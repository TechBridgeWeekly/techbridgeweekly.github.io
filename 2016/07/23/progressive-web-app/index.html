<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>Progressive Web App 會是未來趨勢嗎？ | TechBridge 技術共筆部落格</title>
  <meta name="description" content="TechBridge Weekly 技術週刊團隊是一群對用技術改變世界懷抱熱情的團隊。本技術共筆部落格初期專注於Web前後端、行動網路、機器人/物聯網、數據分析與產品設計等技術分享" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- google-site-verification -->
  <meta
    name="google-site-verification"
    content="bcOr2jIfPaRI5ngBviymG6zkEU_VN3sbfABLt0hsmoc"
  />
  <link
    rel="stylesheet preload"
    type="text/css"
    href="/css/screen.css"
    as="style"
  />
  <link
    rel="stylesheet preload"
    type="text/css"
    href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400"
    as="style"
  />

  <!-- Favicons -->
  <link rel="apple-touch-icon" href="/img/favicon.ico" />
  <link rel="icon preload" href="/img/favicon.ico" as="image" />

   
  <link
    rel="alternate"
    type="application/atom+xml"
    title="Atom 0.3"
    href="atom.xml"
  />
    
</head>


<body class="post-template">

  <header class="site-head" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo-tb-500-500.png" alt="Blog Logo"/></a> 
            <h1 class="blog-title">TechBridge 技術共筆部落格</h1>
            <h2 class="blog-description">var topics = ['Web前後端', '行動網路', '機器人/物聯網', '數據分析', '產品設計', 'etc.']</h2>
            <div class="navbar-block">
                <span><a href="/">首頁</a></span> / <span><a href="/about/">關於我們</a></span> / <span><a href="http://weekly.techbridge.cc/" target="_blank">技術週刊</a></span> / <span><a href="https://www.facebook.com/techbridge.cc/" target="_blank">粉絲專頁</a></span> / <span><a href="/atom.xml" target="_blank">訂閱RSS </a></span>
                <br>
            </div>
        </div>
    </div>
</header>
  

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2016-07-23T21:32:34.000Z" itemprop="datePublished">
          2016-07-23
      </time>
    
    
    | 
    <a href='/tags/pwa/'>pwa</a>,
    
    <a href='/tags/web-app/'>web app</a>
    
    
</span>

<meta name="generator" content="Progressive Web App 會是未來趨勢嗎？">
<meta name="og:title" content="Progressive Web App 會是未來趨勢嗎？">
<meta name="og:description" content="TechBridge Weekly 技術週刊團隊是一群對用技術改變世界懷抱熱情的團隊。本技術共筆部落格初期專注於Web前後端、行動網路、機器人/物聯網、數據分析與產品設計等技術分享。">
<meta name="og:type" content="website">
<meta name="og:image" content="/img/og-cover.png">

    <h1 class="post-title">Progressive Web App 會是未來趨勢嗎？</h1>
    <section class="post-content">
      <div class="fb-like" data-href="https://www.facebook.com/techbridge.cc" data-layout="button_count" data-action="like" data-size="large" data-show-faces="false" data-share="true"></div>   
      <hr>
      <p>距離今年 Google I&#x2F;O 2016 轉眼間也過了兩個多月，議程中提及的 Progressive Web App (PWA) 似乎討論不多，我當時隨便掃過 Google Developers 上的資料後的念頭是：“怎麼有點像當年 Firefox OS 上跑 web app的長相？”</p>
<p>其實我覺得是蠻雷同的，差別在於 Progressive Web App 是想能夠直接利用目前的 Browser 來支援其運作。實際上 Mozilla 一樣有在推動相關標準的建立。</p>
<p>這也是我初次接觸 Progressive Web App，因此就照著 Google Developers 上的教學走一遍，並紀錄分享在此。</p>
<h2 id="何謂-Progressive-Web-App-PWA"><a href="#何謂-Progressive-Web-App-PWA" class="headerlink" title="何謂 Progressive Web App (PWA)"></a>何謂 Progressive Web App (PWA)</h2><p>先講結論，Progressive Web App 是希望能夠讓 Web application 盡可能的在各種環境（網路環境、手機作業系統等）下都能順暢且不減功能性的運作，並讓你的 Web App 可以：</p>
<ol>
<li>直接被使用者安裝到桌面</li>
<li>offline 使用</li>
<li>擁有推播功能</li>
<li>開啟時看不到 URL Bar（類 Native app 的使用經驗）</li>
<li>開啟時有 Splash Screen</li>
</ol>
<p>而要做到這些事情，整個 PWA 的設計要點就會包含以下特性：</p>
<ul>
<li><p><strong><span style="color: #c11b1b">Progressive - 漸進增強：在越完善的環境下，能執行更加完整的服務，若環境不許可，能夠優雅降級，運行最基本的功能。</span></strong></p>
</li>
<li><p>Responsive - 響應式介面：能夠在各種螢幕尺寸下顯示、能夠因應多種輸入方式與設備回饋（震動、音頻等）。</p>
</li>
<li><p><strong><span style="color: #c11b1b">App-like - 類原生程式的操作模式與使用者介面：採用原生平台（Native App）的 Style 與資料更新方式（利用 service worker 存取快取資源）。</span></strong></p>
</li>
<li><p><strong><span style="color: #c11b1b">Fresh - 持續更新：使用 Service worker API 來自動更新應用程式（無需透過 App store, Google Play 等）。</span></strong></p>
</li>
<li><p>Safe - 應全面採用 HTTPS 提供最基本的安全防護。</p>
</li>
<li><p>Discoverable - 透過設置 manifest 檔案，一樣能進行 SEO 優化，讓搜尋引擎找得到你的 APP。</p>
</li>
<li><p><strong><span style="color: #c11b1b">Re-engageable - 透過推播，能主動與使用者互動。</span></strong></p>
</li>
<li><p><strong><span style="color: #c11b1b">Installable - 可安裝：透過 Add To Home 等方式，將 Web App 放在手機桌面，並且能在應用程式中單獨列出與切換，就像一般的 App 一樣，但完全不用透過應用程式商店下載。</span></strong></p>
</li>
<li><p>Linkable - 透過 URL 可以隨時分享你的 App。</p>
</li>
</ul>
<p>上面是官網所列出的，而紅色是我認為較為重點的特徵，而在這些重點特徵下，最大要點就是 Service worker。有了 Service worker 的幫助，你可以實作出離線可用的 Web App，讓 User 操作起來有更佳的使用體驗。</p>
<!-- 簡介 service worker -->

<h2 id="Service-Worker"><a href="#Service-Worker" class="headerlink" title="Service Worker"></a>Service Worker</h2><p>Service worker 是一個運行在瀏覽器背後的腳本，有其自己的生命週期，並獨立於網頁頁面。<br>其特性如下：</p>
<ul>
<li><p><strong><span style="color: #071684">Javascript worker，無法直接操作頁面 DOM，但可透過 <code>postMessage</code> 與頁面溝通，讓該頁面自行操作 DOM。</span></strong></p>
</li>
<li><p><strong><span style="color: #071684">Service worker 可以讓你截取並掌控頁面發出的 network request。(這點很重要！要記住！！)</span></strong></p>
</li>
<li><p><strong><span style="color: #071684">當 Service worker 不需要被使用時，會進入 Terminated 生命週期，等待下一次的需求進來。因此你在 onfetch 或是 onmessage 的 event handler 中若想要儲存全域變數，必須使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API">IndexedDB</a> API 來輔助儲存。</span></strong></p>
</li>
<li><p><strong><span style="color: #071684">使用 Promise (這對一般開發者來說應該已經不算難事)</span></strong></p>
</li>
</ul>
<p>待會進行 PWA 實作的時候，我們就會運用到 service worker，透過 intercept 以及 handle network requests 來幫忙處理 Cache 的議題。</p>
<p>今天重點擺在 PWA，Service Worker 的相關介紹可以看這裡：<br><a target="_blank" rel="noopener" href="http://www.html5rocks.com/en/tutorials/service-worker/introduction/">source: html5rocks</a><br><img src="/img/arvinh/sw-lifecycle.png" alt="Service Worker LifeCycle" style="width: 500px;"/></p>
<!-- 動手做第一個 pwa -->
<p>看太多文字會想睡覺，所以開始動手做我們的第一個 Progressive Web App 吧！</p>
<h1 id="Progressive-Web-App"><a href="#Progressive-Web-App" class="headerlink" title="Progressive Web App"></a>Progressive Web App</h1><p>為求快速，我們跟著 Google developers 上的範例程式走一遍，才能專注在 PWA 的部分，不用去管其他細節。code 可以在此下載 <a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/getting-started/your-first-progressive-web-app/pwa-weather.zip">google developers pwa example</a>，後續步驟會需要這份 code 來做對應比較方便理解。</p>
<p>範例是一個天氣卡，可以顯示所選區域的天氣狀況，大致上會長這樣：</p>
<img src="/img/arvinh/pwa-weather-example-final.png" alt="pwa-weather" style="width: 200px;"/>

<h2 id="App-Shell-Architecture"><a href="#App-Shell-Architecture" class="headerlink" title="App Shell Architecture"></a>App Shell Architecture</h2><p>當你用瀏覽器打開一個網頁時，通常都需要等該頁面載完需要的 javascript, css 等等檔案後，你才能看到一個完整的頁面，在 SPA 當道的現今更是如此（姑且先不談 server-side render）</p>
<p>但還記得先前提過，Progressive Web App 的目標是想要能夠 <strong><span style="color: #c11b1b">讓 Web application 盡可能的在各種環境（網路環境、手機作業系統等）下都能順暢且不減功能性的運作。</span></strong></p>
<p>因此 PWA 提出了一個 <strong>App Shell Architecture</strong></p>
<p>App shell architecture 將應用程式的基礎設施（infrastructure）、UI 與資料做分離，並利用 service worker 將 infra 與 UI 做 Cache，如此一來，當你重複打開 Web App 時，需要遠端載入的就只剩下資料，因為其他部分都已經先快取在本地端了（也可以把部分資料先快取起來）。</p>
<p>由上述說明應該不難看出 app shell 的設計會非常重要，他決定了你的 User 進到你的 App 後的第一印象。所以在設計 App shell architecture 時，有幾個要點必須考量清楚：</p>
<ul>
<li><p>當 Web App 開啟時，哪些東西需要立即呈現在螢幕上?</p>
</li>
<li><p>有哪些是重要的 UI components？</p>
</li>
<li><p>此 app shell 是否需要 styles, javascript 等等資源？</p>
</li>
</ul>
<p>以今天的範例來說，我們會預期一開啟 App 時，要能馬上看到最上方的 Header 以及中間至少一張天氣預測卡，因此這兩個元件就會是我們必須設計進 App shell architecture 的 component。</p>
<p>稍稍整理一下，我們的 App shell 將會擁有：</p>
<ul>
<li><p>顯示 App 名稱、更新與新增按鈕的 Header Bar</p>
</li>
<li><p>Header 下方放置天氣卡的 Container</p>
</li>
<li><p>天氣卡模板</p>
</li>
<li><p>加入地區天氣時的對話筐</p>
</li>
<li><p>載入狀態的 loader</p>
</li>
</ul>
<h2 id="App-shell-architecture-implementation"><a href="#App-shell-architecture-implementation" class="headerlink" title="App shell architecture implementation"></a>App shell architecture implementation</h2><p>根據上方列出的需求，身為 web developer 一定很快就會把 HTML、CSS 刻好，甚至將可能需要的 JS 都先準備好，但實際上 Progressive web app 的重點其實在於如何將元件與資料做 cache ，以及 app-like 的顯示模式，因此我們跳過這些跟基礎 web 開發相關的步驟，直接到剛剛下載的範例檔案中，打開 step-04 資料夾，裡面就有了最 default 的元件 layout（<code>index.html</code>, <code>inline.cs</code>），以及資料 fetch 相關的 javascript 檔案（<code>app.js</code>）：</p>
<img src="/img/arvinh/step-04-foldr.png" alt="step-04 folder" style="width: 200px;"/>

<p><strong><span style="color: #c11b1b">[!NOTICE] 需要將程式碼內的一些相關路徑修改一下才能正常運作喔！</span></strong></p>
<p>開啟以後正常會看到如下畫面：</p>
<p><img src="/img/arvinh/step-04.gif" alt="step-04" title="step-04"></p>
<p>會先閃過 loading 圈圈，接著利用 <code>initialWeatherForecast</code> 做第一次資料繪製，這邊是先寫死一個假資料，但實務上應該要根據 user 當下 ip location 去抓取資料並更新。</p>
<p>但不管是假資料與否，重點在於，當處理完第一次資料 fetch 後，要能夠 cache 起來，才能應付 slow connection 或是 offline 的狀況。也就是待會 service-worker 要負責的事情。</p>
<p>此外，此 Wep app的功能中，要<strong>讓 user 能夠選擇想要的區域</strong>，我們總不能要 user 每次進來都重選，因此要能儲存這部分資訊，實務上可以用 <code>IndexDB</code> 來儲存，Google 推薦的 lib 為 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/idb">idb</a>，而這邊我們簡單用 LocalStorage API 來處理即可。</p>
<p>相關設定在 <code>app.js</code> 當中：</p>
<figure class="highlight js"><figcaption><span>app.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Iterate all of the cards and attempt to get the latest forecast data</span></span><br><span class="line"> app.<span class="property">updateForecasts</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">var</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(app.<span class="property">visibleCards</span>);</span><br><span class="line">   keys.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">key</span>) &#123;</span><br><span class="line">     app.<span class="title function_">getForecast</span>(key);</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Save list of cities to localStorage, see note below about localStorage.</span></span><br><span class="line"> app.<span class="property">saveSelectedCities</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">var</span> selectedCities = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(app.<span class="property">selectedCities</span>);</span><br><span class="line">   <span class="comment">// IMPORTANT: See notes about use of localStorage.</span></span><br><span class="line">   <span class="variable language_">localStorage</span>.<span class="property">selectedCities</span> = selectedCities;</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> app.<span class="property">selectedCities</span> = <span class="variable language_">localStorage</span>.<span class="property">selectedCities</span>;</span><br><span class="line"> <span class="keyword">if</span> (app.<span class="property">selectedCities</span>) &#123;</span><br><span class="line">   app.<span class="property">selectedCities</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(app.<span class="property">selectedCities</span>);</span><br><span class="line">   app.<span class="property">selectedCities</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">city</span>) &#123;</span><br><span class="line">     app.<span class="title function_">getForecast</span>(city.<span class="property">key</span>, city.<span class="property">label</span>);</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   app.<span class="title function_">updateForecastCard</span>(initialWeatherForecast);</span><br><span class="line">   app.<span class="property">selectedCities</span> = [</span><br><span class="line">     &#123;<span class="attr">key</span>: initialWeatherForecast.<span class="property">key</span>, <span class="attr">label</span>: initialWeatherForecast.<span class="property">label</span>&#125;</span><br><span class="line">   ];</span><br><span class="line">   app.<span class="title function_">saveSelectedCities</span>();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>如此一來，你可以新增想要的城市，在當你重新載入時，就會看到剛剛所選的城市依然會出現了。</p>
<p><img src="/img/arvinh/localstorage.gif" alt="localstorage" title="local storage test"></p>
<h2 id="Use-Service-Worker-to-Pre-cache-the-App-Shell"><a href="#Use-Service-Worker-to-Pre-cache-the-App-Shell" class="headerlink" title="Use Service Worker to Pre-cache the App Shell"></a>Use Service Worker to Pre-cache the App Shell</h2><h3 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h3><p><strong><span style="color: #c11b1b">Service worker 的功能只能在 localhost 或是 HTTPS 的環境下，並且目前的瀏覽器有支援的不多，至少要 Chrome 47 以上。不過相信會越來越多瀏覽器加入此支援的。</span></strong></p>
<h3 id="step-1-註冊-service-worker"><a href="#step-1-註冊-service-worker" class="headerlink" title="step 1. 註冊 service worker"></a>step 1. 註冊 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">service worker</a></h3><p>在我們的 <code>app.js</code> 中，需要先檢查是否有 service worker 存在，若無，則透過 <code>navigator.serviceWorker</code> 去註冊。</p>
<figure class="highlight js"><figcaption><span>app.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;serviceWorker&#x27;</span> <span class="keyword">in</span> navigator) &#123;  </span><br><span class="line">  navigator.<span class="property">serviceWorker</span>  </span><br><span class="line">           .<span class="title function_">register</span>(<span class="string">&#x27;/service-worker.js&#x27;</span>)  </span><br><span class="line">           .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Service Worker Registered&#x27;</span>); &#125;);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>當然，我們也要創建好我們的 <code>service-worker.js</code>。 Service worker 的檔案要放在<strong>根目錄</strong>底下，因為 service worker 的 js scope 是包含其所在之目錄。</p>
<h3 id="step-2-Pre-cache-assets"><a href="#step-2-Pre-cache-assets" class="headerlink" title="step 2. Pre-cache assets"></a>step 2. Pre-cache assets</h3><p>當 service worker 被註冊好後，當使用者初次開啟我們的 web app，會觸發一個 <code>install</code> event，而我們可以在這個 event handler 中 cache 住我們需要的 assets。</p>
<figure class="highlight js"><figcaption><span>service-worker.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;install&#x27;</span>, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[ServiceWorker] Install&#x27;</span>);</span><br><span class="line">  e.<span class="title function_">waitUntil</span>(</span><br><span class="line">    caches.<span class="title function_">open</span>(cacheName).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">cache</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[ServiceWorker] Caching App Shell&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span> cache.<span class="title function_">addAll</span>(filesToCache);</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>其中的 caches 是 Service Worker API 中的 <code>CacheStorage</code>，可以到 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/open">MDN</a> 瞭解一下。</strong></p>
<p>此外，<code>chacheName</code> 的設定也是蠻重要的，可以依此來分開你的資料與 App shell 的快取。</p>
<p>當你 <code>caches.open</code>後，裡面的 callback 可以呼叫 <code>cache.addAll()</code> 來將 assets 放入快取，<code>cache.addAll()</code> 接受 <code>URL</code> list，像是這樣的格式：</p>
<figure class="highlight js"><figcaption><span>service-worker.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> filesToCache = [  </span><br><span class="line">  <span class="string">&#x27;/&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/index.html&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/scripts/app.js&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/styles/inline.css&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/clear.png&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/cloudy-scattered-showers.png&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/cloudy.png&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/fog.png&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/ic\_add\_white\_24px.svg&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/ic\_refresh\_white\_24px.svg&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/partly-cloudy.png&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/rain.png&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/scattered-showers.png&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/sleet.png&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/snow.png&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/thunderstorm.png&#x27;</span>,  </span><br><span class="line">  <span class="string">&#x27;/images/wind.png&#x27;</span>  </span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>建議你加入版號來設置你的 <code>cachName</code>，這樣才能確保每次更新都能拿到最新資料。不過要記得將過期的 cache 清空！<br>我們可以在 <code>activate</code> 這個 event 的 handler 來做這件事情。</p>
<figure class="highlight js"><figcaption><span>service-worker.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;activate&#x27;</span>, <span class="keyword">function</span>(<span class="params">e</span>) &#123;  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[ServiceWorker] Activate&#x27;</span>);  </span><br><span class="line">  e.<span class="title function_">waitUntil</span>(  </span><br><span class="line">    caches.<span class="title function_">keys</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">keyList</span>) &#123;  </span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(keyList.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">key</span>) &#123;  </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[ServiceWorker] Removing old cache&#x27;</span>, key);  </span><br><span class="line">        <span class="keyword">if</span> (key !== cacheName) &#123;  </span><br><span class="line">          <span class="keyword">return</span> caches.<span class="title function_">delete</span>(key);  </span><br><span class="line">        &#125;  </span><br><span class="line">      &#125;));  </span><br><span class="line">    &#125;)  </span><br><span class="line">  );  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="step-3-Fetch-assets-from-cache-or-not"><a href="#step-3-Fetch-assets-from-cache-or-not" class="headerlink" title="step 3. Fetch assets from cache or not"></a>step 3. Fetch assets from cache or not</h3><p>到目前為止，我們知道了怎麼把 assets 存進 cache 裡面，但要怎麼拿出來呢？<br>我們註冊一個 <code>fetch</code> event handler，用來擷取 web app 發出的 request，當 request 有 match 到我們剛剛存入的那些 assets 時，我們就從中取出並回傳，若並沒有 match 到，則利用 <code>fetch</code> api 去真的打 request。 [ fetch api 也是目前實驗中的 web api，介紹可看 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch api</a> ]</p>
<figure class="highlight js"><figcaption><span>service-worker.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;fetch&#x27;</span>, <span class="keyword">function</span>(<span class="params">e</span>) &#123;  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[ServiceWorker] Fetch&#x27;</span>, e.<span class="property">request</span>.<span class="property">url</span>);  </span><br><span class="line">  e.<span class="title function_">respondWith</span>(  </span><br><span class="line">    caches.<span class="title function_">match</span>(e.<span class="property">request</span>).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>) &#123;  </span><br><span class="line">      <span class="keyword">return</span> response || <span class="title function_">fetch</span>(e.<span class="property">request</span>);  </span><br><span class="line">    &#125;)  </span><br><span class="line">  );  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Beware-of-the-edge-cases"><a href="#Beware-of-the-edge-cases" class="headerlink" title="Beware of the edge cases"></a>Beware of the edge cases</h3><p>目前範例中的 code 實際上並不適合運用在 production 上頭，因為有許多 edge cases 沒有被考慮與處理到：</p>
<ol>
<li>剛剛提過的，當你的 content 有變動時，cache key 要更新（範例內我們需要手動更新）。</li>
<li>只要你的檔案有一點點更動，小至 typo，大至 code refactor，都會造成 cache invalidated，需要重新下載，效率不好。</li>
<li>必須確保 service-worker 中的 <code>install handler</code> 所發出的 https request 不會被 Brower cache 影響，否則會無法 update。</li>
<li>最重要的一點，範例採用 cache-first 的策略，任何 request 只要有 cache 在就會先拿 cache，若 service worker 相關的註冊與設定也被 cache 時，更新會變得很困難。</li>
</ol>
<p>Google 提出一套 lib <a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/sw-precache">sw-precache</a> 來幫助你避免上述的 edge cases，這超出此篇的範疇，但若要製作 Productoin 版本的 PWA 時，務必研究一下。</p>
<p>此外，在開發中，也可以透過 <code>chrome://serviceworker-internals</code> 來 stop、un-register 現存的 service workers 以及 fresh start service worker。</p>
<h3 id="Test-Service-worker"><a href="#Test-Service-worker" class="headerlink" title="Test Service worker"></a>Test Service worker</h3><p>現在我們可以來試試看剛剛的 service worker 到底能不能幫我們把 assets cache 起來，你可以像 Google 教學中 deploy 到 <a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/getting-started/your-first-progressive-web-app/step-08?hl=en">firebase</a>，也可以學我直接用 express 來 host。</p>
<p>用 express 來 host 範例需要更動幾個地方：</p>
<ol>
<li>把範例的 index.html, inline.css, app.js 和一些 images 放入 express 中的相對路徑。</li>
<li>修改 service-worker.js 中的 <code>filesToCache</code> 相對路徑，主要是 app.js 與 inline.css</li>
</ol>
<figure class="highlight js"><figcaption><span>service-worker-in-express.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> filesToCache = [</span><br><span class="line">  <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/javascripts/app.js&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/stylesheets/inline.css&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;..&#x27;</span></span><br></pre></td></tr></table></figure>

<p>啟動server 後，開啟 Chrome devTool 的 resources tab，應該可以看到如下畫面，就代表你的 service worker 有成功幫你 cache 住 assets：</p>
<p><img src="/img/arvinh/cache-example.png" alt="service-worker cache" title="service-worker cache"></p>
<h3 id="step-4-Cache-Data"><a href="#step-4-Cache-Data" class="headerlink" title="step 4. Cache Data"></a>step 4. Cache Data</h3><p>接下來我們要 cache 住資料！</p>
<p>策略上分兩種：</p>
<ol>
<li>cache first then network：一次發兩種 request，先抓 cache 資料，等 network request 回來後更新 cache。</li>
<li>network first then cache：先發 network request，若 timeout 再撈 cache 資料。</li>
</ol>
<p>這邊我們採用 cache-first，才能因應快速 response 與 offline 使用的需求。</p>
<p>首先我們得在 service-worker 中加入一個 <code>dataCacheName</code>，用以區分資料與 app shell 的 cache。</p>
<figure class="highlight js"><figcaption><span>service-worker.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dataCacheName = <span class="string">&#x27;weatherData-v1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>接著在 <code>fetch</code> event handler 中，我們將抓取資料的API request 與其他 request 分開。</p>
<figure class="highlight js"><figcaption><span>service-worker.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;fetch&#x27;</span>, <span class="keyword">function</span>(<span class="params">e</span>) &#123;  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[ServiceWorker] Fetch&#x27;</span>, e.<span class="property">request</span>.<span class="property">url</span>);  </span><br><span class="line">  <span class="keyword">var</span> dataUrl = <span class="string">&#x27;https://publicdata-weather.firebaseio.com/&#x27;</span>;  </span><br><span class="line">  <span class="keyword">if</span> (e.<span class="property">request</span>.<span class="property">url</span>.<span class="title function_">indexOf</span>(dataUrl) === <span class="number">0</span>) &#123;  </span><br><span class="line">    <span class="comment">// Put data handler code here  </span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    e.<span class="title function_">respondWith</span>(  </span><br><span class="line">      caches.<span class="title function_">match</span>(e.<span class="property">request</span>).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>) &#123;  </span><br><span class="line">        <span class="keyword">return</span> response || <span class="title function_">fetch</span>(e.<span class="property">request</span>);  </span><br><span class="line">      &#125;)  </span><br><span class="line">    );  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面的 code 中，service-worker 會擷取頁面發出的 request，如果包含 dataUrl，我們就另外處理：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">e.<span class="title function_">respondWith</span>(  </span><br><span class="line">  <span class="title function_">fetch</span>(e.<span class="property">request</span>)  </span><br><span class="line">    .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>) &#123;  </span><br><span class="line">      <span class="keyword">return</span> caches.<span class="title function_">open</span>(dataCacheName).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">cache</span>) &#123;  </span><br><span class="line">        cache.<span class="title function_">put</span>(e.<span class="property">request</span>.<span class="property">url</span>, response.<span class="title function_">clone</span>());  </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[ServiceWorker] Fetched&amp;Cached Data&#x27;</span>);  </span><br><span class="line">        <span class="keyword">return</span> response;  </span><br><span class="line">      &#125;);  </span><br><span class="line">    &#125;)  </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>利用 <code>fetch API</code> 發送 request，送回來的 response 再傳回去之前，會先 clone 一份到 cache 當中。</p>
<p>到這邊為止我們 cache 住資料了，但還是不能 offline 運作！因為還少了一個步驟，先前提到我們要同步發送 <strong>兩個</strong> request，一個抓 cache，一個真的送資料。</p>
<p>在 <code>app.js</code> 中的 <code>app.getForecast</code>裡加入這段：</p>
<figure class="highlight js"><figcaption><span>app.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;caches&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span>) &#123;</span><br><span class="line">  caches.<span class="title function_">match</span>(url).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (response) &#123;</span><br><span class="line">      response.<span class="title function_">json</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">json</span>) &#123;</span><br><span class="line">        <span class="comment">// Only update if the XHR is still pending, otherwise the XHR</span></span><br><span class="line">        <span class="comment">// has already returned and provided the latest data.</span></span><br><span class="line">        <span class="keyword">if</span> (app.<span class="property">hasRequestPending</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[App] Forecast Updated From Cache&#x27;</span>);</span><br><span class="line">          json.<span class="property">key</span> = key;</span><br><span class="line">          json.<span class="property">label</span> = label;</span><br><span class="line">          app.<span class="title function_">updateForecastCard</span>(json);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先檢查 <code>window</code> 有無支援 <code>caches</code> object，接著從 caches 中拿出資料，這時要確認一下同時發送出去的 network request 是否已經 response 回來了，我們這邊用個 flag <code>app.hasRequestPending</code> 來控制。只有在 network response 還沒回來前我們會使用 caches 內的資料。</p>
<p>而在發送原本的 <code>XMLHttpRequest</code> 之前，記得加上 <code>app.hasRequestPending = true;</code>，並在 <code>app.updateForecastCard(response)</code>之前，將 <code>app.hasRequestPending</code> 設為 false。</p>
<h3 id="Test-Offline-function"><a href="#Test-Offline-function" class="headerlink" title="Test Offline function"></a>Test Offline function</h3><p>到目前為止我們的 Web app 已經可以在 offline 使用了，即便遠端 host 掛掉，我們能從 cache 中抓到我們的 App Shell，並且透過 service worker 幫我們去跟 <code>https://publicdata-weather.firebaseio.com/</code> 要資料；若是連網路都沒有，至少會有 cache 的資料可以顯示！</p>
<p><img src="/img/arvinh/offline-1.gif" alt="offline test I- without host server" title="offline test"></p>
<p><img src="/img/arvinh/offlinetest-2.gif" alt="offline test II - without network connection" title="offline test"></p>
<h2 id="Support-Native-Integration"><a href="#Support-Native-Integration" class="headerlink" title="Support Native Integration"></a>Support Native Integration</h2><p>Progressive Web App 的最後一哩路，我們要加入 Add-to-Homescreen。</p>
<p>要有 Add to Homescreen 的功能不難，只要加入一個 manifest.json 即可，透過這方式打開的 Web App 不會顯示出 URL bar，看起來就像一般的 App！你也可以再加入 Web app install banners，這邊就不討論，可以看這篇的教學 - <a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/engage-and-retain/app-install-banners/">Web app install banners</a></p>
<h3 id="Web-App-Manifest"><a href="#Web-App-Manifest" class="headerlink" title="Web App Manifest"></a>Web App Manifest</h3><p>透過 web app manifest，你可以：</p>
<ul>
<li><p>像 App 一般有個漂亮 icon 顯現在 Android 的 Homescreen 上。</p>
</li>
<li><p>開啟時可以進入全螢幕畫面，不顯示 URL bar！</p>
</li>
<li><p>控制 screen orientation。</p>
</li>
<li><p>設定 <code>splash screen</code>，以前是為了降低 User 等待載入時間，但現在通常都用來宣傳你的網站品牌等等（有些人是不推薦使用…）</p>
</li>
<li><p>追蹤你的 App 是從 homescreen 還是 url 開啟。</p>
</li>
</ul>
<figure class="highlight json"><figcaption><span>manifets.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Weather&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;short_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Weather&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;icons&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/icons/icon-128x128.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;128x128&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/icons/icon-144x144.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;144x144&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/icons/icon-152x152.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;152x152&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/touch/icon-192x192.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;192x192&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;images/touch/icon-256x256.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;256x256&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image/png&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;display&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standalone&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;background_color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#3E4EB8&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;theme_color&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#2F3BA2&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>[小技巧] 可以透過在 <code>start_url</code> 設置 query string 的參數來追蹤開啟來源。</p>
<p>manifest 檔案設定好後記得回到你的 <code>index.html</code> 的 <code>&lt;head&gt;</code> 加上 <code>&lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot;&gt;</code></p>
<h3 id="for-safari-in-ios"><a href="#for-safari-in-ios" class="headerlink" title="for safari in ios"></a>for safari in ios</h3><p>如果要用在 ios 上的 safari 還需要額外設定</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Add to home screen for Safari on iOS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apple-mobile-web-app-capable&quot;</span> <span class="attr">content</span>=<span class="string">&quot;yes&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apple-mobile-web-app-status-bar-style&quot;</span> <span class="attr">content</span>=<span class="string">&quot;black&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apple-mobile-web-app-title&quot;</span> <span class="attr">content</span>=<span class="string">&quot;Weather App&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;images/icons/icon-152x152.png&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Best-practices"><a href="#Best-practices" class="headerlink" title="Best practices"></a>Best practices</h3><ul>
<li>在你網站的每個 page 都可放入 manifest.json，這樣不管 user 是從哪頁進去，Chrome都能偵測到</li>
<li><code>short_name</code> 盡量都要設置，優先權高於 <code>name</code> 這個 field。</li>
<li>icon 的大小要盡可能符合多種 device。</li>
<li>icon 也要考量到是否符合 slash screen，並記得設置 <code>background_color</code></li>
</ul>
<h2 id="Final"><a href="#Final" class="headerlink" title="Final"></a>Final</h2><p>最終到你手機上的呈現就會像這樣：</p>
<p>IOS 版本 (ISO 版本看不到 splash screen，不確定原因，可能版本不支援）：</p>
<img src="/img/arvinh/iphoneDemo_1.gif" alt="iphone demo" style="width: 400px;"/>

<p>Android 版本（主要是看得到 splash screen..）：</p>
<img src="/img/arvinh/android-1.jpg" alt="android demo" style="width: 300px;"/>

<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>看了今年 Google I&#x2F;O 與 Apple WWDC 後，Apple 感覺想把 App 更融入他們的系統，以後或許不會再有 App 的概念，就是 Apple。而 Google 則持續推廣 Progressive Web App，希望讓 Web 能夠更行動化，似乎都希望能夠弭平一些隔閡。</p>
<p>我個人是蠻希望 Progressive Web App 的方式能普及，可惜現在的瀏覽器支援度還很差，需要更多時間，但大家應該有看過這張圖：</p>
<img src="/img/arvinh/appinstall.png" alt="source: https://www.youtube.com/watch?v=MyQ8mtR9WxI" style="width: 300px;"/>

<p>App 從下載到安裝使用的人數差了四分之一，如果 Progressive Web App 可以起來的話，相信對使用者與開發者來說都是雙贏的局面（更多人使用、又不會佔手機空間、又不用到 app store 更新），但大廠怎麼想就不知道了…</p>
<p>但至少 Progressive web app 會帶給使用者更好的 web 瀏覽體驗是無庸置疑的！</p>
<!-- 資料來源 -->
<h2 id="資料來源"><a href="#資料來源" class="headerlink" title="資料來源"></a>資料來源</h2><ol>
<li><a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/getting-started/your-first-progressive-web-app/?hl=zh-tw">Google developer web fundamentals</a></li>
<li><a target="_blank" rel="noopener" href="http://www.html5rocks.com/en/tutorials/service-worker/introduction/">html5rocks: service-worker</a></li>
<li><a target="_blank" rel="noopener" href="https://developers.google.com/web/fundamentals/engage-and-retain/app-install-banners/">Google developer web app install banner</a></li>
</ol>
<p>關於作者：<br><a target="_blank" rel="noopener" href="http://blog.arvinh.info/about/">@arvinh</a> 前端攻城獅，熱愛數據分析和資訊視覺化</p>
  
      <div>喜歡我們的文章嗎？歡迎分享按讚給予我們支持和鼓勵！</div>
      <div class="fb-like" data-href="https://blog.techbridge.cc/2016/07/23/progressive-web-app/index.html" data-layout="button_count" data-action="like" data-size="large" data-show-faces="false" data-share="true"></div>
      <br>
      <br>
      <div class="fb-page" data-href="https://www.facebook.com/techbridge.cc" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="https://www.facebook.com/techbridge.cc" class="fb-xfbml-parse-ignore"><a target="_blank" rel="noopener" href="https://www.facebook.com/techbridge.cc">TechBridge 技術日報</a></blockquote></div>
      <br>
    </section>
    <br>
    <hr>
    <div>
      <h4>訂閱 TechBridge Weekly 技術週刊，每週發送最精華的技術開發、產品設計的資訊給您</h4>
      <form class="form-control" method="post" action="https://goodbits.io/e/cab8a418-6b70-48d6-97ea-b5f0ef34b22c" target="_blank">
        <input class="form-control" type="text" name="first_name" placeholder="First Name"></input>
        <input class="form-control" type="text" name="last_name" placeholder="Last Name"></input>
        <div>
          <input class="form-control" type="text" name="email" placeholder="Email"></input>
        </div>
        <br>
        <div>
          <button class="form-control btn subscribe-btn" type="submit">馬上訂閱技術週刊</button>
        </div>
        <br>
        <label for="">PS. 我們討厭垃圾信，所以我們只提供有價值的內容給您 :)</label>
      </form>
    </div>
    <footer class="post-footer">
      <section class="author">
    <h4>TechBridge Weekly 技術週刊編輯團隊</h4>
    <p>TechBridge Weekly 技術週刊團隊是一群對用技術改變世界懷抱熱情的團隊。本技術共筆部落格初期專注於Web前後端、行動網路、機器人/物聯網、資料科學與產品設計等技術分享。This is TechBridge Weekly Team Tech Blog, which focus on web, mobile, robotics, IoT, Data Science technology sharing.</p>
    <span><a href="/2016/03/19/about/">關於我們</a></span> / <span><a href="https://www.techbridge.cc/" target="_blank">技術日報</a></span> / <span><a href="http://weekly.techbridge.cc/" target="_blank">技術週刊</a></span> / <span><a href="https://www.facebook.com/techbridge.cc/" target="_blank">粉絲專頁</a></span> / <span><a href="/atom.xml" target="_blank">訂閱RSS </a></span>   
	<div class="fb-like" data-href="https://www.facebook.com/techbridge.cc" data-layout="button_count" data-size="large" data-action="like" data-show-faces="false" data-share="true"></div>    
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" target="_blank" rel="noopener" href="http://twitter.com/share?url=https://blog.techbridge.cc/2016/07/23/progressive-web-app/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" target="_blank" rel="noopener" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.techbridge.cc/2016/07/23/progressive-web-app/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" target="_blank" rel="noopener" href="https://plus.google.com/share?url=https://blog.techbridge.cc/2016/07/23/progressive-web-app/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
    <iframe src="https://ghbtns.com/github-btn.html?user=TechBridgeHQ&repo=blog-starter-kit&type=star&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>      
</section>
    </footer>
    <br>
  </article>
  <nav class="pagination" role="pagination">
    <h2>更多優質技術文章</h2>
    
    <a class="newer-posts" href="/2016/07/30/react-dev-enviroment-webpack-browserify/">
        ← 一看就懂的 React 開發環境建置與 Webpack 入門教學
    </a>
    
    <span class="page-number">•</span>
    
    <a class="older-posts" href="/2016/07/16/javascript-jsfuck-and-aaencode/">
        讓 JavaSript 難以閱讀：jsfuck 與 aaencode →
    </a>
    
</nav>
  <div id="comment" class="comments-area">
    <h1 class="title"><a href="#disqus_comments" name="disqus_comments">留言討論</a></h1>

    
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
    
</div>
</main>


  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75308642-1', 'auto');
  ga('send', 'pageview');

</script>
<footer class="site-footer">
  
  <a class="subscribe icon-feed" href="/atom.xml"><span class="tooltip">Subscribe!</span></a>
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">TechBridge 技術共筆部落格</a> &copy; 2017 &bull; All rights reserved.</section>
  </div>
</footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>


<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '[object Object]']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>


<script type="text/javascript">
    var disqus_shortname = 'techbridgeweekly';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.4/dist/medium-zoom.min.js"></script>
<script>
// NodeList
mediumZoom(document.querySelectorAll('img'));
</script>
  <div id="fb-root"></div>
	<script>(function(d, s, id) {
	  var js, fjs = d.getElementsByTagName(s)[0];
	  if (d.getElementById(id)) return;
	  js = d.createElement(s); js.id = id;
	  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
	  fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));</script>
</body>
</html>
