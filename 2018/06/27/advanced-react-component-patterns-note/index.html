<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>進階 React Component Patterns 筆記（上） | TechBridge 技術共筆部落格</title>
  <meta name="description" content="TechBridge Weekly 技術週刊團隊是一群對用技術改變世界懷抱熱情的團隊。本技術共筆部落格初期專注於Web前後端、行動網路、機器人/物聯網、數據分析與產品設計等技術分享" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- google-site-verification -->
  <meta
    name="google-site-verification"
    content="bcOr2jIfPaRI5ngBviymG6zkEU_VN3sbfABLt0hsmoc"
  />
  <link
    rel="stylesheet preload"
    type="text/css"
    href="/css/screen.css"
    as="style"
  />
  <link
    rel="stylesheet preload"
    type="text/css"
    href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400"
    as="style"
  />

  <!-- Favicons -->
  <link rel="apple-touch-icon" href="/img/favicon.ico" />
  <link rel="icon preload" href="/img/favicon.ico" as="image" />

   
  <link
    rel="alternate"
    type="application/atom+xml"
    title="Atom 0.3"
    href="atom.xml"
  />
    
</head>


<body class="post-template">

  <header class="site-head" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo-tb-500-500.png" alt="Blog Logo"/></a> 
            <h1 class="blog-title">TechBridge 技術共筆部落格</h1>
            <h2 class="blog-description">var topics = ['Web前後端', '行動網路', '機器人/物聯網', '數據分析', '產品設計', 'etc.']</h2>
            <div class="navbar-block">
                <span><a href="/">首頁</a></span> / <span><a href="/about/">關於我們</a></span> / <span><a href="http://weekly.techbridge.cc/" target="_blank">技術週刊</a></span> / <span><a href="https://www.facebook.com/techbridge.cc/" target="_blank">粉絲專頁</a></span> / <span><a href="/atom.xml" target="_blank">訂閱RSS </a></span>
                <br>
            </div>
        </div>
    </div>
</header>
  

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2018-06-27T23:33:27.000Z" itemprop="datePublished">
          2018-06-27
      </time>
    
    
    | 
    <a href='/tags/react/'>react</a>,
    
    <a href='/tags/es6/'>es6</a>,
    
    <a href='/tags/javascript/'>javascript</a>,
    
    <a href='/tags/pattern/'>pattern</a>
    
    
</span>

<meta name="generator" content="進階 React Component Patterns 筆記（上）">
<meta name="og:title" content="進階 React Component Patterns 筆記（上）">
<meta name="og:description" content="TechBridge Weekly 技術週刊團隊是一群對用技術改變世界懷抱熱情的團隊。本技術共筆部落格初期專注於Web前後端、行動網路、機器人/物聯網、數據分析與產品設計等技術分享。">
<meta name="og:type" content="website">
<meta name="og:image" content="/img/og-cover.png">

    <h1 class="post-title">進階 React Component Patterns 筆記（上）</h1>
    <section class="post-content">
      <div class="fb-like" data-href="https://www.facebook.com/techbridge.cc" data-layout="button_count" data-action="like" data-size="large" data-show-faces="false" data-share="true"></div>   
      <hr>
      <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>前不久在 Frontend masters 看到一部影片 <a target="_blank" rel="noopener" href="https://frontendmasters.com/courses/advanced-react-patterns/">Advanced React Patterns</a>，是 Paypal 的工程師 Kent C. Dodds 在某場 workshop 介紹他實作 React component 時所使用的進階 React Patterns（目前似乎要付費觀看，而他在 <a target="_blank" rel="noopener" href="https://egghead.io/courses/advanced-react-component-patterns">egghead.io</a> 上也有一系列教學，同樣要收費就是了…），內容非常豐富扎實，若是想提供一些可高度客製化的共用元件，使用這些 Pattern 絕對是有絕佳的幫助！如果可以，我強烈建議大家自己去聽聽，不用把時間花在閱讀我的文字上 :p</p>
<p>自從看完那影片後，平常開發都會不自覺得去思考這些 pattern，看看如果應用到我目前的專案中，能否帶來益處。</p>
<p>當然有些早已有在使用，而有些則苦無伸展之處，為了加深自己對這些 pattern 的印象與理解，今天就來筆記一下這系列影片的內容，也希望能對來到這邊的讀者有所幫助。</p>
<h2 id="為何要有-Pattern"><a href="#為何要有-Pattern" class="headerlink" title="為何要有 Pattern"></a>為何要有 Pattern</h2><p>在開始介紹之前，我其實想討論一下為什麼需要有 Pattern，或是說，我們真的需要 Pattern 嗎？</p>
<p>會有這樣的疑問其實是在過往經驗中，還蠻常發現採用 Design pattern 的程式碼如果需要修改時，對於不熟悉該 Pattern，或是原作者雖然採用某種 Pattern，但沒有堅持到底，在一些地方為了方便而改採取別種作法；更慘的情況是，在錯誤的情境下，採用了不適合的 pattern，這些情況都容易造成維護上的極大困擾。</p>
<p>所謂的 Pattern，代表的應該是『被分門別類過，通過反覆使用與測試的考驗，且多數人知曉的程式設計經驗總結』，如果說，你今天採用的 Pattern 是團隊內的人都能接受並理解的，然後也都同意該情境下非常適合使用那種 Pattern，非他莫屬，直接打趴其他簡單做法的優缺點，那麼使用 Pattern 是絕對有好處的，除了測試的穩定性、程式碼的重用性外，在開發共用 component 或套件上，更有助於一般元件使用者，像是可以 export 出更加簡潔、方便的 API 等等。</p>
<p>若不是上述情況，有道是『最好的 Pattern，就是沒有 Pattern』，讓邏輯單純簡單、不影響效能、方便接手的人進行維護，可能比起刻意套用 Pattern 來得有效益。所以在開發前，最好花點時間釐清自己的狀況。</p>
<p>不過，你也得先了解有哪些 Patterns，才能在開發時有參考依據麻！所以不管你現在用不用得到，多學還是好的！</p>
<h1 id="React-Component-Patterns"><a href="#React-Component-Patterns" class="headerlink" title="React Component Patterns"></a>React Component Patterns</h1><p>主要想介紹的 React Component Pattern 有幾種：</p>
<ul>
<li>Compound comopnent</li>
<li>Render props comopnent</li>
<li>Prop Collections and Getters</li>
<li>State Initializers</li>
<li>State Reducer</li>
<li>Control Props</li>
<li>Provider</li>
<li>Higher-order component</li>
</ul>
<p>但礙於篇幅關係，打算拆成幾篇文章來說明，今天是上篇，會介紹到 <code>Compound component</code>、<code>Render props component</code> 與 <code>Prop Collections and Getters</code>。</p>
<h2 id="Compound-component"><a href="#Compound-component" class="headerlink" title="Compound component"></a>Compound component</h2><p>假設今天你要撰寫一個 <code>Toggle</code> Component，並且分別在 state <code>On</code> 或 <code>Off</code> 時，能夠顯示不同的文字描述，你會怎麼做？</p>
<p>一個很直覺的做法是，利用 props 來傳遞不同 state 時所需要顯示的文字（只是呈現 idea，並非有功能的 code）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Toggle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  state = &#123; <span class="attr">on</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; whenOn, whenOff &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span> ? whenOn : whenOff;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="title class_">Toggle</span></span><br><span class="line">  whenOn=<span class="string">&quot;Toggle is on&quot;</span></span><br><span class="line">  whenOff=<span class="string">&quot;Toggle is off&quot;</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>這樣做當然可行，但有幾個明顯的壞處：</p>
<ul>
<li>順序無法調動：沒辦法讓 <code>Toggle</code> component 的使用者自由得調整 <code>whenOn</code> 與 <code>whenOff</code> 的顯示順序，除非你另外加入其他 props 來控制。</li>
<li>利用 Props 來傳遞 UI 元件的話，容易造成使用者困擾，只能盡量透過 props 的命名來區別 UI 元件與其他狀態控制的 pros，舉例來說，如果今天 <code>Toggle</code> 還有一個 props 是來控制 toggle on 時的 callback：  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Toggle</span></span><br><span class="line">  whenOn=<span class="string">&quot;Toggle is on&quot;</span></span><br><span class="line">  whenOff=<span class="string">&quot;Toggle is off&quot;</span>｀</span><br><span class="line">  whenOnCallback=&#123;<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;yeee, I am on&#x27;</span>)&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
  看起來就不是一個非常好的 API 設計，對吧？</li>
</ul>
<p>要解決這種情況，最適合的方式就是採用 <code>Compound component</code>！</p>
<p>所謂的 <strong>Compound component</strong> 就是讓你的 UI 元件透過 <code>this.props.children</code> 的方式傳入給 <code>parent component</code>，利用 <code>React.Children.map()</code> 來 render 所有傳入的 <code>this.props.children</code>，並且透過 <code>React.cloneElement</code> 將 parent 的 <code>state</code> 傳入每個 children 的 <code>props</code>，讓 parent 與 children 之間會 <strong>隱含著狀態的共享</strong>，對於元件使用者來說，他只需要傳入想要的 <code>children component</code>，不用知道 parent 與 children 之間如何溝通，當然也能隨意調整順序，這樣的 API 設計，對於元件使用者就非常的友善。</p>
<p>在這樣的原則下，不難發現，Compound component 必須要 <strong>同時結合使用 parent component 與 children component 才有意義</strong>。</p>
<p>以剛剛的 <code>&lt;Toggle&gt;</code> 為例子，若改以 Compound component 的話：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Toggle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title class_">On</span> = <span class="function">(<span class="params">&#123; on, children &#125;</span>) =&gt;</span> on &amp;&amp; children;</span><br><span class="line">  <span class="keyword">static</span> <span class="title class_">Off</span> = <span class="function">(<span class="params">&#123; on, children &#125;</span>) =&gt;</span> !on &amp;&amp; children;</span><br><span class="line">  <span class="keyword">static</span> <span class="title class_">Button</span> = <span class="function">(<span class="params">&#123; on, toggle &#125;</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;toggle&#125;</span> /&gt;</span></span></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123; <span class="attr">onToggle</span>: <span class="function">() =&gt;</span> &#123; &#125; &#125;</span><br><span class="line">  state = &#123; <span class="attr">on</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  toggle = <span class="function">() =&gt;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(</span><br><span class="line">      <span class="function">(<span class="params">&#123; on &#125;</span>) =&gt;</span> (&#123; <span class="attr">on</span>: !on &#125;),</span><br><span class="line">      <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onToggle</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>),</span><br><span class="line">    )</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> children = <span class="title class_">React</span>.<span class="property">Children</span>.<span class="title function_">map</span>(</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">children</span>,</span><br><span class="line">      <span class="function"><span class="params">child</span> =&gt;</span></span><br><span class="line">        <span class="title class_">React</span>.<span class="title function_">cloneElement</span>(child, &#123;</span><br><span class="line">          <span class="attr">on</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>,</span><br><span class="line">          <span class="attr">toggle</span>: <span class="variable language_">this</span>.<span class="property">toggle</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="title class_">Toggle</span></span><br><span class="line">  onToggle=&#123;<span class="function"><span class="params">on</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;toggle&#x27;</span>, on)&#125;</span><br><span class="line">&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle.On</span>&gt;</span>The button is on<span class="tag">&lt;/<span class="name">Toggle.On</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle.Off</span>&gt;</span>The button is off<span class="tag">&lt;/<span class="name">Toggle.Off</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle.Button</span> /&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Toggle</span>&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://codesandbox.io/embed/6zz376vrzz">Demo link</a></p>
<p>我們透過 <code>Toggle</code> Class 的 static properties 來定義 children component，這樣的好處是我們能夠從名稱上就保持 Parent 與 Children Component 之間的關聯性。</p>
<p>透過 Compound Component，不僅能讓使用者自訂元件順序，又能將 UI component 與其他 callback props 做個清楚的切割。對於使用者來說，完全不需要管 <code>Toggle</code> 的 state 變化時，<code>Toggle.On</code> 要怎麼變動，他們之間的 state 與 props 都由 Parent component 處理。</p>
<p>另外，在 Kent C. Dodds 的 workshop 中，有人提問為何不直接用 <code>this.props.children.map</code> 就好，而要用 <code>React.Children.map</code>？</p>
<p>原因在於，在目前 React 的實作中，當你的 children 只有一個時，<code>this.props.children</code> 不會是一個 array，透過 <code>React.Children.map</code> 能寫得更簡潔，少些判斷。</p>
<p>看到這邊，不知道有沒有想到，其實我們在撰寫表單時常用的 <code>&lt;select&gt;</code> 與 <code>&lt;option&gt;</code> 就是一個 Compound component 的例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span>&gt;</span>Opt 1<span class="tag">&lt;<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span>&gt;</span>Opt 2<span class="tag">&lt;<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="更有彈性的-Compound-Component"><a href="#更有彈性的-Compound-Component" class="headerlink" title="更有彈性的 Compound Component"></a>更有彈性的 Compound Component</h2><p>在上面的例子中，其實只要使用者更動其中一個 children，整個 Compound component 就會壞掉：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Toggle</span></span><br><span class="line">  onToggle=&#123;<span class="function"><span class="params">on</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;toggle&#x27;</span>, on)&#125;</span><br><span class="line">&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle.On</span>&gt;</span>The button is on<span class="tag">&lt;/<span class="name">Toggle.On</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle.Off</span>&gt;</span>The button is off<span class="tag">&lt;/<span class="name">Toggle.Off</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Toggle.Button</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Toggle</span>&gt;</span><br></pre></td></tr></table></figure>

<p>因為 <code>React.Children.map</code> 只會 for-loop 到第一層的 children，也就是說，<code>React.cloneElement</code> 現在不會複製 <code>&lt;Toggle.Button&gt;</code> 而是複製 <code>&lt;div&gt;</code> 了。</p>
<p>不過好在現在有了 React 16 的 Context API，要解決這個問題簡單了不少，主要就是將 <code>state</code> 的共享改由 <code>Context</code> 來完成：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ToggleContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(&#123;</span><br><span class="line">  <span class="attr">on</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">toggle</span>: <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Toggle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title class_">On</span> = <span class="function">(<span class="params">&#123; children &#125;</span>) =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ToggleContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;contextValue =&gt; contextValue.on &amp;&amp; children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ToggleContext.Consumer</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">static</span> <span class="title class_">Off</span> = <span class="function">(<span class="params">&#123; children &#125;</span>) =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ToggleContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;contextValue =&gt; !contextValue.on &amp;&amp; children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ToggleContext.Consumer</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">static</span> <span class="title class_">Button</span> = <span class="function">() =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ToggleContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;contextValue =&gt; <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;contextValue.toggle&#125;</span>&gt;</span> Toggle <span class="tag">&lt;/<span class="name">button</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ToggleContext.Consumer</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123; <span class="attr">onToggle</span>: <span class="function">() =&gt;</span> &#123;&#125; &#125;;</span><br><span class="line">  state = &#123; <span class="attr">on</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">  toggle = <span class="function">() =&gt;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(</span><br><span class="line">      <span class="function">(<span class="params">&#123; on &#125;</span>) =&gt;</span> (&#123; <span class="attr">on</span>: !on &#125;),</span><br><span class="line">      <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onToggle</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>)</span><br><span class="line">    );</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 由於不用傳遞 props 給 children，也就不用 React.Children.map 了，直接使用 this.props.children 即可</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">ToggleContext.Provider</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">on:</span> <span class="attr">this.state.on</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">toggle:</span> <span class="attr">this.toggle</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;this.props.children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ToggleContext.Provider</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="title class_">Toggle</span> onToggle=&#123;<span class="function"><span class="params">on</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;toggle&quot;</span>, on)&#125;&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle.On</span>&gt;</span>The button is on<span class="tag">&lt;/<span class="name">Toggle.On</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle.Off</span>&gt;</span>The button is off<span class="tag">&lt;/<span class="name">Toggle.Off</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Toggle.Button</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Toggle</span>&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://codesandbox.io/embed/mzv766qqmx">Demo Link</a></p>
<p>如此一來，使用者想要在我們的 Componet 裡面如何 wrap 各個 Child Component 都可以了！</p>
<p><strong>Note:</strong> 在 workshop 中，Kent C. Dodds 有提到關於在 render 時， <code>Provider</code> 每次都會接收到新 object，造成多餘 re-render 的問題，因此可以做點小改良：<br>將要傳給 <code>Provider</code> 的 value 改以 <code>this.state</code> 傳入，這樣每次在 render <code>Toggle</code> 時，才不會讓所有 <code>Toggle</code> 的 children component 也 re-render。<br>只是要特別注意你原本要傳入 context 的 value 內，若有一些 function 如 <code>this.toggle</code>，記得確保你的 state 在宣告時能取得到。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">toggle = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setState</span>(</span><br><span class="line">    <span class="function">(<span class="params">&#123; on &#125;</span>) =&gt;</span> (&#123; <span class="attr">on</span>: !on &#125;),</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onToggle</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>)</span><br><span class="line">  );</span><br><span class="line">state = &#123; <span class="attr">on</span>: <span class="literal">false</span>, <span class="attr">toggle</span>: <span class="variable language_">this</span>.<span class="property">toggle</span> &#125;; <span class="comment">// 將 state 移至 toggle function 之下，以確保 refer 得到</span></span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 由於不用傳遞 props 給 children，也就不用 React.Children.map 了，直接使用 this.props.children 即可</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ToggleContext.Provider</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">value</span>=<span class="string">&#123;this.state&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;this.props.children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ToggleContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>

<p>不過當你並不想把所有 <code>state</code> 都放入 <code>context</code> 時，可能就得想另一種方法了。</p>
<h1 id="Render-props-comopnent"><a href="#Render-props-comopnent" class="headerlink" title="Render props comopnent"></a>Render props comopnent</h1><p>Render props 相對於 Compound Component 來說應該是比較有名的 Pattern，而他的概念與實作方式也相對簡單，網路上也早有針對 Render props 的相關討論，像<a target="_blank" rel="noopener" href="https://blog.kentcdodds.com/answers-to-common-questions-about-render-props-a9f84bb12d5d">這個</a>或<a target="_blank" rel="noopener" href="https://hackernoon.com/do-more-with-less-using-render-props-de5bcdfbe74c">這個</a>。</p>
<p>從名稱就可以猜出一二，所謂 Render props 就是將 render function 當作 props 傳入，讓原本的 render function 的控制權，從內部元件本身移轉至使用該元件的使用者身上，這種方式讓使用元件的使用者可以更方便的操作 <code>｀state</code>，而實作方式上比較常看到的有兩種：</p>
<ul>
<li><p>將 render 當作 props 傳入：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Toggle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123; <span class="attr">onToggle</span>: <span class="function">() =&gt;</span> &#123; &#125; &#125;</span><br><span class="line">  state = &#123; <span class="attr">on</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  toggle = <span class="function">() =&gt;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(</span><br><span class="line">      <span class="function">(<span class="params">&#123; on &#125;</span>) =&gt;</span> (&#123; <span class="attr">on</span>: !on &#125;),</span><br><span class="line">      <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onToggle</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>),</span><br><span class="line">    )</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">renderToggle</span>(&#123;<span class="attr">on</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>, <span class="attr">toggle</span>: <span class="variable language_">this</span>.<span class="property">toggle</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="title class_">Toggle</span></span><br><span class="line">  onToggle=&#123;<span class="function"><span class="params">on</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;toggle&#x27;</span>, on)&#125;</span><br><span class="line">  renderToggle=&#123;<span class="function">(<span class="params">&#123;on, toggle&#125;</span>) =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;on ? &#x27;The button is on&#x27; : &#x27;The button is off&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      &lt;buttononClick=&#123;toggle&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        &#123;on ? &#x27;click on&#x27; : &#x27;click off&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>用 <code>this.props.children</code> 來呼叫 render props：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Toggle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> defaultProps = &#123; <span class="attr">onToggle</span>: <span class="function">() =&gt;</span> &#123; &#125; &#125;</span><br><span class="line">    state = &#123; <span class="attr">on</span>: <span class="literal">false</span> &#125;</span><br><span class="line">    toggle = <span class="function">() =&gt;</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(</span><br><span class="line">        <span class="function">(<span class="params">&#123; on &#125;</span>) =&gt;</span> (&#123; <span class="attr">on</span>: !on &#125;),</span><br><span class="line">        <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onToggle</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>),</span><br><span class="line">      )</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">children</span>(&#123;<span class="attr">on</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>, <span class="attr">toggle</span>: <span class="variable language_">this</span>.<span class="property">toggle</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;<span class="title class_">Toggle</span></span><br><span class="line">    onToggle=&#123;<span class="function"><span class="params">on</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;toggle&#x27;</span>, on)&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &#123;<span class="function">(<span class="params">&#123;on, toggle&#125;</span>) =&gt;</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;on ? &#x27;The button is on&#x27; : &#x27;The button is off&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;toggle&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;on ? &#x27;click on&#x27; : &#x27;click off&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )&#125;</span><br><span class="line">  &lt;/<span class="title class_">Toggle</span>&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://codesandbox.io/embed/6zx6q92qw">Demo Link</a></p>
<p>以這兩種方法來說，我的想法與 Kent C. Dodds 相同，以 <code>this.props.children</code> 來呼叫 render props 在使用上比較有優勢，除了可以明確知道 <code>Toggle</code> 元件的起始點外，還可以避免 當 renderProps 的內容很多時，容易 miss 掉一些 <code>Toggle</code> 的重要 props 的問題，例如下面的範例：</p>
<iframe src="https://codesandbox.io/embed/jv9xjz5mr3?view=editor" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

<h1 id="Prop-Collections-and-Getters"><a href="#Prop-Collections-and-Getters" class="headerlink" title="Prop Collections and Getters"></a>Prop Collections and Getters</h1><p>在 Kent C. Dodds 的 workshop 中所提到的 <code>Prop Collections</code> 與 <code>Prop Getters</code> 其實是要搭配運用的。</p>
<p>我們將上面的例子稍微改變一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Toggle</span> onToggle=&#123;<span class="function"><span class="params">on</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;toggle&quot;</span>, on)&#125;&gt;</span><br><span class="line">  &#123;<span class="function">(<span class="params">&#123; on, toggle &#125;</span>) =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;on ? &quot;The button is on&quot; : &quot;The button is off&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button1&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;toggle&#125;</span> <span class="attr">aria-pressed</span>=<span class="string">&#123;on&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button2&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;toggle&#125;</span> <span class="attr">aria-pressed</span>=<span class="string">&#123;on&#125;</span> <span class="attr">aria-label</span>=<span class="string">&quot;custom-button2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/<span class="title class_">Toggle</span>&gt;</span><br></pre></td></tr></table></figure>

<p>現在我們有兩個 button 可以同時更改 Toggle 的狀態，而稍微注意一下可以發現兩個 button 其實接收的 props 有共通的部份，目前的寫法很多餘，也不好看。這時候我們就可以創造一個 <code>Prop collections</code> 來負責提供 Common 的 props：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Toggle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="comment">//... Same as before</span></span><br><span class="line">  <span class="title function_">getStateAndHelpers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">on</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>,</span><br><span class="line">      <span class="attr">togglerProps</span>: &#123; <span class="comment">// collection for common Props</span></span><br><span class="line">        <span class="string">&quot;aria-pressed&quot;</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>,</span><br><span class="line">        <span class="attr">onClick</span>: <span class="variable language_">this</span>.<span class="property">toggle</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">children</span>(<span class="variable language_">this</span>.<span class="title function_">getStateAndHelpers</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而剛剛的範例就能修改為：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Toggle</span> onToggle=&#123;<span class="function"><span class="params">on</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;toggle&quot;</span>, on)&#125;&gt;</span><br><span class="line">  &#123;<span class="function">(<span class="params">&#123; on, togglerProps &#125;</span>) =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;on ? &quot;The button is on&quot; : &quot;The button is off&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button1&quot;</span> &#123;<span class="attr">...togglerProps</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">class</span>=<span class="string">&quot;button2&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#123;<span class="attr">...togglerProps</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">aria-label</span>=<span class="string">&quot;custom-button2&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/<span class="title class_">Toggle</span>&gt;</span><br></pre></td></tr></table></figure>

<p>但這樣做你可能會發現一個缺點，就是當別人不小心 overwrite 你的 common props 時，你無能為力。這其實也是 <code>render props</code> 的一個小缺點，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;button</span><br><span class="line">  <span class="keyword">class</span>=<span class="string">&quot;button1&quot;</span></span><br><span class="line">  &#123;...togglerProps&#125;</span><br><span class="line">  onClick=&#123;<span class="function">() =&gt;</span> <span class="string">&#x27;overwrite&#x27;</span>&#125; <span class="comment">// 蓋過我們原先在 onClick 的操作 (this.toggle)</span></span><br><span class="line">&gt;</span><br><span class="line">  &#123;on ? <span class="string">&quot;click on&quot;</span> : <span class="string">&quot;click off&quot;</span>&#125;</span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<h2 id="這時候-Prop-Getters-就可以出動了！"><a href="#這時候-Prop-Getters-就可以出動了！" class="headerlink" title="這時候 Prop Getters 就可以出動了！"></a>這時候 <code>Prop Getters</code> 就可以出動了！</h2><p>在原本的 Prop collections（<code>togglerProps</code>）中，我們改以呼叫一個 <code>Prop Getter</code> 的方式取得 common props：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Toggle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="comment">//... Same as before</span></span><br><span class="line">  getTogglerProps = <span class="function">(<span class="params">&#123; onClick, ...props &#125; = &#123;&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="string">&#x27;aria-pressed&#x27;</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>,</span><br><span class="line">    <span class="attr">onClick</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">toggle</span>();</span><br><span class="line">      onClick &amp;&amp; <span class="title function_">onClick</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    ...props,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getStateAndHelpers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">on</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>,</span><br><span class="line">      <span class="attr">getTogglerProps</span>: <span class="variable language_">this</span>.<span class="property">getTogglerProps</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">children</span>(<span class="variable language_">this</span>.<span class="title function_">getStateAndHelpers</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如此一來，使用者所提供的 <code>onClick</code> 就不會蓋過我們元件原始的 <code>onClick</code> 行為，也就是 <code>this.toggle</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;button</span><br><span class="line">  <span class="keyword">class</span>=<span class="string">&quot;button2&quot;</span></span><br><span class="line">  &#123;...<span class="title function_">getTogglerProps</span>(&#123;</span><br><span class="line">    <span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;overwrite&#x27;</span>)</span><br><span class="line">  &#125;)&#125;</span><br><span class="line">  aria-label=<span class="string">&quot;custom-button2&quot;</span></span><br><span class="line">&gt;</span><br><span class="line">  &#123;on ? <span class="string">&quot;click on&quot;</span> : <span class="string">&quot;click off&quot;</span>&#125;</span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<p>如果想要 overwrite 更多的 method，在 <code>Prop Getter</code> 中也要做相對應的判斷與修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">getTogglerProps = <span class="function">(<span class="params">&#123; onClick, otherMethod, ...props &#125; = &#123;&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="string">&#x27;aria-pressed&#x27;</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>,</span><br><span class="line">  <span class="attr">onClick</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">toggle</span>();</span><br><span class="line">    onClick &amp;&amp; <span class="title function_">onClick</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">otherMethod</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">originOtherMethod</span>();</span><br><span class="line">    otherMethod &amp;&amp; <span class="title function_">otherMethod</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  ...props,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>如果嫌每次都要判斷傳入的 props 是否存在很麻煩，可以學 Kent C. Dodds 寫一個 handy funtion：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">callAll</span> = (<span class="params">...fns</span>) =&gt; <span class="function">(<span class="params">...args</span>) =&gt;</span></span><br><span class="line">  fns.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> fn &amp;&amp; <span class="title function_">fn</span>(...args));</span><br><span class="line">getTogglerProps = <span class="function">(<span class="params">&#123; onClick, otherMethod, ...props &#125; = &#123;&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="string">&#x27;aria-pressed&#x27;</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">on</span>,</span><br><span class="line">  <span class="attr">onClick</span>: <span class="title function_">callAll</span>(onClick, <span class="variable language_">this</span>.<span class="property">toggle</span>),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://codesandbox.io/embed/wywk4w1z6w">Demo Link</a></p>
<h1 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h1><p>今天統整了三個 React component patterns: <code>Compound Component</code>、<code>Render Props</code> 與 <code>Prop Collections &amp; Getters</code>，讓我自己對這幾個 pattern 更熟悉了一些，不過還是要盡量運用在自己的專案當中，才能確切感受其好處，並更得心應手。也希望這些整理對來到這邊的讀者有所幫助，剩下的幾個 Pattern 會陸續補上，決不食言！</p>
<p>最後，再次呼籲大家去看看 Kent C. Dodds 的影片 <a target="_blank" rel="noopener" href="https://frontendmasters.com/courses/advanced-react-patterns/">Advanced React Patterns</a>，我比較推薦看 workshop 的版本，因為還可以聽到現場其他人對他的提問，以及他的回答，都很有幫助！</p>
<h2 id="資料來源"><a href="#資料來源" class="headerlink" title="資料來源"></a>資料來源</h2><ol>
<li><a target="_blank" rel="noopener" href="https://frontendmasters.com/courses/advanced-react-patterns/">Advanced React Patterns workshop</a></li>
<li><a target="_blank" rel="noopener" href="https://codesandbox.io/s/github/kentcdodds/advanced-react-patterns-v2">Advanced React Patterns V2 codesandbox</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.kentcdodds.com/advanced-react-component-patterns-56af2b74bc5f">Advanced React Patterns Blog</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/59b78dfe5188257e7e115cae">什麼是設計模式</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.kentcdodds.com/answers-to-common-questions-about-render-props-a9f84bb12d5d">Answers to common questions about render props</a></li>
<li><a target="_blank" rel="noopener" href="https://hackernoon.com/do-more-with-less-using-render-props-de5bcdfbe74c">Do more with less using render props</a></li>
</ol>
<p>關於作者：<br><a target="_blank" rel="noopener" href="http://blog.arvinh.info/about/">@arvinh</a> 前端攻城獅，熱愛數據分析和資訊視覺化</p>
  
      <div>喜歡我們的文章嗎？歡迎分享按讚給予我們支持和鼓勵！</div>
      <div class="fb-like" data-href="https://blog.techbridge.cc/2018/06/27/advanced-react-component-patterns-note/index.html" data-layout="button_count" data-action="like" data-size="large" data-show-faces="false" data-share="true"></div>
      <br>
      <br>
      <div class="fb-page" data-href="https://www.facebook.com/techbridge.cc" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="https://www.facebook.com/techbridge.cc" class="fb-xfbml-parse-ignore"><a target="_blank" rel="noopener" href="https://www.facebook.com/techbridge.cc">TechBridge 技術日報</a></blockquote></div>
      <br>
    </section>
    <br>
    <hr>
    <div>
      <h4>訂閱 TechBridge Weekly 技術週刊，每週發送最精華的技術開發、產品設計的資訊給您</h4>
      <form class="form-control" method="post" action="https://goodbits.io/e/cab8a418-6b70-48d6-97ea-b5f0ef34b22c" target="_blank">
        <input class="form-control" type="text" name="first_name" placeholder="First Name"></input>
        <input class="form-control" type="text" name="last_name" placeholder="Last Name"></input>
        <div>
          <input class="form-control" type="text" name="email" placeholder="Email"></input>
        </div>
        <br>
        <div>
          <button class="form-control btn subscribe-btn" type="submit">馬上訂閱技術週刊</button>
        </div>
        <br>
        <label for="">PS. 我們討厭垃圾信，所以我們只提供有價值的內容給您 :)</label>
      </form>
    </div>
    <footer class="post-footer">
      <section class="author">
    <h4>TechBridge Weekly 技術週刊編輯團隊</h4>
    <p>TechBridge Weekly 技術週刊團隊是一群對用技術改變世界懷抱熱情的團隊。本技術共筆部落格初期專注於Web前後端、行動網路、機器人/物聯網、資料科學與產品設計等技術分享。This is TechBridge Weekly Team Tech Blog, which focus on web, mobile, robotics, IoT, Data Science technology sharing.</p>
    <span><a href="/2016/03/19/about/">關於我們</a></span> / <span><a href="https://www.techbridge.cc/" target="_blank">技術日報</a></span> / <span><a href="http://weekly.techbridge.cc/" target="_blank">技術週刊</a></span> / <span><a href="https://www.facebook.com/techbridge.cc/" target="_blank">粉絲專頁</a></span> / <span><a href="/atom.xml" target="_blank">訂閱RSS </a></span>   
	<div class="fb-like" data-href="https://www.facebook.com/techbridge.cc" data-layout="button_count" data-size="large" data-action="like" data-show-faces="false" data-share="true"></div>    
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" target="_blank" rel="noopener" href="http://twitter.com/share?url=https://blog.techbridge.cc/2018/06/27/advanced-react-component-patterns-note/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" target="_blank" rel="noopener" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.techbridge.cc/2018/06/27/advanced-react-component-patterns-note/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" target="_blank" rel="noopener" href="https://plus.google.com/share?url=https://blog.techbridge.cc/2018/06/27/advanced-react-component-patterns-note/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
    <iframe src="https://ghbtns.com/github-btn.html?user=TechBridgeHQ&repo=blog-starter-kit&type=star&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>      
</section>
    </footer>
    <br>
  </article>
  <nav class="pagination" role="pagination">
    <h2>更多優質技術文章</h2>
    
    <a class="newer-posts" href="/2018/07/07/resrc-for-swe/">
        ← 軟體工程師面試資源最簡整理與技巧分享
    </a>
    
    <span class="page-number">•</span>
    
    <a class="older-posts" href="/2018/06/23/javascript-call-by-value-or-reference/">
        深入探討 JavaScript 中的參數傳遞：call by value 還是 reference？ →
    </a>
    
</nav>
  <div id="comment" class="comments-area">
    <h1 class="title"><a href="#disqus_comments" name="disqus_comments">留言討論</a></h1>

    
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
    
</div>
</main>


  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75308642-1', 'auto');
  ga('send', 'pageview');

</script>
<footer class="site-footer">
  
  <a class="subscribe icon-feed" href="/atom.xml"><span class="tooltip">Subscribe!</span></a>
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">TechBridge 技術共筆部落格</a> &copy; 2017 &bull; All rights reserved.</section>
  </div>
</footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>


<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '[object Object]']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>


<script type="text/javascript">
    var disqus_shortname = 'techbridgeweekly';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.4/dist/medium-zoom.min.js"></script>
<script>
// NodeList
mediumZoom(document.querySelectorAll('img'));
</script>
  <div id="fb-root"></div>
	<script>(function(d, s, id) {
	  var js, fjs = d.getElementsByTagName(s)[0];
	  if (d.getElementById(id)) return;
	  js = d.createElement(s); js.id = id;
	  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
	  fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));</script>
</body>
</html>
